/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../Map.js";import i from"../TimeExtent.js";import r from"../core/Accessor.js";import{c as s}from"../chunks/asyncUtils.js";import o from"../core/Collection.js";import{C as a}from"../chunks/CollectionFlattener.js";import n from"../core/Error.js";import l from"../core/Evented.js";import{HandleOwner as p,HandleOwnerMixin as h}from"../core/HandleOwner.js";import{m as u}from"../chunks/handleUtils.js";import c from"../core/Loadable.js";import{L as d}from"../chunks/Logger.js";import{a as m,i as y,r as g,g as f,u as _,d as v,f as w}from"../chunks/maybe.js";import{EsriPromiseMixin as b}from"../core/Promise.js";import{createDeferred as j,createAbortError as k,isAbortError as M,onAbort as T,throwIfAborted as R,isAborted as S,after as V}from"../core/promiseUtils.js";import{on as C,watch as E,syncAndInitial as x,whenOnce as I,when as L,sync as P}from"../core/reactiveUtils.js";import{property as F}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{s as O}from"../chunks/ensureType.js";import{subclass as U}from"../core/accessorSupport/decorators/subclass.js";import{O as D,G as A,o as q}from"../chunks/GraphicsCollection.js";import W from"../geometry/Extent.js";import G from"../geometry/HeightModelInfo.js";import N,{e as H}from"../geometry/SpatialReference.js";import"../chunks/object.js";import{BasemapView as z}from"./BasemapView.js";import{schedule as K}from"../core/scheduling.js";import{W as B}from"../chunks/WatchUpdatingTracking.js";import $ from"./Magnifier.js";import{T as Q,I as J}from"../chunks/Scheduler.js";import{V as X}from"../chunks/InputManager.js";import{e as Y,V as Z}from"../chunks/ViewEvents.js";import{E as ee}from"../chunks/interfaces3.js";import{f as te}from"../core/Handles.js";import{c as ie}from"../chunks/mathUtils.js";import{c as re}from"../chunks/screenUtils.js";import{c as se}from"../chunks/screenUtils2.js";import oe from"./input/Input.js";import ae from"./navigation/Navigation.js";import{s as ne,d as le}from"../chunks/heightModelInfoUtils.js";import{V as pe}from"../chunks/ViewingMode.js";import{isLoaded as he,canProjectWithoutEngine as ue,project as ce,load as de}from"../geometry/projection.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/JSONSupport.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../chunks/nextTick.js";import"../config.js";import"../chunks/string.js";import"../chunks/loadAll.js";import"../core/urlUtils.js";import"../chunks/writer.js";import"../portal/Portal.js";import"../kernel.js";import"../request.js";import"../chunks/reader.js";import"../chunks/locale.js";import"../portal/PortalQueryParams.js";import"../chunks/jsonMap.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalItem.js";import"../chunks/assets.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/messages.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../Ground.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/compilerUtils.js";import"../chunks/enumeration.js";import"../chunks/debugFlags.js";import"../chunks/opacityUtils.js";import"../chunks/editableLayers.js";import"../chunks/basemapUtils.js";import"../chunks/collectionUtils2.js";import"../support/LayersMixin.js";import"../layers/Layer.js";import"../geometry.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../core/Identifiable.js";import"../support/TablesMixin.js";import"../chunks/timeUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../chunks/number.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/ObservableValue.js";import"../chunks/debugFlags2.js";import"../chunks/Queue.js";import"../chunks/IViewEvents.js";import"./input/gamepad/GamepadSettings.js";import"./input/gamepad/GamepadInputDevice.js";import"./navigation/gamepad/GamepadSettings.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";let me=class extends D{constructor(e){super(e),this.handles.add(this.on("before-add",(e=>{m(e.item)||e.item.parent===this.owner&&(d.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())})))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};me=e([U("esri.support.AnalysesCollection")],me);class ye{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=j(),this._started=!1,this.done=!1,T(this._controller.signal,(()=>{const t=new n("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{let r,s;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new n("layer:view-not-supported","No layerview implementation was found");const s=await this.layerViewImporter.importLayerView(t);R(e),r="default"in s?new s.default({layer:t,view:i}):new s({layer:t,view:i})}const o=()=>{s=g(s),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};s=T(e,o),R(e);try{await r.when()}catch(e){throw o(),e}const a=this._map?.allLayers?.includes(t);if(!a)return o(),void this._deferred.reject(new n("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new n("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let ge=class extends r{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new B,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const e=this.view.map?.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>(m(this._workPromise)&&(this._workPromise=j(),this._workPromise.promise.catch((()=>{}))),this.removeHandles("reschedule"),this.addHandles(K(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{const e=this.view.map;if(this._map!==e&&(this.clear(),this._map=e),m(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const t=[],i=e=>{if(!m(e))for(const r of e)r&&(t.push(r),this._createLayerView(r),"layers"in r&&r.layers&&i(r.layers))};for(const e of this._rootCollectionNames)i(this.get(e));this._refreshCollections();for(const[e,i]of this._layerLayerViewInfoMap)t.includes(e)||(this._layerLayerViewInfoMap.delete(i.layer),i.destroy());const r=t.filter((e=>"group"===e.type)).map((e=>e.layers)),s=[e?.ground?.layers,e?.basemap?.baseLayers,e?.basemap?.referenceLayers,e?.layers,...r].filter((e=>!!e));this.addHandles(s.map((e=>this._watchUpdatingTracking.addOnCollectionChange((()=>e),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([C((()=>this.view?.map?.allLayers),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),E((()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]}),(()=>this._reschedule()),x)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,y(this._workPromise)&&(this._workPromise.reject(k()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return y(this._workPromise)||this._watchUpdatingTracking.updating||O(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new n("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const o=e.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new ye(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{t&&(M(t)||"cancelled:layerview-create"===t.name)||d.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};e([F()],ge.prototype,"_workPromise",void 0),e([F({readOnly:!0})],ge.prototype,"_watchUpdatingTracking",void 0),e([F({readOnly:!0})],ge.prototype,"_layersToLayerViews",null),e([F({readOnly:!0})],ge.prototype,"_rootCollectionNames",null),e([F()],ge.prototype,"layerViewImporter",void 0),e([F()],ge.prototype,"supportsGround",void 0),e([F({readOnly:!0})],ge.prototype,"updating",null),e([F({readOnly:!0})],ge.prototype,"updatingRemaining",null),e([F({constructOnly:!0})],ge.prototype,"view",void 0),ge=e([U("esri.views.LayerViewManager")],ge);const fe=ge;let _e=class extends r{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(Q.TEXTURE_UNLOAD)??J}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return y(t)?`${e}.${t}px`:e}};function ve(e){return e.visible&&e.getEditableFlag(ee.USER)&&e.getEditableFlag(ee.MANAGER)}e([F()],_e.prototype,"_frameTask",void 0),e([F()],_e.prototype,"updating",null),_e=e([U("esri.views.3d.support.TextureCollection")],_e);class we{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":be(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!je(e))break;const r=se(e),s=this._intersect(r,e.pointerType,t.forEachTool);if(m(s))break;const o=s.manipulator,a=s.tool;!(y(o)&&y(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,t),y(o)&&y(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:r,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&m(t.activeTool)&&(this._revertToNullActiveTool=!0,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:r}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!je(e))break;const r=this._grabbedManipulators.get(e.pointerId),s=f(r,(({manipulator:e})=>e)),o=f(r,(({tool:e})=>e));if(m(s)||m(o))break;const a=se(e);a.x=ie(a.x,0,t.view.width),a.y=ie(a.y,0,t.view.height);const n=_(r).start,l=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(s.dragging=!0,l?s.events.emit("drag",{action:"update",start:n,screenPoint:a}):s.events.emit("drag",{action:"start",start:n,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:n}));break;case"end":s.dragging=!1,l&&s.events.emit("drag",{action:"end",start:n,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=se(e),s=this._intersect(r,e.pointerType,t.forEachTool);if(e.native.shiftKey||t.forEachTool((e=>{if((!y(s)||s.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.onManipulatorSelectionChanged&&e.onManipulatorSelectionChanged()}})),m(s))break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const n=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:n,stopPropagation:i});break}case"click":{const r=se(e),s=this._intersect(r,e.pointerType,t.forEachTool),o=y(s)?s.manipulator:null;if(m(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const r=se(e),s=this._intersect(r,e.pointerType,t.forEachTool),o=y(s)?s.manipulator:null;if(m(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const r=se(e),s=this._intersect(r,e.pointerType,t.forEachTool),o=y(s)?s.manipulator:null;if(m(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:se(t)}),this._grabbedManipulators.forEach((({manipulator:t},i)=>{t===e&&this._grabbedManipulators.delete(i)})),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,t){const i=f(this._grabbedManipulators.get(e.pointerId),(({manipulator:e})=>e));m(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:se(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(t.setActiveTool))}_cursorFromMap(e){let t=null;return O(e,(({manipulator:e})=>!(m(e)||!e.interactive||(e.grabbing&&e.grabCursor?(t=e.grabCursor,0):!e.cursor||(t=e.cursor,0))))),t}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,i=new Set;this._grabbedManipulators.forEach((({tool:e})=>{t.add(e)})),this._hoveredManipulators.forEach((({tool:e})=>{i.add(e)})),e((e=>{e.hasGrabbedManipulators=t.has(e),e.hasHoveredManipulators=i.has(e);const r=this._grabbedManipulators.values(),s=te(r,(({tool:t})=>t===e));e.firstGrabbedManipulator=y(s)?s.manipulator:null}))}clearPointers(e,{forEachTool:t,setActiveTool:i},r=!0,s){const o=(t,i)=>t===e&&(m(s)||s===i);this._grabbedManipulators.forEach((({tool:e,manipulator:t,pointerType:i},r)=>{o(e,t)&&(this._grabbedManipulators.delete(r),t.grabbing=!1,t.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))})),this._draggedManipulators.forEach((({tool:e,manipulator:t},i)=>{o(e,t)&&(this._draggedManipulators.delete(i),t.dragging=!1,t.events.emit("drag",{action:"cancel"}))})),r&&this._hoveredManipulators.forEach((({tool:e,manipulator:t},i)=>{o(e,t)&&(this._hoveredManipulators.delete(i),t.hovering=!1)})),this._afterManipulatorUngrab(i),this._onFocusChange(t)}_intersect(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!ve(i))return!1;const s=i.manipulators.intersect(e,t);return!m(s)&&(r={tool:i,manipulator:s},!0)})),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(re(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!be(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(se(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){let s=this._intersect(e,i,r);const o=f(this._hoveredManipulators.get(t),(({manipulator:e})=>e));y(s)&&!s.manipulator.interactive&&(s=null),y(s)&&o===s.manipulator||(y(o)&&(o.hovering=!1),y(s)?(s.manipulator.hovering=!0,this._hoveredManipulators.set(t,s)):this._hoveredManipulators.delete(t),this._onFocusChange(r))}_afterManipulatorUngrab(e){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}}function be(e){return"mouse"===e}function je(e){return"mouse"!==e.pointerType||0===e.button}let ke=class extends p{constructor(e){super(e),this._manipulatorState=new we,this.tools=new o,this.cursor=null,this._forEachTool=e=>{for(const t of this.tools.items)if(e(t))return}}initialize(){var e;this.handles.add([this.view.on(Y,(e=>{this._handleInputEvent(e)}),X.TOOL),...(e=this.tools,[e.on("before-add",(t=>{const i=t.item;if(null==i||e.includes(i))return d.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()})),e.on("after-remove",(e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()}))]),this.tools.on("before-add",(({item:e})=>{this._updateToolEditableFlag(e)})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(y(e)&&!this.view.ready)return void d.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),y(t)&&t.deactivate(),y(e)&&e.activate(),this._removeIncompleteTools(e);for(const e of this.tools){this._updateToolEditableFlag(e);const t=ve(e);!m(this.activeTool)&&t||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!t)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))||(this.textures?.updating??!1)}attach(){"3d"===this.view.type?(this._set("textures",new _e(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([E((()=>{const{state:e}=this.view;return"camera"in e&&e.camera}),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this._forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))})),u((()=>this._set("textures",v(this.textures))))],"attached")):this.handles.add(E((()=>this.view.extent),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){y(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove("attached")}_forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};y(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&e.visible&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),!t&&y(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove("tools"),this._forEachTool((e=>{if(e instanceof r){const t=E((()=>[e.cursor,e.visible,e.editable]),(()=>{ve(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}));this.handles.add(t,"tools")}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",(t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)})),e.manipulators.on("change",(()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}))],"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag(ee.MANAGER,m(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;m(e)&&this._forEachTool((t=>!(!y(t.cursor)||!t.visible||(e=t.cursor,0)))),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter((t=>(m(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel)).forEach((e=>{this.tools.remove(e)}))}};e([F({constructOnly:!0,nonNullable:!0})],ke.prototype,"view",void 0),e([F({readOnly:!0,nonNullable:!0})],ke.prototype,"textures",void 0),e([F({value:null})],ke.prototype,"activeTool",null),e([F({readOnly:!0,type:o})],ke.prototype,"tools",void 0),e([F({readOnly:!0})],ke.prototype,"cursor",void 0),e([F({readOnly:!0})],ke.prototype,"updating",null),ke=e([U("esri.views.ToolViewManager")],ke);const Me=ke;let Te,Re=null;async function Se(e){Re||(Re=import("../chunks/geometryServiceUtils.js").then((e=>Te=e))),await Re,R(e)}async function Ve(e,t,i,r){if(!e)return null;const s=e.spatialReference;return he()||ue(s,t)?ce(e,t):Te?Te.projectGeometry(e,t,i,r):(await Promise.race([Se(r),de(r)]),Ve(e,t,i,r))}let Ce=class extends r{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=w(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return y(this.userSpatialReference)?this.userSpatialReference:_(this._spatialReferenceTask.spatialReference)}get extent(){return _(this._extentTask.extent)}get heightModelInfo(){return _(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return _(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return _(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return m(this.userSpatialReference)||this.userSpatialReference.equals(_(this._spatialReferenceTask.spatialReference))?_(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return _(this._tileInfoTask.tileInfo)}get mapCollections(){const e=this.map?.(),t=[];return y(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const t of e){const e=this._getSupportedSpatialReferences(t);if(e.length>0){const t=this._narrowDownSpatialReferenceCandidates(i,e);y(t)&&(i=t)}if(y(i)&&1===i.length)break}if(t&&(m(i)||1!==i.length))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:y(r)?r.spatialReference:null,viewingMode:y(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const t=e[0].tileInfo;return{tileInfo:t&&t.spatialReference.equals(this.spatialReference)?t:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const t of e)if(ne(t)){const e=le(t);if(e)return{heightModelInfo:e,vcsWkid:t.spatialReference?.vcsWkid,latestVcsWkid:t.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const t of e.layers){const e="fullExtents"in t&&t.fullExtents||(y(t.fullExtent)?[t.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:e[0],s=e.find((e=>e.spatialReference.equals(this.spatialReference)))??r;if(s)return{candidates:[{extent:s,layer:t}],updating:!1};if(this._getSupportedSpatialReferences(t).length>0)for(const r of e)i.push({extent:r,layer:t})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(m(e)||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:y(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(y(this._projectExtentTask.task)&&(this._projectExtentTask.task=w(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:s((async e=>{try{const t=await Ve(i.extent,r,i.layer.portalItem,e);this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if(S(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(m(e))return t;const i=[],r=(e,t)=>y(e)?y(t)?e===t&&e:e:t;for(const s of e)for(const e of t){if(!s.spatialReference.equals(e.spatialReference))continue;const t=r(s.viewingMode,e.viewingMode);if(!1!==t){i.push({spatialReference:s.spatialReference,viewingMode:t});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return m(e)||e.length<1?y(t)?{spatialReference:t,viewingMode:null}:null:(y(t)&&e.length>1&&e.some((({spatialReference:e})=>e.equals(t)))&&(e=e.filter((({spatialReference:e})=>e.equals(t)))),e.length>1&&e.some((({viewingMode:e})=>e!==pe.Local))&&(e=e.filter((({viewingMode:e})=>e!==pe.Local))),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const i=[];for(const r of t){const t=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(y(t)){const e=y(t.constraints)?t.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:t,viewingMode:r}of e)(!this.requiresExtentInSpatialReference||m(this.userSpatialReference)||t.equals(this.userSpatialReference))&&i.push({spatialReference:t,viewingMode:r})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((({extent:e})=>t.equals(e.spatialReference)))||e[0]}_collectLayers(e){if("loaded"!==this._loadMaybe(this.map?.()))return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(e.load().catch((()=>{})),"loading"):e.loadStatus:"loaded"}};var Ee;e([F()],Ce.prototype,"required",void 0),e([F({constructOnly:!0})],Ce.prototype,"map",void 0),e([F({constructOnly:!0})],Ce.prototype,"getSpatialReferenceSupport",void 0),e([F()],Ce.prototype,"defaultSpatialReference",void 0),e([F()],Ce.prototype,"userSpatialReference",void 0),e([F()],Ce.prototype,"sourcePreloadCount",void 0),e([F()],Ce.prototype,"priorityCollection",void 0),e([F()],Ce.prototype,"requiresExtentInSpatialReference",void 0),e([F()],Ce.prototype,"suspended",void 0),e([F({readOnly:!0})],Ce.prototype,"ready",null),e([F({readOnly:!0})],Ce.prototype,"heightModelInfoReady",null),e([F({readOnly:!0})],Ce.prototype,"spatialReference",null),e([F({readOnly:!0})],Ce.prototype,"extent",null),e([F({readOnly:!0})],Ce.prototype,"heightModelInfo",null),e([F({readOnly:!0})],Ce.prototype,"vcsWkid",null),e([F({readOnly:!0})],Ce.prototype,"latestVcsWkid",null),e([F({readOnly:!0})],Ce.prototype,"viewingMode",null),e([F({readOnly:!0})],Ce.prototype,"tileInfo",null),e([F({readOnly:!0})],Ce.prototype,"mapCollections",null),e([F({readOnly:!0})],Ce.prototype,"_allLayers",null),e([F({readOnly:!0})],Ce.prototype,"_spatialReferenceTask",null),e([F({readOnly:!0})],Ce.prototype,"_tileInfoTask",null),e([F({readOnly:!0})],Ce.prototype,"_heightModelInfoTask",null),e([F({readOnly:!0})],Ce.prototype,"_extentCandidatesTask",null),e([F()],Ce.prototype,"_extentTask",null),e([F()],Ce.prototype,"_projectExtentTask",void 0),Ce=e([U("esri.views.support.DefaultsFromMap")],Ce);let xe=Ee=class extends(h(l.EventedMixin(b(r)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new a({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new A,this.analyses=new me,this.typeSpecificPreconditionsReady=!0,this.layerViews=new o,this.magnifier=new $,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new oe,this.navigation=new ae,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Z(this),this.persistableViewModels=new o,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(E((()=>this.preconditionsReady),(e=>{e?(this._currentSpatialReference=this.spatialReference,Ee.views.add(this)):(this._currentSpatialReference=null,Ee.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),y(this.analysisViewManager)&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),y(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())}),P))}initialize(){this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,I((()=>this.ready)))))),this.basemapView=new z({view:this}),this.layerViewManager=new fe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Me({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([E((()=>this.initialExtentRequired),(e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e}),{sync:!0,initial:!0}),E((()=>this.ready),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)}),{sync:!0}),E((()=>this._userSpatialReference),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)}),{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([E((()=>this.defaultsFromMap?.ready),(t=>{const i=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&i){if(y(e))return;const t=u((()=>e=w(e)));e=s((async t=>{try{await V(this.spatialReferenceWarningDelay,null,t)}catch{return}finally{e=null}d.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.handles.add(t,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=v(this.graphics),this.analyses=v(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),v(this.analysisViewManager),this.toolViewManager=v(this.toolViewManager),this.layerViewManager=v(this.layerViewManager),this.basemapView=v(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e?.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return d.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ce({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||c.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e?.destroyed&&(d.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:e}),e=null),c.isLoadable(e)&&e.load().catch((()=>{})),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.defaultsFromMap?.required?.heightModelInfo&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!H(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return y(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(e){throw new n("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return y(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&d.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(L((()=>!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};xe.views=new o,e([F()],xe.prototype,"_userSpatialReference",void 0),e([F()],xe.prototype,"activeTool",null),e([F({readOnly:!0})],xe.prototype,"allLayerViews",void 0),e([F()],xe.prototype,"groundView",void 0),e([F()],xe.prototype,"animation",null),e([F()],xe.prototype,"basemapView",void 0),e([F({readOnly:!0})],xe.prototype,"_defaultsFromMapSettings",null),e([F()],xe.prototype,"defaultsFromMap",null),e([F()],xe.prototype,"fatalError",void 0),e([F({type:W})],xe.prototype,"extent",null),e([F(q(A,"graphics"))],xe.prototype,"graphics",void 0),e([F(q(me,"analyses"))],xe.prototype,"analyses",void 0),e([F({readOnly:!0,type:G})],xe.prototype,"heightModelInfo",null),e([F({readOnly:!0})],xe.prototype,"interacting",null),e([F({readOnly:!0})],xe.prototype,"navigating",null),e([F({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],xe.prototype,"preconditionsReady",null),e([F({readOnly:!0})],xe.prototype,"typeSpecificPreconditionsReady",void 0),e([F({type:o,readOnly:!0})],xe.prototype,"layerViews",void 0),e([F({type:$})],xe.prototype,"magnifier",void 0),e([F({value:null,type:t})],xe.prototype,"map",null),e([F()],xe.prototype,"padding",void 0),e([F({readOnly:!0})],xe.prototype,"ready",void 0),e([F({type:N})],xe.prototype,"spatialReference",null),e([F()],xe.prototype,"spatialReferenceWarningDelay",void 0),e([F()],xe.prototype,"stationary",null),e([F({readOnly:!0})],xe.prototype,"supportsGround",void 0),e([F({type:i})],xe.prototype,"timeExtent",void 0),e([F()],xe.prototype,"tools",null),e([F()],xe.prototype,"toolViewManager",void 0),e([F({readOnly:!0})],xe.prototype,"type",void 0),e([F({type:Number})],xe.prototype,"scale",void 0),e([F({readOnly:!0})],xe.prototype,"updating",void 0),e([F({readOnly:!0})],xe.prototype,"initialExtentRequired",void 0),e([F({readOnly:!0})],xe.prototype,"initialExtent",null),e([F()],xe.prototype,"cursor",null),e([F({readOnly:!0})],xe.prototype,"input",void 0),e([F({type:ae,nonNullable:!0})],xe.prototype,"navigation",void 0),e([F()],xe.prototype,"layerViewManager",void 0),e([F()],xe.prototype,"analysisViewManager",void 0),e([F()],xe.prototype,"width",void 0),e([F()],xe.prototype,"height",void 0),e([F({readOnly:!0})],xe.prototype,"resizing",void 0),e([F({value:null,readOnly:!0})],xe.prototype,"size",null),e([F({readOnly:!0})],xe.prototype,"suspended",void 0),e([F({readOnly:!0})],xe.prototype,"viewEvents",void 0),e([F({readOnly:!0})],xe.prototype,"persistableViewModels",void 0),e([F()],xe.prototype,"_isValid",void 0),e([F()],xe.prototype,"_readyCycleForced",void 0),e([F()],xe.prototype,"_currentSpatialReference",void 0),xe=Ee=e([U("esri.views.View")],xe);const Ie=xe;export{me as A,_e as T,Ie as default};
