/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{C as n,c as e}from"./generateRendererUtils.js";const t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,a=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),l=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function i(n){return null==n||"string"==typeof n&&!n?"<Null>":n}function o(n){const e=null!=n.normalizationField||null!=n.normalizationType,t=null!=n.minValue||null!=n.maxValue,a=!!n.sqlExpression&&n.supportsSQLExpression;return!e&&!t&&!a}function r(n){const e=n.returnDistinct?[...new Set(n.values)]:n.values,t=e.filter((n=>null!=n)).length,a={count:t};return n.supportsNullCount&&(a.nullcount=e.length-t),n.percentileParams&&(a.median=u(e,n.percentileParams)),a}function s(n){const{values:e,useSampleStdDev:t,supportsNullCount:a}=n;let l=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=null,r=null,s=null,c=null,m=0;const f=null==n.minValue?-1/0:n.minValue,d=null==n.maxValue?1/0:n.maxValue;for(const n of e)Number.isFinite(n)?n>=f&&n<=d&&(o+=n,l=Math.min(l,n),i=Math.max(i,n),m++):"string"==typeof n&&m++;if(m&&null!=o){r=o/m;let n=0;for(const t of e)Number.isFinite(t)&&t>=f&&t<=d&&(n+=(t-r)**2);c=t?m>1?n/(m-1):0:m>0?n/m:0,s=Math.sqrt(c)}else l=null,i=null;const p={avg:r,count:m,max:i,min:l,stddev:s,sum:o,variance:c};return a&&(p.nullcount=e.length-m),n.percentileParams&&(p.median=u(e,n.percentileParams)),p}function u(n,e){const{fieldType:t,value:a,orderBy:l,isDiscrete:i}=e,o=c(t,"desc"===l);if(0===(n=[...n].filter((n=>null!=n)).sort(((n,e)=>o(n,e)))).length)return null;if(a<=0)return n[0];if(a>=1)return n[n.length-1];const r=(n.length-1)*a,s=Math.floor(r),u=s+1,m=r%1,f=n[s],d=n[u];return u>=n.length||i||"string"==typeof f||"string"==typeof d?f:f*(1-m)+d*m}function c(n,e){const t=e?1:-1,l=function(n){return n?(n,e)=>e-n:(n,e)=>n-e}(e),i=m(e);if(!n||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a].includes(n))return(n,e)=>"number"==typeof n&&"number"==typeof e?l(n,e):"string"==typeof n&&"string"==typeof e?i(n,e):t;if("esriFieldTypeDate"===n)return(n,e)=>{const a=new Date(n).getTime(),i=new Date(e).getTime();return isNaN(a)||isNaN(i)?t:l(a,i)};if(a.has(n))return(n,e)=>l(n,e);if("esriFieldTypeString"===n)return(n,e)=>i(n,e);if("esriFieldTypeGUID"===n||"esriFieldTypeGlobalID"===n){const n=m(e);return(e,t)=>n(f(e),f(t))}return e?(n,e)=>1:(n,e)=>-1}function m(n){return n?(n,e)=>(n=n?.toUpperCase(),e=e?.toUpperCase(),n>e?-1:n<e?1:0):(n,e)=>(n=n?.toUpperCase(),e=e?.toUpperCase(),n<e?-1:n>e?1:0)}function f(n){return n.substr(24,12)+n.substr(19,4)+n.substr(16,2)+n.substr(14,2)+n.substr(11,2)+n.substr(9,2)+n.substr(6,2)+n.substr(4,2)+n.substr(2,2)+n.substr(0,2)}function d(n,e){let t;for(t in n)l.includes(t)&&(Number.isFinite(n[t])||(n[t]=null));return e?(["avg","stddev","variance"].forEach((e=>{null!=n[e]&&(n[e]=Math.ceil(n[e]))})),n):n}function p(n){const e={};for(let t of n)(null==t||"string"==typeof t&&""===t.trim())&&(t=null),null==e[t]?e[t]={count:1,data:t}:e[t].count++;return{count:e}}function v(n){return"coded-value"!==n?.type?[]:n.codedValues.map((n=>n.code))}function b(n,e,t,a){const l=n.count,o=[];if(t&&e){const n=[],t=v(e[0]);for(const l of t)if(e[1]){const t=v(e[1]);for(const o of t)if(e[2]){const t=v(e[2]);for(const e of t)n.push(`${i(l)}${a}${i(o)}${a}${i(e)}`)}else n.push(`${i(l)}${a}${i(o)}`)}else n.push(l);for(const e of n)l.hasOwnProperty(e)||(l[e]={data:e,count:0})}for(const n in l){const e=l[n];o.push({value:e.data,count:e.count,label:e.label})}return{uniqueValueInfos:o}}function h(n,e,t,a){let l=null;switch(e){case"log":0!==n&&(l=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(a)&&0!==a&&(l=n/a*100);break;case"field":Number.isFinite(t)&&0!==t&&(l=n/t);break;case"natural-log":n>0&&(l=Math.log(n));break;case"square-root":n>0&&(l=n**.5)}return l}function g(n,t){const a=V({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||5});return n=function(n,e,t){return e=e??-1/0,t=t??1/0,n.filter((n=>Number.isFinite(n)&&n>=e&&n<=t))}(n,t.minValue,t.maxValue),e({definition:a,values:n,normalizationTotal:t.normalizationTotal})}function V(e){const t=e.field,a=e.classificationMethod||"equal-interval",l=e.normalizationType,i=e.normalizationField,o=new n;return o.classificationField=t,o.breakCount=e.breakCount,o.classificationMethod=a,o.standardDeviationInterval="standard-deviation"===a?e.standardDeviationInterval||1:void 0,o.normalizationType=l,o.normalizationField="field"===l?i:void 0,o}function T(n,e){let a=n.classBreaks;const l=a.length,i=a[0].minValue,o=a[l-1].maxValue,r="standard-deviation"===e,s=t;return a=a.map((n=>{const e=n.label,t={minValue:n.minValue,maxValue:n.maxValue,label:e};if(r&&e){const n=e.match(s).map((n=>+n.trim()));2===n.length?(t.minStdDev=n[0],t.maxStdDev=n[1],n[0]<0&&n[1]>0&&(t.hasAvg=!0)):1===n.length&&(e.includes("<")?(t.minStdDev=null,t.maxStdDev=n[0]):e.includes(">")&&(t.minStdDev=n[0],t.maxStdDev=null))}return t})),{minValue:i,maxValue:o,classBreakInfos:a,normalizationTotal:n.normalizationTotal}}function y(n,e){const{min:t,max:a,intervals:l}=function(n,e){const{field:t,classificationMethod:a,standardDeviationInterval:l,normalizationType:i,normalizationField:r,normalizationTotal:u,minValue:c,maxValue:m}=e,f=e.numBins||10;let d=null,p=null,v=null;if(a&&"equal-interval"!==a||i){const{classBreaks:e}=g(n,{field:t,normalizationType:i,normalizationField:r,normalizationTotal:u,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:m,numClasses:f});d=e[0].minValue,p=e[e.length-1].maxValue,v=e.map((n=>[n.minValue,n.maxValue]))}else{if(null!=c&&null!=m)d=c,p=m;else{const e=s({values:n,minValue:c,maxValue:m,useSampleStdDev:!i,supportsNullCount:o({normalizationType:i,normalizationField:r,minValue:c,maxValue:m})});d=e.min,p=e.max}v=x(d,p,f)}return{min:d,max:p,intervals:v}}(n,e),i=l.map(((n,e)=>({minValue:l[e][0],maxValue:l[e][1],count:0})));for(const e of n)if(null!=e&&e>=t&&e<=a){const n=F(l,e);n>-1&&i[n].count++}return{bins:i,minValue:t,maxValue:a,normalizationTotal:e.normalizationTotal}}function F(n,e){let t=-1;for(let a=n.length-1;a>=0;a--)if(e>=n[a][0]){t=a;break}return t}function x(n,e,t){const a=(e-n)/t,l=[];let i,o=n;for(let n=1;n<=t;n++)i=o+a,i=Number(i.toFixed(16)),l.push([o,n===t?e:i]),o=i;return l}export{V as a,i as b,b as c,h as d,r as e,s as f,x as g,p as h,o as i,g as j,y as k,c as l,u as m,d as p,T as r,l as s};
