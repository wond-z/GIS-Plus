/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{e as n}from"./earcut.js";import{i as t}from"../geometry/Polygon.js";import{d as e}from"./deduplicate.js";function o(t){const o=r(t.rings,t.hasZ,l.CCW_IS_HOLE),s=new Array;let i=0,a=0;for(const t of o.polygons){const e=t.count,r=t.index,l=new Float64Array(o.position.buffer,3*r*o.position.BYTES_PER_ELEMENT,3*e),c=t.holeIndices.map((n=>n-r)),h=new Uint32Array(n(l,c,3));s.push({position:l,faces:h}),i+=l.length,a+=h.length}const c=function(n,t,e){if(1===n.length)return n[0];const o=new Float64Array(t),r=new Uint32Array(e);let s=0,l=0,i=0;for(const t of n){for(let n=0;n<t.position.length;n++)o[s++]=t.position[n];for(let n=0;n<t.faces.length;n++)r[l++]=t.faces[n]+i;i=s/3}return{position:o,faces:r}}(s,i,a),h=e(c.position.buffer,6,{originalIndices:c.faces});return c.position=new Float64Array(h.buffer),c.faces=h.indices,c}function r(n,e,o){const r=n.length,i=new Array(r),a=new Array(r),c=new Array(r);let h=0,f=0,g=0,u=0;for(let t=0;t<r;++t)u+=n[t].length;const p=new Float64Array(3*u);let y=0;for(let u=r-1;u>=0;u--){const d=n[u],w=o===l.CCW_IS_HOLE&&!t(d,!1,!1);if(w&&1!==r)i[h++]=d;else{let n=d.length;for(let t=0;t<h;++t)n+=i[t].length;const t={index:y,pathLengths:new Array(h+1),count:n,holeIndices:new Array(h)};t.pathLengths[0]=d.length,d.length>0&&(c[g++]={index:y,count:d.length}),y=w?s(d,d.length-1,-1,p,y,d.length,e):s(d,0,1,p,y,d.length,e);for(let n=0;n<h;++n){const o=i[n];t.holeIndices[n]=y,t.pathLengths[n+1]=o.length,o.length>0&&(c[g++]={index:y,count:o.length}),y=s(o,0,1,p,y,o.length,e)}h=0,t.count>0&&(a[f++]=t)}}for(let n=0;n<h;++n){const t=i[n];t.length>0&&(c[g++]={index:y,count:t.length}),y=s(t,0,1,p,y,t.length,e)}return a.length=f,c.length=g,{position:p,polygons:a,outlines:c}}function s(n,t,e,o,r,s,l){r*=3;for(let i=0;i<s;++i){const s=n[t];o[r++]=s[0],o[r++]=s[1],o[r++]=l?s[2]:0,t+=e}return r/3}var l;!function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(l||(l={}));export{l as C,r as p,o as t};
