/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import t from"../core/Evented.js";import{clone as s}from"../core/lang.js";import"./Logger.js";import"./ensureType.js";import"../core/Error.js";import"./object.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";const d=new t.EventEmitter,r=Symbol("esri.layers.mixins.EditBusLayer");function l(e){return null!=e&&"object"==typeof e&&r in e}const a=t=>{var l;let a=class extends t{constructor(...e){super(...e),this[l]=!0,this.when().then((()=>{this.own([d.on("edits",(e=>{const t="layer"in e?e.layer:null,i="layer"in e?e.layer?.url:e.serviceUrl,d="layer"in e?e.layer?.layerId:e.layerId,r=e.event;if(t===this||i!==this.url)return;if(null!=d&&null!=this.layerId&&d===this.layerId)return void this.emit("edits",s(r));const l=r.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(l){const{adds:e,updates:t,deletes:i}=l.editedFeatures,d={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:i?i.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:t?t.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:s(r.editedFeatures)};this.emit("edits",d)}}))])}),(()=>{}))}};return l=r,a=e([i("esri.layers.mixins.EditBusLayer")],a),a};export{a as E,d as e,l as i};
