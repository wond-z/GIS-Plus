/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import e from"../core/Accessor.js";import t from"../core/Collection.js";import{a as n,i as o}from"./maybe.js";import{g as r}from"./utils.js";const i=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function f(t){return t instanceof e}function c(e){return e instanceof t?Object.keys(e.items):f(e)?r(e).keys():e?Object.keys(e):[]}function s(e,n){return e instanceof t?e.items[n]:e[n]}function l(e){return e?e.declaredClass:null}function u(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const r=c(e),a=c(t);if(0===r.length&&0===a.length)return;if(!r.length||!a.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const p=a.filter((e=>!r.includes(e))),y=r.filter((e=>!a.includes(e))),m=r.filter((n=>a.includes(n)&&s(e,n)!==s(t,n))).concat(p,y).sort(),d=l(e);if(d&&i.includes(d)&&m.length)return{type:"complete",oldValue:e,newValue:t};let h;const b=f(e)&&f(t);for(const r of m){const i=s(e,r),f=s(t,r);let c;if((b||"function"!=typeof i&&"function"!=typeof f)&&i!==f&&(null!=i||null!=f)){if(n&&n[r]&&"function"==typeof n[r])c=n[r](i,f);else if(i instanceof Date&&f instanceof Date){if(i.getTime()===f.getTime())continue;c={type:"complete",oldValue:i,newValue:f}}else c="object"==typeof i&&"object"==typeof f&&l(i)===l(f)?u(i,f):{type:"complete",oldValue:i,newValue:f};o(c)&&(o(h)?h.diff[r]=c:h={type:"partial",diff:{[r]:c}})}}return h}function a(e,t){if(n(e))return!1;const o=t.split(".");let r=e;for(const e of o){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}function p(e,t){for(const n of t)if(a(e,n))return!0;return!1}function y(e,t){if(!("function"==typeof e||"function"==typeof t||n(e)&&n(t)))return n(e)||n(t)||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:u(e,t)}function m(e){if(n(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!m(e))return!1;for(const e of t.removed)if(!m(e))return!1;for(const e of t.changed)if(!m(e))return!1;return!0}case"partial":for(const t in e.diff)if(!m(e.diff[t]))return!1;return!0}}export{p as a,y as d,a as h,m as i};
