/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import{m as e,h as i,d as a,r as o}from"./handleUtils.js";import{i as s,a as n,g as r,d as l,u as p,r as h,e as c,q as u}from"./maybe.js";import{watch as d,on as m,initial as g,when as _,syncAndInitial as y,sync as v}from"../core/reactiveUtils.js";import{property as f}from"../core/accessorSupport/decorators/property.js";import{b as M}from"../core/lang.js";import"./ensureType.js";import{subclass as b}from"../core/accessorSupport/decorators/subclass.js";import{E as S,d as x,s as E,a as w,g as O,f as j,I as T,b as A,n as D,m as G,h as I,F as R,H as L,l as P,z as V,k as C,G as z,P as U,w as k,Z as H,c as N}from"./vec3.js";import{g as F,e as X,l as Z,b as Y,d as B,c as q}from"./elevationInfoUtils.js";import{E as W}from"./ElevationInfo.js";import{e as Q,b as J,s as K}from"./screenUtils.js";import"./Logger.js";import"../core/Error.js";import{h as $}from"./object.js";import tt from"../core/Accessor.js";import{c as et}from"./asyncUtils.js";import{throwIfAborted as it}from"../core/promiseUtils.js";import{e as at}from"./quantityFormatUtils.js";import{n as ot,e as st,z as nt}from"./unitUtils.js";import{a as rt,s as lt,n as pt,h as ht,l as ct,j as ut,p as dt,e as mt,x as gt,y as _t,b as yt}from"./vec2.js";import{a as vt}from"./vec2f64.js";import{i as ft}from"../geometry/Polygon.js";import{f as Mt}from"./messages.js";import{T as bt}from"./TextOverlayItem.js";import{c as St,b as xt,T as Et,S as wt,a as Ot,d as jt,e as Tt}from"./automaticLengthMeasurementUtils.js";import{d as At}from"./viewUtils.js";import{S as Dt,V as Gt}from"./VerticesVisualElement.js";import{s as It,E as Rt,c as Lt}from"./settings3.js";import{O as Pt}from"./OutlineVisualElement.js";import{e as Vt,E as Ct}from"./MultipassGeometryTest.glsl.js";import{G as zt}from"./GraphicState.js";import{R as Ut}from"./Material.js";import{D as kt,g as Ht}from"./DrawGraphicTool.js";import{D as Nt,S as Ft,E as Xt}from"./drawSurfaces.js";import Zt from"../core/Collection.js";import Yt from"../core/Evented.js";import{HandleOwnerMixin as Bt,HandleOwner as qt}from"../core/HandleOwner.js";import{s as Wt,z as Qt,c as Jt,e as Kt,m as $t}from"./quantityUtils.js";import{m as te}from"./dehydratedFeatures.js";import{M as ee,c as ie,g as ae,f as oe,p as se,a as ne,d as re}from"./manipulatorUtils.js";import{i as le,S as pe,g as he,a as ce}from"../widgets/Sketch/SketchViewModel.js";import{c as ue}from"./manipulatorUtils2.js";import{d as de,c as me,r as ge}from"./mathUtils.js";import{L as _e}from"./LaserlineVisualElement.js";import{projectVectorToVector as ye,projectPointToVector as ve}from"../geometry/projection.js";import{c as fe,i as Me,E as be}from"./aaBoundingBox.js";import{h as Se}from"./aaBoundingRect.js";import{P as xe}from"./PointVisualElement.js";import Ee from"../core/Handles.js";import we from"../Color.js";import{f as Oe,w as je,m as Te,a as Ae,v as De,k as Ge,q as Ie,g as Re,z as Le,r as Pe}from"./mat4.js";import{c as Ve,f as Ce,I as ze}from"./mat4f64.js";import{s as Ue,d as ke,w as He,j as Ne,h as Fe,c as Xe}from"./ray.js";import{b as Ze,c as Ye,d as Be,e as qe,f as We,g as Qe,s as Je}from"./dragEventPipeline3D.js";import{d as Ke,b as $e,c as ti,e as ei,f as ii,g as ai,E as oi,h as si,I as ni,i as ri,j as li,s as pi}from"./dragEventPipeline.js";import{C as hi}from"./basicInterfaces.js";import{e as ci,t as ui,l as di,o as mi,f as gi,a as _i,g as yi}from"./GeometryUtil.js";import{C as vi}from"./ColorMaterial.js";import{a as fi,M as Mi}from"./interfaces3.js";import{d as bi}from"./colorUtils2.js";import{G as Si}from"./GraphicManipulator.js";import{E as xi,P as Ei,O as wi,A as Oi,U as ji,M as Ti,R as Ai,S as Di,b as Gi}from"./EditGeometryOperations.js";import Ii from"../views/interactive/sketch/SketchTooltipOptions.js";import{S as Ri}from"./SnappingContext.js";import{S as Li}from"./SnappingDragPipelineStep.js";import{T as Pi,a as Vi,b as Ci,c as zi,d as Ui,e as ki}from"./TranslateTooltipInfos.js";import{v as Hi,g as Ni,h as Fi}from"./euclideanLengthMeasurementUtils.js";import Xi from"../geometry/Polyline.js";import{n as Zi,f as Yi,c as Bi,q as qi,h as Wi}from"./plane.js";import{j as Qi}from"./utils6.js";import{M as Ji}from"./IViewEvents.js";import{a as Ki}from"./automaticAreaMeasurementUtils.js";import $i from"../views/interactive/sketch/SketchLabelOptions.js";import ta from"../geometry/Point.js";import{V as ea}from"./ViewingMode.js";import{a as ia}from"./Cyclical.js";import{addFrameTask as aa}from"../core/scheduling.js";import{a as oa}from"./vec4f64.js";import{d as sa,g as na}from"./axisAngleDegrees.js";import{c as ra,u as la,a as pa}from"./boundedPlane.js";import{B as ha,c as ca,O as ua,C as da,e as ma,E as ga,F as _a,H as ya,l as va,R as fa,o as Ma,q as ba,t as Sa}from"./sliceToolUtils.js";import{g as xa}from"./Factory.js";import{f as Ea}from"./ray2.js";import{E as wa,a as Oa}from"./ExtentTooltipInfos.js";import"./watch.js";import"./ArrayPool.js";import"./get.js";import"./utils.js";import"./tracking.js";import"../config.js";import"./string.js";import"./nextTick.js";import"./metadata.js";import"./common.js";import"./unitConversionUtils.js";import"./lengthUtils.js";import"./Ellipsoid.js";import"./jsonMap.js";import"../core/JSONSupport.js";import"./reader.js";import"./writer.js";import"../layers/support/fieldUtils.js";import"./arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../geometry/support/webMercatorUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"./typeUtils.js";import"../geometry/support/jsonUtils.js";import"./extentUtils.js";import"./unitFormatUtils.js";import"./byteSizeEstimations.js";import"./number.js";import"./locale.js";import"./projectionEllipsoid.js";import"./projector.js";import"./widgetUtils.js";import"../intl.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./assets.js";import"../widgets/Widget.js";import"./domUtils.js";import"../core/Promise.js";import"./uuid.js";import"./jsxWidgetSupport.js";import"./messageBundle.js";import"./jsxFactory.js";import"../geometry/geometryEngine.js";import"./geometryEngineBase.js";import"./hydrated.js";import"../geometry/support/geodesicUtils.js";import"./geodesicConstants.js";import"./vec4f32.js";import"./Object3DVisualElement.js";import"./VisualElement.js";import"./DefaultBufferWriter.js";import"./sphere.js";import"./vector.js";import"./mathUtils2.js";import"./Util2.js";import"./utils20.js";import"./doublePrecisionUtils.js";import"./Octree.js";import"./frustum.js";import"./lineSegment.js";import"./InterleavedLayout.js";import"./BufferView.js";import"./types.js";import"./RenderSlot.js";import"./bufferWriterUtils.js";import"./triangle.js";import"./Indices.js";import"./VertexAttribute.js";import"./mat3f64.js";import"./ShaderTechniqueConfiguration.js";import"./vec3f32.js";import"./mat4f32.js";import"./compilerUtils.js";import"./requestImageUtils.js";import"./enums3.js";import"./Texture.js";import"./context-util.js";import"./FramebufferObject.js";import"./VertexElementDescriptor.js";import"./OrderIndependentTransparency.js";import"./floatRGBA.js";import"./RightAngleQuadVisualElement.js";import"./Settings2.js";import"./RightAngleSnappingHint.js";import"./lineStippleUtils.js";import"../core/Identifiable.js";import"./line2.js";import"./triangulationUtils.js";import"./earcut.js";import"./deduplicate.js";import"./debugFlags.js";import"./interfaces4.js";import"./vec2f32.js";import"./NestedMap.js";import"./Camera.js";import"./SSAOHelper.js";import"./CameraSpace.glsl.js";import"./Intersector.js";import"./verticalOffsetUtils.js";import"./mat3.js";import"./quat.js";import"./quatf64.js";import"./glUtil.js";import"./OutputHighlight.glsl.js";import"./MemCache.js";import"./Scheduler.js";import"./ObservableValue.js";import"./SimpleObservable.js";import"./debugFlags2.js";import"./VisualElementResources.js";import"./line.js";import"./ElevationProvider.js";import"./graphicUtils.js";import"./hydratedFeatures.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"./enumeration.js";import"../popup/support/FieldInfoFormat.js";import"./date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"./chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"./shared.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"./colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils2.js";import"../symbols/edges/Edges3D.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"./lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"./utils3.js";import"./colors.js";import"./symbolLayerUtils3D.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"./persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"./Thumbnail.js";import"./calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../layers/GraphicsLayer.js";import"./GraphicsCollection.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"./jsonUtils.js";import"./parser.js";import"./_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"./WatchUpdatingTracking.js";import"../geometry/Circle.js";import"./surfaceCoordinateSystems.js";import"./mat2d.js";import"./mat2df64.js";import"./dehydratedFeatureComparison.js";import"./SnappingOperation.js";import"./quantizationUtils.js";import"../layers/support/Field.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"./ImageMaterial.js";import"./GLTextureMaterial.js";import"./NativeLineMaterial.js";import"./VertexColor.glsl.js";import"./InputManager.js";import"./Queue.js";import"./keybindings.js";import"./SnappingManager.js";import"./QueryEngineResult.js";import"./ItemCache.js";import"../core/sql/WhereClause.js";import"./utils13.js";import"./generateRendererUtils.js";import"./colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"./projectionSupport.js";import"./json.js";import"./SnappingCandidate.js";import"./utils21.js";import"../geometry/support/normalizeUtils.js";import"./normalizeUtilsCommon.js";import"./simplify.js";import"./utils4.js";import"./utils5.js";import"./featureConversionUtils.js";import"./OptimizedFeature.js";import"./OptimizedFeatureSet.js";import"./geometry2dUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"./hitTestSelectUtils.js";import"./screenUtils2.js";import"./pe.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"./zscale.js";import"./HUDMaterial.js";import"./VisualVariables.glsl.js";import"./drawUtils.js";import"./defaults.js";import"./defaultsJSON.js";import"./drapedUtils.js";import"./PointSnappingHint.js";import"./measurementUtils2.js";import"../symbols/support/cimSymbolUtils.js";import"./utils7.js";import"./euclideanAreaMeasurementUtils.js";import"../analysis/SlicePlane.js";import"./persistable.js";import"./multiOriginJSONSupportUtils.js";import"./LineVisualElement.js";import"./RenderCoordsHelper.js";import"./spatialReferenceSupport.js";const ja={default:15,far:25};let Ta=class extends tt{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=et((async t=>{const e=await Mt("esri/core/t9n/Units");it(t),this._messagesUnits=e})),i=()=>r(this.context,(t=>t.editGeometryOperations));this.addHandles([d((()=>[s(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((t=>m(i,t,(()=>this._update())))),e((()=>t.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return n(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((t=>t.label.text))}}get _edgeDistancePixels(){return ja[this.edgeDistance]}_update(){this._nextLabelIndex=0;const t=this.context;if(n(t))return void this._destroyUnusedLabels();const{components:e,geometry:i,coordinateHelper:a}=t.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const o=e.length;for(let n=0;n<o;++n){const r=[];if(e[n].iterateVertices((t=>{r.push(a.toXYZ(t.pos))})),0===n&&s(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],p=r[r.length-1];"polygon"===i.type&&r.length>2&&!S(l,p)&&r.push(l);const h=1===o&&!ft(r,!1,!1);let c=Ga,u=Ia;this.toScreenPointArray(t,l,c);for(let e=1;e<r.length;++e){const i=r[e-1],a=r[e];this.toScreenPointArray(t,a,u),this._addLabel(t,i,c,a,u,h),[c,u]=[u,c]}}this._destroyUnusedLabels()}_addLabel(t,e,i,a,o,n){const{label:r}=this._getOrCreateLabel(t);if(!this.visible||rt(i,o)<3025)return void(r.visible=!1);const l=s(t.graphicState)?t.graphicState.isDraped?"on-the-ground":"absolute-height":F(t.editGeometryOperations.data.geometry,t.elevationInfo),{spatialReference:p}=t.editGeometryOperations.data,h=St(e,a,p,l),c=this._messagesUnits,u=ot(t.view);r.text=s(c)&&s(h)?at(c,h,u):"",r.visible=!0;const d=o[0]-i[0],m=o[1]-i[1];n?lt(Aa,-m,d):lt(Aa,m,-d),pt(Aa,Aa),ht(Aa,Aa,this._edgeDistancePixels),ct(Da,i,o,.5),ut(Da,Da,Aa),r.position=[Da[0],Da[1]],Math.abs(Aa[0])>Math.abs(Aa[1])?r.anchor=Aa[0]>0?"left":"right":r.anchor=-Aa[1]<0?"top":"bottom"}_getOrCreateLabel(t){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const e=new bt({fontSize:10,anchor:"center"});t.view.overlay.items.add(e);const i={label:e};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){r(this.context,(e=>e.view.overlay.items.remove(t))),t.destroy()}};t([f()],Ta.prototype,"context",void 0),t([f()],Ta.prototype,"stagedVertex",void 0),t([f()],Ta.prototype,"visible",void 0),t([f()],Ta.prototype,"edgeDistance",void 0),t([f()],Ta.prototype,"updating",null),t([f()],Ta.prototype,"_messagesUnits",void 0),t([f()],Ta.prototype,"_edgeDistancePixels",null),Ta=t([b("esri.views.interactive")],Ta);const Aa=vt(),Da=vt(),Ga=Q(),Ia=Q();let Ra=class extends Ta{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:e,editGeometryOperations:i},a,o=Q()){const{spatialReference:s}=i.data.coordinateHelper;return At(a,s,e,t,La),t.state.camera.projectToScreen(La,o),o}};Ra=t([b("esri.views.3d.interactive.SegmentLabels3D")],Ra);const La=x();let Pa=class extends kt{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new W({mode:t,offset:e})}normalizeCtorArgs(t){if(!t.elevationInfo){const e=t.hasZ??!0;return{...t,elevationInfo:X(e)}}return t}initializeGraphic(t){const e=this._createGraphicState=new zt({graphic:t});return i([this.view.maskOccludee(t),this.view.trackGraphicState(e),d((()=>({element:this._outlineVisualElement,isDraped:e.isDraped})),(({element:t,isDraped:e})=>{r(t,(t=>t.isDraped=e))}),g)])}makeDrawOperation(){const{geometryType:t}=this,e="circle"!==t&&"rectangle"!==t;return new Nt({view:this.view,manipulators:this.manipulators,geometryType:Ht(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Ft(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Xt(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Dt,segmentLabels:e?new Ra:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:s(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Z(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(t){const{view:i}=this;return s(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],this._updateVerticalLineVisualElement(t),null):(this._activeVertexVisualElement=new Gt({view:i,spatialReference:i.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:It.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=It.colorToVec4(It.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new Rt({view:i,extensionType:It.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ut.OccludeAndTransparent}),It.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),e((()=>{this._activeVertexVisualElement=l(this._activeVertexVisualElement),this._verticalLineVisualElement=l(this._verticalLineVisualElement)})))}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if(n(e))return;const{renderCoordsHelper:i,spatialReference:a,elevationProvider:o}=this.view;E(Ca,t[0],t[1],t[2]),Va.setFromElevationInfo(this.elevationInfo),Ca[2]=Vt(Ca,o,Va,i),i.toRenderCoords(Ca,a,Ca)?(e.setStartEndFromWorldDownAtLocation(Ca),e.attached=!0):e.attached=!1}onOutlineChanged(t){if(s(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const i=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Pt({view:this.view,geometry:t,elevationInfo:i,isDraped:s(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Z(this.hasZ,i),attached:!1}),It.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),It.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,e((()=>{this._outlineVisualElement=l(this._outlineVisualElement)}))}onRegularVerticesChanged(t){return s(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new Gt({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:It.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,e((()=>{this._verticesVisualElement=l(this._verticesVisualElement)})))}};t([f({constructOnly:!0})],Pa.prototype,"elevationInfo",void 0),t([f({constructOnly:!0})],Pa.prototype,"geometryType",void 0),t([f()],Pa.prototype,"type",void 0),t([f({constructOnly:!0})],Pa.prototype,"view",void 0),Pa=t([b("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Pa);const Va=new Ct,Ca=x();var za,Ua;!function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"}(za||(za={})),function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"}(Ua||(Ua={}));class ka{constructor(){this.grabbingState=za.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=za.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator(((t,e)=>{if(e===Ua.TRANSLATE_Z&&(this.zManipulator=t),t instanceof ee&&(t.selected&&(0===this.numSelected&&(this.firstSelected=t),this.numSelected++),n(this.firstGrabbedXY)&&t.grabbing&&e===Ua.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=za.ANY,e){case Ua.TRANSLATE_Z:this.grabbingState|=za.Z;break;case Ua.TRANSLATE_XY:this.grabbingState|=za.XY}}))}}function Ha(t){return s(t.geometry)&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)}const Na=x();function Fa(t){const{view:e,graphic:r}=t,l=new zt({graphic:r}),p=[],h=function(t,e,i){const{view:n,graphic:r}=t,l=new xe({view:n,geometry:Xa(r),elevationInfo:Y(r),attached:!1});return function(t,e,i,a){(function(t,e,i,a){const{view:n,graphic:r}=t;let l=null;const p=()=>{const t=Xa(r);(t=>{s(l)&&(l.remove(),l=null),i.isDraped&&s(t)&&(l=function(i,a,o){const s=i.elevationProvider.spatialReference;ve(a,Za,s);const n=Za[0],r=Za[1];return i.elevationProvider.on("elevation-change",(i=>{Se(i.extent,n,r)&&(e.geometry=t)}))}(n,t))})(t),e.geometry=t};a.push(i.on("changed",p),o((()=>l))),p()})(t,e,i,a),It.visualElements.pointGraphics.outline.apply(e),a.push(d((()=>i.displaying),(()=>e.attached=i.displaying),g))}(t,l,e,i),i.push(a(l)),l}(t,l,p);return function(t,e,i,o){const{view:r,graphic:l}=t,p=new Rt({view:r,extensionType:It.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ut.OccludeAndTransparent});It.visualElements.zVerticalLine.apply(p);const h=new _e({view:r,intersectsLineInfinite:!0,attached:!1});It.visualElements.pointGraphics.shadowStyle.apply(h);const c=de(It.visualElements.heightPlaneAngleCutoff),u=new _e({view:r,attached:!1,angleCutoff:c});It.visualElements.heightPlane.apply(u);const m=Y(t.graphic),g=Ct.fromElevationInfo(m),_="on-the-ground"===m.mode||!m.offset&&"absolute-height"!==m.mode,y=new ka;let v=1,f=1;const M=()=>{y.update(t);const i=Xa(l),a=_&&(e.isDraped||n(i)||!i.hasZ);let c=!0;if(!a&&s(i)){const t=Vt(i,r.elevationProvider,g,r.renderCoordsHelper);E(Za,i.x,i.y,t),ye(Za,i.spatialReference,Za,r.renderCoordsHelper.spatialReference),p.setStartEndFromWorldDownAtLocation(Za),h.intersectsWorldUpAtLocation=Za}else c=!1;const d=y.grabbingState&za.Z?It.visualElements.laserlineAlphaMultiplier:1;d!==v&&(v=d,It.visualElements.heightPlane.apply(u,d));const m=Me(Ya);!a&&e.displaying&&o.calculateMapBounds(m)&&ye(be(m,Za),r.spatialReference,Za,r.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=Za,u.attached=!0):u.attached=!1;const M=y.grabbingState&za.XY?It.visualElements.laserlineAlphaMultiplier:1;M!==f&&(f=M,It.visualElements.pointGraphics.shadowStyle.apply(h,M));const b=c&&e.displaying&&!a;h.attached=b,p.attached=b};i.push(d((()=>[e.displaying,e.isDraped]),M),e.on("changed",M)),t.forEachManipulator((t=>{i.push(t.events.on("grab-changed",M))})),i.push(a(h)),i.push(a(p)),i.push(a(u)),M()}(t,l,p,h),p.push(e.trackGraphicState(l)),{visualElement:h,remove(){i(p).remove()}}}function Xa(t){const e=t.geometry;return n(e)?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const Za=x(),Ya=fe();function Ba(t){switch(p(t.graphic.geometry).type){case"point":case"mesh":return Fa(t);case"polygon":case"polyline":return function(t){const{view:e,graphic:n}=t,r=new zt({graphic:n}),l=function(t,e){const{view:o,graphic:s}=t,n=new Pt({view:o,geometry:Ha(s)?s.geometry:null,elevationInfo:Y(s),attached:!1});It.visualElements.lineGraphics.shadowStyle.apply(n);const r=()=>{n.attached=e.displaying};It.visualElements.lineGraphics.outline.apply(n);const l=[d((()=>e.displaying),r),d((()=>e.isDraped),(t=>{n.isDraped=t})),e.on("changed",(()=>n.geometry=Ha(s)?s.geometry:null)),a(n)];return r(),{visualElement:n,remove:()=>i(l).remove()}}(t,r),p=function(t,e,n){const{graphic:r,view:l}=t,p=[],h=Y(r),c="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,u=new ka,m=new Rt({view:l,extensionType:It.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ut.OccludeAndTransparent});It.visualElements.pointGraphics.shadowStyle.apply(m);const g=de(It.visualElements.heightPlaneAngleCutoff),_=new _e({view:l,attached:!1,angleCutoff:g});It.visualElements.heightPlane.apply(_);let y=1,v=1;const f=()=>{if(u.update(t),!n.displaying||c&&(n.isDraped||!Ha(r)||!r.geometry.hasZ))return e.laserlineEnabled=!1,m.attached=!1,void(_.attached=!1);e.laserlineEnabled=!0;{const t=u.grabbingState&za.XY?It.visualElements.laserlineAlphaMultiplier:1;t!==y&&(y=t,It.visualElements.lineGraphics.shadowStyle.apply(e,t),It.visualElements.pointGraphics.shadowStyle.apply(m,t))}{const t=u.grabbingState&za.Z?It.visualElements.laserlineAlphaMultiplier:1;t!==v&&(v=t,It.visualElements.heightPlane.apply(_,t))}!function(t,e){const i=1===e.numSelected?e.firstSelected:e.numSelected>1&&s(e.firstGrabbedXY)?e.firstGrabbedXY:null;s(i)?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}(m,u),function(t,e,i,a){if(a.numSelected>0){E(Na,0,0,0);let e=0;t.forEachManipulator(((t,i)=>{i===Ua.TRANSLATE_XY&&t.selected&&t instanceof ee&&(w(Na,Na,t.renderLocation),e++)})),e>0?(i.heightManifoldTarget=O(Na,Na,1/e),i.attached=!0):i.attached=!1}else{const a=e.attachmentOrigin;s(a)&&t.view.renderCoordsHelper.toRenderCoords(a,Na)?(i.heightManifoldTarget=Na,i.attached=!0):i.attached=!1}}(t,e,_,u)};It.visualElements.zVerticalLine.apply(m),p.push(n.on("changed",f),d((()=>n.displaying),f),e.events.on("attachment-origin-changed",f),a(m),a(_));const M=[],b=()=>{i(M).remove(),M.length=0,t.forEachManipulator((t=>M.push(t.events.on("grab-changed",f)))),t.forEachManipulator((t=>M.push(t.events.on("select-changed",f)))),f()};return b(),p.push(t.onManipulatorsChanged(b),o((()=>i(M)))),i(p)}(t,l.visualElement,r),h=[l,p,e.maskOccludee(n),e.trackGraphicState(r)];return{visualElement:l.visualElement,remove:()=>i(h).remove()}}(t);default:return null}}const qa=[1,.5,0],Wa=Math.ceil(70/3*2),Qa=5*Math.PI/12,Ja=1*Math.PI/3;class Ka{constructor(){this._available=!0}set location(t){this._forEachManipulator3D((e=>e.location=t))}set elevationAlignedLocation(t){this._forEachManipulator3D((e=>e.elevationAlignedLocation=t))}set elevationInfo(t){this._forEachManipulator3D((e=>e.elevationInfo=t))}get renderLocation(){let t;return this._forEachManipulator3D((e=>{t||(t=e.renderLocation)})),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D((e=>e.available=t))}get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}_forEachManipulator3D(t){this.forEachManipulator(((e,i)=>{e instanceof ee&&t(e,i)}))}}function $a(t,e,i,a){const o=t.graphic,s=(t,i)=>e({action:t,graphic:o,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((t,e,i)=>{const n=e.next((t=>("start"===t.action&&s("start",t),t))).next(Ke(o,a)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&s("update",t);break;case"end":s("end",t)}return t}));return i.next($e(o)).next((()=>{s("end",{screenDeltaX:0,screenDeltaY:0})})),n}))}function to(t){if(n(t)||"polyline"!==t.type&&"polygon"!==t.type)return 0;const e=("polyline"===t.type?t.paths:t.rings)[0];if(!e||e.length<2)return 0;const i=e[0],a=e[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function eo(t){if(n(t)||n(t.axis))return 1;const{mapStart:e,mapEnd:i,axis:a}=t,o=[i.x-e.x,i.y-e.y];return o[0]*a[0]+o[1]*a[1]>0?1:-1}class io extends Ka{constructor(t){super(),this._handles=new Ee,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new Yt,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._handles=l(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:e}of this._arrowManipulatorInfos)t(e,Ua.TRANSLATE_XY)}createGraphicDragPipeline(t,e,i){const a=e.graphic,o=Y(a),s=p(a.geometry).spatialReference;return $a(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>e(i,t(i,a,o,s,n),o)),o,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,a,o){return i(this._arrowManipulatorInfos.map((({manipulator:i},s)=>ti(i,((i,n,r,l,p)=>{const h=n.next((t=>({...t,manipulatorType:Ua.TRANSLATE_XY}))).next(ei(this._view,i.elevationAlignedLocation)).next(Ze(this._view,i.elevationAlignedLocation,e,a,o)).next(ii(i.location,this.angle+(s+1)*Math.PI*.5)).next(ai());t(i,h,r,l,p)})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:e},i){const a=this._radius/70,o=54*a,s=o*Math.sqrt(3)/2,n=ci(s,o/2,o/2,.02);ui(n,Oe(ke.get(),E(Ue.get(),0,-s/3,0))),t.renderObjects=[{geometry:n,material:this._opaqueMaterial,stateMask:fi.Focused},{geometry:n,material:this._transparentMaterial,stateMask:fi.Unfocused}],t.radius=s/3*2*1.2;const r=je(ke.get(),i*Math.PI/2),l=Oe(ke.get(),E(Ue.get(),0,100*a,0));Te(e,r,l)}_createManipulators(){for(let t=0;t<4;t++){const e=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(e)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,e=Ae(ke.get(),t,j(0,0,1));if(n(e))return;const i=De(ke.get(),E(Ue.get(),this.displayScale,this.displayScale,this.displayScale)),a=Te(ke.get(),i,e);for(const t of this._arrowManipulatorInfos){const e=Te(ke.get(),a,t.transform);t.manipulator.modelTransform=e}}_createArrowManipulator(t){const e=new ee({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:j(0,0,1)}}),i={manipulator:e,transform:Ve()};return this._updateArrowManipulator(i,t),this._handles.add(e.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(t=1){const e=we.toUnitRGBA(Lt.main);return e[3]*=t,new vi({color:e,transparent:1!==t,cullFace:hi.Back,renderOccluded:Ut.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}class ao{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new oi,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&s(this._lastDragEvent)){const e=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(s(i)){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?i:e,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=t}_snap(t){const e=s(this._view)?this._view.toMap(t,{exclude:[]}):null;return s(e)&&s(this._view)&&(e.z=B(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){return this._view=t,this._elevationInfo=e,this._lastDragEvent=null,t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const e=this._snap(t.screenEnd);return s(e)?{action:t.action,mapStart:t.mapStart,mapEnd:e,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}}}}class oo extends Ka{constructor(t){super(),this._snapToScene=new ao,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,Ua.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,o=Y(a),s=p(a.geometry).spatialReference;return $a(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>e(i,t(i,a,o,s,n),o)),o,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const o=this._view;return ti(this._manipulator,((s,n,r,l,p)=>{const h=n.next(ei(o,s.elevationAlignedLocation)).next(Ze(o,s.elevationAlignedLocation,e,i,a)).next(this._snapToScene.createDragEventPipelineStep(o,e),this._snapToScene.next).next((t=>({...t,manipulatorType:Ua.TRANSLATE_XY}))).next(ai());t(s,h,r,l,p)}))}_updateManipulatorTransform(){const t=De(ke.get(),E(Ue.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new ee({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:j(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=di(.02,1,128,j(0,0,1),j(0,0,0)),e=De(Ve(),j(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:t,material:this._discMaterial,transform:e,stateMask:fi.Focused},{geometry:t,material:this._discMaterialTransparent,transform:e,stateMask:fi.Unfocused}],this._manipulator.radius=this._radius/70*80}_createMaterial(t=1){const e=we.toUnitRGBA(Lt.main);return e[3]*=t,new vi({color:e,transparent:1!==t,cullFace:hi.Back,renderOccluded:Ut.Transparent})}get test(){return{discManipulator:this._manipulator}}}class so extends Ka{constructor(t){super(),this._radius=70,this.events=new Yt,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,Ua.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const a=p(e.graphic.geometry).spatialReference;return $a(e,i,(e=>this.createDragPipeline(((i,a,o,s,n)=>e(i,t(i,a,o,s,n),o)),a)),this._view.state.viewingMode)}createDragPipeline(t,e){const i=this._view;return ti(this._manipulator,((a,o,s,n,r)=>{const l=o.next((t=>({...t,manipulatorType:Ua.TRANSLATE_Z}))).next(Ye(i,a.renderLocation,e)).next(ai());t(a,l,s,n,r)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/70,e=It.zManipulator.height*t,i=It.zManipulator.coneHeight*t,a=It.zManipulator.coneWidth*t,o=It.zManipulator.width*t,s=[j(0,0,0),j(0,0,e)],n=mi(s,o/2,16,!1),r=gi(i,a/2,16,!1),l=[j(0,0,0),j(0,0,e+i)],p=(t=>{const i=Ve();return Ge(i,i,[0,0,e]),Ie(i,i,Math.PI/2),i})(),h=(t,e)=>{const i=bi(It.zManipulator.color,e);return[i.r/255,i.g/255,i.b/255,It.zManipulator.color.a*t]},c=ie(h(1,.25),Ut.Occlude),u=ie(h(1,0),Ut.Occlude),d=ie(h(.7,0),It.zManipulator.renderOccluded),m=ie(h(.85,0),It.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:r,transform:p,material:c,stateMask:fi.Unfocused},{geometry:n,material:c,stateMask:fi.Unfocused},{geometry:r,transform:p,material:u,stateMask:fi.Focused},{geometry:n,material:u,stateMask:fi.Focused},{geometry:r,transform:p,material:d,stateMask:fi.Unfocused},{geometry:n,material:d,stateMask:fi.Unfocused},{geometry:r,transform:p,material:m,stateMask:fi.Focused},{geometry:n,material:m,stateMask:fi.Focused}],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const t=new ee({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e=this._view.state.camera,i=no;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=T(e.eye,i),o=e.computeRenderPixelSizeAtDist(a),s=A(ro,i,e.eye);D(s,s);const n=lo;this._view.renderCoordsHelper.worldUpAtPosition(no,n);const r=Math.abs(G(s,n)),l=I(ro,s,n),p=I(ro,l,n),h=me(r,.01,1),c=1-Math.sqrt(1-h*h)/h/e.fullWidth,u=this._radius/70,d=It.zManipulator.width*u;O(p,D(p,p),(1/c-1)*a+o*d),t[12]-=ro[0],t[13]-=ro[1],t[14]-=ro[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const no=x(),ro=x(),lo=x();class po extends Ka{constructor(t){super(),this._handles=new Ee,this._interactive=!0;const{tool:e,view:i,snapToScene:a,radius:o}=t;this._view=i,this.xyManipulation=new oo({tool:e,view:i,snapToScene:a,radius:o}),this.xyAxisManipulation=new io({tool:e,view:i,radius:o}),this.zManipulation=new so({tool:e,view:i,radius:o}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((t=>{this._handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,e,a){return i([this.xyManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(co.XY,e,i,a,o,s)),e,a),this.xyAxisManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(co.XY_AXIS,e,i,a,o,s)),e,a),this.zManipulation.createGraphicDragPipeline(((e,i,a,o,s)=>t(co.Z,e,i,a,o,s)),e,a)])}createDragPipeline(t,e,a,o){return i([this.xyManipulation.createDragPipeline(((e,i,a,o,s)=>t(co.XY,e,i,a,o,s)),e,a,o),this.xyAxisManipulation.createDragPipeline(((e,i,a,o,s)=>t(co.XY_AXIS,e,i,a,o,s)),e,a,o),this.zManipulation.createDragPipeline(((e,i,a,o,s)=>t(co.Z,e,i,a,o,s)),a)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator((e=>t(e,Ua.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((e=>t(e,Ua.TRANSLATE_XY))),this.zManipulation.forEachManipulator((e=>t(e,Ua.TRANSLATE_Z)))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator((t=>t.focused))||this.xyAxisManipulation.someManipulator((t=>t.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,e=this.xyManipulation;if($("esri-mobile"))return;const i=[];e.forEachManipulator((t=>i.push(t))),t.forEachManipulator((t=>i.push(t)));const a=()=>{const e=[];this._xyAxisVisible||t.forEachManipulator((t=>e.push(t.disableDisplay()))),this._handles.remove(ho),this._handles.add(e,ho)};for(const t of i)this._handles.add(t.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(_((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator((e=>{e.interactive=!t&&this._interactive||e.grabbing}))}static radiusForSymbol(t){const e=s(t)&&"point-3d"===t.type&&t.symbolLayers;return e&&e.length>0&&e.some((t=>"icon"===t.type))?Wa:70}}const ho="disable-xy-axis-display";var co;!function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"}(co||(co={}));class uo extends Ka{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,Ua.TRANSLATE_XY)}createGraphicDragPipeline(t){return $a(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const e=this._view,i=this._graphicState.graphic,a=s(i.geometry)?i.geometry.spatialReference:null;return ti(this._manipulator,((o,s,n,r,l)=>{const p=s.next(Be(l,e,i,a)).next(si()).next(ai());t(o,p,n,r,l)}))}_createManipulator(){const t=this._view,e=this._graphicState.graphic;this._manipulator=new Si({graphic:e,view:t,selectable:!0,cursor:"move"})}}class mo{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class go{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move"}}class _o{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let yo=class extends(Bt(Yt.EventedMixin(ni))){constructor(t){super(t),this.graphics=new Zt,this.enableZ=!0,this.tooltipOptions=new Ii,this.type="move-3d",this._snappingPipeline=new Li,this._tooltip=null}initialize(){const{graphics:t,view:e}=this;this.addHandles([t.on("change",(()=>this._refreshManipulators())),d((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new Et({view:e}):l(this._tooltip)}),y)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=l(this._tooltip),this._moveManipulation=l(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>le(t)===pe.SUPPORTED)).map((t=>new vo(t)));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this._updateMoveManipulation(t))}_createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new uo({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(({action:t})=>{const{tooltipOptions:e,_tooltip:i}=this;n(i)||("start"===t?i.info=new Pi({tooltipOptions:e}):i.clear())}))]))),this.handles.add(e.manipulationXY.createDragPipeline(((e,i,a,o)=>this._buildDragEventPipeline(t,co.XY,e,i,a,o))))}this._createMoveManipulation(t)}_createMoveManipulation(t){const e=new po({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?po.radiusForSymbol(t[0].graphic.symbol):70});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(i=>{e.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=e=>i=>{this.handles.add(i.events.on("focus-changed",(({action:i})=>{const a=this._tooltip;n(a)||("focus"===i?this._updateMoveTooltip(t,e):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(co.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(co.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(co.Z));const a=()=>this._updateMoveManipulation(t);for(const e of t)this.handles.add([e.state.on("changed",a),d((()=>e.state.displaying),a)]);const o=t[t.length-1];this.handles.add(o.state.on("changed",(()=>this._updateMoveManipulationAngle(o)))),this.handles.add(e.createDragPipeline(((e,i,a,o,s)=>this._buildDragEventPipeline(t,e,i,a,o,s)),Y(o.graphic),p(o.graphic.geometry).spatialReference,o.graphic)),this._updateMoveManipulationAngle(o)}_createVisualElements(t){for(const i of t){const a=i.graphic,o=Ba({view:this.view,graphic:a,forEachManipulator:t=>{i.manipulationXY.forEachManipulator(t),this._moveManipulation.forEachManipulator(t)},onManipulatorsChanged:()=>e()});n(o)||(i.geometryRepresentation=o.visualElement,i.geometryRepresentation instanceof Pt&&this.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(()=>{i.state.isDraped||this._updateMoveManipulation(t)})),d((()=>i.state.isDraped),(()=>this._updateMoveManipulation(t)))]),this.handles.add(o))}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=to(t.graphic.geometry)}_updateMoveManipulation(t){const e=te(0,0,0,this.view.spatialReference);let i=0,a=!1;const o=this._moveManipulation;for(const o of t){if(!o.state.displaying)continue;const t=o.state.graphic;this.enableZ&&ue(t)&&(a=!0);const n=o.geometryRepresentation instanceof Pt&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:ae(this.view,t);s(n)&&(e.x+=n.x,e.y+=n.y,e.z+=n.z,i++)}i>0?(e.x/=i,e.y/=i,e.z/=i,o.location=e,o.xyManipulation.available=!0,o.xyAxisManipulation.available=!0,o.zManipulation.available=a):o.available=!1}_buildDragEventPipeline(t,e,i,a,o,s){const n=[],r=[];let l=null,p=null;const h=()=>{for(const t of n)t.dragging=!1;n.length=0,r.length=0,l=null,p=null,this._moveManipulation.interactive=!0};if(o=o.next((t=>p(t))).next((()=>{if(this.emit("graphic-move-stop",new _o(r)),this.destroyed)return null;h()})),1===t.length&&e===co.XY){const e=t[0].graphic;a=this._buildSnappingPipelineSteps(e,Y(e),a,o,s)}return a.next((e=>{if("start"===e.action){n.length=0,r.length=0;for(const e of t)e.dragging||!e.manipulationXY.hasManipulator(i)&&e.manipulationXY.grabbing||(n.push(e),r.push(e.graphic),e.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,l=ri(r,this.view.state.viewingMode),p=li(r),this.emit("graphic-move-start",new mo(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>l(t))).next((i=>(this._updateMoveTooltip(t,e,i),i))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,o=i.y-e.y;if(this.emit("graphic-move",new go(a,o,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new _o(r)),this.destroyed)return null;h()}}))}_updateMoveTooltip(t,e,i){const{tooltipOptions:a,_tooltip:o}=this;if(n(o))return;o.clear();const s=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(e){case co.XY:o.info=new Pi({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,((t,e)=>xt(t,e,s)));break;case co.XY_AXIS:o.info=new Ci({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,((t,e)=>{const a=xt(t,e,s);return Wt(a,eo(i))}));break;case co.Z:o.info=new Vi({tooltipOptions:a}),this._updateMoveTooltipDistance(o.info,i,Hi)}}_updateMoveTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:Qt}}_buildSnappingPipelineSteps(t,e,i,a,o){const s=t.geometry;if(n(s)||"point"!==s.type&&"mesh"!==s.type)return i;const r=("point"===s.type?s:s.anchor).clone(),l=new Ri({elevationInfo:e,pointer:o,editGeometryOperations:xi.fromGeometry(r,this.view.state.viewingMode),visualizer:new Dt,excludeFeature:t}),p=this.snappingManager;return i.next((e=>(r.z=q(this.view,r,Y(t),{mode:"absolute-height",offset:0}),{...e,snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:p,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],yo.prototype,"view",void 0),t([f()],yo.prototype,"graphics",void 0),t([f({constructOnly:!0,nonNullable:!0})],yo.prototype,"enableZ",void 0),t([f({constructOnly:!0,type:Ii})],yo.prototype,"tooltipOptions",void 0),t([f({constructOnly:!0})],yo.prototype,"snappingManager",void 0),t([f()],yo.prototype,"type",void 0),t([f()],yo.prototype,"updating",null),yo=t([b("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],yo);class vo{constructor(t){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new zt({graphic:t})}get graphic(){return this.state.graphic}}function fo(t,e,i){const a="on-the-ground"===i.mode?Ei.XY:Ei.XYZ;return new wi(t,a,e,0)}function Mo(t,e,i){const a=x();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const o=bo(t,e,Zi(i.plane)),s=bo(t,e,i.edgeDirection);if(n(o)||n(s))return null;const r=I(x(),o,s);return Yi(a,r,Bi())}function bo(t,e,i){const a=te(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),o=x(),s=x();return t.renderCoordsHelper.toRenderCoords(e,o)&&t.renderCoordsHelper.toRenderCoords(a,s)?R(s,o,s):null}let So=class extends wt{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=Qt,this.area=null,this.totalLength=null}};t([f()],So.prototype,"type",void 0),t([f()],So.prototype,"distance",void 0),t([f()],So.prototype,"area",void 0),t([f()],So.prototype,"totalLength",void 0),So=t([b("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],So);let xo=class extends(Yt.EventedMixin(qt)){constructor(t){super(t),this._vertexManipulatorMaterial=ie(It.colorToVec4(It.reshapeManipulators.vertex.color),It.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=oe(It.colorToVec4(It.reshapeManipulators.vertex.outlineColor),It.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=oe(It.colorToVec4(It.reshapeManipulators.vertex.hoverOutlineColor),It.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=ie(It.colorToVec4(It.reshapeManipulators.edge.color),It.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=oe(It.colorToVec4(It.reshapeManipulators.edge.outlineColor),It.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=ie(It.colorToVec4(It.reshapeManipulators.edgeOffset.color),It.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=ie(It.colorToVec4(It.reshapeManipulators.edgeOffset.hoverColor),It.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=ie(It.colorToVec4(It.reshapeManipulators.selected.color),It.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=oe(It.colorToVec4(It.reshapeManipulators.selected.outlineColor),It.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=oe(It.colorToVec4(It.reshapeManipulators.selected.hoverOutlineColor),It.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new Ee,this._manipulatorInfos=[],this._editGeometryOperations=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Ao.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new Li,this._snappingPipelineHandle=new Li,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:t,view:e}=this,i=this._graphicState=new zt({graphic:t});this._tooltip=new Et({view:e}),this.addHandles([d((()=>i.displaying),(t=>{for(const e of this._manipulatorInfos)e.manipulator.available=t})),d((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:t,enabled:e,edgeOffsetEnabled:i})=>{s(t)&&(t.visible=e,t.edgeDistance=i?"far":"default")}),g),_((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),g),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=l(this._segmentLabels),this._tooltip=l(this._tooltip),this._removeManipulators()}get inputGeometry(){return s(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const t=this._manipulatorInfos.filter((t=>t.manipulator.selected&&"vertex"===t.type));this._removeVertices(t)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=l(this._moveManipulation),this._graphicMoveManipulation=l(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(n(this._editGeometryOperations))return;const t=Y(this.graphic);for(const e of this._editGeometryOperations.data.components){for(const i of e.vertices)this._createVertexOrEdgeManipulator(i,t);for(const i of e.edges)this._createVertexOrEdgeManipulator(i,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return s(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return s(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(n(this._editGeometryOperations))return null;const t=this._editGeometryOperations.redo();return s(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if(n(this._editGeometryOperations))return null;this.emit("undo");const t=this._editGeometryOperations.undo();return s(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._removeManipulators(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(t=this.inputGeometry){this._removeManipulators(),this._tooltip.clear(),n(t)||(l(this._editGeometryOperations),this._editGeometryOperations=xi.fromGeometry(t,this.view.state.viewingMode),this._createManipulators(),l(this._segmentLabels),this._segmentLabels=new Ra({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:Y(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(t,e){if("end"===e.action)return e;let i=0;const a=[],o=this._manipulatorInfos.some((t=>"vertex"===t.type&&t.manipulator.selected)),s=t===Do.SELECTED_OR_ALL&&o;for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.grabbing||s&&!t.manipulator.selected||a.push(t),i++);if(0===a.length)return e;if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(Ao.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Ao.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){let t=0;for(const e of this._manipulatorInfos)"vertex"===e.type&&e.manipulator.selected&&t++;return t>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(Ao.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const o=[];for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.selected&&!e.manipulator.grabbing||e===t.info)&&o.push(e);this._moveVertices(o,t,Oi.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case Ao.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Ao.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Ao.MOVING:switch(this._reshapeEventState){case Ao.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Ao.RESHAPING:switch(this._reshapeEventState){case Ao.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Ao.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulation(){const{tool:t,view:e}=this,i=this._graphicState;if(this._graphicMoveManipulation=new uo({tool:t,view:e,graphicState:i}),this.enableMoveGraphic){let t=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,i,a)=>{i.next((t=>this._trackNumDragging(t))).next((e=>("start"===e.action&&(t=p(this._editGeometryOperations).createUndoGroup()),e))).next((t=>this._perGraphicManipulatorDragAction(Do.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(co.XY,t),t))).next((e=>{"end"===e.action&&(this._tooltip.clear(),t=h(t))})),a.next((()=>this._onDragCancel(!0,(()=>t=h(t)))))}))),this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(t,!1))))}else this._graphicMoveManipulation.forEachManipulator((t=>{t.grabbable=!1,t.cursor=null}));this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(t.events.on("immediate-click",(t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})))))}_createMoveManipulation(t){const{graphic:e,handles:i,tool:a,view:o}=this,s=this._graphicState;this._moveManipulation=new po({tool:a,view:o,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&ue(e),snapToScene:!1,radius:po.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>i.add([t.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(t)||this._manipulatorInfos.some((t=>t.manipulator.selected))||this.emit("immediate-click",{...i,graphic:e}),i.stopPropagation()})),this._watchAndUpdateGrabState(t,!1)])));const n=t=>e=>{i.add(e.events.on("focus-changed",(({action:e})=>{"focus"===e&&this._tooltipOptions.enabled?this._updateTranslateTooltip(t):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(n(co.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(co.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(n(co.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const r=p(e.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,o,s,n,r)=>(n=n.next((t=>(this._onDragCancel(),t))),s.next((t=>this._trackNumDragging(t))).next((t=>{const e=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));return t.manipulatorType===Ua.TRANSLATE_XY&&1===e.length?{...t,info:e[0],snapOrigin:e[0].handle.pos}:t})).next(pi(this.view,t,e)).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:t=>!!t.info,cancel:n,snappingManager:a.snappingManager,snappingContext:new Ri({editGeometryOperations:p(this._editGeometryOperations),elevationInfo:t,pointer:r,excludeFeature:e,visualizer:new Dt}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipelineHandle.next).next(si()).next((t=>this._perGraphicManipulatorDragAction(Do.SELECTED_OR_ALL,t))).next((t=>(this._updateTranslateTooltip(i,t),t))))),t,r,e),d((()=>s.displaying),(()=>{this._updateMoveManipulationPosition()}),g),s.on("changed",(()=>this._updateMoveManipulationPosition())),d((()=>s.isDraped),(t=>{this._updateMoveManipulationPosition();const e="align-move-manipulation";t?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):i.remove(e)}),g)])}_createVisualElements(){const{graphic:t,view:e}=this,i=Ba({view:e,graphic:t,forEachManipulator:t=>{if(!this.destroyed){this._graphicMoveManipulation.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);for(const e of this._manipulatorInfos)t(e.manipulator,Ua.TRANSLATE_XY)}},onManipulatorsChanged:t=>this.on("manipulators-changed",t)});s(i)&&(this._outlineVisualElement=i.visualElement instanceof Pt?i.visualElement:null),s(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t,e=Y(this.graphic)){const a=It.reshapeManipulators.edgeOffset,o=a.size/2,r=o+a.collisionPadding;if(n(this._edgeOffsetManipulatorGeometryInside)||n(this._edgeOffsetManipulatorGeometryOutside)){const t=o/r,e=t*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=ci(e,t/2,t/2,a.height,a.offset),this._edgeOffsetManipulatorGeometryOutside=ci(-e,t/2,t/2,a.height,-a.offset)}const l=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:fi.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:fi.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:fi.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:fi.Focused}],p=new ee({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==e.mode||Qi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:r,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:j(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new ee({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),c={manipulator:p,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(c,a.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(c);const u=[];for(const t of[c.handle.leftVertex,c.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(t);s(e)&&u.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c))))}c.locationUpdateHandle=i(u),this._manipulatorHandles.add(c.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(h,!0)],p),this._manipulatorHandles.add(ti(p,this._createEdgeOffsetPipeline(c,e)),p),this._manipulatorHandles.add(ti(h,((t,i,a,o)=>{if("touch"===o)this._createEdgeOffsetPipeline(c,e)(t,i,a);else if(this.enableMoveGraphic){const o=this.graphic,n=s(o.geometry)?o.geometry.spatialReference:null;i.next((t=>this._trackNumDragging(t))).next(ei(this.view,t.elevationAlignedLocation)).next(Ze(this.view,t.elevationAlignedLocation,e,n,o)).next(ai()).next(si()).next((t=>this._perGraphicManipulatorDragAction(Do.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(co.XY,t),t))).next((t=>{"end"===t.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!t.metadata.deleting)))}})),p);const d=t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",d),h.events.on("immediate-click",d),p.events.on("focus-changed",(({action:t})=>{const e=this._tooltipOptions;if("focus"===t&&e.enabled){const t=this._tooltip.info=new So({tooltipOptions:e});this._updateTooltipAreaOrTotalLength(t)}else this._tooltip.clear()}))],p),this._manipulatorInfos.push(c),this.manipulators.add(p),this.manipulators.add(h),this.emit("manipulators-changed"),c}_autoHideEdgeOffsetManipulator(t,e){const a=t.manipulator,o=t.edgeManipulator,n=()=>{t.visibilityHandle=h(t.visibilityHandle);const n=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex),l=s(n)&&s(r)&&function(t,e,i){const a=i.projectToRenderScreen(t,J()),o=i.projectToRenderScreen(e,J());return s(a)&&s(o)?L(A(a,a,o)):0}(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!a.focused&&!o.focused||l)&&(a.grabbable=!l,o.grabbable=!l,t.visibilityHandle=i([a.disableDisplay(),{remove:()=>{a.grabbable=!0,o.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([a.events.on("focus-changed",n),o.events.on("focus-changed",n),{remove:()=>{h(t.visibilityHandle),o.metadata.deleting=!0,this.manipulators.remove(o)}}],a),n()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const{coordinateHelper:e}=p(this._editGeometryOperations).data,i=Mo(this.view,t.manipulator.elevationAlignedLocation,fo(e,t.handle,p(t.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex),o=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(n(a)||n(o))return;const r=a.manipulator.renderLocation,l=o.manipulator.renderLocation,h=s(i)?function(t,e,i){const a=Zi(t),o=R(x(),e,i),s=I(x(),o,a),n=I(x(),o,s);return Ce(o[0],o[1],o[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1)}(i,r,l):ze;t.manipulator.modelTransform=h,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=h;const c=P(A(Oo,r,l))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-c,0,0],[c,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,o)=>{this._clearSelection();const{step:s,cleanup:n}=this._initializeEdgeOffset(t,e);a.next((t=>this._trackNumDragging(t))).next(ei(this.view,i.elevationAlignedLocation)).next(s).next(qe(this.view)).next(We(this.view,p(this._editGeometryOperations).data.spatialReference)).next(si()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next((t=>{"end"===t.action&&n()})),o.next((()=>{i.metadata.deleting||(n(),this._onDragCancel())}))}}_initializeEdgeOffset(t,e){const o=p(this._editGeometryOperations),r=fo(o.data.coordinateHelper,t.handle,e),l=o.createUndoGroup(),c=Mo(this.view,t.manipulator.elevationAlignedLocation,r);if(r.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);s(e)&&this._splitEdgeManipulator(e,1)}if(r.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);s(e)&&this._splitEdgeManipulator(e,0)}const u=()=>new Xi({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:o.data.spatialReference}),m=new Pt({view:this.view,isDraped:this._graphicState.isDraped,geometry:u(),elevationInfo:t.elevationInfo,width:It.visualElements.lineGraphics.outline.width,color:It.colorToVec4(Lt.main),attached:!0});let g;const _=()=>{this._cleanEdgeOffsetCollapsedEdges(t),g=h(g)},y=this.on("undo",_);return g=i([a(m),d((()=>this._graphicState.isDraped),(t=>m.isDraped=t)),this._graphicState.on("changed",(()=>m.geometry=u())),l,y]),{step:t=>n(r)||n(c)?(_(),null):{...t,operation:r,plane:c},cleanup:_}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||n(e.operation))return e;this._updateEventState(Ao.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o}=e;return(i||a||o)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return t=>{const{operation:e,mapEnd:i}=t;return n(e)||n(i)?t:("start"===t.action&&e.selectArrowFromStartPoint(i),{...t,signedDistance:e.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return t=>{const{mapEnd:e,signedDistance:i,operation:a}=t,o=this._tooltip,r=this._tooltipOptions;if(!r.enabled||n(i))return o.clear(),t;let l=o.info;(n(l)||"reshape-edge-offset"!==l.type)&&(l=o.info=new So({tooltipOptions:r}));const{coordinateHelper:h}=p(this._editGeometryOperations).data;return l.distance="end"===t.action?Qt:function(t,e,i,a,o){if(t){const t=o.toXYZ(o.pointToVector(i)),n=qi(a,t,Ue.get()),r=jt(n,t,o.spatialReference);if(s(r))return Jt(r.value*Math.sign(e),r.unit)}return Jt(e*st(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,e,a.plane,h),this._updateTooltipAreaOrTotalLength(l),t}}_cleanEdgeOffsetCollapsedEdges(t){const e=t.handle.leftVertex.leftEdge?.leftVertex,i=t.handle.leftVertex,a=t.handle.rightVertex.rightEdge?.rightVertex,o=t.handle.rightVertex,n=p(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&n.distance(e.pos,i.pos)<jo){const t=this._getManipulatorInfoFromHandle(i);s(t)&&r.push(t)}if(n.distance(i.pos,o.pos)<jo||a&&n.distance(a.pos,o.pos)<jo){const t=this._getManipulatorInfoFromHandle(o);s(t)&&r.push(t)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t,e=Y(this.graphic)){if("edge"===t.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if(n(this._vertexManipulatorGeometry)||n(this._vertexManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(It.reshapeManipulators.vertex);this._vertexManipulatorGeometry=_i(t,16,16),this._vertexManipulatorOutlineGeometry=_i(e,16,16)}if(n(this._edgeManipulatorGeometry)||n(this._edgeManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(It.reshapeManipulators.edge);this._edgeManipulatorGeometry=_i(t,16,16),this._edgeManipulatorOutlineGeometry=_i(e,16,16)}const a=s(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:To.Vertex|fi.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:To.Vertex|fi.Unfocused|fi.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:To.Vertex|fi.Focused|fi.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:fi.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:fi.Selected|fi.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:fi.Selected|fi.Focused}];this.enableMidpoints&&a.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:To.Edge|fi.Focused|fi.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:To.Edge|fi.Focused|fi.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:To.Edge|fi.Unfocused|fi.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:To.Edge|fi.Unfocused|fi.Unselected});const o=new ee({view:this.view,renderObjects:a,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible),metadata:{deleting:!1}});this._setTypeSpecificManipulatorSettings(o,t,e);const r="edge"===t.type?{manipulator:o,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:o,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(o),this._updateManipulatorPosition(r),"edge"===r.type){const t=[];for(const e of[r.handle.leftVertex,r.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(e);s(i)&&t.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r))))}r.locationUpdateHandle=i(t),this._manipulatorHandles.add(r.locationUpdateHandle,o)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(o,!0),o);const l=ti(o,((t,i,a,o)=>{let s=null;a=a.next((e=>(this._onDragCancel(!t.metadata.deleting,(()=>s=h(s))),e))),i.next((t=>this._trackNumDragging(t))).next((t=>{if("start"===t.action&&(s=p(this._editGeometryOperations).createUndoGroup()),"edge"===r.type){const e=this._splitEdgeManipulator(r);return{...t,info:e,snapOrigin:e.handle.pos}}return{...t,info:r,snapOrigin:r.handle.pos}})).next(ei(this.view,t.elevationAlignedLocation)).next(Qe(this.view,this.graphic,t.elevationAlignedLocation,t.location.spatialReference,this.graphic)).next(pi(this.view,e,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new Ri({editGeometryOperations:p(this._editGeometryOperations),elevationInfo:e,pointer:o,excludeFeature:this.graphic,visualizer:new Dt}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipeline.next).next(si()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(s=h(s)),this._updateTranslateVertexTooltip(t,co.XY,e)}))}));return this._manipulatorHandles.add([l,o.events.on("immediate-click",(t=>this._manipulatorClickCallback(t,r))),o.events.on("select-changed",(()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),o.events.on("focus-changed",(({action:t})=>{"focus"===t&&"edge"!==r.type?this._updateTranslateVertexTooltip(o,co.XY):this._tooltip.clear()}))],o),this.emit("manipulators-changed"),r}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(t=!0,e){switch(this._numDragging--,t&&(this.undo(),this.outputGeometry=s(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),s(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Ao.NONE:break;case Ao.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Ao.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(Ao.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){switch(e.type){case"vertex":t.state=To.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2,t.radius=It.reshapeManipulators.vertex.size/2+It.reshapeManipulators.vertex.collisionPadding,t.elevationInfo=i,t.interactive=s(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":t.state=To.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1,t.radius=It.reshapeManipulators.edge.size/2+It.reshapeManipulators.edge.collisionPadding,t.elevationInfo="on-the-ground"!==i.mode||Qi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",(i=>this._onGrabStateChanged(t,e,i.action,i.pointerType)))}_onGrabStateChanged(t,e,i,a="mouse"){if("start"===i)e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Ao.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((t=>{t.manipulator.interactive=t.manipulator.grabbing||!this._numGrabbing&&s(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in t&&(t.edgeManipulator.interactive=t.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((t=>{t.interactive=t.grabbing||!this._numGrabbing})))}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){n(t)||(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),M(this._manipulatorInfos,t),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t)for(const e of this._manipulatorInfos)if(t===e.handle)return e;return null}_updateManipulatorPosition(t){if(n(t))return;const e=p(this._editGeometryOperations);if("vertex"===t.type)t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,wo),t.manipulator.grabbing&&s(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if("edge"===t.type){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(n(i)||n(a))return;const o=i.manipulator,r=a.manipulator;if(s(t.manipulator.elevationInfo)&&"on-the-ground"===t.manipulator.elevationInfo.mode){const i=o.location,a=r.location,s=.5,n=i.x+s*(a.x-i.x),l=i.y+s*(a.y-i.y),p=i.hasZ&&a.hasZ?0:void 0;t.manipulator.location=te(n,l,p,e.data.spatialReference)}else V(Oo,o.renderLocation,r.renderLocation,.5),t.manipulator.renderLocation=Oo}}_splitEdgeManipulator(t,e=.5){const i=p(this._editGeometryOperations),a=p(i.splitEdge(t.handle,e).createdVertex);t.locationUpdateHandle.remove(),t.locationUpdateHandle=void 0;const o=Y(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(t),s=this._createVertexOrEdgeManipulator(a)):(s=t,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,o)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,co.XY),this._updateSelection(t.manipulator);const n=this._updateEventState(Ao.RESHAPING),r=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:r,componentIndex:l,vertexIndex:p(a.index)}],added:r}),n&&this._updateEventState(Ao.NONE),s}_updateMoveManipulationPosition(){const t=E(Oo,0,0,0);let e=0,i=!1,a=null,o=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(e++,w(t,t,s.manipulator.renderLocation),n(a)||s.selectedIndex>a.selectedIndex?(o=a,a=s):(n(o)||s.selectedIndex>o.selectedIndex)&&(o=s)):i=!0);if(0!==e){const t=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.zManipulation.available=t&&this.enableZVertex&&ue(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t&&1!==e}else{const t=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t,this._moveManipulation.zManipulation.available=t&&this.enableZShape&&ue(this.graphic)}if(0!==e){let t=0;if(s(a)){const e=a.handle.pos,i=s(o)?o.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,r=n(o)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&r?this._moveManipulation.xyAxisManipulation.available=!1:i?t=Eo(i,e):r&&(t=Eo(e,r))}this._moveManipulation.angle=t,this._moveManipulation.radius=Wa}else this._moveManipulation.angle=to(p(this.graphic.geometry)),this._moveManipulation.radius=po.radiusForSymbol(this.graphic.symbol);0!==e&&i?(O(t,t,1/e),wo.spatialReference=p(this._editGeometryOperations).data.spatialReference,wo.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,wo),this._moveManipulation.elevationAlignedLocation=wo):s(this._outlineVisualElement)&&!this._graphicState.isDraped&&s(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:se(this.view,this._moveManipulation,this.graphic)}_removeVertices(t){const e=[],i=p(this._editGeometryOperations);for(const a of t)if("vertex"===a.type&&i.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const t=p(i.removeVertices([a.handle]).removedVertices[0].createdEdge);t&&this._createVertexOrEdgeManipulator(t)}if(e.length>0){const t=e.map((t=>{const e=i.data.components.indexOf(t.component);return{coordinates:i.data.coordinateHelper.vectorToArray(t.pos),componentIndex:e,vertexIndex:p(t.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(Ao.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:t.map((t=>t.coordinates)),vertices:t}),this.destroyed)return;if(a&&(this._updateEventState(Ao.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e,i=("start"===e.action?Oi.NEW_STEP:Oi.ACCUMULATE_STEPS)){const a=p(this._editGeometryOperations);a.moveVertices(t.map((t=>t.handle)),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const e of t)this._updateManipulatorPosition(e)}_offsetEdge(t,e){if(n(e.operation)||n(e.signedDistance))return;const i=p(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),"vertex"===e.type&&(e.manipulator.selected=!e.manipulator.selected,t.button===Ji.Right&&this._removeVertices([e])),"edge"===e.type&&t.button===Ji.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){const i=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,t,e):this._updateTranslateGraphicTooltip(t,e)}_updateTranslateGraphicTooltip(t,e){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case co.XY:this._tooltip.info=new Pi({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,e)=>xt(t,e,a)));break;case co.XY_AXIS:this._tooltip.info=new Ci({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,i)=>{const o=xt(t,i,a);return Wt(o,eo(e))}));break;case co.Z:this._tooltip.info=new Vi({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,Hi)}}_updateTranslateVertexTooltip(t,e,i){const a=this._tooltipOptions;if(!a.enabled)return;let o;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case co.XY:o=new ki({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((t,e)=>xt(t,e,n))),this._updateTooltipAreaOrTotalLength(o);break;case co.XY_AXIS:o=new Ui({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((t,e)=>{const a=xt(t,e,n);return Wt(a,eo(i))})),this._updateTooltipAreaOrTotalLength(o);break;case co.Z:o=new zi({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,Hi)}const r=Ni(t.elevationAlignedLocation);s(r)&&(o.elevation={mode:"absolute-height",...r}),this._tooltip.info=o}_updateTranslateTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:Qt}}_updateTooltipAreaOrTotalLength(t){const{geometry:e}=this.graphic;if(n(e))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";t.area="polygon"===e.type?Ki(e,i):null,t.totalLength="polyline"===e.type?Ot(e,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Eo(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}t([f()],xo.prototype,"_segmentLabels",void 0),t([f({constructOnly:!0})],xo.prototype,"tool",void 0),t([f()],xo.prototype,"_tooltip",void 0),t([f()],xo.prototype,"inputGeometry",null),t([f()],xo.prototype,"outputGeometry",void 0),t([f({readOnly:!0})],xo.prototype,"updating",null),t([f()],xo.prototype,"manipulators",null),t([f()],xo.prototype,"view",null),t([f()],xo.prototype,"graphic",null),t([f()],xo.prototype,"enableZShape",null),t([f()],xo.prototype,"enableZVertex",null),t([f()],xo.prototype,"enableMoveGraphic",null),t([f()],xo.prototype,"enableMidpoints",null),t([f()],xo.prototype,"enableEdgeOffset",null),t([f()],xo.prototype,"_labelOptions",null),t([f()],xo.prototype,"_tooltipOptions",null),xo=t([b("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],xo);const wo=te(0,0,null,null),Oo=x(),jo=1e-6;var To,Ao,Do;!function(t){t.Vertex=Mi.Custom1,t.Edge=Mi.Custom2}(To||(To={})),function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(Ao||(Ao={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Do||(Do={}));let Go=class extends(Yt.EventedMixin(ni)){constructor(t){super(t),this._handles=new Ee,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new $i,this.tooltipOptions=new Ii,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new xo({tool:this});this.addHandles([t.on("reshape",(t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)})),t.on("move",(t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)})),t.on("vertex-add",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)})),t.on("vertex-remove",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)})),t.on("immediate-click",(t=>this.emit("immediate-click",t))),this.view.on("pointer-down",["Shift"],(t=>{t.stopPropagation()})),d((()=>this.graphic),(()=>this._updateGraphic()),y)]),this.finishToolCreation()}destroy(){this._handles=l(this._handles),this._reshapeOperation=l(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const t=he(this.graphic);this._reshapeOperation.inputGeometry=s(t)?t.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),ce(this.graphic)!==pe.SUPPORTED)return;const t=d((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),v);this._handles.add(t,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0,this.graphic.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){n(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){s(this.snappingManager)&&this.snappingManager.doneSnapping(),s(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){s(this.snappingManager)&&this.snappingManager.doneSnapping(),s(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(t){"key-down"!==t.type||"Delete"!==t.key&&"Backspace"!==t.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};t([f()],Go.prototype,"_reshapeOperation",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"view",void 0),t([f({constructOnly:!0})],Go.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"enableZShape",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"enableZVertex",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"enableMoveGraphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"enableMidpoints",void 0),t([f({constructOnly:!0,nonNullable:!0})],Go.prototype,"enableEdgeOffset",void 0),t([f()],Go.prototype,"type",void 0),t([f({constructOnly:!0,type:$i})],Go.prototype,"labelOptions",void 0),t([f({constructOnly:!0,type:Ii})],Go.prototype,"tooltipOptions",void 0),t([f({constructOnly:!0})],Go.prototype,"snappingManager",void 0),t([f()],Go.prototype,"updating",null),t([f()],Go.prototype,"automaticManipulatorSelection",void 0),Go=t([b("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Go);let Io=class extends wt{constructor(t){super(t),this.type="transform-rotate",this.rotationType="geographic"}};t([f()],Io.prototype,"type",void 0),t([f()],Io.prototype,"rotation",void 0),t([f()],Io.prototype,"rotationPrecision",void 0),t([f()],Io.prototype,"orientation",void 0),t([f()],Io.prototype,"orientationPrecision",void 0),t([f()],Io.prototype,"rotationType",void 0),Io=t([b("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Io);let Ro=class extends wt{constructor(t){super(t),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};t([f()],Ro.prototype,"type",void 0),t([f()],Ro.prototype,"scale",void 0),t([f()],Ro.prototype,"size",void 0),t([f()],Ro.prototype,"sizeUnit",void 0),t([f()],Ro.prototype,"sizePrecision",void 0),Ro=t([b("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Ro);let Lo=class extends wt{constructor(t){super(t),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var Po,Vo;t([f()],Lo.prototype,"type",void 0),t([f()],Lo.prototype,"orientation",void 0),t([f()],Lo.prototype,"orientationEnabled",void 0),t([f()],Lo.prototype,"orientationPrecision",void 0),t([f()],Lo.prototype,"rotationType",void 0),t([f()],Lo.prototype,"size",void 0),t([f()],Lo.prototype,"sizeUnit",void 0),t([f()],Lo.prototype,"sizeEnabled",void 0),t([f()],Lo.prototype,"sizePrecision",void 0),Lo=t([b("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Lo),function(t){t.ScaleIn=Mi.Custom2,t.ScaleOut=Mi.Custom3,t.RotateLeft=Mi.Custom4,t.RotateRight=Mi.Custom5,t.Unlocked=Mi.Custom7,t.DelayedFocused=Mi.Custom8,t.TouchInput=Mi.Custom12}(Po||(Po={}));class Co{constructor({adapter:t,tooltipOptions:e,mode:i,tool:a}){this._mode=null,this._handles=new Ee,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new Yt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>s(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=a,this._mode=i,this._adapter=t,this._tooltipOptions=e,this._tooltip=new Et({view:a.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(_((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),g))}get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}destroy(){s(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=l(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=l(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=aa({update:({deltaTime:e})=>{t.update(e)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){s(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=l(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,Ua.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const e=this.tool.graphicState.graphic,i=ti(t,((t,i,a)=>{this._scaleRotateDragData=null;const o=this._adapter.startInteraction(),n={mode:"none",origin:C(t.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();const r=Ue.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,r),i.next(Je(this.tool.view,Yi(t.renderLocation,r,Bi()))).next((t=>{const i=Zi(t.plane),a=ne(t.renderStart,t.renderEnd,n.origin,i),r=ia.shortestSignedDiff(n.angle,a);n.angleDir=me(n.angleDir+r,-.3,.3),n.angle=a;const l=function(t,e){const i=A(Ue.get(),e.renderStart,t.origin),a=A(Ue.get(),e.renderEnd,t.origin),o=P(i),s=P(a);return 0===o?0:s/o}(n,t),p=l-this._adapter.scale;if(n.scaleDir=me(n.scaleDir+p,-.2,.2),this._onScaleChanged(),"none"===n.mode){const i=this._mode||function(t,e,i,a){const{renderStart:o,renderEnd:s}=t,n=zo(o,a,Ue.get()),r=zo(s,a,Ue.get());if(z(n,r)<100)return null;const l=A(Ue.get(),o,i),p=I(Ue.get(),l,Zi(e)),h=o,c=w(Ue.get(),h,p),u=zo(i,a,Ue.get()),d=n,m=zo(c,a,Ue.get()),g=A(Ue.get(),m,d),_=A(Ue.get(),n,u),y=He(d,g),v=He(u,_);return Ne(y,r)<Ne(v,r)?"rotate":"scale"}(t,t.plane,n.origin,this.tool.view.state.camera);if(s(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:e,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:e,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":o.state.angle=n.initialAngle+a;break;case"scale":o.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),t.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:e,angle:ge(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:e,xScale:l,yScale:l})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:ge(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:l,yScale:l})}}return"end"===t.action&&(this.startAnimation(Uo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),o.done()),t})).next(this._updateTooltipPipelineStep(n)),a.next((()=>{if(o.cancel(),s(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:1,yScale:1})}this.startAnimation(Uo(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,t.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function(t,e){let i=0,a=null;const o=()=>!1;return{start:()=>{a=t.getFocused,t.getFocused=o,i=0,e()},update:t=>(i+=t,!a()||i>200?Vo.STOP:Vo.CONTINUE),destroy:()=>{t.getFocused=a,e()}}}(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState()})),t.events.on("immediate-click",(t=>{t.stopPropagation()})),d((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),g)])}_updateTooltipPipelineStep(t){return e=>{const i=this._tooltipOptions;if(!i.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const a=this._tooltip,o=this._tooltipOptions.visualVariables,n=s(o)?o.size:null,r=s(o)?o.rotation:null;switch(t.mode){case"scale":a.info=new Ro({tooltipOptions:i,scale:{value:this._adapter.scale},size:Jt(c(this._adapter.size,-1),"meters"),sizeUnit:s(n)?n.unit:null,sizePrecision:s(n)?ko(n.valueType):null});break;case"rotate":{const t=s(r)?ko(r.valueType):null,e=s(r)?r.rotationType:"geographic";a.info=new Io({tooltipOptions:i,rotation:Kt(c(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:t,orientation:Kt(-this._adapter.angle,"radians","geographic"),orientationPrecision:t,rotationType:e})}}return e}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=s(t)?t.rotation:null,i=s(t)?t.size:null;this._tooltip.info=new Lo({tooltipOptions:this._tooltipOptions,orientation:Kt(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:s(e)?ko(e.valueType):null,rotationType:s(e)?e.rotationType:"geographic",size:Jt(c(this._adapter.size,-1),"meters"),sizeUnit:s(i)?i.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:s(i)?ko(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Po.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Po.Unlocked,!(s(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),s(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Po.ScaleIn|Po.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Po.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Po.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Po.RotateLeft|Po.RotateRight,!1),this._ringManipulator.updateStateEnabled(Po.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Po.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Po.ScaleIn|Po.ScaleOut|Po.RotateLeft|Po.RotateRight,!1)}_updateManipulatorTransform(){const t=Ae(ke.get(),this._adapter.angle,j(0,0,1));if(n(t))return;const e=this.getScale(),i=De(ke.get(),E(Ue.get(),e,e,e));this._ringManipulator.modelTransform=Te(ke.get(),i,t)}_createRingManipulator(){const t=(t,e,i)=>{const a=[],o=Math.ceil(128*(e-t)/(2*Math.PI));for(let s=0;s<o+1;s++){const n=t+s*(e-t)/o;a.push(j(i*Math.cos(n),i*Math.sin(n),0))}return a},e=e=>t(0,2*Math.PI,e),i=(t,e)=>yi((t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]])(e),t,[],[],!1),a=e(160),o=i(a,24),s={left:[],right:[]},n=[];for(let e=0;e<2;e++){const a=e*Math.PI-Math.PI/4,o=Math.PI/2-Qa,r=a+o,l=a+Math.PI/2-o,p=t(r,l,190),h=i(p,9);n.push(p),n.push(t(r,l,201)),s.left.push(h),s.right.push(h);for(let t=0;t<2;t++){const e=0===t,i=Ve();if(e){Re(i,i,[1,-1,1]),Le(i,i,-r,[0,0,1]);const t=Math.round(.2*(p.length-1));i[12]=p[t][0],i[13]=p[t][1],i[14]=p[t][2]}else{Le(i,i,l,[0,0,1]);const t=Math.round(.8*(p.length-1));i[12]=p[t][0],i[13]=p[t][1],i[14]=p[t][2]}const a=ci(60,0,23,.5);ui(a,i),(e?s.left:s.right).push(a)}}const r=[];for(let e=0;e<2;e++){const a=e*Math.PI-Math.PI/4,o=Math.PI/2-Ja,s=a+o,n=a+Math.PI/2-o,l=t(s,n,213);r.push(i(l,9))}const l=e(190),p=e(213),h=i(l,9),c=i(p,9),u=e(130),d=e(107),m=i(u,9),g=i(d,9),_=this._createMaterial(),y=this._createMaterial(.66),v=this._createMaterial(.5),f=this._createMaterial(.33);let M=[{geometry:o,material:_,stateMask:Po.DelayedFocused},{geometry:o,material:v,stateMask:fi.None}];this._mode&&"scale"!==this._mode||(M=M.concat([{geometry:r,material:_,stateMask:Po.DelayedFocused|Po.Unlocked},{geometry:h,material:y,stateMask:Po.DelayedFocused|Po.ScaleIn},{geometry:c,material:f,stateMask:Po.DelayedFocused|Po.ScaleIn},{geometry:m,material:y,stateMask:Po.DelayedFocused|Po.ScaleOut},{geometry:g,material:f,stateMask:Po.DelayedFocused|Po.ScaleOut}])),this._mode&&"rotate"!==this._mode||(M=M.concat([{geometry:s.right,material:_,stateMask:Po.DelayedFocused|Po.Unlocked},{geometry:s.left,material:_,stateMask:Po.DelayedFocused|Po.RotateLeft},{geometry:s.right,material:_,stateMask:Po.DelayedFocused|Po.RotateRight}]));const b=[a,...n];return new ee({view:this.tool.view,renderObjects:M,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Y(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:b,direction:j(0,0,1)}})}_createMaterial(t=1){const e=oa([...qa,t]);return new vi({color:e,transparent:1!==t,cullFace:hi.Back,renderOccluded:Ut.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function zo(t,e,i){return e.projectToScreen(t,Ho),E(i,Ho[0],Ho[1],0)}function Uo(t,e){let i=null,a=1;const o=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=o,e()},update:t=>(a+=((a+1)/2-a)*Math.min(3*t,1),e(),Math.abs(a-1)<.01?Vo.STOP:Vo.CONTINUE),destroy:()=>{t.getScale=i,e()}}}function ko(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(Vo||(Vo={}));const Ho=Q();function No(t){return s(t.geometry)&&"mesh"===t.geometry.type?(e=t.geometry,s(e.transform)?function(t,e){let i=e.clone(),a=null;return{undo:e=>{a=s(t.transform)?t.transform.clone():null,t.transform=i,e.notifyGeometryChanged()},redo:e=>{i=s(t.transform)?t.transform.clone():null,t.transform=a,e.notifyGeometryChanged()}}}(e,e.transform):function(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}(e)):function(t){let e=t.geometry,i=u;return{undo(t){i=t.geometry,t.geometry=e},redo(t){e=t.geometry,t.geometry=i}}}(t);var e}let Fo=class extends qt{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([_((()=>s(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(({interactionState:t})=>{this._updateMeshRotation(t)}),v),_((()=>s(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(({interactionState:t})=>{this._updateMeshSize(t)}),v)])}get angle(){const t=this.geometry.transform;if(n(t))return 0;const e=sa(t.rotation)[2];return Math.abs(e)>.999999?de(na(t.rotation))*Math.sign(e):0}get scale(){return s(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new Xo({angle:this.angle});this._interactionState=t;const e=()=>this._interactionState=null;return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return No(this.graphic)}_updateMeshRotation(t){const e=this.geometry.anchor,i=this.viewingMode===ea.Global,{angle:a,previousAngle:o}=t;this.geometry.rotate(0,0,ge(a-o),{origin:e,geographic:i}),t.previousAngle=a,s(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const e=this.geometry.anchor,i=this.viewingMode===ea.Global,{scale:a,previousScale:o}=t;this.geometry.scale(a/o,{origin:e,geographic:i}),t.previousScale=a,s(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};t([f({constructOnly:!0})],Fo.prototype,"graphic",void 0),t([f({constructOnly:!0})],Fo.prototype,"geometry",void 0),t([f({constructOnly:!0})],Fo.prototype,"viewingMode",void 0),t([f()],Fo.prototype,"angle",null),t([f()],Fo.prototype,"scale",null),t([f()],Fo.prototype,"_interactionState",void 0),Fo=t([b("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Fo);let Xo=class extends tt{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}cancel(){this.angle=this.initialAngle,this.scale=1}};t([f()],Xo.prototype,"angle",void 0),t([f()],Xo.prototype,"initialAngle",void 0),t([f()],Xo.prototype,"previousAngle",void 0),t([f()],Xo.prototype,"previousScale",void 0),t([f()],Xo.prototype,"scale",void 0),t([f()],Xo.prototype,"state",null),Xo=t([b("InteractionState")],Xo);let Zo=class extends qt{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(_((()=>s(this._interactionState)?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),v))}get angle(){return s(this._interactionState)?this._interactionState.angle:s(this._orientationReferenceSymbolLayer)?(t=this._orientationReferenceSymbolLayer.heading,-de(t)):0;var t}get scale(){return s(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return s(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if(n(t))return null;const e=this.findLayerView(),i=this._graphicSymbol;if(n(e)||n(i)||"point-3d"!==i.type)return null;const a=e.getSymbolLayerSize(i,t);if("size"in a&&s(a.size))return a.size;const o=this.sizeAxis;return"width"in a&&s(a.width)&&(n(o)||"width"===o||"all"===o||"width-and-depth"===o)?a.width:"depth"in a&&s(t.depth)&&(n(o)||"depth"===o||"all"===o||"width-and-depth"===o)?a.depth:"height"in a&&s(t.height)&&(n(o)||"height"===o||"all"===o)?a.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return n(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return n(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&s(t.heading)))}get _graphicSymbol(){return s(this.graphic)&&s(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(s(this._interactionState)||n(t)||n(e))return Yo;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),a=t.clone(),o=this.angle,r=new Bo({originalSymbol:a,angle:o,initialSizes:i});this._interactionState=r;const l=()=>this._interactionState=null;return{state:r,done:l,cancel:()=>{this._graphicSymbol=a,l()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:a}){const o=this._graphicSymbol;if(n(o)||"point-3d"!==o.type)return;const r=o.clone(),l=-ge(e-this.initialAngle);let p=!1;this._forEachObjectSymbolLayerPair(i,r,((e,i,o)=>{const n=c(e.heading,0)+l;i.heading!==n&&(i.heading=n,p=!0);const r=a[o];if(s(r)&&"width"in r){r.width=this.sizeFilter(r.width),r.height=this.sizeFilter(r.height),r.depth=this.sizeFilter(r.depth);const e=r.width*t;i.width!==e&&(i.width=e,p=!0);const a=r.depth*t;i.depth!==a&&(i.depth=a,p=!0);const o=r.height*t;i.height!==o&&(i.height=o,p=!0)}})),p&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,a)=>{const o=e.symbolLayers.getItemAt(a);"object"===t.type&&"object"===o.type&&i(t,o,a)}))}};t([f()],Zo.prototype,"angle",null),t([f()],Zo.prototype,"scale",null),t([f()],Zo.prototype,"relativeAngle",null),t([f()],Zo.prototype,"initialAngle",null),t([f()],Zo.prototype,"size",null),t([f()],Zo.prototype,"sizeAxis",void 0),t([f({constructOnly:!0})],Zo.prototype,"graphic",void 0),t([f()],Zo.prototype,"_interactionState",void 0),t([f({constructOnly:!0})],Zo.prototype,"findLayerView",void 0),t([f({constructOnly:!0})],Zo.prototype,"sizeFilter",void 0),t([f()],Zo.prototype,"_sizeReferenceSymbolLayer",null),t([f()],Zo.prototype,"_orientationReferenceSymbolLayer",null),t([f()],Zo.prototype,"_graphicSymbol",null),Zo=t([b("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Zo);const Yo={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Bo=class extends tt{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:o}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:o}}};t([f()],Bo.prototype,"originalSymbol",void 0),t([f()],Bo.prototype,"angle",void 0),t([f()],Bo.prototype,"initialAngle",void 0),t([f()],Bo.prototype,"initialSizes",void 0),t([f()],Bo.prototype,"scale",void 0),t([f()],Bo.prototype,"state",null),Bo=t([b("InteractionState")],Bo);let qo=class extends(Bt(Yt.EventedMixin(ni))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Ii,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new Li,this._tooltip=null}initialize(){const{graphic:t,view:i}=this;this.graphicState=new zt({graphic:t}),this.addHandles(d((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new Et({view:i}):l(this._tooltip)}),y)),this._moveManipulation=new po({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&ue(t),radius:po.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const a=t=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const i=this._tooltip;n(i)||("focus"===e?this._updateMoveTooltip(t):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(a(co.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(co.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(co.Z)),this._moveManipulation.elevationInfo=Y(t);const o=t.geometry;if(this._moveManipulation.createGraphicDragPipeline(((e,a,n,r,l)=>(s(o)&&e===co.XY&&(n=n.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Ri({elevationInfo:Y(t),pointer:l,editGeometryOperations:xi.fromGeometry(new ta({spatialReference:o.spatialReference}),i.state.viewingMode),visualizer:new Dt,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:r,useZ:!1}),this._snappingPipeline.next)),n.next((t=>(this._updateMoveTooltip(e,t),t))))),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:o}=t,s={graphic:i,dxScreen:a,dyScreen:o};switch(e){case"start":this.emit("graphic-translate-start",s),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this._moveManipulation.angle=s(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(d((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Co({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([Ba({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>e()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),d((()=>i.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof ee&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=l(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=l(this._scaleRotate),this._scaleRotateAdapter=l(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){n(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return s(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Fo({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Zo({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:s(this.tooltipOptions.visualVariables)&&s(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),s(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return d((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&ue(this.graphic)}))}_createGeometryUndoRecord(){return No(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,s(this._scaleRotate)&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,s(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){s(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(n(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t}_updateMoveAngle(){this.view.state.viewingMode===ea.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){se(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if(n(a))return;a.clear();const o=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case co.XY:a.info=new Pi({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>xt(t,e,o)));break;case co.XY_AXIS:a.info=new Ci({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=xt(t,i,o);return Wt(a,eo(e))}));break;case co.Z:a.info=new Vi({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,Hi)}}_updateMoveTooltipDistance(t,e,i){if(s(e)&&"end"!==e.action){const{mapStart:a,mapEnd:o}=e,n=i(a,o);t.distance=s(n)?n:Qt}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:s(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],qo.prototype,"view",void 0),t([f({constructOnly:!0,nonNullable:!0})],qo.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],qo.prototype,"enableZ",void 0),t([f()],qo.prototype,"enableRotation",void 0),t([f()],qo.prototype,"enableScaling",void 0),t([f({constructOnly:!0,type:Ii})],qo.prototype,"tooltipOptions",void 0),t([f()],qo.prototype,"graphicState",void 0),t([f({value:!1})],qo.prototype,"snapToScene",null),t([f({constructOnly:!0})],qo.prototype,"snappingManager",void 0),t([f({readOnly:!0})],qo.prototype,"type",void 0),t([f({readOnly:!0})],qo.prototype,"updating",null),qo=t([b("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],qo);class Wo{constructor(){this._lastDragEvent=null,this.next=new oi,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&s(this._lastDragEvent)){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=ha(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}function Qo(t,e){return Ko(t,e,!1)}function Jo(t,e){return Ko(t,e,!0)}function Ko(t,e,i){if(t instanceof ji){if(t.operation instanceof Ti)return function(t,e,i=!1){const a=i?-1:1,o=j(a*t.dx,a*t.dy,a*t.dz);w(e.origin,e.origin,o)}(t.operation,e,i),!0;if(t.operation instanceof Ai)return function(t,e,i=!1){const a=i?-t.angle:t.angle;U(e.basis1,e.basis1,H,a),U(e.basis2,e.basis2,H,a)}(t.operation,e,i),!0;if(t.operation instanceof Di)return function(t,e,i=!1){const a=i?1/t.factor1:t.factor1,o=i?1/t.factor2:t.factor2;O(e.basis1,e.basis1,a),O(e.basis2,e.basis2,o),dt(e.origin,e.origin,t.origin,t.axis1,a),dt(e.origin,e.origin,t.origin,t.axis2,o)}(t.operation,e,i),!0}return!1}function $o(t,e,i,a){const o=Ue.get();A(o,A(o,t.origin,t.basis1),t.basis2);const s=Ue.get();k(s,o,t.basis1,2);const r=Ue.get();k(r,s,t.basis2,2);const l=Ue.get();k(l,o,t.basis2,2),o[2]=s[2]=r[2]=l[2]=e;const p=a?"on-the-ground":"absolute-height",h=$t(Tt(o,s,i,p),Tt(l,r,i,p)),c=$t(Tt(s,r,i,p),Tt(o,l,i,p));return n(c)||n(h)?null:[h,c]}let ts=class extends(Yt.EventedMixin(ni)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Ii,this._preserveAspectRatio=new Wo,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new Ee,this._moveZManipulator=null,this._resizeManipulators=null,this._rotateManipulator=null,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=ra(),this._mapBoundsStart=ra(),this._zmax=0,this._sizeStart=null,this._displayBounds=ra(),this._displayBoundsStart=ra(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=vt(),this._endScale=vt()}initialize(){const{view:t,graphic:i,manipulators:a,_handles:o}=this,n=this._graphicState=new zt({graphic:i}),r=i.geometry;this._editGeometryOperations=xi.fromGeometry(r,t.state.viewingMode),this._graphicMoveManipulation=new uo({tool:this,view:t,graphicState:n}),this._moveZManipulator=ca(t,ua.CENTER_ON_CALLOUT),this._moveZManipulator.state|=da,o.add([this._createMoveXYGraphicDragPipeline(),d((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,Ua.TRANSLATE_Z))),this._createMoveZDragPipeline()]),a.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=ma(t,e);return o.add([d((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,Ua.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),a.addMany(this._resizeManipulators),this._rotateManipulatorTexture=xa(t.toolViewManager.textures),this._rotateManipulator=re(t,{texture:this._rotateManipulatorTexture.texture}),o.add([d((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,Ua.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),a.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const l=Ba({view:t,graphic:i,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>e()});s(l)&&(this._outlineVisualElement=l.visualElement instanceof Pt?l.visualElement:null),s(this._outlineVisualElement)&&o.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),o.add(l),o.add([n.on("changed",(()=>this._onGeometryChanged())),d((()=>n.displaying),(()=>this._updateAllManipulatorAvailability())),d((()=>n.isDraped),(()=>this._graphicDrapedChanged()),g),t.trackGraphicState(n)]);const p=t.pointsOfInterest;p&&o.add(d((()=>p.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds()))),this._forEachManipulator((t=>{o.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((t,e)=>{o.add(t.events.on("immediate-click",(t=>{e===Ua.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:i}),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new Et({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{lt(this._startScale,t.xScale,t.yScale),lt(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{lt(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{lt(this._startScale,0,0),lt(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=c(this._moveXYTooltipInfo,(()=>new Pi({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo=c(this._moveZTooltipInfo,(()=>new Vi({tooltipOptions:this.tooltipOptions}))),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=Fi(e,i,this.view.spatialReference);if(n(a))return null;t.distance=a}else t.distance=Jt(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo=c(this._rotateTooltipInfo,(()=>new wa({tooltipOptions:this.tooltipOptions})));return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if(n(t))return null;const e=this._scaleTooltipInfo=c(this._scaleTooltipInfo,(()=>new Oa({tooltipOptions:this.tooltipOptions}))),i=$o(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return n(i)?null:(e.xSize=i[0],e.ySize=i[1],s(this._sizeStart)&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(es),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{s(this._attachmentOrigin)&&Se(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),es)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof ee){const a=this._graphicState.displaying,o=this.enableZ&&ue(this.graphic);switch(e){case Ua.ROTATE:t.available=a&&this.enableRotation;break;case Ua.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||o),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?ga:_a;break;case Ua.TRANSLATE_Z:t.available=a&&o;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,Ua.SCALE))),t(this._rotateManipulator,Ua.ROTATE),t(this._moveZManipulator,Ua.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return c(nt(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=yt(Fe.get(),i.leftVertex.pos,i.rightVertex.pos);pt(a,a);const o=c(ae(this.view,this.graphic),(()=>t.extent.center));let s=as*this.view.pixelSizeAt(o);const n=this.view.spatialReference,r=t.spatialReference;n.equals(r)||(s*=st(n)/st(r)),function(t,e,i,a){a||(a=ra());const o=lt(Fe.get(),t[1],-t[0]),s=lt(Fe.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=lt(Fe.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),r=Fe.get();e.components.forEach((e=>e.vertices.forEach((e=>{const i=e.pos;lt(r,mt(t,i),mt(o,i)),gt(s,s,r),_t(n,n,r)}))));const l=1e-6,p=lt(Fe.get(),n[0]-s[0]<l?i/2:0,n[1]-s[1]<l?i/2:0);yt(s,s,p),ut(n,n,p),ht(a.basis1,t,(n[0]-s[0])/2),ht(a.basis2,o,(n[1]-s[1])/2),lt(a.origin,s[0]*t[0]+s[1]*o[0],s[0]*t[1]+s[1]*o[1]),ut(a.origin,a.origin,a.basis1),ut(a.origin,a.origin,a.basis2)}(a,e,s,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos);i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const t=this.graphic.geometry;if(n(t))return;const e=s(this._outlineVisualElement)&&!this._graphicState.isDraped&&s(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:ae(this.view,this.graphic);this._attachmentOrigin=c(e,t.extent.center);const i=s(e)?e.z:Vt(this._mapBounds.origin,this.view.elevationProvider,Ct.fromElevationInfo(Y(this.graphic)),this.view.renderCoordsHelper),a=pa(this._mapBounds);a.origin[2]=i,function(t,e,i,a=0,o){o||(o=ra()),e.toRenderCoords(t.origin,i,o.origin);const s=Ue.get();w(s,t.origin,t.basis1),w(s,s,t.basis2),e.toRenderCoords(s,i,s);const n=Ue.get();w(n,t.origin,t.basis1),A(n,n,t.basis2),e.toRenderCoords(n,i,n);const r=Ue.get();A(r,t.origin,t.basis1),A(r,r,t.basis2),e.toRenderCoords(r,i,r);const l=Ue.get();A(l,t.origin,t.basis1),w(l,l,t.basis2),e.toRenderCoords(l,i,l);const p=V(Ue.get(),s,n,.5);A(p,p,o.origin);const h=V(Ue.get(),r,l,.5);A(h,o.origin,h),V(o.basis1,p,h,.5);const c=V(Ue.get(),l,s,.5);A(c,c,o.origin);const u=V(Ue.get(),n,r,.5);A(u,o.origin,u),V(o.basis2,c,u,.5);const d=I(Ue.get(),o.basis1,o.basis2),m=I(d,d,o.basis1);D(m,m),O(o.basis2,m,G(o.basis2,m)),O(o.basis1,o.basis1,1+a/P(o.basis1)),O(o.basis2,o.basis2,1+a/P(o.basis2)),la(o)}(a,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent.center;return is*this.view.pixelSizeAt(e)}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,co.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return ti(this._moveZManipulator,((i,a,o)=>{const s=C(i.renderLocation),n=a.next(Ye(t,s,e)).next(ai());this._applyGraphicMoveSteps(n,o,co.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next(si()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||t.mapEnd.z-t.mapStart.z)&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{s(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){pa(this._displayBounds,this._displayBoundsStart),pa(this._mapBounds,this._mapBoundsStart),n(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=$o(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return t=>{if(n(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const t of this._editGeometryOperations.data.components)e.push(...t.vertices);const i="start"===t.action?Oi.NEW_STEP:Oi.ACCUMULATE_STEPS;return Qo(this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===co.XY||e===co.XY_AXIS){const e=xt(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");s(e)&&s(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab(t){if("start"!==t.action)return;const e=this._calculatePickRay(t.screenPoint);Wi(this._displayBounds.plane,e,Ue.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return ti(t,((t,i,a)=>{n(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(Je(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{s(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,o=this._displayBoundsMarginStart,s=N(Ue.get(),e.origin);k(s,s,e.basis1,-i[0]),k(s,s,e.basis2,-i[1]);const n=A(Ue.get(),t.renderEnd,s),r=A(Ue.get(),t.renderStart,s),l=ha(t.handle),p=ya(e),h=ya(this._displayBounds)/p,c=(t,e)=>{if(0===t)return 1;let i=P(e),s=.5*t*G(e,n)/i;const p=s<0?-1:1;l&&(s+=(i-.5*t*G(e,r)/i)*p*h);const c=i<1.5*o?1:os;return i=Math.max(i-o,os),p>0&&(s-=a),p*Math.max(p*(s/i),c)};return{...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=N(x(),this._mapBoundsStart.origin);k(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),k(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=lt(vt(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);pt(i,i);const a=[];for(const t of this._editGeometryOperations.data.components)a.push(...t.vertices);const o="start"===t.action?Oi.NEW_STEP:Oi.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,o,Gi.REPLACE);return pa(this._mapBoundsStart,this._mapBounds),Qo(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab(t){if("start"!==t.action)return;const e=va(this._displayBounds,this.view.renderCoordsHelper,fa.HEADING,Bi()),i=this._calculatePickRay(t.screenPoint);Wi(e,i,Ue.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:e})}_createRotateDragPipeline(t){return ti(t,((t,e,i)=>{const a=this.inputState;n(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(Je(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:ge(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{s(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=Zi(t.rotatePlane),a=ne(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=N(x(),this._mapBoundsStart.origin),i=[];for(const t of this._editGeometryOperations.data.components)i.push(...t.vertices);const a="start"===t.action?Oi.NEW_STEP:Oi.ACCUMULATE_STEPS,o=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,Gi.REPLACE);return pa(this._mapBoundsStart,this._mapBounds),Qo(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=Xe(),i=K(t);return Ea(this.view.state.camera,i,e),D(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=Ma(this._displayBounds,ke.get());ba(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{Sa(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:A(Ue.get(),i.origin,i.basis1),edge:2},o=ke.get();Pe(o,e,a.edge*Math.PI/2),o[12]=0,o[13]=0,o[14]=0,t.modelTransform=o,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;n(t)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Jo(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(s(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Jo(p(t),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Qo(p(t),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};t([f({constructOnly:!0,nonNullable:!0})],ts.prototype,"view",void 0),t([f({constructOnly:!0,nonNullable:!0})],ts.prototype,"graphic",void 0),t([f({constructOnly:!0,nonNullable:!0})],ts.prototype,"enableZ",void 0),t([f()],ts.prototype,"enableRotation",void 0),t([f()],ts.prototype,"enableScaling",void 0),t([f({constructOnly:!0,type:Ii})],ts.prototype,"tooltipOptions",void 0),t([f()],ts.prototype,"preserveAspectRatio",null),t([f()],ts.prototype,"grabbing",void 0),t([f()],ts.prototype,"inputState",void 0),t([f({readOnly:!0})],ts.prototype,"type",void 0),t([f()],ts.prototype,"_moveUnit",null),ts=t([b("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],ts);const es="draped-elevation-changes",is=10,as=80,os=1e-6;export{Pa as DrawGraphicTool3D,ts as ExtentTransformTool,yo as GraphicMoveTool,Go as GraphicReshapeTool,qo as GraphicTransformTool};
