/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import e from"../core/Accessor.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./ensureType.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import{e as n,i as o,a,g as r,d as l}from"./maybe.js";import{watch as c,syncAndInitial as p}from"../core/reactiveUtils.js";import"./Logger.js";import"../core/Error.js";import"./object.js";import"../intl.js";import{e as h,g as v,h as u,i as d,j as m,k as f,l as g}from"./quantityFormatUtils.js";import{n as _}from"./unitUtils.js";import b from"../widgets/Widget.js";import{i as y}from"./widgetUtils.js";import{m as w}from"./messageBundle.js";import{a as T}from"./number.js";import{t as x}from"./jsxFactory.js";import{b as L,c as $,d as j,f as z,e as C}from"./euclideanLengthMeasurementUtils.js";import{c as E}from"./quantityUtils.js";import{d as O}from"./vec3.js";import{geodesicLength as k}from"../geometry/geometryEngine.js";import{projectVectorToWGS84ComparableLonLat as R,projectPolylineToWGS84ComparableLonLat as S}from"../geometry/projection.js";import{isSupported as U,InverseGeodeticSolverResult as P,inverseGeodeticSolver as V,geodesicLengths as W}from"../geometry/support/geodesicUtils.js";import{l as A,i as D,e as F}from"../geometry/SpatialReference.js";let Z=class extends e{constructor(t){super(t)}};t([i()],Z.prototype,"tooltipOptions",void 0),Z=t([s("esri.views.interactive.tooltip.SketchTooltipInfo")],Z);const M="esri-tooltip",G=`${M}-content`;let q=class extends b{get _units(){const t=_(this.tooltip.view);return{length:t,verticalLength:t,area:t}}_formatScale(t){return T(t,{style:"percent",maximumFractionDigits:0})}_formatRelativeOrientation(t){return T(t,{maximumFractionDigits:2,minimumFractionDigits:2,signDisplay:"exceptZero"})}_formatLength(t,e,i){return h(this._messagesUnits,t,n(e,this._units.length),i)}_formatRelativeLength(t){return v(this._messagesUnits,t,this._units.length)}_formatVerticalLength(t){return u(this._messagesUnits,t,this._units.verticalLength)}_formatRelativeVerticalLength(t){return d(this._messagesUnits,t,this._units.verticalLength)}_formatTotalLength(t){return h(this._messagesUnits,t,this._units.length)}_formatArea(t){return m(this._messagesUnits,t,this._units.area)}_formatPercentage(t){return T(t.value,{style:"percent"})}};t([i()],q.prototype,"info",void 0),t([i()],q.prototype,"tooltip",void 0),t([i()],q.prototype,"_units",null),t([w("esri/core/t9n/Units"),i()],q.prototype,"_messagesUnits",void 0),t([w("esri/views/interactive/tooltip/t9n/Tooltip"),i()],q.prototype,"_messagesTooltip",void 0),q=t([s("esri.views.interactive.tooltip.content.TooltipContent")],q);const B=`${M}-field`,X={base:B,title:`${B}__title`,value:`${B}__value`};let Y=class extends b{render(){return x("div",{class:X.base},x("div",{class:X.title},this.title),x("div",{class:X.value},this.value))}};t([i()],Y.prototype,"title",void 0),t([i()],Y.prototype,"value",void 0),Y=t([s("esri.views.interactive.tooltip.support.TooltipField")],Y);const H={base:`${M}-value-by-value`};let I=class extends b{constructor(){super(...arguments),this.divider="Ã—"}render(){return x("div",{class:H.base},x("span",null,this.left),x("span",null,this.divider),x("span",null,this.right))}};t([i()],I.prototype,"left",void 0),t([i()],I.prototype,"divider",void 0),t([i()],I.prototype,"right",void 0),I=t([s("esri.views.interactive.tooltip.support.ValueByValue")],I);const N={base:`${G} ${G}--draw-rectangle`};let J=class extends q{render(){const{area:t,radius:e,xSize:i,ySize:s,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return x("div",{class:N.base},a.radius&&o(e)&&x(Y,{title:r.radius,value:this._formatLength(e)}),a.size&&o(i)&&o(s)&&x(Y,{title:r.size,value:x(I,{left:this._formatLength(i),right:this._formatLength(s)})}),a.area&&x(Y,{title:r.area,value:this._formatArea(t)}))}};J=t([s("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],J);const K={base:`${G} ${G}--draw-point`};let Q=class extends q{render(){const{elevation:t,tooltipOptions:e}=this.info,{visibleElements:i}=e,s=this._messagesTooltip.sketch;return x("div",{class:K.base},i.elevation&&x(Y,{title:s.elevation,value:this._formatVerticalLength(t)}))}};Q=t([s("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],Q);const tt={base:`${G} ${G}--draw-polygon`};let et=class extends q{render(){const{area:t,elevation:e,tooltipOptions:i,viewType:s}=this.info,{visibleElements:n}=i,o=this._messagesTooltip.sketch;return x("div",{class:tt.base},n.elevation&&"2d"!==s&&x(Y,{title:o.elevation,value:this._formatVerticalLength(e)}),n.area&&x(Y,{title:o.area,value:this._formatArea(t)}))}};et=t([s("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],et);const it={base:`${G} ${G}--draw-polyline`};let st=class extends q{render(){const{elevation:t,totalLength:e,tooltipOptions:i,viewType:s}=this.info,{visibleElements:n}=i,o=this._messagesTooltip.sketch;return x("div",{class:it.base},n.elevation&&"2d"!==s&&x(Y,{title:o.elevation,value:this._formatVerticalLength(t)}),n.totalLength&&x(Y,{title:o.totalLength,value:this._formatLength(e)}))}};st=t([s("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],st);const nt={base:`${G} ${G}--draw-rectangle`};let ot=class extends q{render(){const{area:t,xSize:e,ySize:i,tooltipOptions:s}=this.info,{visibleElements:n}=s,a=this._messagesTooltip.sketch;return x("div",{class:nt.base},n.size&&o(e)&&o(i)&&x(Y,{title:a.size,value:x(I,{left:this._formatLength(e),right:this._formatLength(i)})}),n.area&&x(Y,{title:a.area,value:this._formatArea(t)}))}};ot=t([s("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],ot);const at={base:`${G} ${G}--extent-rotate`};let rt=class extends q{render(){const{angle:t,tooltipOptions:e}=this.info,{visibleElements:i}=e,s=this._messagesTooltip.sketch;return x("div",{class:at.base},i.rotation&&x(Y,{title:s.rotation,value:this._formatRelativeOrientation(t)}))}};rt=t([s("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],rt);const lt={base:`${G} ${G}--extent-scale`};let ct=class extends q{render(){const t=this.info,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:lt.base},e.size&&x(Y,{title:i.size,value:x(I,{left:this._formatLength(t.xSize),right:this._formatLength(t.ySize)})}),e.scale&&x(Y,{title:i.scale,value:x(I,{left:this._formatScale(t.xScale),right:this._formatScale(t.yScale)})}))}};ct=t([s("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],ct);const pt={base:`${G} ${G}--reshape-edge-offset`};let ht=class extends q{render(){const{area:t,distance:e,totalLength:i,tooltipOptions:s}=this.info,{visibleElements:n}=s,a=this._messagesTooltip.sketch;return x("div",{class:pt.base},n.distance&&x(Y,{title:a.distance,value:this._formatRelativeLength(e)}),n.area&&o(t)&&x(Y,{title:a.area,value:this._formatArea(t)}),n.totalLength&&o(i)&&x(Y,{title:a.totalLength,value:this._formatLength(i)}))}};ht=t([s("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ht);const vt={base:`${G} ${G}--transform-absolute`};let ut=class extends q{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:vt.base},e.orientation&&t.orientationEnabled&&x(Y,{title:i.orientation,value:f(t.orientation,t.rotationType,t.orientationPrecision)}),e.size&&t.sizeEnabled&&x(Y,{title:i.size,value:this._formatLength(t.size,t.sizeUnit,t.sizePrecision)}))}};ut=t([s("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],ut);const dt={base:`${G} ${G}--transform-rotate`};let mt=class extends q{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:dt.base},e.rotation&&x(Y,{title:i.rotation,value:g(t.rotation,t.rotationType,t.rotationPrecision)}),e.orientation&&x(Y,{title:i.orientation,value:f(t.orientation,t.rotationType,t.orientationPrecision)}))}};mt=t([s("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],mt);const ft={base:`${G} ${G}--transform-scale`};let gt=class extends q{render(){const{scale:t,size:e,sizePrecision:i,sizeUnit:s,tooltipOptions:n}=this.info,{visibleElements:o}=n,a=this._messagesTooltip.sketch;return x("div",{class:ft.base},o.scale&&x(Y,{title:a.scale,value:this._formatPercentage(t)}),o.size&&x(Y,{title:a.size,value:this._formatLength(e,s,i)}))}};gt=t([s("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],gt);const _t={base:`${G} ${G}--translate-graphic`};let bt=class extends q{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:_t.base},e.distance&&x(Y,{title:i.distance,value:this._formatLength(t.distance)}))}};bt=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphic")],bt);const yt={base:`${G} ${G}--translate-graphic-xy`};let wt=class extends q{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:yt.base},e.distance&&x(Y,{title:i.distance,value:this._formatRelativeLength(t.distance)}))}};wt=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicXY")],wt);const Tt={base:`${G} ${G}--translate-graphic-z`};let xt=class extends q{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,i=this._messagesTooltip.sketch;return x("div",{class:Tt.base},e.distance&&x(Y,{title:i.distance,value:this._formatRelativeVerticalLength(t.distance)}))}};xt=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicZ")],xt);const Lt={base:`${G} ${G}--translate-vertex`};let $t=class extends q{render(){const{distance:t,elevation:e,area:i,totalLength:s,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return x("div",{class:Lt.base},a.distance&&x(Y,{title:r.distance,value:this._formatLength(t)}),a.elevation&&o(e)&&x(Y,{title:r.elevation,value:this._formatVerticalLength(e)}),a.area&&o(i)&&x(Y,{title:r.area,value:this._formatArea(i)}),a.totalLength&&o(s)&&x(Y,{title:r.totalLength,value:this._formatLength(s)}))}};$t=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],$t);const jt={base:`${G} ${G}--translate-vertex`};let zt=class extends q{render(){const{area:t,distance:e,elevation:i,totalLength:s,tooltipOptions:n}=this.info,{visibleElements:a}=n,r=this._messagesTooltip.sketch;return x("div",{class:jt.base},a.distance&&x(Y,{title:r.distance,value:this._formatRelativeLength(e)}),a.elevation&&o(i)&&x(Y,{title:r.elevation,value:this._formatVerticalLength(i)}),a.area&&o(t)&&x(Y,{title:r.area,value:this._formatArea(t)}),a.totalLength&&o(s)&&x(Y,{title:r.totalLength,value:this._formatLength(s)}))}};zt=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexXY")],zt);const Ct={base:`${G} ${G}--translate-vertex`};let Et=class extends q{render(){const{distance:t,elevation:e,tooltipOptions:i}=this.info,{visibleElements:s}=i,n=this._messagesTooltip.sketch;return x("div",{class:Ct.base},s.distance&&x(Y,{title:n.distance,value:this._formatRelativeVerticalLength(t)}),s.elevation&&o(e)&&x(Y,{title:n.elevation,value:this._formatVerticalLength(e)}))}};Et=t([s("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexZ")],Et);const Ot={base:`${M}`};let kt=class extends e{constructor(t){super(t),this.info=null,this._contentContainer=(()=>{const t=document.createElement("div");return t.classList.add(Ot.base),t})(),this._contentWidget=null}initialize(){const t=this._contentContainer;this.addHandles([c((()=>this.view.overlay?.surface),(e=>{t.remove(),r(e,(e=>e.appendChild(t)))}),p),c((()=>this.info),((e,i)=>{o(this._contentWidget)&&o(e)&&o(i)&&e.type===i.type?this._contentWidget.info=e:(this._contentWidget=l(this._contentWidget),r(function(t,e){if(a(e))return null;const i=document.createElement("div");switch(e.type){case"draw-point":return new Q({tooltip:t,info:e,container:i});case"draw-polygon":return new et({tooltip:t,info:e,container:i});case"draw-polyline":return new st({tooltip:t,info:e,container:i});case"draw-rectangle":return new ot({tooltip:t,info:e,container:i});case"draw-circle":return new J({tooltip:t,info:e,container:i});case"extent-rotate":return new rt({tooltip:t,info:e,container:i});case"extent-scale":return new ct({tooltip:t,info:e,container:i});case"transform-absolute":return new ut({tooltip:t,info:e,container:i});case"transform-rotate":return new mt({tooltip:t,info:e,container:i});case"transform-scale":return new gt({tooltip:t,info:e,container:i});case"translate-graphic":return new bt({tooltip:t,info:e,container:i});case"translate-graphic-z":return new xt({tooltip:t,info:e,container:i});case"translate-graphic-xy":return new wt({tooltip:t,info:e,container:i});case"translate-vertex":return new $t({tooltip:t,info:e,container:i});case"translate-vertex-z":return new Et({tooltip:t,info:e,container:i});case"translate-vertex-xy":return new zt({tooltip:t,info:e,container:i});case"reshape-edge-offset":return new ht({tooltip:t,info:e,container:i})}}(this,e),(e=>{this._contentWidget=e,e.container&&t.appendChild(e.container)})))}),p),c((()=>({container:this._contentContainer,contentWidget:this._contentWidget,screenPoint:this._screenPoint})),Rt,p)])}destroy(){this._contentWidget=l(this._contentWidget),this._contentContainer.remove()}clear(){this.info=null}get _screenPoint(){const t=this.view.inputManager;return t?.multiTouchActive?null:t?.latestPointerLocation}get test(){return{contentContainer:this._contentContainer,visible:"none"!==this._contentContainer?.style.display}}};function Rt({container:t,contentWidget:e,screenPoint:i}){const{style:s}=t;if(o(i)&&o(e)){s.display="block";const e=y(t),n=`translate(${Math.round(i.x)+St[0]*(e?-1:1)}px, ${Math.round(i.y)+St[1]}px)`;s.transform=e?`translate(-100%, 0) ${n}`:n}else s.display="none"}t([i({nonNullable:!0})],kt.prototype,"view",void 0),t([i()],kt.prototype,"info",void 0),t([i()],kt.prototype,"_contentContainer",void 0),t([i()],kt.prototype,"_contentWidget",void 0),t([i()],kt.prototype,"_screenPoint",null),kt=t([s("esri.views.interactive.tooltip.Tooltip")],kt);const St=[20,20];function Ut(t,e,i,s,...n){return A(t)&&U(t)?e.apply(void 0,n):D(t)?i.apply(void 0,n):s.apply(void 0,n)}function Pt(t){const{spatialReference:e}=t;return Ut(e,Zt,Mt,Gt,t)}function Vt(t,e){if(!F(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return Bt[0]=t.x,Bt[1]=t.y,Bt[2]=t.hasZ?t.z:0,Xt[0]=e.x,Xt[1]=e.y,Xt[2]=e.hasZ?e.z:0,Wt(Bt,Xt,i)}function Wt(t,e,i){return Ut(i,At,Dt,Ft,t,e,i)}function At(t,e,i){return E(V(qt,t,e,i).distance,"meters")}function Dt(t,e,i){return E(k(function(t,e,i){return{type:"polyline",spatialReference:i,paths:[[[...t],[...e]]]}}(t,e,i),"meters"),"meters")}function Ft(t,e,i){return R(t,i,Yt)&&R(e,i,Ht)?E(V(qt,Yt,Ht).distance,"meters"):null}function Zt(t){return E(W([t],"meters")[0],"meters")}function Mt(t){return E(k(t,"meters"),"meters")}function Gt(t){const e=[];if(!S(t,e))return null;let i=0;for(const t of e){let e=0;for(let i=1;i<t.length;++i)e+=V(qt,t[i-1],t[i]).distance;i+=e}return E(i,"meters")}const qt=new P,Bt=O(),Xt=O(),Yt=O(),Ht=O();function It(t,e){return ee($,Pt,L,e,t)}function Nt(t,e,i,s){return ee(C,Wt,z,s,t,e,i)}function Jt(t,e,i){return ee(j,Vt,j,i,t,e)}function Kt(t,e,i,s){return ee(z,Wt,z,s,t,e,i)}function Qt(t){return ee($,Pt,L,"on-the-ground",t)}function te(t,e){return ee(j,Vt,j,"on-the-ground",t,e)}function ee(t,e,i,s,...n){if("on-the-ground"===s){const t=e.apply(void 0,n);return o(t)?t:i.apply(void 0,n)}return t.apply(void 0,n)}export{Z as S,kt as T,It as a,Jt as b,Nt as c,Wt as d,Kt as e,te as f,Ut as g,Qt as h};
