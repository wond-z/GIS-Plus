/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{a as t,i as a,e}from"./maybe.js";import{o as r}from"../core/lang.js";import{o}from"./vec2.js";import{s as n,d as s}from"./vec3.js";import{O as i}from"./vec4f64.js";import{lonLatToWebMercatorComparable as u}from"../geometry/projection.js";import{g as c}from"./projectionEllipsoid.js";import{V as l}from"./ViewingMode.js";import{P as f}from"./basicInterfaces.js";import{d as p}from"./bufferWriterUtils.js";import{V as E}from"./VertexAttribute.js";function T(s,T=null){const h=[],O=[];!function(t,a,e){const{attributeData:{position:o},removeDuplicateStartEnd:n}=t,s=function(t){const a=t.length;return t[0]===t[a-3]&&t[1]===t[a-2]&&t[2]===t[a-1]}(o)&&n,i=o.length/3-(s?1:0),u=new Array(2*(i-1)),c=s?r(o,0,o.length-3):o;let l=0;for(let t=0;t<i-1;t++)u[l++]=t,u[l++]=t+1;a.push([E.POSITION,{size:3,data:c,exclusive:s}]),e.push([E.POSITION,u])}(s,O,h);const I=O[0][1].data,R=h[0][1].length,d=new Array(R).fill(0);return function(a,e,r){const o=a.attributeData.mapPosition;t(o)||(r.push([E.MAPPOS,r[0][1]]),e.push([E.MAPPOS,{size:3,data:o}]))}(s,O,h),function(t,r,o,n){if(a(t.attributeData.colorFeature))return;const s=t.attributeData.color;r.push([E.COLOR,{size:4,data:e(s,i)}]),o.push([E.COLOR,n])}(s,O,h,d),function(t,r,o,n){if(a(t.attributeData.sizeFeature))return;const s=t.attributeData.size;r.push([E.SIZE,{size:1,data:[e(s,1)]}]),o.push([E.SIZE,n])}(s,O,h,d),function(t,e,r,o){if(!a(t.attributeData.normal))return;const n=t.attributeData.normal;e.push([E.NORMAL,{size:3,data:n}]),r.push([E.NORMAL,o])}(s,O,h,d),function(a,e,r,o){const n=a.attributeData.colorFeature;t(n)||(e.push([E.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([E.COLOR,o]))}(s,O,h,d),function(a,e,r,o){const n=a.attributeData.sizeFeature;t(n)||(e.push([E.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([E.SIZEFEATUREATTRIBUTE,o]))}(s,O,h,d),function(a,e,r,o){const n=a.attributeData.opacityFeature;t(n)||(e.push([E.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([E.OPACITYFEATUREATTRIBUTE,o]))}(s,O,h,d),function(a,e,r,s){if(t(a.overlayInfo)||a.overlayInfo.renderCoordsHelper.viewingMode!==l.Global||!a.overlayInfo.spatialReference.isGeographic)return;const i=new Float64Array(s.length),f=c(a.overlayInfo.spatialReference);for(let t=0;t<i.length;t+=3)u(s,t,i,t,f);const p=s.length/3,T=new Float32Array(p+1);let h=m,O=A,I=0,R=0;n(h,i[R++],i[R++],i[R++]),T[0]=0;for(let t=1;t<p+1;++t)t===p&&(R=0),n(O,i[R++],i[R++],i[R++]),I+=o(h,O),T[t]=I,[h,O]=[O,h];e.push([E.DISTANCETOSTART,{size:1,data:T}]),r.push([E.DISTANCETOSTART,r[0][1]])}(s,O,h,I),new p(O,h,f.Line,T)}var h;!function(t){t[t.KEEP=0]="KEEP",t[t.REMOVE=1]="REMOVE"}(h||(h={}));const m=s(),A=s();function O(a,e){if(t(a)||0===a.length)return[];const r=[];return a.forEach((t=>{const a=t.length,o=new Float64Array(3*a);t.forEach(((t,a)=>{o[3*a+0]=t[0],o[3*a+1]=t[1],o[3*a+2]=t[2]}));const n={attributeData:{position:o,normal:e},removeDuplicateStartEnd:!1};r.push(n)})),r}export{T as c,O as l};
