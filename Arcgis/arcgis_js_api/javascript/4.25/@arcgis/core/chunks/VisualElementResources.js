/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{i as e,a as s}from"./maybe.js";import{watch as r,initial as t}from"../core/reactiveUtils.js";import{U as o}from"./basicInterfaces.js";import{b as c}from"./Material.js";import{W as i,O as a}from"./DefaultBufferWriter.js";import{l as h}from"./bufferWriterUtils.js";class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return e(this._resources)?this._resources.object:null}get resources(){return e(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(s(this._resources)||!e)return;const r=this._resources.object;this._resources.external.forEach((s=>{s.type===c.Geometry&&e.remove(s)})),r.removeAllGeometries();const t=this._resourceFactory.recreateGeometry(this._resources.external,r,this._resources.layer);e.addMany(t)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,s=e.view,c=s._stage;if(!c)return;const u=new i({isPickable:!1,updatePolicy:o.SYNC});c.add(u);const _=new a({castShadow:!1}),l=e.createResources(_,u);l.forEach((e=>{c.add(e),e instanceof h&&c.loadImmediate(e)})),c.add(_),u.add(_);const n=e.cameraChanged?r((()=>s.state.camera),(s=>e.cameraChanged(s)),t):null;this._resources={layer:u,object:_,external:l,cameraHandle:n},this._syncVisible()}_destroyResources(){if(s(this._resources))return;const e=this._resourceFactory.view._stage;e?.remove(this._resources.object),e?.remove(this._resources.layer),this._resources.external.forEach((s=>{e?.remove(s),"dispose"in s&&s.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){s(this._resources)||this._resources.object.setVisible(this._visible)}}export{u as V};
