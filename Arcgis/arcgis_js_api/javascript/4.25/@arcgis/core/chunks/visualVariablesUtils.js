/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{a as e}from"./maybe.js";import{t as s,a as t}from"./screenUtils.js";import{p as n}from"./Utils18.js";import{N as o}from"./definitions.js";import{c as i}from"./enums4.js";import{g as l}from"./visualVariablesUtils2.js";const a=8388607,r=0,u=1,c=e=>(8388608&e)>>>23,p=e=>8388607&e,f=e=>1===c(e)?254:255;function m(e){return 1===c(e)}function v(e,s){return((s?8388608:0)|e)>>>0}const y=(e,s)=>e&&((...e)=>s.warn("DEBUG:",...e))||(()=>null),d=!1;function h(e,s){if(!e||!s)return e;switch(s){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function z(e){return e.map((e=>function(e){return{value:e.value,size:s(e.size)}}(e)))}function g(e){if("string"==typeof e||"number"==typeof e)return s(e);const t=e;return{type:"size",expression:t.expression,stops:z(t.stops)}}const S=e=>{const s=[],n=[],i=z(e),l=i.length;for(let e=0;e<6;e++){const a=i[Math.min(e,l-1)];s.push(a.value),n.push(null==a.size?o:t(a.size))}return{values:new Float32Array(s),sizes:new Float32Array(n)}};function E(e){const s=e&&e.length>0?{}:null,t=s?{}:null;if(!s)return{vvFields:s,vvRanges:t};for(const n of e)if(n.field&&(s[n.type]=n.field),"size"===n.type){t.size||(t.size={});const e=n;switch(l(e)){case i.SIZE_MINMAX_VALUE:t.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:g(e.minSize),maxSize:g(e.maxSize)};break;case i.SIZE_SCALE_STOPS:t.size.scaleStops={stops:z(e.stops)};break;case i.SIZE_FIELD_STOPS:if(e.levels){const s={};for(const t in e.levels)s[t]=S(e.levels[t]);t.size.fieldStops={type:"level-dependent",levels:s}}else t.size.fieldStops={type:"static",...S(e.stops)};break;case i.SIZE_UNIT_VALUE:t.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)t.color=x(n);else if("opacity"===n.type)t.opacity=V(n);else if("rotation"===n.type){const e=n;t.rotation={type:e.rotationType}}return{vvFields:s,vvRanges:t}}function V(e){const s={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const t=e.stops;for(let e=0;e<8;++e){const n=t[Math.min(e,t.length-1)];s.values[e]=n.value,s.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)s.values[e]=1/0,s.opacities[e]=t}}return s}function b(e,s,t){e[4*s+0]=t.r/255,e[4*s+1]=t.g/255,e[4*s+2]=t.b/255,e[4*s+3]=t.a}function x(s){if(e(s))return null;if(s.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof s.field){if(!s.stops)return null;{if(s.stops.length>8)return null;t.field=s.field;const e=s.stops;for(let s=0;s<8;++s){const n=e[Math.min(s,e.length-1)];t.values[s]=n.value,b(t.colors,s,n.color)}}}else{if(!(s.stops&&s.stops.length>=0))return null;{const e=s.stops&&s.stops.length>=0&&s.stops[0].color;for(let s=0;s<8;s++)t.values[s]=1/0,b(t.colors,s,e)}}for(let e=0;e<32;e+=4)n(t.colors,e,!0);return t}export{a as D,u as a,r as b,v as c,c as d,f as e,y as f,p as g,d as h,h as i,m as j,E as k};
