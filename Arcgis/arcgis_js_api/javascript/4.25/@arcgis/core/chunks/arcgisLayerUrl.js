/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{a as e,i as r}from"./maybe.js";import{urlToObject as s,removeTrailingSlash as t,removeQueryParameters as n,Url as l,makeAbsolute as i,join as a}from"../core/urlUtils.js";import{w as u}from"./persistableUrlUtils.js";const o={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},c=Object.values(o),f=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${c.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),p=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${c.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),v=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function d(e){return!!f.test(e)}function m(r){if(e(r))return null;const t=s(r),n=t.path.match(f)||t.path.match(p);if(!n)return null;const[,l,i,a,u]=n,c=i.indexOf("/");return{title:h(-1!==c?i.slice(c+1):i),serverType:o[a.toLowerCase()],sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:l}}}function w(e){const r=s(e).path.match(v);return r?{serviceUrl:r[1],sublayerId:Number(r[2])}:null}function h(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function y(e,s){const t=[];if(e){const s=m(e);r(s)&&s.title&&t.push(s.title)}if(s){const e=h(s);t.push(e)}if(2===t.length){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")}function g(e){if(!e)return!1;const r=(e=e.toLowerCase()).includes(".arcgis.com/"),s=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return r&&s}function S(e,r){return e?t(n(e,r)):e}function b(e){let{url:l}=e;if(!l)return{url:l};l=n(l,e.logger);const i=s(l),a=m(i.path);let u;if(r(a))null!=a.sublayer&&null==e.layer.layerId&&(u=a.sublayer),l=a.url.path;else if(e.nonStandardUrlAllowed){const e=w(i.path);r(e)&&(l=e.serviceUrl,u=e.sublayerId)}return{url:t(l),layerId:u}}function C(e,r,s,t,n){u(r,t,"url",n),t.url&&null!=e.layerId&&(t.url=a(t.url,s,e.layerId.toString()))}function I(e){if(!e)return!1;const r=e.toLowerCase(),s=r.includes("/services/"),t=r.includes("/mapserver/wmsserver"),n=r.includes("/imageserver/wmsserver"),l=r.includes("/wmsserver");return s&&(t||n||l)}function L(e){if(!e)return!1;const r=new l(i(e)).authority?.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}export{b as a,d as b,h as c,I as d,L as e,w as f,g as i,m as p,S as s,y as t,C as w};
