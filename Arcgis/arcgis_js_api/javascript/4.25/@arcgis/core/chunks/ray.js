/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{e as t}from"../core/lang.js";import{n as e}from"./nextTick.js";import{q as i,k as s,c as r,b as n,d as a,h as o,n as h,m as c,a as f,g as m}from"./vec3.js";import{B as _}from"./byteSizeEstimations.js";import{a as u}from"./mat3f64.js";import{a as g}from"./mat4f64.js";import{a as l}from"./quatf64.js";import{c as P}from"./vec2f64.js";import{b as p}from"./vec4f64.js";class B{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&e((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*w);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,w));t++)this._items.push(this._allocator())}}const w=1024;class d{constructor(t,e,i){this._itemByteSize=t,this._itemCreate=e,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){0===this._itemsPtr&&e((()=>this._reset()));const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const t=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let e=0;e<this._itemsPerBuffer;++e)this._items.push(this._itemCreate(t,e*this._itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=M){return new d(16,P,t)}static createVec3f64(t=M){return new d(24,i,t)}static createVec4f64(t=M){return new d(32,p,t)}static createMat3f64(t=M){return new d(72,u,t)}static createMat4f64(t=M){return new d(128,g,t)}static createQuatf64(t=M){return new d(32,l,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const M=4*_.KILOBYTES,b=d.createVec2f64(),j=d.createVec3f64(),y=d.createVec4f64();d.createMat3f64();const z=d.createMat4f64(),S=d.createQuatf64();function V(t){return t?x(s(t.origin),s(t.direction)):x(a(),a())}function x(t,e){return{origin:t,direction:e}}function k(e,i){return t(e.origin,i.origin)&&t(e.direction,i.direction)}function v(t,e){const i=Q.get();return i.origin=t,i.direction=e,i}function A(t,e=V()){return C(t.origin,t.direction,e)}function q(t,e,i=V()){return r(i.origin,t),n(i.direction,e,t),i}function C(t,e,i=V()){return r(i.origin,t),r(i.direction,e),i}function E(t,e){const i=o(j.get(),h(j.get(),t.direction),n(j.get(),e,t.origin));return c(i,i)}function O(t,e,i){const s=c(t.direction,n(i,e,t.origin));return f(i,t.origin,m(i,t.direction,s)),i}const Q=new B((()=>V()));export{B as O,y as a,A as b,V as c,z as d,O as e,C as f,k as g,b as h,q as i,E as j,S as k,j as s,v as w};
