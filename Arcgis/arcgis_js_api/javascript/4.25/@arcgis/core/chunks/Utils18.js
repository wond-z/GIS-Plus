/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{a as e}from"./maybe.js";import{a as t}from"./number2.js";import r from"../core/Error.js";import{L as n}from"./Logger.js";import"./mathUtils.js";import{C as s,J as a}from"./enums.js";import{a as o,b as i,V as c}from"./enums4.js";import{O as u}from"./ArrayPool.js";import{U as l,a as m,D as f}from"./enums3.js";import"./Texture.js";import{V as h}from"./VertexElementDescriptor.js";function y(e,t=0,r=!1){const n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,r||(e[t+3]*=255),e}function d(e){if(!e)return 0;const{r,g:n,b:s,a}=e;return t(r*a,n*a,s*a,255*a)}function p(e){if(!e)return 0;const[r,n,s,a]=e;return t(r*(a/255),n*(a/255),s*(a/255),a)}function g(t,r,n=0){if(e(r))return t[n+0]=0,t[n+1]=0,t[n+2]=0,void(t[n+3]=0);const{r:s,g:a,b:o,a:i}=r;t[n+0]=s*i/255,t[n+1]=a*i/255,t[n+2]=o*i/255,t[n+3]=i}class S{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,r,n,s,a,o,i,c){this.color=e,this.haloColor=t,this.haloSize=r,this.size=n,this.angle=s,this.offsetX=a,this.offsetY=o,this.hAnchor=i,this.vAnchor=c}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}S.pool=new u(S);const I=n.getLogger("esri.views.2d.engine.webgl.Utils");function T(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const w=T([{name:"geometry",strideInBytes:36}]),E=T([{name:"geometry",strideInBytes:12}]),L=T([{name:"geometry",strideInBytes:36}]),A=T([{name:"geometry",strideInBytes:24}]),D=T([{name:"geometry",strideInBytes:12}]),N=T([{name:"geometry",strideInBytes:40}]),C=T([{name:"geometry",strideInBytes:36}]),U=T([{name:"geometry",strideInBytes:36}]);function v(e,t){switch(e){case o.MARKER:return t===i.HEATMAP?E:w;case o.FILL:switch(t){case i.DOT_DENSITY:return D;case i.SIMPLE:case i.OUTLINE_FILL_SIMPLE:return A;default:return L}case o.LINE:return N;case o.TEXT:return C;case o.LABEL:return U}}const M=["geometry"],b=["geometry"],B=["geometry"],O=["geometry"],R=["geometry"];function _(e){switch(e){case o.MARKER:return M;case o.FILL:return b;case o.LINE:return B;case o.TEXT:return O;case o.LABEL:return R}}function z(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function F(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function j(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function x(e){return null!=e}function P(e){return"number"==typeof e}function V(e){switch(e){case"butt":return s.BUTT;case"round":return s.ROUND;case"square":return s.SQUARE;default:return I.error(new r("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),s.ROUND}}function Y(e){switch(e){case"miter":return a.MITER;case"bevel":return a.BEVEL;case"round":return a.ROUND;default:return I.error(new r("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),a.ROUND}}function k(e){switch(e){case"opacity":return c.OPACITY;case"color":return c.COLOR;case"rotation":return c.ROTATION;case"size":return c.SIZE;default:return I.error(`Cannot interpret unknown vv: ${e}`),null}}function $(e,t,r,n,s,a,o){for(const t in a){const n=a[t].stride,o=z(n),i=a[t].data,c=r[t].data,u=n*s.vertexCount/o,l=n*e/o,m=n*s.vertexFrom/o;for(let e=0;e<u;++e)c[e+l]=i[e+m]}const i=s.indexCount;for(let r=0;r<i;++r)n[r+t]=o[r+s.indexFrom]-s.vertexFrom+e}const G={geometry:l.STATIC_DRAW};function X(e,t){const r=[];for(let n=0;n<5;++n){const s=_(n),a={};for(const e of s)a[e]={data:t(n,e)};r.push({data:e(n),buffers:a})}return r}function q(e){switch(e){case f.BYTE:case f.UNSIGNED_BYTE:return 1;case f.SHORT:case f.UNSIGNED_SHORT:return 2;case f.FLOAT:case f.INT:case f.UNSIGNED_INT:return 4}}function H(e){switch(e){case m.UNSIGNED_BYTE:return 1;case m.UNSIGNED_SHORT_4_4_4_4:return 2;case m.FLOAT:return 4;default:return void I.error(new r("webgl-utils",`Unable to handle type ${e}`))}}function K(e){switch(e){case m.UNSIGNED_BYTE:return Uint8Array;case m.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case m.FLOAT:return Float32Array;default:return void I.error(new r("webgl-utils",`Unable to handle type ${e}`))}}const W=new Map,J=(e,t)=>{if(!W.has(e)){const r=function(e){const t={};for(const r in e){const n=e[r];let s=0;t[r]=n.map((e=>{const t=new h(e.name,e.count,e.type,s,0,e.normalized||!1);return s+=e.count*q(e.type),t})),t[r].forEach((e=>e.stride=s))}return t}(t),n=(e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t})(r),s=(e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t})(t),a={strides:n,bufferLayouts:r,attributes:s};W.set(e,a)}return W.get(e)};function Q(e){e(o.FILL),e(o.LINE),e(o.MARKER),e(o.TEXT),e(o.LABEL)}const Z=e=>"path"in e&&fe(e.path),ee=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,te=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,re=e=>e.startsWith("data:image/gif"),ne=e=>"url"in e&&e.url&&(e.url.includes(".gif")||re(e.url))||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&re(e.imageData),se=e=>e.startsWith("data:image/png"),ae=e=>"url"in e&&e.url&&(e.url.includes(".png")||se(e.url))||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&se(e.imageData),oe=e=>e.type&&e.type.toLowerCase().includes("3d");function ie(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const ce=e=>e.includes("data:image/svg+xml");function ue(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return he(e);default:return!0}}function le(e){const t="maxVVSize"in e&&e.maxVVSize,r="width"in e&&e.width||"size"in e&&e.size||0;return t||r}function me(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}const fe=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),he=e=>"fill"===e.type&&"CIMMarkerPlacementInsidePolygon"===e?.cim?.markerPlacement?.type;export{V as A,Y as B,G as C,k as D,H as E,x as F,oe as a,me as b,J as c,ie as d,Z as e,ee as f,K as g,he as h,P as i,te as j,le as k,ne as l,ae as m,ce as n,F as o,y as p,z as q,$ as r,ue as s,X as t,j as u,v,g as w,Q as x,p as y,d as z};
