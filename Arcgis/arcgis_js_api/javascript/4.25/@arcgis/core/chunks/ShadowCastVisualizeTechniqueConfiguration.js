/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{h as t,c as e}from"./mathUtils.js";import{i as n}from"./maybe.js";import{a as i,i as o,q as a,u as r,r as c}from"./mat4.js";import{c as s}from"./mat4f64.js";import{s as l,f as u,z as d,n as m,g as f,e as h,a as g,k as b,d as p}from"./vec3.js";import{V as y}from"./ViewingMode.js";import{d as v}from"./mathUtils2.js";import{_ as A}from"./tslib.es6.js";import{p as M,S as N}from"./ShaderTechniqueConfiguration.js";var T,x,P={exports:{}};T=P,x=function(){var t=Math.PI,e=Math.sin,n=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,r=Math.acos,c=t/180,s=864e5,l=2440588,u=2451545,d={dec:0,ra:0};function m(t){return new Date((t+.5-l)*s)}function f(t){return function(t){return t.valueOf()/s-.5+l}(t)-u}var h=23.4397*c;function g(t,o){return a(e(t)*n(h)-i(o)*e(h),n(t))}function b(t,i){return o(e(i)*n(h)+n(i)*e(h)*e(t))}function p(t,o,r){return a(e(t),n(t)*e(o)-i(r)*n(o))}function y(t,i,a){return o(e(i)*e(a)+n(i)*n(a)*n(t))}function v(t,e){return c*(280.16+360.9856235*t)-e}function A(t){return c*(357.5291+.98560028*t)}function M(t){return c*(1.9148*e(t)+.02*e(2*t)+3e-4*e(3*t))}function N(e,n){return e+n+102.9372*c+t}function T(t,e){var n=A(t),i=N(n,M(n));return e||(e={dec:0,ra:0}),e.dec=b(i,0),e.ra=g(i,0),e}var x={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,n,i){var o=c*-n,a=c*e,r=f(t),s=T(r,d),l=v(r,o)-s.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=p(l,a,s.dec),i.altitude=y(l,a,s.dec),i}},P=[[-.83,"sunrise","sunset"]];x.addTime=function(t,e,n){P.push([t,e,n])};var O=9e-4;function w(e,n,i){return O+(e+n)/(2*t)+i}function E(t,n,i){return u+t+.0053*e(n)-.0069*e(2*i)}function z(t){var i=c*(134.963+13.064993*t),o=c*(93.272+13.22935*t),a=c*(218.316+13.176396*t)+6.289*c*e(i),r=5.128*c*e(o),s=385001-20905*n(i);return{ra:g(a,r),dec:b(a,r),dist:s}}return x.getTimes=function(i,o,a){var s=c*-a,l=c*o,u=function(e,n){return Math.round(e-O-n/(2*t))}(f(i),s),d=w(0,s,u),h=A(d),g=M(h),p=N(h,g),y=b(p,0),v=E(d,h,p);function T(t){return E(w(function(t,i,o){return r((e(t)-e(i)*e(o))/(n(i)*n(o)))}(t,l,y),s,u),h,p)}var z,I,G,S,D,H,L,j={solarNoon:m(v),nadir:m(v-.5),polarException:x.PolarException.NORMAL};for(z=0,I=P.length;z<I;z+=1)D=v-((S=T((G=P[z])[0]*c))-v),j[G[1]]=m(D),j[G[2]]=m(S);return j.polarException=(H=P[0][0]*c,(L=(e(H)-e(l)*e(y))/(n(l)*n(y)))<-1?x.PolarException.MIDNIGHT_SUN:L>1?x.PolarException.POLAR_NIGHT:x.PolarException.NORMAL),j},x.getMoonPosition=function(t,e,n){var o=c*-n,a=c*e,r=f(t),s=z(r),l=v(r,o)-s.ra,u=y(l,a,s.dec);return u+=.017*c/i(u+10.26*c/(u+5.1*c)),{azimuth:p(l,a,s.dec),altitude:u,distance:s.dist}},x.getMoonFraction=function(t){var i=f(t),o=T(i),c=z(i),s=149598e3,l=r(e(o.dec)*e(c.dec)+n(o.dec)*n(c.dec)*n(o.ra-c.ra)),u=a(s*e(l),c.dist-s*n(l));return(1+n(u))/2},x}(),void 0!==x&&(T.exports=x);const O=P.exports,w={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function E(i,o,a,r,c,s){l(s.ambient.color,1,1,1),s.ambient.intensity=w.global.ambient,l(s.direct.color,1,1,1),s.direct.intensity=w.global.direct;const m=o[2],f=e((Math.abs(m)-w.local.altitude)/(w.global.altitude-w.local.altitude),0,1);let h;if(s.globalFactor=f,n(i)&&(h=O.getTimes(i,o[1],o[0])),f<1){let e;if(n(i))e=function(t,e,n){const i=t.valueOf();let o,a;e.polarException===O.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===O.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,c=o+r/2,s=r/4,l=c-s,d=c+s,m=.06*r,f=o-m/2,h=o+m/2,g=a-m/2,b=a+m/2,p=w.local,y=[.01,p.ambientAtNight],v=[.8,.8,1],A=[.01,.01,.01],M=[p.directAtTwilight,p.ambientAtTwilight],N=[1,.6,.5],T=[.8,.8,1],x=[.9*p.directAtNoon,p.ambientAtNoon],P=[1,.98,.98],E=[.98,.98,1],z=[p.directAtNoon,p.ambientAtNoon],I=[1,1,1],G=[1,1,1],S=x,D=P,H=E,L=M,j=N,F=T;let C,q,V=[0,0],k=[0,0,0],B=[0,0,0];i<f||i>b?(V=y,k=A,B=v,q="night"):i<h?(C=h-f,V=_(i-f,C,y,M),k=_(i-f,C,A,N),B=_(i-f,C,v,T),q="sun rising"):i<l?(C=l-h,V=_(i-h,C,M,x),k=_(i-h,C,N,P),B=_(i-h,C,T,E),q="early morning"):i<c?(C=c-l,V=_(i-l,C,x,z),k=_(i-l,C,P,I),B=_(i-l,C,E,G),q="late morning"):i<d?(C=d-c,V=_(i-c,C,z,S),k=_(i-c,C,I,D),B=_(i-c,C,G,H),q="early afternoon"):i<g?(C=g-d,V=_(i-d,C,S,L),k=_(i-d,C,D,j),B=_(i-d,C,H,F),q="late afternoon"):i<b&&(C=b-g,V=_(i-g,C,L,y),k=_(i-g,C,j,A),B=_(i-g,C,F,v),q="sun setting");let J=0;switch(n){case"rainy":case"foggy":J=.9;case"snowy":J=.5}J>0&&(k=U(k,J),B=U(B,J));const K=u(k[0],k[1],k[2]),Q=u(B[0],B[1],B[2]),W=R(n);return{direct:{intensity:V[0]*W.direct,color:K},ambient:{intensity:V[1]*W.ambient,color:Q},timeOfDay:q}}(i,h,r);else{const t=R(r);e={direct:{intensity:w.local.directAtNoon*t.direct,color:u(1,1,1)},ambient:{intensity:w.local.ambientAtNoon*t.ambient,color:u(1,1,1)},timeOfDay:"early afternoon"}}d(s.ambient.color,e.ambient.color,s.ambient.color,f),s.ambient.intensity=t(e.ambient.intensity,s.ambient.intensity,f),d(s.direct.color,e.direct.color,s.direct.color,f),s.direct.intensity=t(e.direct.intensity,s.direct.intensity,f),s.specularStrength="rainy"===r||"snowy"===r||"foggy"===r?0:1,s.environmentStrength="rainy"===r?.7:"snowy"===r||"foggy"===r?.75:1}s.noonFactor=n(i)?function(t,n){const i=t.valueOf();let o,a;n.polarException===O.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):n.polarException===O.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=n.sunrise.valueOf(),a=n.sunset.valueOf());const r=o+(a-o)/2;return 1-e(Math.abs(i-r)/432e5,0,1)}(i,h):1,n(i)?I(i,o,a,s.direct.directionToLightSource):z(c,a,s.direct.directionToLightSource)}function z(t,e,n){e===y.Global?m(q,t.eye):l(q,0,0,1),f(V,t.viewForward,-1);const o=v(V,q),a=Math.max(o-2*B,0),r=.85*a/(a+1),c=Math.max(B,o-B-r);i(C,-c,t.viewRight),h(n,V,C),g(n,n,f(k,t.viewRight,J)),m(n,n)}function I(t,n,i,s){const u=j,d=o(L);if(i===y.Global)O.getPosition(t,0,0,u),l(s,0,0,-1),a(d,d,-u.azimuth),r(d,d,-u.altitude),h(s,s,d);else{const i=w.planarDirection,o=i.globalAngles,r=n[2];let m=(Math.abs(r)-i.localAltitude)/(i.globalAltitude-i.localAltitude);m=e(m,0,1),m<1?(O.getPosition(t,n[1],n[0],u),u.azimuth=(1-m)*u.azimuth+m*o.azimuth,u.altitude=(1-m)*u.altitude+m*o.altitude):(u.azimuth=o.azimuth,u.altitude=o.altitude),l(s,0,-1,0),c(d,d,-u.azimuth),a(d,d,-u.altitude),h(s,s,d)}}function G(t,e){if(e===y.Global)return!0;const n=w.planarDirection;return Math.abs(t)<n.localAltitude}function S(t,e,n,i,o){const a=t.getTime(),r=e.getTime()-a,c=Math.floor(r/n)+1,s=new Array(c);for(let t=0;t<c;++t)F.setTime(a+n*t),s[t]=p(),I(F,i,o,s[t]);return s}const D=u(.5773502691896258,-.5773502691896258,.5773502691896258);class H{constructor(){this.ambient={color:u(1,1,1),intensity:.55},this.direct={color:u(1,1,1),intensity:.55,directionToLightSource:b(D)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const L=s(),j={azimuth:0,altitude:0};function R(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function U(t,e){const n=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(n-t[i])*e;return t}function _(t,e,n,i){const o=[];for(let a=0;a<n.length;a++)o[a]=(i[a]-n[a])*t/e+n[a];return o}const F=new Date(0),C=s(),q=p(),V=p(),k=p(),B=.25,J=.2;var K;!function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"}(K||(K={}));class Q extends N{constructor(){super(...arguments),this.visualization=K.Gradient,this.bandsEnabled=!1}}A([M({count:K.COUNT})],Q.prototype,"visualization",void 0),A([M()],Q.prototype,"bandsEnabled",void 0);export{H as C,K as S,z as a,G as b,E as c,Q as d,O as e,S as f};
