/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{b as t,h as e,n as s,s as n,e as a,g as r,a as o,m as l,c as u,d as c}from"./vec3.js";import{f as h,b as i,c as f}from"./vec3f32.js";import{c as O,f as p,h as A}from"./plane.js";import{w as I}from"./ray.js";import{P as M}from"./basicInterfaces.js";import{d as g}from"./bufferWriterUtils.js";import{g as y}from"./Indices.js";import{a as d}from"./Util2.js";import{V as N}from"./VertexAttribute.js";var w;!function(t){t.length=function(t,e){const s=t[e],n=t[e+1],a=t[e+2];return Math.sqrt(s*s+n*n+a*a)},t.normalize=function(t,e){const s=t[e],n=t[e+1],a=t[e+2],r=1/Math.sqrt(s*s+n*n+a*a);t[e]*=r,t[e+1]*=r,t[e+2]*=r},t.scale=function(t,e,s){t[e]*=s,t[e+1]*=s,t[e+2]*=s},t.add=function(t,e,s,n,a,r=e){(a=a||t)[r]=t[e]+s[n],a[r+1]=t[e+1]+s[n+1],a[r+2]=t[e+2]+s[n+2]},t.subtract=function(t,e,s,n,a,r=e){(a=a||t)[r]=t[e]-s[n],a[r+1]=t[e+1]-s[n+1],a[r+2]=t[e+2]-s[n+2]}}(w||(w={}));const P=w;var m,z,S;!function(t){const e=.5,s=[[-e,-e,e],[e,-e,e],[e,e,e],[-e,e,e],[-e,-e,-e],[e,-e,-e],[e,e,-e],[-e,e,-e]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],a=[0,0,1,0,1,1,0,1],r=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],o=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)o[6*t+e]=t;const l=new Array(36);for(let t=0;t<6;t++)l[6*t+0]=0,l[6*t+1]=1,l[6*t+2]=2,l[6*t+3]=2,l[6*t+4]=3,l[6*t+5]=0;t.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(24);for(let n=0;n<8;n++)e[3*n]=s[n][0]*t[0],e[3*n+1]=s[n][1]*t[1],e[3*n+2]=s[n][2]*t[2];return new g([[N.POSITION,{size:3,data:e,exclusive:!0}],[N.NORMAL,{size:3,data:n}],[N.UV0,{size:2,data:a}]],[[N.POSITION,r],[N.NORMAL,o],[N.UV0,l]])}}(m||(m={})),function(t){const e=.5,s=[[-e,0,-e],[e,0,-e],[e,0,e],[-e,0,e],[0,-e,0],[0,e,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],a=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],r=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];t.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(18);for(let n=0;n<6;n++)e[3*n]=s[n][0]*t[0],e[3*n+1]=s[n][1]*t[1],e[3*n+2]=s[n][2]*t[2];return new g([[N.POSITION,{size:3,data:e,exclusive:!0}],[N.NORMAL,{size:3,data:n}]],[[N.POSITION,a],[N.NORMAL,r]])}}(z||(z={})),function(n){const a=.5,r=h(-a,0,-a),o=h(a,0,-a),l=h(0,0,a),u=h(0,.5,0),c=i(),f=i(),O=i(),p=i(),A=i();t(c,r,u),t(f,r,o),e(O,c,f),s(O,O),t(c,o,u),t(f,o,l),e(p,c,f),s(p,p),t(c,l,u),t(f,l,r),e(A,c,f),s(A,A);const I=[r,o,l,u],M=[0,-1,0,O[0],O[1],O[2],p[0],p[1],p[2],A[0],A[1],A[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],d=[0,0,0,1,1,1,2,2,2,3,3,3];n.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(12);for(let s=0;s<4;s++)e[3*s]=I[s][0]*t[0],e[3*s+1]=I[s][1]*t[1],e[3*s+2]=I[s][2]*t[2];return new g([[N.POSITION,{size:3,data:e,exclusive:!0}],[N.NORMAL,{size:3,data:M}]],[[N.POSITION,y],[N.NORMAL,d]])}}(S||(S={}));const v=m.createGeometry,x=z.createGeometry,T=S.createGeometry;function L(t,e,s,n={uv:!0}){const a=-Math.PI,r=2*Math.PI,o=-Math.PI/2,l=Math.PI,u=Math.max(3,Math.floor(e)),c=Math.max(2,Math.floor(s)),h=(u+1)*(c+1),i=new Float32Array(3*h),f=new Float32Array(3*h),O=new Float32Array(2*h),p=[];let A=0;for(let e=0;e<=c;e++){const s=[],n=e/c,h=o+n*l,I=Math.cos(h);for(let e=0;e<=u;e++){const o=e/u,l=a+o*r,c=Math.cos(l)*I,p=Math.sin(h),M=-Math.sin(l)*I;i[3*A]=c*t,i[3*A+1]=p*t,i[3*A+2]=M*t,f[3*A]=c,f[3*A+1]=p,f[3*A+2]=M,O[2*A]=o,O[2*A+1]=n,s.push(A),++A}p.push(s)}const I=new Array;for(let t=0;t<c;t++)for(let e=0;e<u;e++){const s=p[t][e],n=p[t][e+1],a=p[t+1][e+1],r=p[t+1][e];0===t?(I.push(s),I.push(a),I.push(r)):t===c-1?(I.push(s),I.push(n),I.push(a)):(I.push(s),I.push(n),I.push(a),I.push(a),I.push(r),I.push(s))}const M=[[N.POSITION,I],[N.NORMAL,I]],y=[[N.POSITION,{size:3,data:i,exclusive:!0}],[N.NORMAL,{size:3,data:f,exclusive:!0}]];return n.uv&&(y.push([N.UV0,{size:2,data:O,exclusive:!0}]),M.push([N.UV0,I])),n.offset&&(M[0][0]=N.OFFSET,y[0][0]=N.OFFSET,M.push([N.POSITION,new Array(I.length).fill(0)]),y.push([N.POSITION,{size:3,data:Float64Array.from(n.offset),exclusive:!0}])),new g(y,M)}function R(t,e,s){const n=t;let a,r;if(s)a=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const t=n*(1+Math.sqrt(5))/2;a=[-n,t,0,n,t,0,-n,-t,0,n,-t,0,0,-n,t,0,n,t,0,-n,-t,0,n,-t,t,0,-n,t,0,n,-t,0,-n,-t,0,n],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let e=0;e<a.length;e+=3)P.scale(a,e,t/P.length(a,e));let o={};function l(e,s){e>s&&([e,s]=[s,e]);const n=e.toString()+"."+s.toString();if(o[n])return o[n];let r=a.length;return a.length+=3,P.add(a,3*e,a,3*s,a,r),P.scale(a,r,t/P.length(a,r)),r/=3,o[n]=r,r}for(let t=0;t<e;t++){const t=r.length,e=new Array(4*t);for(let s=0;s<t;s+=3){const t=r[s],n=r[s+1],a=r[s+2],o=l(t,n),u=l(n,a),c=l(a,t),h=4*s;e[h]=t,e[h+1]=o,e[h+2]=c,e[h+3]=n,e[h+4]=u,e[h+5]=o,e[h+6]=a,e[h+7]=c,e[h+8]=u,e[h+9]=o,e[h+10]=u,e[h+11]=c}r=e,o={}}const u=new Float32Array(a);for(let t=0;t<u.length;t+=3)P.normalize(u,t);const c=[[N.POSITION,r],[N.NORMAL,r]],h=[[N.POSITION,{size:3,data:new Float32Array(a),exclusive:!0}],[N.NORMAL,{size:3,data:u,exclusive:!0}]];return new g(h,c)}function F(t,e,s,n,a,r,o,l){const u=e?[e[0],e[1],e[2]]:[0,0,0],c=t?[t[0],t[1],t[2]]:[0,0,1];r=r||[0,0];const h=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],i=null!=n&&2===n.length?n:[1,1],f=[[N.POSITION,{size:3,data:u,exclusive:!0}],[N.NORMAL,{size:3,data:c,exclusive:!0}],[N.UV0,{size:r.length,data:r}],[N.COLOR,{size:4,data:h,exclusive:!0}],[N.SIZE,{size:2,data:i}]];if(null!=a){const t=new Float32Array([a[0],a[1],a[2],a[3]]);f.push([N.AUXPOS1,{size:4,data:t}])}if(null!=o){const t=new Float32Array([o[0],o[1],o[2],o[3]]);f.push([N.AUXPOS2,{size:4,data:t}])}return new g(f,null,M.Point,l)}const b=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function U(t=b){const e=new Array(12);for(let s=0;s<4;s++)for(let n=0;n<3;n++)e[3*s+n]=t[s][n];const s=[0,1,2,2,3,0],n=[0,0,0,0,0,0],a=[[N.POSITION,s],[N.NORMAL,n],[N.UV0,s],[N.COLOR,n]],r=[[N.POSITION,{size:3,data:e,exclusive:!0}],[N.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[N.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[N.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]];return new g(r,a)}function V(t,e,s,n,a=!0,r=!0){let o=0;const l=e,u=t;let c=h(0,o,0),i=h(0,o+u,0),f=h(0,-1,0),O=h(0,1,0);n&&(o=u,i=h(0,0,0),c=h(0,o,0),f=h(0,1,0),O=h(0,-1,0));const p=[i,c],A=[f,O],I=s+2,M=Math.sqrt(u*u+l*l);if(n)for(let t=s-1;t>=0;t--){const e=t*(2*Math.PI/s),n=h(Math.cos(e)*l,o,Math.sin(e)*l);p.push(n);const a=h(u*Math.cos(e)/M,-l/M,u*Math.sin(e)/M);A.push(a)}else for(let t=0;t<s;t++){const e=t*(2*Math.PI/s),n=h(Math.cos(e)*l,o,Math.sin(e)*l);p.push(n);const a=h(u*Math.cos(e)/M,l/M,u*Math.sin(e)/M);A.push(a)}const y=new Array,d=new Array;if(a){for(let t=3;t<p.length;t++)y.push(1),y.push(t-1),y.push(t),d.push(0),d.push(0),d.push(0);y.push(p.length-1),y.push(2),y.push(1),d.push(0),d.push(0),d.push(0)}if(r){for(let t=3;t<p.length;t++)y.push(t),y.push(t-1),y.push(0),d.push(t),d.push(t-1),d.push(1);y.push(0),y.push(2),y.push(p.length-1),d.push(1),d.push(2),d.push(A.length-1)}const w=new Float32Array(3*I);for(let t=0;t<I;t++)w[3*t]=p[t][0],w[3*t+1]=p[t][1],w[3*t+2]=p[t][2];const P=new Float32Array(3*I);for(let t=0;t<I;t++)P[3*t]=A[t][0],P[3*t+1]=A[t][1],P[3*t+2]=A[t][2];const m=[[N.POSITION,y],[N.NORMAL,d]],z=[[N.POSITION,{size:3,data:w,exclusive:!0}],[N.NORMAL,{size:3,data:P,exclusive:!0}]];return new g(z,m)}function j(t,a,u,c,O,p){const A=c?f(c):h(1,0,0),I=O?f(O):h(0,0,0);p=p??!0;const M=i();s(M,A);const y=i();r(y,M,Math.abs(t));const d=i();r(d,y,-.5),o(d,d,I);const w=h(0,1,0);Math.abs(1-l(M,w))<.2&&n(w,0,0,1);const P=i();e(P,M,w),s(P,P),e(w,P,M);const m=2*u+(p?2:0),z=u+(p?2:0),S=new Float32Array(3*m),v=new Float32Array(3*z),x=new Float32Array(2*m),T=new Array(3*u*(p?4:2)),L=new Array(3*u*(p?4:2));p&&(S[3*(m-2)+0]=d[0],S[3*(m-2)+1]=d[1],S[3*(m-2)+2]=d[2],x[2*(m-2)]=0,x[2*(m-2)+1]=0,S[3*(m-1)+0]=S[3*(m-2)+0]+y[0],S[3*(m-1)+1]=S[3*(m-2)+1]+y[1],S[3*(m-1)+2]=S[3*(m-2)+2]+y[2],x[2*(m-1)]=1,x[2*(m-1)+1]=1,v[3*(z-2)+0]=-M[0],v[3*(z-2)+1]=-M[1],v[3*(z-2)+2]=-M[2],v[3*(z-1)+0]=M[0],v[3*(z-1)+1]=M[1],v[3*(z-1)+2]=M[2]);const R=(t,e,s)=>{T[t]=e,L[t]=s};let F=0;const b=i(),U=i();for(let t=0;t<u;t++){const e=t*(2*Math.PI/u);r(b,w,Math.sin(e)),r(U,P,Math.cos(e)),o(b,b,U),v[3*t+0]=b[0],v[3*t+1]=b[1],v[3*t+2]=b[2],r(b,b,a),o(b,b,d),S[3*t+0]=b[0],S[3*t+1]=b[1],S[3*t+2]=b[2],x[2*t+0]=t/u,x[2*t+1]=0,S[3*(t+u)+0]=S[3*t+0]+y[0],S[3*(t+u)+1]=S[3*t+1]+y[1],S[3*(t+u)+2]=S[3*t+2]+y[2],x[2*(t+u)+0]=t/u,x[2*t+1]=1;const s=(t+1)%u;R(F++,t,t),R(F++,t+u,t),R(F++,s,s),R(F++,s,s),R(F++,t+u,t),R(F++,s+u,s)}if(p){for(let t=0;t<u;t++){const e=(t+1)%u;R(F++,m-2,z-2),R(F++,t,z-2),R(F++,e,z-2)}for(let t=0;t<u;t++){const e=(t+1)%u;R(F++,t+u,z-1),R(F++,m-1,z-1),R(F++,e+u,z-1)}}const V=[[N.POSITION,T],[N.NORMAL,L],[N.UV0,T]],j=[[N.POSITION,{size:3,data:S,exclusive:!0}],[N.NORMAL,{size:3,data:v,exclusive:!0}],[N.UV0,{size:2,data:x,exclusive:!0}]];return new g(j,V)}function G(t,e,s,n,a){s=s||10,n=null==n||n,d(t.length>1);const r=[],o=[];for(let t=0;t<s;t++){r.push([0,-t-1,-(t+1)%s-1]);const n=t/s*2*Math.PI;o.push([Math.cos(n)*e,Math.sin(n)*e])}return C(o,t,[[0,0,0]],r,n,a)}function C(a,l,f,M,y,d=h(0,0,0)){const w=a.length,P=new Float32Array(l.length*w*3+(6*f.length||0)),m=new Float32Array(l.length*w*3+(f?6:0)),z=new Array,S=new Array;let v=0,x=0;const T=i(),L=i(),R=i(),F=i(),b=i(),U=i(),V=i(),j=c(),G=i(),C=i(),q=i(),E=i(),X=i(),k=O();n(G,0,1,0),t(L,l[1],l[0]),s(L,L),y?(o(j,l[0],d),s(R,j)):n(R,0,0,1),Z(L,R,G,G,b,R,B),u(F,R),u(E,b);for(let t=0;t<f.length;t++)r(U,b,f[t][0]),r(j,R,f[t][2]),o(U,U,j),o(U,U,l[0]),P[v++]=U[0],P[v++]=U[1],P[v++]=U[2];m[x++]=-L[0],m[x++]=-L[1],m[x++]=-L[2];for(let t=0;t<M.length;t++)z.push(M[t][0]>0?M[t][0]:-M[t][0]-1+f.length),z.push(M[t][1]>0?M[t][1]:-M[t][1]-1+f.length),z.push(M[t][2]>0?M[t][2]:-M[t][2]-1+f.length),S.push(0),S.push(0),S.push(0);let W=f.length;const D=f.length-1;for(let n=0;n<l.length;n++){let c=!1;n>0&&(u(T,L),n<l.length-1?(t(L,l[n+1],l[n]),s(L,L)):c=!0,o(C,T,L),s(C,C),o(q,l[n-1],F),p(l[n],C,k),A(k,I(q,T),j)?(t(j,j,l[n]),s(R,j),e(b,C,R),s(b,b)):Z(C,F,E,G,b,R,B),u(F,R),u(E,b)),y&&(o(j,l[n],d),s(X,j));for(let t=0;t<w;t++)if(r(U,b,a[t][0]),r(j,R,a[t][1]),o(U,U,j),s(V,U),m[x++]=V[0],m[x++]=V[1],m[x++]=V[2],o(U,U,l[n]),P[v++]=U[0],P[v++]=U[1],P[v++]=U[2],!c){const e=(t+1)%w;z.push(W+t),z.push(W+w+t),z.push(W+e),z.push(W+e),z.push(W+w+t),z.push(W+w+e);for(let t=0;t<6;t++){const e=z.length-6;S.push(z[e+t]-D)}}W+=w}const H=l[l.length-1];for(let t=0;t<f.length;t++)r(U,b,f[t][0]),r(j,R,f[t][1]),o(U,U,j),o(U,U,H),P[v++]=U[0],P[v++]=U[1],P[v++]=U[2];const J=x/3;m[x++]=L[0],m[x++]=L[1],m[x++]=L[2];const K=W-w;for(let t=0;t<M.length;t++)z.push(M[t][0]>=0?W+M[t][0]:-M[t][0]-1+K),z.push(M[t][2]>=0?W+M[t][2]:-M[t][2]-1+K),z.push(M[t][1]>=0?W+M[t][1]:-M[t][1]-1+K),S.push(J),S.push(J),S.push(J);const Q=[[N.POSITION,z],[N.NORMAL,S]],Y=[[N.POSITION,{size:3,data:P,exclusive:!0}],[N.NORMAL,{size:3,data:m,exclusive:!0}]];return new g(Y,Q)}function q(t,e,s){d(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),d(3===t[0].length,"createPolylineGeometry(): malformed vertex"),d(null==e||e.length===t.length,"createPolylineGeometry: need same number of points and normals"),d(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const n=new Float64Array(3*t.length),a=new Array(2*(t.length-1));let r=0,o=0;for(let e=0;e<t.length;e++){for(let s=0;s<3;s++)n[r++]=t[e][s];e>0&&(a[o++]=e-1,a[o++]=e)}const l=[],u=[];if(l.push([N.POSITION,a]),u.push([N.POSITION,{size:3,data:n,exclusive:!0}]),e){const s=new Float32Array(3*e.length);let n=0;for(let a=0;a<t.length;a++)for(let t=0;t<3;t++)s[n++]=e[a][t];l.push([N.NORMAL,a]),u.push([N.NORMAL,{size:3,data:s,exclusive:!0}])}return s&&(u.push([N.COLOR,{size:4,data:s}]),l.push([N.COLOR,y(s.length/4)])),new g(u,l,M.Line)}function E(t,e,s,n,a=0){const r=new Array(18),o=[[-e,a,n/2],[s,a,n/2],[0,t+a,n/2],[-e,a,-n/2],[s,a,-n/2],[0,t+a,-n/2]];for(let t=0;t<6;t++)r[3*t]=o[t][0],r[3*t+1]=o[t][1],r[3*t+2]=o[t][2];return new g([[N.POSITION,{size:3,data:r,exclusive:!0}]],[[N.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])}function X(t,e){const s=t.getMutableAttribute(N.POSITION).data;for(let t=0;t<s.length;t+=3){const r=s[t],o=s[t+1],l=s[t+2];n(D,r,o,l),a(D,D,e),s[t]=D[0],s[t+1]=D[1],s[t+2]=D[2]}}function k(t,e=t){const s=t.vertexAttributes,n=s.get(N.POSITION).data,a=s.get(N.NORMAL).data;if(a){const t=e.getMutableAttribute(N.NORMAL).data;for(let e=0;e<a.length;e+=3){const s=a[e+1];t[e+1]=-a[e+2],t[e+2]=s}}if(n){const t=e.getMutableAttribute(N.POSITION).data;for(let e=0;e<n.length;e+=3){const s=n[e+1];t[e+1]=-n[e+2],t[e+2]=s}}return e}function W(t,n,a,r,o){return!(Math.abs(l(n,t))>o||(e(a,t,n),s(a,a),e(r,a,t),s(r,r),0))}function Z(t,e,s,n,a,r,o){return W(t,e,a,r,o)||W(t,s,a,r,o)||W(t,n,a,r,o)}const B=.99619469809,D=i();export{L as a,F as b,q as c,U as d,E as e,V as f,C as g,R as h,k as i,x as j,T as k,j as l,v as m,Z as n,G as o,X as t};
