/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import s from"../core/Handles.js";import{d as t}from"../chunks/maybe.js";import{watch as r,on as i,initial as o}from"../core/reactiveUtils.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{cast as n}from"../core/accessorSupport/decorators/cast.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import p from"./Widget.js";import c from"./Legend/LegendViewModel.js";import{substitute as d}from"../intl.js";import{a as m}from"../chunks/screenUtils.js";import"../chunks/ensureType.js";import{g as h,a as u,r as y,b as g,c as v,d as f,e as _,renderColorRampPreviewHTML as b,f as j}from"../symbols/support/symbolUtils.js";import{d as k}from"../chunks/utils6.js";import{i as w,c as L}from"../chunks/widgetUtils.js";import{t as S}from"../chunks/jsxFactory.js";import{c as C}from"../chunks/projector.js";import{H as x,i as I}from"../chunks/Heading.js";import{a as z}from"../chunks/accessibleHandler.js";import{m as E}from"../chunks/messageBundle.js";import{a as R}from"../chunks/number.js";import"../core/promiseUtils.js";import"../chunks/object.js";import"../core/Error.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/string.js";import"../chunks/handleUtils.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/jsonMap.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"./Legend/support/ActiveLayerInfo.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../geometry/SpatialReference.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/EffectView.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../chunks/jsonUtils.js";import"../chunks/ExportImageParameters.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../core/sql.js";import"../chunks/commonProperties.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/floorFilterUtils.js";import"../chunks/sublayerUtils.js";import"../renderers/support/jsonUtils.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/compilerUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils2.js";import"../chunks/rendererConversion.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/utils15.js";import"../chunks/numberUtils.js";import"../chunks/previewSymbol3D.js";import"../chunks/colorUtils2.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/themeUtils.js";import"./smartMapping/support/utils.js";import"../chunks/asyncUtils.js";import"../chunks/ItemCache.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";const U="esri-relationship-ramp--square__table-row",$="esri-relationship-ramp--square__table-cell",M="esri-relationship-ramp--square__table-label";function A(e,s,t,r){const{focus:i,labels:o}=e,l=!!i,n=function(e,s,t,r,i=60){const{focus:o,numClasses:l,colors:n,rotation:a}=e,p=!!o,c=Math.sqrt(i**2+i**2)+(p?0:5),d=[],m=[],b=[],j=(i||75)/l;for(let e=0;e<l;e++){const s=e*j;for(let t=0;t<l;t++){const r=t*j,i=h(n[e][t]),o=u(null),l={type:"rect",x:r,y:s,width:j,height:j};d.push(y(i)),m.push(g(l,i.fill,o,null)),b.push(v(l))}}let w=null;p||(w="margin: -15px -15px -18px -15px");const L=V("left",o,s),C=V("right",o,s),x=f(b),I=_(x,c,c,0,!1,a,!1),z=_(x,c,c,0,!1,p?-45:null,!1),E={filter:k(r),opacity:null==t?null:`${t}`};return S("div",{styles:E,class:p?"esri-relationship-ramp--diamond__middle-column--ramp":$},S("svg",{xmlns:"http://www.w3.org/2000/svg",width:c,height:c,style:w},S("defs",null,S("marker",{id:`${s}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},S("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),S("marker",{id:`${s}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},S("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),S("g",{transform:I},m),S("g",{transform:z},S("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":L.markerStart,"marker-end":L.markerEnd,x1:-10,y1:i-15,x2:-10,y2:15}),S("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:15,y1:i+10,x2:i-15,y2:i+10}))))}(e,s,t,r),a=w();return l?S("div",{class:"esri-relationship-ramp--diamond__container",styles:{justifyContent:"center"}},S("div",{class:"esri-relationship-ramp--diamond__left-column"},a?o.right:o.left),S("div",{class:"esri-relationship-ramp--diamond__middle-column"},S("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},o.top),n,S("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},o.bottom)),S("div",{class:"esri-relationship-ramp--diamond__right-column"},a?o.left:o.right)):S("div",{class:"esri-relationship-ramp--square__table"},S("div",{class:U},S("div",{class:L($,M,"esri-relationship-ramp--square__table-label--right-bottom")},a?o.top:o.left),S("div",{class:$}),S("div",{class:L($,M,"esri-relationship-ramp--square__table-label--left-bottom")},a?o.left:o.top)),S("div",{class:U},S("div",{class:$}),n,S("div",{class:$})),S("div",{class:U},S("div",{class:L($,M,"esri-relationship-ramp--square__table-label--right-top")},a?o.right:o.bottom),S("div",{class:$}),S("div",{class:L($,M,"esri-relationship-ramp--square__table-label--left-top")},a?o.bottom:o.right)))}function V(e,s,t){const r=`${t}_arrowStart`,i=`${t}_arrowEnd`,o="left"===e,l={markerStart:null,markerEnd:null};switch(s){case"HL":o?l.markerStart=`url(#${i})`:l.markerEnd=`url(#${r})`;break;case"LL":l.markerStart=`url(#${i})`;break;case"LH":o?l.markerEnd=`url(#${r})`:l.markerStart=`url(#${i})`;break;default:l.markerEnd=`url(#${r})`}return l}const N=C();function F(e="vertical"){const s="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?S("svg",{height:"4",width:"10"},S("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:s})):S("svg",{height:"10",width:"10"},S("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:s}))}function D(e,s="vertical"){const t=document.createElement("div");return t.style.height="20px",t.className="esri-univariate-above-and-below-ramp__symbol",null!=e&&(t.style.opacity=e.toString()),N.append(t,F.bind(null,s)),t}function P(e,s,t="vertical",r){e.infos.forEach(((e,i)=>{if(r&&2===i)e.preview=D(s,t);else{const s=m(e.size)+("horizontal"===t?20:10),r="div"===e.preview.tagName.toLowerCase(),i=r?e.preview:document.createElement("div");i.className="esri-univariate-above-and-below-ramp__symbol","horizontal"===t?i.style.width=`${s}px`:i.style.height=`${s}px`,r||i.appendChild(e.preview),e.preview=i}}))}function T(e,s="classic"){const t=e.infos;return"classic"===s?(m(t[0].size)+10)/2:(m(t[0].size)-m(t[t.length-1].size))/2}function O(e,s){if(!e)return null;const t=e.infos.map((e=>e.color)),r=b("full"===s.type?t:"above"===s.type?t.slice(0,3):t.slice(2,5),{width:s.width,height:s.height,align:s.rampAlignment,effectList:s.effectList});return r.className="esri-legend__color-ramp",null!=s.opacity&&(r.style.opacity=s.opacity.toString()),r}function B(e,s,t,r="vertical"){let i=0;const o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l;for(let e=n;e<=a;e++)i+=t&&e===l?"horizontal"===r?10:20:m(o[e].size)+("horizontal"===r?20:10);return Math.round(i)}function q(e,s,t,r="vertical"){const i=B(e,s,t,r),o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l,p="full"===s?o[n].size+o[a].size:"above"===s?o[n].size:o[a].size,c=t?"vertical"===r?20:10:0,d="vertical"===r?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(i-(m(p)/2+c/2+d/2))}function H(e,s,t="vertical"){const r=e.infos;let i=r.find((({type:e})=>"size-ramp"===e)),o=r.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],P(i,s,t,!0)),o&&(o={...o},o.infos=[...o.infos]),"horizontal"===t&&(i?.infos.reverse(),o?.infos.reverse()),{sizeRampElement:i,colorRampElement:o}}function W(e,s="vertical"){const t=e.infos;let r=t.find((({type:e})=>"size-ramp"===e)),i=t.find((({type:e})=>"color-ramp"===e));return r&&(r={...r},r.infos=[...r.infos],P(r,null,s,!1)),i&&(i={...i},i.infos=[...i.infos]),"horizontal"===s&&(r?.infos.reverse(),i?.infos.reverse()),{sizeRampElement:r,colorRampElement:i}}function G(e){e.appendChild(this)}function Q(e,s,t){if(!s)return;if("string"==typeof s||"number"==typeof s)return s;if("value"in s||"unit"in s)return d(e.dotValue,s);if("colorName"in s||"bandName"in s)return e[s.colorName]+": "+(e[s.bandName]||s.bandName);if("showCount"in s)return s.showCount?e.clusterCountTitle:null;let r=null;return function(e,s){return s}(0,t)?r=s.ratioPercentTotal?"showRatioPercentTotal":s.ratioPercent?"showRatioPercent":s.ratio?"showRatio":s.normField?"showNormField":s.field?"showField":null:X(0,t)&&(r=s.normField?"showNormField":s.normByPct?"showNormPct":s.field?"showField":null),r?d("showField"===r?"{field}":e[r],{field:s.field,normField:s.normField}):null}function X(e,s){return!s}function Y(e,s){return!!(s&&"Stretched"===s&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const Z="esri-legend--card__layer-row",J="esri-legend--card__ramp-label",K="esri-legend--card__symbol",ee="esri-legend__layer-cell esri-legend__layer-cell--info";var se;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(se||(se={}));const te=window.devicePixelRatio;let re=class extends p{constructor(e,t){super(e,t),this._handles=new s,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=se.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles(r((()=>this.activeLayerInfos),(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)})))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===se.Auto&&this.view.container.clientWidth<=768||this.layout===se.Stack;const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const t=this._sectionNames.length,r=this._sectionNames.map(((e,s)=>{const r=d(this.messagesCommon.pagination.pageText,{index:s+1,total:t});return S("div",{key:e,role:"tab",id:e,"aria-label":r,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:r,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{"esri-legend--card__carousel-indicator--activated":this._selectedSectionName===e}),"data-section-name":e})})),i=this._hasIndicators&&t>1?S("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation",role:"tablist"},r):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s&&s.length?s:null,l={"esri-legend--stacked":this._hasIndicators};return S("div",{class:this.classes("esri-legend--card",l)},o||S("div",{class:"esri-legend--card__message"},this.messages.noLegend),i)}_selectSection(e){const s=e.target.getAttribute("data-section-name");s&&(this._selectedSectionName=s)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const s=e.key,t="ArrowLeft"===s?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),o=this._sectionNames;let l=null;-1!==i&&(o[i+t]?l=document.getElementById(o[i+t]):"ArrowLeft"===s?l=document.getElementById(o[o.length-1]):"ArrowRight"===s&&(l=document.getElementById(o[0])),l&&l.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const s=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(s),this._watchForSectionChanges(e.children),this._handles.add(r((()=>e.version),(()=>this._generateSectionNames())),s)}));const s="activeLayerInfos-collection-change";this._handles.remove(s),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,s,t){return`${this.id}${e.uid}-type-${s.type}-${t}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((s,t)=>{this._sectionNames.push(this._getSectionName(e.layer,s,t))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return S("div",{key:e.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},S("div",{class:"esri-legend--card__service-caption-container"},e.title),s)}{const s=e.legendElements;if(s&&!s.length)return null;const t=s.some((e=>"relationship-ramp"===e.type)),r=s.map(((s,r)=>this._renderLegendForElement(s,e,r,t))).filter((e=>!!e));if(!r.length)return null;const i={"esri-legend--card__group-layer-child":!!e.parent};return S("div",{key:e.layer.uid,class:this.classes("esri-legend--card__service",i)},S("div",{class:"esri-legend--card__service-caption-container"},S("div",{class:"esri-legend--card__service-caption-text"},e.title)),S("div",{class:"esri-legend--card__service-content"},r))}}_renderLegendForElement(e,s,t,r=!1,i=!1){const o="color-ramp"===e.type,l="opacity-ramp"===e.type,n="size-ramp"===e.type,a=s.layer;let p=null;if("string"==typeof e.title)p=e.title;else if(e.title){const s=e.title,t=Q(this.messages,s,o||l);p=s.title?`${s.title} (${t})`:t}const c=this._getSectionName(a,e,t),d=this._hasIndicators&&!i?S("div",null,S(x,{level:this.headingLevel,class:"esri-legend--card__carousel-title"},s.title),S(x,{level:I(this.headingLevel),class:"esri-legend--card__layer-caption"},p)):p?S(x,{level:this.headingLevel,class:"esri-legend--card__layer-caption"},p):null,m=s.effectList;let h=null;if("symbol-table"===e.type){const t=e.infos.map(((t,r)=>this._renderLegendForElementInfo(t,s,e.legendType,r))).filter((e=>!!e));if(t.length){const e={"esri-legend--card__label-container":!(t[0].properties.classes&&t[0].properties.classes["esri-legend--card__symbol-row"]||r),"esri-legend--card__relationship-label-container":r};h=S("div",{class:this.classes(e)},t)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,a.opacity,m):n?h=this._renderSizeRamp(e,a.opacity):"pie-chart-ramp"===e.type?h=this._renderPieChartRamp(e):"relationship-ramp"===e.type?h=A(e,this.id,a.opacity,m):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,m):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,a.opacity,m));if(!h)return null;const u=S("div",{key:c,class:"esri-legend--card__section",id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[d,h]);return i||this._sectionMap.set(c,u),u}_renderPieChartRamp(e){return S("div",{class:"esri-legend--card__pie-chart-ramp-preview",bind:e.preview,afterCreate:G})}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:r,colorRampElement:i}=H(e,s,"horizontal");if(!r)return null;const o=B(r,"full",!0,"horizontal"),l=q(r,"above",!0,"horizontal"),n=q(r,"below",!0,"horizontal"),a=O(i,{width:l,height:12,rampAlignment:"horizontal",opacity:s,type:"above",effectList:t}),p=O(i,{width:n,height:12,rampAlignment:"horizontal",opacity:s,type:"below",effectList:t}),c=T(r,"card"),d=r.infos.map((e=>e.label)),m=d.length-1,h=d.map(((e,s)=>0===s||s===m?S("div",{key:s},e):null)),u={marginTop:"3px",display:"flex"};w(this.container)?u.marginRight=`${c}px`:u.marginLeft=`${c}px`;const y={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return S("div",{class:Z,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},S("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},r.infos.map(((e,s)=>S("div",{key:s,class:K,bind:e.preview,afterCreate:G})))),a?S("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:u,key:"color-ramp-preview"},S("div",{bind:a,afterCreate:G}),S("div",{bind:p,afterCreate:G})):null,S("div",{class:ee},S("div",{class:"esri-legend__ramp-labels",styles:y},h)))}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:r,colorRampElement:i}=W(e,"horizontal");if(!r)return null;const o=B(r,"full",!1,"horizontal"),l=O(i,{width:q(r,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:s,type:"full",effectList:t}),n=T(r,"card"),a=r.infos.length-1,p=r.infos.map(((e,s)=>0===s||s===a?S("div",{key:s},e.label):null)),c={marginTop:"3px",display:"flex"};w(this.container)?c.marginRight=`${n}px`:c.marginLeft=`${n}px`;const d={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return S("div",{class:Z,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},S("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},r.infos.map(((e,s)=>S("div",{key:s,class:K,bind:e.preview,afterCreate:G})))),S("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:c,key:"color-ramp-preview"},S("div",{bind:l,afterCreate:G})),S("div",{class:ee},S("div",{class:"esri-legend__ramp-labels",styles:d},p)))}_renderLegendForElementInfo(e,s,t,r){const i=s.layer;if(e.type)return this._renderLegendForElement(e,s,r,!1,!0);const o=Y(i,t);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return S("div",{key:r,bind:e.preview,afterCreate:G});const s={"esri-legend--card__symbol-cell":this._hasIndicators};return S("div",{key:r,class:this.classes(Z,{"esri-legend--card__symbol-row":this._hasIndicators})},S("div",{class:this.classes(s),bind:e.preview,afterCreate:G}),S("div",{class:this.classes("esri-legend--card__image-label",{"esri-legend--card__label-cell":this._hasIndicators})},Q(this.messages,e.label,!1)||""))}let t=255,o=255,l=255,n=0,a=255,p=255,c=255,d=0;const m=e.symbol.color&&e.symbol.color.a,h=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;m&&(t=e.symbol.color.r,o=e.symbol.color.g,l=e.symbol.color.b,n=e.symbol.color.a*i.opacity),h&&(a=e.symbol.outline.color.r,p=e.symbol.outline.color.g,c=e.symbol.outline.color.b,d=e.symbol.outline.color.a*i.opacity);const u=e.symbol.color?.isBright??!0,y=u?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",g={background:m?`rgba(${t}, ${o}, ${l}, ${n})`:"none",color:u?"black":"white",textShadow:`-1px -1px 0 ${y},\n                                              1px -1px 0 ${y},\n                                              -1px 1px 0 ${y},\n                                              1px 1px 0 ${y}`,border:h?`1px solid rgba(${a}, ${p}, ${c}, ${d})`:"none",filter:k(s.effectList)};return S("div",{key:r,class:Z},S("div",{class:"esri-legend--card__label-element",styles:g}," ",e.label," "))}if(e.src){const s=this._renderImage(e,i,o);return S("div",{key:r,class:Z},s,S("div",{class:"esri-legend--card__image-label"},e.label||""))}}_renderImage(e,s,t){const{label:r,src:i,opacity:o}=e,l={"esri-legend--card__imagery-layer-image--stretched":t,[K]:!t},n={opacity:`${null!=o?o:s.opacity}`};return S("img",{alt:Q(this.messages,r,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}_renderSizeRampLines(e){const s=e.infos,t=s[0],r=s[s.length-1],i=t.symbol,o=this._hasIndicators,l=m(t.size+t.outlineSize)*te,n=m(r.size+r.outlineSize)*te,a=o?l:l+50*te,p=o?l/2+50*te:l,c=function(e){if(e){if(e.type.includes("3d")){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1).get("resource.primitive");return"triangle"===t||"cone"===t||"tetrahedron"===t}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.includes("3d")){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1),r=t.resource&&t.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}{const s=e.style;return"circle"===s||"diamond"===s||"cross"===s}}}(i),h=document.createElement("canvas");h.width=a,h.height=p,h.style.width=h.width/te+"px",h.style.height=h.height/te+"px";const u=h.getContext("2d");if(o){u.beginPath();const e=0,s=0,t=a/2-n/2,r=p;u.moveTo(e,s),u.lineTo(t,r);const i=a,o=0,l=a/2+n/2,c=p;u.moveTo(i,o),u.lineTo(l,c)}else{u.beginPath();const e=0,s=p/2-n/2,t=a,r=0;u.moveTo(e,s),u.lineTo(t,r);const i=0,o=p/2+n/2,l=a,c=p;u.moveTo(i,o),u.lineTo(l,c)}return u.strokeStyle="#ddd",u.stroke(),S("div",{bind:h,afterCreate:G,styles:o?{display:"flex",marginTop:`-${c?0:d?l/2:0}px`,marginBottom:`-${c?n:d?n/2:0}px`}:{display:"flex",marginRight:`-${c?0:d?l/2:0}px`,marginLeft:`-${c?0:d?n/2:0}px`}})}_renderSizeRamp(e,s){const t=e.infos,r=t[0].label,i=t[t.length-1].label;let o=t[0].preview,l=t[t.length-1].preview;const n=this._hasIndicators,a={"flex-direction":n?"column":"row-reverse"};o&&(o=o.cloneNode(!0),o.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");const p={opacity:null!=s?`${s}`:""};return S("div",{class:this.classes(Z,{"esri-legend--card__size-ramp-row":n})},S("div",{class:J},n?r:i),S("div",{class:"esri-legend--card__size-ramp-container",styles:a},S("div",{bind:o,afterCreate:G,class:"esri-legend--card__size-ramp-preview",styles:p}),this._renderSizeRampLines(e),S("div",{bind:l,afterCreate:G,class:"esri-legend--card__size-ramp-container",styles:p})),S("div",{class:J},n?i:r))}_renderLegendForRamp(e,s,t){const r=e.infos,i="heatmap-ramp"===e.type,o=r.length-1,l=o>2&&!i?25*o:100,n=l+20,a=r.slice(0).reverse();a.forEach(((e,s)=>{e.offset=i?e.ratio:s/o}));const p=a.length-1,c=a.length%2!=0&&a[a.length/2|0],d=c&&S("div",{class:"esri-legend--card__interval-separators-container"},S("div",{class:"esri-legend--card__interval-separator"},"|"),S("div",{class:J},c.label)),m=r[r.length-1].label,h=r[0].label,u=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:a[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:l,height:25},fill:{type:"linear",x1:10,y1:0,x2:l+10,y2:0,colors:a},stroke:{width:0}},{shape:{type:"path",path:`M${l+10} 0 L${n} 12.5 L${l+10} 25 Z`},fill:a[p].color,stroke:{width:0}}]],y=j(u,n,25),{messages:g}=this,v={filter:k(t),opacity:null==s?null:`${s}`};return S("div",{class:Z,styles:{justifyContent:"center"}},S("div",{class:J},i?g[m]:m),S("div",{class:"esri-legend--card__symbol-container"},S("div",{styles:v},y),d),S("div",{class:J},i?g[h]:h))}};e([l()],re.prototype,"activeLayerInfos",void 0),e([l()],re.prototype,"headingLevel",void 0),e([l()],re.prototype,"layout",void 0),e([l(),E("esri/widgets/Legend/t9n/Legend")],re.prototype,"messages",void 0),e([l(),E("esri/t9n/common")],re.prototype,"messagesCommon",void 0),e([l({readOnly:!0})],re.prototype,"type",void 0),e([l()],re.prototype,"view",void 0),e([z()],re.prototype,"_selectSection",null),re=e([a("esri.widgets.Legend.styles.Card")],re);const ie=re,oe="esri-legend__layer-cell esri-legend__layer-cell--info",le="esri-legend__symbol",ne={display:"flex",alignItems:"flex-start"},ae={marginLeft:"3px"},pe={display:"table-cell",verticalAlign:"middle"};let ce=class extends p{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return S("div",null,s&&s.length?s:S("div",{class:"esri-legend__message"},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`esri-legend__${e.layer.uid}-version-${e.version}`,r=e.title?x({level:this.headingLevel,class:this.classes("esri-widget__heading","esri-legend__service-label")},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return S("div",{key:t,class:this.classes("esri-legend__service","esri-legend__group-layer")},r,s)}{const s=e.legendElements;if(s&&!s.length)return null;const i=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList))).filter((e=>!!e));if(!i.length)return null;const o={"esri-legend__group-layer-child":!!e.parent};return S("div",{key:t,class:this.classes("esri-legend__service",o),tabIndex:0},r,S("div",{class:"esri-legend__layer"},i))}}_renderLegendForElement(e,s,t,r){const i="color-ramp"===e.type,o="opacity-ramp"===e.type,l="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||l){const r=e.infos.map((r=>this._renderLegendForElementInfo(r,s,t,l,e.legendType))).filter((e=>!!e));r.length&&(n=S("div",{class:"esri-legend__layer-body"},r))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?n=A(e,this.id,s.opacity,t):"pie-chart-ramp"===e.type?n=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,s.opacity,t));if(!n)return null;const a=e.title;let p=null;if("string"==typeof a)p=a;else if(a){const e=Q(this.messages,a,i||o);p=X(0,i||o)&&a.title?`${a.title} (${e})`:e}const c=r?"esri-legend__layer-child-table":"esri-legend__layer-table",d=p?S("div",{class:"esri-legend__layer-caption"},p):null,m={"esri-legend__layer-table--size-ramp":l||!r};return S("div",{class:this.classes(c,m)},d,n)}_renderPieChartRamp(e){return S("div",{bind:e.preview,afterCreate:G})}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:r,colorRampElement:i}=H(e,s);if(!r)return null;const o=q(r,"above",!0),l=q(r,"below",!0),n=O(i,{width:12,height:o,rampAlignment:"vertical",opacity:s,type:"above",effectList:t}),a=O(i,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"below",effectList:t}),p=T(r),c=r.infos.map((e=>e.label)),d=c.map(((e,s)=>{const t=2===s;return 0===s?S("div",{key:s,class:e?n?"esri-univariate-above-and-below-ramp__label":"esri-legend__ramp-label":null},e):t?S("div",null):null})),m=c.length-1,h=Math.floor(c.length/2),u=c.map(((e,s)=>s===h||s===m?S("div",{key:s,class:e?n?"esri-univariate-above-and-below-ramp__label":"esri-legend__ramp-label":null},e):null)),y={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${p}px`},v={height:`${o}px`},f={height:`${l}px`};return S("div",{key:"univariate-above-and-below-ramp-preview",styles:ne},S("div",{class:"esri-legend__layer-body"},r.infos.map(((e,s)=>S("div",{class:this.classes("esri-legend__layer-row","esri-legend__size-ramp")},S("div",{class:le,styles:y,bind:e.preview,afterCreate:G}),n||s%2!=0?null:S("div",{class:oe},c[s]))))),n?S("div",{styles:g,key:"color-ramp-preview"},S("div",{styles:ae},S("div",{styles:pe},S("div",{class:"esri-legend__ramps",bind:n,afterCreate:G})),S("div",{styles:pe},S("div",{class:"esri-legend__ramp-labels",styles:v},d))),S("div",{styles:ae},S("div",{styles:pe},S("div",{class:"esri-legend__ramps",bind:a,afterCreate:G})),S("div",{styles:pe},S("div",{class:"esri-legend__ramp-labels",styles:f},u)))):null)}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:r,colorRampElement:i}=W(e);if(!r)return null;const o=T(r),l=q(r,"full",!1),n=O(i,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"full",effectList:t}),a=r.infos.length-1,p=r.infos.map(((e,s)=>0===s||s===a?S("div",{key:s,class:e.label?i?"esri-univariate-above-and-below-ramp__label":"esri-legend__ramp-label":null},e.label):null)),c={display:"table-cell",verticalAlign:"middle"},d={marginTop:`${o}px`},m={height:`${l}px`};return S("div",{key:"univariate-above-and-below-ramp-preview",styles:ne},S("div",{class:"esri-legend__layer-body"},r.infos.map((e=>S("div",{class:this.classes("esri-legend__layer-row","esri-legend__size-ramp")},S("div",{class:le,styles:c,bind:e.preview,afterCreate:G}))))),S("div",{styles:d,key:"color-ramp-preview"},S("div",{styles:ae},S("div",{styles:pe},S("div",{class:"esri-legend__ramps",bind:n,afterCreate:G})),S("div",{styles:pe},S("div",{class:"esri-legend__ramp-labels",styles:m},p)))))}_renderLegendForRamp(e,s){const t=e.infos,r="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,o="stretch-ramp"===e.type,l=e.preview,n=r?"esri-legend__opacity-ramp":"";l.className=`esri-legend__color-ramp ${n}`,null!=s&&(l.style.opacity=s.toString());const a=t.map((e=>S("div",{class:e.label?"esri-legend__ramp-label":null},i?this.messages[e.label]||e.label:o?this._getStretchStopLabel(e):e.label))),p={height:l.style.height};return S("div",{class:"esri-legend__layer-row"},S("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},S("div",{class:"esri-legend__ramps",bind:l,afterCreate:G})),S("div",{class:oe},S("div",{class:"esri-legend__ramp-labels",styles:p},a)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:R(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,s,t,r,i){if(e.type)return this._renderLegendForElement(e,s,t,!0);let o=null;const l=Y(s,i);if(e.preview?o=S("div",{class:le,bind:e.preview,afterCreate:G}):e.src&&(o=this._renderImage(e,s,l)),!o)return null;const n={"esri-legend__imagery-layer-info--stretched":l},a={"esri-legend__imagery-layer-info--stretched":l,"esri-legend__size-ramp":!l&&r};return S("div",{class:"esri-legend__layer-row"},S("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",a)},o),S("div",{class:this.classes(oe,n)},Q(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:r,src:i,opacity:o}=e,l={"esri-legend__imagery-layer-image--stretched":t,[le]:!t},n={opacity:`${null!=o?o:s.opacity}`};return S("img",{alt:Q(this.messages,r,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}};e([l()],ce.prototype,"activeLayerInfos",void 0),e([l()],ce.prototype,"headingLevel",void 0),e([l(),E("esri/widgets/Legend/t9n/Legend")],ce.prototype,"messages",void 0),e([l({readOnly:!0})],ce.prototype,"type",void 0),ce=e([a("esri.widgets.Legend.styles.Classic")],ce);const de=ce;let me=class extends p{constructor(e,t){super(e,t),this._handles=new s,this.headingLevel=3,this.iconClass="esri-icon-layer-list",this.messages=null,this.style=new de,this.viewModel=new c}initialize(){this.addHandles([i((()=>this.view),"resize",(()=>this.scheduleRender())),i((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),r((()=>this.headingLevel),(e=>{const{style:s}=this;s&&(s.headingLevel=e)})),r((()=>this.style),((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),o)])}destroy(){this._handles=t(this._handles)}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof ie||e instanceof de)return e;if("string"==typeof e)return"card"===e?new ie:new de;if(e&&"string"==typeof e.type){const s={...e};return delete s.type,new("card"===e.type?ie:de)(s)}return new de}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return S("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof de?"esri-widget--panel":null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=r((()=>e.version),(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const t=i((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),o);this._handles.add(t,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([l()],me.prototype,"activeLayerInfos",null),e([l()],me.prototype,"basemapLegendVisible",null),e([l()],me.prototype,"groundLegendVisible",null),e([l()],me.prototype,"headingLevel",void 0),e([l()],me.prototype,"hideLayersNotInCurrentView",null),e([l()],me.prototype,"keepCacheOnDestroy",null),e([l()],me.prototype,"respectLayerVisibility",null),e([l()],me.prototype,"iconClass",void 0),e([l()],me.prototype,"label",null),e([l()],me.prototype,"layerInfos",null),e([l(),E("esri/widgets/Legend/t9n/Legend")],me.prototype,"messages",void 0),e([l()],me.prototype,"style",void 0),e([n("style")],me.prototype,"castStyle",null),e([l()],me.prototype,"view",null),e([l()],me.prototype,"viewModel",void 0),me=e([a("esri.widgets.Legend")],me);const he=me;export{he as default};
