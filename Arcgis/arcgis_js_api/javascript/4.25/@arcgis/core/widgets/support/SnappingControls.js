/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{d as t,a as s,u as i}from"../../chunks/maybe.js";import{g as n}from"../../chunks/watch.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import{cast as l}from"../../core/accessorSupport/decorators/cast.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import a from"../Widget.js";import"../../chunks/widgetUtils.js";import{m as c}from"../../chunks/messageBundle.js";import{t as p}from"../../chunks/jsxFactory.js";import d from"./SnappingControls/SnappingControlsViewModel.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../core/promiseUtils.js";import"../../chunks/object.js";import"../../core/Error.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../chunks/metadata.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Evented.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../core/Promise.js";import"../../core/reactiveUtils.js";import"../../chunks/uuid.js";import"../../chunks/projector.js";import"../../chunks/jsxWidgetSupport.js";import"../../core/HandleOwner.js";import"../../chunks/WatchUpdatingTracking.js";import"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../../chunks/layerListUtils.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../LayerList/LayerListViewModel.js";import"../LayerList/ListItem.js";import"../../core/Identifiable.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../chunks/ActionSlider.js";import"../../support/actions/ActionToggle.js";import"../LayerList/ListItemPanel.js";import"./widget.js";import"../../chunks/accessibleHandler.js";import"../../chunks/vmEvent.js";import"../../chunks/themeUtils.js";const h={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0};let m=class extends a{constructor(e,t){super((()=>{const{view:t,viewModel:s,snappingOptions:i,...n}=e;return n})(),t),this._layerListFilter=null,this.messages=null,this.messagesCommon=null,this.visibleElements={...h},this._defaultViewModel=null,e?.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new d({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=t(this._defaultViewModel)}loadDependencies(){return Promise.all([import("../../chunks/calcite-accordion.js"),import("../../chunks/calcite-accordion-item.js"),import("../../chunks/calcite-block.js"),import("../../chunks/calcite-checkbox.js"),import("../../chunks/calcite-input.js"),import("../../chunks/calcite-label.js"),import("../../chunks/calcite-list.js"),import("../../chunks/calcite-list-item.js"),import("../../chunks/calcite-panel.js"),import("../../chunks/calcite-switch.js")])}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&((s(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=t(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...h,...e}}render(){const{label:e,visibleElements:{header:t}}=this;return p("div",{"aria-label":e,class:this.classes("esri-snapping-controls","esri-widget")},p("div",{class:"esri-snapping-controls__container"},t?this.renderHeaderView():this.renderContent()))}renderHeaderView(){return p("calcite-panel",{heading:this.label,class:"esri-snapping-controls__panel"},this.renderContent())}renderContent(){return[this.renderToggles(),this.renderLayerList()]}renderToggles(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:s}}=this;if(e||t||s)return p("calcite-block",{class:"esri-snapping-controls__toggle-block",key:"toggle-block",heading:"",open:!0},this.renderEnabledToggle(),p("div",{class:"esri-snapping-controls__nested-container"},this.renderSelfEnabledToggle(),this.renderFeatureEnabledToggle()))}renderEnabledToggle(){if(!this.visibleElements.enabledToggle)return;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:s}}}=this;return p("calcite-label",{layout:"inline-space-between"},e,p("calcite-switch",{checked:t,disabled:s,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}renderSelfEnabledToggle(){if(!this.visibleElements.selfEnabledToggle)return;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:s,enabledToggled:i}}}=this;return p("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,p("calcite-switch",{checked:s,disabled:i||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))}renderFeatureEnabledToggle(){if(!this.visibleElements.featureEnabledToggle)return;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:s,enabledToggled:i}}}=this;return p("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,p("calcite-switch",{checked:s,disabled:i||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))}renderLayerList(){if(!this.visibleElements.layerList)return;const{messages:e,messagesCommon:t}=this,s=this.viewModel.layerListViewModel.operationalItems.length>9?p("calcite-input",{class:"esri-snapping-controls__layer-list__filter",clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i")}):null;return p("calcite-block",{key:"list-block","intl-collapse":t?.collapse,"intl-expand":t?.expand,heading:e.snappingLayers,class:"esri-snapping-controls__layer-list-block",open:!0,collapsible:!0},s,p("calcite-list",{class:"esri-snapping-controls__layer-list"},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems,i(this._layerListFilter))))}renderLayerListItemCollection(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e);const s=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return s.length>0?this.renderLayerListItemGroup(e,s):null})).toArray()}renderLayerListItem(e){const{messages:{untitledLayer:t}}=this,s=e.title||t,i=e.enabled,n=p("calcite-checkbox",{value:e.layer.id,checked:i,bind:this,onCalciteCheckboxChange:e=>this._handleLayerListItemChange(e.target)});return p("calcite-list-item",{key:`${this.id}-list-item-${e.uid}`,onclick:()=>{const e=!n.properties.checked;this._handleLayerListItemChange({checked:e,value:n.properties.value})}},p("calcite-label",{class:"esri-snapping-controls__layer-list__item",slot:"content-start",tabIndex:-1,layout:"inline","disable-spacing":"true"},p("div",{class:"esri-snapping-controls__layer-list__item__checkbox"},n),p("div",{class:"esri-snapping-controls__layer-list__item__label"},s)))}renderLayerListItemGroup(e,t){const s=e.title||this.messages.untitledLayer,i=e.title&&""!==e.title?e.title:n(),r=!!t,l=t??e.children;return p("calcite-list-item",{key:i},p("calcite-accordion",{"icon-position":"start",appearance:"transparent",afterCreate:e=>{e.append(...Array.from(e.children).map((e=>(e.remove(),e))))}},p("calcite-accordion-item",{active:r,"item-title":s,key:e.uid},p("calcite-list",null,[...this.renderLayerListItemCollection(l)]))))}_enableSnappingSwitchChange(e){this.snappingOptions.enabled=e.target.checked}_featureEnabledSwitchChange(e){this.snappingOptions.featureEnabled=e.target.checked}_itemTitleMatchesFilter(e,t){return t.test(e.title)}_selfEnabledSwitchChange(e){this.snappingOptions.selfEnabled=e.target.checked}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}};e([r()],m.prototype,"_layerListFilter",void 0),e([r()],m.prototype,"label",null),e([r(),c("esri/widgets/support/SnappingControls/t9n/SnappingControls")],m.prototype,"messages",void 0),e([r(),c("esri/t9n/common")],m.prototype,"messagesCommon",void 0),e([r()],m.prototype,"snappingOptions",null),e([r()],m.prototype,"view",null),e([r()],m.prototype,"viewModel",null),e([r()],m.prototype,"visibleElements",void 0),e([l("visibleElements")],m.prototype,"castVisibleElements",null),m=e([o("esri.widgets.support.SnappingControls")],m);const g=m;export{g as default};
