/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{a as s}from"../core/promiseUtils.js";import{HandleOwnerMixin as o}from"../core/HandleOwner.js";import{L as i}from"../chunks/Logger.js";import{i as l}from"../chunks/maybe.js";import{on as r,watch as n}from"../core/reactiveUtils.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{cast as m}from"../core/accessorSupport/decorators/cast.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import c from"./Widget.js";import d from"./FeatureTable/FeatureTableViewModel.js";import u from"./FeatureTable/Grid/support/ButtonMenu.js";import h from"./FeatureTable/Grid/support/ButtonMenuItem.js";import{H as g}from"../chunks/Heading.js";import"../chunks/widgetUtils.js";import{m as b}from"../chunks/messageBundle.js";import{t as j}from"../chunks/jsxFactory.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/ensureType.js";import"../chunks/WatchUpdatingTracking.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/layerViewUtils.js";import"./FeatureTable/Grid/Column.js";import"./FeatureTable/FieldColumn.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"./FeatureForm/InputField.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./FeatureTable/Grid/EditorColumn.js";import"../chunks/uriUtils.js";import"./support/DatePicker.js";import"./support/DatePickerViewModel.js";import"./support/DateTimeElementViewModel.js";import"../chunks/Popover.js";import"../chunks/accessibleHandler.js";import"../chunks/datetime.js";import"./support/TimePicker.js";import"./support/TimePickerViewModel.js";import"./FeatureTable/Grid/GroupColumn.js";import"../rest/support/AttachmentQuery.js";import"./FeatureTable/Grid/support/ButtonMenuViewModel.js";const y={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0,deleteSelection:!0},selectionColumn:!0,columnMenus:!0},w=i.getLogger("esri.widgets.FeatureTable");let v=class extends(o(c)){constructor(e,t){super(e,t),this._prompt=null,this.menu=null,this.menuConfig=null,this.viewModel=new d,this.visibleElements={...y},this._showDeletePrompt=this._showDeletePrompt.bind(this),this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.handles.add([r((()=>this.viewModel.columns),"change",(()=>this._syncMenuConfig())),r((()=>this.viewModel.activeFilters),"change",(()=>this._syncMenuConfig())),r((()=>this.highlightIds),"change",(e=>{this._syncMenuConfig(),this._onSelectionChange(e)})),n((()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled]),(()=>this.scheduleRender())),n((()=>[this.menuConfig,this.editingEnabled]),(()=>this._syncMenuConfig())),n((()=>this.messages),(()=>{this.menu.label=this.messages?.options,this._syncMenuConfig()}))]),this._set("menu",new u({label:this.messages?.options,iconClass:"esri-icon-handle-horizontal",...this.menuConfig}));const{attachmentsEnabled:e,relatedRecordsEnabled:t}=this;this.viewModel?.store?.set({attachmentsEnabled:e,relatedRecordsEnabled:t})}loadDependencies(){return Promise.all([import("../chunks/calcite-scrim.js"),import("../chunks/calcite-button.js"),import("../chunks/calcite-icon.js")])}destroy(){this._prompt=null,this.handles.removeAll(),this.menu?.destroy()}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(e){this.viewModel.attachmentsEnabled=e}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(e){this.viewModel.autoRefreshEnabled=e}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(e){this.viewModel.columnReorderingEnabled=e}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(e){this.viewModel.editingEnabled=e}get fieldConfigs(){return this.viewModel.fieldConfigs}set fieldConfigs(e){this.viewModel.fieldConfigs=e}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(e){this.viewModel.filterGeometry=e}get grid(){return this.viewModel.grid}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(e){this.viewModel.hiddenFields=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(e){this.viewModel.highlightIds=e}get highlightOnRowSelectEnabled(){return this.viewModel.highlightEnabled}set highlightOnRowSelectEnabled(e){this.viewModel.highlightEnabled=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get messages(){return this.viewModel.messages}set messages(e){this.viewModel.messages=e}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(e){this.viewModel.messagesCommon=e}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(e){this.viewModel.messagesURIUtils=e}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(e){this.viewModel.multiSortEnabled=e}get pageSize(){return this.viewModel.pageSize}set pageSize(e){this.viewModel.pageSize=e}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(e){this.viewModel.relatedRecordsEnabled=e}get state(){return this.viewModel.state}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(e){this.viewModel.tableTemplate=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){const t={...y,...e};return this.grid?.set("visibleElements",{...this.grid.visibleElements,selectionColumn:t.selectionColumn,columnMenus:t.columnMenus}),t}clearHighlights(){return s(w,"`FeatureTable.clearHighlights` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"}),this.viewModel.clearHighlights()}clearSelection(){return s(w,"`FeatureTable.clearSelection` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"}),this.viewModel.clearSelection()}clearSelectionFilter(){return this.viewModel.clearSelectionFilter()}deleteSelection(e){return this.highlightIds.length?e?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}deselectRows(e){return this.viewModel.deselectRows(e)}filterBySelection(){return this.viewModel.filterBySelection()}findColumn(e){return this.viewModel.findColumn(e)}hideColumn(e){this.grid?.hideColumn(e),this._syncMenuConfig()}refresh(){return this.viewModel.refresh()}showAllColumns(){return this.viewModel.showAllColumns()}showColumn(e){this.grid?.showColumn(e),this._syncMenuConfig()}sortColumn(e,t){return this.viewModel.sortColumn(e,t)}selectRows(e){return this.viewModel.selectRows(e)}scrollToIndex(e){return this.viewModel.scrollToIndex(e)}zoomToSelection(){return this.viewModel.zoomToSelection()}render(){const{_prompt:e}=this,t=l(e)?j("calcite-scrim",null,this.renderPrompt(e)):null;return j("div",{bind:this,class:this.classes("esri-feature-table","esri-widget")},this.visibleElements.header?this._renderHeader():null,j("div",{class:"esri-feature-table__content"},"disabled"!==this.state&&this.grid?.render()),t)}renderPrompt({title:e,message:t,context:s,actions:o}){const i=!!o.secondary,l=j("calcite-button",{appearance:"solid",color:"danger"===s?"red":"blue",width:i?"half":"full",onclick:o.primary.action,key:"prompt-primary-button"},o.primary.label),r=i?j("calcite-button",{appearance:"clear",color:"danger"===s?"red":"blue",width:"half",onclick:o.secondary.action,key:"prompt-secondary-button"},o.secondary.label):null;return j("div",{class:`esri-feature-table__prompt--${s}`},j("div",{class:"esri-feature-table__prompt__header"},j("calcite-icon",{icon:"exclamation-mark-triangle"}),j(g,{class:"esri-feature-table__prompt__header__heading",level:2},e)),j("div",{class:"esri-feature-table__prompt__message"},t),j("div",{class:"esri-feature-table__prompt__divider"}),j("div",{class:"esri-feature-table__prompt__actions"},r,l))}_renderHeader(){return j("div",{key:"header",class:"esri-feature-table__header"},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)}_renderTitle(){return j("div",{class:"esri-feature-table__title",key:"title"},this._getTitle())}_getTitle(){const{grid:e,highlightIds:s,layer:o,messages:i,viewModel:{size:l}}=this;return e&&o?t(i.header,{title:o.title,count:l,selected:s.length||0}):""}_renderLoader(){const{state:e,store:t}=this.viewModel,s="loading"===e||t.syncing||t.querying;return j("div",{class:"esri-feature-table__loader-container"},s?j("div",{class:"esri-feature-table__loader",key:"loader"}):null)}_renderMenu(){return j("div",{class:"esri-feature-table__menu"},this.menu.render())}_onSelectionChange(e){const{added:t,removed:s}=e,o=t.map((e=>this.viewModel.store.getLocalItemByKey(e)||{objectId:e,feature:null,attachments:null,relatedRecords:null})),i=s.map((e=>this.viewModel.store.getLocalItemByKey(e)||{objectId:e,feature:null,attachments:null,relatedRecords:null}));this.emit("selection-change",{added:o,removed:i})}_syncMenuConfig(){this.menu?.set({...this.menuConfig,items:this._getMenuItems()})}_getMenuItems(){const e=this.menuConfig?.items,t=this._getDefaultMenuItems(),s=[];return t?.length&&s.push(...t),e?.length&&s.push(...e),s}_getDefaultMenuItems(){const{highlightIds:e,messages:t,viewModel:s,visibleElements:o}=this,{menuItems:i}=o,l=[];if(i?.refreshData&&l.push(new h({selectionEnabled:!1,label:t?.refreshData,clickFunction:()=>this.refresh()})),e.length){const s=this._getSelectionFilter();if(i?.clearSelection&&l.push(new h({selectionEnabled:!1,label:t?.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()})),i?.zoomToSelection&&this.view&&l.push(new h({selectionEnabled:!1,label:t?.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()})),i?.selectedRecordsShowSelectedToggle&&(!s||e.length!==s.objectIds.length)){const e=t.showSelected,s=new h({selectionEnabled:!1,label:e,clickFunction:()=>{this.filterBySelection(),s.set("label",e)}});l.push(s)}i?.deleteSelection&&this.editingEnabled&&this.layer?.capabilities?.operations?.supportsDelete&&l.push(new h({selectionEnabled:!1,label:t.deleteSelection,clickFunction:this._showDeletePrompt}))}if(i?.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const e=t.showAllRecords,s=new h({selectionEnabled:!1,label:e,clickFunction:()=>{this.clearSelectionFilter(),s.set("label",e)}});l.push(s)}return i?.toggleColumns&&l.push(new h({iconClass:"esri-icon-right",label:t?.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:s?.columns?.items.map((({header:e,hidden:t,path:s})=>new h({label:e||s,selected:!t,selectionEnabled:!0,iconClass:"esri-icon-check-mark",clickFunction:()=>this._toggleColumnFromMenuItem(s)})))})),l.length?l:null}_toggleMenuItemSelectedIcon({item:e}){e?.set("iconClass",e?.selected?"esri-icon-down":"esri-icon-right")}_toggleColumnFromMenuItem(e){const{grid:t,viewModel:s}=this;s.findColumn(e)?.hidden?t.showColumn(e):t.hideColumn(e)}_showDeletePrompt(){const{messages:e,messagesCommon:s}=this,o=this.highlightIds.length||0,i=t(e.deleteSelectionCount,{count:o});this.menu.open=!1,this._prompt={title:i,message:e.deleteRecordsRemoved,context:"danger",actions:{primary:{label:s.delete,action:this._onDeleteSelectionClick},secondary:{label:e.keepRecords,action:()=>this._prompt=null}}}}async _onDeleteSelectionClick(){await this.viewModel.deleteSelection(),this._prompt=null}_getSelectionFilter(){return this.viewModel.activeFilters?.find((e=>"selection"===e.type))}_hasSelectionFilter(){return!!this._getSelectionFilter()}};e([a({readOnly:!0})],v.prototype,"activeFilters",null),e([a({readOnly:!0})],v.prototype,"activeSortOrders",null),e([a()],v.prototype,"attachmentsEnabled",null),e([a()],v.prototype,"autoRefreshEnabled",null),e([a()],v.prototype,"columnReorderingEnabled",null),e([a({readOnly:!0})],v.prototype,"columns",null),e([a()],v.prototype,"editingEnabled",null),e([a()],v.prototype,"fieldConfigs",null),e([a()],v.prototype,"filterGeometry",null),e([a({readOnly:!0})],v.prototype,"grid",null),e([a()],v.prototype,"hiddenFields",null),e([a()],v.prototype,"highlightEnabled",null),e([a()],v.prototype,"highlightIds",null),e([a()],v.prototype,"highlightOnRowSelectEnabled",null),e([a()],v.prototype,"label",null),e([a()],v.prototype,"layer",null),e([a(),b("esri/widgets/FeatureTable/t9n/FeatureTable")],v.prototype,"messages",null),e([a(),b("esri/t9n/common")],v.prototype,"messagesCommon",null),e([a(),b("esri/widgets/support/t9n/uriUtils")],v.prototype,"messagesURIUtils",null),e([a({readOnly:!0})],v.prototype,"menu",void 0),e([a()],v.prototype,"menuConfig",void 0),e([a()],v.prototype,"multiSortEnabled",null),e([a()],v.prototype,"pageSize",null),e([a()],v.prototype,"relatedRecordsEnabled",null),e([a({readOnly:!0})],v.prototype,"state",null),e([a()],v.prototype,"tableTemplate",null),e([a()],v.prototype,"timeExtent",null),e([a()],v.prototype,"view",null),e([a()],v.prototype,"viewModel",void 0),e([a()],v.prototype,"visibleElements",void 0),e([m("visibleElements")],v.prototype,"castVisibleElements",null),v=e([p("esri.widgets.FeatureTable")],v);const M=v;export{M as default};
