/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{isAbortError as s,o as r,d as o,p as i}from"../core/promiseUtils.js";import{L as n}from"../chunks/Logger.js";import{a,i as l,u as p,o as c}from"../chunks/maybe.js";import{watch as u,initial as m,when as d,on as h}from"../core/reactiveUtils.js";import{property as v}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{cast as _}from"../core/accessorSupport/decorators/cast.js";import{subclass as g}from"../core/accessorSupport/decorators/subclass.js";import{d as y}from"../chunks/defaultUnit.js";import j from"../rest/support/Stop.js";import S from"../symbols/SimpleMarkerSymbol.js";import b from"./Search.js";import k from"./Widget.js";import f from"./Directions/DirectionsViewModel.js";import"../chunks/ensureType.js";import w from"../portal/Portal.js";import"../chunks/widgetUtils.js";import{m as M}from"../chunks/messageBundle.js";import{t as C}from"../chunks/jsxFactory.js";import{c as I,t as D}from"../chunks/quantityUtils.js";import{f as T}from"../chunks/unitFormatUtils.js";import{a as L,f as P,c as $}from"../chunks/number.js";import{g as R}from"../chunks/assets.js";import{i as U,m as B}from"./Search/LocatorSearchSource.js";import x from"./support/DatePicker.js";import{H as E,i as A}from"../chunks/Heading.js";import H from"./support/TimePicker.js";import{a as O}from"../chunks/accessibleHandler.js";import{S as z}from"../chunks/sortable.esm.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonMap.js";import"../chunks/handleUtils.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../geometry/SpatialReference.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/writer.js";import"../chunks/Ellipsoid.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/utils9.js";import"../chunks/networkEnums.js";import"./Search/SearchResultRenderer.js";import"./Search/SearchViewModel.js";import"../chunks/layerViewUtils.js";import"./Search/LayerSearchSource.js";import"./Search/SearchSource.js";import"../chunks/FullTextSearch.js";import"../chunks/geometryUtils3.js";import"../chunks/scaleUtils.js";import"../chunks/geolocationUtils.js";import"../chunks/trimExtend.js";import"../rest/support/GeneralizeParameters.js";import"../rest/support/LengthsParameters.js";import"../rest/support/OffsetParameters.js";import"../chunks/project.js";import"../chunks/utils4.js";import"../chunks/utils5.js";import"../rest/support/ProjectParameters.js";import"../rest/support/RelationParameters.js";import"../rest/support/TrimExtendParameters.js";import"./support/GoTo.js";import"../chunks/vmEvent.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/analysisThemeUtils.js";import"../views/support/colorUtils.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../layers/RouteLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils2.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/originUtils.js";import"../chunks/multiOriginJSONSupportUtils.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../chunks/OperationalLayer.js";import"../chunks/commonProperties.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../support/timeUtils.js";import"../layers/mixins/PortalLayer.js";import"../chunks/asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/arcgisLayerUrl.js";import"../layers/support/RouteSymbols.js";import"../layers/support/RouteStopSymbols.js";import"../chunks/portalItemUtils.js";import"../rest/networkService.js";import"../rest/support/TravelMode.js";import"../rest/route.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../rest/support/RouteSolveResult.js";import"../rest/support/NAMessage.js";import"../rest/support/GPMessage.js";import"../rest/support/RouteResult.js";import"../rest/support/DirectionsFeatureSet.js";import"../rest/support/DirectionsFeature.js";import"../rest/support/DirectionsEvent.js";import"../rest/support/DirectionLine.js";import"../rest/support/DirectionPoint.js";import"../rest/support/PointBarrier.js";import"../rest/support/PolygonBarrier.js";import"../rest/support/PolylineBarrier.js";import"../rest/support/RouteInfo.js";import"../rest/support/RouteParameters.js";import"../chunks/commonProperties3.js";import"../rest/support/DataLayer.js";import"../rest/support/NetworkFeatureSet.js";import"../rest/support/NetworkUrl.js";import"../chunks/byteSizeEstimations.js";import"../chunks/Cyclical.js";import"../chunks/suggestLocations.js";import"../rest/support/AddressCandidate.js";import"./support/DatePickerViewModel.js";import"./support/DateTimeElementViewModel.js";import"../chunks/Popover.js";import"../chunks/datetime.js";import"./support/TimePickerViewModel.js";const F="esri-save-layer",V={panel:`${F}`,error:`${F}__error`,errorIcon:`${F}__error-icon`,errorLabel:`${F}__error-label`,layerNameLabel:`${F}__layer-name-label`,portalFolderLabel:`${F}__portal-folder-label`,processLabel:`${F}__process-label`,processLoader:`${F}__process-loader`};let N=class extends k{constructor(e,t){super(e,t),this._folders=null,this._layer=null,this._userName=null,this.messages=null,this.messagesCommon=null,this.messagesIdentity=null,this.opened=!1,this.state="initialized"}loadDependencies(){return Promise.all([import("../chunks/calcite-button.js"),import("../chunks/calcite-combobox.js"),import("../chunks/calcite-combobox-item.js"),import("../chunks/calcite-icon.js"),import("../chunks/calcite-input.js"),import("../chunks/calcite-label.js"),import("../chunks/calcite-loader.js"),import("../chunks/calcite-panel.js")])}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}close(){this.opened=!1,this.state="initialized"}async open(e){this.state="initialized",this.opened=!0,this._layer=e,this.state="connect-to-portal";const t=w.getDefault();try{await t._signIn()}catch(e){return void(s(e)||"identity-manager:user-aborted"===e.name?this.close():this.state="connect-to-portal-error")}this.state="fetch-portal-information";const{user:r}=t;this._userName=r.username;try{this._folders=await r.fetchFolders()}catch{return void(this.state="fetch-portal-information-error")}this.state="save-layer"}render(){switch(this.state){case"initialized":return this._renderInitialized();case"connect-to-portal":return this._renderProcess(this.messagesIdentity.lblSigning);case"connect-to-portal-error":return this._renderError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderProcess(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayer();case"saving":return this._renderProcess(this.messages.processing.saving);case"saving-error":return this._renderError(this.messages.errors.saving)}}_renderError(e){return C("calcite-panel",{class:V.panel,heading:this.messages.widgetLabel,key:`${F}-error-panel`},C("div",{class:V.error},C("calcite-icon",{class:V.errorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messagesCommon.errorMessage}),C("calcite-label",{class:V.errorLabel},e)),C("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.close))}_renderInitialized(){return C("calcite-panel",{class:V.panel,heading:this.messages.widgetLabel,key:`${F}-initialize-panel`})}_renderProcess(e){return C("calcite-panel",{class:V.panel,heading:this.messages.widgetLabel,key:`${F}-process-panel`},C("calcite-loader",{class:V.processLoader,label:e,active:!0}),C("calcite-label",{class:V.processLabel,alignment:"center"},e))}_renderSaveLayer(){if(a(this._layer)||a(this._folders)||a(this._userName))return this._renderInitialized();const{stops:e}=this._layer,t=`${e.getItemAt(0).name} - ${e.getItemAt(e.length-1).name}`,s=this._folders.map((e=>C("calcite-combobox-item",{key:`${F}-folder-${e.id}`,"text-label":e.title,value:e.id})));return s.unshift(C("calcite-combobox-item",{key:`${F}-folder-home`,selected:!0,"text-label":`${this._userName} (${this.messagesCommon.home})`,value:null})),C("calcite-panel",{class:V.panel,heading:this.messages.widgetLabel,key:`${F}-save-panel`},C("calcite-label",{class:V.layerNameLabel},this.messages.laverName,C("calcite-input",{afterCreate:e=>{this._layerNameInput=e},label:this.messages.laverName,value:t})),C("calcite-label",{class:V.portalFolderLabel},this.messages.saveInFolder,C("calcite-combobox",{afterCreate:e=>{this._portalFolderCombobox=e},label:this.messages.saveInFolder,"overlay-positioning":"fixed","selection-mode":"single"},s)),C("calcite-button",{onclick:()=>this._saveButtonClick(),slot:"footer-actions",width:"half"},this.messagesCommon.save),C("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.cancel))}_saveButtonClick(){this.state="saving",this._saveLayer().then((()=>{this.close()})).catch((()=>{this.state="saving-error"}))}async _saveLayer(){if(a(this._layer)||a(this._folders))return;const e=this._layerNameInput.value,t=this._portalFolderCombobox.value,s=this._folders.find((e=>e.id===t));await this._layer.saveAs({title:e},{folder:s})}};function q(e,t){return L(e,{style:"unit",unit:t,unitDisplay:"short"})}function G(e,t,s){let r,o;const i=I(t,"meters");switch(s){case"metric":({value:r,unit:o}=function(e){return e.value<.01?D(e,"millimeters"):e.value<1?D(e,"centimeters"):e.value<1e3?D(e,"meters"):D(e,"kilometers")}(i));break;case"imperial":({value:r,unit:o}=function(e){return e.value<.254?D(e,"inches"):e.value<1609.344?D(e,"feet"):D(e,"miles")}(i));break;default:({value:r,unit:o}=D(i,s))}return 0===r?"":T(e,r,o,"metric"===s||"imperial"===s?0:2)}function W(e){if(0===e)return"";if(e<1)return q(Math.floor(60*e),"second");if(e<60)return q(Math.floor(e),"minute");const t=Math.floor(e/60),s=Math.floor(e%60);return 0===s?`${q(t,"hour")}`:`${q(t,"hour")} ${q(s,"minute")}`}e([v()],N.prototype,"label",null),e([v(),M("esri/widgets/support/t9n/SaveLayer")],N.prototype,"messages",void 0),e([v(),M("esri/t9n/common")],N.prototype,"messagesCommon",void 0),e([v(),M("esri/identity/t9n/identity")],N.prototype,"messagesIdentity",void 0),e([v()],N.prototype,"opened",void 0),e([v()],N.prototype,"state",void 0),N=e([g("esri.widgets.Directions.SaveLayer")],N);const K="esri-directions",Y={base:`${K} esri-widget esri-widget--panel`,directionsButton:`${K}__button`,clearRouteButton:`${K}__clear-route-button`,scroller:`${K}__scroller`,panelContent:`${K}__panel-content`,panelContentLoading:`${K}__panel-content--loading`,panelContentError:`${K}__panel-content--error`,panelContentSignIn:`${K}__panel-content--sign-in`,loader:`${K}__loader`,message:`${K}__message`,travelMode:`${K}__travel-modes`,travelModeSelect:`${K}__travel-modes-select`,departureTime:`${K}__departure-time`,departureTimeSelect:`${K}__departure-time-select`,directionsSection:`${K}__directions-section`,departureTimeControls:`${K}__departure-time-controls`,section:`${K}__section`,summary:`${K}__summary`,stopIcon:`${K}__stop-icon`,interactiveStopIcon:`${K}__stop-icon--interactive`,removeStopButton:`${K}__remove-stop`,removeStop:`${K}__remove-stop-icon`,reverseStops:`${K}__reverse-stops`,stopIconContainer:`${K}__stop-icon-container`,lastStopIconContainer:`${K}__stop-icon-container--last`,stopHandle:`${K}__stop-handle`,stopInput:`${K}__stop-input`,stopOptions:`${K}__stop-options`,stopHandleIcon:`${K}__stop-handle-icon`,verticalSplitter:`${K}__vertical-splitter`,stopRow:`${K}__stop-row`,stopRowGhost:`${K}__stop-row-ghost`,validStopRow:`${K}__stop-row--valid`,stops:`${K}__stops`,directionCosts:`${K}__costs`,costsDetails:`${K}__costs-details`,primaryCosts:`${K}__costs-value`,secondaryCosts:`${K}__other-costs-total`,routeActions:`${K}__route-actions`,maneuvers:`${K}__maneuvers`,maneuverList:`${K}__maneuver-list`,maneuverSection:`${K}__maneuver-section`,maneuverSectionHeader:`${K}__maneuver-section-header`,maneuverSectionHeaderButton:`${K}__maneuver-section-header-toggle-button`,maneuverSectionTitle:`${K}__maneuver-section-title`,collapsibleSection:`${K}__maneuver-section--collapsible`,maneuverSectionToggle:`${K}__maneuver-section-toggle`,maneuver:`${K}__maneuver`,maneuverActive:`${K}__maneuver--active`,maneuverCosts:`${K}__maneuver-costs`,maneuverCostsContainer:`${K}__maneuver-costs-container`,maneuverIcon:`${K}__maneuver-icon`,intermediateCost:`${K}__cost--intermediate`,horizontalSplitter:`${K}__horizontal-splitter`,sectionSplitter:`${K}__section-splitter`,disclaimer:`${K}__disclaimer`,signInContent:`${K}__sign-in-content`,signInButton:`${K}__sign-in-button`,contentTitle:`${K}__content-title`,warningCard:`${K}__warning-card`,warningHeader:`${K}__warning-header`,warningHeading:`${K}__warning-heading`,warningMessage:`${K}__warning-message`,saveSection:`${K}__save-section`,saveButtons:`${K}__save-buttons`,saveButton:`${K}__save-button`,saveAsButton:`${K}__save-as-button`,saveAsButtonPopover:`${K}__save-as-button-with-popover`,printButton:`${K}__print-button`,layerDetailsLink:`${K}__layer-details-link`,toolbarSection:`${K}__toolbar-section`,toolbarButtons:`${K}__toolbar-buttons`,addStopButton:`${K}__add-stop-button`,closeIcon:"esri-icon-up",handleIcon:"esri-icon-handle-vertical",lastStopIcon:"esri-icon-radio-checked",openIcon:"esri-icon-down",removeStopIcon:"esri-icon-trash",reverseStopIcon:"esri-icon-up-down-arrows",stopsIcon:"esri-icon-radio-unchecked",warningIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-directions",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",emptyContent:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",screenReaderText:"esri-icon-font-fallback-text",select:"esri-select"},J=new Map([["bear-left","bear-left"],["bear-right","bear-right"],["central-fork","fork-middle"],["door","walk-through-door"],["elevator","elevator"],["escalator","escalator"],["left-fork","fork-left"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["right-fork","fork-right"],["right-ramp","exit-highway-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","roundabout-left"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["u-turn","u-turn-left"]]);var Q;!function(e){e.NOW="now",e.DEPART_BY="depart-by",e.UNSPECIFIED="unspecified"}(Q||(Q={}));const X={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function Z(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}const ee=n.getLogger("esri.widgets.Directions");let te=class extends k{constructor(e,t){super(e,t),this._autoStopRemovalDelay=100,this._departureTime=Q.NOW,this._datePicker=new x,this._newPlaceholderStop=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new N,this._sections=null,this._stopsToSearches=new Map,this._timePicker=new H,this.headingLevel=2,this.iconClass=Y.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new f,this.visibleElements={...X},this._setUpDragAndDropStops=e=>{this._sortable=z.create(e,{draggable:`.${Y.validStopRow}`,ghostClass:Y.stopRowGhost,handle:`.${Y.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this.viewModel.layer.stops.forEach((e=>this._acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:r}=s,o=r[t],i=r[e],n=t-e<0;s.insertBefore(o,n?i.nextElementSibling:i);const a=this.viewModel.layer.stops;a.reorder(a.getItemAt(e),t);for(const e of a)e.sequence=null;this._getDirections()}}initialize(){this.addHandles([u((()=>this.viewModel.layer.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),m),d((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,this.removeHandles(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this.addHandles([r(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=500)),r(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=100)),t,s],e),this._pointerDownUpHandle=t,this._viewClickHandle=s}}),m),d((()=>a(this.viewModel.serviceDescription)),(()=>{try{this.viewModel.load()}catch{}}),m),u((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))}loadDependencies(){return Promise.all([import("../chunks/calcite-button.js"),import("../chunks/calcite-link.js"),import("../chunks/calcite-popover.js")])}destroy(){this._datePicker.destroy(),this._timePicker.destroy();for(const e of this._stopsToSearches.values())e.destroy();this._sortable&&this._sortable.destroy(),l(this._renderSavePopoverFunction)&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}set routeServiceUrl(e){o(ee,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url=e}get routeServiceUrl(){return o(ee,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url}set routeSymbol(e){o(ee,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines=e}get routeSymbol(){return o(ee,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines}set stopSymbols(e){o(ee,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops=e}get stopSymbols(){return o(ee,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...X,...e}}getDirections(){return this.viewModel.getDirections()}render(){return C("div",{class:this.classes(Y.base,Y.scroller)},this._renderPanelContent())}save(){return this.viewModel.layer.save()}saveAs(e,t={}){return this.viewModel.layer.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{viewModel:{serviceDescription:e,state:t}}=this,s="initializing"===t,r="error"===t&&!e,o="unauthenticated"===t,i={[Y.panelContentLoading]:s,[Y.panelContentError]:r,[Y.panelContentSignIn]:o},n=s?"presentation":"group",a=o?this._renderSignIn():r?this._renderMessage(this._getErrorMessage()):s?this._renderLoader():this._renderReadyContent();return C("div",{class:this.classes(Y.panelContent,i),role:n},a)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return C("div",{key:"sign-in",class:Y.signInContent},C(E,{class:Y.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),C(E,{level:A(this.headingLevel)},this.messages.signInRequired),C("button",{class:this.classes(Y.button,Y.buttonSecondary,Y.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}))}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=l(e)?e.name:this.messages.travelMode;return C("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Y.travelMode,this._saveLayer.opened&&Y.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},C("select",{"aria-label":s,bind:this,class:this.classes(Y.travelModeSelect,Y.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map((t=>{const s=l(e)&&t.id===e.id;return C("option",{key:`esri-directions__travel-mode-${t.id}`,"data-mode":t,selected:s,value:t.id},t.name)}))))}_handleTravelModeChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"],this._getDirections()}_renderStopsContainer(){return this.visibleElements.stops?C("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Y.section,this._saveLayer.opened&&Y.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const e=this._departureTime,{messages:t}=this,s=t.departureTime;return C("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Y.departureTime,this._saveLayer.opened&&Y.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},C("select",{"aria-label":s,bind:this,class:this.classes(Y.departureTimeSelect,Y.select),onchange:this._handleDepartureOptionChange,title:s},C("option",{value:Q.NOW,selected:e===Q.NOW},t.leaveNow),C("option",{value:Q.DEPART_BY,selected:e===Q.DEPART_BY},t.departBy),C("option",{value:Q.UNSPECIFIED,selected:e===Q.UNSPECIFIED},t.timeUnspecified)),e===Q.DEPART_BY?this._renderTimeControls():null)}_renderStops(){const e=this.viewModel.layer.stops;let s=0;for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);for(const t of e){const e=this._acquireSearch(t);"none"!==e.activeMenu&&(s+=1),l(t.name)&&(e.searchTerm=t.name)}const r=e.toArray().map(((r,o)=>{const i=e.length,n=o>1&&a(r.geometry),p={[Y.stopsIcon]:o>=0&&o<i-1,[Y.lastStopIcon]:o===i-1},c={[Y.lastStopIconContainer]:o===i-1},u={[Y.validStopRow]:!n},m=e.getItemAt(o+1),d=m&&l(m.geometry),h=o===i-1,v=o===i-2,_=2===i&&0===o||i>2&&!h&&!v||i>2&&v&&d||i>2&&h&&a(r.geometry),g=i<3,y=this._acquireSearch(r),{messages:j}=this,{removeStop:S,reverseStops:b,unlocated:k}=j,f=t(j.stopLabelTemplate,{number:o+1,label:l(r.geometry)?r.name:k}),w=`${this.id}__stop--${o}`,M=!!y.searchTerm&&!!y.selectedResult&&l(r.geometry)&&y.selectedResult.name===r.name,I={zIndex:"none"!==y.activeMenu?""+s--:""};return C("li",{"aria-label":f,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(Y.stopRow,u),id:w,key:o,"data-stop-index":o,styles:I},C("div",{class:Y.stopHandle},C("span",{"aria-hidden":"true",class:this.classes(Y.stopIcon,Y.handleIcon,Y.stopHandleIcon,Y.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),C("div",{bind:this,"aria-labelledby":w,class:this.classes(Y.stopIconContainer,c),"data-stop-index":o,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},C("span",{class:this.classes(Y.stopIcon,p),tabindex:M?"0":null}))),C("div",{class:Y.stopInput},y.render()),C("div",{class:Y.stopOptions,role:"group"},C("div",{"aria-label":S,class:Y.removeStopButton,bind:this,"data-stop-index":o,hidden:g,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:S},C("span",{"aria-hidden":"true",class:this.classes(Y.stopIcon,Y.removeStop,Y.removeStopIcon,Y.interactiveStopIcon)}),C("span",{class:Y.screenReaderText},"removeStopTitle")),C("div",{"aria-label":b,class:Y.reverseStops,bind:this,hidden:_,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:b},C("span",{"aria-hidden":"true",class:this.classes(Y.stopIcon,Y.reverseStopIcon,Y.interactiveStopIcon)}),C("span",{class:Y.screenReaderText},"removeStopTitle"))))})),o=this._renderAddStop();return C("div",null,C("ol",{class:Y.stops,role:"group",afterCreate:this._setUpDragAndDropStops},r),o)}_renderAddStop(){const{stops:e}=this.viewModel.layer,t=e.filter((({geometry:e})=>l(e))),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&l(s)&&l(s.geometry)?C("div",{class:Y.toolbarSection},C("div",{class:Y.toolbarButtons},C("calcite-button",{appearance:"outline",class:Y.addStopButton,color:"neutral",scale:"s",round:!0,"icon-start":"plus",key:Y.addStopButton,onclick:()=>{this._addNewPlaceholder()},text:this.messages.addStop,width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){const t=e.currentTarget["data-stop-index"],s=this.viewModel.layer.stops.getItemAt(t);s&&l(s.geometry)&&this._centerAtStop(s)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],r=this.viewModel.layer.stops.getItemAt(s);if(t===r){const e=this._acquireSearch(r);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){if(this._saveLayer.opened)return;if(this.removeHandles("search-term"),e.selectedResult&&l(t.geometry)&&l(e.selectedResult?.feature.geometry)&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle.pause();const s=a(t.geometry)&&a(e.selectedResult?.feature.geometry),r=l(t.geometry)&&l(e.selectedResult?.feature.geometry)&&t.geometry!==e.selectedResult.feature.geometry;if((s||r)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle.pause();e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(l(t.geometry)&&(t.geometry=null,this._getDirections()),this.scheduleRender()):this._pointerDownUpHandle.pause())}),this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){if(this._pointerDownUpHandle.resume(),this.hasHandles("search-term"))return;const{view:s}=this,r=s.cursor;this.addHandles([{remove(){s.cursor=r}},u((()=>e.searchTerm),(t=>{e.destroyed||(s.cursor=t.length?r:"copy")}),m)],"search-term"),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel,t=i(e,"click",this._handleViewClick.bind(this)),s=i(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=i(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=Z(e)?this._activeStop:null})),t=i(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=Z(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?s:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){e.stopPropagation();const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=e.results[0].results[0],{feature:r,name:o}=s;this._activeStop.geometry=r.geometry,this._activeStop.name=o,t.searchTerm=o})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e=new j({symbol:new S});this.viewModel.layer.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){this.viewModel.layer.stops.reverse();for(const e of this.viewModel.layer.stops)e.sequence=null;this._getDirections()}_handleRemoveStop(e){const t=e.currentTarget["data-stop-index"],s=this.viewModel.layer.stops.getItemAt(t);this._removeStop(s),(l(s.geometry)||a(this.viewModel.layer.routeInfo))&&this._getDirections()}_removeStop(e){this.viewModel.layer.stops.length<=2||(this._disposeSearch(e),this.viewModel.layer.stops.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===Q.NOW?(this._departureTime=Q.NOW,this.viewModel.departureTime=Q.NOW,this.removeHandles("date-time-picker"),this._getDirections()):s.value===Q.DEPART_BY?(this._departureTime=Q.DEPART_BY,this.addHandles(u((()=>[this._datePicker.value,this._timePicker.value]),(()=>{this._updateDepartureTime(),this._getDirections()}),m),"date-time-picker")):(this._departureTime=Q.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))}_renderTimeControls(){return C("div",{class:Y.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return C("div",{class:Y.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:r}=this.visibleElements;return e||t||s||r?C("div",{class:Y.saveSection,key:Y.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?C("div",{class:Y.saveButtons,key:Y.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const e=this.viewModel.layer.portalItem?.itemControl,t=l(this.viewModel.layer.routeInfo)&&("admin"===e||"update"===e);return C("calcite-button",{appearance:"outline",class:Y.saveButton,color:"blue",disabled:!t,"icon-start":"save",key:Y.saveButton,onclick:()=>{this._handleSaveButtonClick()},text:this.messagesCommon.save,width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=a(this.viewModel.layer.routeInfo);return C("div",{class:Y.saveAsButtonPopover,key:Y.saveAsButtonPopover},C("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:Y.saveAsButton,color:"blue",disabled:e,"icon-start":"duplicate",key:Y.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),text:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return C("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,"overlay-positioning":"fixed",referenceElement:p(this._saveAsButtonNode)},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?C("calcite-button",{appearance:"outline",class:Y.printButton,color:"blue","icon-start":"print",key:Y.printButton,text:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e;return C("calcite-link",{class:Y.layerDetailsLink,href:`${s}/home/item.html?id=${t}`,key:Y.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return C("div",{class:this.classes(Y.directionsSection,Y.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return C("div",{class:Y.loader,key:"loader"})}_renderWarningCard(){return C("div",{class:Y.warningCard,role:"alert"},C("div",{class:Y.warningHeader},C("span",{class:Y.warningIcon,"aria-hidden":"true"}),C(E,{class:Y.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),C("div",{class:Y.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{viewModel:{layer:e,state:t}}=this,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():l(e.directionLines)?C("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Y.summary,this._saveLayer.opened&&Y.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):C("div",{key:"esri-directions__placeholder",class:Y.emptyContent},this._renderPlaceholder(),C(E,{class:Y.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return C("svg",{class:Y.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},C("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))}_renderMessage(e){return C(E,{level:this.headingLevel},e)}_renderRouteActions(){return C("div",{class:Y.routeActions},C("button",{"aria-label":this.messages.clearRoute,class:this.classes(Y.clearRouteButton,Y.button,Y.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))}_getSections(){const{directionPoints:e,directionLines:t,stops:s}=this.viewModel.layer;if(a(e)||a(t))return null;const r=[];let o=null;for(const i of e){const{objectId:e,stopId:n}=i;if(l(n)){const e=s.find((e=>e.objectId===n)),t=0===r.length;(a(o)||o.stop!==e)&&(o={stop:e,directions:[],open:t},r.push(o));continue}if(a(o))continue;const p=t.find((t=>t.directionPointId===e));a(p)||o.directions.push({directionPoint:i,directionLine:p})}return r}_renderManeuverSections(){return a(this._sections)?null:C("div",{class:Y.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let r;e.directions.length>0&&s&&(r=C("ol",{class:Y.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const o=p(this._sections).length>2,i=t===p(this._sections).length-1,n={[Y.collapsibleSection]:o},a={[Y.openIcon]:!s,[Y.closeIcon]:s};let l;if(o&&!i){const t=s?this.messagesCommon.close:this.messagesCommon.open;l=C("header",{class:this.classes(Y.maneuverSectionHeader,Y.maneuverSectionToggle),key:Y.maneuverSectionHeader},C("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:Y.maneuverSectionHeaderButton,"data-maneuver-section":e,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:t},C(E,{class:Y.maneuverSectionTitle,level:this.headingLevel},e.stop.name),C("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=C("header",{class:Y.maneuverSectionHeader,key:Y.maneuverSectionHeader},C(E,{class:Y.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return C("section",{class:this.classes(Y.maneuverSection,n),key:t},l,r)})))}_handleSectionToggle(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open}_renderCosts(){const e=this._getCostSummary(),{directionPoints:s}=this.viewModel.layer;if(a(s)||a(e))return null;const r=s.getItemAt(s.length-1).arrivalTime,{distance:o,duration:i}=e,{eta:n,etaTemplate:p,primaryCosts:c,secondaryCosts:u,zoomToRoute:m}=this.messages,d=$("short-time"),h=l(r)?`<strong>${P(r,d)}</strong>`:null,v=l(r)?`${function(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",r=Math.abs(Math.floor(t/60)),o=Math.abs(Math.floor(t)%60),i={minimumIntegerDigits:2};return`GMT${s}${L(r,i)}${L(o,i)}`}(r)}`:null,_=t(p,{time:h,gmt:v});return C("div",{"aria-label":m,bind:this,class:Y.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:m},C("div",{class:Y.costsDetails,role:"group"},C("div",{class:Y.primaryCosts,title:c},i),C("div",{class:Y.verticalSplitter}),C("div",{class:Y.secondaryCosts,title:u},o)),C("div",{innerHTML:_,title:n}))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){const{messages:e,viewModel:{lastError:t}}=this;if(l(t))switch(t.name){case"directions-view-model:unable-to-route":return e.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return e.errors.unableToLoadServiceMetadata}return e.errors.unknownError}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??(t.locationType="street"),U(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=B))}_acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new b({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([h((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.geometry=s.selectedResult.feature.geometry,e.name=s.selectedResult.name,this._getDirections()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e))),s.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer.removeResult()})),u((()=>s.searchTerm),(t=>{e.name=t}))],s),this._stopsToSearches.set(e,s),s}_disposeSearch(e){if(this._stopsToSearches.has(e)){const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}}_renderManeuver(e){const{directionPoint:t,directionLine:s}=e,{distance:r,duration:o}=s,{messages:i,messagesUnits:n,unit:p}=this,u=G(n,c(r,0),p),m=W(c(o,0)),d=u&&m?`${u}&nbsp;&middot;&nbsp;${m}`:`${u}${m}`,h=this._getFormattedManeuverText(t),{objectId:v,directionPointType:_}=t,g=function(e){if(a(e)||!J.has(e))return null;const t=J.get(e),s=2===window.devicePixelRatio?"@2x":"";return`${R("esri/themes/base/images/maneuvers/")}${t}${s}.png`}(_),y=`esri-directions__maneuver-${v}`,j=`esri-directions__intermediate-costs-${v}`,S={[Y.maneuverActive]:this._activeManeuver===s};return C("li",{"aria-labelledby":`${y} ${j}`,bind:this,class:this.classes(Y.maneuver,S),"data-maneuver":s,key:s,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},l(g)&&C("img",{alt:"",class:Y.maneuverIcon,src:g}),C("div",{class:Y.maneuverCostsContainer},C("span",{id:y,innerHTML:c(h,"")}),C("div",{class:Y.maneuverCosts},C("div",{class:Y.horizontalSplitter}),C("div",{"aria-hidden":"true",id:j,class:Y.intermediateCost,innerHTML:d,title:i.intermediateCosts}))))}_handleManeuverClick(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlight(t)}_getFormattedManeuverText(e){const{displayText:t,name:s,intersectingName:r}=e;if(a(t))return"";let o=t;return l(s)&&o.includes(s)&&(o=o.replace(s,`<strong>${s}</strong>`)),l(r)&&o.includes(r)&&(o=o.replace(r,`<strong>${r}</strong>`)),o}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:r}=s.layer;if(a(r))return null;const o=c(r.totalDistance,0),i=c(r.totalDuration,0);return{distance:G(e,o,t),duration:W(i)}}async _getDirections(){if(!(this.viewModel.layer.stops.filter((e=>l(e.geometry))).length<2))try{await this.viewModel.getDirections()}catch{}}};e([v()],te.prototype,"apiKey",null),e([v(y)],te.prototype,"defaultUnit",void 0),e([v()],te.prototype,"goToOverride",null),e([v()],te.prototype,"headingLevel",void 0),e([v()],te.prototype,"iconClass",void 0),e([v()],te.prototype,"label",null),e([v({readOnly:!0})],te.prototype,"lastRoute",null),e([v()],te.prototype,"layer",null),e([v()],te.prototype,"maxStops",null),e([v(),M("esri/widgets/Directions/t9n/Directions")],te.prototype,"messages",void 0),e([v(),M("esri/t9n/common")],te.prototype,"messagesCommon",void 0),e([v(),M("esri/core/t9n/Units")],te.prototype,"messagesUnits",void 0),e([v()],te.prototype,"routeServiceUrl",null),e([v()],te.prototype,"routeSymbol",null),e([v()],te.prototype,"searchProperties",void 0),e([v()],te.prototype,"stopSymbols",null),e([v()],te.prototype,"unit",null),e([v()],te.prototype,"view",null),e([v({type:f})],te.prototype,"viewModel",void 0),e([v()],te.prototype,"visibleElements",void 0),e([_("visibleElements")],te.prototype,"castVisibleElements",null),e([O()],te.prototype,"_handleStopIconClick",null),e([O()],te.prototype,"_handleClearRouteClick",null),e([O()],te.prototype,"_handleReverseStops",null),e([O()],te.prototype,"_handleRemoveStop",null),e([O()],te.prototype,"_handleSectionToggle",null),e([O()],te.prototype,"_handleSummaryInteraction",null),e([O()],te.prototype,"_handleManeuverClick",null),te=e([g("esri.widgets.Directions")],te);const se=te;export{se as default};
