"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[2670],{62670:(e,t,a)=>{a.r(t),a.d(t,{save:()=>N,saveAll:()=>J,saveAs:()=>Z});var r=a(76506),n=a(60991),o=a(92143),i=a(71252),l=a(50406),s=a(87217),u=a(9506),c=a(21132),y=a(14830),d=a(51899),f=a(49900),p=a(56420),m=a(69586),w=a(60111);a(71552),a(31450),a(40642),a(86748),a(66122),a(21972),a(60474),a(66396),a(86656),a(91055),a(17533),a(6540),a(91306),a(34250),a(19657),a(6906),a(15324),a(75067),a(89914),a(12047),a(86787),a(97714),a(2906),a(14249),a(60217),a(74569),a(21801),a(73796),a(60947),a(91597),a(35132),a(89623),a(84069),a(44567),a(98380),a(92896),a(22781),a(57251),a(32422),a(29107),a(30574),a(2157),a(25977),a(58076),a(98242),a(7471),a(54414),a(59465),a(1648),a(8925),a(33921),a(3482),a(45154),a(16769),a(93603),a(15438),a(593),a(85699),a(55531),a(96055),a(47776),a(18033),a(6331),a(62048),a(56890),a(30493),a(4292),a(75626),a(72652),a(29641),a(70821),a(3296),a(34229),a(37029),a(55306),a(96467),a(63571),a(30776),a(48027),a(54174),a(82426),a(72836),a(29794),a(63130),a(25696),a(98402),a(42775),a(95834),a(34394),a(57150),a(76726),a(20444),a(76393),a(78548),a(2497),a(49906),a(46527),a(11799),a(48649),a(59877),a(9960),a(30823),a(53326),a(92482),a(5853),a(39141),a(32101),a(38742),a(48243),a(34635),a(10401),a(70737),a(36834),a(8487),a(17817),a(90814),a(15459),a(97189),a(88762),a(82058),a(81184),a(33101),a(67477),a(78533),a(74653),a(91091),a(58943),a(61847),a(28212),a(16955),a(22401),a(48699),a(77894),a(55187),a(8586),a(44509),a(69814),a(11305),a(62259),a(44790),a(5909),a(60669),a(48208),a(51589),a(65684),a(12158),a(74864),a(63683),a(94479),a(45702),a(51127),a(26822),a(51723),a(23243),a(51669),a(6090),a(3977),a(36741),a(11253),a(90319),a(38822),a(52228),a(74057),a(23761),a(48190),a(85557),a(53785),a(95587),a(94070),a(43022),a(16218),a(9075),a(71206),a(9352),a(89241),a(91700),a(51979),a(32037),a(60698),a(90811),a(60045),a(68681),a(53321),a(86758),a(95310),a(58085),a(93939),a(62407),a(90033),a(97807),a(238),a(68714),a(20208),a(54179),a(10691),a(38949),a(71777),a(19755),a(62554),a(27371),a(78648),a(87558),a(13063),a(17153),a(35962),a(9252),a(67350),a(11471),a(83748),a(28376),a(9801),a(53523),a(42911),a(46826),a(45433),a(41617),a(95873),a(23771),a(65514),a(46987),a(37453),a(73173),a(66284),a(87239),a(87728),a(55823),a(92847),a(87258),a(97546),a(54732),a(96994),a(75025),a(80462),a(92200),a(65949),a(22465),a(65775),a(5777),a(21471),a(65398),a(9641),a(6210),a(36231),a(93314),a(35197),a(31292),a(69218),a(32925),a(27207),a(79093),a(29027),a(67541),a(1557),a(47842),a(17298),a(34446),a(46646),a(17055),a(2180),a(14327),a(39275),a(70846),a(67961),a(29395),a(94303),a(77807),a(50203),a(30439),a(6941),a(14460),a(13322),a(13201),a(89440),a(86861),a(39241),a(41864),a(74742),a(28239),a(97565),a(64049),a(68219),a(6416),a(82377),a(59765),a(77361),a(61261),a(46495),a(78303),a(47346),a(1709),a(68653),a(40944),a(71831),a(39210),a(90549),a(78893),a(1623),a(12381),a(92624);const v=o.L.getLogger("esri.layers.FeatureLayer");function h(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function S(e,t){if("Feature Service"!==t.type)throw new n.Z("feature-layer:portal-item-wrong-type",h(e,'should have portal item of type "Feature Service"'))}async function b(e){if(await e.load(),(0,d.i)(e))throw new n.Z("feature-layer:save",h(e,"using an in-memory source cannot be saved to a portal item"))}async function g(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return function(e,t){let a=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:a})=>new n.Z(e,t,a)));if(t?.ignoreUnsupported&&(a=a.filter((({name:e})=>"layer:unsupported"!==e&&"symbol:unsupported"!==e&&"symbol-layer:unsupported"!==e&&"property:unsupported"!==e&&"url:unsupported"!==e))),a.length>0)throw new n.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}(t,a),r}function I(e){const{layer:t,layerJSON:a}=e;return t.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function A(e){(0,w.a)(e,w.T.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function T(e,t){return/\/\d+\/?$/.test(e.url??"")?I(t[0]):async function(e,t){const{layer:{url:a,customParameters:r,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await async function(e,t,a){var r,n;e||(e={}),(r=e).layers||(r.layers=[]),(n=e).tables||(n.tables=[]);const{url:o,customParameters:s,apiKey:c}=t,{serviceJSON:d,layersJSON:f}=await(0,y.f)(o,{customParameters:s,apiKey:c}),p=O(e.layers,d.layers,a),m=O(e.tables,d.tables,a);e.layers=p.itemResources,e.tables=m.itemResources;const w=[...p.added,...m.added],v=f?[...f.layers,...f.tables]:[];return await async function(e,t,a,r){const n=t.map((({id:e})=>new u.default({url:a,layerId:e,sourceJSON:r.find((({id:t})=>t===e))})));await(0,l.as)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;r&&!(0,i.a)(n)&&E(t,{id:a,popupInfo:n.toJSON()},e)}))}(e,w,o,v),e}(o,{url:a??"",customParameters:r,apiKey:n},t.map((e=>e.layer.layerId))));for(const e of t)E(e.layer,e.layerJSON,o);return o}(e,t)}function O(e,t,a){const n=(0,r.y)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const o=n.added.map((({id:e})=>({id:e})));return o.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:o.filter((({id:e})=>!a.includes(e)))}}function E(e,t,a){e.isTable?P(a.tables,t):P(a.layers,t)}function P(e,t){if(!e)return;const a=e.findIndex((({id:e})=>e===t.id));-1===a?e.push(t):e[a]=t}function L(e){const{portalItem:t}=e;return(0,d.h)(e)&&!e.dynamicDataSource&&!!t?.loaded&&"Feature Service"===t.type}const N=(0,l.Ds)((async function(e,t){await b(e),function(e){const t=e.portalItem;if(!t)throw v.error("save: requires the portalItem property to be set"),new n.Z("feature-layer:portal-item-not-set",h(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.Z("feature-layer:portal-item-not-loaded",h(e,"cannot be saved to a portal item that does not exist or is inaccessible"));S(e,t)}(e);const a=e.portalItem,r=(0,m.a)(a),o=await g(e,r,t),i=await T(a,[{layer:e,layerJSON:o}]);return A(a),await a.update({data:i}),(0,s.u)(r),a})),J=(0,l.Ds)((async(e,t)=>{await async function(e){if(!e?.length)throw new n.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const t of e)if(!L(t))throw new n.Z("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${h(t,"does not conform")}`,{layer:t});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const a=e[0].portalItem,r=(0,m.a)(a),o=await Promise.all(e.map((e=>g(e,r,t)))),i=await T(a,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return A(a),await a.update({data:i}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,s.u)(r),a.clone()})),Z=(0,l.Ds)((async function(e,t,a){await b(e);const r=function(e,t){var a,r;let n=p.default.from(t);return n.id&&(n=n.clone(),n.id=null),(a=n).type??(a.type="Feature Service"),(r=n).portal??(r.portal=f.Z.getDefault()),S(e,n),n}(e,t),n=(0,m.a)(r),o=I({layer:e,layerJSON:await g(e,n,a)});return await async function(e,t){const{url:a,layerId:r,title:n,fullExtent:o,isTable:l}=e,s=(0,c.p)(a),u=(0,i.i)(s)&&"FeatureServer"===s.serverType;t.url=u?a:`${a}/${r}`,t.title||(t.title=n),t.extent=null,!l&&(0,i.i)(o)&&(t.extent=await(0,w.g)(o)),(0,w.r)(t,w.T.METADATA),(0,w.r)(t,w.T.MULTI_LAYER),(0,w.a)(t,w.T.SINGLE_LAYER),l&&(0,w.a)(t,w.T.TABLE),A(t)}(e,r),await async function(e,t,a){const r=e.portal;await(r?._signIn()),await(r?.user?.addItem({item:e,data:t,folder:a?.folder}))}(r,o,a),e.portalItem=r,(0,s.u)(n),r}))},14830:(e,t,a)=>{a.d(t,{a:()=>i,f:()=>n});var r=a(82058);async function n(e,t){let a=await i(e,t);a=a||{},a.layers=a.layers?.filter(o)||[];const r={serviceJSON:a};if((a.currentVersion??0)<10.5)return r;const n=await i(e+"/layers",t);return r.layersJSON={layers:n?.layers?.filter(o)||[],tables:n?.tables||[]},r}function o(e){return!e.type||"Feature Layer"===e.type}async function i(e,t){return(await(0,r.default)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}})).data}},69586:(e,t,a)=>{a.d(t,{a:()=>i,c:()=>o});var r=a(32101),n=a(49900);function o(e){return{origin:"portal-item",url:(0,r.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function i(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,r.mN)(e.itemUrl):null,portal:e.portal||n.Z.getDefault(),portalItem:e}}},51899:(e,t,a)=>{function r(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function n(e){return"feature"===e?.type&&"feature-layer"===e.source?.type}a.d(t,{h:()=>n,i:()=>r})},25368:(e,t,a)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{i:()=>r})},87217:(e,t,a)=>{a.d(t,{u:()=>n});var r=a(25368);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:a})=>{(0,r.i)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)}))}},60111:(e,t,a)=>{a.d(t,{T:()=>c,a:()=>i,g:()=>u,h:()=>l,r:()=>s});var r=a(1623),n=a(60947),o=a(35132);function i(e,t){if(!l(e,t)){const a=e.typeKeywords;a?a.push(t):e.typeKeywords=[t]}}function l(e,t){return!!e.typeKeywords?.includes(t)}function s(e,t){const a=e.typeKeywords;if(a){const e=a.indexOf(t);e>-1&&a.splice(e,1)}}async function u(e){const t=e.clone().normalize();let a;if(t.length>1)for(const e of t)a?e.width>a.width&&(a=e):a=e;else a=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,o.Sx)(e);const a=n.Z.WGS84;return await(0,r.iQ)(t,a),(0,r.iV)(e,a)}(a)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}}]);