"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[4912,2058,3173],{30831:(e,t,s)=>{s.d(t,{I:()=>r});var i=s(91700);class r{constructor(e,t){this._storage=new i.M,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},77849:(e,t,s)=>{s.d(t,{Q:()=>M,S:()=>D,a:()=>v,b:()=>T,g:()=>_,h:()=>I,v:()=>S});var i=s(71252),r=s(44567),n=s(98380),a=s(71435),o=s(60947),l=s(60991),u=s(30831),c=s(72274),d=s(59565),h=s(24251);function m(e,t,s){return{objectId:e,target:t,distance:s,type:"vertex"}}function f(e,t,s,i,r,n=!1){return{objectId:e,target:t,distance:s,type:"edge",start:i,end:r,draped:n}}var p=s(3039),g=s(14249),y=s(60217);const x=new class{constructor(e,t){this._cache=new u.I(e),this._invalidCache=new u.I(t)}get(e,t){const s=`${t.uid}:${e}`,i=this._cache.get(s);if(i)return i;if(void 0!==this._invalidCache.get(s))return null;try{const i=c.WhereClause.create(e,t);return this._cache.put(s,i),i}catch{return this._invalidCache.put(s,null),null}}}(50,500),w="feature-store:unsupported-query",b=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function v(e,t){if(!t)return!0;const s=x.get(t,e);if(!s)throw new l.Z(w,"invalid SQL expression",{where:t});if(!s.isStandardized)throw new l.Z(w,"where clause is not standard",{where:t});return S(e,s.fieldNames,"where clause contains missing fields"),!0}function T(e,t,s){if(!t)return!0;const i=x.get(t,e);if(!i)throw new l.Z(w,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new l.Z(w,"having does not contain a valid aggregate function",{having:t});const r=i.fieldNames;if(S(e,r,"having contains missing fields"),!i.getExpressions().every((t=>{const{aggregateType:i,field:r}=t,n=e.has(r)&&e.get(r).name;return s.some((t=>{const{onStatisticField:s,statisticType:r}=t;return(e.has(s)&&e.get(s).name)===n&&r.toLowerCase().trim()===i}))})))throw new l.Z(w,"expressions in having should also exist in outStatistics",{having:t});return!0}function _(e,t){return e?x.get(e,t):null}function S(e,t,s,i=!0){const r=[];for(const s of t)if("*"!==s&&!e.has(s))if(i){const t=F(s);try{const s=_(t,e);if(!s)throw new l.Z(w,"invalid SQL expression",{where:t});if(!s.isStandardized)throw new l.Z(w,"expression is not standard",{clause:s});S(e,s.fieldNames,"expression contains missing fields")}catch(e){const t=e&&e.details;if(t&&(t.clause||t.where))throw e;t&&t.missingFields?r.push(...t.missingFields):r.push(s)}}else r.push(s);if(r.length)throw new l.Z(w,s,{missingFields:r})}function F(e){return e.split(" as ")[0]}function I(e,t){const s=t.get(e);return!!s&&!b.has(s.type)}class q{constructor(e,t,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=t;const i=e.outFields;if(i&&!i.includes("*")){this.outFields=i;let e=0;for(const t of i){const i=F(t),r=this.fieldsIndex.get(i),n=r?null:_(i,s),a=r?r.name:t.split(" as ")[1]||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:n})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,s){const i=s?s.name:t;let r=null;return this._fieldDataCache.has(i)?r=this._fieldDataCache.get(i).clause:s||(r=_(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:r})),s?this.featureAdapter.getAttribute(e,i):r.calculateValue(e,this.featureAdapter)}getDataValue(e,t){const s=t.normalizationType,i=t.normalizationTotal;let r=this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2&&(r=`${(0,d.b)(r)}${t.fieldDelimiter}${(0,d.b)(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${(0,d.b)(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)),s&&Number.isFinite(r)){const n="field"===s&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=(0,d.d)(r,s,n,i)}return r}getExpressionValue(e,t,s,i){const r={attributes:this.featureAdapter.getAttributes(e),layer:{fields:this.fieldsIndex.fields}},n=i.createExecContext(r,s);return i.executeFunction(t,n)}getExpressionValues(e,t,s,i){const r={fields:this.fieldsIndex.fields};return e.map((e=>{const n={attributes:this.featureAdapter.getAttributes(e),layer:r},a=i.createExecContext(n,s);return i.executeFunction(t,a)}))}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:_(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:_(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){const t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);const s={};for(const i of t){const{alias:t,clause:r}=this._fieldDataCache.get(i);s[t]=r?r.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return s}_processAttributesForDistinctValues(e){if((0,i.a)(e)||!this.returnDistinctValues)return e;const t=this.outFields,s=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);s.push(e[t])}else for(const t in e)s.push(e[t]);const r=`${(t||["*"]).join(",")}=${s.join(",")}`;let n=this._returnDistinctMap.get(r)||0;return this._returnDistinctMap.set(r,++n),n>1?null:e}}class M{constructor(e,t,s){this.items=e,this.query=t,this.geometryType=s.geometryType,this.hasM=s.hasM,this.hasZ=s.hasZ,this.fieldsIndex=s.fieldsIndex,this.objectIdField=s.objectIdField,this.spatialReference=s.spatialReference,this.featureAdapter=s.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new q(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:s,outStatistics:i}=this.query,r=t?.length;if(!r)return 1;const n=new Map,a=new Map,o=new Set;for(const r of i){const{statisticType:i}=r,l="exceedslimit"!==i?r.onStatisticField:void 0;if(!a.has(l)){const s=[];for(const i of t){const t=this._getAttributeValues(e,i,n);s.push(t)}a.set(l,this._calculateUniqueValues(s,e.returnDistinctValues))}const u=a.get(l);for(const t in u){const{data:i,items:r}=u[t],n=i.join(",");s&&!e.validateItems(r,s)||o.add(n)}}return o.size}async createQueryResponse(){let e;return e=this.query.outStatistics?this.query.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry&&((0,o.j)(this.query.outSR)&&!(0,o.e)(this.query.geometry.spatialReference,this.query.outSR)?e.queryGeometry=(0,p.c)({spatialReference:this.query.outSR,...(0,h.p)(this.query.geometry,this.query.geometry.spatialReference,this.query.outSR)}):e.queryGeometry=(0,p.c)({spatialReference:this.query.outSR,...this.query.geometry})),e}createSnappingResponse(e,t){const s=this.featureAdapter,r=C(this.hasZ,this.hasM),{point:n}=e,a="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},u="esriGeometryPolygon"===this.geometryType,c=null!=n.z,d=null!=n.m,h=this._getPointCreator(n,c,d,this.spatialReference,t),p=new E(null,0),g=new E(null,0),y={x:0,y:0,z:0};for(const t of this.items){const c=s.getGeometry(t);if((0,i.a)(c))continue;const{coords:d,lengths:x}=c;if(p.coords=d,g.coords=d,e.types&D.EDGE){let e=0;for(let i=0;i<x.length;i++){const u=x[i];for(let i=0;i<u;i++,e+=r){const c=p;if(c.coordsIndex=e,i!==u-1){const i=g;i.coordsIndex=e+r;const u=y;R(y,n,c,i);const d=(n.x-u.x)/a,m=(n.y-u.y)/o,p=d*d+m*m;p<=1&&l.candidates.push(f(s.getObjectId(t),h(u),Math.sqrt(p),h(c),h(i)))}}}}if(e.types&D.VERTEX){const e=u?d.length-r:d.length;for(let i=0;i<e;i+=r){const e=p;e.coordsIndex=i;const r=(n.x-e.x)/a,u=(n.y-e.y)/o,c=r*r+u*u;c<=1&&l.candidates.push(m(s.getObjectId(t),h(e),Math.sqrt(c)))}}}return l.candidates.sort(((e,t)=>e.distance-t.distance)),l}_getPointCreator(e,t,s,r,n){const a=(0,i.i)(n)&&!(0,o.e)(r,n)?e=>(0,h.p)(e,r,n):e=>e,{hasZ:l}=this,u=e.m;return t&&s?l?({x:e,y:t,z:s})=>a({x:e,y:t,z:s,m:u}):({x:e,y:t})=>a({x:e,y:t,z:0,m:u}):t?l?({x:e,y:t,z:s})=>a({x:e,y:t,z:s}):({x:e,y:t})=>a({x:e,y:t,z:0}):s?({x:e,y:t})=>a({x:e,y:t,m:u}):({x:e,y:t})=>a({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,minValue:a,maxValue:o,scale:l}=e,u=this.fieldsIndex.isDateField(t),c=await this._getDataValues({field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,scale:l}),h=(0,d.i)({normalizationType:r,normalizationField:i,minValue:a,maxValue:o}),m=this.fieldsIndex.get(t),f={value:.5,fieldType:m?.type},p=(0,g.qN)(m)?(0,d.e)({values:c,supportsNullCount:h,percentileParams:f}):(0,d.f)({values:c,minValue:a,maxValue:o,useSampleStdDev:!r,supportsNullCount:h,percentileParams:f});return(0,d.p)(p,u)}async createUniqueValuesResponse(e){const{field:t,valueExpression:s,domains:i,returnAllCodedValues:r,scale:n}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:s,scale:n}),o=(0,d.h)(a);return(0,d.c)(o,i,r,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c,scale:h}=e,m=await this._getDataValues({field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,scale:h}),f=(0,d.j)(m,{field:t,normalizationField:i,normalizationType:r,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c});return(0,d.r)(f,a)}async createHistogramResponse(e){const{field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c,scale:h}=e,m=await this._getDataValues({field:t,valueExpression:s,normalizationField:i,normalizationType:r,normalizationTotal:n,scale:h});return(0,d.k)(m,{field:t,normalizationField:i,normalizationType:r,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c})}_sortFeatures(e,t,s){if(e.length>1&&t&&t.length)for(const i of t.reverse()){const t=i.split(" "),r=t[0],n=this.fieldsIndex.get(r),a=t[1]&&"desc"===t[1].toLowerCase(),o=(0,d.l)(n?.type,a);e.sort(((e,t)=>{const i=s(e,r,n),a=s(t,r,n);return o(i,a)}))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:s,hasM:i,hasZ:r,objectIdField:n,spatialReference:o}=this,{outFields:l,outSR:u,quantizationParameters:c,resultRecordCount:d,resultOffset:h,returnZ:m,returnM:f}=e,g=null!=d&&t.length>(h||0)+d,y=l&&(l.includes("*")?[...this.fieldsIndex.fields]:l.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:g,features:this._createFeatures(e,t),fields:y,geometryType:s,hasM:i&&f,hasZ:r&&m,objectIdFieldName:n,spatialReference:(0,p.c)(u||o),transform:c&&(0,a.t)(c)||null}}_createFeatures(e,t){const s=new q(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:r}=this,{orderByFields:n,quantizationParameters:o,returnGeometry:l,returnCentroid:u,maxAllowableOffset:c,resultOffset:d,resultRecordCount:h,returnZ:m=!1,returnM:f=!1}=e,g=r&&m,y=i&&f;let x=[],w=0;const b=[...t];if(this._sortFeatures(b,n,((e,t,i)=>s.getFieldValue(e,t,i))),l||u){const e=(0,a.t)(o);if(l&&!u)for(const t of b)x[w++]={attributes:s.getAttributes(t),geometry:(0,p.g)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,g,y)};else if(!l&&u)for(const t of b)x[w++]={attributes:s.getAttributes(t),centroid:(0,p.t)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of b)x[w++]={attributes:s.getAttributes(t),centroid:(0,p.t)(this,this.featureAdapter.getCentroid(t,this),e),geometry:(0,p.g)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,g,y)}}else for(const e of b){const t=s.getAttributes(e);t&&(x[w++]={attributes:t})}const v=d||0;if(null!=h){const e=v+h;x=x.slice(v,Math.min(x.length,e))}return x}_createExceedsLimitQueryResponse(e){let t=!1,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const t of e.outStatistics)if("exceedslimit"===t.statisticType){s=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,r=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>s;else if(this.items.length>r)t=!0;else{const e=C(this.hasZ,this.hasM),s=this.featureAdapter;t=this.items.reduce(((e,t)=>{const r=s.getGeometry(t);return e+((0,i.i)(r)&&r.coords.length||0)}),0)/e>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}async _createStatisticsQueryResponse(e){const t={attributes:{}},s=[],i=new Map,r=new Map,n=new Map,a=new Map,o=new q(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:u,having:c,orderByFields:d}=e,h=u&&u.length,m=!!h,f=m&&u[0],p=m&&!this.fieldsIndex.get(f);for(const e of l){const{outStatisticFieldName:l,statisticType:d}=e,g=e,y="exceedslimit"!==d?e.onStatisticField:void 0,x="percentile_disc"===d||"percentile_cont"===d,w="EnvelopeAggregate"===d||"CentroidAggregate"===d||"ConvexHullAggregate"===d,b=m&&1===h&&(y===f||p)&&"count"===d;if(m){if(!n.has(y)){const e=[];for(const t of u){const s=this._getAttributeValues(o,t,i);e.push(s)}n.set(y,this._calculateUniqueValues(e,!w&&o.returnDistinctValues))}const e=n.get(y);for(const t in e){const{count:s,data:r,items:n,itemPositions:d}=e[t],h=r.join(",");if(!c||o.validateItems(n,c)){const e=a.get(h)||{attributes:{}};if(w){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:s}=await this._getAggregateGeometry(g,n);e.aggregateGeometries[s]=t}else{let t=null;if(b)t=s;else{const e=this._getAttributeValues(o,y,i),s=d.map((t=>e[t]));t=x&&"statisticParameters"in g?this._getPercentileValue(g,s):this._getStatisticValue(g,s,null,o.returnDistinctValues)}e.attributes[l]=t}let t=0;u.forEach(((s,i)=>e.attributes[this.fieldsIndex.get(s)?s:"EXPR_"+ ++t]=r[i])),a.set(h,e)}}}else if(w){t.aggregateGeometries||(t.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:s}=await this._getAggregateGeometry(g,this.items);t.aggregateGeometries[s]=e}else{const e=this._getAttributeValues(o,y,i);t.attributes[l]=x&&"statisticParameters"in g?this._getPercentileValue(g,e):this._getStatisticValue(g,e,r,o.returnDistinctValues)}s.push({name:l,alias:l,type:"esriFieldTypeDouble"})}const g=m?Array.from(a.values()):[t];return this._sortFeatures(g,d,((e,t)=>e.attributes[t])),{fields:s,features:g}}async _getAggregateGeometry(e,t){const i=await Promise.all([s.e(3361),s.e(3981)]).then(s.bind(s,43981)).then((e=>e.g)),{statisticType:a,outStatisticFieldName:o}=e,{featureAdapter:l,spatialReference:u,geometryType:c,hasZ:d,hasM:h}=this,m=t.map((e=>(0,p.g)(c,d,h,l.getGeometry(e)))),f=i.convexHull(u,m,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const e=f?(0,n.g)(f):(0,n.e)(i.union(u,m));g.aggregateGeometries={...e,spatialReference:u},g.outStatisticFieldName=o||"extent"}else if("CentroidAggregate"===a){const e=f?(0,r.e)(f):(0,r.f)((0,n.e)(i.union(u,m)));g.aggregateGeometries={x:e[0],y:e[1],spatialReference:u},g.outStatisticFieldName=o||"centroid"}else"ConvexHullAggregate"===a&&(g.aggregateGeometries=f,g.outStatisticFieldName=o||"convexHull");return g}_getStatisticValue(e,t,s,i){const{onStatisticField:r,statisticType:n}=e;let a=null;return a=s?.has(r)?s.get(r):(0,g.qN)(this.fieldsIndex.get(r))?(0,d.e)({values:t,returnDistinct:i}):(0,d.f)({values:t,minValue:null,maxValue:null,useSampleStdDev:!0}),s&&s.set(r,a),a["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:s,statisticParameters:i,statisticType:r}=e,{value:n,orderBy:a}=i,o=this.fieldsIndex.get(s);return(0,d.m)(t,{value:n,orderBy:a,fieldType:o?.type,isDiscrete:"percentile_disc"===r})}_getAttributeValues(e,t,s){if(s.has(t))return s.get(t);const i=this.fieldsIndex.get(t),r=this.items.map((s=>e.getFieldValue(s,t,i)));return s.set(t,r),r}_getAttributeDataValues(e,t){return this.items.map((s=>e.getDataValue(s,{field:t.field,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,normalizationField:t.normalizationField,normalizationType:t.normalizationType,normalizationTotal:t.normalizationTotal})))}async _getAttributeExpressionValues(e,t,s){const{arcadeUtils:i}=await(0,y.l)(),r=i.createFunction(t),n=s&&i.getViewInfo(s);return e.getExpressionValues(this.items,r,n,i)}_calculateUniqueValues(e,t){const s={},i=this.items,r=i.length;for(let n=0;n<r;n++){const r=i[n],a=[];for(const t of e)a.push(t[n]);const o=a.join(",");t?null==s[o]&&(s[o]={count:1,data:a,items:[r],itemPositions:[n]}):null==s[o]?s[o]={count:1,data:a,items:[r],itemPositions:[n]}:(s[o].count++,s[o].items.push(r),s[o].itemPositions.push(n))}return s}async _getDataValues(e){const t=new q(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:s,field:i,normalizationField:r,normalizationType:n,normalizationTotal:a,scale:o}=e,l=s?{viewingMode:"map",scale:o,spatialReference:this.query.outSR||this.spatialReference}:null;return s?this._getAttributeExpressionValues(t,s,l):this._getAttributeDataValues(t,{field:i,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,normalizationField:r,normalizationType:n,normalizationTotal:a})}}function R(e,t,s,i){const r=i.x-s.x,n=i.y-s.y,a=r*r+n*n,o=(t.x-s.x)*r+(t.y-s.y)*n,l=Math.min(1,Math.max(0,o/a));e.x=s.x+r*l,e.y=s.y+n*l}function C(e,t){return e?t?4:3:t?3:2}var D,z;(z=D||(D={}))[z.NONE=0]="NONE",z[z.EDGE=1]="EDGE",z[z.VERTEX=2]="VERTEX";class E{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}},92482:(e,t,s)=>{s.d(t,{N:()=>x,c:()=>n,d:()=>c,e:()=>p,f:()=>y,g:()=>l,h:()=>h,i:()=>m,j:()=>f,r:()=>o,t:()=>u,y:()=>d}),s(71552),s(82426);var i=s(71252),r=s(21801);function n(e=w){return[e[0],e[1],e[2],e[3]]}function a(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function o(e,t,s,i,r=n()){return r[0]=e,r[1]=t,r[2]=s,r[3]=i,r}function l(e,t=n()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function u(e,t){return new r.Z({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function c(e,t,s){if((0,i.a)(t))a(s,e);else if("length"in t)g(t)?(s[0]=Math.min(e[0],t[0]),s[1]=Math.min(e[1],t[1]),s[2]=Math.max(e[2],t[2]),s[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(s[0]=Math.min(e[0],t[0]),s[1]=Math.min(e[1],t[1]),s[2]=Math.max(e[2],t[0]),s[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":s[0]=Math.min(e[0],t.xmin),s[1]=Math.min(e[1],t.ymin),s[2]=Math.max(e[2],t.xmax),s[3]=Math.max(e[3],t.ymax);break;case"point":s[0]=Math.min(e[0],t.x),s[1]=Math.min(e[1],t.y),s[2]=Math.max(e[2],t.x),s[3]=Math.max(e[3],t.y)}}function d(e){return function(e){return(0,i.a)(e)||e[0]>=e[2]?0:e[2]-e[0]}(e)*function(e){return e[1]>=e[3]?0:e[3]-e[1]}(e)}function h(e,t,s){return t>=e[0]&&s>=e[1]&&t<=e[2]&&s<=e[3]}function m(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function f(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function p(e){return e?a(e,x):n(x)}function g(e){return null!=e&&4===e.length}function y(e,t){return g(e)&&g(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const x=[1/0,1/0,-1/0,-1/0],w=[0,0,0,0]},73173:(e,t,s)=>{s.d(t,{g:()=>l});var i=s(31450),r=(s(82058),s(60991)),n=s(92143),a=s(32101);const o=n.L.getLogger("esri.assets");function l(e){if(!i.Z.assetsPath)throw o.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new r.Z("assets:path-not-set","config.assetsPath is not set");return(0,a.v_)(i.Z.assetsPath,e)}},77314:(e,t,s)=>{s.d(t,{j:()=>i});const i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,s){const i=new r(e.getPointX(t),e.getPointY(t),s),n=e.hasZ(t),a=e.hasM(t);return n&&(i.z=e.getPointZ(t)),a&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,s){return new n(e.exportPaths(t),s,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,s){return new a(e.exportPaths(t),s,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,s){return new o(e.exportPoints(t),s,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,s){const i=e.hasZ(t),r=e.hasM(t),n=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),s);if(i){const s=e.getZExtent(t);n.zmin=s.vmin,n.zmax=s.vmax}if(r){const s=e.getMExtent(t);n.mmin=s.vmin,n.mmax=s.vmax}return n}};class r{constructor(e,t,s){this.x=e,this.y=t,this.spatialReference=s,this.z=void 0,this.m=void 0}}class n{constructor(e,t,s,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),i&&(this.hasM=i)}}class a{constructor(e,t,s,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),i&&(this.hasM=i)}}class o{constructor(e,t,s,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),i&&(this.hasM=i)}}class l{constructor(e,t,s,i,r){this.xmin=e,this.ymin=t,this.xmax=s,this.ymax=i,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},24251:(e,t,s)=>{s.d(t,{a:()=>y,c:()=>h,p:()=>p});var i=s(71252),r=s(1623),n=s(77314),a=s(60947),o=s(35132);const l=[0,0];function u(e,t){if(!t)return null;if("x"in t){const s={x:0,y:0};return[s.x,s.y]=e(t.x,t.y,l),null!=t.z&&(s.z=t.z),null!=t.m&&(s.m=t.m),s}if("xmin"in t){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=e(t.xmin,t.ymin,l),[s.xmax,s.ymax]=e(t.xmax,t.ymax,l),t.hasZ&&(s.zmin=t.zmin,s.zmax=t.zmax,s.hasZ=!0),t.hasM&&(s.mmin=t.mmin,s.mmax=t.mmax,s.hasM=!0),s}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function c(e,t){const s=[];for(const i of e)s.push(d(i,t));return s}function d(e,t){const s=[];for(const i of e){const e=t(i[0],i[1],[0,0]);s.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return s}async function h(e,t){if(!e||!t)return;const s=Array.isArray(e)?e.map((e=>(0,i.i)(e.geometry)?e.geometry.spatialReference:null)).filter(i.i):[e];await(0,r.iQ)(s.map((e=>({source:e,dest:t}))))}const m=u.bind(null,o.hG),f=u.bind(null,o.R6);function p(e,t,s,i){if(!e)return e;if(s||(s=t,t=e.spatialReference),!(0,a.j)(t)||!(0,a.j)(s)||(0,a.e)(t,s))return e;if((0,o.Q8)(t,s)){const t=(0,a.i)(s)?m(e):f(e);return t.spatialReference=s,t}return(0,r.oj)(n.j,[e],t,s,null,i)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,s){if(!e||!e.length||!t||!s||(0,a.e)(t,s))return e;const i={geometries:e,inSpatialReference:t,outSpatialReference:s,resolve:null};return this._jobs.push(i),new Promise((e=>{i.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:s,outSpatialReference:i,resolve:l}=e;(0,o.Q8)(s,i)?(0,a.i)(i)?l(t.map(m)):l(t.map(f)):l((0,r.oj)(n.j,t,s,i,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(e,t,s){return g.push(e,t,s)}},3039:(e,t,s)=>{s.d(t,{Q:()=>p,a:()=>_,c:()=>F,g:()=>v,n:()=>T,t:()=>b});var i=s(57251),r=s(71252),n=s(53785),a=s(1623),o=s(98380),l=s(32422),u=s(95533),c=s(60947),d=s(40267),h=s(85674),m=s(24251);const f=new i.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({}),g=new h.a,y=new h.a,x=new h.a,w={esriGeometryPoint:d.f,esriGeometryPolyline:d.h,esriGeometryPolygon:d.i,esriGeometryMultipoint:d.j};function b(e,t,s,i=e.hasZ,n=e.hasM){if((0,r.a)(t))return null;const a=e.hasZ&&i,o=e.hasM&&n;if(s){const r=(0,d.q)(x,t,e.hasZ,e.hasM,"esriGeometryPoint",s,i,n);return(0,d.f)(r,a,o)}return(0,d.f)(t,a,o)}function v(e,t,s,i,n,a,o=t,l=s){const u=t&&o,c=s&&l,h=(0,r.i)(i)?"coords"in i?i:i.geometry:null;if((0,r.a)(h))return null;if(n){let i=(0,d.g)(y,h,t,s,e,n,o,l);return a&&(i=(0,d.q)(x,i,u,c,e,a)),w[e]?.(i,u,c)??null}if(a){const i=(0,d.q)(x,h,t,s,e,a,o,l);return w[e]?.(i,u,c)??null}return(0,d.r)(g,h,t,s,o,l),w[e]?.(g,u,c)??null}async function T(e,t,s){const{outFields:i,orderByFields:r,groupByFieldsForStatistics:n,outStatistics:a}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(r)for(let e=0;e<r.length;e++)r[e]=r[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),_(e,t,s)}async function _(e,t,i){if(!e)return null;let{where:a}=e;if(e.where=a=a&&a.trim(),(!a||/^1 *= *1$/.test(a)||t&&t===a)&&(e.where=null),!e.geometry)return e;let d=await async function(e){const{distance:t,units:i}=e,r=e.geometry;if(null==t||"vertexAttributes"in r)return r;const a=r.spatialReference,o=i?f.fromJSON(i):(0,n.v)(a),l=a&&((0,c.l)(a)||(0,c.i)(a))?r:await(0,m.c)(a,c.W).then((()=>(0,m.p)(r,c.W)));return(await async function(){return(await Promise.all([s.e(3361),s.e(3981)]).then(s.bind(s,43981)).then((e=>e.g))).geodesicBuffer}())(l.spatialReference,l,t,o)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;d=(0,o.e)(d),d.spatialReference=t}if(d){await(0,m.c)(d.spatialReference,i),d=function(e,t){const s=e.spatialReference;return S(e,t)&&(0,l.YX)(e)?{spatialReference:s,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(d,i);const t=(await(0,u.aX)((0,l.im)(d)))[0];if((0,r.a)(t))throw p;const s="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,n=s&&S(d,i)?{densificationStep:8*s}:void 0,a=t.toJSON(),o=await(0,m.p)(a,a.spatialReference,i,n);if(!o)throw p;o.spatialReference=i,e.geometry=o}return e}function S(e,t){if(!e)return!1;const s=e.spatialReference;return((0,l.YX)(e)||(0,l.oU)(e)||(0,l.l9)(e))&&!(0,c.e)(s,t)&&!(0,a.Up)(s,t)}function F(e){return e&&I in e?JSON.parse(JSON.stringify(e,q)):e}const I="_geVersion",q=(e,t)=>e!==I?t:void 0},92847:(e,t,s)=>{s.d(t,{g:()=>a});var i=s(71252),r=s(53785),n=s(60947);function a(e,t,s){if((0,i.a)(t)||(0,i.a)(s)||s.vcsWkid||(0,n.e)(t,s))return null;const a=(0,r.g)(t)/(0,r.g)(s);if(1===a)return null;switch(e){case"point":case"esriGeometryPoint":return e=>{return s=a,void((t=e)&&null!=t.z&&(t.z*=s));var t,s};case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const s of e.paths)for(const e of s)e.length>2&&(e[2]*=t)}(e,a);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const s of e.rings)for(const e of s)e.length>2&&(e[2]*=t)}(e,a);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const s of e.points)s.length>2&&(s[2]*=t)}(e,a);case"extent":case"esriGeometryExtent":return e=>{return s=a,void((t=e)&&null!=t.zmin&&null!=t.zmax&&(t.zmin*=s,t.zmax*=s));var t,s};default:return null}}},82058:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w,i:()=>f,l:()=>y,p:()=>m,r:()=>A,s:()=>g});var i=s(31450),r=s(88762),n=s(60991),a=s(71552),o=s(76506),l=s(71252),u=s(50406),c=s(32101);s(92143),s(40642);const d=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,h={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function m(e){const t=e?.match(d);if(!t)return null;const[,s,i,r]=t;if(!s)return null;let n=null,a=null,o=null;const{devext:l,qaext:u,www:c}=h;if(i)if(n=s,r)switch(r.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qa":({customBaseUrl:a,portalHostname:o}=u);break;default:return null}else({customBaseUrl:a,portalHostname:o}=c);else switch(s.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:o}=l);break;case"qaext":({customBaseUrl:a,portalHostname:o}=u);break;case"www":({customBaseUrl:a,portalHostname:o}=c);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:o,urlKey:n}}function f(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}const p=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function g(e){const t=(0,c.P$)(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!p.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function y(e,t,s=!1,i){return new Promise(((r,n)=>{if((0,u.Hc)(i))return void n(x());let o=()=>{h(),n(new Error(`Unable to load ${t}`))},c=()=>{const t=e;h(),r(t)},d=()=>{if(!e)return;const t=e;h(),t.src="",n(x())};const h=()=>{(0,a.h)("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",c)),o=null,c=null,e=null,(0,l.i)(i)&&i.removeEventListener("abort",d),d=null,s&&URL.revokeObjectURL(t)};(0,l.i)(i)&&i.addEventListener("abort",d),(0,a.h)("esri-image-decode")?e.decode().then(c,o):(e.addEventListener("error",o),e.addEventListener("load",c))}))}function x(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}async function w(e,t){const o=(0,c.HK)(e),d=(0,c.jc)(e);d||o||(e=(0,c.Fv)(e));const h={url:e,requestOptions:{...(0,l.u)(t)}};let m=(0,c.oh)(e);if(m){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let s,i;try{i=await e.before(t)}catch(e){s=R("request:interceptor",e,t)}if((i instanceof Error||i instanceof n.Z)&&(s=R("request:interceptor",i,t)),s)throw e.error&&e.error(s),s;return i}}(m,h);if(null!=e)return{data:e,getHeader:I,requestOptions:h.requestOptions,url:h.url};m.after||m.error||(m=null)}if(e=h.url,"image"===(t=h.requestOptions).responseType){if((0,a.h)("host-webworker")||(0,a.h)("host-node"))throw R("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),h)}else if(o)throw R("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),h);if("head"===t.method){if(t.body)throw R("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),h);if(o||d)throw R("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),h)}if(await async function(){(0,a.h)("host-webworker")?b||(b=await s.e(9768).then(s.bind(s,89768))):w._abortableFetch||(w._abortableFetch=globalThis.fetch.bind(globalThis))}(),b)return b.execute(e,t);const f=new AbortController;(0,u.fu)(t,(()=>f.abort()));const p={controller:f,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:m,params:h,redoRequest:!1,useIdentity:v.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},y=await async function(e){let t,s;await async function(e){const t=e.params.url,s=e.params.requestOptions,n=e.controller.signal,a=s.body;let o=null,l=null;if(T&&"HTMLFormElement"in globalThis&&(a instanceof FormData?o=a:a instanceof HTMLFormElement&&(o=new FormData(a))),"string"==typeof a&&(l=a),e.fetchOptions={cache:s.cacheBust&&!w._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:s.headers||{},method:"head"===s.method?"HEAD":"GET",mode:"cors",priority:v.priority,redirect:"follow",signal:n},(o||l)&&(e.fetchOptions.body=o||l),"anonymous"===s.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||s.query?.token||o?.get("token")),!e.hasToken&&i.Z.apiKey&&g(t)&&(s.query||(s.query={}),s.query.token=i.Z.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!D(t)&&!(0,u.Hc)(n)){let i;"immediate"===s.authMode?(await C(),i=await r.id.getCredential(t,{signal:n}),e.credential=i):"no-prompt"===s.authMode?(await C(),i=await r.id.getCredential(t,{prompt:!1,signal:n}).catch((()=>{})),e.credential=i):r.id&&(i=r.id.findCredential(t)),i&&(e.credentialToken=i.token,e.useSSL=!!i.ssl)}}(e);try{do{[t,s]=await z(e)}while(!await P(e,t,s))}catch(s){const i=R("request:server",s,e.params,t);throw i.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(i),i}const n=e.params.url;if(s&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)){if(!e.hasToken&&!e.credentialToken&&s.user?.username&&!(0,c.kl)(n)){const e=(0,c.P$)(n,!0);e&&v.trustedServers.push(e)}Array.isArray(s.authorizedCrossOriginNoCorsDomains)&&function(e){i.Z.request.crossOriginNoCorsDomains||(i.Z.request.crossOriginNoCorsDomains={});const t=i.Z.request.crossOriginNoCorsDomains;for(let s of e)s=s.toLowerCase(),/^https?:\/\//.test(s)?t[(0,c.P$)(s)??""]=0:(t[(0,c.P$)("http://"+s)??""]=0,t[(0,c.P$)("https://"+s)??""]=0)}(s.authorizedCrossOriginNoCorsDomains)}const a=e.credential;if(a&&r.id){const e=r.id.findServerInfo(a.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=r.id.findCredential(t,a.userId);e&&-1===r.id._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:s,getHeader:t?e=>t?.headers.get(e):I,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(p);return m?.after?.(y),y}let b;const v=i.Z.request,T="FormData"in globalThis,_=[499,498,403,401],S=["COM_0056","COM_0057","SB_0008"],F=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],I=()=>null,q=Symbol();function M(e){const t=(0,c.P$)(e);return!t||t.endsWith(".arcgis.com")||w._corsServers.includes(t)||(0,c.kl)(t)}function R(e,t,s,i){let r="Error";const a={url:s.url,requestOptions:s.requestOptions,getHeader:I,ssl:!1};if(t instanceof n.Z)return t.details?(t.details=(0,o.d9)(t.details),t.details.url=s.url,t.details.requestOptions=s.requestOptions):t.details=a,t;if(t){const e=i&&(e=>i.headers.get(e)),s=i&&i.status,n=t.message;n&&(r=n),e&&(a.getHeader=e),a.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||s||0,a.subCode=t.subcode,a.messageCode=t.messageCode,"string"==typeof t.details?a.messages=[t.details]:a.messages=t.details,a.raw=q in t?t[q]:t}return(0,u.D_)(t)?(0,u.zE)():new n.Z(e,r,a)}async function C(){r.id||await Promise.all([s.e(6467),s.e(9798)]).then(s.bind(s,89798))}function D(e){return F.some((t=>t.test(e)))}async function z(e){let t=e.params.url;const s=e.params.requestOptions,n=e.fetchOptions??{},o=(0,c.jc)(t)||(0,c.HK)(t),l=s.responseType||"json",d=o?0:null!=s.timeout?s.timeout:v.timeout;let h=!1;if(!o){e.useSSL&&(t=(0,c.hO)(t)),s.cacheBust&&"default"===n.cache&&(t=(0,c.ZN)(t,"request.preventCache",Date.now()));let o={...s.query};e.credentialToken&&(o.token=e.credentialToken);let l=(0,c.B7)(o);(0,a.h)("esri-url-encodes-apostrophe")&&(l=l.replace(/'/g,"%27"));const u=t.length+1+l.length;let d;h="delete"===s.method||"post"===s.method||"put"===s.method||!!s.body||u>v.maxUrlLength;const m=s.useProxy||!!(0,c.ed)(t);if(m){const e=(0,c.b7)(t);d=e.path,!h&&d.length+1+u>v.maxUrlLength&&(h=!0),e.query&&(o={...e.query,...o})}if("HEAD"===n.method&&(h||m)){if(h){if(u>v.maxUrlLength)throw R("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw R("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(m)throw R("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(h?(n.method="delete"===s.method?"DELETE":"put"===s.method?"PUT":"POST",s.body?t=(0,c.fl)(t,o):(n.body=(0,c.B7)(o),n.headers||(n.headers={}),n.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,c.fl)(t,o),m&&(e.useProxy=!0,t=`${d}?${t}`),o.token&&T&&n.body instanceof FormData&&!f(t)&&n.body.set("token",o.token),s.hasOwnProperty("withCredentials"))e.withCredentials=s.withCredentials;else if(!(0,c.D6)(t,(0,c.TI)()))if((0,c.kl)(t))e.withCredentials=!0;else if(r.id){const s=r.id.findServerInfo(t);s&&s.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(n.credentials="include",function(e){const t=i.Z.request.crossOriginNoCorsDomains;if(t){let s=(0,c.P$)(e);if(s)return s=s.toLowerCase(),!(0,c.D6)(s,(0,c.TI)())&&t[s]<Date.now()-36e5}return!1}(t)&&await async function(e){const t=i.Z.request.crossOriginNoCorsDomains,s=(0,c.P$)(e);t&&s&&(t[s.toLowerCase()]=Date.now());const r=(0,c.mN)(e);e=r.path,"json"===r.query?.f&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}(h?(0,c.fl)(t,o):t))}let m,p,g=0,y=!1;d>0&&(g=setTimeout((()=>{y=!0,e.controller.abort()}),d));try{if("native-request-init"===s.responseType)p=n,p.url=t;else if("image"!==s.responseType||"default"!==n.cache||"GET"!==n.method||h||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(s.headers)||!o&&!e.useProxy&&v.proxyUrl&&!M(t)){if(m=await w._abortableFetch(t,n),e.useProxy||function(e){const t=(0,c.P$)(e);t&&!w._corsServers.includes(t)&&w._corsServers.push(t)}(t),"native"===s.responseType)p=m;else if("HEAD"!==n.method)if(m.ok){switch(l){case"array-buffer":p=await m.arrayBuffer();break;case"blob":case"image":p=await m.blob();break;default:p=await m.text()}if(g&&(clearTimeout(g),g=0),"json"===l||"xml"===l||"document"===l)if(p)switch(l){case"json":p=JSON.parse(p);break;case"xml":p=E(p,"application/xml");break;case"document":p=E(p,"text/html")}else p=null;if(p){if("array-buffer"===l||"blob"===l){const e=m.headers.get("Content-Type");if(e&&/application\/json|text\/plain/i.test(e)&&p["blob"===l?"size":"byteLength"]<=750)try{const e=await new Response(p).json();e.error&&(p=e)}catch{}}"image"===l&&p instanceof Blob&&(p=await V(URL.createObjectURL(p),e,!0))}}else p=await m.text()}else p=await V(t,e)}catch(i){if("AbortError"===i.name){if(y)throw new Error("Timeout exceeded");throw(0,u.zE)("Request canceled")}if(!(!m&&i instanceof TypeError&&v.proxyUrl)||s.body||"delete"===s.method||"head"===s.method||"post"===s.method||"put"===s.method||e.useProxy||M(t))throw i;e.redoRequest=!0,(0,c.tD)({proxyUrl:v.proxyUrl,urlPrefix:(0,c.P$)(t)??""})}finally{g&&clearTimeout(g)}return[m,p]}function E(e,t){let s;try{s=(new DOMParser).parseFromString(e,t)}catch{}if(!s||s.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return s}async function P(e,t,s){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||"native"===i.responseType||"native-request-init"===i.responseType)return!0;let n,a;if(!t.ok)throw n=new Error(`Unable to load ${t.url} status: ${t.status}`),n[q]=s,n;s&&(s.error?n=s.error:"error"===s.status&&Array.isArray(s.messages)&&(n={...s},n[q]=s,n.details=s.messages));let o,l=null;n&&(a=Number(n.code),l=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o&&o.toUpperCase());const u=i.authMode;if(403===a&&(4===l||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==u||498===a)&&void 0!==a&&_.includes(a)&&!D(e.params.url)&&(403!==a||o&&!S.includes(o)&&(null==l||2===l&&e.credentialToken))){await C();try{const t=await r.id.getCredential(e.params.url,{error:R("request:server",n,e.params),prompt:"no-prompt"!==u,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===u)return e.credential=void 0,e.credentialToken=void 0,!1;n=t}}if(n)throw n;return!0}function V(e,t,s=!1){const i=t.controller.signal,r=new Image;return t.withCredentials?r.crossOrigin="use-credentials":r.crossOrigin="anonymous",r.alt="",r.fetchPriority=v.priority,r.src=e,y(r,e,s,i)}w._abortableFetch=null,w._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const A=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"}))}}]);