/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{JSONSupport as i}from"../../core/JSONSupport.js";import{L as s}from"../../chunks/Logger.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/ensureType.js";import{subclass as t}from"../../core/accessorSupport/decorators/subclass.js";import{f as o,b as n,A as a,B as l,y as p,a as u}from"../../chunks/vec3.js";import c from"../../geometry/Point.js";import g,{e as h}from"../../geometry/SpatialReference.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../chunks/object.js";import"../../chunks/ArrayPool.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/common.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../geometry/Geometry.js";import"../../geometry/support/webMercatorUtils.js";import"../../chunks/Ellipsoid.js";let m=class extends i{constructor(){super(...arguments),this.values=null}};e([r({type:[Number],json:{write:!0}})],m.prototype,"values",void 0),m=e([t("esri.layers.voxel.VoxelIrregularSpacing")],m);const y=m;let d=class extends i{constructor(){super(...arguments),this.scale=1,this.offset=0}};e([r({type:Number,json:{write:!0}})],d.prototype,"scale",void 0),e([r({type:Number,json:{write:!0}})],d.prototype,"offset",void 0),d=e([t("esri.layers.voxel.VoxelRegularSpacing")],d);const j=d;let S=class extends i{constructor(){super(...arguments),this.irregularSpacing=null,this.isPositiveUp=!0,this.isWrappedDateLine=!1,this.label=null,this.name=null,this.quantity=null,this.regularSpacing=null,this.size=0,this.unit=null}get isRegular(){return(null==this.irregularSpacing||void 0===this.irregularSpacing)&&null!==this.regularSpacing}getRange(){return this.isRegular?[this.regularSpacing.offset,this.regularSpacing.offset+this.regularSpacing.scale*(this.size-1)]:Array.isArray(this.irregularSpacing?.values)&&this.irregularSpacing.values.length>1?[this.irregularSpacing.values[0],this.irregularSpacing.values[this.irregularSpacing.values.length-1]]:[0,0]}};e([r({type:y,json:{write:!0}})],S.prototype,"irregularSpacing",void 0),e([r({type:Boolean,json:{write:!0}})],S.prototype,"isPositiveUp",void 0),e([r({type:Boolean,json:{write:!0}})],S.prototype,"isWrappedDateLine",void 0),e([r({type:String,json:{write:!0}})],S.prototype,"label",void 0),e([r({type:String,json:{write:!0}})],S.prototype,"name",void 0),e([r({type:String,json:{write:!0}})],S.prototype,"quantity",void 0),e([r({type:j,json:{write:!0}})],S.prototype,"regularSpacing",void 0),e([r({type:Number,json:{write:!0}})],S.prototype,"size",void 0),e([r({type:String,json:{write:!0}})],S.prototype,"unit",void 0),e([r({type:Boolean,json:{read:!1}})],S.prototype,"isRegular",null),S=e([t("esri.layers.voxel.VoxelDimension")],S);const v=S,f=s.getLogger("esri.layers.voxel.VoxelVolume");let x=class extends i{constructor(e){super(e),this.id=0,this.dimensions=null,this.spatialReference=g.WGS84}get zDimension(){if(!this.dimensions)return-1;if(!Array.isArray(this.dimensions))return-1;if(4!==this.dimensions.length)return-1;for(let e=2;e<4;++e)if(this.dimensions[e].size>0)return e;return-1}get isValid(){return!(!this.dimensions||!Array.isArray(this.dimensions)||4!==this.dimensions.length||this.dimensions[0].size<1||this.dimensions[1].size<1||-1===this.zDimension||this.dimensions[this.zDimension].size<1)}get originInLayerSpace3D(){if(!this.isValid||"xyt"===this.volumeType)return[0,0,0];const e=this.dimensions[0].getRange(),i=this.dimensions[1].getRange(),s=this.dimensions[2],r=s.isRegular?s.getRange():[0,s.size];return[e[0],i[0],r[0]]}get voxelSizeInLayerSpaceSigned(){if(!this.isValid||"xyt"===this.volumeType)return[0,0,0];const e=this.dimensions[0].getRange(),i=this.dimensions[1].getRange(),s=this.dimensions[2],r=s.isRegular?s.getRange():[0,s.size],t=[this.sizeInVoxels[0],this.sizeInVoxels[1],this.sizeInVoxels[2]];for(let e=0;e<3;++e)t[e]<2?t[e]=1:t[e]-=1;return s.isRegular&&!s.isPositiveUp&&(t[2]*=-1),[(e[1]-e[0])/t[0],(i[1]-i[0])/t[1],(r[1]-r[0])/t[2]]}get volumeType(){if(this.isValid){const e=this.dimensions[2].size>0,i=this.dimensions[3].size>0;if(!e&&i)return"xyt";if(e&&i)return"xyzt"}return"xyz"}get sizeInVoxels(){if(!this.isValid)return[0,0,0];const e=this.zDimension;return[this.dimensions[0].size,this.dimensions[1].size,this.dimensions[e].size]}computeVoxelSpaceLocation(e){if(!this.isValid)return[0,0,0];if("xyt"===this.volumeType)return f.error("computeVoxelSpacePosition cannot be used with XYT volumes."),[0,0,0];if(!h(this.spatialReference,e.spatialReference))return f.error("pos argument should have the same spatial reference as the VoxelLayer."),[0,0,0];const i=o(e.x,e.y,e.z??0);n(i,i,this.originInLayerSpace3D),a(i,i,this.voxelSizeInLayerSpaceSigned);const s=this.dimensions[this.zDimension];if(!s.isRegular&&Array.isArray(s.irregularSpacing?.values)&&s.irregularSpacing.values.length>1){const r=e.z??0,t=s.irregularSpacing.values,o=s.isPositiveUp?1:-1,n=t.reduce(((e,i)=>Math.abs(o*i-r)<Math.abs(o*e-r)?i:e));for(let e=0;e<t.length;++e)if(t[e]===n){i[2]=e;break}}return[i[0],i[1],i[2]]}computeLayerSpaceLocation(e){if(!this.isValid)return new c({x:0,y:0,spatialReference:this.spatialReference});const i=l(e);if(p(i,i,this.voxelSizeInLayerSpaceSigned),u(i,i,this.originInLayerSpace3D),"xyt"===this.volumeType)return new c({x:i[0],y:i[1],spatialReference:this.spatialReference});const s=this.dimensions[this.zDimension];return s.isRegular||Array.isArray(s.irregularSpacing?.values)&&(e[2]<0?i[2]=s.irregularSpacing.values[0]:e[2]<s.irregularSpacing.values.length?i[2]=s.irregularSpacing.values[e[2]]:i[2]=s.irregularSpacing.values[s.irregularSpacing.values.length-1],s.isPositiveUp||(i[2]*=-1)),new c({x:i[0],y:i[1],z:i[2],spatialReference:this.spatialReference})}};e([r({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],x.prototype,"id",void 0),e([r({type:[v],json:{write:{enabled:!0,isRequired:!0}}})],x.prototype,"dimensions",void 0),e([r({type:g,json:{read:{enabled:!1}}})],x.prototype,"spatialReference",void 0),e([r({type:Number,json:{read:!1}})],x.prototype,"zDimension",null),e([r({type:[Boolean],json:{read:!1}})],x.prototype,"isValid",null),e([r({type:[Number],json:{read:!1}})],x.prototype,"originInLayerSpace3D",null),e([r({type:[Number],json:{read:!1}})],x.prototype,"voxelSizeInLayerSpaceSigned",null),e([r({type:["xyz","xyzt","xyt"],json:{read:{enabled:!1}}})],x.prototype,"volumeType",null),e([r({type:[Number],json:{read:!1}})],x.prototype,"sizeInVoxels",null),x=e([t("esri.layers.voxel.VoxelVolume")],x);const z=x;export{z as default};
