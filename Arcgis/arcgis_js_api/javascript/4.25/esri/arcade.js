// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ./chunks/_rollupPluginBabelHelpers ./Graphic ./arcade/ImmutableArray ./core/Error ./core/lang ./layers/FeatureLayer ./rest/support/FeatureSet ./support/arcadeOnDemand".split(" "),function(t,y,I,J,u,K,L,M,N){function O(b,a,c,e={}){a=a.elementType;const d="array"===a.type?[{name:"value",type:a.type,elementType:a.elementType}]:"dictionary"===a.type?[{name:"value",type:a.type,properties:a.properties}]:[{name:"value",type:a.type}];return new J(b.map(f=>{const h={};v(h,d,{value:f},c,e);
return h.value}))}function P(b,a,c={}){b=b instanceof M?new L({source:b.features,geometryType:b.geometryType,fields:b.fields,spatialReference:b.spatialReference}):b;return a.constructFeatureSet(b,c.spatialReference,null,!0,c.lruCache,c.interceptor)}function Q(b,a,c={}){const {spatialReference:e,interceptor:d,lruCache:f}=c;return"string"===typeof b?a.createFeatureSetCollectionFromService(b,e,f,d):a.createFeatureSetCollectionFromMap(b,e,f,d)}function R(b,a,c,e={}){const d={};v(d,a.properties,b,c,e);
return new q.Dictionary(d)}function v(b,a,c,e,d={}){const f={};for(const h of Object.keys(c))f[h.toLowerCase()]=c[h];for(const h of a)if(a=h.name.toLowerCase(),d.variablesPreProcessed)b[a]=f[a];else switch(h.type){case "array":b[a]=O(f[a],h,e,d);break;case "feature":c=f[a];b[a]=null==c?null:q.Feature.createFromGraphic(c);break;case "featureSet":c=f[a];b[a]=e?P(c,e,d):null;break;case "featureSetCollection":c=f[a];b[a]=e?Q(c,e,d):null;break;case "dictionary":b[a]=R(f[a],h,e,d);break;case "geometry":case "boolean":case "date":case "text":case "number":b[a]=
f[a]}}function z(b,a){for(const c of b)a.push(c),"dictionary"===c.type&&z(c.properties,a);return a}function A(b,a,c,e,d){const {spatialReference:f,interceptor:h,lruCache:w,services:n,console:l,abortSignal:k}=c;d={vars:{},spatialReference:f,interceptor:h,lrucache:w,useAsync:d,services:n,console:l,abortSignal:k};if(!a)return d;v(d.vars,b.variables,a,e,c);return d}function r(b,a){switch(a.getArcadeType(b)){case "date":return new Date(b.getTime());case "feature":var c="geometry"in b?b.geometry():null;
b="readAttributes"in b?b.readAttributes():b.attributes;return new I({geometry:c,attributes:b});case "dictionary":c=b.attributes;const e={};for(const d of Object.keys(c))e[d]=r(b.field(d),a);return e;case "array":return("toArray"in b?b.toArray():b).map(d=>r(d,a))}return b}function x(){x=y._asyncToGenerator(function*(b,a,c={}){q||(q=yield N.loadArcade());const {arcade:e,arcadeUtils:d}=q,{loadScriptDependencies:f,referencesMember:h,scriptIsAsync:w}=e;var n=z(a.variables,[]),l=n.filter(g=>"featureSet"===
g.type||"featureSetCollection"===g.type).map(g=>g.name.toLowerCase());const k=e.parseScript(b,l);if(!k)throw new u("arcade:invalid-script","Unable to create SyntaxTree");b=d.extractFieldNames(k);const S=e.scriptTouchesGeometry(k);n=n.map(g=>g.name.toLowerCase()).filter(g=>h(k,g));const p=w(k,l);yield f(k,p,l);l={vars:{},spatialReference:null,useAsync:p};for(const g of n)l.vars[g]="any";const {lruCache:B}=c,C=e.compileScript(k,l),D=e.featureSetUtils();return{execute:(g,m={})=>{if(p)throw new u("arcade:invalid-execution-mode",
"Cannot execute the script in synchronous mode");g=C(A(a,g,{lruCache:B,...m},D,p));return m.rawOutput?g:r(g,d)},executeAsync:function(){var g=y._asyncToGenerator(function*(m,E={}){m=yield C(A(a,m,{lruCache:B,...E},D,p));return E.rawOutput?m:r(m,d)});return function(m){return g.apply(this,arguments)}}(),isAsync:p,variablesUsed:n,fieldsUsed:b,geometryUsed:S,syntaxTree:k}});return x.apply(this,arguments)}let q=null;const F={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},
{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"}]},G={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},H=new Map([["constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},
{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",F],["popup-element",F],["feature-reduction-popup",G],["feature-reduction-popup-element",G],["visualization",{variables:[{name:"$feature",type:"feature"},
{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);t.createArcadeExecutor=function(b,a){return x.apply(this,arguments)};t.createArcadeProfile=function(b){var a=H.get(b);if(!a)throw a=Array.from(H.keys()).map(c=>`'${c}'`).join(", "),new u("createArcadeProfile:invalid-profile-name",`Invalid profile name '${b}'. You must specify one of the following values: ${a}`);return K.clone(a)};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});