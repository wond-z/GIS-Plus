// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/HandleOwner ../core/Loadable ../core/Logger ../core/maybe ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/loadExternal ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(K,x,f,L,e,U,g,h,V,W,X,m,ia,ja,Y,y,M,Z,q,aa,r,B,C,D,ba,ca,da,ea,p,fa,ha){var n;e=n=function(N){function k(a){a=N.call(this,a)||this;a.components=null;a.transform=null;a.external=null;a.hasZ=!0;a.hasM=!1;a.vertexAttributes=new D.MeshVertexAttributes;a.type="mesh";return a}x._inheritsLoose(k,N);var l=k.prototype;l.initialize=function(){if(h.isNone(this.external)||this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.handles.add(X.watch(()=>({vertexAttributes:this.vertexAttributes,
components:this.components?.map(a=>a.clone())}),()=>this._set("external",null),{once:!0,sync:!0}))})};l.addComponent=function(a){this.loaded?(this.components||(this.components=[]),this.components.push(B.from(a)),this.notifyChange("components")):g.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")};l.removeComponent=function(a){if(this.loaded){if(this.components&&(a=this.components.indexOf(a),-1!==a)){this.components.splice(a,1);this.notifyChange("components");
return}g.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else g.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")};l.rotate=function(a,b,c,d){r.fromAxisAndAngle(E.x,a,v);r.fromAxisAndAngle(E.y,b,O);r.fromAxisAndAngle(E.z,c,P);r.compose(v,O,v);r.compose(v,P,v);fa.rotate(this,v,d);return this};l.offset=function(a,b,c,d){if(!this.loaded)return g.getLogger(this.declaredClass).error("offset()",
"Mesh must be loaded before applying operations"),this;z[0]=a;z[1]=b;z[2]=c;ea.offset(this,z,d);return this};l.scale=function(a,b){if(!this.loaded)return g.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this;ha.scale(this,a,b);return this};l.centerAt=function(a,b){if(!this.loaded)return g.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this;ca.centerAt(this,a,b);return this};l.load=function(a){h.isSome(this.external)&&
this.addResolvingPromise(da.loadExternal(this,this.external.source,a));return Promise.resolve(this)};l.updateExternalSource=function(a){this._set("external",a)};l.clone=function(){var a=null;if(this.components){const b=new Map,c=new Map;a=this.components.map(d=>d.cloneWithDeduplication(b,c))}a={components:a,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:h.isSome(this.transform)?this.transform.clone():null,external:h.isSome(this.external)?{source:this.external.source,
extent:h.isSome(this.external.extent)?this.external.extent.clone():null}:null};return new n(a)};l.vertexAttributesChanged=function(){this.notifyChange("vertexAttributes")};l.toBinaryGLTF=function(){var a=x._asyncToGenerator(function*(b){var c=new Promise((t,u)=>K(["./support/meshUtils/exporters/gltf/gltfexport"],t,u));const d=this.load();c=yield Promise.all([c,d]);({toBinaryGLTF:c}=c[0]);return c(this,b)});return function(b){return a.apply(this,arguments)}}();k.createBox=function(a,b){if(!(a instanceof
q))return g.getLogger("esri.geometry.Mesh").error(".createBox()","expected location to be a Point instance"),null;a=new n(p.convertUnitGeometry(p.createUnitSizeBox(),a,b));return b&&b.imageFace&&"all"!==b.imageFace?p.extractSingleFaceOfBox(a,b.imageFace):a};k.createSphere=function(a,b){return a instanceof q?new n(p.convertUnitGeometry(p.createUnitSizeSphere(b&&b.densificationFactor||0),a,b)):(g.getLogger("esri.geometry.Mesh").error(".createSphere()","expected location to be a Point instance"),null)};
k.createCylinder=function(a,b){return a instanceof q?new n(p.convertUnitGeometry(p.createUnitSizeCylinder(b&&b.densificationFactor||0),a,b)):(g.getLogger("esri.geometry.Mesh").error(".createCylinder()","expected location to be a Point instance"),null)};k.createPlane=function(a,b){if(!(a instanceof q))return g.getLogger("esri.geometry.Mesh").error(".createPlane()","expected location to be a Point instance"),null;const c=b?.facing??"up",d=p.convertPlaneSizeParameter(c,b?.size);return new n(p.convertUnitGeometry(p.createUnitSizePlane(c),
a,{...b,size:d}))};k.createFromPolygon=function(a,b){if(!(a instanceof aa))return g.getLogger("esri.geometry.Mesh").error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const c=ba.triangulate(a);return new n({vertexAttributes:new D.MeshVertexAttributes({position:c.position}),components:[new B({faces:c.faces,shading:"flat",material:b?.material??null})],spatialReference:a.spatialReference})};k.createFromGLTF=function(){var a=x._asyncToGenerator(function*(b,c,d){if(!(b instanceof
q))throw g.getLogger("esri.geometry.Mesh").error(".createfromGLTF()","expected location to be a Point instance"),new L("invalid-input","Expected location to be a Point instance");const {loadGLTFMesh:t}=yield W.whenOrAbort(new Promise((u,w)=>K(["./support/meshUtils/loadGLTFMesh"],u,w)),d);return new n(yield t(b,c,d))});return function(b,c,d){return a.apply(this,arguments)}}();k.createWithExternalSource=function(a,b,c){const d=c?.extent??null;c=c?.transform?.clone()??new C;c.origin=[a.x,a.y,a.z??0];
return new n({external:{source:b,extent:d},transform:c,spatialReference:a.spatialReference})};k.createIncomplete=function(a,b){b=b?.transform?.clone()??new C;b.origin=[a.x,a.y,a.z??0];a=new n({transform:b,spatialReference:a.spatialReference});a.addResolvingPromise(Promise.reject(new L("mesh-incomplete","Mesh resources are not complete")));return a};x._createClass(k,[{key:"hasExtent",get:function(){return!this.loaded&&h.isSome(this.external)&&h.isSome(this.external.extent)||this.loaded&&0<this.vertexAttributes.position.length&&
(!this.components||0<this.components.length)}},{key:"_boundingInfo",get:function(){var a=this.vertexAttributes.position;const b=this.spatialReference;if(0===a.length||this.components&&0===this.components.length)return{extent:new M({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b}),center:new q({x:0,y:0,z:0,spatialReference:b})};a=h.isSome(this.transform)?this.transform.project(a,b):a;let c=Infinity,d=Infinity,t=Infinity,u=-Infinity,w=-Infinity,F=-Infinity,Q=0,R=0,S=0;const T=a.length,
G=1/(T/3);let A=0;for(;A<T;){const H=a[A++],I=a[A++],J=a[A++];c=Math.min(c,H);d=Math.min(d,I);t=Math.min(t,J);u=Math.max(u,H);w=Math.max(w,I);F=Math.max(F,J);Q+=G*H;R+=G*I;S+=G*J}return{extent:new M({xmin:c,ymin:d,zmin:t,xmax:u,ymax:w,zmax:F,spatialReference:b}),center:new q({x:Q,y:R,z:S,spatialReference:b})}}},{key:"anchor",get:function(){if(h.isSome(this.transform))return this.transform.getOriginPoint(this.spatialReference);const a=this._boundingInfo;return new q({x:a.center.x,y:a.center.y,z:a.extent.zmin,
spatialReference:this.spatialReference})}},{key:"origin",get:function(){return h.isSome(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}},{key:"extent",get:function(){return!this.loaded&&h.isSome(this.external)&&h.isSome(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}}]);return k}(e.HandleOwnerMixin(U.LoadableMixin(V.EsriPromiseMixin(Z))));f.__decorate([m.property({type:[B],json:{write:!0}})],e.prototype,"components",void 0);
f.__decorate([m.property({type:C,json:{write:!0}})],e.prototype,"transform",void 0);f.__decorate([m.property({constructOnly:!0})],e.prototype,"external",void 0);f.__decorate([m.property({readOnly:!0})],e.prototype,"hasExtent",null);f.__decorate([m.property({readOnly:!0})],e.prototype,"_boundingInfo",null);f.__decorate([m.property({readOnly:!0})],e.prototype,"anchor",null);f.__decorate([m.property({readOnly:!0})],e.prototype,"origin",null);f.__decorate([m.property({readOnly:!0,json:{read:!1}})],e.prototype,
"extent",null);f.__decorate([m.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],e.prototype,"hasZ",void 0);f.__decorate([m.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],e.prototype,"hasM",void 0);f.__decorate([m.property({type:D.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],e.prototype,"vertexAttributes",void 0);e=n=f.__decorate([Y.subclass("esri.geometry.Mesh")],e);const E={x:y.fromValues(1,0,0),y:y.fromValues(0,1,0),z:y.fromValues(0,0,1)},v=r.create(),O=r.create(),
P=r.create(),z=y.create();return e});