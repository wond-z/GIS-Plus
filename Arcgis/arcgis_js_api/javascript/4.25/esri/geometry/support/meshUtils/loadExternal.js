// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(v,w,h,z,m,k,x,A){function n(){n=h._asyncToGenerator(function*(a,b,c){const {loadGLTFMesh:d}=yield k.whenOrAbort(new Promise((p,q)=>v(["./loadGLTFMesh"],p,q)),c),f=yield y(b,c);b=d(new A({x:0,y:0,z:0,spatialReference:a.spatialReference}),f.url,{resolveFile:B(f),useTransform:!0,signal:m.isSome(c)?c.signal:null});
b.then(()=>f.dispose(),()=>f.dispose());const {vertexAttributes:e,components:g}=yield b;a.vertexAttributes=e;a.components=g});return n.apply(this,arguments)}function B(a){const b=x.removeFile(a.url);return c=>{var d=x.makeRelative(c,b,b);return((d=d?d.replace(/^ *\.\//,""):null)?a.files.get(d):null)??c}}function y(a,b){return r.apply(this,arguments)}function r(){r=h._asyncToGenerator(function*(a,b){return a instanceof Blob?l.fromBlob(a):"string"===typeof a?new l(a):Array.isArray(a)?C(a,b):D(a,b)});
return r.apply(this,arguments)}function C(a,b){return t.apply(this,arguments)}function t(){t=h._asyncToGenerator(function*(a,b){const c=new Map;let d=null;a=yield k.eachAlwaysValues(a.map(function(){var e=h._asyncToGenerator(function*(g){return{name:g.name,source:yield y(g instanceof Blob?g:g.source,b)}});return function(g){return e.apply(this,arguments)}}()));const f=[];for(const e of a)e&&(k.isAborted(b)?e.source.dispose():f.push(e));k.throwIfAborted(b);for(const {name:e,source:g}of f){if(m.isNone(d)||
/\.(gltf|glb)/i.test(e))d=g.url;c.set(e,g.url);g.files&&g.files.forEach((p,q)=>c.set(q,p))}if(m.isNone(d))throw new z("mesh-load-external:missing-files","Missing files to load external mesh source");return new l(d,()=>f.forEach(({source:e})=>e.dispose()),c)});return t.apply(this,arguments)}function D(a,b){return u.apply(this,arguments)}function u(){u=h._asyncToGenerator(function*(a,b){const {default:c}=yield k.whenOrAbort(new Promise((d,f)=>v(["../../../request"],e=>d(Object.freeze(Object.defineProperty({__proto__:null,
default:e},Symbol.toStringTag,{value:"Module"}))),f)),b);a="string"===typeof a.multipart[0]?yield Promise.all(a.multipart.map(function(){var d=h._asyncToGenerator(function*(f){return(yield c(f,{responseType:"array-buffer"})).data});return function(f){return d.apply(this,arguments)}}())):a.multipart;return l.fromBlob(new Blob(a))});return u.apply(this,arguments)}let l=function(){function a(b,c=()=>{},d=new Map){this.url=b;this.dispose=c;this.files=d}a.fromBlob=function(b){const c=URL.createObjectURL(b);
return new a(c,()=>URL.revokeObjectURL(c))};return a}();w.loadExternal=function(a,b,c){return n.apply(this,arguments)};Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});