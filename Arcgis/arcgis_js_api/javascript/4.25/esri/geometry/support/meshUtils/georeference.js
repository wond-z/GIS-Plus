// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../projection ../../projectionEllipsoid ../MeshTransform ../buffer/BufferView ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),function(n,l,u,I,z,A,B,J,K,L,k,p,r,m){function v(b,a,c){if(r.isGeographicMesh(a.spatialReference,c)){var d=a.spatialReference,f=C(a,c,w);c=new Float64Array(b.position.length);var e=b.position,g=f;a=d;var h=
c;p.transformMat4(k.BufferViewVec3f64.fromTypedArray(h),k.BufferViewVec3f64.fromTypedArray(e),g);e=new Float64Array(e.length);a=m.projectFromPCPF(h,e,a);f=B.normalFromMat4(D,f);h=c;e=b.normal;g=f;var t=d;if(l.isNone(e))h=null;else{var q=new Float32Array(e.length);p.transformMat3(k.BufferViewVec3f.fromTypedArray(q),k.BufferViewVec3f.fromTypedArray(e),g);m.projectNormalFromPCPF(q,a,h,t,q);h=q}b=b.tangent;if(l.isNone(b))b=null;else{e=new Float32Array(b.length);p.transformMat3(k.BufferViewVec3f.fromTypedArray(e,
4*Float32Array.BYTES_PER_ELEMENT),k.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),f);for(f=3;f<e.length;f+=4)e[f]=b[f];m.projectTangentFromPCPF(e,a,c,d,e);b=e}b={position:a,normal:h,tangent:b}}else{d=new Float64Array(b.position.length);f=b.position;h=a.x;e=a.y;g=a.z||0;const {horizontal:E,vertical:M}=x(c?c.unit:null,a.spatialReference);for(a=0;a<f.length;a+=3)d[a+0]=f[a+0]*E+h,d[a+1]=f[a+1]*E+e,d[a+2]=f[a+2]*M+g;b={position:d,normal:b.normal,tangent:b.tangent}}return b}function F(b,
a,c){const {position:d,normal:f,tangent:e}=b;if(l.isNone(a))return{position:d,normal:f,tangent:e};var g=a.localMatrix;b=m.transformPosition(d,new Float64Array(d.length),g);const h=l.isSome(f)?m.transformNormal(f,new Float32Array(f.length),g):null;g=l.isSome(e)?m.transformTangent(e,new Float32Array(e.length),g):null;return v({position:b,normal:h,tangent:g},a.getOriginPoint(c),{geographic:a.geographic})}function G(b,a,c){return r.isGeographicMesh(a.spatialReference,c)?H(b,a,c):y(b,a,c)}function y(b,
a,c){const d=new Float64Array(b.position.length),f=b.position,e=a.x,g=a.y,h=a.z||0,{horizontal:t,vertical:q}=x(c?c.unit:null,a.spatialReference);for(a=0;a<f.length;a+=3)d[a+0]=(f[a+0]-e)/t,d[a+1]=(f[a+1]-g)/t,d[a+2]=(f[a+2]-h)/q;return{position:d,normal:b.normal,tangent:b.tangent}}function H(b,a,c){var d=a.spatialReference;C(a,c,w);var f=z.invert(N,w);c=new Float64Array(b.position.length);a=m.projectToPCPF(b.position,d,c);var e=k.BufferViewVec3f64.fromTypedArray(a);a=new Float64Array(a.length);var g=
k.BufferViewVec3f64.fromTypedArray(a);p.transformMat4(g,e,f);f=B.normalFromMat4(D,f);e=b.normal;g=b.position;l.isNone(e)?e=null:(e=m.projectNormalToPCPF(e,g,c,d,new Float32Array(e.length)),g=k.BufferViewVec3f.fromTypedArray(e),p.transformMat3(g,g,f));g=b.tangent;b=b.position;l.isNone(g)?d=null:(d=m.projectTangentToPCPF(g,b,c,d,new Float32Array(g.length)),b=k.BufferViewVec3f.fromTypedArray(d,4*Float32Array.BYTES_PER_ELEMENT),p.transformMat3(b,b,f));return{position:a,normal:e,tangent:d}}function C(b,
a,c){J.computeTranslationToOriginAndRotation(b.spatialReference,[b.x,b.y,b.z||0],c,K.getSphericalPCPF(b.spatialReference));const {horizontal:d,vertical:f}=x(a?a.unit:null,b.spatialReference);z.scale(c,c,[d,d,f]);return c}function x(b,a){if(l.isNone(b))return O;const c=a.isGeographic?1:u.getMetersPerUnitForSR(a);a=a.isGeographic?1:u.getMetersPerVerticalUnitForSR(a);b=u.convertUnit(1,b,"meters");return{horizontal:b*c,vertical:b*a}}const w=A.create(),N=A.create(),D=I.create(),O={horizontal:1,vertical:1};
n.georeference=v;n.georeferenceApplyTransform=F;n.georeferenceByTransform=function(b,a,c){if(c?.useTransform){const {position:d,normal:f,tangent:e}=b;return{vertexAttributes:{position:d,normal:f,tangent:e},transform:new L({origin:[a.x,a.y,a.z??0],geographic:r.isGeographicMesh(a.spatialReference,c)})}}return{vertexAttributes:v(b,a,c),transform:null}};n.ungeoreference=G;n.ungeoreferenceByTransform=function(b,a,c,d){if(l.isNone(a))return G(b,c,d);b=F(b,a,c.spatialReference);return c.equals(a.getOriginPoint(c.spatialReference))?
y(b,c,d):r.isGeographicMesh(c.spatialReference,d)?H(b,c,d):y(b,c,d)};Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});