// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Color ./core/Collection ./core/collectionUtils ./core/compilerUtils ./core/Error ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./ground/NavigationConstraint ./views/3d/support/debugFlags ./webdoc/support/opacityUtils".split(" "),
function(u,p,l,B,C,D,E,F,g,w,G,H,x,r,q,y,I,J,K,L,z){function A(h){return"elevation"===h.type||h&&"createElevationSampler"in h}var v;g=v=function(h){function m(a){var b=h.call(this,a)||this;b.opacity=1;b.shading=!L.TERRAIN_USE_LEGACY_SHADING;b.surfaceColor=null;b.navigationConstraint=null;b.layers=new C;b.layers.on("after-add",c=>{c=c.item;c.parent&&c.parent!==p._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=p._assertThisInitialized(b);"elevation"!==c.type&&"base-elevation"!==
c.type&&x.getLogger(b.declaredClass).error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)});b.layers.on("after-remove",c=>{c.item.parent=null});return b}p._inheritsLoose(m,h);var e=m.prototype;e.initialize=function(){this.when().catch(a=>{x.getLogger(this.declaredClass).error("#load()","Failed to load ground",a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};
e.destroy=function(){const a=this.layers.removeAll();for(const b of a)b.destroy();this.layers.destroy()};e.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a={...a},delete a.resourceInfo);return a};e.writeLayers=function(a,b,c,d){const n=[];a&&(d={...d,layerContainerType:"ground"},a.forEach(f=>{if("write"in f){const k={};E.typeCast(f)().write(k,d)&&n.push(k)}else d&&d.messages&&d.messages.push(new F("layer:unsupported",`Layers (${f.title}, ${f.id}) of type '${f.declaredClass}' cannot be persisted in the ground`,
{layer:f}))}));b.layers=n};e.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};e.loadAll=function(){return H.loadAll(this,a=>{a(this.layers)})};e.queryElevation=function(){var a=p._asyncToGenerator(function*(b,c){yield this.load({signal:c?.signal});var {ElevationQuery:d}=yield new Promise((f,k)=>u(["./layers/support/ElevationQuery"],f,k));r.throwIfAborted(c);d=new d;const n=this.layers.filter(A).toArray();return d.queryAll(n,b,c)});return function(b,
c){return a.apply(this,arguments)}}();e.createElevationSampler=function(){var a=p._asyncToGenerator(function*(b,c){yield this.load({signal:c?.signal});var {ElevationQuery:d}=yield new Promise((f,k)=>u(["./layers/support/ElevationQuery"],f,k));r.throwIfAborted(c);d=new d;const n=this.layers.filter(A).toArray();return d.createSamplerAll(n,b,c)});return function(b,c){return a.apply(this,arguments)}}();e.clone=function(){const a={opacity:this.opacity,surfaceColor:w.clone(this.surfaceColor),navigationConstraint:w.clone(this.navigationConstraint),
layers:this.layers.slice()};this.loaded&&(a.loadStatus="loaded");return(new v({resourceInfo:this.resourceInfo})).set(a)};e.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});h.prototype.read.call(this,a,b)};e._loadFromSource=function(a){const b=this.resourceInfo;return b?this._loadLayersFromJSON(b.data,b.context,a):Promise.resolve()};e._loadLayersFromJSON=function(a,b,c){const d=b&&b.origin||"web-scene",n=b&&b.portal||null,f=b&&b.url||null;return(new Promise((k,t)=>
u(["./layers/support/layersCreator"],k,t))).then(({populateOperationalLayers:k})=>{r.throwIfAborted(c);const t=[];a.layers&&Array.isArray(a.layers)&&t.push(k(this.layers,a.layers,{context:{origin:d,url:f,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));return r.eachAlways(t)}).then(()=>{})};p._createClass(m,[{key:"layers",set:function(a){this._set("layers",D.referenceSetter(a,this._get("layers")))}}]);return m}(g.JSONSupportMixin(G));l.__decorate([q.property({json:{read:!1}})],
g.prototype,"layers",null);l.__decorate([J.writer("layers")],g.prototype,"writeLayers",null);l.__decorate([q.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);l.__decorate([q.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:y.Integer,read:{reader:z.transparencyToOpacity,source:"transparency"},write:{writer:(h,m)=>{m.transparency=z.opacityToTransparency(h)},target:"transparency"}}})],g.prototype,"opacity",void 0);l.__decorate([q.property({type:Boolean,nonNullable:!0,json:{read:!1}})],
g.prototype,"shading",void 0);l.__decorate([q.property({type:B,json:{type:[y.Integer],write:(h,m)=>{m.surfaceColor=h.toJSON().slice(0,3)}}})],g.prototype,"surfaceColor",void 0);l.__decorate([q.property({type:K.NavigationConstraint,json:{write:!0}})],g.prototype,"navigationConstraint",void 0);return g=v=l.__decorate([I.subclass("esri.Ground")],g)});