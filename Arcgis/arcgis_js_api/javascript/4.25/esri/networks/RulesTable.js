// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/JSONSupport ../core/Loadable ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/typeUtils".split(" "),function(x,q,D,m,E,t,G,H,F,p){m=function(z){function y(d){d=z.call(this,d)||this;d.request=D;return d}x._inheritsLoose(y,z);var u=y.prototype;u.initialize=function(){};u.load=function(){var d=x._asyncToGenerator(function*(e){e=
this.layer.load(e).then(()=>this._initializeRulesTable());this.addResolvingPromise(e);return this});return function(e){return d.apply(this,arguments)}}();u.getFeatureSQL=function(d,e){var a=d.layerId.toString(),f=d.fieldsIndex?.normalizeFieldName("assetGroup");d=d.fieldsIndex?.normalizeFieldName("assetType");f=f?e.attributes[f]:null;e=d?e.attributes[d]:null;if(a=this.rulesHash[a])if(a=a.assetGroupHash[f])return(a=a.assetTypeHash[e])?a:null;return null};u._initializeRulesTable=function(){var d=x._asyncToGenerator(function*(){const e=
{};let a;var f=a||(a={});f[f.from=0]="from";f[f.to=1]="to";f[f.via=2]="via";f=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(const g of this.rules)if(g.ruleType===p.RuleType.RTJunctionJunctionConnectivity||g.ruleType===p.RuleType.RTJunctionEdgeConnectivity||g.ruleType===
p.RuleType.RTEdgeJunctionEdgeConnectivity){var b=[[a.from,a.to],[a.to,a.from]];g.ruleType===p.RuleType.RTEdgeJunctionEdgeConnectivity&&(b=[[a.from,a.via],[a.via,a.from],[a.to,a.via],[a.via,a.to]]);for(const A of b){b=A.shift();var h=A.shift(),k=!1;switch(g.ruleType){case p.RuleType.RTEdgeJunctionEdgeConnectivity:k=b===a.from||b===a.to;break;case p.RuleType.RTJunctionEdgeConnectivity:k=b===a.to}var l=f[b];b=g[l.networkSourceId].layerId.toString();const r=g[l.assetGroupId]?.assetGroupCode?.toString();
l=g[l.assetTypeId]?.assetTypeCode?.toString();var n=f[h];h=g[n.networkSourceId].layerId.toString();const B=g[n.assetGroupId]?.assetGroupCode?.toString();n=g[n.assetTypeId];const C=n?.assetTypeCode?.toString(),v=e[b]?e[b]:{assetGroupHash:{}};if(!(r&&l&&B&&C))continue;const w=v.assetGroupHash[r]?v.assetGroupHash[r]:{assetTypeHash:{}},c=w.assetTypeHash[l]?w.assetTypeHash[l]:{};c[h]=c[h]?c[h]:{};k&&(c[b]=c[b]?c[b]:{},k=`(assetgroup = ${r} AND assettype = ${l})`,c[b].anyVertex=c[b].anyVertex?`${c[b].anyVertex}`:
`${k}`,"esriNECPEndVertex"===n.connectivityPolicy&&(c[b].endVertex=c[b]?.endVertex?`${c[b].endVertex}`:`${k}`));k=`(assetgroup = ${B} AND assettype = ${C})`;c[h].anyVertex=c[h]?.anyVertex?`${c[h].anyVertex} OR ${k}`:`${k}`;"esriNECPEndVertex"===n.connectivityPolicy&&(c[h].endVertex=c[h]?.endVertex?`${c[h].endVertex} OR ${k}`:`${k}`);w.assetTypeHash[l]=c;v.assetGroupHash[r]=w;e[b]=v}}this.rulesHash=e});return function(){return d.apply(this,arguments)}}();return y}(m.JSONSupportMixin(E));q.__decorate([t.property({constructOnly:!0})],
m.prototype,"layer",void 0);q.__decorate([t.property({constructOnly:!0})],m.prototype,"rules",void 0);q.__decorate([t.property()],m.prototype,"rulesHash",void 0);q.__decorate([t.property({constructOnly:!0})],m.prototype,"request",void 0);return m=q.__decorate([F.subclass("esri.networks.RulesTable")],m)});