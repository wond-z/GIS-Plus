// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/maybe ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../operations/urlUtils ./queryZScale".split(" "),function(g,l,u,h,q,v,w,x,y){function r(a,b){const c=a.geometry;a=a.toJSON();h.isSome(c)&&(a.geometry=JSON.stringify(c),a.geometryType=v.getJsonType(c),a.inSR=c.spatialReference.wkid||JSON.stringify(c.spatialReference));a.topFilter?.groupByFields&&(a.topFilter.groupByFields=
a.topFilter.groupByFields.join(","));a.topFilter?.orderByFields&&(a.topFilter.orderByFields=a.topFilter.orderByFields.join(","));a.topFilter&&(a.topFilter=JSON.stringify(a.topFilter));a.objectIds&&(a.objectIds=a.objectIds.join(","));a.orderByFields&&(a.orderByFields=a.orderByFields.join(","));!a.outFields||b?.returnCountOnly||b?.returnExtentOnly||b?.returnIdsOnly?delete a.outFields:a.outFields.includes("*")?a.outFields="*":a.outFields=a.outFields.join(",");a.outSR?a.outSR=a.outSR.wkid||JSON.stringify(a.outSR):
c&&a.returnGeometry&&(a.outSR=a.inSR);a.returnGeometry&&delete a.returnGeometry;if(a.timeExtent){const {start:d,end:e}=a.timeExtent;if(null!=d||null!=e)a.time=d===e?d:`${null==d?"null":d},${null==e?"null":e}`;delete a.timeExtent}return a}function m(){m=l._asyncToGenerator(function*(a,b,c,d){a=yield k(a,b,"json",d);y.applyFeatureSetZUnitScaling(b,c,a.data);return a});return m.apply(this,arguments)}function n(){n=l._asyncToGenerator(function*(a,b,c){return h.isSome(b.timeExtent)&&b.timeExtent.isEmpty?
{data:{objectIds:[]}}:k(a,b,"json",c,{returnIdsOnly:!0})});return n.apply(this,arguments)}function p(){p=l._asyncToGenerator(function*(a,b,c){return h.isSome(b.timeExtent)&&b.timeExtent.isEmpty?{data:{count:0,extent:null}}:k(a,b,"json",c,{returnExtentOnly:!0,returnCountOnly:!0}).then(d=>{const e=d.data;if(e.hasOwnProperty("extent"))return d;if(e.features)throw Error("Layer does not support extent calculation.");if(e.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");
return d})});return p.apply(this,arguments)}function k(a,b,c,d={},e={}){const t="string"===typeof a?q.urlToObject(a):a;a=b.geometry?[b.geometry]:[];d.responseType="pbf"===c?"array-buffer":"json";return w.normalizeCentralMeridian(a,null,d).then(f=>{f=f&&f[0];h.isSome(f)&&(b=b.clone(),b.geometry=f);f=x.mapParameters({...t.query,f:c,...e,...r(b,e)});return u(q.join(t.path,"queryTopFeatures"),{...d,query:{...f,...d.query}})})}g.executeQueryForTopCount=function(a,b,c){return h.isSome(b.timeExtent)&&b.timeExtent.isEmpty?
Promise.resolve({data:{count:0}}):k(a,b,"json",c,{returnIdsOnly:!0,returnCountOnly:!0})};g.executeQueryForTopExtents=function(a,b,c){return p.apply(this,arguments)};g.executeQueryForTopIds=function(a,b,c){return n.apply(this,arguments)};g.executeTopFeaturesQuery=function(a,b,c,d){return m.apply(this,arguments)};g.queryToQueryStringParameters=r;Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});