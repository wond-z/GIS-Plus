// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/stretchUtils ../../../../rest/support/ImageHistogramParameters ./RasterLayerAdapter ../../../../geometry/Point".split(" "),function(l,m,e,h,t,B,C,u,v,w,x,
y){e=function(n){function k(){var b=n.apply(this,arguments)||this;b._cacheSize=20;b._statsCache=new Map;return b}l._inheritsLoose(k,n);var f=k.prototype;f.generateRasterInfo=function(b){const a=h.unwrap(b?.renderingRule);return this.layer.generateRasterInfo(a,{signal:b?.signal})};f.estimateStatisticsHistograms=function(){var b=l._asyncToGenerator(function*(a){var d=h.unwrap(a?.renderingRule)?.functionName??"default";if(this._statsCache.has(d))return this._statsCache.get(d);let {width:p,height:q,pixelSize:g}=
this.layer.rasterInfo;for(var c=1;2E3<p||2E3<q;)p/=2,q/=2,c*=2;const z=a?.renderingRule??this.layer.renderingRule,{fullExtent:r,mosaicRule:A}=this.layer;g=new y(g.x*c,g.y*c,r.spatialReference);c=new w({geometry:r,pixelSize:g,renderingRule:z,mosaicRule:A});this.layer.capabilities.operations.supportsComputeStatisticsHistograms?a=yield this.layer.computeStatisticsHistograms(c,a):({histograms:a}=yield this.layer.computeHistograms(c,a),a={statistics:v.estimateStatisticsFromHistograms(a),histograms:a});
this._statsCache.set(d,a);this._statsCache.size>this._cacheSize&&(d=this._statsCache.keys().next().value,this._statsCache.delete(d));return a});return function(a){return b.apply(this,arguments)}}();f.supportsMultidirectionalHillshade=function(){return 10.81<=this.layer.version};f.load=function(b){this.addResolvingPromise(this.layer.load(b).then(()=>{this.generateRasterInfo({renderingRule:this.renderingRule,signal:h.unwrap(b)?.signal}).then(a=>this.rasterInfo=a)}));return Promise.resolve(this)};return k}(x);
m.__decorate([t.property()],e.prototype,"layer",void 0);return e=m.__decorate([u.subclass("esri.smartMapping.support.adapters.ImageryLayerAdapter")],e)});