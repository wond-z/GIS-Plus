// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ../../layers/support/fieldUtils ./support/utils ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils".split(" "),function(n,d,t,p,g,u,q,f){function v(a){return h.apply(this,arguments)}function h(){h=n._asyncToGenerator(function*(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new d("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new d("histogram:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&u.verifyBinningParams(a,"histogram");const {layer:k,...l}=a;var c=a.forBinning?f.binningCapableLayerTypes:f.defaultSupportedLayerTypes,b=f.createLayerAdapter(k,c,a.forBinning);a={layerAdapter:b,...l};a.normalizationType=q.getNormalizationType(a);if(!b)throw new d("histogram:invalid-parameters","'layer' must be one of these types: "+f.getLayerTypeLabels(c).join(", "));
c=t.isSome(a.signal)?{signal:a.signal}:null;yield b.load(c);const w=a.valueExpression||a.sqlExpression;var e=a.field;c=e?b.getField(e):null;const r=!a.classificationMethod||"equal-interval"===a.classificationMethod;e=yield q.getFieldsList({field:e,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(e=g.verifyBasicFieldValidity(b,e,"histogram:invalid-parameters"))throw e;if(c){if(b=g.verifyFieldType(b,c,"histogram:invalid-parameters",x))throw b;if(p.isDateField(c)){if(a.normalizationType)throw new d("histogram:invalid-parameters",
"Normalization is not allowed for date fields");if(!r)throw new d("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields");}}else if(w){if(a.normalizationType)throw new d("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!r)throw new d("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified");
}if(b=g.verifyFilterValidty(a.filter,"histogram:invalid-parameters"))throw b;return a});return h.apply(this,arguments)}function m(){m=n._asyncToGenerator(function*(a){const {layerAdapter:k,...l}=yield v(a);return k.histogram(l)});return m.apply(this,arguments)}const x=["date",...p.numericTypes];return function(a){return m.apply(this,arguments)}});