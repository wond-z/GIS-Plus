// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../core/maybe ../../geometry/support/scaleUtils ../../renderers/support/AuthoringInfo ../heuristics/outline ./support/dotDensityUtils ./support/utils ../statistics/spatialStatistics ../statistics/summaryStatisticsForAttributes ../statistics/support/attributeDensity ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/dotDensity".split(" "),
function(z,n,T,U,D,V,W,X,Y,Z,aa,k,t,A,E,F,p,q,G,H,I,J,B,l,C){function K(a){return u.apply(this,arguments)}function u(){u=n._asyncToGenerator(function*(a){if(!(a&&a.layer&&a.view&&a.attributes&&a.attributes.length))throw new k("dot-density-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(8<a.attributes.length)throw new k("dot-density-renderer:invalid-parameters","Dot density renderer does not support more than 8 attributes");a.forBinning&&J.verifyBinningParams(a,
"dot-density-renderer");const b={...a};var c=[l.LayerType.FeatureLayer,l.LayerType.OGCFeatureLayer,l.LayerType.GeoJSONLayer,l.LayerType.WFSLayer];c=a.forBinning?l.binningCapableLayerTypes:c;a=l.createLayerAdapter(b.layer,c,a.forBinning);b.layer=a;b.dotBlendingEnabled=null==b.dotBlendingEnabled?!0:b.dotBlendingEnabled;b.dotValueOptimizationEnabled=null==b.dotValueOptimizationEnabled?!0:b.dotValueOptimizationEnabled;if(!a)throw new k("dot-density-renderer:invalid-parameters","'layer' must be one of these types: "+
l.getLayerTypeLabels(c).join(", "));c=t.isSome(b.signal)?{signal:b.signal}:null;yield Promise.all([b.view.when(),a.load(c)]);if("polygon"!==a.geometryType)throw new k("dot-density-renderer:not-supported","Dot density renderer is supported for polygon layers only");c=[];var d=b.attributes;for(var f of d)d=yield B.getFieldsList({field:f.field,valueExpression:f.valueExpression}),c.push(...d);if(f=q.verifyBasicFieldValidity(a,c.filter(Boolean),"dot-density-renderer:invalid-parameters"))throw f;return b});
return u.apply(this,arguments)}function L(a){return v.apply(this,arguments)}function v(){v=n._asyncToGenerator(function*(a){let b=a.dotDensityScheme,c=null;var d=null;d=yield q.getBasemapInfo(a.basemap,a.view);c=t.isSome(d.basemapId)?d.basemapId:null;d=t.isSome(d.basemapTheme)?d.basemapTheme:null;if(b)return{scheme:C.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=C.getSchemes({basemap:c,numColors:a.attributes.length,basemapTheme:d}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,
basemapId:c,basemapTheme:d}});return v.apply(this,arguments)}function M(a){return w.apply(this,arguments)}function w(){w=n._asyncToGenerator(function*(a){const {view:b,layer:c,attributes:d,signal:f}=a;a=yield c.getSampleFeatures({view:b,sampleSize:500,returnGeometry:!0,signal:f});const [e,h]=yield Promise.all([G({features:a,geometryType:c.geometryType}),H({layer:c,attributes:d,includeZeros:!1,includeNegatives:!1,view:b,signal:f})]);a="avgSize"in e&&e.avgSize;const g=h.avg;if(!a)throw new k("dot-density-renderer:insufficient-info",
"Average polygon size is invalid");if(!g)throw new k("dot-density-renderer:insufficient-info","Average attribute value is invalid");const r=A.getResolutionForScale(b.scale,b.spatialReference);return{dotValue:p.roundValue(g/(a*a/(r*r)*.1))||1,referenceScale:b.scale,minSliderValue:1,maxSliderValue:p.roundValue(g)}});return w.apply(this,arguments)}function N(a){return x.apply(this,arguments)}function x(){x=n._asyncToGenerator(function*(a){const {view:b,layer:c,attributes:d,signal:f}=a;a=[];for(var e of d){var h=
yield B.getFieldsList({field:e.field,valueExpression:e.valueExpression});a.push(...h)}e=yield c.getSampleFeatures({view:b,sampleSize:500,requiredFields:a,returnGeometry:!0,signal:f});e=yield I({features:e,attributes:d,includeZeros:!1,includeNegatives:!1,view:b});if(!e.avgDensity||!e.minDensity||!e.maxDensity)throw new k("dot-density-renderer:insufficient-info","Invalid density values");a=A.getResolutionForScale(b.scale,b.spatialReference);const g=a*a;a=p.roundValue(e.minDensity*g);h=p.roundValue(e.maxDensity*
g);e=p.roundValue(e.avgDensity*g*10)||1;e>h&&(e=h);return{dotValue:e,referenceScale:b.scale,minSliderValue:a,maxSliderValue:h}});return x.apply(this,arguments)}function y(){y=n._asyncToGenerator(function*(a){var b=yield K(a),c=b.layer;const d=c.geometryType,f=(a=yield L(b))&&a.scheme;if(!f)throw new k("dot-density-renderer:insufficient-info","Unable to find dot-density scheme");c={layer:c,view:b.view,attributes:b.attributes,signal:b.signal};const e={layer:b.layer,view:b.view,signal:b.signal},[h,g]=
yield Promise.all([b.trueDensity?N(c):M(c),b.outlineOptimizationEnabled?F(e):null]),{dotValue:r,referenceScale:O,minSliderValue:P,maxSliderValue:Q}=h,R=q.createColors(f.colors,b.attributes.length);c=b.attributes.map((m,S)=>({field:m.field,valueExpression:m.valueExpression,label:m.label,valueExpressionTitle:m.valueExpressionTitle,color:R[S]}));b=new D({attributes:c,dotBlendingEnabled:b.dotBlendingEnabled,outline:g?q.getSymbolOutlineFromScheme(f,d,g.opacity):null,dotValue:r,referenceScale:b.dotValueOptimizationEnabled?
O:null,legendOptions:b.legendOptions});g&&g.visualVariables&&g.visualVariables.length&&(b.visualVariables=g.visualVariables.map(m=>m.clone()));b.authoringInfo=new E({type:"dot-density",minSliderValue:P,maxSliderValue:Q});return{renderer:b,dotDensityScheme:f,basemapId:a.basemapId,basemapTheme:a.basemapTheme}});return y.apply(this,arguments)}z.createRenderer=function(a){return y.apply(this,arguments)};Object.defineProperties(z,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});