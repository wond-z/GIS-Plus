// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../core/maybe ../../core/screenUtils ../../intl/messages ../../intl/substitute ../../renderers/support/AuthoringInfo ../../renderers/support/AuthoringInfoVisualVariable ../../renderers/support/utils ../../renderers/visualVariables/SizeVariable ../../renderers/visualVariables/support/sizeVariableUtils ../heuristics/ageUnit ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/support/ageUtils ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/size".split(" "),
function(C,w,W,wa,xa,ya,za,Aa,Ba,Ca,Da,h,A,X,G,ha,Y,ia,ja,Z,ka,la,aa,ma,g,E,H,F,r,B){function na(a){return I.apply(this,arguments)}function I(){I=w._asyncToGenerator(function*(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new h("size-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new h("size-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");
a.forBinning&&H.verifyBinningParams(a,"size-visual-variable");const b={...a};if("90-10"===b.theme)throw new h("size-visual-variable:not-supported","Only 'high-to-low', 'above', 'below' themes are supported.");var c=a.forBinning?r.binningCapableLayerTypes:r.featureCapableLayerTypes;a=r.createLayerAdapter(b.layer,c,a.forBinning);b.layer=a;if(!a)throw new h("size-visual-variable:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));"height"===b.axis&&(b.sizeOptimizationEnabled=
!1);c=A.isSome(b.signal)?{signal:b.signal}:null;yield a.load(c);c=a.geometryType;if("mesh"===c)throw new h("size-visual-variable:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(b.worldScale){if("polyline"===c||"polygon"===c)throw new h("size-visual-variable:not-supported","'worldScale' sizing is not supported for polyline and polygon layers");if(!b.view||"3d"!==b.view.type)throw new h("size-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true");
}c=yield F.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});if(a=g.verifyBasicFieldValidity(a,c,"size-visual-variable:invalid-parameters"))throw a;return b});return I.apply(this,arguments)}function oa(a){return J.apply(this,arguments)}function J(){J=w._asyncToGenerator(function*(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new h("size-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new h("size-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&H.verifyBinningParams(a,"size-continuous-renderer");const b={...a};b.symbolType=b.symbolType||"2d";b.defaultSymbolEnabled=null==b.defaultSymbolEnabled?!0:b.defaultSymbolEnabled;var c=a.forBinning?r.binningCapableLayerTypes:r.featureCapableLayerTypes;a=r.createLayerAdapter(b.layer,c,a.forBinning);b.layer=a;if(!a)throw new h("size-continuous-renderer:invalid-parameters",
"'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));c=A.isSome(b.signal)?{signal:b.signal}:null;yield a.load(c);c=a.geometryType;const d=b.symbolType.includes("3d");b.outlineOptimizationEnabled="polygon"===c?b.outlineOptimizationEnabled:!1;if("mesh"===c)throw new h("size-continuous-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(d&&("polyline"===c||"polygon"===c))throw new h("size-continuous-renderer:not-supported",
"3d symbols are not supported for polyline and polygon layers");if(b.symbolType.includes("3d-volumetric")&&(!b.view||"3d"!==b.view.type))throw new h("size-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");c=yield F.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});if(a=g.verifyBasicFieldValidity(a,c,"size-continuous-renderer:invalid-parameters"))throw a;
return b});return J.apply(this,arguments)}function pa(a){return K.apply(this,arguments)}function K(){K=w._asyncToGenerator(function*(a){if(!a||!a.layer||!a.field&&!a.valueExpression)throw new h("size-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&!a.view)throw new h("size-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&H.verifyBinningParams(a,"size-class-breaks-renderer");
const b={...a};b.symbolType=b.symbolType||"2d";b.defaultSymbolEnabled=null==b.defaultSymbolEnabled?!0:b.defaultSymbolEnabled;b.classificationMethod=b.classificationMethod||"equal-interval";b.normalizationType=F.getNormalizationType(b);var c=a.forBinning?r.binningCapableLayerTypes:r.featureCapableLayerTypes;a=r.createLayerAdapter(b.layer,c,a.forBinning);b.layer=a;if(!a)throw new h("size-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));
if(!(null!=b.minValue&&null!=b.maxValue||null==b.minValue&&null==b.maxValue))throw new h("size-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");c=A.isSome(b.signal)?{signal:b.signal}:null;yield a.load(c);c=a.geometryType;const d=b.symbolType.includes("3d");b.outlineOptimizationEnabled="polygon"===c?b.outlineOptimizationEnabled:!1;if("mesh"===c)throw new h("size-class-breaks-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");
if(d&&("polyline"===c||"polygon"===c))throw new h("size-class-breaks-renderer:not-supported","3d symbols are not supported for polyline and polygon layers");if(b.symbolType.includes("3d-volumetric")&&(!b.view||"3d"!==b.view.type))throw new h("size-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");c=yield F.getFieldsList({field:b.field,normalizationField:b.normalizationField});if(a=
g.verifyBasicFieldValidity(a,c,"size-class-breaks-renderer:invalid-parameters"))throw a;return b});return K.apply(this,arguments)}function ba(a){a={...a};const b=a.symbolType.includes("3d-volumetric");if(a.worldScale=b)a.axis="3d-volumetric-uniform"===a.symbolType?"all":"height";delete a.symbolType;delete a.defaultSymbolEnabled;return a}function qa(a){return L.apply(this,arguments)}function L(){L=w._asyncToGenerator(function*(a){if(!(a&&a.layer&&a.view&&a.startTime&&a.endTime))throw new h("size-age-renderer:missing-parameters",
"'layer', 'view', 'startTime', 'endTime' parameters are required");a={...a};a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;var b=r.createLayerAdapter(a.layer,r.featureCapableLayerTypes);a.layer=b;if(!b)throw new h("size-age-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(r.featureCapableLayerTypes).join(", "));var c=A.isSome(a.signal)?{signal:a.signal}:null;yield b.load(c);c=b.geometryType;const d=
a.symbolType.includes("3d");a.outlineOptimizationEnabled="polygon"===c?a.outlineOptimizationEnabled:!1;if("mesh"===c)throw new h("size-age-renderer:invalid-parameters","Size visualization is not applicable to layers with 'mesh' geometry type");if(d&&("polyline"===c||"polygon"===c))throw new h("size-age-renderer:not-supported","3d symbols are not supported for polyline and polygon layers");if(a.symbolType.includes("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new h("size-age-renderer:invalid-parameters",
"'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or 3d-volumetric-uniform");if(b=E.verifyDates(b,a.startTime,a.endTime,"size-age-renderer:invalid-parameters"))throw b;if(a.unit&&!E.supportedAgeUnits.includes(a.unit))throw new h("size-age-renderer:invalid-unit",`Supported units are: ${E.supportedAgeUnits.join(", ")}`);return a});return L.apply(this,arguments)}function ca(a){return M.apply(this,arguments)}function M(){M=w._asyncToGenerator(function*(a){let b=
a.sizeScheme,c=null;var d=null;d=yield g.getBasemapInfo(a.basemap,a.view);c=A.isSome(d.basemapId)?d.basemapId:null;d=A.isSome(d.basemapTheme)?d.basemapTheme:null;if(b)return{scheme:B.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=B.getSchemes({basemap:c,basemapTheme:d,geometryType:a.geometryType,worldScale:a.worldScale,view:a.view}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}});return M.apply(this,arguments)}function da(a,b){let c;switch(b){case "point":case "multipoint":c=
[a.minSize,a.maxSize];break;case "polyline":c=[a.minWidth,a.maxWidth];break;case "polygon":c=[a.marker.minSize,a.marker.maxSize]}return c}function ra(a,b,c,d){return N.apply(this,arguments)}function N(){N=w._asyncToGenerator(function*(a,b,c,d){const {theme:e,field:k,normalizationField:v,minValue:p,maxValue:q,axis:l}=a;var f=a.layer,n=k&&"function"!==typeof k?f.getField(k):null,t=n&&"date"===n.type,m=f.geometryType;f=yield ca({basemap:a.basemap,geometryType:m,sizeScheme:a.sizeScheme,worldScale:a.worldScale,
view:a.view});n=f.scheme;if(!n)throw new h("size-visual-variable:insufficient-info","Unable to find size scheme");d=d&&[d.minSize,d.maxSize]||da(n,m);const {minDataValue:u,maxDataValue:y,defaultValuesUsed:x}=g.getDataRange(b,c,e,t,"above"===e||"below"===e);c=[];const z="height"===l;t=z?l:void 0;m=d[0];d=d[1];z&&"number"===typeof m&&"number"===typeof d&&(d=g.getSizeRangeForAxis({minSize:m,maxSize:d},t),c.push(new Z({axis:"width-and-depth",minSize:d.minSize})),d=d.maxSize);a=new Z({field:k,valueExpression:a.valueExpression,
valueExpressionTitle:a.valueExpressionTitle,valueUnit:"unknown",normalizationField:v,axis:t,minSize:m,maxSize:d,minDataValue:u,maxDataValue:y,legendOptions:a.legendOptions});a.transformationType===ka.TransformationType.ClampedLinear&&"below"===e&&a.flipSizes();c.unshift(a);a=new ia({type:"size",theme:e,minSliderValue:null!=p?p:b.min,maxSliderValue:null!=q?q:b.max});a=new Y({visualVariables:[a]});return{basemapId:f.basemapId,basemapTheme:f.basemapTheme,visualVariables:c,statistics:b,defaultValuesUsed:x,
sizeScheme:B.cloneScheme(n),authoringInfo:a}});return N.apply(this,arguments)}function ea(a,b,c,d,e){return O.apply(this,arguments)}function O(){O=w._asyncToGenerator(function*(a,b,c,d,e){const k=yield G.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),v=e.field,p=e.layer.geometryType,q=e.defaultSymbolEnabled;var l=B.cloneScheme(a.sizeScheme),f="polygon"===p;const n=f?l.marker:l;l=f?l.background:null;f=f?"point":p;const t=b&&b.opacity,m=a.visualVariables.map(u=>u.clone());b&&b.visualVariables&&
b.visualVariables.length&&m.push(...b.visualVariables.map(u=>u.clone()));return{renderer:new W({backgroundFillSymbol:l&&g.createSymbol(p,{type:e.symbolType,color:l.color,outline:g.getSymbolOutlineFromScheme(l,p,t)}),classBreakInfos:[{minValue:-fa,maxValue:fa,symbol:g.createSymbol(f,{type:e.symbolType,color:n.color,size:g.getSymbolSizeFromScheme(n,f),outline:g.getSymbolOutlineFromScheme(n,f,t)})}],defaultLabel:q?k.other:null,defaultSymbol:q?g.createSymbol(f,{type:e.symbolType,color:n.noDataColor,size:g.getSymbolSizeFromScheme(n,
f,!0),outline:g.getSymbolOutlineFromScheme(n,f,t)}):null,field:v,normalizationField:d,normalizationType:c,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,visualVariables:m,authoringInfo:a.authoringInfo&&a.authoringInfo.clone()}),visualVariables:a.visualVariables.map(u=>u.clone()),statistics:a.statistics,defaultValuesUsed:a.defaultValuesUsed,sizeScheme:B.cloneScheme(a.sizeScheme),basemapId:a.basemapId,basemapTheme:a.basemapTheme}});return O.apply(this,arguments)}function sa(a,
b){const c=X.toPt(a.minSize);a=(X.toPt(a.maxSize)-c)/(4<=b?b-1:b);const d=[];for(let e=0;e<b;e++)d.push(c+a*e);return d}function ta(a,b){return P.apply(this,arguments)}function P(){P=w._asyncToGenerator(function*(a,b){var c=yield G.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const d=a.defaultSymbolEnabled,e=a.layer.geometryType;var k="polygon"===e;const v=a.symbolType.includes("3d-volumetric"),p=yield ca({basemap:a.basemap,geometryType:e,sizeScheme:a.sizeScheme,worldScale:v,view:a.view}),
q=p.scheme,{result:l,outlineResult:f}=b,n=l.classBreakInfos,t=a.classificationMethod,m=a.normalizationType,u=k?q.marker:q,y=k?q.background:null,x=k?"point":e;k=da(u,x);const z=v&&g.getSizeRangeForAxis({minSize:k[0],maxSize:k[1]},"height"),ua=sa({minSize:k[0],maxSize:v?z.maxSize:k[1]},n.length),Q=f&&f.opacity;c=new W({backgroundFillSymbol:y&&g.createSymbol(e,{type:a.symbolType,color:y.color,outline:g.getSymbolOutlineFromScheme(y,e,Q)}),classBreakInfos:n.map((D,va)=>({minValue:D.minValue,maxValue:D.maxValue,
symbol:g.createSymbol(x,{type:a.symbolType,color:u.color,size:ua[va],widthAndDepth:z&&z.minSize,outline:g.getSymbolOutlineFromScheme(u,x,Q)}),label:D.label})),defaultLabel:d?c.other:null,defaultSymbol:d?g.createSymbol(x,{type:a.symbolType,color:u.noDataColor,size:g.getSymbolSizeFromScheme(u,x,!0),widthAndDepth:z&&z.minSize,outline:g.getSymbolOutlineFromScheme(u,x,Q)}):null,field:a.field,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle,normalizationType:m,normalizationField:a.normalizationField,
normalizationTotal:"percent-of-total"===m?l.normalizationTotal:void 0,legendOptions:a.legendOptions,authoringInfo:new Y({type:"class-breaks-size",classificationMethod:t,standardDeviationInterval:a.standardDeviationInterval})});"standard-deviation"!==t&&ja.setLabelsForClassBreaks({classBreakInfos:c.classBreakInfos,classificationMethod:t,normalizationType:m,round:!0});f&&f.visualVariables&&f.visualVariables.length&&(c.visualVariables=f.visualVariables.map(D=>D.clone()));return{renderer:c,sizeScheme:B.cloneScheme(q),
classBreaksResult:l,defaultValuesUsed:b.defaultValuesUsed,basemapId:p.basemapId,basemapTheme:p.basemapTheme}});return P.apply(this,arguments)}function R(a){return S.apply(this,arguments)}function S(){S=w._asyncToGenerator(function*(a){a=yield na(a);const {view:b,field:c,valueExpression:d,minValue:e,maxValue:k,layer:v,normalizationField:p,signal:q,statistics:l}=a,[f,n,t]=yield Promise.all([l?l:g.getSummaryStatistics({layer:v,field:c,valueExpression:d,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,
normalizationType:p?"field":void 0,normalizationField:p,minValue:e,maxValue:k,view:b,signal:q}),"90-10"===a.theme?g.getClassBreaks({layer:v,field:c,normalizationField:p,valueExpression:d,classificationMethod:"quantile",minValue:e,maxValue:k,view:b,numClasses:10,signal:q}):null,a.sizeOptimizationEnabled?ma({view:b,layer:v,signal:q}):null]);return ra(a,f,n?.result,t)});return S.apply(this,arguments)}function T(){T=w._asyncToGenerator(function*(a){a=yield oa(a);var b={layer:a.layer,view:a.view,signal:a.signal};
const [c,d]=yield Promise.all([R(ba(a)),a.outlineOptimizationEnabled?aa(b):null]);b=a.normalizationField;return ea(c,d,b?"field":void 0,b,a)});return T.apply(this,arguments)}function U(){U=w._asyncToGenerator(function*(a){a=yield pa(a);var b=g.getClassBreaks;const c={...a};delete c.basemap;delete c.sizeScheme;delete c.legendOptions;delete c.symbolType;delete c.defaultSymbolEnabled;c.analyzeData=!(null!=c.minValue&&null!=c.maxValue);b=yield b.call(g,c,a.outlineOptimizationEnabled);return ta(a,b)});
return U.apply(this,arguments)}function V(){V=w._asyncToGenerator(function*(a){var b=yield qa(a);const {defaultSymbolEnabled:c,view:d,startTime:e,endTime:k,symbolType:v,minValue:p,maxValue:q,signal:l}=b;a=b.layer;var f={layer:b.layer,view:b.view,signal:l};const [n,t]=yield Promise.all([b.unit?{unit:b.unit,statistics:null,valueExpression:null}:yield la({view:d,layer:a,startTime:e,endTime:k,minValue:p,maxValue:q,signal:l}),b.outlineOptimizationEnabled?aa(f):null]),{unit:m,statistics:u}=n;f=E.getAgeExpressions({layer:a,
startTime:e,endTime:k,unit:m}).valueExpression;var y=yield G.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");y=ha.substitute(y[`ageInfo_${m}`],{unit:m,startTime:g.formatDate(e,m,a),endTime:g.formatDate(k,m,a)});b=yield R(ba({layer:a,basemap:b.basemap,valueExpression:f,symbolType:v,statistics:u,legendOptions:{title:y},theme:b.theme,sizeScheme:b.sizeScheme,sizeOptimizationEnabled:b.sizeOptimizationEnabled,view:b.view,minValue:p,maxValue:q,signal:l}));a=yield ea(b,t,null,null,{layer:a,valueExpression:f,
defaultSymbolEnabled:c,symbolType:v});a.renderer.authoringInfo.visualVariables.forEach(x=>g.updateAgeRendererAuthoringInfoVV(x,e,k,m));return{...a,unit:m}});return V.apply(this,arguments)}const fa=2**53-1;C.createAgeRenderer=function(a){return V.apply(this,arguments)};C.createClassBreaksRenderer=function(a){return U.apply(this,arguments)};C.createContinuousRenderer=function(a){return T.apply(this,arguments)};C.createVisualVariables=R;Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});