// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/fieldUtils ../../statistics/support/predominanceUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ../utils ./FeatureLayerAdapter ./support/utils ../../../statistics/utils".split(" "),
function(l,y,z,h,n,r,t,H,I,A,B,C,D,E,v,F,p,w){t=function(x){function u(b){return x.call(this,b)||this}l._inheritsLoose(u,x);var g=u.prototype;g._waitForLayerViewUpdate=function(){var b=l._asyncToGenerator(function*(a){if(!a)throw new h("ogc-feature-layer-adapter:insufficient-data","layerView is required to fetch the features");yield r.whenOnce(()=>!a.updating)});return function(a){return b.apply(this,arguments)}}();g._summaryStatsFromClientQuery=function(){var b=l._asyncToGenerator(function*(a,c){const {signal:e,
view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");a=this._getSummaryStatsQuery(a,c);const f=yield d.whenLayerView(this.layer);yield r.whenOnce(()=>!f.updating,n.unwrap(e));a=yield f.queryFeatures(a,{signal:e});c=p.getSummaryStatisticsFromFeatureSet(a,c);return w.processSummaryStatisticsResult(c)});return function(a,c){return b.apply(this,arguments)}}();g._uvFromClientQuery=function(){var b=l._asyncToGenerator(function*(a,
c){const {signal:e,view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");var f=this._getUVQuery(a);const k=yield d.whenLayerView(this.layer);yield r.whenOnce(()=>!k.updating,n.unwrap(e));f=yield k.queryFeatures(f,{signal:e});f=yield p.getUniqueValuesFromFeatureSet(f,{layer:this,field:a.field,field2:a.field2,field3:a.field3,fieldDelimiter:v.FIELD_DELIMITER,view:a.view,signal:a.signal});return w.createUVResult(f,c,a.returnAllCodedValues,
v.FIELD_DELIMITER)});return function(a,c){return b.apply(this,arguments)}}();g.summaryStatistics=function(b){const {field:a,valueExpression:c,sqlExpression:e,features:d,view:f}=b,k=a?this.getField(a):null,q=B.isDateField(k),m=!!c,G="3d"===f?.type;if(!c&&e&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return m||d||G?this._summaryStatsFromMemory(b,k):this._summaryStatsFromClientQuery(b,q)};g.uniqueValues=
function(){var b=l._asyncToGenerator(function*(a){const {valueExpression:c,sqlExpression:e,features:d,view:f}=a,k=yield p.getDomainsForFields(a,this),q=!!c,m="3d"===f?.type;if(!c&&e&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return q||d||m?this._uvFromMemory(a,k):this._uvFromClientQuery(a,k)});return function(a){return b.apply(this,arguments)}}();g.histogram=function(b){const {features:a,valueExpression:c,
normalizationType:e,sqlExpression:d}=b,f=a||!!c;if(!c&&d&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return f||e?this._histogramFromMemory(b):this._histogramForField(b)};g.classBreaks=function(b){return!1!==b.analyzeData?this._classBreaksFromMemory(b):this._classBreaksFromInterpolation(b)};g.queryFeatureCount=function(){var b=l._asyncToGenerator(function*(a){const {whereClause:c,view:e,signal:d}=
a;if(!e)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");a=this.layer.createQuery();a.where=D.mergeWhereClauses(a.where,c);const f=yield e.whenLayerView(this.layer);yield r.whenOnce(()=>!f.updating,n.unwrap(d));return f.queryFeatureCount(a,{signal:d})});return function(a){return b.apply(this,arguments)}}();g.generateRenderer=function(b,a){throw new h("ogc-feature-layer-adapter:not-supported","OGCFeatureLayer does not support generateRenderer operation");
};g.predominantCategories=function(){var b=l._asyncToGenerator(function*(a){const {fields:c,view:e,signal:d}=a;a=C.getArcadeForPredominantCategory(c);a=yield this._uvFromMemory({valueExpression:a,view:e,signal:d});return p.getPredominantCategoriesFromUVInfos(a.uniqueValueInfos,c)});return function(a){return b.apply(this,arguments)}}();g.getSampleFeatures=function(){var b=l._asyncToGenerator(function*(a,c){const {view:e,sampleSize:d,requiredFields:f,returnGeometry:k,signal:q}=a,m=this.layer.createQuery();
m.outSpatialReference=a.spatialReference||e&&e.spatialReference;m.returnGeometry=!!k;m.outFields=f;if(!e)throw new h("ogc-feature-layer-adapter:not-supported","view is required to get sample features for OGCFeatureLayer");a=yield e.whenLayerView(this.layer);if(p.getMissingFields(this,f,a).length)throw new h("ogc-feature-layer-adapter:not-supported","Required fields need to be passed in the outFields for OGCFeatureLayer");c=yield this._fetchFeaturesFromMemory(a,m,q,c);return z.pickRandom(c,0<d&&d<=
c.length?d:c.length,1)});return function(a,c){return b.apply(this,arguments)}}();g.load=function(b){var a=this;const c=this.layer.load(b).then(function(){var e=l._asyncToGenerator(function*(d){a.geometryType=d.geometryType;a.objectIdField=d.objectIdField;a.supportsSQLExpression=d.get("capabilities.query.supportsSqlExpression");a.minScale=d.minScale;a.maxScale=d.maxScale;a.fullExtent=d.fullExtent;a.workerClient=E.WorkerClient.getInstance();yield a.workerClient.open(n.unwrap(n.unwrap(b).signal))});
return function(d){return e.apply(this,arguments)}}());this.addResolvingPromise(c);return Promise.resolve(this)};return u}(F);return t=y.__decorate([A.subclass("esri.smartMapping.support.adapters.OGCFeatureLayerAdapter")],t)});