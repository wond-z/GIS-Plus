// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../rest/support/generateRendererUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ../utils ./FeatureLayerAdapter ./support/utils".split(" "),function(m,y,t,u,n,F,G,H,z,v,p,A,B,C,D){function w(h){return"esri.rest.support.ClassBreaksDefinition"===
h.declaredClass}function x(h){return"esri.rest.support.UniqueValueDefinition"===h.declaredClass}n=function(h){function q(d){return h.call(this,d)||this}m._inheritsLoose(q,h);var r=q.prototype;r._createGenerateRendererResult=function(){var d=m._asyncToGenerator(function*(a,b,e,c,f){a=a?.features;if(!a?.length)throw new t("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const k=D.ensureFeaturesJSON(a);a=null;if("percent-of-total"===c&&(a=(yield this.workerClient.summaryStatistics({field:b},
k)).sum,null==a))throw new t("csv-layer-adapter:invalid","invalid normalizationTotal");if(w(f))return b=(yield p.getDataValues({field:b,normalizationType:c,normalizationField:e,normalizationTotal:a},k)).filter(g=>Number.isFinite(g)),v.createGenerateRendererClassBreaks({definition:f,values:b,normalizationTotal:a});if(x(f))return f=(yield p.getDataValues({field:b},k)).filter(g=>null!=g&&"string"===typeof g&&""!==g.trim()),v.createGenerateRendererUniqueValues(f)});return function(a,b,e,c,f){return d.apply(this,
arguments)}}();r.generateRenderer=function(d,a){const b=d.classificationDefinition;let e=null,c=null,f=null;w(b)?(e=b.classificationField,c=b.normalizationField,f=b.normalizationType):x(b)&&(e=b.attributeField);const k=this.layer;return B.getFieldsList({field:e,normalizationField:c}).then(g=>{const l=k.createQuery();l.returnGeometry=!1;l.outFields=g;l.where=p.mergeWhereClauses(l.where,d.where);return k.queryFeatures(l,{signal:a}).then(E=>this._createGenerateRendererResult(E,e,c,f,b))})};r.load=function(d){var a=
this;const b=this.layer.load(d).then(function(){var e=m._asyncToGenerator(function*(c){a.geometryType=c.geometryType;a.objectIdField=c.objectIdField;a.supportsSQLExpression=!0;a._hasLocalSource=!1;a.hasQueryEngine=!0;a.workerClient=A.WorkerClient.getInstance();yield a.workerClient.open(u.unwrap(u.unwrap(d).signal))});return function(c){return e.apply(this,arguments)}}());this.addResolvingPromise(b);return Promise.resolve(this)};return q}(C);return n=y.__decorate([z.subclass("esri.smartMapping.support.adapters.CSVLayerAdapter")],
n)});