// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ../../../../core/has ../../../../layers/support/CodedValueDomain ../../../../layers/support/Domain ../../../../layers/support/InheritedDomain ../../../../layers/support/RangeDomain ../../../../layers/support/Field ../../../statistics/support/predominanceUtils ../../utils ../../../../statistics/utils".split(" "),function(g,B,H,N,I,O,P,Q,J,K,r,v){function C(a){const {field:c,normalizationType:b,normalizationField:d,
normalizationTotal:e,layer:f}=a;a=r.isIntegerField(f,c);let l=c;"percent-of-total"===b?l=`((${a?r.castIntegerFieldToFloat(c):c} / ${e}) * 100)`:"log"===b?l=`(log(${c}) * ${L})`:"field"===b?l=`(${a?r.castIntegerFieldToFloat(c):c} / ${d})`:"natural-log"===b?l=`(log(${a?r.castIntegerFieldToFloat(c):c}))`:"square-root"===b&&(l=`(power(${a?r.castIntegerFieldToFloat(c):c}, 0.5))`);return l}function D(a,c){let b;c=c.toLowerCase();if(a)for(const d in a)if(d.toLowerCase()!==c){b=a[d];break}return b}function t(a,
c){let b;c=c.toLowerCase();if(a)for(const d in a)if(d.toLowerCase()===c){b=a[d];break}return b}function w(a,c){if(c)for(const b in a)a[b].label=c[b];return{count:a}}function x(a,c,b){return y.apply(this,arguments)}function y(){y=B._asyncToGenerator(function*(a,c,b){var d=a?b.getField(a):null;if(d=d?b.getFieldDomain(d.name):null)return d;({uniqueValueInfos:a}=yield b.uniqueValues({field:a,sqlWhere:c.sqlWhere,features:c.features,useFeaturesInView:c.useFeaturesInView,view:c.view,signal:c.signal}));a=
a.map(e=>({code:e.value}));return new I({codedValues:a})});return y.apply(this,arguments)}function z(){z=B._asyncToGenerator(function*(a,c){if(!a.returnAllCodedValues)return[];const {field:b,field2:d,field3:e}=a;if(b&&!d)return(c=(a=b?c.getField(b):null)?c.getFieldDomain(a.name):null)?[c]:[];const f=[];b&&(f.push(x(b,a,c)),d&&(f.push(x(d,a,c)),e&&f.push(x(e,a,c))));return Promise.all(f)});return z.apply(this,arguments)}function E(a,c){switch(a.statisticType){case "avg":case "avg_angle":return"double";
case "count":return"integer";case "min":case "max":case "sum":return a.onStatisticField?c.get(a.onStatisticField)?.type??null:a.onStatisticExpression?"string"===a.onStatisticExpression.returnType?null:"double":null;case "mode":return a.onStatisticField?c.get(a.onStatisticField)?.type??null:a.onStatisticExpression?"string"===a.onStatisticExpression.returnType?"string":"double":null;default:return null}}const M=/_value$/i,L=Math.LOG10E;g.ensureFeaturesJSON=function(a){return a.map(c=>c.toJSON())};g.generateBinParams=
function(a){const c=[],b=a.classBreaks,d=b[0].minValue,e=b[b.length-1].maxValue;b.forEach(f=>{c.push([f.minValue,f.maxValue])});return{min:d,max:e,intervals:c,sqlExpr:C({field:a.field,normalizationType:a.normalizationType,normalizationField:a.normalizationField,normalizationTotal:a.normalizationTotal,layer:a.layer}),excludeZerosExpr:a.where,normTotal:a.normalizationTotal}};g.getAggregateFieldType=E;g.getDomainsForFields=function(a,c){return z.apply(this,arguments)};g.getFeatureReductionFields=function(a){const c=
"featureReduction"in a&&a.featureReduction;return("fields"in c&&c.fields||[]).map(b=>{const d=E(b,a.fieldsIndex);return d?new J({type:d,name:b.name,alias:b.alias}):null}).filter(Boolean)};g.getFieldExpr=C;g.getHistogramFromFeatureSet=function(a,c,b,d,e){const f={};a&&a.features&&a.features.forEach(n=>{var k=n.attributes;n=D(k,"countOFExpr");k=t(k,"countOFExpr");0!==n&&(f[n]=k)});const l=[];v.getEqualIntervalBins(c,b,d).forEach((n,k)=>{k=(k+1).toString();l.push({minValue:n[0],maxValue:n[1],count:f.hasOwnProperty(k)?
f[k]:0})});return{bins:l,minValue:c,maxValue:b,normalizationTotal:e}};g.getMissingFields=function(a,c,b){const d=[];if(c)for(const e of c)c=a.getField(e),"availableFields"in b&&!b.availableFields.includes(c.name)&&d.push(c.name);return d};g.getMissingFieldsForBinning=function(a,c){const b=[];a="featureReduction"in a.layer&&a.layer.featureReduction;if("binning"!==a?.type||!c)return b;a="fields"in a?a.fields?.map(d=>d.name?.toLowerCase()).filter(Boolean):null;for(const d of c)a.includes(d.toLowerCase())||
b.push(d);return b};g.getPredominantCategoriesFromUVInfos=function(a,c){const b=a.map(e=>e.value),d=c.filter(e=>!b.includes(e));for(const e of d)a.push({value:e,count:0});a.sort((e,f)=>c.indexOf(e.value)-c.indexOf(f.value));for(const e of a)e.value===K.noDominantCategoryField&&(e.value=null);return{predominantCategoryInfos:a}};g.getSummaryStatisticsFromFeatureSet=function(a,c){a=(a=a&&a.features)&&a[0]&&a[0].attributes;const b={};for(const d in a)b[d.replace(M,"").toLowerCase()]=a[d];null!=b.totalcount&&
b.totalcount>=b.count&&(b.nullcount=b.totalcount-b.count);delete b.totalcount;b.min===b.max&&null!=b.min&&null==b.stddev&&(b.stddev=b.variance=0);c&&("min max avg stddev sum variance".split(" ").forEach(d=>{null!=b[d]&&(b[d]=Math.ceil(b[d]))}),b.min===b.max&&null!=b.min&&(b.avg=b.min,b.stddev=b.variance=0));return b};g.getUniqueValuesFromFeatureSet=function(a,c){a=a&&a.features;const {field:b,field2:d,field3:e,fieldDelimiter:f,layer:l,view:n,signal:k,labels:A}=c,F=`countOF${b&&d?"Expr":b||"Expr"}`,
p={};let G=!1;a.forEach(q=>{var m=q.attributes;q=t(m,F);var h=b?t(m,b):D(m,F);let u=d?t(m,d):null;m=e?t(m,e):null;null===h&&0===q&&(G=!0);if(null==h||"string"===typeof h&&""===h.trim())h=null;d&&(null==u||"string"===typeof u&&""===u.trim())&&(u=null);e&&(null==m||"string"===typeof m&&""===m.trim())&&(m=null);d&&(h=`${v.processNullValue(h)}${f}${v.processNullValue(u)}`,e&&(h=`${h}${f}${v.processNullValue(m)}`));null==p[h]?p[h]={count:q,data:h}:p[h].count+=q});return b&&G?l.queryFeatureCount({whereClause:b+
" is NULL",view:n,signal:k}).then(q=>{p["null"].count+=q||0;return w(p,A)}).catch(()=>{H.throwIfAborted(k);return w(p,A)}):Promise.resolve(w(p,A))};g.getViewInfoParams=function(a){return{viewingMode:"2d"===a.type?"map":a.viewingMode,scale:a.scale,spatialReference:a.spatialReference?.toJSON()}};g.msSinceUnixEpochSQL=function(a,c){return r.getDateDiffSQL(a,new Date(0),c,"milliseconds").sqlExpression};Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});