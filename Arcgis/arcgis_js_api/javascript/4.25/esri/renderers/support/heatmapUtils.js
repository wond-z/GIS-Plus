// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec4","../../chunks/vec4f64"],function(l,t,q,y,z){function A(a,b,c,e){let {color:k,ratio:f}=b,{color:d,ratio:g}=c;g===f&&(1===g?f-=1E-6:g+=1E-6);b=t.clamp((e-f)/(g-f),0,1);y.lerp(a,k.toArray(),d.toArray(),b)}function u(a,b,c,e,k){a=new Uint32Array(a*a);b="buffer"in b?b:new Float64Array(b);c="buffer"in c?new Uint32Array(c.buffer):new Uint32Array((new Uint8Array(c)).buffer);k=c.length/(k-e);for(let f=0;f<b.length;f++)a[f]=
c[t.clamp(Math.floor((b[f]-e)*k),0,c.length-1)];return a.buffer}function v(a,b,c){a=Math.sqrt(a**2+b**2)/c;return 1<a?0:3/(Math.PI*c**2)*(1-a**2)**2}function w(a,b){return null!=a?"string"===typeof b?c=>-1*+c.readAttribute(a):c=>+c.readAttribute(a)+b:c=>1}l.MAGIC_KERNEL_DENSITY_RADIUS_INFLATION_FACTOR=2.4;l.calculateHeatmapIntensityInfoReaders=function(a,b,c,e){const {radius:k,fieldOffset:f,field:d}=b;b=Math.round(q.pt2px(k));const g=new Float64Array(c*e);let r=Number.NEGATIVE_INFINITY;const B=w(d,
f),x=new Set;for(const C of a)for(a=C.getCursor();a.next();){var h=a.getObjectId();if(x.has(h))continue;x.add(h);h=a.readLegacyPointGeometry();if(-128>h.x||h.x>=c+128||-128>h.y||h.y>e+128)continue;const D=+B(a),E=Math.max(0,Math.round(h.x)-b);var n=Math.max(0,Math.round(h.y)-b);const F=Math.min(e,Math.round(h.y)+b),G=Math.min(c,Math.round(h.x)+b);for(;n<F;n++)for(let p=E;p<G;p++){var m=n*c+p;const H=v(h.x-p,h.y-n,b);m=g[m]+=H*D;m>r&&(r=m)}}return{matrix:g.buffer,max:r}};l.createHeatmapImageData=u;
l.createValueFunction=function(a,b){return"function"===typeof a?a:a?"string"===typeof b?c=>-1*+c[a]:c=>+c[a]+b:()=>1};l.createValueFunctionCursor=w;l.drawHeatmap=function(a,b,c,e,k,f){a.canvas.width=a.canvas.height=b;a.clearRect(0,0,b,b);const d=a.getImageData(0,0,b,b);c&&e&&d.data.set(new Uint8ClampedArray(u(b,c,e,k,f)));a.putImageData(d,0,0)};l.evaluateDensityKernel=v;l.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(a){return q.px2pt(2.4*a)};l.generateGradient=function(a){const b=new Uint8ClampedArray(2048);
a=a.filter(({ratio:d})=>0<=d&&1>=d).sort((d,g)=>d.ratio-g.ratio).map(({color:d,ratio:g})=>({color:d,ratio:Math.max(g,.001)}));if(1>a.length)return b;let c=a[0],e=a[0],k=1;const f=z.create();for(let d=0;512>d;d++){const g=(d+.5)/512;for(;g>e.ratio&&k<a.length;)c=e,e=a[k++];A(f,c,e,g);b.set(f,4*d)}return b};l.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(a){return q.pt2px(a)/2.4};Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});