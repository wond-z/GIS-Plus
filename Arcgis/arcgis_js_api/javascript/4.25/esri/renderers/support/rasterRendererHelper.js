// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../rasterRenderers ../../core/maybe ../../core/unitUtils ../../layers/support/Field ../../layers/support/RasterInfo ../FlowRenderer ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./UniqueValueInfo ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),
function(k,B,va,g,ea,fa,ha,ia,N,ja,E,O,ka,la,P,ma,na,oa,pa,qa,ra){function Q(a,b){a=R(a,b?.variableName);const {bandCount:c}=a;let {bandIds:d,stretchType:e}=b||{};d?.some(q=>q>=c)&&(d=null);let f=g.unwrap(a.statistics),h=g.unwrap(a.histograms);1<c?(d=d?.length?d:S(a),f=null==f?null:d?.map(q=>f[q]),h=null==h?null:d?.map(q=>h[q])):d=[0];null==e&&(e=sa(a));let r=!1;switch(e){case "none":r=!1;break;case "percent-clip":r=!h?.length;break;default:r=!f?.length}var {dataType:m}=a;m=1===d?.length&&T.has(m)?
U:null;m=new ma({stretchType:e,dynamicRangeAdjustment:r,colorRamp:m,outputMin:0,outputMax:255,gamma:1===d?.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===e?m.maxPercent=m.minPercent=.25:"standard-deviation"===e&&(m.numberOfStandardDeviations=2);if(!r&&(g.isSome(a.multidimensionalInfo)||b?.includeStatisticsInStretch))if("percent-clip"===e)m.histograms=h;else if("min-max"===e||"standard-deviation"===e)m.statistics=f;return m}function R(a,b){if(null==b)return a;let c=g.unwrap(a.statistics),d=g.unwrap(a.histograms);
var {multidimensionalInfo:e}=a;if(b&&g.isSome(e)&&(e=e.variables.find(f=>f.name===b))){const {statistics:f,histograms:h}=e;f?.length&&(c=f);h?.length&&(d=h)}return ha.fromJSON({...a.toJSON(),statistics:c,histograms:d})}function S(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;let c;if(a&&a.length===b){const {red:d,green:e,blue:f,nir:h}=V(a);null!=d&&null!=e&&null!=f?c=[d,e,f]:null!=h&&null!=d&&null!=e&&(c=[h,d,e])}!c&&3<=b&&(c=[0,1,
2]);return c}function V(a){const b={};for(let e=0;e<a.length;e++){var c=a[e],d=c.BandName?.toLowerCase();"red"===d?b.red=e:"green"===d?b.green=e:"blue"===d?b.blue=e:"nearinfrared"===d||"nearinfrared_1"===d||"nir"===d?b.nir=e:c.WavelengthMax&&c.WavelengthMin&&(d=c.WavelengthMin,c=c.WavelengthMax,null==b.blue&&410<=d&&480>=d&&480<=c&&540>=c?b.blue=e:null==b.green&&490<=d&&560>=d&&560<=c&&610>=c?b.green=e:null==b.red&&595<=d&&670>=d&&660<=c&&730>=c?b.red=e:null==b.nir&&700<=d&&860>=d&&800<=c&&950>=c&&
(b.nir=e))}return b}function sa(a){let b="percent-clip";const {pixelType:c,dataType:d,histograms:e,statistics:f}=a;"u8"!==c||"processed"!==d&&g.isSome(e)&&g.isSome(f)?"u8"===c||"elevation"===d||T.has(d)?b="min-max":g.isSome(e)?b="percent-clip":g.isSome(f)&&(b="min-max"):b="none";return b}function W(a,b,c,d){if(!G(a,b))return null;const {attributeTable:e,statistics:f}=a,h=H(e,b),r=z(e,"red"),m=z(e,"green"),q=z(e,"blue");a=new N;const t=[],w=new Set,v=!!(r&&m&&q);if(g.isSome(e))e.features.forEach(n=>
{var p=n.attributes[h.name];w.has(n.attributes[h.name])||null==p||(w.add(p),p=!v||"single"!==r.type&&"double"!==r.type||"single"!==m.type&&"double"!==m.type||"single"!==q.type&&"double"!==q.type||e.features.some(l=>1<l.attributes[r.name]||1<l.attributes[m.name]||1<l.attributes[q.name])?1:255,t.push(new O({value:n.attributes[h.name],label:n.attributes[h.name]+"",symbol:{type:"simple-fill",style:"solid",outline:null,color:v?new B([n.attributes[r.name]*p,n.attributes[m.name]*p,n.attributes[q.name]*p,
1]):new B([0,0,0,0])}})))});else if(f?.[0])for(b=f[0].min;b<=f[0].max;b++)t.push(new O({value:b,label:b.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new B([0,0,0,0])}}));t.sort((n,p)=>n.value&&"string"===typeof n.value.valueOf()?0:n.value>p.value?1:-1);if(!v){const n=E.convertColorRampToColormap(X,t.length);t.forEach((p,l)=>p.symbol.color=new B(n[l].slice(1,4)));a.colorRamp=X}if(c||d){const n=c||E.convertColorRampToColormap(d,t.length).map(p=>p.slice(1));t.forEach((p,l)=>
p.symbol.color=new B(n[l]));a.colorRamp=d}return new na({field:h.name,uniqueValueInfos:t,authoringInfo:a})}function H(a,b,c){let d;g.isSome(a)?(d=b?a.fields.find(e=>b.toLowerCase()===e.name.toLowerCase()):ta(a.fields),d||(c||(d=a.fields.find(e=>"string"===e.type)),d||(d=z(a,"value")))):d=new fa({name:"value"});return d}function ta(a){let b;for(let c=0;c<a.length;c++){const d=a[c].name.toLowerCase();if("string"===a[c].type){if(d.startsWith("class")){b=a[c];break}null==b&&(d.endsWith("name")||d.endsWith("type"))&&
(b=a[c])}}return b}function z(a,b){return g.isNone(a)?null:a.fields.find(c=>c.name.toLowerCase()===b)}function G(a,b){const {attributeTable:c,bandCount:d}=a;return g.isNone(c)&&Y(a)?!0:g.isNone(c)||1<d||b&&null==c.fields.find(e=>e.name.toLowerCase()===b.toLowerCase())?!1:!0}function I(a){const {bandCount:b,colormap:c}=a;return g.isSome(c)&&0<c.length&&1===b}function Z(a){if(!I(a))return null;let b;const {attributeTable:c,colormap:d}=a;if(g.isSome(c)){const e=z(c,"value"),f=H(c,null,!0);"string"===
f.type&&(b={},c.features.forEach(h=>{h=h.attributes;b[h[e.name]]=f?h[f.name]:h[e.name]}))}return oa.createFromColormap(g.unwrap(d),b)}function J(a){const {bandCount:b,dataType:c,pixelType:d}=a;return"elevation"===c||"generic"===c&&1===b&&("s16"===d||"s32"===d||"f32"===d||"f64"===d)}function K(a,b=!1){const {attributeTable:c,bandCount:d}=a;return 1===d&&(!b||g.isSome(c)||g.isSome(a.histograms))}function aa(a,b,c){let d=0,e=0;g.isSome(a.attributeTable)?(a=a.attributeTable,d=e=a.features[0].attributes[b.name],
a.features.forEach(f=>{f=f.attributes[b.name];f<d&&(d=f);f>e&&(e=f)})):g.isSome(a.histograms)&&(a=a.histograms,d=a[0].min,e=a[0].max);return(e-d)/c}function Y(a){return["u8","s8"].includes(a.pixelType)&&null!=a.statistics?.[0]?.min&&null!=a.statistics[0]?.max&&1===a.bandCount}function F(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function L(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function ba(a){if(!F(a))return null;if(g.isSome(a.statistics)&&a.statistics.length&&
("vector-magdir"===a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:c,maxMagnitude:d}=M(a.dataType,a.statistics);var b=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:c,maxDataValue:d}]}a=g.isSome(a.multidimensionalInfo)?ua.get(a.multidimensionalInfo.variables[0].unit):null;b=new ra({visualVariables:b,inputUnit:a,rotationType:"geographic"});b.visualVariables=[...b.sizeVariables,...b.rotationVariables];return b}function ca(a){return{color:a.symbolLayers[0].material?.color,
type:"esriSFS",style:"esriSFSSolid"}}function M(a,b){if("vector-magdir"===a)a=b[0].min,b=b[0].max;else{const c=b[0].min,d=b[0].max,e=b[1].min;b=b[1].max;a=0;b=Math.max(Math.abs(c),Math.abs(e),Math.abs(d),Math.abs(b))}return{minMagnitude:a,maxMagnitude:b}}const U=P.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),X=P.fromJSON(E.PREDEFINED_JSON_COLOR_RAMPS[0]),T=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" ")),
ua=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);k.createClassBreaksRenderer=function(a,b){a=R(a,b?.variableName);const {attributeTable:c}=a;if(!K(a))return null;const d=g.isSome(a.histograms)?a.histograms[0]:null,e=null!=b?.numClasses&&isFinite(b?.numClasses)?b.numClasses:5,f=new N({classificationMethod:b?.classificationMethod,colorRamp:b?.colorRamp});let h=b?.field||"value";const r=[],m=[],q=g.isSome(c),t=
q&&c.fields.find(l=>"count"===l.name.toLowerCase()),w=q?c.fields.find(l=>l.name.toLowerCase()===h.toLowerCase()):void 0;if(w&&q){h=w.name;const l=c.features.length;let A=0;c.features.forEach(u=>A+=(t?u.attributes[t.name]:50)/l);c.features.forEach(u=>{const C=u.attributes[w.name];u=t?u.attributes[t.name]:50;if(0<u){m.push(u);u=Math.max(1,Math.round(u/l/A*1E3));for(let D=0;D<u;D++)r.push(C)}})}else{var {pixelType:v}=a;const l=(d.max-d.min)/d.size,A=(v=v.includes("s")||v.includes("u"))&&1===l?Math.floor(d.min+
.5):d.min,u=v&&1===l?Math.floor(d.max-.5):d.max,C=d.size;let D=0,da;d.counts.forEach(x=>D+=x/C);d.counts.forEach((x,y)=>{if(0<x)for(m.push(x),x=Math.max(1,Math.round(x/C/D*1E3)),da=q?c.features[y].attributes[w.name]:0===y?A:y===C-1?u:d.min+l*(y+.5),y=0;y<x;y++)r.push(da)})}v=b?.classificationMethod||"natural-breaks";let n=b?.definedInterval;"defined-interval"!==v||n||(n=aa(a,w,e));a=la.createGenerateRendererClassBreaks({values:r,valueFrequency:m,normalizationTotal:null,definition:new ka({classificationMethod:v,
breakCount:e,definedInterval:n})});let p=b?.colors;p||(b=b?.colorRamp||U,f.colorRamp=b,p=E.convertColorRampToColormap(b,a.classBreaks.length,!0).map(l=>l.slice(1)));b=a.classBreaks.map((l,A)=>new ja({minValue:l.minValue,maxValue:l.maxValue,label:l.label,symbol:{type:"simple-fill",color:p[A]}}));return new qa({field:h,classBreakInfos:b,authoringInfo:f})};k.createColormapRenderer=Z;k.createDefaultRenderer=function(a,b){const {attributeTable:c,colormap:d}=a;if(F(a)){var e=ba(a);if(g.isSome(e))return e}return g.isSome(d)&&
(e=Z(a),g.isSome(e))||g.isSome(c)&&(e=W(a),g.isSome(e))?e:Q(a,b)};k.createFlowRenderer=function(a){if(!L(a))return null;let b;if(g.isSome(a.statistics)&&0<a.statistics.length&&("vector-magdir"===a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:c,maxMagnitude:d}=M(a.dataType,a.statistics);b=[{type:"color",field:"Magnitude",stops:[{value:c,color:"#1020C0"},{value:d,color:"#C02010"}]}]}return new ia({visualVariables:b})};k.createShadedReliefRenderer=function(a,b="traditional"){if(!J(a))return null;
({extent:a}=a);a=a.width*ea.getMetersPerUnitForSR(a.spatialReference);return new pa({hillshadeType:b,scalingType:5E6<a?"adjusted":"none"})};k.createStretchRenderer=Q;k.createUVRenderer=W;k.createVectorFieldRenderer=ba;k.estimateMagnitudeRange=M;k.getBandNames=function(a,b){const c=a.keyProperties&&a.keyProperties.BandProperties;b=b?.length?b:Array.from(Array(a.bandCount).keys());return b.map(d=>c&&c.length===a.bandCount?c[d]&&c[d].BandName||"band_"+(d+1):"band_"+(d+1))};k.getClassField=H;k.getDefaultBandCombination=
S;k.getDefaultInterpolation=function(a,b,c){const d=["nearest","bilinear","cubic","majority"].find(e=>e===c?.toLowerCase());return"Map"===b?d??"bilinear":"standard-time"===a.dataType?d??"nearest":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===d||"majority"===d?d:"nearest":d??"bilinear"};k.getDefinedInterval=aa;k.getField=z;k.getSupportedRendererTypes=function(a,b=!1){const c=["raster-stretch"];I(a)&&c.push("raster-colormap");G(a)&&c.push("unique-value");K(a,b)&&c.push("class-breaks");
J(a)&&c.push("raster-shaded-relief");F(a)&&c.push("vector-field");L(a)&&c.push("flow");return c};k.getWellKnownBandIndexes=V;k.isClassBreaksSupported=K;k.isColormapRendererSupported=I;k.isFlowRendererSupported=L;k.isShadedReliefRendererSupported=J;k.isSingleBand8BitRasterWithStats=Y;k.isUVRendererSupported=G;k.isVectorFieldRendererSupported=F;k.normalizeRendererJSON=function(a){if("uniqueValue"===a.type){var b=a.uniqueValueInfos;b?.[0].symbol?.symbolLayers?.length&&(a.uniqueValueInfos=b?.map(c=>({value:c.value,
label:c.label,symbol:c.symbol?ca(c.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,b[0].symbol?.symbolLayers?.length&&(a.classBreakInfos=b.map(c=>({classMinValue:c.classMinValue,classMaxValue:c.classMaxValue,label:c.label,symbol:c.symbol?ca(c.symbol):null}))));return a};Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});