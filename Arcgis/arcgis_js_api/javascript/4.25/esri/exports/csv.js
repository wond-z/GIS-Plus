// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/_rollupPluginBabelHelpers","../core/Error","../layers/support/Field"],function(k,u,v,m){function w(a){return Object.keys(a.attributes).map(b=>{const g=a.attributes[b];return"objectid"===b.toLowerCase()||"fid"===b.toLowerCase()?new m({name:b,alias:b,type:"oid"}):"number"===typeof g?new m({name:b,alias:b,type:"double"}):new m({name:b,alias:b,type:"string"})})}function x(a){if(!a.fields){var b=a.features[0];if(b.layer){a.fields=b.layer.fields;const g=Object.keys(b.attributes);
b=a.fields.filter(e=>g.includes(e.name));a.fields=b}else a.fields=w(b)}return a}function y(a){return a.map(({attributes:b})=>b)}function z(a){const {delimiter:b,fields:g=[],outFields:e=[]}=a,h=b||",",d=g.map(n=>n.name);return n=>{let p="";d.filter(l=>e.includes(l)).forEach(l=>{var c=g.find(({name:q})=>q===l);let f=n[l]||"";"date"===c?.type&&(f=(new Date(f)).toString());c?.domain&&"coded-value"===c.domain.type&&(c=c.domain.codedValues.find(q=>f===q.code))&&(f=c.name);"string"===typeof f&&f.includes(h)&&
(f=`"${f}"`);p+=`${f}${h}`});return`${p}\r\n`}}function A(a){return r.apply(this,arguments)}function r(){r=u._asyncToGenerator(function*(a,{includeGeometry:b=!0,delimiter:g=",",outFields:e=["*"]}={}){a=x(a);if(b&&"point"!==a.geometryType)throw new v("export-csv:invalid-geometries",`the input geometry ${a.geometryType} is not supported, must be point`);var {features:h}=a;if(!h.length)return null;let d=a.fields;const [n]=e;"*"===n&&(e=d.map(c=>c.name));b&&"point"===a.geometryType&&(d.some(c=>"x"===
c.name||"y"===c.name)||(d=[...d,new m({name:"lon",alias:"Longitude",type:"double"}),new m({name:"lat",alias:"Latitude",type:"double"})],e=[...e,"lon","lat"]),h.forEach(c=>{c.attributes.lon=c.geometry.longitude;c.attributes.lat=c.geometry.latitude}));d=d.filter(c=>e.includes(c.name));a=g||",";h=y(h);b=d.map(c=>c.name).join(a);const p=z({delimiter:a,outFields:e||d.map(c=>c.name),fields:d});let l=`${b}${a}\r\n`;h.forEach(c=>{l+=p(c)});return l.replace(new RegExp(`${a}\r\ns*$`,"g"),"")});return r.apply(this,
arguments)}function t(){t=u._asyncToGenerator(function*(a,b){if(!a||a.features&&!a.features.length)throw new v("csv-export:features-required","exportFeaturesToCSV requires features to export");return A(a,b)});return t.apply(this,arguments)}k.attributeToString=z;k.convertFeaturesToCSV=A;k.exportFeaturesToCSV=function(a,b){return t.apply(this,arguments)};k.extractAttributes=y;k.extractFieldsFromFeature=w;k.validateFeatureSetFields=x;Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});