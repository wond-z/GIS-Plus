// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../core/BidiText ../../core/lang ../../core/Logger ../../core/maybe ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../support/arcadeOnDemand ./CIMPlacements ./CIMSymbolDrawHelper ./enums ./utils ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(B,Q,X,R,H,K,F,Y,C,D,Z,aa,S,E,p,n,ba,I,L,ca){function J(d,a,b){switch(a.type){case "CIMSymbolReference":return J(d,a.symbol,b);case "CIMPointSymbol":null==b&&(b={x:0,y:0});d.drawSymbol(a,b);break;case "CIMLineSymbol":null==b&&(b={paths:[[[0,0],[10,0]]]});d.drawSymbol(a,b);break;case "CIMPolygonSymbol":null==b&&(b={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});d.drawSymbol(a,b);break;case "CIMTextSymbol":d.drawSymbol(a,{x:0,y:0});break;case "CIMVectorMarker":b=new S.Placement,d.drawMarker(a,
b)}return d.envelope()}function da(d){if(!d)return 0;switch(d.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(d.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(d.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(d.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(d.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(d.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(d.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(d.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function ea(d){if(!d)return 0;switch(d.type){case "CIMGeometricEffectArrow":return Math.abs(.5*d.width);case "CIMGeometricEffectBuffer":return Math.abs(d.size);case "CIMGeometricEffectExtension":return Math.abs(d.length);case "CIMGeometricEffectJog":return Math.abs(.5*d.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(n.getValue(d.offsetX)),Math.abs(n.getValue(d.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(d.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(d.offset);case "CIMGeometricEffectRadial":return Math.abs(d.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(d.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(d.fromWidth),Math.abs(d.toWidth));case "CIMGeometricEffectWave":return Math.abs(d.amplitude);default:return 0}}
function T(d){if(!d)return 0;let a=0;for(const b of d)a+=ea(b);return a}function fa(d,a,b){d.effects&&!F.isSome(a.geometryEngine)&&(G?b.push(G):n.isGeometryEngineRequired(d.effects)&&(G=n.importGeometryEngine(),b.push(G),G.then(c=>a.geometryEngine=c)))}const U=Math.PI,ha=U/2,x=96/72,V=Math.PI/180,M=K.getLogger("esri.symbols.cim.CIMSymbolHelper");K=function(){function d(){}var a=d.prototype;a.getSymbolInflateSize=function(b,c,f,g,h){b||(b=[0,0,0,0]);return c?this._getInflateSize(b,c,f,g,h):b};d.safeSize=
function(b){const c=Math.max(Math.abs(b[0]),Math.abs(b[2]));b=Math.max(Math.abs(b[1]),Math.abs(b[3]));return Math.sqrt(c*c+b*b)};a._vectorMarkerBounds=function(b,c,f,g){let h=!0;const l=D.create();if(c&&c.markerGraphics)for(const e of c.markerGraphics)c=[0,0,0,0],e.geometry&&(Z.getBoundsXY(l,e.geometry),c[0]=0,c[1]=0,c[2]=0,c[3]=0,this.getSymbolInflateSize(c,e.symbol,f,0,g),l[0]+=c[0],l[1]+=c[1],l[2]+=c[2],l[3]+=c[3],h?(b[0]=l[0],b[1]=l[1],b[2]=l[2],b[3]=l[3],h=!1):(b[0]=Math.min(b[0],l[0]),b[1]=
Math.min(b[1],l[1]),b[2]=Math.max(b[2],l[2]),b[3]=Math.max(b[3],l[3])));return b};a._getInflateSize=function(b,c,f,g,h){return void 0!==c.symbolLayers?(b=this._getLayersInflateSize(b,c.symbolLayers,f,g,h),c=T(c.effects),0<c&&(b[0]-=c,b[1]-=c,b[2]+=c,b[3]+=c),b):this._getTextInflatedSize(b,c,h)};a._getLayersInflateSize=function(b,c,f,g,h){let l=!0;if(!c)return b;for(const r of c)if(r){var e=[0,0,0,0];switch(r.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":c=r;var k=c.width;
k=c.capStyle===p.LineCapStyle.Square||c.joinStyle===p.LineJoinStyle.Miter?k/1.4142135623730951:k/2;e[0]=-k;e[1]=-k;e[2]=k;e[3]=k;break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":c=r;if("CIMVectorMarker"===r.type){if(k=r,e=this._vectorMarkerBounds(e,k,f,h),k.frame){var m=(k.frame.xmin+k.frame.xmax)/2,q=(k.frame.ymin+k.frame.ymax)/2;e[0]-=m;e[1]-=q;e[2]-=m;e[3]-=q;k=k.size/(k.frame.ymax-k.frame.ymin);e[0]*=k;e[1]*=k;e[2]*=k;e[3]*=k}}else"CIMPictureMarker"===r.type?(e=r,
m=f.getResource(e.url),k=1,F.isSome(m)&&m.height&&(k=m.width/m.height),m=c.size/2,e=c.size*k*e.scaleX/2,e=[-e,-m,e,m]):(e=c.size/2,e=[-e,-e,e,e]);c.anchorPoint&&("Absolute"===c.anchorPointUnits?(k=c.anchorPoint.x,m=c.anchorPoint.y):(k=c.anchorPoint.x*(e[2]-e[0]),m=c.anchorPoint.y*(e[3]-e[1])),e[0]-=k,e[1]-=m,e[2]-=k,e[3]-=m);k=n.getValue(c.rotation);c.rotateClockwise&&(k=-k);g&&(k-=g);k&&(m=V*k,k=Math.cos(m),m=Math.sin(m),q=D.create([I.C_INFINITY,I.C_INFINITY,-I.C_INFINITY,-I.C_INFINITY]),D.expandPointInPlace(q,
[e[0]*k-e[1]*m,e[0]*m+e[1]*k]),D.expandPointInPlace(q,[e[0]*k-e[3]*m,e[0]*m+e[3]*k]),D.expandPointInPlace(q,[e[2]*k-e[1]*m,e[2]*m+e[1]*k]),D.expandPointInPlace(q,[e[2]*k-e[3]*m,e[2]*m+e[3]*k]),e=q);k=n.getValue(c.offsetX);m=n.getValue(c.offsetY);if(g){var t=V*g;q=Math.cos(t);t=Math.sin(t);const u=k*t+m*q;k=k*q-m*t;m=u}e[0]+=k;e[1]+=m;e[2]+=k;e[3]+=m;c=da(c.markerPlacement);0<c&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c)}c=T(r.effects);0<c&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c);l?(b[0]=e[0],b[1]=e[1],b[2]=e[2],
b[3]=e[3],l=!1):(b[0]=Math.min(b[0],e[0]),b[1]=Math.min(b[1],e[1]),b[2]=Math.max(b[2],e[2]),b[3]=Math.max(b[3],e[3]))}return b};a._getTextInflatedSize=function(b,c,f){const g=c.height??10;b[0]=-g/2;b[1]=-g/2;b[2]=g/2;b[3]=g/2;if(!f)return b;f=f.get(c);if(!f)return b;const {text:h,mosaicItem:l}=f;if(!l||0===l.glyphMosaicItems.length)return b;f=E.lineGapType2LineHeight(c.lineGapType,c.lineGap??0,g);const e=R.bidiText(h)[1];c=ca.shapeGlyphs(l.glyphMosaicItems,e,{scale:g/L.GLYPH_SIZE,angle:n.getValue(c.angle),
xOffset:n.getValue(c.offsetX),yOffset:n.getValue(c.offsetY),hAlign:E.horizontalAlignment2HAlign(c.horizontalAlignment),vAlign:E.verticalAlignment2VAlign(c.verticalAlignment),maxLineWidth:512,lineHeight:L.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(f||1,4)),decoration:c.font.decoration||"none",isCIM:!0}).boundsT;b[0]=c.x-c.halfWidth;b[1]=-c.y-c.halfHeight;b[2]=c.x+c.halfWidth;b[3]=-c.y+c.halfHeight;return b};return d}();let A=function(){function d(){}d.getEnvelope=function(a,b,c){c=new E.EnvDrawHelper(c);
if(Array.isArray(a)){let f;for(const g of a)f?f.union(J(c,g,b)):f=J(c,g,b);return f}return J(c,a,b)};d.getTextureAnchor=function(a,b){a=this.getEnvelope(a,null,b);if(!a)return[0,0,0];b=a.height*x+2;return[-((a.x+.5*a.width)*x)/(a.width*x+2),-((a.y+.5*a.height)*x)/b,b]};d.rasterize=function(a,b,c,f,g=!0){var h=c||this.getEnvelope(b,null,f);if(!h)return[null,0,0,0,0];const l=(h.x+.5*h.width)*x,e=(h.y+.5*h.height)*x;a.width=h.width*x;a.height=h.height*x;c||(a.width+=2,a.height+=2);c=a.getContext("2d");
h=E.Transformation.createScale(x,-x);h.translate(.5*a.width-l,.5*a.height+e);f=new E.CanvasDrawHelper(c,f,h);switch(b.type){case "CIMPointSymbol":f.drawSymbol(b,{type:"point",x:0,y:0});break;case "CIMVectorMarker":h=new S.Placement,f.drawMarker(b,h)}b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);if(g)for(f=0;f<b.length;f+=4)g=b[f+3]/255,b[f]*=g,b[f+1]*=g,b[f+2]*=g;return[b,a.width,a.height,-l/a.width,-e/a.height]};d.fromTextSymbol=function(a){const {angle:b,color:c,font:f,haloColor:g,
haloSize:h,horizontalAlignment:l,kerning:e,text:k,verticalAlignment:m,xoffset:q,yoffset:t}=a;let r,u;if(f){var y=f.family;var w=f.style;var z=f.weight;r=f.size;u=f.decoration}a=!1;k&&(a=R.bidiText(k)[1]);var ia=p.BlockProgression.BTT,ja=p.FontEffects.Normal,ka=p.FontEncoding.Unicode;y=y||"Arial";b:{if(z)switch(z.toLowerCase()){case "bold":case "bolder":z="bold";break b}z=""}b:{if(w)switch(w.toLowerCase()){case "italic":case "oblique":w="italic";break b}w=""}z=z&&w?`${z}-${w}`:`${z}${w}`;return{type:"CIMPointSymbol",
symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:b,blockProgression:ia,depth3D:1,extrapolateBaselines:!0,fontEffects:ja,fontEncoding:ka,fontFamilyName:y,fontStyleName:z,fontType:p.FontType.Unspecified,haloSize:h,height:r,hinting:p.GlyphHinting.Default,horizontalAlignment:la(l??
"center"),kerning:e,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:n.getValue(q),offsetY:n.getValue(t),strikethrough:"line-through"===u,underline:"underline"===u,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:v(c)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:v(g)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:a?p.TextReadingDirection.RTL:p.TextReadingDirection.LTR,
verticalAlignment:ma(m??"baseline"),verticalGlyphOrientation:p.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:p.BillBoardMode.FaceNearPlane},textString:k}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}};d.fromPictureFillSymbol=function(a){const {height:b,outline:c,width:f,xoffset:g,xscale:h,yoffset:l,yscale:e}=a,k=[],m={type:"CIMPolygonSymbol",symbolLayers:k};if(c){const {cap:t,join:r,miterLimit:u,width:y}=c;k.push({type:"CIMSolidStroke",color:v(c.color),
capStyle:N(t),joinStyle:O(r),miterLimit:u,width:y})}let q=a.url;"esriPFS"===a.type&&a.imageData&&(q=a.imageData);a="angle"in a?a.angle:0;k.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.TextureFilter.Picture,tintColor:null,url:q,height:b*(e||1),width:f*(h||1),offsetX:n.getValue(g),offsetY:n.getValue(l),rotation:n.getValue(-a),colorSubstitutions:null});return m};d.fromSimpleFillSymbol=function(a){const {color:b,style:c,outline:f}=a;a=[];const g={type:"CIMPolygonSymbol",
symbolLayers:a};var h=null;if(f){const {cap:l,join:e,style:k}=f;"solid"!==k&&"none"!==k&&"esriSLSSolid"!==k&&"esriSLSNull"!==k&&(h=[{type:"CIMGeometricEffectDashes",dashTemplate:P(k,l),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);a.push({type:"CIMSolidStroke",color:v(f.color),capStyle:N(l),joinStyle:O(e),miterLimit:f.miterLimit,width:f.width,effects:h})}if(c&&"solid"!==c&&"none"!==c&&"esriSFSSolid"!==c&&"esriSFSNull"!==c){h={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",
color:v(b),capStyle:p.LineCapStyle.Butt,joinStyle:p.LineJoinStyle.Miter,width:.75}]};let l=0;const e=C.px2pt("vertical"===c||"horizontal"===c||"cross"===c||"esriSFSCross"===c||"esriSFSVertical"===c||"esriSFSHorizontal"===c?8:10);switch(c){case "vertical":case "esriSFSVertical":l=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":l=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":l=45;break;case "cross":case "esriSFSCross":l=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":l=
-45}a.push({type:"CIMHatchFill",lineSymbol:h,offsetX:0,offsetY:0,rotation:l,separation:e});"cross"===c||"esriSFSCross"===c?a.push({type:"CIMHatchFill",lineSymbol:H.clone(h),offsetX:0,offsetY:0,rotation:90,separation:e}):("diagonal-cross"===c||"esriSFSDiagonalCross"===c)&&a.push({type:"CIMHatchFill",lineSymbol:H.clone(h),offsetX:0,offsetY:0,rotation:45,separation:e})}else!c||"solid"!==c&&"esriSFSSolid"!==c||a.push({type:"CIMSolidFill",enable:!0,color:v(b)});return g};d.fromSimpleLineSymbol=function(a){const {cap:b,
color:c,join:f,marker:g,miterLimit:h,style:l,width:e}=a;a=null;"solid"!==l&&"none"!==l&&"esriSLSSolid"!==l&&"esriSLSNull"!==l&&(a=[{type:"CIMGeometricEffectDashes",dashTemplate:P(l,b),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const k=[];if(g){let m;switch(g.placement){case "begin-end":m=p.ExtremityPlacement.Both;break;case "begin":m=p.ExtremityPlacement.JustBegin;break;case "end":m=p.ExtremityPlacement.JustEnd;break;default:m=p.ExtremityPlacement.None}const q=d.fromSimpleMarker(g,
e,c).symbolLayers[0];q.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:m,offsetAlongLine:0};k.push(q)}"none"!==l&&"esriSLSNull"!==l&&k.push({type:"CIMSolidStroke",color:v(c),capStyle:N(b),joinStyle:O(f),miterLimit:h,width:e,effects:a});return{type:"CIMLineSymbol",symbolLayers:k}};d.fromPictureMarker=function(a){const {angle:b,height:c,width:f,xoffset:g,yoffset:h}=a;let l=a.url;"esriPMS"===a.type&&a.imageData&&(l=a.imageData);return{type:"CIMPointSymbol",
symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.TextureFilter.Picture,tintColor:null,url:l,size:c,width:f,offsetX:n.getValue(g),offsetY:n.getValue(h),rotation:n.getValue(-b)}]}};d.fromSimpleMarker=function(a,b,c){var {style:f}=a;c=a.color??c;if("path"===f){b=[];"outline"in a&&a.outline&&(f=a.outline,b.push({type:"CIMSolidStroke",enable:!0,width:C.pt2px(Math.round(C.px2pt(f.width))),color:v(f.color)}));b.push({type:"CIMSolidFill",enable:!0,color:v(c),path:a.path});
const [e,k]=W("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:n.getValue(-a.angle),size:n.getValue(a.size||6),offsetX:n.getValue(a.xoffset),offsetY:n.getValue(a.yoffset),frame:e,markerGraphics:[{type:"CIMMarkerGraphic",geometry:k,symbol:{type:"CIMPolygonSymbol",symbolLayers:b}}]}]}}const [g,h]=W(f);if(h&&g){f=[];if("outline"in a&&a.outline){var l=a.outline;f.push({type:"CIMSolidStroke",enable:!0,width:.667<l.width?C.pt2px(Math.round(C.px2pt(l.width))):
l.width,color:v(l.color)})}else!b||"line-marker"!==a.type||"cross"!==a.style&&"x"!==a.style||f.push({type:"CIMSolidStroke",enable:!0,width:b,color:v(c)});f.push({type:"CIMSolidFill",enable:!0,color:v(c)});c={type:"CIMPolygonSymbol",symbolLayers:f};l={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:n.getValue(-a.angle),size:n.getValue(a.size||6*b),offsetX:n.getValue(a.xoffset),offsetY:n.getValue(a.yoffset),frame:g,markerGraphics:[{type:"CIMMarkerGraphic",geometry:h,symbol:c}]}]}}return l};
d.fromCIMHatchFill=function(a,b){const c=b*(a.separation??4);var f=c/2;a=H.clone(a.lineSymbol);for(var g=this._getLineSymbolPeriod(a)||4;4>g;)g*=2;g/=2;f={xmin:-g,xmax:g,ymin:-f,ymax:f};const h=a.symbolLayers.find(l=>"CIMSolidStroke"===l.type);h&&(h.width*=b);return{type:"CIMVectorMarker",frame:f,markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-g,0],[g,0]]]},symbol:a}],size:c}};d.fetchResources=function(a,b,c){if(a&&b)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a=
a.symbolLayers)for(const f of a)switch(fa(f,b,c),f.type){case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMCharacterMarker":case "CIMPictureMarker":"url"in f&&f.url&&c.push(b.fetchResource(f.url,null));break;case "CIMVectorMarker":if(a=f.markerGraphics)for(const g of a)g&&(a=g.symbol)&&d.fetchResources(a,b,c)}}};d._getLineSymbolPeriod=function(a){if(a){const b=this._getEffectsRepeat(a.effects);if(b)return b;if(a.symbolLayers)for(const c of a.symbolLayers)if(c){if(a=
this._getEffectsRepeat(c.effects))return a;switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(a=this._getPlacementRepeat(c.markerPlacement))return a}}}return 0};d._getEffectsRepeat=function(a){if(a)for(var b of a)if(b)switch(b.type){case "CIMGeometricEffectDashes":if((a=b.dashTemplate)&&a.length){b=0;for(const c of a)b+=c;a.length&1&&(b*=2);return b}break;case "CIMGeometricEffectWave":return b.period;default:M.error(`unsupported geometric effect type ${b.type}`)}return 0};
d._getPlacementRepeat=function(a){if(a)switch(a.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((a=a.placementTemplate)&&a.length){let b=0;for(const c of a)b+=c;a.length&1&&(b*=2);return b}}return 0};d.fromCIMInsidePolygon=function(a){var b=a.markerPlacement;const c={type:a.type,...a,markerPlacement:null,anchorPoint:null};a=Math.abs(b.stepX);const f=Math.abs(b.stepY);var g=(b.randomness??100)/100;let h,
l;if("Random"===b.gridType){var e=C.px2pt(L.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE);const k=Math.max(Math.floor(e/a),1),m=Math.max(Math.floor(e/f),1);e=k*a/2;h=m*f/2;l=2*h;b=new Y(b.seed);const q=g*a/1.5,t=g*f/1.5;g=[];for(let r=0;r<k;r++)for(let u=0;u<m;u++){const y=r*a-e+q*(.5-b.getFloat()),w=u*f-h+t*(.5-b.getFloat());g.push({x:y,y:w});0===r&&g.push({x:y+2*e,y:w});0===u&&g.push({x:y,y:w+2*h})}}else!0===b.shiftOddRows?(e=a/2,h=f,l=2*f,g=[{x:-e,y:0},{x:e,y:0},{x:0,y:h},{x:0,y:-h}]):(e=a/2,h=f/2,l=f,g=
[{x:-a,y:0},{x:0,y:-f},{x:-a,y:-f},{x:0,y:0},{x:a,y:0},{x:0,y:f},{x:a,y:f},{x:-a,y:f},{x:a,y:-f}]);a=g.map(k=>({type:"CIMMarkerGraphic",geometry:k,symbol:{type:"CIMPointSymbol",symbolLayers:[c]}}));return{type:"CIMVectorMarker",frame:{xmin:-e,xmax:e,ymin:-h,ymax:h},markerGraphics:a,size:l}};d.getSize=function(a){if(a)switch(a.type){case "CIMTextSymbol":return a.height;case "CIMPointSymbol":var b=0;if(a.symbolLayers)for(var c of a.symbolLayers)if(c)switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":a=
c.size,a>b&&(b=a)}return b;case "CIMLineSymbol":case "CIMPolygonSymbol":c=0;if(a.symbolLayers)for(b of a.symbolLayers)if(b)switch(b.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":a=b.width;a>c&&(c=a);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":n.isCIMMarkerStrokePlacement(b.markerPlacement)&&(a=b.size,a>c&&(c=a))}return c}};d.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==
a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-a.frame.ymin)}return 1};return d}(),na=function(){function d(){}d.findApplicableOverrides=function(a,b,c){if(a&&b){if(a.primitiveName){let f=!1;for(const g of c)if(g.primitiveName===a.primitiveName){f=!0;break}if(!f)for(const g of b)g.primitiveName===a.primitiveName&&c.push(g)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const f of a.effects)d.findApplicableOverrides(f,b,c);if(a.symbolLayers)for(const f of a.symbolLayers)d.findApplicableOverrides(f,
b,c);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(a.effects)for(const f of a.effects)d.findApplicableOverrides(f,b,c);a.markerPlacement&&d.findApplicableOverrides(a.markerPlacement,b,c);if("CIMVectorMarker"===a.type){if(a.markerGraphics)for(const f of a.markerGraphics)d.findApplicableOverrides(f,b,c),d.findApplicableOverrides(f.symbol,
b,c)}else"CIMCharacterMarker"===a.type?d.findApplicableOverrides(a.symbol,b,c):"CIMHatchFill"===a.type?d.findApplicableOverrides(a.lineSymbol,b,c):"CIMPictureMarker"===a.type&&d.findApplicableOverrides(a.animatedSymbolProperties,b,c)}}};d.findEffectOverrides=function(a,b,c){if(b&&a){var f=a.length;for(let g=0;g<f;g++){const h=a[g]?.primitiveName;if(h){let l=!1;for(const e of c)if(e.primitiveName===h){l=!0;break}if(!l)for(const e of b)e.primitiveName===h&&c.push(e)}}}};d.resolveSymbolOverrides=function(){var a=
Q._asyncToGenerator(function*(b,c,f,g,h,l,e){if(!b||!b.symbol)return null;let {symbol:k,primitiveOverrides:m}=b;b=!!m;if(!b&&!g)return k;k=H.clone(k);let q=!0;c||(c={attributes:{}},q=!1);b&&(q||(m=m.filter(t=>!t.valueExpressionInfo?.expression.includes("$feature"))),e||(m=m.filter(t=>!t.valueExpressionInfo?.expression.includes("$view"))),0<m.length&&(b=n.attributesToFields(c.attributes),yield d.evaluateOverrides(m,c,{spatialReference:f,fields:b,geometryType:h},l,e)),d.applyOverrides(k,m));g&&d.applyDictionaryTextOverrides(k,
c,g);return k});return function(b,c,f,g,h,l,e){return a.apply(this,arguments)}}();d.evaluateOverrides=function(){var a=Q._asyncToGenerator(function*(b,c,f,g,h){if(c){var l;for(const e of b)(b=e.valueExpressionInfo)&&f&&(l||(l=[]),e.value=void 0,b=aa.createRendererExpression(b.expression,f.spatialReference,f.fields).then(k=>{e.value=ba(k,c,{$view:h},f.geometryType,g)}),l.push(b));void 0!==l&&0<l.length&&(yield Promise.all(l))}});return function(b,c,f,g,h){return a.apply(this,arguments)}}();d.applyDictionaryTextOverrides=
function(a,b,c,f="Normal"){if(a&&a.type)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":case "CIMTextSymbol":var g=a.symbolLayers;if(!g)break;for(var h of g)h&&"CIMVectorMarker"===h.type&&d.applyDictionaryTextOverrides(h,b,c,"CIMTextSymbol"===a.type?a.textCase:f);break;case "CIMVectorMarker":a=a.markerGraphics;if(!a)break;for(g of a)g&&d.applyDictionaryTextOverrides(g,b,c);break;case "CIMMarkerGraphic":(h=a.textString)&&h.includes("[")&&(c=n.analyzeTextParts(h,c),
a.textString=n.assignTextValuesFromFeature(b,c,f))}};d.applyOverrides=function(a,b,c,f){if(a.primitiveName)for(const h of b)if(h.primitiveName===a.primitiveName){var g=(g=h.propertyName)?g.charAt(0).toLowerCase()+g.substr(1):g;f&&f.push({cim:a,nocapPropertyName:g,value:a[g]});h.expression&&(h.value=d.toValue(h.propertyName,h.expression));if(c){let l=!1;for(const e of c)e.primitiveName===a.primitiveName&&(l=!0);l||c.push(h)}F.isSome(h.value)&&(a[g]=h.value)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const h of a.effects)d.applyOverrides(h,
b,c,f);if(a.symbolLayers)for(const h of a.symbolLayers)d.applyOverrides(h,b,c,f);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(a.effects)for(const h of a.effects)d.applyOverrides(h,b,c,f);if("CIMVectorMarker"===a.type&&a.markerGraphics)for(const h of a.markerGraphics)d.applyOverrides(h,b,c,f),d.applyOverrides(h.symbol,b,c,f)}};d.restoreOverrides=function(a){for(const b of a)b.cim[b.nocapPropertyName]=b.value};d.buildOverrideKey=function(a){let b="";for(const c of a)void 0!==
c.value&&(b+=`${c.primitiveName}${c.propertyName}${JSON.stringify(c.value)}`);return b};d.toValue=function(a,b){return"DashTemplate"===a?b.split(" ").map(c=>Number(c)):"Color"===a?(a=(new X(b)).toRgba(),a[3]*=255,a):b};return d}();const N=d=>{if(!d)return p.LineCapStyle.Butt;switch(d){case "butt":return p.LineCapStyle.Butt;case "square":return p.LineCapStyle.Square;case "round":return p.LineCapStyle.Round}},O=d=>{if(!d)return p.LineJoinStyle.Miter;switch(d){case "miter":return p.LineJoinStyle.Miter;
case "round":return p.LineJoinStyle.Round;case "bevel":return p.LineJoinStyle.Bevel}},la=d=>{if(F.isNone(d))return"Center";switch(d){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},ma=d=>{if(F.isNone(d))return"Center";switch(d){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},v=d=>{if(!d)return[0,0,0,0];const {r:a,g:b,b:c,a:f}=d;return[a,b,c,255*f]},P=(d,a)=>{a="butt"===a;switch(d){case "dash":case "esriSLSDash":return a?
[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return a?[4,3,1,3]:[3,4,0,4];case "dot":case "esriSLSDot":return a?[1,3]:[0,4];case "long-dash":case "esriSLSLongDash":return a?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return a?[8,3,1,3]:[7,4,0,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return a?[8,3,1,3,1,3]:[7,4,0,4,0,4];case "short-dash":case "esriSLSShortDash":return a?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return a?[4,1,1,1]:[3,2,0,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return a?
[4,1,1,1,1,1]:[3,2,0,2,0,2];case "short-dot":case "esriSLSShortDot":return a?[1,1]:[0,2];case "solid":case "esriSLSSolid":case "none":return M.error("Unexpected: style does not require rasterization"),[0,0];default:return M.error(`Tried to rasterize SLS, but found an unexpected style: ${d}!`),[0,0]}},W=d=>{if("circle"===d||"esriSMSCircle"===d){var a=Math.acos(.995);d=Math.ceil(U/a/4);0===d&&(d=1);a=ha/d;d*=4;var b=[];b.push([50,0]);for(let c=1;c<d;c++)b.push([50*Math.cos(c*a),-50*Math.sin(c*a)]);
b.push([50,0]);a={rings:[b]};b={xmin:-50,ymin:-50,xmax:50,ymax:50}}else"cross"===d||"esriSMSCross"===d?(a={rings:[[[0,50],[0,0],[50,0],[50,-0],[0,-0],[0,-50],[-0,-50],[-0,-0],[-50,-0],[-50,0],[-0,0],[-0,50],[0,50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"diamond"===d||"esriSMSDiamond"===d?(a={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"square"===d||"esriSMSSquare"===d?(a={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},b={xmin:-50,ymin:-50,xmax:50,
ymax:50}):"x"===d||"esriSMSX"===d?(a={rings:[[[0,0],[50,50],[50,50],[0,0],[50,-50],[50,-50],[0,-0],[-50,-50],[-50,-50],[-0,0],[-50,50],[-50,50],[0,0]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"triangle"===d||"esriSMSTriangle"===d?(d=2/3*100,b=d-100,a={rings:[[[-57.735026918962575,b],[0,d],[57.735026918962575,b],[-57.735026918962575,b]]]},b={xmin:-57.735026918962575,ymin:b,xmax:57.735026918962575,ymax:d}):"arrow"===d&&(a={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},b={xmin:-50,
ymin:-50,xmax:50,ymax:50});return[b,a]};let G;B.CIMSymbolHelper=A;B.CIMSymbolInflatedSizeHelper=K;B.OverrideHelper=na;B.slsDashToTemplateArray=P;B.symbolToCIM=function(d){if(!d||!d.type)return null;let a;switch(d.type){case "cim":return d.data;case "web-style":return d;case "simple-marker":a=A.fromSimpleMarker(d);break;case "picture-marker":a=A.fromPictureMarker(d);break;case "simple-line":a=A.fromSimpleLineSymbol(d);break;case "simple-fill":a=A.fromSimpleFillSymbol(d);break;case "picture-fill":a=
A.fromPictureFillSymbol(d);break;case "text":a=A.fromTextSymbol(d)}return{type:"CIMSymbolReference",symbol:a}};Object.defineProperties(B,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});