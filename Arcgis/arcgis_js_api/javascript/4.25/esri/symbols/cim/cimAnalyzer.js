// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./quantizeTime ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/grouping".split(" "),function(aa,qa,ra,sa,Y,ta,P,ia,C,U,J,N,ua,Z,n,ja,V,va,wa){function ba(a){switch(a){case "Butt":return N.CapType.BUTT;
case "Square":return N.CapType.SQUARE;default:return N.CapType.ROUND}}function ca(a){switch(a){case "Bevel":return N.JoinType.BEVEL;case "Miter":return N.JoinType.MITER;default:return N.JoinType.ROUND}}function ka(a,l,g,h){let b;a[l]?b=a[l]:(b={},a[l]=b);b[g]=h}function la(a){return(a=a.markerPlacement)&&a.angleToLine?N.Alignment.MAP:N.Alignment.SCREEN}function da(){da=qa._asyncToGenerator(function*(a,l,g,h,b){h=h??[];if(!a)return h;let d;const f={};if("CIMSymbolReference"===a.type){if(d=a.symbol,
a=a.primitiveOverrides){var c=[];for(const m of a){var e=m.valueExpressionInfo;e&&l?(e=U.createRendererExpression(e.expression,l.spatialReference,l.fields).then(v=>{P.isNone(v)||ka(f,m.primitiveName,m.propertyName,v)}),c.push(e)):null!=m.value&&ka(f,m.primitiveName,m.propertyName,m.value)}0<c.length&&(yield Promise.all(c))}}else return ma.error("Expect cim type to be 'CIMSymbolReference'"),h;c=[];J.CIMSymbolHelper.fetchResources(d,g,c);0<c.length&&(yield Promise.all(c));switch(d.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":xa(d,
a,f,l,h,g,b)}return h});return da.apply(this,arguments)}function xa(a,l,g,h,b,d,f){if(a){var c=a.symbolLayers;if(c){var e=a.effects,m=J.CIMSymbolHelper.getSize(a);if("CIMPointSymbol"===a.type&&"Map"===a.angleAlignment)var v=N.Alignment.MAP;for(var w=c.length;w--;){var k=c[w];if(!k||!1===k.enable)continue;let A;e&&e.length&&(A=[...e]);var r=k.effects;r&&r.length&&(e?A.push(...r):A=[...r]);r=[];J.OverrideHelper.findEffectOverrides(A,l,r);r=0<r.length?ya(A,r,g,h):A;var u=[];J.OverrideHelper.findApplicableOverrides(k,
l,u);switch(k.type){case "CIMSolidFill":za(k,r,g,u,h,b);break;case "CIMPictureFill":Aa(k,r,g,u,h,d,b);break;case "CIMHatchFill":Ba(k,r,g,u,h,b);break;case "CIMGradientFill":var t=g,p=h,y=b;const [H,S]=K(u,k.primitiveName,r,null,null);var x=C.numericHash(JSON.stringify(k)+S).toString();y.push({type:"fill",templateHash:x,materialHash:H?W(x,t,u,p):x,cim:k,materialOverrides:null,colorLocked:k.colorLocked,effects:r,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,
sampleAlphaOnly:!1});break;case "CIMSolidStroke":Ca(k,r,g,u,h,b,"CIMPolygonSymbol"===a.type,m);break;case "CIMPictureStroke":Da(k,r,g,u,h,b,"CIMPolygonSymbol"===a.type,m);break;case "CIMGradientStroke":t=g;p=h;y=b;x="CIMPolygonSymbol"===a.type;var B=m,D=k.primitiveName,G=void 0!==k.width?k.width:4,z=ba(k.capStyle),E=ca(k.joinStyle),F=k.miterLimit;const [Q,L]=K(u,D,r,null,null),R=C.numericHash(JSON.stringify(k)+L).toString();y.push({type:"line",templateHash:R,materialHash:Q?W(R,t,u,p):R,cim:k,materialOverrides:null,
isOutline:x,colorLocked:k.colorLocked,effects:r,color:{r:128,g:128,b:128,a:1},width:q(D,t,"Width",p,G),cap:q(D,t,"CapStyle",p,z),join:q(D,t,"JoinStyle",p,E),miterLimit:q(D,t,"MiterLimit",p,F),referenceWidth:B,zOrder:ea(k.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1});break;case "CIMCharacterMarker":fa(k,r,g,u,h,b);break;case "CIMPictureMarker":if(fa(k,r,g,u,h,b))break;"CIMLineSymbol"===a.type&&(v=la(k));Ea(k,r,g,u,h,d,b,v,m);break;case "CIMVectorMarker":if(fa(k,r,g,u,h,b))break;"CIMLineSymbol"===
a.type&&(v=la(k));t=g;p=h;y=b;x=d;B=v;D=m;G=f;if(E=k.markerGraphics){z=0;k.scaleSymbolsProportionally&&(F=k.frame)&&(z=F.ymax-F.ymin);F=na(k.markerPlacement,u,t,p);for(const O of E)if(O&&(E=O.symbol))switch(E.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":Fa(k,r,F,null,O,u,t,p,y,x,B,D,z,G);break;case "CIMTextSymbol":Ga(k,r,F,O,t,u,p,y,B,D,z)}}break;default:ma.error("Cannot analyze CIM layer",k.type)}}}}}function za(a,l,g,h,b,d){const f=a.primitiveName,c=n.fromCIMColor(a.color),
[e,m]=K(h,f,l,null,null),v=C.numericHash(JSON.stringify(a)+m).toString();d.push({type:"fill",templateHash:v,materialHash:e?()=>v:v,cim:a,materialOverrides:null,colorLocked:a.colorLocked,color:q(f,g,"Color",b,c,M),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:l,applyRandomOffset:!1,sampleAlphaOnly:!0})}function Aa(a,l,g,h,b,d,f){const c=a.primitiveName,e=a.tintColor?n.fromCIMColor(a.tintColor):{r:255,g:255,b:255,a:1},[m,v]=K(h,c,l,null,null);h=C.numericHash(JSON.stringify(a)+v).toString();
const w=C.numericHash(`${a.url}${JSON.stringify(a.colorSubstitutions)}`).toString();let k=n.getValue(a.scaleX);if("width"in a){const r=a.width;let u=1;d=d.getResource(a.url);P.isSome(d)&&(u=d.width/d.height);k/=a.height/r*u}f.push({type:"fill",templateHash:h,materialHash:m?()=>w:w,cim:a,materialOverrides:null,colorLocked:a.colorLocked,effects:l,color:q(c,g,"TintColor",b,e,M),height:q(c,g,"Height",b,a.height),scaleX:q(c,g,"ScaleX",b,k),angle:q(c,g,"Rotation",b,n.getValue(a.rotation)),offsetX:q(c,g,
"OffsetX",b,n.getValue(a.offsetX)),offsetY:q(c,g,"OffsetY",b,n.getValue(a.offsetY)),url:a.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}function Ba(a,l,g,h,b,d){const f=["Rotation","OffsetX","OffsetY"],c=h.filter(r=>r.primitiveName!==a.primitiveName||!f.includes(r.propertyName)),e=a.primitiveName,[m,v]=K(h,e,l,null,null);h=C.numericHash(JSON.stringify(a)+v).toString();const w=C.numericHash(`${a.separation}${JSON.stringify(a.lineSymbol)}`).toString();let k={r:255,g:255,b:255,a:1};if(a.lineSymbol){const r=
a.lineSymbol?.symbolLayers.find(u=>"CIMSolidStroke"===u.type);r&&(k=n.fromCIMColor(r.color))}d.push({type:"fill",templateHash:h,materialHash:m?W(w,g,c,b):w,cim:a,materialOverrides:c,colorLocked:a.colorLocked,effects:l,color:k,height:q(e,g,"Separation",b,a.separation),scaleX:1,angle:q(e,g,"Rotation",b,n.getValue(a.rotation)),offsetX:q(e,g,"OffsetX",b,n.getValue(a.offsetX)),offsetY:q(e,g,"OffsetY",b,n.getValue(a.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0})}function Ca(a,l,g,h,b,d,f,c){const e=
a.primitiveName,m=n.fromCIMColor(a.color),v=void 0!==a.width?a.width:4,w=ba(a.capStyle),k=ca(a.joinStyle),r=a.miterLimit,[u,t]=K(h,e,l,null,null),p=C.numericHash(JSON.stringify(a)+t).toString();let y;if(l&&l instanceof Array&&0<l.length&&(h=l[l.length-1],"CIMGeometricEffectDashes"===h.type&&"NoConstraint"===h.lineDashEnding&&null===h.offsetAlongLine)){l=[...l];var x=l.pop();y=x.dashTemplate;x=x.scaleDash}d.push({type:"line",templateHash:p,materialHash:u?()=>p:p,cim:a,materialOverrides:null,isOutline:f,
colorLocked:a.colorLocked,effects:l,color:q(e,g,"Color",b,m,M),width:q(e,g,"Width",b,v),cap:q(e,g,"CapStyle",b,w),join:q(e,g,"JoinStyle",b,k),miterLimit:q(e,g,"MiterLimit",b,r),referenceWidth:c,zOrder:ea(a.name),dashTemplate:y,scaleDash:x,sampleAlphaOnly:!0})}function Da(a,l,g,h,b,d,f,c){const e=C.numericHash(`${a.url}${JSON.stringify(a.colorSubstitutions)}`).toString(),m=a.primitiveName,v=n.fromCIMColor(a.tintColor),w=void 0!==a.width?a.width:4,k=ba(a.capStyle),r=ca(a.joinStyle),u=a.miterLimit,[t,
p]=K(h,m,l,null,null);h=C.numericHash(JSON.stringify(a)+p).toString();d.push({type:"line",templateHash:h,materialHash:t?()=>e:e,cim:a,materialOverrides:null,isOutline:f,colorLocked:a.colorLocked,effects:l,color:q(m,g,"TintColor",b,v,M),width:q(m,g,"Width",b,w),cap:q(m,g,"CapStyle",b,k),join:q(m,g,"JoinStyle",b,r),miterLimit:q(m,g,"MiterLimit",b,u),referenceWidth:c,zOrder:ea(a.name),dashTemplate:null,scaleDash:!1,url:a.url,sampleAlphaOnly:!1})}function fa(a,l,g,h,b,d){const f=a.markerPlacement;if(!f||
"CIMMarkerPlacementInsidePolygon"!==f.type)return!1;var c=Math.abs(f.stepX),e=Math.abs(f.stepY);if(0===c||0===e)return!0;const m=["Rotation","OffsetX","OffsetY"],v=h.filter(p=>p.primitiveName!==a.primitiveName||!m.includes(p.propertyName)),w="url"in a?a.url:null,[k,r]=K(h,f.primitiveName,l,null,null);h=C.numericHash(JSON.stringify(a)+r).toString();let u=null;if("Random"===f.gridType){var t=ia.px2pt(va.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE);const p=Math.max(Math.floor(t/c),1),y=Math.max(Math.floor(t/
e),1);t=e*y;u=x=>x?x*y:0;c=p*c/t}else f.shiftOddRows?(t=2*e,u=p=>p?2*p:0,c=c/e*.5):(t=e,u=null,c/=e);e={r:255,g:255,b:255,a:1};"tintColor"in a&&(e=n.fromCIMColor(a.tintColor));d.push({type:"fill",templateHash:h,materialHash:k?W(h,g,v,b):h,cim:a,materialOverrides:v,colorLocked:a.colorLocked,effects:l,color:q(f.primitiveName,g,"TintColor",b,e,M),height:q(f.primitiveName,g,"StepY",b,t,u),scaleX:c,angle:q(f.primitiveName,g,"GridAngle",b,f.gridAngle),offsetX:q(f.primitiveName,g,"OffsetX",b,n.getValue(f.offsetX)),
offsetY:q(f.primitiveName,g,"OffsetY",b,n.getValue(f.offsetY)),url:w,applyRandomOffset:"Random"===f.gridType,sampleAlphaOnly:!w});return!0}function Ea(a,l,g,h,b,d,f,c,e){const m=a.primitiveName,v=n.getValue(a.size);let w=n.getValue(a.scaleX,1);const k=n.getValue(a.rotation),r=n.getValue(a.offsetX),u=n.getValue(a.offsetY),t=a.tintColor?n.fromCIMColor(a.tintColor):{r:255,g:255,b:255,a:1},p=C.numericHash(`${a.url}${JSON.stringify(a.colorSubstitutions)}${JSON.stringify(a.animatedSymbolProperties)}`).toString(),
y=na(a.markerPlacement,h,g,b),x=Ha(a.animatedSymbolProperties,h,g,b),[B,D]=K(h,m,l,y,x);h=C.numericHash(JSON.stringify(a)+D).toString();const G=a.anchorPoint??{x:0,y:0};if("width"in a){const z=a.width;let E=1;d=d.getResource(a.url);P.isSome(d)&&(E=d.width/d.height);w/=v/z*E}f.push({type:"marker",templateHash:h,materialHash:a.animatedSymbolProperties&&!0===a.animatedSymbolProperties.randomizeStartTime?(z,E,F,A)=>{F=wa.getMaterialGroup(A);z=n.evaluateValueOrFunction(x,z,E);return p+`-MATERIALGROUP(${F})`+
`-ASP(${JSON.stringify(z)})`}:B?(z,E)=>{z=n.evaluateValueOrFunction(x,z,E);return p+`-ASP(${JSON.stringify(z)})`}:p,cim:a,materialOverrides:null,colorLocked:a.colorLocked,effects:l,scaleSymbolsProportionally:!1,alignment:c,size:q(m,g,"Size",b,v),scaleX:q(m,g,"ScaleX",b,w),rotation:q(m,g,"Rotation",b,k),offsetX:q(m,g,"OffsetX",b,r),offsetY:q(m,g,"OffsetY",b,u),color:q(m,g,"TintColor",b,t,M),anchorPoint:{x:G.x,y:-G.y},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},
outlineWidth:0,frameHeight:0,rotateClockwise:a.rotateClockwise,referenceSize:e,sizeRatio:1,markerPlacement:y,url:a.url,animatedSymbolProperties:x})}function Ga(a,l,g,h,b,d,f,c,e,m,v){J.OverrideHelper.findApplicableOverrides(h,d,[]);var w=h.geometry;if("x"in w&&"y"in w){var k=h.symbol,r=n.fromCIMFontDecoration(k),u=n.fromCIMFontStyle(k.fontStyleName),t=sa.getFontFamily(k.fontFamilyName);k.font={family:t,decoration:r,...u};var p=a.frame,y=w.x-.5*(p.xmin+p.xmax),x=w.y-.5*(p.ymin+p.ymax),B=a.size/v;v=
a.primitiveName;w=n.getValue(k.height)*B;p=n.getValue(k.angle);y=n.getValue(a.offsetX)+(n.getValue(k.offsetX)+y)*B;x=n.getValue(a.offsetY)+(n.getValue(k.offsetY)+x)*B;var D=n.fromCIMColor(n.getFillColor(k)),G=n.fromCIMColor(n.getStrokeColor(k)),z=n.getStrokeWidth(k);z||(G=n.fromCIMColor(n.getFillColor(k.haloSymbol)),z=k.haloSize*B);var [E,F]=K(d,v,l,g,null);d=JSON.stringify(a.effects)+Number(a.colorLocked).toString()+JSON.stringify(a.anchorPoint)+a.anchorPointUnits+JSON.stringify(a.markerPlacement)+
a.size.toString();d=C.numericHash(JSON.stringify(h)+d+F).toString();var A=q(h.primitiveName,b,"TextString",f,h.textString,n.adjustTextCase,k.textCase);if(null!=A){({fontStyleName:h}=k);var H=t+(h?"-"+h.toLowerCase():"-regular");"string"===typeof A&&A.includes("[")&&k.fieldMap&&(A=n.createLabelOverrideFunction(k.fieldMap,A,k.textCase));c.push({type:"text",templateHash:d,materialHash:E||"function"===typeof A||A.match(/\[(.*?)\]/)?(S,Q,L)=>H+"-"+n.evaluateValueOrFunction(A,S,Q,L):H+"-"+C.numericHash(A),
cim:k,materialOverrides:null,colorLocked:a.colorLocked,effects:l,alignment:e,anchorPoint:{x:a.anchorPoint?a.anchorPoint.x:0,y:a.anchorPoint?a.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,fontName:H,decoration:r,weight:q(v,b,"Weight",f,u.weight),style:q(v,b,"Size",f,u.style),size:q(v,b,"Size",f,w),angle:q(v,b,"Rotation",f,p),offsetX:q(v,b,"OffsetX",f,y),offsetY:q(v,b,"OffsetY",f,x),horizontalAlignment:n.fromCIMHorizontalAlignment(k.horizontalAlignment),verticalAlignment:n.fromCIMVerticalAlignment(k.verticalAlignment),
text:A,color:D,outlineColor:G,outlineSize:z,referenceSize:m,sizeRatio:1,markerPlacement:g})}}}function Fa(a,l,g,h,b,d,f,c,e,m,v,w,k,r){var u=b.symbol;const t=u.symbolLayers;if(t)if(r)oa(a,l,g,h,b,f,d,c,e,m,v,w,k);else if(r=t.length,t&&2===t.length&&t[0].enable&&t[1].enable&&"CIMSolidStroke"===t[0].type&&"CIMSolidFill"===t[1].type&&!t[0].effects&&!t[1].effects)Ia(a,l,g,h,b,t,d,f,c,e,v,w,k);else if(u=ja.CIMEffectHelper.applyEffects(u.effects,b.geometry,m.geometryEngine))for(;r--;){var p=t[r];if(p&&
!1!==p.enable)switch(p.type){case "CIMSolidFill":case "CIMSolidStroke":var y=ja.CIMEffectHelper.applyEffects(p.effects,u,m.geometryEngine),x=Z.getExtent(y);if(!x)continue;const G="Relative"!==a.anchorPointUnits,[z,E,F]=Z.getSDFMetrics(x,a.frame,a.size,a.anchorPoint,G);var B="CIMSolidFill"===p.type;y={type:"sdf",geom:y,asFill:B};var D=a.primitiveName;x=n.getValue(a.size)??10;const A=n.getValue(a.rotation),H=n.getValue(a.offsetX),S=n.getValue(a.offsetY),Q=p.path,L=p.primitiveName,R=B?n.fromCIMColor(n.getFillColor(p)):
n.fromCIMColor(n.getStrokeColor(p)),O=B?{r:0,g:0,b:0,a:0}:n.fromCIMColor(n.getStrokeColor(p)),X=n.getStrokeWidth(p);if(!B&&!X)break;B=!1;let I="";for(const T of d)if(T.primitiveName===L||T.primitiveName===D)void 0!==T.value?I+=`-${T.primitiveName}-${T.propertyName}-${JSON.stringify(T.value)}`:T.valueExpressionInfo&&(B=!0);P.isSome(l)&&"function"===typeof l&&(B=!0);D=JSON.stringify({...a,markerGraphics:null});const pa=C.numericHash(JSON.stringify(y)+Q).toString();p={type:"marker",templateHash:C.numericHash(JSON.stringify(b)+
JSON.stringify(p)+D+I).toString(),materialHash:B?()=>pa:pa,cim:y,materialOverrides:null,colorLocked:a.colorLocked,effects:l,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:v,anchorPoint:{x:E,y:F},isAbsoluteAnchorPoint:G,size:q(a.primitiveName,f,"Size",c,x),rotation:q(a.primitiveName,f,"Rotation",c,A),offsetX:q(a.primitiveName,f,"OffsetX",c,H),offsetY:q(a.primitiveName,f,"OffsetY",c,S),scaleX:1,frameHeight:k,rotateClockwise:a.rotateClockwise,referenceSize:w,sizeRatio:z,color:q(L,
f,"Color",c,R,M),outlineColor:q(L,f,"Color",c,O,M),outlineWidth:q(L,f,"Width",c,X),markerPlacement:g,animatedSymbolProperties:h,path:Q};e.push(p);break;default:oa(a,l,g,h,b,f,d,c,e,m,v,w,k)}}}function Ia(a,l,g,h,b,d,f,c,e,m,v,w,k){var r=b.geometry;const u=d[0];d=d[1];var t=Z.getExtent(r);if(t){var p="Relative"!==a.anchorPointUnits,[y,x,B]=Z.getSDFMetrics(t,a.frame,a.size,a.anchorPoint,p);r={type:"sdf",geom:r,asFill:!0};var D=a.primitiveName;t=n.getValue(a.size);var G=n.getValue(a.rotation),z=n.getValue(a.offsetX),
E=n.getValue(a.offsetY),F=d.path,A=d.primitiveName,H=u.primitiveName,S=n.fromCIMColor(n.getFillColor(d)),Q=n.fromCIMColor(n.getStrokeColor(u)),L=n.getStrokeWidth(u),R=!1,O="";for(const I of f)if(I.primitiveName===A||I.primitiveName===H||I.primitiveName===D)void 0!==I.value?O+=`-${I.primitiveName}-${I.propertyName}-${JSON.stringify(I.value)}`:I.valueExpressionInfo&&(R=!0);f=JSON.stringify({...a,markerGraphics:null});var X=C.numericHash(JSON.stringify(r)+F).toString();a={type:"marker",templateHash:C.numericHash(JSON.stringify(b)+
JSON.stringify(d)+JSON.stringify(u)+f+O).toString(),materialHash:R?()=>X:X,cim:r,materialOverrides:null,colorLocked:a.colorLocked,effects:l,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:v,anchorPoint:{x,y:B},isAbsoluteAnchorPoint:p,size:q(a.primitiveName,c,"Size",e,t),rotation:q(a.primitiveName,c,"Rotation",e,G),offsetX:q(a.primitiveName,c,"OffsetX",e,z),offsetY:q(a.primitiveName,c,"OffsetY",e,E),scaleX:1,frameHeight:k,rotateClockwise:a.rotateClockwise,referenceSize:w,sizeRatio:y,
color:q(A,c,"Color",e,S,M),outlineColor:q(H,c,"Color",e,Q,M),outlineWidth:q(H,c,"Width",e,L),markerPlacement:g,path:F,animatedSymbolProperties:h};m.push(a)}}function oa(a,l,g,h,b,d,f,c,e,m,v,w,k){b={type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:a.rotateClockwise,rotation:0,size:a.size,billboardMode3D:a.billboardMode3D,depth3D:a.depth3D,frame:a.frame,markerGraphics:[b],
scaleSymbolsProportionally:a.scaleSymbolsProportionally,respectFrame:a.respectFrame,clippingPath:a.clippingPath};const r=["Rotation","OffsetX","OffsetY"],u=f.filter(z=>z.primitiveName!==a.primitiveName||!r.includes(z.propertyName));var t="";for(var p of f)void 0!==p.value&&(t+=`-${p.primitiveName}-${p.propertyName}-${JSON.stringify(p.value)}`);const [y,x,B]=J.CIMSymbolHelper.getTextureAnchor(b,m);f=a.primitiveName;m=n.getValue(a.rotation);p=n.getValue(a.offsetX);const D=n.getValue(a.offsetY);t=C.numericHash(JSON.stringify(b)+
t).toString();const G=0<u.length||P.isSome(l)&&"function"===typeof l;l={type:"marker",templateHash:t,materialHash:G?W(t,d,u,c):t,cim:b,materialOverrides:u,colorLocked:a.colorLocked,effects:l,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:v,anchorPoint:{x:y,y:x},isAbsoluteAnchorPoint:!1,size:a.size,rotation:q(f,d,"Rotation",c,m),offsetX:q(f,d,"OffsetX",c,p),offsetY:q(f,d,"OffsetY",c,D),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:k,
rotateClockwise:a.rotateClockwise,referenceSize:w,sizeRatio:B/ia.pt2px(a.size),markerPlacement:g,animatedSymbolProperties:h};e.push(l)}function ea(a){return a&&0===a.indexOf("Level_")&&(a=parseInt(a.substr(6),10),!isNaN(a))?a:0}function M(a){if(!a||0===a.length)return null;a=(new ra(a)).toRgba();return{r:a[0],g:a[1],b:a[2],a:a[3]}}function q(a,l,g,h,b,d,f){if(a=l[a]){const c=a[g];if("string"===typeof c||"number"===typeof c||c instanceof Array)return d?d.call(null,c,f):c;if(null!=c&&c instanceof U.ArcadeExpression)return(e,
m,v)=>{e=V(c,e,{$view:v},h.geometryType,m);null!==e&&d&&(e=d.call(null,e,f));return null!==e?e:b}}return b}function ha(a){return a?a.charAt(0).toLowerCase()+a.substr(1):a}function ya(a,l,g,h){for(const b of l)if(b.valueExpressionInfo){const d=g[b.primitiveName]&&g[b.primitiveName][b.propertyName];d instanceof U.ArcadeExpression&&(b.fn=(f,c,e)=>V(d,f,{$view:e},h.geometryType,c))}return(b,d,f)=>{for(var c of l)c.fn&&(c.value=c.fn(b,d,f));b=[];for(let e of a){if(d=e?.primitiveName){f=!1;for(const m of l)m.primitiveName===
d&&(c=ha(m.propertyName),null!=m.value&&m.value!==e[c]&&(f||(e=Y.clone(e),f=!0),e[c]=m.value))}b.push(e)}return b}}function na(a,l,g,h){const b=[];J.OverrideHelper.findApplicableOverrides(a,l,b);if(0===b.length)return a;for(const d of b)if(d.valueExpressionInfo){const f=g[d.primitiveName]&&g[d.primitiveName][d.propertyName];f instanceof U.ArcadeExpression&&(d.fn=(c,e,m)=>V(f,c,{$view:m},h.geometryType,e))}return(d,f,c)=>{for(const e of b)e.fn&&(e.value=e.fn(d,f,c));d=Y.clone(a);f=a.primitiveName;
for(const e of b)e.primitiveName===f&&(c=ha(e.propertyName),null!=e.value&&e.value!==d[c]&&(d[c]=e.value));return d}}function Ha(a,l,g,h){const b=[];J.OverrideHelper.findApplicableOverrides(a,l,b);if(0===b.length)return a;for(const d of b)if(d.valueExpressionInfo){const f=g[d.primitiveName]&&g[d.primitiveName][d.propertyName];f instanceof U.ArcadeExpression&&(d.fn=(c,e,m)=>V(f,c,{$view:m},h.geometryType,e))}return(d,f,c)=>{for(var e of b)e.fn&&(e.value=e.fn(d,f,c));d=Y.clone(a);f=a.primitiveName;
for(const m of b)m.primitiveName===f&&(c=ha(m.propertyName),null!=m.value&&(e=ua.quantizeIfNeeded(m.value,m.propertyName),e!==d[c]&&(d[c]=e)));return d}}function W(a,l,g,h){for(const b of g)if(b.valueExpressionInfo){const d=l[b.primitiveName]&&l[b.primitiveName][b.propertyName];d instanceof U.ArcadeExpression&&(b.fn=(f,c,e)=>V(d,f,{$view:e},h.geometryType,c))}return(b,d,f)=>{for(const c of g)c.fn&&(c.value=c.fn(b,d,f));return C.numericHash(a+J.OverrideHelper.buildOverrideKey(g)).toString()}}function K(a,
l,g,h,b){let d=!1,f="";for(const c of a)c.primitiveName===l&&(void 0!==c.value?f+=`-${c.primitiveName}-${c.propertyName}-${JSON.stringify(c.value)}`:c.valueExpressionInfo&&(d=!0));P.isSome(g)&&"function"===typeof g&&(d=!0);P.isSome(h)&&"function"===typeof h&&(d=!0);P.isSome(b)&&"function"===typeof b&&(d=!0);return[d,f]}const ma=ta.getLogger("esri.symbols.cim.cimAnalyzer");aa.analyzeCIMResource=function(a,l){if(!l||0===l.length)return a;a=Y.clone(a);J.OverrideHelper.applyOverrides(a,l);return a};aa.analyzeCIMSymbol=
function(a,l,g,h,b){return da.apply(this,arguments)};Object.defineProperties(aa,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});