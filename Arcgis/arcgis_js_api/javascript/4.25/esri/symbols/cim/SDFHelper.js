// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect"],function(A,D,E,F){function B(b){if(!b)return null;switch(b.type){case "CIMPointSymbol":b=b.symbolLayers;if(!b||1!==b.length)break;return B(b[0]);case "CIMVectorMarker":b=b.markerGraphics;if(!b||1!==b.length)break;var a=b[0];if(!a)break;b=a.geometry;if(!b)break;a=a.symbol;if(!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type||a.symbolLayers?.some(c=>!!c.effects))break;return{geom:b,asFill:"CIMPolygonSymbol"===
a.type};case "sdf":return{geom:b.geom,asFill:b.asFill}}return null}function C(b){let a=Infinity,c=-Infinity,e=Infinity,d=-Infinity;for(const f of b)for(const k of f)k[0]<a&&(a=k[0]),k[0]>c&&(c=k[0]),k[1]<e&&(e=k[1]),k[1]>d&&(d=k[1]);return[a,e,c,d]}A.buildSDF=function(b){var a=b.geom;var c=a?a.rings?a.rings:a.paths?a.paths:void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax?[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]:null:null;a=Infinity;var e=
-Infinity;var d=Infinity,f=-Infinity;for(var k of c)for(var m of k)m[0]<a&&(a=m[0]),m[0]>e&&(e=m[0]),m[1]<d&&(d=m[1]),m[1]>f&&(f=m[1]);e=new F(a,d,e-a,f-d);d=64/Math.max(e.width,e.height);k=Math.round(e.width*d)+62;m=Math.round(e.height*d)+62;a=[];for(var n of c)if(n&&1<n.length){c=[];for(var l of n){let [t,v]=l;t-=e.x;v-=e.y;t*=d;v*=d;t+=30.5;v+=30.5;b.asFill?c.push([t,v]):c.push([Math.round(t),Math.round(v)])}b.asFill&&(f=c.length-1,c[0][0]===c[f][0]&&c[0][1]===c[f][1]||c.push(c[0]));a.push(c)}l=
k*m;n=Array(l);for(c=0;c<l;++c)n[c]=962;for(var h of a)for(c=h.length,e=1;e<c;++e){d=h[e-1];f=h[e];var u=void 0,p=void 0;d[0]<f[0]?(u=d[0],p=f[0]):(u=f[0],p=d[0]);var g=void 0,q=void 0;d[1]<f[1]?(g=d[1],q=f[1]):(g=f[1],q=d[1]);var w=Math.floor(u)-31;p=Math.floor(p)+31;g=Math.floor(g)-31;q=Math.floor(q)+31;0>w&&(w=0);p>k&&(p=k);0>g&&(g=0);q>m&&(q=m);u=f[0]-d[0];const t=f[1]-d[1],v=u*u+t*t;for(;w<p;w++)for(let y=g;y<q;y++){var r=(w-d[0])*u+(y-d[1])*t,x=void 0;0>r?(x=d[0],r=d[1]):r>v?(x=f[0],r=f[1]):
(r/=v,x=d[0]+r*u,r=d[1]+r*t);x=(w-x)*(w-x)+(y-r)*(y-r);r=(m-y-1)*k+w;x<n[r]&&(n[r]=x)}}for(h=0;h<l;++h)n[h]=Math.sqrt(n[h]);if(b.asFill)for(var z of a)for(b=z.length,h=1;h<b;++h)for(a=z[h-1],l=z[h],a[0]<l[0]?(c=a[0],e=l[0]):(c=l[0],e=a[0]),a[1]<l[1]?(f=a[1],d=l[1]):(f=l[1],d=a[1]),c=Math.floor(c),e=Math.floor(e)+1,f=Math.floor(f),d=Math.floor(d)+1,31>c&&(c=31),e>k-31&&(e=k-31),31>f&&(f=31),d>m-31&&(d=m-31);f<d;++f)if(a[1]>f!==l[1]>f){p=(m-f-1)*k;for(g=c;g<e;++g)g<(l[0]-a[0])*(f-a[1])/(l[1]-a[1])+
a[0]&&(n[p+g]=-n[p+g]);for(g=31;g<c;++g)n[p+g]=-n[p+g]}z=n.length;b=new Uint8Array(4*z);for(h=0;h<z;++h)D.packFloatRGBA(.5-n[h]/62,b,4*h);return[b,k,m]};A.getExtent=function(b){return b?b.rings?C(b.rings):b.paths?C(b.paths):E.isExtent(b)?[b.xmin,b.ymin,b.xmax,b.ymax]:null:null};A.getSDFInfo=B;A.getSDFMetrics=function(b,a,c,e,d){const [f,k,m,n]=b;if(m<f||n<k)return[0,0,0];var l=m-f,h=n-k;b=64/Math.max(l,h);const u=Math.round(l*b),p=Math.round(h*b)+62;h=1;a&&(h=p/b/(a.ymax-a.ymin));let g=0,q=0;l=1;
e&&(d?a&&c&&0<a.ymax-a.ymin&&(l=(a.xmax-a.xmin)/(a.ymax-a.ymin),g=e.x/(c*l),q=e.y/c):(g=e.x,q=e.y));g=.5*(a.xmax+a.xmin)+g*(a.xmax-a.xmin);q=.5*(a.ymax+a.ymin)+q*(a.ymax-a.ymin);g=(g-f)*b+31;q=(q-k)*b+31;a=g/(u+62)-.5;e=q/p-.5;d&&(a*=c*l,e*=c);return[h,a,e]};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});