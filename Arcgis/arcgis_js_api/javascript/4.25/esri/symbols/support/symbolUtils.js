// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils".split(" "),function(u,t,w,L,p,B,E,F,G,r){function H(a,b){if(b&&(a.style.filter=r.getCSSFilterFromEffectList(b),b=b.effects))for(const c of b)if("drop-shadow"===c?.type){0>c.offsetX?a.style.marginLeft=`${Math.abs(c.offsetX)}px`:a.style.marginRight=`${c.offsetX}px`;break}}function C(a,b){return x.apply(this,arguments)}function x(){x=
w._asyncToGenerator(function*(a,b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=yield new Promise((d,e)=>u(["./previewWebStyleSymbol"],d,e));return c(a,C,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=yield new Promise((d,e)=>u(["./previewSymbol3D"],d,e)),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=yield new Promise((d,
e)=>u(["./previewSymbol2D"],d,e)),c(a,b);case "cim":return{previewCIMSymbol:c}=yield new Promise((d,e)=>u(["./previewCIMSymbol"],d,e)),c(a,b)}});return x.apply(this,arguments)}function y(a){return a&&"opacity"in a?a.opacity*y(a.parent):1}function z(){z=w._asyncToGenerator(function*(a,b){if(a){var c=a.sourceLayer,d=(p.isSome(b)&&(b.useSourceLayer??!1)?c:a.layer)??c;c=y(d);if(p.isSome(a.symbol)&&(!p.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?yield a.symbol.fetchSymbol({...b,
cache:p.isSome(b)?b.webStyleCache:null}):a.symbol.clone(),r.applyColorToSymbol(a,null,c),a;var e=(p.isSome(b)?b.renderer:null)??(d&&"renderer"in d?d.renderer:null);if(d=e&&"getSymbolAsync"in e?yield e.getSymbolAsync(a,b):null){d="web-style"===d.type?yield d.fetchSymbol({...b,cache:p.isSome(b)?b.webStyleCache:null}):d.clone();if(!(e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.length))return r.applyColorToSymbol(d,null,c),d;"arcadeRequiredForVisualVariables"in e&&e.arcadeRequiredForVisualVariables&&
(p.isNone(b)||p.isNone(b.arcade))&&(b={...p.unwrap(b)},b.arcade=yield B.loadArcade());var n=yield new Promise((l,q)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],l,q)),h=[],f=[],g=[],k=[];for(var m of e.visualVariables)switch(m.type){case "color":h.push(m);break;case "opacity":f.push(m);break;case "rotation":k.push(m);break;case "size":m.target||g.push(m)}m=(m=!!h.length&&h[h.length-1])?n.getColor(m,a,b):null;f=(f=!!f.length&&f[f.length-1])?n.getOpacity(f,a,b):null;null!=c&&(f=
null!=f?f*c:c);r.applyColorToSymbol(d,m,f);g.length&&(c=n.getAllSizes(g,a,b),yield r.applySizesToSymbol(d,c));for(const l of k)r.applyRotationToSymbol(d,n.getRotationAngle(l,a,b),l.axis);return d}}});return z.apply(this,arguments)}function A(){A=w._asyncToGenerator(function*(a,b){if(a){var c=y(a.layer||a.sourceLayer);if(p.isSome(a.symbol)&&(!p.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?yield a.symbol.fetchSymbol(b):a.symbol.clone(),r.getColorFromSymbol(a,c);var d=
p.isSome(b)&&b.renderer||a.get("layer.renderer")||a.get("sourceLayer.renderer"),e=yield d.getSymbolAsync(a,b);if(e){e="web-style"===e.type?yield e.fetchSymbol(b):e.clone();var n=r.getColorFromSymbol(e,c);if(!("visualVariables"in d)||"visualVariables"in d&&!d.visualVariables||"visualVariables"in d&&!d.visualVariables?.length)return n;d.arcadeRequiredForVisualVariables&&(p.isNone(b)||p.isNone(b.arcade))&&(b={...p.unwrap(b)},b.arcade=yield B.loadArcade());e=yield new Promise((g,k)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],
g,k));var h=[],f=[];for(const g of d.visualVariables)switch(g.type){case "color":h.push(g);break;case "opacity":f.push(g)}d=(d=0<h.length?h[h.length-1]:null)?e.getColor(d,a,b):n;a=(n=0<f.length?f[f.length-1]:null)?e.getOpacity(n,a,b):null;null!=c&&(a=null!=a?a*c:c);return d?r.applyOpacityToColor(d,a):null}}});return A.apply(this,arguments)}let v=null;const D=[255,255,255];t.getDisplayedColor=function(a,b){return A.apply(this,arguments)};t.getDisplayedSymbol=function(a,b){return z.apply(this,arguments)};
t.renderColorRampPreviewHTML=function(a,b={}){var c="horizontal"===b.align;const {width:d=c?75:24,height:e=c?24:75,gradient:n=!0}=b;var h=window.devicePixelRatio,f=d*h,g=e*h;h=document.createElement("canvas");h.width=f;h.height=g;h.style.width=`${d}px`;h.style.height=`${e}px`;const k=h.getContext("2d");var m=c?f:0,l=c?0:g;if(n){const q=k.createLinearGradient(0,0,m,l);c=a.length;const I=1===c?0:1/(c-1);a.forEach((J,K)=>q.addColorStop(K*I,J.toString()));k.fillStyle=q;k.fillRect(0,0,f,g)}else{f=c?f/
a.length:f;g=c?g:g/a.length;l=m=0;for(const q of a)k.fillStyle=q.toString(),k.fillRect(m,l,f,g),m=c?m+f:0,l=c?0:l+g}a=document.createElement("div");a.style.width=`${d}px`;a.style.height=`${e}px`;H(a,b?.effectList);a.appendChild(h);return a};t.renderDotDensityPreviewHTML=function(a,b,c){const {backgroundColor:d,outline:e,dotSize:n}=a;c=c&&c.swatchSize||F.SymbolSizeDefaults.size;const h=Math.round(c*c/n**2*.8),f=window.devicePixelRatio;a=document.createElement("canvas");const g=c*f;a.width=g;a.height=
g;a.style.width=`${a.width/f}px`;a.style.height=`${a.height/f}px`;const k=a.getContext("2d");d&&(k.fillStyle=d.toCss(!0),k.fillRect(0,0,g,g),k.fill());k.fillStyle=b.toCss(!0);if(v&&v.length/2===h)for(b=0;b<2*h;b+=2)k.fillRect(v[b],v[b+1],n*f,n*f),k.fill();else for(v=[],b=0;b<2*h;b+=2){const m=Math.floor(Math.random()*(g-0+1)),l=Math.floor(Math.random()*(g-0+1));v.push(m,l);k.fillRect(m,l,n*f,n*f);k.fill()}e&&(e.color&&(k.strokeStyle=e.color.toCss(!0)),k.lineWidth=e.width,k.strokeRect(0,0,g,g));c=
new Image(c,c);c.src=a.toDataURL();return c};t.renderPieChartPreviewHTML=function(a,b={}){const c=b.radius||40;var d=2*Math.PI*c,e=a.length;const n=d/e,h=[],f=E.getStroke(b.outline);null!=f?.width&&(f.width*=2);(f||b.backgroundColor)&&h.push({shape:{type:"circle",cx:c,cy:c,r:c},fill:b.backgroundColor,stroke:f,offset:[0,0]});const g=b.values,k=g&&g.length===e&&100===g.reduce((l,q)=>l+q,0),m=[0];for(let l=0;l<e;l++){let q=null;k&&(q=g[l]*d/100,m.push(q+m[l]));h.push({shape:{type:"circle",cx:c,cy:c,
r:c/2},fill:[0,0,0,0],stroke:{width:c,dashArray:`${(q??n)/2} ${d}`,dashoffset:`-${k?m[l]/2:n/2*l}`,color:a[l]},offset:[0,0]})}e=null;a=2*c+(f?.width||0);if(d=b.holePercentage)f&&h.push({shape:{type:"circle",cx:c,cy:c,r:c*d},fill:null,stroke:f,offset:[0,0]}),e=a/2,e=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:D,stroke:f?{...f,color:D}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:c*d},fill:[0,0,0],stroke:null,offset:[0,0]}]];return G.renderSymbol([h],[a,a],{effectView:b.effectList,ignoreStrokeWidth:!0,
masking:e,rotation:-90})};t.renderPreviewHTML=C;Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});