// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/screenUtils ../cim/CIMSymbolHelper ../cim/CIMSymbolRasterizer ../cim/utils ./previewUtils ./renderUtils".split(" "),function(v,B,g,k,l,C,m,D){function n(){n=B._asyncToGenerator(function*(b,f={}){const {node:w,opacity:x,symbolConfig:p}=f;var d="object"===typeof p&&"isSquareFill"in p?p.isSquareFill:!1,e=f.cimOptions||f,c=e.geometryType||C.mapCIMSymbolToGeometryType(b?.data?.symbol);var a=f?.size;a="number"===typeof a?{width:a,height:a}:
{width:null!=a&&"object"===typeof a&&"width"in a?a.width:null,height:null!=a&&"object"===typeof a&&"height"in a?a.height:null};const {feature:y,fieldMap:z}=e;if(null==a.width||null==a.height){e=yield k.OverrideHelper.resolveSymbolOverrides(b.data,y,null,z,c);if(!e)return null;b=b.clone();b.data={type:"CIMSymbolReference",symbol:e};b.data.primitiveOverrides=null;const q=[];k.CIMSymbolHelper.fetchResources(e,r.resourceManager,q);0<q.length&&(yield Promise.all(q));const {width:t,height:u}=k.CIMSymbolHelper.getEnvelope(e,
null,r.resourceManager);a.width="esriGeometryPolygon"===c?h:"esriGeometryPolyline"===c?E:null!=t&&isFinite(t)?Math.min(t,A):h;a.height="esriGeometryPolygon"===c?h:null!=u&&isFinite(u)?Math.max(Math.min(u,A),1):h}d=yield r.rasterizeCIMSymbolAsync(b,y,a,d||"esriGeometryPolygon"!==c?l.GeometryStyle.Preview:l.GeometryStyle.Legend,z,c);if(!d)return null;const {width:F,height:G}=d;b=document.createElement("canvas");b.width=F;b.height=G;b.getContext("2d").putImageData(d,0,0);d=g.pt2px(a.width);a=g.pt2px(a.height);
c=new Image(d,a);c.src=b.toDataURL();null!=x&&(c.style.opacity=`${x}`);b=c;null!=f.effectView&&(b=D.renderSymbol([[{shape:{type:"image",x:0,y:0,width:d,height:a,src:c.src},fill:null,stroke:null,offset:[0,0]}]],[d,a],{effectView:f.effectView}));w&&b&&w.appendChild(b);return b});return n.apply(this,arguments)}const r=new l.CIMSymbolRasterizer(null,!0),h=g.px2pt(m.SymbolSizeDefaults.size),A=g.px2pt(m.SymbolSizeDefaults.maxSize),E=g.px2pt(m.SymbolSizeDefaults.lineWidth);v.previewCIMSymbol=function(b){return n.apply(this,
arguments)};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});