// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require exports ../chunks/_rollupPluginBabelHelpers ../geometry ../core/Error ../core/Logger ../core/maybe ../geometry/SpatialReference".split(" "),function(B,k,y,t,C,D,E,F){function z(){u||(u=y._asyncToGenerator(function*(){const c=yield new Promise((b,a)=>B(["./arcadeUtils"],b,a));return{arcade:c.arcade,arcadeUtils:c,Dictionary:c.Dictionary,Feature:c.arcadeFeature}})());return u}const G=D.getLogger("esri.support.arcadeOnDemand");let u;t=(c,b,a)=>n.create(c,b,a,null,["$feature","$view"]);
let n=function(){function c(a,h,d,p,l,m,f,e){this.script=a;this.evaluate=l;this.fields=Array.isArray(f)?f:f.fields;this._syntaxTree=p;this._arcade=h;this._arcadeDictionary=d;this._arcadeFeature=m;this._spatialReference=e;this._referencesGeometry=h.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}c.create=function(){var a=y._asyncToGenerator(function*(h,d,p,l,m,f){const {arcade:e,Feature:H,Dictionary:v}=yield z(),w=F.fromJSON(d);
d=null;try{d=e.parseScript(h,f)}catch(g){return G.error(new C("arcade-bad-expression","Failed to parse arcade script",{script:h,error:g})),null}f=m.reduce((g,I)=>({...g,[I]:null}),{});let q=null;E.isSome(l)&&(q=new v(l),q.immutable=!0,f.$config=null);var x=(l=e.scriptUsesGeometryEngine(d))&&e.enableGeometrySupport();const J=e.scriptUsesFeatureSet(d)&&e.enableFeatureSetSupport(),A=(m=e.scriptIsAsync(d))&&e.enableAsyncSupport();f={vars:f,spatialReference:w,useAsync:!!A};yield Promise.all([x,J,A]);x=
new Set;yield e.loadDependentModules(x,d,null,m,l);const r=new v;r.immutable=!1;r.setField("scale",0);const K=e.compileScript(d,f);return new c(h,e,v,d,g=>{"$view"in g&&g.$view&&(r.setField("scale",g.$view.scale),g.$view=r);q&&(g.$config=q);return K({vars:g,spatialReference:w})},new H,p,w)});return function(h,d,p,l,m,f){return a.apply(this,arguments)}}();var b=c.prototype;b.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);
this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this.fields});return this._arcadeFeature};b.createDictionary=function(){return new this._arcadeDictionary};b.referencesMember=function(a){return this._arcade.referencesMember(this._syntaxTree,a)};b.referencesFunction=function(a){return this._arcade.referencesFunction(this._syntaxTree,a)};b.referencesGeometry=function(){return this._referencesGeometry};b.referencesScale=function(){return this._referencesScale};b.extractFieldLiterals=
function(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)};return c}();k.ArcadeExpression=n;k.createDictionaryExpression=(c,b,a,h)=>n.create(c,b,a,h,["$feature","$view"]);k.createLabelExpression=(c,b,a)=>n.create(c,b,a,null,["$feature"]);k.createRendererExpression=t;k.createVVExpression=t;k.loadArcade=z;Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});