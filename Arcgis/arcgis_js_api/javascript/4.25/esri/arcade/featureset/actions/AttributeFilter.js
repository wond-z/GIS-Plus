// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../support/errorsupport ../support/FeatureSet ../support/IdSet ../support/shared ../support/sqlUtils ../../../core/promiseUtils ../../../core/sql/WhereClause ../../../geometry/SpatialReference".split(" "),function(k,t,u,p,l,r,x,v,y){return function(w){function n(c){var a=w.call(this,c)||this;a.declaredClass="esri.arcade.featureset.actions.AttributeFilter";a._maxProcessing=1E3;a._parent=c.parentfeatureset;c.whereclause instanceof v.WhereClause?(a._whereclause=
c.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=c.whereclause,a._whereclause=null);return a}k._inheritsLoose(n,w);var g=n.prototype;g._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=
this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.globalIdField=this.objectIdField=this.typeIdField="",this.spatialReference=new y({wkid:4326}),this.geometryType=l.layerGeometryEsriConstants.point)};g._getSet=function(){var c=k._asyncToGenerator(function*(a){if(null===this._wset){yield this._ensureLoaded();const b=yield this._parent._getFilteredSet("",null,this._whereclause,null,a);this._checkCancelled(a);this._wset=null!==this._whereClauseFunction?new p(b._candidates.slice(0).concat(b._known.slice(0)),
[],b._ordered,this._clonePageDefinition(b.pagesDefinition)):new p(b._candidates.slice(0),b._known.slice(0),b._ordered,this._clonePageDefinition(b.pagesDefinition))}return this._wset});return function(a){return c.apply(this,arguments)}}();g._isInFeatureSet=function(c){let a=this._parent?._isInFeatureSet(c);if(a===l.IdState.NotInFeatureSet)return a;a=this._idstates[c];return void 0===a?l.IdState.Unknown:a};g._getFeature=function(c,a,b){return this._parent._getFeature(c,a,b)};g._getFeatures=function(c,
a,b,e){return this._parent._getFeatures(c,a,b,e)};g._featureFromCache=function(c){return this._parent._featureFromCache(c)};g.executeWhereClause=function(c){return this._whereclause?.testFeature(c)??!1};g.executeWhereClauseDeferred=function(){var c=k._asyncToGenerator(function*(a){return null!==this._whereClauseFunction?(a=this._whereClauseFunction(a),x.isPromiseLike(a),a):this.executeWhereClause(a)});return function(a){return c.apply(this,arguments)}}();g._fetchAndRefineFeatures=function(){var c=
k._asyncToGenerator(function*(a,b,e){var f=new p([],a,!1,null),d=Math.min(b,a.length);yield this._parent?._getFeatures(f,-1,d,e);this._checkCancelled(e);if(null==this._whereClauseFunction){for(b=0;b<d;b++)e=this._parent?._featureFromCache(a[b]),!0===this.executeWhereClause(e)?this._idstates[a[b]]=l.IdState.InFeatureSet:this._idstates[a[b]]=l.IdState.NotInFeatureSet;return"success"}e=[];for(f=0;f<d;f++){const h=this._parent?._featureFromCache(a[f]);e.push(yield this.executeWhereClauseDeferred(h))}for(d=
0;d<b;d++)this._idstates[a[d]]=!0===e[d]?l.IdState.InFeatureSet:l.IdState.NotInFeatureSet;return"success"});return function(a,b,e){return c.apply(this,arguments)}}();g._getFilteredSet=function(){var c=k._asyncToGenerator(function*(a,b,e,f,d){null===this._whereClauseFunction&&(null!==e?null!==this._whereclause&&(e=r.combine(this._whereclause,e)):e=this._whereclause);yield this._ensureLoaded();a=yield this._parent._getFilteredSet(a,b,e,f,d);this._checkCancelled(d);return null!==this._whereClauseFunction?
new p(a._candidates.slice(0).concat(a._known.slice(0)),[],a._ordered,this._clonePageDefinition(a.pagesDefinition)):new p(a._candidates.slice(0),a._known.slice(0),a._ordered,this._clonePageDefinition(a.pagesDefinition))});return function(a,b,e,f,d){return c.apply(this,arguments)}}();g._stat=function(){var c=k._asyncToGenerator(function*(a,b,e,f,d,h,m){if(null!==this._whereClauseFunction)return null===d&&""===e&&null===f?this._manualStat(a,b,h,m):{calculated:!1};var q=this._whereclause;null!==d&&null!==
this._whereclause&&(q=r.combine(this._whereclause,d));q=yield this._parent._stat(a,b,e,f,q,h,m);return!1===q.calculated?null===d&&""===e&&null===f?this._manualStat(a,b,h,m):{calculated:!1}:q});return function(a,b,e,f,d,h,m){return c.apply(this,arguments)}}();g._canDoAggregates=function(){var c=k._asyncToGenerator(function*(a,b,e,f,d){if(null!==this._whereClauseFunction)return!1;null!==d?null!==this._whereclause&&(d=r.combine(this._whereclause,d)):d=this._whereclause;return null===this._parent?!1:
this._parent._canDoAggregates(a,b,e,f,d)});return function(a,b,e,f,d){return c.apply(this,arguments)}}();g._getAggregatePagesDataSourceDefinition=function(){var c=k._asyncToGenerator(function*(a,b,e,f,d,h,m){if(null===this._parent)throw new t.FeatureSetError(t.FeatureSetErrorCodes.NeverReach);null!==d?null!==this._whereclause&&(d=r.combine(this._whereclause,d)):d=this._whereclause;return this._parent._getAggregatePagesDataSourceDefinition(a,b,e,f,d,h,m)});return function(a,b,e,f,d,h,m){return c.apply(this,
arguments)}}();n.registerAction=function(){u._featuresetFunctions.filter=function(c){if("function"===typeof c)return new n({parentfeatureset:this,whereclause:c});let a=null;c instanceof v.WhereClause&&(a=c);return new n({parentfeatureset:this,whereclause:a})}};return n}(u)});