// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../support/errorsupport ../support/FeatureSet ../support/IdSet ../support/shared ../support/sqlUtils ../../../geometry/Geometry ../../../layers/FeatureLayer ../../../layers/support/FeatureType ../../../layers/support/Field ../../../rest/support/Query".split(" "),function(k,z,w,A,r,u,B,C,D,E,x,v){return function(y){function p(a){var b=y.call(this,a)||this;b.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory";b._removeGeometry=
!1;b._overrideFields=null;b._forceIsTable=!1;a.spatialReference&&(b.spatialReference=a.spatialReference);b._transparent=!0;b._maxProcessing=1E3;b._layer=a.layer;b._wset=null;!0===a.isTable&&(b._forceIsTable=!0);void 0!==a.outFields&&(b._overrideFields=a.outFields);void 0!==a.includeGeometry&&(b._removeGeometry=!1===a.includeGeometry);return b}k._inheritsLoose(p,y);var e=p.prototype;e._maxQueryRate=function(){return u.defaultMaxRecords};e.end=function(){return this._layer};e.optimisePagingFeatureQueries=
function(){};e.loadImpl=function(){var a=k._asyncToGenerator(function*(){if(!0===this._layer.loaded)return this._initialiseFeatureSet(),this;yield this._layer.load();this._initialiseFeatureSet();return this});return function(){return a.apply(this,arguments)}}();e._initialiseFeatureSet=function(){null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference);this.geometryType=this._layer.geometryType;this.fields=this._layer.fields.slice(0);if(this._layer.outFields&&(1!==this._layer.outFields.length||
"*"!==this._layer.outFields[0])){var a=[];for(var b of this.fields)if("oid"===b.type)a.push(b);else for(const c of this._layer.outFields)if(c.toLowerCase()===b.name.toLowerCase()){a.push(b);break}this.fields=a}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{a=[];b=[];for(const c of this.fields)if("oid"===c.type)a.push(c),b.push(c.name);else for(const f of this._overrideFields)if(f.toLowerCase()===c.name.toLowerCase()){a.push(c);
b.push(c.name);break}this.fields=a;this._overrideFields=b}this.objectIdField=this._layer.objectIdField;for(const c of this.fields)"global-id"===c.type&&(this.globalIdField=c.name);this.hasM=this._layer.supportsM;this.hasZ=this._layer.supportsZ;this._databaseType=u.FeatureServiceDatabaseType.Standardised;this.typeIdField=this._layer.typeIdField;this.types=this._layer.types};e.isTable=function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType};e._isInFeatureSet=
function(){return u.IdState.InFeatureSet};e._candidateIdTransform=function(a){return a};e._getSet=function(){var a=k._asyncToGenerator(function*(b){return null===this._wset?(yield this._ensureLoaded(),this._wset=b=yield this._getFilteredSet("",null,null,null,b)):this._wset});return function(b){return a.apply(this,arguments)}}();e._changeFeature=function(a){const b={};for(const c of this.fields)b[c.name]=a.attributes[c.name];return new z({geometry:!0===this._removeGeometry?null:a.geometry,attributes:b})};
e._getFilteredSet=function(){var a=k._asyncToGenerator(function*(b,c,f,d,g){let q="",t=!1;null!==d&&(q=d.constructClause(),t=!0);if(this.isTable()&&c&&null!==b&&""!==b)return new r([],[],!0,null);d=new v;d.where=null===f?null===c?"1\x3d1":"":B.toWhereClause(f,u.FeatureServiceDatabaseType.Standardised);d.spatialRelationship=this._makeRelationshipEnum(b);d.outSpatialReference=this.spatialReference;d.orderByFields=""!==q?q.split(","):null;d.geometry=null===c?null:c;d.returnGeometry=!0;d.relationParameter=
this._makeRelationshipParam(b);b=yield this._layer.queryFeatures(d);if(null===b)return new r([],[],t,null);this._checkCancelled(g);const n=[];b.features.forEach(h=>{const l=h.attributes[this._layer.objectIdField];n.push(l);this._featureCache[l]=this._changeFeature(h)});return new r([],n,t,null)});return function(b,c,f,d,g){return a.apply(this,arguments)}}();e._makeRelationshipEnum=function(a){if(a.includes("esriSpatialRelRelation"))return"relation";switch(a){case "esriSpatialRelRelation":return"relation";
case "esriSpatialRelIntersects":return"intersects";case "esriSpatialRelContains":return"contains";case "esriSpatialRelOverlaps":return"overlaps";case "esriSpatialRelWithin":return"within";case "esriSpatialRelTouches":return"touches";case "esriSpatialRelCrosses":return"crosses";case "esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return a};e._makeRelationshipParam=function(a){return a.includes("esriSpatialRelRelation")?a.split(":")[1]:""};e._queryAllFeatures=function(){var a=k._asyncToGenerator(function*(){if(this._wset)return this._wset;
const b=new v;b.where="1\x3d1";yield this._ensureLoaded();if(this._layer.source&&this._layer.source.items){const f=[];this._layer.source.items.forEach(d=>{const g=d.attributes[this._layer.objectIdField];f.push(g);this._featureCache[g]=this._changeFeature(d)});return this._wset=new r([],f,!1,null)}const c=[];(yield this._layer.queryFeatures(b)).features.forEach(f=>{const d=f.attributes[this._layer.objectIdField];c.push(d);this._featureCache[d]=this._changeFeature(f)});return this._wset=new r([],c,
!1,null)});return function(){return a.apply(this,arguments)}}();e._getFeatures=function(){var a=k._asyncToGenerator(function*(b,c,f){const d=[];-1!==c&&void 0===this._featureCache[c]&&d.push(c);for(let g=b._lastFetchedIndex;g<b._known.length&&!(b._lastFetchedIndex+=1,void 0===this._featureCache[b._known[g]]&&(b._known[g]!==c&&d.push(b._known[g]),d.length>f));g++);if(0===d.length)return"success";throw new w.FeatureSetError(w.FeatureSetErrorCodes.MissingFeatures);});return function(b,c,f){return a.apply(this,
arguments)}}();e._refineSetBlock=function(){var a=k._asyncToGenerator(function*(b){return b});return function(b){return a.apply(this,arguments)}}();e._stat=function(){var a=k._asyncToGenerator(function*(){return{calculated:!1}});return function(){return a.apply(this,arguments)}}();e._canDoAggregates=function(){var a=k._asyncToGenerator(function*(){return!1});return function(){return a.apply(this,arguments)}}();e.relationshipMetaData=function(){return[]};p._cloneAttr=function(a){const b={};for(const c in a)b[c]=
a[c];return b};e.nativeCapabilities=function(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}};p.create=function(a,b){var c=a.layerDefinition.objectIdField,f=a.layerDefinition.typeIdField?a.layerDefinition.typeIdField:"";const d=[];if(a.layerDefinition.types)for(var g of a.layerDefinition.types)d.push(E.fromJSON(g));let q=a.layerDefinition.geometryType;void 0===q&&(q=a.featureSet.geometryType||
"");g=a.featureSet.features;const t=b.toJSON();if(""===c||void 0===c){var n=!1;for(var h of a.layerDefinition.fields)if("oid"===h.type||"esriFieldTypeOID"===h.type){c=h.name;n=!0;break}if(!1===n){c="FID";h=!0;for(n=0;h;){let m=!0;for(var l of a.layerDefinition.fields)if(l.name===c){m=!1;break}!0===m?h=!1:(n++,c="FID"+n.toString())}a.layerDefinition.fields.push({type:"esriFieldTypeOID",name:c,alias:c});l=[];for(h=0;h<g.length;h++)l.push({geometry:a.featureSet.features[h].geometry,attributes:a.featureSet.features[h].attributes?
this._cloneAttr(a.featureSet.features[h].attributes):{}}),l[h].attributes[c]=h;g=l}}l=[];for(const m of a.layerDefinition.fields)m instanceof x?l.push(m):l.push(x.fromJSON(m));a=q;switch(a){case "esriGeometryPoint":a="point";break;case "esriGeometryPolyline":a="polyline";break;case "esriGeometryPolygon":a="polygon";break;case "esriGeometryExtent":a="extent";break;case "esriGeometryMultipoint":a="multipoint"}for(const m of g)m.geometry&&!1===m.geometry instanceof C&&(m.geometry.type=a,void 0===m.geometry.spatialReference&&
(m.geometry.spatialReference=t));f={outFields:["*"],source:g,fields:l,types:d,typeIdField:f,objectIdField:c,spatialReference:b};f.geometryType=a?a:"point";f=new D(f);return new p({layer:f,spatialReference:b,isTable:null===a||""===a})};e.queryAttachments=function(){var a=k._asyncToGenerator(function*(){return[]});return function(){return a.apply(this,arguments)}}();e.getFeatureByObjectId=function(){var a=k._asyncToGenerator(function*(b){const c=new v;c.where=this.objectIdField+"\x3d"+b.toString();
b=yield this._layer.queryFeatures(c);return 1===b.features.length?b.features[0]:null});return function(b){return a.apply(this,arguments)}}();e.getOwningSystemUrl=function(){var a=k._asyncToGenerator(function*(){return""});return function(){return a.apply(this,arguments)}}();e.getIdentityUser=function(){var a=k._asyncToGenerator(function*(){return""});return function(){return a.apply(this,arguments)}}();k._createClass(p,[{key:"gdbVersion",get:function(){return""}}]);return p}(A)});