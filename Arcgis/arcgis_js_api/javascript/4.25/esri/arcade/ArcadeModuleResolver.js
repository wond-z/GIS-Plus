// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../request ../portal/Portal ./parser ./featureset/support/RecentlyUsedCache ./executionError".split(" "),function(r,n,w,t,u,x,g){let k=function(){function b(a){this.portalUri=a}var p=b.prototype;p.normalizeModuleUri=function(a){const d=/^[a-z0-9A-Z]+(@[0-9]+\.[0-9]+\.[0-9]+)?([\?|\/].*)?$/gi;var e=/(?<portalurl>.+)\/home\/item\.html\?id=(?<itemid>.+)$/gi;const l=/(?<portalurl>.+)\/sharing\/rest\/content\/users\/[a-zA-Z0-9]+\/items\/(?<itemid>.+)$/gi,
q=/(?<portalurl>.+)\/sharing\/rest\/content\/items\/(?<itemid>.+)$/gi;var m=/(?<itemid>.*)@(?<versionstring>[0-9]+\.[0-9]+\.[0-9]+)([\?|\/].*)?$/gi;if(a.startsWith("portal+")){let f=a.substring(7);var h="",c=f;let v=!1;for(const y of[e,q,l])if(e=y.exec(f),null!==e){h=e.groups;c=h.itemid;h=h.portalurl;v=!0;break}if(!1===v)if(d.test(f))c=f,h=this.portalUri;else throw new g.ModuleError(g.ModuleErrorCodes.UnsupportedUriProtocol,{uri:a});c.includes("/")&&(c=c.split("/")[0]);c.includes("?")&&(c=c.split("?")[0]);
a="current";m=m.exec(c);null!==m&&(a=m.groups,c=a.itemid,a=a.versionstring);f=(new t({url:h})).restUrl+"/content/items/"+c+"/resources/"+a+".arc";return{url:f,scheme:"portal",uri:"PO:"+f}}if(a.startsWith("mock")){if("mock"===a)return{url:"",scheme:"mock",data:'\n      export var hello \x3d 1;\n      export function helloWorld() {\n          return "Hello World " + hello;\n      }\n  ',uri:"mock"};c=a.replace("mock:","");if(void 0!==b.mocks[c])return{url:"",scheme:"mock",data:b.mocks[c],uri:a}}throw new g.ModuleError(g.ModuleErrorCodes.UnrecognisedUri,
{uri:a});};p.fetchModule=function(){var a=n._asyncToGenerator(function*(d){var e=b.cachedModules.getFromCache(d.uri);if(e)return e;e=this.fetchSource(d);b.cachedModules.addToCache(d.uri,e);let l=null;try{l=yield e}catch(q){throw b.cachedModules.removeFromCache(d.uri),q;}return l});return function(d){return a.apply(this,arguments)}}();p.fetchSource=function(){var a=n._asyncToGenerator(function*(d){if("portal"===d.scheme){const e=yield w(d.url,{responseType:"text",query:{}});if(e.data)return u.parseScript(e.data,
[])}if("mock"===d.scheme)return u.parseScript(d.data??"",[]);throw new g.ModuleError(g.ModuleErrorCodes.UnsupportedUriProtocol);});return function(d){return a.apply(this,arguments)}}();b.create=function(a){return new b(a)};b.getDefault=function(){return this._default??(b._default=b._moduleResolverFactory())};n._createClass(b,null,[{key:"moduleResolverClass",set:function(a){this._moduleResolverFactory=a;this._default=null}}]);return b}();k.mocks={};k.cachedModules=new x(30);k._default=null;k._moduleResolverFactory=
()=>{const b=t.getDefault();return new k(b.url)};r.ArcadeModuleResolver=k;Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});