// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../kernel ../request ./featureSetCollection ./featureset/actions/AttributeFilter ./featureset/actions/GroupBy ./featureset/actions/OrderBy ./featureset/actions/SpatialFilter ./featureset/actions/Top ./featureset/sources/FeatureLayerDynamic ./featureset/sources/FeatureLayerMemory ./featureset/sources/FeatureLayerRelated ./featureset/support/cache ./featureset/support/errorsupport ./featureset/support/FeatureSet ./featureset/support/shared ../core/sql/WhereClause ../layers/FeatureLayer ../portal/Portal ../portal/PortalItem".split(" "),
function(q,n,L,u,G,M,N,O,P,Q,R,S,T,m,H,U,I,V,r,W,X){function v(a,d){return w.apply(this,arguments)}function w(){w=n._asyncToGenerator(function*(a,d){if(m.applicationCache){var g=m.applicationCache.getLayerInfo(a);if(g)return g=yield g,new r({url:a,outFields:d,sourceJSON:g});const h=new r({url:a,outFields:d});d=n._asyncToGenerator(function*(){yield h.load();return h.sourceJSON})();if(m.applicationCache){m.applicationCache.setLayerInfo(a,d);try{return yield d,h}catch(b){throw m.applicationCache.clearLayerInfo(a),
b;}}yield d;return h}return new r({url:a,outFields:d})});return w.apply(this,arguments)}function x(a,d,g,h,b){return y.apply(this,arguments)}function y(){y=n._asyncToGenerator(function*(a,d,g,h,b,k=null){a=yield v(a,["*"]);return t(a,d,g,h,b,k)});return y.apply(this,arguments)}function t(a,d=null,g=null,h=!0,b=null,k=null){d={layer:a,spatialReference:d,outFields:g,includeGeometry:h,lrucache:b,interceptor:k};return!0===a._hasMemorySource()?new S(d):new R(d)}function Y(a){return z.apply(this,arguments)}
function z(){z=n._asyncToGenerator(function*(a){if(null!==m.applicationCache){var d=m.applicationCache.getLayerInfo(a);if(null!==d)return d}d=n._asyncToGenerator(function*(){const g=yield u(a,{responseType:"json",query:{f:"json"}});return g.data?g.data:null})();if(null!==m.applicationCache){m.applicationCache.setLayerInfo(a,d);try{return yield d}catch(g){throw m.applicationCache.clearLayerInfo(a),g;}}return d});return z.apply(this,arguments)}function Z(a,d){return A.apply(this,arguments)}function A(){A=
n._asyncToGenerator(function*(a,d){const g="QUERYDATAELEMTS:"+d.toString()+":"+a;if(null!==m.applicationCache){var h=m.applicationCache.getLayerInfo(g);if(null!==h)return h}h=n._asyncToGenerator(function*(){var b=yield u(a+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([d.toString()]),f:"json"}});if(b.data&&(b=b.data,b.layerDataElements&&b.layerDataElements[0]))return b.layerDataElements[0];throw new H.FeatureSetError(H.FeatureSetErrorCodes.DataElementsNotFound);
})();if(null!==m.applicationCache){m.applicationCache.setLayerInfo(g,h);try{return yield h}catch(b){throw m.applicationCache.clearLayerInfo(g),b;}}return h});return A.apply(this,arguments)}function J(a){return B.apply(this,arguments)}function B(){B=n._asyncToGenerator(function*(a){if(null!==m.applicationCache){var d=m.applicationCache.getLayerInfo(a);if(null!==d)return d}d=n._asyncToGenerator(function*(){var g=yield u(a,{responseType:"json",query:{f:"json"}});return g.data?(g=g.data,g.layers||(g.layers=
[]),g.tables||(g.tables=[]),g):{layers:[],tables:[]}})();if(null!==m.applicationCache){m.applicationCache.setLayerInfo(a,d);try{return yield d}catch(g){throw m.applicationCache.clearLayerInfo(a),g;}}return d});return B.apply(this,arguments)}function C(){C=n._asyncToGenerator(function*(a,d){var g=3,h=[],b=null,k={},c=null;c=yield J(a);if(c.controllerDatasetLayers&&void 0!==c.controllerDatasetLayers.utilityNetworkLayerId&&null!==c.controllerDatasetLayers.utilityNetworkLayerId){if(c.layers)for(var f of c.layers)k[f.id]=
f.name;if(c.tables)for(var e of c.tables)k[e.id]=e.name;f=c.controllerDatasetLayers.utilityNetworkLayerId;if(c=yield Z(a,f)){(b=c)&&b.dataElement&&void 0!==b.dataElement.schemaGeneration&&(g=b.dataElement.schemaGeneration);c={};b.dataElement.domainNetworks||(b.dataElement.domainNetworks=[]);for(var l of b.dataElement.domainNetworks){for(const p of l.edgeSources?l.edgeSources:[])e={layerId:p.layerId,sourceId:p.sourceId,className:k[p.layerId]?k[p.layerId]:null},e.className&&(c[e.className]=e);for(const p of l.junctionSources?
l.junctionSources:[])e={layerId:p.layerId,sourceId:p.sourceId,className:k[p.layerId]?k[p.layerId]:null},e.className&&(c[e.className]=e)}if(b.dataElement.terminalConfigurations)for(const p of b.dataElement.terminalConfigurations)for(const K of p.terminals)h.push({terminalId:K.terminalId,terminalName:K.terminalName});k=yield Y(a+"/"+f);if(k.systemLayers&&void 0!==k.systemLayers.associationsTableId&&null!==k.systemLayers.associationsTableId)return l=[],4<=g&&(l.push("STATUS"),l.push("PERCENTALONG")),
a=yield x(a+"/"+k.systemLayers.associationsTableId.toString(),d,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...l],!1,null,null),yield a.load(),4<=g&&(a=a.filter(V.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",
a.getFieldsIndex())),yield a.load()),{lkp:c,associations:a,unVersion:g,terminals:h}}}return{associations:null,unVersion:g,lkp:null,terminals:[]}});return C.apply(this,arguments)}function D(){D=n._asyncToGenerator(function*(a,d,g,h=null,b=null,k=!0,c=null,f=null){var e=a.serviceUrl();if(!e)return null;e="/"===e.charAt(e.length-1)?e+d.relatedTableId.toString():e+"/"+d.relatedTableId.toString();e=yield x(e,h,b,k,c,f);return new T({layer:a,relatedLayer:e,relationship:d,objectId:g,spatialReference:h,outFields:b,
includeGeometry:k,lrucache:c,interceptor:f})});return D.apply(this,arguments)}function E(){E=n._asyncToGenerator(function*(a,d,g){if(!L.id.findCredential(a.restUrl))return null;if("loaded"===a.loadStatus&&""===d&&a.user&&a.user.sourceJSON&&!1===g)return a.user.sourceJSON;if(""===d)return a=yield u(a.restUrl+"/community/self",{responseType:"json",query:{f:"json",...(!1===g?{}:{returnUserLicenseTypeExtensions:!0})}}),a.data&&(a=a.data)&&a.username?a:null;a=yield u(a.restUrl+"/community/users/"+d,{responseType:"json",
query:{f:"json"}});return a.data?(a=a.data,a.error?null:a):null});return E.apply(this,arguments)}function F(){F=n._asyncToGenerator(function*(a,d,g,h,b,k,c,f=null){if(m.applicationCache){var e=m.applicationCache.getLayerInfo(a+":"+k.url);if(e)return a=yield e,d=new r({url:I.extractServiceUrl(a.url)+"/"+d,outFields:["*"]}),t(d,g,h,b,c,f)}e=(new X({id:a,portal:k})).load();m.applicationCache&&m.applicationCache.setLayerInfo(a+":"+k.url,e);try{const l=yield e,p=new r({url:I.extractServiceUrl(l.url??"")+
"/"+d,outFields:["*"]});return t(p,g,h,b,c,f)}catch(l){throw m.applicationCache&&m.applicationCache.clearLayerInfo(a+":"+k.url),l;}});return F.apply(this,arguments)}M.registerAction();N.registerAction();O.registerAction();P.registerAction();Q.registerAction();let aa=function(a){function d(h,b=null,k=null,c=null){var f=a.call(this)||this;f._map=h;f._overridespref=b;f._lrucache=k;f._interceptor=c;f._instantLayers=[];return f}n._inheritsLoose(d,a);var g=d.prototype;g._makeAndAddFeatureSet=function(h,
b=!0,k=null){const c=t(h,this._overridespref,null===k?["*"]:k,b,this._lrucache,this._interceptor);this._instantLayers.push({featureset:c,opitem:h,includeGeometry:b,outFields:JSON.stringify(k)});return c};g.featureSetByName=function(){var h=n._asyncToGenerator(function*(b,k=!0,c=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return yield this._map.load(),this.featureSetByName(b,k,c);null===c&&(c=["*"]);c=c.slice(0);c=c.sort();var f=JSON.stringify(c);for(let e=0;e<
this._instantLayers.length;e++){const l=this._instantLayers[e];if(l.opitem.title===b&&l.includeGeometry===k&&l.outFields===f)return this._instantLayers[e].featureset}if(f=this._map.allLayers.find(e=>e instanceof r&&e.title===b?!0:!1))return this._makeAndAddFeatureSet(f,k,c);if(this._map.tables&&(f=this._map.tables.find(e=>e.title&&e.title===b||e.title&&e.title===b?!0:!1))){if(f instanceof r)return this._makeAndAddFeatureSet(f,k,c);f._materializedTable||(f._materializedTable=new r(f.outFields?f:{...f,
outFields:["*"]}));yield f._materializedTable.load();return this._makeAndAddFeatureSet(f._materializedTable,k,c)}return null});return function(b){return h.apply(this,arguments)}}();g.featureSetById=function(){var h=n._asyncToGenerator(function*(b,k=!0,c=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return yield this._map.load(),this.featureSetById(b,k,c);null===c&&(c=["*"]);c=c.slice(0);c=c.sort();var f=JSON.stringify(c);for(let e=0;e<this._instantLayers.length;e++){const l=
this._instantLayers[e];if(l.opitem.id===b&&l.includeGeometry===k&&l.outFields===f)return this._instantLayers[e].featureset}if(f=this._map.allLayers.find(e=>e instanceof r&&e.id===b?!0:!1))return this._makeAndAddFeatureSet(f,k,c);if(this._map.tables&&(f=this._map.tables.find(e=>e.id===b?!0:!1))){if(f instanceof r)return this._makeAndAddFeatureSet(f,k,c);f._materializedTable||(f._materializedTable=new r({...f,outFields:["*"]}));yield f._materializedTable.load();return this._makeAndAddFeatureSet(f._materializedTable,
k,c)}return null});return function(b){return h.apply(this,arguments)}}();return d}(G),ba=function(a){function d(h,b=null,k=null,c=null){var f=a.call(this)||this;f._url=h;f._overridespref=b;f._lrucache=k;f._interceptor=c;f.metadata=null;f._instantLayers=[];return f}n._inheritsLoose(d,a);var g=d.prototype;g._makeAndAddFeatureSet=function(h,b=!0,k=null){const c=t(h,this._overridespref,null===k?["*"]:k,b,this._lrucache);this._instantLayers.push({featureset:c,opitem:h,includeGeometry:b,outFields:JSON.stringify(k)});
return c};g._loadMetaData=function(){var h=n._asyncToGenerator(function*(){const b=yield J(this._url);return this.metadata=b});return function(){return h.apply(this,arguments)}}();g.load=function(){return this._loadMetaData()};g.clone=function(){return new d(this._url,this._overridespref,this._lrucache,this._interceptor)};g.featureSetByName=function(){var h=n._asyncToGenerator(function*(b,k=!0,c=null){null===c&&(c=["*"]);c=c.slice(0);c=c.sort();var f=JSON.stringify(c);for(var e=0;e<this._instantLayers.length;e++){const l=
this._instantLayers[e];if(l.opitem.title===b&&l.includeGeometry===k&&l.outFields===f)return this._instantLayers[e].featureset}f=yield this._loadMetaData();e=null;for(const l of f.layers?f.layers:[])l.name===b&&(e=l);if(!e)for(const l of f.tables?f.tables:[])l.name===b&&(e=l);return e?(b=yield v(this._url+"/"+e.id,["*"]),this._makeAndAddFeatureSet(b,k,c)):null});return function(b){return h.apply(this,arguments)}}();g.featureSetById=function(){var h=n._asyncToGenerator(function*(b,k=!0,c=["*"]){null===
c&&(c=["*"]);c=c.slice(0);c=c.sort();var f=JSON.stringify(c);b=null!==b&&void 0!==b?b.toString():"";for(var e=0;e<this._instantLayers.length;e++){const l=this._instantLayers[e];if(l.opitem.id===b&&l.includeGeometry===k&&l.outFields===f)return this._instantLayers[e].featureset}f=yield this._loadMetaData();e=null;for(const l of f.layers?f.layers:[])null!==l.id&&void 0!==l.id&&l.id.toString()===b&&(e=l);if(!e)for(const l of f.tables?f.tables:[])null!==l.id&&void 0!==l.id&&l.id.toString()===b&&(e=l);
return e?(b=yield v(this._url+"/"+e.id,["*"]),this._makeAndAddFeatureSet(b,k,c)):null});return function(b){return h.apply(this,arguments)}}();n._createClass(d,[{key:"url",get:function(){return this._url}}]);return d}(G);q.constructAssociationMetaDataFeatureSetFromUrl=function(a,d){return C.apply(this,arguments)};q.constructFeatureSet=t;q.constructFeatureSetFromPortalItem=function(a,d,g,h,b,k,c){return F.apply(this,arguments)};q.constructFeatureSetFromRelationship=function(a,d,g){return D.apply(this,
arguments)};q.constructFeatureSetFromUrl=x;q.convertToFeatureSet=function(a,d,g,h,b){if(null===a)return null;if(a instanceof r){switch(d){case "datasource":return t(a,b,a.outFields,!0,g,h).getDataSourceFeatureSet();case "parent":return t(a,b,a.outFields,!0,g,h);case "root":return t(a,b,a.outFields,!0,g,h)}return null}if(a instanceof U)switch(d){case "datasource":return a.getDataSourceFeatureSet();case "parent":return a;case "root":return a.getRootFeatureSet()}return null};q.createFeatureSetCollectionFromMap=
function(a,d,g=null,h=null){return new aa(a,d,g,h)};q.createFeatureSetCollectionFromService=function(a,d,g=null,h=null){return new ba(a,d,g,h)};q.getPortal=function(a,d){return null===a?d:new W({url:a.field("url")})};q.initialiseMetaDataCache=function(){null===m.applicationCache&&(m.applicationCache=new m)};q.lookupUser=function(a,d,g){return E.apply(this,arguments)};Object.defineProperties(q,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});