// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/Collection ./core/collectionUtils ./core/deprecate ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./webdoc/support/writeUtils".split(" "),
function(D,n,h,t,x,E,g,F,G,H,u,y,v,w,l,P,I,J,K,z,L,A,B){var q;let M=0;g=q=function(m){function k(b){var a=m.call(this,b)||this;a.id=null;a.portalItem=null;a.spatialReference=null;a.thumbnailUrl=null;a.title="Basemap";a.id=Date.now().toString(16)+"-basemap-"+M++;a.baseLayers=new t;a.referenceLayers=new t;const c=d=>{d.parent&&d.parent!==n._assertThisInitialized(a)&&"remove"in d.parent&&d.parent.remove(d);d.parent=n._assertThisInitialized(a);"elevation"===d.type&&u.getLogger(a.declaredClass).error(`Layer '${d.title}, id:${d.id}' of type '${d.type}' is not supported as a basemap layer and will therefore be ignored.`)};
a.baseLayers.on("after-add",d=>c(d.item));a.referenceLayers.on("after-add",d=>c(d.item));a.baseLayers.on("after-remove",d=>{d.item.parent=null});a.referenceLayers.on("after-remove",d=>{d.item.parent=null});return a}n._inheritsLoose(k,m);var f=k.prototype;f.initialize=function(){this.when().catch(b=>{u.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,b)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};
f.destroy=function(){var b=this.baseLayers.removeAll();for(const a of b)a.destroy();b=this.referenceLayers.removeAll();for(const a of b)a.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem?.destroy();this.portalItem=null};f.normalizeCtorArgs=function(b){b&&"resourceInfo"in b&&(this._set("resourceInfo",b.resourceInfo),b={...b},delete b.resourceInfo);return b};f._writeBaseLayers=function(b,a,c){const d=[];b&&(c={...c,layerContainerType:"basemap"},this.baseLayers.forEach(e=>
{e=B.getLayerJSON(e,c.webmap?c.webmap.getLayerJSONFromResourceInfo(e):null,c);y.isSome(e)&&d.push(e)}),this.referenceLayers.forEach(e=>{e=B.getLayerJSON(e,c.webmap?c.webmap.getLayerJSONFromResourceInfo(e):null,c);y.isSome(e)&&(e.isReference=!0,d.push(e))}));a.baseMapLayers=d};f.writeTitle=function(b,a){a.title=b||"Basemap"};f.load=function(b){this.addResolvingPromise(this._loadFromSource(b));return Promise.resolve(this)};f.loadAll=function(){return H.loadAll(this,b=>{b(this.baseLayers,this.referenceLayers)})};
f.clone=function(){const b={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};this.loaded&&(b.loadStatus="loaded");return(new q({resourceInfo:this.resourceInfo})).set(b)};f.read=function(b,a){this.resourceInfo||this._set("resourceInfo",{data:b,context:a});m.prototype.read.call(this,b,a)};f.write=function(b,a){b=b||{};a&&a.origin||(a={origin:"web-map",...a});m.prototype.write.call(this,b,a);!this.loaded&&this.resourceInfo&&
this.resourceInfo.data.baseMapLayers&&(b.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(c=>{c=F.clone(c);c.url&&w.isProtocolRelative(c.url)&&(c.url=`https:${c.url}`);c.templateUrl&&w.isProtocolRelative(c.templateUrl)&&(c.templateUrl=`https:${c.templateUrl}`);return c}));return b};f._loadFromSource=function(){var b=n._asyncToGenerator(function*(a){const {resourceInfo:c,portalItem:d}=this;v.throwIfAborted(a);const e=[];c?(e.push(this._loadLayersFromJSON(c.data,c.context?c.context.url:null,a)),
c.data.id&&!c.data.title&&e.push(A.getBasemapTitle(c.data.id).then(r=>{r&&this.read({title:r},c.context)}))):d&&e.push(this._loadFromItem(d,a));yield Promise.all(e)});return function(a){return b.apply(this,arguments)}}();f._loadLayersFromJSON=function(){var b=n._asyncToGenerator(function*(a,c,d){var e=this.resourceInfo&&this.resourceInfo.context;const r=this.portalItem&&this.portalItem.portal||e&&e.portal||null,N=e&&"web-scene"===e.origin?"web-scene":"web-map",{populateOperationalLayers:C}=yield new Promise((p,
O)=>D(["./layers/support/layersCreator"],p,O));e=[];v.throwIfAborted(d);a.baseMapLayers&&Array.isArray(a.baseMapLayers)&&(c={context:{origin:N,url:c,portal:r,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=C(this.baseLayers,a.baseMapLayers.filter(p=>!p.isReference),c),e.push(d),a=C(this.referenceLayers,a.baseMapLayers.filter(p=>p.isReference),c),e.push(a));yield v.eachAlways(e)});return function(a,c,d){return b.apply(this,arguments)}}();f._loadFromItem=function(){var b=n._asyncToGenerator(function*(a,
c){const d=yield(yield a.load(c)).fetchData("json",c),e=w.urlToObject(a.itemUrl??"");this._set("resourceInfo",{data:d.baseMap??{},context:{origin:"web-map",portal:a.portal||z.getDefault(),url:e}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:d.spatialReference},this.resourceInfo.context);this.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||z.getDefault(),url:e});return this._loadLayersFromJSON(this.resourceInfo.data,
e,c)});return function(a,c){return b.apply(this,arguments)}}();k.fromId=function(b){const a=A.esriBasemapDefinitions[b];if(a){if(a.deprecated){let c=null;"dark-gray"===b?c="dark-gray-vector":"gray"===b?c="gray-vector":"streets"===b?c="streets-vector":"topo"===b&&(c="topo-vector");E.deprecated(u.getLogger("esri.Basemap"),`The ${b} basemap has entered mature support and is no longer being updated.`,{replacement:c,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return q.fromJSON(a)}return null};n._createClass(k,
[{key:"baseLayers",set:function(b){this._set("baseLayers",x.referenceSetter(b,this._get("baseLayers")))}},{key:"referenceLayers",set:function(b){this._set("referenceLayers",x.referenceSetter(b,this._get("referenceLayers")))}}]);return k}(g.JSONSupportMixin(G));h.__decorate([l.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(m,k,f,b){this._writeBaseLayers(m,k,b)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:t}},writer(m,k,f,b){this._writeBaseLayers(m,
k,b)}}}}}})],g.prototype,"baseLayers",null);h.__decorate([l.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"id",void 0);h.__decorate([l.property({type:L})],g.prototype,"portalItem",void 0);h.__decorate([l.property()],g.prototype,"referenceLayers",null);h.__decorate([l.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);h.__decorate([l.property({type:K})],g.prototype,"spatialReference",void 0);h.__decorate([l.property()],g.prototype,"thumbnailUrl",void 0);h.__decorate([l.property({type:String,
json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"title",void 0);h.__decorate([J.writer("title")],g.prototype,"writeTitle",null);return g=q=h.__decorate([I.subclass("esri.Basemap")],g)});