// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/ViewingMode ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(l,m,f,n,k,p,q,r,x,y){function t(){t=m._asyncToGenerator(function*(a,b={}){yield z(a,b);k.throwIfAborted(b)});return t.apply(this,arguments)}function u(){u=m._asyncToGenerator(function*(a,
b={}){const {basemap:c,view:e}=a;k.throwIfAborted(b);if(!("spatialReferenceLocked"in e)||e.spatialReferenceLocked)if(yield c.load(b),k.throwIfAborted(b),0!==c.baseLayers.length&&(a=c.baseLayers.getItemAt(0),p.isTiledLayer(a))){if(c.spatialReference){if(e.spatialReference.equals(c.spatialReference))return;w()}yield a.load(b);k.throwIfAborted(b);b=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo.spatialReference:null]).filter(Boolean);0!==b.length&&b.every(d=>
!e.spatialReference.equals(d))&&w()}});return u.apply(this,arguments)}function w(){throw new f("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function z(a,b){return v.apply(this,arguments)}function v(){v=m._asyncToGenerator(function*(a,b){const {basemap:c,view:e}=a;yield c.load(b);if(0!==c.baseLayers.length){a=c.baseLayers.concat(c.referenceLayers).toArray().filter(d=>!p.isBasemapSupportedLayer(d)).map(d=>new f("basemap-compatibility:unsupported-basemap-layer-type",
"Unsupported basemap layer type ${operationalLayerType}",{layer:d,operationalLayerType:d.operationalLayerType||"unknown"}));if(a.length)throw a[0];a=c.baseLayers.getItemAt(0);if(p.isBasemapSupportedLayer(a)){try{yield a.load(b)}catch(d){const {name:g="basemap-compatibility:unknown-error",message:h="Unknown basemap compatibility error",details:A}=d;throw new f(g,h,A);}B(a,e)}}});return v.apply(this,arguments)}function B(a,b){const c=b.state.viewingMode;if(c){if("wmts"===a?.type){var e=r.getTileInfoAndExtentFromWMTSLayer(a,
b.spatialReference,c);if(n.isNone(e.tileInfo))throw new f("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");var d=e.tileInfo;e=e.fullExtent}else d=a.tileInfo,e=a.fullExtent;if(!n.isNone(d)){if(!y.isSpatialReferenceSupported(d.spatialReference,c))throw new f(`basemapgalleryitem:spatial-reference-unsupported-${q.stringFromViewingMode(c)}`,`Basemap spatial reference is unsupported in ${q.stringFromViewingMode(c)} mode`);var g=d.spatialReference.isGeographic;
g="vector-tile"===a?.type?d.getOrCreateCompatible(256,g?1:2):null;if(c===q.ViewingMode.Global){let h=r.checkIfTileInfoSupportedForView(d,e,null,c);h&&"vector-tile"===a?.type&&n.isSome(e)&&g&&!r.checkIfTileInfoSupportedForView(g,e,null,c)&&(h=null);if(h)throw new f(`basemapgalleryitem:tiling-scheme-unsupported-${d.spatialReference.isWebMercator?"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",{error:h});}else if(x.TilingScheme.checkUnsupported(d))throw new f("basemapgalleryitem:tiling-scheme-unsupported-local",
"Basemap tiling scheme is unsupported in local mode");b=b.get("basemapTerrain.tilingScheme");if(!(!b||b.compatibleWith(d)||"vector-tile"===a?.type&&g&&b.compatibleWith(g)))throw new f("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}}l.default2DCompatibility=function(a){return u.apply(this,arguments)};l.default3DCompatibility=function(a){return t.apply(this,arguments)};Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});