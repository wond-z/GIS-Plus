// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/maybe ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),function(I,D,l,z,J,x,K,m,h,L,M,N,E,A,
t,F,c){const G={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},B=window.CSS;h=function(H){function y(a,b){a=H.call(this,a,b)||this;a.displayType="auto";a.messages=null;a.messagesUnits=null;a.selectedFile=null;a.submitting=!1;a.viewModel=new E;a.visibleElements={...G};a._supportsImageOrientation=B&&B.supports&&B.supports("image-orientation","from-image");a._addAttachmentForm=null;a._updateAttachmentForm=null;
return a}D._inheritsLoose(y,H);var e=y.prototype;e.initialize=function(){this.addHandles([x.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),x.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),x.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),x.initial)])};e.loadDependencies=function(){return Promise.all([new Promise((a,b)=>I(["../chunks/calcite-icon"],a,b))])};e.castVisibleElements=function(a){return{...G,...a}};e.addAttachment=function(){const {_addAttachmentForm:a,
viewModel:b}=this;this._set("submitting",!0);this._set("error",null);return b.addAttachment(a).then(d=>{this._set("submitting",!1);this._set("error",null);b.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new z("attachments:add-attachment",this.messages.addErrorMessage,d));throw d;})};e.deleteAttachment=function(a){const {viewModel:b}=this;this._set("submitting",!0);this._set("error",null);return b.deleteAttachment(a).then(d=>{this._set("submitting",!1);this._set("error",
null);b.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new z("attachments:delete-attachment",this.messages.deleteErrorMessage,d));throw d;})};e.updateAttachment=function(){const {viewModel:a}=this,{_updateAttachmentForm:b}=this;this._set("submitting",!0);this._set("error",null);return a.updateAttachment(b).then(d=>{this._set("submitting",!1);this._set("error",null);a.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new z("attachments:update-attachment",
this.messages.updateErrorMessage,d));throw d;})};e.addFile=function(){const a=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);this.viewModel.mode="view";return a};e.updateFile=function(){const {viewModel:a}=this,b=a.updateFile(this.selectedFile,this._updateAttachmentForm,a.activeFileInfo);a.mode="view";return b};e.deleteFile=function(a){a=this.viewModel.deleteFile(a||this.viewModel.activeFileInfo.file);this.viewModel.mode="view";return a};e.render=function(){const {submitting:a,
viewModel:b}=this,{state:d}=b;return c.tsx("div",{class:this.classes("esri-attachments","esri-widget")},a?this.renderProgressBar():null,"loading"===d?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};e.renderErrorMessage=function(){const {error:a,visibleElements:b}=this;return a&&b.errorMessage?c.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},a.message):null};e.renderAttachments=function(){const {activeFileInfo:a,mode:b,activeAttachmentInfo:d}=this.viewModel;
return"add"===b?this.renderAddForm():"edit"===b?this.renderDetailsForm(d||a):this.renderAttachmentContainer()};e.renderLoading=function(){return c.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},c.tsx("div",{class:"esri-attachments__loader"}))};e.renderProgressBar=function(){return this.visibleElements.progressBar?c.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};e.renderAddForm=function(){const {submitting:a,selectedFile:b}=this;var d=a||!b,f=this.visibleElements.cancelAddButton?
c.tsx("button",{type:"button",bind:this,disabled:a,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",a&&"esri-button--disabled")},this.messages.cancel):null;d=this.visibleElements.addSubmitButton?c.tsx("button",{type:"submit",disabled:d,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:d})},this.messages.add):null;const g=b?c.tsx("span",{key:"file-name",
class:"esri-attachments__file-name"},b.name):null;f=c.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c.tsx("fieldset",{class:"esri-attachments__file-fieldset"},g,c.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},b?this.messages.changeFile:this.messages.selectFile,c.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",
bind:this,onchange:this._handleFileInputChange}))),d,f);return c.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},f)};e.renderDetailsForm=function(a){const {visibleElements:b,viewModel:d,selectedFile:f,submitting:g}=this;var {abilities:k}=d,n=g||!f;let q;if(f){var r=f.type;q=f.name;var p=f.size}else if("file"in a)r=a.file.type,q=a.file.name,p=a.file.size;else{r=a.contentType;q=a.name;p=a.size;var u=a.url}var v=k.editing&&k.operations.delete&&b.deleteButton?c.tsx("button",{key:"delete-button",
type:"button",disabled:g,bind:this,onclick:C=>this._submitDeleteAttachment(C,a),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:g})},this.messages.delete):void 0;n=k.editing&&k.operations.update&&b.updateButton?c.tsx("button",{disabled:n,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:n})},this.messages.update):void 0;const w=
this.visibleElements.cancelUpdateButton?c.tsx("button",{disabled:g,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:g})},this.messages.cancel):void 0;k=k.editing&&k.operations.update?c.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},c.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},q),c.tsx("label",{class:this.classes("esri-attachments__file-label",
"esri-button","esri-button--secondary")},this.messages.changeFile,c.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0;p=c.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},c.tsx("label",null,K.formatFileSize(this.messagesUnits,p)));r=c.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},c.tsx("label",null,r));u=J.isSome(u)?c.tsx("a",{class:"esri-attachments__item-link",
href:u,rel:"noreferrer",target:"_blank"},this.renderImageMask(a,400),c.tsx("div",{class:"esri-attachments__item-link-overlay"},c.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},c.tsx("calcite-icon",{icon:"launch"})))):this.renderImageMask(a,400);v=c.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:C=>this._submitUpdateAttachment(C,a)},c.tsx("div",{class:"esri-attachments__metadata"},p,r),k,c.tsx("div",{class:"esri-attachments__actions"},
v,w,n));return c.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},u,v)};e.renderImageMask=function(a,b){return"file"in a?this.renderGenericImageMask(a.file.name,a.file.type):this.renderImageMaskForAttachment(a,b)};e.renderGenericImageMask=function(a,b){var {supportsResizeAttachments:d}=this.viewModel;b=A.getIconPath(b);d={["esri-attachments__image--resizable"]:d};return c.tsx("div",{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask")},c.tsx("img",
{title:a,alt:a,src:b,class:this.classes(d,"esri-attachments__image")}))};e.renderImageMaskForAttachment=function(a,b){var {supportsResizeAttachments:d}=this.viewModel;const {contentType:f,name:g,url:k}=a;if(!d||!A.isSupportedImage(f))return this.renderGenericImageMask(g,f);a=(a=this._getCSSTransform(a))?{transform:a,"image-orientation":"none"}:{};b=`${k}${k.includes("?")?"\x26":"?"}w=${b}`;d={["esri-attachments__image--resizable"]:d};return c.tsx("div",{class:this.classes("esri-attachments__item-mask")},
c.tsx("img",{styles:a,alt:g,title:g,src:b,class:this.classes(d,"esri-attachments__image")}))};e.renderFile=function(a){const {file:b}=a;return c.tsx("li",{class:"esri-attachments__item",key:b},c.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(a),type:"button"},this.renderImageMask(a),c.tsx("label",{class:"esri-attachments__label"},c.tsx("span",{class:"esri-attachments__filename"},
b.name||this.messages.noTitle),c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",t.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}))))};e.renderAttachmentInfo=function({attachmentInfo:a,displayType:b}){const {viewModel:d,effectiveDisplayType:f}=this,{abilities:g,supportsResizeAttachments:k}=d,{contentType:n,name:q,url:r}=a;b=this.renderImageMask(a,"list"===b?48:400);var p=g.editing?c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
t.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;p="preview"===f&&k&&A.isSupportedImage(n)?null:c.tsx("label",{class:"esri-attachments__label"},c.tsx("span",{class:"esri-attachments__filename"},q||this.messages.noTitle),p);b=[b,p];b=g.editing?c.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":a.id,onclick:()=>this._startEditAttachment(a),
type:"button"},b):c.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:r,target:"_blank"},b);return c.tsx("li",{class:"esri-attachments__item",key:a},b)};e.renderAttachmentContainer=function(){const {effectiveDisplayType:a,viewModel:b,visibleElements:d}=this,{attachmentInfos:f,abilities:g,fileInfos:k}=b;var n=!!f?.length;const q=!!k?.length,r={["esri-attachments__container--list"]:"preview"!==a,["esri-attachments__container--preview"]:"preview"===a},p=g.editing&&g.operations.add&&
d.addButton?c.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):void 0,u=n?c.tsx("ul",{key:"attachments-list",class:"esri-attachments__items"},f.toArray().map(w=>this.renderAttachmentInfo({attachmentInfo:w,displayType:a}))):void 0,v=q?c.tsx("ul",
{key:"file-list",class:"esri-attachments__items"},k.toArray().map(w=>this.renderFile(w))):void 0;n=q||n?void 0:c.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return c.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",r)},u,v,n,p)};e._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};e._handleFileInputChange=function(a){a=(a=a.target)&&a.files&&a.files.item(0);this._set("selectedFile",a)};e._submitDeleteAttachment=
function(a,b){a.preventDefault();"file"in b?this.deleteFile(b.file):this.deleteAttachment(b)};e._submitAddAttachment=function(a){a.preventDefault();this.viewModel.filesEnabled?this.addFile():this.addAttachment()};e._submitUpdateAttachment=function(a,b){a.preventDefault();"file"in b?this.updateFile():this.updateAttachment()};e._startEditAttachment=function(a){const {viewModel:b}=this;b.activeFileInfo=null;b.activeAttachmentInfo=a;b.mode="edit"};e._startEditFile=function(a){const {viewModel:b}=this;
b.activeAttachmentInfo=null;b.activeFileInfo=a;b.mode="edit"};e._startAddAttachment=function(){this.viewModel.mode="add"};e._cancelForm=function(a){a.preventDefault();this.viewModel.mode="view"};e._getCSSTransform=function(a){({orientationInfo:a}=a);return!this._supportsImageOrientation&&a?[a.rotation?`rotate(${a.rotation}deg)`:"",a.mirrored?"scaleX(-1)":""].join(" "):""};D._createClass(y,[{key:"abilities",get:function(){return this.viewModel.abilities},set:function(a){this.viewModel.abilities=a}},
{key:"effectiveDisplayType",get:function(){const {displayType:a}=this;return a&&"auto"!==a?a:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(a){this.viewModel.graphic=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}}]);return y}(N);l.__decorate([m.property()],h.prototype,"abilities",null);l.__decorate([m.property()],h.prototype,"displayType",
void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"effectiveDisplayType",null);l.__decorate([m.property()],h.prototype,"graphic",null);l.__decorate([m.property()],h.prototype,"label",null);l.__decorate([m.property(),F.messageBundle("esri/widgets/Attachments/t9n/Attachments")],h.prototype,"messages",void 0);l.__decorate([m.property(),F.messageBundle("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"selectedFile",void 0);l.__decorate([m.property({readOnly:!0})],
h.prototype,"submitting",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"error",void 0);l.__decorate([m.property({type:E})],h.prototype,"viewModel",void 0);l.__decorate([m.property()],h.prototype,"visibleElements",void 0);l.__decorate([L.cast("visibleElements")],h.prototype,"castVisibleElements",null);return h=l.__decorate([M.subclass("esri.widgets.Attachments")],h)});