// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/deprecate ../core/events ../core/Logger ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../properties/defaultUnit ../rest/support/Stop ../symbols/SimpleMarkerSymbol ./Search ./Widget ./Directions/DirectionsViewModel ./Directions/components/SaveLayer ./Directions/support/directionsUtils ./Directions/support/resources ./Search/support/locatorUtils ./support/DatePicker ./support/Heading ./support/TimePicker ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../chunks/sortable.esm ../intl/substitute ../intl/date ../intl/number".split(" "),
function(I,J,n,m,B,C,U,h,u,q,ja,V,W,X,Y,Z,aa,ba,L,ca,G,b,M,da,z,ea,A,K,e,ka,fa,N,O,P){function Q(H){return!!H.composedPath?.().find(D=>D.classList?.contains("esri-search__suggestions-list"))}const R={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0},E=U.getLogger("esri.widgets.Directions");m=function(H){function D(a,c){var d=H.call(this,a,c)||this;d._autoStopRemovalDelay=100;d._departureTime=b.DepartureTime.NOW;d._datePicker=new da;d._newPlaceholderStop=
null;d._pointerPressedSearchSuggestionStop=null;d._renderSavePopoverFunction=null;d._saveAsButtonNode=null;d._saveLayer=new ca.SaveLayer;d._sections=null;d._stopsToSearches=new Map;d._timePicker=new ea;d.headingLevel=2;d.iconClass=b.CSS.widgetIcon;d.messages=null;d.messagesCommon=null;d.messagesUnits=null;d.searchProperties=null;d.viewModel=new L;d.visibleElements={...R};d._setUpDragAndDropStops=g=>{d._sortable=fa.Sortable.create(g,{draggable:`.${b.CSS.validStopRow}`,ghostClass:b.CSS.stopRowGhost,
handle:`.${b.CSS.stopHandle}`,onEnd:d._handleStopInputDragEnd})};d._handleDragHandlePointerDown=()=>d.viewModel.layer.stops.forEach(g=>d._acquireSearch(g).activeMenu="none");d._handleStopInputDragEnd=({oldIndex:g,newIndex:k,target:l})=>{if(g!==k){var {children:p}=l,t=p[g];l.insertBefore(p[k],0>k-g?t.nextElementSibling:t);l=d.viewModel.layer.stops;l.reorder(l.getItemAt(g),k);for(const r of l)r.sequence=null;d._getDirections()}};return d}J._inheritsLoose(D,H);var f=D.prototype;f.initialize=function(){this.addHandles([u.watch(()=>
this.viewModel.layer.routeInfo,()=>{this._focusedManeuver=this._activeManeuver=null;this._sections=this._getSections();this.scheduleRender()},u.initial),u.when(()=>this.view,(a,c)=>{c&&(this._viewClickHandle=null,this.removeHandles(c));if(a){c=this._prepPointerDownUpClick();const d=this._prepViewClick();c.pause();d.pause();this.addHandles([C.on(a.surface,"mousedown",()=>this._autoStopRemovalDelay=500),C.on(a.surface,"mouseup",()=>this._autoStopRemovalDelay=100),c,d],a);this._pointerDownUpHandle=c;
this._viewClickHandle=d}},u.initial),u.when(()=>h.isNone(this.viewModel.serviceDescription),()=>{try{this.viewModel.load()}catch{}},u.initial),u.watch(()=>this._saveLayer.state,()=>{this.scheduleRender()})]);this.when(()=>{this.destroyed||(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))})};f.loadDependencies=function(){return Promise.all([new Promise((a,c)=>I(["../chunks/calcite-button"],a,c)),new Promise((a,
c)=>I(["../chunks/calcite-link"],a,c)),new Promise((a,c)=>I(["../chunks/calcite-popover"],a,c))])};f.destroy=function(){this._datePicker.destroy();this._timePicker.destroy();for(const a of this._stopsToSearches.values())a.destroy();this._sortable&&this._sortable.destroy();h.isSome(this._renderSavePopoverFunction)&&this._projector.detach(this._renderSavePopoverFunction)};f.castVisibleElements=function(a){return{...R,...a}};f.getDirections=function(){return this.viewModel.getDirections()};f.render=
function(){return e.tsx("div",{class:this.classes(b.CSS.base,b.CSS.scroller)},this._renderPanelContent())};f.save=function(){return this.viewModel.layer.save()};f.saveAs=function(a,c={}){return this.viewModel.layer.saveAs(a,c)};f.zoomToRoute=function(){return this.viewModel.zoomToRoute()};f._renderPanelContent=function(){const {viewModel:{serviceDescription:a,state:c}}=this;var d="initializing"===c;const g="error"===c&&!a,k="unauthenticated"===c,l={[b.CSS.panelContentLoading]:d,[b.CSS.panelContentError]:g,
[b.CSS.panelContentSignIn]:k},p=d?"presentation":"group";d=k?this._renderSignIn():g?this._renderMessage(this._getErrorMessage()):d?this._renderLoader():this._renderReadyContent();return e.tsx("div",{class:this.classes(b.CSS.panelContent,l),role:p},d)};f._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]};f._renderSignIn=function(){return e.tsx("div",
{key:"sign-in",class:b.CSS.signInContent},e.tsx(z.Heading,{class:b.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),e.tsx(z.Heading,{level:z.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),e.tsx("button",{class:this.classes(b.CSS.button,b.CSS.buttonSecondary,b.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))};f._handleSignInClick=function(){this.viewModel.load().catch(()=>
{})};f._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const {selectedTravelMode:a,travelModes:c}=this.viewModel;if(0===c.length)return null;const d=h.isSome(a)?a.name:this.messages.travelMode;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(b.CSS.travelMode,this._saveLayer.opened&&b.CSS.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},e.tsx("select",{"aria-label":d,bind:this,class:this.classes(b.CSS.travelModeSelect,
b.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:d},c.map(g=>{const k=h.isSome(a)&&g.id===a.id;return e.tsx("option",{key:`esri-directions__travel-mode-${g.id}`,"data-mode":g,selected:k,value:g.id},g.name)})))};f._handleTravelModeChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);this.viewModel.selectedTravelMode=a["data-mode"];this._getDirections()};f._renderStopsContainer=function(){return this.visibleElements.stops?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),
class:this.classes(b.CSS.section,this._saveLayer.opened&&b.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null};f._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;const a=this._departureTime,{messages:c}=this,d=c.departureTime;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(b.CSS.departureTime,this._saveLayer.opened&&b.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",
role:"group"},e.tsx("select",{"aria-label":d,bind:this,class:this.classes(b.CSS.departureTimeSelect,b.CSS.select),onchange:this._handleDepartureOptionChange,title:d},e.tsx("option",{value:b.DepartureTime.NOW,selected:a===b.DepartureTime.NOW},c.leaveNow),e.tsx("option",{value:b.DepartureTime.DEPART_BY,selected:a===b.DepartureTime.DEPART_BY},c.departBy),e.tsx("option",{value:b.DepartureTime.UNSPECIFIED,selected:a===b.DepartureTime.UNSPECIFIED},c.timeUnspecified)),a===b.DepartureTime.DEPART_BY?this._renderTimeControls():
null)};f._renderStops=function(){const a=this.viewModel.layer.stops;let c=0;for(var d of this._stopsToSearches.keys())a.includes(d)||this._disposeSearch(d);for(var g of a)d=this._acquireSearch(g),"none"!==d.activeMenu&&(c+=1),h.isSome(g.name)&&(d.searchTerm=g.name);g=a.toArray().map((k,l)=>{var p=a.length,t=1<l&&h.isNone(k.geometry);const r={[b.CSS.stopsIcon]:0<=l&&l<p-1,[b.CSS.lastStopIcon]:l===p-1},x={[b.CSS.lastStopIconContainer]:l===p-1};t={[b.CSS.validStopRow]:!t};var v=a.getItemAt(l+1);v=v&&
h.isSome(v.geometry);var w=l===p-1,y=l===p-2;v=2===p&&0===l||2<p&&!w&&!y||2<p&&y&&v||2<p&&w&&h.isNone(k.geometry);p=3>p;w=this._acquireSearch(k);({messages:y}=this);const {removeStop:F,reverseStops:S,unlocated:ha}=y;y=N.substitute(y.stopLabelTemplate,{number:l+1,label:h.isSome(k.geometry)?k.name:ha});const T=`${this.id}__stop--${l}`;k=!!w.searchTerm&&!!w.selectedResult&&h.isSome(k.geometry)&&w.selectedResult.name===k.name;const ia={zIndex:"none"!==w.activeMenu?`${c--}`:""};return e.tsx("li",{"aria-label":y,
afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(b.CSS.stopRow,t),id:T,key:l,"data-stop-index":l,styles:ia},e.tsx("div",{class:b.CSS.stopHandle},e.tsx("span",{"aria-hidden":"true",class:this.classes(b.CSS.stopIcon,b.CSS.handleIcon,b.CSS.stopHandleIcon,b.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),e.tsx("div",{bind:this,"aria-labelledby":T,class:this.classes(b.CSS.stopIconContainer,x),"data-stop-index":l,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,
role:"button"},e.tsx("span",{class:this.classes(b.CSS.stopIcon,r),tabindex:k?"0":null}))),e.tsx("div",{class:b.CSS.stopInput},w.render()),e.tsx("div",{class:b.CSS.stopOptions,role:"group"},e.tsx("div",{"aria-label":F,class:b.CSS.removeStopButton,bind:this,"data-stop-index":l,hidden:p,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:F},e.tsx("span",{"aria-hidden":"true",class:this.classes(b.CSS.stopIcon,b.CSS.removeStop,b.CSS.removeStopIcon,b.CSS.interactiveStopIcon)}),
e.tsx("span",{class:b.CSS.screenReaderText},"removeStopTitle")),e.tsx("div",{"aria-label":S,class:b.CSS.reverseStops,bind:this,hidden:v,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:S},e.tsx("span",{"aria-hidden":"true",class:this.classes(b.CSS.stopIcon,b.CSS.reverseStopIcon,b.CSS.interactiveStopIcon)}),e.tsx("span",{class:b.CSS.screenReaderText},"removeStopTitle"))))});d=this._renderAddStop();return e.tsx("div",null,e.tsx("ol",{class:b.CSS.stops,
role:"group",afterCreate:this._setUpDragAndDropStops},g),d)};f._renderAddStop=function(){var {stops:a}=this.viewModel.layer;const c=a.filter(({geometry:d})=>h.isSome(d));a=a.at(-1);return 1<c.length&&c.length<this.maxStops&&h.isSome(a)&&h.isSome(a.geometry)?e.tsx("div",{class:b.CSS.toolbarSection},e.tsx("div",{class:b.CSS.toolbarButtons},e.tsx("calcite-button",{appearance:"outline",class:b.CSS.addStopButton,color:"neutral",scale:"s",round:!0,"icon-start":"plus",key:b.CSS.addStopButton,onclick:()=>
{this._addNewPlaceholder()},text:this.messages.addStop,width:"full"},this.messages.addStop))):null};f._handleStopIconClick=function(a){(a=this.viewModel.layer.stops.getItemAt(a.currentTarget["data-stop-index"]))&&h.isSome(a.geometry)&&this._centerAtStop(a)};f._handleClearRouteClick=function(){this.viewModel.reset()};f._centerAtStop=function(a){this.viewModel.centerAt(a)};f._handleStopFieldCreation=function(a){const c=this._newPlaceholderStop;if(c){a=this.viewModel.layer.stops.getItemAt(a["data-stop-index"]);
if(c===a){const d=this._acquireSearch(a);d.when(()=>{this.renderNow();d.focus()})}this._newPlaceholderStop=null}};f._handleStopInputBlur=function(a,c){if(!this._saveLayer.opened)if(this.removeHandles("search-term"),a.selectedResult&&h.isSome(c.geometry)&&h.isSome(a.selectedResult?.feature.geometry)&&c.geometry===a.selectedResult?.feature.geometry)this._pointerDownUpHandle.pause();else{var d=h.isNone(c.geometry)&&h.isNone(a.selectedResult?.feature.geometry),g=h.isSome(c.geometry)&&h.isSome(a.selectedResult?.feature.geometry)&&
c.geometry!==a.selectedResult.feature.geometry;(d||g)&&"none"===a.activeMenu&&a.searchTerm?(a.search(),this._pointerDownUpHandle.pause()):a.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(()=>{this.destroyed||(this._viewClickHandle.pause(),"searching"===a.viewModel.state?this._pointerDownUpHandle.pause():this._pointerPressedSearchSuggestionStop||(h.isSome(c.geometry)&&(c.geometry=null,this._getDirections()),this.scheduleRender()))},
this._autoStopRemovalDelay))}};f._handleStopInputFocus=function(a,c){this._pointerDownUpHandle.resume();if(!this.hasHandles("search-term")){var {view:d}=this,g=d.cursor;this.addHandles([{remove(){d.cursor=g}},u.watch(()=>a.searchTerm,k=>{a.destroyed||(d.cursor=k.length?g:"copy")},u.initial)],"search-term");this._activeStop=c}};f._prepViewClick=function(){const {view:a}=this.viewModel,c=C.pausable(a,"click",this._handleViewClick.bind(this)),d=C.pausable(a.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId);
d.pause()});return{remove(){d.remove();c.remove()},pause(){d.pause();c.pause()},resume(){d.resume();c.resume()}}};f._prepPointerDownUpClick=function(){const a=C.pausable(document,"pointerdown",d=>{this._pointerPressedSearchSuggestionStop=Q(d)?this._activeStop:null}),c=C.pausable(document,"pointerup",d=>{this._pointerDownUpHandle.pause();d=Q(d);const g=this._activeStop;d||g!==this._pointerPressedSearchSuggestionStop||this._removeStop(g);this.scheduleRender();this._pointerPressedSearchSuggestionStop=
d?g:null});return{remove(){c.remove();a.remove()},pause(){c.pause();a.pause()},resume(){a.resume()}}};f._handleViewClick=function(a){a.stopPropagation();const c=this._stopsToSearches.get(this._activeStop);c&&!c.searchTerm&&(c.search(a.mapPoint).then(d=>{const {feature:g,name:k}=d.results[0].results[0];this._activeStop.geometry=g.geometry;this._activeStop.name=k;c.searchTerm=k}),this.scheduleRender());this._viewClickHandle.pause();clearTimeout(this._autoStopRemovalTimeoutId)};f._addNewPlaceholder=
function(){this._pointerDownUpHandle.pause();if(!this._newPlaceholderStop){var a=new Y({symbol:new Z});this.viewModel.layer.stops.add(a);this._newPlaceholderStop=a}};f._handleReverseStops=function(){this._reverseStops()};f._reverseStops=function(){this.viewModel.layer.stops.reverse();for(const a of this.viewModel.layer.stops)a.sequence=null;this._getDirections()};f._handleRemoveStop=function(a){a=this.viewModel.layer.stops.getItemAt(a.currentTarget["data-stop-index"]);this._removeStop(a);(h.isSome(a.geometry)||
h.isNone(this.viewModel.layer.routeInfo))&&this._getDirections()};f._removeStop=function(a){2>=this.viewModel.layer.stops.length||(this._disposeSearch(a),this.viewModel.layer.stops.remove(a))};f._handleDepartureOptionChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);a.value===b.DepartureTime.NOW?(this._departureTime=b.DepartureTime.NOW,this.viewModel.departureTime=b.DepartureTime.NOW,this.removeHandles("date-time-picker"),this._getDirections()):a.value===b.DepartureTime.DEPART_BY?(this._departureTime=
b.DepartureTime.DEPART_BY,this.addHandles(u.watch(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime();this._getDirections()},u.initial),"date-time-picker")):(this._departureTime=b.DepartureTime.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())};f._updateDepartureTime=function(){const a=this._datePicker.value,c=this._timePicker.value;a&&c&&(this.viewModel.departureTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),c.getHours(),c.getMinutes()))};
f._renderTimeControls=function(){return e.tsx("div",{class:b.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())};f._renderSectionSplitter=function(){return e.tsx("div",{class:b.CSS.sectionSplitter})};f._renderSaveContainer=function(){const {saveButton:a,saveAsButton:c,printButton:d,layerDetails:g}=this.visibleElements;return a||c||d||g?e.tsx("div",{class:b.CSS.saveSection,key:b.CSS.saveSection},this._renderSaveButtons(),
this._renderRouteLayerDetailsLink()):null};f._renderSaveButtons=function(){const {saveButton:a,saveAsButton:c,printButton:d}=this.visibleElements;return a||c||d?e.tsx("div",{class:b.CSS.saveButtons,key:b.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null};f._renderSaveButton=function(){if(!this.visibleElements.saveButton)return null;var a=this.viewModel.layer.portalItem?.itemControl;a=h.isSome(this.viewModel.layer.routeInfo)&&("admin"===a||"update"===
a);return e.tsx("calcite-button",{appearance:"outline",class:b.CSS.saveButton,color:"blue",disabled:!a,"icon-start":"save",key:b.CSS.saveButton,onclick:()=>{this._handleSaveButtonClick()},text:this.messagesCommon.save,width:"full"},this.messagesCommon.save)};f._renderSaveAsButton=function(){if(!this.visibleElements.saveAsButton)return null;const a=h.isNone(this.viewModel.layer.routeInfo);return e.tsx("div",{class:b.CSS.saveAsButtonPopover,key:b.CSS.saveAsButtonPopover},e.tsx("calcite-button",{afterCreate:c=>
{this._saveAsButtonNode=c},appearance:"outline",class:b.CSS.saveAsButton,color:"blue",disabled:a,"icon-start":"duplicate",key:b.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),text:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))};f._renderSavePopover=function(){return e.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,"overlay-positioning":"fixed",referenceElement:h.unwrap(this._saveAsButtonNode)},this._saveLayer.render())};f._handleSaveAsButtonClick=
function(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)};f._renderPrintButton=function(){return this.visibleElements.printButton?e.tsx("calcite-button",{appearance:"outline",class:b.CSS.printButton,color:"blue","icon-start":"print",key:b.CSS.printButton,text:this.messagesCommon.print}):null};f._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const {portalItem:a}=this.viewModel.layer;if(!a)return null;const {id:c,
portal:{url:d}}=a;return e.tsx("calcite-link",{class:b.CSS.layerDetailsLink,href:`${d}/home/item.html?id=${c}`,key:b.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)};f._handleSaveButtonClick=function(){this.viewModel.layer.save()};f._renderDirectionsContainer=function(){return e.tsx("div",{class:this.classes(b.CSS.directionsSection,b.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())};f._renderLoader=function(){return e.tsx("div",{class:b.CSS.loader,
key:"loader"})};f._renderWarningCard=function(){return e.tsx("div",{class:b.CSS.warningCard,role:"alert"},e.tsx("div",{class:b.CSS.warningHeader},e.tsx("span",{class:b.CSS.warningIcon,"aria-hidden":"true"}),e.tsx(z.Heading,{class:b.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),e.tsx("div",{class:b.CSS.warningMessage},this._getErrorMessage()))};f._renderDirectionsContainerContent=function(){const {viewModel:{layer:a,state:c}}=this,d="routing"===c;return"error"===c?this._renderWarningCard():
d?this._renderLoader():h.isSome(a.directionLines)?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(b.CSS.summary,this._saveLayer.opened&&b.CSS.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):e.tsx("div",{key:"esri-directions__placeholder",class:b.CSS.emptyContent},this._renderPlaceholder(),e.tsx(z.Heading,{class:b.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))};
f._renderPlaceholder=function(){return e.tsx("svg",{class:b.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},e.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))};
f._renderMessage=function(a){return e.tsx(z.Heading,{level:this.headingLevel},a)};f._renderRouteActions=function(){return e.tsx("div",{class:b.CSS.routeActions},e.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(b.CSS.clearRouteButton,b.CSS.button,b.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))};f._getSections=function(){const {directionPoints:a,directionLines:c,stops:d}=this.viewModel.layer;if(h.isNone(a)||
h.isNone(c))return null;const g=[];let k=null;for(const p of a){const {objectId:t,stopId:r}=p;if(h.isSome(r)){var l=d.find(v=>v.objectId===r);const x=0===g.length;if(h.isNone(k)||k.stop!==l)k={stop:l,directions:[],open:x},g.push(k)}else h.isNone(k)||(l=c.find(x=>x.directionPointId===t),h.isNone(l)||k.directions.push({directionPoint:p,directionLine:l}))}return g};f._renderManeuverSections=function(){return h.isNone(this._sections)?null:e.tsx("div",{class:b.CSS.maneuvers,role:"group"},this._sections.map((a,
c)=>{const {open:d}=a;let g;0<a.directions.length&&d&&(g=e.tsx("ol",{class:b.CSS.maneuverList},a.directions.map(r=>this._renderManeuver(r))));var k=2<h.unwrap(this._sections).length;const l=c===h.unwrap(this._sections).length-1,p={[b.CSS.collapsibleSection]:k},t={[b.CSS.openIcon]:!d,[b.CSS.closeIcon]:d};k&&!l?(k=d?this.messagesCommon.close:this.messagesCommon.open,a=e.tsx("header",{class:this.classes(b.CSS.maneuverSectionHeader,b.CSS.maneuverSectionToggle),key:b.CSS.maneuverSectionHeader},e.tsx("div",
{"aria-expanded":d.toString(),"aria-label":k,bind:this,class:b.CSS.maneuverSectionHeaderButton,"data-maneuver-section":a,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:k},e.tsx(z.Heading,{class:b.CSS.maneuverSectionTitle,level:this.headingLevel},a.stop.name),e.tsx("span",{"aria-hidden":"true",class:this.classes(t)})))):a=e.tsx("header",{class:b.CSS.maneuverSectionHeader,key:b.CSS.maneuverSectionHeader},e.tsx(z.Heading,{class:b.CSS.maneuverSectionTitle,
level:this.headingLevel},a.stop.name));return e.tsx("section",{class:this.classes(b.CSS.maneuverSection,p),key:c},a,g)}))};f._handleSectionToggle=function(a){a=a.currentTarget["data-maneuver-section"];a.open=!a.open};f._renderCosts=function(){var a=this._getCostSummary(),{directionPoints:c}=this.viewModel.layer;if(h.isNone(c)||h.isNone(a))return null;c=c.getItemAt(c.length-1).arrivalTime;const {distance:d,duration:g}=a,{eta:k,etaTemplate:l,primaryCosts:p,secondaryCosts:t,zoomToRoute:r}=this.messages;
a=O.convertDateFormatToIntlOptions("short-time");a=h.isSome(c)?`<strong>${O.formatDate(c,a)}</strong>`:null;if(h.isSome(c)){c=c.getTimezoneOffset();const x=Math.abs(Math.floor(c)%60),v={minimumIntegerDigits:2};c=`${`GMT${0<c?"-":"+"}${P.formatNumber(Math.abs(Math.floor(c/60)),v)}${P.formatNumber(x,v)}`}`}else c=null;a=N.substitute(l,{time:a,gmt:c});return e.tsx("div",{"aria-label":r,bind:this,class:b.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,
role:"button",tabIndex:0,title:r},e.tsx("div",{class:b.CSS.costsDetails,role:"group"},e.tsx("div",{class:b.CSS.primaryCosts,title:p},g),e.tsx("div",{class:b.CSS.verticalSplitter}),e.tsx("div",{class:b.CSS.secondaryCosts,title:t},d)),e.tsx("div",{innerHTML:a,title:k}))};f._handleSummaryInteraction=function(){this._focusedManeuver=this._activeManeuver=null;this.viewModel.clearHighlights();this.zoomToRoute()};f._getErrorMessage=function(){const {messages:a,viewModel:{lastError:c}}=this;if(h.isSome(c))switch(c.name){case "directions-view-model:unable-to-route":return a.errors.unableToRoute;
case "directions-view-model:service-metadata-unavailable":return a.errors.unableToLoadServiceMetadata}return a.errors.unknownError};f._normalizeSearchSources=function(a){this._overrideDefaultSources(a);this._applyLocatorSourceOverrides(a)};f._overrideDefaultSources=function(a){a.viewModel.defaultSources.forEach(c=>{c.autoNavigate=!1})};f._applyLocatorSourceOverrides=function({allSources:a}){for(const c of a)"url"in c&&c.url&&(c.locationType??(c.locationType="street"),M.isArcGISWorldGeocoder(c.url)&&
this.apiKey&&null==c.apiKey&&(c.apiKey=this.apiKey,c.url=M.meteredArcGISLocatorUrl))};f._acquireSearch=function(a){const {view:c}=this.viewModel;if(this._stopsToSearches.has(a)){const g=this._stopsToSearches.get(a);g.view=c;this._overrideDefaultSources(g);return g}const d=new aa({view:c,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});this._normalizeSearchSources(d);this.addHandles([u.on(()=>d.allSources,"change",()=>this._normalizeSearchSources(d)),d.on("select-result",()=>{a.geometry=
d.selectedResult.feature.geometry;a.name=d.selectedResult.name;this._getDirections()}),d.on("search-focus",()=>this._handleStopInputFocus(d,a)),d.on("search-blur",()=>this._handleStopInputBlur(d,a)),d.on("search-clear",()=>{a.geometry=null;a.name=null;this._activeStop=a;this.viewModel.layer.removeResult()}),u.watch(()=>d.searchTerm,g=>{a.name=g})],d);this._stopsToSearches.set(a,d);return d};f._disposeSearch=function(a){if(this._stopsToSearches.has(a)){const c=this._stopsToSearches.get(a);this.removeHandles(c);
c.destroy();this._stopsToSearches.delete(a)}};f._renderManeuver=function(a){const {directionPoint:c,directionLine:d}=a,{distance:g,duration:k}=d,{messages:l,messagesUnits:p,unit:t}=this;a=G.formatDistance(p,h.unwrapOrValue(g,0),t);var r=G.formatDuration(h.unwrapOrValue(k,0));a=a&&r?`${a}&nbsp;&middot;&nbsp;${r}`:`${a}${r}`;r=this._getFormattedManeuverText(c);const {objectId:x,directionPointType:v}=c,w=b.getIconPath(v),y=`esri-directions__maneuver-${x}`,F=`esri-directions__intermediate-costs-${x}`;
return e.tsx("li",{"aria-labelledby":`${y} ${F}`,bind:this,class:this.classes(b.CSS.maneuver,{[b.CSS.maneuverActive]:this._activeManeuver===d}),"data-maneuver":d,key:d,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},h.isSome(w)&&e.tsx("img",{alt:"",class:b.CSS.maneuverIcon,src:w}),e.tsx("div",{class:b.CSS.maneuverCostsContainer},
e.tsx("span",{id:y,innerHTML:h.unwrapOrValue(r,"")}),e.tsx("div",{class:b.CSS.maneuverCosts},e.tsx("div",{class:b.CSS.horizontalSplitter}),e.tsx("div",{"aria-hidden":"true",id:F,class:b.CSS.intermediateCost,innerHTML:a,title:l.intermediateCosts}))))};f._handleManeuverClick=function(a){a=a.currentTarget["data-maneuver"];if(this._activeManeuver===a)this._activeManeuver=null,this.zoomToRoute();else{this._activeManeuver=a;var {geometry:c}=a;this.viewModel.centerAt(c);this.viewModel.highlight(a)}};f._handleManeuverMouseOver=
function(a){this._activeManeuver||this._focusedManeuver||this.viewModel.highlight(a.currentTarget["data-maneuver"])};f._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()};f._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())};f._handleManeuverFocus=function(a){this._activeManeuver||(this._focusedManeuver=a=a.currentTarget["data-maneuver"],this.viewModel.highlight(a))};f._getFormattedManeuverText=
function(a){const {displayText:c,name:d,intersectingName:g}=a;if(h.isNone(c))return"";a=c;h.isSome(d)&&a.includes(d)&&(a=a.replace(d,`<strong>${d}</strong>`));h.isSome(g)&&a.includes(g)&&(a=a.replace(g,`<strong>${g}</strong>`));return a};f._getCostSummary=function(){const {messagesUnits:a,unit:c,viewModel:d}=this;var {routeInfo:g}=d.layer;if(h.isNone(g))return null;var k=h.unwrapOrValue(g.totalDistance,0);g=h.unwrapOrValue(g.totalDuration,0);k=G.formatDistance(a,k,c);g=G.formatDuration(g);return{distance:k,
duration:g}};f._getDirections=function(){var a=J._asyncToGenerator(function*(){if(!(2>this.viewModel.layer.stops.filter(c=>h.isSome(c.geometry)).length))try{yield this.viewModel.getDirections()}catch{}});return function(){return a.apply(this,arguments)}}();J._createClass(D,[{key:"apiKey",get:function(){return this.viewModel.apiKey},set:function(a){this.viewModel.apiKey=a}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(a){this.viewModel.goToOverride=a}},{key:"label",
get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"lastRoute",get:function(){return this.viewModel.lastRoute}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=a}},{key:"maxStops",get:function(){return this.viewModel.maxStops},set:function(a){this.viewModel.maxStops=a}},{key:"routeServiceUrl",get:function(){B.deprecatedProperty(E,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",
warnOnce:!0});return this.viewModel.legacyLayer.url},set:function(a){B.deprecatedProperty(E,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.url=a}},{key:"routeSymbol",get:function(){B.deprecatedProperty(E,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.directionLines},set:function(a){B.deprecatedProperty(E,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",
version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.directionLines=a}},{key:"stopSymbols",get:function(){B.deprecatedProperty(E,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.stops},set:function(a){B.deprecatedProperty(E,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.stops=a}},{key:"unit",get:function(){return this.defaultUnit},
set:function(a){this._overrideIfSome("unit",a)}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}}]);return D}(ba);n.__decorate([q.property()],m.prototype,"apiKey",null);n.__decorate([q.property(X.defaultUnitPropertyMetadata)],m.prototype,"defaultUnit",void 0);n.__decorate([q.property()],m.prototype,"goToOverride",null);n.__decorate([q.property()],m.prototype,"headingLevel",void 0);n.__decorate([q.property()],m.prototype,"iconClass",void 0);n.__decorate([q.property()],
m.prototype,"label",null);n.__decorate([q.property({readOnly:!0})],m.prototype,"lastRoute",null);n.__decorate([q.property()],m.prototype,"layer",null);n.__decorate([q.property()],m.prototype,"maxStops",null);n.__decorate([q.property(),K.messageBundle("esri/widgets/Directions/t9n/Directions")],m.prototype,"messages",void 0);n.__decorate([q.property(),K.messageBundle("esri/t9n/common")],m.prototype,"messagesCommon",void 0);n.__decorate([q.property(),K.messageBundle("esri/core/t9n/Units")],m.prototype,
"messagesUnits",void 0);n.__decorate([q.property()],m.prototype,"routeServiceUrl",null);n.__decorate([q.property()],m.prototype,"routeSymbol",null);n.__decorate([q.property()],m.prototype,"searchProperties",void 0);n.__decorate([q.property()],m.prototype,"stopSymbols",null);n.__decorate([q.property()],m.prototype,"unit",null);n.__decorate([q.property()],m.prototype,"view",null);n.__decorate([q.property({type:L})],m.prototype,"viewModel",void 0);n.__decorate([q.property()],m.prototype,"visibleElements",
void 0);n.__decorate([V.cast("visibleElements")],m.prototype,"castVisibleElements",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleStopIconClick",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleClearRouteClick",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleReverseStops",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleRemoveStop",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleSectionToggle",null);n.__decorate([A.accessibleHandler()],
m.prototype,"_handleSummaryInteraction",null);n.__decorate([A.accessibleHandler()],m.prototype,"_handleManeuverClick",null);return m=n.__decorate([W.subclass("esri.widgets.Directions")],m)});