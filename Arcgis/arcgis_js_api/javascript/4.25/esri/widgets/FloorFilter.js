// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/events ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./FloorFilter/FloorFilterViewModel ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),function(v,l,k,A,B,m,F,G,C,D,w,q,n,x,e,y){const E=["ArrowUp","ArrowDown","End",
"Home"];k=function(z){function r(a,b){var c=z.call(this,a,b)||this;c._activeMenu=null;c._activeMenuIndex={levels:-1,menuItems:-1};c._baseNode=null;c._facilitiesListNode=null;c._levelsListNode=null;c._sitesListNode=null;c._searchInput=null;c.viewModel=new w;c.messages=null;c.messagesCommon=null;c.headingLevel=2;c._resizeObserver=new ResizeObserver(()=>c.scheduleRender());c.addHandles(B.watch(()=>c._searchInput,()=>c._focusSearch()));return c}v._inheritsLoose(r,z);var g=r.prototype;g.destroy=function(){this._resizeObserver.disconnect()};
g.updateWebDocument=function(a){return this.viewModel.updateWebDocument(a)};g.render=function(){var {longNames:a}=this;a=a&&this.viewModel.isNormalMode?"expanded":"collapsed";var b=this.renderButtons();const c=this.renderFilterMenu(),f=e.tsx("div",{class:this.classes("esri-floor-filter__separator")});var d=this._getComponentPosition();const h=this._getPosition(d),p="top-right"===d||"bottom-right"===d,t="top-left"===d||"bottom-left"===d,u=n.isRTL(this.container);d=u&&t||!u&&p?c:b;b=u&&t||!u&&p?b:c;
return e.tsx("div",{afterCreate:this._afterBaseNodeCreate,key:"floor-filter-menu",class:this.classes("esri-floor-filter","esri-widget",`${"esri-floor-filter__layout--"}${a}`,`${"esri-floor-filter__position--"}${h}`)},d,this.viewModel?.filterMenuOpen&&f,b)};g.renderButtons=function(){const a=this._getComponentPosition(),b=[];"top"===this._getPosition(a)?(b.push(this.renderBrowseButton()),b.push(this.renderLevelButtons()),b.push(this.renderCloseLevelsButton()),b.push(this.renderZoomButton()),b.push(this.renderCollapseToggleButton())):
(b.push(this.renderCollapseToggleButton()),b.push(this.renderZoomButton()),b.push(this.renderCloseLevelsButton()),b.push(this.renderLevelButtons()),b.push(this.renderBrowseButton()));return e.tsx("div",{key:"button-container",class:this.classes("esri-widget","esri-floor-filter__button-container")},b)};g.renderBrowseButton=function(){const {longNames:a,messages:b}=this;return e.tsx("button",{key:"browse-button",title:b.buttons.browse,bind:this,class:this.classes("esri-widget","esri-widget--button",
"esri-interactive",("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&"esri-button--disabled","esri-floor-filter__browse-button",this.viewModel?.filterMenuOpen&&"esri-widget--button-active"),"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":b.buttons.browse,onclick:this._toggleFilterMenu,type:"button"},e.tsx("div",{class:this.classes("esri-floor-filter__button-info")},e.tsx("span",{class:this.classes("esri-icon","esri-icon-urban-model")}),e.tsx("span",{class:this.classes("esri-floor-filter__button-label")},
a&&this.viewModel.isNormalMode&&b.buttons.browse)))};g.renderLevelButtons=function(){if(!this.viewModel?.filterFeatures?.levels?.levelsInfo||!this.facility)return null;const {facility:a,messagesCommon:b,messages:c}=this;var f=this.viewModel?.getFacility(a);const d=(this.viewModel?.getFacilityLevels(a)).map(h=>this.renderLevelButton(h));if(!d.length)return null;f=f&&y.substitute(c.selector.levelsLabel,{name:`"${f.name}"`});if(this._isWebScene(this.view.map)&&1<d?.length){const h=this.renderLevelButton({id:`all--${a}`,
facilityId:a,shortName:b.all,longName:b.all,levelNumber:null,verticalOrder:null});d.push(h)}return e.tsx("ul",{key:"levels-button-container",class:this.classes("esri-floor-filter__levels-container"),bind:this,"data-id":"levels",afterCreate:n.storeNode,"data-node-ref":"_levelsListNode","aria-label":f,onkeydown:this._handleListKeydown},d)};g.renderLevelButton=function(a){var {longNames:b}=this;const {shortName:c,longName:f,id:d}=a;a=this.level===d;b=b&&this.viewModel.isNormalMode?f:c;return this.viewModel.isNormalMode||
a||this.viewModel.levelsExpanded?e.tsx("li",{key:`levels--${d}`},e.tsx("button",{"data-id":d,"data-list-id":"levels",bind:this,class:this.classes("esri-widget--button",a?"esri-widget--button-active":null,"esri-interactive","esri-floor-filter__level-button"),onclick:this._levelSelected,onfocus:this._onItemFocus,type:"button"},b)):null};g.renderCloseLevelsButton=function(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const {messagesCommon:a}=this;return e.tsx("button",
{key:"close-levels-button",title:a.close,bind:this,class:this.classes("esri-widget","esri-widget--button","esri-interactive","esri-floor-filter__close-levels-button"),"aria-label":a.close,onclick:this._closeLevels,type:"button"},e.tsx("div",{class:this.classes("esri-floor-filter__button-info")},e.tsx("span",{class:this.classes("esri-icon","esri-icon-close")})))};g.renderZoomButton=function(){const {longNames:a,messages:b,facility:c,site:f}=this,d=this.viewModel?.filterMenuType,h=this.viewModel?.filterMenuOpen,
p=this.viewModel?.getSite(f),t=this.viewModel?.getFacility(c);return e.tsx("button",{key:"zoom-button",title:b.buttons.zoomTo,bind:this,class:this.classes("esri-widget","esri-widget--button",("site"===d&&h?!p:!t)&&"esri-button--disabled","esri-interactive",0<this.viewModel?.getFacilityLevels(c).length?"esri-floor-filter__zoom-button--levels":"esri-floor-filter__zoom-button"),"aria-label":b.buttons.zoomTo,onclick:this._zoomToClicked,type:"button"},e.tsx("div",{class:this.classes("esri-floor-filter__button-info")},
e.tsx("span",{class:this.classes("esri-icon","esri-icon-zoom-to-object")}),e.tsx("span",{class:this.classes("esri-floor-filter__button-label")},a&&this.viewModel.isNormalMode&&b.buttons.zoomTo)))};g.renderCollapseToggleButton=function(){const {longNames:a,messagesCommon:b}=this,c=this.classes("esri-icon",a?"esri-icon-collapse":"esri-icon-expand"),f=a?b.collapse:b.expand;return e.tsx("button",{key:"minimize-toggle-button",title:f,bind:this,class:this.classes("esri-widget","esri-widget--button","esri-interactive",
"esri-floor-filter__minimize-toggle-button"),"aria-label":f,onclick:this._toggleCollapsed,type:"button"},e.tsx("div",{class:this.classes("esri-floor-filter__button-info")},e.tsx("span",{class:c}),e.tsx("span",{class:this.classes("esri-floor-filter__button-label")},a&&this.viewModel.isNormalMode&&b.collapse)))};g.renderFilterMenu=function(){return this.viewModel?.filterMenuOpen?"site"===this.viewModel?.filterMenuType?this.renderSiteFilterMenu():"facility"===this.viewModel?.filterMenuType?this.renderFacilityFilterMenu():
null:null};g.renderSiteFilterMenu=function(){const {messages:a,messagesCommon:b}=this;var c=this.site?this.viewModel?.getSite(this.site)?.name:a.selector.selectSite;c=e.tsx("div",{key:"filter-menu-site-header",class:this.classes("esri-floor-filter__filter-menu-header")},e.tsx("div",{class:this.classes("esri-floor-filter__filter-menu-header-text-group")},e.tsx(q.Heading,{level:this.headingLevel,class:this.classes("esri-floor-filter__filter-menu-header-text")},c)),e.tsx("button",{bind:this,title:b.close,
class:this.classes("esri-icon","esri-icon-close"),onclick:this._closeClicked,type:"button"}));const f=this.renderSearchInput(),d=this.renderSiteItems();return e.tsx("div",{key:"filter-menu-site",class:this.classes("esri-floor-filter__filter-menu")},c,f,d)};g.renderFacilityFilterMenu=function(){const {messages:a,messagesCommon:b,site:c}=this;var f=this.viewModel?.getSite(c)?.name,d=this.facility&&this.viewModel?.getFacility(this.facility)?.name||a.selector.selectFacility,h=this.viewModel.hasMultipleSites?
e.tsx("button",{bind:this,title:b.back,class:this.classes("esri-floor-filter__filter-menu-header-back"),onclick:this._backClicked,type:"button"},e.tsx("span",{class:this.classes(n.isRTL(this.container)?"esri-icon-right":"esri-icon-left")})):null;f=this.viewModel.hasMultipleSites?e.tsx(q.Heading,{level:q.incrementHeadingLevel(this.headingLevel),class:this.classes("esri-floor-filter__filter-menu-header-subtext")},f):null;d=e.tsx("div",{key:"filter-menu-site-header",class:this.classes("esri-floor-filter__filter-menu-header")},
h,e.tsx("div",{class:this.classes("esri-floor-filter__filter-menu-header-text-group")},e.tsx(q.Heading,{level:this.headingLevel,class:this.classes("esri-floor-filter__filter-menu-header-text")},d),f),e.tsx("button",{bind:this,title:b.close,class:this.classes("esri-icon","esri-icon-close"),onclick:this._closeClicked,type:"button"}));h=this.renderSearchInput();f=this.renderFacilityItems();return e.tsx("div",{key:"filter-menu-facility",class:this.classes("esri-floor-filter__filter-menu")},d,h,f)};g.renderSearchInput=
function(){const {messagesCommon:a}=this;return e.tsx("div",{key:"filter-menu-search",class:this.classes("esri-floor-filter__filter-menu-search")},e.tsx("span",{class:this.classes("esri-icon","esri-icon-search")}),e.tsx("input",{bind:this,key:"filter-menu-search__input",afterCreate:n.storeNode,"data-node-ref":"_searchInput",class:this.classes("esri-floor-filter__filter-menu-search-input"),placeholder:a.search,oninput:this._onSearchChange,onpaste:this._onSearchChange,value:this.viewModel.searchTerm}))};
g.renderBlueCircle=function(){return e.tsx("span",{key:"floor-filter__selected-item-circle",class:this.classes("esri-floor-filter__selected-item-circle")})};g.renderSiteItems=function(){if(!this.viewModel?.filterFeatures?.sites?.sitesInfo)return null;const {messages:a}=this,b=this.viewModel.filterSites(this.viewModel.filterFeatures.sites.sitesInfo).map(f=>this.renderSiteItem(f)),c=0===b.length&&this.viewModel?.searchTerm&&e.tsx("div",{class:this.classes("esri-widget__content--empty")},a.noResults);
return e.tsx("ul",{key:"filter-menu-items--sites",class:this.classes("esri-floor-filter__filter-menu-items"),bind:this,afterCreate:n.storeNode,"data-node-ref":"_sitesListNode","data-id":"sites",onkeydown:this._handleListKeydown,tabIndex:-1,"aria-label":a.selector.sitesLabel},b,c)};g.renderSiteItem=function(a){const {name:b,id:c}=a;a=this.site===c;return e.tsx("li",{key:`filter-menu-site--${c}`},e.tsx("button",{"data-id":c,"data-list-id":"sites",bind:this,class:this.classes("esri-floor-filter__filter-menu-site"),
onclick:this._siteSelected,onfocus:this._onItemFocus,type:"button"},a&&this.renderBlueCircle(),e.tsx("span",{class:this.classes(a?"esri-floor-filter__filter-menu-item-name--selected":"esri-floor-filter__filter-menu-item-name")},b),e.tsx("span",{class:this.classes(n.isRTL(this.container)?"esri-icon-left":"esri-icon-right")})))};g.renderFacilityItems=function(){if(!this.viewModel?.filterFeatures?.facilities?.facilitiesInfo)return null;const {messages:a,site:b}=this;var c=this.viewModel.getSite(b);const f=
this.viewModel.filterFacilities(this.viewModel.filterFeatures.facilities.facilitiesInfo).map(h=>this.renderFacilityItem(h)),d=0===f.length&&this.viewModel?.searchTerm&&e.tsx("div",{class:this.classes("esri-widget__content--empty")},a.noResults);c=c?y.substitute(a.selector.siteFacilitiesLabel,{name:`"${c.name}"`}):a.selector.facilitiesLabel;return e.tsx("ul",{key:"filter-menu-items--facilities",class:this.classes("esri-floor-filter__filter-menu-items"),bind:this,afterCreate:n.storeNode,"data-node-ref":"_facilitiesListNode",
"data-id":"facilities",onkeydown:this._handleListKeydown,tabIndex:-1,"aria-label":c},f,d)};g.renderFacilityItem=function(a){const {name:b,id:c}=a;a=this.facility===c;return e.tsx("li",{key:`filter-menu-facility--${c}`},e.tsx("button",{"data-id":c,"data-list-id":"facilities",bind:this,class:this.classes("esri-floor-filter__filter-menu-facility"),onclick:this._facilitySelected,onfocus:this._onItemFocus,type:"button"},a&&this.renderBlueCircle(),e.tsx("span",{class:this.classes(a?"esri-floor-filter__filter-menu-item-name--selected":
"esri-floor-filter__filter-menu-item-name")},b)))};g._afterBaseNodeCreate=function(a){this._baseNode&&this._resizeObserver?.unobserve(this._baseNode);this._baseNode=a;this._resizeObserver?.observe(this._baseNode)};g._toggleCollapsed=function(){this.longNames=!this.longNames};g._toggleFilterMenu=function(){this.viewModel.filterMenuOpen=!(this.viewModel?.filterMenuOpen??!1)};g._setFilterMenuType=function(a){this.viewModel.filterMenuType=a};g._zoomToClicked=function(){if(this.site&&"site"===this.viewModel?.filterMenuType&&
this.viewModel?.filterMenuOpen){var a=this.viewModel?.getSite(this.site);this.viewModel.goTo(a)}else this.facility?(a=this.viewModel?.getFacility(this.facility),this.viewModel.goTo(a)):this.site&&(a=this.viewModel?.getSite(this.site),this.viewModel.goTo(a))};g._onSearchChange=function(a){a=a.target;""===a.value?this.viewModel.searchTerm=null:a.value&&this.viewModel?.searchTerm!==a.value&&(this.viewModel.searchTerm=a.value.toLowerCase().trim())};g._closeClicked=function(){this.viewModel.searchTerm=
null;this.viewModel.filterMenuOpen=!1};g._backClicked=function(){this._setFilterMenuType("site");this.viewModel.searchTerm=null};g._siteSelected=function(a){a=a.currentTarget.getAttribute("data-id");const b=this.viewModel.getSite(a);let c=!1;this.site!==a&&(this.level=this.facility=null,c=!0,this.viewModel.levelsExpanded=!1);this.site=a;this.viewModel.searchTerm=null;this._setFilterMenuType("facility");this.viewModel.goTo(b);c&&this.viewModel.setFloors(null)};g._facilitySelected=function(a){a=a.currentTarget.getAttribute("data-id");
var b=this.viewModel.getFacility(a),c=!1;this.facility!==a&&(this.level="base-floors"===this.viewModel.filterMode?(c=this.viewModel?.getBaseLevel(b))?c.id:null:null,c=!0,this.viewModel.levelsExpanded=!1);this.facility=a;this.viewModel.goTo(b);c&&(b=this.viewModel.getLevel(this.level),this.viewModel.setFloors(b));!this.viewModel.isNormalMode&&1<this.viewModel.getFacilityLevels(a)?.length&&(this.viewModel.levelsExpanded=!0);setTimeout(()=>this._focusActiveLevel(),50)};g._levelSelected=function(a){this.level=
a.currentTarget.getAttribute("data-id")};g._closeLevels=function(){this.viewModel.levelsExpanded=!1};g._isWebScene=function(a){return"esri.WebScene"===a.declaredClass};g._getComponentPosition=function(){return this.view?.ui?.getPosition(this.container)};g._getPosition=function(a){switch(a){case "bottom-right":case "bottom-left":return"bottom";default:return"top"}};g._handleListKeydown=function(a){var b=a.currentTarget.getAttribute("data-id");let c=null;"sites"===b||"facilities"===b?(this._activeMenu!==
b&&(this._activeMenuIndex.menuItems=-1),this._activeMenu=b,c="menuItems"):"levels"===b&&(c="levels");var f="sites"===b?this._sitesListNode:"facilities"===b?this._facilitiesListNode:"levels"===b?this._levelsListNode:null;b=A.eventKey(a);const d="Tab"===b,h=E.includes(b);h&&a.preventDefault();(f=f?.getElementsByTagName("li"))&&0!==f.length&&(h||d)&&this._handleItemNavigation(b,a.shiftKey,f,d,c)};g._handleItemNavigation=function(a,b,c,f,d){if(d){this._activeMenuIndex[d]===c.length&&this._activeMenuIndex[d]--;
-1===this._activeMenuIndex[d]&&this._activeMenuIndex[d]++;var h=this._activeMenuIndex[d];switch(a){case "Home":this._activeMenuIndex[d]=0;break;case "End":this._activeMenuIndex[d]=c.length-1;break;case "ArrowUp":this._activeMenuIndex[d]=0>=this._activeMenuIndex[d]?c.length-1:this._activeMenuIndex[d]-1;break;case "ArrowDown":this._activeMenuIndex[d]=this._activeMenuIndex[d]===c.length-1?0:this._activeMenuIndex[d]+1}"Tab"===a&&b&&0<=this._activeMenuIndex[d]&&this._activeMenuIndex[d]--;"Tab"===a&&!b&&
this._activeMenuIndex[d]<c.length&&this._activeMenuIndex[d]++;h!==this._activeMenuIndex[d]&&-1<this._activeMenuIndex[d]&&this._activeMenuIndex[d]<c.length&&!f&&(a=c[this._activeMenuIndex[d]].getElementsByTagName("button"),(1===a?.length&&a[0])?.focus())}};g._focusSearch=function(){this._searchInput?.focus()};g._focusActiveLevel=function(){const {level:a}=this;var b=this._levelsListNode;const c=b?.getElementsByTagName("li");if(a&&b&&c){b=this._facilitiesListNode?.getElementsByTagName("li");this._activeMenuIndex.menuItems=
b?b.length-1:-1;b=[];for(let f=0;f<c.length;f++){const d=c[f].getElementsByTagName("button");1===d?.length&&b.push(d[0])}b.forEach((f,d)=>{f.getAttribute("data-id")===a&&(f.focus(),this._activeMenuIndex.levels=d)})}};g._onItemFocus=function(a){var b=a.currentTarget;a=b.getAttribute("data-list-id");const c=b.getAttribute("data-id");if(b="sites"===a?this._sitesListNode:"facilities"===a?this._facilitiesListNode:"levels"===a?this._levelsListNode:null)if(b=b?.getElementsByTagName("li")){var f=[];Array.from(b).forEach(h=>
{h=h.getElementsByTagName("button");1===h?.length&&f.push(h[0])});var d=null;switch(a){case "sites":case "facilities":d="menuItems";break;case "levels":d="levels"}d&&f.forEach((h,p)=>{h.getAttribute("data-id")===c&&this._activeMenuIndex[d]!==p&&(this._activeMenuIndex[d]=p)})}};v._createClass(r,[{key:"enabled",get:function(){return this.viewModel.enabled},set:function(a){this.viewModel.enabled=a}},{key:"longNames",get:function(){return this.viewModel.longNames},set:function(a){this.viewModel.longNames=
a}},{key:"minimized",get:function(){return this.viewModel.minimized},set:function(a){this.viewModel.minimized=a}},{key:"pinnedLevels",get:function(){return this.viewModel.pinnedLevels},set:function(a){this.viewModel.pinnedLevels=a}},{key:"site",get:function(){return this.viewModel.site},set:function(a){this.viewModel.site=a}},{key:"facility",get:function(){return this.viewModel.facility},set:function(a){this.viewModel.facility=a}},{key:"level",get:function(){return this.viewModel.level},set:function(a){this.viewModel.level=
a}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(a){this.viewModel.goToOverride=a}}]);return r}(D);l.__decorate([m.property()],k.prototype,"_searchInput",void 0);l.__decorate([m.property()],k.prototype,"enabled",null);l.__decorate([m.property()],k.prototype,"longNames",null);l.__decorate([m.property()],k.prototype,"minimized",null);l.__decorate([m.property()],k.prototype,
"pinnedLevels",null);l.__decorate([m.property()],k.prototype,"site",null);l.__decorate([m.property()],k.prototype,"facility",null);l.__decorate([m.property()],k.prototype,"level",null);l.__decorate([m.property()],k.prototype,"view",null);l.__decorate([m.property({type:w})],k.prototype,"viewModel",void 0);l.__decorate([m.property(),x.messageBundle("esri/widgets/FloorFilter/t9n/FloorFilter")],k.prototype,"messages",void 0);l.__decorate([m.property(),x.messageBundle("esri/t9n/common")],k.prototype,"messagesCommon",
void 0);l.__decorate([m.property()],k.prototype,"goToOverride",null);l.__decorate([m.property()],k.prototype,"headingLevel",void 0);return k=l.__decorate([C.subclass("esri.widgets.FloorFilter")],k)});