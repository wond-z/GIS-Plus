// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(l,n,g,e,v,w,k,h,H,x,y,z,q,A,B,r,f,C){const t={title:!0,description:!0};e=function(u){function m(a,b){var d=u.call(this,a,b)||this;d._featureElementInfo=null;d._relatedFeatureIntersectionObserver=new IntersectionObserver(([p])=>{p?.isIntersecting&&d._increaseFeaturePage()},{root:window.document});d.headingLevel=2;d.viewModel=new q;d.messages=null;d.messagesCommon=null;d.visibleElements={...t};d._increaseFeaturePage=()=>{const {state:p,showAllEnabled:D,relatedFeatures:E,featuresPerPage:F,featurePage:G}=
d.viewModel;"ready"===p&&D&&E.length>=F*G&&d.viewModel.featurePage++};return d}n._inheritsLoose(m,u);var c=m.prototype;c.initialize=function(){this._featureElementInfo=new A;this.addHandles([k.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),k.initial),k.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),k.on(()=>this.viewModel.relatedFeatureViewModels,
"change",()=>this._setupRelatedFeatureViewModels())])};c.loadDependencies=function(){return Promise.all([new Promise((a,b)=>l(["../../chunks/calcite-list"],a,b)),new Promise((a,b)=>l(["../../chunks/calcite-list-item"],a,b)),new Promise((a,b)=>l(["../../chunks/calcite-icon"],a,b)),new Promise((a,b)=>l(["../../chunks/calcite-notice"],a,b))])};c.destroy=function(){this._unobserveRelatedFeatureObserver();this._featureElementInfo=v.destroyMaybe(this._featureElementInfo)};c.castVisibleElements=function(a){return{...t,
...a}};c.renderStickyLoading=function(){return"querying"===this.viewModel.state?f.tsx("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null};c.renderLoadingIcon=function(){return f.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})};c.renderLoading=function(){return f.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},this.renderLoadingIcon())};c.renderShowAllIconNode=
function(){return f.tsx("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})};c.renderChevronIconNode=function(){const a=B.isRTL(this.container)?"chevron-left":"chevron-right";return f.tsx("calcite-icon",{scale:"s",icon:a,slot:"content-end"})};c.renderRelatedFeature=function(a){var {itemDescriptionFieldName:b}=this.viewModel;const d=a.title;a.description=b&&a.formattedAttributes?.global[b];b="loading"===a.state;return f.tsx("calcite-list-item",{key:a.uid,label:b?`${this.messagesCommon?.loading}\u2026`:
d,description:b?"\u2026":a.description,onclick:()=>this.emit("select-record",{featureViewModel:a})},this.renderChevronIconNode())};c.renderShowAllListItem=function(){return this.displayShowAllButton?f.tsx("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,onclick:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null};c.renderNoRelatedFeaturesMessage=function(){return f.tsx("calcite-notice",{key:"no-related-features-message",
icon:"information",open:!0,color:"blue",scale:"s",width:"full"},f.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))};c.renderFeatureObserver=function(){return f.tsx("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})};c.renderList=function(){const {relatedFeatureViewModels:a}=this.viewModel;return f.tsx("calcite-list",null,a.toArray().map(b=>this.renderRelatedFeature(b)),this.renderShowAllListItem())};
c.renderRelatedFeatures=function(){const {displayListItems:a}=this,{state:b}=this.viewModel;return f.tsx("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===b})},a?this.renderList():"ready"===b?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())};c.renderRelationshipNotFound=function(){return f.tsx("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",
open:!0,color:"red",scale:"s",width:"full"},f.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))};c.render=function(){const {state:a}=this.viewModel;return f.tsx("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===a?this.renderLoading():"disabled"===a?this.renderRelationshipNotFound():this.renderRelatedFeatures())};c._setupRelatedFeatureViewModels=function(){const {relatedFeatureViewModels:a}=this.viewModel;this.removeHandles("related-feature-viewmodels");
a?.forEach(b=>{this.addHandles(k.watch(()=>[b.title,b.state],()=>this.scheduleRender(),k.initial),"related-feature-viewmodels")});this.scheduleRender()};c._setupFeatureElementInfo=function(){const {headingLevel:a,visibleElements:b}=this;this._featureElementInfo.set({description:b.description&&this.description,title:b.title&&this.title,headingLevel:a})};c._handleRelatedFeatureObserverChange=function(){var a=n._asyncToGenerator(function*(){this._unobserveRelatedFeatureObserver();const {state:b,showAllEnabled:d}=
this.viewModel;yield w.after(0);this._relatedFeatureIntersectionObserverNode&&"ready"===b&&d&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)});return function(){return a.apply(this,arguments)}}();c._relatedFeatureIntersectionObserverCreated=function(a){this._relatedFeatureIntersectionObserverNode=a};c._unobserveRelatedFeatureObserver=function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)};
n._createClass(m,[{key:"displayShowAllButton",get:function(){const {showAllEnabled:a,featureCount:b,displayCount:d}=this.viewModel;return!a&&(b>d||0===d)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}},{key:"description",get:function(){return this.viewModel.description},set:function(a){this.viewModel.description=a}},{key:"featureCountDescription",get:function(){const {messages:a}=this,{featureCount:b}=this.viewModel;return C.substitute(1===
b?a?.numberRecord:a?.numberRecords,{number:b})}},{key:"title",get:function(){return this.viewModel.title},set:function(a){this.viewModel.title=a}}]);return m}(z);g.__decorate([h.property()],e.prototype,"_relatedFeatureIntersectionObserverNode",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"displayShowAllButton",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"displayListItems",null);g.__decorate([h.property()],e.prototype,"description",null);g.__decorate([h.property({readOnly:!0})],
e.prototype,"featureCountDescription",null);g.__decorate([h.property()],e.prototype,"headingLevel",void 0);g.__decorate([h.property()],e.prototype,"title",null);g.__decorate([h.property({type:q})],e.prototype,"viewModel",void 0);g.__decorate([h.property(),r.messageBundle("esri/widgets/Feature/t9n/Feature")],e.prototype,"messages",void 0);g.__decorate([h.property(),r.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);g.__decorate([h.property()],e.prototype,"visibleElements",void 0);
g.__decorate([x.cast("visibleElements")],e.prototype,"castVisibleElements",null);return e=g.__decorate([y.subclass("esri.widgets.Feature.FeatureRelationship")],e)});