// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),function(z,k,f,m,H,D,E,F,G,l,A){const B={chartAnimation:!0};f=function(C){function y(a){a=
C.call(this,a)||this;a.abilities={...B};a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.expressionAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}z._inheritsLoose(y,C);var q=y.prototype;q.castAbilities=function(a){return{...B,...a}};q.setActiveMedia=function(a){this._setContentElementMedia(a)};q.next=function(){this._pageContentElementMedia(1)};q.previous=function(){this._pageContentElementMedia(-1)};
q._setContentElementMedia=function(a){const {formattedMediaInfoCount:d}=this;this.activeMediaInfoIndex=(a+d)%d};q._pageContentElementMedia=function(a){const {activeMediaInfoIndex:d}=this;this._setContentElementMedia(d+a)};q._formatMediaInfos=function(){const {attributes:a,mediaInfos:d,formattedAttributes:e,expressionAttributes:g,fieldInfoMap:n,layer:c}=this;return d?.map(b=>{b=b?.clone();if(!b)return null;b.title=l.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:n,globalAttributes:e,
expressionAttributes:g,layer:c,text:b.title});b.caption=l.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:n,globalAttributes:e,expressionAttributes:g,layer:c,text:b.caption});b.altText=l.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:n,globalAttributes:e,expressionAttributes:g,layer:c,text:b.altText});if("image"===b.type){var {value:r}=b;this._setImageValue({value:r,formattedAttributes:e,layer:c});return b.value.sourceURL?b:void 0}return"pie-chart"===b.type||"line-chart"===
b.type||"column-chart"===b.type||"bar-chart"===b.type?({value:r}=b,this._setChartValue({value:r,chartType:b.type,attributes:a,formattedAttributes:e,layer:c,expressionAttributes:g}),b):null}).filter(Boolean)};q._setImageValue=function(a){const {fieldInfoMap:d}=this,{value:e,formattedAttributes:g,layer:n}=a,{linkURL:c,sourceURL:b}=e;b&&(a=l.fixTokens(b,n),e.sourceURL=l.substituteAttributes({formattedAttributes:g,template:a,fieldInfoMap:d}));c&&(a=l.fixTokens(c,n),e.linkURL=l.substituteAttributes({formattedAttributes:g,
template:a,fieldInfoMap:d}))};q._setChartValue=function(a){const {value:d,attributes:e,formattedAttributes:g,chartType:n,layer:c,expressionAttributes:b}=a,{popupTemplate:r,relatedInfos:w}=this,{fields:u,normalizeField:v}=d;d.fields=l.getFixedFieldNames(u,c);v&&(d.normalizeField=l.getFixedFieldName(v,c));if(u.some(h=>!!(null!=g[h]||l.isRelatedField(h)&&w.size))){var t=r?.fieldInfos;u.forEach(h=>{l.isRelatedField(h)?d.series=[...d.series,...this._getRelatedChartInfos({fieldInfos:t,fieldName:h,formattedAttributes:g,
chartType:n,value:d})]:(h=this._getChartOption({value:d,attributes:e,chartType:n,formattedAttributes:g,expressionAttributes:b,fieldName:h,fieldInfos:t}),d.series.push(h))})}};q._getRelatedChartInfos=function(a){const {fieldInfos:d,fieldName:e,formattedAttributes:g,chartType:n,value:c}=a,b=[];a=A.getRelatedFieldInfo(e);const {layerId:r,fieldName:w}=a;a=this.relatedInfos?.get(r.toString());if(!a)return b;const {relatedFeatures:u,relation:v}=a;if(!v||!u)return b;({cardinality:a}=v);u.forEach(t=>{const {attributes:h}=
t;h&&Object.keys(h).forEach(p=>{p===w&&b.push(this._getChartOption({value:c,attributes:h,formattedAttributes:g,fieldName:e,chartType:n,relatedFieldName:p,fieldInfos:d}))})});return"one-to-many"===a||"many-to-many"===a?b:[b[0]]};q._getTooltip=function({label:a,value:d,chartType:e}){return"pie-chart"===e?`${a}`:`${a}: ${d}`};q._getChartOption=function(a){const {value:d,attributes:e,formattedAttributes:g,expressionAttributes:n,fieldName:c,relatedFieldName:b,fieldInfos:r,chartType:w}=a,{layer:u,fieldInfoMap:v}=
this,{normalizeField:t,tooltipField:h}=d;a=t?l.isRelatedField(t)?e[A.getRelatedFieldInfo(t).fieldName]:e[t]:null;var p=l.isExpressionField(c)&&n&&void 0!==n[c]?n[c]:b&&void 0!==e[b]?e[b]:void 0!==e[c]?e[c]:g[c];a=new G({fieldName:c,value:void 0===p?null:p&&a?p/a:p});if(l.isRelatedField(c)){p=v.get(c.toLowerCase());var x=v.get(h.toLowerCase());a.tooltip=this._getTooltip({label:g[x?.fieldName??h]??p?.label??p?.fieldName??b,value:g[p?.fieldName??c],chartType:w});return a}x=l.getFieldInfo(r,c);p=l.getFixedFieldName(c,
u);x=h&&void 0!==g[h]?g[h]:l.getFieldInfoLabel(x||new F({fieldName:p}),this.popupTemplate?.expressionInfos);a.tooltip=this._getTooltip({label:x,value:g[p],chartType:w});return a};z._createClass(y,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return y}(f);k.__decorate([m.property()],
f.prototype,"abilities",void 0);k.__decorate([D.cast("abilities")],f.prototype,"castAbilities",null);k.__decorate([m.property()],f.prototype,"activeMediaInfoIndex",void 0);k.__decorate([m.property({readOnly:!0})],f.prototype,"activeMediaInfo",null);k.__decorate([m.property()],f.prototype,"attributes",void 0);k.__decorate([m.property()],f.prototype,"description",void 0);k.__decorate([m.property()],f.prototype,"fieldInfoMap",void 0);k.__decorate([m.property()],f.prototype,"formattedAttributes",void 0);
k.__decorate([m.property()],f.prototype,"expressionAttributes",void 0);k.__decorate([m.property({readOnly:!0})],f.prototype,"formattedMediaInfos",null);k.__decorate([m.property()],f.prototype,"layer",void 0);k.__decorate([m.property({readOnly:!0})],f.prototype,"formattedMediaInfoCount",null);k.__decorate([m.property()],f.prototype,"mediaInfos",void 0);k.__decorate([m.property()],f.prototype,"popupTemplate",void 0);k.__decorate([m.property()],f.prototype,"relatedInfos",void 0);k.__decorate([m.property()],
f.prototype,"title",void 0);return f=k.__decorate([E.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],f)});