// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/maybe ../../core/reactiveUtils ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/Error ../../core/has ../../core/accessorSupport/decorators/subclass ./CreateWorkflowData ./Edits ./Workflow ./workflowUtils".split(" "),function(b,A,y,B,t,H,I,J,K,C,D,E,F,f){var u;t=u=function(z){function q(c){c=z.call(this,c)||this;c.type="create";return c}b._inheritsLoose(q,z);q.create=function(c,
v,a){c=new u({data:new D({edits:new E.Edits,viewModel:c}),onCommit:function(){var k=b._asyncToGenerator(function*(g){yield a(g.creationInfo.layer,{addFeatures:[g.edits.feature]})});return function(g){return k.apply(this,arguments)}}()});c._set("steps",this._createWorkflowSteps(c,v));return c};q._createWorkflowSteps=function(c,v="awaiting-feature-creation-info"){const {data:a,handles:k}=c,g=new Map;c=f.createWorkflowSteps(["awaiting-feature-creation-info","awaiting-feature-to-create","editing-new-feature",
"adding-attachment","editing-attachment"],v,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",setUp(){var e=this;return b._asyncToGenerator(function*(){a.creationInfo=null;a.edits.feature=null;a.viewModel.featureTemplatesViewModel.select(null);k.add(a.viewModel.featureTemplatesViewModel.on("select",({item:d})=>{a.creationInfo={layer:d.layer,template:d.template};a.viewModel.activeWorkflow.next()}),e.id)})()},tearDown(){var e=this;return b._asyncToGenerator(function*(){k.remove(e.id)})()}}),
"awaiting-feature-to-create":()=>({id:"awaiting-feature-to-create",setUp(){var e=this;return b._asyncToGenerator(function*(){k.add(yield f.setUpFeatureAdd(a.viewModel.sketchViewModel,a.creationInfo,d=>{a.edits.feature=d;a.viewModel.activeWorkflow.next()},g),e.id)})()},tearDown(){var e=this;return b._asyncToGenerator(function*(){k.remove(e.id)})()}}),"editing-new-feature":()=>({id:"editing-new-feature",setUp(){var e=this;return b._asyncToGenerator(function*(){const d=a.edits.feature,w=d.sourceLayer,
n=a.viewModel,p=n.sketchViewModel;var x=f.findLayerInfo(n.layerInfos,w);const {spatialReference:G}=n.view;n.featureFormViewModel.set({arcadeEditType:"INSERT",feature:d,formTemplate:x?.formTemplate,spatialReference:G});p.allowDeleteKey=!1;const l=f.getVisualVariableAttributes(d);yield f.startUpdatingFeature(p,d,w,l,g);x=p.on("update",function(){var r=b._asyncToGenerator(function*(m){var h=m.graphics[0];if("complete"===m.state)return f.startUpdatingFeature(p,h,w,l,g);yield f.visualVariableInteractiveUpdate(p.view,
h,m,l,g);m=h.attributes;y.isSome(l.rotation)&&({field:h}=l.rotation,n.featureFormViewModel.setValue(h,m[h]));y.isSome(l.size)&&({field:h}=l.size,n.featureFormViewModel.setValue(h,m[h]))});return function(m){return r.apply(this,arguments)}}());k.add([a.viewModel.featureFormViewModel.on("value-change",b._asyncToGenerator(function*(){a.edits.updateAttributes(a.viewModel.featureFormViewModel.getValues());d.attributes=a.edits.feature.attributes;"3d"===p.view.type&&(yield f.updateGraphicSymbolWhenRequired(d,
g))})),x,B.watch(()=>a.viewModel.attachmentsViewModel.mode,r=>{"add"===r&&a.viewModel.activeWorkflow.go("adding-attachment");"edit"===r&&a.viewModel.activeWorkflow.go("editing-attachment")})],e.id)})()},tearDown(e){var d=this;return b._asyncToGenerator(function*(){e.cancelled&&a.viewModel.sketchViewModel.layer.removeAll();k.remove(d.id)})()}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-new-feature",setUp(){return b._asyncToGenerator(function*(){})()},tearDown(){return b._asyncToGenerator(function*(){a.viewModel.attachmentsViewModel.mode=
"view"})()}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-new-feature",setUp(){return b._asyncToGenerator(function*(){})()},tearDown(){return b._asyncToGenerator(function*(){a.viewModel.attachmentsViewModel.mode="view"})()}})});return f.avoidFeatureTemplateSelectionWithOnlyOneItem(a,c)};return q}(F);return t=u=A.__decorate([C.subclass("esri.widgets.Editor.CreateWorkflow")],t)});