// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/memoize ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../support/elevationInfoUtils ./support/constants ./support/geometryUtils ./support/profileUtils".split(" "),
function(g,r,p,G,H,I,J,h,u,x,v,K,t,P,Q,L,B,y,C,M){g.ElevationProfileController=function(D){function w(a){var b=D.call(this,a)||this;b._handles=new I;b._updateTask=null;b._paramsPerProfile=new Map;b._getUpdateParametersMemoized=u.memoize((c,d,e)=>({stationary:c,visibleProfiles:d,generationParameters:e}));b._getGenerationParametersMemoized=u.memoize((c,d,e,q,m,n,k)=>C.isPolyline(d)&&C.isValidInputPath(d)&&!h.isNone(q)?{view:c,geometry:d,elevationInfo:e,options:n,queue:q,cache:m,slicePlane:k}:null);
b._getElevationInfoMemoized=u.memoize((c,d)=>({mode:c,offset:d}));b._getOptionsMemoized=u.memoize((c,d,e)=>{const {densificationMaxSamples:q,maxTotalSamples:m}=y.getConfig();return{geodesicDistanceThreshold:c,samplingDistance:d,densificationMaxSamples:Math.round(q/e),maxTotalSamples:m}});b._updateThrottled=K.throttle(c=>x.ignoreAbortErrors(b._update(c)),y.getConfig().updateThrottleMillis);return b}r._inheritsLoose(w,D);var l=w.prototype;l.initialize=function(){const a=this.viewModel;this._handles.add([v.watch(()=>
a.profiles.toArray(),b=>{this._abortUpdate();this._paramsPerProfile.clear();this._handles.remove("line-change");this._handles.add(b.map(c=>J.handlesGroup([c.attach(this.viewModel),c.on("change",()=>{this._invalidateProfile(c)})])),"line-change")},v.syncAndInitial),this._updateThrottled,v.watch(()=>this._updateParameters,this._updateThrottled,v.syncAndInitial)])};l.destroy=function(){this._handles.destroy();this._paramsPerProfile.clear()};l._update=function(){var a=r._asyncToGenerator(function*({stationary:b,
visibleProfiles:c,generationParameters:d}){var e=this;this._abortUpdate();b&&(h.isNone(d)?this._clearResults():this._updateTask=H.createTask(function(){var q=r._asyncToGenerator(function*(m){e.viewModel.error=null;const n=c.filter(f=>!e._isProfileValid(f,d));var k=M.generateProfiles({...d,providers:n},{signal:m});try{var z=!1,E=!1;try{for(var A=r._asyncIterator(k),F;z=!(F=yield A.next()).done;z=!1){const f=F.value;x.throwIfAborted(m);e._clearInvalidResults(d);for(k=0;k<n.length;k++)n[k].result=f[k]}}catch(f){E=
!0;var N=f}finally{try{z&&null!=A.return&&(yield A.return())}finally{if(E)throw N;}}for(const f of n)e._paramsPerProfile.set(f,d)}catch(f){x.throwIfAbortError(f),e._abortUpdate(),e.viewModel.error=f,n.forEach(O=>{O.result=null})}});return function(m){return q.apply(this,arguments)}}()))});return function(b){return a.apply(this,arguments)}}();l._abortUpdate=function(){this._updateTask=h.abortMaybe(this._updateTask)};l._isProfileValid=function(a,b){return this._paramsPerProfile.has(a)&&this._paramsPerProfile.get(a)===
b};l._invalidateProfile=function(a){this._paramsPerProfile.delete(a);this._updateThrottled(this._updateParameters)};l._clearInvalidResults=function(a){for(const b of this.viewModel.profiles.items)this._isProfileValid(b,a)||(b.result=null,this._paramsPerProfile.delete(b))};l._clearResults=function(){for(const a of this.viewModel.profiles.items)a.result=null,this._paramsPerProfile.delete(a)};r._createClass(w,[{key:"_updateParameters",get:function(){var {viewModel:a}=this;a=a.view;return this._getUpdateParametersMemoized(h.isSome(a)?
a.stationary:!0,this.viewModel.visibleProfiles,this._generationParameters)}},{key:"_generationParameters",get:function(){const {view:a,input:b,queue:c,tileCache:d}=this.viewModel;return h.isNone(a)||!a.ready?null:this._getGenerationParametersMemoized(a,h.applySome(b,e=>e.geometry),this._elevationInfo,c,d,this._options,"3d"===a.type?a.slicePlane:null)}},{key:"_elevationInfo",get:function(){const a=h.applySome(this.viewModel.input,b=>B.hasGraphicFeatureExpressionInfo(b)?null:B.getGraphicEffectiveElevationInfo(b));
return h.isSome(a)?this._getElevationInfoMemoized(a.mode,a.offset):null}},{key:"_options",get:function(){const a=this.viewModel,b=a.visibleProfiles.length;let c=h.unwrapOr(a.minDemResolution,y.getConfig().defaultDemResolution);c=parseFloat(c.toFixed(2));return this._getOptionsMemoized(a.geodesicDistanceThreshold,c,b)}}]);return w}(G);p.__decorate([t.property({nonNullable:!0})],g.ElevationProfileController.prototype,"viewModel",void 0);p.__decorate([t.property()],g.ElevationProfileController.prototype,
"_updateParameters",null);p.__decorate([t.property()],g.ElevationProfileController.prototype,"_generationParameters",null);p.__decorate([t.property()],g.ElevationProfileController.prototype,"_elevationInfo",null);p.__decorate([t.property()],g.ElevationProfileController.prototype,"_options",null);g.ElevationProfileController=p.__decorate([L.subclass("esri.widgets.ElevationProfile.ElevationProfileController")],g.ElevationProfileController);Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});