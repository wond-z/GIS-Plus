// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["./has","./ObjectPool"],function(k,m){var h;(function(f){f[f.varint=0]="varint";f[f.fixed64=1]="fixed64";f[f.delimited=2]="delimited";f[f.fixed32=5]="fixed32";f[f.unknown=99]="unknown"})(h||(h={}));const n=new TextDecoder("utf-8"),p=k("safari")||k("ios")?6:k("ff")?12:32;k=function(){function f(a,c,d=0,b=a?a.byteLength:0){this._tag=0;this._dataType=h.unknown;this._init(a,c,d,b)}var e=f.prototype;e._init=function(a,c,d,b){this._data=a;this._dataView=c;this._pos=d;this._end=b};e.asUnsafe=function(){return this};
e.clone=function(){return new f(this._data,this._dataView,this._pos,this._end)};e.pos=function(){return this._pos};e.move=function(a){this._pos=a};e.nextTag=function(a){for(;;){if(this._pos===this._end)return!1;const c=this._decodeVarint();this._tag=c>>3;this._dataType=c&7;if(!a||a===this._tag)break;this.skip()}return!0};e.next=function(){if(this._pos===this._end)return!1;const a=this._decodeVarint();this._tag=a>>3;this._dataType=a&7;return!0};e.empty=function(){return this._pos>=this._end};e.tag=
function(){return this._tag};e.getInt32=function(){return this._decodeVarint()};e.getInt64=function(){return this._decodeVarint()};e.getUInt32=function(){let a=4294967295;a=(this._data[this._pos]&127)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<7)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<14)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<21)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&
15)<<28)>>>0;if(128>this._data[this._pos++])return a};e.getUInt64=function(){return this._decodeVarint()};e.getSInt32=function(){const a=this.getUInt32();if(void 0!==a)return a>>>1^-(a&1)|0};e.getSInt64=function(){return this._decodeSVarint()};e.getBool=function(){const a=0!==this._data[this._pos];this._skip(1);return a};e.getEnum=function(){return this._decodeVarint()};e.getFixed64=function(){var a=this._dataView;const c=this._pos;a=a.getUint32(c,!0)+4294967296*a.getUint32(c+4,!0);this._skip(8);
return a};e.getSFixed64=function(){var a=this._dataView;const c=this._pos;a=a.getUint32(c,!0)+4294967296*a.getInt32(c+4,!0);this._skip(8);return a};e.getDouble=function(){const a=this._dataView.getFloat64(this._pos,!0);this._skip(8);return a};e.getFixed32=function(){const a=this._dataView.getUint32(this._pos,!0);this._skip(4);return a};e.getSFixed32=function(){const a=this._dataView.getInt32(this._pos,!0);this._skip(4);return a};e.getFloat=function(){const a=this._dataView.getFloat32(this._pos,!0);
this._skip(4);return a};e.getString=function(){const a=this._getLength();var c=this._pos;c=this._toString(this._data,c,c+a);this._skip(a);return c};e.getBytes=function(){const a=this._getLength();var c=this._pos;c=this._toBytes(this._data,c,c+a);this._skip(a);return c};e.getLength=function(){return this._getLengthUnsafe()};e.processMessageWithArgs=function(a,c,d,b){const g=this.getMessage();a=a(g,c,d,b);g.release();return a};e.processMessage=function(a){const c=this.getMessage();a=a(c);c.release();
return a};e.getMessage=function(){const a=this._getLength(),c=f.pool.acquire();c._init(this._data,this._dataView,this._pos,this._pos+a);this._skip(a);return c};e.release=function(){f.pool.release(this)};e.dataType=function(){return this._dataType};e.skip=function(){switch(this._dataType){case h.varint:this._decodeVarint();break;case h.fixed64:this._skip(8);break;case h.delimited:this._skip(this._getLength());break;case h.fixed32:this._skip(4);break;default:throw Error("Invalid data type!");}};e.skipLen=
function(a){this._skip(a)};e._skip=function(a){if(this._pos+a>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=a};e._decodeVarint=function(){const a=this._data;let c=this._pos,d=0,b=0;if(10<=this._end-c){if(b=a[c++],d|=b&127,0!==(b&128)&&(b=a[c++],d|=(b&127)<<7,0!==(b&128)&&(b=a[c++],d|=(b&127)<<14,0!==(b&128)&&(b=a[c++],d|=(b&127)<<21,0!==(b&128)&&(b=a[c++],d+=268435456*(b&127),0!==(b&128)&&(b=a[c++],d+=34359738368*(b&127),0!==(b&128)&&(b=a[c++],d+=4398046511104*(b&127),
0!==(b&128)&&(b=a[c++],d+=562949953421312*(b&127),0!==(b&128)&&(b=a[c++],d+=72057594037927936*(b&127),0!==(b&128)&&(b=a[c++],d+=0x7fffffffffffffff*(b&127),0!==(b&128)))))))))))throw Error("Varint too long!");}else{let g=1;for(;c!==this._end;){b=a[c];if(0===(b&128))break;++c;d+=(b&127)*g;g*=128}if(c===this._end)throw Error("Varint overrun!");++c;d+=b*g}this._pos=c;return d};e._decodeSVarint=function(){const a=this._data;let c=this._pos,d=0,b=0;const g=a[c]&1;if(10<=this._end-c){if(b=a[c++],d|=b&127,
0!==(b&128)&&(b=a[c++],d|=(b&127)<<7,0!==(b&128)&&(b=a[c++],d|=(b&127)<<14,0!==(b&128)&&(b=a[c++],d|=(b&127)<<21,0!==(b&128)&&(b=a[c++],d+=268435456*(b&127),0!==(b&128)&&(b=a[c++],d+=34359738368*(b&127),0!==(b&128)&&(b=a[c++],d+=4398046511104*(b&127),0!==(b&128)&&(b=a[c++],d+=562949953421312*(b&127),0!==(b&128)&&(b=a[c++],d+=72057594037927936*(b&127),0!==(b&128)&&(b=a[c++],d+=0x7fffffffffffffff*(b&127),0!==(b&128)))))))))))throw Error("Varint too long!");}else{let l=1;for(;c!==this._end;){b=a[c];
if(0===(b&128))break;++c;d+=(b&127)*l;l*=128}if(c===this._end)throw Error("Varint overrun!");++c;d+=b*l}this._pos=c;return g?-(d+1)/2:d/2};e._getLength=function(){if(this._dataType!==h.delimited)throw Error("Not a delimited data type!");return this._decodeVarint()};e._getLengthUnsafe=function(){return this.getUInt32()};e._toString=function(a,c,d){d=Math.min(this._end,d);if(d-c>p)return a=a.subarray(c,d),n.decode(a);let b="",g="";for(;c<d;++c){const l=a[c];l&128?g+="%"+l.toString(16):(b+=decodeURIComponent(g)+
String.fromCharCode(l),g="")}g.length&&(b+=decodeURIComponent(g));return b};e._toBytes=function(a,c,d){d=Math.min(this._end,d);return new Uint8Array(a.buffer,c,d-c)};return f}();k.pool=new m(k,void 0,f=>{f._data=null;f._dataView=null});return k});