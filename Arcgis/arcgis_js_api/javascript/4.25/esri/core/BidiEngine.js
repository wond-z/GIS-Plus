// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["./bidiEngineTables"],function(g){function x(d,e,a,h,b){var c=d;void 0===e&&(e=b.defInFormat);void 0===a&&(a=b.defOutFormat);void 0===h&&(h=b.defSwap);if(e!==a){var f=e.substring(0,1),k=a.substring(0,1);var l=e.substring(1,4);var m=a.substring(1,4);"C"===l.charAt(0)&&(l=z(c),l="ltr"===l||"rtl"===l?l.toUpperCase():"L"===e.charAt(2)?"LTR":"RTL",e=f+l);"C"===m.charAt(0)&&(l=z(c),"rtl"===l?m="RTL":"ltr"===l?(c=c.split(""),c.reverse(),l=z(c.join("")),m=l.toUpperCase()):m="L"===a.charAt(2)?"LTR":
"RTL",a=k+m)}if(e===a)return d;k=e.substring(0,1);c=e.substring(1,4);f=a.substring(0,1);m=a.substring(1,4);b.inFormat=e;b.outFormat=a;b.swap=h;if("L"===k&&"VLTR"===a){if("LTR"===c)return b.dir=0,w(d,b);if("RTL"===c)return b.dir=1,w(d,b)}if("V"===k&&"V"===f)return b.dir="RTL"===c?1:0,D(d,b);if("L"===k&&"VRTL"===a)return b.dir="LTR"===c?0:1,d=w(d,b),D(d);if("VLTR"===e&&"LLTR"===a)return b.dir=0,w(d,b);if("V"===k&&"L"===f&&c!==m)return d=D(d),"RTL"===c?x(d,"LLTR","VLTR",h,b):x(d,"LRTL","VRTL",h,b);if("VRTL"===
e&&"LRTL"===a)return x(d,"LRTL","VRTL",h,b);"L"===k&&"L"===f&&(e=b.swap,b.swap=e.substr(0,1)+"N","RTL"===c?(b.dir=1,d=w(d,b),b.swap="N"+e.substr(1,2),b.dir=0,d=w(d,b)):(b.dir=0,d=w(d,b),b.swap="N"+e.substr(1,2),d=x(d,"VLTR","LRTL",b.swap,b)));return d}function z(d){return(d=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(d))?"z">=d[0]?"ltr":"rtl":""}function w(d,e){d=d.split("");const a=[];F(d,a,e);if(0!==e.hiLevel&&e.swap.substr(0,1)!==e.swap.substr(1,2))for(let c=
0;c<d.length;c++)if(1===a[c]){var h=c;b:{let f=void 0;var b=d[c];let k=0,l=g.SwapTable.length-1;for(;k<=l;)if(f=Math.floor((k+l)/2),b<g.SwapTable[f][0])l=f-1;else if(b>g.SwapTable[f][0])k=f+1;else{b=g.SwapTable[f][1];break b}}d[h]=b}G(2,d,a,e);G(1,d,a,e);A=a;return d.join("")}function F(d,e,a){const h=d.length;var b=a.dir?g.impTabRtl:g.impTabLtr,c=0,f=-1;const k=[],l=[];a.hiLevel=a.dir;a.lastArabic=!1;a.hasUbatAl=!1;a.hasUbatB=!1;a.hasUbatS=!1;for(var m=0;m<h;m++){var p=m,u=d[m].charCodeAt(0);const n=
g.PrimaryTable[u>>8];k[p]=n<g.TBBASE?n:g.UnicodeTable[n-g.TBBASE][u&255]}for(p=0;p<h;p++){m=O(d,k,l,p,a);l[p]=m;c=b[c][m];u=c&240;c&=15;m=b[c][5];e[p]=m;if(0<u){if(16===u)for(;f<p;f++)e[f]=1;f=-1}if(b[c][6])-1===f&&(f=p);else if(-1<f){for(;f<p;f++)e[f]=m;f=-1}k[p]===g.UBAT_B&&(e[p]=0);a.hiLevel|=m}if(a.hasUbatS)for(d=0;d<h;d++)if(k[d]===g.UBAT_S)for(e[d]=a.dir,b=d-1;0<=b;b--)if(k[b]===g.UBAT_WS)e[b]=a.dir;else break}function D(d,e){d=d.split("");if(e){const a=[];F(d,a,e);A=a}d.reverse();r.reverse();
return d.join("")}function H(d){for(let e=0;e<g.ArabicAlefBetIntervalsBegine.length;e++)if(d>=g.ArabicAlefBetIntervalsBegine[e]&&d<=g.ArabicAlefBetIntervalsEnd[e])return!0;return!1}function I(d,e,a,h){for(;e*a<h&&y(d[e]);)e+=a;return e*a<h&&H(d[e])?!0:!1}function G(d,e,a,h){if(!(h.hiLevel<d))if(1!==d||1!==h.dir||h.hasUbatB){h=e.length;for(var b=0,c,f,k;b<h;){if(a[b]>=d){for(c=b+1;c<h&&a[c]>=d;)c++;for(f=c-1;b<f;b++,f--)k=e[b],e[b]=e[f],e[f]=k,k=r[b],r[b]=r[f],r[f]=k;b=c}b++}}else e.reverse(),r.reverse()}
function O(d,e,a,h,b){return{UBAT_L:()=>{b.lastArabic=!1;return g.UBAT_L},UBAT_R:()=>{b.lastArabic=!1;return g.UBAT_R},UBAT_ON:()=>g.UBAT_ON,UBAT_AN:()=>g.UBAT_AN,UBAT_EN:()=>b.lastArabic?g.UBAT_AN:g.UBAT_EN,UBAT_AL:()=>{b.lastArabic=!0;b.hasUbatAl=!0;return g.UBAT_R},UBAT_WS:()=>g.UBAT_ON,UBAT_CS:()=>{let c,f;if(1>h||h+1>=e.length||(c=a[h-1])!==g.UBAT_EN&&c!==g.UBAT_AN||(f=e[h+1])!==g.UBAT_EN&&f!==g.UBAT_AN)return g.UBAT_ON;b.lastArabic&&(f=g.UBAT_AN);return f===c?f:g.UBAT_ON},UBAT_ES:()=>(0<h?a[h-
1]:g.UBAT_B)===g.UBAT_EN&&h+1<e.length&&e[h+1]===g.UBAT_EN?g.UBAT_EN:g.UBAT_ON,UBAT_ET:()=>{if(0<h&&a[h-1]===g.UBAT_EN)return g.UBAT_EN;if(b.lastArabic)return g.UBAT_ON;let c=h+1;const f=e.length;for(;c<f&&e[c]===g.UBAT_ET;)c++;return c<f&&e[c]===g.UBAT_EN?g.UBAT_EN:g.UBAT_ON},UBAT_NSM:()=>{if("VLTR"===b.inFormat){for(var c=e.length,f=h+1;f<c&&e[f]===g.UBAT_NSM;)f++;if(f<c&&(c=d[h].charCodeAt[0],f=e[f],(1425<=c&&2303>=c||64286===c)&&(f===g.UBAT_R||f===g.UBAT_AL)))return g.UBAT_R}return 1>h||e[h-1]===
g.UBAT_B?g.UBAT_ON:a[h-1]},UBAT_B:()=>{b.lastArabic=!0;b.hasUbatB=!0;return b.dir},UBAT_S:()=>{b.hasUbatS=!0;return g.UBAT_ON},UBAT_LRE:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_RLE:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_LRO:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_RLO:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_PDF:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_BN:()=>g.UBAT_ON}[g.TYPES_NAMES[e[h]]]()}function E(d,e){for(let a=0;a<g.BaseForm.length;a++)if(d===g.BaseForm[a])return e[a];return d}
function y(d){return"\u064b"<=d&&"\u0655">=d?!0:!1}function J(d){return"L"===d?"LTR":"R"===d?"RTL":"C"===d?"CLR":"D"===d?"CRL":""}function K(d,e){for(let a=0;a<g.AlefTable.length;a++)if(d===g.AlefTable[a])return e[a];return d}function L(d,e,a,h){for(let b=0;b<d.length;b++)if(d[b]>e||!a&&d[b]===e)d[b]+=h}let r=[],B=[],A=[];const C={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},
M=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,P=/[\u0591-\u06ff\ufb1d-\ufefc]/;return function(){function d(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}var e=d.prototype;e.bidiTransform=function(a,h,b){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var c=this.sourceToTarget,f=this.targetToSource,k=a.length;r=[];A=[];for(var l=0;l<k;l++)c[l]=l,f[l]=l,r[l]=l;if(!this.checkParameters(h,b))return a;h=this.inputFormat;b=this.outputFormat;
c=a;k=J(h.charAt(1));c=J(b.charAt(1));l="I"===h.charAt(0)?"L":h.charAt(0);f="I"===b.charAt(0)?"L":b.charAt(0);k=l+k;c=f+c;f=h.charAt(2)+b.charAt(2);C.defInFormat=k;C.defOutFormat=c;C.defSwap=f;a=x(a,k,c,f,C);c=!1;if("R"===b.charAt(1))c=!0;else if("C"===b.charAt(1)||"D"===b.charAt(1))c="rtl"===this.checkContextual(a);f=this.sourceToTarget=r;k=Array(f.length);for(l=0;l<f.length;l++)k[f[l]]=l;B=this.targetToSource=k;if(h.charAt(3)===b.charAt(3))c=a;else if("S"===b.charAt(3))if(h=c,b=!0,0===a.length)c=
"";else{void 0===h&&(h=!0);void 0===b&&(b=!0);a=String(a);a=a.split("");k=0;c=1;f=a.length;h||(k=a.length-1,c=-1,f=1);var m=k;k=b;var p=0;l=[];for(var u=0;m*c<f;m+=c)if(H(a[m])||y(a[m])){var n;if(n="\u0644"===a[m])b:{for(var q=a,t=m+c,v=c,N=f;t*v<N&&y(q[t]);)t+=v;n=" ";if(t*v<N)for(n=q[t],q=0;q<g.AlefTable.length;q++)if(g.AlefTable[q]===n){n=!0;break b}n=!1}if(n){a[m]=0===p?K(a[m+c],g.LamAlefInialTableFE):K(a[m+c],g.LamAlefMedialTableFE);m+=c;p=a;n=m;q=c;for(t=f;n*q<t&&y(p[n]);)n+=q;n*q<t&&(p[n]=
" ");k&&(l[u]=m,u++);p=0}else{n=a[m];if(1===p){q=m;if(I(a,m+c,c,f))b:for(t=a[m],v=0;v<g.BaseForm.length;v++){if(t===g.BaseForm[v]){t=g.MedialForm[v];break b}}else t=E(a[m],g.FinalForm);a[q]=t}else!0===I(a,m+c,c,f)?a[m]=E(a[m],g.InitialForm):a[m]=E(a[m],g.IsolatedForm);y(n)||(p=1);b:{for(q=0;q<g.StandAlonForm.length;q++)if(g.StandAlonForm[q]===n){n=!0;break b}n=!1}!0===n&&(p=0)}}else p=0;c=l;f="";for(k=0;k<a.length;k++){if(l=b){b:{for(l=0;l<c.length;l++)if(c[l]===k)break b;l=-1}l=-1<l}l?(L(B,k,!h,
-1),r.splice(k,1)):f+=a[k]}c=f}else if(h=a,b=c,a=!0,0===h.length)c="";else for(void 0===a&&(a=!0),void 0===b&&(b=!0),h=String(h),c="",f=h.split(""),k=0;k<h.length;k++)l=!1,"\ufe70"<=f[k]&&"\ufeff">f[k]?(u=h.charCodeAt(k),"\ufef5"<=f[k]&&"\ufefc">=f[k]?(b?(0<k&&a&&" "===f[k-1]?c=c.substring(0,c.length-1)+"\u0644":(c+="\u0644",l=!0),c+=g.AlefTable[(u-65269)/2]):(c+=g.AlefTable[(u-65269)/2],c+="\u0644",k+1<h.length&&a&&" "===f[k+1]?k++:l=!0),l&&(L(B,k,!0,1),r.splice(k,0,r[k]))):c+=g.FETo06Table[u-65136]):
c+=f[k];this.sourceToTarget=r;this.targetToSource=B;this.levels=A;return c};e._inputFormatSetter=function(a){if(!M.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a};e._outputFormatSetter=function(a){if(!M.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a};e.checkParameters=function(a,h){a?this._inputFormatSetter(a):a=this.inputFormat;h?this._outputFormatSetter(h):h=this.outputFormat;return a===h?
!1:!0};e.checkContextual=function(a){a=z(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(h){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a};e.hasBidiChar=function(a){return P.test(a)};return d}()});