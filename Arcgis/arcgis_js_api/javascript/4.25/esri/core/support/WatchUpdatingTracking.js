// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../Accessor ../Handles ../maybe ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),function(g,p,m,q,r,t,e,u,v,w){g.WatchUpdatingTracking=function(n){function h(){var a=n.apply(this,arguments)||this;a.updating=!1;a._handleId=0;a._handles=new r;a._scheduleHandleId=0;a._pendingPromises=new Set;return a}p._inheritsLoose(h,n);var d=h.prototype;d.destroy=function(){this.removeAll();
this._handles.destroy()};d.add=function(a,b,c={}){return this._installWatch(a,b,c,e.watch)};d.addWhen=function(a,b,c={}){return this._installWatch(a,b,c,e.when)};d.addOnCollectionChange=function(a,b,{initial:c=!1,final:k=!1}={}){const f=++this._handleId;this._handles.add([e.on(a,"after-changes",this._createSyncUpdatingCallback(),e.sync),e.on(a,"change",b,{onListenerAdd:c?l=>b({added:l.toArray(),removed:[]}):void 0,onListenerRemove:k?l=>b({added:[],removed:l.toArray()}):void 0})],f);return{remove:()=>
this._handles.remove(f)}};d.addPromise=function(a){if(t.isNone(a))return a;const b=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(a)&&(0!==this._pendingPromises.size||this._handles.has(-42)||this._set("updating",!1))}},b);this._pendingPromises.add(a);this._set("updating",!0);const c=()=>this._handles.remove(b);a.then(c,c);return a};d.removeAll=function(){this._pendingPromises.clear();this._handles.removeAll();this._set("updating",!1)};d._installWatch=function(a,b,c={},
k){const f=++this._handleId;c.sync||this._installSyncUpdatingWatch(a,f);a=k(a,b,c);this._handles.add(a,f);return{remove:()=>this._handles.remove(f)}};d._installSyncUpdatingWatch=function(a,b){const c=this._createSyncUpdatingCallback();a=e.watch(a,c,{sync:!0,equals:()=>!1});this._handles.add(a,b);return a};d._createSyncUpdatingCallback=function(){return()=>{this._handles.remove(-42);++this._scheduleHandleId;const a=this._scheduleHandleId;this._get("updating")||this._set("updating",!0);this._handles.add(u.schedule(()=>
{a===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this._handles.remove(-42))}),-42)}};return h}(q);m.__decorate([v.property({readOnly:!0})],g.WatchUpdatingTracking.prototype,"updating",void 0);g.WatchUpdatingTracking=m.__decorate([w.subclass("esri.core.support.WatchUpdatingTracking")],g.WatchUpdatingTracking);Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});