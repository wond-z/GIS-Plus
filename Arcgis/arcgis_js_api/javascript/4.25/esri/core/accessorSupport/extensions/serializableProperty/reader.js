// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../Logger ../../../object ../../../Warning ../../metadata ./type".split(" "),function(m,y,z,A,B,C){function t(a){var b=a.ndimArray??0;if(1<b)return D(a);if(1===b)return u(a);if("type"in a&&v(a.type)){b=a.type.prototype?.itemType?.Type;const d=u("function"===typeof b?{type:b}:{types:b});return(f,c,g)=>(f=d(f,c,g))?new a.type(f):f}return n(a)}function n(a){return"type"in a?E(a.type):F(a.types)}function E(a){return a.prototype.read?(b,d,f)=>{if(null==b)return b;d=typeof b;if("object"!==
d)p.error(`Expected JSON value of type 'object' to deserialize type '${a.prototype.declaredClass}', but got '${d}'`);else return d=new a,d.read(b,f),d}:a.fromJSON}function w(a,b,d,f){return 0!==f&&Array.isArray(b)?b.map(c=>w(a,c,d,f-1)):a(b,void 0,d)}function D(a){const b=n(a),d=w.bind(null,b),f=a.ndimArray??0;return(c,g,e)=>{if(null==c)return c;c=d(c,e,f);g=f;for(e=c;0<g&&Array.isArray(e);)g--,e=e[0];if(void 0!==e)for(e=0;e<g;e++)c=[c];return c}}function u(a){const b=n(a);return(d,f,c)=>{if(null==
d)return d;if(Array.isArray(d)){f=[];for(const g of d)d=b(g,void 0,c),void 0!==d&&f.push(d);return f}c=b(d,void 0,c);return void 0!==c?[c]:void 0}}function v(a){return C.isCollection(a)?(a=a.prototype.itemType)&&a.Type?"function"===typeof a.Type?q(a.Type):x(a.Type):!1:!1}function q(a){return Array.isArray(a)?!1:!!a&&a.prototype&&("read"in a.prototype||"fromJSON"in a||v(a))}function x(a){for(const b in a.typeMap)if(!q(a.typeMap[b]))return!1;return!0}function F(a){let b=null;const d=a.errorContext??
"type";return(f,c,g)=>{if(null==f)return f;c=typeof f;if("object"!==c)p.error(`Expected JSON value of type 'object' to deserialize, but got '${c}'`);else{if(!b){c={};for(var e in a.typeMap){const l=a.typeMap[e];var h=B.getOwnClassMetadata(l.prototype);if("function"===typeof a.key)continue;h=h.properties[a.key];if(!h)continue;h.json?.type&&Array.isArray(h.json.type)&&1===h.json.type.length&&"string"===typeof h.json.type[0]&&(c[h.json.type[0]]=l);h=h.json?.write;if(!h||!h.writer){c[e]=l;continue}var k=
h.target;k="string"===typeof k?k:a.key;const r={};h.writer(e,r,k);r[k]&&(c[r[k]]=l)}b=c}e=a.key;if("string"===typeof e){if(c=(e=f[e])?b[e]:a.defaultKeyValue?a.typeMap[a.defaultKeyValue]:void 0)return e=new c,e.read(f,g),e;e=`Type '${e||"unknown"}' is not supported`;g&&g.messages&&f&&g.messages.push(new A(`${d}:unsupported`,e,{definition:f,context:g}));p.error(e)}}}}const p=y.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");m.create=function(a,b,d){a&&(d||b.read)&&!b.read?.reader&&
!1!==b.read?.enabled&&(d="types"in a?x(a.types):q(a.type),d&&z.setDeepValue("read.reader",t(a),b))};m.createTypeReader=t;Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});