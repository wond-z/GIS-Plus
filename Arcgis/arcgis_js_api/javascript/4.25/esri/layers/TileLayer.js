// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(u,q,e,f,l,t,v,n,z,w,F,T){u.ArcGISCachedService=
A=>{A=function(H){function L(){var R=H.apply(this,arguments)||this;R.copyright=null;R.minScale=0;R.maxScale=0;R.spatialReference=null;R.tileInfo=null;R.tilemapCache=null;return R}q._inheritsLoose(L,H);var E=L.prototype;E.readMinScale=function(R,J){return null!=J.minLOD&&null!=J.maxLOD?R:0};E.readMaxScale=function(R,J){return null!=J.minLOD&&null!=J.maxLOD?R:0};E.readTilemapCache=function(R,J){return J.capabilities&&J.capabilities.includes("Tilemap")?new F.TilemapCache({layer:this}):null};q._createClass(L,
[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return L}(A);e.__decorate([l.property({json:{read:{source:"copyrightText"}}})],A.prototype,"copyright",void 0);e.__decorate([l.property()],A.prototype,"minScale",void 0);e.__decorate([n.reader("service","minScale")],A.prototype,"readMinScale",null);e.__decorate([l.property()],A.prototype,"maxScale",void 0);e.__decorate([n.reader("service","maxScale")],A.prototype,"readMaxScale",null);e.__decorate([l.property({type:T})],A.prototype,
"spatialReference",void 0);e.__decorate([l.property({readOnly:!0})],A.prototype,"supportsBlankTile",null);e.__decorate([l.property(w.serviceTileInfoProperty)],A.prototype,"tileInfo",void 0);e.__decorate([l.property()],A.prototype,"tilemapCache",void 0);e.__decorate([n.reader("service","tilemapCache",["capabilities"])],A.prototype,"readTilemapCache",null);e.__decorate([l.property()],A.prototype,"version",void 0);return A=e.__decorate([z.subclass("esri.layers.mixins.ArcGISCachedService")],A)};Object.defineProperties(u,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(u,q){function e(l,t,v,n){if(!l)return null;const {minScale:z,maxScale:w,minLOD:F,maxLOD:T}=t;if(null!=F&&null!=T)return n&&n.ignoreMinMaxLOD?q.fromJSON(l):q.fromJSON({...l,lods:l.lods.filter(({level:A})=>null!=A&&A>=F&&A<=T)});if(0!==z&&0!==w){const A=z?Math.round(1E4*z)/1E4:Infinity,H=w?Math.round(1E4*w)/1E4:-Infinity;return q.fromJSON({...l,
lods:l.lods.filter(L=>{L=Math.round(1E4*L.scale)/1E4;return L<=A&&L>=H})})}return q.fromJSON(l)}const f={type:q,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:e}}}}};u.readServiceTileInfo=e;u.serviceTileInfoProperty=f;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(u,q,e,f,l,t,v,n,z,w,F,T,A,H,L,E,R,J,X){var K;e=new e.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});f=K=function(x){function G(c){c=x.call(this,c)||this;c.dpi=96;c.format=null;c.origin=null;c.minScale=0;c.maxScale=0;c.size=null;c.spatialReference=null;return c}u._inheritsLoose(G,x);G.create=function(c=
{}){const {resolutionFactor:d=1,scales:b,size:k=256,spatialReference:r=H.WebMercator,numLODs:m=24}=c;if(!E.isValid(r)){c=[];if(b)for(var y=0;y<b.length;y++){var O=b[y];c.push({level:y,scale:O,resolution:O})}else for(y=5E-4,O=m-1;0<=O;O--)c.unshift({level:O,scale:y,resolution:y}),y*=2;return new K({dpi:96,lods:c,origin:new A(0,0,r),size:[k,k],spatialReference:r})}y=E.getInfo(r);c=c.origin?new A({x:c.origin.x,y:c.origin.y,spatialReference:r}):y?new A({x:y.origin[0],y:y.origin[1],spatialReference:r}):
new A({x:0,y:0,spatialReference:r});y=1/(39.37*t.getMetersPerUnitForSR(r)*96);O=[];if(b)for(var N=0;N<b.length;N++){var S=b[N];O.push({level:N,scale:S,resolution:S*y})}else{var P=E.isGeographic(r)?512/k*5.916575275917094E8:256/k*5.91657527591555E8;N=Math.ceil(m/d);O.push({level:0,scale:P,resolution:P*y});for(S=1;S<N;S++)P/=2**d,O.push({level:S,scale:P,resolution:P*y})}return new K({dpi:96,lods:O,origin:c,size:[k,k],spatialReference:r})};var C=G.prototype;C.readOrigin=function(c,d){return A.fromJSON({spatialReference:d.spatialReference,
...c})};C.readSize=function(c,d){return[d.cols,d.rows]};C.writeSize=function(c,d){d.cols=c[0];d.rows=c[1]};C.zoomToScale=function(c){const d=this.scales;if(0>=c)return d[0];if(c>=d.length-1)return d[d.length-1];const b=Math.floor(c);return d[b]/(d[b]/d[b+1])**(c-b)};C.scaleToZoom=function(c){const d=this.scales,b=d.length-1;let k=0;for(;k<b;k++){const r=d[k],m=d[k+1];if(r<=c)break;if(m===c)return k+1;if(r>c&&m<c)return k+Math.log(r/c)/Math.log(r/m)}return k};C.snapScale=function(c,d=.95){c=this.scaleToZoom(c);
return c%Math.floor(c)>=d?this.zoomToScale(Math.ceil(c)):this.zoomToScale(Math.floor(c))};C.tileAt=function(c,d,b,k){var r=this.lodAt(c);if(!r)return null;let m;if("number"===typeof d)m=d,d=b;else{if(E.equals(d.spatialReference,this.spatialReference))m=d.x,d=d.y;else{k=R.project(d,this.spatialReference);if(l.isNone(k))return null;m=k.x;d=k.y}k=b}b=r.resolution*this.size[0];r=r.resolution*this.size[1];k||(k=new X.TileKey(null,0,0,0,L.create()));k.level=c;k.row=Math.floor((this.origin.y-d)/r+.001);
k.col=Math.floor((m-this.origin.x)/b+.001);this.updateTileInfo(k);return k};C.updateTileInfo=function(c,d=K.ExtrapolateOptions.NONE){var b=this.lodAt(c.level);b||d!==K.ExtrapolateOptions.POWER_OF_TWO||(d=this.lods[this.lods.length-1],d.level<c.level&&(b=d));if(b){var k=c.level-b.level;d=b.resolution*this.size[0]/2**k;b=b.resolution*this.size[1]/2**k;c.id=`${c.level}/${c.row}/${c.col}`;c.extent||(c.extent=L.create());c.extent[0]=this.origin.x+c.col*d;c.extent[1]=this.origin.y-(c.row+1)*b;c.extent[2]=
c.extent[0]+d;c.extent[3]=c.extent[1]+b}};C.upsampleTile=function(c){const d=this._upsampleLevels[c.level];if(!d||-1===d.parentLevel)return!1;c.level=d.parentLevel;c.row=Math.floor(c.row/d.factor+.001);c.col=Math.floor(c.col/d.factor+.001);this.updateTileInfo(c);return!0};C.getTileBounds=function(c,d){var b=this.lodAt(d.level);if(null==b)return null;var {resolution:k}=b;b=k*this.size[0];k*=this.size[1];c[0]=this.origin.x+d.col*b;c[1]=this.origin.y-(d.row+1)*k;c[2]=c[0]+b;c[3]=c[1]+k;return c};C.lodAt=
function(c){return this._levelToLOD?.[c]??null};C.clone=function(){return K.fromJSON(this.write({}))};C.getOrCreateCompatible=function(c,d){if(256===this.size[0]&&256===this.size[1])return 256===c?this:null;const b=[],k=this.lods.length;for(let r=0;r<k;r++){const m=this.lods[r];b.push(new J({level:m.level,scale:m.scale,resolution:m.resolution*d}))}return new K({size:[c,c],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,
lods:b})};C._initializeUpsampleLevels=function(){const c=this.lods;this._upsampleLevels=[];let d=null;for(let b=0;b<c.length;b++){const k=c[b];this._upsampleLevels[k.level]={parentLevel:d?d.level:-1,factor:d?d.resolution/k.resolution:0};d=k}};u._createClass(G,[{key:"isWrappable",get:function(){const {spatialReference:c,origin:d}=this;if(c&&d){const b=E.getInfo(c);return c.isWrappable&&!!b&&Math.abs(b.origin[0]-d.x)<=b.dx}return!1}},{key:"lods",set:function(c){let d=0,b=0;const k=[],r=this._levelToLOD=
{};c&&(d=-Infinity,b=Infinity,c.forEach(m=>{k.push(m.scale);d=m.scale>d?m.scale:d;b=m.scale<b?m.scale:b;r[m.level]=m}));this._set("scales",k);this._set("minScale",d);this._set("maxScale",b);this._set("lods",c);this._initializeUpsampleLevels()}}]);return G}(f.JSONSupport);q.__decorate([v.property({type:Number,json:{write:!0}})],f.prototype,"compressionQuality",void 0);q.__decorate([v.property({type:Number,json:{write:!0}})],f.prototype,"dpi",void 0);q.__decorate([v.property({type:String,json:{read:e.read,
write:e.write,origins:{"web-scene":{read:!1,write:!1}}}})],f.prototype,"format",void 0);q.__decorate([v.property({readOnly:!0})],f.prototype,"isWrappable",null);q.__decorate([v.property({type:A,json:{write:!0}})],f.prototype,"origin",void 0);q.__decorate([w.reader("origin")],f.prototype,"readOrigin",null);q.__decorate([v.property({type:[J],value:null,json:{write:!0}})],f.prototype,"lods",null);q.__decorate([v.property({readOnly:!0})],f.prototype,"minScale",void 0);q.__decorate([v.property({readOnly:!0})],
f.prototype,"maxScale",void 0);q.__decorate([v.property({readOnly:!0})],f.prototype,"scales",void 0);q.__decorate([v.property({cast:x=>Array.isArray(x)?x:"number"===typeof x?[x,x]:[256,256]})],f.prototype,"size",void 0);q.__decorate([w.reader("size",["rows","cols"])],f.prototype,"readSize",null);q.__decorate([T.writer("size",{cols:{type:z.Integer},rows:{type:z.Integer}})],f.prototype,"writeSize",null);q.__decorate([v.property({type:H,json:{write:!0}})],f.prototype,"spatialReference",void 0);f=K=q.__decorate([F.subclass("esri.layers.support.TileInfo")],
f);(function(x){x=x.ExtrapolateOptions||(x.ExtrapolateOptions={});x[x.NONE=0]="NONE";x[x.POWER_OF_TWO=1]="POWER_OF_TWO"})(f||(f={}));return f})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(u,q,e,f,l,t,v){var n;e=n=function(z){function w(F){F=
z.call(this,F)||this;F.cols=null;F.level=0;F.levelValue=null;F.origin=null;F.resolution=0;F.rows=null;F.scale=0;return F}u._inheritsLoose(w,z);w.prototype.clone=function(){return new n({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return w}(e.JSONSupport);q.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"cols",void 0);q.__decorate([f.property({type:t.Integer,
json:{write:!0}})],e.prototype,"level",void 0);q.__decorate([f.property({type:String,json:{write:!0}})],e.prototype,"levelValue",void 0);q.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"origin",void 0);q.__decorate([f.property({type:Number,json:{write:!0}})],e.prototype,"resolution",void 0);q.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,
"rows",void 0);q.__decorate([f.property({type:Number,json:{write:!0}})],e.prototype,"scale",void 0);return e=n=q.__decorate([v.subclass("esri.layers.support.LOD")],e)})},"esri/layers/support/TileKey":function(){define(["exports"],function(u){u.TileKey=function(q,e,f,l,t){this.id=q;this.level=e;this.row=f;this.col=l;this.extent=t};Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/byteSizeEstimations ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./TileKey ./Tilemap".split(" "),
function(u,q,e,f,l,t,v,n,z,w,F,T,A,H,L,E,R,J,X,K,x){var G;u.TilemapCache=G=function(C){function c(b){b=C.call(this,b)||this;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2*t.ByteSizeUnit.MEGABYTES;b.request=f;b._prefetchingEnabled=!0;return b}q._inheritsLoose(c,C);var d=c.prototype;d.initialize=function(){this._tilemapCache=new w(this.cacheByteSize);this.addHandles([A.watch(()=>{const {layer:b}=this;return[b?.parsedUrl,b?.tileServers,b?.apiKey,b?.customParameters]},
()=>this._initializeTilemapDefinition()),A.watch(()=>this.layer?.tileInfo?.lods,b=>this._initializeAvailableLevels(b),A.syncAndInitial)]);this._initializeTilemapDefinition()};d.castLevels=function(b){return 2>=b?(z.getLogger(this.declaredClass).error("Minimum levels for Tilemap is 3, but got ",b),3):b};d.fetchTilemap=function(b,k,r,m){if(!this._availableLevels[b])return Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));const y=this._tmpTilemapDefinition;
if(b=this._tilemapFromCache(b,k,r,y))return Promise.resolve(b);const O=m&&m.signal;m={...m,signal:null};return new Promise((N,S)=>{T.onAbort(O,()=>S(T.createAbortError()));const P=x.tilemapDefinitionId(y);let M=this._pendingTilemapRequests[P];if(!M){M=x.Tilemap.fromDefinition(y,m).then(B=>{this._tilemapCache.put(P,B,B.byteSize);return B});const h=()=>delete this._pendingTilemapRequests[P];this._pendingTilemapRequests[P]=M;M.then(h,h)}M.then(N,S)})};d.getAvailability=function(b,k,r){return this._availableLevels[b]?
(b=this._tilemapFromCache(b,k,r,this._tmpTilemapDefinition))?b.getAvailability(k,r):"unknown":"unavailable"};d.fetchAvailability=function(b,k,r,m){return this._availableLevels[b]?this.fetchTilemap(b,k,r,m).catch(y=>y).then(y=>{if(y instanceof x.Tilemap){y=y.getAvailability(k,r);if("unavailable"===y)throw new v("tile-map:tile-unavailable","Tile is not available",{level:b,row:k,col:r});return y}if(T.isAbortError(y))throw y;return"unknown"}):Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};
d.fetchAvailabilityUpsample=function(b,k,r,m,y){m.level=b;m.row=k;m.col=r;const O=this.layer.tileInfo;O.updateTileInfo(m);const N=this.fetchAvailability(b,k,r,y).catch(S=>{if(T.isAbortError(S))throw S;if(O.upsampleTile(m))return this.fetchAvailabilityUpsample(m.level,m.row,m.col,m);throw S;});this._fetchAvailabilityUpsamplePrefetch(m.id,b,k,r,y,N);return N};d._fetchAvailabilityUpsamplePrefetch=function(){var b=q._asyncToGenerator(function*(k,r,m,y,O,N){if(this._prefetchingEnabled){var S=`prefetch-${k}`;
if(!this.handles.has(S)){var P=new AbortController;N.then(()=>P.abort(),()=>P.abort());var M=!1;this.handles.add({remove(){M||(M=!0,P.abort())}},S);yield H.waitTicks(10,P.signal).catch(()=>{});M||(M=!0,this.handles.remove(S));if(!T.isAborted(P))for(k=new K.TileKey(k,r,m,y),O={...O,signal:P.signal},r=this.layer.tileInfo,m=0;G._prefetches.length<G._maxPrefetch&&r.upsampleTile(k);++m){const h=this.fetchAvailability(k.level,k.row,k.col,O);G._prefetches.push(h);y=()=>{G._prefetches.removeUnordered(h)};
h.then(y,y)}}}});return function(k,r,m,y,O,N){return b.apply(this,arguments)}}();d._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var {parsedUrl:b,apiKey:k,customParameters:r}=this.layer;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:b.path,query:L.objectToQuery({...b.query,...r,token:k??b.query?.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};d._tilemapFromCache=function(b,
k,r,m){m.level=b;m.row=k-k%this.size;m.col=r-r%this.size;b=x.tilemapDefinitionId(m);return this._tilemapCache.get(b)};d._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(k=>this._availableLevels[k.level]=!0)};q._createClass(c,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(k){b._prefetchingEnabled=k},hasTilemap(k,r,m){return!!b._tilemapFromCache(k,
r,m,b._tmpTilemapDefinition)}}}}]);return c}(n.HandleOwnerMixin(l));u.TilemapCache._maxPrefetch=4;u.TilemapCache._prefetches=new F({initialSize:G._maxPrefetch});e.__decorate([E.property({constructOnly:!0,type:Number})],u.TilemapCache.prototype,"levels",void 0);e.__decorate([J.cast("levels")],u.TilemapCache.prototype,"castLevels",null);e.__decorate([E.property({readOnly:!0,type:Number})],u.TilemapCache.prototype,"size",null);e.__decorate([E.property({constructOnly:!0,type:Number})],u.TilemapCache.prototype,
"cacheByteSize",void 0);e.__decorate([E.property({constructOnly:!0})],u.TilemapCache.prototype,"layer",void 0);e.__decorate([E.property({constructOnly:!0})],u.TilemapCache.prototype,"request",void 0);u.TilemapCache=G=e.__decorate([X.subclass("esri.layers.support.TilemapCache")],u.TilemapCache);Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(u){function q(l){return 32+l.length}function e(l){if(!l)return 0;
if(Array.isArray(l)){var t=l.length;if(0===t||"number"===typeof l[0])l=32+8*t;else{var v=32;for(let n=0;n<t;n++)v+=f(l[n]);l=v}return l}v=32;for(t in l)l.hasOwnProperty(t)&&(v+=f(l[t]));return v}function f(l){switch(typeof l){case "object":return e(l);case "string":return q(l);case "number":return 16;case "boolean":return 4;default:return 8}}u.ByteSizeUnit=void 0;(function(l){l[l.KILOBYTES=1024]="KILOBYTES";l[l.MEGABYTES=1048576]="MEGABYTES";l[l.GIGABYTES=1073741824]="GIGABYTES"})(u.ByteSizeUnit||
(u.ByteSizeUnit={}));u.estimateAttributesObjectSize=function(l){if(!l)return 0;let t=32;for(const v in l)if(l.hasOwnProperty(v)){const n=l[v];switch(typeof n){case "string":t+=q(n);break;case "number":t+=16;break;case "boolean":t+=4}}return t};u.estimateFixedArraySize=function(l,t){return 32+l.length*t};u.estimateNestedObjectSize=e;u.estimateNumberByteSize=function(l){return 16};u.estimateStringByteSize=q;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(u,q,e,f,l){function t(n){if("vector-tile"===n.service.type)var z=`${n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;else z=n.service.tileServers,z=`${z&&z.length?z[n.row%z.length]:n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;(n=n.service.query)&&(z=`${z}?${n}`);return z}let v=function(){function n(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var z=n.prototype;z.getAvailability=function(w,F){if("unknown"!==this._allAvailability)return this._allAvailability;w=(w-this.location.top)*this.location.width+(F-this.location.left);F=w>>3;const T=this._tileAvailabilityBitSet;return 0>F||F>T.length?"unknown":T[F]&1<<w%8?"available":"unavailable"};z._updateFromData=function(w){let F=!0,T=!0;const A=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let H=0;for(let L=0;L<w.length;L++){const E=L%8;w[L]?(T=!1,A[H]|=1<<E):F=!1;7===E&&++H}T?this._allAvailability="unavailable":F?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=A,this.byteSize+=A.length)};n.fromDefinition=function(w,F){const T=w.service.request||q,{row:A,col:H,width:L,height:E}=w,R={query:{f:"json"}};F=F?{...R,...F}:R;return T(t(w),F).then(J=>J.data).catch(J=>{if(J&&J.details&&422===J.details.httpStatus)return{location:{top:A,left:H,width:L,
height:E},valid:!0,data:e.constant(L*E,0)};throw J;}).then(J=>{if(J.location&&(J.location.top!==A||J.location.left!==H||J.location.width!==L||J.location.height!==E))throw new f("tilemap:location-mismatch","Tilemap response for different location than requested",{response:J,definition:{top:A,left:H,width:L,height:E}});return n.fromJSON(J)})};n.fromJSON=function(w){n._validateJSON(w);const F=new n;F.location=Object.freeze(l.clone(w.location));F._updateFromData(w.data);return Object.freeze(F)};n._validateJSON=
function(w){if(!w||!w.location)throw new f("tilemap:missing-location","Location missing from tilemap response");if(!1===w.valid)throw new f("tilemap:invalid","Tilemap response was marked as invalid");if(!w.data)throw new f("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(w.data))throw new f("tilemap:data-mismatch","Data must be an array of numbers");if(w.data.length!==w.location.width*w.location.height)throw new f("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return n}();u.Tilemap=v;u.tilemapDefinitionId=function(n){return`${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`};Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(u,q,e,f,l,t,v,n,z,w,F,T,A,H,L){u.ArcGISMapService=E=>{E=function(R){function J(){var K=R.apply(this,arguments)||this;K.capabilities=void 0;K.copyright=null;K.fullExtent=null;K.legendEnabled=!0;K.spatialReference=null;K.version=void 0;K._allLayersAndTablesPromise=null;K._allLayersAndTablesMap=null;return K}q._inheritsLoose(J,R);var X=J.prototype;X.readCapabilities=function(K,x){var G=x.capabilities&&x.capabilities.split(",").map(N=>N.toLowerCase().trim());if(!G)return{operations:{supportsExportMap:!1,
supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var C=this.type;K=G.includes("data");const c=G.includes("query"),d=G.includes("map"),b=!!x.exportTilesAllowed;G=G.includes("tilemap");const k="tile"!==C&&!!x.supportsDynamicLayers,r="tile"!==C&&(!x.tileInfo||k),m="tile"!==C&&(!x.tileInfo||k);C="tile"!==C;var y=x.cimVersion&&v.Version.parse(x.cimVersion);const O=y?.since(1,4)??!1;y=y?.since(2,0)??!1;return{operations:{supportsExportMap:d,
supportsExportTiles:b,supportsIdentify:c,supportsQuery:K,supportsTileMap:G},exportMap:d?{supportsArcadeExpressionForLabeling:O,supportsSublayersChanges:C,supportsDynamicLayers:k,supportsSublayerVisibility:r,supportsSublayerDefinitionExpression:m,supportsCIMSymbols:y}:null,exportTiles:b?{maxExportTilesCount:+x.maxExportTilesCount}:null}};X.readVersion=function(K,x){(K=x.currentVersion)||(K=x.hasOwnProperty("capabilities")||x.hasOwnProperty("tables")?10:x.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return K};X.fetchSublayerInfo=function(){var K=q._asyncToGenerator(function*(x,G){yield this.fetchAllLayersAndTables(G);return this._allLayersAndTablesMap?.get(x)});return function(x,G){return K.apply(this,arguments)}}();X.fetchAllLayersAndTables=function(){var K=q._asyncToGenerator(function*(x){yield this.load(x);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=f(t.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(C=>
{this._allLayersAndTablesMap=new Map;for(const c of C.data.layers)this._allLayersAndTablesMap.set(c.id,c);return{result:C.data}},C=>({error:C})));const G=yield this._allLayersAndTablesPromise;l.throwIfAborted(x);if("result"in G)return G.result;throw G.error;});return function(x){return K.apply(this,arguments)}}();return J}(E);e.__decorate([n.property({readOnly:!0})],E.prototype,"capabilities",void 0);e.__decorate([F.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount",
"supportsDynamicLayers","tileInfo"])],E.prototype,"readCapabilities",null);e.__decorate([n.property({json:{read:{source:"copyrightText"}}})],E.prototype,"copyright",void 0);e.__decorate([n.property({type:A})],E.prototype,"fullExtent",void 0);e.__decorate([n.property(L.id)],E.prototype,"id",void 0);e.__decorate([n.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],E.prototype,"legendEnabled",void 0);e.__decorate([n.property(L.popupEnabled)],
E.prototype,"popupEnabled",void 0);e.__decorate([n.property({type:H})],E.prototype,"spatialReference",void 0);e.__decorate([n.property({readOnly:!0})],E.prototype,"version",void 0);e.__decorate([F.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],E.prototype,"readVersion",null);return E=e.__decorate([T.subclass("esri.layers.mixins.ArcGISMapService")],E)};Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/Version":function(){define(["exports",
"./Error"],function(u,q){let e=function(){function f(t,v,n=""){this.major=t;this.minor=v;this._context=n}var l=f.prototype;l.lessThan=function(t,v){return this.major<t||t===this.major&&this.minor<v};l.since=function(t,v){return!this.lessThan(t,v)};l.validate=function(t){if(this.major!==t.major)throw new q((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t});
};l.clone=function(){return new f(this.major,this.minor,this._context)};f.parse=function(t,v=""){const [n,z]=t.split(".");var w=/^\s*\d+\s*$/;if(!n||!n.match||!n.match(w))throw new q((v&&v+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!z||!z.match||!z.match(w))throw new q((v&&v+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});t=parseInt(n,10);w=parseInt(z,10);return new f(t,w,v)};return f}();u.Version=
e;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(u,q,e,f,l,t,v,n,z,w,F,T,A,H,L,E){function R(x,G){const C=[],c={};if(!x)return C;x.forEach(d=>{const b=new L;b.read(d,G);c[b.id]=b;null!=d.parentLayerId&&-1!==d.parentLayerId?(d=c[d.parentLayerId],d.sublayers||(d.sublayers=[]),d.sublayers.unshift(b)):C.unshift(b)});return C}function J(x,G){x&&x.forEach(C=>{G(C);C.sublayers&&C.sublayers.length&&J(C.sublayers,G)})}const X=v.getLogger("esri.layers.TileLayer"),K=f.ofType(L);u.SublayersOwner=x=>{x=function(G){function C(...d){var b=G.call(this,
...d)||this;b.allSublayers=new l({getCollections:()=>[b.sublayers],getChildrenFunction(k){return k.sublayers}});b.sublayersSourceJSON={[H.OriginId.SERVICE]:{},[H.OriginId.PORTAL_ITEM]:{},[H.OriginId.WEB_SCENE]:{},[H.OriginId.WEB_MAP]:{}};b.addHandles(n.watch(()=>b.sublayers,(k,r)=>b._handleSublayersChange(k,r),n.sync));return b}q._inheritsLoose(C,G);var c=C.prototype;c.readSublayers=function(d,b){if(b&&d){var {sublayersSourceJSON:k}=this,r=H.nameToId(b.origin);if(!(r<H.OriginId.SERVICE||(k[r]={context:b,
visibleLayers:d.visibleLayers||k[r].visibleLayers,layers:d.layers||k[r].layers},r>H.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:m,origin:y}=this.createSublayersForOrigin("web-document");d=F.getProperties(this);d.setDefaultOrigin(y);this._set("sublayers",new K(m));d.setDefaultOrigin("user")}}};c.findSublayerById=function(d){return this.allSublayers.find(b=>b.id===d)};c.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
c.createSublayersForOrigin=function(d){const b="web-document"===d?H.nameToId("web-map"):H.nameToId(d);let k=H.OriginId.SERVICE;d=this.sublayersSourceJSON[H.OriginId.SERVICE].layers;let r=this.sublayersSourceJSON[H.OriginId.SERVICE].context,m=null;var y=[H.OriginId.PORTAL_ITEM,H.OriginId.WEB_SCENE,H.OriginId.WEB_MAP].filter(h=>h<=b);for(var O of y)y=this.sublayersSourceJSON[O],E.isSublayerOverhaul(y.layers)&&(k=O,d=y.layers,r=y.context,y.visibleLayers&&(m={visibleLayers:y.visibleLayers,context:y.context}));
O=[H.OriginId.PORTAL_ITEM,H.OriginId.WEB_SCENE,H.OriginId.WEB_MAP].filter(h=>h>k&&h<=b);let N=null;for(var S of O){const {layers:h,visibleLayers:B,context:U}=this.sublayersSourceJSON[S];h&&(N={layers:h,context:U});B&&(m={visibleLayers:B,context:U})}S=R(d,r);const P=new Map,M=new Set;if(N)for(const h of N.layers)P.set(h.id,h);if(m)for(const h of m.visibleLayers)M.add(h);J(S,h=>{N&&h.read(P.get(h.id),N.context);m&&h.read({defaultVisibility:M.has(h.id)},m.context)});return{origin:H.idToName(k),sublayers:new K({items:S})}};
c.read=function(d,b){G.prototype.read.call(this,d,b);this.readSublayers(d,b)};c._handleSublayersChange=function(d,b){b&&(b.forEach(k=>{k.parent=null;k.layer=null}),this.handles.remove("sublayers-owner"));d&&(d.forEach(k=>{k.parent=this;k.layer=this}),this.handles.add([d.on("after-add",({item:k})=>{k.parent=this;k.layer=this}),d.on("after-remove",({item:k})=>{k.parent=null;k.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(d.on("before-changes",k=>{X.error(new t("tilelayer:sublayers-non-modifiable",
"ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));k.preventDefault()}),"sublayers-owner"))};return C}(x);e.__decorate([z.property({readOnly:!0})],x.prototype,"allSublayers",void 0);e.__decorate([z.property({readOnly:!0,type:f.ofType(L)})],x.prototype,"serviceSublayers",void 0);e.__decorate([z.property({value:null,type:K,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],x.prototype,"sublayers",void 0);e.__decorate([z.property({readOnly:!0})],x.prototype,"sublayersSourceJSON",
void 0);return x=e.__decorate([A.subclass("esri.layers.mixins.SublayersOwner")],x)};u.forEachSublayer=J;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./arcgisLayerUrl ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(u,q,e,f,l,t,v,n,z,w,F,T,A,H,L,E,R,J,X,K,x,G,C,c,d,b,k,r,m,y,O,N,S,P,M,h,B,U,W,Y,ia,ca,ra,na,ja,oa,sa,ta,ka){function la(Q){return Q&&"esriSMS"===Q.type}function ma(Q,Z,D){Q=this.originIdOf(Z)>=h.nameToId(D.origin);return{ignoreOrigin:!0,allowNull:Q,enabled:D?"map-image"===D.layer?.type&&(D.writeSublayerStructure||Q):!1}}function pa(Q,Z,D){return{enabled:D?"tile"===D.layer?.type&&this._isOverridden(Z):!1}}function ba(Q,Z,D){return{ignoreOrigin:!0,enabled:D&&D.writeSublayerStructure||!1}}function fa(Q,
Z,D){return{ignoreOrigin:!0,enabled:D?D.writeSublayerStructure||this.originIdOf(Z)>=h.nameToId(D.origin):!1}}const qa=Q=>Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));var ha;let ua=0;const ea=new Set;ea.add("layer");ea.add("parent");ea.add("loaded");ea.add("loadStatus");ea.add("loadError");ea.add("loadWarnings");f=ha=function(Q){function Z(a){a=Q.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.geometryType=null;a.globalIdField=
null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}q._inheritsLoose(Z,Q);var D=Z.prototype;D.load=function(){var a=q._asyncToGenerator(function*(g){var p=this;this.addResolvingPromise(q._asyncToGenerator(function*(){if(!p.layer&&!p.url)throw new X("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:p});var I=null;!p.layer||p.originIdOf("url")>h.OriginId.SERVICE||
"data-layer"===p.source?.type?I=(yield E(p.url,{responseType:"json",query:{f:"json"},...g})).data:(I=p.id,"map-layer"===p.source?.type&&(I=p.source.mapLayerId),I=yield p.layer.fetchSublayerInfo(I,g));I&&(p.sourceJSON=I,p.read({layerDefinition:I},{origin:"service"}))})());return this});return function(g){return a.apply(this,arguments)}}();D.readCapabilities=function(a,g){g=g.layerDefinition||g;a=(a=g.capabilities||a)?a.toLowerCase().split(",").map(I=>I.trim()):[];const p=this.url?B.parse(this.url):
null;a=a.includes(d.isSome(p)&&"MapServer"===p.serverType?"data":"query");return{exportMap:{supportsModification:!!g.canModifyLayer},operations:{supportsQuery:a}}};D.readGlobalIdFieldFromService=function(a,g){g=g.layerDefinition||g;if(g.globalIdField)return g.globalIdField;if(g.fields)for(const p of g.fields)if("esriFieldTypeGlobalID"===p.type)return p.name};D.writeLabelingInfo=function(a,g,p,I){a&&a.length&&(g.layerDefinition={drawingInfo:{labelingInfo:a.map(V=>V.write({},I))}})};D.readMinScale=
function(a,g){return g.minScale||g.layerDefinition&&g.layerDefinition.minScale||0};D.readMaxScale=function(a,g){return g.maxScale||g.layerDefinition&&g.layerDefinition.maxScale||0};D.readObjectIdFieldFromService=function(a,g){g=g.layerDefinition||g;if(g.objectIdField)return g.objectIdField;if(g.fields)for(const p of g.fields)if("esriFieldTypeOID"===p.type)return p.name};D.readOpacity=function(a,g){a=g.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};D.writeOpacity=
function(a,g,p,I){g.layerDefinition={drawingInfo:{transparency:100-100*a}}};D.writeParent=function(a,g){g.parentLayerId=this.parent&&this.parent!==this.layer?M.ensureInteger(this.parent.id):-1};D.castSublayers=function(a){return M.ensureType(J.ofType(ha),a)};D.writeSublayers=function(a,g,p){this.get("sublayers.length")&&(g[p]=this.sublayers.map(I=>I.id).toArray().reverse())};D.readTypeIdField=function(a,g){g=g.layerDefinition||g;let p=g.typeIdField;p&&g.fields&&(p=p.toLowerCase(),a=g.fields.find(I=>
I.name.toLowerCase()===p))&&(p=a.name);return p};D.writeVisible=function(a,g,p,I){g[p]=this.getAtOrigin("defaultVisibility","service")||a};D.clone=function(){const {store:a}=y.getProperties(this),g=new ha;y.getProperties(g).store=a.clone(ea);this.commitProperty("url");g._lastParsedUrl=this._lastParsedUrl;return g};D.createPopupTemplate=function(a){return sa.createPopupTemplate(this,a)};D.createQuery=function(){return new oa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};D.createFeatureLayer=
function(){var a=q._asyncToGenerator(function*(){if(this.hasOwnProperty("sublayers"))return null;const g=this.layer?.parsedUrl,p=new (yield new Promise((I,V)=>u(["../FeatureLayer"],aa=>I(qa(aa)),V))).default({url:g.path});g&&this.source&&("map-layer"===this.source.type?p.layerId=this.source.mapLayerId:p.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(p.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(p.definitionExpression=this.definitionExpression);this.floorInfo&&
(p.floorInfo=G.clone(this.floorInfo));this.originIdOf("labelingInfo")>h.OriginId.SERVICE&&(p.labelingInfo=G.clone(this.labelingInfo));this.originIdOf("labelsVisible")>h.OriginId.DEFAULTS&&(p.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>h.OriginId.DEFAULTS&&(p.legendEnabled=this.legendEnabled);this.originIdOf("visible")>h.OriginId.DEFAULTS&&(p.visible=this.visible);this.originIdOf("minScale")>h.OriginId.DEFAULTS&&(p.minScale=this.minScale);this.originIdOf("maxScale")>h.OriginId.DEFAULTS&&
(p.maxScale=this.maxScale);this.originIdOf("opacity")>h.OriginId.DEFAULTS&&(p.opacity=this.opacity);this.originIdOf("popupTemplate")>h.OriginId.DEFAULTS&&(p.popupTemplate=G.clone(this.popupTemplate));this.originIdOf("renderer")>h.OriginId.SERVICE&&(p.renderer=G.clone(this.renderer));"data-layer"===this.source?.type&&(p.dynamicDataSource=this.source.clone());this.originIdOf("title")>h.OriginId.DEFAULTS&&(p.title=this.title);"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>h.OriginId.DEFAULTS&&
(p.customParameters=this.layer.customParameters);"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>h.OriginId.DEFAULTS&&(p.customParameters=this.layer.customParameters);return p});return function(){return a.apply(this,arguments)}}();D.getField=function(a){return this.fieldsIndex.get(a)};D.getFeatureType=function(a){const {typeIdField:g,types:p}=this;if(!g||!a)return null;const I=a.attributes?a.attributes[g]:void 0;if(null==I)return null;let V=null;p.some(aa=>{const {id:da}=aa;if(null==
da)return!1;da.toString()===I.toString()&&(V=aa);return!!V});return V};D.getFieldDomain=function(a,g){return(g=this.getFeatureType(g&&g.feature))&&(g=g.domains&&g.domains[a])&&"inherited"!==g.type?g:this._getLayerDomain(a)};D.queryFeatures=function(){var a=q._asyncToGenerator(function*(g=this.createQuery(),p){yield this.load();if(!this.capabilities?.operations?.supportsQuery)throw new X("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:I},{default:V}]=yield Promise.all([new Promise((aa,
da)=>u(["../../rest/query/operations/query"],aa,da)),new Promise((aa,da)=>u(["../../rest/support/FeatureSet"],va=>aa(qa(va)),da))]);g=yield I(this.url,oa.from(g),this.layer?.spatialReference??null,{...p,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});g=V.fromJSON(g.data);if(g?.features)for(const aa of g.features)aa.sourceLayer=this;return g});return function(){return a.apply(this,arguments)}}();D.toExportImageJSON=function(a){const g={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,
type:"mapLayer"}};a=k.sqlAnd(a,this.definitionExpression);d.isSome(a)&&(g.definitionExpression=a);const p=["renderer","labelingInfo","opacity","labelsVisible"].reduce((I,V)=>{I[V]=this.originIdOf(V);return I},{});if(Object.keys(p).some(I=>p[I]>h.OriginId.SERVICE)){a=g.drawingInfo={};p.renderer>h.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);p.labelsVisible>h.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&p.labelingInfo>h.OriginId.SERVICE){!this.loaded&&
this.labelingInfo.some(V=>!V.labelPlacement)&&c.getLogger(this.declaredClass).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",{sublayer:this});let I=this.labelingInfo;d.isSome(this.geometryType)&&(I=ca.validateLabelingInfo(this.labelingInfo,ka.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));
a.labelingInfo=I.filter(V=>V.labelPlacement).map(V=>V.toJSON({origin:"service",layer:this.layer}));a.showLabels=!0}p.opacity>h.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return g};D._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,g=>{g.color||"esriSMSX"!==g.style&&"esriSMSCross"!==g.style||(g.color=g.outline&&g.outline.color?g.outline.color:[0,0,0,0])})};D._forEachSimpleMarkerSymbols=function(a,g){if(a){const p="uniqueValueInfos"in
a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const I of p)la(I.symbol)&&g(I.symbol);"symbol"in a&&la(a.symbol)&&g(a.symbol);"defaultSymbol"in a&&la(a.defaultSymbol)&&g(a.defaultSymbol)}};D._setAndNotifyLayer=function(a,g){const p=this.layer,I=this._get(a);let V,aa;switch(a){case "definitionExpression":case "floorInfo":V="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":V="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":V=
"supportsDynamicLayers",aa="supportsModification"}const da=y.getProperties(this).getDefaultOrigin();if("service"!==da){if(V&&!1===this.get(`layer.capabilities.exportMap.${V}`)){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${V}'`);return}if(aa&&!1===this.get(`capabilities.exportMap.${aa}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${aa}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):
(this._set(a,g),"service"!==da&&I!==g&&p&&p.emit&&p.emit("sublayer-update",{propertyName:a,target:this}))};D._handleSublayersChange=function(a,g){g&&(g.forEach(p=>{p.parent=null;p.layer=null}),this.handles.removeAll());a&&(a.forEach(p=>{p.parent=this;p.layer=this.layer}),this.handles.add([a.on("after-add",({item:p})=>{p.parent=this;p.layer=this.layer}),a.on("after-remove",({item:p})=>{p.parent=null;p.layer=null}),a.on("before-changes",p=>{const I=this.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==I||I||(c.getLogger(this.declaredClass).error(new X("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),p.preventDefault())})]))};D._logLockedError=function(a,g){c.getLogger(this.declaredClass).error(new X("sublayer:locked",`Property '${String(a)}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:g,sublayer:this,layer:this.layer}))};D._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?
a.domain:null};q._createClass(Z,[{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new Y(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?ua++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):
this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(g=>g.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",
get:function(){const {minScale:a,maxScale:g}=this;return{minScale:a,maxScale:g}}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const g of a.getSymbols())if(R.isSymbol3D(g)){c.getLogger(this.declaredClass).warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||
new ja.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var g=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===g?.type)return`${a.path}/${g.mapLayerId}`;g={layer:JSON.stringify({source:this.source})};return`${a.path}/dynamicLayer?${r.objectToQuery(g)}`},
set:function(a){this._overrideIfSome("url",a)}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return Z}(K.HandleOwnerMixin(b.MultiOriginJSONMixin(x.IdentifiableMixin(C))));f.test={isMapImageLayerOverridePolicy:Q=>Q===ba||Q===ma,isTileImageLayerOverridePolicy:Q=>Q===pa};e.__decorate([m.property({readOnly:!0})],f.prototype,"capabilities",void 0);e.__decorate([N.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],f.prototype,"readCapabilities",
null);e.__decorate([m.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ma}}})],f.prototype,"definitionExpression",null);e.__decorate([m.property({type:[W],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],f.prototype,"fields",void 0);e.__decorate([m.property({readOnly:!0})],f.prototype,"fieldsIndex",null);e.__decorate([m.property({type:ra,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},
write:{target:"layerDefinition.floorInfo",overridePolicy:ma},origins:{"web-scene":{read:!1,write:!1}}}})],f.prototype,"floorInfo",null);e.__decorate([m.property({type:ta,json:{read:{source:"layerDefinition.extent"}}})],f.prototype,"fullExtent",void 0);e.__decorate([m.property({type:ka.featureGeometryTypeKebabDictionary.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:ka.featureGeometryTypeKebabDictionary.read}}}}})],f.prototype,"geometryType",void 0);e.__decorate([m.property({type:String})],
f.prototype,"globalIdField",void 0);e.__decorate([N.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],f.prototype,"readGlobalIdFieldFromService",null);e.__decorate([m.property({type:M.Integer,json:{write:{ignoreOrigin:!0}}})],f.prototype,"id",null);e.__decorate([m.property({value:null,type:[ia],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ba}}})],f.prototype,"labelingInfo",
null);e.__decorate([P.writer("labelingInfo")],f.prototype,"writeLabelingInfo",null);e.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ba}}})],f.prototype,"labelsVisible",null);e.__decorate([m.property({value:null})],f.prototype,"layer",null);e.__decorate([m.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",
overridePolicy:fa}}})],f.prototype,"legendEnabled",void 0);e.__decorate([m.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],f.prototype,"listMode",null);e.__decorate([m.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],f.prototype,"minScale",null);e.__decorate([N.reader("minScale",["minScale","layerDefinition.minScale"])],f.prototype,"readMinScale",null);e.__decorate([m.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],
f.prototype,"maxScale",null);e.__decorate([N.reader("maxScale",["maxScale","layerDefinition.maxScale"])],f.prototype,"readMaxScale",null);e.__decorate([m.property({readOnly:!0})],f.prototype,"effectiveScaleRange",null);e.__decorate([m.property({type:String})],f.prototype,"objectIdField",void 0);e.__decorate([N.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],f.prototype,"readObjectIdFieldFromService",null);e.__decorate([m.property({type:Number,value:1,
json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ba}}})],f.prototype,"opacity",null);e.__decorate([N.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],f.prototype,"readOpacity",null);e.__decorate([P.writer("opacity")],f.prototype,"writeOpacity",null);e.__decorate([m.property({json:{type:M.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:ba}}})],f.prototype,"parent",void 0);e.__decorate([P.writer("parent")],
f.prototype,"writeParent",null);e.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(Q,Z){return!Z.disablePopup}},write:{target:"disablePopup",overridePolicy:fa,writer(Q,Z,D){Z[D]=!Q}}}})],f.prototype,"popupEnabled",void 0);e.__decorate([m.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:fa}}})],f.prototype,"popupTemplate",void 0);e.__decorate([m.property({readOnly:!0})],f.prototype,"defaultPopupTemplate",null);e.__decorate([m.property({types:L.rendererTypes,
value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba},origins:{"web-scene":{types:L.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba}}}}})],f.prototype,"renderer",null);e.__decorate([m.property({types:{key:"type",base:null,typeMap:{"data-layer":na.DataLayerSource,"map-layer":ja.MapLayerSource}},cast(Q){if(Q){if("mapLayerId"in Q)return M.ensureClass(ja.MapLayerSource,Q);if("dataSource"in Q)return M.ensureClass(na.DataLayerSource,
Q)}return Q},json:{name:"layerDefinition.source",write:{overridePolicy:ba}}})],f.prototype,"source",null);e.__decorate([m.property()],f.prototype,"sourceJSON",void 0);e.__decorate([m.property({value:null,json:{type:[M.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ba}}})],f.prototype,"sublayers",null);e.__decorate([O.cast("sublayers")],f.prototype,"castSublayers",null);e.__decorate([P.writer("sublayers")],f.prototype,"writeSublayers",null);e.__decorate([m.property({type:String,json:{name:"name",
write:{overridePolicy:fa}}})],f.prototype,"title",void 0);e.__decorate([m.property({type:String})],f.prototype,"typeIdField",void 0);e.__decorate([N.reader("typeIdField",["layerDefinition.typeIdField"])],f.prototype,"readTypeIdField",null);e.__decorate([m.property({type:[U],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],f.prototype,"types",void 0);e.__decorate([m.property({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:pa}}})],f.prototype,"url",
null);e.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ba}}})],f.prototype,"visible",null);e.__decorate([P.writer("visible")],f.prototype,"writeVisible",null);return f=ha=e.__decorate([S.subclass("esri.layers.support.Sublayer")],f)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(u,q,e){function f(l,t){if(!l||!l.length||
q.isNone(t))return!0;t=t.slice().reverse().flatten(({sublayers:z})=>z&&z.toArray().reverse()).map(z=>z.id).toArray();if(l.length>t.length)return!1;let v=0;const n=t.length;for(const {id:z}of l){for(;v<n&&t[v]!==z;)v++;if(v>=n)return!1}return!0}u.isExportDynamic=function(l,t,v){return l.some(n=>{const z=n.source;return!(!z||"map-layer"===z.type&&z.mapLayerId===n.id&&(q.isNone(z.gdbVersion)||z.gdbVersion===v))||n.originIdOf("renderer")>e.OriginId.SERVICE||n.originIdOf("labelingInfo")>e.OriginId.SERVICE||
n.originIdOf("opacity")>e.OriginId.SERVICE||n.originIdOf("labelsVisible")>e.OriginId.SERVICE})?!0:!f(l,t)};u.isSublayerOverhaul=function(l){return!!l&&l.some(t=>null!=t.minScale||t.layerDefinition&&null!=t.layerDefinition.minScale)};u.shouldWriteSublayerStructure=function(l,t,v){return t.flatten(({sublayers:n})=>n).length!==l.length||l.some(n=>n.originIdOf("minScale")>v||n.originIdOf("maxScale")>v||n.originIdOf("renderer")>v||n.originIdOf("labelingInfo")>v||n.originIdOf("opacity")>v||n.originIdOf("labelsVisible")>
v||n.originIdOf("source")>v)?!0:!f(l,t)};Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),function(u,
q,e,f,l,t,v,n,z,w,F,T,A,H,L,E,R,J,X,K,x,G,C,c,d,b,k,r,m,y,O){const N="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");l=function(S){function P(...h){h=
S.call(this,...h)||this;h.listMode="show";h.isReference=null;h.operationalLayerType="ArcGISTiledMapServiceLayer";h.resampling=!0;h.sourceJSON=null;h.spatialReference=null;h.path=null;h.sublayers=null;h.type="tile";h.url=null;return h}u._inheritsLoose(P,S);var M=P.prototype;M.normalizeCtorArgs=function(h,B){return"string"===typeof h?{url:h,...B}:h};M.load=function(h){const B=t.isSome(h)?h.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},h).catch(n.throwIfAbortError).then(()=>
this._fetchService(B)));return Promise.resolve(this)};M.readSpatialReference=function(h,B){return(h=h||B.tileInfo&&B.tileInfo.spatialReference)&&E.fromJSON(h)};M.writeSublayers=function(h,B,U,W){if(this.loaded&&h){h=h.slice().reverse().flatten(({sublayers:ca})=>ca&&ca.toArray().reverse()).toArray();var Y=[],ia={writeSublayerStructure:!1,...W};h.forEach(ca=>{ca=ca.write({},ia);Y.push(ca)});Y.some(ca=>1<Object.keys(ca).length)&&(B.layers=Y)}};M.castTileServers=function(h){return Array.isArray(h)?h.map(B=>
z.urlToObject(B).path):null};M.fetchTile=function(h,B,U,W={}){({signal:W}=W);h=this.getTileUrl(h,B,U);return e(h,{responseType:"image",signal:W,query:{...this.refreshParameters}}).then(Y=>Y.data)};M.fetchImageBitmapTile=function(){var h=u._asyncToGenerator(function*(B,U,W,Y={}){({signal:Y}=Y);B=this.getTileUrl(B,U,W);B=yield e(B,{responseType:"blob",signal:Y,query:{...this.refreshParameters}});return createImageBitmap(B.data)});return function(B,U,W){return h.apply(this,arguments)}}();M.getTileUrl=
function(h,B,U){const W=z.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),Y=this.tileServers;return`${Y&&Y.length?Y[B%Y.length]:this.parsedUrl.path}/tile/${h}/${B}/${U}${W?"?"+W:""}`};M._fetchService=function(h){return(new Promise((B,U)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new f("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
B({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new f("tile-layer:undefined-url","layer's url is not defined");var W=m.parse(this.parsedUrl.path);if(t.isSome(W)&&"ImageServer"===W.serverType)throw new f("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");e(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:h}).then(B,U)}})).then(B=>{B.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));
this.sourceJSON=B.data;this.read(B.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!m.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,h).then(U=>{this.read({currentVersion:U})}).catch(()=>{})})};M._fetchServerVersion=function(h,B){if(!m.isArcGISUrl(h))return Promise.reject();h=h.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return e(h,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:B}).then(U=>{if(U.data&&U.data.currentVersion)return U.data.currentVersion;
throw new f("tile-layer:version-not-available");})};M._getMapName=function(h){return(h=h.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&h[2]};M._getDefaultAttribution=function(h){if(h){h=h.toLowerCase();for(let U=0,W=N.length;U<W;U++){var B=N[U];if(B.toLowerCase().includes(h))return z.makeAbsolute("//static.arcgis.com/attribution/"+B)}}};M._getDefaultTileServers=function(h){const B=
-1!==h.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),U=-1!==h.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return B||U?[h,h.replace(B?/server\.arcgisonline/i:/services\.arcgisonline/i,B?"services.arcgisonline":"server.arcgisonline")]:[]};u._createClass(P,[{key:"attributionDataUrl",get:function(){const h=this.parsedUrl?.path.toLowerCase();return h?this._getDefaultAttribution(this._getMapName(h)):null}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},
{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return P}(G.BlendLayer(r.SublayersOwner(k.ScaleRangeLayer(c.OperationalLayer(d.PortalLayer(X.ArcGISCachedService(K.ArcGISMapService(x.ArcGISService(v.MultiOriginJSONMixin(l.HandleOwnerMixin(b.RefreshableLayer(J.APIKeyMixin(C.CustomParametersMixin(R))))))))))))));q.__decorate([w.property({readOnly:!0})],l.prototype,"attributionDataUrl",null);q.__decorate([w.property({type:["show","hide","hide-children"]})],l.prototype,
"listMode",void 0);q.__decorate([w.property({json:{read:!0,write:!0}})],l.prototype,"blendMode",void 0);q.__decorate([w.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],l.prototype,"isReference",void 0);q.__decorate([w.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],l.prototype,"operationalLayerType",void 0);q.__decorate([w.property({type:Boolean})],l.prototype,"resampling",void 0);q.__decorate([w.property()],l.prototype,"sourceJSON",void 0);
q.__decorate([w.property({type:E})],l.prototype,"spatialReference",void 0);q.__decorate([A.reader("spatialReference",["spatialReference","tileInfo"])],l.prototype,"readSpatialReference",null);q.__decorate([w.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],l.prototype,"path",void 0);q.__decorate([w.property({readOnly:!0})],l.prototype,"sublayers",void 0);q.__decorate([L.writer("sublayers",{layers:{type:[O]}})],l.prototype,"writeSublayers",null);q.__decorate([w.property({json:{read:!1,
write:!1}})],l.prototype,"popupEnabled",void 0);q.__decorate([w.property()],l.prototype,"tileServers",null);q.__decorate([T.cast("tileServers")],l.prototype,"castTileServers",null);q.__decorate([w.property({readOnly:!0,json:{read:!1}})],l.prototype,"type",void 0);q.__decorate([w.property(y.url)],l.prototype,"url",void 0);l=q.__decorate([H.subclass("esri.layers.TileLayer")],l);l.prototype.fetchTile.__isDefault__=!0;return l});