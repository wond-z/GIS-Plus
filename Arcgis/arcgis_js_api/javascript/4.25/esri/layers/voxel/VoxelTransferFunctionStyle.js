// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/Clonable ../../core/Collection ../../core/collectionUtils ../../core/JSONSupport ../../core/mathUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./VoxelColorStop ./VoxelOpacityStop ./VoxelRangeFilter".split(" "),function(C,t,D,p,v,E,G,r,w,K,L,H,z,A,I){var l;(function(q){q[q.Color=1]="Color";q[q.Alpha=
2]="Alpha";q[q.Both=3]="Both"})(l||(l={}));p=function(q){function y(a){a=q.call(this,a)||this;a.interpolation=null;a.stretchRange=null;a.rangeFilter=null;a._colorMapSize=256;a.colorStops=new (v.ofType(z));a.opacityStops=new (v.ofType(A));return a}C._inheritsLoose(y,q);var F=y.prototype;F.getPreviousNext=function(a,d,b){let c=a;for(;0<--c&&d[c].type!==b&&d[c].type!==l.Both;);const k=d.length;for(;++a<k&&d[a].type!==b&&d[a].type!==l.Both;);return[c,a]};F.getColorForContinuousDataValue=function(a,d){const b=
this.rasterizedTransferFunction;if(2>this.colorStops.length||!Array.isArray(this.stretchRange)||2>this.stretchRange.length||256>b.length)return null;let c=this.stretchRange[0],k=this.stretchRange[1];if(c>k){const g=c;c=k;k=g}a=r.clamp(a,c,k);a=b[Math.round((a-c)/(k-c)*(this._colorMapSize-1))].clone();d||(a.a=1);return a};C._createClass(y,[{key:"colorStops",set:function(a){this._set("colorStops",E.referenceSetter(a,this._get("colorStops"),v.ofType(z)))}},{key:"opacityStops",set:function(a){this._set("opacityStops",
E.referenceSetter(a,this._get("opacityStops"),v.ofType(A)))}},{key:"rasterizedTransferFunction",get:function(){const a=[];if(2>this.colorStops.length)return a;const d=[],b=[];for(var c of this.colorStops){if(!c.color)return a;b.push({color:{r:c.color.r,g:c.color.g,b:c.color.b,a:Math.round(255*(1-c.color.a))},position:c.position,type:l.Color})}if(0===this.opacityStops.length)for(var k of b)d.push({color:k.color,position:k.position});else{for(var g of this.opacityStops){c=r.clamp(g.position,0,1);k=
Math.round(255*r.clamp(1-g.opacity,0,1));let f=!1;for(var h of b)if(h.type===l.Color&&1E-5>Math.abs(h.position-c)){h.color.a=k;h.type=l.Both;f=!0;break}f||b.push({color:{r:0,g:0,b:0,a:k},position:g.position,type:l.Alpha})}b.sort((f,e)=>f.position<e.position?-1:1);g=b.length;for(h=0;h<g;++h){const f=b[h];if(f.type!==l.Both)if(f.type===l.Color){const [e,m]=this.getPreviousNext(h,b,l.Alpha);f.color.a=-1!==e&&m!==g?Math.round(r.lerp(b[e].color.a,b[m].color.a,(f.position-b[e].position)/(b[m].position-
b[e].position))):-1!==e?b[e].color.a:b[m].color.a}else{const [e,m]=this.getPreviousNext(h,b,l.Color);if(-1!==e&&m!==g){const n=(f.position-b[e].position)/(b[m].position-b[e].position),x=b[e].color,J=b[m].color;["r","g","b"].forEach(B=>{f.color[B]=Math.round(r.lerp(x[B],J[B],n))})}else-1!==e?["r","g","b"].forEach(n=>{f.color[n]=b[e][n]}):["r","g","b"].forEach(n=>{f.color[n]=b[m][n]})}}for(var u of b)d.push({color:u.color,position:u.position})}d[0].position=0;d[d.length-1].position=1;u=0;g=1;for(h=
0;h<this._colorMapSize;++h){for(c=h/this._colorMapSize;c>d[g].position;)u=g++;const f=(c-d[u].position)/(d[g].position-d[u].position),e=d[u].color,m=d[g].color,n=new D;["r","g","b"].forEach(x=>{n[x]=Math.round(r.lerp(e[x],m[x],f))});n.a=r.clamp(1-r.lerp(e.a,m.a,f)/255,0,1);a.push(n)}return a}}]);return y}(p.ClonableMixin(G.JSONSupport));t.__decorate([w.property({type:["linear","nearest"],json:{write:!0}})],p.prototype,"interpolation",void 0);t.__decorate([w.property({type:[Number],json:{write:{enabled:!0,
isRequired:!0}}})],p.prototype,"stretchRange",void 0);t.__decorate([w.property({type:v.ofType(z),json:{write:{enabled:!0,overridePolicy(){return{enabled:!!this.colorStops&&0<this.colorStops.length}}}}})],p.prototype,"colorStops",null);t.__decorate([w.property({type:v.ofType(A),json:{read:{source:"alphaStops"},write:{enabled:!0,target:"alphaStops",overridePolicy(){return{enabled:!!this.opacityStops&&0<this.opacityStops.length}}}}})],p.prototype,"opacityStops",null);t.__decorate([w.property({type:I,
json:{write:!0}})],p.prototype,"rangeFilter",void 0);t.__decorate([w.property({type:[D],clonable:!1,json:{read:!1}})],p.prototype,"rasterizedTransferFunction",null);return p=t.__decorate([H.subclass("esri.layers.voxel.VoxelTransferFunctionStyle")],p)});