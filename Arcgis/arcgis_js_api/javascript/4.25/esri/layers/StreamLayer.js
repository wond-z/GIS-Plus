// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../symbols ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/extensions/serializableProperty/reader ../geometry/support/typeUtils ./Layer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/FeatureEffectLayer ./mixins/FeatureReductionLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/fieldProperties ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/PurgeOptions ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../symbols/support/ElevationInfo ../geometry/SpatialReference ../geometry/Extent".split(" "),
function(A,m,c,p,B,oa,pa,qa,ra,sa,ta,C,D,E,u,F,G,l,H,I,b,J,d,ua,v,w,K,L,q,M,N,O,P,Q,R,S,T,U,V,W,k,X,r,Y,Z,x,aa,ba,ca,da,y,ea){p=X.defineFieldProperties();b=function(z){function n(...a){a=z.call(this,...a)||this;a.copyright=null;a.definitionExpression=null;a.displayField=null;a.elevationInfo=null;a.fields=null;a.fieldsIndex=null;a.geometryDefinition=null;a.geometryType=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.maxReconnectionAttempts=0;a.maxReconnectionInterval=20;a.maxScale=
0;a.minScale=0;a.objectIdField=null;a.operationalLayerType="ArcGISStreamLayer";a.popupEnabled=!0;a.popupTemplate=null;a.purgeOptions=new x;a.screenSizePerspectiveEnabled=!0;a.sourceJSON=null;a.spatialReference=y.WGS84;a.type="stream";a.url=null;a.updateInterval=300;a.webSocketUrl=null;return a}m._inheritsLoose(n,z);var f=n.prototype;f.normalizeCtorArgs=function(a,e){return"string"===typeof a?{url:a,...e}:a};f.load=function(a){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new l("stream-layer:websocket-unsupported",
"WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=I.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},a).catch(J.throwIfAbortError).then(()=>this._fetchService(e)));return Promise.resolve(this)};f.readRenderer=function(a,e,g){e=e.layerDefinition||e;if(a=e.drawingInfo&&e.drawingInfo.renderer||void 0)return(a=E.read(a,e,g)||void 0)||H.getLogger(this.declaredClass).error("Failed to create renderer",
{rendererDefinition:e.drawingInfo.renderer,layer:this,context:g}),a;if(e.defaultSymbol)return e.types&&e.types.length?new D({defaultSymbol:t(e.defaultSymbol,e,g),field:e.typeIdField,uniqueValueInfos:e.types.map(h=>({id:h.id,symbol:t(h.symbol,h,g)}))}):new C({symbol:t(e.defaultSymbol,e,g)})};f.connect=function(){var a=m._asyncToGenerator(function*(e){const [{createConnection:g}]=yield Promise.all([new Promise((fa,ha)=>A(["./graphics/sources/connections/createConnection"],fa,ha)),this.load()]),h=q.featureGeometryTypeKebabDictionary.toJSON(this.geometryType),
{customParameters:ia=null,definitionExpression:ja=null,geometryDefinition:ka=null,maxReconnectionAttempts:la=0,maxReconnectionInterval:ma=20,spatialReference:na=this.spatialReference}=e||this.createConnectionParameters();return g(this.parsedUrl,this.spatialReference,na,h,{geometry:ka,where:ja},la,ma,ia)});return function(e){return a.apply(this,arguments)}}();f.createConnectionParameters=function(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,
geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}};f.createPopupTemplate=function(a){return ca.createPopupTemplate(this,a)};f.createQuery=function(){const a=new ba;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};f.getFieldDomain=function(a,e){if(!this.fields)return null;let g=null;this.fields.some(h=>{h.name===a&&(g=h.domain);return!!g});return g};f.getField=
function(a){return this.fieldsIndex.get(a)};f.serviceSupportsSpatialReference=function(a){return!0};f._fetchService=function(){var a=m._asyncToGenerator(function*(e){if(this.webSocketUrl){if(!this.timeInfo?.trackIdField)throw new l("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField)throw new l("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");if(!this.fields)throw new l("stream-layer:missing-metadata","The stream layer fields must be specified.");
if(!this.geometryType)throw new l("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.url=this.webSocketUrl}else this.sourceJSON||({data:e}=yield F(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:e}),this.sourceJSON=e);this.sourceJSON={...(this.sourceJSON??{}),objectIdField:"__esri_stream_id__"};this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});r.fixRendererFields(this.renderer,this.fieldsIndex);
r.fixTimeInfoFields(this.timeInfo,this.fieldsIndex);return aa.loadStyleRenderer(this,{origin:"service"})});return function(e){return a.apply(this,arguments)}}();m._createClass(n,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){r.fixRendererFields(a,this.fieldsIndex);this._set("renderer",a)}}]);return n}(R.FeatureReductionLayer(Q.FeatureEffectLayer(O.BlendLayer(W.TemporalLayer(V.ScaleRangeLayer(U.RefreshableLayer(N.ArcGISService(S.OperationalLayer(T.PortalLayer(b.MultiOriginJSONMixin(P.CustomParametersMixin(M))))))))))));
c.__decorate([d.property({type:String})],b.prototype,"copyright",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);c.__decorate([d.property({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],b.prototype,"definitionExpression",void 0);c.__decorate([d.property({type:String})],b.prototype,"displayField",void 0);c.__decorate([d.property({type:da})],b.prototype,"elevationInfo",void 0);c.__decorate([d.property(p.fields)],
b.prototype,"fields",void 0);c.__decorate([d.property(p.fieldsIndex)],b.prototype,"fieldsIndex",void 0);c.__decorate([d.property({type:ea})],b.prototype,"geometryDefinition",void 0);c.__decorate([d.property({type:q.featureGeometryTypeKebabDictionary.apiValues,json:{read:{reader:q.featureGeometryTypeKebabDictionary.read}}})],b.prototype,"geometryType",void 0);c.__decorate([d.property(k.labelsVisible)],b.prototype,"labelsVisible",void 0);c.__decorate([d.property({type:[Y],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",
reader:Z.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);c.__decorate([d.property(k.legendEnabled)],b.prototype,"legendEnabled",void 0);c.__decorate([d.property({type:["show","hide"]})],b.prototype,"listMode",void 0);c.__decorate([d.property({type:v.Integer})],b.prototype,"maxReconnectionAttempts",void 0);c.__decorate([d.property({type:v.Integer})],b.prototype,"maxReconnectionInterval",void 0);c.__decorate([d.property(k.maxScale)],b.prototype,
"maxScale",void 0);c.__decorate([d.property(k.minScale)],b.prototype,"minScale",void 0);c.__decorate([d.property({type:String})],b.prototype,"objectIdField",void 0);c.__decorate([d.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([d.property(k.popupEnabled)],b.prototype,"popupEnabled",void 0);c.__decorate([d.property({type:B,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],b.prototype,"popupTemplate",void 0);c.__decorate([d.property({type:x})],
b.prototype,"purgeOptions",void 0);c.__decorate([d.property({types:u.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:u.webSceneRendererTypes,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],b.prototype,"renderer",null);c.__decorate([w.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),w.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],
b.prototype,"readRenderer",null);c.__decorate([d.property(k.screenSizePerspectiveEnabled)],b.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([d.property()],b.prototype,"sourceJSON",void 0);c.__decorate([d.property({type:y,json:{origins:{service:{read:{source:"spatialReference"}}}}})],b.prototype,"spatialReference",void 0);c.__decorate([d.property({json:{read:!1}})],b.prototype,"type",void 0);c.__decorate([d.property(k.url)],b.prototype,"url",void 0);c.__decorate([d.property({type:Number})],
b.prototype,"updateInterval",void 0);c.__decorate([d.property({type:String})],b.prototype,"webSocketUrl",void 0);b=c.__decorate([K.subclass("esri.layers.StreamLayer")],b);const t=L.createTypeReader({types:G.symbolTypesRenderer});return b});