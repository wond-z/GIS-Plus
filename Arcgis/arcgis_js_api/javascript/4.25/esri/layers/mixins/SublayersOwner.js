// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),function(v,F,p,z,G,H,I,A,
r,O,J,P,K,d,w,L){function M(f,m){const g=[],l={};if(!f)return g;f.forEach(a=>{const b=new w;b.read(a,m);l[b.id]=b;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=l[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(b)):g.unshift(b)});return g}function x(f,m){f&&f.forEach(g=>{m(g);g.sublayers&&g.sublayers.length&&x(g.sublayers,m)})}const N=I.getLogger("esri.layers.TileLayer"),y=z.ofType(w);v.SublayersOwner=f=>{f=function(m){function g(...a){var b=m.call(this,...a)||this;b.allSublayers=
new G({getCollections:()=>[b.sublayers],getChildrenFunction(c){return c.sublayers}});b.sublayersSourceJSON={[d.OriginId.SERVICE]:{},[d.OriginId.PORTAL_ITEM]:{},[d.OriginId.WEB_SCENE]:{},[d.OriginId.WEB_MAP]:{}};b.addHandles(A.watch(()=>b.sublayers,(c,h)=>b._handleSublayersChange(c,h),A.sync));return b}F._inheritsLoose(g,m);var l=g.prototype;l.readSublayers=function(a,b){if(b&&a){var {sublayersSourceJSON:c}=this,h=d.nameToId(b.origin);if(!(h<d.OriginId.SERVICE||(c[h]={context:b,visibleLayers:a.visibleLayers||
c[h].visibleLayers,layers:a.layers||c[h].layers},h>d.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:n,origin:k}=this.createSublayersForOrigin("web-document");a=J.getProperties(this);a.setDefaultOrigin(k);this._set("sublayers",new y(n));a.setDefaultOrigin("user")}}};l.findSublayerById=function(a){return this.allSublayers.find(b=>b.id===a)};l.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
l.createSublayersForOrigin=function(a){const b="web-document"===a?d.nameToId("web-map"):d.nameToId(a);let c=d.OriginId.SERVICE;a=this.sublayersSourceJSON[d.OriginId.SERVICE].layers;let h=this.sublayersSourceJSON[d.OriginId.SERVICE].context,n=null;var k=[d.OriginId.PORTAL_ITEM,d.OriginId.WEB_SCENE,d.OriginId.WEB_MAP].filter(e=>e<=b);for(var t of k)k=this.sublayersSourceJSON[t],L.isSublayerOverhaul(k.layers)&&(c=t,a=k.layers,h=k.context,k.visibleLayers&&(n={visibleLayers:k.visibleLayers,context:k.context}));
t=[d.OriginId.PORTAL_ITEM,d.OriginId.WEB_SCENE,d.OriginId.WEB_MAP].filter(e=>e>c&&e<=b);let q=null;for(var u of t){const {layers:e,visibleLayers:B,context:C}=this.sublayersSourceJSON[u];e&&(q={layers:e,context:C});B&&(n={visibleLayers:B,context:C})}u=M(a,h);const D=new Map,E=new Set;if(q)for(const e of q.layers)D.set(e.id,e);if(n)for(const e of n.visibleLayers)E.add(e);x(u,e=>{q&&e.read(D.get(e.id),q.context);n&&e.read({defaultVisibility:E.has(e.id)},n.context)});return{origin:d.idToName(c),sublayers:new y({items:u})}};
l.read=function(a,b){m.prototype.read.call(this,a,b);this.readSublayers(a,b)};l._handleSublayersChange=function(a,b){b&&(b.forEach(c=>{c.parent=null;c.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(c=>{c.parent=this;c.layer=this}),this.handles.add([a.on("after-add",({item:c})=>{c.parent=this;c.layer=this}),a.on("after-remove",({item:c})=>{c.parent=null;c.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(a.on("before-changes",c=>{N.error(new H("tilelayer:sublayers-non-modifiable",
"ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));c.preventDefault()}),"sublayers-owner"))};return g}(f);p.__decorate([r.property({readOnly:!0})],f.prototype,"allSublayers",void 0);p.__decorate([r.property({readOnly:!0,type:z.ofType(w)})],f.prototype,"serviceSublayers",void 0);p.__decorate([r.property({value:null,type:y,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"sublayers",void 0);p.__decorate([r.property({readOnly:!0})],f.prototype,"sublayersSourceJSON",
void 0);return f=p.__decorate([K.subclass("esri.layers.mixins.SublayersOwner")],f)};v.forEachSublayer=x;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});