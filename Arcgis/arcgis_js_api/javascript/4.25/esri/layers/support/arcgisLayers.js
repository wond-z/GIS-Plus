// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ../../core/urlUtils ./arcgisLayerUrl ./fetchService ./lazyLayerLoader".split(" "),function(B,v,k,C,m,w,x,l,D){function n(){n=k._asyncToGenerator(function*(a){const b=yield E(a.url,a.properties?.customParameters);a={...a.properties,url:a.url};if(!b.sublayerIds)return null!=b.layerOrTableId&&(a.layerId=b.layerOrTableId,a.sourceJSON=b.sourceJSON),new b.Constructor(a);const c=new (yield new Promise((e,d)=>
B(["../GroupLayer"],g=>e(Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"}))),d))).default({title:b.parsedUrl.title});F(c,b,a);return c});return n.apply(this,arguments)}function y(a,b){return a?a.find(c=>c.id===b):null}function F(a,b,c){function e(d,g){d={...c,layerId:d,sublayerTitleMode:"service-name"};m.isSome(g)&&(d.sourceJSON=g);return new b.Constructor(d)}b.sublayerIds.forEach(d=>{d=e(d,y(b.sublayerInfos,d));a.add(d)});b.tableIds.forEach(d=>{d=
e(d,y(b.tableInfos,d));a.tables.add(d)})}function E(a,b){return p.apply(this,arguments)}function p(){p=k._asyncToGenerator(function*(a,b){var c=x.parse(a);m.isNone(c)&&(c=yield G(a,b));if(m.isNone(c))throw new C("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:a});const {serverType:e,sublayer:d}=c;var g={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(e){case "MapServer":var h=null!=d?"FeatureLayer":H(a,b).then(f=>
f?"TileLayer":"MapImageLayer");break;case "ImageServer":h=l.fetchService(a,{customParameters:b}).then(f=>f.tileInfo?"LERC"!==(f.tileInfo&&f.tileInfo.format)?.toUpperCase()||f.cacheType&&"elevation"!==f.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer");break;case "SceneServer":h=l.fetchService(c.url.path,{customParameters:b}).then(f=>{if(f){if("Voxel"===f?.layerType)return"VoxelLayer";if(f?.layers&&Array.isArray(f.layers)&&0<f.layers.length){const z={Point:"SceneLayer","3DObject":"SceneLayer",
IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};f=f.layers[0]?.layerType;if(null!=z[f])return z[f]}}return"SceneLayer"});break;default:h=g[e]}g="FeatureServer"===e;c={parsedUrl:c,Constructor:null,layerOrTableId:g?d:null,sublayerIds:null,tableIds:null};h=yield h;({FeatureLayer:!0,SceneLayer:!0})[h]&&null==d&&(a=yield I(a,e,b),g&&(c.sublayerInfos=a.layerInfos,c.tableInfos=a.tableInfos),1!==a.layerIds.length+a.tableIds.length?(c.sublayerIds=a.layerIds,
c.tableIds=a.tableIds):g&&(c.layerOrTableId=a.layerIds[0]??a.tableIds[0],c.sourceJSON=a.layerInfos[0]??a.tableInfos[0]));c.Constructor=yield J(h);return c});return p.apply(this,arguments)}function G(a,b){return q.apply(this,arguments)}function q(){q=k._asyncToGenerator(function*(a,b){b=yield l.fetchService(a,{customParameters:b});let c=null,e=null;var d=b.type;"Feature Layer"===d||"Table"===d?(c="FeatureServer",e=b.id):"indexedVector"===d?c="VectorTileServer":b.hasOwnProperty("mapName")?c="MapServer":
b.hasOwnProperty("bandCount")&&b.hasOwnProperty("pixelSizeX")?c="ImageServer":b.hasOwnProperty("maxRecordCount")&&b.hasOwnProperty("allowGeometryUpdates")?c="FeatureServer":b.hasOwnProperty("streamUrls")?c="StreamServer":A(b)?(c="SceneServer",e=b.id):b.hasOwnProperty("layers")&&A(b.layers?.[0])&&(c="SceneServer");if(!c)return null;d=null!=e?x.parseNonStandardSublayerUrl(a):null;return{title:m.isSome(d)&&b.name||w.getFilename(a),serverType:c,sublayer:e,url:{path:m.isSome(d)?d.serviceUrl:w.urlToObject(a).path}}});
return q.apply(this,arguments)}function A(a){return a?.hasOwnProperty("store")&&a.hasOwnProperty("id")&&"number"===typeof a.id}function I(a,b,c){return r.apply(this,arguments)}function r(){r=k._asyncToGenerator(function*(a,b,c){let e=!1;"FeatureServer"===b?(a=yield l.fetchFeatureService(a,{customParameters:c}),e=!!a.layersJSON,b=a.layersJSON||a.serviceJSON):b=yield l.fetchService(a,{customParameters:c});a=b?.layers;b=b?.tables;return{layerIds:a?.map(d=>d.id).reverse()||[],tableIds:b?.map(d=>d.id).reverse()||
[],layerInfos:e?a:[],tableInfos:e?b:[]}});return r.apply(this,arguments)}function J(a){return t.apply(this,arguments)}function t(){t=k._asyncToGenerator(function*(a){return(0,D.layerLookupMap[a])()});return t.apply(this,arguments)}function H(a,b){return u.apply(this,arguments)}function u(){u=k._asyncToGenerator(function*(a,b){return(yield l.fetchService(a,{customParameters:b})).tileInfo});return u.apply(this,arguments)}v.fromUrl=function(a){return n.apply(this,arguments)};Object.defineProperties(v,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});