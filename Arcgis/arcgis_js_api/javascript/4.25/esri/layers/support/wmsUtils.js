// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../core/maybe ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference ../ogc/crsUtils".split(" "),function(t,X,Y,Z,D,I,K){function L(a){if(0<a.spatialReferences.length)return a.spatialReferences;if(a.sublayers)for(const d of a.sublayers)if(a=L(d),0<a.length)return a;return[]}function M(a){let d=[];for(const b of a)d.push(b),b.sublayers?.length&&(d=d.concat(M(b.sublayers)),delete b.sublayers);return d}function m(a,d){for(let b=0;b<d.childNodes.length;b++){const c=
d.childNodes[b];if(c.nodeType===Node.ELEMENT_NODE&&c.nodeName===a)return c}return null}function E(a,d){const b=[];for(let c=0;c<d.childNodes.length;c++){const f=d.childNodes[c];f.nodeType===Node.ELEMENT_NODE&&f.nodeName===a&&b.push(f)}return b}function u(a,d,b){return(a=m(a,d))?a.textContent:b}function C(a,d,b){if(!a)return null;var c=parseFloat(a.getAttribute("minx")),f=parseFloat(a.getAttribute("miny")),g=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(b=isNaN(f)?-Number.MAX_VALUE:
f,c=isNaN(c)?-Number.MAX_VALUE:c,f=isNaN(a)?Number.MAX_VALUE:a,g=isNaN(g)?Number.MAX_VALUE:g):(b=isNaN(c)?-Number.MAX_VALUE:c,c=isNaN(f)?-Number.MAX_VALUE:f,f=isNaN(g)?Number.MAX_VALUE:g,g=isNaN(a)?Number.MAX_VALUE:a);d=new I({wkid:d});return new D({xmin:b,ymin:c,xmax:f,ymax:g,spatialReference:d})}function N(a,d){if(a=m(d,a))if(a=m("DCPType",a))if(a=m("HTTP",a))if(a=m("Get",a)){var b=(a=m("OnlineResource",a))?a.getAttribute("xlink:href")??null:null;if(b){b.indexOf("\x26")===b.length-1&&(b=b.substring(0,
b.length-1));a=["service","request"];d=[];b=Z.urlToObject(b);for(const c in b.query)b.query.hasOwnProperty(c)&&(a.includes(c.toLowerCase())||d.push(c+"\x3d"+b.query[c]));return b.path+(d.length?"?"+d.join("\x26"):"")}}return null}function O(a,d){var b=E("Operation",a);if(!b.length)return d=m(d,a),E("Format",d).map(({textContent:c})=>c);a=[];for(const c of b)if(c.getAttribute("name")===d){b=E("Format",c);for(const {textContent:f}of b)a.push(f)}return a}function P(a,d,b){a=m(d,a);if(!a)return b;({textContent:a}=
a);if(null==a||""===a)return b;a=Number(a);return isNaN(a)?b:a}function F(a,d,b){if(!a)return null;const c={id:b.idCounter++,fullExtents:[],parentLayerId:null,queryable:"1"===a.getAttribute("queryable"),spatialReferences:[],sublayers:null},f=m("LatLonBoundingBox",a),g=m("EX_GeographicBoundingBox",a);let n=null;f&&(n=C(f,4326));g&&(n=new D(0,0,0,0,new I({wkid:4326})),n.xmin=parseFloat(u("westBoundLongitude",g,"0")),n.ymin=parseFloat(u("southBoundLatitude",g,"0")),n.xmax=parseFloat(u("eastBoundLongitude",
g,"0")),n.ymax=parseFloat(u("northBoundLatitude",g,"0")));f||g||(n=new D(-180,-90,180,90,new I({wkid:4326})));c.minScale=P(a,"MaxScaleDenominator",0);c.maxScale=P(a,"MinScaleDenominator",0);const v=["1.0.0","1.1.0","1.1.1"].includes(d)?"SRS":"CRS";Array.prototype.slice.call(a.childNodes).forEach(e=>{if("Name"===e.nodeName)c.name=e.textContent||"";else if("Title"===e.nodeName)c.title=e.textContent||"";else if("Abstract"===e.nodeName)c.description=e.textContent||"";else if("BoundingBox"===e.nodeName){var h=
e.getAttribute(v);if(h&&0===h.indexOf("EPSG:")){var p=parseInt(h.substring(5),10);0===p||isNaN(p)||n||(n="1.3.0"===d?C(e,p,K.isAxesOrderReversedForWkid(p)):C(e,p))}(p=h&&h.indexOf(":"))&&-1<p&&(h=parseInt(h.substring(p+1,h.length),10),0===h||isNaN(h)||(h=G[h]?G[h]:h),e="1.3.0"===d?C(e,h,K.isAxesOrderReversedForWkid(h)):C(e,h),c.fullExtents.push(e))}else if(e.nodeName===v)e.textContent.split(" ").forEach(l=>{l=l.includes(":")?parseInt(l.split(":")[1],10):parseInt(l,10);0===l||isNaN(l)||(l=G[l]?G[l]:
l,c.spatialReferences.includes(l)||c.spatialReferences.push(l))});else if("Style"!==e.nodeName||c.legendURL)"Layer"===e.nodeName&&(e=F(e,d,b))&&(e.parentLayerId=c.id,c.sublayers||(c.sublayers=[]),c.sublayers.push(e));else if(e=m("LegendURL",e))if(e=m("OnlineResource",e))c.legendURL=e.getAttribute("xlink:href")});c.extent=n?.toJSON();c.dimensions=E("Dimension",a).filter(e=>e.getAttribute("name")&&e.getAttribute("units")&&e.textContent).map(e=>{const h=e.getAttribute("name"),p=e.getAttribute("units"),
l=e.textContent,k=e.getAttribute("unitSymbol"),w=e.getAttribute("default"),y="0"!==(e.getAttribute("default")??"0"),q="0"!==(e.getAttribute("nearestValue")??"0");e="0"!==(e.getAttribute("current")??"0");return H({name:h,units:p})?{name:"time",units:"ISO8601",extent:Q(l),default:Q(w),multipleValues:y,nearestValue:q,current:e}:J({name:h,units:p})?{name:"elevation",units:p,extent:R(l),unitSymbol:k,default:R(w),multipleValues:y,nearestValue:q}:{name:h,units:p,extent:S(l),unitSymbol:k,default:S(w),multipleValues:y,
nearestValue:q}});return c}function aa(a){return Array.isArray(a)&&0<a.length&&a[0]instanceof Date}function J(a){return/^elevation$/i.test(a.name)&&/^(epsg|crs):\d+$/i.test(a.units)}function H(a){return/^time$/i.test(a.name)&&/^iso8601$/i.test(a.units)}function R(a){if(!a)return null;const d=a.includes("/");a=a.split(",");return d?a.map(b=>{var c=b.split("/");if(2>c.length)return null;b=parseFloat(c[0]);const f=parseFloat(c[1]);c=3<=c.length&&"0"!==c[2]?parseFloat(c[2]):void 0;return{min:b,max:f,
resolution:c}}).filter(b=>b):a.map(b=>parseFloat(b))}function S(a){if(!a)return null;const d=a.includes("/");a=a.split(",");return d?a.map(b=>{b=b.split("/");return 2>b.length?null:{min:b[0],max:b[1],resolution:3<=b.length&&"0"!==b[2]?b[2]:void 0}}).filter(b=>b):a}function Q(a){if(!a)return null;const d=a.includes("/");a=a.split(",");return d?a.map(b=>{var c=b.split("/");if(2>c.length)return null;b=new Date(c[0]);const f=new Date(c[1]);c=3<=c.length&&"0"!==c[2]?T(c[2]):void 0;return{min:b,max:f,resolution:c}}).filter(b=>
b):a.map(b=>new Date(b))}function T(a){var d=a.match(/(?:p(\d+y|\d+(?:.|,)\d+y)?(\d+m|\d+(?:.|,)\d+m)?(\d+d|\d+(?:.|,)\d+d)?)?(?:t(\d+h|\d+(?:.|,)\d+h)?(\d+m|\d+(?:.|,)\d+m)?(\d+s|\d+(?:.|,)\d+s)?)?/i);if(!d)return null;a=z(d[1]);const b=z(d[2]),c=z(d[3]),f=z(d[4]),g=z(d[5]);d=z(d[6]);return{years:a,months:b,days:c,hours:f,minutes:g,seconds:d}}function z(a){if(!a)return 0;a=a.match(/(?:\d+(?:.|,)\d+|\d+)/);if(!a)return 0;a=a[0].replace(",",".");return Number(a)}const G={84:4326,83:4269,27:4267},U=
new Set([102100,3857,102113,900913]),ba=new Set([3395,54004]);t.fromISODuration=T;t.getPopupLayers=function(a){a=a.filter(d=>d.popupEnabled&&d.name&&d.queryable);return a.length?a.map(({name:d})=>d).join():null};t.isDimensionInterval=function(a){return void 0!==a.min&&void 0!==a.max};t.isElevationDimension=J;t.isGenericDimension=function(a){return!H(a)&&!J(a)};t.isTimeDimension=H;t.normalizeWKID=function(a,d){let b=a.wkid;if(Y.isNone(d))return b;!d.includes(b)&&a.latestWkid&&(b=a.latestWkid);return U.has(b)?
d.find(c=>U.has(c))||d.find(c=>ba.has(c))||102100:b};t.parseCapabilities=function(a){if(!a)return null;const d={idCounter:-1};"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));a=a.documentElement;if("ServiceExceptionReport"===a.nodeName)throw a=Array.prototype.slice.call(a.childNodes).map(r=>r.textContent).join("\r\n"),new X("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",a);var b=m("Capability",a),c=m("Service",
a),f=m("Request",b);if(!b||!c||!f)return null;var g=m("Layer",b);if(!g)return null;const n="WMS_Capabilities"===a.nodeName||"WMT_MS_Capabilities"===a.nodeName?a.getAttribute("version"):"1.3.0";a=u("Title",c,"")||u("Name",c,"");var v=u("AccessConstraints",c,"");v=/^none$/i.test(v)?"":v;const e=u("Abstract",c,""),h=parseInt(u("MaxWidth",c,"5000"),10);c=parseInt(u("MaxHeight",c,"5000"),10);const p=O(f,"GetMap"),l=N(f,"GetMap"),k=F(g,n,d);let w=0,y;Array.prototype.slice.call(b.childNodes).forEach(r=>
{"Layer"===r.nodeName&&(0===w?y=r:(1===w&&k.name&&(k.name="",k.sublayers.push(F(y,n,d))),k.sublayers.push(F(r,n,d))),w++)});if(!k)return null;var q;b=k.fullExtents;(q=k.sublayers)||(q=[]);0===q.length&&q.push(k);g=k.extent;g||(g=new D(q[0].extent),k.extent=g.toJSON(),g=k.extent);const ca=0<k.spatialReferences.length?k.spatialReferences:L(k),V=N(f,"GetFeatureInfo");f=V?O(f,"GetFeatureInfo"):null;q=M(q);const da=k.minScale||0,ea=k.maxScale||0,W=k.dimensions;var B=q.reduce((r,A)=>r.concat(A.dimensions),
[]);B=W.concat(B).filter(H);var x=null;B.length&&(x=B.map(r=>{({extent:r}=r);return aa(r)?r.map(A=>A.getTime()):r.map(A=>[A.min.getTime(),A.max.getTime()])}).flat(2),B=Math.min(...x),x=Math.max(...x),x={startTimeField:null,endTimeField:null,trackIdField:null,timeExtent:[B,x]});return{copyright:v,description:e,dimensions:W,extent:g,fullExtents:b,featureInfoFormats:f,featureInfoUrl:V,mapUrl:l,maxWidth:h,maxHeight:c,maxScale:ea,minScale:da,layers:q,spatialReferences:ca,supportedImageFormatTypes:p,timeInfo:x,
title:a,version:n}};t.toISOString=function(a){return a.toISOString().replace(/\.[0-9]{3}/,"")};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});