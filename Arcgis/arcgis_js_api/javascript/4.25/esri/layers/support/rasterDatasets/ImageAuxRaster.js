// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./BaseRaster ./InMemoryRaster ./pamParser ../rasterFormats/RasterCodec ../rasterFunctions/stretchUtils ../rasterTransforms/PolynomialTransform ../../../geometry/SpatialReference ../../../geometry/Extent".split(" "),
function(h,q,k,v,w,x,r,y,K,L,z,A,B,C,D,E,F,G,H){k=function(t){function p(){return t.apply(this,arguments)||this}h._inheritsLoose(p,t);var l=p.prototype;l.open=function(){var e=h._asyncToGenerator(function*(b){yield this.init();var a=yield this._fetchData(b);let {spatialReference:c,statistics:d,histograms:g,transform:f}=yield this._fetchAuxiliaryData(b);(b=!c)&&(c=new G({wkid:3857}));g?.length&&null==d&&(d=E.estimateStatisticsFromHistograms(g));const {width:I,height:J}=a;let m=new H({xmin:-.5,ymin:.5-
J,xmax:I-.5,ymax:.5,spatialReference:c});const u=f?f.forwardTransform(m):m;var n=!0;f&&(n=(n=f.forwardCoefficients)&&0===n[1]&&0===n[2])&&(f=null,m=u);a=new B({data:{extent:u,nativeExtent:m,transform:f,pixelBlock:a,statistics:d,histograms:g,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:b}});yield a.open();a.data=null;this._set("rasterInfo",a.rasterInfo);this._inMemoryRaster=a});return function(b){return e.apply(this,arguments)}}();l.fetchRawTile=function(e,b,a,c={}){return this._inMemoryRaster.fetchRawTile(e,
b,a,c)};l._fetchData=function(){var e=h._asyncToGenerator(function*(b){({data:b}=yield this.request(this.url,{responseType:"array-buffer",signal:b?.signal}));var a=D.getFormat(b).toUpperCase();if("JPG"===a||"PNG"===a||"GIF"===a||"BMP"===a)this._set("datasetFormat",a);else throw new v("image-aux-raster:open","the data is not a supported format");a=a.toLowerCase();const c="gif"===a||"bmp"===a||!w("ios");return yield this.decodePixelBlock(b,{format:a,useCanvas:c,hasNoZlibMask:!0})});return function(b){return e.apply(this,
arguments)}}();l._fetchAuxiliaryData=function(){var e=h._asyncToGenerator(function*(b){b=x.unwrap(b?.signal);var a=this.ioConfig.skipExtensions??[],c=a.includes("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:b}),d=this.datasetFormat;a=(d="JPG"===d?"jgw":"PNG"===d?"pgw":"BMP"===d?"bpw":null)&&a.includes(d)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+d,{responseType:"text",signal:b});c=yield r.eachAlways([c,a]);if(b?.aborted)throw r.createAbortError();
b=C.parsePAMInfo(c[0].value?.data);b.transform||(c=c[1].value?c[1].value.data.split("\n").slice(0,6).map(g=>Number(g)):null,b.transform=6===c?.length?new F({forwardCoefficients:[c[4],c[5],c[0],-c[1],c[2],-c[3]]}):null);return b});return function(b){return e.apply(this,arguments)}}();return p}(A);q.__decorate([y.property({type:String,json:{write:!0}})],k.prototype,"datasetFormat",void 0);return k=q.__decorate([z.subclass("esri.layers.support.rasterDatasets.ImageAuxRaster")],k)});