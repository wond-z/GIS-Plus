// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/Extent ../../../geometry/Polygon ../../ogc/crsUtils ../RasterInfo ./xmlUtilities".split(" "),function(J,z,T,U,K,b){function V(a){const c=b.getElementValues(a,"requestResponseCRSs").map(d=>d.split(":")[1]);a=b.getElementValues(a,"nativeCRSs").map(d=>d.split(":")[1]);return{requestResponseCRSs:c,nativeCRSs:a}}function Q(a,c){const d=b.getElementValues(a,"1.0.0"===c?"interpolationMethod":"InterpolationMethod"),m="1.0.0"===c?a.getAttribute("default"):b.getElementValue(a,
"InterpolationMethods/Default");return null!=m?[m].concat(d.filter(f=>f.toLowerCase()!==m.toLowerCase())):d}function L(a){return null==a?["nearest"]:a.map(c=>{c=c.toLowerCase();return c.includes("nearest")?"nearest":c.includes("linear")?"bilinear":c.includes("cubic")?"cubic":null}).filter(c=>!!c)}function M(a,c){a=b.getElementValues(a,c);return a?.length&&""!==a[0]&&!isNaN(Number(a[0]))?a.map(d=>Number(d)):null}function N(a){return null==a?null:a.every(c=>c===a[0])?a[0]:a}function W(a=null){if(!a)return{resolution:null,
units:null};let c=a.toUpperCase();var d=["Y","M","D"];const m=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");let f;c.includes("PT")?(c=c.slice(2),d=m.findIndex(g=>c.includes(g)),f=a[3+d]):(c=c.slice(1),d=d.findIndex(g=>c.includes(g)),-1<d&&(f=a[d]));return{resolution:parseFloat(c.substring(0,c.length-1)),units:f}}function C(a){var c=b.getElements(a,"timeposition");if(0<c.length){a=[];for(var d=0;d<c.length;d++)a.push(new Date(b.getElementValue(c[d])));return{begin:a[0],end:a[a.length-
1],values:a}}return(d=b.getElement(a,"timePeriod")||b.getElement(a,"TimePeriod"))?(c=new Date(b.getElementValue(d,"beginPosition")||b.getElementValue(d,"BeginPosition")),a=new Date(b.getElementValue(d,"endPosition")||b.getElementValue(d,"EndPosition")),d=b.getElementValue(d,"timeResolution")||b.getElementValue(d,"TimeResolution"),d=W(d),{begin:c,end:a,...d}):null}function X(a){if(!a.temporalDomain)return null;const {begin:c,end:d,values:m,units:f,resolution:g}=a.temporalDomain;return{variables:[{name:"default",
description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:m?.map(l=>l.getTime()),hasRegularIntervals:!m,interval:g,intervalUnit:f,extent:[c.getTime(),d.getTime()]}]}]}}function Y(a,c){if(!c.temporalDomain)return null;a=a.filter(m=>!m.identifier.toLowerCase().includes("field_1")&&!m.axis.some(f=>f.identifier.includes("band")));const d=[];a.length&&a.forEach(m=>{const f=m.axis.map(g=>{const l=g.values.map(e=>"ISO8601"===g.uom?(e=e.trim(),e.toLowerCase().includes("z")?(new Date(e)).getTime():
(new Date(e+"Z")).getTime()):parseFloat(e.trim())),h=[Math.min.apply(null,l),Math.max.apply(null,l)];return{name:g.identifier.trim(),description:"",field:g.identifier.trim(),unit:g.uom?g.uom.trim():"",hasRegularIntervals:!1,values:l,extent:h}});d.push({name:m.identifier.trim(),description:m.description?.trim()??"",unit:"",dimensions:f})});if(c.temporalDomain){const {begin:m,end:f,values:g,units:l,resolution:h}=c.temporalDomain;d.some(e=>e.dimensions.some(k=>"stdtime"===k.name.toLowerCase()))||d.forEach(e=>
{e.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:g?.map(k=>k.getTime()),hasRegularIntervals:!g,interval:h,intervalUnit:l,extent:[m.getTime(),f.getTime()]})})}return d.length?{variables:d}:null}function Z(a){var c=b.getElement(a,"SpatialDomain"),d=b.getElement(c,"GridCRS"),m=b.getElementValue(d,"GridBaseCRS");const f=b.getElementValue(d,"GridOrigin")?.split(" ").map(p=>parseFloat(p))??[0,0];d=b.getSpaceDelimitedNumericValues(d,"GridOffsets");c=b.getElements(c,"BoundingBox");
let g;for(var l=0;l<c.length;l++){var h=c[l].getAttribute("crs")?.toLowerCase();if(null!=h)if(h.includes("imagecrs")){var e=b.getSpaceDelimitedNumericValues(c[l],"LowerCorner");h=b.getSpaceDelimitedNumericValues(c[l],"UpperCorner");g=h[0]-e[0]+1;e=h[1]-e[1]+1}else if(0<h.indexOf("epsg")){var k=h.split(":");k=parseInt(k[k.length-1],10);var n=b.getSpaceDelimitedNumericValues(c[l],"LowerCorner");h=b.getSpaceDelimitedNumericValues(c[l],"UpperCorner");n=new z({xmin:n[0],ymin:n[1],xmax:h[0],ymax:h[1],spatialReference:{wkid:k}})}}c=
g>e;l=n.xmax-n.xmin>n.ymax-n.ymin;h=!1;U.isAxesOrderReversedForWkid(k)&&(c===l?h=!1:(h=!0,n=new z({xmin:n.ymin,ymin:n.xmin,xmax:n.ymax,ymax:n.xmax,spatialReference:{wkid:k}})));m={columns:g,rows:e,origin:{x:f[0],y:f[1]},offset:{x:d[0],y:d[d.length-1]},gridBaseCRS:m,envelope:n,useEPSGAxis:h};a=(a=b.getElement(a,"temporalDomain")||b.getElement(a,"TemporalDomain"))?C(a):null;return{spatialDomain:m,temporalDomain:a}}function aa(a){const c=b.getElement(a,"Envelope")||b.getElement(a,"EnvelopeWithTimePeriod");
var d=c.getAttribute("srsName"),m=d.slice(d.lastIndexOf("/")+1);d=c.getAttribute("axisLabels").split(" ").map(k=>k.trim()).filter(k=>""!==k.trim());var f=b.getSpaceDelimitedNumericValues(c,"lowerCorner"),g=b.getSpaceDelimitedNumericValues(c,"upperCorner");const l=!"y lat latitude north nor n b".split(" ").includes(d[0].toLowerCase());m=parseInt(m,10);m=isNaN(m)?null:{wkid:m};m=l?new z({xmin:f[0],ymin:f[1],xmax:g[0],ymax:g[1],spatialReference:m}):new z({xmin:f[1],ymin:f[0],xmax:g[1],ymax:g[0],spatialReference:m});
f={mins:f,maxs:g};g=c.getAttribute("uomLabels").trim().split(" ");let h,e;b.isSameTagIgnoreNS(c,"EnvelopeWithTimePeriod")&&(h=new Date(b.getElementValue(a,"beginPosition")||b.getElementValue(a,"BeginPosition")),e=new Date(b.getElementValue(a,"endPosition")||b.getElementValue(a,"EndPosition")),a=g?.findIndex(k=>"oledatetime"===k?.toLowerCase()),-1<a&&(g[a]="ISO8601"));return{envelope:m,axisLabels:d,uomLabels:g.length?g:null,envelopeAllDims:f,beginPosition:h,endPosition:e,isEastFirst:l}}function ba(a,
c){const d=[];a=b.getElements(a,"DataRecord");const m=[];let f=[],g;for(let l=0;l<a.length;l++){const h=b.getElements(a[l],"field"),e=[];for(let k=0;k<h.length;k++){const n=h[k].getAttribute("name"),p=b.getElementValue(h[k],"description")||"",q=b.getElement(h[k],"uom")?.getAttribute("code")||"",r=b.getSpaceDelimitedNumericValues(h[k],"interval"),t=M(h[k],"nilValue")?.[0];if(!c||n.toLowerCase().includes("band"))m.push(n),r?.length&&(g=g||[],g.push({min:r[0],max:r[1],avg:-1,stddev:-1})),f.push(t);e.push({name:n,
description:p,uom:q,allowedValues:r,nilValue:t})}d.push(e)}f.some(l=>null!=l)||(f=null);return{rangeType:d,bandNames:m,bandStats:g,bandNoDataValues:f}}function ca(a){let c=1,d="";Math.abs(a-1/24)<1/24*.01?d="Hours":.01>Math.abs(a-1)?d="Days":1>a?(c=Math.round(24*a),d="Hours"):27.99<a&&31.01>a?d="Months":12>Math.round(a/30)?d="Months":364.99<a&&366.01>a&&(d="Years");return{interval:c,intervalUnit:d}}function da(a,c,d){if(2>=d.axisLabels.length)return null;const m=[];for(var f=0;f<a.length;f++){var g=
a[f];for(var l=0;l<g.length;l++)g[l].name.toLowerCase().includes("band")||m.push(g[l])}const h=[];if(m.length){const e=[];for(a=2;a<d.axisLabels.length;a++){l=(c.uomLabels?.length??0)>a?c.uomLabels?.[a]:"";(f=d.axisLabels[a].toLowerCase().includes("time")||"iso8601"===l.toLowerCase()||"oledatetime"===l.toLowerCase())?(l=ca(d.offset[a]),g=l.interval,l=l.intervalUnit):g=d.offset[a];const k=[];f?(k.push((new Date).setTime(864E5*(c.envelopeAllDims.mins[a]-25569))),k.push((new Date).setTime(864E5*(c.envelopeAllDims.maxs[a]-
25569)))):(k.push(c.envelopeAllDims.mins[a]),k.push(c.envelopeAllDims.maxs[a]));e.push({name:d.axisLabels[a].trim(),description:d.axisLabels[a].trim(),unit:c.uomLabels&&c.uomLabels.length>a?c.uomLabels[a].trim():"",hasRegularIntervals:!0,extent:k,interval:g,intervalUnit:l})}m.forEach(k=>{var {allowedValues:n}=k;n=2===n?.length?[{min:n[0],max:n[1],avg:-1,stddev:-1}]:null;h.push({name:k.name.trim(),description:k.description?.trim()??"",unit:k.uom.trim(),statistics:n,dimensions:e})});if(h.length)return{variables:h}}return null}
function ea(a,c){var d=b.getElement(a,"RectifiedGrid"),m=b.getSpaceDelimitedNumericValues(d,"low"),f=b.getSpaceDelimitedNumericValues(d,"high");a=[];for(var g=0;g<m.length;g++)a.push(f[g]-m[g]+1);m=b.getElementValue(d,"axisLabels").split(" ");f=b.getSpaceDelimitedNumericValues(d,"origin/pos");g=b.getElements(d,"offsetVector");d=[];for(var l=0;l<g.length;l++){var h=b.getSpaceDelimitedNumericValues(g[l]);const e=h.findIndex(k=>0!==k);d[e]=h[e]}g=!1;c?.length&&m?.length&&(g=[...c].sort((e,k)=>e<k?-1:
1).join(","),l=[...m].sort((e,k)=>e<k?-1:1).join(","),g=g===l);"y lat latitude north nor n b".split(" ").includes((g?m:c)[0].toLowerCase())?(c=a[1],l=a[0],h={y:Math.abs(d[0]),x:Math.abs(d[1])}):(c=a[0],l=a[1],h={x:Math.abs(d[0]),y:Math.abs(d[1])});return{columns:c,rows:l,origin:f,offset:d,resolution:h,gridSamples:a,axisLabels:m,hasSameAxisLabelsAsBoundedBy:g}}function fa(a){var c=b.getElement(a,"EarthObservation");if(!c)return null;var d=b.getElement(c,"phenomenonTime");d=d?C(d):null;var m=b.getElement(c,
"phenomenonTime");m=m?C(m):null;var f=b.getElementValue(c,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");c=null;if(f&&(f=f.split(" ").map(l=>l.trim()).filter(l=>null!=l&&""!==l),f.length)){c=[];for(var g=0;g<f.length/2;g+=2)c.push(f[g],f[g+1]);c=new T({rings:[c],spatialReference:{wkid:4326}})}f=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/identifier");g=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/acquisitionType");
a=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/status");return{observation:{phonomenonTime:d,resultTime:m,footprint:c,identifier:f,acquisitionType:g,status:a}}}J.parseCoverages=function(a,c){let d=null;d="string"===typeof a?(new DOMParser).parseFromString(a,"text/xml"):a;if("1.0.0"===c)return b.getElements(d,"CoverageOffering").map(m=>{const f={version:"1.0"};var g=[],l;for(var h=0;h<m.childNodes.length;h++){var e=m.childNodes[h];if(1===e.nodeType)if(b.isSameTagIgnoreNS(e,"description"))f.description=
b.getElementValue(e);else if(b.isSameTagIgnoreNS(e,"name"))f.name=b.getElementValue(e);else if(b.isSameTagIgnoreNS(e,"label"))f.label=b.getElementValue(e);else if(b.isSameTagIgnoreNS(e,"supportedFormats"))f.supportedFormats=b.getElementValues(e,"formats");else if(b.isSameTagIgnoreNS(e,"supportedCRSs"))f.supportedCRSs=V(e);else if(b.isSameTagIgnoreNS(e,"supportedInterpolations"))f.supportedInterpolations=Q(e,"1.0.0");else if(b.isSameTagIgnoreNS(e,"lonLatEnvelope")){var k=b.getElements(e,"pos");e=b.getSpaceDelimitedNumericValues(k[0]);
k=b.getSpaceDelimitedNumericValues(k[1]);e=new z({xmin:e[0],ymin:e[1],xmax:k[0],ymax:k[1],spatialReference:{wkid:4326}});f.lonLatEnvelope=e}else if(b.isSameTagIgnoreNS(e,"rangeSet")){g=[];k=b.getElements(e,"RangeSet");e=[];for(var n=0;n<k.length;n++){var p=b.getElementValue(k[n],"name"),q=b.getElementValue(k[n],"label"),r=[],t=M(k[n],"nullValues/singleValue");const x=b.getElements(k[n],"AxisDescription");for(let w=0;w<x.length;w++){const D=b.getElementValue(x[w],"name"),O=b.getElementValue(x[w],"label"),
y=b.getElementValues(x[w],"singleValue");if(0===y.length){var u=b.getElementValue(x[w],"min");const E=b.getElementValue(x[w],"max"),F=Number(b.getElementValue(x[w],"res"))||1;if(null!==u&&null!==E)for(u=parseInt(u,10);u<=parseInt(E,10);u+=F)y.push(u.toString())}"band"===D.toLowerCase()&&(e=y);r.push({name:D,label:O,values:y})}g.push({name:p,label:q,nullValues:t,axis:r})}k=g;g=e;f.rangeSet=k;e=k[0].nullValues;e?.length&&(l=N(e))}else b.isSameTagIgnoreNS(e,"domainSet")&&(k=b.getElement(e,"spatialDomain"),
n=b.getElement(k,"Envelope")||b.getElement(k,"EnvelopeWithTimePeriod"),p=n.getAttribute("srsName").split(":"),p=p[p.length-1],q=b.getElements(n,"pos"),n=b.getSpaceDelimitedNumericValues(q[0]),q=b.getSpaceDelimitedNumericValues(q[1]),p=parseInt(p,10),p=isNaN(p)?null:{wkid:p},n=new z({xmin:n[0],ymin:n[1],xmax:q[0],ymax:q[1],spatialReference:p}),p=b.getElement(k,"RectifiedGrid"),q=b.getElementValue(p,"low").split(" "),r=b.getElementValue(p,"high").split(" "),p=parseInt(r[0],10)-parseInt(q[0],10)+1,q=
parseInt(r[1],10)-parseInt(q[1],10)+1,r=b.getSpaceDelimitedNumericValues(k,"origin/pos"),t=b.getElements(k,"offsetVector"),k=parseFloat(b.getElementValue(t[0]).split(" ")[0]),t=parseFloat(b.getElementValue(t[1]).split(" ")[1]),k={envelope:n,columns:p,rows:q,offset:{x:k,y:t},origin:{x:r[0],y:r[1]}},e=(e=b.getElement(e,"temporalDomain")||b.getElement(e,"TemporalDomain"))?C(e):null,f.domainSet={spatialDomain:k,temporalDomain:e})}m=L(f.supportedInterpolations);const {name:G,description:H,label:I,lonLatEnvelope:v,
supportedFormats:P}=f;({spatialDomain:h}=f.domainSet);e={x:Math.abs(h.offset.x),y:Math.abs(h.offset.y)};k=X(f.domainSet);l=new K({width:h.columns,height:h.rows,pixelSize:e,extent:h.envelope,spatialReference:h.envelope.spatialReference,bandCount:g.length||1,noDataValue:l,multidimensionalInfo:k});return{id:G,title:f.name,description:H||I,lonLatEnvelope:v,rasterInfo:l,bandNames:g,supportedFormats:P,supportedInterpolations:m,coverageDescription:f,version:"1.0.0",useEPSGAxis:!1}});a=b.getElements(d,"CoverageDescription");
return"1.1.0"===c||"1.1.1"===c||"1.1.2"===c?a.map(m=>{const f=[];var g=[];const l={supportedFormats:f,supportedCRSs:g,version:"1.1"};var h=[],e;for(var k=0;k<m.childNodes.length;k++){var n=m.childNodes[k];if(1===n.nodeType){var p=b.getNodeNameIgnoreNS(n).toLowerCase();switch(p){case "title":case "abstract":case "identifier":l[p]=b.getElementValue(n);break;case "supportedformat":p=b.getElementValue(n);f.includes(p)||f.push(p);break;case "supportedcrs":p=b.getElementValue(n);g.includes(p)||g.push(p);
break;case "range":p=void 0;h=!!l.domain?.temporalDomain;const H=[];n=b.getElements(n,"Field");let I=[];for(let v=0;v<n.length;v++){const P=b.getElementValue(n[v],"Identifier"),x=b.getElementValue(n[v],"Description"),w=b.getElementValue(n[v],"Definition"),D=b.getElementValue(n[v],"Abstract"),O=b.getElementValue(n[v],"Title"),y=M(n[v],"NullValue"),E=Q(n[v],"1.1.0"),F=[],B=b.getElements(n[v],"Axis");for(let A=0;A<B.length;A++){const R=B[A].getAttribute("identifier"),ha=b.getElementValue(B[A],"UOM"),
ia=b.getElementValue(B[A],"DataType"),S=b.getElementValues(B[A],"Key");if(!h||R.toLowerCase().includes("band"))I=S,p=y;F.push({identifier:R,uom:ha,dataType:ia,values:S,bandNoDataValues:p})}H.push({identifier:P,description:x,definition:w,abstract:D,title:O,supportedInterpolations:E,axis:F,nullValues:y})}p={rangeSet:H,bandNames:I,bandNoDataValues:p};l.range=p.rangeSet;h=p.bandNames;({bandNoDataValues:p}=p);p?.length&&(e=N(p));break;case "domain":l.domain=Z(n)}}}m=L(l.range[0].supportedInterpolations);
const {identifier:q,abstract:r,title:t,domain:u,range:G}=l;g={x:Math.abs(u.spatialDomain.offset.x),y:Math.abs(u.spatialDomain.offset.y)};if(k=Y(G,u))e=G[0].nullValues,1===e?.length&&(e=e[0]);e=new K({width:u.spatialDomain.columns,height:u.spatialDomain.rows,pixelSize:g,extent:u.spatialDomain.envelope,spatialReference:u.spatialDomain.envelope.spatialReference,bandCount:h.length||1,noDataValue:e,multidimensionalInfo:k});return{id:q,title:l.title,description:r||t,lonLatEnvelope:null,bandNames:h,rasterInfo:e,
supportedFormats:f,supportedInterpolations:m,coverageDescription:l,version:c,useEPSGAxis:u.spatialDomain.useEPSGAxis}}):a.map(m=>{const f={version:"2.0"};let g=[];let l;for(let t=0;t<m.childNodes.length;t++){var h=m.childNodes[t];if(1===h.nodeType)if(b.isSameTagIgnoreNS(h,"coverageId"))f.coverageId=b.getElementValue(h);else if(b.isSameTagIgnoreNS(h,"ServiceParameters"))f.serviceParameters={supportedFormats:b.getElementValues(h,"nativeFormat")};else if(b.isSameTagIgnoreNS(h,"boundedBy"))f.boundedBy=
aa(h);else if(b.isSameTagIgnoreNS(h,"rangeType")){h=ba(h,2<f.boundedBy?.axisLabels.length||2<f.domainSet?.axisLabels.length);f.rangeType=h.rangeType;g=h.bandNames;var e=h.bandStats;({bandNoDataValues:h}=h);h?.length&&(l=N(h))}else b.isSameTagIgnoreNS(h,"domainSet")?f.domainSet=ea(h,f.boundedBy?.axisLabels):b.isSameTagIgnoreNS(h,"metadata")&&(h=b.getElement(h,"EOMetadata"),f.eoMetadata=h?fa(h):null)}const {coverageId:k,boundedBy:n,domainSet:p,rangeType:q,serviceParameters:r}=f;m=da(q,n,p);!e&&m&&(e=
m?.variables[0].statistics);null!=m&&(l=q[0][0].nilValue);e=new K({width:p.columns,height:p.rows,pixelSize:p.resolution,extent:n.envelope,spatialReference:n.envelope.spatialReference,bandCount:g.length||1,statistics:e,noDataValue:l,multidimensionalInfo:m});return{id:k,title:k,description:k,lonLatEnvelope:null,bandNames:g,rasterInfo:e,supportedFormats:r.supportedFormats,supportedInterpolations:null,coverageDescription:f,version:"2.0.1",useEPSGAxis:!1}})};J.standardizeInterpolations=L;Object.defineProperties(J,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});