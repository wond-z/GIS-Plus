// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../RasterInfo ./BaseRaster ../rasterFunctions/pixelUtils ../rasterFunctions/stretchUtils ../../../geometry/Extent ../../../geometry/SpatialReference".split(" "),function(h,k,
f,w,r,x,t,J,K,y,z,A,B,C,D,E){f=function(u){function l(){var c=u.apply(this,arguments)||this;c.datasetFormat="MEMORY";c.data=null;return c}h._inheritsLoose(l,u);var m=l.prototype;m.open=function(){var c=h._asyncToGenerator(function*(a){yield this.init();var b=this.data;const {pixelBlock:d,statistics:e,histograms:n,name:v,keyProperties:F,nativeExtent:G,transform:H}=this.data,{width:p,height:q,pixelType:I}=d,g=b.extent??new D({xmin:-.5,ymin:.5,xmax:p-.5,ymax:q-.5,spatialReference:new E({wkid:3857})});
b=new z({width:p,height:q,pixelType:I,extent:g,nativeExtent:G,transform:H,pixelSize:{x:g.width/p,y:g.height/q},spatialReference:g.spatialReference,bandCount:3,keyProperties:F||{},statistics:e,isPseudoSpatialReference:b.isPseudoSpatialReference??!b.extent,histograms:n});this.createRemoteDatasetStorageInfo(b,512,512);this._set("rasterInfo",b);this.updateTileInfo();yield this._buildInMemoryRaster(d,{width:512,height:512},a);this.datasetName=v;this.url="/InMemory/"+v});return function(a){return c.apply(this,
arguments)}}();m.fetchRawTile=function(c,a,b,d){c=this._pixelBlockTiles.get(`${c}/${a}/${b}`);return Promise.resolve(c)};m._buildInMemoryRaster=function(){var c=h._asyncToGenerator(function*(a,b,d){var e=this.rasterInfo.storageInfo.maximumPyramidLevel;const n=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:a,tileSize:b,maximumPyramidLevel:e},d):Promise.resolve(B.split(a,b,e));b=r.isSome(this.rasterInfo.statistics);e=r.isSome(this.rasterInfo.histograms);a=b?Promise.resolve({statistics:null,
histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:a},d):Promise.resolve(C.estimateStatisticsHistograms(a));a=yield x.eachAlways([n,a]);if(!a[0].value&&a[1].value)throw new w("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=a[0].value;b||(this.rasterInfo.statistics=a[1].value?.statistics);e||(this.rasterInfo.histograms=a[1].value?.histograms)});return function(a,b,d){return c.apply(this,arguments)}}();return l}(A);
k.__decorate([t.property({type:String,json:{write:!0}})],f.prototype,"datasetFormat",void 0);k.__decorate([t.property()],f.prototype,"data",void 0);return f=k.__decorate([y.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],f)});