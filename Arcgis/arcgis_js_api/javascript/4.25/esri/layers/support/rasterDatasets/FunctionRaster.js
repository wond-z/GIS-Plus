// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./BaseRaster".split(" "),function(m,n,x,u,p,f,A,y,z){f=function(v){function q(){var a=v.apply(this,arguments)||this;a.datasetFormat="Function";a.tileType="Raster";a.rasterFunction=null;a._primaryRasters=null;return a}m._inheritsLoose(q,
v);var r=q.prototype;r.open=function(){var a=m._asyncToGenerator(function*(b){yield this.init();const {rasterFunction:g}=this,{rasters:h,rasterIds:t}=g.getPrimaryRasters();var c=h.map(d=>d.rasterInfo?void 0:d.open(b));yield Promise.all(c);c=h.map(({rasterInfo:d})=>d);c=g.bind({rasterInfos:c,rasterIds:t});if(!c.success)throw new x("raster-function:open",`cannot bind the function: ${c.error??""}`);yield this.syncJobHandler();this.set("sourceJSON",h[0].sourceJSON);this.set("rasterInfo",g.rasterInfo)});
return function(b){return a.apply(this,arguments)}}();r.syncJobHandler=function(){var a=m._asyncToGenerator(function*(){const {rasterFunction:b}=this;this._primaryRasters=b.getPrimaryRasters();if(this.rasterJobHandler)return this.rasterJobHandler.updateRasterFunction(b)});return function(){return a.apply(this,arguments)}}();r.fetchPixels=function(){var a=m._asyncToGenerator(function*(b,g,h,t={}){const {rasters:c,rasterIds:d}=this._primaryRasters;var k=c.map(e=>e.fetchPixels(b,g,h,t));k=yield Promise.all(k);
var l=k.map(e=>e.pixelBlock);if(l.every(e=>u.isNone(e)))return k[0];const w=k.find(e=>u.isSome(e.pixelBlock))?.extent??b;l=this.rasterJobHandler?yield this.rasterJobHandler.process({extent:w,primaryPixelBlocks:l,primaryRasterIds:d}):this.rasterFunction.process({extent:w,primaryPixelBlocks:l,primaryRasterIds:d});return{...k[0],pixelBlock:l}});return function(b,g,h){return a.apply(this,arguments)}}();return q}(z);n.__decorate([p.property({type:String,json:{write:!0}})],f.prototype,"datasetFormat",void 0);
n.__decorate([p.property()],f.prototype,"tileType",void 0);n.__decorate([p.property()],f.prototype,"rasterFunction",void 0);return f=n.__decorate([y.subclass("esri.layers.support.rasterDatasets.FunctionRaster")],f)});