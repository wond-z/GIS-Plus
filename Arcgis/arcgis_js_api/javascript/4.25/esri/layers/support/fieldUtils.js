// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ../../core/object ./domainUtils ../../support/arcadeOnDemand".split(" "),function(ea,d,g,fa,h,w,q,ha){function R(a,b,c){if(a)for(const e of a)(a=(a=w.getDeepValue(e,b))&&"function"!==typeof a&&c.get(a))&&w.setDeepValue(e,a.name,b)}function m(a,b){if(!a||!b)return[];x.clear();n(x,a,b);return Array.from(x).sort()}function n(a,b,c){if(c)if(b?.fields?.length)if(c.includes("*"))for(const {name:e}of b.fields)a.add(e);
else for(const e of c)p(a,b,e);else if(c.includes("*"))a.clear(),a.add("*");else for(const e of c)null!=e&&a.add(e)}function p(a,b,c){"string"===typeof c&&(b?(b=b.get(c))&&a.add(b.name):a.add(c))}function k(a,b,c){return y.apply(this,arguments)}function y(){y=g._asyncToGenerator(function*(a,b,c){if(c){var {arcadeUtils:e}=yield ha.loadArcade();c=e.extractFieldNames(c,b?.fields?.map(f=>f.name));for(const f of c)p(a,b,f)}});return y.apply(this,arguments)}function S(a,b,c){return z.apply(this,arguments)}
function z(){z=g._asyncToGenerator(function*(a,b,c){if(c&&"1\x3d1"!==c){const e=(yield new Promise((f,l)=>ea(["../../core/sql/WhereClause"],f,l))).WhereClause.create(c,b);if(!e.isStandardized)throw new fa("fieldUtils:collectFilterFields","Where clause is not standardized",{where:c});n(a,b,e.fieldNames)}});return z.apply(this,arguments)}function A(a,b){for(const c of a)if(c&&c.valueType&&c.valueType===b)return c.name;return null}function B(){B=g._asyncToGenerator(function*(a){if(!a)return[];const b=
new Set;yield T(b,a);return Array.from(b).sort()});return B.apply(this,arguments)}function T(a,b){return C.apply(this,arguments)}function C(){C=g._asyncToGenerator(function*(a,b){if(b){var c=w.getDeepValue("elevationInfo.featureExpressionInfo",b);if(c)return c.collectRequiredFields(a,b.fieldsIndex)}});return C.apply(this,arguments)}function D(){D=g._asyncToGenerator(function*(a,b,c){if(b&&c&&"fields"in c){var e=[];e.push(U(a,b,c.popupTemplate));c.fields&&e.push(...c.fields.map(function(){var f=g._asyncToGenerator(function*(l){l.onStatisticExpression?
k(a,b.fieldsIndex,l.onStatisticExpression.expression):a.add(l.onStatisticField)});return function(l){return f.apply(this,arguments)}}()));yield Promise.all(e)}});return D.apply(this,arguments)}function U(a,b,c){return E.apply(this,arguments)}function E(){E=g._asyncToGenerator(function*(a,b,c){const e=[];c?.expressionInfos&&e.push(...c.expressionInfos.map(f=>k(a,b.fieldsIndex,f.expression)));c=c?.content;if(Array.isArray(c))for(const f of c)"expression"===f.type&&f.expressionInfo&&e.push(k(a,b.fieldsIndex,
f.expressionInfo.expression));yield Promise.all(e)});return E.apply(this,arguments)}function F(){F=g._asyncToGenerator(function*(a,b,c){b&&(b.timeInfo&&h.isSome(c)&&c.timeExtent&&n(a,b.fieldsIndex,[b.timeInfo.startField,b.timeInfo.endField]),b.floorInfo&&n(a,b.fieldsIndex,[b.floorInfo.floorField]),h.isSome(c)&&h.isSome(c.where)&&(yield S(a,b.fieldsIndex,c.where)))});return F.apply(this,arguments)}function G(){G=g._asyncToGenerator(function*(a,b,c){b&&c&&(yield Promise.all(c.map(e=>ia(a,b,e))))});
return G.apply(this,arguments)}function ia(a,b,c){return H.apply(this,arguments)}function H(){H=g._asyncToGenerator(function*(a,b,c){b&&c&&(c.valueExpression?yield k(a,b.fieldsIndex,c.valueExpression):c.field&&p(a,b.fieldsIndex,c.field))});return H.apply(this,arguments)}function I(){I=g._asyncToGenerator(function*(a){if(!a)return[];const b="timeInfo"in a&&a.timeInfo;return b?m(a.fieldsIndex,[a.trackIdField,b.startField,b.endField]):[]});return I.apply(this,arguments)}function J(){J=g._asyncToGenerator(function*(a){if(!a)return[];
const b=new Set;yield V(b,a);return Array.from(b).sort()});return J.apply(this,arguments)}function V(a,b){return K.apply(this,arguments)}function K(){K=g._asyncToGenerator(function*(a,b){const {labelingInfo:c,fieldsIndex:e}=b;c&&c.length&&(yield Promise.all(c.map(f=>ja(a,e,f))))});return K.apply(this,arguments)}function ja(a,b,c){return L.apply(this,arguments)}function L(){L=g._asyncToGenerator(function*(a,b,c){if(c){var e=c.getLabelExpression();c=c.where;"arcade"===e.type?yield k(a,b,e.expression):
(e=e.expression.match(/{[^}]*}/g))&&e.forEach(f=>{p(a,b,f.slice(1,-1))});yield S(a,b,c)}});return L.apply(this,arguments)}function M(a){return"number"===typeof a&&!isNaN(a)&&isFinite(a)}function ka(a){return null===a||M(a)}function la(a){return null===a||r(a)}function W(a){return null!=a&&"string"===typeof a}function ma(a){return null===a||W(a)}function na(){return!0}function N(a,b){let c;switch(a.type){case "date":case "integer":case "long":case "small-integer":case "esriFieldTypeDate":case "esriFieldTypeInteger":case "esriFieldTypeLong":case "esriFieldTypeSmallInteger":c=
a.nullable?la:r;break;case "double":case "single":case "esriFieldTypeSingle":case "esriFieldTypeDouble":c=a.nullable?ka:M;break;case "string":case "esriFieldTypeString":c=a.nullable?ma:W;break;default:c=na}return 1===arguments.length?c:c(b)}function O(a){return null!=a&&oa.has(a.type)}function X(a,b){return a.nullable&&null===b?null:O(a)&&!Y(a.type,Number(b))?d.NumericRangeValidationError.OUT_OF_RANGE:N(a,b)?a.domain?q.validateDomainValue(a.domain,b):null:d.TypeValidationError.INVALID_TYPE}function Y(a,
b){a="string"===typeof a?P(a):a;if(!a)return!1;const c=a.min,e=a.max;return a.isInteger?r(b)&&b>=c&&b<=e:b>=c&&b<=e}function P(a){switch(a){case "esriFieldTypeSmallInteger":case "small-integer":return t;case "esriFieldTypeInteger":case "integer":return u;case "esriFieldTypeSingle":case "single":return v;case "esriFieldTypeDouble":case "double":return Z}}function aa(a,b,c){if(!b||!b.attributes||!a){if(h.isSome(c))for(var e of a??[])c.add(e);return!0}b=b.attributes;e=!1;for(const f of a)if(!(f in b))if(e=
!0,h.isSome(c))c.add(f);else break;return e}function Q(){Q=g._asyncToGenerator(function*(a,b){const c=new Set;for(const e of b)yield k(c,a.fieldsIndex,e);return Array.from(c).sort()});return Q.apply(this,arguments)}const pa=/^([0-9])/,qa=/[^A-Za-z0-9_\u0080-\uffff]/g,ra=/_{2,}/g,sa=/^_/,ta=/_$/,ba="field field2 field3 normalizationField rotationInfo.field proportionalSymbolInfo.field proportionalSymbolInfo.normalizationField colorInfo.field colorInfo.normalizationField".split(" "),ca=["field","normalizationField"],
x=new Set,r=(()=>"isInteger"in Number?Number.isInteger:a=>"number"===typeof a&&isFinite(a)&&Math.floor(a)===a)(),da=["integer","small-integer","single","double"],oa=new Set([...da,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);d.NumericRangeValidationError=void 0;(d.NumericRangeValidationError||(d.NumericRangeValidationError={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range";d.TypeValidationError=void 0;(d.TypeValidationError||(d.TypeValidationError=
{})).INVALID_TYPE="type-validation-error::invalid-type";const t={min:-32768,max:32767,isInteger:!0},u={min:-2147483648,max:2147483647,isInteger:!0},v={min:-3.4E38,max:1.2E38,isInteger:!1},Z={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};d.collectArcadeFieldNames=k;d.collectElevationFields=T;d.collectFeatureReductionFields=function(a,b,c){return D.apply(this,arguments)};d.collectField=p;d.collectFields=n;d.collectFilterFields=function(a,b,c){return F.apply(this,arguments)};d.collectLabelingFields=
V;d.collectOrderByInfos=function(a,b,c){return G.apply(this,arguments)};d.collectPopupTemplateFields=U;d.doubleRange=Z;d.featureHasFields=function(a,b){return!aa(a,b,null)};d.fixFields=m;d.fixRendererFields=function(a,b){if(null!=a&&null!=b)for(const c of Array.isArray(a)?a:[a])if(R(ba,c,b),"visualVariables"in c&&c.visualVariables)for(const e of c.visualVariables)R(ca,e,b)};d.fixTimeInfoFields=function(a,b){if(null!=a&&b?.fields?.length)if("startField"in a){var c=b.get(a.startField);b=b.get(a.endField);
a.startField=c?.name??null;a.endField=b?.name??null}else c=b.get(a.startTimeField),b=b.get(a.endTimeField),a.startTimeField=c?.name??null,a.endTimeField=b?.name??null};d.getDisplayFieldName=function({displayField:a,fields:b}){if(a)return a;if(!b||!b.length)return null;if(!(a=A(b,"name-or-title")||A(b,"unique-identifier")||A(b,"type-or-category")))a:{for(const c of b)if(c&&c.name&&(b=c.name.toLowerCase(),b.includes("name")||b.includes("title"))){a=c.name;break a}a=null}return a};d.getElevationFields=
function(a){return B.apply(this,arguments)};d.getExpressionFields=function(a,b){return Q.apply(this,arguments)};d.getFeatureEditFields=function(a){if(!a)return[];const b="editFieldsInfo"in a&&a.editFieldsInfo;return b?m(a.fieldsIndex,[b&&b.creatorField,b&&b.creationDateField,b&&b.editorField,b&&b.editDateField]):[]};d.getFeatureGeometryFields=function(a){if(!a)return[];const b=a.geometryFieldsInfo;return b?m(a.fieldsIndex,[b.shapeAreaField,b.shapeLengthField]):[]};d.getFieldDefaultValue=function(a){const b=
a.defaultValue;if(void 0!==b&&N(a,b))return b;if(a.nullable)return null};d.getFieldRange=function(a){const b=q.getDomainRange(a.domain);if(b)return b;if(O(a))return P(a.type)};d.getLabelingFields=function(a){return J.apply(this,arguments)};d.getNumericTypeForValue=function(a){if(!M(a))return null;if(r(a)){if(a>=t.min&&a<=t.max)return"esriFieldTypeSmallInteger";if(a>=u.min&&a<=u.max)return"esriFieldTypeInteger"}return a>=v.min&&a<=v.max?"esriFieldTypeSingle":"esriFieldTypeDouble"};d.getTimeFields=
function(a){return I.apply(this,arguments)};d.integerRange=u;d.isDateField=function(a){return null!=a&&("date"===a.type||"esriFieldTypeDate"===a.type)};d.isNumberInRange=Y;d.isNumericField=O;d.isRasterPixelValueField=function(a){return["raster.itempixelvalue","raster.servicepixelvalue"].some(b=>a.toLowerCase().startsWith(b))};d.isStringField=function(a){return null!=a&&("string"===a.type||"esriFieldTypeString"===a.type)};d.isValidFieldValue=function(a,b){return null===X(a,b)};d.isValueMatchingFieldType=
N;d.normalizeFieldName=function(a){return a?a.trim().replace(qa,"_").replace(ra,"_").replace(sa,"").replace(ta,"").replace(pa,"F$1"):null};d.numericTypes=da;d.packFields=function(a,b,c=1){if(!b||!a)return[];if(b.includes("*"))return["*"];b=m(a,b);return b.length/a.fields.length>=c?["*"]:b};d.populateMissingFields=aa;d.rendererFields=ba;d.sanitizeNullFieldValue=function(a){return null==a||"number"===typeof a&&isNaN(a)?null:a};d.singleRange=v;d.smallIntegerRange=t;d.unpackFieldNames=function(a,b){return h.isNone(b)||
h.isNone(a)?[]:b.includes("*")?(a.fields??[]).map(c=>c.name):b};d.validateFieldValue=X;d.validationErrorToString=function(a,b,c){switch(a){case q.DomainValidationError.INVALID_CODED_VALUE:return`Value ${c} is not in the coded domain - field: ${b.name}, domain: ${JSON.stringify(b.domain)}`;case q.DomainValidationError.VALUE_OUT_OF_RANGE:return`Value ${c} is out of the range of valid values - field: ${b.name}, domain: ${JSON.stringify(b.domain)}`;case d.TypeValidationError.INVALID_TYPE:return`Value ${c} is not a valid value for the field type - field: ${b.name}, type: ${b.type}, nullable: ${b.nullable}`;
case d.NumericRangeValidationError.OUT_OF_RANGE:const {min:e,max:f}=P(b.type);return`Value ${c} is out of range for the number type - field: ${b.name}, type: ${b.type}, value range is ${e} to ${f}`}};d.visualVariableFields=ca;Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});