// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(q,g,f,n,h,u,r,t){f=function(m){function p(){var a=m.apply(this,arguments)||this;a.functionArguments=null;a.readingBufferSize=0;return a}q._inheritsLoose(p,m);var k=p.prototype;k.bind=function(a,
d=!1){const b=this._getRasterValues();for(let e=0;e<b.length;e++){var c=b[e];if(c&&"object"===typeof c&&"bind"in c&&(!c.rasterInfo||d)&&(c=c.bind(a,d),!c.success))return c}return!this.rasterInfo||d?(this.sourceRasterInfos=this._getSourceRasterInfos(a),this._bindSourceRasters()):{success:!0}};k.process=function(a){const d=this._getRasterValues().map(b=>this._readRasterValue(b,a));return this._processPixels({...a,pixelBlocks:d})};k.getPrimaryRasters=function(){const a=[],d=[];this._getPrimaryRasters(this,
a,d);return{rasters:a,rasterIds:d}};k._getOutputPixelType=function(a){return"unknown"===this.outputPixelType?a:this.outputPixelType??a};k._getRasterValues=function(){const {rasterArgumentNames:a}=this;return"rasters"===a[0]&&Array.isArray(this.functionArguments.rasters)?this.functionArguments.rasters:a.map(d=>this.functionArguments[d])};k._getSourceRasterInfos=function(a){const d=this._getRasterValues(),{rasterInfos:b,rasterIds:c}=a;return d.map(e=>e&&"object"===typeof e&&"bind"in e&&e.rasterInfo?
e.rasterInfo:"string"===typeof e&&c.includes(e)?b[c.indexOf(e)]:b[0])};k._getPrimaryRasterId=function(a){return a?.url};k._getPrimaryRasters=function(a,d=[],b=[]){for(let e=0;e<a.sourceRasters.length;e++){var c=a.sourceRasters[e];if("number"!==typeof c)if("bind"in c)this._getPrimaryRasters(c,d,b);else{const l=this._getPrimaryRasterId(c);null==l||b.includes(l)||(this.mainPrimaryRasterId===l?(d.unshift(c),b.unshift(l)):(d.push(c),b.push(l)))}}};k._readRasterValue=function(a,d){var {primaryPixelBlocks:b}=
d;if(n.isNone(a)||"$$"===a)return a=b[0],n.isNone(a)?null:a.clone();if("string"===typeof a)return a=d.primaryRasterIds.indexOf(a),-1===a?null:b[a];if("number"===typeof a){b=b[0];if(n.isNone(b))return null;const c=new Float32Array(b.width*b.height);c.fill(a);a=b.clone();a.pixels=a.pixels.map(()=>c);return a}return a.process(d)};return p}(f.JSONSupport);g.__decorate([h.property({json:{write:!0}})],f.prototype,"functionName",void 0);g.__decorate([h.property({json:{write:!0}})],f.prototype,"functionArguments",
void 0);g.__decorate([h.property()],f.prototype,"rasterArgumentNames",void 0);g.__decorate([h.property({json:{write:!0}}),r.cast(m=>m?.toLowerCase())],f.prototype,"outputPixelType",void 0);g.__decorate([h.property({json:{write:!0}})],f.prototype,"mainPrimaryRasterId",void 0);g.__decorate([h.property()],f.prototype,"sourceRasters",void 0);g.__decorate([h.property({json:{write:!0}})],f.prototype,"sourceRasterInfos",void 0);g.__decorate([h.property({json:{write:!0}})],f.prototype,"rasterInfo",void 0);
g.__decorate([h.property({json:{write:!0}})],f.prototype,"readingBufferSize",void 0);return f=g.__decorate([t.subclass("esri.layers.support.rasterFunctions.BaseRasterFunction")],f)});