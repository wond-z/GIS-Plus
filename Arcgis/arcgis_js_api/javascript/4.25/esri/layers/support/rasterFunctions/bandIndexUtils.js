// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../core/jsonMap ../../../core/maybe ../PixelBlock ./customBandIndexUtils ./pixelUtils".split(" "),function(p,q,r,t,y,z){function u(e,a,f){const h=f.length,c=new Float32Array(h);for(let b=0;b<h;b++)if(null==e||e[b]){const d=a[b],g=f[b],k=d+g;k&&(c[b]=(d-g)/k)}return[c]}function A(e,a,f){const h=f.length,c=new Float32Array(h);for(let b=0;b<h;b++)if(null==e||e[b]){const d=a[b],g=f[b];g&&(c[b]=d/g)}return[c]}function B(e,a,f){const h=a.length,c=new Float32Array(h);for(let b=0;b<
h;b++)if(null==e||e[b]){const d=a[b],g=f[b];g&&(c[b]=d/g-1)}return[c]}function C(e,a,f,h){const c=f.length,b=new Float32Array(c);for(let d=0;d<c;d++)if(null==e||e[d]){const g=f[d],k=a[d],l=k+g+h;l&&(b[d]=(k-g)/l*(1+h))}return[b]}function D(e,a,f,h,c,b){const d=f.length,g=new Float32Array(d);b=-c*h+b*(1+h*h);for(let k=0;k<d;k++)if(null==e||e[k]){const l=f[k],m=a[k],n=c*m+l+b;n&&(g[k]=h*(m-h*l-c)/n)}return[g]}function E(e,a,f){const h=f.length,c=new Float32Array(h);for(let b=0;b<h;b++)if(null==e||e[b]){const d=
a[b];c[b]=.5*(2*(d+1)-Math.sqrt((2*d+1)**2-8*(d-f[b])))}return[c]}function F(e,a,f){const h=f.length,c=new Float32Array(h);for(let d=0;d<h;d++)if(null==e||e[d]){const g=f[d];var b=a[d];1!==g&&(b=(2*(b*b-g*g)+1.5*b+.5*g)/(b+g+.5),c[d]=b*(1-.25*b)-(g-.125)/(1-g))}return[c]}function G(e,a,f,h,c){const b=f.length,d=new Float32Array(b),g=Math.sqrt(1+h*h);for(let k=0;k<b;k++)if(null==e||e[k])d[k]=(a[k]-h*f[k]-c)/g;return[d]}function H(e,a){const [f,h,c,b,d,g]=a;a=f.length;const k=new Float32Array(a);for(let l=
0;l<a;l++)if(null==e||e[l])k[l]=-.2848*f[l]-.2435*h[l]-.5436*c[l]+.7243*b[l]+.084*d[l]-1.18*g[l];return[k]}function I(e,a){const [f,,h,c,b,d]=a;a=f.length;const g=new Float32Array(a),k=new Float32Array(a),l=new Float32Array(a);for(let m=0;m<a;m++)if(null==e||e[m])g[m]=d[m]?b[m]/d[m]*100:0,k[m]=f[m]?b[m]/f[m]*100:0,l[m]=c[m]?h[m]/c[m]*(b[m]/c[m])*100:0;return[g,k,l]}function J(e,a){const [f,h,c]=a;a=f.length;const b=new Float32Array(a);for(let d=0;d<a;d++)if(null==e||e[d])for(d=0;d<a;d++){const g=
f[d],k=h[d],l=k+g-c[d];l&&(b[d]=(k-g)/l)}return[b]}function K(e,a){const [f,h,c]=a;a=f.length;const b=new Float32Array(a);for(let d=0;d<a;d++)if(null==e||e[d])for(d=0;d<a;d++){const g=f[d],k=h[d],l=c[d];b[d]=1.5*(1.2*(g-l)-2.5*(k-l))*Math.sqrt((2*g+1)**2-6*g-5*Math.sqrt(k)-.5)}return[b]}function L(e,a){const [f,h,c]=a;a=f.length;const b=new Float32Array(a);for(let d=0;d<a;d++)if(null==e||e[d])for(d=0;d<a;d++){const g=f[d];b[d]=100*(g-h[d])-10*(g-c[d])}return[b]}function M(e,a){const [f,h,c]=a;a=f.length;
const b=new Float32Array(a);for(let d=0;d<a;d++)if(null==e||e[d])for(d=0;d<a;d++){const g=f[d],k=h[d],l=g+6*k-7.5*c[d]+1;l&&(b[d]=2.5*(g-k)/l)}return[b]}function N(e,a,f=.5){const [h,c,b]=a;a=c.length;const d=new Float32Array(a);for(let g=0;g<a;g++)if(null==e||e[g])for(g=0;g<a;g++){const k=h[g],l=c[g],m=b[g],n=k+f*l+(1-f)*m;n&&(d[g]=(k-f*l-(1-f)*m)/n)}return[d]}function O(e,a,f){const h=f.length,c=new Float32Array(h);for(let b=0;b<h;b++)if(null==e||e[b])for(b=0;b<h;b++){const d=(.1-a[b])**2+(.06-
f[b])**2;d&&(c[b]=1/d)}return[c]}q=new q.JSONMap({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});p.bandIndexMethodMap=q;p.calculateBandIndex=function(e,a){if(!z.isValidPixelBlock(e))return e;const {equation:f,
method:h}=a;a=a.bandIndexes.map(g=>g-1);const {pixels:c,mask:b}=e;switch(h){case "gndvi":case "nbr":case "ndbi":case "ndvi":case "ndvi-re":case "ndsi":case "ndmi":case "mndwi":a=u(b,c[a[0]],c[a[1]]);break;case "ndwi":a=u(b,c[a[1]],c[a[0]]);break;case "sr":case "sr-re":case "iron-oxide":case "ferrous-minerals":case "clay-minerals":a=A(b,c[a[0]],c[a[1]]);break;case "ci-g":case "ci-re":a=B(b,c[a[0]],c[a[1]]);break;case "savi":a=C(b,c[a[0]],c[a[1]],a[2]+1);break;case "tsavi":a=D(b,c[a[0]],c[a[1]],a[2]+
1,a[3]+1,a[4]+1);break;case "msavi":a=E(b,c[a[0]],c[a[1]]);break;case "gemi":a=F(b,c[a[0]],c[a[1]]);break;case "pvi":a=G(b,c[a[0]],c[a[1]],a[2]+1,a[3]+1);break;case "gvitm":a=H(b,[c[a[0]],c[a[1]],c[a[2]],c[a[3]],c[a[4]],c[a[5]]]);break;case "sultan":a=I(b,[c[a[0]],c[a[1]],c[a[2]],c[a[3]],c[a[4]],c[a[5]]]);break;case "vari":a=J(b,[c[a[0]],c[a[1]],c[a[2]]]);break;case "mtvi2":a=K(b,[c[a[0]],c[a[1]],c[a[2]]]);break;case "rtvi-core":a=L(b,[c[a[0]],c[a[1]],c[a[2]]]);break;case "evi":a=M(b,[c[a[0]],c[a[1]],
c[a[2]]]);break;case "wndwi":a=N(b,[c[a[0]],c[a[1]],c[a[2]]],a[3]??.5);break;case "bai":a=O(b,c[a[0]],c[a[1]]);break;case "custom":a=y.calculateCustomBandIndex(b,c,f);break;default:return e}const d=r.isSome(b)?new Uint8Array(b.length):null;r.isSome(b)&&r.isSome(d)&&d.set(b);e=new t({width:e.width,height:e.height,pixelType:"f32",pixels:a,mask:d});e.updateStatistics();return e};p.calculateNDVI=function(e,a,f,h){const {mask:c,pixels:b,width:d,height:g}=e;e=b[f];a=b[a];f=a.length;const k=h?new Uint8Array(f):
new Float32Array(f),l=h?100:1,m=h?100:0;for(let n=0;n<f;n++)if(null==c||c[n]){const v=e[n],w=a[n],x=v+w;x&&(k[n]=(v-w)/x*l+m)}h=new t({width:d,height:g,mask:c,pixelType:h?"u8":"f32",pixels:[k]});h.updateStatistics();return h};Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});