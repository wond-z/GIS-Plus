// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(l,n,p,u,z,r,A,q,B,C){function v(d,f){const c=w(d,f.spatialReference);if(!c)return null;switch(d.type){case "point":d.z=f.elevationAt(c.x,c.y);break;case "polyline":h.spatialReference=c.spatialReference;var a=d.hasM&&!d.hasZ;for(var e=0;e<d.paths.length;e++){var b=
d.paths[e],g=c.paths[e];for(let k=0;k<b.length;k++){const m=b[k],x=g[k];h.x=x[0];h.y=x[1];a&&(m[3]=m[2]);m[2]=f.elevationAt(h.x,h.y)}}d.hasZ=!0;break;case "multipoint":h.spatialReference=c.spatialReference;a=d.hasM&&!d.hasZ;for(e=0;e<d.points.length;e++)b=d.points[e],g=c.points[e],h.x=g[0],h.y=g[1],a&&(b[3]=b[2]),b[2]=f.elevationAt(h.x,h.y);d.hasZ=!0}return d}function w(d,f){if(r.isNone(d))return null;const c=d.spatialReference;if(c.equals(f))return d;(d=B.project(d,f))||t.error(`Cannot project geometry spatial reference (wkid:${c.wkid}) to elevation sampler spatial reference (wkid:${f.wkid})`);
return d}const t=z.getLogger("esri.layers.support.ElevationSampler");p=function(){function d(){}var f=d.prototype;f.queryElevation=function(c){return v(c.clone(),this)};f.on=function(){return D};f.projectIfRequired=function(c,a){return w(c,a)};return d}();let y=function(d){function f(a,e,b){var g=d.call(this)||this;g.tile=a;g.noDataValue=b;b=a.tile.extent;g.extent=q.toExtent(b,e.spatialReference);g.extent.zmin=a.zmin;g.extent.zmax=a.zmax;g._aaExtent=b;b=A.getMetersPerUnitForSR(e.spatialReference);
a=e.lodAt(a.tile.level).resolution*b;g.demResolution={min:a,max:a};return g}n._inheritsLoose(f,d);var c=f.prototype;c.contains=function(a){a=this.projectIfRequired(a,this.spatialReference);return r.isNone(a)?!1:this.containsAt(a.x,a.y)};c.containsAt=function(a,e){return q.containsXY(this._aaExtent,a,e)};c.elevationAt=function(a,e){if(!this.containsAt(a,e)){const b=this.extent;t.warn("#elevationAt()",`Point used to sample elevation (${a}, ${e}) is outside of the sampler extent (${`${b.xmin}, ${b.ymin}, ${b.xmax}, ${b.ymax}`})`);
return this.noDataValue}return r.unwrapOr(this.tile.sample(a,e),this.noDataValue)};n._createClass(f,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return f}(p);u=function(d){function f(c,a,e){var b=d.call(this)||this;let g;"number"===typeof a?(b.noDataValue=a,g=null):(g=a,b.noDataValue=e);b.samplers=g?c.map(k=>new y(k,g,b.noDataValue)):c;if(c=b.samplers[0]){b.extent=c.extent.clone();const {min:k,max:m}=c.demResolution;b.demResolution={min:k,max:m};for(c=1;c<b.samplers.length;c++)a=
b.samplers[c],b.extent.union(a.extent),b.demResolution.min=Math.min(b.demResolution.min,a.demResolution.min),b.demResolution.max=Math.max(b.demResolution.max,a.demResolution.max)}else b.extent=q.toExtent(q.create(),g.spatialReference),b.demResolution={min:0,max:0};return b}n._inheritsLoose(f,d);f.prototype.elevationAt=function(c,a){for(const e of this.samplers)if(e.containsAt(c,a))return e.elevationAt(c,a);t.warn("#elevationAt()",`Point used to sample elevation (${c}, ${a}) is outside of the sampler`);
return this.noDataValue};n._createClass(f,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return f}(p);const h=new C,D={remove(){}};l.ElevationSamplerBase=p;l.MultiTileElevationSampler=u;l.TileElevationSampler=y;l.updateGeometryElevation=v;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});