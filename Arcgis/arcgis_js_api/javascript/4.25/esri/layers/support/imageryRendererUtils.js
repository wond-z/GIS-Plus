// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../core/lang ../../core/maybe ./RasterFunction ./rasterFunctionUtils ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils ../../renderers/visualVariables/SizeVariable".split(" "),function(v,B,C,k,I,w,J,K){function D(a,b){for(const c in a)"raster"===c.toLowerCase()&&("RasterFunctionVariable"===a[c].type?(a[c]=b.rasterFunctionDefinition,a[c].type="RasterFunctionTemplate"):"RasterFunctionTemplate"===a[c].type&&D(a[c].arguments,b))}function r(a){const b=
B.clone(I.schema[a.functionName+"Function"]);a=a.functionArguments;for(const c in a)"raster"===c.toLowerCase()?(b.arguments[c]=r(a[c]),b.arguments[c].type="RasterFunctionTemplate"):"colormap"===c.toLowerCase()?(b.arguments[c].value=L(a[c]),b.arguments.ColorSchemeType.value=0):b.arguments[c].value=a[c];return b}function E(a){const b=a?.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?E(b.functionArguments):a}function M(a,b){const c=new k;c.functionName="VectorFieldRenderer";
const {dataType:f,bandProperties:e}=b,d="vector-uv"===f?!0:!1;let m,n;e&&2===e.length&&(m=e.map(h=>h.BandName.toLowerCase()).indexOf("magnitude"),n=e.map(h=>h.BandName.toLowerCase()).indexOf("direction"));if(-1===m||null===m)m=0,n=1;const p="arithmetic"===a.rotationType?1:2,t="flow-from"===a.flowRepresentation?0:1,q=a.visualVariables?a.visualVariables.find(h=>"Magnitude"===h.field):new K;a={magnitudeBandID:m,directionBandID:n,isUVComponents:d,referenceSystem:p,massFlowAngleRepresentation:t,symbolTileSize:50,
symbolTileSizeUnits:100,calculationMethod:"Vector Average",symbologyName:N[a.style.toLowerCase().replace("-","_")],minimumMagnitude:q.minDataValue,maximumMagnitude:q.maxDataValue,minimumSymbolSize:q.minSize,maximumSymbolSize:q.maxSize};c.functionArguments=a;return b.convertToRFT?new k({rasterFunctionDefinition:r(c)}):c}function O(a,b){const c=b.convertToRFT,f=new k;f.functionName="Stretch";var e=x[J.stretchTypeJSONDict.toJSON(a.stretchType)],d=P(a.statistics);d={StretchType:e,Statistics:d,DRA:a.dynamicRangeAdjustment,
UseGamma:a.useGamma,Gamma:a.gamma,ComputeGamma:a.computeGamma};null!=a.outputMin&&(d.Min=a.outputMin);null!=a.outputMax&&(d.Max=a.outputMax);e===x.standardDeviation?(d.NumberOfStandardDeviations=a.numberOfStandardDeviations,f.outputPixelType="u8"):e===x.percentClip?(d.MinPercent=a.minPercent,d.MaxPercent=a.maxPercent,f.outputPixelType="u8"):e===x.minMax?f.outputPixelType="u8":e===x.sigmoid&&(d.SigmoidStrengthLevel=a.sigmoidStrengthLevel);f.functionArguments=d;f.variableName="Raster";if(a.colorRamp){d=
a.colorRamp;e=new k;if(c)e.functionArguments={ColorRamp:w.getRFxArgColorRampValue(d)};else{const m=w.getColorRampName(d);m?e.functionArguments={colorRamp:m}:!b.convertColorRampToColormap||"algorithmic"!==d.type&&"multipart"!==d.type?(a=a.colorRamp.toJSON(),"algorithmic"===a.type?a.algorithm=a.algorithm||"esriCIELabAlgorithm":"multipart"===a.type&&a.colorRamps?.length&&a.colorRamps.forEach(n=>n.algorithm=n.algorithm||"esriCIELabAlgorithm"),e.functionArguments={colorRamp:a}):e.functionArguments={Colormap:w.convertColorRampToColormap(d,
256)}}e.variableName="Raster";e.functionName="Colormap";e.functionArguments.Raster=f;return c?new k({rasterFunctionDefinition:r(e)}):e}return c?new k({rasterFunctionDefinition:r(f)}):f}function Q(a,b){const c=[],f=[],e=[],d=[],{pixelType:m,rasterAttributeTable:n}=b,p=C.isNone(n)?null:n.features,t=F(n);if(p&&Array.isArray(p)&&a.classBreakInfos){a.classBreakInfos.forEach((g,y)=>{const u=g.symbol.color;let z;u.a&&p.forEach(G=>{z=G.attributes[a.field];(z>=g.minValue&&z<g.maxValue||y===a.classBreakInfos.length-
1&&z>=g.minValue)&&d.push([G.attributes[t],u.r,u.g,u.b])})});var q=m?A(d,m):d,h=new k;h.functionName="Colormap";h.functionArguments={};h.functionArguments.Colormap=q;h.variableName="Raster";return b.convertToRFT?new k({rasterFunctionDefinition:r(h)}):h}a.classBreakInfos.forEach((g,y)=>{const u=g.symbol&&g.symbol.color;u.a?(0===y?c.push(g.minValue,g.maxValue+1E-6):c.push(g.minValue+1E-6,g.maxValue+1E-6),f.push(y),d.push([y,u.r,u.g,u.b])):e.push(g.minValue,g.maxValue)});q=m?A(d,m):d;h=new k;h.functionName=
"Remap";h.functionArguments={InputRanges:c,OutputValues:f,NoDataRanges:e};h.variableName="Raster";const l=new k;l.functionName="Colormap";l.functionArguments={Colormap:q,Raster:h};return b.convertToRFT?new k({rasterFunctionDefinition:r(l)}):l}function A(a,b){(b=H[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function F(a){if(!C.isNone(a))return{fields:a}=a,(a=a&&a.find(b=>b&&b.name&&"value"===b.name.toLowerCase()))&&a.name}function R(a,b){const c=
[],{pixelType:f,rasterAttributeTable:e}=b;var d=C.isNone(e)?null:e.features;const m=F(e),n=a.defaultSymbol?.color?.toRgb();var p=a.uniqueValueInfos;if(p)if(d){const q=new Map;p.forEach(l=>{const g=l.value;l=l.symbol.color;null!=g&&l&&l.a&&q.set(String(g),l.toRgb())});const h=a.field;d.forEach(({attributes:l})=>{var g=String(l[h]);l=l[m];q.has(g)?(g=q.get(g),c.push([l,...g])):n&&c.push([l,...n])})}else for(a=0;a<p.length;a++){var t=p[a];d=t.symbol.color;t=+t.value;if(d?.a){if(isNaN(t))return null;
c.push([t,d.r,d.g,d.b])}}p=f&&0<c.length?A(c,f):c;a=new k;a.functionName="Colormap";a.functionArguments={};a.functionArguments.Colormap=p;a.variableName="Raster";return b.convertToRFT?new k({rasterFunctionDefinition:r(a)}):a}function P(a){const b=[];a.forEach(c=>{Array.isArray(c)?b.push(c):null!=c.min&&null!=c.max&&b.push([c.min,c.max,c.avg||0,c.stddev||0])});return b}function L(a){const b=[],c=[];a.forEach(f=>{b.push(f[0]);c.push(w.rgbaConvertTo32Bit([...f.slice(1),255]))});return{type:"RasterColormap",
values:b,colors:c}}const H={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},N={simple_scalar:"Simple Scalar",wind_barb:"Wind Barb",single_arrow:"Single Arrow",beaufort_kn:"Beaufort Wind (Knots)",beaufort_m:"Beaufort Wind (MetersPerSecond)",ocean_current_m:"Ocean Current (MetersPerSecond)",ocean_current_kn:"Ocean Current (Knots)"},S=new Set("raster-stretch unique-value class-breaks raster-shaded-relief vector-field raster-colormap".split(" ")),x={none:0,standardDeviation:3,
histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};v.combineRenderingRules=function(a,b){if(!a||!b)return B.clone(a||b);a=B.clone(a);if(b.rasterFunctionDefinition){const c=b.rasterFunctionDefinition;if(c.thumbnail||c.thumbnailEx)c.thumbnail=c.thumbnailEx=null;D(a.rasterFunctionDefinition.arguments,b)}else"none"!==b.functionName.toLowerCase()&&(E(a.functionArguments).Raster=b);return a};v.convertRendererToRenderingRule=function(a,b){b=b||{};switch(a.type){case "raster-stretch":return O(a,b);
case "class-breaks":return Q(a,b);case "unique-value":return R(a,b);case "raster-colormap":var c=b;(b=a.extractColormap())&&0!==b.length?({pixelType:a}=c,a=a?A(b,a):b,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=a,a=c.convertToRFT?new k({rasterFunctionDefinition:r(b)}):b):a=void 0;return a;case "vector-field":return M(a,b);case "raster-shaded-relief":c=b.convertToRFT;if("elevation"!==b.dataType&&("generic"!==b.dataType||1!==b.bandCount||"s16"!==b.pixelType&&
"s32"!==b.pixelType&&"f32"!==b.pixelType&&"f64"!==b.pixelType))a=new k;else{b=new k;b.functionName="Hillshade";var f="traditional"===a.hillshadeType?0:1,e="none"===a.scalingType?1:3,d={HillshadeType:f,SlopeType:e,ZFactor:a.zFactor};0===f&&(d.Azimuth=a.azimuth,d.Altitude=a.altitude);3===e&&(d.PSPower=a.pixelSizePower,d.PSZFactor=a.pixelSizeFactor);b.functionArguments=d;b.variableName="Raster";a.colorRamp&&(b.functionName="ShadedRelief",c?d.ColorRamp=w.getRFxArgColorRampValue(a.colorRamp):d.Colormap=
w.convertColorRampToColormap(a.colorRamp,256));a=c?new k({rasterFunctionDefinition:r(b)}):b}return a;case "flow":throw Error("Unsupported rendering rule.");}};v.convertRenderingRuleToRFT=r;v.isSupportedRendererType=function(a){return S.has(a.type)};v.pixelTypeRanges=H;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});