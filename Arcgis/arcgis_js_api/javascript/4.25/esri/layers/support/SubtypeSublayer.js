// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/has ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/object ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/extensions/serializableProperty/reader ../../form/FormTemplate ./commonProperties ./FeatureTemplate ./fieldProperties ./fieldUtils ./LabelClass ./labelingInfo ../../support/popupUtils ../../symbols/support/defaults".split(" "),
function(G,c,L,A,fa,ha,ia,ja,M,D,N,ka,la,b,O,v,P,H,Q,R,d,ma,B,S,T,U,V,W,x,I,C,X,Y,Z,aa,E){function y(f){const m=f.json.write;"object"===typeof m?m.ignoreOrigin=!0:f.json.write={ignoreOrigin:!0};return f}function ba(f){switch(f){case "point":case "multipoint":return E.defaultPointSymbol2D.clone();case "polyline":return E.defaultPolylineSymbol2D.clone();case "polygon":case "multipatch":return E.defaultPolygonSymbol2D.clone();default:return null}}function ca(f,m){return m?"unique-value"===f?.type&&"string"===
typeof f.field&&f.field.toLowerCase()===m.toLowerCase()&&!f.field2&&!f.field3&&!f.valueExpression:!1}function J(f,m){return null==f?null:m.subtypes?.find(n=>n.code===f)}const da="charts editingEnabled formTemplate labelsVisible labelingInfo legendEnabled minScale maxScale opacity popupEnabled popupTemplate renderer subtypeCode templates title visible".split(" ");A={key:"type",base:M,errorContext:"renderer",typeMap:{simple:D,"unique-value":N,"class-breaks":A}};C=C.defineFieldProperties();const K=V.createTypeReader({types:A});
let ea=0;b=function(f){function m(a){a=f.call(this,a)||this;a.charts=null;a.editingEnabled=!0;a.fieldOverrides=null;a.fieldsIndex=null;a.formTemplate=null;a.id=`${Date.now().toString(16)}-subtype-sublayer-${ea++}`;a.type="subtype-sublayer";a.labelsVisible=!0;a.labelingInfo=null;a.layerType="ArcGISFeatureLayer";a.legendEnabled=!0;a.listMode="show";a.minScale=0;a.maxScale=0;a.opacity=1;a.popupEnabled=!0;a.popupTemplate=null;a.subtypeCode=null;a.templates=null;a.title=null;a.visible=!0;return a}G._inheritsLoose(m,
f);var n=m.prototype;n.writeFieldOverrides=function(a,e,h){const {fields:g,parent:k}=this;let l;if(g){l=[];let q=0;g.forEach(({name:w,alias:z,editable:p,visible:t})=>{if(t&&(t=k?.fields?.find(F=>F.name===w))){var r={name:w},u=!1;z!==t.alias&&(r.alias=z,u=!0);p!==t.editable&&(r.editable=p,u=!0);l.push(r);u&&q++}});0===q&&l.length===g.length&&(l=null)}else l=v.clone(a);l?.length&&R.setDeepValue(h,l,e)};n.readRendererFromService=function(a,e,h){if("Table"===e.type)return null;h=K(e.drawingInfo?.renderer,
e,h);a=void 0;const {subtypeCode:g}=this;null!=g&&ca(h,e.subtypeField)?(e=h.uniqueValueInfos?.find(({value:k})=>{k="number"===typeof k?String(k):k;return k===String(g)}))&&(a=new D({symbol:e.symbol})):"simple"!==h?.type||h.visualVariables?.length||(a=h);return a};n.readRenderer=function(a,e,h){if((a=e?.layerDefinition?.drawingInfo?.renderer)&&!a.visualVariables?.length)return K(a,e,h)||void 0};n.readTemplatesFromService=function(a,e){a=this.subtypeCode;let h=null;switch(e.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":h=
"point";break;case "esriGeometryPolyline":h="line";break;case "esriGeometryPolygon":case "esriGeometryMultiPatch":h="polygon";break;default:h=null}const g={};var k=J(a,e);if(H.isSome(k)){({defaultValues:k}=k);for(const l in k)g[l]=k[l]}g[e.subtypeField]=a;return[new I({name:"New Feature",drawingTool:h,prototype:{attributes:g}})]};n.readTitleFromService=function(a,e){a=J(this.subtypeCode,e);return H.isSome(a)?a.name:null};n.createPopupTemplate=function(a){let e=this;const {parent:h,fields:g,title:k}=
this;if(h){const {displayField:l,editFieldsInfo:q,objectIdField:w}=h;e={displayField:l,editFieldsInfo:q,fields:g,objectIdField:w,title:k}}return aa.createPopupTemplate(e,a)};n.getField=function(a){return this.fieldsIndex.get(a)};n.getFieldDomain=function(a){return this._getLayerDomain(a)};n.hasUserOverrides=function(){return da.some(a=>this.originIdOf(a)===U.OriginId.USER)};n._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};G._createClass(m,[{key:"fields",get:function(){const {parent:a,
fieldOverrides:e,subtypeCode:h}=this;var g=a?.fields;if(!g?.length)return null;const {subtypes:k,subtypeField:l}=a;var q=k.find(t=>t.code===h);const w=q?.defaultValues;q=q?.domains;const z=[];for(const t of g){g=t.clone();const {name:r}=g;var p=e?.find(u=>u.name===r);g.visible=!e||!!p;if(p){const {alias:u,editable:F}=p;u&&(g.alias=u);!1===F&&(g.editable=!1)}p=w?.[r]??null;g.defaultValue=r===l?h:p;p=q?.[r]??null;g.domain=r===l?null:p?"inherited"===p.type?g.domain:p.clone():null;z.push(g)}return z}},
{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:e}=this;return{minScale:a,maxScale:e}}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",get:function(){if(this._isOverridden("renderer"))return this._get("renderer");const {parent:a}=this;return a&&!a.isTable&&"mesh"!==a.geometryType?new D({symbol:ba(a.geometryType)}):null},set:function(a){X.fixRendererFields(a,this.fieldsIndex);this._override("renderer",a)}}]);return m}(b.HandleOwnerMixin(Q.MultiOriginJSONMixin(O.IdentifiableMixin(P))));
c.__decorate([d.property({json:{write:{ignoreOrigin:!0}}})],b.prototype,"charts",void 0);c.__decorate([d.property({type:Boolean,nonNullable:!0,json:{name:"enableEditing",write:{ignoreOrigin:!0}}})],b.prototype,"editingEnabled",void 0);c.__decorate([d.property({readOnly:!0,json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],b.prototype,"fieldOverrides",void 0);c.__decorate([T.writer("fieldOverrides")],b.prototype,"writeFieldOverrides",null);
c.__decorate([d.property({...C.fields,readOnly:!0,json:{read:!1}})],b.prototype,"fields",null);c.__decorate([d.property(C.fieldsIndex)],b.prototype,"fieldsIndex",void 0);c.__decorate([d.property({type:W,json:{name:"formInfo",write:{ignoreOrigin:!0}}})],b.prototype,"formTemplate",void 0);c.__decorate([d.property({type:String,readOnly:!0,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],b.prototype,"id",void 0);c.__decorate([d.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);
c.__decorate([d.property(y(v.clone(x.labelsVisible)))],b.prototype,"labelsVisible",void 0);c.__decorate([d.property({type:[Y],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:Z.reader},write:{ignoreOrigin:!0}}})],b.prototype,"labelingInfo",void 0);c.__decorate([d.property({type:["ArcGISFeatureLayer"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],b.prototype,"layerType",void 0);c.__decorate([d.property(y(v.clone(x.legendEnabled)))],b.prototype,
"legendEnabled",void 0);c.__decorate([d.property({type:["show","hide"]})],b.prototype,"listMode",void 0);c.__decorate([d.property((()=>{const f=v.clone(x.minScale);f.json.origins.service.read=!1;return y(f)})())],b.prototype,"minScale",void 0);c.__decorate([d.property((()=>{const f=v.clone(x.maxScale);f.json.origins.service.read=!1;return y(f)})())],b.prototype,"maxScale",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"effectiveScaleRange",null);c.__decorate([d.property({type:Number,
range:{min:0,max:1},nonNullable:!0,json:{write:{ignoreOrigin:!0}}})],b.prototype,"opacity",void 0);c.__decorate([d.property()],b.prototype,"parent",void 0);c.__decorate([d.property(y(v.clone(x.popupEnabled)))],b.prototype,"popupEnabled",void 0);c.__decorate([d.property({type:L,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],b.prototype,"popupTemplate",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);c.__decorate([d.property({types:A,json:{write:{target:"layerDefinition.drawingInfo.renderer",
ignoreOrigin:!0}}})],b.prototype,"renderer",null);c.__decorate([B.reader("service","renderer",["drawingInfo.renderer","subtypeField","type"])],b.prototype,"readRendererFromService",null);c.__decorate([B.reader("renderer",["layerDefinition.drawingInfo.renderer"])],b.prototype,"readRenderer",null);c.__decorate([d.property({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],b.prototype,"subtypeCode",void 0);c.__decorate([d.property({type:[I],json:{name:"layerDefinition.templates",
write:{ignoreOrigin:!0}}})],b.prototype,"templates",void 0);c.__decorate([B.reader("service","templates",["geometryType","subtypeField","subtypes","type"])],b.prototype,"readTemplatesFromService",null);c.__decorate([d.property({type:String,json:{write:{ignoreOrigin:!0}}})],b.prototype,"title",void 0);c.__decorate([B.reader("service","title",["subtypes"])],b.prototype,"readTitleFromService",null);c.__decorate([d.property({type:Boolean,nonNullable:!0,json:{name:"visibility",write:{ignoreOrigin:!0}}})],
b.prototype,"visible",void 0);return b=c.__decorate([S.subclass("esri.layers.support.SubtypeSublayer")],b)});