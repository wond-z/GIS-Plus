// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Logger ../../core/maybe ../../core/perspectiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/mat3 ../../chunks/mat3f64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Point ../../geometry/Polygon ../../geometry/projection ./GeoreferenceBase".split(" "),
function(M,m,B,U,f,p,V,x,ea,fa,R,W,N,k,g,S,X,T,l){function q(c){return f.isSome(c)&&f.isSome(c.sourcePoint)&&f.isSome(c.mapPoint)}function r(c,e,b){k.set(c,b.sourcePoint.x,b.sourcePoint.y);k.set(e,b.mapPoint.x,b.mapPoint.y)}function Y(c,e,b){r(t,u,e);r(v,w,b);k.rotate(C,v,t,L);k.rotate(y,t,v,L);k.rotate(D,w,u,-L);k.rotate(z,u,w,-L);e=u;b=w;var a=D,d=z;return p.getProjectiveTransform(c,F(O,t,v,C,y),F(P,e,b,a,d))}function Z(c,e,b,a){r(t,u,e);r(v,w,b);r(C,D,a);k.lerp(y,t,v,.5);k.rotate(y,C,y,Math.PI);
k.lerp(z,u,w,.5);k.rotate(z,D,z,Math.PI);e=u;b=w;a=D;var d=z;return p.getProjectiveTransform(c,F(O,t,v,C,y),F(P,e,b,a,d))}function aa(c,e,b,a,d){r(t,u,e);r(v,w,b);r(C,D,a);r(y,z,d);e=u;b=w;a=D;d=z;return p.getProjectiveTransform(c,F(O,t,v,C,y),F(P,e,b,a,d))}function F(c,e,b,a,d){c[0]=e[0];c[1]=e[1];c[2]=b[0];c[3]=b[1];c[4]=a[0];c[5]=a[1];c[6]=d[0];c[7]=d[1];return c}const ba=N.create(),n=g.create();B=function(c){function e(){var b=c.apply(this,arguments)||this;b.sourcePoint=null;b.mapPoint=null;return b}
M._inheritsLoose(e,c);return e}(B);m.__decorate([x.property()],B.prototype,"sourcePoint",void 0);m.__decorate([x.property({type:S})],B.prototype,"mapPoint",void 0);B=m.__decorate([R.subclass("esri.layers.support.ControlPoint")],B);l=function(c){function e(a){a=c.call(this,a)||this;a.controlPoints=null;a.height=0;a.type="control-points";a.width=0;return a}M._inheritsLoose(e,c);var b=e.prototype;b.toMap=function(a){if(f.isNone(a)||f.isNone(this.transform)||f.isNone(this.controlPoints)||!q(this.controlPoints[0]))return null;
k.set(n,a.x,a.y);a=this.controlPoints[0].mapPoint.spatialReference;p.transformProjective(n,n,this.transform);return new S({x:n[0],y:n[1],spatialReference:a})};b.toSource=function(a){if(f.isNone(a)||f.isNone(this.inverseTransform)||f.isNone(this.controlPoints)||!q(this.controlPoints[0]))return null;const d=this.controlPoints[0].mapPoint.spatialReference;a=a.normalize();a=T.projectOrLoad(a,d).geometry;if(f.isNone(a))return null;k.set(n,a.x,a.y);p.transformProjective(n,n,this.inverseTransform);return V.createScreenPoint(n[0],
n[1])};b._updateTransform=function(a){const {controlPoints:d,width:G,height:H}=this;if(!(!f.isNone(d)&&0<G&&0<H))return null;const [h,A,I,ca]=d;if(!q(h))return null;var E=h.mapPoint.spatialReference;const J=this._projectControlPoint(A,E),K=this._projectControlPoint(I,E);E=this._projectControlPoint(ca,E);if(!(J.valid&&K.valid&&E.valid&&q(J.controlPoint)))return null;f.isNone(a)&&(a=N.create());let Q=null;Q=q(K.controlPoint)&&q(E.controlPoint)?aa(a,h,J.controlPoint,K.controlPoint,E.controlPoint):q(K.controlPoint)?
Z(a,h,J.controlPoint,K.controlPoint):Y(a,h,J.controlPoint);return Q.every(da=>0===da)?null:Q};b._projectControlPoint=function(a,d){if(!q(a))return{valid:!0,controlPoint:a};const {sourcePoint:G,mapPoint:H}=a,{geometry:h,pending:A}=T.projectOrLoad(H,d);return A?{valid:!1,controlPoint:null}:A||h?{valid:!0,controlPoint:{sourcePoint:G,mapPoint:h}}:(U.getLogger(this.declaredClass).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:a,sourceSpatialReference:H.spatialReference,
targetSpatialReference:d}),{valid:!1,controlPoint:null})};M._createClass(e,[{key:"coords",get:function(){if(f.isNone(this.controlPoints))return null;const a=this._updateTransform(ba);if(f.isNone(a)||!q(this.controlPoints[0]))return null;var d=this.width,G=this.height,H=this.controlPoints[0].mapPoint.spatialReference;const h=g.fromValues(0,G),A=g.fromValues(0,0),I=g.fromValues(d,0);d=g.fromValues(d,G);p.transformProjective(h,h,a);p.transformProjective(A,A,a);p.transformProjective(I,I,a);p.transformProjective(d,
d,a);return new X({rings:[[h,A,I,d,h]],spatialReference:H})}},{key:"inverseTransform",get:function(){return f.isNone(this.transform)?null:W.invert(N.create(),this.transform)}},{key:"transform",get:function(){return this._updateTransform()}}]);return e}(l);m.__decorate([x.property({type:[B]})],l.prototype,"controlPoints",void 0);m.__decorate([x.property({readOnly:!0})],l.prototype,"coords",null);m.__decorate([x.property()],l.prototype,"height",void 0);m.__decorate([x.property({readOnly:!0})],l.prototype,
"inverseTransform",null);m.__decorate([x.property({readOnly:!0})],l.prototype,"transform",null);m.__decorate([x.property()],l.prototype,"width",void 0);l=m.__decorate([R.subclass("esri.layers.support.ControlPointsGeoreference")],l);const t=g.create(),v=g.create(),C=g.create(),y=g.create(),u=g.create(),w=g.create(),D=g.create(),z=g.create(),L=Math.PI/2,O=Array(8).fill(0),P=Array(8).fill(0);return l});