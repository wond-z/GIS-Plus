// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/source/DataLayerSource ../../../../rest/query/executeQueryJSON ../../../../rest/query/executeQueryPBF ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../rest/query/executeAttachmentQuery ../../../../rest/query/executeForCount ../../../../rest/query/executeForExtent ../../../../rest/query/executeForIds ../../../../rest/query/executeRelationshipQuery ../../../../rest/query/executeTopFeaturesQuery ../../../../rest/query/executeForTopIds ../../../../rest/query/executeForTopExtents ../../../../rest/query/executeForTopCount ../../../../rest/support/RelationshipQuery ../../../../tasks/Task".split(" "),
function(w,n,h,x,y,k,z,l,f,W,A,r,B,C,D,E,F,G,H,I,t,J,K,L,M,u,N){f=function(v){function q(b){b=v.call(this,b)||this;b.dynamicDataSource=null;b.fieldsIndex=null;b.format="json";b.gdbVersion=null;b.infoFor3D=null;b.sourceSpatialReference=null;return b}n._inheritsLoose(q,v);var d=q.prototype;d.execute=function(){var b=n._asyncToGenerator(function*(a,c){const e=yield this.executeJSON(a,c);return this.featureSetFromJSON(a,e,c)});return function(a,c){return b.apply(this,arguments)}}();d.executeJSON=function(){var b=
n._asyncToGenerator(function*(a,c){c={...this.requestOptions,...c};const e=this._normalizeQuery(a);a=null!=a.outStatistics?.[0];const m=y("featurelayer-pbf-statistics");a=!a||m;let g;if("pbf"===this.format&&a)try{g=yield C.executeRawQueryPBF(this.url,e,c)}catch(p){if("query:parsing-pbf"===p.name)this.format="json";else throw p;}"json"!==this.format&&a||(g=yield B.executeRawQueryJSON(this.url,e,c));this._normalizeFields(g.fields);return g});return function(a,c){return b.apply(this,arguments)}}();d.featureSetFromJSON=
function(){var b=n._asyncToGenerator(function*(a,c,e){if(!this._queryIs3DObjectFormat(a)||k.isNone(this.infoFor3D)||!c.assetMaps||!c.features||!c.features.length)return D.fromJSON(c);({meshFeatureSetFromJSON:e}=yield z.whenOrAbort(new Promise((m,g)=>w(["../../../../rest/support/meshFeatureSet"],m,g)),e));return e(a,this.infoFor3D,c)});return function(a,c,e){return b.apply(this,arguments)}}();d.executeForCount=function(b,a){a={...this.requestOptions,...a};b=this._normalizeQuery(b);return G.executeForCount(this.url,
b,a)};d.executeForExtent=function(b,a){a={...this.requestOptions,...a};b=this._normalizeQuery(b);return H.executeForExtent(this.url,b,a)};d.executeForIds=function(b,a){a={...this.requestOptions,...a};b=this._normalizeQuery(b);return I.executeForIds(this.url,b,a)};d.executeRelationshipQuery=function(b,a){b=u.from(b);a={...this.requestOptions,...a};if(this.gdbVersion||this.dynamicDataSource)b=b.clone(),b.gdbVersion=b.gdbVersion||this.gdbVersion,b.dynamicDataSource=b.dynamicDataSource||this.dynamicDataSource;
return t.executeRelationshipQuery(this.url,b,a)};d.executeRelationshipQueryForCount=function(b,a){b=u.from(b);a={...this.requestOptions,...a};if(this.gdbVersion||this.dynamicDataSource)b=b.clone(),b.gdbVersion=b.gdbVersion||this.gdbVersion,b.dynamicDataSource=b.dynamicDataSource||this.dynamicDataSource;return t.executeRelationshipQueryForCount(this.url,b,a)};d.executeAttachmentQuery=function(b,a){return F.executeAttachmentQuery(this.url,b,{...this.requestOptions,...a})};d.executeTopFeaturesQuery=
function(b,a){return J.executeTopFeaturesQuery(this.parsedUrl,b,this.sourceSpatialReference,{...this.requestOptions,...a})};d.executeForTopIds=function(b,a){return K.executeForTopIds(this.parsedUrl,b,{...this.requestOptions,...a})};d.executeForTopExtents=function(b,a){return L.executeForTopExtents(this.parsedUrl,b,{...this.requestOptions,...a})};d.executeForTopCount=function(b,a){return M.executeForTopCount(this.parsedUrl,b,{...this.requestOptions,...a})};d._normalizeQuery=function(b){let a=E.from(b);
a.sourceSpatialReference=a.sourceSpatialReference||this.sourceSpatialReference;if(this.gdbVersion||this.dynamicDataSource)a=a===b?a.clone():a,a.gdbVersion=b.gdbVersion||this.gdbVersion,a.dynamicDataSource=b.dynamicDataSource?r.DataLayerSource.from(b.dynamicDataSource):this.dynamicDataSource;if(k.isSome(this.infoFor3D)&&this._queryIs3DObjectFormat(b)){a=a===b?a.clone():a;a.formatOf3DObjects=null;for(const c of this.infoFor3D.queryFormats){if("3D_glb"===c){a.formatOf3DObjects=c;break}"3D_gltf"!==c||
a.formatOf3DObjects||(a.formatOf3DObjects=c)}if(!a.formatOf3DObjects)throw new x("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(k.isNone(a.outFields)||!a.outFields.includes("*")){a=a===b?a.clone():a;k.isNone(a.outFields)&&(a.outFields=[]);const {originX:c,originY:e,originZ:m,translationX:g,translationY:p,translationZ:O,scaleX:P,scaleY:Q,scaleZ:R,rotationX:S,rotationY:T,rotationZ:U,rotationDeg:V}=this.infoFor3D.transformFieldRoles;
a.outFields.push(c,e,m,g,p,O,P,Q,R,S,T,U,V)}}return a};d._normalizeFields=function(b){if(k.isSome(this.fieldsIndex)&&k.isSome(b))for(const a of b)(b=this.fieldsIndex.get(a.name))&&Object.assign(a,b.toJSON())};d._queryIs3DObjectFormat=function(b){return k.isSome(this.infoFor3D)&&b.returnGeometry&&"xyFootprint"!==b.multipatchOption&&!b.outStatistics};return q}(N);h.__decorate([l.property({type:r.DataLayerSource})],f.prototype,"dynamicDataSource",void 0);h.__decorate([l.property()],f.prototype,"fieldsIndex",
void 0);h.__decorate([l.property()],f.prototype,"format",void 0);h.__decorate([l.property()],f.prototype,"gdbVersion",void 0);h.__decorate([l.property()],f.prototype,"infoFor3D",void 0);h.__decorate([l.property()],f.prototype,"sourceSpatialReference",void 0);return f=h.__decorate([A.subclass("esri.tasks.QueryTask")],f)});