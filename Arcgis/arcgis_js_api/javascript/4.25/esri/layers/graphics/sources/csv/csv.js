// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/number"],function(h,D){function*t(a,d,b){let c=0;for(;c<=a.length;){var e=a.indexOf(d,c);e=a.substring(c,-1<e?e:void 0);c+=e.length+d.length;if(!b||e.trim())yield e}}function u(a){const d=a.includes("\r\n")?"\r\n":"\n";return t(a,d,!0)}function r(a,d){return t(a,d,!1)}function*v(a,d,b,c=()=>Object.create(null)){var e=u(a);e.next();var f="";a="";let g=0,k=c(),l=0;a:for(const m of e){e=r(m,b);for(const n of e)if(f+=a+n,a="",g+=w(n),0===g%2){if(0<g)if(f=x.exec(f))k[d[l]]=
f[1].replace(y,'"'),l++;else{k=c();l=0;f="";g=0;continue a}else k[d[l]]=f,l++;f="";g=0}else a=b;0===g?(yield k,k=c(),l=0):a="\n"}}function z(a,d){a=p(a,d).filter(b=>null!=b);d=a.map(b=>q(b));for(let b=d.length-1;0<=b;b--)d[b]||(d.splice(b,1),a.splice(b,1));return{names:d,aliases:a}}function p(a,d){if(!a?.length)return[];const b=[];var c="";let e="",f=0;a=r(a,d);for(const g of a)c+=e+g,e="",f+=w(g),0===f%2?(0<f?(c=x.exec(c))&&b.push(c[1].replace(y,'"')):b.push(c),c="",f=0):e=d;return b}function w(a){let d=
0,b;for(b=a.indexOf('"',0);0<=b;)d++,b=a.indexOf('"',b+1);return d}function E(a,d,b){d=q(d)?.toLowerCase();b=q(b)?.toLowerCase();const c=a.map(e=>e.toLowerCase());d=d?a[c.indexOf(d)]:null;b=b?a[c.indexOf(b)]:null;return{longitudeFieldName:d||a[c.indexOf(F.find(e=>c.includes(e)))],latitudeFieldName:b||a[c.indexOf(G.find(e=>c.includes(e)))]}}function A(a){if(!a.length)return"string";const d=/[^+-.,0-9]/;return a.map(b=>{var c=!1;if(""!==b){if(d.test(b))c=!0;else{c=B(b);if(!isNaN(c))return/[.,]/.test(b)||
!Number.isInteger(c)||214783647<c||-214783648>c?"double":"integer";if(b.includes("E"))if(c=Number(b),isNaN(c))if(b.includes(","))if(b=b.replace(",","."),c=Number(b),isNaN(c))c=!0;else return"double";else c=!0;else return"double";else c=!0}return c&&!/^[-]?\d*[.,]?\d*$/.test(b)&&C(new Date(b),b)?"date":"string"}}).reduce((b,c)=>{if(void 0===b)return c;if(void 0===c)return b;if(b===c)return c;if("string"===b||"string"===c)return"string";if("double"===b||"double"===c)return"double"})}function C(a,d){if(!a||
"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime()))return!1;a=!0;if(!H&&/\d+\W*$/.test(d)&&(d=d.match(/[a-zA-Z]{2,}/))){a=!1;let b=0;for(;!a&&b<=d.length;)a=!I.test(d[b]),b++;a=!a}return a}function q(a){return a?a.trim().replace(J,"_").replace(K,"_").replace(L,"").replace(M,"").replace(N,"F$1"):null}const x=/^\s*"([\S\s]*)"\s*$/,y=/""/g,O=[","," ",";","|","\t"],B=function(){const a=D._parseInfo(),d=new RegExp("^"+a.regexp+"$"),b=new RegExp("["+a.group+"\\s\\xa0]","g"),c=a.factor;
return e=>{e=d.exec(e);a.factor=c;if(!e)return NaN;let f=e[1];if(!e[1]){if(!e[2])return NaN;f=e[2];a.factor*=-1}f=f.replace(b,"").replace(a.decimal,".");return+f*a.factor}}(),I=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,H=Number.isNaN((new Date("technology 10")).getTime()),G="lat latitude latitude83 latdecdeg lat_dd y ycenter point_y".split(" "),F="lon lng long longitude longitude83 longdecdeg long_dd x xcenter point_x".split(" "),
N=/^([0-9])/,J=/[^A-Za-z0-9_\u0080-\uffff]/g,K=/_{2,}/g,L=/^_/,M=/_$/;h.extractFieldNamesAndAliasesFromRow=z;h.inferDelimiterAndLocationInfo=function(a,d,b){a=a.trim();d=d?.trim();var c=[],e=Array.from(new Set([b?.delimiter,...O])).filter(f=>null!=f);for(const f of e){e=p(a,f).length;const g=p(d,f).length??e;1<e&&c.push({weight:Math.min(e,g),delimiter:f})}d=c.sort(({weight:f},{weight:g})=>g-f).map(({delimiter:f})=>f);for(const f of d)if(c=z(a,f).names,c=E(c,b?.longitudeField,b?.latitudeField),c.longitudeFieldName&&
c.latitudeFieldName)return{delimiter:f,locationInfo:c};return{delimiter:d[0],locationInfo:null}};h.inferFieldType=A;h.inferFields=function(a,d,b,c,e){const f=[];d=v(a,b,d);a=[];for(var g of d){if(10===a.length)break;a.push(g)}for(g=0;g<b.length;g++){const l=b[g];d=c[g];if(l===e.longitudeFieldName||l===e.latitudeFieldName)f.push({name:l,type:"esriFieldTypeDouble",alias:d});else{var k=a.map(n=>n[l]);let m=void 0;switch(A(k)){case "integer":k="esriFieldTypeInteger";break;case "double":k="esriFieldTypeDouble";
break;case "date":k="esriFieldTypeDate";m=36;break;default:k="esriFieldTypeString",m=255}f.push({name:l,type:k,alias:d,length:m})}}return f};h.isValidDate=C;h.normalizeFieldName=q;h.parseNumber=B;h.parseRows=v;h.readRowParts=r;h.readRows=u;h.splitSingleRow=p;Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});