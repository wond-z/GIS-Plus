// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/Loadable ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ogc/ogcFeatureUtils ../../../rest/support/FeatureSet ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),function(g,w,m,N,x,C,n,p,O,P,
D,f,E,y,F){g.OGCFeatureSource=function(z){function q(){var a=z.apply(this,arguments)||this;a.featureDefinition=null;a.type="ogc-feature";return a}w._inheritsLoose(q,z);var e=q.prototype;e.load=function(a){this.addResolvingPromise(this._loadOGCServices(this.layer,a));return this.when()};e.getSource=function(){const {featureDefinition:{collection:a,layerDefinition:b,spatialReference:d,supportedCrs:c},layer:{apiKey:r,customParameters:t,effectiveMaxRecordCount:u}}=this;return{type:"ogc-source",collection:a,
layerDefinition:b,maxRecordCount:u,queryParameters:{apiKey:r,customParameters:t},spatialReference:d,supportedCrs:c}};e.queryExtent=function(a,b){return null};e.queryFeatureCount=function(a,b){return null};e.queryFeatures=function(a,b={}){return this.queryFeaturesJSON(a,b).then(d=>E.fromJSON(d))};e.queryFeaturesJSON=function(a,b={}){const d=this.getSource();return this.load(b).then(()=>f.queryFeatureSetJSON(d,a,b))};e.queryObjectIds=function(a,b){return null};e.serviceSupportsSpatialReference=function(a){return a.isWGS84||
a.isWebMercator?!0:!!this.featureDefinition.supportedCrs[a.wkid]};e._conformsToType=function(a,b){const d=new RegExp(`^${b}$`,"i");return a.conformsTo.some(c=>d.test(c))??!1};e._getCapabilities=function(a,b){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:a},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,
supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:b,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,
supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,
supportsCompactGeometry:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}};
e._getMaxRecordCount=function(a){return a?.components?.parameters?.limit?.schema?.maximum??a?.components?.parameters?.limitFeatures?.schema?.maximum};e._getStorageSpatialReference=function(a){a=f.getSpatialReferenceWkid(a.storageCrs??f.crsDefault);return n.isNone(a)?y.WGS84:new y({wkid:a})};e._getSupportedSpatialReferences=function(a,b){a=a.crs??[f.crsDefault];const d=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return(a.includes("#/crs")?a.filter(c=>"#/crs"!==c).concat(b.crs):a).filter(c=>
!d.test(c))};e._loadOGCServices=function(){var a=w._asyncToGenerator(function*(b,d){var c=n.isSome(d)?d.signal:null;const {apiKey:r,collectionId:t,customParameters:u,fields:G,geometryType:H,hasZ:I,objectIdField:J,timeInfo:K,url:L}=b;d={fields:G?.map(k=>k.toJSON()),geometryType:F.typeKebabDictionary.toJSON(H),hasZ:I,objectIdField:J,timeInfo:K?.toJSON()};c={apiKey:r,customParameters:u,signal:c};var h=yield f.getServerLandingPage(L,c);const [A,B]=yield Promise.all([f.getServerConformance(h,c),f.getServerCollections(h,
c)]);if(!this._conformsToType(A,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new x("ogc-feature-layer:no-geojson-support","Server does not support geojson");b=B.collections.find(k=>k.id===t);if(!b)throw new x("ogc-feature-layer:collection-not-found","Server does not contain the named collection");h=this._conformsToType(A,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?yield f.getServerOpenApi(h,c):null;d=yield f.getCollectionDefinition(b,d,c);c=this._getMaxRecordCount(h);
c=this._getCapabilities(d.hasZ,c);h=this._getStorageSpatialReference(b).toJSON();var l=this._getSupportedSpatialReferences(b,B);const M=new RegExp(`^${f.crsPrefix}`,"i"),v={};for(const k of l)l=f.getSpatialReferenceWkid(k),n.isSome(l)&&(v[l]||(v[l]=k.replace(M,"")));this.featureDefinition={capabilities:c,collection:b,layerDefinition:d,spatialReference:h,supportedCrs:v}});return function(b,d){return a.apply(this,arguments)}}();return q}(C);m.__decorate([p.property()],g.OGCFeatureSource.prototype,"featureDefinition",
void 0);m.__decorate([p.property({constructOnly:!0})],g.OGCFeatureSource.prototype,"layer",void 0);m.__decorate([p.property()],g.OGCFeatureSource.prototype,"type",void 0);g.OGCFeatureSource=m.__decorate([D.subclass("esri.layers.graphics.sources.OGCFeatureSource")],g.OGCFeatureSource);Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});