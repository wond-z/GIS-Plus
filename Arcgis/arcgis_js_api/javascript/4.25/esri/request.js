// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./config ./kernel ./core/Error ./core/has ./core/lang ./core/maybe ./core/promiseUtils ./core/urlUtils ./portal/support/urlUtils ./support/apiKeyUtils ./support/requestUtils".split(" "),function(P,u,C,n,D,x,W,X,w,k,Y,Z,y){function r(a,b){return E.apply(this,arguments)}function E(){E=u._asyncToGenerator(function*(a,b){var c=k.isDataProtocol(a);const e=k.isBlobProtocol(a);e||c||(a=k.normalize(a));const d={url:a,requestOptions:{...X.unwrap(b)}};let f=
k.getInterceptor(a);if(f){a=yield aa(f,d);if(null!=a)return{data:a,getHeader:F,requestOptions:d.requestOptions,url:d.url};f.after||f.error||(f=null)}a=d.url;b=d.requestOptions;if("image"===b.responseType){if(x("host-webworker")||x("host-node"))throw p("request:invalid-parameters",Error("responseType 'image' is not supported in Web Workers or Node environment"),d);}else if(c)throw p("request:invalid-parameters",Error("Data URLs are not supported for responseType \x3d "+b.responseType),d);if("head"===
b.method){if(b.body)throw p("request:invalid-parameters",Error("body parameter cannot be set when method is 'head'"),d);if(c||e)throw p("request:invalid-parameters",Error("data and blob URLs are not supported for method 'head'"),d);}yield ba();if(z)return z.execute(a,b);const h=new AbortController;w.onAbort(b,()=>h.abort());c=yield ca({controller:h,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:f,params:d,redoRequest:!1,useIdentity:q.useIdentity,useProxy:!1,useSSL:!1,
withCredentials:!1});f?.after?.(c);return c});return E.apply(this,arguments)}function da(a){(a=k.getOrigin(a))&&!r._corsServers.includes(a)&&r._corsServers.push(a)}function Q(a){a=k.getOrigin(a);return!a||a.endsWith(".arcgis.com")||r._corsServers.includes(a)||k.isTrustedServer(a)}function p(a,b,c,e){let d="Error";const f={url:c.url,requestOptions:c.requestOptions,getHeader:F,ssl:!1};if(b instanceof D)return b.details?(b.details=W.clone(b.details),b.details.url=c.url,b.details.requestOptions=c.requestOptions):
b.details=f,b;if(b){c=e&&(m=>e.headers.get(m));const h=e&&e.status,g=b.message;g&&(d=g);c&&(f.getHeader=c);f.httpStatus=(null!=b.httpCode?b.httpCode:b.code)||h||0;f.subCode=b.subcode;f.messageCode=b.messageCode;f.messages="string"===typeof b.details?[b.details]:b.details;f.raw=A in b?b[A]:b}return w.isAbortError(b)?w.createAbortError():new D(a,d,f)}function ba(){return G.apply(this,arguments)}function G(){G=u._asyncToGenerator(function*(){x("host-webworker")?z||(z=yield new Promise((a,b)=>P(["./core/workers/request"],
a,b))):r._abortableFetch||(r._abortableFetch=globalThis.fetch.bind(globalThis))});return G.apply(this,arguments)}function H(){return I.apply(this,arguments)}function I(){I=u._asyncToGenerator(function*(){n.id||(yield new Promise((a,b)=>P(["./identity/IdentityManager"],c=>a(Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"}))),b)))});return I.apply(this,arguments)}function ea(a){return J.apply(this,arguments)}function J(){J=u._asyncToGenerator(function*(a){const b=
a.params.url,c=a.params.requestOptions,e=a.controller.signal,d=c.body;let f=null,h=null;R&&"HTMLFormElement"in globalThis&&(d instanceof FormData?f=d:d instanceof HTMLFormElement&&(f=new FormData(d)));"string"===typeof d&&(h=d);a.fetchOptions={cache:c.cacheBust&&!r._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:c.headers||{},method:"head"===c.method?"HEAD":"GET",mode:"cors",priority:q.priority,redirect:"follow",signal:e};if(f||h)a.fetchOptions.body=f||h;"anonymous"===
c.authMode&&(a.useIdentity=!1);a.hasToken=!!(/token=/i.test(b)||c.query?.token||f?.get("token"));!a.hasToken&&C.apiKey&&Z.supportsApiKey(b)&&(c.query||(c.query={}),c.query.token=C.apiKey,a.hasToken=!0);if(a.useIdentity&&!a.hasToken&&!a.credentialToken&&!S(b)&&!w.isAborted(e)){let g;"immediate"===c.authMode?(yield H(),g=yield n.id.getCredential(b,{signal:e}),a.credential=g):"no-prompt"===c.authMode?(yield H(),g=yield n.id.getCredential(b,{prompt:!1,signal:e}).catch(()=>{}),a.credential=g):n.id&&(g=
n.id.findCredential(b));g&&(a.credentialToken=g.token,a.useSSL=!!g.ssl)}});return J.apply(this,arguments)}function S(a){return fa.some(b=>b.test(a))}function ha(a){return K.apply(this,arguments)}function K(){K=u._asyncToGenerator(function*(a){let b=a.params.url;const c=a.params.requestOptions,e=a.fetchOptions??{},d=k.isBlobProtocol(b)||k.isDataProtocol(b),f=c.responseType||"json";var h=d?0:null!=c.timeout?c.timeout:q.timeout,g=!1;if(!d){a.useSSL&&(b=k.toHTTPS(b));c.cacheBust&&"default"===e.cache&&
(b=k.addQueryParameter(b,"request.preventCache",Date.now()));var m={...c.query};a.credentialToken&&(m.token=a.credentialToken);g=k.objectToQuery(m);x("esri-url-encodes-apostrophe")&&(g=g.replace(/'/g,"%27"));const t=b.length+1+g.length;g="delete"===c.method||"post"===c.method||"put"===c.method||!!c.body||t>q.maxUrlLength;const v=c.useProxy||!!k.getProxyRule(b);if(v){const L=k.getProxyUrl(b);var B=L.path;!g&&B.length+1+t>q.maxUrlLength&&(g=!0);L.query&&(m={...L.query,...m})}if("HEAD"===e.method&&(g||
v)){if(g){if(t>q.maxUrlLength)throw p("request:invalid-parameters",Error("URL exceeds maximum length"),a.params);throw p("request:invalid-parameters",Error("cannot use POST request when method is 'head'"),a.params);}if(v)throw p("request:invalid-parameters",Error("cannot use proxy when method is 'head'"),a.params);}g?(e.method="delete"===c.method?"DELETE":"put"===c.method?"PUT":"POST",c.body?b=k.addQueryParameters(b,m):(e.body=k.objectToQuery(m),e.headers||(e.headers={}),e.headers["Content-Type"]=
"application/x-www-form-urlencoded")):b=k.addQueryParameters(b,m);v&&(a.useProxy=!0,b=`${B}?${b}`);m.token&&R&&e.body instanceof FormData&&!Y.isSecureProxyService(b)&&e.body.set("token",m.token);c.hasOwnProperty("withCredentials")?a.withCredentials=c.withCredentials:k.hasSameOrigin(b,k.getAppUrl())||(k.isTrustedServer(b)?a.withCredentials=!0:n.id&&(B=n.id.findServerInfo(b))&&B.webTierAuth&&(a.withCredentials=!0));a.withCredentials&&(e.credentials="include",y.isNoCorsRequestRequired(b)&&(yield y.sendNoCorsRequest(g?
k.addQueryParameters(b,m):b)))}m=0;let T=!1;0<h&&(m=setTimeout(()=>{T=!0;a.controller.abort()},h));h=void 0;let l;try{if("native-request-init"===c.responseType)l=e,l.url=b;else if("image"!==c.responseType||"default"!==e.cache||"GET"!==e.method||g||ia(c.headers)||!d&&!a.useProxy&&q.proxyUrl&&!Q(b))if(h=yield r._abortableFetch(b,e),a.useProxy||da(b),"native"===c.responseType)l=h;else{if("HEAD"!==e.method)if(h.ok){switch(f){case "array-buffer":l=yield h.arrayBuffer();break;case "blob":case "image":l=
yield h.blob();break;default:l=yield h.text()}m&&(clearTimeout(m),m=0);if("json"===f||"xml"===f||"document"===f)if(l)switch(f){case "json":l=JSON.parse(l);break;case "xml":l=U(l,"application/xml");break;case "document":l=U(l,"text/html")}else l=null;if(l){if("array-buffer"===f||"blob"===f){const t=h.headers.get("Content-Type");if(t&&/application\/json|text\/plain/i.test(t)&&750>=l["blob"===f?"size":"byteLength"])try{const v=yield(new Response(l)).json();v.error&&(l=v)}catch{}}"image"===f&&l instanceof
Blob&&(l=yield V(URL.createObjectURL(l),a,!0))}}else l=yield h.text()}else l=yield V(b,a)}catch(t){if("AbortError"===t.name){if(T)throw Error("Timeout exceeded");throw w.createAbortError("Request canceled");}if(!h&&t instanceof TypeError&&q.proxyUrl&&!c.body&&"delete"!==c.method&&"head"!==c.method&&"post"!==c.method&&"put"!==c.method&&!a.useProxy&&!Q(b))a.redoRequest=!0,k.addProxyRule({proxyUrl:q.proxyUrl,urlPrefix:k.getOrigin(b)??""});else throw t;}finally{m&&clearTimeout(m)}return[h,l]});return K.apply(this,
arguments)}function aa(a,b){return M.apply(this,arguments)}function M(){M=u._asyncToGenerator(function*(a,b){if(null!=a.responseData)return a.responseData;a.headers&&(b.requestOptions.headers={...b.requestOptions.headers,...a.headers});a.query&&(b.requestOptions.query={...b.requestOptions.query,...a.query});if(a.before){let c,e;try{e=yield a.before(b)}catch(d){c=p("request:interceptor",d,b)}if(e instanceof Error||e instanceof D)c=p("request:interceptor",e,b);if(c)throw a.error&&a.error(c),c;return e}});
return M.apply(this,arguments)}function ia(a){if(a)for(const b of Object.getOwnPropertyNames(a))if(a[b])return!0;return!1}function U(a,b){let c;try{c=(new DOMParser).parseFromString(a,b)}catch{}if(!c||c.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return c}function ca(a){return N.apply(this,arguments)}function N(){N=u._asyncToGenerator(function*(a){yield ea(a);let b;try{do[b,c]=yield ha(a);while(!(yield ja(a,b,c)))}catch(f){var c=p("request:server",f,a.params,
b);c.details.ssl=a.useSSL;a.interceptor&&a.interceptor.error&&a.interceptor.error(c);throw c;}var e=a.params.url;c&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(e)&&(a.hasToken||a.credentialToken||!c.user?.username||k.isTrustedServer(e)||(e=k.getOrigin(e,!0))&&q.trustedServers.push(e),Array.isArray(c.authorizedCrossOriginNoCorsDomains)&&y.registerNoCorsDomains(c.authorizedCrossOriginNoCorsDomains));if((e=a.credential)&&n.id){var d=n.id.findServerInfo(e.server);if(d=d&&d.owningSystemUrl)d=d.replace(/\/?$/,
"/sharing"),(e=n.id.findCredential(d,e.userId))&&-1===n.id._getIdenticalSvcIdx(d,e)&&e.resources.unshift(d)}return{data:c,getHeader:b?f=>b?.headers.get(f):F,requestOptions:a.params.requestOptions,ssl:a.useSSL,url:a.params.url}});return N.apply(this,arguments)}function ja(a,b,c){return O.apply(this,arguments)}function O(){O=u._asyncToGenerator(function*(a,b,c){if(a.redoRequest)return a.redoRequest=!1;var e=a.params.requestOptions;if(!b||"native"===e.responseType||"native-request-init"===e.responseType)return!0;
let d;if(!b.ok)throw d=Error(`Unable to load ${b.url} status: ${b.status}`),d[A]=c,d;c&&(c.error?d=c.error:"error"===c.status&&Array.isArray(c.messages)&&(d={...c},d[A]=c,d.details=c.messages));let f;b=null;let h;d&&(f=Number(d.code),b=d.hasOwnProperty("subcode")?Number(d.subcode):null,h=(h=d.messageCode)&&h.toUpperCase());e=e.authMode;if(403===f&&(4===b||d.message&&d.message.toLowerCase().includes("ssl")&&!d.message.toLowerCase().includes("permission"))){if(!a.useSSL)return a.useSSL=!0,!1}else if(!a.hasToken&&
a.useIdentity&&("no-prompt"!==e||498===f)&&void 0!==f&&ka.includes(f)&&!S(a.params.url)&&(403!==f||h&&!la.includes(h)&&(null==b||2===b&&a.credentialToken))){yield H();try{const g=yield n.id.getCredential(a.params.url,{error:p("request:server",d,a.params),prompt:"no-prompt"!==e,signal:a.controller.signal,token:a.credentialToken});a.credential=g;a.credentialToken=g.token;a.useSSL=a.useSSL||g.ssl;return!1}catch(g){if("no-prompt"===e)return a.credential=void 0,a.credentialToken=void 0,!1;d=g}}if(d)throw d;
return!0});return O.apply(this,arguments)}function V(a,b,c=!1){const e=b.controller.signal,d=new Image;d.crossOrigin=b.withCredentials?"use-credentials":"anonymous";d.alt="";d.fetchPriority=q.priority;d.src=a;return y.loadImageAsync(d,a,c,e)}let z;const q=C.request,R="FormData"in globalThis,ka=[499,498,403,401],la=["COM_0056","COM_0057","SB_0008"],fa=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],F=()=>null,A=Symbol();r._abortableFetch=null;r._corsServers=["https://server.arcgisonline.com",
"https://services.arcgisonline.com"];return r});