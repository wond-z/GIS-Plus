// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/Error ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(r,l,u,k,v,x,y,z,A,B,w){r.PopupView=m=>{m=function(t){function n(){return t.apply(this,arguments)||this}l._inheritsLoose(n,t);var h=n.prototype;h.fetchPopupFeatures=function(){var b=l._asyncToGenerator(function*(a,c){yield this.when();
const {location:e,queryArea:d,layerViewsAndGraphics:f,clientOnlyGraphics:g}=yield this._prepareFetchPopupFeatures(a,c);a=Promise.resolve(g);c=this._queryLayerPopupFeatures(d,f,c);const q=c.map(p=>p.promise);a=v.eachAlwaysValues([a,...q]).then(p=>Array.from(new Set(p.flat())));return{location:e,clientOnlyGraphics:g,allGraphicsPromise:a,promisesPerLayerView:c}});return function(a,c){return b.apply(this,arguments)}}();h._queryLayerPopupFeatures=function(b,a,c){return a.map(({layerView:e,graphics:d})=>
{d={clientGraphics:d,event:k.isSome(c)?c.event:null,signal:k.isSome(c)?c.signal:null,defaultPopupTemplateEnabled:k.isSome(c)?!!c.defaultPopupTemplateEnabled:!1};d=e.fetchPopupFeatures(b,d);return{layerView:e,promise:d}})};h._isValidPopupGraphic=function(b,a){return b&&!!b.getEffectivePopupTemplate(k.isSome(a)&&a.defaultPopupTemplateEnabled)};h._prepareFetchPopupFeatures=function(){var b=l._asyncToGenerator(function*(a,c){const {clientGraphics:e,queryArea:d,location:f}=yield this._popupHitTestGraphics(a,
c);a=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:g,clientOnlyGraphics:q}=this._graphicsPerFetchPopupLayerView(e,a);return{clientOnlyGraphics:q,layerViewsAndGraphics:g,queryArea:d,location:f}});return function(a,c){return b.apply(this,arguments)}}();h._popupHitTestGraphics=function(){var b=l._asyncToGenerator(function*(a,c){const {results:e,mapPoint:d}=yield this.popupHitTest(a);a=e.filter(g=>"graphic"===g.type&&this._isValidPopupGraphic(g.graphic,c));const f=a.length?a[0].mapPoint:
null;return{clientGraphics:a.map(g=>g.graphic),queryArea:d,location:d||f}});return function(a,c){return b.apply(this,arguments)}}();h._getFetchPopupLayerViews=function(){const b=[];this.allLayerViews.forEach(a=>{this._isValidPopupLayerView(a)&&b.push(a)});k.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&b.push(this.graphicsView);return b.reverse()};h._isValidPopupLayerView=function(b){return k.isSome(b)&&(!("layer"in b)||!b.suspended)&&"fetchPopupFeatures"in b};h._graphicsPerFetchPopupLayerView=
function(b,a){const c=[],e=new Map;a=a.map(d=>{const f=[];"layer"in d?e.set(d.layer,f):e.set(d.graphics,f);return{layerView:d,graphics:f}});for(const d of b)(b=e.get(d.layer)||e.get(d.sourceLayer)||null)?b.push(d):c.push(d);return{layerViewsAndGraphics:a,clientOnlyGraphics:c}};return n}(m);return m=u.__decorate([w.subclass("esri.views.PopupView")],m)};Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});