// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/has ../../core/Evented ../../core/HandleOwner ../../core/handleUtils ../../core/maybe ../../core/quantityUtils ../../core/reactiveUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/GraphicsLayer ../../support/elevationInfoUtils ./support/createUtils ./support/surfaceCoordinateSystems ../interactive/InteractiveToolBase ../interactive/sketch/SketchLabelOptions ../interactive/sketch/SketchTooltipOptions ../interactive/tooltip/DrawTooltipInfos ../interactive/tooltip/Tooltip ../support/automaticAreaMeasurementUtils ../support/automaticLengthMeasurementUtils".split(" "),
function(d,z,e,E,O,F,G,H,b,l,v,I,f,P,Q,J,K,L,m,A,M,B,C,r,N,D,w){d.DrawGraphicTool=function(t){function x(a){a=t.call(this,a)||this;a._graphic=null;a._createOperationGeometry=null;a.defaultZ=0;a.geometryType=null;a.hasZ=!0;a.labelOptions=new B;a.mode=null;a.snappingManager=null;a.snapToScene=!1;a.tooltip=null;a.tooltipOptions=new C;return a}z._inheritsLoose(x,t);var k=x.prototype;k.initialize=function(){this.internalGraphicsLayer=new K({listMode:"hide",internal:!0});this.view.map.layers.add(this.internalGraphicsLayer);
this.drawOperation=this.makeDrawOperation();this.handles.add([this.drawOperation.on("vertex-add",a=>this.onVertexAdd(a)),this.drawOperation.on("vertex-remove",a=>this.onVertexRemove(a)),this.drawOperation.on("vertex-update",a=>this.onVertexUpdate(a)),this.drawOperation.on("cursor-update",a=>this.onCursorUpdate(a)),this.drawOperation.on("complete",a=>this.onComplete(a)),v.watch(()=>this.tooltipOptions.enabled,a=>{this.tooltip=a?new N.Tooltip({view:this.view,info:this._tooltipInfo}):b.destroyMaybe(this.tooltip)},
v.syncAndInitial),v.watch(()=>this._tooltipInfo,a=>{b.isSome(this.tooltip)&&(this.tooltip.info=a)},v.syncAndInitial)]);this.finishToolCreation()};k.destroy=function(){this.drawOperation=b.destroyMaybe(this.drawOperation);this.tooltip=b.destroyMaybe(this.tooltip);this._destroyAllVisualisations();this.view.map.remove(this.internalGraphicsLayer);this.internalGraphicsLayer=b.destroyMaybe(this.internalGraphicsLayer);this._set("view",null)};k.completeCreateOperation=function(){this.drawOperation.complete()};
k.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};k.redo=function(){this.drawOperation.redo()};k.reset=function(){};k.undo=function(){this.drawOperation.undo()};k._createGraphic=function(a){this._graphic=new E({...this.graphicProperties,geometry:a,symbol:this.graphicSymbol});this.internalGraphicsLayer.add(this._graphic);this.handles.add(this.initializeGraphic(this._graphic));this.notifyChange("graphic");this.handles.add(H.makeHandle(()=>{b.isSome(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),
this._graphic=b.destroyMaybe(this._graphic))}),"create-operation-graphic")};k._destroyAllVisualisations=function(){this.handles.remove(p.outline);this.handles.remove(p.regularVertices);this.handles.remove(p.activeVertex);this.handles.remove("create-operation-graphic")};k._getCreateOperationGeometry=function(a={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var c=this.drawOperation.stagedVertex,g=this.drawOperation.committedVertices;const h=g.slice();
b.isSome(c)&&h.push(this.drawOperation.coordinateHelper.pointToArray(c));var q=b.isSome(c)?this.drawOperation.coordinateHelper.pointToArray(c):g.splice(-1)[0];c={regularVertices:null,activeVertex:null,full:null,outline:null,circle:null,rectangle:null};const n=h.length,u=this.view.spatialReference,y="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case "point":c.regularVertices=g;c.activeVertex=q;c.full=this.drawOperation.coordinateHelper.arrayToPoint(h[0]);break;case "multipoint":c.regularVertices=
g;c.activeVertex=q;0<n&&(c.full=m.createMultipoint(h,u));break;case "polyline":c.regularVertices=g;c.activeVertex=q;0<n&&(c.full=m.createPolyline([h],u,y));break;case "polygon":c.regularVertices=g;c.activeVertex=q;0<n&&(c.full=m.createPolygon([h],u,y,!0));break;case "circle":0<n&&(g=A.createViewAlignedCoordinateSystem(this.view,h[0]),1===n&&a.operationComplete?(a=h[0],q=g.makeMapPoint(a[0]+48*this.view.resolution,a[1]),c.circle=m.createCircle([a,q],g,!0),c.full=b.isSome(c.circle)?c.circle.geometry:
null):2===n&&(this.forceUniformSize?(c.circle=m.createCircle(h,g,this.centered),c.full=b.isSome(c.circle)?c.circle.geometry:null):(c.rectangle=m.createEllipse(h,g,this.centered),c.full=c.rectangle.geometry)));break;case "rectangle":0<n&&(g=A.createViewAlignedCoordinateSystem(this.view,h[0]),1===n&&a.operationComplete?(a=h[0],q=g.makeMapPoint(a[0]+48*this.view.resolution,a[1]),c.rectangle=m.createSquare([a,q],g,!0),c.full=c.rectangle.geometry):2===n&&(c.rectangle=this.forceUniformSize?m.createSquare(h,
g,this.centered):m.createRectangle(h,g,this.centered),c.full=c.rectangle.geometry));break;default:return null}switch(this.geometryType){case "polyline":case "polygon":1<n&&(c.outline=m.createPolyline([h],u,y));break;case "circle":case "rectangle":b.isSome(c.full)&&"polygon"===c.full.type&&(c.outline=m.createPolygon(c.full.rings,u,y))}return c};k.initializeGraphic=function(a){return null};k.onComplete=function(a){this._updateGraphic();let c=null;if(this.drawOperation.isCompleted){const g=this._getCreateOperationGeometry({operationComplete:!0});
b.isSome(g)&&(b.isNone(this._graphic)?this._createGraphic(g.full):this._graphic.geometry=g.full,c=b.unwrap(this._graphic).clone())}this._createOperationGeometry=null;this.emit("complete",{graphic:c,...a})};k.onCursorUpdate=function(a){this._updateGraphic();this.emit("cursor-update",a)};k.onDeactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()};k.onVertexAdd=function(a){this._updateGraphic();this.emit("vertex-add",a)};k.onVertexRemove=function(a){this._updateGraphic();this.emit("vertex-remove",
a)};k.onVertexUpdate=function(a){this._updateGraphic();this.emit("vertex-update",a)};k._updateGraphic=function(){const a=this._getCreateOperationGeometry();this._createOperationGeometry=a;b.isNone(a)?this._destroyAllVisualisations():(b.isSome(a.outline)?this.handles.add(this.onOutlineChanged(a.outline),p.outline):this.handles.remove(p.outline),b.isSome(a.regularVertices)?this.handles.add(this.onRegularVerticesChanged(a.regularVertices),p.regularVertices):this.handles.remove(p.regularVertices),b.isSome(a.activeVertex)?
this.handles.add(this.onActiveVertexChanged(a.activeVertex),p.activeVertex):this.handles.remove(p.activeVertex),b.isSome(a.full)?b.isNone(this._graphic)?this._createGraphic(a.full):this._graphic.geometry=a.full:this.handles.remove("create-operation-graphic"))};z._createClass(x,[{key:"_defaultElevation",get:function(){return l.createLength(this.defaultZ,"meters")}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"centered",
set:function(a){this._set("centered",a);this._updateGraphic()}},{key:"enabled",set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)}},{key:"forceUniformSize",set:function(a){this._set("forceUniformSize",a);this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(a){this._set("graphicSymbol",a);b.isSome(this._graphic)&&(this._graphic.symbol=a)}},{key:"updating",get:function(){return this.drawOperation?.updating??!1}},{key:"_tooltipInfo",
get:function(){const {drawOperation:a}=this;if(!a)return null;switch(this.geometryType){case "point":return this._drawPointTooltipInfo;case "polyline":return this._drawPolylineTooltipInfo;case "polygon":return this._drawPolygonTooltipInfo;case "rectangle":return this._drawRectangleTooltipInfo;case "circle":return this._drawCircleTooltipInfo;default:return null}}},{key:"_drawPointTooltipInfo",get:function(){const a=b.applySome(this.graphic,c=>c.geometry);return b.isNone(a)||"point"!==a.type||"2d"===
this.view.type&&0===this.defaultZ?null:new r.DrawPointTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail})}},{key:"_drawPolylineTooltipInfo",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;if(b.isNone(a)||"polyline"!==a.type)return null;a=w.autoLengthByElevationMode(a,this._elevationMode);return new r.DrawPolylineTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:b.unwrapOr(a,l.zeroMeters),
viewType:this.view.type})}},{key:"_drawPolygonTooltipInfo",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;if(b.isNone(a)||"polygon"!==a.type)return null;a=D.autoAreaByElevationMode(a,this._elevationMode);return new r.DrawPolygonTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:b.unwrapOr(a,l.zeroSquareMeters),viewType:this.view.type})}},{key:"_drawRectangleTooltipInfo",get:function(){return b.isNone(this.drawOperation)?null:new r.DrawRectangleTooltipInfo({tooltipOptions:this.tooltipOptions,
xSize:b.unwrapOr(this._xSize,l.zeroMeters),ySize:b.unwrapOr(this._ySize,l.zeroMeters),area:b.unwrapOr(this._fullGeometryArea,l.zeroSquareMeters)})}},{key:"_drawCircleTooltipInfo",get:function(){if(b.isNone(this.drawOperation))return null;const a=this.forceUniformSize;return new r.DrawCircleTooltipInfo({tooltipOptions:this.tooltipOptions,radius:a?b.unwrapOr(this._circleRadius,l.zeroMeters):null,xSize:a?null:b.unwrapOr(this._xSize,l.zeroMeters),ySize:a?null:b.unwrapOr(this._ySize,l.zeroMeters),area:b.unwrapOr(this._fullGeometryArea,
l.zeroSquareMeters)})}},{key:"_circleRadius",get:function(){const a=this._createOperationGeometry;return b.isSome(a)&&b.isSome(a.circle)&&b.isSome(a.circle.center)&&b.isSome(a.circle.edge)?w.autoHorizontalDistanceByElevationModeBetweenPoints(a.circle.center,a.circle.edge,this._elevationMode):null}},{key:"_xSize",get:function(){var a=this._createOperationGeometry;if(b.isNone(a)||b.isNone(a.rectangle))return null;({midpoints:a}=a.rectangle);return b.isSome(a)?w.autoHorizontalDistanceByElevationModeBetweenPoints(a.left,
a.right,this._elevationMode):null}},{key:"_ySize",get:function(){var a=this._createOperationGeometry;if(b.isNone(a)||b.isNone(a.rectangle))return null;({midpoints:a}=a.rectangle);return b.isSome(a)?w.autoHorizontalDistanceByElevationModeBetweenPoints(a.top,a.bottom,this._elevationMode):null}},{key:"_fullGeometryArea",get:function(){var a=this._createOperationGeometry;a=b.isSome(a)?a.full:null;return b.isNone(a)||"polygon"!==a.type?null:D.autoAreaByElevationMode(a,this._elevationMode)}},{key:"_elevationTooltipDetail",
get:function(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}},{key:"_vertexTooltipElevation",get:function(){const {tooltipOptions:a,view:c,drawOperation:g}=this;if(b.isNone(g))return this._defaultElevation;var h=g.stagedVertex??g.lastVertex;if(b.isNone(h)||"2d"===c.type)return this._defaultElevation;h=L.getConvertedElevation(c,h,g.elevationInfo,{mode:a.elevation.mode,offset:0})*I.getMetersPerVerticalUnitForSR(h.spatialReference);return l.createLength(h,"meters")}},
{key:"_elevationMode",get:function(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}}]);return x}(G.HandleOwnerMixin(F.EventedMixin(M.InteractiveToolBase)));e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_createOperationGeometry",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_defaultElevation",null);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"centered",null);e.__decorate([f.property({nonNullable:!0})],d.DrawGraphicTool.prototype,
"defaultZ",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"drawOperation",void 0);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"enabled",null);e.__decorate([f.property({value:!0})],d.DrawGraphicTool.prototype,"forceUniformSize",null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"geometryType",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"graphic",null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,
"graphicProperties",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"graphicSymbol",null);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"hasZ",void 0);e.__decorate([f.property({constructOnly:!0,type:B})],d.DrawGraphicTool.prototype,"labelOptions",void 0);e.__decorate([f.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"mode",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"snappingManager",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,
"snapToScene",void 0);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"tooltip",void 0);e.__decorate([f.property({constructOnly:!0,type:C})],d.DrawGraphicTool.prototype,"tooltipOptions",void 0);e.__decorate([f.property({readOnly:!0})],d.DrawGraphicTool.prototype,"type",void 0);e.__decorate([f.property({readOnly:!0})],d.DrawGraphicTool.prototype,"updating",null);e.__decorate([f.property({constructOnly:!0,nonNullable:!0})],d.DrawGraphicTool.prototype,"view",void 0);e.__decorate([f.property()],
d.DrawGraphicTool.prototype,"_tooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawPointTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawPolylineTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawPolygonTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawRectangleTooltipInfo",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_drawCircleTooltipInfo",null);e.__decorate([f.property()],
d.DrawGraphicTool.prototype,"_circleRadius",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_xSize",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_ySize",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_fullGeometryArea",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_elevationTooltipDetail",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,"_vertexTooltipElevation",null);e.__decorate([f.property()],d.DrawGraphicTool.prototype,
"_elevationMode",null);d.DrawGraphicTool=e.__decorate([J.subclass("esri.views.draw.DrawGraphicTool")],d.DrawGraphicTool);const p={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};d.geometryTypeToDrawOperationGeometryType=function(t){switch(t){case "point":case "polyline":case "polygon":case "multipoint":return t;case "circle":case "rectangle":return"segment";default:return null}};Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});