// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../symbols ../../../core/Evented ../../../core/Handles ../../../core/lang ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/GraphicsLayer ./drawUtils ./HighlightHelper ./layerUtils ./input/GraphicMoverEvents ../../input/InputManager ../../interactive/GraphicManipulator ../../support/screenUtils ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol".split(" "),
function(B,l,h,G,C,H,u,v,m,O,I,J,D,K,E,n,q,L,w,x,M,N){h=function(F){function y(a){a=F.call(this,a)||this;a._activeGraphic=null;a._dragEvent=null;a._handles=new C;a._hoverGraphic=null;a._indicators=[];a._initialDragGeometry=null;a._viewHandles=new C;a._manipulators=[];a._layerViews=null;a.type="graphic-mover";a.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},
onGraphicPointerUp(){}};a.enableMoveAllGraphics=!1;a.graphics=[];a.indicatorsEnabled=!1;a.layer=new J({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"});a.view=null;return a}B._inheritsLoose(y,F);var e=y.prototype;e.initialize=function(){E.addUniqueLayer(this.view,this.layer);this._highlightHelper=new K({view:this.view});this.refresh();this._handles.add([v.watch(()=>[this.graphics,this.graphics?.length],()=>this.refresh()),v.when(()=>this.view?.ready,()=>{this._viewHandles.add([this.view.on("immediate-click",
a=>this._clickHandler(a),q.ViewEventPriorities.TOOL),this.view.on("double-click",a=>this._doubleClickHandler(a),q.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>this._pointerDownHandler(a),q.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>this._pointerMoveHandler(a),q.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>this._pointerUpHandler(a),q.ViewEventPriorities.TOOL),this.view.on("drag",a=>this._dragHandler(a),q.ViewEventPriorities.TOOL),this.view.on("key-down",a=>this._keyDownHandler(a),
q.ViewEventPriorities.TOOL)])},{once:!0,initial:!0}),v.watch(()=>this.view,a=>{this._highlightHelper.removeAll();this._highlightHelper.view=a})])};e.destroy=function(){this._removeIndicators();this.view.map?.remove(this.layer);this.layer.destroy();this.reset();this._manipulators.forEach(a=>a.destroy());this._manipulators=null;this._handles=u.destroyMaybe(this._handles);this._viewHandles=u.destroyMaybe(this._viewHandles)};e.refresh=function(){this.reset();this._setup()};e.reset=function(){this._dragEvent=
this._hoverGraphic=this._activeGraphic=null;this._highlightHelper.removeAll()};e.updateGeometry=function(a,b){if(a=this.graphics[a])a.set("geometry",b),this._setUpIndicators()};e._setup=function(){this._setUpHighlights();this._setUpIndicators();this._setUpManipulators();this._syncLayerViews()};e._clickHandler=function(a){const b=this._findTargetGraphic(w.createScreenPointFromEvent(a));b&&(a=new n.GraphicClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-click",a),this.callbacks.onGraphicClick&&
this.callbacks.onGraphicClick(a))};e._doubleClickHandler=function(a){const b=this._findTargetGraphic(w.createScreenPointFromEvent(a));b&&(a=new n.GraphicDoubleClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-double-click",a),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(a))};e._pointerDownHandler=function(a){const b=this._findTargetGraphic(w.createScreenPointFromEvent(a));if(b){this._activeGraphic=b;const {x:c,y:f}=a;a=new n.GraphicPointerDownEvent(b,
this.graphics.indexOf(b),c,f,a);this.emit("graphic-pointer-down",a);this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(a)}else this._activeGraphic=null};e._pointerUpHandler=function(a){if(this._activeGraphic){const {x:b,y:c}=a,f=this.graphics.indexOf(this._activeGraphic);a=new n.GraphicPointerUpEvent(this._activeGraphic,f,b,c,a);this.emit("graphic-pointer-up",a);this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(a)}};e._pointerMoveHandler=function(a){if(!this._dragEvent){var b=
this._findTargetGraphic(w.createScreenPointFromEvent(a));if(b){const {x:f,y:d}=a;if(this._hoverGraphic){if(this._hoverGraphic===b)return;var c=this.graphics.indexOf(this._hoverGraphic);c=new n.GraphicPointerOutEvent(this.graphics[c],c,f,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",c);this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(c)}c=this.graphics.indexOf(b);a=new n.GraphicPointerOverEvent(b,c,f,d,a);this._hoverGraphic=b;this.emit("graphic-pointer-over",a);
this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(a)}else if(this._hoverGraphic){const {x:f,y:d}=a;b=this.graphics.indexOf(this._hoverGraphic);a=new n.GraphicPointerOutEvent(this.graphics[b],b,f,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",a);this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(a)}}};e._dragHandler=function(a){if(("start"===a.action||this._dragEvent)&&this._activeGraphic&&this._activeGraphic.geometry){"start"===a.action&&this._removeIndicators();
a.stopPropagation();var {action:b,x:c,y:f}=a,d=this.graphics.indexOf(this._activeGraphic),g=this._dragEvent?c-this._dragEvent.x:0,k=this._dragEvent?f-this._dragEvent.y:0,r=c-a.origin.x,t=f-a.origin.y,p="start"===b?this._activeGraphic.geometry:this._initialDragGeometry,z=D.cloneMove(p,r,t,this.view);this._activeGraphic.geometry=z;this.enableMoveAllGraphics&&this.graphics.forEach(A=>{A!==this._activeGraphic&&(A.geometry=D.cloneMove(A.geometry,g,k,this.view))});this._dragEvent=a;"start"===b?(this._initialDragGeometry=
H.clone(p),d=new n.GraphicMoveStartEvent(this._activeGraphic,this.graphics,d,c,f,g,k,r,t,a),this.emit("graphic-move-start",d),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(d),d.defaultPrevented&&this._activeGraphic.set("geometry",p)):"update"===b?(d=new n.GraphicMoveEvent(this._activeGraphic,this.graphics,d,c,f,g,k,r,t,a),this.emit("graphic-move",d),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(d),d.defaultPrevented&&(this._activeGraphic.geometry=p)):(p=new n.GraphicMoveStopEvent(this._activeGraphic,
this.graphics,d,c,f,g,k,r,t,a),this._activeGraphic=this._dragEvent=null,this._setUpIndicators(),this.emit("graphic-move-stop",p),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(p),p.defaultPrevented&&(this.graphics[d].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null)}};e._keyDownHandler=function(a){"a"!==a.key&&"d"!==a.key&&"n"!==a.key||"moving"!==this.state||a.stopPropagation()};e._findTargetGraphic=function(a){const b=this.view.toMap(a);
let c=null,f=Number.MAX_VALUE;this._syncLayerViews();const d=this._layerViews.flatMap(g=>"graphicsViews"in g?Array.from(g.graphicsViews(),k=>k.hitTest(b)).flat():g.graphicsView.hitTest(b)).filter(g=>this.graphics.includes(g));if(d.length)return d[0];this._manipulators.forEach(g=>{const k=g.intersectionDistance(a);u.isSome(k)&&k<f&&(f=k,c=g.graphic)});return c};e._syncLayerViews=function(){this._layerViews=[];const a=new Set;for(const b of this.graphics){const c=E.findLayerView(this.view,b.layer);
c&&a.add(c)}this._layerViews=[...a]};e._setUpManipulators=function(){const {graphics:a,view:b}=this;this._manipulators.forEach(c=>c.destroy());this._manipulators=a?.length?a.map(c=>new L.GraphicManipulator({graphic:c,view:b})):[]};e._setUpHighlights=function(){this.highlightsEnabled&&this._highlightHelper.add(this.graphics)};e._setUpIndicators=function(){this._removeIndicators();if(this.indicatorsEnabled){for(const a of this.graphics){const b=a.clone();b.symbol=this._getSymbolForIndicator(a);this._indicators.push(b);
this._handles.add(v.watch(()=>a.symbol,()=>this._setUpIndicators()),"indicator-symbols")}this.layer.addMany(this._indicators)}};e._removeIndicators=function(){this._handles.remove("indicator-symbols");this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach(a=>a.destroy()),this._indicators=[])};e._getSymbolForIndicator=function(a){if(u.isNone(a.symbol))return null;switch(a.symbol.type){case "cim":return new x({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,
127,0,1],width:1}});case "picture-marker":const {xoffset:b,yoffset:c,height:f,width:d}=a.symbol;return new x({xoffset:b,yoffset:c,size:f===d?d:Math.max(f,d),style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case "simple-marker":const {xoffset:g,yoffset:k,size:r,style:t}=a.symbol;return new x({xoffset:g,yoffset:k,style:"circle"===t?"circle":"square",size:r+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case "simple-fill":return new N({color:[0,0,0,0],outline:{style:"dash",
color:[255,127,0,1],width:1}});case "simple-line":return new M({color:[255,127,0,1],style:"dash",width:1});case "text":const {xoffset:p,yoffset:z}=a.symbol;return new x({xoffset:p,yoffset:z,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});default:return null}};B._createClass(y,[{key:"highlightsEnabled",set:function(a){this._highlightHelper?.removeAll();this._set("highlightsEnabled",a);a&&this._highlightHelper?.add(this.graphics)}},{key:"state",get:function(){const a=!!this.get("view.ready"),
b=!!this.get("graphics.length"),c=this._activeGraphic;return a&&b?c?"moving":"active":a?"ready":"disabled"}}]);return y}(G.EventedAccessor);l.__decorate([m.property()],h.prototype,"_activeGraphic",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"type",void 0);l.__decorate([m.property()],h.prototype,"callbacks",void 0);l.__decorate([m.property()],h.prototype,"enableMoveAllGraphics",void 0);l.__decorate([m.property()],h.prototype,"graphics",void 0);l.__decorate([m.property({value:!1})],
h.prototype,"highlightsEnabled",null);l.__decorate([m.property()],h.prototype,"indicatorsEnabled",void 0);l.__decorate([m.property()],h.prototype,"layer",void 0);l.__decorate([m.property({readOnly:!0})],h.prototype,"state",null);l.__decorate([m.property()],h.prototype,"view",void 0);return h=l.__decorate([I.subclass("esri.views.draw.support.GraphicMover")],h)});