// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/BitmapContainer ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./support/ExportStrategy ../../layers/LayerView ../../layers/MapImageLayerView ../../layers/RefreshableLayerView ../../support/drapedUtils".split(" "),
function(k,g,p,q,r,t,l,m,e,F,u,v,w,x,y,z,A,B,C,D){e=function(n){function h(){return n.apply(this,arguments)||this}k._inheritsLoose(h,n);var c=h.prototype;c.update=function(a){this.strategy.update(a).catch(b=>{t.isAbortError(b)||r.getLogger(this.declaredClass).error(b)});a.stationary&&this.updateHighlightedFeatures(a.state.resolution);this._highlightView.processUpdate(a)};c.attach=function(){const {imageMaxWidth:a,imageMaxHeight:b,version:d}=this.layer,f=10.3<=d,E=10<=d;this._bitmapContainer=new v.BitmapContainer;
this.container.addChild(this._bitmapContainer);this._highlightView=new x({view:this.view,graphics:this.highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new y(this.view.featuresTilingScheme)});this.container.addChild(this._highlightView.container);this.strategy=new z({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:a,imageMaxHeight:b,imageRotationSupported:f,imageNormalizationSupported:E,
hidpi:!0});this.handles.add(l.watch(()=>this.exportImageVersion,()=>this.requestUpdate()),"exportImageVersion");this.handles.add(l.watch(()=>this.view?.floors,()=>this.requestUpdate()),"view.floors");this.requestUpdate()};c.detach=function(){this.handles.remove("exportImageVersion");this.handles.remove("view.floors");this.strategy.destroy();this.container.removeAllChildren();this._bitmapContainer.removeAllChildren();this._highlightView.destroy()};c.moveStart=function(){};c.viewChange=function(){};
c.moveEnd=function(){this.requestUpdate()};c.highlight=function(a){let b=null;a instanceof p?b=[a]:q.isCollection(a)&&0<a.length?b=a.toArray():Array.isArray(a)&&0<a.length&&(b=a);b=b?.filter(Boolean);if(!b||!b.length)return{remove:()=>{}};for(const d of b)"geometryType"in d.sourceLayer&&"point"===d.sourceLayer.geometryType&&(d.visible=!1);this.highlightGraphics.addMany(b);return{remove:()=>{this.highlightGraphics.removeMany(b)}}};c.supportsSpatialReference=function(a){return this.layer.serviceSupportsSpatialReference(a)};
c.createFetchPopupFeaturesQueryGeometry=function(a,b){return D.createQueryGeometry(a,b,this.view)};c.doRefresh=function(){var a=k._asyncToGenerator(function*(){this.requestUpdate()});return function(){return a.apply(this,arguments)}}();c.isUpdating=function(){return this.strategy.updating||this.updateRequested};c.highlightGraphicUpdated=function(a,b){this._highlightView.graphicUpdateHandler({graphic:a,property:b})};c.fetchImage=function(a,b,d,f){return this.layer.fetchImage(a,b,d,{timeExtent:this.timeExtent,
floors:this.view.floors,...f})};c.fetchImageBitmap=function(a,b,d,f){return this.layer.fetchImageBitmap(a,b,d,{timeExtent:this.timeExtent,floors:this.view.floors,...f})};return h}(B(C(w.LayerView2DMixin(A))));g.__decorate([m.property()],e.prototype,"strategy",void 0);g.__decorate([m.property()],e.prototype,"updating",void 0);return e=g.__decorate([u.subclass("esri.views.2d.layers.MapImageLayerView2D")],e)});