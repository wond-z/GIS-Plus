// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/HandleOwner ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(x,D,G,I,m,y,q,
E,r,F,P,H,R){I=function(Z){function T(){var f=Z.apply(this,arguments)||this;f._loadImagery=(l,C,v,A,L)=>P.loadImagery(f.layer,l,C,v,A,L);f._createFlowMesh=(l,C,v,A)=>f.layer.createFlowMesh({meshType:l,flowData:v,simulationSettings:C},{signal:A});f.attached=!1;f.container=null;f.layer=null;f.type="flow";f.timeExtent=null;f.redrawOrRefetch=x._asyncToGenerator(function*(){f._updateVisualization()});return f}x._inheritsLoose(T,Z);var O=T.prototype;O.attach=function(){const {layer:f}=this,l=()=>{this._loadImagery=
(C,v,A,L,J)=>P.loadImagery(f,C,v,A,L,J);this._updateVisualization()};"multidimensionalDefinition"in f?this.handles.add(m.watch(()=>f.multidimensionalDefinition,l)):this.handles.add([m.watch(()=>f.mosaicRule,l),m.watch(()=>f.renderingRule,l),m.watch(()=>f.definitionExpression,l)]);this.container=new H;this._strategy=new R({flowContainer:this.container});this._updateVisualization()};O.detach=function(){this._strategy.destroy();this.container.removeAllChildren();this.container=null;this.handles.removeAll()};
O.update=function(f){f.stationary?this._strategy.update(f):this.layerView.requestUpdate()};O.hitTest=function(f){return new G({attributes:{},geometry:f.clone(),layer:this.layer})};O.moveEnd=function(){};O.doRefresh=function(){var f=x._asyncToGenerator(function*(){});return function(){return f.apply(this,arguments)}}();O._updateVisualization=function(){var {renderer:f}=this.layer;"flow"===f.type&&(f=F(f,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),
this.container.flowStyle=f,this.layerView.requestUpdate())};x._createClass(T,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return T}(I.HandleOwner);D.__decorate([y.property()],I.prototype,"_strategy",void 0);D.__decorate([y.property()],I.prototype,"attached",void 0);D.__decorate([y.property()],I.prototype,"container",void 0);D.__decorate([y.property()],I.prototype,"layer",void 0);D.__decorate([y.property()],I.prototype,"layerView",void 0);D.__decorate([y.property()],
I.prototype,"type",void 0);D.__decorate([y.property()],I.prototype,"updating",null);D.__decorate([y.property()],I.prototype,"timeExtent",void 0);return I=D.__decorate([r.subclass("esri.views.2d.engine.flow.FlowView2D")],I)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define("../../../../core/maybe ./utils ./styles/Imagery ./styles/Particles ./styles/Stack ./styles/Streamlines".split(" "),function(x,D,G,I,m,y){return function(q,E){const {flowSpeed:r,trailLength:F}=q,P=D.getFlowSimulationSettings(q);
let H=null;const R={opacity:D.getOpacity(q),size:D.getSize(q)};let Z=D.getColor(q);"none"===q.background?R.color=Z:("constant"===Z.kind&&(Z={kind:"ramp",stops:[0,1],values:[0,0,0,1,Z.value[0],Z.value[1],Z.value[2],Z.value[3]],count:2}),H=new G.Imagery({loadImagery:E.loadImagery,timeExtent:E.timeExtent,color:Z,opacity:{kind:"constant",value:[1]}}),R.color=D.getForegroundColor());E={loadImagery:E.loadImagery,createFlowMesh:E.createFlowMesh,simulationSettings:P,timeExtent:E.timeExtent,trailLength:F,
flowSpeed:r,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:R.color,opacity:R.opacity,size:R.size};q="butt"===q.trailCap||4>=D.getMax(D.getSize(q))?new y(E):new I.Particles(E);return x.isSome(H)?new m.Stack([H,q]):q}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/maybe","../../../../core/screenUtils"],function(x,D,G){function I(r){return"constant"===r.kind?r.value[0]:r.values[r.values.length-1]}function m(r){r=r.toRgba();return[r[0]/
255,r[1]/255,r[2]/255,r[3]]}function y(r){if(!r.hasVisualVariables("size"))return{kind:"constant",value:[G.pt2px(r.trailWidth)]};const F=r.getVisualVariablesForType("size")[0];r=[];const P=[];if(F.stops){for(H of F.stops)r.push(H.value),P.push(G.pt2px(H.size));var H=F.stops.length}else r.push(F.minDataValue,F.maxDataValue),P.push(G.pt2px(F.minSize),G.pt2px(F.maxSize)),H=2;return{kind:"ramp",stops:r,values:P,count:H}}function q(r,F,P,H){switch(F){case "int":r.setUniform1iv(P,H);break;case "float":r.setUniform1fv(P,
H);break;case "vec2":r.setUniform2fv(P,H);break;case "vec3":r.setUniform3fv(P,H);break;case "vec4":r.setUniform4fv(P,H)}}function E(r,F){return r===F?!0:D.isSome(r)&&D.isSome(F)?r.equals(F):!1}x.areStreamlinesCompatible=function(r,F){var P=r.simulationSettings,H=F.simulationSettings;let R;R=(R=(R=(R=(R=(R=(R=(R=(R=(R=(R=P.collisions===H.collisions)&&P.density===H.density)&&P.interpolate===H.interpolate)&&P.lineCollisionWidth===H.lineCollisionWidth)&&P.lineSpacing===H.lineSpacing)&&P.maxTurnAngle===
H.maxTurnAngle)&&P.minSpeedThreshold===H.minSpeedThreshold)&&P.segmentLength===H.segmentLength)&&P.smoothing===H.smoothing)&&P.velocityScale===H.velocityScale)&&P.verticesPerLine===H.verticesPerLine;return R&&E(r.timeExtent,F.timeExtent)?P=(P=(P=(P=(P=r.loadImagery===F.loadImagery)&&r.createFlowMesh===F.createFlowMesh)&&r.color.kind===F.color.kind)&&r.opacity.kind===F.opacity.kind)&&r.size.kind===F.size.kind:!1};x.getColor=function(r){if(!r.hasVisualVariables("color"))return{kind:"constant",value:m(r.color)};
r=r.getVisualVariablesForType("color")[0];const F=[],P=[];for(const H of r.stops)F.push(H.value),Array.prototype.push.apply(P,m(H.color));return{kind:"ramp",stops:F,values:P,count:r.stops.length}};x.getFlowSimulationSettings=function(r){var F=y(r);F=I(F);const P=Math.max(F/2,5),H=Math.round(G.pt2px(r.maxPathLength)/P)+1,{density:R}=r;return{smoothing:G.pt2px(r.smoothing),interpolate:!0,velocityScale:"flow-from"===r.flowRepresentation?1:-1,verticesPerLine:H,minSpeedThreshold:.001,segmentLength:P,maxTurnAngle:1,
collisions:!0,lineCollisionWidth:F,lineSpacing:10,density:R}};x.getForegroundColor=function(r){return{kind:"constant",value:[.1,.1,.1,1]}};x.getMax=I;x.getOpacity=function(r){if(!r.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};r=r.getVisualVariablesForType("opacity")[0];const F=[],P=[];for(const H of r.stops)F.push(H.value),P.push(H.opacity);return{kind:"ramp",stops:F,values:P,count:r.stops.length}};x.getSize=y;x.setUniform=q;x.setUniforms=function(r,F,P,H){"constant"===H.kind?q(r,
P,`u_${F}`,H.value):(q(r,"float",`u_${F}_stops`,H.stops),q(r,P,`u_${F}_values`,H.values),r.setUniform1i(`u_${F}_count`,H.count))};x.timeExtentsEqual=E;x.toRgba=m;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(x,D,G,I,m,y,q,E,r){let F=function(){function T(f){this._params=f;this.animated=!1}var O=T.prototype;O.isCompatible=function(f){if(!(f instanceof T&&I.timeExtentsEqual(this._params.timeExtent,f._params.timeExtent)))return!1;let l;return l=(l=(l=this._params.loadImagery===f._params.loadImagery)&&this._params.color.kind===f._params.color.kind)&&this._params.opacity.kind===f._params.opacity.kind};O.load=function(){var f=D._asyncToGenerator(function*(l,C){const {extent:v,size:A}=l;G.throwIfAborted(C);
l=yield this._params.loadImagery(v,A[0],A[1],this._params.timeExtent,C);return new Z(l,{color:this._params.color,opacity:this._params.opacity})});return function(l,C){return f.apply(this,arguments)}}();O.render=function(f,l,C){({context:f}=f);const {program:v}=C;f.setFaceCullingEnabled(!1);f.setBlendingEnabled(!0);f.setBlendFunction(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);f.useProgram(v);v.setUniformMatrix3fv("u_dvsMat3",l.dvsMat3);f.bindTexture(C.texture,0);v.setUniform1i("u_texture",
0);v.setUniform1f("u_Min",C.min);v.setUniform1f("u_Max",C.max);I.setUniforms(v,"color","vec4",this._params.color);I.setUniforms(v,"opacity","float",this._params.opacity);f.bindVAO(C.vertexArray);f.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4)};return T}();const P=new Map;P.set("a_position",0);P.set("a_texcoord",1);const H={geometry:[new r.VertexElementDescriptor("a_position",2,y.DataType.UNSIGNED_SHORT,0,8),new r.VertexElementDescriptor("a_texcoord",2,y.DataType.UNSIGNED_SHORT,4,8)]},R={vsPath:"raster/flow/imagery",
fsPath:"raster/flow/imagery",attributes:P};let Z=function(){function T(f,l){this._flowData=f;this._values=l}var O=T.prototype;O.attach=function(f){var {context:l}=f;const {width:C,height:v}=this._flowData;var A={geometry:m.BufferObject.createVertex(l,y.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,C,0,1,1,0,v,0,0,C,v,1,0]))};A=new E.VertexArrayObject(l,P,H,A);var L=[];"ramp"===this._values.color.kind&&L.push("vvColor");"ramp"===this._values.opacity.kind&&L.push("vvOpacity");f=f.painter.materialManager.getProgram(R,
L);L=1E6;let J=-1E6;for(var N=0;N<v;N++)for(var b=0;b<C;b++)if(0!==this._flowData.mask[N*C+b]){var e=this._flowData.data[2*(N*C+b)],g=this._flowData.data[2*(N*C+b)+1];e=Math.sqrt(e*e+g*g);L=Math.min(L,e);J=Math.max(J,e)}N=new Uint8Array(4*C*v);for(b=0;b<v;b++)for(e=0;e<C;e++)if(0!==this._flowData.mask[b*C+e]){g=this._flowData.data[2*(b*C+e)];const d=this._flowData.data[2*(b*C+e)+1];N[4*(b*C+e)]=(Math.sqrt(g*g+d*d)-L)/(J-L)*255;N[4*(b*C+e)+1]=0;N[4*(b*C+e)+2]=0;N[4*(b*C+e)+3]=255}else N[4*(b*C+e)]=
0,N[4*(b*C+e)+1]=0,N[4*(b*C+e)+2]=0,N[4*(b*C+e)+3]=0;l=new q.Texture(l,{pixelFormat:y.PixelFormat.RGBA,internalFormat:y.PixelFormat.RGBA,samplingMode:y.TextureSamplingMode.LINEAR,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:C,height:v},N);this.vertexArray=A;this.program=f;this.texture=l;this.min=L;this.max=J;this._flowData=null};O.detach=function(){this.vertexArray.dispose();this.texture.dispose()};D._createClass(T,[{key:"ready",get:function(){return this.program.isCompiled}}]);
return T}();x.Imagery=F;x.ImageryResources=Z;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(x,D,G,I,m,y,q,E){let r=function(){function Z(O){this._params=
O}var T=Z.prototype;T.isCompatible=function(O){return O instanceof Z?I.areStreamlinesCompatible(this._params,O._params):!1};T.load=function(){var O=D._asyncToGenerator(function*(f,l){const {extent:C,size:v}=f;G.throwIfAborted(l);f=yield this._params.loadImagery(C,v[0],v[1],this._params.timeExtent,l);const {vertexData:A,indexData:L}=yield this._params.createFlowMesh("Particles",this._params.simulationSettings,f,l);return new R(A,L,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});
return function(f,l){return O.apply(this,arguments)}}();T.render=function(O,f,l){({context:O}=O);const {program:C}=l;O.setFaceCullingEnabled(!1);O.setBlendingEnabled(!0);O.setBlendFunction(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);O.useProgram(C);C.setUniform1f("u_time",f.time);C.setUniform1f("u_trailLength",this._params.trailLength);C.setUniform1f("u_flowSpeed",this._params.flowSpeed);C.setUniform1f("u_featheringSize",this._params.featheringSize);C.setUniform1f("u_featheringOffset",this._params.featheringOffset);
C.setUniform1f("u_introFade",this._params.introFade?1:0);C.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);C.setUniform1f("u_decayRate",this._params.decayRate);C.setUniformMatrix3fv("u_dvsMat3",f.dvsMat3);C.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3);I.setUniforms(C,"color","vec4",this._params.color);I.setUniforms(C,"opacity","float",this._params.opacity);I.setUniforms(C,"size","float",this._params.size);O.bindVAO(l.vertexArray);O.drawElements(y.PrimitiveType.TRIANGLES,l.indexCount,
y.DataType.UNSIGNED_INT,0)};D._createClass(Z,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return Z}();const F=new Map;F.set("a_xyts0",0);F.set("a_xyts1",1);F.set("a_typeIdDurationSeed",2);F.set("a_extrudeInfo",3);const P={geometry:[new E.VertexElementDescriptor("a_xyts0",4,y.DataType.FLOAT,0,64),new E.VertexElementDescriptor("a_xyts1",4,y.DataType.FLOAT,16,64),new E.VertexElementDescriptor("a_typeIdDurationSeed",4,y.DataType.FLOAT,32,64),new E.VertexElementDescriptor("a_extrudeInfo",
4,y.DataType.FLOAT,48,64)]},H={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:F};let R=function(){function Z(O,f,l){this._vertexData=O;this._indexData=f;this._values=l}var T=Z.prototype;T.attach=function(O){var {context:f}=O,l=m.BufferObject.createVertex(f,y.Usage.STATIC_DRAW,this._vertexData);const C=m.BufferObject.createIndex(f,y.Usage.STATIC_DRAW,this._indexData);f=new q.VertexArrayObject(f,F,P,{geometry:l},C);l=[];"ramp"===this._values.color.kind&&l.push("vvColor");"ramp"===
this._values.opacity.kind&&l.push("vvOpacity");"ramp"===this._values.size.kind&&l.push("vvSize");O=O.painter.materialManager.getProgram(H,l);this.vertexArray=f;this.program=O;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};T.detach=function(){this.vertexArray.dispose()};D._createClass(Z,[{key:"ready",get:function(){return this.program.isCompiled}}]);return Z}();x.Particles=r;x.ParticlesResources=R;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(x,D){let G=function(){function m(q){this._styles=q}var y=m.prototype;y.isCompatible=function(q){if(!(q instanceof m)||this._styles.length!==q._styles.length)return!1;const E=this._styles.length;for(let r=0;r<E;r++)if(!this._styles[r].isCompatible(q._styles[r]))return!1;return!0};y.load=function(){var q=D._asyncToGenerator(function*(E,r){const F=yield Promise.all(this._styles.map(P=>
P.load(E,r)));return new I(F)});return function(E,r){return q.apply(this,arguments)}}();y.render=function(q,E,r){for(let F=0;F<this._styles.length;F++)this._styles[F].render(q,E,r.resources[F])};D._createClass(m,[{key:"animated",get:function(){return this._styles.reduce((q,E)=>q||E.animated,!1)}}]);return m}(),I=function(){function m(q){this.resources=q}var y=m.prototype;y.attach=function(q){for(const E of this.resources)E.attach(q)};y.detach=function(){for(const q of this.resources)q.detach()};D._createClass(m,
[{key:"ready",get:function(){return this.resources.reduce((q,E)=>q&&E.ready,!0)}}]);return m}();x.Stack=G;x.StackResources=I;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(x,D,G,I,m,y,q){let E=function(){function R(T){this._params=T}var Z=R.prototype;Z.isCompatible=function(T){return T instanceof R?G.areStreamlinesCompatible(this._params,T._params):!1};Z.load=function(){var T=x._asyncToGenerator(function*(O,f){const {extent:l,size:C}=O;D.throwIfAborted(f);O=yield this._params.loadImagery(l,C[0],C[1],this._params.timeExtent,f);const {vertexData:v,indexData:A}=yield this._params.createFlowMesh("Streamlines",this._params.simulationSettings,O,f);return new H(v,
A,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});return function(O,f){return T.apply(this,arguments)}}();Z.render=function(T,O,f){({context:T}=T);const {program:l}=f;T.setFaceCullingEnabled(!1);T.setBlendingEnabled(!0);T.setBlendFunction(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA);T.useProgram(l);l.setUniform1f("u_time",O.time);l.setUniform1f("u_trailLength",this._params.trailLength);l.setUniform1f("u_flowSpeed",this._params.flowSpeed);l.setUniform1f("u_featheringSize",
this._params.featheringSize);l.setUniform1f("u_featheringOffset",this._params.featheringOffset);l.setUniform1f("u_introFade",this._params.introFade?1:0);l.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);l.setUniform1f("u_decayRate",this._params.decayRate);l.setUniformMatrix3fv("u_dvsMat3",O.dvsMat3);l.setUniformMatrix3fv("u_displayViewMat3",O.displayViewMat3);G.setUniforms(l,"color","vec4",this._params.color);G.setUniforms(l,"opacity","float",this._params.opacity);G.setUniforms(l,"size",
"float",this._params.size);T.bindVAO(f.vertexArray);T.drawElements(m.PrimitiveType.TRIANGLES,f.indexCount,m.DataType.UNSIGNED_INT,0)};x._createClass(R,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return R}();const r=new Map;r.set("a_positionAndSide",0);r.set("a_timeInfo",1);r.set("a_extrude",2);r.set("a_speed",3);const F={geometry:[new q.VertexElementDescriptor("a_positionAndSide",3,m.DataType.FLOAT,0,36),new q.VertexElementDescriptor("a_timeInfo",3,m.DataType.FLOAT,12,36),
new q.VertexElementDescriptor("a_extrude",2,m.DataType.FLOAT,24,36),new q.VertexElementDescriptor("a_speed",1,m.DataType.FLOAT,32,36)]},P={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:r};let H=function(){function R(T,O,f){this._vertexData=T;this._indexData=O;this._values=f}var Z=R.prototype;Z.attach=function(T){var {context:O}=T,f=I.BufferObject.createVertex(O,m.Usage.STATIC_DRAW,this._vertexData);const l=I.BufferObject.createIndex(O,m.Usage.STATIC_DRAW,this._indexData);
O=new y.VertexArrayObject(O,r,F,{geometry:f},l);f=[];"ramp"===this._values.color.kind&&f.push("vvColor");"ramp"===this._values.opacity.kind&&f.push("vvOpacity");"ramp"===this._values.size.kind&&f.push("vvSize");T=T.painter.materialManager.getProgram(P,f);this.vertexArray=O;this.program=T;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};Z.detach=function(){this.vertexArray.dispose()};x._createClass(R,[{key:"ready",get:function(){return this.program.isCompiled}}]);return R}();
return E})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(x,D,G,I,m,y,q,E,r,F,P){function H(){H=D._asyncToGenerator(function*(b,e,g,d){const p=performance.now();var w=
R(e,g);const U=performance.now();g=T(e,w,g.width,g.height);e=performance.now();w=f(g,!0);g=performance.now();b="Streamlines"===b?l(w,10):C(w);w=performance.now();I("esri-2d-profiler")&&(N.info("I.1","_createFlowFieldFromData (ms)",Math.round(U-p)),N.info("I.2","_getStreamlines (ms)",Math.round(e-U)),N.info("I.3","createAnimatedLinesData (ms)",Math.round(g-e)),N.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(w-g)),N.info("I.5","createFlowMesh (ms)",Math.round(w-p)),N.info("I.6","Mesh size (bytes)",
b.vertexData.buffer.byteLength+b.indexData.buffer.byteLength));yield Promise.resolve();E.throwIfAborted(d);return b});return H.apply(this,arguments)}function R(b,e){const g=O(e.data,e.width,e.height,b.smoothing);return b.interpolate?(d,p)=>{const w=Math.floor(d),U=Math.floor(p);if(0>w||w>=e.width||0>U||U>=e.height)return[0,0];d-=w;p-=U;const K=w<e.width-1?w+1:w,Q=U<e.height-1?U+1:U;return[(g[2*(U*e.width+w)]*(1-p)+g[2*(Q*e.width+w)]*p)*(1-d)+(g[2*(U*e.width+K)]*(1-p)+g[2*(Q*e.width+K)]*p)*d,(g[2*
(U*e.width+w)+1]*(1-p)+g[2*(Q*e.width+w)+1]*p)*(1-d)+(g[2*(U*e.width+K)+1]*(1-p)+g[2*(Q*e.width+K)+1]*p)*d]}:(d,p)=>{d=Math.round(d);p=Math.round(p);return 0>d||d>=e.width||0>p||p>=e.height?[0,0]:[g[2*(p*e.width+d)],g[2*(p*e.width+d)+1]]}}function Z(b,e,g,d,p,w,U,K,Q){const S=[];let M=0,[X,Y]=e(g,d);X*=b.velocityScale;Y*=b.velocityScale;S.push({x:g,y:d,t:M,speed:Math.sqrt(X*X+Y*Y)});for(let ha=0;ha<b.verticesPerLine;ha++){let [fa,a]=e(g,d);fa*=b.velocityScale;a*=b.velocityScale;const c=Math.sqrt(fa*
fa+a*a);if(c<b.minSpeedThreshold)break;const h=fa/c,n=a/c;g+=h*b.segmentLength;d+=n*b.segmentLength;M+=b.segmentLength/c;if(Math.acos(h*ia+n*ea)>b.maxTurnAngle)break;if(b.collisions){var ia=Math.round(g*Q);var ea=Math.round(d*Q);if(0>ia||ia>U-1||0>ea||ea>K-1)break;const t=w[ea*U+ia];if(-1!==t&&t!==p)break;w[ea*U+ia]=p}S.push({x:g,y:d,t:M,speed:c});ia=h;ea=n}return S}function T(b,e,g,d){const p=[],w=new r,U=1/Math.max(b.lineCollisionWidth,1),K=Math.round(g*U),Q=Math.round(d*U),S=new Int32Array(K*Q);
for(var M=0;M<S.length;M++)S[M]=-1;M=[];for(let X=0;X<d;X+=b.lineSpacing)for(let Y=0;Y<g;Y+=b.lineSpacing)M.push({x:Y,y:X,sort:w.getFloat()});M.sort((X,Y)=>X.sort-Y.sort);for(const {x:X,y:Y}of M)w.getFloat()<b.density&&(g=Z(b,e,X,Y,p.length,S,K,Q,U),2>g.length||p.push(g));return p}function O(b,e,g,d){if(0===d)return b;const p=Math.round(3*d),w=Array(2*p+1);var U=0;for(var K=-p;K<=p;K++){var Q=Math.exp(-K*K/(d*d));w[K+p]=Q;U+=Q}for(d=-p;d<=p;d++)w[d+p]/=U;U=new Float32Array(b.length);for(d=0;d<g;d++)for(K=
0;K<e;K++){var S=Q=0;for(var M=-p;M<=p;M++)if(!(0>K+M||K+M>=e)){var X=w[M+p];Q+=X*b[2*(d*e+(K+M))];S+=X*b[2*(d*e+(K+M))+1]}U[2*(d*e+K)]=Q;U[2*(d*e+K)+1]=S}b=new Float32Array(b.length);for(d=0;d<e;d++)for(K=0;K<g;K++){S=Q=0;for(M=-p;M<=p;M++)0>K+M||K+M>=g||(X=w[M+p],Q+=X*U[2*((K+M)*e+d)],S+=X*U[2*((K+M)*e+d)+1]);b[2*(K*e+d)]=Q;b[2*(K*e+d)+1]=S}return b}function f(b,e){const g=new r;var d=b.reduce((K,Q)=>K+Q.length,0);d=new Float32Array(4*d);const p=Array(b.length);let w=0,U=0;for(const K of b){b=w;
for(const Q of K)d[4*w]=Q.x,d[4*w+1]=Q.y,d[4*w+2]=Q.t,d[4*w+3]=Q.speed,w++;p[U++]={startVertex:b,numberOfVertices:K.length,totalTime:K[K.length-1].t,timeSeed:e?g.getFloat():0}}return{lineVertices:d,lineDescriptors:p}}function l(b,e){function g(ia,ea,ha,fa,a,c,h,n){const t=9*Q;let k=0;K[t+k++]=ia;K[t+k++]=ea;K[t+k++]=1;K[t+k++]=ha;K[t+k++]=c;K[t+k++]=h;K[t+k++]=fa/2;K[t+k++]=a/2;K[t+k++]=n;Q++;K[t+k++]=ia;K[t+k++]=ea;K[t+k++]=-1;K[t+k++]=ha;K[t+k++]=c;K[t+k++]=h;K[t+k++]=-fa/2;K[t+k++]=-a/2;K[t+k++]=
n;Q++}const {lineVertices:d,lineDescriptors:p}=b;var w=b=0;for(var U of p)b+=2*U.numberOfVertices,w+=6*(U.numberOfVertices-1);const K=new Float32Array(9*b);U=new Uint32Array(w);let Q=0;b=0;for(const ia of p){const {totalTime:ea,timeSeed:ha}=ia;let fa=w=null,a=null;var S=null,M=null,X=null;for(let c=0;c<ia.numberOfVertices;c++){S=d[4*(ia.startVertex+c)];const h=d[4*(ia.startVertex+c)+1],n=d[4*(ia.startVertex+c)+2],t=d[4*(ia.startVertex+c)+3];let k=null,z=null;var Y=null;let B=null;0<c&&(k=S-w,z=h-
fa,Y=Math.sqrt(k*k+z*z),k/=Y,z/=Y,1<c?(M=k+M,X=z+X,Y=Math.sqrt(M*M+X*X),M/=Y,X/=Y,Y=Math.min(1/(M*k+X*z),e),M*=Y,X*=Y,Y=-X,B=M):(Y=-z,B=k),null!==Y&&null!==B&&(g(w,fa,a,Y,B,ea,ha,t),U[b++]=Q-2,U[b++]=Q,U[b++]=Q-1,U[b++]=Q,U[b++]=Q+1,U[b++]=Q-1));w=S;fa=h;a=n;M=k;X=z;S=t}g(w,fa,a,-X,M,ea,ha,S)}return{vertexData:K,indexData:U}}function C(b){function e(W,V){var aa=n+k,da=t+z,ba=Math.sqrt(aa*aa+da*da);aa/=ba;da/=ba;var la=n*aa+t*da,ja=k+B,ka=z+u;ba=Math.sqrt(ja*ja+ka*ka);ja/=ba;ka/=ba;var ca=k*ja+z*ka;
ba=Y;var na=ia,pa=ea,qa=ha;da=-(da/la);aa/=la;la=fa;var ra=a,ua=c,va=h;ka=-(ka/ca);ja/=ca;ca=16*M;let oa=0;for(const wa of[1,2])for(const xa of[1,2,3,4])Q[ca+oa++]=ba,Q[ca+oa++]=na,Q[ca+oa++]=pa,Q[ca+oa++]=qa,Q[ca+oa++]=la,Q[ca+oa++]=ra,Q[ca+oa++]=ua,Q[ca+oa++]=va,Q[ca+oa++]=wa,Q[ca+oa++]=xa,Q[ca+oa++]=W,Q[ca+oa++]=V,Q[ca+oa++]=da/2,Q[ca+oa++]=aa/2,Q[ca+oa++]=ka/2,Q[ca+oa++]=ja/2,M++;S[X++]=M-8;S[X++]=M-7;S[X++]=M-6;S[X++]=M-7;S[X++]=M-5;S[X++]=M-6;S[X++]=M-4;S[X++]=M-3;S[X++]=M-2;S[X++]=M-3;S[X++]=
M-1;S[X++]=M-2}function g(W,V,aa,da,ba,la){n=k;t=z;k=B;z=u;null==n&&null==t&&(n=k,t=z);if(null!=fa&&null!=a){B=W-fa;u=V-a;const ja=Math.sqrt(B*B+u*u);B/=ja;u/=ja}null!=n&&null!=t&&e(ba,la);Y=fa;ia=a;ea=c;ha=h;fa=W;a=V;c=aa;h=da}function d(W,V){n=k;t=z;k=B;z=u;null==n&&null==t&&(n=k,t=z);null!=n&&null!=t&&e(W,V)}const {lineVertices:p,lineDescriptors:w}=b;let U=b=0;for(var K of w){const W=K.numberOfVertices-1;b+=8*W;U+=12*W}const Q=new Float32Array(16*b),S=new Uint32Array(U);let M=0,X=0,Y,ia,ea,ha,
fa,a,c,h,n,t,k,z,B,u;for(const W of w){u=B=z=k=t=n=h=c=a=fa=ha=ea=ia=Y=null;const {totalTime:V,timeSeed:aa}=W;for(K=0;K<W.numberOfVertices;K++)g(p[4*(W.startVertex+K)],p[4*(W.startVertex+K)+1],p[4*(W.startVertex+K)+2],p[4*(W.startVertex+K)+3],V,aa);d(V,aa)}return{vertexData:Q,indexData:S}}function v(b,e){const g=e.pixels,{width:d,height:p}=e,w=new Float32Array(d*p*2),U=e.mask||new Uint8Array(d*p*2);e.mask||U.fill(255);if("vector-uv"===b)for(b=0;b<d*p;b++)w[2*b]=g[0][b],w[2*b+1]=-g[1][b];else if("vector-magdir"===
b)for(b=0;b<d*p;b++){e=g[0][b];const K=y.deg2rad(g[1][b]),Q=Math.sin(K-Math.PI/2);w[2*b]=Math.cos(K-Math.PI/2)*e;w[2*b+1]=Q*e}return{data:w,mask:U,width:d,height:p}}function A(){A=D._asyncToGenerator(function*(b,e,g,d,p,w){const U=performance.now();var K=F.getInfo(e.spatialReference);if(!K)return g=yield L(b,e,g,d,p,w),I("esri-2d-profiler")&&N.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-U)),I("esri-2d-profiler")&&N.info("I.9","Number of parts",1),g;const [Q,S]=K.valid,M=
Math.ceil(e.width/(S-Q)),X=e.width/M,Y=Math.round(g/M);let ia=e.xmin;const ea=[];K=performance.now();for(let ha=0;ha<M;ha++){const fa=new P({xmin:ia,xmax:ia+X,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});ea.push(L(b,fa,Y,d,p,w));ia+=X}b=yield Promise.all(ea);I("esri-2d-profiler")&&N.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-K));I("esri-2d-profiler")&&N.info("I.9","Number of parts",b.length);d={data:new Float32Array(g*d*2),mask:new Uint8Array(g*d),width:g,
height:d};e=0;for(const ha of b){for(b=0;b<ha.height;b++)for(p=0;p<ha.width;p++)e+p>=g||(d.data[2*(b*g+e+p)]=ha.data[2*(b*ha.width+p)],d.data[2*(b*g+e+p)+1]=ha.data[2*(b*ha.width+p)+1],d.mask[b*g+e+p]=ha.mask[b*ha.width+p]);e+=ha.width}I("esri-2d-profiler")&&N.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-U));return d});return A.apply(this,arguments)}function L(b,e,g,d,p,w){return J.apply(this,arguments)}function J(){J=D._asyncToGenerator(function*(b,e,g,d,p,w){const U=
{requestProjectedLocalDirections:!0,signal:w};q.isSome(p)&&(U.timeExtent=p);if("imagery"===b.type)return yield b.load({signal:w}),p=b.rasterInfo.dataType,b=yield b.fetchImage(e,g,d,U),!b||q.isNone(b.pixelData)||q.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(g*d*2),mask:new Uint8Array(g*d),width:g,height:d}:v(p,b.pixelData.pixelBlock);yield b.load({signal:w});p=b.rasterInfo.dataType;b=yield b.fetchPixels(e,g,d,U);return!b||q.isNone(b.pixelBlock)?{data:new Float32Array(g*d*2),mask:new Uint8Array(g*
d),width:g,height:d}:v(p,b.pixelBlock)});return J.apply(this,arguments)}const N=m.getLogger("esri.views.2d.engine.flow.dataUtils");x.createAnimatedLinesData=f;x.createFlowMesh=function(b,e,g,d){return H.apply(this,arguments)};x.createParticlesMesh=C;x.createStreamlinesMesh=l;x.loadImagery=function(b,e,g,d,p,w){return A.apply(this,arguments)};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(x,D,G,I){return function(m){function y(){var E=m.apply(this,arguments)||this;E.flowStyle=null;return E}x._inheritsLoose(y,m);var q=y.prototype;q.doRender=function(E){m.prototype.doRender.call(this,E)};q.prepareRenderPasses=function(E){const r=E.registerRenderPass({name:"flow",brushes:[D],target:()=>this.children,drawPhase:G.WGLDrawPhase.MAP});return[...m.prototype.prepareRenderPasses.call(this,E),r]};x._createClass(y,[{key:"requiresDedicatedFBO",
get:function(){return!1}}]);return y}(I)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T,O){function f(l,C){const v=new R({x:(l.xmax+l.xmin)/2,y:(l.ymax+l.ymin)/2,spatialReference:l.spatialReference});var A=l.xmax-l.xmin;const L=l.ymax-l.ymin,J=Math.abs(Math.cos(y.deg2rad(C))),N=Math.abs(Math.sin(y.deg2rad(C)));C=J*A+N*L;A=N*A+J*L;l=new O({xmin:v.x-C/2,ymin:v.y-A/2,xmax:v.x+C/2,ymax:v.y+A/2,spatialReference:l.spatialReference});l.centerAt(v);return l}G=function(l){function C(A){A=l.call(this,A)||this;A._flowDisplayObject=new T.FlowDisplayObject;
A._loading=null;return A}x._inheritsLoose(C,l);var v=C.prototype;v.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};v.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};v.update=function(A){var {flowStyle:L}=this.flowContainer;if(q.isNone(L))this._clear();else{var {extent:J,rotation:N,resolution:b,pixelRatio:e}=A.state;A=f(J,N);A.expand(1.15);L=new Z(L,A,[Math.round((A.xmax-A.xmin)/b),Math.round((A.ymax-A.ymin)/b)],e);if(q.isSome(this._loading)){if(this._loading.update(L))return;
this._loading.detach();this._loading=null}if(q.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(L))L.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},g=>{E.isAbortError(g)||(m.getLogger(this.declaredClass).error("A resource failed to load.",g),this._loading=null)}),this._loading=L}};v._clear=function(){this._flowDisplayObject.clear();q.isSome(this._loading)&&(this._loading.detach(),this._loading=
null)};x._createClass(C,[{key:"updating",get:function(){return null!=this._loading}}]);return C}(I);D.__decorate([r.property()],G.prototype,"_loading",void 0);D.__decorate([r.property()],G.prototype,"flowContainer",void 0);D.__decorate([r.property()],G.prototype,"updating",null);return G=D.__decorate([H.subclass("esri.views.2d.engine.flow.FlowStrategy")],G)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(x,
D){return function(){function G(m,y,q,E){this.state={name:"created"};this.flowStyle=m;this.extent=y;this.size=q;this.pixelRatio=E}var I=G.prototype;I.load=function(){var m=x._asyncToGenerator(function*(){const y=new AbortController;this.state={name:"loading",abortController:y};this.state={name:"loaded",resources:yield this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},y.signal)}});return function(){return m.apply(this,arguments)}}();I.attach=function(m){if("loaded"!==
this.state.name)D.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var y=this.state.resources;y.attach(m);this.state={name:"attached",resources:y}}};I.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};I.update=function(m){if(!this.flowStyle.isCompatible(m.flowStyle)||!this.extent.equals(m.extent)||
this.size[0]!==m.size[0]||this.size[1]!==m.size[1]||this.pixelRatio!==m.pixelRatio)return!1;this.flowStyle=m.flowStyle;return!0};return G}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(x,D,G,I,m,y,q){q=function(E){function r(){var P=E.apply(this,arguments)||this;P._displayData=null;return P}
D._inheritsLoose(r,E);var F=r.prototype;F.clear=function(){I.isSome(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())};F.setTransform=function(P){var {displayData:H}=this;if(!I.isNone(H)){var R=[0,0];P.toScreen(R,[H.extent.xmin,H.extent.ymax]);H=(H.extent.xmax-H.extent.xmin)/H.size[0]/P.resolution;var Z=G.deg2rad(P.rotation),{dvs:T}=this.transforms;m.fromTranslation(T,[-1,1,0]);m.scale(T,T,[2/(P.size[0]*P.pixelRatio),-2/(P.size[1]*P.pixelRatio),1]);m.translate(T,
T,[R[0],R[1],0]);m.rotate(T,T,Z);m.scale(T,T,[H*P.pixelRatio,H*P.pixelRatio,1])}};F._createTransforms=function(){return{dvs:y.create()}};D._createClass(r,[{key:"displayData",get:function(){return this._displayData},set:function(P){this._displayData=P;this.requestRender()}}]);return r}(q.DisplayObject);x.FlowDisplayObject=q;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T){const O=I.ofType({key:"type",base:null,typeMap:{rect:R,path:T,geometry:Z}});x.LayerView2DMixin=f=>{f=function(l){function C(){var A=l.apply(this,arguments)||this;A.attached=!1;A.clips=new O;A.lastUpdateId=-1;A.moving=!1;A.updateRequested=!1;A.visibleAtCurrentScale=!1;return A}D._inheritsLoose(C,l);var v=C.prototype;v.initialize=function(){const A=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&A&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new y("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new H.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.handles.add([q.watch(()=>this.suspended,L=>{this.container&&(this.container.visible=!L);this.view&&!L&&this.updateRequested&&this.view.requestUpdate()},q.syncAndInitial),q.watch(()=>this.layer?.opacity??1,L=>{this.container&&(this.container.opacity=
L)},q.syncAndInitial),q.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",L=>{this.container&&(this.container.blendMode=L)},q.syncAndInitial),q.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,L=>{this.container&&(this.container.effect=L)},q.syncAndInitial),q.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},q.syncAndInitial),q.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?
this.layer.effectiveScaleRange:null}),({scale:L})=>{L=L&&this.isVisibleAtScale(L);L!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",L)},q.syncAndInitial)]),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(L=>{L===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};v.destroy=function(){this.processDetach();this.updateRequested=!1};v.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&
(this.attach(),this.attached=!0,this.requestUpdate())};v.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)};v.isVisibleAtScale=function(A){const L=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!L)return!0;const {minScale:J,maxScale:N}=L;return(0===J||A<=J)&&(0===N||A>=N)};v.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};v.processUpdate=
function(A){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",A),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(A)))};v.hitTest=function(A,L){return Promise.resolve(null)};v.supportsSpatialReference=function(A){return!0};v.canResume=function(){return this.spatialReferenceSupported?l.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};v.getSuspendInfo=function(){const A=l.prototype.getSuspendInfo.call(this),L=!this.spatialReferenceSupported,
J=this.visibleAtCurrentScale;L&&(A.spatialReferenceNotSupported=L);J&&(A.outsideScaleRange=J);return A};D._createClass(C,[{key:"spatialReferenceSupported",get:function(){const A=this.view?.spatialReference;return null==A||this.supportsSpatialReference(A)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return C}(f);G.__decorate([E.property()],f.prototype,"attached",
void 0);G.__decorate([E.property({type:O,set(l){l=m.referenceSetter(l,this._get("clips"),O);this._set("clips",l)}})],f.prototype,"clips",void 0);G.__decorate([E.property()],f.prototype,"container",void 0);G.__decorate([E.property()],f.prototype,"moving",void 0);G.__decorate([E.property({readOnly:!0})],f.prototype,"spatialReferenceSupported",null);G.__decorate([E.property({readOnly:!0})],f.prototype,"updateParameters",void 0);G.__decorate([E.property()],f.prototype,"updateRequested",void 0);G.__decorate([E.property()],
f.prototype,"updating",null);G.__decorate([E.property()],f.prototype,"view",void 0);G.__decorate([E.property({readOnly:!0})],f.prototype,"visibleAtCurrentScale",void 0);return f=G.__decorate([P.subclass("esri.views.2d.layers.LayerView2D")],f)};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(x,D,G,I,m,y,q){var E;I=E=function(r){function F(H){H=r.call(this,H)||this;H.type="rect";H.left=null;H.right=null;H.top=null;H.bottom=null;return H}x._inheritsLoose(F,r);var P=F.prototype;P.clone=function(){return new E({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};P.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return F}(q);D.__decorate([G.property({type:[Number,String],
json:{write:!0}})],I.prototype,"left",void 0);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],I.prototype,"right",void 0);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],I.prototype,"top",void 0);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],I.prototype,"bottom",void 0);return I=E=D.__decorate([y.subclass("esri.views.layers.support.ClipRect")],I)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(x,D,G,I,m,y,q){G=function(E){function r(){return E.apply(this,arguments)||this}x._inheritsLoose(r,E);x._createClass(r,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return r}(G.JSONSupport);D.__decorate([I.property({readOnly:!0})],G.prototype,"version",null);return G=D.__decorate([q.subclass("esri.views.layers.support.ClipArea")],G)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H){var R;G={base:E,key:"type",typeMap:{extent:P,polygon:H}};F=R=function(Z){function T(f){f=Z.call(this,f)||this;f.type="geometry";f.geometry=null;return f}x._inheritsLoose(T,Z);var O=T.prototype;O.clone=function(){return new R({geometry:this.geometry?.clone()??null})};O.commitVersionProperties=function(){this.commitProperty("geometry")};return T}(F);D.__decorate([I.property({types:G,json:{read:r.fromJSON,write:!0}})],F.prototype,"geometry",void 0);return F=R=D.__decorate([q.subclass("esri.views.layers.support.Geometry")],
F)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(x,D,G,I,m,y,q){I=function(E){function r(F){F=E.call(this,F)||this;F.type="path";F.path=[];return F}x._inheritsLoose(r,E);r.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return r}(q);D.__decorate([G.property({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0);return I=D.__decorate([y.subclass("esri.views.layers.support.Path")],I)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P){G=function(H){function R(){return H.apply(this,arguments)||this}x._inheritsLoose(R,H);var Z=R.prototype;Z.doRender=function(T){T.drawPhase===r.WGLDrawPhase.HIGHLIGHT&&H.prototype.doRender.call(this,T)};Z.renderChildren=function(T){this.attributeView.update();if(this.children.some(f=>f.hasData)){this.attributeView.bindTextures(T.context);H.prototype.renderChildren.call(this,T);var {painter:O}=T;O=O.effects.highlight;O.bind(T);T.context.setColorMask(!0,!0,!0,!0);T.context.clear(P.ClearBufferBit.COLOR_BUFFER_BIT);
this._renderChildren(T,O.defines.concat(["highlightAll"]));O.draw(T);O.unbind()}};return R}(F);return G=D.__decorate([E.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],G)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T,O){I=function(f){function l(){var v=f.apply(this,arguments)||this;v.attached=!1;v.container=new Z.Container;v.updateRequested=!1;v.type="imagery";v._bitmapView=new R.BitmapContainer;return v}x._inheritsLoose(l,f);var C=l.prototype;C.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};C.update=function(v){this.strategy.update(v).catch(A=>{q.isAbortError(A)||m.getLogger(this.declaredClass).error(A)})};C.hitTest=function(v){return new G({attributes:{},
geometry:v.clone(),layer:this.layer})};C.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new O({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};C.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();
this.container.removeAllChildren();this.updateRequested=!1};C.redraw=function(){var v=this;this.strategy.updateExports(function(){var A=x._asyncToGenerator(function*(L){if(!(L.source instanceof HTMLImageElement)){var J=yield v.layer.applyRenderer({extent:L.source.extent,pixelBlock:L.source.originalPixelBlock??L.source.pixelBlock}),N=L.source;N.filter=b=>v.layer.pixelFilter?v.layer.applyFilter(b):{...J,extent:N.extent}}});return function(L){return A.apply(this,arguments)}}()).catch(A=>{q.isAbortError(A)||
m.getLogger(this.declaredClass).error(A)})};C.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};C.isUpdating=function(){return this.strategy.updating||this.updateRequested};C.getPixelData=function(){if(this.updating)return null;var v=this.strategy.bitmaps;if(1===v.length&&v[0].source)return{extent:v[0].source.extent,pixelBlock:v[0].source.originalPixelBlock};if(1<v.length){const A=this.view.extent;v=v.map(L=>L.source).filter(L=>L.extent&&L.extent.intersects(A)).map(L=>
({extent:L.extent,pixelBlock:L.originalPixelBlock}));v=H.mosaicPixelData(v,A);return y.isSome(v)?{extent:v.extent,pixelBlock:v.pixelBlock}:null}return null};C._fetchImage=function(v,A,L,J){J=J||{};J.timeExtent=this.timeExtent;J.requestAsImageElement=!0;return this.layer.fetchImage(v,A,L,J).then(N=>N.imageOrCanvasElement?N.imageOrCanvasElement:this.layer.applyRenderer(N.pixelData,{signal:J.signal}).then(b=>{b=new T(b.pixelBlock,b.extent.clone(),N.pixelData.pixelBlock);b.filter=e=>this.layer.applyFilter(e);
return b}))};x._createClass(l,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return l}(I);D.__decorate([E.property()],I.prototype,"attached",void 0);D.__decorate([E.property()],I.prototype,"container",void 0);D.__decorate([E.property()],I.prototype,"layer",void 0);D.__decorate([E.property()],I.prototype,"strategy",void 0);D.__decorate([E.property()],I.prototype,"timeExtent",void 0);D.__decorate([E.property()],I.prototype,"view",void 0);D.__decorate([E.property()],I.prototype,
"updateRequested",void 0);D.__decorate([E.property()],I.prototype,"updating",null);D.__decorate([E.property()],I.prototype,"type",void 0);return I=D.__decorate([P.subclass("esri.views.2d.layers.imagery.ImageryView2D")],I)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T,O){const f=F.create(),l=[0,0],C=new O(0,0,0,0);G=function(v){function A(J){var N=v.call(this,J)||this;N._imagePromise=null;N.bitmaps=[];N.hidpi=!1;N.imageMaxWidth=2048;N.imageMaxHeight=2048;N.imageRotationSupported=!1;N.imageNormalizationSupported=!1;N.update=m.debounce(function(){var b=x._asyncToGenerator(function*(e,g){m.throwIfAborted(g);if(e.stationary&&!N.destroyed){var d=e.state,p=P.getInfo(d.spatialReference);e=N.hidpi?e.pixelRatio:1;var w=N.imageNormalizationSupported&&
d.worldScreenWidth&&d.worldScreenWidth<d.size[0];w?(l[0]=d.worldScreenWidth,l[1]=d.size[1]):N.imageRotationSupported?(l[0]=d.size[0],l[1]=d.size[1]):R.getOuterSize(l,d);p=p&&(d.extent.xmin<p.valid[0]||d.extent.xmax>p.valid[1]);var U=!N.imageNormalizationSupported&&p,K=!(Math.floor(l[0]*e)>N.imageMaxWidth||Math.floor(l[1]*e)>N.imageMaxHeight)&&!U,Q=N.imageRotationSupported?d.rotation:0;p=N.container.children.slice();K?(w=w?d.paddedViewState.center:d.center,N._imagePromise&&console.error("Image promise was not defined!"),
N._imagePromise=N._singleExport(d,l,w,d.resolution,Q,e,g)):(w=Math.min(N.imageMaxWidth,N.imageMaxHeight),U&&(w=Math.min(d.worldScreenWidth,w)),N._imagePromise=N._tiledExport(d,w,e,g));try{const S=yield N._imagePromise;m.throwIfAborted(g);g=[];N._imagePromise=null;if(!N.destroyed){N.bitmaps=S??[];for(const M of p)S.includes(M)||g.push(M.fadeOut().then(()=>{M.remove();M.destroy()}));for(const M of S)g.push(M.fadeIn());yield Promise.all(g)}}catch(S){N._imagePromise=null,m.throwIfAbortError(S)}}});return function(e,
g){return b.apply(this,arguments)}}(),5E3);N.updateExports=m.debounce(function(){var b=x._asyncToGenerator(function*(e){const g=[];for(const d of N.container.children){if(!d.visible||!d.stage)return;g.push(e(d).then(()=>{d.invalidateTexture();d.requestRender()}))}N._imagePromise=m.eachAlways(g).then(()=>N._imagePromise=null);yield N._imagePromise});return function(e){return b.apply(this,arguments)}}());return N}x._inheritsLoose(A,v);var L=A.prototype;L.destroy=function(){this.bitmaps.forEach(J=>J.destroy());
this.bitmaps=[]};L._export=function(){var J=x._asyncToGenerator(function*(N,b,e,g,d,p){e=yield this.fetchSource(N,Math.floor(b*d),Math.floor(e*d),{rotation:g,pixelRatio:d,signal:p});m.throwIfAborted(p);const w=new Z.Bitmap(null,{immutable:!0,requestRenderOnSourceChangedEnabled:!0});w.x=N.xmin;w.y=N.ymax;w.resolution=N.width/b;w.rotation=g;w.pixelRatio=d;w.opacity=0;this.container.addChild(w);yield w.setSourceAsync(e,p);m.throwIfAborted(p);return w});return function(N,b,e,g,d,p){return J.apply(this,
arguments)}}();L._singleExport=function(){var J=x._asyncToGenerator(function*(N,b,e,g,d,p,w){R.getBBox(f,e,g,b);N=F.toExtent(f,N.spatialReference);return[yield this._export(N,b[0],b[1],d,p,w)]});return function(N,b,e,g,d,p,w){return J.apply(this,arguments)}}();L._tiledExport=function(J,N,b,e){var g=H.create({size:N,spatialReference:J.spatialReference,scales:[J.scale]});const d=new T(g);g=d.getTileCoverage(J);if(!g)return null;const p=[];g.forEach((w,U,K,Q)=>{C.set(w,U,K,0);d.getTileBounds(f,C);const S=
F.toExtent(f,J.spatialReference);p.push(this._export(S,N,N,0,b,e).then(M=>{0!==Q&&(C.set(w,U,K,Q),d.getTileBounds(f,C),M.x=f[0],M.y=f[3]);return M}))});return Promise.all(p)};x._createClass(A,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return A}(G);D.__decorate([y.property()],G.prototype,"_imagePromise",void 0);D.__decorate([y.property()],G.prototype,"bitmaps",void 0);D.__decorate([y.property()],G.prototype,"container",void 0);D.__decorate([y.property()],G.prototype,
"fetchSource",void 0);D.__decorate([y.property()],G.prototype,"hidpi",void 0);D.__decorate([y.property()],G.prototype,"imageMaxWidth",void 0);D.__decorate([y.property()],G.prototype,"imageMaxHeight",void 0);D.__decorate([y.property()],G.prototype,"imageRotationSupported",void 0);D.__decorate([y.property()],G.prototype,"imageNormalizationSupported",void 0);D.__decorate([y.property()],G.prototype,"requestUpdate",void 0);D.__decorate([y.property()],G.prototype,"updating",null);return G=D.__decorate([r.subclass("esri.views.2d.layers.support.ExportStrategy")],
G)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(x){const D=Math.PI/180;x.getBBox=function(G,I,m,y){const [q,E]=I,[r,F]=y;I=.5*m;G[0]=q-I*r;G[1]=E-I*F;G[2]=q+I*r;G[3]=E+I*F;return G};x.getOuterSize=function(G,I){var m=I.rotation*D;const y=Math.abs(Math.cos(m));m=Math.abs(Math.sin(m));const [q,E]=I.size;G[0]=Math.round(E*m+q*y);G[1]=Math.round(E*y+q*m);return G};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T,O){m=function(f){function l(){var v=f.apply(this,arguments)||this;v.attached=!1;v.container=new T.RasterVFContainer;v.type="imageryVF";v._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};v._fetchpixels=function(){var A=x._asyncToGenerator(function*(L,J,N,b){const e=yield v._projectFullExtentPromise,{symbolTileSize:g}=v.layer.renderer,{extent:d,width:p,height:w}=Z.snapImageToSymbolTile(L,J,N,g,e);if(y.isSome(e)&&!e.intersects(L))return{extent:d,
pixelBlock:null};L={bbox:`${d.xmin}, ${d.ymin}, ${d.xmax}, ${d.ymax}`,exportParametersVersion:v.layer.exportImageServiceParameters.version,symbolTileSize:g,time:JSON.stringify(v.timeExtent||"")};if(v._canReuseVectorFieldData(L)&&(J=v.getPixelData(),y.isSome(J)&&`${J.extent.xmin}, ${J.extent.ymin}, ${J.extent.xmax}, ${J.extent.ymax}`===L.bbox))return J;({pixelData:b}=yield v.layer.fetchImage(d,p,w,{timeExtent:v.timeExtent,requestAsImageElement:!1,signal:b}));v._dataParameters=L;if(y.isNone(b.pixelBlock))return{extent:d,
pixelBlock:null};b="vector-uv"===v.layer.rasterInfo.dataType?y.unwrap(Z.convertVectorFieldData(b.pixelBlock,"vector-uv")):b.pixelBlock;return{extent:d,pixelBlock:b}});return function(L,J,N,b){return A.apply(this,arguments)}}();return v}x._inheritsLoose(l,f);var C=l.prototype;C.attach=function(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new O({container:this.container,fetchPixels:this._fetchpixels});this.handles.add(q.watch(()=>this.layer.renderer,
v=>this._updateSymbolizerParams(v),q.syncAndInitial),"vector-field-view-update")};C.detach=function(){this._strategy.destroy();this.container.children.forEach(v=>v.destroy());this.container.removeAllChildren();this.handles.remove("vector-field-view-update");this._strategy=this.container=this._projectFullExtentPromise=null};C.getPixelData=function(){if(this.updating||!this.container.children.length)return null;const {extent:v,pixelBlock:A}=this.container.children[0].rawPixelData;return{extent:v,pixelBlock:A}};
C.hitTest=function(v){return new G({attributes:{},geometry:v.clone(),layer:this.layer})};C.update=function(v){this._strategy.update(v,this._symbolizerParams)};C.redraw=function(){this._updateSymbolizerParams(this.layer.renderer);this._strategy.redraw(this._symbolizerParams)};C._canReuseVectorFieldData=function(v){const A=this._dataParameters.time===v.time,L=this._dataParameters.symbolTileSize===v.symbolTileSize,J=this._dataParameters.bbox===v.bbox;return this._dataParameters.exportParametersVersion===
v.exportParametersVersion&&A&&L&&J};C._getProjectedFullExtent=function(){var v=x._asyncToGenerator(function*(A){try{return yield R.projectExtent(this.layer.fullExtent,A)}catch(L){try{const J=(yield I(this.layer.url,{query:{option:"footprints",outSR:A.wkid||JSON.stringify(A.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return J?H.fromJSON(J):null}catch{return null}}});return function(A){return v.apply(this,arguments)}}();C._updateSymbolizerParams=function(v){"vector-field"===
v.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))};x._createClass(l,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return l}(m.HandleOwner);D.__decorate([E.property()],m.prototype,"attached",void 0);D.__decorate([E.property()],m.prototype,"container",void 0);D.__decorate([E.property()],m.prototype,"layer",void 0);D.__decorate([E.property()],m.prototype,"timeExtent",void 0);D.__decorate([E.property()],m.prototype,"type",
void 0);D.__decorate([E.property()],m.prototype,"view",void 0);D.__decorate([E.property()],m.prototype,"updating",null);return m=D.__decorate([P.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],m)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H){function R(a,c,h){return!E.canProjectWithoutEngine(a,c,h)}function Z(a,c,h){if((a=R(a,c,h))&&!E.isLoaded())throw new I("rasterprojectionhelper-project","projection engine is not loaded");return a}function T(){T=D._asyncToGenerator(function*(){E.isLoaded()||(yield E.load())});return T.apply(this,arguments)}function O(a,c,h,n=null){const t=a.spatialReference;if(t.equals(c))return a;Z(t,c,n);h=h.center;h=new r({xmin:h.x-a.x/2,xmax:h.x+a.x/2,ymin:h.y-a.y/2,ymax:h.y+a.y/
2,spatialReference:t});n=E.project(h,c,n);h=U(c);m.isNone(n)||m.isSome(h)&&n.width>=h?(c=y.getMetersPerUnitForSR(t)/y.getMetersPerUnitForSR(c),a={x:a.x*c,y:a.y*c}):a={x:n.width,y:n.height};return a}function f(a,c=.01){return y.getMetersPerUnitForSR(a)?c/y.getMetersPerUnitForSR(a):0}function l(a,c,h=null,n=!0){const t=a.spatialReference;if(t.equals(c))return a;Z(t,c,h);h=E.project(a,c,h);if(!n||!h)return h;C([a],[h],t,c);return h}function C(a,c,h,n){const t=K(h,!0),k=K(n,!0);h=f(h,500);n=f(n,500);
if(h&&m.isSome(t)&&m.isSome(k))for(let z=0;z<a.length;z++){const B=c[z];if(!B)continue;const {x:u}=a[z],{x:W}=B;W>=k[1]-n&&Math.abs(u-t[0])<h?B.x-=k[1]-k[0]:W<=k[0]+n&&Math.abs(u-t[1])<h&&(B.x+=k[1]-k[0])}}function v(a){const {inSR:c,outSR:h,datumTransformation:n,preferPE:t}=a;if(c.equals(h))return{points:a}=b(a,null),a;if(c.isWebMercator&&h.isWGS84||c.isWGS84&&h.isWebMercator){const {cols:W,rows:V,xres:aa,yres:da,usePixelCenter:ba,inSR:la,outSR:ja}=a;let {xmin:ka,ymax:ca}=a;ba&&(ka+=aa/2,ca-=da/
2);a=[];var k=[],z=Math.max(W,V);for(var B=0;B<z;B++){var u=E.project(new F({x:ka+aa*Math.min(W,B),y:ca-da*Math.min(V,B),spatialReference:la}),ja);B<=W&&a.push(u.x);B<=V&&k.push(u.y)}z=[];for(B=0;B<W;B++)for(u=0;u<V;u++)z.push([a[B],k[u]]);return z}if(Z(c,h,n)&&t){if(c.isGeographic)return L(a);k=J(c);if(m.isSome(k))return L(a)}return A(a)}function A(a){var {points:c}=b(a,null);const {inSR:h,outSR:n,datumTransformation:t}=a;a=c.map(k=>new F(k[0],k[1],h));c=E.project(a,n,t);t&&C(a,c,h,n);return c.map(k=>
k?[k.x,k.y]:[NaN,NaN])}function L(a){const {inSR:c,outSR:h,datumTransformation:n}=a;var t=J(c);const {points:k,mask:z}=b(a,t);c.isGeographic||(a=c.wkid?q.PeFactory.coordsys(c.wkid):q.PeFactory.fromString(c.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,c.wkt),q.PeCSTransformations.projToGeog(a,k.length,k));if(m.isSome(n)&&n.steps.length){var B;h.isGeographic&&(B=k.map(([u])=>179.9955<u?1:-179.9955>u?-1:0));n.steps.forEach(u=>{const W=u.wkid?q.PeFactory.geogtran(u.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_GEOGTRAN,
u.wkt);q.PeGTTransformations.geogToGeog(W,k.length,k,null,u.isInverse?q.PeDefs.PE_TRANSFORM_2_TO_1:q.PeDefs.PE_TRANSFORM_1_TO_2)});if(B)for(a=0;a<k.length;a++){t=B[a];const u=k[a][0],W=179.9955<u?1:-179.9955>u?-1:0;t&&W&&t!==W&&(k[a][0]=0<t?u+360:u-360)}}h.isGeographic||(B=J(h,!0),B=m.isSome(B)&&B.isEnvelope?[B.bbox[1],B.bbox[3]]:[-90,90],e(k,B),B=h.wkid?q.PeFactory.coordsys(h.wkid):q.PeFactory.fromString(h.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,h.wkt),q.PeCSTransformations.geogToProj(B,
k.length,k));B=k;if(z&&k.length!==z.length){B=[];for(let u=0,W=0;u<z.length;u++)z[u]?B.push(k[W++]):B.push([NaN,NaN])}return B}function J(a,c=!1){var h=a.wkid||a.wkt;if(!h||a.isGeographic)return null;h=String(h);if(ha.has(h))return h=ha.get(h),c?h?.gcs:h?.pcs;var n=a.wkid?q.PeFactory.coordsys(a.wkid):q.PeFactory.fromString(a.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,a.wkt);a=f(a,1E-4);a=N(n,a);n=N(n,0,!0);ha.set(h,{pcs:a,gcs:n});return c?n:a}function N(a,c=0,h=!1){var n=q.PePCSInfo.generate(a),
t=h?a.horizonGcsGenerate():a.horizonPcsGenerate();if(!n||!t?.length)return null;a=!1;var k=t.find(V=>1===V.getInclusive()&&1===V.getKind());if(!k){k=t.find(V=>1===V.getInclusive()&&0===V.getKind());if(!k)return null;a=!0}h=h?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0);n=n.isPannableRectangle();k=k.getCoord();if(a)return{isEnvelope:a,isPannable:n,vertices:k,coef:null,bbox:[k[0][0]-c,k[0][1]-c,k[1][0]+c,k[1][1]+c],poleLocation:h};c=0;a=[];let [z,B]=k[0],[u,W]=k[0];for(let V=
0,aa=k.length;V<aa;V++){c++;c===aa&&(c=0);const [da,ba]=k[V],[la,ja]=k[c];if(ja===ba)a.push([da,la,ba,ja,2]);else{t=(la-da)/(ja-ba||1E-4);const ka=da-t*ba;ba<ja?a.push([t,ka,ba,ja,0]):a.push([t,ka,ja,ba,1])}z=z<da?z:da;B=B<ba?B:ba;u=u>da?u:da;W=W>ba?W:ba}return{isEnvelope:!1,isPannable:n,vertices:k,coef:a,bbox:[z,B,u,W],poleLocation:h}}function b(a,c){const h=[],{cols:n,rows:t,xres:k,yres:z,usePixelCenter:B}=a;let {xmin:u,ymax:W}=a;B&&(u+=k/2,W-=z/2);if(m.isNone(c)){for(a=0;a<n;a++)for(c=0;c<t;c++)h.push([u+
k*a,W-z*c]);return{points:h}}a=new Uint8Array(n*t);if(c.isEnvelope){const {bbox:[ka,ca,na,pa]}=c;for(let qa=0,ra=0;qa<n;qa++){var V=u+k*qa,aa=c.isPannable||V>=ka&&V<=na;for(var da=0;da<t;da++,ra++){var ba=W-z*da;aa&&ba>=ca&&ba<=pa&&(h.push([V,ba]),a[ra]=1)}}return{points:h,mask:a}}V=c.coef;c=[];for(aa=0;aa<t;aa++){var la=W-z*aa;da=[];ba=[];for(var ja=0;ja<V.length;ja++){const [ka,ca,na,pa,qa]=V[ja];la===na&&na===pa?(da.push(ka),da.push(ca),ba.push(2),ba.push(2)):la>=na&&la<=pa&&(da.push(ka*la+ca),
ba.push(qa))}la=da;if(2<da.length){ja=2===ba[0]?0:ba[0];let ka=da[0];la=[];for(let ca=1;ca<ba.length;ca++)if(2!==ba[ca]||ca===ba.length-1)ba[ca]!==ja&&(la.push(0===ja?Math.min(ka,da[ca-1]):Math.max(ka,da[ca-1])),ja=ba[ca],ka=da[ca]),ca===ba.length-1&&la.push(0===ba[ca]?Math.min(ka,da[ca]):Math.max(ka,da[ca]));la.sort((ca,na)=>ca-na)}else da[0]>da[1]&&(la=[da[1],da[0]]);c.push(la)}for(let ka=0,ca=0;ka<n;ka++)for(V=u+k*ka,aa=0;aa<t;aa++,ca++)if(da=W-z*aa,ba=c[aa],2===ba.length)V>=ba[0]&&V<=ba[1]&&(h.push([V,
da]),a[ca]=1);else if(2<ba.length){la=!1;for(ja=0;ja<ba.length;ja+=2)if(V>=ba[ja]&&V<=ba[ja+1]){la=!0;break}la&&(h.push([V,da]),a[ca]=1)}return{points:h,mask:a}}function e(a,c){const [h,n]=c;for(c=0;c<a.length;c++){const t=a[c][1];if(t<h||t>n)a[c]=[NaN,NaN]}}function g(a){const c=U(a[0].spatialReference);if(2>a.length||m.isNone(c))return a[0];let {xmin:h,xmax:n,ymin:t,ymax:k}=a[0];for(let z=1;z<a.length;z++){const B=a[z];n=B.xmax+c*z;t=Math.min(t,B.ymin);k=Math.max(k,B.ymax)}return new r({xmin:h,
xmax:n,ymin:t,ymax:k,spatialReference:a[0].spatialReference})}function d(a,c,h=null,n=!0){var t=a.spatialReference;if(t.equals(c))return a;var k=S(a);const z=U(t,!0);var B=U(c);if(0===k||m.isNone(z)||m.isNone(B))return k=w(a,c,h,n),m.isNone(z)&&m.isSome(B)&&Math.abs(k.width-B)<f(c)&&E.isLoaded()&&(t=J(t),m.isSome(t)&&t.poleLocation===Y.None&&a.width<(t.bbox[2]-t.bbox[0])/2)?p(a,c)||k:k;B=a.clone().normalize();if(1===B.length&&a.xmax<z&&a.xmax-z/2>f(t)){const {xmin:u,xmax:W}=a;for(let V=0;V<=k;V++)B[V]=
new r({xmin:0===V?u:-z/2,xmax:V===k?W-z*V:z/2,ymin:a.ymin,ymax:a.ymax,spatialReference:t})}a=B.map(u=>w(u,c,h,n));return g(a.filter(m.isSome))}function p(a,c){const h=U(c);if(m.isNone(h))return null;let {xmin:n,ymin:t,xmax:k,ymax:z}=a;var B=a.spatialReference;a=new P({spatialReference:B,rings:[[[n,t],[k,t],[k,z],[n,z],[n,t]]]});a=E.project(a,c);if(2!==a.rings.length||!a.rings[0].length||!a.rings[1].length)return null;({rings:a}=a);B=f(B);c=new r({spatialReference:c});for(let u=0;2>u;u++){n=k=a[u][0][0];
t=z=a[u][0][1];for(let W=0;W<a[u].length;W++)n=n>a[u][W][0]?a[u][W][0]:n,k=k<a[u][W][0]?a[u][W][0]:k,t=t>a[u][W][1]?a[u][W][1]:t,z=z<a[u][W][1]?a[u][W][1]:z;if(0===u)c.ymin=t,c.ymax=z,c.xmin=n,c.xmax=k;else if(c.ymin=Math.min(c.ymin,t),c.ymax=Math.max(c.ymax,z),Math.abs(k-h/2)<B)c.xmin=n,c.xmax+=h;else if(Math.abs(n+h/2)<B)c.xmax=k+h;else return null}return c}function w(a,c,h=null,n=!0,t=!0){const k=a.spatialReference;if(k.equals(c)||!c)return a;Z(k,c,h);const z=E.project(a,c,h);if(t&&c.isWebMercator&&
z&&(z.ymax=Math.min(2.0037508342787E7,z.ymax),z.ymin=Math.max(-2.0037508342787E7,z.ymin),z.ymin>=z.ymax))return null;if(!n||!z)return z;var B=K(k,!0);n=K(c,!0);if(m.isNone(B)||m.isNone(n))return z;t=f(k,.001);const u=f(k,500);var W=f(c,.001);if(Math.abs(z.xmin-n[0])<W&&Math.abs(z.xmax-n[1])<W){W=Math.abs(a.xmin-B[0]);B=Math.abs(B[1]-a.xmax);if(W<t&&B>u){z.xmin=n[0];var V=[];V.push(new F(a.xmax,a.ymin,k));V.push(new F(a.xmax,(a.ymin+a.ymax)/2,k));V.push(new F(a.xmax,a.ymax,k));V=V.map(aa=>l(aa,c,h)).filter(aa=>
!isNaN(aa?.x)).map(aa=>aa.x);z.xmax=Math.max.apply(null,V)}B<t&&W>u&&(z.xmax=n[1],n=[],n.push(new F(a.xmin,a.ymin,k)),n.push(new F(a.xmin,(a.ymin+a.ymax)/2,k)),n.push(new F(a.xmin,a.ymax,k)),a=n.map(aa=>l(aa,c,h)).filter(aa=>!isNaN(aa?.x)).map(aa=>aa.x),z.xmin=Math.min.apply(null,a))}else a=f(c,.001),Math.abs(z.xmin-n[0])<a&&(z.xmin=n[0]),Math.abs(z.xmax-n[1])<a&&(z.xmax=n[1]);return z}function U(a,c=!1){return a?a.isWebMercator?2*(c?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?
360:2*ea[a.wkid]||null:null}function K(a,c=!1){if(a.isGeographic)return[-180,180];a=U(a,c);return m.isSome(a)?[-a/2,a/2]:null}function Q(a,c,h,n){a=(a-c)/h;0!==a-Math.floor(a)?a=Math.floor(a):n&&--a;return a}function S(a,c=!1){var h=U(a.spatialReference);if(m.isNone(h))return 0;const n=c?0:-(h/2),t=f(a.spatialReference),k=!c&&Math.abs(a.xmin+h/2)<t?-h/2:a.xmin;a=Q(!c&&Math.abs(a.xmax-h/2)<t?h/2:a.xmax,n,h,!0);h=Q(k,n,h,!1);return a-h}function M(a){const {projectedExtent:c,srcBufferExtent:h,pixelSize:n,
datumTransformation:t,rasterTransform:k}=a;var z=c.spatialReference;const B=h.spatialReference;var u=Z(z,B);const {xmin:W,ymin:V,xmax:aa,ymax:da}=c,ba=U(B),la=m.isSome(ba)&&(a.hasWrapAround||"gcs-shift"===k?.type);a=a.spacing||[32,32];var ja=a[0]*n.x,ka=a[1]*n.y;const ca=1===a[0],na=Math.ceil((aa-W)/ja-.1/a[0])+(ca?0:1),pa=Math.ceil((da-V)/ka-.1/a[1])+(ca?0:1);ja=v({cols:na,rows:pa,xmin:W,ymax:da,xres:ja,yres:ka,inSR:z,outSR:B,datumTransformation:t,preferPE:4>=a[0],usePixelCenter:ca});ka=[];let qa,
ra=0;const ua=ca?-1:NaN,{xmin:va,xmax:oa,ymax:wa,width:xa,height:ya}=h,za=f(B,500),Aa=m.isSome(ba)&&0<va&&oa>ba/2;var sa=!1;u&&(sa=J(z),sa=m.isSome(sa)&&0<sa.poleLocation);for(z=0;z<na;z++){u=[];for(let ta=0;ta<pa;ta++){var ma=ja[z*pa+ta];la&&ma[0]>oa&&ma[0]>ba/2-za?ma[0]-=ba:la&&0===z&&0>ma[0]&&Aa&&!k&&(ma[0]+=ba);!ma||isNaN(ma[0])||isNaN(ma[1])?(ka.push(ua),ka.push(ua),u.push(null),ra++):(k&&(ma=k.inverseTransform(new F({x:ma[0],y:ma[1],spatialReference:B})),ma=[ma.x,ma.y]),u.push(ma),0<z&&la&&
qa[ta]&&ma[0]<qa[ta][0]&&(ma[0]+=ba,sa&&ma[0]>oa&&ma[0]>ba&&(ma[0]-=ba)),ka.push((ma[0]-va)/xa),ka.push((wa-ma[1])/ya))}qa=u}return{offsets:ka,error:null,coefficients:null,outofBoundPointCount:ra,spacing:a,size:ca?[na,pa]:[na-1,pa-1]}}function X(a,c,h){const {cols:n,rows:t}=c;c=new Float32Array((n-1)*(t-1)*12);const k=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),z=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let da=0;da<n-1;da++){for(var B=0;B<t-1;B++){var u=da*t*2+2*B,W=a[u];const ba=a[u+1];var V=
a[u+2],aa=a[u+3];u+=2*t;const la=a[u],ja=a[u+1],ka=a[u+2];u=a[u+3];let ca=0,na=12*(B*(n-1)+da);for(let pa=0;3>pa;pa++)c[na++]=k[ca++]*W+k[ca++]*V+k[ca++]*ka;ca=0;for(V=0;3>V;V++)c[na++]=k[ca++]*ba+k[ca++]*aa+k[ca++]*u;ca=0;for(aa=0;3>aa;aa++)c[na++]=z[ca++]*W+z[ca++]*la+z[ca++]*ka;ca=0;for(W=0;3>W;W++)c[na++]=z[ca++]*ba+z[ca++]*ja+z[ca++]*u}if(h)for(B=0;B<c.length;B++)isNaN(c[B])&&(c[B]=-1)}return c}var Y;(function(a){a[a.None=0]="None";a[a.North=1]="North";a[a.South=2]="South";a[a.Both=3]="Both"})(Y||
(Y={}));const ia=(a,c,h,n=0)=>{if(1===h[0])return[0,0];var t=1,k=-1,z=1,B=-1;for(var u=0;u<a.length;u+=2)isNaN(a[u])||(t=t>a[u]?a[u]:t,k=k>a[u]?k:a[u],z=z>a[u+1]?a[u+1]:z,B=B>a[u+1]?B:a[u+1]);const {cols:W,rows:V}=c;c=(k-t)/W/h[0];h=(B-z)/V/h[1];n*=2;z=0;B=!1;t=[0,0];for(k=0;k<W-3;k++){for(u=0;u<V-3;u++){var aa=k*V*2+2*u;const da=Math.abs(((a[aa]+a[aa+4]+a[aa+4*V]+a[aa+4*V+4])/4-a[aa+2*V+2])/c);aa=Math.abs(((a[aa+1]+a[aa+5]+a[aa+4*V+1]+a[aa+4*V+5])/4-a[aa+2*V+3])/h);da+aa>z&&(z=da+aa,t=[da,aa]);if(n&&
z>n){B=!0;break}}if(B)break}return t},ea={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,
54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},ha=new Map,fa=new Map;x.computeProjectedScales=function(a,c,h=512,n=!0){const {extent:t,spatialReference:k,pixelSize:z}=a,B=O(new F({x:z.x,y:z.y,spatialReference:k}),c,t);if(null==B)return{projectedPixelSize:null,scales:null,srcResolutions:null,
isCustomTilingScheme:!1};const u=(B.x+B.y)/2;var W=y.getMetersPerUnitForSR(c),V=u*W*96*39.37,aa=c.isGeographic?256/h*2.958287637958547E8:256/h*5.91657527591555E8,da="vector-magdir"===a.dataType||"vector-uv"===a.dataType,ba=d(t,c);a=Math.min(Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2),Math.ceil(Math.log(aa/2/V)/Math.LN2));!da&&n&&(c.isGeographic||c.isWebMercator)&&(da=0>ba.xmin*ba.xmax,!da&&3>a&&(n=U(c),m.isSome(n)&&(da=2**a*u*h,h=Math.ceil(n/da),da=1===h||2===h&&n/2-ba.xmax<da)));
h=V;if(da)h=aa,aa=c.isGeographic?1.341104507446289E-6:.29858214164761665,W=96*aa*W*39.37,c=O(new F({x:aa,y:aa,spatialReference:{wkid:c.isGeographic?4326:3857}}),k,ba),c.x*=h/W,c.y*=h/W;else{c={x:z.x,y:z.y};for(ba=0;h<.5005*aa&&ba<a;)ba++,h*=2,c.x*=2,c.y*=2;1.001>=Math.max(h,aa)/Math.min(h,aa)&&(h=aa)}aa=[h];ba=[{x:c.x,y:c.y}];for(V=Math.min(70.5310735,V)/1.001;h>=V;)h/=2,c.x/=2,c.y/=2,aa.push(h),ba.push({x:c.x,y:c.y});return{projectedPixelSize:B,scales:aa,srcResolutions:ba,isCustomTilingScheme:!da}};
x.defaultGridSpacing=32;x.defaultProjectionToleranceInPixels=4;x.getDefaultDatumTransformationForDataset=function(a,c,h){return Z(a.spatialReference,c)?h?E.getTransformation(c,a.spatialReference,a):E.getTransformation(a.spatialReference,c,a):null};x.getProjectedGridPoints=v;x.getProjectionOffsetGrid=function(a){var c=a.isAdaptive&&null==a.spacing;let h=a.spacing||[32,32],n=M(a);var t={cols:n.size[0]+1,rows:n.size[1]+1};const k=0<n.outofBoundPointCount&&n.outofBoundPointCount<n.offsets.length/2;let z=
n.outofBoundPointCount===n.offsets.length/2||c&&k?[0,0]:ia(n.offsets,t,h,4);const B=(z[0]+z[1])/2;var u=a.projectedExtent.spatialReference;const W=a.srcBufferExtent.spatialReference;c&&(k||4<B)&&(R(u,W,a.datumTransformation)&&(u.isGeographic||m.isSome(J(u))),h=[4,4],n=M({...a,spacing:h}),t={cols:n.size[0]+1,rows:n.size[1]+1},z=ia(n.offsets,t,h,4));n.error=z;1<h[0]&&(n.coefficients=X(n.offsets,t,k));!a.includeGCSGrid||u.isGeographic||u.isWebMercator||(W.isGeographic?n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,
spacing:h}:(c=J(u),m.isSome(c)&&!c.isEnvelope&&(u&&!u.isGeographic&&(c=String(u.wkid||u.wkt),fa.has(c)?u=fa.get(c):(u=(u.wkid?q.PeFactory.coordsys(u.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_PROJCS,u.wkt)).getGeogcs().getCode(),fa.set(c,u)),u=new H({wkid:u})),u=d(a.projectedExtent,u),{offsets:a}=M({...a,srcBufferExtent:u,spacing:h}),t=X(a,t,k),n.gcsGrid={offsets:a,coefficients:t,spacing:h})));return n};x.getRasterDatasetAlignmentInfo=function(a){const c=a.storageInfo.origin.x;var h=U(a.spatialReference,
!0);if(m.isNone(h))return{originX:c,halfWorldWidth:null,pyramidsInfo:null};const n=h/2,{nativePixelSize:t,storageInfo:k,extent:z}=a,{maximumPyramidLevel:B,blockWidth:u,pyramidScalingFactor:W}=k;let V=t.x;const aa=[];a=m.isSome(a.transform)&&"gcs-shift"===a.transform.type;const da=c+(a?0:n);h=a?h-c:n-c;for(let ba=0;ba<=B;ba++){const la=(z.xmax-c)/V/u,ja=h/V/u;aa.push({resolutionX:V,blockWidth:u,datsetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ja-Math.floor(ja)?
ja:Math.ceil(ja),leftMargin:Math.round(da/V)%u,rightPadding:(u-Math.round(h/V)%u)%u,originColumnOffset:Math.floor(da/V/u)});V*=W}return{originX:c,halfWorldWidth:n,pyramidsInfo:aa,hasGCSSShiftTransform:a}};x.getWorldWidth=U;x.getWorldWrapCount=S;x.load=function(){return T.apply(this,arguments)};x.minimumGridSpacing=4;x.projectExtent=d;x.projectPoint=l;x.projectResolution=O;x.requirePE=R;x.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:g(a)};x.snapPyramid=function(a,c,h){const {storageInfo:n,
pixelSize:t}=c;var k=0;let z=!1;var {pyramidResolutions:B}=n;if(m.isSome(B)&&B.length){a=(a.x+a.y)/2;var u=B[B.length-1];u=(u.x+u.y)/2;var W=(t.x+t.y)/2;if(a<=W)k=0;else if(a>=u)k=B.length,z=8<a/u;else{u=W;for(let V=1;V<=B.length;V++){W=(B[V-1].x+B[V-1].y)/2;if(a<=W){a===W?k=V:"down"===h?(k=V-1,z=8<a/u):k="up"===h?V:a-u>W-a||2<a/u?V:V-1;break}u=W}}h=0===k?t:B[k-1];z&&(B=Math.min(h.x,h.y),a=y.getMetersPerUnitForSR(c.spatialReference),19567<B*a&&(z=!1));return{pyramidLevel:k,pyramidResolution:new F({x:h.x,
y:h.y,spatialReference:c.spatialReference}),excessiveReading:z}}k=Math.log(a.x/t.x)/Math.LN2;a=Math.log(a.y/t.y)/Math.LN2;B=c.storageInfo.maximumPyramidLevel||0;k="down"===h?Math.floor(Math.min(k,a)):"up"===h?Math.ceil(Math.max(k,a)):Math.round((k+a)/2);0>k?k=0:k>B&&(z=k>B+3,k=B);h=2**k;c=new F({x:h*c.nativePixelSize.x,y:h*c.nativePixelSize.y,spatialReference:c.spatialReference});return{pyramidLevel:k,pyramidResolution:c,excessiveReading:z}};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(x,D,G,I,m){function y(b,e){return f.get(b)/f.get(e)||1}function q(b,e="geographic"){const [g,d]=b;b=Math.sqrt(g*g+d*d);let p=Math.atan2(d,g)*l;p=(360+p)%360;"geographic"===e&&(p=(450-p)%360);return[b,p]}function E(b,e="geographic"){let g=b[1];"geographic"===e&&(g=(450-g)%360);g%=360;b=b[0];return[b*Math.cos(g/l),b*Math.sin(g/l)]}
function r(b,e,g="geographic",d=1){if(!m.isValidPixelBlock(b))return b;const {pixels:p,width:w,height:U}=b;var K=w*U;const Q=p[0],S=p[1],M=b.pixelType.startsWith("f")?b.pixelType:"f32",X=I.createEmptyBand(M,K);K=I.createEmptyBand(M,K);let Y=0;for(let ia=0;ia<U;ia++)for(let ea=0;ea<w;ea++)"vector-uv"===e?([X[Y],K[Y]]=q([Q[Y],S[Y]],g),X[Y]*=d):([X[Y],K[Y]]=E([Q[Y],S[Y]],g),X[Y]*=d,K[Y]*=d),Y++;b=new I({pixelType:M,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,
pixels:[X,K]});b.updateStatistics();return b}function F(b=0,e=0,g=Math.PI,d=!0){d&&(g=(2*Math.PI-g)%(2*Math.PI));d=d?-1:1;const p=-7*d,w=-2*d,U=-16*d,[K,Q]=H(0,e+13*d,g,21.75),[S,M]=H(b-5.5,e+p,g,21.75),[X,Y]=H(b+5.5,e+p,g,21.75),[ia,ea]=H(b-1.5,e+w,g,21.75),[ha,fa]=H(b+1.5,e+w,g,21.75),[a,c]=H(b-1.5,e+U,g,21.75),[h,n]=H(b+1.5,e+U,g,21.75);return[K,Q,S,M,ia,ea,ha,fa,X,Y,a,c,h,n]}function P(b=0,e=Math.PI,g=!0){g&&(e=(2*Math.PI-e)%(2*Math.PI));var d=g?-1:1,p=5*d;const w=20*d,U=25*d;d*=2;const K=g?1:
-1;g=5*K;let [Q,S]=[0+g,0-w],[M,X]=[Q+2*K,S],[Y,ia]=[M-0*K,X+d],[ea,ha]=[0-g,0-U],[fa,a]=[ea+0*K,ha-d],c=Math.ceil(b/5),h=Math.floor(c/10);c-=8*h;b=[];const n=[];for(let da=0;da<c/2;da++,h--){0>=h&&1===c%2&&da===(c-1)/2&&(ea=0,fa=ea+0*K,ha=(ha+S)/2,a=ha-d);const [ba,la]=H(ea,ha,e,45);if(0<h){const [ja,ka]=H(M,ha,e,45),[ca,na]=H(Q,S,e,45);b.push(ja);b.push(ka);b.push(ba);b.push(la);b.push(ca);b.push(na)}else{const [ja,ka]=H(M,X,e,45),[ca,na]=H(Y,ia,e,45),[pa,qa]=H(fa,a,e,45);n.push(ba);n.push(la);
n.push(pa);n.push(qa);n.push(ca);n.push(na);n.push(ja);n.push(ka)}ha+=p;S+=p;X+=p;ia+=p;a+=p}const [t,k]=H(0+g,0+w,e,45);p=7*K;const [z,B]=H(0+p,0+w,e,45),[u,W]=H(0+g,0-U,e,45),[V,aa]=H(0+p,0-U,e,45);return{pennants:b,barbs:n,shaft:[t,k,z,B,u,W,V,aa]}}function H(b,e,g,d=1){return[Math.sqrt(b*b+e*e)/d,(2*Math.PI+(2*Math.PI+Math.atan2(e,b))%(2*Math.PI)-g)%(2*Math.PI)]}function R(b,e,g,d){g=y(d||"knots",g);for(d=1;d<e.length;d++)if(d===e.length-1){if(b<e[d]*g)break}else if(b<=e[d]*g)break;return Math.min(d-
1,e.length-2)}function Z(b,e,g,d,p){let w=0;switch(e){case "beaufort_kn":w=R(b,A,"knots",g);break;case "beaufort_km":w=R(b,A,"kilometer-per-hour",g);break;case "beaufort_ft":w=R(b,A,"feet-per-second",g);break;case "beaufort_m":w=R(b,A,"meter-per-second",g);break;case "classified_arrow":w=R(b,p??[],d,g);break;case "ocean_current_m":w=R(b,L,"meter-per-second",g);break;case "ocean_current_kn":w=R(b,J,"knots",g)}return w}function T(b,e){const {style:g,inputUnit:d,outputUnit:p,breakValues:w}=e,U=C.fromJSON(d),
K=C.fromJSON(p);let Q=0,S=0;const {width:M,height:X,mask:Y}=b,ia=b.pixels[0];b=b.pixels[1];var ea=G.isSome(Y)?Y.filter(a=>0<a).length:M*X;const ha=new Float32Array(42*ea);ea=new Uint32Array(15*ea);e=e.invertDirection?F(0,0,0,!1):v;for(let a=0;a<X;a++)for(let c=0;c<M;c++){var fa=a*M+c;if(!Y||Y[a*M+c]){const h=(b[fa]+360)%360/180*Math.PI,n=Z(ia[fa],g,U,K,w);for(let t=0;t<e.length;t+=2)ha[Q++]=(c+.5)/M,ha[Q++]=(a+.5)/X,ha[Q++]=e[t],ha[Q++]=e[t+1]+h,ha[Q++]=n,ha[Q++]=ia[fa];fa=7*(Q/42-1);ea[S++]=fa;ea[S++]=
fa+1;ea[S++]=fa+2;ea[S++]=fa+0;ea[S++]=fa+4;ea[S++]=fa+3;ea[S++]=fa+0;ea[S++]=fa+2;ea[S++]=fa+3;ea[S++]=fa+2;ea[S++]=fa+5;ea[S++]=fa+3;ea[S++]=fa+5;ea[S++]=fa+6;ea[S++]=fa+3}}return{vertexData:ha,indexData:ea}}function O(b,e){let g=0,d=0;const {width:p,height:w,mask:U}=b;b=b.pixels[0];const K=[],Q=[];var S=C.fromJSON(e.inputUnit);S=y(S,"knots");e="wind_speed"===e.style?5:Number.MAX_VALUE;for(let X=0;X<w;X++)for(let Y=0;Y<p;Y++){var M=b[X*p+Y]*S;if((!U||U[X*p+Y])&&M<e){for(let ia=0;4>ia;ia++)K[g++]=
(Y+.5)/p,K[g++]=(X+.5)/w,K[g++]=2>ia?-.5:.5,K[g++]=0===ia%2?-.5:.5,K[g++]=0,K[g++]=M;M=4*(g/24-1);Q[d++]=M;Q[d++]=M+1;Q[d++]=M+2;Q[d++]=M+1;Q[d++]=M+2;Q[d++]=M+3}}return{vertexData:new Float32Array(K),indexData:new Uint32Array(Q)}}const f=new Map;f.set("meter-per-second",1);f.set("kilometer-per-hour",.277778);f.set("knots",.514444);f.set("feet-per-second",.3048);f.set("mile-per-hour",.44704);const l=180/Math.PI,C=new D.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",
esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),v=F(0,0,0),A=[0,1,3,6,10,16,21,27,33,40,47,55,63],L=[0,.5,1,1.5,2],J=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],N=[];x.convertToLocalDirections=function(b,e,g,d="geographic"){if(!m.isValidPixelBlock(b)||G.isNone(g))return b;b="vector-magdir"===e?b.clone():G.unwrap(r(b,e));const p=b.pixels[1];for(let w=0;w<p.length;w++)p[w]="geographic"===d?(p[w]+g[w]+270)%360:(p[w]+360-g[w])%360;return"vector-magdir"===e?b:r(b,"vector-magdir")};
x.convertVectorFieldData=r;x.convertVectorFieldUnit=function(b,e,g=1){if(1===g||!m.isValidPixelBlock(b))return b;b=b.clone();const {pixels:d,width:p,height:w}=b,U=d[0],K=d[1];let Q=0;for(let S=0;S<w;S++)for(let M=0;M<p;M++)"vector-uv"===e?(U[Q]*=g,K[Q]*=g):U[Q]*=g,Q++;b.updateStatistics();return b};x.createVFMesh=function(b,e){if("simple_scalar"===e.style)e=O(b,e);else if("wind_speed"===e.style){if(0===N.length)for(var g=0;30>g;g++)N.push(P(5*g,0,!e.invertDirection));e=C.fromJSON(e.inputUnit);e=y(e,
"knots");const {width:U,height:K,mask:Q}=b;g=b.pixels[0];b=b.pixels[1];const S=[],M=[];let X=0,Y=0;for(let ia=0;ia<K;ia++)for(let ea=0;ea<U;ea++){var d=ia*U+ea,p=g[d]*e;if((!Q||Q[ia*U+ea])&&5<=p){const ha=(b[d]+360)%360/180*Math.PI,{pennants:fa,barbs:a,shaft:c}=N[Math.min(Math.floor(p/5),29)];if(0===fa.length+a.length)continue;d=S.length/6;const h=(ea+.5)/U,n=(ia+.5)/K;for(var w=0;w<fa.length;w+=2)S[X++]=h,S[X++]=n,S[X++]=fa[w],S[X++]=fa[w+1]+ha,S[X++]=0,S[X++]=p;for(w=0;w<a.length;w+=2)S[X++]=h,
S[X++]=n,S[X++]=a[w],S[X++]=a[w+1]+ha,S[X++]=0,S[X++]=p;for(w=0;w<c.length;w+=2)S[X++]=h,S[X++]=n,S[X++]=c[w],S[X++]=c[w+1]+ha,S[X++]=0,S[X++]=p;for(p=0;p<fa.length/6;p++)M[Y++]=d,M[Y++]=d+1,M[Y++]=d+2,d+=3;for(p=0;p<a.length/8;p++)M[Y++]=d,M[Y++]=d+1,M[Y++]=d+2,M[Y++]=d+1,M[Y++]=d+2,M[Y++]=d+3,d+=4;M[Y++]=d+0;M[Y++]=d+1;M[Y++]=d+2;M[Y++]=d+1;M[Y++]=d+3;M[Y++]=d+2;d+=4}}e={vertexData:new Float32Array(S),indexData:new Uint32Array(M)}}else e=T(b,e);return e};x.createVFMeshScalar=O;x.getUnitConversionFactor=
y;x.sampleVectorField=function(b,e,g,d=[0,0],p=.5){const {width:w,height:U,mask:K}=b,[Q,S]=b.pixels,[M,X]=d;b=Math.round((w-M)/g);d=Math.round((U-X)/g);var Y=b*d;const ia=new Float32Array(Y),ea=new Float32Array(Y);Y=new Uint8Array(Y);e="vector-uv"===e;for(let fa=0;fa<d;fa++)for(let a=0;a<b;a++){let c=0;const h=fa*b+a,n=Math.max(0,fa*g+X),t=Math.max(0,a*g+M),k=Math.min(U,n+g),z=Math.min(w,t+g);for(let B=n;B<k;B++)for(let u=t;u<z;u++){var ha=B*w+u;if(!K||K[ha]){c++;ha=e?[Q[ha],S[ha]]:[Q[ha],(360+S[ha])%
360];const [W,V]=e?ha:E(ha);ia[h]+=W;ea[h]+=V}}if(c>=(k-n)*(z-t)*(1-p)){Y[h]=1;const [B,u]=q([ia[h]/c,ea[h]/c]);ia[h]=B;ea[h]=u}else Y[h]=0,ia[h]=0,ea[h]=0}g=new I({width:b,height:d,pixels:[ia,ea],mask:Y});g.updateStatistics();return g};x.snapImageToSymbolTile=function(b,e,g,d,p){if(G.isNone(p)||!p.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(e/d),height:Math.round(g/d),resolution:b.width/e};const w=p.xmin;p=p.ymax;e=(b.xmax-b.xmin)/e*d;g=(b.ymax-b.ymin)/g*d;b.xmin=
w+Math.floor((b.xmin-w)/e)*e;b.xmax=w+Math.ceil((b.xmax-w)/e)*e;b.ymin=p+Math.floor((b.ymin-p)/g)*g;b.ymax=p+Math.ceil((b.ymax-p)/g)*g;return{extent:b,width:Math.round(b.width/e),height:Math.round(b.height/g),resolution:(e+g)/2}};x.unitKebabDict=C;x.uvComponentToVector=q;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./BrushVectorField",
"../webgl/enums","../webgl/WGLContainer"],function(x,D,G,I,m){m=function(y){function q(){var r=y.apply(this,arguments)||this;r.symbolTypes=["triangle"];return r}D._inheritsLoose(q,y);var E=q.prototype;E.prepareRenderPasses=function(r){const F=r.registerRenderPass({name:"imagery (vf)",brushes:[G],target:()=>this.children,drawPhase:I.WGLDrawPhase.MAP});return[...y.prototype.prepareRenderPasses.call(this,r),F]};E.doRender=function(r){this.visible&&r.drawPhase===I.WGLDrawPhase.MAP&&this.symbolTypes.forEach(F=>
{r.renderPass=F;y.prototype.doRender.call(this,r)})};D._createClass(q,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return q}(m);x.RasterVFContainer=m;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H){G=function(R){function Z(O){var f=R.call(this,O)||this;f.update=y.debounce((l,C)=>f._update(l,C).catch(v=>{y.isAbortError(v)||I.getLogger(f.declaredClass).error(v)}));return f}x._inheritsLoose(Z,R);var T=Z.prototype;T.redraw=function(O){if(this.container.children.length){var f=this.container.children[0];f.symbolizerParameters=O;f.invalidateVAO();this.container.symbolTypes="wind_speed"===O.style?["scalar","triangle"]:"simple_scalar"===O.style?["scalar"]:["triangle"];
this.container.requestRender()}};T._update=function(){var O=x._asyncToGenerator(function*(f,l,C){if(f.stationary){var {extent:v,spatialReference:A}=f.state,L=new P({xmin:v.xmin,ymin:v.ymin,xmax:v.xmax,ymax:v.ymax,spatialReference:A}),[J,N]=f.state.size;this._loading=this.fetchPixels(L,J,N,C);C=yield this._loading;this._addToDisplay(C,l,f.state);this._loading=null}});return function(f,l,C){return O.apply(this,arguments)}}();T._addToDisplay=function(O,f,l){if(m.isNone(O.pixelBlock))this.container.children.forEach(L=>
L.destroy()),this.container.removeAllChildren();else{var {extent:C,pixelBlock:v}=O,A=new H.RasterVFDisplayObject(v);A.offset=[0,0];A.symbolizerParameters=f;A.rawPixelData=O;A.invalidateVAO();A.x=C.xmin;A.y=C.ymax;A.pixelRatio=l.pixelRatio;A.rotation=l.rotation;A.resolution=l.resolution;A.width=v.width*f.symbolTileSize;A.height=v.height*f.symbolTileSize;this.container.children.forEach(L=>L.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===f.style?["scalar","triangle"]:
"simple_scalar"===f.style?["scalar"]:["triangle"];this.container.addChild(A)}};x._createClass(Z,[{key:"updating",get:function(){return!!this._loading}}]);return Z}(G);D.__decorate([q.property()],G.prototype,"fetchPixels",void 0);D.__decorate([q.property()],G.prototype,"container",void 0);D.__decorate([q.property()],G.prototype,"_loading",void 0);D.__decorate([q.property()],G.prototype,"updating",null);return G=D.__decorate([F.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],G)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R){G=function(Z){function T(f=null){var l=Z.call(this)||this;l._source=null;l._symbolizerParameters=null;l._vaoInvalidated=!0;l.coordScale=[1,1];l.height=null;l.stencilRef=0;l.resolution=null;l.pixelRatio=1;l.x=0;l.y=0;l.rotation=0;l.rawPixelData=null;l.width=null;l.source=f;return l}D._inheritsLoose(T,Z);var O=T.prototype;O.destroy=function(){I.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)};O.invalidateVAO=
function(){!this._vaoInvalidated&&I.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};O.updateVectorFieldVAO=function(f){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(I.isSome(this.source)&&I.isNone(this.vaoData)){var {style:l}=this.symbolizerParameters;switch(l){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":l=
E.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(f.context,l)};break;case "simple_scalar":l=E.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(f.context,l)};break;case "wind_speed":l=E.createVFMesh(this.source,this.symbolizerParameters);l=this._createVectorFieldVAO(f.context,l);const C=E.createVFMeshScalar(this.source,this.symbolizerParameters);f=this._createVectorFieldVAO(f.context,C);this.vaoData=
{magdir:l,scalar:f}}}this.ready();this.requestRender()}};O._createTransforms=function(){return{dvs:y.create()}};O.setTransform=function(f){const l=m.identity(this.transforms.dvs),[C,v]=f.toScreenNoRotation([0,0],[this.x,this.y]);var A=this.resolution/this.pixelRatio/f.resolution;const L=A*this.width;A*=this.height;const J=Math.PI*this.rotation/180;m.translate(l,l,q.fromValues(C,v));m.translate(l,l,q.fromValues(L/2,A/2));m.rotate(l,l,-J);m.translate(l,l,q.fromValues(-L/2,-A/2));m.scaleByVec2(l,l,q.fromValues(L,
A));m.multiply(this.transforms.dvs,f.displayViewMat3,l)};O.onAttach=function(){this.invalidateVAO()};O.onDetach=function(){this.invalidateVAO()};O._createVectorFieldVAO=function(f,l){const {vertexData:C,indexData:v}=l;l=P.BufferObject.createVertex(f,H.Usage.STATIC_DRAW,new Float32Array(C));const A=P.BufferObject.createIndex(f,H.Usage.STATIC_DRAW,new Uint32Array(v)),L=F.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:H.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:H.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:H.DataType.FLOAT,normalized:!1}]});return{vao:new R.VertexArrayObject(f,L.attributes,L.bufferLayouts,{geometry:l},A),elementCount:v.length}};D._createClass(T,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(f){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(f)&&(this._symbolizerParameters=f,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(f){this._source=f;this.invalidateVAO()}}]);return T}(r.DisplayObject);x.RasterVFDisplayObject=G;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/ImageryLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H){return R=>{R=function(Z){function T(){var f=Z.apply(this,arguments)||this;f.view=null;return f}x._inheritsLoose(T,Z);var O=T.prototype;O.fetchPopupFeatures=function(){var f=x._asyncToGenerator(function*(l,C){const {layer:v}=this;if(!l)throw new G("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:v});var {popupEnabled:A}=v;const L=H.getFetchPopupTemplate(v,C);if(!A||I.isNone(L))throw new G("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:A,popupTemplate:L});const J=yield L.getRequiredFields();A=new P;A.timeExtent=this.timeExtent;A.geometry=l;A.outFields=J;A.outSpatialReference=l.spatialReference;l=this.view.resolution;l="2d"===this.view.type?new r(l,l,this.view.spatialReference):new r(.5*l,.5*l,this.view.spatialReference);const {returnTopmostRaster:N,showNoDataRecords:b}=L.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};C={returnDomainValues:!0,returnTopmostRaster:N,pixelSize:l,showNoDataRecords:b,signal:I.isSome(C)?
C.signal:null};return v.queryVisibleRasters(A,C).then(e=>e)});return function(l,C){return f.apply(this,arguments)}}();O.canResume=function(){return!Z.prototype.canResume.call(this)||this.timeExtent?.isEmpty?!1:!0};return T}(R);D.__decorate([m.property()],R.prototype,"layer",void 0);D.__decorate([m.property()],R.prototype,"suspended",void 0);D.__decorate([m.property(F.combinedViewLayerTimeExtentProperty)],R.prototype,"timeExtent",void 0);D.__decorate([m.property()],R.prototype,"view",void 0);return R=
D.__decorate([E.subclass("esri.views.layers.ImageryLayerView")],R)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(x,D,G,I){function m(){m=D._asyncToGenerator(function*(y,q=y.popupTemplate){if(G.isNone(q))return[];const E=yield q.getRequiredFields(y.fieldsIndex);({lastEditInfoEnabled:q}=q);const {objectIdField:r,typeIdField:F,globalIdField:P,relationships:H}=y;if(E.includes("*"))return["*"];
q=q?yield I.getFeatureEditFields(y):[];const R=I.fixFields(y.fieldsIndex,[...E,...q]);F&&R.push(F);R&&r&&y.fieldsIndex.has(r)&&!R.includes(r)&&R.push(r);R&&P&&y.fieldsIndex.has(P)&&!R.includes(P)&&R.push(P);H&&H.forEach(Z=>{({keyField:Z}=Z);R&&Z&&y.fieldsIndex.has(Z)&&!R.includes(Z)&&R.push(Z)});return R});return m.apply(this,arguments)}x.getFetchPopupTemplate=function(y,q){return y.popupTemplate?y.popupTemplate:G.isSome(q)&&q.defaultPopupTemplateEnabled&&G.isSome(y.defaultPopupTemplate)?y.defaultPopupTemplate:
null};x.getRequiredFields=function(y){return m.apply(this,arguments)};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(x,D,G,I,m,y,q,E,r){return F=>{F=function(P){function H(){return P.apply(this,arguments)||this}x._inheritsLoose(H,P);H.prototype.initialize=function(){this.handles.add(m.on(()=>this.layer,"refresh",R=>{this.doRefresh(R.dataChanged).catch(Z=>{I.isAbortError(Z)||G.getLogger(this.declaredClass).error(Z)})}),"RefreshableLayerView")};return H}(F);D.__decorate([y.property()],F.prototype,"layer",void 0);return F=D.__decorate([r.subclass("esri.layers.mixins.RefreshableLayerView")],F)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(x,D,G,I,m,y,q,E,r,F,P,H,R,Z,T,O,f,l,C){q=function(v){function A(){var J=v.apply(this,arguments)||this;J._exportImageVersion=-1;J._highlightGraphics=new F.GraphicsCollection;J.subview=null;return J}x._inheritsLoose(A,v);var L=A.prototype;L.hitTest=function(){var J=x._asyncToGenerator(function*(N,b){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(N),layer:this.layer,mapPoint:N}]:null});return function(N,b){return J.apply(this,arguments)}}();L.update=function(J){this.subview?.update(J)};
L.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.view&&(this._highlightView=new R({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Z(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.handles.add([m.watch(()=>this.layer.blendMode??"normal",J=>this.subview.container.blendMode=J,m.syncAndInitial),m.watch(()=>this.layer.effect??null,J=>this.subview.container.effect=
J,m.syncAndInitial),m.watch(()=>this.layer.exportImageServiceParameters.version,J=>{J&&this._exportImageVersion!==J&&(this._exportImageVersion=J,this.requestUpdate())},m.sync),m.watch(()=>this.timeExtent,J=>{this.subview.timeExtent=J;"redraw"in this.subview?this.requestUpdate():this.subview.redrawOrRefetch()},m.sync),this.layer.on("redraw",()=>{"redraw"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()}),m.watch(()=>this.layer.renderer,()=>this._setSubView())],"imagerylayerview-update")};
L.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.handles.remove("imagerylayerview-update");this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1};L.moveStart=function(){};L.viewChange=function(){};L.moveEnd=function(){this.requestUpdate()};L.highlight=function(J,N){if(!((Array.isArray(J)?J[0]:I.isCollection(J)?J.getItemAt(0):J)instanceof G))return{remove:()=>{}};let b=
[];Array.isArray(J)||I.isCollection(J)?b=J.map(e=>e.clone()):J instanceof G&&(b=[J.clone()]);this._highlightGraphics.addMany(b);return{remove:()=>{this._highlightGraphics.removeMany(b)}}};L.doRefresh=function(){var J=x._asyncToGenerator(function*(){this.requestUpdate()});return function(){return J.apply(this,arguments)}}();L.isUpdating=function(){return!this.subview||this.subview.updating};L._setSubView=function(){if(this.view){var J=this.layer.renderer?.type,N="imagery";"vector-field"===J?N="imageryVF":
"flow"===J&&(N="flow");if(this.subview){({type:J}=this.subview);if(J===N){this._attachSubview(this.subview);"flow"===J?this.subview.redrawOrRefetch():"imagery"===J&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===N?new T({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===N?new O({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new P({layer:this.layer,
layerView:this});this._attachSubview(this.subview);this.requestUpdate()}};L._attachSubview=function(J){J&&!J.attached&&(J.attach(),J.attached=!0,this.container.addChildAt(J.container,0),J.container.blendMode=this.layer.blendMode,J.container.effect=this.layer.effect)};L._detachSubview=function(J){J?.attached&&(this.container.removeChild(J.container),J.detach(),J.attached=!1)};x._createClass(A,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():
null}}]);return A}(f(C(H.LayerView2DMixin(l))));D.__decorate([y.property()],q.prototype,"pixelData",null);D.__decorate([y.property()],q.prototype,"subview",void 0);return q=D.__decorate([r.subclass("esri.views.2d.layers.ImageryLayerView2D")],q)});