// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/CircularArray ../../../../core/has ../../../../core/maybe ../../../../chunks/mat2df32 ./enums ./Utils ./WGLTile ./collisions/MetricReader ./cpuMapped/Geometry".split(" "),function(y,u,r,v,q,w,h,d,e,c,b){let a=0;e=function(g){function k(f,p,n,m,t,x){f=g.call(this,f,p,n,m)||this;f.instanceId=a++;f.patchCount=0;f._renderState={current:{geometry:new Map,metrics:null},
next:null,swap:!1,swapFrames:0,locked:!1};f._patches=new r(100);f._bufferPatches=new r(100);f._lastCommitTime=0;f.transforms.labelMat2d=w.create();f._store=t;f._requestLabelUpdate=x;return f}u._inheritsLoose(k,g);var l=k.prototype;l.destroy=function(){g.prototype.destroy.call(this);this._renderState.current.geometry.forEach(f=>f.destroy());q.isSome(this._renderState.next)&&this._renderState.next.geometry.forEach(f=>f.destroy());this._renderState.current=null;this._renderState.next=null};l.getGeometry=
function(f){return this._renderState.current.geometry.get(f)};l.patch=function(f,p){this.patchCount++;f.clear&&50<=this._patches.size&&this._dropPatches();const n=f.addOrUpdate&&this.key.id!==f.addOrUpdate.tileKeyOrigin;p&&n?this._bufferPatches.enqueue(f):(f.sort=f.sort&&!p,this._patches.enqueue(f));this.requestRender()};l.commit=function(f){if(this._lastCommitTime!==f.time){this._lastCommitTime=f.time;for(f=0;4>f;f++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&
(this._swapRenderStates(),this.requestRender())}};l.lock=function(){this._renderState.locked=!0};l.unlock=function(){this._renderState.locked=!1;this._flushUpdates();this._swap()};l._swapRenderStates=function(){this._renderState.next&&(this._renderState.locked?(this._renderState.swap=!0,this.requestRender()):(this._renderState.swap=!0,this._swap()))};l._swap=function(){this._renderState.swap&&(this._renderState.swap=!1,q.isSome(this._renderState.next)&&(this._renderState.current.geometry.forEach(f=>
f.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))};l._flushUpdates=function(){let f=this._patches.maxSize;for(;this._patches.size&&f--;)this._updateMesh(),this._swap()};l._updateBufferMesh=function(){var f=this._bufferPatches.peek();if(!q.isSome(f)||!f.clear||null===this._renderState.next)for(;this._bufferPatches.size;)f=this._bufferPatches.dequeue(),q.isSome(f)&&this._patchBuffer(f)};l._updateMesh=function(){const f=this._patches.dequeue();
if(q.isSome(f)){if(v("esri-2d-update-debug")){var p=f.addOrUpdate?.tileKeyOrigin;p=this.key.id===p?"SELF":p;let n="";for(let m=0;5>m;m++)n+=f.addOrUpdate?.data[m]?.records?.byteLength?1:0;console.debug(this.key.id,"FeatureTile:patch",`[clear: ${f.clear} origin: ${p}, end:${f.end} data:${n}]`)}!0===f.clear&&(q.isSome(this._renderState.next)&&(this._renderState.next.geometry.forEach(n=>n.destroy()),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},v("esri-2d-update-debug")&&
console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState"));this.requestRender();this._patch(f);f.end&&(v("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}};l._patch=function(f){d.forEachGeometryType(p=>{this._remove(p,f.remove);this._insert(p,f,!1)})};l._patchBuffer=function(f){d.forEachGeometryType(p=>{this._insert(p,f,!0)})};l._insert=function(f,p,n){try{const m=q.unwrapOr(this._renderState.next,
this._renderState.current),t=p.addOrUpdate?.data[f],x=m.geometry;q.isNone(t)||(x.has(f)||(v("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Creating geometry buffer ${f}`),x.set(f,new b.Geometry(f,this.stage))),v("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Inserting into ${f}, version=${p.addOrUpdate.version} stride=${t.stride}`),x.get(f).insert(t,p.sort,n),f===h.WGLGeometryType.LABEL&&this._insertLabelMetrics(p.type,t.metrics,p.clear))}catch(m){}};
l._insertLabelMetrics=function(f,p,n){n=q.unwrapOr(this._renderState.next,this._renderState.current);if(!q.isNone(p))if(p=c.MetricReader.from(p),q.isNone(n.metrics))n.metrics=p;else{if("update"===f)for(f=p.getCursor();f.next();)n.metrics.delete(f.id);n.metrics.link(p)}};l._remove=function(f,p){f=q.unwrapOr(this._renderState.next,this._renderState.current).geometry.get(f);p&&p.length&&f&&(f.remove(p),this._removeLabelMetrics(p))};l._removeLabelMetrics=function(f){const {metrics:p}=q.unwrapOr(this._renderState.next,
this._renderState.current);if(!q.isNone(p)&&f.length)for(const n of f)for(;p.delete(n););};l._dropPatches=function(){const f=[];let p=!1;for(;this._patches.size;){const n=this._patches.dequeue();if(q.isNone(n))break;if(n.clear){if(p)break;p=!0}f.push(n)}this._patches.clear();f.forEach(n=>this._patches.enqueue(n))};u._createClass(k,[{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}}]);return k}(e.WGLTile);
y.FeatureTile=e;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/collisions/MetricReader":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(y,u,r){let v=function(){function w(d){this._savedOffset=this._savedCursor=null;this._cursor=this._head=d}w.from=function(d){d=q.from(new Float32Array(d));return new w(d)};var h=w.prototype;h.computedMinZoom=function(){return this._cursor.computedMinZoom()};
h.setComputedMinZoom=function(d){return this._cursor.setComputedMinZoom(d)};h.boundsComputedAnchorX=function(d){return this._cursor.boundsComputedAnchorX(d)};h.boundsComputedAnchorY=function(d){return this._cursor.boundsComputedAnchorY(d)};h.setBoundsComputedAnchorX=function(d,e){return this._cursor.setBoundsComputedAnchorX(d,e)};h.setBoundsComputedAnchorY=function(d,e){return this._cursor.setBoundsComputedAnchorY(d,e)};h.boundsX=function(d){return this._cursor.boundsX(d)};h.boundsY=function(d){return this._cursor.boundsY(d)};
h.boundsWidth=function(d){return this._cursor.boundsWidth(d)};h.boundsHeight=function(d){return this._cursor.boundsHeight(d)};h.link=function(d){if(r.isSome(d._head))return this._cursor.link(d._head)};h.getCursor=function(){return this.copy()};h.copy=function(){const d=new w(this._head?.copy());if(!d._head)return d;let e=d._head,c=d._head._link;for(;c;)e._link=c.copy(),e=c,c=e._link;return d};h.peekId=function(){return this._cursor.peekId()??this._cursor._link.peekId()};h.nextId=function(){const d=
this.id;for(;d===this.id;)if(!this.next())return!1;return!0};h.save=function(){this._savedCursor=this._cursor;this._savedOffset=this._cursor._offset};h.restore=function(){this._savedCursor&&(this._cursor=this._savedCursor);null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)};h.next=function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;this._cursor._offset=0}return!0};h.lookup=function(d){for(this._cursor=this._head;this._cursor&&
!this._cursor.lookup(d);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor};h.delete=function(d){let e=this._head,c=null;for(;e;){if(e.delete(d))return e.isEmpty()&&r.isSome(c)&&(c._link=e._link),!0;c=e;e=e._link}return!1};u._createClass(w,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},
{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}}]);return w}(),q=function(){function w(d){this._offset=-1;this._link=null;this._deletedCount=this._count=0;this._offsets={instance:null};this._buffer=d}w.from=function(d){return new w(new Float32Array(d))};
var h=w.prototype;h.isEmpty=function(){return this._deletedCount===this.count};h.computedMinZoom=function(){return this._buffer[this._offset+8]};h.setComputedMinZoom=function(d){this._buffer[this._offset+8]=d};h.boundsComputedAnchorX=function(d){return this._buffer[this._offset+10+6*d+0]};h.boundsComputedAnchorY=function(d){return this._buffer[this._offset+10+6*d+1]};h.setBoundsComputedAnchorX=function(d,e){this._buffer[this._offset+10+6*d+0]=e};h.setBoundsComputedAnchorY=function(d,e){this._buffer[this._offset+
10+6*d+1]=e};h.boundsX=function(d){return this._buffer[this._offset+10+6*d+2]};h.boundsY=function(d){return this._buffer[this._offset+10+6*d+3]};h.boundsWidth=function(d){return this._buffer[this._offset+10+6*d+4]};h.boundsHeight=function(d){return this._buffer[this._offset+10+6*d+5]};h.link=function(d){let e=this;for(;e._link;)e=e._link;e._link=d};h.getCursor=function(){return this.copy()};h.copy=function(){const d=new w(this._buffer);d._link=this._link;d._offset=this._offset;d._deletedCount=this._deletedCount;
d._offsets=this._offsets;d._count=this._count;return d};h.peekId=function(){const d=this._offset+10+6*this.boundsCount+0;return d>=this._buffer.length?0:this._buffer[d]};h.next=function(){let d=0;for(;this._offset<this._buffer.length&&100>d++&&(this._offset=-1===this._offset?0:this._offset+(10+6*this.boundsCount),4294967296===this.id););return 4294967296!==this.id&&this._offset<this._buffer.length};h.delete=function(d){const e=this._offset,c=this.lookup(d);if(c)for(this.id=4294967295,++this._deletedCount;this.next()&&
this.id===d;)this.id=4294967295,++this._deletedCount;this._offset=e;return c};h.lookup=function(d){const e=this._offset;if(r.isNone(this._offsets.instance)){this._offsets.instance=new Map;const c=this.copy();c._offset=-1;let b=0;for(;c.next();)c.id!==b&&(this._offsets.instance.set(c.id,c._offset),b=c.id)}if(!this._offsets.instance.has(d))return!1;this._offset=this._offsets.instance.get(d);return 4294967296===this.id?(this._offset=e,!1):!0};h._computeCount=function(){const d=this._offset;let e=0;for(this._offset=
-1;this.next();)e++;this._offset=d;return e};u._createClass(w,[{key:"count",get:function(){this._count||(this._count=this._computeCount());return this._count}},{key:"id",get:function(){return this._buffer[this._offset+0]},set:function(d){this._buffer[this._offset+0]=d}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+
4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}}]);return w}();y.MetricReader=v;y.MetricReaderNode=q;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/cpuMapped/Geometry":function(){define("exports ../../../../../core/maybe ../FeatureDisplayList ./Buffer ./DisplayRecordReader ../../../../webgl/VertexArrayObject".split(" "),
function(y,u,r,v,q,w){let h=function(){function d(c,b){this._vaos=new Map;this._indicesInvalid=!1;this.geometryType=c;this._stage=b}var e=d.prototype;e.destroy=function(){for(const [,c]of this._vaos)u.isSome(c)&&c.dispose(!1);this._indexBuffer=u.destroyMaybe(this._indexBuffer);this._vertexBuffer=u.destroyMaybe(this._vertexBuffer)};e.insert=function(c,b,a){if(c.records.byteLength)if(a=c.stride,this._vertexBuffer&&this._indexBuffer){var g=c.vertices.byteLength/a;this._indexBuffer.ensure(c.indices.byteLength/
4);this._vertexBuffer.ensure(g);const {vertices:k,indices:l}=c;c=q.DisplayRecordReader.from(c.records);const f=this._vertexBuffer.insert(k,0,k.byteLength/a,0),p=this._indexBuffer.insert(l,0,l.byteLength/4,f);c.forEach(n=>{n.indexFrom+=p;n.vertexFrom+=f});u.unwrapOrThrow(this._records,"Expected records to be defined").link(c);if(b)this._indicesInvalid=!0;else if(this._displayList)for(b=c.getCursor();b.next();)this._displayList.addRecord(b)}else{g=c.indices.byteLength/4;const k=c.vertices.byteLength/
a,l=a/Uint32Array.BYTES_PER_ELEMENT,f=this._stage.bufferPool;this._records=q.DisplayRecordReader.from(c.records);this._indexBuffer=new v.Buffer("index",g,1,f);this._vertexBuffer=new v.Buffer("vertex",k,l,f);this._indexBuffer.insert(c.indices,0,c.indices.byteLength/4,0);this._vertexBuffer.insert(c.vertices,0,c.vertices.byteLength/a,0);b&&(this._indicesInvalid=!0)}};e.remove=function(c){if(!u.isNone(this._records))for(const b of c){c=this._records.getCursor();if(!c.lookup(b))continue;const a=c.indexFrom,
g=c.vertexFrom;let k=c.indexCount,l=c.vertexCount;for(;c.next()&&c.id===b;)k+=c.indexCount,l+=c.vertexCount;this._indexBuffer.free(a,k);this._vertexBuffer.free(g,l,!0);this._records.delete(b)}};e.getVAO=function(c,b,a,g){if(!this._vertexBuffer||!this._indexBuffer||u.isNone(this._records)||!this._vertexBuffer.bufferSize)return null;const k=g?1:0;let l=this._vaos.get(k);if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||g&&this._indexBuffer.invalidatedComputeBuffer)u.applySome(l,p=>p.dispose(!1)),
l=null;this._vertexBuffer.upload();this._indexBuffer.upload();g=this._indexBuffer.getGPUBuffer(c,1===k);const f=this._vertexBuffer.getGPUBuffer(c);l||(l=new w.VertexArrayObject(c,a,b,{geometry:f},g),this._vaos.set(k,l));return l};e.forEachCommand=function(c){if(!u.isNone(this._records)){this._sortIndices(this._records);if(!this._displayList){const b=this._cursorIndexOrder;this._displayList=r.FeatureDisplayList.from(this,this.geometryType,this._records.getCursor(),b)}this._displayList.forEach(c)}};
e._sortIndices=function(c){const b=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var a=0,g=c.getCursor(),k=[],l=[],f=[];g.next();)l.push(g.index),f.push(g.sortKey),k.push(g.id);l.sort((m,t)=>{const x=f[t],z=f[m];return z===x?k[t]-k[m]:x-z});c=c.getCursor();g=b?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const m of l){if(!c.seekIndex(m))throw Error("Expected to find index");if(b){const {indexFrom:t,indexCount:x}=c;c.indexFrom=a;for(var p=
0;p<x;p++)this._indexBuffer.set(a++,g.array[t+p])}else{const {vertexFrom:t,vertexCount:x}=c;var n=this._vertexBuffer.strideInt;const z=t*n;p=z+x*n;c.vertexFrom=a/n;for(n=z;n<p;n++)this._vertexBuffer.set(a++,g.array[n])}}this._cursorIndexOrder=l;this._displayList=null}};return d}();y.Geometry=h;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./cpuMapped/FreeList"],function(y,u,r,v){let q=function(){function h(d,e,c,b,a){this.target=d;this.geometryType=e;this.materialKey=c;this.indexFrom=b;this.indexCount=a}h.prototype.extend=function(d){this.indexCount+=d};u._createClass(h,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}}]);return h}(),w=function(){function h(e,c){this.geometryType=0;this._target=e;this.geometryType=c}h.from=function(e,c,b,a){e=new h(e,c);if(r.isSome(a))for(const g of a)b.seekIndex(g),
e.addRecord(b);else for(;b.next();)e.addRecord(b);return e};var d=h.prototype;d.addRecord=function(e){var c=this._target,b=this.geometryType,a=e.materialKey;let g=e.indexFrom,k=e.indexCount;const l=e.vertexFrom;e=e.vertexCount;k||(g=l,k=e);if(r.isNone(this._head))a=new q(c,b,a,g,k),this._head=new v.List(a);else{c=null;for(b=this._head;b;){if(g<b.data.indexFrom)return this._insert(a,g,k,c,b);c=b;b=b.next}this._insert(a,g,k,c,null)}};d.forEach=function(e){r.isSome(this._head)&&this._head.forEach(e)};
d.infos=function*(){if(r.isSome(this._head))for(const e of this._head.values())yield e};d._insert=function(e,c,b,a,g){if(r.isNone(a)&&r.isNone(g)){const k=new q(this._target,this.geometryType,e,c,b);this._head=new v.List(k)}if(r.isNone(a)&&r.isSome(g))return this._insertAtHead(e,c,b,g);if(r.isSome(a)&&r.isNone(g))return this._insertAtEnd(e,c,b,a);if(r.isSome(a)&&r.isSome(g))return this._insertAtMiddle(e,c,b,a,g)};d._insertAtHead=function(e,c,b,a){e===a.data.materialKey&&c+b===a.data.indexFrom?(a.data.indexFrom=
c,a.data.indexCount+=b):(e=new q(this._target,this.geometryType,e,c,b),this._head=new v.List(e),this._head.next=a)};d._insertAtEnd=function(e,c,b,a){a.data.materialKey===e&&a.data.indexEnd===c?a.data.indexCount+=b:(e=new q(this._target,this.geometryType,e,c,b),e=new v.List(e),a.next=e)};d._insertAtMiddle=function(e,c,b,a,g){a.data.materialKey===e&&a.data.indexEnd===c?(a.data.indexCount+=b,a.data.materialKey===g.data.materialKey&&a.data.indexEnd===g.data.indexFrom&&(a.data.indexCount+=g.data.indexCount,
a.next=g.next)):e===g.data.materialKey&&c+b===g.data.indexFrom?(g.data.indexFrom=c,g.data.indexCount+=b):(e=new q(this._target,this.geometryType,e,c,b),e=new v.List(e),a.next=e,e.next=g)};return h}();y.FeatureDisplayList=w;y.FeatureDisplayListInfo=q;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../BufferPool ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(y,u,r,v,q,w,h){let d=function(){function e(b,a,g,k){k=v.TypedBuffer.create(a*g*Uint32Array.BYTES_PER_ELEMENT,k);this.size=a;this.strideInt=g;this.bufferType=b;this.dirty={start:Infinity,end:0};this._gpu=null;this._cpu=k;this.clear()}var c=e.prototype;c.invalidate=function(){this._invalidateTriangleBuffer();r.applySome(this._gpu,b=>b.dispose());this._gpu=null};c._invalidateTriangleBuffer=function(){r.applySome(this._gpuComputeTriangles,b=>b.dispose());this._gpuComputeTriangles=null};c.destroy=
function(){r.applySome(this._gpu,b=>b.dispose());r.applySome(this._gpuComputeTriangles,b=>b.dispose());r.applySome(this._cpu,b=>b.destroy());r.applySome(this._cpu2,b=>b.destroy())};c.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new q.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};c.ensure=function(b){if(!(this.maxAvailableSpace()>=b)&&b*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const a=this._cpu.length/this.strideInt;
b=Math.round(1.25*(a+b));this._cpu.expand(b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(a,b-a)}};c.set=function(b,a){this._cpu.array[b]!==a&&(this._cpu.array[b]=a,this.dirty.start=Math.min(b,this.dirty.start),this.dirty.end=Math.max(b,this.dirty.end))};c.getGPUBuffer=function(b,a=!1){if(!this.bufferSize)return null;if(a){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");r.isNone(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=
this._createComputeBuffer(b));return this._gpuComputeTriangles}r.isNone(this._gpu)&&(this._gpu=this._createBuffer(b));return this._gpu};c.getCPUBuffer=function(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);this._cpu2.set(this._cpu);return this._cpu2};c.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};c.insert=function(b,a,g,k){const l=g*this.strideInt;if(!l)return 0;b=new Uint32Array(b,
a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l);g=r.unwrapOrThrow(this.freeList.firstFit(g),"First fit region must be defined")*this.strideInt;a=g/this.strideInt-a;if(0!==k)for(let f=0;f<b.length;f++)b[f]+=k;this._cpu.array.set(b,g);this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,g+l);this.fillPointer=Math.max(this.fillPointer,g+l);return a};c.free=function(b,a,g){const k=b*this.strideInt,l=(b+a)*this.strideInt;if(!0===g)for(g=b;g!==b+a;g++)this._cpu.array[g*
this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,k);this.dirty.end=Math.max(this.dirty.end,l);this.freeList.free(b,a)};c.upload=function(){this.dirty.end&&(this._invalidateTriangleBuffer(),r.isNone(this._gpu)||this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)};c._createBuffer=function(b){const a=h.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?w.BufferObject.createIndex(b,a,this._cpu.array):w.BufferObject.createVertex(b,
a,this._cpu.array)};c._createComputeBuffer=function(b){const a=h.Usage.DYNAMIC_DRAW,g=new Uint32Array(this.fillPointer/3);for(let k=0;k<this.fillPointer;k+=3)g[k/3]=this._cpu.array[k];return w.BufferObject.createIndex(b,a,g)};u._createClass(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return this.bufferSize&&!this._gpu}},{key:"invalidatedComputeBuffer",get:function(){return this.bufferSize&&!this._gpuComputeTriangles}},{key:"bufferSize",
get:function(){return this._cpu.length/this.strideInt}}]);return e}();y.Buffer=d;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(y,u,r,v,q,w,h){r=function(d){function e(b){b=d.call(this,b)||this;b.tiles=new Map;return b}y._inheritsLoose(e,d);var c=e.prototype;c.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};c.acquireTile=function(b){const a=this.createTile(b);a.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(b.id,a);return a};c.forceAttributeTextureUpload=function(){};c.forEachTile=function(b){this.tiles.forEach(b)};c.releaseTile=function(b){this.tiles.delete(b.key.id);
this.disposeTile(b)};c.isUpdating=function(){let b=!0;this.tiles.forEach(a=>{b=b&&a.isReady});return!b};c.setHighlight=function(){};c.invalidateLabels=function(){};c.requestUpdate=function(){this.layerView.requestUpdate()};y._createClass(e,[{key:"updating",get:function(){return this.isUpdating()}}]);return e}(r.HandleOwner);u.__decorate([v.property()],r.prototype,"layer",void 0);u.__decorate([v.property()],r.prototype,"layerView",void 0);u.__decorate([v.property()],r.prototype,"tileInfoView",void 0);
u.__decorate([v.property()],r.prototype,"updating",null);return r=u.__decorate([h.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],r)})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),function(y,u,r,v,q,w,h){const d=
r("featurelayer-order-by-server-enabled");r=function(e){function c(a,g,k,l){a=e.call(this,a)||this;a._hitTestsRequests=[];a._layer=k;a._layerView=g;a._onUpdate=l;return a}u._inheritsLoose(c,e);var b=c.prototype;b.renderChildren=function(a){this.attributeView.update();this.hasAnimation&&a.painter.effects.integrate.draw(a,a.attributeView);e.prototype.renderChildren.call(this,a)};b.hasEmptyAttributeView=function(){return this.attributeView.isEmpty()};b.isUpdating=function(){return this.attributeView.isUpdating()};
b.hitTest=function(a){let g=this._hitTestsRequests.find(({x:l,y:f})=>l===a.x&&f===a.y);const k=v.createResolver();g?g.resolvers.push(k):(g={x:a.x,y:a.y,resolvers:[k]},this._hitTestsRequests.push(g));this.requestRender();return k.promise};b.onTileData=function(a,g){const k=d&&"orderBy"in this._layer&&this._layer.orderBy,l=k?.length&&!k[0].valueExpression&&k[0].field;a.patch(g,k&&this._layerView.orderByFields===l);this.contains(a)||this.addChild(a);this.requestRender()};b.onTileError=function(a){this.contains(a)||
this.addChild(a)};b.updateTransitionProperties=function(a,g){e.prototype.updateTransitionProperties.call(this,a,g);this._layerView.featureEffectView.transitionStep(a,g);this._layerView.featureEffectView.transitioning&&this.requestRender()};b.doRender=function(a){const {minScale:g,maxScale:k}=this._layer,l=a.state.scale;l<=(g||Infinity)&&l>=k&&e.prototype.doRender.call(this,a)};b.afterRender=function(a){e.prototype.afterRender.call(this,a);this._hitTestsRequests.length&&this.requestRender()};b.onAttributeStoreUpdate=
function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();this._onUpdate()};b.setStencilReference=function(a){const {rendererSchema:g}=a.rendererInfo;if("dot-density"===g?.type&&1<g?.dotSize||"heatmap"===g?.type)for(const k of this.children)k.stencilRef=k.key.level+1;else e.prototype.setStencilReference.call(this,a)};b.prepareRenderPasses=function(a){const g=a.registerRenderPass({name:"label",brushes:[q.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:h.WGLDrawPhase.LABEL|
h.WGLDrawPhase.LABEL_ALPHA}),k=a.registerRenderPass({name:"geometry",brushes:[q.brushes.fill,q.brushes.dotDensity,q.brushes.line,q.brushes.marker,q.brushes.heatmap,q.brushes.pieChart,q.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:a.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:a.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,
args:()=>this._layerView.featureEffectView.includedEffects},{apply:a.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),l=a.registerRenderPass({name:"highlight",brushes:[q.brushes.fill,q.brushes.dotDensity,q.brushes.line,q.brushes.marker,q.brushes.pieChart,q.brushes.text],target:()=>this.children,drawPhase:h.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:a.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...e.prototype.prepareRenderPasses.call(this,
a),k,l,g]};u._createClass(c,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some(g=>g.labelingInfo&&g.labelingInfo.length&&g.labelsVisible);var a=this._layer.featureReduction;a=a&&"labelingInfo"in a&&a.labelsVisible&&a.labelingInfo&&a.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!a}}]);return c}(w.FeatureContainer);y.WGLFeatureView=
r;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"*noref":1}});
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),function(y,
u,r,v,q,w,h,d,e,c,b,a,g,k,l){q=function(f){function p(){var m=f.apply(this,arguments)||this;m.type="symbol";return m}y._inheritsLoose(p,f);var n=p.prototype;n.install=function(m){const t=new l.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=t;m.addChild(t)};n.uninstall=function(m){m.removeChild(this.featuresView);this.featuresView.destroy();this.featuresView=null};n.fetchResource=function(m,t){({url:m}=m);const x=this.featuresView.stage;
try{return x.resourceManager.fetchResource(m,{signal:t.signal})}catch(z){return v.isAbortError(z)?Promise.resolve({width:0,height:0}):Promise.reject(z)}};n.isUpdating=function(){const m=f.prototype.isUpdating.call(this),t=!this.featuresView||this.featuresView.isUpdating();var x=this.featuresView?.hasEmptyAttributeView();x=m||t||m&&x;r("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${x}\n  -> updatingTiles ${m}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${t}`);
return x};n.hitTest=function(m){return this.featuresView.hitTest(m)};n.supportsRenderer=function(m){return null!=m&&"simple class-breaks unique-value dot-density dictionary heatmap pie-chart".split(" ").includes(m.type)};n.onConfigUpdate=function(m){var t=null;m&&"visualVariables"in m&&(t=(a.simplifyVVRenderer(m).visualVariables||[]).map(x=>{const z=x.clone();"normalizationField"in x&&(z.normalizationField=null);x.valueExpression&&"$view.scale"!==x.valueExpression&&(z.valueExpression=null,z.field=
"nop");return z}),t=k.convertVisualVariables(t));this.featuresView.setRendererInfo(m,t,this.layerView.featureEffect)};n.onTileData=function(m){const t=this.tiles.get(m.tileKey);if(t&&m.data)this.featuresView.onTileData(t,m.data);this.layerView.view.labelManager.requestUpdate()};n.onTileError=function(m){if(m=this.tiles.get(m.tileKey))this.featuresView.onTileError(m)};n.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()};n.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload();
this.tiles.forEach(m=>m.lock())};n.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(m=>m.unlock())};n.getMaterialItems=function(){var m=y._asyncToGenerator(function*(t){return this.featuresView.getMaterialItems(t)});return function(t){return m.apply(this,arguments)}}();n.invalidateLabels=function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()};n.createTile=function(m){const t=this.tileInfoView.getTileBounds(c.create(),
m),x=this.tileInfoView.getTileResolution(m.level);return new b.FeatureTile(m,x,t[0],t[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())};n.disposeTile=function(m){this.featuresView.removeChild(m);m.destroy();this.layerView.view.labelManager.requestUpdate()};return p}(g);return q=u.__decorate([e.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],q)});