// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),function(p,q,g,w,z,A,x,y){function l(b){return b.some(c=>c.globalId)}function h(b){return b.filter(c=>!c.error).map(c=>c.objectId??c.globalId)}function r(b,c){b=new Set(b);
for(const e of c.values())b.add(e);return b}function t(b,c){b=new Set(b);for(const e of c.values())b.delete(e);return b}g=function(b){function c(a){a=b.call(this,a)||this;a._hasGlobalIds=!1;return a}p._inheritsLoose(c,b);var e=c.prototype;e.normalizeCtorArgs=function(a){this._queueProcessor=new y.QueueProcessor({concurrency:1,process:a.process});return{}};e.destroy=function(){this.clear()};e.clear=function(){this._queueProcessor.clear()};e.push=function(a){const d=this._queueProcessor;var f=d.last();
switch(a.type){case "update":case "refresh":if(f?.type===a.type)return;d.push(a).finally(()=>this.notifyChange("updating"));break;case "edit":(f="processed-edit"===f?.type?f:null)&&d.popLast();a=this._mergeEdits(f,a);for(const k of a)d.push(k).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};e._mergeEdits=function(a,d){const {addedFeatures:f,deletedFeatures:k,updatedFeatures:m}=d.edits;if(this._hasGlobalIds=this._hasGlobalIds||l(f)||l(m)||l(k))return d=[...f,...m],[a,{type:"processed-edit",
edits:{addOrModified:d,removed:k}}];d=new Set(h(a?.edits.addOrModified??[]));a=new Set(h(a?.edits.removed??[]));const u=new Set([...h(f),...h(m)]),v=new Set(h(k));d=Array.from(r(t(d,v),u)).map(n=>({objectId:n}));a=Array.from(r(t(a,u),v)).map(n=>({objectId:n}));return[{type:"processed-edit",edits:{addOrModified:d,removed:a}}]};p._createClass(c,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return c}(g);q.__decorate([w.property({readOnly:!0})],g.prototype,"updating",null);
return g=q.__decorate([x.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],g)});