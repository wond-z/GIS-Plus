// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../rest/support/FeatureSet ./FeatureLayerView2D ./support/util".split(" "),function(m,k,p,l,q,n,h,B,t,u,v,w){function r(d,f){if(l.isNone(d)&&l.isNone(f))return null;const c={};l.isSome(f)&&
(c.geometry=f.toJSON());l.isSome(d)&&(c.where=d);return c}h=function(d){function f(){var a=d.apply(this,arguments)||this;a._enabledDataReceived=!1;a.errorString=null;a.connectionStatus="disconnected";return a}m._inheritsLoose(f,d);var c=f.prototype;c.initialize=function(){this.handles.add([q.watch(()=>this.layer?.purgeOptions,()=>this._update()),q.watch(()=>this.suspended,a=>{a?this._proxy.pauseStream():this._proxy.resumeStream()})])};c.on=function(a,b){"data-received"===a&&(this._enabledDataReceived=
!0,this._proxy.enableEvent("data-received",!0));const e=d.prototype.on.call(this,a,b),g=this;return{remove(){e.remove();"data-received"===a&&(g._proxy.closed||g.hasEventListener("data-received")||g._proxy.enableEvent("data-received",!1))}}};c.queryLatestObservations=function(a,b){if(!this.layer.timeInfo.endField&&!this.layer.timeInfo.startField)throw new p("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(a),
b).then(e=>{e=u.fromJSON(e);e.features.forEach(g=>{g.layer=this.layer;g.sourceLayer=this.layer});return e})};c.detach=function(){d.prototype.detach.call(this);this.connectionStatus="disconnected"};c._createClientOptions=function(){return{...d.prototype._createClientOptions.call(this),setProperty:a=>{this.set(a.propertyName,a.value)}}};c._createTileRendererHash=function(a){var b=JSON.stringify(this.layer.purgeOptions);const e=JSON.stringify(r(this.layer.definitionExpression,this.layer.geometryDefinition));
b=`${b}.${e})`;return d.prototype._createTileRendererHash.call(this,a)+b};c._createServiceOptions=function(){var a=m._asyncToGenerator(function*(){const b=this.layer,{objectIdField:e}=b,g=b.fields.map(x=>x.toJSON()),y=w.toJSONGeometryType(b.geometryType),z=b.timeInfo&&b.timeInfo.toJSON()||null,A=b.spatialReference?b.spatialReference.toJSON():null;return{type:"stream",fields:g,geometryType:y,objectIdField:e,timeInfo:z,source:this.layer.parsedUrl,serviceFilter:r(this.layer.definitionExpression,this.layer.geometryDefinition),
purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,spatialReference:A,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:b.customParameters}});return function(){return a.apply(this,arguments)}}();m._createClass(f,[{key:"connectionError",get:function(){if(this.errorString)return new p("stream-controller",this.errorString)}}]);return f}(v);
k.__decorate([n.property()],h.prototype,"errorString",void 0);k.__decorate([n.property({readOnly:!0})],h.prototype,"connectionError",null);k.__decorate([n.property()],h.prototype,"connectionStatus",void 0);return h=k.__decorate([t.subclass("esri.views.2d.layers.StreamLayerView2D")],h)});