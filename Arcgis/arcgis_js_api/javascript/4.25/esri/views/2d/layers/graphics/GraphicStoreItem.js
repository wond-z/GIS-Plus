// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry".split(" "),function(B,x,q,C,y,h,D,r,k){function z(d){d.coords.length=0;d.lengths.length=0}const n=new k,w=new k;
k=function(){function d(){this.bounds=q.create();this.graphic=null}d.acquire=function(b=null,e,c,f,a){let g;0===d._pool.length?g=new d:(g=d._pool.pop(),this._set.delete(g));g.acquire(b,e,c,f,a);return g};d.release=function(b){b&&!this._set.has(b)&&(b.release(),this._pool.push(b),this._set.add(b))};d.getCentroidQuantized=function(b,e){if(y.isPolygon(b.geometry)){const c=b.symbol;if(x.isNone(c))return null;if(0<c?.layers.length&&c.layers.some(f=>"text"===f.type||"marker"===f.type))return b=C.polygonCentroid(b.geometry),
null!==b?h.quantizePoint(e,{},{x:b[0],y:b[1]},!1,!1):null}return null};var t=d.prototype;t.acquire=function(b=null,e,c,f,a){b&&this.set(b,e,c,f,a)};t.release=function(){this.geometry=this.symbolResource=this.graphic=null};t.set=function(b,e,c,f,a){this.graphic=b;this.geometry=c;this.symbolResource=e;this.bounds=f;a&&(this.size=a)};t.getGeometryQuantized=function(b,e,c,f){var a=this.geometry;const g=y.getJsonType(a);if(x.isNone(g))return null;switch(g){case "esriGeometryPolygon":({rings:a}=a);if(!a||
0===a.length)return null;c=1===a.length&&2===a[0].length?h.quantizeGeometry(b,{paths:[[a[0][0],a[0][1]]]}):h.quantizeGeometry(b,this.geometry);if(!c&&(c=h.quantizeGeometry(b,{x:a[0][0][0],y:a[0][0][1]}))){const {x:u,y:p}=c;return{rings:[[[u-1,p],[1,-1],[1,1],[-1,1],[-1,-1]]]}}return c;case "esriGeometryPolyline":return z(n),z(w),r.convertFromPolyline(n,a),r.generalizeOptimizedGeometry(w,n,a.hasZ,a.hasM,"esriGeometryPolyline",b.scale[0]),r.quantizeOptimizedGeometry(n,w,a.hasZ,a.hasM,"esriGeometryPolyline",
b),r.convertToPolyline(n,a.hasZ,a.hasM);case "esriGeometryMultipoint":const l=.5*f*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]);c=D.getInfo(c);a=a.points;if(c){const [u,p]=c.valid,A=p-u;a=a.filter(m=>{if(m[0]+l>p||m[0]-l<u){const v=[...m];v[0]=m[0]+l>p?v[0]-A:v[0]+A;return q.containsPointWithMargin(e,m,l)||q.containsPointWithMargin(e,v,l)}return q.containsPointWithMargin(e,m,l)})}return 0===a.length?{points:a}:h.quantizeGeometry(b,{points:a})}return h.quantizeGeometry(b,
this.geometry)};B._createClass(d,[{key:"symbol",get:function(){return this.symbolResource.symbol}}]);return d}();k._pool=[];k._set=new Set;return k});