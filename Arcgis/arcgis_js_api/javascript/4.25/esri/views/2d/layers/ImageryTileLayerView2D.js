// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/maybe","../DimensionalDefinition"],function(A,K,C){function L(d,c,h){const v=c.shift();0===h.length&&h.push({sliceId:-1,multidimensionalDefinition:[]});const e=h.length;for(let m=0;m<e;m++){const f=h.shift().multidimensionalDefinition;v.values?.forEach(k=>{h.push({sliceId:-1,multidimensionalDefinition:[...f,{variableName:d,dimensionName:v.name,values:[k]}]})})}c.length&&L(d,c,h)}
function x(d,c){return Array.isArray(d)?c[0]===c[1]?d[0]===c[0]||d[1]===c[0]:d[0]>=c[0]&&d[0]<=c[1]&&d[1]>=c[0]&&d[1]<=c[1]:d>=c[0]&&d<=c[1]}function E(d,c){return d[0]<=c[0]&&d[1]>=c[0]||d[0]<=c[1]&&d[1]>=c[1]||d[0]>=c[0]&&d[1]<=c[1]}function y(d){return 1===d.length?[d[0],d[0]]:[d[0],d[d.length-1]]}function I(d,c,h){if(!c?.subsetDefinitions?.length)return d;if(h){const {variables:e}=c;if(e.length&&!e.includes(h))return null;c=c.subsetDefinitions.find(m=>m.dimensionName===d.name&&m.variableName===
h);if(!c?.values?.length)return d;c=y(c.values)}else c=c.dimensions.find(({name:e})=>e===d.name)?.extent;const v=c;if(!v||!v?.length)return d;c=d.values.filter(e=>x(e,v));return{...d,extent:[...v],values:c}}function u(d,c){var {values:h}=c;if(h?.length)return Array.isArray(h[0])!==Array.isArray(d)?-1:Array.isArray(h[0])?h.findIndex(m=>m[0]===d[0]&&m[1]===d[1]):h.indexOf(d);var {extent:v}=c;if(Array.isArray(d)||d<v[0]||d>v[1])return-1;h=c.interval||1;if("ISO8601"!==c.unit)return Math.round((d-v[0])/
h);v=v[0];let e=-1;switch(c.intervalUnit?.toLowerCase()||"seconds"){case "seconds":e=Math.round((d-v)/1E3/h);break;case "minutes":e=Math.round((d-v)/6E4/h);break;case "hours":e=Math.round((d-v)/36E5/h);break;case "days":e=Math.round((d-v)/864E5/h);break;case "months":c=(new Date(d)).getUTCFullYear()-(new Date(v)).getUTCFullYear();h=(new Date(v)).getUTCMonth();v=(new Date(d)).getUTCMonth();e=0===c?v-h:v+11-h+12*(c-1);break;case "years":e=Math.round(((new Date(d)).getUTCFullYear()-(new Date(v)).getUTCFullYear())/
h);break;case "decades":e=Math.round(((new Date(d)).getUTCFullYear()-(new Date(v)).getUTCFullYear())/10/h)}return e}function r(d){var c=d.values?.length;if(c)return c;const {extent:h,unit:v}=d;c=d.interval||1;var e=h?h[1]-h[0]:0;if("ISO8601"!==v)return Math.round(e/c);switch(d.intervalUnit?.toLowerCase()??"seconds"){case "seconds":c=Math.round(e/1E3/c);break;case "minutes":c=Math.round(e/6E4/c);break;case "hours":c=Math.round(e/36E5/c);break;case "days":c=Math.round(e/864E5/c);break;case "months":d=
(new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear();c=(new Date(h[1][0])).getUTCMonth();e=(new Date(h[1][1])).getUTCMonth();c=0===d?e-c+1:e+11-c+12*(d-1)+1;break;case "years":c=Math.round(((new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear())/c);break;case "decades":c=Math.round(((new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear())/10/c);break;default:c=0}return c}A.createSlices=function(d,c){const h=[];let v=0;(c?d.variables.filter(e=>e.name.toLowerCase()===
c.toLowerCase()):[...d.variables].sort((e,m)=>e.name>m.name?1:-1)).forEach(e=>{const m=[],f=[...e.dimensions].sort((k,J)=>k.name>J.name?-1:1);L(e.name,f,m);m.forEach(k=>{h.push({...k,sliceId:v++})})});return h};A.getDefaultMultidimensionalDefinition=function(d,c={}){const {multidimensionalInfo:h,keyProperties:v}=d;if(K.isNone(h))return null;const e=c.variableName||v?.DefaultVariable;({variables:d}=h);const {multidimensionalSubset:m}=c;m?.variables?.length&&(d=d.filter(({name:O})=>m.variables.includes(O)));
var f=e?d.find(({name:O})=>O===e)??d[0]:d[0];if(!f)return null;d=[];const {dimensions:k,name:J}=f;if(0===k.length)return[new C({variableName:J,dimensionName:"",values:[],isSlice:!0})];for(f=0;f<k.length;f++){const O=I(k[f],m,J);if(!O)return null;const {values:T,extent:U}=O;let da=T?.[0]??U[0];"stdz"===O.name.toLowerCase()&&!O.hasRanges&&Math.abs(U[1])<=Math.abs(U[0])&&(da=T?.length?T[T.length-1]:U[1]);d.push(new C({variableName:J,dimensionName:O.name,values:[da],isSlice:c.useRangeForRangedDimensionInfo?
!!O.hasRanges:!0}))}return d};A.getSliceIds=function(d,c,h){let v=d;c&&(c=[...c].sort((e,m)=>e.dimensionName<m.dimensionName?-1:1),c.forEach(({dimensionName:e,values:m,isSlice:f})=>{m.length&&(v=v.filter(k=>{k=k.multidimensionalDefinition.find(O=>O.dimensionName===e);if(null==k)return!1;const J=k.values[0];return"number"===typeof J?"number"===typeof m[0]?m.includes(J):m.some(O=>O[0]<=J&&O[1]>=J):"number"===typeof m[0]?m.some(O=>J[0]<=O&&J[1]>=O):f?m.some(O=>O[0]===J[0]&&O[0]===J[1]):m.some(O=>O[0]>=
J[0]&&O[0]<=J[1]||O[1]>=J[0]&&O[1]<=J[1]||O[0]<J[0]&&O[1]>J[1])}))}));if(v.length&&h&&K.isSome(h.start)&&K.isSome(h.end)){const e=h.start.getTime(),m=h.end.getTime(),f=v[0].multidimensionalDefinition.findIndex(k=>"StdTime"===k.dimensionName);-1<f&&(v=v.filter(k=>{k=k.multidimensionalDefinition[f].values[0];return e<=k&&m>=k}))}return v.map(e=>e.sliceId)};A.getSliceIndex=function(d,c){let h=0;var v=d[0].variableName;c=[...c.variables].sort((m,f)=>m.name>f.name?1:-1);for(var e=0;e<c.length;e++){const m=
c[e],f=[...m.dimensions].sort((k,J)=>k.name>J.name?-1:1);if(m.name!==v)h+=f.map(k=>r(k)).reduce((k,J)=>k*J);else{v=f.map(k=>r(k));c=f.length;for(let k=0;k<c;k++){e=d.find(J=>J.dimensionName===f[k].name);if(null==e)return null;e=u(e.values[0],f[k]);if(-1===e)return null;v.shift();h=k===c-1?h+e:h+e*v.reduce((J,O)=>J*O)}break}}return h};A.getSubsetVariablesFromMdInfo=function(d,c){if(K.isNone(c)||K.isNone(d))return null;c=c.variables.map(h=>({...h}));d?.variables?.length&&(c=c.filter(({name:h})=>d.variables.includes(h)),
c.forEach(h=>{h.dimensions=h.dimensions.map(v=>I(v,d,h.name))}));return c};A.hasExcludedVariableOrDimension=function(d,c,h){if(!c?.subsetDefinitions?.length)return!1;const {variables:v}=c;if(v.length&&d.some(({variableName:e})=>e&&!v.includes(e)))return!0;for(let e=0;e<d.length;e++){const m=d[e],f=c.subsetDefinitions.find(k=>(""===m.variableName||k.variableName===m.variableName)&&k.dimensionName===m.dimensionName);if(f?.values.length){const k=y(f.values);if(!m.isSlice&&2===m.values.length&&!Array.isArray(m.values[0])&&
m.values[0]!==m.values[1]&&h){if(!E(m.values,k))return!0}else if(m.values.some(J=>!x(J,k)))return!0}}return!1};A.isMultiSliceOrRangeDefinition=function(d){return K.isNone(d)||!d.length?!1:d.some(c=>{if(null==c.values)return!0;const h=c.values.length;return 0===h||1<h||!c.isSlice&&Array.isArray(c.values[0])})};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(A,K,C,L,x,E,y){var I;C=I=function(u){function r(d){d=u.call(this,d)||this;d.variableName=null;d.dimensionName=null;d.values=[];d.isSlice=!1;return d}A._inheritsLoose(r,u);r.prototype.clone=function(){return new I({variableName:this.variableName,dimensionName:this.dimensionName,values:L.clone(this.values),isSlice:this.isSlice})};return r}(C.JSONSupport);K.__decorate([x.property({type:String,json:{write:!0}})],C.prototype,"variableName",void 0);K.__decorate([x.property({type:String,json:{write:!0}})],
C.prototype,"dimensionName",void 0);K.__decorate([x.property({type:E.types.array(E.types.oneOf([E.types.native(Number),E.types.array(E.types.native(Number))])),json:{write:!0}})],C.prototype,"values",void 0);K.__decorate([x.property({type:Boolean,json:{write:!0}})],C.prototype,"isSlice",void 0);return C=I=K.__decorate([y.subclass("esri.layers.support.DimensionalDefinition")],C)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/HandleOwner ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c,h){L=function(v){function e(){var f=v.apply(this,arguments)||this;f._loadImagery=(k,J,O,T,U)=>d.loadImagery(f.layer,k,J,O,T,U);f._createFlowMesh=(k,J,O,T)=>f.layer.createFlowMesh({meshType:k,flowData:O,simulationSettings:J},{signal:T});f.attached=!1;f.container=null;f.layer=null;f.type="flow";f.timeExtent=null;f.redrawOrRefetch=A._asyncToGenerator(function*(){f._updateVisualization()});return f}A._inheritsLoose(e,v);var m=e.prototype;m.attach=function(){const {layer:f}=
this,k=()=>{this._loadImagery=(J,O,T,U,da)=>d.loadImagery(f,J,O,T,U,da);this._updateVisualization()};"multidimensionalDefinition"in f?this.handles.add(x.watch(()=>f.multidimensionalDefinition,k)):this.handles.add([x.watch(()=>f.mosaicRule,k),x.watch(()=>f.renderingRule,k),x.watch(()=>f.definitionExpression,k)]);this.container=new c;this._strategy=new h({flowContainer:this.container});this._updateVisualization()};m.detach=function(){this._strategy.destroy();this.container.removeAllChildren();this.container=
null;this.handles.removeAll()};m.update=function(f){f.stationary?this._strategy.update(f):this.layerView.requestUpdate()};m.hitTest=function(f){return new C({attributes:{},geometry:f.clone(),layer:this.layer})};m.moveEnd=function(){};m.doRefresh=function(){var f=A._asyncToGenerator(function*(){});return function(){return f.apply(this,arguments)}}();m._updateVisualization=function(){var {renderer:f}=this.layer;"flow"===f.type&&(f=r(f,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,
timeExtent:this.timeExtent}),this.container.flowStyle=f,this.layerView.requestUpdate())};A._createClass(e,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return e}(L.HandleOwner);K.__decorate([E.property()],L.prototype,"_strategy",void 0);K.__decorate([E.property()],L.prototype,"attached",void 0);K.__decorate([E.property()],L.prototype,"container",void 0);K.__decorate([E.property()],L.prototype,"layer",void 0);K.__decorate([E.property()],L.prototype,"layerView",
void 0);K.__decorate([E.property()],L.prototype,"type",void 0);K.__decorate([E.property()],L.prototype,"updating",null);K.__decorate([E.property()],L.prototype,"timeExtent",void 0);return L=K.__decorate([u.subclass("esri.views.2d.engine.flow.FlowView2D")],L)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define("../../../../core/maybe ./utils ./styles/Imagery ./styles/Particles ./styles/Stack ./styles/Streamlines".split(" "),function(A,K,C,L,x,E){return function(y,I){const {flowSpeed:u,
trailLength:r}=y,d=K.getFlowSimulationSettings(y);let c=null;const h={opacity:K.getOpacity(y),size:K.getSize(y)};let v=K.getColor(y);"none"===y.background?h.color=v:("constant"===v.kind&&(v={kind:"ramp",stops:[0,1],values:[0,0,0,1,v.value[0],v.value[1],v.value[2],v.value[3]],count:2}),c=new C.Imagery({loadImagery:I.loadImagery,timeExtent:I.timeExtent,color:v,opacity:{kind:"constant",value:[1]}}),h.color=K.getForegroundColor());I={loadImagery:I.loadImagery,createFlowMesh:I.createFlowMesh,simulationSettings:d,
timeExtent:I.timeExtent,trailLength:r,flowSpeed:u,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:h.color,opacity:h.opacity,size:h.size};y="butt"===y.trailCap||4>=K.getMax(K.getSize(y))?new E(I):new L.Particles(I);return A.isSome(c)?new x.Stack([c,y]):y}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/maybe","../../../../core/screenUtils"],function(A,K,C){function L(u){return"constant"===u.kind?u.value[0]:u.values[u.values.length-
1]}function x(u){u=u.toRgba();return[u[0]/255,u[1]/255,u[2]/255,u[3]]}function E(u){if(!u.hasVisualVariables("size"))return{kind:"constant",value:[C.pt2px(u.trailWidth)]};const r=u.getVisualVariablesForType("size")[0];u=[];const d=[];if(r.stops){for(c of r.stops)u.push(c.value),d.push(C.pt2px(c.size));var c=r.stops.length}else u.push(r.minDataValue,r.maxDataValue),d.push(C.pt2px(r.minSize),C.pt2px(r.maxSize)),c=2;return{kind:"ramp",stops:u,values:d,count:c}}function y(u,r,d,c){switch(r){case "int":u.setUniform1iv(d,
c);break;case "float":u.setUniform1fv(d,c);break;case "vec2":u.setUniform2fv(d,c);break;case "vec3":u.setUniform3fv(d,c);break;case "vec4":u.setUniform4fv(d,c)}}function I(u,r){return u===r?!0:K.isSome(u)&&K.isSome(r)?u.equals(r):!1}A.areStreamlinesCompatible=function(u,r){var d=u.simulationSettings,c=r.simulationSettings;let h;h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=d.collisions===c.collisions)&&d.density===c.density)&&d.interpolate===c.interpolate)&&d.lineCollisionWidth===c.lineCollisionWidth)&&d.lineSpacing===
c.lineSpacing)&&d.maxTurnAngle===c.maxTurnAngle)&&d.minSpeedThreshold===c.minSpeedThreshold)&&d.segmentLength===c.segmentLength)&&d.smoothing===c.smoothing)&&d.velocityScale===c.velocityScale)&&d.verticesPerLine===c.verticesPerLine;return h&&I(u.timeExtent,r.timeExtent)?d=(d=(d=(d=(d=u.loadImagery===r.loadImagery)&&u.createFlowMesh===r.createFlowMesh)&&u.color.kind===r.color.kind)&&u.opacity.kind===r.opacity.kind)&&u.size.kind===r.size.kind:!1};A.getColor=function(u){if(!u.hasVisualVariables("color"))return{kind:"constant",
value:x(u.color)};u=u.getVisualVariablesForType("color")[0];const r=[],d=[];for(const c of u.stops)r.push(c.value),Array.prototype.push.apply(d,x(c.color));return{kind:"ramp",stops:r,values:d,count:u.stops.length}};A.getFlowSimulationSettings=function(u){var r=E(u);r=L(r);const d=Math.max(r/2,5),c=Math.round(C.pt2px(u.maxPathLength)/d)+1,{density:h}=u;return{smoothing:C.pt2px(u.smoothing),interpolate:!0,velocityScale:"flow-from"===u.flowRepresentation?1:-1,verticesPerLine:c,minSpeedThreshold:.001,
segmentLength:d,maxTurnAngle:1,collisions:!0,lineCollisionWidth:r,lineSpacing:10,density:h}};A.getForegroundColor=function(u){return{kind:"constant",value:[.1,.1,.1,1]}};A.getMax=L;A.getOpacity=function(u){if(!u.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};u=u.getVisualVariablesForType("opacity")[0];const r=[],d=[];for(const c of u.stops)r.push(c.value),d.push(c.opacity);return{kind:"ramp",stops:r,values:d,count:u.stops.length}};A.getSize=E;A.setUniform=y;A.setUniforms=function(u,
r,d,c){"constant"===c.kind?y(u,d,`u_${r}`,c.value):(y(u,"float",`u_${r}_stops`,c.stops),y(u,d,`u_${r}_values`,c.values),u.setUniform1i(`u_${r}_count`,c.count))};A.timeExtentsEqual=I;A.toRgba=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(A,K,C,L,x,E,y,I,u){let r=function(){function e(f){this._params=f;this.animated=!1}var m=e.prototype;m.isCompatible=function(f){if(!(f instanceof e&&L.timeExtentsEqual(this._params.timeExtent,f._params.timeExtent)))return!1;let k;return k=(k=(k=this._params.loadImagery===f._params.loadImagery)&&this._params.color.kind===f._params.color.kind)&&this._params.opacity.kind===f._params.opacity.kind};m.load=function(){var f=K._asyncToGenerator(function*(k,J){const {extent:O,size:T}=k;C.throwIfAborted(J);
k=yield this._params.loadImagery(O,T[0],T[1],this._params.timeExtent,J);return new v(k,{color:this._params.color,opacity:this._params.opacity})});return function(k,J){return f.apply(this,arguments)}}();m.render=function(f,k,J){({context:f}=f);const {program:O}=J;f.setFaceCullingEnabled(!1);f.setBlendingEnabled(!0);f.setBlendFunction(E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA);f.useProgram(O);O.setUniformMatrix3fv("u_dvsMat3",k.dvsMat3);f.bindTexture(J.texture,0);O.setUniform1i("u_texture",
0);O.setUniform1f("u_Min",J.min);O.setUniform1f("u_Max",J.max);L.setUniforms(O,"color","vec4",this._params.color);L.setUniforms(O,"opacity","float",this._params.opacity);f.bindVAO(J.vertexArray);f.drawArrays(E.PrimitiveType.TRIANGLE_STRIP,0,4)};return e}();const d=new Map;d.set("a_position",0);d.set("a_texcoord",1);const c={geometry:[new u.VertexElementDescriptor("a_position",2,E.DataType.UNSIGNED_SHORT,0,8),new u.VertexElementDescriptor("a_texcoord",2,E.DataType.UNSIGNED_SHORT,4,8)]},h={vsPath:"raster/flow/imagery",
fsPath:"raster/flow/imagery",attributes:d};let v=function(){function e(f,k){this._flowData=f;this._values=k}var m=e.prototype;m.attach=function(f){var {context:k}=f;const {width:J,height:O}=this._flowData;var T={geometry:x.BufferObject.createVertex(k,E.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,J,0,1,1,0,O,0,0,J,O,1,0]))};T=new I.VertexArrayObject(k,d,c,T);var U=[];"ramp"===this._values.color.kind&&U.push("vvColor");"ramp"===this._values.opacity.kind&&U.push("vvOpacity");f=f.painter.materialManager.getProgram(h,
U);U=1E6;let da=-1E6;for(var Q=0;Q<O;Q++)for(var b=0;b<J;b++)if(0!==this._flowData.mask[Q*J+b]){var n=this._flowData.data[2*(Q*J+b)],t=this._flowData.data[2*(Q*J+b)+1];n=Math.sqrt(n*n+t*t);U=Math.min(U,n);da=Math.max(da,n)}Q=new Uint8Array(4*J*O);for(b=0;b<O;b++)for(n=0;n<J;n++)if(0!==this._flowData.mask[b*J+n]){t=this._flowData.data[2*(b*J+n)];const q=this._flowData.data[2*(b*J+n)+1];Q[4*(b*J+n)]=(Math.sqrt(t*t+q*q)-U)/(da-U)*255;Q[4*(b*J+n)+1]=0;Q[4*(b*J+n)+2]=0;Q[4*(b*J+n)+3]=255}else Q[4*(b*J+
n)]=0,Q[4*(b*J+n)+1]=0,Q[4*(b*J+n)+2]=0,Q[4*(b*J+n)+3]=0;k=new y.Texture(k,{pixelFormat:E.PixelFormat.RGBA,internalFormat:E.PixelFormat.RGBA,samplingMode:E.TextureSamplingMode.LINEAR,dataType:E.PixelType.UNSIGNED_BYTE,wrapMode:E.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:J,height:O},Q);this.vertexArray=T;this.program=f;this.texture=k;this.min=U;this.max=da;this._flowData=null};m.detach=function(){this.vertexArray.dispose();this.texture.dispose()};K._createClass(e,[{key:"ready",get:function(){return this.program.isCompiled}}]);
return e}();A.Imagery=r;A.ImageryResources=v;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(A,K,C,L,x,E,y,I){let u=function(){function v(m){this._params=
m}var e=v.prototype;e.isCompatible=function(m){return m instanceof v?L.areStreamlinesCompatible(this._params,m._params):!1};e.load=function(){var m=K._asyncToGenerator(function*(f,k){const {extent:J,size:O}=f;C.throwIfAborted(k);f=yield this._params.loadImagery(J,O[0],O[1],this._params.timeExtent,k);const {vertexData:T,indexData:U}=yield this._params.createFlowMesh("Particles",this._params.simulationSettings,f,k);return new h(T,U,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});
return function(f,k){return m.apply(this,arguments)}}();e.render=function(m,f,k){({context:m}=m);const {program:J}=k;m.setFaceCullingEnabled(!1);m.setBlendingEnabled(!0);m.setBlendFunction(E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA);m.useProgram(J);J.setUniform1f("u_time",f.time);J.setUniform1f("u_trailLength",this._params.trailLength);J.setUniform1f("u_flowSpeed",this._params.flowSpeed);J.setUniform1f("u_featheringSize",this._params.featheringSize);J.setUniform1f("u_featheringOffset",this._params.featheringOffset);
J.setUniform1f("u_introFade",this._params.introFade?1:0);J.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);J.setUniform1f("u_decayRate",this._params.decayRate);J.setUniformMatrix3fv("u_dvsMat3",f.dvsMat3);J.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3);L.setUniforms(J,"color","vec4",this._params.color);L.setUniforms(J,"opacity","float",this._params.opacity);L.setUniforms(J,"size","float",this._params.size);m.bindVAO(k.vertexArray);m.drawElements(E.PrimitiveType.TRIANGLES,k.indexCount,
E.DataType.UNSIGNED_INT,0)};K._createClass(v,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return v}();const r=new Map;r.set("a_xyts0",0);r.set("a_xyts1",1);r.set("a_typeIdDurationSeed",2);r.set("a_extrudeInfo",3);const d={geometry:[new I.VertexElementDescriptor("a_xyts0",4,E.DataType.FLOAT,0,64),new I.VertexElementDescriptor("a_xyts1",4,E.DataType.FLOAT,16,64),new I.VertexElementDescriptor("a_typeIdDurationSeed",4,E.DataType.FLOAT,32,64),new I.VertexElementDescriptor("a_extrudeInfo",
4,E.DataType.FLOAT,48,64)]},c={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:r};let h=function(){function v(m,f,k){this._vertexData=m;this._indexData=f;this._values=k}var e=v.prototype;e.attach=function(m){var {context:f}=m,k=x.BufferObject.createVertex(f,E.Usage.STATIC_DRAW,this._vertexData);const J=x.BufferObject.createIndex(f,E.Usage.STATIC_DRAW,this._indexData);f=new y.VertexArrayObject(f,r,d,{geometry:k},J);k=[];"ramp"===this._values.color.kind&&k.push("vvColor");"ramp"===
this._values.opacity.kind&&k.push("vvOpacity");"ramp"===this._values.size.kind&&k.push("vvSize");m=m.painter.materialManager.getProgram(c,k);this.vertexArray=f;this.program=m;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};e.detach=function(){this.vertexArray.dispose()};K._createClass(v,[{key:"ready",get:function(){return this.program.isCompiled}}]);return v}();A.Particles=u;A.ParticlesResources=h;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(A,K){let C=function(){function x(y){this._styles=y}var E=x.prototype;E.isCompatible=function(y){if(!(y instanceof x)||this._styles.length!==y._styles.length)return!1;const I=this._styles.length;for(let u=0;u<I;u++)if(!this._styles[u].isCompatible(y._styles[u]))return!1;return!0};E.load=function(){var y=K._asyncToGenerator(function*(I,u){const r=yield Promise.all(this._styles.map(d=>
d.load(I,u)));return new L(r)});return function(I,u){return y.apply(this,arguments)}}();E.render=function(y,I,u){for(let r=0;r<this._styles.length;r++)this._styles[r].render(y,I,u.resources[r])};K._createClass(x,[{key:"animated",get:function(){return this._styles.reduce((y,I)=>y||I.animated,!1)}}]);return x}(),L=function(){function x(y){this.resources=y}var E=x.prototype;E.attach=function(y){for(const I of this.resources)I.attach(y)};E.detach=function(){for(const y of this.resources)y.detach()};K._createClass(x,
[{key:"ready",get:function(){return this.resources.reduce((y,I)=>y&&I.ready,!0)}}]);return x}();A.Stack=C;A.StackResources=L;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(A,K,C,L,x,E,y){let I=function(){function h(e){this._params=e}var v=h.prototype;v.isCompatible=function(e){return e instanceof h?C.areStreamlinesCompatible(this._params,e._params):!1};v.load=function(){var e=A._asyncToGenerator(function*(m,f){const {extent:k,size:J}=m;K.throwIfAborted(f);m=yield this._params.loadImagery(k,J[0],J[1],this._params.timeExtent,f);const {vertexData:O,indexData:T}=yield this._params.createFlowMesh("Streamlines",this._params.simulationSettings,m,f);return new c(O,
T,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});return function(m,f){return e.apply(this,arguments)}}();v.render=function(e,m,f){({context:e}=e);const {program:k}=f;e.setFaceCullingEnabled(!1);e.setBlendingEnabled(!0);e.setBlendFunction(x.BlendFactor.ONE,x.BlendFactor.ONE_MINUS_SRC_ALPHA);e.useProgram(k);k.setUniform1f("u_time",m.time);k.setUniform1f("u_trailLength",this._params.trailLength);k.setUniform1f("u_flowSpeed",this._params.flowSpeed);k.setUniform1f("u_featheringSize",
this._params.featheringSize);k.setUniform1f("u_featheringOffset",this._params.featheringOffset);k.setUniform1f("u_introFade",this._params.introFade?1:0);k.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);k.setUniform1f("u_decayRate",this._params.decayRate);k.setUniformMatrix3fv("u_dvsMat3",m.dvsMat3);k.setUniformMatrix3fv("u_displayViewMat3",m.displayViewMat3);C.setUniforms(k,"color","vec4",this._params.color);C.setUniforms(k,"opacity","float",this._params.opacity);C.setUniforms(k,"size",
"float",this._params.size);e.bindVAO(f.vertexArray);e.drawElements(x.PrimitiveType.TRIANGLES,f.indexCount,x.DataType.UNSIGNED_INT,0)};A._createClass(h,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return h}();const u=new Map;u.set("a_positionAndSide",0);u.set("a_timeInfo",1);u.set("a_extrude",2);u.set("a_speed",3);const r={geometry:[new y.VertexElementDescriptor("a_positionAndSide",3,x.DataType.FLOAT,0,36),new y.VertexElementDescriptor("a_timeInfo",3,x.DataType.FLOAT,12,36),
new y.VertexElementDescriptor("a_extrude",2,x.DataType.FLOAT,24,36),new y.VertexElementDescriptor("a_speed",1,x.DataType.FLOAT,32,36)]},d={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:u};let c=function(){function h(e,m,f){this._vertexData=e;this._indexData=m;this._values=f}var v=h.prototype;v.attach=function(e){var {context:m}=e,f=L.BufferObject.createVertex(m,x.Usage.STATIC_DRAW,this._vertexData);const k=L.BufferObject.createIndex(m,x.Usage.STATIC_DRAW,this._indexData);
m=new E.VertexArrayObject(m,u,r,{geometry:f},k);f=[];"ramp"===this._values.color.kind&&f.push("vvColor");"ramp"===this._values.opacity.kind&&f.push("vvOpacity");"ramp"===this._values.size.kind&&f.push("vvSize");e=e.painter.materialManager.getProgram(d,f);this.vertexArray=m;this.program=e;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};v.detach=function(){this.vertexArray.dispose()};A._createClass(h,[{key:"ready",get:function(){return this.program.isCompiled}}]);return h}();
return I})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(A,K,C,L,x,E,y,I,u,r,d){function c(){c=K._asyncToGenerator(function*(b,n,t,q){const z=performance.now();var l=
h(n,t);const D=performance.now();t=e(n,l,t.width,t.height);n=performance.now();l=f(t,!0);t=performance.now();b="Streamlines"===b?k(l,10):J(l);l=performance.now();L("esri-2d-profiler")&&(Q.info("I.1","_createFlowFieldFromData (ms)",Math.round(D-z)),Q.info("I.2","_getStreamlines (ms)",Math.round(n-D)),Q.info("I.3","createAnimatedLinesData (ms)",Math.round(t-n)),Q.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(l-t)),Q.info("I.5","createFlowMesh (ms)",Math.round(l-z)),Q.info("I.6","Mesh size (bytes)",
b.vertexData.buffer.byteLength+b.indexData.buffer.byteLength));yield Promise.resolve();I.throwIfAborted(q);return b});return c.apply(this,arguments)}function h(b,n){const t=m(n.data,n.width,n.height,b.smoothing);return b.interpolate?(q,z)=>{const l=Math.floor(q),D=Math.floor(z);if(0>l||l>=n.width||0>D||D>=n.height)return[0,0];q-=l;z-=D;const F=l<n.width-1?l+1:l,P=D<n.height-1?D+1:D;return[(t[2*(D*n.width+l)]*(1-z)+t[2*(P*n.width+l)]*z)*(1-q)+(t[2*(D*n.width+F)]*(1-z)+t[2*(P*n.width+F)]*z)*q,(t[2*
(D*n.width+l)+1]*(1-z)+t[2*(P*n.width+l)+1]*z)*(1-q)+(t[2*(D*n.width+F)+1]*(1-z)+t[2*(P*n.width+F)+1]*z)*q]}:(q,z)=>{q=Math.round(q);z=Math.round(z);return 0>q||q>=n.width||0>z||z>=n.height?[0,0]:[t[2*(z*n.width+q)],t[2*(z*n.width+q)+1]]}}function v(b,n,t,q,z,l,D,F,P){const R=[];let S=0,[X,Y]=n(t,q);X*=b.velocityScale;Y*=b.velocityScale;R.push({x:t,y:q,t:S,speed:Math.sqrt(X*X+Y*Y)});for(let ha=0;ha<b.verticesPerLine;ha++){let [fa,a]=n(t,q);fa*=b.velocityScale;a*=b.velocityScale;const g=Math.sqrt(fa*
fa+a*a);if(g<b.minSpeedThreshold)break;const p=fa/g,B=a/g;t+=p*b.segmentLength;q+=B*b.segmentLength;S+=b.segmentLength/g;if(Math.acos(p*ia+B*ea)>b.maxTurnAngle)break;if(b.collisions){var ia=Math.round(t*P);var ea=Math.round(q*P);if(0>ia||ia>D-1||0>ea||ea>F-1)break;const G=l[ea*D+ia];if(-1!==G&&G!==z)break;l[ea*D+ia]=z}R.push({x:t,y:q,t:S,speed:g});ia=p;ea=B}return R}function e(b,n,t,q){const z=[],l=new u,D=1/Math.max(b.lineCollisionWidth,1),F=Math.round(t*D),P=Math.round(q*D),R=new Int32Array(F*P);
for(var S=0;S<R.length;S++)R[S]=-1;S=[];for(let X=0;X<q;X+=b.lineSpacing)for(let Y=0;Y<t;Y+=b.lineSpacing)S.push({x:Y,y:X,sort:l.getFloat()});S.sort((X,Y)=>X.sort-Y.sort);for(const {x:X,y:Y}of S)l.getFloat()<b.density&&(t=v(b,n,X,Y,z.length,R,F,P,D),2>t.length||z.push(t));return z}function m(b,n,t,q){if(0===q)return b;const z=Math.round(3*q),l=Array(2*z+1);var D=0;for(var F=-z;F<=z;F++){var P=Math.exp(-F*F/(q*q));l[F+z]=P;D+=P}for(q=-z;q<=z;q++)l[q+z]/=D;D=new Float32Array(b.length);for(q=0;q<t;q++)for(F=
0;F<n;F++){var R=P=0;for(var S=-z;S<=z;S++)if(!(0>F+S||F+S>=n)){var X=l[S+z];P+=X*b[2*(q*n+(F+S))];R+=X*b[2*(q*n+(F+S))+1]}D[2*(q*n+F)]=P;D[2*(q*n+F)+1]=R}b=new Float32Array(b.length);for(q=0;q<n;q++)for(F=0;F<t;F++){R=P=0;for(S=-z;S<=z;S++)0>F+S||F+S>=t||(X=l[S+z],P+=X*D[2*((F+S)*n+q)],R+=X*D[2*((F+S)*n+q)+1]);b[2*(F*n+q)]=P;b[2*(F*n+q)+1]=R}return b}function f(b,n){const t=new u;var q=b.reduce((F,P)=>F+P.length,0);q=new Float32Array(4*q);const z=Array(b.length);let l=0,D=0;for(const F of b){b=l;
for(const P of F)q[4*l]=P.x,q[4*l+1]=P.y,q[4*l+2]=P.t,q[4*l+3]=P.speed,l++;z[D++]={startVertex:b,numberOfVertices:F.length,totalTime:F[F.length-1].t,timeSeed:n?t.getFloat():0}}return{lineVertices:q,lineDescriptors:z}}function k(b,n){function t(ia,ea,ha,fa,a,g,p,B){const G=9*P;let w=0;F[G+w++]=ia;F[G+w++]=ea;F[G+w++]=1;F[G+w++]=ha;F[G+w++]=g;F[G+w++]=p;F[G+w++]=fa/2;F[G+w++]=a/2;F[G+w++]=B;P++;F[G+w++]=ia;F[G+w++]=ea;F[G+w++]=-1;F[G+w++]=ha;F[G+w++]=g;F[G+w++]=p;F[G+w++]=-fa/2;F[G+w++]=-a/2;F[G+w++]=
B;P++}const {lineVertices:q,lineDescriptors:z}=b;var l=b=0;for(var D of z)b+=2*D.numberOfVertices,l+=6*(D.numberOfVertices-1);const F=new Float32Array(9*b);D=new Uint32Array(l);let P=0;b=0;for(const ia of z){const {totalTime:ea,timeSeed:ha}=ia;let fa=l=null,a=null;var R=null,S=null,X=null;for(let g=0;g<ia.numberOfVertices;g++){R=q[4*(ia.startVertex+g)];const p=q[4*(ia.startVertex+g)+1],B=q[4*(ia.startVertex+g)+2],G=q[4*(ia.startVertex+g)+3];let w=null,M=null;var Y=null;let N=null;0<g&&(w=R-l,M=p-
fa,Y=Math.sqrt(w*w+M*M),w/=Y,M/=Y,1<g?(S=w+S,X=M+X,Y=Math.sqrt(S*S+X*X),S/=Y,X/=Y,Y=Math.min(1/(S*w+X*M),n),S*=Y,X*=Y,Y=-X,N=S):(Y=-M,N=w),null!==Y&&null!==N&&(t(l,fa,a,Y,N,ea,ha,G),D[b++]=P-2,D[b++]=P,D[b++]=P-1,D[b++]=P,D[b++]=P+1,D[b++]=P-1));l=R;fa=p;a=B;S=w;X=M;R=G}t(l,fa,a,-X,S,ea,ha,R)}return{vertexData:F,indexData:D}}function J(b){function n(W,V){var Z=B+w,ca=G+M,aa=Math.sqrt(Z*Z+ca*ca);Z/=aa;ca/=aa;var la=B*Z+G*ca,ja=w+N,ka=M+H;aa=Math.sqrt(ja*ja+ka*ka);ja/=aa;ka/=aa;var ba=w*ja+M*ka;aa=
Y;var na=ia,pa=ea,qa=ha;ca=-(ca/la);Z/=la;la=fa;var ra=a,ua=g,va=p;ka=-(ka/ba);ja/=ba;ba=16*S;let oa=0;for(const wa of[1,2])for(const xa of[1,2,3,4])P[ba+oa++]=aa,P[ba+oa++]=na,P[ba+oa++]=pa,P[ba+oa++]=qa,P[ba+oa++]=la,P[ba+oa++]=ra,P[ba+oa++]=ua,P[ba+oa++]=va,P[ba+oa++]=wa,P[ba+oa++]=xa,P[ba+oa++]=W,P[ba+oa++]=V,P[ba+oa++]=ca/2,P[ba+oa++]=Z/2,P[ba+oa++]=ka/2,P[ba+oa++]=ja/2,S++;R[X++]=S-8;R[X++]=S-7;R[X++]=S-6;R[X++]=S-7;R[X++]=S-5;R[X++]=S-6;R[X++]=S-4;R[X++]=S-3;R[X++]=S-2;R[X++]=S-3;R[X++]=S-
1;R[X++]=S-2}function t(W,V,Z,ca,aa,la){B=w;G=M;w=N;M=H;null==B&&null==G&&(B=w,G=M);if(null!=fa&&null!=a){N=W-fa;H=V-a;const ja=Math.sqrt(N*N+H*H);N/=ja;H/=ja}null!=B&&null!=G&&n(aa,la);Y=fa;ia=a;ea=g;ha=p;fa=W;a=V;g=Z;p=ca}function q(W,V){B=w;G=M;w=N;M=H;null==B&&null==G&&(B=w,G=M);null!=B&&null!=G&&n(W,V)}const {lineVertices:z,lineDescriptors:l}=b;let D=b=0;for(var F of l){const W=F.numberOfVertices-1;b+=8*W;D+=12*W}const P=new Float32Array(16*b),R=new Uint32Array(D);let S=0,X=0,Y,ia,ea,ha,fa,a,
g,p,B,G,w,M,N,H;for(const W of l){H=N=M=w=G=B=p=g=a=fa=ha=ea=ia=Y=null;const {totalTime:V,timeSeed:Z}=W;for(F=0;F<W.numberOfVertices;F++)t(z[4*(W.startVertex+F)],z[4*(W.startVertex+F)+1],z[4*(W.startVertex+F)+2],z[4*(W.startVertex+F)+3],V,Z);q(V,Z)}return{vertexData:P,indexData:R}}function O(b,n){const t=n.pixels,{width:q,height:z}=n,l=new Float32Array(q*z*2),D=n.mask||new Uint8Array(q*z*2);n.mask||D.fill(255);if("vector-uv"===b)for(b=0;b<q*z;b++)l[2*b]=t[0][b],l[2*b+1]=-t[1][b];else if("vector-magdir"===
b)for(b=0;b<q*z;b++){n=t[0][b];const F=E.deg2rad(t[1][b]),P=Math.sin(F-Math.PI/2);l[2*b]=Math.cos(F-Math.PI/2)*n;l[2*b+1]=P*n}return{data:l,mask:D,width:q,height:z}}function T(){T=K._asyncToGenerator(function*(b,n,t,q,z,l){const D=performance.now();var F=r.getInfo(n.spatialReference);if(!F)return t=yield U(b,n,t,q,z,l),L("esri-2d-profiler")&&Q.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-D)),L("esri-2d-profiler")&&Q.info("I.9","Number of parts",1),t;const [P,R]=F.valid,S=
Math.ceil(n.width/(R-P)),X=n.width/S,Y=Math.round(t/S);let ia=n.xmin;const ea=[];F=performance.now();for(let ha=0;ha<S;ha++){const fa=new d({xmin:ia,xmax:ia+X,ymin:n.ymin,ymax:n.ymax,spatialReference:n.spatialReference});ea.push(U(b,fa,Y,q,z,l));ia+=X}b=yield Promise.all(ea);L("esri-2d-profiler")&&Q.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-F));L("esri-2d-profiler")&&Q.info("I.9","Number of parts",b.length);q={data:new Float32Array(t*q*2),mask:new Uint8Array(t*q),width:t,
height:q};n=0;for(const ha of b){for(b=0;b<ha.height;b++)for(z=0;z<ha.width;z++)n+z>=t||(q.data[2*(b*t+n+z)]=ha.data[2*(b*ha.width+z)],q.data[2*(b*t+n+z)+1]=ha.data[2*(b*ha.width+z)+1],q.mask[b*t+n+z]=ha.mask[b*ha.width+z]);n+=ha.width}L("esri-2d-profiler")&&Q.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-D));return q});return T.apply(this,arguments)}function U(b,n,t,q,z,l){return da.apply(this,arguments)}function da(){da=K._asyncToGenerator(function*(b,n,t,q,z,l){const D=
{requestProjectedLocalDirections:!0,signal:l};y.isSome(z)&&(D.timeExtent=z);if("imagery"===b.type)return yield b.load({signal:l}),z=b.rasterInfo.dataType,b=yield b.fetchImage(n,t,q,D),!b||y.isNone(b.pixelData)||y.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(t*q*2),mask:new Uint8Array(t*q),width:t,height:q}:O(z,b.pixelData.pixelBlock);yield b.load({signal:l});z=b.rasterInfo.dataType;b=yield b.fetchPixels(n,t,q,D);return!b||y.isNone(b.pixelBlock)?{data:new Float32Array(t*q*2),mask:new Uint8Array(t*
q),width:t,height:q}:O(z,b.pixelBlock)});return da.apply(this,arguments)}const Q=x.getLogger("esri.views.2d.engine.flow.dataUtils");A.createAnimatedLinesData=f;A.createFlowMesh=function(b,n,t,q){return c.apply(this,arguments)};A.createParticlesMesh=J;A.createStreamlinesMesh=k;A.loadImagery=function(b,n,t,q,z,l){return T.apply(this,arguments)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(A,K,C,L){return function(x){function E(){var I=x.apply(this,arguments)||this;I.flowStyle=null;return I}A._inheritsLoose(E,x);var y=E.prototype;y.doRender=function(I){x.prototype.doRender.call(this,I)};y.prepareRenderPasses=function(I){const u=I.registerRenderPass({name:"flow",brushes:[K],target:()=>this.children,drawPhase:C.WGLDrawPhase.MAP});return[...x.prototype.prepareRenderPasses.call(this,I),u]};A._createClass(E,[{key:"requiresDedicatedFBO",
get:function(){return!1}}]);return E}(L)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c,h,v,e,m){function f(k,J){const O=new h({x:(k.xmax+k.xmin)/2,y:(k.ymax+k.ymin)/2,spatialReference:k.spatialReference});var T=k.xmax-k.xmin;const U=k.ymax-k.ymin,da=Math.abs(Math.cos(E.deg2rad(J))),Q=Math.abs(Math.sin(E.deg2rad(J)));J=da*T+Q*U;T=Q*T+da*U;k=new m({xmin:O.x-J/2,ymin:O.y-T/2,xmax:O.x+J/2,ymax:O.y+T/2,spatialReference:k.spatialReference});k.centerAt(O);return k}C=function(k){function J(T){T=k.call(this,T)||this;T._flowDisplayObject=new e.FlowDisplayObject;
T._loading=null;return T}A._inheritsLoose(J,k);var O=J.prototype;O.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};O.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};O.update=function(T){var {flowStyle:U}=this.flowContainer;if(y.isNone(U))this._clear();else{var {extent:da,rotation:Q,resolution:b,pixelRatio:n}=T.state;T=f(da,Q);T.expand(1.15);U=new v(U,T,[Math.round((T.xmax-T.xmin)/b),Math.round((T.ymax-T.ymin)/b)],n);if(y.isSome(this._loading)){if(this._loading.update(U))return;
this._loading.detach();this._loading=null}if(y.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(U))U.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},t=>{I.isAbortError(t)||(x.getLogger(this.declaredClass).error("A resource failed to load.",t),this._loading=null)}),this._loading=U}};O._clear=function(){this._flowDisplayObject.clear();y.isSome(this._loading)&&(this._loading.detach(),this._loading=
null)};A._createClass(J,[{key:"updating",get:function(){return null!=this._loading}}]);return J}(L);K.__decorate([u.property()],C.prototype,"_loading",void 0);K.__decorate([u.property()],C.prototype,"flowContainer",void 0);K.__decorate([u.property()],C.prototype,"updating",null);return C=K.__decorate([c.subclass("esri.views.2d.engine.flow.FlowStrategy")],C)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(A,
K){return function(){function C(x,E,y,I){this.state={name:"created"};this.flowStyle=x;this.extent=E;this.size=y;this.pixelRatio=I}var L=C.prototype;L.load=function(){var x=A._asyncToGenerator(function*(){const E=new AbortController;this.state={name:"loading",abortController:E};this.state={name:"loaded",resources:yield this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},E.signal)}});return function(){return x.apply(this,arguments)}}();L.attach=function(x){if("loaded"!==
this.state.name)K.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var E=this.state.resources;E.attach(x);this.state={name:"attached",resources:E}}};L.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};L.update=function(x){if(!this.flowStyle.isCompatible(x.flowStyle)||!this.extent.equals(x.extent)||
this.size[0]!==x.size[0]||this.size[1]!==x.size[1]||this.pixelRatio!==x.pixelRatio)return!1;this.flowStyle=x.flowStyle;return!0};return C}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(A,K,C,L,x,E,y){y=function(I){function u(){var d=I.apply(this,arguments)||this;d._displayData=null;return d}
K._inheritsLoose(u,I);var r=u.prototype;r.clear=function(){L.isSome(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())};r.setTransform=function(d){var {displayData:c}=this;if(!L.isNone(c)){var h=[0,0];d.toScreen(h,[c.extent.xmin,c.extent.ymax]);c=(c.extent.xmax-c.extent.xmin)/c.size[0]/d.resolution;var v=C.deg2rad(d.rotation),{dvs:e}=this.transforms;x.fromTranslation(e,[-1,1,0]);x.scale(e,e,[2/(d.size[0]*d.pixelRatio),-2/(d.size[1]*d.pixelRatio),1]);x.translate(e,
e,[h[0],h[1],0]);x.rotate(e,e,v);x.scale(e,e,[c*d.pixelRatio,c*d.pixelRatio,1])}};r._createTransforms=function(){return{dvs:E.create()}};K._createClass(u,[{key:"displayData",get:function(){return this._displayData},set:function(d){this._displayData=d;this.requestRender()}}]);return u}(y.DisplayObject);A.FlowDisplayObject=y;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c,h,v,e){const m=L.ofType({key:"type",base:null,typeMap:{rect:h,path:e,geometry:v}});A.LayerView2DMixin=f=>{f=function(k){function J(){var T=k.apply(this,arguments)||this;T.attached=!1;T.clips=new m;T.lastUpdateId=-1;T.moving=!1;T.updateRequested=!1;T.visibleAtCurrentScale=!1;return T}K._inheritsLoose(J,k);var O=J.prototype;O.initialize=function(){const T=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&T&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new E("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.handles.add([y.watch(()=>this.suspended,U=>{this.container&&(this.container.visible=!U);this.view&&!U&&this.updateRequested&&this.view.requestUpdate()},y.syncAndInitial),y.watch(()=>this.layer?.opacity??1,U=>{this.container&&(this.container.opacity=
U)},y.syncAndInitial),y.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",U=>{this.container&&(this.container.blendMode=U)},y.syncAndInitial),y.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,U=>{this.container&&(this.container.effect=U)},y.syncAndInitial),y.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},y.syncAndInitial),y.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?
this.layer.effectiveScaleRange:null}),({scale:U})=>{U=U&&this.isVisibleAtScale(U);U!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",U)},y.syncAndInitial)]),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(U=>{U===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};O.destroy=function(){this.processDetach();this.updateRequested=!1};O.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&
(this.attach(),this.attached=!0,this.requestUpdate())};O.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)};O.isVisibleAtScale=function(T){const U=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!U)return!0;const {minScale:da,maxScale:Q}=U;return(0===da||T<=da)&&(0===Q||T>=Q)};O.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};O.processUpdate=
function(T){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",T),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(T)))};O.hitTest=function(T,U){return Promise.resolve(null)};O.supportsSpatialReference=function(T){return!0};O.canResume=function(){return this.spatialReferenceSupported?k.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};O.getSuspendInfo=function(){const T=k.prototype.getSuspendInfo.call(this),U=!this.spatialReferenceSupported,
da=this.visibleAtCurrentScale;U&&(T.spatialReferenceNotSupported=U);da&&(T.outsideScaleRange=da);return T};K._createClass(J,[{key:"spatialReferenceSupported",get:function(){const T=this.view?.spatialReference;return null==T||this.supportsSpatialReference(T)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return J}(f);C.__decorate([I.property()],f.prototype,"attached",
void 0);C.__decorate([I.property({type:m,set(k){k=x.referenceSetter(k,this._get("clips"),m);this._set("clips",k)}})],f.prototype,"clips",void 0);C.__decorate([I.property()],f.prototype,"container",void 0);C.__decorate([I.property()],f.prototype,"moving",void 0);C.__decorate([I.property({readOnly:!0})],f.prototype,"spatialReferenceSupported",null);C.__decorate([I.property({readOnly:!0})],f.prototype,"updateParameters",void 0);C.__decorate([I.property()],f.prototype,"updateRequested",void 0);C.__decorate([I.property()],
f.prototype,"updating",null);C.__decorate([I.property()],f.prototype,"view",void 0);C.__decorate([I.property({readOnly:!0})],f.prototype,"visibleAtCurrentScale",void 0);return f=C.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],f)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(A,K,C,L,x,E,y){var I;L=I=function(u){function r(c){c=u.call(this,c)||this;c.type="rect";c.left=null;c.right=null;c.top=null;c.bottom=null;return c}A._inheritsLoose(r,u);var d=r.prototype;d.clone=function(){return new I({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};d.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return r}(y);K.__decorate([C.property({type:[Number,String],
json:{write:!0}})],L.prototype,"left",void 0);K.__decorate([C.property({type:[Number,String],json:{write:!0}})],L.prototype,"right",void 0);K.__decorate([C.property({type:[Number,String],json:{write:!0}})],L.prototype,"top",void 0);K.__decorate([C.property({type:[Number,String],json:{write:!0}})],L.prototype,"bottom",void 0);return L=I=K.__decorate([E.subclass("esri.views.layers.support.ClipRect")],L)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(A,K,C,L,x,E,y){C=function(I){function u(){return I.apply(this,arguments)||this}A._inheritsLoose(u,I);A._createClass(u,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return u}(C.JSONSupport);K.__decorate([L.property({readOnly:!0})],C.prototype,"version",null);return C=K.__decorate([y.subclass("esri.views.layers.support.ClipArea")],C)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c){var h;C={base:I,key:"type",typeMap:{extent:d,polygon:c}};r=h=function(v){function e(f){f=v.call(this,f)||this;f.type="geometry";f.geometry=null;return f}A._inheritsLoose(e,v);var m=e.prototype;m.clone=function(){return new h({geometry:this.geometry?.clone()??null})};m.commitVersionProperties=function(){this.commitProperty("geometry")};return e}(r);K.__decorate([L.property({types:C,json:{read:u.fromJSON,write:!0}})],r.prototype,"geometry",void 0);return r=h=K.__decorate([y.subclass("esri.views.layers.support.Geometry")],
r)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,K,C,L,x,E,y){L=function(I){function u(r){r=I.call(this,r)||this;r.type="path";r.path=[];return r}A._inheritsLoose(u,I);u.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return u}(y);K.__decorate([C.property({type:[[[Number]]],json:{write:!0}})],L.prototype,"path",void 0);return L=K.__decorate([E.subclass("esri.views.layers.support.Path")],L)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(A,K,C,L,x,E,y,I,u,r){x=function(d){function c(){var v=d.apply(this,arguments)||this;v.container=null;v.layer=null;v.type="raster";return v}A._inheritsLoose(c,d);var h=c.prototype;h.attach=function(){d.prototype.attach.call(this);this.container=new I.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme};h.detach=function(){d.prototype.detach.call(this);this.container.removeAllChildren();this.container=null};h.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&
this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&r.canUseMajorityInterpolationOnDataSource(this.layer))};h.fetchTile=function(v,e){return this.layer.fetchTile(v.level,v.row,v.col,e)};h.updateTileSource=function(){var v=A._asyncToGenerator(function*(e,m){const {bandIds:f}=this.layer,k=this._getLayerInterpolation(),J=this.canUseWebGLForProcessing(),{source:O,globalSymbolizerParams:T,suspended:U,coords:da,resolution:Q}=m;m=this.layerView.hasTilingEffects?T:m.symbolizerParams;
({bitmap:e}=e);[e.x,e.y]=da;e.resolution=Q;if(O&&C.isSome(O)&&C.isSome(O.pixelBlock)){var b={extent:O.extent,pixelBlock:O.pixelBlock};e.rawPixelData=b;J?(e.source=O.pixelBlock,e.isRendereredSource=!1):(b=yield this.layer.applyRenderer(b,"stretch"===T?.type?T:null),e.source=b,e.isRendereredSource=!0);e.symbolizerParameters=J?m:null;J?e.transformGrid||(e.transformGrid=O.transformGrid):e.transformGrid=null}else b=this.createEmptyTilePixelBlock(),e.source=b,e.symbolizerParameters=J?m:null,e.transformGrid=
null;e.bandIds=J?f:null;e.width=this._tileInfoView.tileInfo.size[0];e.height=this._tileInfoView.tileInfo.size[1];e.interpolation=k;e.suspended=U;e.invalidateTexture()});return function(e,m){return v.apply(this,arguments)}}();h.updateTileSymbolizerParameters=function(){var v=A._asyncToGenerator(function*(e,m){const {local:f,global:k}=m;({bandIds:m}=this.layer);const J=this._getLayerInterpolation(),O=this.canUseWebGLForProcessing();({bitmap:e}=e);const {rawPixelData:T}=e;!O&&C.isSome(T)?(e.source=yield this.layer.applyRenderer(T,
"stretch"===k?.type?k:null),e.isRendereredSource=!0):(e.isRendereredSource&&C.isSome(T)&&(e.source=T.pixelBlock),e.isRendereredSource=!1);e.symbolizerParameters=O?this.layerView.hasTilingEffects?k:f:null;e.bandIds=O?m:null;e.interpolation=J;e.suspended=!1});return function(e,m){return v.apply(this,arguments)}}();h._getLayerInterpolation=function(){var v=this.layer.renderer.type;if("raster-colormap"===v||"unique-value"===v||"class-breaks"===v)return"nearest";({interpolation:v}=this.layer);const {renderer:e}=
this.layer;return"raster-stretch"===e.type&&null!=e.colorRamp?"bilinear"===v||"cubic"===v?"bilinear":"nearest":v};return c}(u.BaseImageryTileSubView2D);K.__decorate([L.property()],x.prototype,"container",void 0);K.__decorate([L.property()],x.prototype,"layer",void 0);K.__decorate([L.property()],x.prototype,"type",void 0);return x=K.__decorate([y.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],x)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ../brushes ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(A,K,C,L,x,E,y,I){I=function(u){function r(){var c=u.apply(this,arguments)||this;c.isCustomTilingScheme=!1;return c}K._inheritsLoose(r,u);var d=r.prototype;d.createTile=function(c){const h=this._getTileBounds(c),[v,e]=this._tileInfoView.tileInfo.size,m=this._tileInfoView.getTileResolution(c.level);return new E.RasterTile(c,m,h[0],h[3],v,e)};d.prepareRenderPasses=function(c){const h=c.registerRenderPass({name:"imagery (tile)",brushes:[x.brushes.raster],target:()=>this.children.map(v=>v.bitmap),
drawPhase:y.WGLDrawPhase.MAP});return[...u.prototype.prepareRenderPasses.call(this,c),h]};d.doRender=function(c){this.visible&&c.drawPhase===y.WGLDrawPhase.MAP&&u.prototype.doRender.call(this,c)};d._getTileBounds=function(c){const h=this._tileInfoView.getTileBounds(C.create(),c);if(this.isCustomTilingScheme&&c.world){var {tileInfo:v}=this._tileInfoView,e=L.getWorldWidth(v.spatialReference);if(e){const {resolution:m}=v.lodAt(c.level);v=(e=e/m%v.size[0])?(v.size[0]-e)*m:0;h[0]-=v*c.world;h[2]-=v*c.world}}return h};
return r}(I);A.RasterTileContainer=I;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(A,K,C,L,x){x=function(E){function y(u,r,d,c,h,v,e=null){var m=E.call(this,u,r,d,c,h,v)||this;m.bitmap=new L.RasterBitmap(e,null,null);m.bitmap.coordScale=[h,v];m.bitmap.once("isReady",
()=>m.ready());return m}K._inheritsLoose(y,E);var I=y.prototype;I.destroy=function(){E.prototype.destroy.call(this);this.bitmap.destroy();this.stage=this.bitmap=null};I.setTransform=function(u){E.prototype.setTransform.call(this,u);this.bitmap.transforms.dvs=this.transforms.dvs};I._createTransforms=function(){return{dvs:C.create(),tileMat3:C.create()}};I.onAttach=function(){this.bitmap.stage=this.stage};I.onDetach=function(){this.bitmap.stage=null};K._createClass(y,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},
set:function(u){this.bitmap.stencilRef=u}}]);return y}(x.TiledDisplayObject);A.RasterTile=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/pixelUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/PagedTileQueue ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c,h,v,e,m,f,k,J,O,T,U,da,Q,b){const n=[0,0];A.BaseImageryTileSubView2D=function(t){function q(){var l=t.apply(this,arguments)||this;l._emptyTilePixelBlock=null;l._tileStrategy=null;l._tileInfoView=null;l._fetchQueue=null;l._blockCacheRegistryUrl=null;l._blockCacheRegistryId=null;l._srcResolutions=null;l.previousLOD=null;l._needBlockCacheUpdate=!1;l._globalSymbolizerParams=null;l._symbolizerParams=null;l._abortController=null;l._isCustomTilingScheme=!1;l._globalUpdateRequested=
!1;l.attached=!1;l.container=null;l.layer=null;l.timeExtent=null;l.redrawOrRefetch=I.debounce((D,F)=>!l.previousLOD||l.layerView.suspended?Promise.resolve():D?l.updatingHandles.addPromise(l.doRefresh()):l.updatingHandles.addPromise(l._redrawImage(F)));return l}K._inheritsLoose(q,t);var z=q.prototype;z.update=function(l){this._fetchQueue.pause();this._fetchQueue.state=l.state;this._tileStrategy.update(l);this._fetchQueue.resume();const {extent:D,resolution:F,scale:P}=l.state;l=this._tileInfoView.getClosestInfoForScale(P);
if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const R=this._srcResolutions[l.level],S=D.toJSON?D:b.fromJSON(D);m.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,S,F,R,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;this.previousLOD?.level!==l.level&&(this.previousLOD=l,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}};z.moveEnd=function(){if(this.layerView.hasTilingEffects||
!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const l=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(l);this.layerView.requestUpdate()};z.attach=function(){Q.getWebGLCapabilities("2d").supportsTextureFloat||(this.useWebGLForProcessing=!1);this._initializeTileInfo();
this._tileInfoView=new O(this.layerView.tileInfo,this.layerView.fullExtent);var l=this._computeFetchConcurrency();this._fetchQueue=new U({tileInfoView:this._tileInfoView,concurrency:l,process:(D,F)=>this._fetchTile1(D,F)});l=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new da({cachePolicy:"purge",acquireTile:D=>this.acquireTile(D),releaseTile:D=>this.releaseTile(D),cacheSize:l,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()};z.detach=function(){this._tileStrategy.destroy();
this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null};z.acquireTile=function(l){l=this.container.createTile(l);this._enqueueTileFetch(l);this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;return l};z.releaseTile=
function(l){this._fetchQueue.abort(l.key.id);this.container.removeChild(l);l.once("detach",()=>{l.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()};z.createEmptyTilePixelBlock=function(l=null){const D=null==l||l.join(",")===this._tileInfoView.tileInfo.size.join(",");if(D&&y.isSome(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;l=l||this._tileInfoView.tileInfo.size;const [F,P]=l;l=new v({width:F,height:P,pixels:[new Uint8Array(F*P)],mask:new Uint8Array(F*P),pixelType:"u8"});
D&&(this._emptyTilePixelBlock=l);return l};z._fetchTile1=function(l,D){D=y.isSome(D)&&D.signal;const F=this.canUseWebGLForProcessing(),{layerView:P}=this,R=!P.tileInfo.isWrappable&&y.isSome(k.getWorldWidth(P.view.spatialReference));D={allowPartialFill:!0,datumTransformation:P.datumTransformation,interpolation:F?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:F,signal:y.unwrap(D),srcResolution:this._srcResolutions[l.level],timeExtent:P.timeExtent,tileInfo:P.tileInfo,
disableWrapAround:R};return this.fetchTile(l,D)};z._getCacheSize=function(l){return l?40:0};z._initializeTileInfo=function(){var l=this.layerView.view.spatialReference;const D=new h({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:l}),{scales:F,srcResolutions:P,isCustomTilingScheme:R}=k.computeProjectedScales(this.layer.rasterInfo,l);l=e.create({spatialReference:l,size:512,scales:F});if(0===l.origin.x||l.origin.x>D.x)l.origin=D;this._isCustomTilingScheme=R;this.layerView.set("tileInfo",
l);this._srcResolutions=P??[]};z._computeFetchConcurrency=function(){var {blockBoundary:l}=this.layer.rasterInfo.storageInfo;l=l[l.length-1];return 64<(l.maxCol-l.minCol+1)*(l.maxRow-l.minRow+1)?2:10};z._enqueueTileFetch=function(){var l=K._asyncToGenerator(function*(D,F){this.updatingHandles.addPromise(this._enqueueTileFetch1(D,F))});return function(D,F){return l.apply(this,arguments)}}();z._enqueueTileFetch1=function(){var l=K._asyncToGenerator(function*(D,F){if(!this._fetchQueue.has(D.key.id)){try{const P=
yield this._fetchQueue.push(D.key),{bandIds:R}=this.layer;let S=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){S=!1;try{yield this._redrawImage(this._abortController&&this._abortController.signal)}catch(ia){I.isAbortError(ia)&&E.getLogger(this.declaredClass).error(ia)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||
null!=this._symbolizerParams||this._updateSymbolizerParams();const X=this._tileInfoView.getTileCoords(n,D.key),Y=this._tileInfoView.getTileResolution(D.key);yield this.updateTileSource(D,{source:P,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:S,bandIds:R,coords:X,resolution:Y});D.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(D)}catch(P){I.isAbortError(P)||E.getLogger(this.declaredClass).error(P)}this.layerView.requestUpdate()}});
return function(D,F){return l.apply(this,arguments)}}();z._redrawImage=function(){var l=K._asyncToGenerator(function*(D){var F=this;0!==this.container.children.length&&(yield this.layer.updateRenderer(),this.layerView.hasTilingEffects?yield this._updateGlobalSymbolizerParams(D):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),D=this.container.children.map(function(){var P=K._asyncToGenerator(function*(R){return F.updateTileSymbolizerParameters(R,{local:F._symbolizerParams,global:F._globalSymbolizerParams})});
return function(R){return P.apply(this,arguments)}}()),yield I.eachAlways(D),this.container.requestRender())});return function(D){return l.apply(this,arguments)}}();z._updateGlobalSymbolizerParams=function(){var l=K._asyncToGenerator(function*(D){(D=yield this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:D}))&&D.pixelBlock&&(D=this.layer.symbolizer.generateWebGLParameters({pixelBlock:f.extractBands(D.pixelBlock,
this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds}),!this.canUseWebGLForProcessing()&&D&&"stretch"===D.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(D.factor=D.factor.map(F=>255*F),D.outMin=Math.round(255*D.outMin),D.outMax=Math.round(255*D.outMax)),this._globalSymbolizerParams=D)});return function(D){return l.apply(this,arguments)}}();z._updateSymbolizerParams=
function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})};z._updateBlockCacheRegistry=function(l=!1){const {url:D,rasterInfo:F,raster:P}=this.layer;var {multidimensionalDefinition:R}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent});
R=F?.multidimensionalInfo?P.getSliceIndex(R):null;R=m.getRasterId(D,R);R!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=m.register(R,this.layer.raster.rasterInfo),l&&(l=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),m.update(R,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,this._srcResolutions[l.level],this.layer.raster.ioConfig.sampling)),
this._blockCacheRegistryUrl=R)};z.doRefresh=function(){var l=K._asyncToGenerator(function*(){if(this.attached){yield this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var D=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;this._tileStrategy.tiles.forEach(F=>D.push(this._enqueueTileFetch(F)));yield I.eachAlways(D)}});return function(){return l.apply(this,arguments)}}();
K._createClass(q,[{key:"useWebGLForProcessing",get:function(){return this._get("useWebGLForProcessing")??!0},set:function(l){this._set("useWebGLForProcessing",l)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(l){if(this._tileStrategy&&this.useProgressiveUpdate!==l){this._tileStrategy.destroy();this.container.removeAllChildren();const D=this._getCacheSize(l);this._tileStrategy=new da({cachePolicy:"purge",
acquireTile:F=>this.acquireTile(F),releaseTile:F=>this.releaseTile(F),cacheSize:D,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",l);this.layerView.requestUpdate()}}},{key:"updating",get:function(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return q}(x.HandleOwner);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"_fetchQueue",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,
"_globalUpdateRequested",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"attached",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"container",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"layer",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"layerView",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"type",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,
"useWebGLForProcessing",null);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);C.__decorate([u.property()],A.BaseImageryTileSubView2D.prototype,"updating",null);A.BaseImageryTileSubView2D=C.__decorate([c.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],A.BaseImageryTileSubView2D);Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),function(A,K,C,L,x,E){function y(r,d){return(r=I.get(r))?r[d]??null:null}const I=new Map,u=new L;A.decreaseRefCount=function(r,d,c){const h=I.get(r);if(!h)return null==d?u.decreaseRefCount(r,c):0;if(null==d||null==h[d])return u.decreaseRefCount(r,c);d=h[d]?.cache;r=d?.get(c);if(d&&r){r.refCount--;
if(0===r.refCount){d.delete(c);for(d=0;d<h.length;d++)h[d]?.cache.delete(c);r.controller&&r.controller.abort()}return r.refCount}return 0};A.deleteBlock=function(r,d,c){const h=I.get(r);h?null==d||null==h[d]?u.deleteBlock(r,c):h[d]?.cache.delete(c):null==d&&u.deleteBlock(r,c)};A.deleteRaster=function(r){I.delete(r)};A.getBlock=function(r,d,c){const h=I.get(r);if(!h)return null==d?u.getBlock(r,c):null;if(null==d||null==h[d]){for(d=0;d<h.length;d++){var v=h[d]?.cache.get(c);if(v)return v.refCount++,
v.block}return u.getBlock(r,c)}if(r=h[d]?.cache.get(c))return r.refCount++,r.block;for(r=0;r<h.length;r++){if(r===d||!h[r])continue;v=h[r]?.cache;const e=v?.get(c);if(v&&e)return e.refCount++,v.set(c,e),e.block}return null};A.getRasterId=function(r,d){return null==d?r:`${r}?sliceId=${d}`};A.putBlock=function(r,d,c,h,v=null){const e=I.get(r);if(e)if(null==d||null==e[d])u.putBlock(r,c,h,v);else{var m={refCount:1,block:h,isResolved:!1,isRejected:!1,controller:v};h.then(()=>m.isResolved=!0).catch(()=>
m.isRejected=!0);e[d]?.cache.set(c,m)}else null==d&&u.putBlock(r,c,h,v)};A.register=function(r,d){d={extent:null,rasterInfo:d,cache:new Map};const c=I.get(r);if(c)return c.push(d),c.length-1;I.set(r,[d]);return 0};A.unregister=function(r,d){const c=I.get(r);c&&(c[d]=null,c.some(h=>null!=h)||I.delete(r))};A.update=function(r,d,c,h,v,e,m=null){if(r=y(r,d)){d=r.extent;var {cache:f,rasterInfo:k}=r;if(!d||d.xmin!==c.xmin||d.xmax!==c.xmax||d.ymin!==c.ymin||d.ymax!==c.ymax){h=h??0;d=c.clone().normalize();
var {spatialReference:J,transform:O}=k,T=new Set;for(let t=0;t<d.length;t++){var U=d[t];if(U.xmax-U.xmin<=h||U.ymax-U.ymin<=h)continue;var da=x.projectExtent(U,J,m);C.isSome(O)&&(da=O.inverseTransform(da));var Q=new E({x:h,y:h,spatialReference:U.spatialReference});if(null==v&&(v=x.projectResolution(Q,J,U,m),!v))return;const {pyramidLevel:q,pyramidResolution:z,excessiveReading:l}=x.snapPyramid(v,k,e||"closest");if(l)return;({storageInfo:U}=k);var {origin:b}=U;Q=Math.max(0,Math.floor((da.xmin-b.x)/
z.x));b=Math.max(0,Math.floor((b.y-da.ymax)/z.y));const D=0<q?U.pyramidBlockWidth:U.blockWidth,F=0<q?U.pyramidBlockHeight:U.blockHeight;U=Math.max(0,Math.floor(Q/D)-1);var n=Math.max(0,Math.floor(b/F)-1);Q=Math.floor((Q+Math.ceil((da.xmax-da.xmin)/z.x-.1)-1)/D)+1;da=Math.floor((b+Math.ceil((da.ymax-da.ymin)/z.y-.1)-1)/F)+1;for(b=n;b<=da;b++)for(n=U;n<=Q;n++)T.add(`${q}/${b}/${n}`)}f.forEach((t,q)=>{T.has(q)||(t=f.get(q),(null==t||t.isResolved||t.isRejected)&&f.delete(q))});r.extent={xmin:c.xmin,ymin:c.ymin,
xmax:c.xmax,ymax:c.ymax}}}};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function A(C=15E3,L=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=C;this._interval=Math.min(C,L)}var K=A.prototype;K.decreaseRefCount=function(C,L){C=C+"/"+L;L=this._cachedBlocks;if(L.has(C)){const x=L.get(C);x.refCount--;0>=x.refCount&&(L.delete(C),
x.controller&&x.controller.abort());return x.refCount}return 0};K.getBlock=function(C,L){C=C+"/"+L;L=this._cachedBlocks;if(L.has(C)){const x=L.get(C);x.ts=Date.now();x.refCount++;L.delete(C);L.set(C,x);return x.block}return null};K.putBlock=function(C,L,x,E){const y=this._cachedBlocks;C=C+"/"+L;y.has(C)?(x=y.get(C),x.ts=Date.now(),x.refCount++):y.set(C,{block:x,ts:Date.now(),refCount:1,controller:E});this._trim();this._updateTimer()};K.deleteBlock=function(C,L){const x=this._cachedBlocks;C=C+"/"+
L;x.has(C)&&x.delete(C)};K.updateMaxSize=function(C){this._size=C;this._trim()};K.empty=function(){this._cachedBlocks.clear();this._clearTimer()};K.getCurrentSize=function(){return this._cachedBlocks.size};K._updateTimer=function(){if(null==this._timer){var C=this._cachedBlocks;this._timer=setInterval(()=>{const L=Array.from(C),x=Date.now();for(let E=0;E<L.length;E++)if(L[E][1].ts<=x-this._duration)C.delete(L[E][0]);else break;0===C.size&&this._clearTimer()},this._interval)}};K._trim=function(){const C=
this._cachedBlocks;if(!(-1===this._size||this._size>=C.size)){var L=Array.from(C);for(let x=0;x<L.length-this._size;x++)C.delete(L[x][0])}};K._clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return A}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c){function h(a,g,p){return!I.canProjectWithoutEngine(a,g,p)}function v(a,g,p){if((a=h(a,g,p))&&!I.isLoaded())throw new L("rasterprojectionhelper-project","projection engine is not loaded");return a}function e(){e=K._asyncToGenerator(function*(){I.isLoaded()||(yield I.load())});return e.apply(this,arguments)}function m(a,g,p,B=null){const G=a.spatialReference;if(G.equals(g))return a;v(G,g,B);p=p.center;p=new u({xmin:p.x-a.x/2,xmax:p.x+a.x/2,ymin:p.y-a.y/2,ymax:p.y+a.y/
2,spatialReference:G});B=I.project(p,g,B);p=D(g);x.isNone(B)||x.isSome(p)&&B.width>=p?(g=E.getMetersPerUnitForSR(G)/E.getMetersPerUnitForSR(g),a={x:a.x*g,y:a.y*g}):a={x:B.width,y:B.height};return a}function f(a,g=.01){return E.getMetersPerUnitForSR(a)?g/E.getMetersPerUnitForSR(a):0}function k(a,g,p=null,B=!0){const G=a.spatialReference;if(G.equals(g))return a;v(G,g,p);p=I.project(a,g,p);if(!B||!p)return p;J([a],[p],G,g);return p}function J(a,g,p,B){const G=F(p,!0),w=F(B,!0);p=f(p,500);B=f(B,500);
if(p&&x.isSome(G)&&x.isSome(w))for(let M=0;M<a.length;M++){const N=g[M];if(!N)continue;const {x:H}=a[M],{x:W}=N;W>=w[1]-B&&Math.abs(H-G[0])<p?N.x-=w[1]-w[0]:W<=w[0]+B&&Math.abs(H-G[1])<p&&(N.x+=w[1]-w[0])}}function O(a){const {inSR:g,outSR:p,datumTransformation:B,preferPE:G}=a;if(g.equals(p))return{points:a}=b(a,null),a;if(g.isWebMercator&&p.isWGS84||g.isWGS84&&p.isWebMercator){const {cols:W,rows:V,xres:Z,yres:ca,usePixelCenter:aa,inSR:la,outSR:ja}=a;let {xmin:ka,ymax:ba}=a;aa&&(ka+=Z/2,ba-=ca/2);
a=[];var w=[],M=Math.max(W,V);for(var N=0;N<M;N++){var H=I.project(new r({x:ka+Z*Math.min(W,N),y:ba-ca*Math.min(V,N),spatialReference:la}),ja);N<=W&&a.push(H.x);N<=V&&w.push(H.y)}M=[];for(N=0;N<W;N++)for(H=0;H<V;H++)M.push([a[N],w[H]]);return M}if(v(g,p,B)&&G){if(g.isGeographic)return U(a);w=da(g);if(x.isSome(w))return U(a)}return T(a)}function T(a){var {points:g}=b(a,null);const {inSR:p,outSR:B,datumTransformation:G}=a;a=g.map(w=>new r(w[0],w[1],p));g=I.project(a,B,G);G&&J(a,g,p,B);return g.map(w=>
w?[w.x,w.y]:[NaN,NaN])}function U(a){const {inSR:g,outSR:p,datumTransformation:B}=a;var G=da(g);const {points:w,mask:M}=b(a,G);g.isGeographic||(a=g.wkid?y.PeFactory.coordsys(g.wkid):y.PeFactory.fromString(g.isGeographic?y.PeDefs.PE_TYPE_GEOGCS:y.PeDefs.PE_TYPE_PROJCS,g.wkt),y.PeCSTransformations.projToGeog(a,w.length,w));if(x.isSome(B)&&B.steps.length){var N;p.isGeographic&&(N=w.map(([H])=>179.9955<H?1:-179.9955>H?-1:0));B.steps.forEach(H=>{const W=H.wkid?y.PeFactory.geogtran(H.wkid):y.PeFactory.fromString(y.PeDefs.PE_TYPE_GEOGTRAN,
H.wkt);y.PeGTTransformations.geogToGeog(W,w.length,w,null,H.isInverse?y.PeDefs.PE_TRANSFORM_2_TO_1:y.PeDefs.PE_TRANSFORM_1_TO_2)});if(N)for(a=0;a<w.length;a++){G=N[a];const H=w[a][0],W=179.9955<H?1:-179.9955>H?-1:0;G&&W&&G!==W&&(w[a][0]=0<G?H+360:H-360)}}p.isGeographic||(N=da(p,!0),N=x.isSome(N)&&N.isEnvelope?[N.bbox[1],N.bbox[3]]:[-90,90],n(w,N),N=p.wkid?y.PeFactory.coordsys(p.wkid):y.PeFactory.fromString(p.isGeographic?y.PeDefs.PE_TYPE_GEOGCS:y.PeDefs.PE_TYPE_PROJCS,p.wkt),y.PeCSTransformations.geogToProj(N,
w.length,w));N=w;if(M&&w.length!==M.length){N=[];for(let H=0,W=0;H<M.length;H++)M[H]?N.push(w[W++]):N.push([NaN,NaN])}return N}function da(a,g=!1){var p=a.wkid||a.wkt;if(!p||a.isGeographic)return null;p=String(p);if(ha.has(p))return p=ha.get(p),g?p?.gcs:p?.pcs;var B=a.wkid?y.PeFactory.coordsys(a.wkid):y.PeFactory.fromString(a.isGeographic?y.PeDefs.PE_TYPE_GEOGCS:y.PeDefs.PE_TYPE_PROJCS,a.wkt);a=f(a,1E-4);a=Q(B,a);B=Q(B,0,!0);ha.set(p,{pcs:a,gcs:B});return g?B:a}function Q(a,g=0,p=!1){var B=y.PePCSInfo.generate(a),
G=p?a.horizonGcsGenerate():a.horizonPcsGenerate();if(!B||!G?.length)return null;a=!1;var w=G.find(V=>1===V.getInclusive()&&1===V.getKind());if(!w){w=G.find(V=>1===V.getInclusive()&&0===V.getKind());if(!w)return null;a=!0}p=p?0:(2===B.getNorthPoleLocation()?1:0)|(2===B.getSouthPoleLocation()?2:0);B=B.isPannableRectangle();w=w.getCoord();if(a)return{isEnvelope:a,isPannable:B,vertices:w,coef:null,bbox:[w[0][0]-g,w[0][1]-g,w[1][0]+g,w[1][1]+g],poleLocation:p};g=0;a=[];let [M,N]=w[0],[H,W]=w[0];for(let V=
0,Z=w.length;V<Z;V++){g++;g===Z&&(g=0);const [ca,aa]=w[V],[la,ja]=w[g];if(ja===aa)a.push([ca,la,aa,ja,2]);else{G=(la-ca)/(ja-aa||1E-4);const ka=ca-G*aa;aa<ja?a.push([G,ka,aa,ja,0]):a.push([G,ka,ja,aa,1])}M=M<ca?M:ca;N=N<aa?N:aa;H=H>ca?H:ca;W=W>aa?W:aa}return{isEnvelope:!1,isPannable:B,vertices:w,coef:a,bbox:[M,N,H,W],poleLocation:p}}function b(a,g){const p=[],{cols:B,rows:G,xres:w,yres:M,usePixelCenter:N}=a;let {xmin:H,ymax:W}=a;N&&(H+=w/2,W-=M/2);if(x.isNone(g)){for(a=0;a<B;a++)for(g=0;g<G;g++)p.push([H+
w*a,W-M*g]);return{points:p}}a=new Uint8Array(B*G);if(g.isEnvelope){const {bbox:[ka,ba,na,pa]}=g;for(let qa=0,ra=0;qa<B;qa++){var V=H+w*qa,Z=g.isPannable||V>=ka&&V<=na;for(var ca=0;ca<G;ca++,ra++){var aa=W-M*ca;Z&&aa>=ba&&aa<=pa&&(p.push([V,aa]),a[ra]=1)}}return{points:p,mask:a}}V=g.coef;g=[];for(Z=0;Z<G;Z++){var la=W-M*Z;ca=[];aa=[];for(var ja=0;ja<V.length;ja++){const [ka,ba,na,pa,qa]=V[ja];la===na&&na===pa?(ca.push(ka),ca.push(ba),aa.push(2),aa.push(2)):la>=na&&la<=pa&&(ca.push(ka*la+ba),aa.push(qa))}la=
ca;if(2<ca.length){ja=2===aa[0]?0:aa[0];let ka=ca[0];la=[];for(let ba=1;ba<aa.length;ba++)if(2!==aa[ba]||ba===aa.length-1)aa[ba]!==ja&&(la.push(0===ja?Math.min(ka,ca[ba-1]):Math.max(ka,ca[ba-1])),ja=aa[ba],ka=ca[ba]),ba===aa.length-1&&la.push(0===aa[ba]?Math.min(ka,ca[ba]):Math.max(ka,ca[ba]));la.sort((ba,na)=>ba-na)}else ca[0]>ca[1]&&(la=[ca[1],ca[0]]);g.push(la)}for(let ka=0,ba=0;ka<B;ka++)for(V=H+w*ka,Z=0;Z<G;Z++,ba++)if(ca=W-M*Z,aa=g[Z],2===aa.length)V>=aa[0]&&V<=aa[1]&&(p.push([V,ca]),a[ba]=
1);else if(2<aa.length){la=!1;for(ja=0;ja<aa.length;ja+=2)if(V>=aa[ja]&&V<=aa[ja+1]){la=!0;break}la&&(p.push([V,ca]),a[ba]=1)}return{points:p,mask:a}}function n(a,g){const [p,B]=g;for(g=0;g<a.length;g++){const G=a[g][1];if(G<p||G>B)a[g]=[NaN,NaN]}}function t(a){const g=D(a[0].spatialReference);if(2>a.length||x.isNone(g))return a[0];let {xmin:p,xmax:B,ymin:G,ymax:w}=a[0];for(let M=1;M<a.length;M++){const N=a[M];B=N.xmax+g*M;G=Math.min(G,N.ymin);w=Math.max(w,N.ymax)}return new u({xmin:p,xmax:B,ymin:G,
ymax:w,spatialReference:a[0].spatialReference})}function q(a,g,p=null,B=!0){var G=a.spatialReference;if(G.equals(g))return a;var w=R(a);const M=D(G,!0);var N=D(g);if(0===w||x.isNone(M)||x.isNone(N))return w=l(a,g,p,B),x.isNone(M)&&x.isSome(N)&&Math.abs(w.width-N)<f(g)&&I.isLoaded()&&(G=da(G),x.isSome(G)&&G.poleLocation===Y.None&&a.width<(G.bbox[2]-G.bbox[0])/2)?z(a,g)||w:w;N=a.clone().normalize();if(1===N.length&&a.xmax<M&&a.xmax-M/2>f(G)){const {xmin:H,xmax:W}=a;for(let V=0;V<=w;V++)N[V]=new u({xmin:0===
V?H:-M/2,xmax:V===w?W-M*V:M/2,ymin:a.ymin,ymax:a.ymax,spatialReference:G})}a=N.map(H=>l(H,g,p,B));return t(a.filter(x.isSome))}function z(a,g){const p=D(g);if(x.isNone(p))return null;let {xmin:B,ymin:G,xmax:w,ymax:M}=a;var N=a.spatialReference;a=new d({spatialReference:N,rings:[[[B,G],[w,G],[w,M],[B,M],[B,G]]]});a=I.project(a,g);if(2!==a.rings.length||!a.rings[0].length||!a.rings[1].length)return null;({rings:a}=a);N=f(N);g=new u({spatialReference:g});for(let H=0;2>H;H++){B=w=a[H][0][0];G=M=a[H][0][1];
for(let W=0;W<a[H].length;W++)B=B>a[H][W][0]?a[H][W][0]:B,w=w<a[H][W][0]?a[H][W][0]:w,G=G>a[H][W][1]?a[H][W][1]:G,M=M<a[H][W][1]?a[H][W][1]:M;if(0===H)g.ymin=G,g.ymax=M,g.xmin=B,g.xmax=w;else if(g.ymin=Math.min(g.ymin,G),g.ymax=Math.max(g.ymax,M),Math.abs(w-p/2)<N)g.xmin=B,g.xmax+=p;else if(Math.abs(B+p/2)<N)g.xmax=w+p;else return null}return g}function l(a,g,p=null,B=!0,G=!0){const w=a.spatialReference;if(w.equals(g)||!g)return a;v(w,g,p);const M=I.project(a,g,p);if(G&&g.isWebMercator&&M&&(M.ymax=
Math.min(2.0037508342787E7,M.ymax),M.ymin=Math.max(-2.0037508342787E7,M.ymin),M.ymin>=M.ymax))return null;if(!B||!M)return M;var N=F(w,!0);B=F(g,!0);if(x.isNone(N)||x.isNone(B))return M;G=f(w,.001);const H=f(w,500);var W=f(g,.001);if(Math.abs(M.xmin-B[0])<W&&Math.abs(M.xmax-B[1])<W){W=Math.abs(a.xmin-N[0]);N=Math.abs(N[1]-a.xmax);if(W<G&&N>H){M.xmin=B[0];var V=[];V.push(new r(a.xmax,a.ymin,w));V.push(new r(a.xmax,(a.ymin+a.ymax)/2,w));V.push(new r(a.xmax,a.ymax,w));V=V.map(Z=>k(Z,g,p)).filter(Z=>
!isNaN(Z?.x)).map(Z=>Z.x);M.xmax=Math.max.apply(null,V)}N<G&&W>H&&(M.xmax=B[1],B=[],B.push(new r(a.xmin,a.ymin,w)),B.push(new r(a.xmin,(a.ymin+a.ymax)/2,w)),B.push(new r(a.xmin,a.ymax,w)),a=B.map(Z=>k(Z,g,p)).filter(Z=>!isNaN(Z?.x)).map(Z=>Z.x),M.xmin=Math.min.apply(null,a))}else a=f(g,.001),Math.abs(M.xmin-B[0])<a&&(M.xmin=B[0]),Math.abs(M.xmax-B[1])<a&&(M.xmax=B[1]);return M}function D(a,g=!1){return a?a.isWebMercator?2*(g?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*ea[a.wkid]||
null:null}function F(a,g=!1){if(a.isGeographic)return[-180,180];a=D(a,g);return x.isSome(a)?[-a/2,a/2]:null}function P(a,g,p,B){a=(a-g)/p;0!==a-Math.floor(a)?a=Math.floor(a):B&&--a;return a}function R(a,g=!1){var p=D(a.spatialReference);if(x.isNone(p))return 0;const B=g?0:-(p/2),G=f(a.spatialReference),w=!g&&Math.abs(a.xmin+p/2)<G?-p/2:a.xmin;a=P(!g&&Math.abs(a.xmax-p/2)<G?p/2:a.xmax,B,p,!0);p=P(w,B,p,!1);return a-p}function S(a){const {projectedExtent:g,srcBufferExtent:p,pixelSize:B,datumTransformation:G,
rasterTransform:w}=a;var M=g.spatialReference;const N=p.spatialReference;var H=v(M,N);const {xmin:W,ymin:V,xmax:Z,ymax:ca}=g,aa=D(N),la=x.isSome(aa)&&(a.hasWrapAround||"gcs-shift"===w?.type);a=a.spacing||[32,32];var ja=a[0]*B.x,ka=a[1]*B.y;const ba=1===a[0],na=Math.ceil((Z-W)/ja-.1/a[0])+(ba?0:1),pa=Math.ceil((ca-V)/ka-.1/a[1])+(ba?0:1);ja=O({cols:na,rows:pa,xmin:W,ymax:ca,xres:ja,yres:ka,inSR:M,outSR:N,datumTransformation:G,preferPE:4>=a[0],usePixelCenter:ba});ka=[];let qa,ra=0;const ua=ba?-1:NaN,
{xmin:va,xmax:oa,ymax:wa,width:xa,height:ya}=p,za=f(N,500),Aa=x.isSome(aa)&&0<va&&oa>aa/2;var sa=!1;H&&(sa=da(M),sa=x.isSome(sa)&&0<sa.poleLocation);for(M=0;M<na;M++){H=[];for(let ta=0;ta<pa;ta++){var ma=ja[M*pa+ta];la&&ma[0]>oa&&ma[0]>aa/2-za?ma[0]-=aa:la&&0===M&&0>ma[0]&&Aa&&!w&&(ma[0]+=aa);!ma||isNaN(ma[0])||isNaN(ma[1])?(ka.push(ua),ka.push(ua),H.push(null),ra++):(w&&(ma=w.inverseTransform(new r({x:ma[0],y:ma[1],spatialReference:N})),ma=[ma.x,ma.y]),H.push(ma),0<M&&la&&qa[ta]&&ma[0]<qa[ta][0]&&
(ma[0]+=aa,sa&&ma[0]>oa&&ma[0]>aa&&(ma[0]-=aa)),ka.push((ma[0]-va)/xa),ka.push((wa-ma[1])/ya))}qa=H}return{offsets:ka,error:null,coefficients:null,outofBoundPointCount:ra,spacing:a,size:ba?[na,pa]:[na-1,pa-1]}}function X(a,g,p){const {cols:B,rows:G}=g;g=new Float32Array((B-1)*(G-1)*12);const w=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),M=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ca=0;ca<B-1;ca++){for(var N=0;N<G-1;N++){var H=ca*G*2+2*N,W=a[H];const aa=a[H+1];var V=a[H+2],Z=a[H+3];H+=2*G;const la=
a[H],ja=a[H+1],ka=a[H+2];H=a[H+3];let ba=0,na=12*(N*(B-1)+ca);for(let pa=0;3>pa;pa++)g[na++]=w[ba++]*W+w[ba++]*V+w[ba++]*ka;ba=0;for(V=0;3>V;V++)g[na++]=w[ba++]*aa+w[ba++]*Z+w[ba++]*H;ba=0;for(Z=0;3>Z;Z++)g[na++]=M[ba++]*W+M[ba++]*la+M[ba++]*ka;ba=0;for(W=0;3>W;W++)g[na++]=M[ba++]*aa+M[ba++]*ja+M[ba++]*H}if(p)for(N=0;N<g.length;N++)isNaN(g[N])&&(g[N]=-1)}return g}var Y;(function(a){a[a.None=0]="None";a[a.North=1]="North";a[a.South=2]="South";a[a.Both=3]="Both"})(Y||(Y={}));const ia=(a,g,p,B=0)=>{if(1===
p[0])return[0,0];var G=1,w=-1,M=1,N=-1;for(var H=0;H<a.length;H+=2)isNaN(a[H])||(G=G>a[H]?a[H]:G,w=w>a[H]?w:a[H],M=M>a[H+1]?a[H+1]:M,N=N>a[H+1]?N:a[H+1]);const {cols:W,rows:V}=g;g=(w-G)/W/p[0];p=(N-M)/V/p[1];B*=2;M=0;N=!1;G=[0,0];for(w=0;w<W-3;w++){for(H=0;H<V-3;H++){var Z=w*V*2+2*H;const ca=Math.abs(((a[Z]+a[Z+4]+a[Z+4*V]+a[Z+4*V+4])/4-a[Z+2*V+2])/g);Z=Math.abs(((a[Z+1]+a[Z+5]+a[Z+4*V+1]+a[Z+4*V+5])/4-a[Z+2*V+3])/p);ca+Z>M&&(M=ca+Z,G=[ca,Z]);if(B&&M>B){N=!0;break}}if(N)break}return G},ea={3395:2.0037508342789244E7,
3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,
54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},ha=new Map,fa=new Map;A.computeProjectedScales=function(a,g,p=512,B=!0){const {extent:G,spatialReference:w,pixelSize:M}=a,N=m(new r({x:M.x,y:M.y,spatialReference:w}),g,G);if(null==N)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const H=(N.x+N.y)/
2;var W=E.getMetersPerUnitForSR(g),V=H*W*96*39.37,Z=g.isGeographic?256/p*2.958287637958547E8:256/p*5.91657527591555E8,ca="vector-magdir"===a.dataType||"vector-uv"===a.dataType,aa=q(G,g);a=Math.min(Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2),Math.ceil(Math.log(Z/2/V)/Math.LN2));!ca&&B&&(g.isGeographic||g.isWebMercator)&&(ca=0>aa.xmin*aa.xmax,!ca&&3>a&&(B=D(g),x.isSome(B)&&(ca=2**a*H*p,p=Math.ceil(B/ca),ca=1===p||2===p&&B/2-aa.xmax<ca)));p=V;if(ca)p=Z,Z=g.isGeographic?1.341104507446289E-6:
.29858214164761665,W=96*Z*W*39.37,g=m(new r({x:Z,y:Z,spatialReference:{wkid:g.isGeographic?4326:3857}}),w,aa),g.x*=p/W,g.y*=p/W;else{g={x:M.x,y:M.y};for(aa=0;p<.5005*Z&&aa<a;)aa++,p*=2,g.x*=2,g.y*=2;1.001>=Math.max(p,Z)/Math.min(p,Z)&&(p=Z)}Z=[p];aa=[{x:g.x,y:g.y}];for(V=Math.min(70.5310735,V)/1.001;p>=V;)p/=2,g.x/=2,g.y/=2,Z.push(p),aa.push({x:g.x,y:g.y});return{projectedPixelSize:N,scales:Z,srcResolutions:aa,isCustomTilingScheme:!ca}};A.defaultGridSpacing=32;A.defaultProjectionToleranceInPixels=
4;A.getDefaultDatumTransformationForDataset=function(a,g,p){return v(a.spatialReference,g)?p?I.getTransformation(g,a.spatialReference,a):I.getTransformation(a.spatialReference,g,a):null};A.getProjectedGridPoints=O;A.getProjectionOffsetGrid=function(a){var g=a.isAdaptive&&null==a.spacing;let p=a.spacing||[32,32],B=S(a);var G={cols:B.size[0]+1,rows:B.size[1]+1};const w=0<B.outofBoundPointCount&&B.outofBoundPointCount<B.offsets.length/2;let M=B.outofBoundPointCount===B.offsets.length/2||g&&w?[0,0]:ia(B.offsets,
G,p,4);const N=(M[0]+M[1])/2;var H=a.projectedExtent.spatialReference;const W=a.srcBufferExtent.spatialReference;g&&(w||4<N)&&(h(H,W,a.datumTransformation)&&(H.isGeographic||x.isSome(da(H))),p=[4,4],B=S({...a,spacing:p}),G={cols:B.size[0]+1,rows:B.size[1]+1},M=ia(B.offsets,G,p,4));B.error=M;1<p[0]&&(B.coefficients=X(B.offsets,G,w));!a.includeGCSGrid||H.isGeographic||H.isWebMercator||(W.isGeographic?B.gcsGrid={offsets:B.offsets,coefficients:B.coefficients,spacing:p}:(g=da(H),x.isSome(g)&&!g.isEnvelope&&
(H&&!H.isGeographic&&(g=String(H.wkid||H.wkt),fa.has(g)?H=fa.get(g):(H=(H.wkid?y.PeFactory.coordsys(H.wkid):y.PeFactory.fromString(y.PeDefs.PE_TYPE_PROJCS,H.wkt)).getGeogcs().getCode(),fa.set(g,H)),H=new c({wkid:H})),H=q(a.projectedExtent,H),{offsets:a}=S({...a,srcBufferExtent:H,spacing:p}),G=X(a,G,w),B.gcsGrid={offsets:a,coefficients:G,spacing:p})));return B};A.getRasterDatasetAlignmentInfo=function(a){const g=a.storageInfo.origin.x;var p=D(a.spatialReference,!0);if(x.isNone(p))return{originX:g,
halfWorldWidth:null,pyramidsInfo:null};const B=p/2,{nativePixelSize:G,storageInfo:w,extent:M}=a,{maximumPyramidLevel:N,blockWidth:H,pyramidScalingFactor:W}=w;let V=G.x;const Z=[];a=x.isSome(a.transform)&&"gcs-shift"===a.transform.type;const ca=g+(a?0:B);p=a?p-g:B-g;for(let aa=0;aa<=N;aa++){const la=(M.xmax-g)/V/H,ja=p/V/H;Z.push({resolutionX:V,blockWidth:H,datsetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ja-Math.floor(ja)?ja:Math.ceil(ja),leftMargin:Math.round(ca/
V)%H,rightPadding:(H-Math.round(p/V)%H)%H,originColumnOffset:Math.floor(ca/V/H)});V*=W}return{originX:g,halfWorldWidth:B,pyramidsInfo:Z,hasGCSSShiftTransform:a}};A.getWorldWidth=D;A.getWorldWrapCount=R;A.load=function(){return e.apply(this,arguments)};A.minimumGridSpacing=4;A.projectExtent=q;A.projectPoint=k;A.projectResolution=m;A.requirePE=h;A.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:t(a)};A.snapPyramid=function(a,g,p){const {storageInfo:B,pixelSize:G}=g;var w=0;let M=
!1;var {pyramidResolutions:N}=B;if(x.isSome(N)&&N.length){a=(a.x+a.y)/2;var H=N[N.length-1];H=(H.x+H.y)/2;var W=(G.x+G.y)/2;if(a<=W)w=0;else if(a>=H)w=N.length,M=8<a/H;else{H=W;for(let V=1;V<=N.length;V++){W=(N[V-1].x+N[V-1].y)/2;if(a<=W){a===W?w=V:"down"===p?(w=V-1,M=8<a/H):w="up"===p?V:a-H>W-a||2<a/H?V:V-1;break}H=W}}p=0===w?G:N[w-1];M&&(N=Math.min(p.x,p.y),a=E.getMetersPerUnitForSR(g.spatialReference),19567<N*a&&(M=!1));return{pyramidLevel:w,pyramidResolution:new r({x:p.x,y:p.y,spatialReference:g.spatialReference}),
excessiveReading:M}}w=Math.log(a.x/G.x)/Math.LN2;a=Math.log(a.y/G.y)/Math.LN2;N=g.storageInfo.maximumPyramidLevel||0;w="down"===p?Math.floor(Math.min(w,a)):"up"===p?Math.ceil(Math.max(w,a)):Math.round((w+a)/2);0>w?w=0:w>N&&(M=w>N+3,w=N);p=2**w;g=new r({x:p*g.nativePixelSize.x,y:p*g.nativePixelSize.y,spatialReference:g.spatialReference});return{pyramidLevel:w,pyramidResolution:g,excessiveReading:M}};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d){E=function(c){function h(){var e=c.apply(this,arguments)||this;e._handle=null;e.container=null;e.layer=null;e.type="rasterVF";return e}A._inheritsLoose(h,c);var v=h.prototype;v.canUseWebGLForProcessing=function(){return!1};v.fetchTile=function(){var e=A._asyncToGenerator(function*(m,f){f={...f,interpolation:"nearest",requestProjectedLocalDirections:!0};m=yield this.layer.fetchTile(m.level,m.row,m.col,f);"vector-magdir"===this.layer.rasterInfo.dataType&&m?.pixelBlock&&
(m.pixelBlock=yield this.layer.convertVectorFieldData(m.pixelBlock,f));return m});return function(m,f){return e.apply(this,arguments)}}();v.updateTileSource=function(e,m){const f=m.symbolizerParams,{tileData:k}=e;k.key=e.key;k.width=this._tileInfoView.tileInfo.size[0];k.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:e}=f);({source:m}=m);k.offset=this._getTileSymbolOffset(k.key,e);C.isSome(m)&&C.isSome(m.pixelBlock)?(k.rawPixelData={extent:m.extent,pixelBlock:m.pixelBlock},k.symbolizerParameters=
f,k.source=this._sampleVectorFieldData(m.pixelBlock,f,k.offset)):(m=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo[0]-k.offset[0])/e),Math.round((this._tileInfoView.tileInfo[1]-k.offset[1])/e)]),k.source=m,k.symbolizerParameters=f);k.invalidateVAO();return Promise.resolve(null)};v.updateTileSymbolizerParameters=function(e,m){m=m.local;const {symbolTileSize:f}=m;({tileData:e}=e);e.offset=this._getTileSymbolOffset(e.key,f);const k=e.symbolizerParameters.symbolTileSize;e.symbolizerParameters=
m;C.isSome(e.rawPixelData?.pixelBlock)&&k!==f&&(e.source=this._sampleVectorFieldData(e.rawPixelData.pixelBlock,e.symbolizerParameters,e.offset));return Promise.resolve(null)};v.attach=function(){c.prototype.attach.call(this);this.container=new r.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=L.watch(()=>this.layer.renderer,e=>this._updateSymbolType(e))};v.detach=function(){c.prototype.detach.call(this);
this.container.removeAllChildren();this._handle.remove();this._handle=null};v._getTileSymbolOffset=function(e,m){const f=e.col*this._tileInfoView.tileInfo.size[0]%m;e=e.row*this._tileInfoView.tileInfo.size[1]%m;return[f>m/2?m-f:-f,e>m/2?m-e:-e]};v._sampleVectorFieldData=function(e,m,f){({symbolTileSize:m}=m);return u.sampleVectorField(e,"vector-uv",m,f)};v._updateSymbolType=function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===
e.style?["scalar"]:["triangle"])};return h}(d.BaseImageryTileSubView2D);K.__decorate([x.property()],E.prototype,"container",void 0);K.__decorate([x.property()],E.prototype,"layer",void 0);K.__decorate([x.property()],E.prototype,"type",void 0);return E=K.__decorate([I.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],E)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(A,
K,C,L,x){function E(b,n){return f.get(b)/f.get(n)||1}function y(b,n="geographic"){const [t,q]=b;b=Math.sqrt(t*t+q*q);let z=Math.atan2(q,t)*k;z=(360+z)%360;"geographic"===n&&(z=(450-z)%360);return[b,z]}function I(b,n="geographic"){let t=b[1];"geographic"===n&&(t=(450-t)%360);t%=360;b=b[0];return[b*Math.cos(t/k),b*Math.sin(t/k)]}function u(b,n,t="geographic",q=1){if(!x.isValidPixelBlock(b))return b;const {pixels:z,width:l,height:D}=b;var F=l*D;const P=z[0],R=z[1],S=b.pixelType.startsWith("f")?b.pixelType:
"f32",X=L.createEmptyBand(S,F);F=L.createEmptyBand(S,F);let Y=0;for(let ia=0;ia<D;ia++)for(let ea=0;ea<l;ea++)"vector-uv"===n?([X[Y],F[Y]]=y([P[Y],R[Y]],t),X[Y]*=q):([X[Y],F[Y]]=I([P[Y],R[Y]],t),X[Y]*=q,F[Y]*=q),Y++;b=new L({pixelType:S,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[X,F]});b.updateStatistics();return b}function r(b=0,n=0,t=Math.PI,q=!0){q&&(t=(2*Math.PI-t)%(2*Math.PI));q=q?-1:1;const z=-7*q,l=-2*q,D=-16*q,[F,P]=c(0,n+
13*q,t,21.75),[R,S]=c(b-5.5,n+z,t,21.75),[X,Y]=c(b+5.5,n+z,t,21.75),[ia,ea]=c(b-1.5,n+l,t,21.75),[ha,fa]=c(b+1.5,n+l,t,21.75),[a,g]=c(b-1.5,n+D,t,21.75),[p,B]=c(b+1.5,n+D,t,21.75);return[F,P,R,S,ia,ea,ha,fa,X,Y,a,g,p,B]}function d(b=0,n=Math.PI,t=!0){t&&(n=(2*Math.PI-n)%(2*Math.PI));var q=t?-1:1,z=5*q;const l=20*q,D=25*q;q*=2;const F=t?1:-1;t=5*F;let [P,R]=[0+t,0-l],[S,X]=[P+2*F,R],[Y,ia]=[S-0*F,X+q],[ea,ha]=[0-t,0-D],[fa,a]=[ea+0*F,ha-q],g=Math.ceil(b/5),p=Math.floor(g/10);g-=8*p;b=[];const B=[];
for(let ca=0;ca<g/2;ca++,p--){0>=p&&1===g%2&&ca===(g-1)/2&&(ea=0,fa=ea+0*F,ha=(ha+R)/2,a=ha-q);const [aa,la]=c(ea,ha,n,45);if(0<p){const [ja,ka]=c(S,ha,n,45),[ba,na]=c(P,R,n,45);b.push(ja);b.push(ka);b.push(aa);b.push(la);b.push(ba);b.push(na)}else{const [ja,ka]=c(S,X,n,45),[ba,na]=c(Y,ia,n,45),[pa,qa]=c(fa,a,n,45);B.push(aa);B.push(la);B.push(pa);B.push(qa);B.push(ba);B.push(na);B.push(ja);B.push(ka)}ha+=z;R+=z;X+=z;ia+=z;a+=z}const [G,w]=c(0+t,0+l,n,45);z=7*F;const [M,N]=c(0+z,0+l,n,45),[H,W]=c(0+
t,0-D,n,45),[V,Z]=c(0+z,0-D,n,45);return{pennants:b,barbs:B,shaft:[G,w,M,N,H,W,V,Z]}}function c(b,n,t,q=1){return[Math.sqrt(b*b+n*n)/q,(2*Math.PI+(2*Math.PI+Math.atan2(n,b))%(2*Math.PI)-t)%(2*Math.PI)]}function h(b,n,t,q){t=E(q||"knots",t);for(q=1;q<n.length;q++)if(q===n.length-1){if(b<n[q]*t)break}else if(b<=n[q]*t)break;return Math.min(q-1,n.length-2)}function v(b,n,t,q,z){let l=0;switch(n){case "beaufort_kn":l=h(b,T,"knots",t);break;case "beaufort_km":l=h(b,T,"kilometer-per-hour",t);break;case "beaufort_ft":l=
h(b,T,"feet-per-second",t);break;case "beaufort_m":l=h(b,T,"meter-per-second",t);break;case "classified_arrow":l=h(b,z??[],q,t);break;case "ocean_current_m":l=h(b,U,"meter-per-second",t);break;case "ocean_current_kn":l=h(b,da,"knots",t)}return l}function e(b,n){const {style:t,inputUnit:q,outputUnit:z,breakValues:l}=n,D=J.fromJSON(q),F=J.fromJSON(z);let P=0,R=0;const {width:S,height:X,mask:Y}=b,ia=b.pixels[0];b=b.pixels[1];var ea=C.isSome(Y)?Y.filter(a=>0<a).length:S*X;const ha=new Float32Array(42*
ea);ea=new Uint32Array(15*ea);n=n.invertDirection?r(0,0,0,!1):O;for(let a=0;a<X;a++)for(let g=0;g<S;g++){var fa=a*S+g;if(!Y||Y[a*S+g]){const p=(b[fa]+360)%360/180*Math.PI,B=v(ia[fa],t,D,F,l);for(let G=0;G<n.length;G+=2)ha[P++]=(g+.5)/S,ha[P++]=(a+.5)/X,ha[P++]=n[G],ha[P++]=n[G+1]+p,ha[P++]=B,ha[P++]=ia[fa];fa=7*(P/42-1);ea[R++]=fa;ea[R++]=fa+1;ea[R++]=fa+2;ea[R++]=fa+0;ea[R++]=fa+4;ea[R++]=fa+3;ea[R++]=fa+0;ea[R++]=fa+2;ea[R++]=fa+3;ea[R++]=fa+2;ea[R++]=fa+5;ea[R++]=fa+3;ea[R++]=fa+5;ea[R++]=fa+6;
ea[R++]=fa+3}}return{vertexData:ha,indexData:ea}}function m(b,n){let t=0,q=0;const {width:z,height:l,mask:D}=b;b=b.pixels[0];const F=[],P=[];var R=J.fromJSON(n.inputUnit);R=E(R,"knots");n="wind_speed"===n.style?5:Number.MAX_VALUE;for(let X=0;X<l;X++)for(let Y=0;Y<z;Y++){var S=b[X*z+Y]*R;if((!D||D[X*z+Y])&&S<n){for(let ia=0;4>ia;ia++)F[t++]=(Y+.5)/z,F[t++]=(X+.5)/l,F[t++]=2>ia?-.5:.5,F[t++]=0===ia%2?-.5:.5,F[t++]=0,F[t++]=S;S=4*(t/24-1);P[q++]=S;P[q++]=S+1;P[q++]=S+2;P[q++]=S+1;P[q++]=S+2;P[q++]=S+
3}}return{vertexData:new Float32Array(F),indexData:new Uint32Array(P)}}const f=new Map;f.set("meter-per-second",1);f.set("kilometer-per-hour",.277778);f.set("knots",.514444);f.set("feet-per-second",.3048);f.set("mile-per-hour",.44704);const k=180/Math.PI,J=new K.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),O=r(0,0,0),T=[0,1,3,6,10,16,21,27,33,40,47,55,63],U=[0,.5,
1,1.5,2],da=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],Q=[];A.convertToLocalDirections=function(b,n,t,q="geographic"){if(!x.isValidPixelBlock(b)||C.isNone(t))return b;b="vector-magdir"===n?b.clone():C.unwrap(u(b,n));const z=b.pixels[1];for(let l=0;l<z.length;l++)z[l]="geographic"===q?(z[l]+t[l]+270)%360:(z[l]+360-t[l])%360;return"vector-magdir"===n?b:u(b,"vector-magdir")};A.convertVectorFieldData=u;A.convertVectorFieldUnit=function(b,n,t=1){if(1===t||!x.isValidPixelBlock(b))return b;b=b.clone();const {pixels:q,
width:z,height:l}=b,D=q[0],F=q[1];let P=0;for(let R=0;R<l;R++)for(let S=0;S<z;S++)"vector-uv"===n?(D[P]*=t,F[P]*=t):D[P]*=t,P++;b.updateStatistics();return b};A.createVFMesh=function(b,n){if("simple_scalar"===n.style)n=m(b,n);else if("wind_speed"===n.style){if(0===Q.length)for(var t=0;30>t;t++)Q.push(d(5*t,0,!n.invertDirection));n=J.fromJSON(n.inputUnit);n=E(n,"knots");const {width:D,height:F,mask:P}=b;t=b.pixels[0];b=b.pixels[1];const R=[],S=[];let X=0,Y=0;for(let ia=0;ia<F;ia++)for(let ea=0;ea<
D;ea++){var q=ia*D+ea,z=t[q]*n;if((!P||P[ia*D+ea])&&5<=z){const ha=(b[q]+360)%360/180*Math.PI,{pennants:fa,barbs:a,shaft:g}=Q[Math.min(Math.floor(z/5),29)];if(0===fa.length+a.length)continue;q=R.length/6;const p=(ea+.5)/D,B=(ia+.5)/F;for(var l=0;l<fa.length;l+=2)R[X++]=p,R[X++]=B,R[X++]=fa[l],R[X++]=fa[l+1]+ha,R[X++]=0,R[X++]=z;for(l=0;l<a.length;l+=2)R[X++]=p,R[X++]=B,R[X++]=a[l],R[X++]=a[l+1]+ha,R[X++]=0,R[X++]=z;for(l=0;l<g.length;l+=2)R[X++]=p,R[X++]=B,R[X++]=g[l],R[X++]=g[l+1]+ha,R[X++]=0,R[X++]=
z;for(z=0;z<fa.length/6;z++)S[Y++]=q,S[Y++]=q+1,S[Y++]=q+2,q+=3;for(z=0;z<a.length/8;z++)S[Y++]=q,S[Y++]=q+1,S[Y++]=q+2,S[Y++]=q+1,S[Y++]=q+2,S[Y++]=q+3,q+=4;S[Y++]=q+0;S[Y++]=q+1;S[Y++]=q+2;S[Y++]=q+1;S[Y++]=q+3;S[Y++]=q+2;q+=4}}n={vertexData:new Float32Array(R),indexData:new Uint32Array(S)}}else n=e(b,n);return n};A.createVFMeshScalar=m;A.getUnitConversionFactor=E;A.sampleVectorField=function(b,n,t,q=[0,0],z=.5){const {width:l,height:D,mask:F}=b,[P,R]=b.pixels,[S,X]=q;b=Math.round((l-S)/t);q=Math.round((D-
X)/t);var Y=b*q;const ia=new Float32Array(Y),ea=new Float32Array(Y);Y=new Uint8Array(Y);n="vector-uv"===n;for(let fa=0;fa<q;fa++)for(let a=0;a<b;a++){let g=0;const p=fa*b+a,B=Math.max(0,fa*t+X),G=Math.max(0,a*t+S),w=Math.min(D,B+t),M=Math.min(l,G+t);for(let N=B;N<w;N++)for(let H=G;H<M;H++){var ha=N*l+H;if(!F||F[ha]){g++;ha=n?[P[ha],R[ha]]:[P[ha],(360+R[ha])%360];const [W,V]=n?ha:I(ha);ia[p]+=W;ea[p]+=V}}if(g>=(w-B)*(M-G)*(1-z)){Y[p]=1;const [N,H]=y([ia[p]/g,ea[p]/g]);ia[p]=N;ea[p]=H}else Y[p]=0,ia[p]=
0,ea[p]=0}t=new L({width:b,height:q,pixels:[ia,ea],mask:Y});t.updateStatistics();return t};A.snapImageToSymbolTile=function(b,n,t,q,z){if(C.isNone(z)||!z.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(n/q),height:Math.round(t/q),resolution:b.width/n};const l=z.xmin;z=z.ymax;n=(b.xmax-b.xmin)/n*q;t=(b.ymax-b.ymin)/t*q;b.xmin=l+Math.floor((b.xmin-l)/n)*n;b.xmax=l+Math.ceil((b.xmax-l)/n)*n;b.ymin=z+Math.floor((b.ymin-z)/t)*t;b.ymax=z+Math.ceil((b.ymax-z)/t)*t;return{extent:b,
width:Math.round(b.width/n),height:Math.round(b.height/t),resolution:(n+t)/2}};A.unitKebabDict=J;A.uvComponentToVector=y;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),function(A,K,C,L,x,E,y){y=function(I){function u(){var d=
I.apply(this,arguments)||this;d.isCustomTilingScheme=!1;d.symbolTypes=["triangle"];return d}K._inheritsLoose(u,I);var r=u.prototype;r.createTile=function(d){const c=this._tileInfoView.getTileBounds(C.create(),d),[h,v]=this._tileInfoView.tileInfo.size,e=this._tileInfoView.getTileResolution(d.level);return new x.RasterVFTile(d,e,c[0],c[3],h,v)};r.prepareRenderPasses=function(d){const c=d.registerRenderPass({name:"imagery (vf tile)",brushes:[L],target:()=>this.children.map(h=>h.tileData),drawPhase:E.WGLDrawPhase.MAP});
return[...I.prototype.prepareRenderPasses.call(this,d),c]};r.doRender=function(d){this.visible&&d.drawPhase===E.WGLDrawPhase.MAP&&this.symbolTypes.forEach(c=>{d.renderPass=c;I.prototype.doRender.call(this,d)})};return u}(y);A.RasterVFTileContainer=y;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RasterVFDisplayObject ../webgl/TiledDisplayObject".split(" "),
function(A,K,C,L,x,E){E=function(y){function I(r,d,c,h,v,e,m=null){var f=y.call(this,r,d,c,h,v,e)||this;f.tileData=new x.RasterVFDisplayObject(m);f.tileData.coordScale=[v,e];f.tileData.once("isReady",()=>f.ready());return f}K._inheritsLoose(I,y);var u=I.prototype;u.destroy=function(){y.prototype.destroy.call(this);this.tileData.destroy();this.stage=this.tileData=null};u._createTransforms=function(){return{dvs:L.create(),tileMat3:L.create()}};u.setTransform=function(r){y.prototype.setTransform.call(this,
r);const d=this.resolution/(r.resolution*r.pixelRatio),c=this.transforms.tileMat3,[h,v]=this.tileData.offset,[e,m]=r.toScreenNoRotation([0,0],[this.x+h*this.resolution,this.y-v*this.resolution]),{symbolTileSize:f}=this.tileData.symbolizerParameters;C.set(c,Math.round((this.width-this.tileData.offset[0])/f)*f/this.rangeX*d,0,0,0,Math.round((this.height-this.tileData.offset[1])/f)*f/this.rangeY*d,0,e,m,1);C.multiply(this.transforms.dvs,r.displayViewMat3,c);this.tileData.transforms.dvs=this.transforms.dvs};
u.onAttach=function(){this.tileData.stage=this.stage};u.onDetach=function(){this.tileData.stage=null};K._createClass(I,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(r){this.tileData.stencilRef=r}}]);return I}(E.TiledDisplayObject);A.RasterVFTile=E;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c,h){C=function(v){function e(f=null){var k=v.call(this)||this;k._source=null;k._symbolizerParameters=null;k._vaoInvalidated=!0;k.coordScale=[1,1];k.height=null;k.stencilRef=0;k.resolution=null;k.pixelRatio=1;k.x=0;k.y=0;k.rotation=0;k.rawPixelData=null;k.width=null;k.source=f;return k}K._inheritsLoose(e,v);var m=e.prototype;m.destroy=function(){L.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)};m.invalidateVAO=
function(){!this._vaoInvalidated&&L.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};m.updateVectorFieldVAO=function(f){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(L.isSome(this.source)&&L.isNone(this.vaoData)){var {style:k}=this.symbolizerParameters;switch(k){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":k=
I.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(f.context,k)};break;case "simple_scalar":k=I.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(f.context,k)};break;case "wind_speed":k=I.createVFMesh(this.source,this.symbolizerParameters);k=this._createVectorFieldVAO(f.context,k);const J=I.createVFMeshScalar(this.source,this.symbolizerParameters);f=this._createVectorFieldVAO(f.context,J);this.vaoData=
{magdir:k,scalar:f}}}this.ready();this.requestRender()}};m._createTransforms=function(){return{dvs:E.create()}};m.setTransform=function(f){const k=x.identity(this.transforms.dvs),[J,O]=f.toScreenNoRotation([0,0],[this.x,this.y]);var T=this.resolution/this.pixelRatio/f.resolution;const U=T*this.width;T*=this.height;const da=Math.PI*this.rotation/180;x.translate(k,k,y.fromValues(J,O));x.translate(k,k,y.fromValues(U/2,T/2));x.rotate(k,k,-da);x.translate(k,k,y.fromValues(-U/2,-T/2));x.scaleByVec2(k,k,
y.fromValues(U,T));x.multiply(this.transforms.dvs,f.displayViewMat3,k)};m.onAttach=function(){this.invalidateVAO()};m.onDetach=function(){this.invalidateVAO()};m._createVectorFieldVAO=function(f,k){const {vertexData:J,indexData:O}=k;k=d.BufferObject.createVertex(f,c.Usage.STATIC_DRAW,new Float32Array(J));const T=d.BufferObject.createIndex(f,c.Usage.STATIC_DRAW,new Uint32Array(O)),U=r.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:c.DataType.FLOAT,normalized:!1},
{location:1,name:"a_offset",count:2,type:c.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:c.DataType.FLOAT,normalized:!1}]});return{vao:new h.VertexArrayObject(f,U.attributes,U.bufferLayouts,{geometry:k},T),elementCount:O.length}};K._createClass(e,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(f){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(f)&&(this._symbolizerParameters=f,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(f){this._source=f;this.invalidateVAO()}}]);return e}(u.DisplayObject);A.RasterVFDisplayObject=C;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(A,K,C,L,x,E,y,I,u,r,d,c){return h=>{h=function(v){function e(){var f=v.apply(this,arguments)||this;f._rasterFieldPrefix="Raster.";f.layer=null;f.view=null;f.tileInfo=null;return f}A._inheritsLoose(e,v);var m=e.prototype;m._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)};m.supportsSpatialReference=function(f){return!!this.projectFullExtent(f)};m.projectFullExtent=function(f){const k=x.unwrap(this.layer.fullExtent),J=d.getDefaultDatumTransformationForDataset(k,
f,!1);return d.projectExtent(k,f,J)};m.fetchPopupFeatures=function(){var f=A._asyncToGenerator(function*(k,J){const {layer:O}=this;if(!k)throw new L("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:O});var {popupEnabled:T}=O;J=c.getFetchPopupTemplate(O,J);if(!T||x.isNone(J))throw new L("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:T,popupTemplate:J});T=[];const {value:U,magdirValue:da}=yield O.identify(k,{timeExtent:this.timeExtent});
let Q="";if(U&&U.length){Q="imagery-tile"===O.type&&O.hasStandardTime()&&null!=U[0]?U.map(n=>O.getStandardTimeValue(n)).join(", "):U.join(", ");k={ObjectId:0};k["Raster.ServicePixelValue"]=Q;J=O.rasterInfo.attributeTable;if(x.isSome(J)){const {fields:n,features:t}=J,q=n.find(({name:z})=>"value"===z.toLowerCase());if(J=q?t.find(z=>String(z.attributes[q.name])===Q):null)for(var b in J.attributes)J.attributes.hasOwnProperty(b)&&(k[this._rasterFieldPrefix+b]=J.attributes[b])}b=O.rasterInfo.dataType;if("vector-magdir"===
b||"vector-uv"===b)k["Raster.Magnitude"]=da?.[0],k["Raster.Direction"]=da?.[1];b=new C(this.fullExtent.clone(),null,k);b.layer=O;b.sourceLayer=b.layer;T.push(b)}return T});return function(k,J){return f.apply(this,arguments)}}();A._createClass(e,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return d.getDefaultDatumTransformationForDataset(x.unwrap(this.layer.fullExtent),
this.view.spatialReference,!0)}}]);return e}(h);K.__decorate([E.property()],h.prototype,"layer",void 0);K.__decorate([E.property(r.combinedViewLayerTimeExtentProperty)],h.prototype,"timeExtent",void 0);K.__decorate([E.property()],h.prototype,"view",void 0);K.__decorate([E.property()],h.prototype,"fullExtent",null);K.__decorate([E.property()],h.prototype,"tileInfo",void 0);K.__decorate([E.property({readOnly:!0})],h.prototype,"hasTilingEffects",null);return h=K.__decorate([u.subclass("esri.views.layers.ImageryTileLayerView")],
h)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(A,K,C,L){function x(){x=K._asyncToGenerator(function*(E,y=E.popupTemplate){if(C.isNone(y))return[];const I=yield y.getRequiredFields(E.fieldsIndex);({lastEditInfoEnabled:y}=y);const {objectIdField:u,typeIdField:r,globalIdField:d,relationships:c}=E;if(I.includes("*"))return["*"];y=y?yield L.getFeatureEditFields(E):
[];const h=L.fixFields(E.fieldsIndex,[...I,...y]);r&&h.push(r);h&&u&&E.fieldsIndex.has(u)&&!h.includes(u)&&h.push(u);h&&d&&E.fieldsIndex.has(d)&&!h.includes(d)&&h.push(d);c&&c.forEach(v=>{({keyField:v}=v);h&&v&&E.fieldsIndex.has(v)&&!h.includes(v)&&h.push(v)});return h});return x.apply(this,arguments)}A.getFetchPopupTemplate=function(E,y){return E.popupTemplate?E.popupTemplate:C.isSome(y)&&y.defaultPopupTemplateEnabled&&C.isSome(E.defaultPopupTemplate)?E.defaultPopupTemplate:null};A.getRequiredFields=
function(E){return x.apply(this,arguments)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(A,
K,C,L,x,E,y,I,u){return r=>{r=function(d){function c(){return d.apply(this,arguments)||this}A._inheritsLoose(c,d);c.prototype.initialize=function(){this.handles.add(x.on(()=>this.layer,"refresh",h=>{this.doRefresh(h.dataChanged).catch(v=>{L.isAbortError(v)||C.getLogger(this.declaredClass).error(v)})}),"RefreshableLayerView")};return c}(r);K.__decorate([E.property()],r.prototype,"layer",void 0);return r=K.__decorate([u.subclass("esri.layers.mixins.RefreshableLayerView")],r)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(A,
K,C,L,x,E,y,I,u,r,d,c,h,v,e,m,f,k,J,O){u=function(T){function U(){var Q=T.apply(this,arguments)||this;Q._useWebGLForProcessing=!0;Q._useProgressiveUpdate=!0;Q.subview=null;return Q}A._inheritsLoose(U,T);var da=U.prototype;da.update=function(Q){this.subview.update(Q);this.notifyChange("updating")};da.isUpdating=function(){return!this.subview||this.subview.updating};da.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._updateSubview();this.handles.add([y.watch(()=>{const {layer:Q}=this;
return{bandIds:Q.bandIds,renderer:Q.renderer,interpolation:Q.interpolation,multidimensionalDefinition:Q.multidimensionalDefinition,rasterFunction:"imagery-tile"===Q.type?Q.rasterFunction:null}},(Q,b)=>{const n=Q.interpolation!==b.interpolation&&("majority"===Q.interpolation||"majority"===b.interpolation)&&f.canUseMajorityInterpolationOnDataSource(this.layer),t=Q.renderer!==b.renderer&&b.renderer?.type!==Q.renderer?.type;t&&this._updateSubview();const q=Q.rasterFunction!==b.rasterFunction;this.subview.redrawOrRefetch(Q.multidimensionalDefinition!==
b.multidimensionalDefinition||n||t||q).catch(z=>{E.isAbortError(z)||L.getLogger(this.declaredClass).error(z)});this.notifyChange("updating")}),y.watch(()=>this.layer.blendMode??"normal",Q=>{this.subview.container.blendMode=Q},y.syncAndInitial),y.watch(()=>this.layer.effect??null,Q=>{this.subview.container.effect=Q},y.syncAndInitial),y.watch(()=>this.layer.multidimensionalSubset??null,(Q,b)=>{const {multidimensionalDefinition:n}=this.layer;x.isSome(n)&&c.hasExcludedVariableOrDimension(n,Q)!==c.hasExcludedVariableOrDimension(n,
b)&&(this.subview.redrawOrRefetch(!0).catch(t=>{E.isAbortError(t)||L.getLogger(this.declaredClass).error(t)}),this.notifyChange("updating"))},y.sync),y.watch(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch(!0).catch(Q=>{E.isAbortError(Q)||L.getLogger(this.declaredClass).error(Q)})},y.initial)],"attach")};da.detach=function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();
this.subview=null};da.moveStart=function(){this.requestUpdate()};da.viewChange=function(){this.requestUpdate()};da.moveEnd=function(){this.subview.moveEnd()};da.hitTest=function(){var Q=A._asyncToGenerator(function*(b,n){return[{type:"graphic",layer:this.layer,mapPoint:b,graphic:new C({attributes:{},geometry:b.clone()})}]});return function(b,n){return Q.apply(this,arguments)}}();da.doRefresh=function(){return this.subview?.doRefresh()};da._updateSubview=function(){var Q="vector-field"===this.layer.renderer.type?
"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){if(this.subview.type===Q){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}const {layer:b}=this;Q="rasterVF"===Q?new m({layer:b,layerView:this}):"flow"===Q?new h({layer:b,layerView:this}):new e({layer:b,layerView:this});"useWebGLForProcessing"in Q&&(Q.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in Q&&(Q.useProgressiveUpdate=
this._useProgressiveUpdate);"previousLOD"in Q&&(Q.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD);this._attachSubview(Q);this.subview=Q;this.requestUpdate()};da._attachSubview=function(Q){Q&&!Q.attached&&(Q.attach(),Q.attached=!0,this.container.addChildAt(Q.container,0),Q.container.blendMode=this.layer.blendMode,Q.container.effect=this.layer.effect)};da._detachSubview=function(Q){Q?.attached&&(this.container.removeChild(Q.container),Q.detach(),Q.attached=!1)};A._createClass(U,
[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(Q){this._useWebGLForProcessing=Q;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=Q)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(Q){this._useProgressiveUpdate=Q;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=Q)}}]);return U}(k(O(v.LayerView2DMixin(J))));K.__decorate([I.property()],
u.prototype,"subview",void 0);K.__decorate([I.property()],u.prototype,"useWebGLForProcessing",null);K.__decorate([I.property()],u.prototype,"useProgressiveUpdate",null);return u=K.__decorate([d.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],u)});