// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/earcut ../../../geometry/support/aaBoundingRect ../../../geometry/support/coordsUtils ../../../geometry/support/normalizeUtilsSync ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/data/projectionSupport ../tiling/PagedTileQueue ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/definitions ../engine/webgl/TurboLine ./LayerView2D ./support/DisplayGL ./support/util ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(n,t,x,q,V,D,E,F,G,H,I,z,W,J,X,Y,Z,K,L,M,N,A,O,P){const y=new Set,u=[],v=[];let Q=function(w,r,g,b,a,c,d,e=[0,0],f=F.create()){this.id=w;this.level=r;this.row=g;this.col=b;this.world=a;this.resolution=c;this.scale=d;this.coords=e;this.bounds=f};q=function(w){function r(b){b=w.call(this,b)||this;b._tileMap=new Map;b.container=new N(n._assertThisInitialized(b));b.layer=null;b.tiles=[];b._renderTarget={framebuffer:null,viewport:[0,0,0,0]};return b}n._inheritsLoose(r,w);var g=r.prototype;g.attach=
function(){};g.detach=function(){};g.requestRender=function(){this.container.requestRender()};g.tilesChanged=function(b,a){};g.supportsSpatialReference=function(b){const a=this.layer?.tileInfo;return a?I.equals(a.spatialReference,b):!0};g.doRefresh=function(){var b=n._asyncToGenerator(function*(){});return function(){return b.apply(this,arguments)}}();g.isUpdating=function(){return!1};g.update=function(b){var a=this._tileInfoView;const c=this.tiles;if(a){b=a.getTileCoverage(b.state,0);const {spans:e,
lodInfo:f}=b;({level:b}=f);if(e.length)for(const {row:h,colFrom:l,colTo:k}of e)for(a=l;a<=k;a++){var d=f.normalizeCol(a);const p=f.getWorldForColumn(a),m=`${b}/${h}/${d}/${p}`;this._tileMap.has(m)||(d=new Q(m,b,h,d,p,f.resolution,f.scale),f.getTileCoords(d.coords,d,!1),f.getTileBounds(d.bounds,d,!0),this._tileMap.set(m,d),c.push(d),u.push(d));y.add(m)}}for(b=c.length-1;0<=b;b--)a=c[b],y.has(a.id)||(c.splice(b,1),v.push(a),this._tileMap.delete(a.id));if(u.length||v.length)this.tilesChanged(u,v),u.length=
v.length=0;y.clear();this.requestRender()};g.moveStart=function(){};g.viewChange=function(){this.requestUpdate()};g.moveEnd=function(){};g.bindRenderTarget=function(){this.context.bindFramebuffer(this.context.FRAMEBUFFER,this._renderTarget.framebuffer);this.context.viewport(this._renderTarget.viewport[0],this._renderTarget.viewport[1],this._renderTarget.viewport[2],this._renderTarget.viewport[3])};g.getRenderTarget=function(){return this._renderTarget};g.tessellateExtent=function(){var b=n._asyncToGenerator(function*(a){const c=
{vertices:[],indices:[]};a=yield this._projectAndNormalizeGeometry(a);const d=c.vertices.length;c.vertices.push({x:a.xmin,y:a.ymin,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:0,distance:0});c.vertices.push({x:a.xmax,y:a.ymin,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:0,distance:0});c.vertices.push({x:a.xmin,y:a.ymax,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:1,distance:0});c.vertices.push({x:a.xmax,y:a.ymax,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:1,distance:0});c.indices.push(d+0,d+1,d+2,d+1,d+3,d+
2);return c});return function(a){return b.apply(this,arguments)}}();g.tessellatePoint=function(){var b=n._asyncToGenerator(function*(a,c){a=yield this._projectAndNormalizeGeometry(a);return this._tessellatePoints([a],c)});return function(a,c){return b.apply(this,arguments)}}();g.tessellateMultipoint=function(){var b=n._asyncToGenerator(function*(a,c){const d=yield this._projectAndNormalizeGeometry(a);a=d.points.map(e=>({x:e[0],y:e[1],spatialReference:d.spatialReference}));return this._tessellatePoints(a,
c)});return function(a,c){return b.apply(this,arguments)}}();g._tessellatePoints=function(){var b=n._asyncToGenerator(function*(a,c){const d={vertices:[],indices:[]};for(const e of a)a=d.vertices.length,d.vertices.push({x:e.x,y:e.y,xOffset:c.x,yOffset:c.y+c.height,uTexcoord:0,vTexcoord:0,distance:0}),d.vertices.push({x:e.x,y:e.y,xOffset:c.x+c.width,yOffset:c.y+c.height,uTexcoord:1,vTexcoord:0,distance:0}),d.vertices.push({x:e.x,y:e.y,xOffset:c.x,yOffset:c.y,uTexcoord:0,vTexcoord:1,distance:0}),d.vertices.push({x:e.x,
y:e.y,xOffset:c.x+c.width,yOffset:c.y,uTexcoord:1,vTexcoord:1,distance:0}),d.indices.push(a+0,a+1,a+2,a+1,a+3,a+2);return d});return function(a,c){return b.apply(this,arguments)}}();g.tessellatePolyline=function(){var b=n._asyncToGenerator(function*(a,c){const d={vertices:[],indices:[]};var e=(yield this._projectAndNormalizeGeometry(a)).paths;if(!e||!e.length)return d;let f;a=new L.LineTessellation((h,l,k,p,m,B,R,S,aa,T,C)=>{k=d.vertices.length;d.vertices.push({x:h,y:-l,xOffset:R*c/2,yOffset:S*c/
2,uTexcoord:C/f,vTexcoord:(T+1)/2,distance:C});return k},(h,l,k)=>{d.indices.push(h,l,k)},!0);for(const h of e){f=0;for(e=1;e<h.length;++e){const l=h[e][0]-h[e-1][0],k=h[e][1]-h[e-1][1];f+=Math.sqrt(l*l+k*k)}e=h.map(l=>({x:l[0],y:-l[1]}));a.tessellate(e,U)}return d});return function(a,c){return b.apply(this,arguments)}}();g.tessellatePolygon=function(){var b=n._asyncToGenerator(function*(a){const c={vertices:[],indices:[]};a=yield this._projectAndNormalizeGeometry(a);const d=a.rings;if(!d||!d.length)return c;
G.closeRings(a);for(const k of a.rings)for(const p of k)p[1]=-p[1];let e=Infinity,f=Infinity,h=-Infinity,l=-Infinity;A.analyzeRings(a.rings,()=>{},(k,p,m)=>{for(;k<p;k+=2)e=Math.min(e,m[k]),f=Math.min(f,m[k+1]),h=Math.max(h,m[k]),l=Math.max(l,m[k+1])});A.analyzeRings(a.rings,()=>{},(k,p,m,B)=>{this._invokeEarcut(c,k,p,m,B,[e,f,h,l])});return c});return function(a){return b.apply(this,arguments)}}();g._invokeEarcut=function(b,a,c,d,e,f){a=d.slice(a,c);e=E.earcut(a,e,2);c=b.vertices.length;for(d=0;d<
a.length;d+=2){const h=a[d],l=a[d+1];b.vertices.push({x:h,y:-l,xOffset:0,yOffset:0,uTexcoord:(h-f[0])/(f[2]-f[0]),vTexcoord:1-(l-f[1])/(f[3]-f[1]),distance:0})}for(f=0;f<e.length;++f)b.indices.push(c+e[f])};g._projectAndNormalizeGeometry=function(){var b=n._asyncToGenerator(function*(a){yield z.checkProjectionSupport(a.spatialReference,this.view.spatialReference);const c=H.normalizeCentralMeridianForDisplay(a);return z.project(c,a.spatialReference,this.view.spatialReference)});return function(a){return b.apply(this,
arguments)}}();n._createClass(r,[{key:"_tileInfoView",get:function(){const b=this.layer&&this.layer.tileInfo;return b?new J(b):null}},{key:"context",get:function(){return this.view._stage.context.gl}}]);return r}(P(M.LayerView2DMixin(O)));t.__decorate([x.property()],q.prototype,"_tileInfoView",null);t.__decorate([x.property()],q.prototype,"layer",void 0);t.__decorate([x.property()],q.prototype,"context",null);q=t.__decorate([D.subclass("esri.views.2d.layers.BaseLayerViewGL2D")],q);const U={pixelCoordRatio:1,
wrapDistance:1E11,halfWidth:K.THIN_LINE_HALF_WIDTH_THRESHOLD+1,initialDistance:0,textured:!0,offset:0};return q});