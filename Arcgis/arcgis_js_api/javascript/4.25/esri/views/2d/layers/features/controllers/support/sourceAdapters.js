// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/workers/Connection ../../../../../../geometry/support/quantizationUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),function(p,f,w,m,x,u,q,v,r,k,y){function z(c){return t.apply(this,
arguments)}function t(){t=f._asyncToGenerator(function*(c){const d=new x;yield d.open(c,{});return d});return t.apply(this,arguments)}let l=function(){function c(d){this.service=d}c.prototype.destroy=function(){};return c}(),A=function(c){function d(a){var b=c.call(this,a)||this;b._portsOpen=z(a.source).then(e=>b.client=e);return b}f._inheritsLoose(d,c);var h=d.prototype;h.destroy=function(){this.client.close();this.client=null};h.executeQuery=function(){var a=f._asyncToGenerator(function*(b,e){yield this._portsOpen;
b=yield this.client.invoke("queryFeatures",b.toJSON(),e);return k.FeatureSetReaderJSON.fromFeatureSet(b,this.service)});return function(b,e){return a.apply(this,arguments)}}();return d}(l),B=function(c){function d(){return c.apply(this,arguments)||this}f._inheritsLoose(d,c);d.prototype.executeQuery=function(){var h=f._asyncToGenerator(function*(a,b){({data:b}=yield r.executeQueryPBFBuffer(this.service.source,a,b));return y.FeatureSetReaderPBF.fromBuffer(b,this.service,!a.quantizationParameters)});
return function(a,b){return h.apply(this,arguments)}}();return d}(l),F=function(c){function d(){return c.apply(this,arguments)||this}f._inheritsLoose(d,c);d.prototype.executeQuery=function(){var h=f._asyncToGenerator(function*(a,b){const {source:e,capabilities:n,spatialReference:C,objectIdField:D,geometryType:E}=this.service;if(m.isSome(a.quantizationParameters)&&!n.query.supportsQuantization){const g=a.clone();a=u.toQuantizationTransform(m.unwrap(g.quantizationParameters));g.quantizationParameters=
null;({data:b}=yield r.executeQuery(e,g,C,b));b=q.convertFromFeatureSet(b,D);q.quantizeOptimizedFeatureSet(a,b);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(b,this.service)}({data:a}=yield r.executeQuery(e,a,this.service.spatialReference,b));"esriGeometryPoint"===E&&(a.features=a.features?.filter(g=>m.isSome(g.geometry)?(g=g.geometry,Number.isFinite(g.x)&&Number.isFinite(g.y)):!0));return k.FeatureSetReaderJSON.fromFeatureSet(a,this.service)});return function(a,b){return h.apply(this,arguments)}}();
return d}(l),G=function(c){function d(){return c.apply(this,arguments)||this}f._inheritsLoose(d,c);d.prototype.executeQuery=function(){var h=f._asyncToGenerator(function*(a,b){var {capabilities:e}=this.service;if(a.quantizationParameters&&!e.query.supportsQuantization){const n=a.clone();e=u.toQuantizationTransform(m.unwrap(n.quantizationParameters));n.quantizationParameters=null;a=yield v.queryOptimizedFeatureSet(this.service.source,a,b);q.quantizeOptimizedFeatureSet(e,a);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,
this.service)}a=yield v.queryOptimizedFeatureSet(this.service.source,a,b);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,this.service)});return function(a,b){return h.apply(this,arguments)}}();return d}(l);p.SourceAdapter=l;p.createSourceAdapter=function(c){const {capabilities:d}=c;return"ogc-source"===c.source?.type?new G(c):Array.isArray(c.source)?new A(c):d.query.supportsFormatPBF&&w("featurelayer-pbf")?new B(c):new F(c)};Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});