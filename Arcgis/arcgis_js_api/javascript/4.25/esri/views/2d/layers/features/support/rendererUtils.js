// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/screenUtils ../../../../webgl/capabilities".split(" "),function(n,w,t,B,x,u){function y(a){return("size"===a.type||"color"===a.type||"opacity"===a.type)&&null!=a.stops}function z(a){var c=a.type;var b=a.stops;if(8>=b.length)c=b;else if(p.warn(`Found ${b.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),16<b.length){const [v,...d]=b;var l=
d.pop(),k=d[0].value,m=d[d.length-1].value,q=(m-k)/6;const r=[];for(;k<m;k+=q){for(var e=0;k>=d[e].value;)e++;var f=d[e],h=b[e-1],g=k-h.value;f=f.value===h.value?1:g/(f.value-h.value);"color"===c?(h=d[e],e=b[e-1],g=h.color.clone(),g.r=(1-f)*e.color.r+f*g.r,g.g=(1-f)*e.color.g+f*g.g,g.b=(1-f)*e.color.b+f*g.b,g.a=(1-f)*e.color.a+f*g.a,r.push({value:k,color:g,label:h.label})):"size"===c?(h=d[e],g=b[e-1],e=x.toPt(h.size),g=x.toPt(g.size),r.push({value:k,size:(1-f)*g+f*e,label:h.label})):(h=d[e],r.push({value:k,
opacity:(1-f)*b[e-1].opacity+f*h.opacity,label:h.label}))}c=[v,...r,l]}else{const [v,...d]=b;for(c=d.pop();6<d.length;){l=b=0;for(m=1;m<d.length;m++)q=Math.abs(d[m].value-d[m-1].value),q>l&&(l=q,b=m);d.splice(b,1)}c=[v,...d,c]}a.stops=c;return a}function A(){if(t("heatmap-force-raster"))return"raster";const {supportsTextureFloat:a,supportsTextureHalfFloat:c,supportsColorBufferFloat:b,supportsColorBufferFloatBlend:l,supportsColorBufferHalfFloat:k}=u.getWebGLCapabilities("2d");return a&&b&&l||c&&k?
"symbol":t("heatmap-allow-raster-fallback")?"raster":"none"}const p=B.getLogger("esri.views.2d.layers.features.support.rendererUtils");n.getSupportedHeatmapRenderer=A;n.isRendererSupported=function(a){if(!a)return!0;switch(a.type){case "dot-density":if(!u.getWebGLCapabilities("2d").supportsTextureFloat)return p.error(new w("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case "heatmap":if(a=A(),"none"===a||"raster"===a&&!t("heatmap-force-raster")){const c=
u.getWebGLCapabilities("2d"),b=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(l=>!c[l]).join(", ");if("none"===a)return p.errorOnce(new w("webgl-missing-extension",`Missing WebGL${c.type} requirements for Heatmap: ${b}`)),!1;"raster"===a&&p.warnOnce(`Missing WebGL${c.type} requirements for accelerated Heatmap: ${b}. Feature support may be limited.`)}}return!0};n.simplifyVVRenderer=a=>{if(!("visualVariables"in
a&&a.visualVariables&&a.visualVariables.length))return a;a=a.clone();const c=a.visualVariables.map(b=>y(b)?z(b):b);a.visualVariables=c;return a};n.simplifyVisualVariables=function(a){return a.map(c=>y(c)?z(c.clone()):c)};Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});