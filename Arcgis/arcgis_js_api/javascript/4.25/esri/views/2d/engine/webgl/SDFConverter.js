// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["../../../../core/floatRGBA","../../../../core/promiseUtils"],function(t,p){return function(){function q(a){this._svg=null;this.size=a;const f=document.createElement("canvas");f.width=f.height=a;this._context=f.getContext("2d");this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a)}var l=q.prototype;l.dispose=function(){this._context=this._gridOuter=this._gridInner=
this._f=this._d=this._z=this._v=null;this._svg&&(document.body.removeChild(this._svg),this._svg=null)};l.draw=function(a,f,e=31){this._initSVG();const g=this.createSVGString(a);return new Promise((k,c)=>{const b=new Image;b.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(g);b.onload=()=>{b.onload=null;this._context.clearRect(0,0,this.size,this.size);this._context.drawImage(b,0,0,this.size,this.size);var d=this._context.getImageData(0,0,this.size,this.size);const r=new Uint8Array(this.size*
this.size*4);for(let n=0;n<this.size*this.size;n++){const m=d.data[4*n+3]/255;this._gridOuter[n]=1===m?0:0===m?1E20:Math.max(0,.5-m)**2;this._gridInner[n]=1===m?1E20:0===m?0:Math.max(0,m-.5)**2}this._edt(this._gridOuter,this.size,this.size);this._edt(this._gridInner,this.size,this.size);for(d=0;d<this.size*this.size;d++)t.packFloatRGBA(.5-(this._gridOuter[d]-this._gridInner[d])/(2*e),r,4*d);k(r)};const h=f&&f.signal;if(h)p.onAbort(h,()=>c(p.createAbortError()))})};l._initSVG=function(){if(!this._svg){const a=
document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("aria-hidden","true");a.setAttribute("role","presentation");document.body.appendChild(a);this._svg=a}return this._svg};l.createSVGString=function(a){const f=this._initSVG(),e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",a);f.appendChild(e);a=e.getBBox();var g=a.width/a.height;const k=this.size/
2;let c,b,h;1<g?(b=c=k/a.width,h=this.size/4,g=k-1/g*k/2):(c=b=k/a.height,h=k-k*g/2,g=this.size/4);e.setAttribute("style",`transform: matrix(${c}, 0, 0, ${b}, ${-a.x*c+h}, ${-a.y*b+g})`);a=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${f.innerHTML}</svg>`;f.removeChild(e);return a};l._edt=function(a,f,e){const g=this._f,k=this._d,c=this._v,b=this._z;for(var h=0;h<f;h++){for(var d=0;d<e;d++)g[d]=a[d*f+h];this._edt1d(g,k,c,b,e);for(d=0;d<e;d++)a[d*
f+h]=k[d]}for(h=0;h<e;h++){for(d=0;d<f;d++)g[d]=a[h*f+d];this._edt1d(g,k,c,b,f);for(d=0;d<f;d++)a[h*f+d]=Math.sqrt(k[d])}};l._edt1d=function(a,f,e,g,k){e[0]=0;g[0]=-1E20;g[1]=1E20;for(let c=1,b=0;c<k;c++){let h=(a[c]+c*c-(a[e[b]]+e[b]*e[b]))/(2*c-2*e[b]);for(;h<=g[b];)b--,h=(a[c]+c*c-(a[e[b]]+e[b]*e[b]))/(2*c-2*e[b]);b++;e[b]=c;g[b]=h;g[b+1]=1E20}for(let c=0,b=0;c<k;c++){for(;g[b+1]<c;)b++;f[c]=(c-e[b])*(c-e[b])+a[e[b]]}};return q}()});