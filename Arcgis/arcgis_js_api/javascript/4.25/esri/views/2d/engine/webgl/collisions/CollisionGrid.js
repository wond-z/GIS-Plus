// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(l,h,p){let t=function(){function n(a,b,c){this._debugMap=new Map;this._width=a*c;this._height=b*c;this._pixelRatio=c;a=Math.ceil(this._width/1);b=Math.ceil(this._height/1);this._cols=a;this._rows=b;this._cells=p.StaticBitSet.create(a*b)}var g=n.prototype;g.insertMetrics=function(a){const b=this._hasCollision(a);0===b&&this._markMetrics(a);return b};g.getCellId=function(a,b){return a+b*this._cols};
g.has=function(a){return this._cells.has(a)};g.hasRange=function(a,b){return this._cells.hasRange(a,b)};g.set=function(a){this._cells.set(a)};g.setRange=function(a,b){this._cells.setRange(a,b)};g._collide=function(a,b,c,d){a-=c/2;b-=d/2;c=a+c;var f=b+d;if(0>c||0>f||a>this._width||b>this._height)return 1;d=h.clamp(Math.floor(a/1),0,this._cols);var e=h.clamp(Math.floor(b/1),0,this._rows);a=h.clamp(Math.ceil(c/1),0,this._cols);b=h.clamp(Math.ceil(f/1),0,this._rows);for(c=e;c<=b;c++)for(f=d;f<=a;f++)if(e=
this.getCellId(f,c),this.has(e))return 2;return 0};g._mark=function(a,b,c,d,f){a-=c/2;b-=d/2;c=a+c;var e=b+d;d=h.clamp(Math.floor(a/1),0,this._cols);var k=h.clamp(Math.floor(b/1),0,this._rows);a=h.clamp(Math.ceil(c/1),0,this._cols);b=h.clamp(Math.ceil(e/1),0,this._rows);for(c=k;c<=b;c++)for(e=d;e<=a;e++)k=this.getCellId(e,c),this._debugMap.set(k,f),this.set(k);return!1};g._hasCollision=function(a){const b=a.id;let c=0,d=0;a.save();do{const f=a.boundsCount;c+=f;for(let e=0;e<f;e++){const k=a.boundsComputedAnchorX(e),
m=a.boundsComputedAnchorY(e),q=(a.boundsWidth(e)+2)*this._pixelRatio,r=(a.boundsHeight(e)+2)*this._pixelRatio;switch(this._collide(k,m,q,r)){case 2:return 2;case 1:d++}}}while(a.peekId()===b&&a.next());a.restore();return c===d?1:0};g._markMetrics=function(a){const b=a.id;a.save();do{const c=a.boundsCount;for(let d=0;d<c;d++){const f=a.boundsComputedAnchorX(d),e=a.boundsComputedAnchorY(d),k=(a.boundsWidth(d)+2)*this._pixelRatio,m=(a.boundsHeight(d)+2)*this._pixelRatio;this._mark(f,e,k,m,a.id)}}while(a.peekId()===
b&&a.next());a.restore()};return n}();l.CollisionBitsetGrid=t;l.HAS_COLLISION=2;l.NONE=0;l.OUTSIDE_EXTENT=1;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});