// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture".split(" "),function(p,q,z,b,r,A){const B=[1,0],C=[0,1];let H=function(){function t(){this._verticalBlurFBO=this._horizontalBlurFBO=null;this._size=[0,0];this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",
attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}var n=t.prototype;n.dispose=function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null);this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null);this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)};n.draw=function(d,c,e){const {context:a,state:D,painter:E}=
d,{materialManager:u}=E,v=this._programDesc,k=c.width,l=c.height,m=[Math.round(k),Math.round(l)],{blurRadius:w,offsetX:F,offsetY:G,color:f}=e;e=[q.pt2px(F),q.pt2px(G)];this._createOrResizeResources(d,k,l,m);const x=this._horizontalBlurFBO;d=this._verticalBlurFBO;a.setStencilWriteMask(0);a.setStencilTestEnabled(!1);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);const y=this._layerFBOTexture;c.copyToTexture(0,0,k,l,0,0,y);this._quad||(this._quad=new z(a,[-1,-1,1,-1,-1,1,1,1]));a.setViewport(0,
0,m[0],m[1]);const h=this._quad;h.bind();a.setBlendingEnabled(!1);const g=u.getProgram(v.blur,[{name:"radius",value:Math.ceil(w)}]);a.useProgram(g);a.bindFramebuffer(x);a.bindTexture(c.colorTexture,4);g.setUniform1i("u_colorTexture",4);g.setUniform2fv("u_texSize",m);g.setUniform2fv("u_direction",B);g.setUniform1f("u_sigma",w);h.draw();a.bindFramebuffer(d);a.bindTexture(x.colorTexture,5);g.setUniform1i("u_colorTexture",5);g.setUniform2fv("u_direction",C);h.draw();a.bindFramebuffer(c);a.setViewport(0,
0,k,l);c=u.getProgram(v.composite);a.useProgram(c);a.bindTexture(d.colorTexture,2);c.setUniform1i("u_blurTexture",2);a.bindTexture(y,3);c.setUniform1i("u_layerFBOTexture",3);c.setUniform4fv("u_shadowColor",[f[0]/255*f[3],f[1]/255*f[3],f[2]/255*f[3],f[3]]);c.setUniformMatrix3fv("u_displayViewMat3",D.displayMat3);c.setUniform2fv("u_shadowOffset",e);h.draw();a.setBlendingEnabled(!0);a.setStencilTestEnabled(!0);a.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA);h.unbind()};n._createOrResizeResources=
function(d,c,e,a){({context:d}=d);this._horizontalBlurFBO&&this._size[0]===c&&this._size[1]===e||(this._size[0]=c,this._size[1]=e,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(a[0],a[1]):this._horizontalBlurFBO=new r.FramebufferObject(d,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE,width:a[0],height:a[1]},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:b.TextureSamplingMode.LINEAR,flipped:!1,width:a[0],height:a[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(a[0],a[1]):this._verticalBlurFBO=new r.FramebufferObject(d,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE,width:a[0],height:a[1]},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:b.TextureSamplingMode.LINEAR,
flipped:!1,width:a[0],height:a[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(c,e):this._layerFBOTexture=new A.Texture(d,{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:b.TextureSamplingMode.LINEAR,flipped:!1,width:c,height:e}))};return t}();p.DropShadow=H;Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});