// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/context-util ../../webgl/enums ../../webgl/Texture".split(" "),function(p,n,q,r,k,y,t,u,z,A,m,B){function w(d){return d&&"render"in d}function x(d){const f=document.createElement("canvas");f.width=d.width;f.height=d.height;d.render(f.getContext("2d"));return f}function C(d){return w(d)?
d instanceof z?q.applySome(d.getRenderedRasterPixels(),f=>f.renderedRasterPixels):x(d):d}u=function(d){function f(a=null,b){var c=d.call(this)||this;c.blendFunction="standard";c._sourceWidth=0;c._sourceHeight=0;c._textureInvalidated=!1;c.stencilRef=0;c.coordScale=[1,1];c._height=void 0;c.pixelRatio=1;c.resolution=0;c.rotation=0;c._source=null;c._width=void 0;c.x=0;c.y=0;c.immutable=b.immutable??!1;c.requestRenderOnSourceChangedEnabled=b.requestRenderOnSourceChangedEnabled??!0;c.source=a;c.requestRender=
c.requestRender.bind(n._assertThisInitialized(c));return c}n._inheritsLoose(f,d);var e=f.prototype;e.destroy=function(){this._texture&&(this._texture.dispose(),this._texture=null);q.isSome(this._uploadStatus)&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)};e.beforeRender=function(a){d.prototype.beforeRender.call(this,a);this.updateTexture(a)};e.setSourceAsync=function(){var a=n._asyncToGenerator(function*(b,c){q.isSome(this._uploadStatus)&&this._uploadStatus.controller.abort();const h=
new AbortController,g=r.createResolver();r.onAbortOrThrow(c,()=>h.abort());r.onAbortOrThrow(h,l=>g.reject(l));this._uploadStatus={controller:h,resolver:g};this.source=b;return g.promise});return function(b,c){return a.apply(this,arguments)}}();e.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())};e.updateTransitionProperties=function(a,b){64<=a&&(this.inFadeTransition=this.fadeTransitionEnabled=!1);d.prototype.updateTransitionProperties.call(this,
a,b)};e.setTransform=function(a){const b=k.identity(this.transforms.dvs),[c,h]=a.toScreenNoRotation([0,0],[this.x,this.y]);var g=this.resolution/this.pixelRatio/a.resolution;const l=g*this.width;g*=this.height;const v=Math.PI*this.rotation/180;k.translate(b,b,t.fromValues(c,h));k.translate(b,b,t.fromValues(l/2,g/2));k.rotate(b,b,-v);k.translate(b,b,t.fromValues(-l/2,-g/2));k.scaleByVec2(b,b,t.fromValues(l,g));k.multiply(this.transforms.dvs,a.displayViewMat3,b)};e.setSamplingProfile=function(a){this._texture&&
(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};e.bind=function(a,b){this._texture&&a.bindTexture(this._texture,b)};e.updateTexture=function(){var a=n._asyncToGenerator(function*({context:b,painter:c}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(b)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);b=C(this.source);try{if(q.isSome(this._uploadStatus)){const {controller:h,
resolver:g}=this._uploadStatus,l={signal:h.signal},{width:v,height:D}=this;yield c.textureUploadManager.enqueueTextureUpdate({data:b,texture:this._texture,width:v,height:D},l);g.resolve();this._uploadStatus=null}else this._texture.setData(b);this.ready()}catch(h){r.throwIfNotAbortError(h)}}else this._texture.setData(null)});return function(b){return a.apply(this,arguments)}}();e.onDetach=function(){this.destroy()};e._createTransforms=function(){return{dvs:y.create()}};e._createTexture=function(a){const b=
this.immutable&&a.type===A.ContextType.WEBGL2;return new B.Texture(a,{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:b?m.SizedPixelFormat.RGBA8:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,isImmutable:b,width:this._sourceWidth,height:this._sourceHeight})};n._createClass(f,[{key:"isSourceScaled",get:function(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}},{key:"height",get:function(){return void 0!==
this._height?this._height:this._sourceHeight},set:function(a){this._height=a}},{key:"source",get:function(){return this._source},set:function(a){if(null!=a||null!=this._source)this._source=a,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width),this.invalidateTexture()}},{key:"width",get:function(){return void 0!==this._width?this._width:this._sourceWidth},
set:function(a){this._width=a}}]);return f}(u.DisplayObject);p.Bitmap=u;p.isImageSource=w;p.rasterize=x;Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});