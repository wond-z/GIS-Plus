// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./definitions","./Geometry","./GeometryUtils"],function(x,z,A,n,v){let w=function(m,d,a){this.ratio=m;this.x=d;this.y=a},C=function(){function m(a,b,e,f=8,c=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=f;this._pixelMargin=c;this._tileSize=A.TILE_SIZE*f;this._dz=a;this._yPos=b;this._xPos=e}var d=m.prototype;d.setPixelMargin=function(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))};
d.setExtent=function(a){this._extent=a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-b;this._ymin=a*this._yPos-b;this._xmax=this._xmin+a+2*b;this._ymax=this._ymin+a+2*b};d.reset=function(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0};d.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=
new n.Point(a,b);this._firstPt=new n.Point(a,b);this._dist=0};d.lineTo=function(a,b){const e=this._isIn(a,b),f=new n.Point(a,b),c=n.Point.distance(this._prevPt,f);if(e)if(this._prevIsIn)this._lineTo(a,b,!0);else{var g=this._prevPt;var h=f;a=this._intersect(h,g);this._start=this._dist+c*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(h.x,h.y,!0)}else if(this._prevIsIn)h=this._prevPt,g=f,a=this._intersect(h,g),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!1);else{const k=this._prevPt;if(!(k.x<=this._xmin&&
f.x<=this._xmin||k.x>=this._xmax&&f.x>=this._xmax||k.y<=this._ymin&&f.y<=this._ymin||k.y>=this._ymax&&f.y>=this._ymax)){a=[];if(k.x<this._xmin&&f.x>this._xmin||k.x>this._xmin&&f.x<this._xmin){b=(this._xmin-k.x)/(f.x-k.x);var l=k.y+b*(f.y-k.y);l<=this._ymin?h=!1:l>=this._ymax?h=!0:a.push(new w(b,this._xmin,l))}if(k.x<this._xmax&&f.x>this._xmax||k.x>this._xmax&&f.x<this._xmax)b=(this._xmax-k.x)/(f.x-k.x),l=k.y+b*(f.y-k.y),l<=this._ymin?h=!1:l>=this._ymax?h=!0:a.push(new w(b,this._xmax,l));if(k.y<this._ymin&&
f.y>this._ymin||k.y>this._ymin&&f.y<this._ymin)b=(this._ymin-k.y)/(f.y-k.y),l=k.x+b*(f.x-k.x),l<=this._xmin?g=!1:l>=this._xmax?g=!0:a.push(new w(b,l,this._ymin));if(k.y<this._ymax&&f.y>this._ymax||k.y>this._ymax&&f.y<this._ymax)b=(this._ymax-k.y)/(f.y-k.y),l=k.x+b*(f.x-k.x),l<=this._xmin?g=!1:l>=this._xmax?g=!0:a.push(new w(b,l,this._ymax));if(0===a.length)g?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,
this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+c*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+c*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=c;this._prevIsIn=e;this._prevPt=f};d.close=function(){if(2<this._line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===
a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};d.result=function(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===n.GeometryType.Polygon&&a&&B.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines};d.resultWithStarts=function(){if(this._type!==n.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const e=[];for(let f=
0;f<b;f++)e.push({line:a[f],start:this._starts[f]||0});return e};d._isIn=function(a,b){return a>=this._xmin&&a<=this._xmax&&b>=this._ymin&&b<=this._ymax};d._intersect=function(a,b){let e,f,c;if(b.x>=this._xmin&&b.x<=this._xmax)f=b.y<=this._ymin?this._ymin:this._ymax,c=(f-a.y)/(b.y-a.y),e=a.x+c*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)e=b.x<=this._xmin?this._xmin:this._xmax,c=(e-a.x)/(b.x-a.x),f=a.y+c*(b.y-a.y);else{f=b.y<=this._ymin?this._ymin:this._ymax;e=b.x<=this._xmin?this._xmin:this._xmax;
const g=(e-a.x)/(b.x-a.x),h=(f-a.y)/(b.y-a.y);g<h?(c=g,f=a.y+g*(b.y-a.y)):(c=h,e=a.x+h*(b.x-a.x))}this._r=c;return new n.Point(e,f)};d._pushLine=function(){this._line&&(this._type===n.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));
this._line=[];this._start=0};d._moveTo=function(a,b,e){this._type!==n.GeometryType.Polygon?e&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new n.Point(a,b))):(e||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new n.Point(a,
b)),this._isV=this._isH=!1)};d._lineTo=function(a,b,e){if(this._type!==n.GeometryType.Polygon)if(e){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(e=this._line[this._line.length-1],e.equals(a,b)))return;this._line.push(new n.Point(a,b))}else this._line&&0<this._line.length&&this._pushLine();else if(e||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&
(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){e=this._line[this._line.length-1];const f=e.x===a,c=e.y===b;f&&c||(this._isH&&f?(e.x=a,e.y=b,e=this._line[this._line.length-2],e.x===a&&e.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(e=this._line[this._line.length-2],this._isH=e.x===a,this._isV=e.y===b)):(this._isH=e.x===a,this._isV=e.y===b)):this._isV&&c?
(e.x=a,e.y=b,e=this._line[this._line.length-2],e.x===a&&e.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(e=this._line[this._line.length-2],this._isH=e.x===a,this._isV=e.y===b)):(this._isH=e.x===a,this._isV=e.y===b)):(this._line.push(new n.Point(a,b)),this._isH=f,this._isV=c))}else this._line.push(new n.Point(a,b))};return m}(),D=function(){function m(){}var d=m.prototype;d.setExtent=function(a){this._ratio=4096===a?1:4096/a};d.reset=function(a){this._lines=[];this._line=null};
d.moveTo=function(a,b){this._line&&this._lines.push(this._line);this._line=[];const e=this._ratio;this._line.push(new n.Point(a*e,b*e))};d.lineTo=function(a,b){const e=this._ratio;this._line.push(new n.Point(a*e,b*e))};d.close=function(){const a=this._line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};d.result=function(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines};z._createClass(m,[{key:"validateTessellation",get:function(){return 1>this._ratio}}]);return m}();
var q;(function(m){m[m.sideLeft=0]="sideLeft";m[m.sideRight=1]="sideRight";m[m.sideTop=2]="sideTop";m[m.sideBottom=3]="sideBottom"})(q||(q={}));let B=function(){function m(){}m.simplify=function(d,a,b){if(b){var e=-a,f=d+a,c=-a,g=d+a;d=[];a=[];var h=b.length;for(let l=0;l<h;++l){const k=b[l];if(!k||2>k.length)continue;let r=k[0],t;const u=k.length;for(let p=1;p<u;++p)t=k[p],r.x===t.x&&(r.x<=e&&(r.y>t.y?(d.push(l),d.push(p),d.push(q.sideLeft),d.push(-1)):(a.push(l),a.push(p),a.push(q.sideLeft),a.push(-1))),
r.x>=f&&(r.y<t.y?(d.push(l),d.push(p),d.push(q.sideRight),d.push(-1)):(a.push(l),a.push(p),a.push(q.sideRight),a.push(-1)))),r.y===t.y&&(r.y<=c&&(r.x<t.x?(d.push(l),d.push(p),d.push(q.sideTop),d.push(-1)):(a.push(l),a.push(p),a.push(q.sideTop),a.push(-1))),r.y>=g&&(r.x>t.x?(d.push(l),d.push(p),d.push(q.sideBottom),d.push(-1)):(a.push(l),a.push(p),a.push(q.sideBottom),a.push(-1)))),r=t}0!==d.length&&0!==a.length&&(m.fillParent(b,a,d),m.fillParent(b,d,a),e=[],m.calcDeltas(e,a,d),m.calcDeltas(e,d,a),
m.addDeltas(e,b))}};m.fillParent=function(d,a,b){const e=b.length,f=a.length;for(let k=0;k<f;k+=4){var c=a[k],g=a[k+1];const r=a[k+2],t=d[c][g-1];c=d[c][g];g=8092;let u=-1;for(let p=0;p<e;p+=4){if(b[p+2]!==r)continue;var h=b[p];const y=b[p+1];var l=d[h][y-1];h=d[h][y];switch(r){case q.sideLeft:case q.sideRight:v.between(t.y,l.y,h.y)&&v.between(c.y,l.y,h.y)&&(l=Math.abs(h.y-l.y),l<g&&(g=l,u=p));break;case q.sideTop:case q.sideBottom:v.between(t.x,l.x,h.x)&&v.between(c.x,l.x,h.x)&&(l=Math.abs(h.x-l.x),
l<g&&(g=l,u=p))}}a[k+3]=u}};m.calcDeltas=function(d,a,b){const e=a.length;for(let f=0;f<e;f+=4){const c=m.calcDelta(f,a,b,[]);d.push(a[f]);d.push(a[f+1]);d.push(a[f+2]);d.push(c)}};m.calcDelta=function(d,a,b,e){d=a[d+3];if(-1===d)return 0;const f=e.length;if(1<f&&e[f-2]===d)return 0;e.push(d);return m.calcDelta(d,b,a,e)+1};m.addDeltas=function(d,a){const b=d.length;let e=0;for(var f=0;f<b;f+=4){var c=d[f+3];c>e&&(e=c)}for(f=0;f<b;f+=4){c=a[d[f]];const g=d[f+1],h=e-d[f+3];switch(d[f+2]){case q.sideLeft:c[g-
1].x-=h;c[g].x-=h;1===g&&(c[c.length-1].x-=h);g===c.length-1&&(c[0].x-=h);break;case q.sideRight:c[g-1].x+=h;c[g].x+=h;1===g&&(c[c.length-1].x+=h);g===c.length-1&&(c[0].x+=h);break;case q.sideTop:c[g-1].y-=h;c[g].y-=h;1===g&&(c[c.length-1].y-=h);g===c.length-1&&(c[0].y-=h);break;case q.sideBottom:c[g-1].y+=h,c[g].y+=h,1===g&&(c[c.length-1].y+=h),g===c.length-1&&(c[0].y+=h)}}};return m}();x.SimpleBuilder=D;x.TileClipper=C;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});