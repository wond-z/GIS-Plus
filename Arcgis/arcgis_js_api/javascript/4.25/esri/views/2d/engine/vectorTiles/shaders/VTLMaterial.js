// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../MemoryBuffer ./enums ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),function(F,K,G,L,e,m,H){let J=function(){function y(b){this._locations=new Map;this._key=b}var k=y.prototype;k.defines=function(){return[]};k.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};k.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();
return this._locations};k.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};k.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};k.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};k.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};k.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();
return this._shaderMain};k.setDataUniforms=function(b,d,h,l,u){var n=this.getUniforms();for(const a of n){const {name:c,type:p,getValue:f}=a;n=f(h,d,l,u);if(null!==n)switch(p){case "float":b.setUniform1f(c,n);break;case "vec2":b.setUniform2fv(c,n);break;case "vec4":b.setUniform4fv(c,n)}}};k.encodeAttributes=function(b,d,h,l){const u=this.attributesInfo(),n=this.getEncodingInfos(),a=[];let c=0,p=0;for(const q of Object.keys(n)){var f=n[q];const {type:A,precisionFactor:r,isLayout:B}=u[q],C=B?h.getLayoutProperty(q):
h.getPaintProperty(q),w=C.interpolator?.getInterpolationRange(d);let z=0;for(const v of f){const {offset:g,bufferElementsToAdd:t}=v;if(0<t){for(f=0;f<t;f++)a.push(0);c+=p;p=v.bufferElementsToAdd}f=l??C.getValue(w?w[z]:d,b);switch(A){case e.EncodingType.R8_SIGNED:case e.EncodingType.R8_UNSIGNED:a[c]|=this._encodeByte(f*(r||1),8*g);break;case e.EncodingType.R16_SIGNED:case e.EncodingType.R16_UNSIGNED:a[c]|=this._encodeShort(f*(r||1),8*g);break;case e.EncodingType.R8G8_SIGNED:case e.EncodingType.R8G8_UNSIGNED:a[c]|=
this._encodeByte(f*(r||1),8*g);a[c]|=this._encodeByte(f*(r||1),8*g+8);break;case e.EncodingType.R16G16_SIGNED:case e.EncodingType.R16G16_UNSIGNED:a[c]|=this._encodeShort(f*(r||1),8*g);a[c]|=this._encodeShort(f*(r||1),8*g+16);break;case e.EncodingType.R8G8B8A8_SIGNED:case e.EncodingType.R8G8B8A8_UNSIGNED:a[c]|=this._encodeByte(f*(r||1),8*g);a[c]|=this._encodeByte(f*(r||1),8*g+8);a[c]|=this._encodeByte(f*(r||1),8*g+16);a[c]|=this._encodeByte(f*(r||1),8*g+24);break;case e.EncodingType.R8G8B8A8_COLOR:a[c]=
this._encodeColor(f);break;case e.EncodingType.R16G16B16A16_DASHARRAY:case e.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(c,a,f);break;default:throw Error("Unsupported encoding type");}z++}}return a};k.getAtributeState=function(b){const d=3+2*b;b=0|this._bit(d);return b|=this._bit(d+1)<<1};k._buildAttributesInfo=function(){const b=[],d={};var h={},l=-1;const u=this.attributesInfo();var n=this.attributes();let a=-1;for(const q of n){a++;n=this.getAtributeState(a);if(n===e.AttributeStatus.UNIFORM||
n===e.AttributeStatus.UNUSED)continue;var c=u[q];const A=[];d[q]=A;c=c.type;for(let r=0;r<n;r++){const {dataType:B,bytesPerElement:C,count:w,normalized:z}=y._encodingInfo[c],v=C*w;var p=`${B}-${!0===z}`;let g=h[p],t=0;!g||4<g.count+w?(l++,g={dataIndex:l,count:0,offset:0},4!==w&&(h[p]=g),b.push({location:-1,name:"a_data_"+l,count:w,type:B,normalized:z}),t=Math.ceil(Math.max(v/4,1))):(p=b[g.dataIndex],p.count+=w,t=Math.ceil(Math.max(p.count*C/4,1))-Math.ceil(Math.max(g.offset/4,1)));A.push({dataIndex:g.dataIndex,
offset:g.offset,bufferElementsToAdd:t});g.offset+=v;g.count+=w}}for(const q of b)switch(q.type){case m.DataType.BYTE:case m.DataType.UNSIGNED_BYTE:q.count=4;break;case m.DataType.SHORT:case m.DataType.UNSIGNED_SHORT:q.count+=q.count%2}this._buildVertexBufferLayout(b);h=0;l=this._layoutInfo.geometry;for(var f of l)this._locations.set(f.name,h++);if(f=this._layoutInfo.opacity)for(const q of f)this._locations.set(q.name,h++);this._buildShaderInfo(b,d);this._propertyEncodingInfo=d};k._buildVertexBufferLayout=
function(b){const d={},h=this.geometryInfo();let l=h[0].stride;if(0===b.length)d.geometry=h;else{const u=[];let n=l;for(const a of b)l+=I(a.type)*a.count;for(const a of h)u.push(new H.VertexElementDescriptor(a.name,a.count,a.type,a.offset,l,a.normalized));for(const a of b)u.push(new H.VertexElementDescriptor(a.name,a.count,a.type,n,l,a.normalized)),n+=I(a.type)*a.count;d.geometry=u}this.opacityInfo()&&(d.opacity=this.opacityInfo());this._layoutInfo=d;this._stride=l};k._buildShaderInfo=function(b,
d){let h="\n",l="\n";const u=[];for(var n of b)h+=`attribute ${this._getType(n.count)} ${n.name};\n`;var a=this.attributes();b=this.attributesInfo();n=-1;for(const f of a){n++;const {name:q,type:A,precisionFactor:r,isLayout:B}=b[f];a=r&&1!==r?` * ${1/r}`:"";const {bytesPerElement:C,count:w}=y._encodingInfo[A];var c=z=>`a_data_${z.dataIndex}${M(w,z.offset,C)}`;switch(this.getAtributeState(n)){case e.AttributeStatus.UNIFORM:a=this._getType(w);var p=`u_${q}`;u.push({name:p,type:a,getValue:(v,g,t,x)=>
{t=B?v.getLayoutValue(f,g):v.getPaintValue(f,g);if(A===e.EncodingType.R16G16B16A16_DASHARRAY){v=v.getDashKey(t,v.getLayoutValue("line-cap",g));x=x.getMosaicItemPosition(v,!1);if(G.isNone(x))return null;const {tl:D,br:E}=x;return[D[0],E[1],E[0],D[1]]}if(A===e.EncodingType.R16G16B16A16_PATTERN){x=x.getMosaicItemPosition(t,!f.includes("line-"));if(G.isNone(x))return null;const {tl:D,br:E}=x;return[D[0],E[1],E[0],D[1]]}return A===e.EncodingType.R8G8B8A8_COLOR?(x=t[3],[x*t[0],x*t[1],x*t[2],x]):t}});h+=
`uniform ${a} ${p};\n`;l+=`${a} ${q} = ${p};\n`;break;case e.AttributeStatus.DATA_DRIVEN:p=c(d[f][0]);l+=`${this._getType(w)} ${q} = ${p}${a};\n`;break;case e.AttributeStatus.INTERPOLATED_DATA_DRIVEN:p=`u_t_${q}`;u.push({name:p,type:"float",getValue:(v,g,t,x)=>(B?v.getLayoutProperty(f):v.getPaintProperty(f)).interpolator.interpolationUniformValue(t,g)});h+=`uniform float ${p};\n`;const z=c(d[f][0]);c=c(d[f][1]);l+=`${this._getType(w)} ${q} = mix(${z}${a}, ${c}${a}, ${p});\n`}}this._shaderHeader=h;
this._shaderMain=l;this._uniforms=u};k._bit=function(b){return(this._key&1<<b)>>b};k._getType=function(b){switch(b){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};k._encodeColor=function(b){const d=255*b[3];return L.i8888to32(b[0]*d,b[1]*d,b[2]*d,d)};k._encodePattern=function(b,d,h){if(h&&h.rect){var l=h.rect,u=h.width;h=h.height;d[b]=this._encodeShort(l.x+2,0);d[b]|=this._encodeShort(l.y+2+h,16);d[b+1]=this._encodeShort(l.x+2+u,0);
d[b+1]|=this._encodeShort(l.y+2,16)}};k._encodeByte=function(b,d){return(b&255)<<d};k._encodeShort=function(b,d){return(b&65535)<<d};K._createClass(y,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return y}();J._encodingInfo={[e.EncodingType.R8_SIGNED]:{dataType:m.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R8_UNSIGNED]:{dataType:m.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R16_SIGNED]:{dataType:m.DataType.SHORT,
bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R16_UNSIGNED]:{dataType:m.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R8G8_SIGNED]:{dataType:m.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R8G8_UNSIGNED]:{dataType:m.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R16G16_SIGNED]:{dataType:m.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R16G16_UNSIGNED]:{dataType:m.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R8G8B8A8_SIGNED]:{dataType:m.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:m.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_COLOR]:{dataType:m.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[e.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:m.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[e.EncodingType.R16G16B16A16_PATTERN]:{dataType:m.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:4,normalized:!1}};const I=y=>{switch(y){case m.DataType.FLOAT:return 4;case m.DataType.INT:return 4;case m.DataType.UNSIGNED_INT:return 4;case m.DataType.SHORT:return 2;case m.DataType.UNSIGNED_SHORT:return 2;case m.DataType.BYTE:return 1;case m.DataType.UNSIGNED_BYTE:return 1}},M=(y,k,b)=>{k/=b;if(1===y)switch(k){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===y)switch(k){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===
y)switch(k){case 0:return".xyz";case 1:return".yzw"}return""};F.VTLMaterial=J;Object.defineProperties(F,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});