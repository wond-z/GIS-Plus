// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(A,n,B,e){const m=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,
.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),y={beaufort_ft:m,beaufort_m:m,beaufort_km:m,beaufort_mi:m,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,
.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,
.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,
1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),single_arrow:new Float32Array([0,92/255,230/255,1]),wind_speed:new Float32Array([0,0,0,1])};return function(z){function p(){var a=z.apply(this,
arguments)||this;a._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};return a}A._inheritsLoose(p,z);var h=p.prototype;h.dispose=function(){};h.prepareState=function({context:a}){a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);
a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilOp(e.StencilOperation.KEEP,e.StencilOperation.KEEP,e.StencilOperation.REPLACE)};h.draw=function(a,c){if(!n.isNone(c.source)&&0!==c.source.validPixelCount){var {context:f,timeline:k}=a;k.begin(this.name);f.setStencilFunction(e.CompareFunction.EQUAL,c.stencilRef,255);c.updateVectorFieldVAO(a);if("scalar"===a.renderPass){var d=c.vaoData.scalar;d&&this._drawScalars(a,c,d.vao,d.elementCount)}else(d=c.vaoData.magdir)&&
this._drawTriangles(a,c,d.vao,d.elementCount);k.end(this.name)}};h._drawTriangles=function(a,c,f,k){const {context:d,painter:q,requestRender:l,allowDelayedRender:r}=a,{symbolizerParameters:g}=c;var b=g.dataRange?["dataRange"]:[];"geographic"===g.rotationType&&b.push("rotationGeographic");b=q.materialManager.getProgram(this._desc.magdir,b);if(r&&n.isSome(l)&&!b.isCompiled)l();else{d.useProgram(b);var {coordScale:t,opacity:u,transforms:v}=c;b.setUniform2fv("u_coordScale",t);b.setUniform1f("u_opacity",
u);b.setUniformMatrix3fv("u_dvsMat3",v.dvs);var {style:w,dataRange:x,rotation:C,symbolPercentRange:D}=g;b.setUniform4fv("u_colors",y[w]||y.single_arrow);b.setUniform2fv("u_dataRange",x);b.setUniform1f("u_rotation",C);b.setUniform2fv("u_symbolPercentRange",D);a=this._getSymbolSize(a,c);b.setUniform2fv("u_symbolSize",a);d.bindVAO(f);d.drawElements(e.PrimitiveType.TRIANGLES,k,e.DataType.UNSIGNED_INT,0)}};h._drawScalars=function(a,c,f,k){const {context:d,painter:q,requestRender:l,allowDelayedRender:r}=
a,{symbolizerParameters:g}=c;var b=[];"wind_speed"===g.style?b.push("innerCircle"):g.dataRange&&b.push("dataRange");"geographic"===g.rotationType&&b.push("rotationGeographic");b=q.materialManager.getProgram(this._desc.scalar,b);if(r&&n.isSome(l)&&!b.isCompiled)l();else{d.useProgram(b);var {coordScale:t,opacity:u,transforms:v}=c;b.setUniform2fv("u_coordScale",t);b.setUniform1f("u_opacity",u);b.setUniformMatrix3fv("u_dvsMat3",v.dvs);var {dataRange:w,symbolPercentRange:x}=g;b.setUniform2fv("u_dataRange",
w);b.setUniform2fv("u_symbolPercentRange",x);a=this._getSymbolSize(a,c);b.setUniform2fv("u_symbolSize",a);d.bindVAO(f);d.drawElements(e.PrimitiveType.TRIANGLES,k,e.DataType.UNSIGNED_INT,0)}};h._getSymbolSize=function(a,c){a=c.key?2**(a.displayLevel-c.key.level):c.resolution/a.state.resolution;const {symbolTileSize:f}=c.symbolizerParameters;return[f/(Math.round((c.width-c.offset[0])/f)*f)/a,f/(Math.round((c.height-c.offset[1])/f)*f)/a]};return p}(B)});