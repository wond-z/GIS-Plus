// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3f32 ../brushes ../Container ./ClippingInfo ./enums".split(" "),function(h,u,g,p,q,r,t,d){return function(e){function f(){var a=e.apply(this,arguments)||this;a.name=a.constructor.name;return a}h._inheritsLoose(f,e);var c=f.prototype;c.beforeRender=function(a){e.prototype.beforeRender.call(this,a);this.updateTransforms(a.state)};c._createTransforms=function(){return{dvs:p.create()}};
c.doRender=function(a){a=this.createRenderParams(a);const {painter:b,globalOpacity:k,profiler:l,drawPhase:m}=a,n=m===d.WGLDrawPhase.LABEL||m===d.WGLDrawPhase.HIGHLIGHT?1:k*this.computedOpacity;l.recordContainerStart(this.name);b.beforeRenderLayer(a,this._clippingInfos?255:0,n);this.renderChildren(a);b.compositeLayer(a,n);l.recordContainerEnd()};c.renderChildren=function(a){g.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(a.painter));for(const b of this._renderPasses)try{b.render(a)}catch(k){}};
c.createRenderParams=function(a){a.requireFBO=this.requiresDedicatedFBO;return a};c.prepareRenderPasses=function(a){return[a.registerRenderPass({name:"clip",brushes:[q.brushes.clip],target:()=>this._clippingInfos,drawPhase:d.WGLDrawPhase.MAP|d.WGLDrawPhase.LABEL|d.WGLDrawPhase.LABEL_ALPHA|d.WGLDrawPhase.DEBUG|d.WGLDrawPhase.HIGHLIGHT})]};c.updateTransforms=function(a){for(const b of this.children)b.setTransform(a)};c.onAttach=function(){e.prototype.onAttach.call(this);this._updateClippingInfo()};
c.onDetach=function(){e.prototype.onDetach.call(this);this._updateClippingInfo()};c._updateClippingInfo=function(){g.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(b=>b.destroy()),this._clippingInfos=null);if(this.stage){var a=this._clips;g.isSome(a)&&a.length&&(this._clippingInfos=a.items.map(b=>t.fromClipArea(this.stage,b)));this.requestRender()}};h._createClass(f,[{key:"clips",set:function(a){this._clips=a;this.children.forEach(b=>b.clips=a);this._updateClippingInfo()}}]);return f}(r.Container)});