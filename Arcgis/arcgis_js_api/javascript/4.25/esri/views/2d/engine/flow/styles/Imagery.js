// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(t,v,z,u,A,h,B,C,w){let D=function(){function l(b){this._params=b;this.animated=!1}var m=l.prototype;m.isCompatible=function(b){if(!(b instanceof l&&u.timeExtentsEqual(this._params.timeExtent,b._params.timeExtent)))return!1;
let e;return e=(e=(e=this._params.loadImagery===b._params.loadImagery)&&this._params.color.kind===b._params.color.kind)&&this._params.opacity.kind===b._params.opacity.kind};m.load=function(){var b=v._asyncToGenerator(function*(e,a){const {extent:f,size:n}=e;z.throwIfAborted(a);e=yield this._params.loadImagery(f,n[0],n[1],this._params.timeExtent,a);return new x(e,{color:this._params.color,opacity:this._params.opacity})});return function(e,a){return b.apply(this,arguments)}}();m.render=function(b,e,
a){({context:b}=b);const {program:f}=a;b.setFaceCullingEnabled(!1);b.setBlendingEnabled(!0);b.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);b.useProgram(f);f.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3);b.bindTexture(a.texture,0);f.setUniform1i("u_texture",0);f.setUniform1f("u_Min",a.min);f.setUniform1f("u_Max",a.max);u.setUniforms(f,"color","vec4",this._params.color);u.setUniforms(f,"opacity","float",this._params.opacity);b.bindVAO(a.vertexArray);b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,
0,4)};return l}();const q=new Map;q.set("a_position",0);q.set("a_texcoord",1);const E={geometry:[new w.VertexElementDescriptor("a_position",2,h.DataType.UNSIGNED_SHORT,0,8),new w.VertexElementDescriptor("a_texcoord",2,h.DataType.UNSIGNED_SHORT,4,8)]},F={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:q};let x=function(){function l(b,e){this._flowData=b;this._values=e}var m=l.prototype;m.attach=function(b){var {context:e}=b;const {width:a,height:f}=this._flowData;var n={geometry:A.BufferObject.createVertex(e,
h.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,f,0,0,a,f,1,0]))};n=new C.VertexArrayObject(e,q,E,n);var k=[];"ramp"===this._values.color.kind&&k.push("vvColor");"ramp"===this._values.opacity.kind&&k.push("vvOpacity");b=b.painter.materialManager.getProgram(F,k);k=1E6;let r=-1E6;for(var g=0;g<f;g++)for(var c=0;c<a;c++)if(0!==this._flowData.mask[g*a+c]){var d=this._flowData.data[2*(g*a+c)],p=this._flowData.data[2*(g*a+c)+1];d=Math.sqrt(d*d+p*p);k=Math.min(k,d);r=Math.max(r,d)}g=new Uint8Array(4*
a*f);for(c=0;c<f;c++)for(d=0;d<a;d++)if(0!==this._flowData.mask[c*a+d]){p=this._flowData.data[2*(c*a+d)];const y=this._flowData.data[2*(c*a+d)+1];g[4*(c*a+d)]=(Math.sqrt(p*p+y*y)-k)/(r-k)*255;g[4*(c*a+d)+1]=0;g[4*(c*a+d)+2]=0;g[4*(c*a+d)+3]=255}else g[4*(c*a+d)]=0,g[4*(c*a+d)+1]=0,g[4*(c*a+d)+2]=0,g[4*(c*a+d)+3]=0;e=new B.Texture(e,{pixelFormat:h.PixelFormat.RGBA,internalFormat:h.PixelFormat.RGBA,samplingMode:h.TextureSamplingMode.LINEAR,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,width:a,height:f},g);this.vertexArray=n;this.program=b;this.texture=e;this.min=k;this.max=r;this._flowData=null};m.detach=function(){this.vertexArray.dispose();this.texture.dispose()};v._createClass(l,[{key:"ready",get:function(){return this.program.isCompiled}}]);return l}();t.Imagery=D;t.ImageryResources=x;Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});