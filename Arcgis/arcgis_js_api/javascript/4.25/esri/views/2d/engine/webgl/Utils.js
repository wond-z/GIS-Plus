// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ./color ./enums ./SymbolProperties ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexElementDescriptor".split(" "),function(b,t,u,z,A,m,B,e,W,g,X,Y){function n(a){const c={};for(const d of a)c[d.name]=d.strideInBytes;return c}function C(a){switch(a){case e.WGLGeometryType.MARKER:return Z;case e.WGLGeometryType.FILL:return aa;case e.WGLGeometryType.LINE:return ba;
case e.WGLGeometryType.TEXT:return ca;case e.WGLGeometryType.LABEL:return da}}function D(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function E(a){switch(a){case g.DataType.BYTE:case g.DataType.UNSIGNED_BYTE:return 1;case g.DataType.SHORT:case g.DataType.UNSIGNED_SHORT:return 2;case g.DataType.FLOAT:case g.DataType.INT:case g.DataType.UNSIGNED_INT:return 4}}function ea(a){const c={};for(const d in a){let f=0;c[d]=a[d].map(h=>{const k=new Y.VertexElementDescriptor(h.name,h.count,
h.type,f,0,h.normalized||!1);f+=h.count*E(h.type);return k});c[d].forEach(h=>h.stride=f)}return c}const r=u.getLogger("esri.views.2d.engine.webgl.Utils");u=[{name:"geometry",strideInBytes:36}];const F=[{name:"geometry",strideInBytes:12}],G=[{name:"geometry",strideInBytes:36}],H=[{name:"geometry",strideInBytes:24}],I=[{name:"geometry",strideInBytes:12}],J=[{name:"geometry",strideInBytes:40}],K=[{name:"geometry",strideInBytes:36}],L=[{name:"geometry",strideInBytes:36}],M=n(u),N=n(F),O=n(G),P=n(H),Q=
n(I),R=n(J),S=n(K),T=n(L),Z=["geometry"],aa=["geometry"],ba=["geometry"],ca=["geometry"],da=["geometry"],fa={geometry:g.Usage.STATIC_DRAW},v=new Map,w=a=>a.startsWith("data:image/gif"),x=a=>a.startsWith("data:image/png"),U=a=>{if(!a)return!1;a=a.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(a)&&/[\dz]$/i.test(a)&&4<a.length?!0:!1},V=a=>"fill"===a.type&&"CIMMarkerPlacementInsidePolygon"===a?.cim?.markerPlacement?.type;b.C_FILL_STRIDE_SPEC=O;b.C_FILL_STRIDE_SPEC_DD=Q;b.C_FILL_STRIDE_SPEC_SIMPLE=
P;b.C_FILL_VERTEX_DEF=G;b.C_FILL_VERTEX_DEF_DD=I;b.C_FILL_VERTEX_DEF_SIMPLE=H;b.C_HEATMAP_STRIDE_SPEC=N;b.C_HEATMAP_VERTEX_DEF=F;b.C_ICON_STRIDE_SPEC=M;b.C_ICON_VERTEX_DEF=u;b.C_LABEL_STRIDE_SPEC=T;b.C_LABEL_VERTEX_DEF=L;b.C_LINE_STRIDE_SPEC=R;b.C_LINE_VERTEX_DEF=J;b.C_TEXT_STRIDE_SPEC=S;b.C_TEXT_VERTEX_DEF=K;b.C_VBO_GEOMETRY="geometry";b.C_VBO_INFO=fa;b.C_VBO_PERINSTANCE="per_instance";b.C_VBO_PERINSTANCE_VV="per_instance_vv";b.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*
c/4));case 1:case 3:return new Uint8Array(a*c)}};b.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};b.charCodes=function(a){const c=[];for(let d=0;d<a.length;d++)c.push(a.charCodeAt(d));return c};b.copyMeshData=function(a,c,d,f,h,k,l){for(const y in k){var q=k[y].stride,p=D(q);const ha=k[y].data,ia=d[y].data,ja=q*h.vertexCount/p,ka=q*a/p;q=q*h.vertexFrom/p;for(p=0;p<ja;++p)ia[p+ka]=ha[p+q]}d=h.indexCount;for(k=
0;k<d;++k)f[k+c]=l[k+h.indexFrom]-h.vertexFrom+a};b.createGeometryData=function(a,c){const d=[];for(let f=0;5>f;++f){const h=C(f),k={};for(const l of h)k[l]={data:c(f,l)};d.push({data:a(f),buffers:k})}return d};b.createProgramDescriptor=(a,c)=>{if(!v.has(a)){const h=ea(c);var d=h;var f={};for(const k in d){const l=d[k];f[k]=l.length?l[0].stride:0}d=f;f=new Map;for(const k in c)for(const l of c[k])f.set(l.name,l.location);v.set(a,{strides:d,bufferLayouts:h,attributes:f})}return v.get(a)};b.createTextureFromTexelData=
function(a,c){let d,f;z.isPowerOfTwo(c.width)&&z.isPowerOfTwo(c.height)?(d=!0,f=g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR):(d=!1,f=g.TextureSamplingMode.LINEAR);return new X.Texture(a,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,internalFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,hasMipmap:d,samplingMode:f,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0},c)};b.forEachGeometryType=function(a){a(e.WGLGeometryType.FILL);a(e.WGLGeometryType.LINE);a(e.WGLGeometryType.MARKER);
a(e.WGLGeometryType.TEXT);a(e.WGLGeometryType.LABEL)};b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};b.getBytes=E;b.getCapType=function(a){switch(a){case "butt":return m.CapType.BUTT;case "round":return m.CapType.ROUND;case "square":return m.CapType.SQUARE;default:return r.error(new t("mapview-invalid-type",`Cap type ${a} is not a valid option. Defaulting to round`)),m.CapType.ROUND}};b.getJoinType=function(a){switch(a){case "miter":return m.JoinType.MITER;
case "bevel":return m.JoinType.BEVEL;case "round":return m.JoinType.ROUND;default:return r.error(new t("mapview-invalid-type",`Join type ${a} is not a valid option. Defaulting to round`)),m.JoinType.ROUND}};b.getNamedBuffers=C;b.getPMSResourceSize=function(a){const c="maxVVSize"in a&&a.maxVVSize;a="width"in a&&a.width||"size"in a&&a.size||0;return c?c:a};b.getPixelArrayCtor=function(a){switch(a){case g.PixelType.UNSIGNED_BYTE:return Uint8Array;case g.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;
case g.PixelType.FLOAT:return Float32Array;default:r.error(new t("webgl-utils",`Unable to handle type ${a}`))}};b.getPixelBytes=function(a){switch(a){case g.PixelType.UNSIGNED_BYTE:return 1;case g.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case g.PixelType.FLOAT:return 4;default:r.error(new t("webgl-utils",`Unable to handle type ${a}`))}};b.getStrides=function(a,c){switch(a){case e.WGLGeometryType.MARKER:switch(c){case e.WGLSymbologyType.HEATMAP:return N;default:return M}case e.WGLGeometryType.FILL:switch(c){case e.WGLSymbologyType.DOT_DENSITY:return Q;
case e.WGLSymbologyType.SIMPLE:case e.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return P;default:return O}case e.WGLGeometryType.LINE:return R;case e.WGLGeometryType.TEXT:return S;case e.WGLGeometryType.LABEL:return T}};b.getTextProperties=function(a){return W.TextProperties.pool.acquire(a.color?B.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?B.copyAndPremultiply(a.haloColor):[255,255,255,255],A.pt2px(a.haloSize),A.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,
"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.getTransformParams=function(a){const {transform:c,hasZ:d,hasM:f}=a;return{transform:c,hasZ:d,hasM:f}};b.getUrl=a=>"imageData"in a&&a.imageData&&"contentType"in a&&a.contentType?`data:${a.contentType};base64,${a.imageData}`:"url"in a?a.url:null;b.getVVType=function(a){switch(a){case "opacity":return e.VVType.OPACITY;case "color":return e.VVType.COLOR;case "rotation":return e.VVType.ROTATION;
case "size":return e.VVType.SIZE;default:return r.error(`Cannot interpret unknown vv: ${a}`),null}};b.is3D=a=>a.type&&a.type.toLowerCase().includes("3d");b.isDefined=function(a){return null!=a};b.isGIF=a=>"url"in a&&a.url&&(a.url.includes(".gif")||w(a.url))||"contentType"in a&&"image/gif"===a.contentType||"imageData"in a&&w(a.imageData);b.isGIFDataUri=w;b.isImageResource=a=>"url"in a&&a.url||"imageData"in a&&a.imageData;b.isMarkerPlacementInsidePolygon=V;b.isNumber=function(a){return"number"===typeof a};
b.isPNG=a=>"url"in a&&a.url&&(a.url.includes(".png")||x(a.url))||"contentType"in a&&"image/png"===a.contentType||"imageData"in a&&x(a.imageData);b.isPNGDataUri=x;b.isSVGImage=a=>a.includes("data:image/svg+xml");b.isSVGResource=a=>"path"in a&&U(a.path);b.isSimple=function(a){switch(a.type){case "line":return"CIMSolidStroke"===a.cim.type&&!a.dashTemplate;case "fill":return"CIMSolidFill"===a.cim.type;case "esriSFS":return"esriSFSSolid"===a.style||"esriSFSNull"===a.style;case "esriSLS":return"esriSLSSolid"===
a.style||"esriSLSNull"===a.style;default:return!1}};b.isValidSVG=U;b.shouldRepeat=function(a){switch("cim"in a?a.cim.type:a.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":return!1;case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":return V(a);default:return!0}};b.strideToPackingFactor=D;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});