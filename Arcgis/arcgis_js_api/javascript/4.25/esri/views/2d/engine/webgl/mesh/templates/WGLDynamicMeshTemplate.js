// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../symbols/cim/cimAnalyzer","../../../../../../symbols/cim/utils","./WGLMeshTemplate"],function(v,w,x,k,y){const p=w.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");return function(q){function m(d){var a=q.call(this)||this;a._ongoingMaterialRequestMap=new Map;a._materialCache=new Map;a._dynamicPropertyMap=new Map;a._cimLayer=d;return a}v._inheritsLoose(m,q);m.prototype.analyze=
function(d,a,e,f,g){if(g&&0===g.length)return null;const r=g&&0<g.length,h=a.readLegacyFeature();a=a.getObjectId();const n=this._materialCache;var b=this._cimLayer.materialHash;if(!b)return p.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const c="function"===typeof b?b(h,e,f,a):b;if(n.has(c))return d=n.get(c),Promise.resolve(d);if(b=this._ongoingMaterialRequestMap.get(c))return b;b=this._cimLayer;const t=x.analyzeCIMResource(b.cim,this._cimLayer.materialOverrides);
t.mosaicHash=c;const {type:u,url:z}=b;a={cim:t,type:u,mosaicHash:c,url:z,size:null,dashTemplate:null,text:null,fontName:null,objectId:a,animatedSymbolProperties:null};switch(u){case "marker":a.size=k.evaluateValueOrFunction(b.size,h,e,f);a.animatedSymbolProperties=k.evaluateValueOrFunction(b.animatedSymbolProperties,h,e,f);break;case "line":a.dashTemplate=b.dashTemplate;break;case "text":a.text=k.evaluateValueOrFunction(b.text,h,e,f),a.fontName=k.evaluateValueOrFunction(b.fontName,h,e,f)}d=d.getMosaicItem(a,
g).then(l=>{r||(this._ongoingMaterialRequestMap.delete(c),n.set(c,l));return l}).catch(l=>{this._ongoingMaterialRequestMap.delete(c);p.error(".analyze()",l.message);return null});r||this._ongoingMaterialRequestMap.set(c,d);return d};return m}(y)});