// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/capabilities/isWebGL2Context".split(" "),function(v,
y,z,A,q,r,B,l,C,D,E,F,w,m,G,H,x){const p=C.create();return function(u){function t(c){var b=u.call(this)||this;b.elementView=c;b.isWrapAround=!1;b.perspectiveTransform=E.create();b._vertices=new Float32Array(20);b._handles=[];b._handles.push(l.watch(()=>b.elementView.element.opacity,a=>b.opacity=a,l.initial),l.watch(()=>[b.elementView.coords],()=>{b.requestRender()},l.initial),l.when(()=>b.elementView.element.loaded,()=>{const a=b.elementView.element;b.ready();"video"===a.type&&r.isSome(a.content)&&
b._handles.push(z.on(a.content,"play",()=>b.requestRender()))},l.initial));c.element.load().catch(a=>{A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new y("element-load-error","Element cannot be displayed",{element:c,error:a}))});return b}v._inheritsLoose(t,u);var n=t.prototype;n.destroy=function(){this._handles.forEach(c=>c.remove());this.texture?.dispose();this.texture=null};n.beforeRender=function(c){const {context:b}=c,a=this.elementView.element.content;if(r.isSome(a)){var d=a instanceof
HTMLImageElement;const g=a instanceof HTMLVideoElement,h=d?a.naturalWidth:g?a.videoWidth:a.width;d=d?a.naturalHeight:g?a.videoHeight:a.height;this._updatePerspectiveTransform(h,d);this.texture?g&&!a.paused&&(this.texture.setData(a),this.requestRender(),(x(b.gl)||q.isPowerOfTwo(h)&&q.isPowerOfTwo(d))&&this.texture.generateMipmap()):(this.texture=new G.Texture(b,{pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,
width:h,height:d,preMultiplyAlpha:!0},a),(x(b.gl)||q.isPowerOfTwo(h)&&q.isPowerOfTwo(d))&&this.texture.generateMipmap(),g&&!a.paused&&this.requestRender())}u.prototype.beforeRender.call(this,c)};n._createTransforms=function(){return null};n.updateDrawCoords=function(c,b){var a=this.elementView.coords;if(!r.isNone(a)){var [d,g,h,k]=a.rings[0];a=this._vertices;var {x:e,y:f}=c;(c=0!==b)?a.set([g[0]-e,g[1]-f,d[0]-e,d[1]-f,h[0]-e,h[1]-f,k[0]-e,k[1]-f,k[0]-e,k[1]-f,g[0]+b-e,g[1]-f,g[0]+b-e,g[1]-f,d[0]+
b-e,d[1]-f,h[0]+b-e,h[1]-f,k[0]+b-e,k[1]-f]):a.set([g[0]-e,g[1]-f,d[0]-e,d[1]-f,h[0]-e,h[1]-f,k[0]-e,k[1]-f]);this.isWrapAround=c}};n.getVAO=function(c,b,a){if(r.isNone(this.elementView.coords))return null;var d=this._vertices;this._vao?this._geometryVbo.setData(d):(this._geometryVbo=w.BufferObject.createVertex(c,m.Usage.DYNAMIC_DRAW,d),d=w.BufferObject.createVertex(c,m.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new H.VertexArrayObject(c,a,b,{geometry:this._geometryVbo,
tex:d}));return this._vao};n._updatePerspectiveTransform=function(c,b){const a=this._vertices;B.getProjectiveTransform(p,[0,0,c,0,0,b,c,b],[a[0],a[1],a[4],a[5],a[2],a[3],a[6],a[7]]);D.set(this.perspectiveTransform,p[6]/p[8]*c,p[7]/p[8]*b)};v._createClass(t,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return t}(F.DisplayObject)});