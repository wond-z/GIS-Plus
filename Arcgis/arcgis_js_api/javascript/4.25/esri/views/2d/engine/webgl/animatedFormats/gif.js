// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/time","../../../../../geometry/support/meshUtils/exporters/gltf/imageutils"],function(A,N,O,P){function F(){F=N._asyncToGenerator(function*(n,b){n=I(n);var d=J(n,!0);const {width:f,height:g}=n.lsd;n=document.createElement("canvas");n.width=f;n.height=g;n=n.getContext("2d");const c=[];b=[];for(const a of d){b.push(O.Milliseconds(a.delay||100));d=new ImageData(a.patch,a.dims.width,a.dims.height);var h=P.imageTypeToCanvas(d);
d=3===a.disposalType&&n.getImageData(a.dims.left,a.dims.top,a.dims.width,a.dims.height);n.drawImage(h,a.dims.left,a.dims.top);h=n.getImageData(0,0,f,g);c.push(h);1!==a.disposalType&&(2===a.disposalType?n.clearRect(a.dims.left,a.dims.top,a.dims.width,a.dims.height):3===a.disposalType&&n.putImageData(d,a.dims.left,a.dims.top))}return{frameDurations:b,getFrame:a=>c[a],width:f,height:g}});return F.apply(this,arguments)}function K(n){const b=new Uint8Array(n);return!Q.some((d,f)=>d!==b[f])}var t={},x=
{},p={};Object.defineProperty(p,"__esModule",{value:!0});p.loop=p.conditional=p.parse=void 0;p.parse=function f(b,d){var g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:g;if(Array.isArray(d))d.forEach(function(a){return f(b,a,g,c)});else if("function"===typeof d)d(b,g,c,f);else{var h=Object.keys(d)[0];Array.isArray(d[h])?(c[h]={},f(b,d[h],g,c[h])):c[h]=d[h](b,g,c,f)}return g};p.conditional=function(b,d){return function(f,g,c,h){d(f,
g,c)&&h(f,b,g,c)}};p.loop=function(b,d){return function(f,g,c,h){for(var a=[],k=f.pos;d(f,g,c);){var l={};h(f,b,g,l);if(f.pos===k)break;k=f.pos;a.push(l)}return a}};var e={};Object.defineProperty(e,"__esModule",{value:!0});e.readBits=e.readArray=e.readUnsigned=e.readString=e.peekBytes=e.readBytes=e.peekByte=e.readByte=e.buildStream=void 0;e.buildStream=function(b){return{data:b,pos:0}};var L=function(){return function(b){return b.data[b.pos++]}};e.readByte=L;e.peekByte=function(){var b=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:0;return function(d){return d.data[d.pos+b]}};var B=function(b){return function(d){return d.data.subarray(d.pos,d.pos+=b)}};e.readBytes=B;e.peekBytes=function(b){return function(d){return d.data.subarray(d.pos,d.pos+b)}};e.readString=function(b){return function(d){return Array.from(B(b)(d)).map(function(f){return String.fromCharCode(f)}).join("")}};e.readUnsigned=function(b){return function(d){d=B(2)(d);return b?(d[1]<<8)+d[0]:(d[0]<<8)+d[1]}};e.readArray=function(b,
d){return function(f,g,c){g="function"===typeof d?d(f,g,c):d;c=B(b);for(var h=Array(g),a=0;a<g;a++)h[a]=c(f);return h}};e.readBits=function(b){return function(d){d=L()(d);for(var f=Array(8),g=0;8>g;g++)f[7-g]=!!(d&1<<g);return Object.keys(b).reduce(function(c,h){var a=b[h];if(a.length){for(var k=a.length,l=0,m=0;m<k;m++)l+=f[a.index+m]&&Math.pow(2,k-m-1);c[h]=l}else c[h]=f[a.index];return c},{})}};(function(b){Object.defineProperty(b,"__esModule",{value:!0});b["default"]=void 0;var d={blocks:function(a){for(var k=
[],l=a.data.length,m=0,q=(0,e.readByte)()(a);0!==q&&q;q=(0,e.readByte)()(a)){if(a.pos+q>=l){l-=a.pos;k.push((0,e.readBytes)(l)(a));m+=l;break}k.push((0,e.readBytes)(q)(a));m+=q}a=new Uint8Array(m);for(l=m=0;l<k.length;l++)a.set(k[l],m),m+=k[l].length;return a}},f=(0,p.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},
{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&249===a[1]}),g=(0,p.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,p.conditional)({lct:(0,e.readArray)(3,function(a,
k,l){return Math.pow(2,l.descriptor.lct.size+1)})},function(a,k,l){return l.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},d]}]},function(a){return 44===(0,e.peekByte)()(a)}),c=(0,p.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(a,k,l){return(0,e.readBytes)(l.text.blockSize)(a)}},d]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&1===a[1]}),h=(0,p.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},
{id:function(a,k,l){return(0,e.readString)(l.blockSize)(a)}},d]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&255===a[1]});d=(0,p.conditional)({comment:[{codes:(0,e.readBytes)(2)},d]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&254===a[1]});f=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,
length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,p.conditional)({gct:(0,e.readArray)(3,function(a,k){return Math.pow(2,k.lsd.gct.size+1)})},function(a,k){return k.lsd.gct.exists}),{frames:(0,p.loop)([f,h,d,g,c],function(a){a=(0,e.peekByte)()(a);return 33===a||44===a})}];b["default"]=f})(x);var C={};Object.defineProperty(C,"__esModule",{value:!0});C.deinterlace=void 0;C.deinterlace=function(b,d){for(var f=Array(b.length),g=b.length/d,c=[0,4,2,1],h=[8,8,
4,2],a=0,k=0;4>k;k++)for(var l=c[k];l<g;l+=h[k]){var m=l,q=b.slice(a*d,(a+1)*d);f.splice.apply(f,[m*d,d].concat(q));a++}return f};var D={};Object.defineProperty(D,"__esModule",{value:!0});D.lzw=void 0;D.lzw=function(b,d,f){var g,c,h,a,k,l,m,q,G=Array(f),H=Array(4096),y=Array(4096),z=Array(4097);var v=1<<b;var R=v+1;var r=v+2;var w=-1;var u=b+1;var E=(1<<u)-1;for(c=0;c<v;c++)H[c]=0,y[c]=c;for(h=a=g=k=l=q=m=0;h<f;){if(0===l){if(g<u){a+=d[m]<<g;g+=8;m++;continue}c=a&E;a>>=u;g-=u;if(c>r||c==R)break;if(c==
v){u=b+1;E=(1<<u)-1;r=v+2;w=-1;continue}if(-1==w){z[l++]=y[c];k=w=c;continue}var S=c;c==r&&(z[l++]=k,c=w);for(;c>v;)z[l++]=y[c],c=H[c];k=y[c]&255;z[l++]=k;4096>r&&(H[r]=w,y[r]=k,r++,0===(r&E)&&4096>r&&(u++,E+=r));w=S}l--;G[q++]=z[l];h++}for(h=q;h<f;h++)G[h]=0;return G};Object.defineProperty(t,"__esModule",{value:!0});var J=t.decompressFrames=t.decompressFrame=I=t.parseGIF=void 0,T=x&&x.__esModule?x:{default:x},I=t.parseGIF=function(b){b=new Uint8Array(b);return(0,p.parse)((0,e.buildStream)(b),T["default"])},
M=function(b,d,f){if(b.image){var g=b.image,c=(0,D.lzw)(g.data.minCodeSize,g.data.blocks,g.descriptor.width*g.descriptor.height);g.descriptor.lct.interlaced&&(c=(0,C.deinterlace)(c,g.descriptor.width));c={pixels:c,dims:{top:b.image.descriptor.top,left:b.image.descriptor.left,width:b.image.descriptor.width,height:b.image.descriptor.height}};c.colorTable=g.descriptor.lct&&g.descriptor.lct.exists?g.lct:d;b.gce&&(c.delay=10*(b.gce.delay||10),c.disposalType=b.gce.extras.disposal,b.gce.extras.transparentColorGiven&&
(c.transparentIndex=b.gce.transparentColorIndex));if(f){b=c.pixels.length;d=new Uint8ClampedArray(4*b);for(f=0;f<b;f++){g=4*f;var h=c.pixels[f],a=c.colorTable[h]||[0,0,0];d[g]=a[0];d[g+1]=a[1];d[g+2]=a[2];d[g+3]=h!==c.transparentIndex?255:0}c.patch=d}return c}console.warn("gif frame does not have associated image.")};t.decompressFrame=M;J=t.decompressFrames=function(b,d){return b.frames.filter(function(f){return f.image}).map(function(f){return M(f,b.gct,d)})};const Q=[71,73,70];A.isAnimatedGIF=function(b){function d(){h++;
c+=8;const k=g.getUint8(c++);c+=k&128?3*2**((k&7)+1):0;c++;f()}function f(){let k;for(;k=g.getUint8(c++);)c+=k}if(!K(b))return!1;const g=new DataView(b);b=g.getUint8(10);let c=13+(b&128?3*2**((b&7)+1):0),h=0;for(b=!1;!b;){switch(g.getUint8(c++)){case 33:a:{switch(g.getUint8(c++)){case 249:c++;c+=4;f();break;case 1:h++;c++;c+=12;f();break;case 254:f();break;case 255:c++;c+=8;c+=3;f();break;default:var a=!1;break a}a=!0}if(!a)return!1;break;case 44:d();break;case 59:b=!0;break;default:return!1}if(1<
h)return!0}return!1};A.isGIF=K;A.parseGif=function(b,d){return F.apply(this,arguments)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});