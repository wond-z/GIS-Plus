// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],function(m,w,u,x,y){let v=function(g){this.tile=g;this.parent=null;this.children=new Set},z=function(){function g(){this.nodes=new Map;this.roots=new Set}var d=g.prototype;d.create=function(b){const a=new v(b);let f;const k=[];this.nodes.forEach(c=>{this._canConnectDirectly(a,c)&&k.push(c);!f&&this._canConnectDirectly(c,a)&&(f=c)});if(f){for(const c of k)f.children.delete(c),a.children.add(c),
c.parent=a;f.children.add(a);a.parent=f}else{this.roots.add(a);for(const c of k)a.children.add(c),c.parent=a,this.roots.delete(c)}this.nodes.set(b.key.id,a);return a};d.destroy=function(b){u.isSome(b.parent)?(b.parent.children.delete(b),b.children.forEach(a=>{u.isSome(b.parent)&&b.parent.children.add(a)})):this.roots.delete(b);b.children.forEach(a=>{(a.parent=b.parent)||this.roots.add(a)});this.nodes.delete(b.tile.key.id)};d.clear=function(){this.roots.clear();this.nodes.clear()};d._canConnectDirectly=
function(b,a){let {level:f,row:k,col:c}=a.tile.key;for({world:a}=a.tile.key;0<f;){f--;k>>=1;c>>=1;if(b.tile.key.level===f&&b.tile.key.row===k&&b.tile.key.col===c&&b.tile.key.world===a)return!0;if(this.nodes.has(`${f}/${k}/${c}/${a}`))break}return!1};return g}(),A=function(){function g(b,a,f){this._rows=Math.ceil(a/f);this._columns=Math.ceil(b/f);this._cellSize=f;this.cells=Array(this._rows);for(b=0;b<this._rows;b++)for(this.cells[b]=Array(this._columns),a=0;a<this._columns;a++)this.cells[b][a]=[]}
var d=g.prototype;d.getCell=function(b,a){a=Math.min(Math.max(Math.floor(a/this._cellSize),0),this._rows-1);b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._columns-1);return this.cells[a]&&this.cells[a][b]||null};d.getCellSpan=function(b,a,f,k){return[Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(a/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(k/this._cellSize),
0),this.rows-1)]};w._createClass(g,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return g}();m.GridIndex=A;m.TileGraph=z;m.TileNode=v;m.deserializeSymbols=function(g,d,b,a,f,k){const c=d[a++];for(let t=0;t<c;t++){const l=new y.VTLSymbol(k);l.xTile=d[a++];l.yTile=d[a++];l.hash=d[a++];l.priority=d[a++];var e=d[a++];for(var h=0;h<e;h++){const n=d[a++],p=d[a++],q=d[a++],r=d[a++],B=!!d[a++],
C=d[a++],D=b[a++],E=b[a++],F=d[a++],G=d[a++];l.colliders.push({xTile:n,yTile:p,dxPixels:q,dyPixels:r,hard:B,partIndex:C,width:F,height:G,minLod:D,maxLod:E})}e=g[a++];for(h=0;h<e;h++)l.textVertexRanges.push([g[a++],g[a++]]);e=g[a++];for(h=0;h<e;h++)l.iconVertexRanges.push([g[a++],g[a++]]);f.push(l)}return a};m.tileCoordChange=function(g,d,b,a,f,k){b-=f;if(0<=b)return(d>>b)+(a-(k<<b))*(g>>b);b=-b;return d-(k-(a<<b))*(g>>b)<<b};m.writeOpacityToBuffers=function(g,d,b){for(const [t,l]of g.symbols){{var a=
g,f=d,k=b,c=l;const n=a.layerData.get(t);if(n.type===x.BucketType.SYMBOL){for(const p of c){c=p.unique;var e=void 0;if(p.selectedForRendering){var h=c.parts[0];e=h.startOpacity;h=h.targetOpacity;a.allSymbolsFadingOut=a.allSymbolsFadingOut&&0===h;e=k?Math.floor(127*e)|h<<7:h?255:0;e|=e<<24|e<<16|e<<8}else e=0;for(const [q,r]of p.iconVertexRanges)for(h=q;h<q+r;h+=4)n.iconOpacity[h/4]=e;p.selectedForRendering?(e=c.parts[1],c=e.startOpacity,e=e.targetOpacity,a.allSymbolsFadingOut=a.allSymbolsFadingOut&&
0===e,c=k?Math.floor(127*c)|e<<7:e?255:0,e=c<<24|c<<16|c<<8|c):e=0;for(const [q,r]of p.textVertexRanges)for(c=q;c<q+r;c+=4)n.textOpacity[c/4]=e}n.lastOpacityUpdate=f;n.opacityChanged=!0}}}};Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});