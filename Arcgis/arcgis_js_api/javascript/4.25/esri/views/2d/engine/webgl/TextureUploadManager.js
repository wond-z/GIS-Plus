// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","../../../../core/promiseUtils","./definitions","../../../webgl/context-util"],function(l,m,k,n,q){let u=function(){function p(c,a){this._queue=[];this._context=c;this._refreshable=a}var g=p.prototype;g.destroy=function(){this._queue=[]};g.enqueueTextureUpdate=function(c,a){const b=k.createResolver(),e=n.TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE,f=Math.ceil(c.height/e);k.throwIfAborted(a);if(this._context.type===q.ContextType.WEBGL1)this._queue.push({type:"no-chunk",
request:c,resolver:b,options:a});else for(let d=0;d<f;d++){const h=d===f-1;this._queue.push({type:"chunk",request:c,resolver:b,chunk:d,chunkOffset:d*e,destHeight:h?c.height-e*d:e,chunkIsLast:h,options:a})}k.onAbortOrThrow(a,d=>b.reject(d));return b.promise};g.upload=function(){let c=0;for(;this._queue.length;){var a=performance.now();const b=this._queue.shift();if(b&&(!m.isSome(b.options.signal)||!b.options.signal.aborted)){switch(b.type){case "chunk":this._uploadChunk(b);break;case "no-chunk":this._uploadNoChunk(b)}a=
performance.now()-a;c+=a;if(c+a>=n.TEXTURE_UPLOAD_MANAGER_BUDGET)break}}this._queue.length&&this._refreshable.requestRender()};g._uploadChunk=function(c){const {request:a,resolver:b,chunkOffset:e,chunkIsLast:f,destHeight:d}=c,{data:h,texture:r,width:t}=a;m.isSome(h)&&(r.updateData(0,0,e,t,d,h,e),f&&b.resolve())};g._uploadNoChunk=function(c){const {request:a,resolver:b}=c,{data:e,texture:f}=a;f.setData(e);b.resolve()};return p}();l.TextureUploadManager=u;Object.defineProperties(l,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});