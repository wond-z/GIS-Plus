// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/libtess ../../DisplayId ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),function(w,t,x,p,y,A,B,z,C,r){x=function(){function u(c,a,b){this._loadPromise=A.loadLibtess();this._geometryType=c;this._idField=a;this._templateStore=b}var n=u.prototype;n.update=function(c,
a){p.isSome(c.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(c.mesh.labels,a));this._schema=c};n._createLabelTemplates=function(c,a){const b=new Map;if("simple"===c.type){for(var d of c.classes)c=z.fromLabelClass(d,a),b.set(d.index,c);return b}for(const g in c.classes){d=c.classes[g];for(const e of d)d=z.fromLabelClass(e,a),b.set(e.index,d)}return b};n.analyze=function(){var c=t._asyncToGenerator(function*(a,b,d,g,e,f,h){if(!y.isAborted(h)){var l;"dictionary"===d.type&&(l=yield d.analyze(this._idField,
a.copy(),b,e,f,h));for(b=0;a.next();){var k=void 0;k=l?l[b++]:p.isSome(g)&&B.isAggregateId(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?g.match(this._idField,a,this._geometryType,e,f):d.match(this._idField,a,this._geometryType,e,f);a.setGroupId(k);if(r.isDynamicId(k)){k=this._templateStore.getDynamicTemplateGroup(k);for(const m of k)m&&m.analyze&&m.analyze(this._templateStore,a,e,f)}}yield this._loadPromise;return this._templateStore.finalize(h)}});return function(a,b,d,g,e,f,h){return c.apply(this,
arguments)}}();n.analyzeGraphics=function(){var c=t._asyncToGenerator(function*(a,b,d,g,e,f){if(!y.isAborted(f)){a=a.getCursor();for(d&&(yield d.analyze(this._idField,a.copy(),b,g,e,f));a.next();){b=a.getGroupId();if(null==b||-1===b)b=d.match(this._idField,a,a.geometryType,g,e),a.setGroupId(b);if(r.isDynamicId(b)){const h=this._templateStore.getDynamicTemplateGroup(b);for(const l of h)l&&l.analyze&&l.analyze(this._templateStore,a,g,e)}a.setGroupId(b)}yield this._loadPromise;return this._templateStore.finalize(f)}});
return function(a,b,d,g,e,f){return c.apply(this,arguments)}}();n.writeGraphic=function(c,a,b,d){const g=a.getGroupId(),e=a.getDisplayId(),f=this._templateStore.getTemplateGroup(g);c.featureStart(a.insertAfter,0);if(null!=e){if(r.isDynamicId(g))for(const h of f)h&&h.bindFeature(a,null,null);if(f){for(const h of f)h&&h.write(c,a,b,d);c.featureEnd()}}};n.writeCursor=function(c,a,b,d,g,e,f){const h=a.getGroupId(),l=a.getDisplayId(),k=this._templateStore.getTemplateGroup(h),m=this._schema.mesh.sortKey;
let q=0;p.isSome(m)&&(q=null!=m.fieldIndex?a.getComputedNumericAtIndex(m.fieldIndex):null!=m.field?a.readAttribute(m.field):a.readAttribute(this._idField),q*="asc"===m.order?1:-1);c.featureStart(0,null==q||isNaN(q)?0:q);if(null!=l&&k){if(r.isDynamicId(h))for(const v of k)v.bindFeature(a,b,d);for(const v of k)v.write(c,a,g,f);p.isSome(e)&&c.hasRecords&&(b=e&&this._findLabelRef(k),this._writeLabels(c,a,e,b,g,f));c.featureEnd()}};n._findLabelRef=function(c){for(const a of c)if(a instanceof C)return a;
return null};n._writeLabels=function(c,a,b,d,g,e){for(const f of b)if(p.isSome(f)&&f){const {glyphs:h,rtl:l,index:k}=f;b=this._labelTemplates.get(k);b.setZoomLevel(g);b.bindReferenceTemplate(d);b.bindTextInfo(h,l);b.write(c,a,null,e)}};t._createClass(u,[{key:"templates",get:function(){return this._templateStore}}]);return u}();w.WGLMeshFactory=x;Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});