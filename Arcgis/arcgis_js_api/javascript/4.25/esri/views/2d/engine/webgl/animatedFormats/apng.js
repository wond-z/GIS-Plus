// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/_commonjsHelpers","../../../../../core/promiseUtils","../../../../../core/time"],function(F,L,I,M,N){function H(){H=L._asyncToGenerator(function*(q,u){q=O(q);if(q instanceof Error)throw q;yield q.createImages();M.throwIfAborted(u);const {frames:f,width:e,height:g}=q;u=document.createElement("canvas");u.width=e;u.height=g;u=u.getContext("2d");const l=[];q=[];for(const a of f){q.push(N.Milliseconds(a.delay||100));
var n=a.imageElement;u.globalCompositeOperation=0===a.blendOp?"copy":"source-over";const c=2===a.disposeOp&&u.getImageData(a.left,a.top,a.width,a.height);u.drawImage(n,a.left,a.top);n=u.getImageData(0,0,e,g);l.push(n);0!==a.disposeOp&&(1===a.disposeOp?u.clearRect(a.left,a.top,a.width,a.height):2===a.disposeOp&&u.putImageData(c,a.left,a.top))}return{frameDurations:q,getFrame:a=>l[a],width:e,height:g}});return H.apply(this,arguments)}function J(q){const u=new Uint8Array(q);return!P.some((f,e)=>f!==
u[e])}var K={exports:{}};(function(q,u){(function(f,e){q.exports=e()})(I.commonjsGlobal,function(){return function(f){function e(l){if(g[l])return g[l].exports;var n=g[l]={exports:{},id:l,loaded:!1};f[l].call(n.exports,n,n.exports,e);n.loaded=!0;return n.exports}var g={};e.m=f;e.c=g;e.p="";return e(0)}([function(f,e,g){function l(p,y){var z=new DataView(p.buffer),v=8,w=void 0,B=void 0,m=void 0;do B=z.getUint32(v),w=v+4,w=Array.prototype.slice.call(p.subarray(w,w+4)),w=String.fromCharCode.apply(String,
w),m=y(w,p,v,B),v+=12+B;while(!1!==m&&"IEND"!=w&&v<p.length)}function n(p,y,z){var v=new Uint8Array(z);v.set(p.subarray(y,y+z));return v}Object.defineProperty(e,"__esModule",{value:!0});e.isNotPNG=function(p){return p===b};e.isNotAPNG=function(p){return p===d};e.default=function(p){var y=new Uint8Array(p);if(Array.prototype.some.call(k,function(x,t){return x!==y[t]}))return b;var z=!1;l(y,function(x){return!(z="acTL"===x)});if(!z)return d;var v=[],w=[],B=null,m=null,D=0,C=new c.APNG;l(y,function(x,
t,r,E){var A=new DataView(t.buffer);switch(x){case "IHDR":B=t.subarray(r+8,r+8+E);C.width=A.getUint32(r+8);C.height=A.getUint32(r+12);break;case "acTL":C.numPlays=A.getUint32(r+8+4);break;case "fcTL":m&&(C.frames.push(m),D++);m=new c.Frame;m.width=A.getUint32(r+8+4);m.height=A.getUint32(r+8+8);m.left=A.getUint32(r+8+12);m.top=A.getUint32(r+8+16);x=A.getUint16(r+8+20);t=A.getUint16(r+8+22);0===t&&(t=100);m.delay=1E3*x/t;10>=m.delay&&(m.delay=100);C.playTime+=m.delay;m.disposeOp=A.getUint8(r+8+24);
m.blendOp=A.getUint8(r+8+25);m.dataParts=[];0===D&&2===m.disposeOp&&(m.disposeOp=1);break;case "fdAT":m&&m.dataParts.push(t.subarray(r+8+4,r+8+E));break;case "IDAT":m&&m.dataParts.push(t.subarray(r+8,r+8+E));break;case "IEND":w.push(n(t,r,12+E));break;default:v.push(n(t,r,12+E))}});m&&C.frames.push(m);if(0==C.frames.length)return d;var Q=new Blob(v),R=new Blob(w);C.frames.forEach(function(x){var t=[];t.push(k);B.set(G(x.width),0);B.set(G(x.height),4);t.push(h("IHDR",B));t.push(Q);x.dataParts.forEach(function(r){return t.push(h("IDAT",
r))});t.push(R);x.imageData=new Blob(t,{type:"image/png"});delete x.dataParts;t=null});return C};var a=(f=g(1))&&f.__esModule?f:{default:f},c=g(2),b=Error("Not a PNG"),d=Error("Not an animated PNG"),k=new Uint8Array([137,80,78,71,13,10,26,10]),h=function(p,y){var z=p.length+y.length,v=new Uint8Array(z+8),w=new DataView(v.buffer);w.setUint32(0,y.length);for(var B=v.set,m=new Uint8Array(p.length),D=0;D<p.length;D++)m[D]=p.charCodeAt(D);B.call(v,m,4);v.set(y,8);p=(0,a.default)(v,4,z);w.setUint32(z+4,
p);return v},G=function(p){return new Uint8Array([p>>>24&255,p>>>16&255,p>>>8&255,p&255])}},function(f,e){Object.defineProperty(e,"__esModule",{value:!0});e.default=function(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=-1,b=a;for(a+=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n.length-a;b<a;b++)c=c>>>8^g[(c^n[b])&255];return c^-1};var g=new Uint32Array(256);for(f=0;256>f;f++){e=f;for(var l=0;8>l;l++)e=0!==(e&1)?3988292384^e>>>1:e>>>1;g[f]=e}},function(f,e,g){function l(c,
b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(e,"__esModule",{value:!0});e.Frame=e.APNG=void 0;var n=function(){function c(b,d){for(var k=0;k<d.length;k++){var h=d[k];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(b,h.key,h)}}return function(b,d,k){d&&c(b.prototype,d);k&&c(b,k);return b}}(),a=(f=g(3))&&f.__esModule?f:{default:f};e.APNG=function(){function c(){l(this,c);this.playTime=this.numPlays=
this.height=this.width=0;this.frames=[]}n(c,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(b){return b.createImage()}))}},{key:"getPlayer",value:function(b){var d=this,k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;return this.createImages().then(function(){return new a.default(d,b,k)})}}]);return c}();e.Frame=function(){function c(){l(this,c);this.blendOp=this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageElement=this.imageData=
null}n(c,[{key:"createImage",value:function(){var b=this;return this.imageElement?Promise.resolve():new Promise(function(d,k){var h=URL.createObjectURL(b.imageData);b.imageElement=document.createElement("img");b.imageElement.onload=function(){URL.revokeObjectURL(h);d()};b.imageElement.onerror=function(){URL.revokeObjectURL(h);b.imageElement=null;k(Error("Image creation error"))};b.imageElement.src=h})}}]);return c}()},function(f,e,g){function l(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+
typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function a(c,b){for(var d=0;d<b.length;d++){var k=b[d];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(c,k.key,k)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();f=g(4);f=function(a){function c(b,
d,k){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var h=(c.__proto__||Object.getPrototypeOf(c)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");h=!h||"object"!==typeof h&&"function"!==typeof h?this:h;h.playbackRate=1;h._currentFrameNumber=0;h._ended=!1;h._paused=!0;h._numPlays=0;h._apng=b;h.context=d;h.stop();k&&h.play();return h}l(c,a);n(c,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=
(this._currentFrameNumber+1)%this._apng.frames.length;this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._paused=this._ended=!0));this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);
var b=this.currentFrame;this._prevFrame=b;this._prevFrameData=null;2==b.disposeOp&&(this._prevFrameData=this.context.getImageData(b.left,b.top,b.width,b.height));0==b.blendOp&&this.context.clearRect(b.left,b.top,b.width,b.height);this.context.drawImage(b.imageElement,b.left,b.top);this.emit("frame",this._currentFrameNumber);this._ended&&this.emit("end")}},{key:"play",value:function(){var b=this;this.emit("play");this._ended&&this.stop();this._paused=!1;var d=performance.now()+this.currentFrame.delay/
this.playbackRate;requestAnimationFrame(function G(h){if(!b._ended&&!b._paused){if(h>=d){for(;h-d>=b._apng.playTime/b.playbackRate;)d+=b._apng.playTime/b.playbackRate,b._numPlays++;do b.renderNextFrame(),d+=b.currentFrame.delay/b.playbackRate;while(!b._ended&&h>d)}requestAnimationFrame(G)}})}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop");this._numPlays=0;this._ended=!1;this._paused=!0;this._currentFrameNumber=-1;
this.context.clearRect(0,0,this._apng.width,this._apng.height);this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]);return c}((f&&f.__esModule?f:{default:f}).default);e.default=f},function(f,e){function g(){this._events=this._events||{};this._maxListeners=this._maxListeners||
void 0}function l(a){return"function"===typeof a}function n(a){return"object"===typeof a&&null!==a}f.exports=g;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._maxListeners=void 0;g.defaultMaxListeners=10;g.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};g.prototype.emit=function(a){var c;this._events||(this._events={});if("error"===a&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){var b=
arguments[1];if(b instanceof Error)throw b;var d=Error('Uncaught, unspecified "error" event. ('+b+")");d.context=b;throw d;}d=this._events[a];if(void 0===d)return!1;if(l(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:b=Array.prototype.slice.call(arguments,1),d.apply(this,b)}else if(n(d)){b=Array.prototype.slice.call(arguments,1);var k=d.slice();d=k.length;for(c=0;c<d;c++)k[c].apply(this,b)}return!0};
g.prototype.addListener=function(a,c){if(!l(c))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",a,l(c.listener)?c.listener:c);this._events[a]?n(this._events[a])?this._events[a].push(c):this._events[a]=[this._events[a],c]:this._events[a]=c;n(this._events[a])&&!this._events[a].warned&&(c=void 0!==this._maxListeners?this._maxListeners:g.defaultMaxListeners)&&0<c&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[a].length),"function"===typeof console.trace&&console.trace());return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(a,c){function b(){this.removeListener(a,b);d||(d=!0,c.apply(this,arguments))}if(!l(c))throw TypeError("listener must be a function");var d=!1;b.listener=c;this.on(a,b);return this};g.prototype.removeListener=function(a,c){if(!l(c))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;var b=this._events[a];
var d=b.length;var k=-1;if(b===c||l(b.listener)&&b.listener===c)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,c);else if(n(b)){for(;0<d--;)if(b[d]===c||b[d].listener&&b[d].listener===c){k=d;break}if(0>k)return this;1===b.length?(b.length=0,delete this._events[a]):b.splice(k,1);this._events.removeListener&&this.emit("removeListener",a,c)}return this};g.prototype.removeAllListeners=function(a){if(!this._events)return this;if(!this._events.removeListener)return 0===
arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(c in this._events)"removeListener"!==c&&this.removeAllListeners(c);this.removeAllListeners("removeListener");this._events={};return this}var c=this._events[a];if(l(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);delete this._events[a];return this};g.prototype.listeners=function(a){return this._events&&this._events[a]?l(this._events[a])?[this._events[a]]:
this._events[a].slice():[]};g.prototype.listenerCount=function(a){if(this._events){a=this._events[a];if(l(a))return 1;if(a)return a.length}return 0};g.listenerCount=function(a,c){return a.listenerCount(c)}}])})})(K);const O=I.getDefaultExportFromCjs(K.exports),P=[137,80,78,71,13,10,26,10];F.isAnimatedPNG=function(q){if(!J(q))return!1;const u=new DataView(q);q=new Uint8Array(q);let f=8,e;do{const g=u.getUint32(f);e=String.fromCharCode.apply(String,Array.prototype.slice.call(q.subarray(f+4,f+8)));if("acTL"===
e)return!0;f+=12+g}while("IEND"!==e&&f<q.length);return!1};F.isPNG=J;F.parseApng=function(q,u){return H.apply(this,arguments)};Object.defineProperties(F,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});