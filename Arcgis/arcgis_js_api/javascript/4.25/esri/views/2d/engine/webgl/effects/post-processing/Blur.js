// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../VertexStream","../../../../../webgl/enums","../../../../../webgl/FramebufferObject"],function(n,r,f,t){const u=[1,0],v=[0,1];let w=function(){function p(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",
fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}var l=p.prototype;l.dispose=function(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)};l.draw=function(b,e,a){const {context:c}=b,{type:d,radius:h}=a;0!==h&&(this._createOrResizeResources(b),this._quad||(this._quad=new r(c,[-1,-1,1,-1,-1,1,1,1])),a=this._quad,a.bind(),"blur"===d?this._gaussianBlur(b,e,h):this._radialBlur(b,e),a.unbind())};l._gaussianBlur=function(b,e,a){const {context:c,state:d,painter:h,pixelRatio:m}=
b;var {size:k}=d,{materialManager:g}=h;b=this._quad;k=[Math.round(m*k[0]),Math.round(m*k[1])];const q=this._blurFBO;g=g.getProgram(this._programDesc.gaussianBlur,[{name:"radius",value:Math.ceil(a)}]);c.useProgram(g);c.setBlendingEnabled(!1);c.bindFramebuffer(q);c.bindTexture(e.colorTexture,4);g.setUniform1i("u_colorTexture",4);g.setUniform2fv("u_texSize",k);g.setUniform2fv("u_direction",u);g.setUniform1f("u_sigma",a);b.draw();c.bindFramebuffer(e);c.setStencilWriteMask(0);c.setStencilTestEnabled(!1);
c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.bindTexture(q.colorTexture,5);g.setUniform1i("u_colorTexture",5);g.setUniform2fv("u_direction",v);b.draw();c.setBlendingEnabled(!0);c.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA);c.setStencilTestEnabled(!0)};l._radialBlur=function(b,e){const {context:a,painter:c}=b,{materialManager:d}=c,h=this._programDesc;b=this._quad;const m=this._blurFBO;a.bindFramebuffer(m);const k=d.getProgram(h.radialBlur);a.useProgram(k);a.setBlendingEnabled(!1);
a.bindTexture(e.colorTexture,4);k.setUniform1i("u_colorTexture",4);b.draw();a.bindFramebuffer(e);a.setStencilWriteMask(0);a.setStencilTestEnabled(!1);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);e=d.getProgram(h.blit);a.useProgram(e);a.bindTexture(m.colorTexture,5);e.setUniform1i("u_texture",5);a.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA);b.draw()};l._createOrResizeResources=function(b){const {context:e,state:a,pixelRatio:c}=b;var {size:d}=
a;b=Math.round(c*d[0]);d=Math.round(c*d[1]);this._blurFBO&&this._size[0]===b&&this._size[1]===d||(this._size[0]=b,this._size[1]=d,this._blurFBO?this._blurFBO.resize(b,d):this._blurFBO=new t.FramebufferObject(e,{colorTarget:f.TargetType.TEXTURE,depthStencilTarget:f.DepthStencilTargetType.NONE,width:b,height:d},{target:f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.RGBA,internalFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:f.TextureSamplingMode.LINEAR,
flipped:!1,width:b,height:d}))};return p}();n.Blur=w;Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});