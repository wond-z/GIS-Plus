// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/iteratorUtils ../../core/MapUtils ../../core/mathUtils ../../core/maybe ../../core/screenUtils ./interactiveToolUtils ../support/screenUtils".split(" "),function(t,x,y,z,u,f,A,B,p){let C=function(){function r(){this._pointerLocations=new Map;this._hoveredManipulators=new Map;this._grabbedManipulators=new Map;this._draggedManipulators=new Map;this._revertToNullActiveTool=this._stopDrag=!1;this._cursor=null}var k=r.prototype;k.handleInputEvent=
function(a,e){var c=()=>a.stopPropagation();switch(a.type){case "pointer-move":"mouse"===a.pointerType&&this._pointerLocations.set(a.pointerId,{x:a.x,y:a.y,pointerType:a.pointerType});break;case "drag":0<this._grabbedManipulators.size&&(this._stopDrag=!0);this._stopDrag&&(a.stopPropagation(),"end"===a.action&&(this._stopDrag=!1));break;case "pointer-down":if("mouse"===a.pointerType&&0!==a.button)break;c=p.createScreenPointFromEvent(a);var d=this._intersect(c,a.pointerType,e.forEachTool);if(f.isNone(d))break;
var b=d.manipulator,g=d.tool;!(f.isSome(b)&&f.isSome(g)&&b.interactive)||b.grabbable&&b.grabbableForEvent(a)||!b.grabbing||b.dragging||this._ungrabManipulatorBeforeDragging(b,a,e);f.isSome(b)&&f.isSome(g)&&b.interactive&&b.grabbable&&b.grabbableForEvent(a)&&!b.grabbing&&(this._grabbedManipulators.set(a.pointerId,{manipulator:b,tool:g,start:c,pointerType:a.pointerType}),1===this._grabbedManipulators.size&&f.isNone(e.activeTool)&&(this._revertToNullActiveTool=!0,e.setActiveTool(d.tool)),b.grabbing=
!0,b.events.emit("grab-changed",{action:"start",pointerType:a.pointerType,screenPoint:c}),a.stopPropagation());break;case "pointer-up":this._draggedManipulators.has(a.pointerId)||this._handlePointerEnd(a,e);break;case "pointer-drag":if("mouse"===a.pointerType&&0!==a.button)break;g=this._grabbedManipulators.get(a.pointerId);c=f.applySome(g,({manipulator:m})=>m);d=f.applySome(g,({tool:m})=>m);if(f.isNone(c)||f.isNone(d))break;b=p.createScreenPointFromEvent(a);b.x=u.clamp(b.x,0,e.view.width);b.y=u.clamp(b.y,
0,e.view.height);g=f.unwrap(g).start;const n=this._draggedManipulators.get(a.pointerId);switch(a.action){case "start":case "update":if("update"===a.action||1===this._grabbedManipulators.size)c.dragging=!0,n?c.events.emit("drag",{action:"update",start:g,screenPoint:b}):c.events.emit("drag",{action:"start",start:g,screenPoint:b,pointerType:a.pointerType}),this._draggedManipulators.set(a.pointerId,{tool:d,manipulator:c,start:g});break;case "end":c.dragging=!1,n&&c.events.emit("drag",{action:"end",start:g,
screenPoint:b}),this._draggedManipulators.delete(a.pointerId),this._handlePointerEnd(a,e)}a.stopPropagation();break;case "immediate-click":d=p.createScreenPointFromEvent(a);const h=this._intersect(d,a.pointerType,e.forEachTool);a.native.shiftKey||e.forEachTool(m=>{if((!f.isSome(h)||h.tool!==m||m.automaticManipulatorSelection)&&m.manipulators){let v=!1;m.manipulators.forEach(({manipulator:w})=>{w.selected&&(w.selected=!1,v=!0)});if(v&&m.onManipulatorSelectionChanged)m.onManipulatorSelectionChanged()}});
if(f.isNone(h))break;const {manipulator:l,tool:q}=h;if(!l.interactive)break;if(l.selectable&&q.automaticManipulatorSelection&&(l.selected=!l.selected,q.onManipulatorSelectionChanged))q.onManipulatorSelectionChanged();l.events.emit("immediate-click",{screenPoint:d,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c});break;case "click":c=p.createScreenPointFromEvent(a);d=this._intersect(c,a.pointerType,e.forEachTool);d=f.isSome(d)?d.manipulator:null;if(f.isNone(d)||
!d.interactive)break;d.events.emit(a.type,{screenPoint:c,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey});a.stopPropagation();break;case "double-click":d=p.createScreenPointFromEvent(a);b=this._intersect(d,a.pointerType,e.forEachTool);b=f.isSome(b)?b.manipulator:null;if(f.isNone(b)||!b.interactive)break;b.events.emit("double-click",{screenPoint:d,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c});break;case "immediate-double-click":d=p.createScreenPointFromEvent(a),
b=this._intersect(d,a.pointerType,e.forEachTool),b=f.isSome(b)?b.manipulator:null,!f.isNone(b)&&b.interactive&&b.events.emit("immediate-double-click",{screenPoint:d,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c})}this._onFocusChange(e.forEachTool)};k._ungrabManipulatorBeforeDragging=function(a,e,c){a.grabbing=!1;a.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:p.createScreenPointFromEvent(e)});this._grabbedManipulators.forEach(({manipulator:d},
b)=>{d===a&&this._grabbedManipulators.delete(b)});this._afterManipulatorUngrab(c.setActiveTool)};k._handlePointerEnd=function(a,e){const c=f.applySome(this._grabbedManipulators.get(a.pointerId),({manipulator:d})=>d);!f.isNone(c)&&c.grabbing&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",pointerType:a.pointerType,screenPoint:p.createScreenPointFromEvent(a)}),this._grabbedManipulators.delete(a.pointerId),this._afterManipulatorUngrab(e.setActiveTool))};k._cursorFromMap=function(a){let e=
null;z.someMap(a,({manipulator:c})=>{if(!f.isNone(c)&&c.interactive){if(c.grabbing&&c.grabCursor)return e=c.grabCursor,!0;if(c.cursor)return e=c.cursor,!0}return!1});return e};k._onFocusChange=function(a){this._updateCursor();this._updateFocusedManipulatorTools(a)};k._updateCursor=function(){this._cursor=0<this._grabbedManipulators.size?this._cursorFromMap(this._grabbedManipulators)||"grabbing":0<this._hoveredManipulators.size?this._cursorFromMap(this._hoveredManipulators)||"pointer":null};k._updateFocusedManipulatorTools=
function(a){const e=new Set,c=new Set;this._grabbedManipulators.forEach(({tool:d})=>{e.add(d)});this._hoveredManipulators.forEach(({tool:d})=>{c.add(d)});a(d=>{d.hasGrabbedManipulators=e.has(d);d.hasHoveredManipulators=c.has(d);var b=this._grabbedManipulators.values();b=y.find(b,({tool:g})=>g===d);d.firstGrabbedManipulator=f.isSome(b)?b.manipulator:null})};k.clearPointers=function(a,{forEachTool:e,setActiveTool:c},d=!0,b){const g=(n,h)=>n===a&&(f.isNone(b)||b===h);this._grabbedManipulators.forEach(({tool:n,
manipulator:h,pointerType:l},q)=>{g(n,h)&&(this._grabbedManipulators.delete(q),h.grabbing=!1,h.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:l}))});this._draggedManipulators.forEach(({tool:n,manipulator:h},l)=>{g(n,h)&&(this._draggedManipulators.delete(l),h.dragging=!1,h.events.emit("drag",{action:"cancel"}))});d&&this._hoveredManipulators.forEach(({tool:n,manipulator:h},l)=>{g(n,h)&&(this._hoveredManipulators.delete(l),h.hovering=!1)});this._afterManipulatorUngrab(c);this._onFocusChange(e)};
k._intersect=function(a,e,c){let d=null;c(b=>{if(null==b.manipulators||!B.areToolManipulatorsEditable(b))return!1;const g=b.manipulators.intersect(a,e);if(f.isNone(g))return!1;d={tool:b,manipulator:g};return!0});return d};k.updateHoveredStateFromKnownPointers=function(a){this._pointerLocations.forEach((e,c)=>{this._updateHoveredStateForPointerAtScreenPosition(A.createScreenPoint(e.x,e.y),c,e.pointerType,a)})};k.handleHoverEvent=function(a,e){"pointer-up"!==a.type&&"immediate-click"!==a.type&&"pointer-move"!==
a.type||"mouse"!==a.pointerType||this._updateHoveredStateForPointerAtScreenPosition(p.createScreenPointFromEvent(a),a.pointerId,a.pointerType,e)};k._updateHoveredStateForPointerAtScreenPosition=function(a,e,c,d){a=this._intersect(a,c,d);c=f.applySome(this._hoveredManipulators.get(e),({manipulator:b})=>b);f.isSome(a)&&!a.manipulator.interactive&&(a=null);f.isSome(a)&&c===a.manipulator||(f.isSome(c)&&(c.hovering=!1),f.isSome(a)?(a.manipulator.hovering=!0,this._hoveredManipulators.set(e,a)):this._hoveredManipulators.delete(e),
this._onFocusChange(d))};k._afterManipulatorUngrab=function(a){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(a(null),this._revertToNullActiveTool=!1)};x._createClass(r,[{key:"cursor",get:function(){return this._cursor}}]);return r}();t.ToolViewManagerManipulatorState=C;Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});