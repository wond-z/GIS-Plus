// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../core/workers/WorkerHandle ../../../../../chunks/sphere ../../../../../support/elevationInfoUtils ../../candidates/EdgeSnappingCandidate ../../candidates/VertexSnappingCandidate".split(" "),
function(f,h,m,v,r,D,E,w,x,y,z,u,A,B){f.SceneLayerSnappingSourceWorkerHandle=function(n){function k(b){b=n.call(this,b)||this;b.availability=0;b._ids=new Set;b._tmpP=x.create();return b}h._inheritsLoose(k,n);var d=k.prototype;d.destroy=function(){this._workerHandle.destroy();this._workerHandle=null};d.initialize=function(){this._workerHandle=new C(this.schedule,{fetchAllEdgeLocations:(b,a)=>this._fetchAllEdgeLocations(b,a)})};d.fetchCandidates=function(){var b=h._asyncToGenerator(function*(a,c){const p=
a.coordinateHelper,g=p.toXYZ(a.point);this.renderCoordsHelper.toRenderCoords(g,p.spatialReference,g);const l=a.distance;a=yield this._workerHandle.invoke({bounds:z.fromValues(g[0],g[1],g[2],"number"===typeof l?l:l.distance),types:a.types},c);a.candidates.sort((e,t)=>e.distance-t.distance);return a.candidates.map(e=>this._convertCandidate(p,e))});return function(a,c){return b.apply(this,arguments)}}();d.add=function(){var b=h._asyncToGenerator(function*(a,c){this._ids.add(a.id);yield this._workerHandle.invokeMethod("add",
a,c)});return function(a,c){return b.apply(this,arguments)}}();d.remove=function(){var b=h._asyncToGenerator(function*(a,c){this._ids.delete(a.id);yield this._workerHandle.invokeMethod("remove",a,c)});return function(a,c){return b.apply(this,arguments)}}();d._convertCandidate=function(b,a){switch(a.type){case "edge":return new A.EdgeSnappingCandidate({coordinateHelper:b,objectId:a.objectId,targetPoint:this._convertRenderCoordinate(b,a.target),edgeStart:this._convertRenderCoordinate(b,a.start),edgeEnd:this._convertRenderCoordinate(b,
a.end),elevationInfo:u.absoluteHeightElevationInfo});case "vertex":return new B.VertexSnappingCandidate({coordinateHelper:b,objectId:a.objectId,targetPoint:this._convertRenderCoordinate(b,a.target),elevationInfo:u.absoluteHeightElevationInfo})}};d._convertRenderCoordinate=function(b,a){this.renderCoordsHelper.fromRenderCoords(a,this._tmpP,b.spatialReference);return b.fromXYZ(this._tmpP)};d._fetchAllEdgeLocations=function(){var b=h._asyncToGenerator(function*(a,c){var p=this;const g=[],l=[];for(const {id:e,
uid:t}of a.components)this._ids.has(e)&&g.push(h._asyncToGenerator(function*(){const q=yield p.fetchEdgeLocations(e,c.signal);l.push(q.locations.buffer);return{id:e,uid:t,objectIds:q.objectIds,locations:q.locations.buffer,origin:q.origin,type:q.type}})());return{result:{components:(yield Promise.all(g)).filter(({id:e})=>this._ids.has(e))},transferList:l}});return function(a,c){return b.apply(this,arguments)}}();return k}(v.HandleOwner);m.__decorate([r.property({constructOnly:!0})],f.SceneLayerSnappingSourceWorkerHandle.prototype,
"renderCoordsHelper",void 0);m.__decorate([r.property({constructOnly:!0})],f.SceneLayerSnappingSourceWorkerHandle.prototype,"fetchEdgeLocations",void 0);m.__decorate([r.property({constructOnly:!0})],f.SceneLayerSnappingSourceWorkerHandle.prototype,"schedule",void 0);m.__decorate([r.property({readOnly:!0})],f.SceneLayerSnappingSourceWorkerHandle.prototype,"availability",void 0);f.SceneLayerSnappingSourceWorkerHandle=m.__decorate([w.subclass("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],
f.SceneLayerSnappingSourceWorkerHandle);let C=function(n){function k(d,b){return n.call(this,"SceneLayerSnappingSourceWorker","fetchCandidates",{},d,{strategy:"dedicated",client:b})||this}h._inheritsLoose(k,n);return k}(y.WorkerHandle);Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});