// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/elevationInfoUtils ../snappingUtils ./queryEngineUtils ./snappingCandidateElevationAlignment ./snappingCandidateElevationFilter ./symbologySnappingCandidates".split(" "),
function(e,n,g,A,l,p,q,h,G,H,B,u,v,w,x,C,y){e.FeatureCollectionSnappingSource=function(z){function r(a){a=z.call(this,a)||this;a.view=null;a._layerView3D=null;return a}n._inheritsLoose(r,z);var t=r.prototype;t.initialize=function(){const {view:a}=this,{layer:c}=this.layerSource;l.isSome(a)&&"3d"===a.type&&"subtype-group"!==c.type&&(a.whenLayerView(c).then(b=>this._layerView3D=b),this.addHandles([a.elevationProvider.on("elevation-change",({context:b})=>{const {elevationInfo:d}=c;u.elevationContextAffectsAlignment(b,
d)&&this._snappingElevationAligner.notifyElevationSourceChange()}),q.watch(()=>c.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),q.initial),q.watch(()=>l.isSome(this._layerView3D)?this._layerView3D.processor?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),q.initial)]))};t.refresh=function(){};t.fetchCandidates=function(){var a=n._asyncToGenerator(function*(c,b){var {layer:d}=this.layerSource;const {coordinateHelper:k,elevationInfo:m}=c;var f=
d.source;if(!f.querySnapping)return[];d=v.makeFilter(d);c=v.makeSnappingQuery(c,d);f=yield f.querySnapping(c,{signal:b});p.throwIfAborted(b);f=yield this._snappingElevationAligner.alignCandidates(f.candidates,b);p.throwIfAborted(b);d=yield this._symbologySnappingFetcher.fetch(f,b);p.throwIfAborted(b);b=0===d.length?f:[...f,...d];b=this._snappingElevationFilter.filter(c,b);const D=k.hasZ()?u.absoluteHeightElevationInfo:m,E=this._getGroundElevation;return b.map(F=>w.convertSnappingCandidate(F,k,D,E))});
return function(c,b){return a.apply(this,arguments)}}();n._createClass(r,[{key:"availability",get:function(){return 1}},{key:"updating",get:function(){return this.layerSource.updating}},{key:"_snappingElevationAligner",get:function(){const {view:a}=this,{layer:c}=this.layerSource,b=l.isSome(a)&&"3d"===a.type;if(!b||"subtype-group"===c.type)return x.getSnappingCandidateElevationAligner();const d=function(){var k=n._asyncToGenerator(function*(m,f){return(yield p.whenOrAbort(a.whenLayerView(c),f)).elevationAlignPointsInFeatures(m,
f)});return function(m,f){return k.apply(this,arguments)}}();return x.getSnappingCandidateElevationAligner(b,{elevationInfo:c.elevationInfo,alignPointsInFeatures:d,spatialReference:a.spatialReference})}},{key:"_snappingElevationFilter",get:function(){var {view:a}=this;a=l.isSome(a)&&"3d"===a.type&&"subtype-group"!==this.layerSource.layer.type;return C.getSnappingCandidateElevationFilter(a)}},{key:"_symbologySnappingFetcher",get:function(){const {view:a}=this,{layer:c}=this.layerSource;return l.isSome(a)&&
"3d"===a.type&&"subtype-group"!==c.type?y.getSymbologySnappingCandidatesFetcher(this._symbologySnappingSupported,function(){var b=n._asyncToGenerator(function*(d,k){const m=yield a.whenLayerView(c);p.throwIfAborted(k);return m.queryForSymbologySnapping({candidates:d,spatialReference:a.spatialReference},k)});return function(d,k){return b.apply(this,arguments)}}()):y.getSymbologySnappingCandidatesFetcher()}},{key:"_symbologySnappingSupported",get:function(){return l.isSome(this._layerView3D)&&this._layerView3D.symbologySnappingSupported}},
{key:"_getGroundElevation",get:function(){return w.makeGetGroundElevation(this.view)}}]);return r}(A);g.__decorate([h.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"layerSource",void 0);g.__decorate([h.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"view",void 0);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationAligner",null);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationFilter",
null);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingFetcher",null);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_layerView3D",void 0);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingSupported",null);g.__decorate([h.property()],e.FeatureCollectionSnappingSource.prototype,"_getGroundElevation",null);e.FeatureCollectionSnappingSource=g.__decorate([B.subclass("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],
e.FeatureCollectionSnappingSource);Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});