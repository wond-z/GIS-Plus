// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/asyncUtils","../../../../../core/maybe","../../../../../geometry/support/aaBoundingRect"],function(a,k,h,p,l){let q=function(){function c(b,d){this.data=b;this.resolution=d;this.state={type:a.StateType.CREATED};this.alive=!0}var g=c.prototype;g.process=function(b){switch(this.state.type){case a.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,b),this.state.task.promise.then(b.resume,b.resume);
case a.StateType.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,b),this.state.task.promise.then(b.resume,b.resume);case a.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,b)}return null};g._gotoFetchCount=function(b,d){var e=this;return{type:a.StateType.FETCH_COUNT,previous:b,task:h.createTask(function(){var m=k._asyncToGenerator(function*(f){f=yield h.resultOrAbort(d.fetchCount(e,f));e.state.type===a.StateType.FETCH_COUNT&&(e.state=e._gotoFetchedCount(e.state,f.ok?
f.value:Infinity))});return function(f){return m.apply(this,arguments)}}())}};g._gotoFetchedCount=function(b,d){return{type:a.StateType.FETCHED_COUNT,featureCount:d,previous:b}};g._gotoFetchFeatures=function(b,d){var e=this;return{type:a.StateType.FETCH_FEATURES,previous:b,task:h.createTask(function(){var m=k._asyncToGenerator(function*(f){f=yield h.resultOrAbort(d.fetchFeatures(e,b.featureCount,f));e.state.type===a.StateType.FETCH_FEATURES&&(e.state=e._gotoFetchedFeatures(e.state,f.ok?f.value:[]))});
return function(f){return m.apply(this,arguments)}}())}};g._gotoFetchedFeatures=function(b,d){return{type:a.StateType.FETCHED_FEATURES,previous:b,features:d}};g._goToDone=function(b,d){d.finish(this,b.features);return{type:a.StateType.DONE,previous:b}};g.reset=function(){const b=this.state;this.state={type:a.StateType.CREATED};switch(b.type){case a.StateType.FETCH_COUNT:case a.StateType.FETCH_FEATURES:b.task.abort()}};g.intersects=function(b){if(p.isNone(b)||!this.data.extent)return!0;l.fromExtent(b,
n);return l.intersects(this.data.extent,n)};k._createClass(c,[{key:"debugInfo",get:function(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}},{key:"_featureCount",get:function(){switch(this.state.type){case a.StateType.CREATED:case a.StateType.FETCH_COUNT:return 0;case a.StateType.FETCHED_COUNT:return this.state.featureCount;case a.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case a.StateType.FETCHED_FEATURES:return this.state.features.length;
case a.StateType.DONE:return this.state.previous.features.length}}},{key:"_stateToString",get:function(){switch(this.state.type){case a.StateType.CREATED:return"created";case a.StateType.FETCH_COUNT:return"fetch-count";case a.StateType.FETCHED_COUNT:return"fetched-count";case a.StateType.FETCH_FEATURES:return"fetch-features";case a.StateType.FETCHED_FEATURES:return"fetched-features";case a.StateType.DONE:return"done"}}}]);return c}();a.StateType=void 0;(function(c){c[c.CREATED=0]="CREATED";c[c.FETCH_COUNT=
1]="FETCH_COUNT";c[c.FETCHED_COUNT=2]="FETCHED_COUNT";c[c.FETCH_FEATURES=3]="FETCH_FEATURES";c[c.FETCHED_FEATURES=4]="FETCHED_FEATURES";c[c.DONE=5]="DONE"})(a.StateType||(a.StateType={}));const n=l.create();a.PendingFeatureTile=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});