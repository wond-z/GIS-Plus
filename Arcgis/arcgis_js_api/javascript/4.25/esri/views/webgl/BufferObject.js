// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(r,t,v,m,n,u,p,l,d){const g=m.getLogger("esri.views.webgl.BufferObject");m=function(){function f(a,b,c,e){this._context=a;this.bufferType=b;this.usage=c;this._glName=null;this._size=-1;this._indexType=void 0;a.instanceCounter.increment(d.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();
p.checkWebGLError(this._context.gl);e&&this.setData(e)}f.createIndex=function(a,b,c){return new f(a,d.BufferType.ELEMENT_ARRAY_BUFFER,b,c)};f.createVertex=function(a,b,c){return new f(a,d.BufferType.ARRAY_BUFFER,b,c)};f.createUniform=function(a,b,c){if(a.type!==l.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new f(a,d.BufferType.UNIFORM_BUFFER,b,c)};f.createPixelPack=function(a,b=d.Usage.STREAM_READ,c){if(a.type!==l.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");
a=new f(a,d.BufferType.PIXEL_PACK_BUFFER,b);c&&a.setSize(c);return a};f.createPixelUnpack=function(a,b=d.Usage.STREAM_DRAW,c){if(a.type!==l.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new f(a,d.BufferType.PIXEL_UNPACK_BUFFER,b,c)};var k=f.prototype;k.dispose=function(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(d.ResourceType.BufferObject,this),this._context=
n.nullifyNonNullableForDispose(this._context)):this._glName&&g.warn("Leaked WebGL buffer object")};k.setSize=function(a,b=null){0>=a&&g.error("Buffer size needs to be positive!");if(this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER&&n.isSome(b))switch(this._indexType=b,b){case d.DataType.UNSIGNED_SHORT:a*=2;break;case d.DataType.UNSIGNED_INT:a*=4}this._setBufferData(a)};k.setData=function(a){if(a){var b=a.byteLength;this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER&&(u.isUint16Array(a)&&(b/=2,
this._indexType=d.DataType.UNSIGNED_SHORT),u.isUint32Array(a)&&(b/=4,this._indexType=d.DataType.UNSIGNED_INT));this._setBufferData(b,a)}};k._setBufferData=function(a,b=null){this._size=a;const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const e=this._context.gl;n.isSome(b)?e.bufferData(this.bufferType,b,this.usage):e.bufferData(this.bufferType,a,this.usage);p.checkWebGLError(e);this._isVAOAware&&this._context.bindVAO(c)};k.setSubData=
function(a,b,c,e){if(a){(0>b||b>=this._size)&&g.error("offset is out of range!");c>=e&&g.error("end must be bigger than start!");b+(e-c)>this._size&&g.error("An attempt to write beyond the end of the buffer!");var h=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var q=this._context.gl;this._context.type===l.ContextType.WEBGL2?q.bufferSubData(this.bufferType,b*a.BYTES_PER_ELEMENT,a,c,e-c):(c=0===c&&e===a.length?a:a.subarray(c,e),q.bufferSubData(this.bufferType,
b*a.BYTES_PER_ELEMENT,c));p.checkWebGLError(q);this._isVAOAware&&this._context.bindVAO(h)}};k.getSubData=function(a,b=0,c,e){if(this._context.type!==l.ContextType.WEBGL2)g.error("Get buffer subdata is supported in WebGL2 only!");else if(0>c||0>e)g.error("Problem getting subdata: offset and length were less than zero!");else{var h=v.isArrayLike(a)?a.BYTES_PER_ELEMENT:1;h*((c??0)+(e??0))>a.byteLength?g.error("Problem getting subdata: offset and length exceeded destination size!"):(b+h*(e??0)>this.byteSize&&
g.warn("Potential problem getting subdata: requested data exceeds buffer size!"),h=this._context.gl,this._context.bindBuffer(this,d.BufferType.COPY_READ_BUFFER),h.getBufferSubData(d.BufferType.COPY_READ_BUFFER,b,a,c,e),this._context.unbindBuffer(d.BufferType.COPY_READ_BUFFER))}};k.getSubDataAsync=function(){var a=t._asyncToGenerator(function*(b,c=0,e,h){this._context.type!==l.ContextType.WEBGL2?g.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(b,
c,e,h))});return function(b){return a.apply(this,arguments)}}();t._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===d.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER||
this.bufferType===d.BufferType.ARRAY_BUFFER}}]);return f}();r.BufferObject=m;Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});