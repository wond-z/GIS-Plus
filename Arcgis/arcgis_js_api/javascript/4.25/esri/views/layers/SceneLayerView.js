// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),function(z,p,e,c,q,v,x,f,D,E,A,r,B){const w=c.getLogger("esri.views.layers.SceneLayerView");c=function(y){function t(){var a=y.apply(this,
arguments)||this;a.layer=null;a.filter=null;a._geometryEngine=null;a._projectionEngineLoaded=!1;return a}p._inheritsLoose(t,y);var h=t.prototype;h.initialize=function(){var a=this;x.whenOnce(()=>!this._geometryEngine&&q.isSome(this.layer.filter)&&this.layer.filter.geometries.length).then(p._asyncToGenerator(function*(){return a._geometryEngine=yield new Promise((d,k)=>z(["../../geometry/geometryEngine"],d,k))}));this._projectionEngineLoaded=r.isLoaded();x.whenOnce(()=>!this._projectionEngineLoaded&&
this._filterNeedsProjectionEngine).then(p._asyncToGenerator(function*(){yield r.load();a._projectionEngineLoaded=!0}))};h.highlight=function(a){throw Error("Not implemented");};h.queryFeatures=function(a,d){throw Error("Not implemented");};h.queryObjectIds=function(a,d){throw Error("Not implemented");};h.queryFeatureCount=function(a,d){throw Error("Not implemented");};h.createQuery=function(){throw Error("Not implemented");};h.queryExtent=function(a,d){throw Error("Not implemented");};p._createClass(t,
[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(a){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return v.unwrapUpdating(this._layerFilter)}},{key:"_layerFilter",get:function(){const a=this.layer.filter;if(q.isNone(a)||1>a.geometries.length)return null;const d=this._geometryEngine;if(q.isNone(d)||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return v.updating;
const k=a.geometries.getItemAt(0).spatialReference,C=a.geometries.toArray().map(b=>{try{b=d.simplify(b)}catch(m){return w.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==b)return null;if(b.spatialReference.equals(k))return b;try{return r.project(b,k)}catch(m){return w.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}}).filter(b=>null!=b).sort((b,m)=>b.extent.xmin-m.extent.xmin),n=new Set,l=[],u=[];
for(let b of C){const m=b.extent.xmin;l.length=0;n.forEach(g=>{m>=g.extent.xmax?(u.push(g),n.delete(g)):b.extent.ymin<=g.extent.ymax&&b.extent.ymax>=g.extent.ymin&&d.intersects(b,g)&&l.push(g)});if(0<l.length){l.push(b);try{b=d.union(l)}catch(g){w.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}l.pop();l.forEach(g=>n.delete(g))}n.add(b)}n.forEach(b=>u.push(b));return 0<u.length?{spatialRelationship:a.spatialRelationship,geometries:u}:null}},{key:"_filterNeedsProjectionEngine",
get:function(){const a=this.layer.filter;if(q.isNone(a)||1>=a.geometries.length)return!1;const d=a.geometries.getItemAt(0).spatialReference;return a.geometries.some(({spatialReference:k})=>!k.equals(d)&&!r.canProjectWithoutEngine(k,d))}},{key:"layerFilterUpdating",get:function(){return v.isUpdating(this._layerFilter)}}]);return t}(B);e.__decorate([f.property()],c.prototype,"layer",void 0);e.__decorate([f.property()],c.prototype,"availableFields",null);e.__decorate([f.property()],c.prototype,"maximumNumberOfFeatures",
null);e.__decorate([f.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",null);e.__decorate([f.property()],c.prototype,"filter",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"layerFilter",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"_layerFilter",null);e.__decorate([f.property()],c.prototype,"_geometryEngine",void 0);e.__decorate([f.property()],c.prototype,"_projectionEngineLoaded",void 0);e.__decorate([f.property()],c.prototype,"_filterNeedsProjectionEngine",
null);e.__decorate([f.property()],c.prototype,"layerFilterUpdating",null);return c=e.__decorate([A.subclass("esri.views.layers.SceneLayerView")],c)});