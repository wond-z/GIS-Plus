// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../geometry/projection ../../../../../geometry/support/aaBoundingRect ../../support/projectionUtils ../../../../interactive/coordinateHelper ../../../../interactive/editGeometry/EditGeometry ../../../../interactive/editGeometry/EditGeometryOperations".split(" "),
function(g,n,h,v,w,x,e,p,k,F,G,y,z,A,m,B,C,q,r){const D=x.getLogger("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurement3DPathHelper");g.AreaMeasurement3DPathHelper=function(t){function l(a={}){a=t.call(this,a)||this;a._handles=new w;a._version=0;a._internalGeometryChange=!1;a._extent=m.empty();return a}n._inheritsLoose(l,t);var d=l.prototype;d.destroy=function(){this._handles=e.destroyMaybe(this._handles)};d._initialize=function(a,b){this._handles.removeAll();this._handles.add(p.watch(()=>
a.geometry,()=>{this._updateEditGeometryFromModelGeometry(a,b)},p.syncAndInitial));this._makeDirty(!0)};d._makeDirty=function(a=!1){this.notifyChange("isValidPolygon");this.notifyChange("initialized");this.notifyChange("extent");a&&this.notifyChange("numVertices")};d._updateEditGeometryFromModelGeometry=function(a,b){this._version++;if(!this._internalGeometryChange){this._handles.remove("EditGeometry");var c=a.geometry;if(e.isSome(c)){const f=A.tryProjectWithZConversion(c,b.spatialReference);e.isNone(f)&&
B.logFailedGeometryProjectionError(a,c.spatialReference,D);c=f}e.isSome(c)?this._editGeometryOperations=r.EditGeometryOperations.fromGeometry(c,b.state.viewingMode):this._editGeometryOperations=new r.EditGeometryOperations(new q.EditGeometry("polygon",C.createCoordinateHelper(!0,!1,b.spatialReference)));this._makeDirty(!0);this.emit("change");this._handles.add(this._editGeometry.on("change",f=>{this._makeDirty(null!=f.addedVertices||null!=f.removedVertices);this._internalGeometryChange=!0;a.geometry=
0<this.numVertices?this._editGeometry.geometry:null;this._internalGeometryChange=!1}),"EditGeometry")}};d.getVertex=function(a){if(!this.constructed||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const b=this._editGeometry.components[0].vertices[0];let c=b;do{if(c.index===a)return c;c=c.rightEdge.rightVertex}while(c!==b&&null!=c);return null};d.getVertexPositionAsPoint=function(a){return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)};
d.getVertexPositionAsPointFromIndex=function(a){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(a).pos)};d.forEachVertex=function(a){this.constructed&&0<this._editGeometry.components.length&&this._editGeometry.components[0].iterateVertices(a)};d.forEachVertexPosition=function(a){const b=this._editGeometry.coordinateHelper;this.forEachVertex((c,f)=>{b.vectorToPoint(c.pos,u);a(u,f)})};d.clear=function(){e.isSome(this.areaMeasurement)&&(this.areaMeasurement.geometry=null)};d.add=
function(a){if(!this.constructed)return null;if(0===this._editGeometry.components.length){const b=e.unwrap(this.view);this._editGeometry.components.push(new q.Component(b.spatialReference,b.state.viewingMode))}a=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(a));this.emit("change");return a};d.close=function(){if(!this.constructed||0===this._editGeometry.components.length)return null;const a=this._editGeometryOperations.closeComponent(this._editGeometry.components[0]);
this.emit("change");return a};d.ensureContains=function(a,b=""){let c=!1;this._editGeometry.components.forEach(f=>{f.iterateVertices(E=>{E===a&&(c=!0)})});if(!c)throw Error(`vertex doesnt exist ${b}`);return c};d.setVertexPosition=function(a,b){if(!this.constructed)return null;a=this._editGeometryOperations.setVertexPosition(a,this._editGeometry.coordinateHelper.pointToVector(b));this.emit("change");return a};d.equals=function(a){if(this.numVertices!==a.numVertices)return!1;let b=!0;this.forEachVertexPosition((c,
f)=>{f=a.getVertexPositionAsPointFromIndex(f);c.equals(f)||(b=!1)});return b?!0:!1};n._createClass(l,[{key:"areaMeasurement",set:function(a){this._set("areaMeasurement",a);e.isSome(a)&&e.isSome(this.view)&&this._initialize(a,this.view)}},{key:"view",set:function(a){this._set("view",a);e.isSome(a)&&e.isSome(this.areaMeasurement)&&this._initialize(this.areaMeasurement,a)}},{key:"constructed",get:function(){return e.isSome(this.areaMeasurement)&&e.isSome(this.view)}},{key:"version",get:function(){return this._version}},
{key:"isValidPolygon",get:function(){return this.constructed&&0<this._editGeometry.components.length&&this._editGeometry.components[0].isClosed()}},{key:"extent",get:function(){if(this.constructed&&0<this._editGeometry.components.length&&0<this._editGeometry.components[0].vertices.length){const a=m.empty(this._extent);this.forEachVertex(b=>{m.expandPointInPlace(a,b.pos)});return a}return null}},{key:"spatialReference",get:function(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:
null}},{key:"_editGeometry",get:function(){return this._editGeometryOperations.data}},{key:"vertices",get:function(){const a=[];this.forEachVertex(b=>{a.push(b)});return a}},{key:"numVertices",get:function(){return this.constructed&&0<this._editGeometry.components.length?this._editGeometry.components[0].vertices.length:0}},{key:"lastPoint",get:function(){if(this.constructed&&0<this._editGeometry.components.length){const a=this._editGeometry.components[0].getLastVertex();if(e.isSome(a))return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)}return null}}]);
return l}(v.EventedAccessor);h.__decorate([k.property({value:null})],g.AreaMeasurement3DPathHelper.prototype,"areaMeasurement",null);h.__decorate([k.property({value:null})],g.AreaMeasurement3DPathHelper.prototype,"view",null);h.__decorate([k.property()],g.AreaMeasurement3DPathHelper.prototype,"isValidPolygon",null);h.__decorate([k.property()],g.AreaMeasurement3DPathHelper.prototype,"extent",null);h.__decorate([k.property()],g.AreaMeasurement3DPathHelper.prototype,"spatialReference",null);h.__decorate([k.property()],
g.AreaMeasurement3DPathHelper.prototype,"numVertices",null);g.AreaMeasurement3DPathHelper=h.__decorate([y.subclass("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurement3DPathHelper")],g.AreaMeasurement3DPathHelper);const u=new z;Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});