// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/clock ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/vectorStacks ./lengthDimensionManipulatorUtils ./LengthDimensionSubTool ./settings ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../../interactive/AnalysisToolBase ../../../interactive/keybindings ../../../support/screenUtils".split(" "),
function(c,n,d,t,p,e,h,f,C,D,u,v,q,w,x,y,z,A,r,B){var k;(function(l){l.Ready="ready";l.Creating="creating";l.Created="created"})(k||(k={}));c.DimensionTool=function(l){function m(a){a=l.call(this,a)||this;a.automaticManipulatorSelection=!1;a.removeIncompleteOnCancel=!1;a._pointerMoveTimerMs=x.settings.pointerMoveTimeoutMs;a._prevPointerMoveTimeout=null;return a}n._inheritsLoose(m,l);var b=m.prototype;b.initialize=function(){this._intersector=y.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
z.StoreResults.MIN;this._lengthDimensionSubTool=new w.LengthDimensionSubTool({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view});this.addHandles([p.destroyHandle(this._lengthDimensionSubTool),p.makeHandle(()=>this._clearPointerMoveTimeout()),h.watch(()=>this.state,a=>{a===k.Created&&this.finishToolCreation()},h.syncAndInitial),h.when(()=>this.firstGrabbedManipulator,a=>{this.selectedDimension=a.metadata},h.syncAndInitial),
h.watch(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),h.syncAndInitial)])};b.onInputEvent=function(a){switch(a.type){case "immediate-click":this._clickHandler(a);break;case "immediate-double-click":this._doubleClickHandler(a);break;case "pointer-move":this._pointerMoveHandler(a);break;case "key-down":r.SKETCH_KEYS.cancel===a.key?e.isSome(this._activeSubTool)&&this._activeSubTool.removeStaged()?a.stopPropagation():this.active||(this.selectedDimension=null):r.SKETCH_KEYS.delete.includes(a.key)&&
this._deleteKeyHandler()}};b.onActivate=function(){this._activeSubTool=this._lengthDimensionSubTool};b.onDeactivate=function(){e.isSome(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)};b.onShow=function(){this._resetPointerMoveTimeout()};b.onManipulatorSelectionChanged=function(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()};b.onHide=function(){this.selectedDimension=null};b._clickHandler=function(a){if(this.hasFocusedManipulators)a.stopPropagation();
else if(!e.isNone(this._activeSubTool)){var g=this._intersectScreen(a);e.isNone(g)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:g,pointerType:a.pointerType}),a.stopPropagation())}};b._doubleClickHandler=function(a){this.active&&(this.view.activeTool=null,a.stopPropagation())};b._pointerMoveHandler=function(a){this._resetPointerMoveTimeout();if(!e.isNone(this._activeSubTool)&&!this.hasFocusedManipulators){var g=this._intersectScreen(a);if(!e.isNone(g))this._activeSubTool.onPointerMove({mapPoint:g,
pointerType:a.pointerType})}};b._deleteKeyHandler=function(){e.isSome(this._activeSubTool)&&this._activeSubTool.removeStaged();this._removeSelected()};b._intersectScreen=function(a){a=B.createScreenPointArrayFromEvent(a);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,this._intersector);a=this._intersector.results.min;const g=v.sv3d.get();return a.getIntersectionPoint(g)?this.view.renderCoordsHelper.fromRenderCoords(g,this.view.spatialReference):null};b._removeSelected=function(){e.isSome(this.selectedDimension)&&
(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)};b._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout=e.removeMaybe(this._prevPointerMoveTimeout)};b._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout();this.manipulators.forEach(a=>{a.manipulator.state|=q.DidPointerMoveRecentlyFlag});this._prevPointerMoveTimeout=t.clock.setTimeout(()=>{this.manipulators.forEach(a=>{a.manipulator.state&=~q.DidPointerMoveRecentlyFlag})},this._pointerMoveTimerMs)};
n._createClass(m,[{key:"state",get:function(){return this.analysis.dimensions.some(a=>"length"===a.type)?e.isSome(this._activeSubTool)?k.Creating:k.Created:k.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"selectedDimension",get:function(){return this.analysisViewData.selectedDimension},set:function(a){this.analysisViewData.selectedDimension=a}},{key:"testInfo",get:function(){return{...this._lengthDimensionSubTool.testInfo,
setManipulatorAutoHideDelay:a=>{this._pointerMoveTimerMs=a;this._resetPointerMoveTimeout()}}}}]);return m}(A.AnalysisToolBase);d.__decorate([f.property({constructOnly:!0})],c.DimensionTool.prototype,"view",void 0);d.__decorate([f.property({constructOnly:!0})],c.DimensionTool.prototype,"analysis",void 0);d.__decorate([f.property({readOnly:!0})],c.DimensionTool.prototype,"state",null);d.__decorate([f.property({readOnly:!0})],c.DimensionTool.prototype,"updating",null);d.__decorate([f.property({readOnly:!0})],
c.DimensionTool.prototype,"cursor",null);d.__decorate([f.property({constructOnly:!0})],c.DimensionTool.prototype,"analysisViewData",void 0);d.__decorate([f.property()],c.DimensionTool.prototype,"selectedDimension",null);d.__decorate([f.property()],c.DimensionTool.prototype,"automaticManipulatorSelection",void 0);d.__decorate([f.property()],c.DimensionTool.prototype,"_activeSubTool",void 0);d.__decorate([f.property()],c.DimensionTool.prototype,"_lengthDimensionSubTool",void 0);c.DimensionTool=d.__decorate([u.subclass("esri.views.3d.analysis.Dimension.DimensionTool")],
c.DimensionTool);Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});