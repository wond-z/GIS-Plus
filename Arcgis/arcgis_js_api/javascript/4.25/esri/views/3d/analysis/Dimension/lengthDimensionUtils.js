// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../analysis/dimensionUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/quantityUtils ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/Axis ../../../../geometry/support/vectorStacks ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../interactive/visualElements/support/Segment ../../../support/euclideanLengthMeasurementUtils".split(" "),
function(f,q,A,m,B,C,D,I,d,v,J,n,K,L,x,E){function F(a,c,b){b.toRenderCoords(c.elevationAlignedStartPoint,a.startRenderSpace);b.toRenderCoords(c.elevationAlignedEndPoint,a.endRenderSpace);return a}function y(a,c){const {measureType:b,elevationAlignedStartPoint:e,elevationAlignedEndPoint:g,directSegment:{startRenderSpace:h,endRenderSpace:k},directSegment:p,renderCoordsHelper:t}=c;var r=p.eval(.5,n.sv3d.get()),l=t.worldUpAtPosition(r,n.sv3d.get());r=t.worldBasisAtPosition(r,J.Axis.Y,n.sv3d.get());switch(b){case q.LengthDimensionMeasureType.Horizontal:d.copy(a,
l);break;case q.LengthDimensionMeasureType.Vertical:d.dot(h,l)<d.dot(k,l)?d.sub(a,k,h):d.sub(a,h,k);d.cross(a,a,l);d.cross(a,a,l);break;case q.LengthDimensionMeasureType.Direct:if(c=m.unwrapOr(c.orientation,0),z({elevationAlignedStartPoint:e,elevationAlignedEndPoint:g}))D.fromRotation(w,-A.deg2rad(c),l),d.transformMat4(a,r,w);else{const u=d.sub(n.sv3d.get(),k,h);l=d.cross(n.sv3d.get(),u,l);d.cross(l,l,u);D.fromRotation(w,A.deg2rad(c),u);d.transformMat4(a,l,w)}}return d.equals(a,v.ZEROS)?d.copy(a,
r):d.normalize(a,a)}function z({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c}){return m.isSome(a)&&m.isSome(c)&&a.x===c.x&&a.y===c.y}function G(a,c){const {offsetAxis:b,offset:e,relativeToSegment:{startRenderSpace:g,endRenderSpace:h},relativeToSegment:k,renderCoordsHelper:p}=c,[t,r]=M(g,h,b,e/p.unitInMeters);d.scaleAndAdd(a.startRenderSpace,k.startRenderSpace,b,t);d.scaleAndAdd(a.endRenderSpace,k.endRenderSpace,b,r);return a}function M(a,c,b,e=0){c=d.dot(c,b);a=d.dot(a,b);b=Math.abs(c-
a)+e;return c>a?[b,e]:[e,b]}function H(a,c,b={invert:!1}){const {startRenderSpace:e,endRenderSpace:g}=c.dimensionSegment;return b.invert?d.sub(a,e,g):d.sub(a,g,e)}f.OffsetSegmentLocation=void 0;(function(a){a[a.Start=0]="Start";a[a.End=1]="End"})(f.OffsetSegmentLocation||(f.OffsetSegmentLocation={}));const N=K.makeDehydratedPoint(0,0,0,null),O=new x.EuclideanSegment,w=I.create(),P=v.create();f.GEODESIC_DISTANCE_THRESHOLD=1E5;f.arePointsVerticallyAligned=z;f.computationToGeometryDependencies=function(a){const {elevationAlignedStartPoint:c,
elevationAlignedEndPoint:b,dimension:{offset:e,measureType:g,orientation:h}}=a;return{elevationAlignedStartPoint:c,elevationAlignedEndPoint:b,offset:e,measureType:g,orientation:h}};f.computeGeometryFromDimension=function({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,offset:b,measureType:e,orientation:g},h,k=null){if(m.isNone(a)||m.isNone(c))return null;const p=F(m.isSome(k)?k.directSegment:new x.EuclideanSegment,{elevationAlignedStartPoint:a,elevationAlignedEndPoint:c},h),t=m.isSome(k)?
k.primaryOffsetAxis:v.create();y(t,{measureType:e,elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,directSegment:p,orientation:g,renderCoordsHelper:h});g=m.isSome(k)?k.dimensionSegment:new x.EuclideanSegment;z({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c})&&e===q.LengthDimensionMeasureType.Vertical?(d.copy(g.startRenderSpace,p.startRenderSpace),d.copy(g.endRenderSpace,p.endRenderSpace)):G(g,{offsetAxis:t,offset:b,relativeToSegment:p,renderCoordsHelper:h});return{directSegment:p,
dimensionSegment:g,primaryOffsetAxis:t,spatialReference:h.spatialReference}};f.computeLength=function(a,c,b){if(m.isNone(a))return null;a=E.euclideanDirectDistance(a.dimensionSegment.startRenderSpace,a.dimensionSegment.endRenderSpace,a.spatialReference);if(m.isNone(a))return null;c=c===q.LengthDimensionMeasureType.Vertical?C.preferredVerticalLengthUnit(a.value,a.unit,b):C.preferredLengthUnit(a.value,a.unit,b);return B.toUnit(a,c)};f.computeOffsetAxis=y;f.computeOffsetForPoint=function(a,c,b,e){({directSegment:b}=
b);c=y(n.sv3d.get(),{measureType:c,directSegment:b,renderCoordsHelper:e});b=G(O,{offsetAxis:c,offset:0,relativeToSegment:b,renderCoordsHelper:e}).eval(.5,n.sv3d.get());a=d.sub(n.sv3d.get(),a,b);return d.dot(a,c)*e.unitInMeters};f.computeSegmentForMeasureType=function(a,c,b,e){switch(c){case q.LengthDimensionMeasureType.Direct:return F(a,b,e);case q.LengthDimensionMeasureType.Horizontal:case q.LengthDimensionMeasureType.Vertical:const {elevationAlignedStartPoint:k,elevationAlignedEndPoint:p,dimension:t,
geometry:r}=b;if(t.measureType===q.LengthDimensionMeasureType.Direct){var g=r,h=g.directSegment.eval(.5,n.sv3d.get());b=e.worldUpAtPosition(h,n.sv3d.get());g=g.dimensionSegment.eval(.5,n.sv3d.get());h=d.sub(n.sv3d.get(),g,h);b=d.equals(h,v.ZEROS)?!1:0<d.dot(h,b);b=b===k.z>p.z;c===q.LengthDimensionMeasureType.Horizontal&&(b=!b)}else{const {startRenderSpace:Q,endRenderSpace:R}=r.dimensionSegment,{startRenderSpace:S,endRenderSpace:T}=r.directSegment;b=!(d.sqrDist(S,Q)<d.sqrDist(T,R))}const [l,u]=b?[k,
p]:[p,k];b=L.clonePoint(u,N);c===q.LengthDimensionMeasureType.Horizontal?b.z=l.z:(b.x=l.x,b.y=l.y);e.toRenderCoords(l,a.startRenderSpace);e.toRenderCoords(b,a.endRenderSpace);return a}};f.computeSpanningSegment=function(a,c,b,e){c===f.OffsetSegmentLocation.Start?(d.copy(a.startRenderSpace,b.startRenderSpace),d.copy(a.endRenderSpace,e.startRenderSpace)):(d.copy(a.startRenderSpace,b.endRenderSpace),d.copy(a.endRenderSpace,e.endRenderSpace));return a};f.dimensionStartToEnd=H;f.directStartToEnd=function(a,
c){const {startRenderSpace:b,endRenderSpace:e}=c.directSegment;return d.sub(a,e,b)};f.directUp=function(a,c,b){c=c.directSegment.eval(.5,n.sv3d.get());return b.worldUpAtPosition(c,a)};f.headingFromGeometry=function(a,c){const b=a.directSegment.eval(.5,n.sv3d.get());return c.headingAtPosition(b,a.primaryOffsetAxis)};f.isGeodesicDimension=function(a){const {elevationAlignedStartPoint:c,elevationAlignedEndPoint:b}=a;if(m.isNone(c)||m.isNone(b))return!1;a=E.euclideanDirectDistanceBetweenPoints(c,b);return m.isSome(a)&&
1E5<B.toUnit(a,"meters").value};f.isValidComputation=function(a){return m.isSome(a.geometry)};f.maxScreenLengthSquaredFromGeometry=function(a,c){return d.squaredLength(H(P,a))/c**2};f.offsetSegment=function(a,c,b,e){d.scaleAndAdd(a.startRenderSpace,c.startRenderSpace,b,e);d.scaleAndAdd(a.endRenderSpace,c.endRenderSpace,b,e)};Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});