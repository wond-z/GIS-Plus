// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(y,z,k,v,w,q,C,D,E,A,x){function B(t){return t.isVisible?t.parameters.transparent?x.Transparency.TRANSPARENT:x.Transparency.OPAQUE:x.Transparency.INVISIBLE}
let G=function(){function t(a,b,c,f,l,d,h,m=null){this.graphics3DSymbolLayer=a;this.stageObject=b;this._uniqueGeometries=c;this._uniqueMaterials=f;this._sharedResource=l;this.elevationAligner=d;this.elevationContext=h;this._edgeState=m;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.stageObject=b}var g=t.prototype;g.initialize=
function(a,b){this._stageLayer=b;this._stage=a;a.addMany(this._uniqueMaterials);a.addMany(this._uniqueGeometries);a.add(this.stageObject)};g.destroy=function(){var a=this._stage;this._stageLayer&&(a.removeMany(this._uniqueMaterials),a.removeMany(this._uniqueGeometries));a.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);a=this._stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();
k.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};g.layerOpacityChanged=function(a,b){if(!k.isNone(this._edgeState)){var c=B(this._edgeState.baseMaterial),f=!1;for(const l of this._edgeState.edgeMaterials)l.objectTransparency!==c&&(l.objectTransparency=c,f=!0);f&&this._resetEdgeObject(b);this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};g.slicePlaneEnabledChanged=function(a,b){k.isNone(this._edgeState)||
(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:a},!b),this._edgeState.properties.hasSlicePlane=a)};g.setVisibility=function(a){if(null!=this._stage&&this._visible!==a&&((this._visible=a)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),k.isSome(this._edgeState))){const b=this._stage.renderView.ensureEdgeView();b.hasObject(this.stageObject)?
b.updateObjectVisibility(this.stageObject,a):a&&this._addOrUpdateEdgeObject(b,!1)}};g.alignWithElevation=function(a,b,c,f){null!=this.elevationAligner&&(k.isSome(c)&&D.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,a,b),this._resetEdgeObject(f))};g.getCenterObjectSpace=function(a=w.create()){return v.copy(a,C.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};g.getBoundingBoxObjectSpace=
function(a=q.create()){const b=this.stageObject.boundingVolumeObjectSpace;q.setMin(a,b.min);q.setMax(a,b.max);return a};g.computeAttachmentOrigin=function(a){if(this.useObjectOriginAsAttachmentOrigin){var b=this.stageObject.transformation;a.render.origin[0]+=b[12];a.render.origin[1]+=b[13];a.render.origin[2]+=b[14];a.render.num++}else for(b of this.stageObject.geometryRecords)b.computeAttachmentOrigin(n)&&(v.transformMat4(n,n,this.stageObject.transformation),v.add(a.render.origin,a.render.origin,
n),a.render.num++)};g.getProjectedBoundingBox=function(){var a=z._asyncToGenerator(function*(b,c,f,l,d){d=this.getBoundingBoxObjectSpace(d);var h=F,m=q.isPoint(d)?1:h.length;for(var e=0;e<m;e++){const u=h[e];p[0]=d[u[0]];p[1]=d[u[1]];p[2]=d[u[2]];v.transformMat4(p,p,this.stageObject.transformation);r[3*e]=p[0];r[3*e+1]=p[1];r[3*e+2]=p[2]}if(!b(r,0,m))return null;q.empty(d);b=null;this.calculateRelativeScreenBounds&&(b=this.calculateRelativeScreenBounds());for(h=0;h<3*m;h+=3){for(e=0;3>e;e++)d[e]=
Math.min(d[e],r[h+e]),d[e+3]=Math.max(d[e+3],r[h+e]);b&&f.push({location:r.slice(h,h+3),screenSpaceBoundingRect:b})}if(c&&c.service&&"absolute-height"!==this.elevationContext.mode){q.center(d,n);f="relative-to-scene"===this.elevationContext.mode?"scene":"ground";m=0;if(c.useViewElevation)m=k.unwrapOr(c.service.getElevation(n[0],n[1],f),0);else try{const u=E.demResolutionForBoundingBox(d,c.service.spatialReference,c);m=k.unwrapOr(yield c.service.queryElevation(n[0],n[1],l,u,f),0)}catch(u){}q.offset(d,
0,0,-this.alignedSampledElevation+m)}return d});return function(b,c,f,l,d){return a.apply(this,arguments)}}();g.addObjectState=function(a,b){a===A.Object3DState.Highlight&&b.addObject(this.stageObject,this.stageObject.highlight());a===A.Object3DState.MaskOccludee&&b.addObject(this.stageObject,this.stageObject.maskOccludee())};g.removeObjectState=function(a){a.removeObject(this.stageObject)};g._resetEdgeObject=function(a){if(!k.isNone(this._edgeState)){var b=this._stage.renderView.ensureEdgeView();
this._visible?this._addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};g._addOrUpdateEdgeObject=function(a,b){const c=this._edgeState;if(!k.isNone(c)){var f=B(c.baseMaterial);for(const l of c.edgeMaterials)l.objectTransparency=f;a.addOrUpdateObject3D(this.stageObject,c.edgeMaterials,c.properties,!b).then(()=>this._stageLayer?.sync())}};z._createClass(t,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",
get:function(){return this._visible}}]);return t}();const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=w.create(),n=w.create(),F=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];y.Graphics3DObject3DGraphicLayer=G;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});