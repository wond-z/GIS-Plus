// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(w,u,F,f,G,x,y,z,k,t,p,H,I,J,v,K,L,r,A,B,C,D,M,E,N,O,P,Q){const R=["polyline","polygon","extent"];v=function(m){function n(a,b,c,g){a=m.call(this,a,b,c,g)||this;a._needsUV=!1;a._hasOutline=!1;return a}u._inheritsLoose(n,m);var d=n.prototype;d.doLoad=function(){var a=u._asyncToGenerator(function*(){});return function(){return a.apply(this,arguments)}}();d._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};d._ensureFillMaterial=function(){if(!f.isSome(this._material)){var a=
f.get(this.symbolLayer,"material","color");a=this._getCombinedOpacityAndColor(a);this._material=A.createMaterial(this.symbolLayer,{color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof P.PatternMaterial;this._context.stage.add(this._material)}};d._ensureOutlineMaterial=function(){const a=this.symbolLayer.outline;!f.isSome(this._outlineMaterial)&&
this._isValidOutline(a)&&(this._hasOutline=!0,this._outlineMaterial=(b=>{const c=O.getStipplePatternForLinePattern(a.pattern);return new Q.RibbonLineMaterial({width:b,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleScaleWithLineWidth:!0,cap:L.parseCapType(a.patternCap||"butt")})})(G.pt2px(a.size)),this._context.stage.add(this._outlineMaterial))};d._isValidOutline=function(a){return f.isSome(a)&&a.size&&0<a.size&&f.isSome(a.color)&&
(f.isNone(a.pattern)||"style"!==a.pattern.type||"none"!==a.pattern.style)};d.destroy=function(){m.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};d.createGraphics3DGraphic=function(a){const b=a.graphic;if(!this._validateGeometry(b.geometry,R,this.symbolLayer.type))return null;a=this._getVertexOpacityAndColor(a.renderingInfo,255);const c=this.setGraphicElevationContext(b,new H.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===c.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(b,a):this._createAs3DShape(b,a,c)};d.layerOpacityChanged=function(){if(f.isSome(this._material)){var a=this._material.parameters.color,b=f.get(this.symbolLayer,"material","color");b=this._getCombinedOpacity(b);this._material.setParameters({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass})}f.isSome(this._outlineMaterial)&&(a=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}))};d.layerElevationInfoChanged=function(a,b,c){const g=this._elevationContext.mode;c=p.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,g);if(c!==p.SymbolUpdateType.UPDATE)return c;const e=p.needsElevationUpdates2D(g);return this.updateGraphics3DGraphicElevationInfo(a,b,()=>e)};d.slicePlaneEnabledChanged=function(){f.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
f.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};d.physicalBasedRenderingChanged=function(){return!0};d.pixelRatioChanged=function(){return!0};d._createAs3DShape=function(a,b,c){const g=r.geometryAsPolygon(a.geometry);if(f.isNone(g))return null;var e=D.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,c);b=new S(e,b,this._context.layer.uid,a.uid);e=b.renderData.position.length/3;this._needsUV&&
(b.uvMapSpace=new Float32Array(4*e),b.boundingRect=new Float64Array(9*e));b.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:b.graphicsUid,layerUid:b.layerUid});this._createAs3DShapeFill(b);this._hasOutline&&this._createAs3DShapeOutline(b);this._logGeometryCreationWarnings(b.renderData,g.rings,"rings","FillSymbol3DLayer");if(0===b.outGeometries.length)return null;this._needsUV&&B.createMapSpaceUVCoords(t.BufferViewVec4f.fromTypedArray(b.uvMapSpace),t.BufferViewVec3f64.fromTypedArray(b.renderData.position),
this._context.renderCoordsHelper,t.BufferViewMat3f64.fromTypedArray(b.boundingRect));a=new M.Object3D({geometries:b.outGeometries,materials:b.outMaterials,transformations:b.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:a.uid}});a=new J.Graphics3DObject3DGraphicLayer(this,a,b.outGeometries,null,null,A.uvElevationAligner,c);a.alignedSampledElevation=b.renderData.sampledElevation;a.needsElevationUpdates=p.needsElevationUpdates2D(c.mode);return a};d._createAs3DShapeFill=
function(a){var b=a.renderData.polygons;for(const {position:c,mapPosition:g,holeIndices:e,index:q,count:h}of b){if(f.isSome(this._context.clippingExtent)&&(k.empty(l),k.expandWithBuffer(l,g),!k.intersectsClippingArea(l,this._context.clippingExtent)))continue;b=x.earcut(g,e,3);0!==b.length&&(b=r.createColorGeometry({indices:b,attributeData:{position:c,color:a.color,mapPosition:g,uvMapSpace:this._needsUV?new Float32Array(a.uvMapSpace.buffer,4*q*a.uvMapSpace.BYTES_PER_ELEMENT,4*h):null,boundingRect:this._needsUV?
new Float64Array(a.boundingRect.buffer,9*q*a.boundingRect.BYTES_PER_ELEMENT,9*h):null,objectAndLayerIdColor:a.objectAndLayerIdColor}}),a.outGeometries.push(b),a.outMaterials.push(f.unwrap(this._material)),a.outTransforms.push(y.IDENTITY))}};d._createAs3DShapeOutline=function(a){if(this._hasOutline){var b=a.renderData.outlines;for(let c=0;c<b.length;++c){const {mapPosition:g,position:e}=b[c];if(f.isSome(this._context.clippingExtent)&&(k.empty(l),k.expandWithBuffer(l,g),!k.intersectsClippingArea(l,
this._context.clippingExtent)))continue;const q=C.createGeometry({overlayInfo:null,removeDuplicateStartEnd:!0,attributeData:{position:e,mapPosition:g}},a.objectAndLayerIdColor),h=q.vertexAttributes.get(N.VertexAttribute.POSITION);h.data===e&&(h.data=new Float64Array(e));a.outGeometries.push(q);a.outMaterials.push(f.unwrap(this._outlineMaterial));a.outTransforms.push(y.IDENTITY)}}};d._createAsOverlay=function(a,b){const c=r.geometryAsPolygon(a.geometry);if(f.isNone(c))return null;f.unwrap(this._material).renderPriority=
this._renderPriority+this._renderPriorityStep/2;f.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const g=D.geometryToRenderInfoDraped(c,this._context.overlaySR);a=new T(g,b,this._context.layer.uid,a.uid);b=a.renderData.position.length/3;this._needsUV&&(a.uvMapSpace=new Float32Array(4*b));a.outBoundingBox=k.empty();a.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:a.graphicsUid,layerUid:a.layerUid});this._createAsOverlayFill(a);
this._hasOutline&&this._createAsOverlayOutline(a);this._logGeometryCreationWarnings(a.renderData,c.rings,"rings","FillSymbol3DLayer");if(0===a.outGeometries.length)return null;this._needsUV&&B.createMapSpaceUVCoordsDraped(t.BufferViewVec4f.fromTypedArray(a.uvMapSpace),t.BufferViewVec3f64.fromTypedArray(a.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return new I(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)};d._createAsOverlayFill=
function(a){var b=a.renderData.polygons;for(const {position:c,holeIndices:g,index:e,count:q}of b){k.empty(l);k.expandWithBuffer(l,c);if(!k.intersectsClippingArea(l,this._context.clippingExtent))continue;b=x.earcut(c,g,3);if(0===b.length)continue;k.expandWithAABB(a.outBoundingBox,l);b=r.createColorGeometry({indices:b,attributeData:{position:c,color:a.color,uvMapSpace:this._needsUV?new Float32Array(a.uvMapSpace.buffer,4*e*a.uvMapSpace.BYTES_PER_ELEMENT,4*q):null,objectAndLayerIdColor:a.objectAndLayerIdColor}});
b=new E.RenderGeometry(b,f.unwrap(this._material),{layerUid:a.layerUid,graphicUid:a.graphicsUid});const h=l;z.set(b.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1])));a.outGeometries.push(b)}};d._createAsOverlayOutline=function(a){if(this._hasOutline){var b=a.renderData.outlines;for(let g=0;g<b.length;++g){var {position:c}=b[g];k.empty(l);k.expandWithBuffer(l,c);if(!k.intersectsClippingArea(l,this._context.clippingExtent))continue;k.expandWithAABB(a.outBoundingBox,
l);c=C.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:c}},a.objectAndLayerIdColor);c=new E.RenderGeometry(c,f.unwrap(this._outlineMaterial),{layerUid:a.layerUid,graphicUid:a.graphicsUid});const e=l;z.set(c.boundingSphere,.5*(e[0]+e[3]),.5*(e[1]+e[4]),0,.5*Math.sqrt((e[3]-e[0])*(e[3]-e[0])+(e[4]-e[1])*(e[4]-e[1])));a.outGeometries.push(c)}}};d._getOutlineOpacity=function(){const a=
f.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(f.isSome(a)?a.a:0)};d._getOutlineColor=function(){const a=f.get(this.symbolLayer,"outline","color"),b=this._getOutlineOpacity();return K.mixinColorAndOpacity(f.isSome(a)?F.toUnitRGB(a):null,b)};d.test=function(){return{...m.prototype.test.call(this),createAsOverlay:(a,b)=>this._createAsOverlay(a,b),createAs3DShape:(a,b,c)=>this._createAs3DShape(a,b,c)}};return n}(v.Graphics3DSymbolLayer);v.elevationModeChangeTypes=
{definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};const l=k.create();let S=function(m){function n(d,a,b,c){d=m.call(this,d,b,c)||this;d.color=a;return d}u._inheritsLoose(n,m);return n}(r.PolygonCreationDataBase),T=function(m){function n(d,a,b,c){d=m.call(this,d,b,c)||this;d.color=a;return d}u._inheritsLoose(n,m);return n}(r.PolygonCreationDataBase);w.Graphics3DPolygonFillSymbolLayer=v;Object.defineProperties(w,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});