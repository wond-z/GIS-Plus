// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),function(q,u,y,v,z,k,A,B,r,C,D,t,E,F,G){function n(g,h){g=null!=g?h.attributes[g]:0;return null!=g&&isFinite(g)?g:0}function w(g){const h={color:!1,opacity:!1,
opacityAlwaysOpaque:!0,size:!1};g&&"visualVariables"in g&&g.visualVariables&&g.visualVariables.forEach(c=>{switch(c.type){case "color":h.color=!0;if(c.stops)for(let a=0;a<c.stops.length;a++){const b=c.stops[a].color;b&&(h.opacity=!0,1>b.a&&(h.opacityAlwaysOpaque=!1))}break;case "opacity":h.opacity=!0;h.opacityAlwaysOpaque=!1;break;case "size":h.size=!0}});return h}const m=z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");v=function(g){function h(a,b,d,f){var e=g.call(this,d.schedule)||
this;e._context=d;e._elevationInfoOverride=null;e._ignoreDrivers=!1;e._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};e.complexity=null;e.logger=m;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.symbol=a;e.symbolLayer=b;e._renderPriority=f.renderPriority;e._renderPriorityStep=f.renderPriorityStep;e._elevationContext=new C.ElevationContext;e.complexity=e.computeComplexity();e._ignoreDrivers=f.ignoreDrivers;e._ignoreDrivers||(e._drivenProperties=w(e._context.renderer));
e._updateElevationContext();return e}u._inheritsLoose(h,g);var c=h.prototype;c.getCachedSize=function(){return null};c._drivenPropertiesChanged=function(a){if(this._ignoreDrivers)return!1;const b=this._drivenProperties;a=w(a);return a.color!==b.color||a.opacity!==b.opacity||a.opacityAlwaysOpaque!==b.opacityAlwaysOpaque||a.size!==b.size};c._logGeometryCreationWarnings=function(a,b,d,f){const e="polygons"in a?a.polygons:null,l=`${f} geometry failed to be created`;let p=null;a.projectionSuccess?!this._logGeometryValidationWarnings(b,
d,f)&&e&&0===e.length&&"rings"===d&&0<b.length&&2<b[0].length&&(p=`${l} (filled rings should use clockwise winding - try reversing the order of vertices)`):p=`${l} (failed to project geometry to view spatial reference)`;p&&m.warnOncePerTick(p)};c._logGeometryValidationWarnings=function(a,b,d){d=`${d} geometry failed to be created`;return!a.length||1===a.length&&!a[0].length?(m.warnOncePerTick(`${d} (no ${b} were defined)`),!0):Array.isArray(a)&&Array.isArray(a[0])?!1:(m.warnOncePerTick(`${d} (${b} should be defined as a 2D array)`),
!0)};c._validateGeometry=function(a,b=null,d=null){return k.isSome(b)&&!b.includes(a.type)?(this.logger.warn("unsupported geometry type for "+d+` symbol: ${a.type}`),!1):"point"!==a.type||isFinite(a.x)&&isFinite(a.y)?!0:(m.warn("point coordinate is not a valid number, graphic skipped"),!1)};c._defaultElevationInfoNoZ=function(){return H};c._defaultElevationInfoZ=function(){return I};c._updateElevationContext=function(){k.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};c.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};c.getGeometryElevationMode=function(a,b=this.getDefaultElevationInfo(a)){return this._elevationContext.mode||
b.mode};c.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};c.setGraphicElevationContext=function(a,b){var d=k.unwrap(a.geometry);const f=this.getDefaultElevationInfo(d);b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:f.unit;b.mode=this.getGeometryElevationMode(d,f);b.offsetMeters=k.unwrapOr(this._elevationContext.meterUnitOffset,k.unwrapOr(f.offset,0));if(d=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode=
"relative-to-ground",b.offsetMeters=0;b.updateFeatureExpressionInfoContext(d?D.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};c.prepareSymbolLayerPatch=function(a){};c.updateGeometry=function(a,b){return!1};c.onRemoveGraphic=function(a){};c._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const a=this._context.layer.opacity;return null==
a?1:a};c._getCombinedOpacity=function(a,b=x){let d=1;this.draped||(d*=this._getLayerOpacity());if(this._drivenProperties.opacity)return d;k.isSome(a)?d*=a.a:b.hasIntrinsicColor||(d=0);return d};c._getCombinedOpacityAndColor=function(a,b=x){b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return t.mixinColorAndOpacity(null,b);a=k.isSome(a)?y.toUnitRGB(a):A.ONES;return t.mixinColorAndOpacity(a,b)};c._getVertexOpacityAndColor=function(a,b=null){a=t.mixinColorAndOpacity(this._drivenProperties.color?
a.color:null,this._drivenProperties.opacity?a.opacity:null);k.isSome(b)&&(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b);return a};c.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};c.computeComplexity=function(){return G.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};c.globalPropertyChanged=function(a,b,d){switch(a){case "opacity":return this.layerOpacityChanged(b,d),!0;case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,
d,a)===r.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,d);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};c.updateGraphics3DGraphicElevationInfo=function(a,b,d){let f=r.SymbolUpdateType.UPDATE;a.forEach(e=>{const l=b(e);k.isSome(l)?(this.setGraphicElevationContext(e.graphic,l.elevationContext),l.needsElevationUpdates=d(l.elevationContext.mode)):f=
r.SymbolUpdateType.RECREATE});return f};c.applyRendererDiff=function(a,b){return E.ApplyRendererDiffResult.Recreate_Symbol};c.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;const b=this._fastUpdates.visualVariables,d=b.size?n(b.size.field,a):0,f=b.color?n(b.color.field,a):0;a=b.opacity?n(b.opacity.field,a):0;return B.fromValues(d,f,a,0)};c.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&m.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};c.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables?.size?.field??null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null})}};u._createClass(h,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return h}(F.Loadable);const H={mode:"on-the-ground",offset:0,unit:"meters"},I={mode:"absolute-height",offset:0,unit:"meters"},x={hasIntrinsicColor:!1};q.Graphics3DSymbolLayer=v;q.getAttributeValue=n;Object.defineProperties(q,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});