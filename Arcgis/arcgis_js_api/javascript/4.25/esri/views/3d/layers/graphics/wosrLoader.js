// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(x,y,S,J,T,U,V,w,K,L,M,B,W,t,X,Y,Z,N){function C(){C=y._asyncToGenerator(function*(a,b){a=yield aa(a,b);b=yield O(a.textureDefinitions,b);let c=0;for(const m in b)if(b.hasOwnProperty(m)){const h=b[m];c+=h?.image?h.image.width*h.image.height*4:0}return{resource:a,textures:b,size:c+T.estimateNestedObjectSize(a)}});return C.apply(this,arguments)}function aa(a,b){return D.apply(this,arguments)}function D(){D=y._asyncToGenerator(function*(a,b){const c=w.isSome(b)&&b.streamDataRequester;if(c)return ba(a,
c,b);a=yield J.result(S(a,w.unwrap(b)));if(!0===a.ok)return a.value.data;K.throwIfAbortError(a.error);P(a.error)});return D.apply(this,arguments)}function ba(a,b,c){return E.apply(this,arguments)}function E(){E=y._asyncToGenerator(function*(a,b,c){a=yield J.result(b.request(a,"json",c));if(!0===a.ok)return a.value;K.throwIfAbortError(a.error);P(a.error.details.url)});return E.apply(this,arguments)}function P(a){throw new U("",`Request for object resource failed: ${a}`);}function ca(a){const b=B.empty();
a.forEach(c=>{c=c.boundingInfo;w.isSome(c)&&(B.expandWithVec3(b,c.getBBMin()),B.expandWithVec3(b,c.getBBMax()))});return b}function O(a,b){return F.apply(this,arguments)}function F(){F=y._asyncToGenerator(function*(a,b){const c=[];for(const r in a){var m=a[r],h=m.images[0].data;if(!h){p.warn("Externally referenced texture data is not yet supported");continue}h=m.encoding+";base64,"+h;const u="/textureDefinitions/"+r,v="rgba"===m.channels?m.alphaChannelUsage||"transparency":"none",z={noUnpackFlip:!0,
wrap:{s:N.TextureWrapMode.REPEAT,t:N.TextureWrapMode.REPEAT},preMultiplyAlpha:Q(v)!==t.AlphaDiscardMode.Opaque};m=w.isSome(b)&&b.disableTextures?Promise.resolve(null):W.requestImage(h,b);c.push(m.then(G=>({refId:u,image:G,params:z,alphaChannelUsage:v})))}a=yield Promise.all(c);b={};for(const r of a)b[r.refId]=r;return b});return F.apply(this,arguments)}function Q(a){switch(a){case "mask":return t.AlphaDiscardMode.Mask;case "maskAndTransparency":return t.AlphaDiscardMode.MaskBlend;case "none":return t.AlphaDiscardMode.Opaque;
case "transparency":return t.AlphaDiscardMode.Blend;default:return t.AlphaDiscardMode.Blend}}const p=V.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),da=new L.Version(1,2,"wosr");x.createTextureResources=O;x.load=function(a,b){return C.apply(this,arguments)};x.processLoadResult=function(a,b){const c=[],m=[],h=[],r=[],u=a.resource;var v=L.Version.parse(u.version||"1.0","wosr");da.validate(v);v=u.model.name;const z=u.model.geometries,G=u.materialDefinitions;a=a.textures;let R=0;const H=
new Map;for(let I=0;I<z.length;I++){var d=z[I],g=d,f=g.params,n=f.topology,e=!0;f.vertexAttributes||(p.warn("Geometry must specify vertex attributes"),e=!1);switch(f.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:n=f.faces;if(!n)p.warn("Indexed geometries must specify faces"),e=!1;else if(f.vertexAttributes)for(const k in f.vertexAttributes)(f=n[k])&&f.values?(null!=f.valueType&&"UInt32"!==f.valueType&&(p.warn(`Unsupported indexed geometry indices type '${f.valueType}', only UInt32 is currently supported`),
e=!1),null!=f.valuesPerElement&&1!==f.valuesPerElement&&(p.warn(`Unsupported indexed geometry values per element '${f.valuesPerElement}', only 1 is currently supported`),e=!1)):(p.warn(`Indexed geometry does not specify face indices for '${k}' attribute`),e=!1);break;default:p.warn(`Unsupported topology '${n}'`),e=!1}g.params.material||(p.warn("Geometry requires material"),e=!1);g=g.params.vertexAttributes;for(const k in g)g[k].values||(p.warn("Geometries with externally defined attributes are not yet supported"),
e=!1);if(e){g=d.params;e=g.material;g=g.texture;n=d.params.vertexAttributes;f=[];for(const k in n){var q=n[k];f.push([k,{data:q.values,size:q.valuesPerElement,exclusive:!0}])}n=[];if("PerAttributeArray"!==d.params.topology){d=d.params.faces;for(const k in d)n.push([k,d[k].values])}if((d=a&&a[g])&&!H.has(g)){const {image:k,params:ea}=d;q=new Y.Texture(k,ea);r.push(q);H.set(g,q)}q=(q=H.get(g))?q.id:void 0;var l=h[e]?h[e][g]:null;if(!l){l=e.substring(e.lastIndexOf("/")+1);l=G[l].params;1===l.transparency&&
(l.transparency=0);var A=d&&d.alphaChannelUsage;A=0<l.transparency||"transparency"===A||"maskAndTransparency"===A;const k=d?Q(d.alphaChannelUsage):void 0;d={ambient:M.fromArray(l.diffuse),diffuse:M.fromArray(l.diffuse),opacity:1-(l.transparency||0),transparent:A,textureAlphaMode:k,textureAlphaCutoff:.33,textureId:q,initTextureTransparent:!0,doubleSided:!0,cullFace:t.CullFaceOptions.None,colorMixMode:l.externalColorMixMode||"tint",textureAlphaPremultiplied:d?!!d.params.preMultiplyAlpha:!1};w.isSome(b)&&
b.materialParamsMixin&&Object.assign(d,b.materialParamsMixin);l=new Z.DefaultMaterial(d);h[e]||(h[e]={});h[e][g]=l}m.push(l);e=new X.Geometry(f,n);R+=n.position?n.position.length:0;c.push(e)}}return{engineResources:[{name:v,stageResources:{textures:r,materials:m,geometries:c},pivotOffset:u.model.pivotOffset,numberOfVertices:R,lodThreshold:null}],referenceBoundingBox:ca(c)}};Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});