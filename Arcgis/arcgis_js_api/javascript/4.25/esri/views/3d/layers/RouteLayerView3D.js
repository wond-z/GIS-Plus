// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/CollectionFlattener ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../rest/support/DirectionLine ../../../rest/support/DirectionPoint ../../../rest/support/PointBarrier ../../../rest/support/PolygonBarrier ../../../rest/support/PolylineBarrier ../../../rest/support/RouteInfo ../../../rest/support/Stop ./LayerView3D ./graphics/GraphicsProcessor ./support/projectExtentUtils ../support/EventedSet ../webgl-engine/lib/basicInterfaces ../../layers/LayerView".split(" "),
function(l,f,r,t,q,m,g,e,I,u,v,w,x,y,z,A,B,C,D,E,F,G,H){e=function(n){function p(){var a=n.apply(this,arguments)||this;a.type="route-3d";a.loadedGraphics=new F.EventedSet;a._byObjectID=new Map;a.slicePlaneEnabled=!1;a.fullExtentInLocalViewSpatialReference=null;return a}l._inheritsLoose(p,n);var c=p.prototype;c.initialize=function(){this._set("processor",new D.GraphicsProcessor({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0}));this.addResolvingPromise(this.processor.initializePromise);
this.updatingHandles.addOnCollectionChange(()=>this._routeItems,a=>this._routeItemsChanged(a),m.initial);this.addResolvingPromise(E.toViewIfLocal(this).then(a=>this.fullExtentInLocalViewSpatialReference=a));this.handles.add(m.when(()=>this.view?.basemapTerrain?.ready,()=>()=>this.notifyChange("updating"),{once:!0}))};c.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("processor",q.destroyMaybe(this.processor));this._get("_routeItems")?.destroy()};c._routeItemsChanged=
function(a){if(a.removed.length){this.loadedGraphics.removeMany(a.removed.map(b=>{const d=this._byObjectID.get(b);this._byObjectID.delete(b);return d}));for(const b of a.removed)this.handles.remove(b)}if(a.added.length){this.loadedGraphics.addMany(a.added.map(b=>{const d=b.toGraphic();this._byObjectID.set(b,d);return d}));for(const b of a.added)this.handles.add([m.watch(()=>b.geometry,(d,h)=>{this._updateGraphic(b,"geometry",d,h)}),m.watch(()=>b.symbol,(d,h)=>{this._updateGraphic(b,"symbol",d,h)})],
b)}};c.getSuspendInfo=function(){const a=n.prototype.getSuspendInfo.call(this);a.outsideScaleRange=this.processor?.scaleVisibilitySuspended??!1;a.outsideOfView=this.processor?.frustumVisibilitySuspended??!1;return a};c.fetchPopupFeatures=function(){var a=l._asyncToGenerator(function*(b,d){return q.isSome(d)?d.clientGraphics:null});return function(b,d){return a.apply(this,arguments)}}();c.getHit=function(a){return this.processor.getHit(a)};c.whenGraphicBounds=function(a,b){return this.processor.whenGraphicBounds(a,
b)};c.computeAttachmentOrigin=function(a,b){return this.processor?.computeAttachmentOrigin(a,b)};c.getSymbolLayerSize=function(a,b){return this.processor.getSymbolLayerSize(a,b)};c.queryGraphics=function(){var a=l._asyncToGenerator(function*(){return new r(this.loadedGraphics.toArray())});return function(){return a.apply(this,arguments)}}();c.maskOccludee=function(a){return this.processor.maskOccludee(a)};c.highlight=function(a){return a instanceof v||a instanceof w||a instanceof x||a instanceof y||
a instanceof z||a instanceof A||a instanceof B?(a=this._byObjectID.get(a),this.processor.highlight(a)):this.processor.highlight(a)};c.canResume=function(){return n.prototype.canResume.call(this)&&!this.processor?.scaleVisibilitySuspended};c.isUpdating=function(){return!(!this.processor?.updating&&this.view?.basemapTerrain?.ready)};c._updateGraphic=function(a,b,d,h){a=this._byObjectID.get(a);a[b]=d;k.graphic=a;k.property=b;k.oldValue=h;k.newValue=d;this.processor?.graphicsCore.graphicUpdateHandler(k)};
l._createClass(p,[{key:"_routeItems",get:function(){return new t({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.stops,this.layer.directionLines,this.layer.directionPoints,q.isSome(this.layer.routeInfo)?new r([this.layer.routeInfo]):null]})}},{key:"legendEnabled",get:function(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}},{key:"updatePolicy",get:function(){return this.processor?.graphicsCore.effectiveUpdatePolicy||
G.UpdatePolicy.SYNC}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.processor?.elevationAlignment.updating??!1,visibilityFrustum:!this.processor?.frustumVisibilitySuspended}}}]);return p}(C.LayerView3D(H));f.__decorate([g.property()],e.prototype,"_routeItems",null);f.__decorate([g.property()],e.prototype,"loadedGraphics",void 0);f.__decorate([g.property({readOnly:!0})],
e.prototype,"legendEnabled",null);f.__decorate([g.property()],e.prototype,"layer",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"processor",void 0);f.__decorate([g.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);e=f.__decorate([u.subclass("esri.views.3d.layers.RouteLayerView3D")],e);const k={graphic:null,property:null,oldValue:null,newValue:null};return e});