// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(f,h,g,k,l){let n=function(){function c(a){this._capabilities=this._memoryCache=null;const b=a.layerView.layer;this._layerView=a.layerView;this.objectIdField=b.objectIdField;this.globalIdField="globalIdField"in b?b.globalIdField:null;this._returnZ=a.returnZ;this._returnM=a.returnM;const d=this._layerView.view.resourceController;this.query=l.createFeatureTileQuery3D(b,
m=>d.schedule(m));d&&this._memoryCacheEnabled&&(this._memoryCache=d.memoryController.newCache(b.uid))}var e=c.prototype;e.destroy=function(){this._memoryCache=g.destroyMaybe(this._memoryCache);this.query.destroy()};e.createQuery=function(){const a=this._layerView.layer.createQuery();a.outFields=this._layerView.availableFields;a.returnZ=this._returnZ;a.returnM=this._returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a};e.logFetchError=function(a,b){a.error("#fetchTile()",this._layerView.layer,
b&&b.message?b.message:b)};h._createClass(c,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",
get:function(){const a=this._layerView.view.resourceController;return a?a.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return g.isSome(this._capabilities)?
this._capabilities:this._capabilities=k.contextCapabilitiesFromLayer(this._layerView.layer)}}]);return c}();f.FeatureTileFetcher3DLayerViewContext=n;Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});