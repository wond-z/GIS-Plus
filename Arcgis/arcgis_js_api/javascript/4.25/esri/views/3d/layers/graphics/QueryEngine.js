// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(e,g,h,F,r,n,k,G,H,t,u,v,p,w,x){const y=v.QueryEngine;e.QueryEngine=function(q){function m(b){b=q.call(this,b)||this;b._dataQueryEngineInstance=null;return b}g._inheritsLoose(m,q);var f=m.prototype;f.destroy=function(){this.clear()};f.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};f.executeQueryForIdSet=function(){var b=g._asyncToGenerator(function*(a,c,d){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a,
c),d)});return function(a,c,d){return b.apply(this,arguments)}}();f.executeQueryForCount=function(){var b=g._asyncToGenerator(function*(a,c){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();f.executeQueryForExtent=function(){var b=g._asyncToGenerator(function*(a,c){const {count:d,extent:l}=yield this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),c);a=u.fromJSON(l);return{count:d,extent:a}});return function(a,
c){return b.apply(this,arguments)}}();f.executeQueryForIds=function(){var b=g._asyncToGenerator(function*(a,c){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();f.executeQueryForLatestObservations=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),c);a=p.fromJSON(a);a.features.forEach(d=>{d.layer=this.layer;d.sourceLayer=this.layer});
return a});return function(a,c){return b.apply(this,arguments)}}();f.executeQuery=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this._dataQueryEngine.executeQuery(this._ensureQueryJSON(a),c);a=p.fromJSON(a);a.features.forEach(d=>{d.layer=this.layer;d.sourceLayer=this.layer});return a});return function(a,c){return b.apply(this,arguments)}}();f._ensureQueryJSON=function(b,a){let c=this.defaultQueryJSON;n.isSome(b)&&("outSpatialReference"in b&&!b.outSpatialReference&&(b.outSpatialReference=
this.spatialReference),c=b.toJSON());n.isSome(a)&&(b=a.geometries.map(d=>d.toJSON()).reduce((d,l)=>{d.rings=d.rings.concat(l.rings);return d}),c={...c,sceneFilter:{...a,geometry:b}});return c};f._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const b="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,a=this.layer.objectIdField,c=x.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),d=this.layer.fields.map(z=>
z.toJSON()),l=this.priority,A=this.spatialReference.toJSON(),{hasZ:B,hasM:C,featureStore:D,scheduler:E}=this.context;return this._dataQueryEngineInstance=new y({hasZ:B,hasM:C,geometryType:c,fields:d,timeInfo:b,spatialReference:A,objectIdField:a,featureStore:D,scheduler:E,priority:l})};g._createClass(m,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return m}(r);h.__decorate([k.property({constructOnly:!0})],e.QueryEngine.prototype,"context",void 0);h.__decorate([k.property({constructOnly:!0})],e.QueryEngine.prototype,"priority",void 0);h.__decorate([k.property()],e.QueryEngine.prototype,"layer",null);h.__decorate([k.property()],
e.QueryEngine.prototype,"spatialReference",null);h.__decorate([k.property()],e.QueryEngine.prototype,"_queryGeometryType",null);h.__decorate([k.property()],e.QueryEngine.prototype,"defaultQueryJSON",null);e.QueryEngine=h.__decorate([t.subclass("esri.views.3d.layers.graphics.QueryEngine")],e.QueryEngine);Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});