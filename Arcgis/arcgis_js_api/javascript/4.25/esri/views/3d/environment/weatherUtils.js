// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsCompositionParameters ./CloudsData ./weather ../../support/RenderState".split(" "),function(w,t,y,h,x,z,u,v,b,d,n,E){function A(a,p,g,e){const f=a.fadeInOutHeight,q=f.stage===b.FadeHeightStages.FINISHED?g:a.startTimeHeightFade;0!==e?(e=(g-q)/(1*e),f.factor+=p?-e:e):f.factor=p?0:1;a.startTimeHeightFade=
g;f.factor=t.clamp(f.factor,0,1);f.stage=b.FadeHeightStages.HEIGHT_FADE}const B=x.fromValues(0,0,1),r=u.create(),l=x.create(),F=x.create();w.updateWeatherFading=function(a,p,g,e,f){a.renderingStage===d.CloudsRenderingStages.FINISHED_RENDERING&&(a.renderingStage=d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS);const q=h.length(p.eye);0>a.fadeInOutHeight.factor&&(a.fadeInOutHeight.factor=q-v.earth.radius>n.weatherHeightLimit?1:0);a.isCameraPositionFinal=h.equals(a.cameraPositionLastFrame,p.eye);h.normalize(l,
p.eye);h.scale(l,l,v.earth.radius);const k=a.parallax;0===k.anchorPointClouds[0]&&0===k.anchorPointClouds[1]&&0===k.anchorPointClouds[2]&&h.copy(k.anchorPointClouds,l);var m=h.length(h.subtract(F,k.anchorPointClouds,l));let C=!0;if(m>a.fadeIn.distanceThresholdFactor*k.cloudsHeight||a.fadeIn.stage!==b.FadeInStages.FINISHED)g=a.parallax.anchorPointClouds,a.fadeIn.stage===b.FadeInStages.FINISHED&&(a.fadeIn.factor=0,h.copy(g,l),a.fadeIn.stage=b.FadeInStages.CHANGE_ANCHOR,a.crossFade.enabled=!1,a.fadeInOut.stage=
b.FadeInOutStages.FINISHED),a.fadeIn.stage===b.FadeInStages.CHANGE_ANCHOR&&a.isCameraPositionFinal&&(d.ensureClouds(a.data)&&a.renderingStage!==d.CloudsRenderingStages.RENDERING||a.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(h.copy(g,l),a.fadeIn.stage=b.FadeInStages.FADE_IN,a.startTime=e,a.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(a.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS)),1>a.fadeIn.factor&&a.fadeIn.stage===b.FadeInStages.FADE_IN?a.fadeIn.factor=
f?t.clamp((e-a.startTime)/(1*f),0,1):1:1<=a.fadeIn.factor&&a.fadeIn.stage===b.FadeInStages.FADE_IN&&(a.fadeIn.stage=b.FadeInStages.FINISHED,a.fadeIn.factor=1);else if(m>a.fadeInOut.distanceThresholdFactor*k.cloudsHeight||a.fadeInOut.stage!==b.FadeInOutStages.FINISHED){{const {fadeInOut:c,crossFade:D}=a;c.stage===b.FadeInOutStages.FINISHED&&(a.startTime=e,c.factor=1,c.stage=b.FadeInOutStages.FADE_OUT);0<c.factor&&c.stage===b.FadeInOutStages.FADE_OUT?c.factor=f?1-t.clamp((e-a.startTime)/(.5*f),0,1):
0:(0>=c.factor&&c.stage===b.FadeInOutStages.FADE_OUT&&(c.factor=0,h.copy(a.parallax.anchorPointClouds,l)),0>=c.factor&&c.stage===b.FadeInOutStages.FADE_OUT&&a.isCameraPositionFinal&&(c.factor=0,c.stage=b.FadeInOutStages.SWITCH,a.crossFade.enabled=!1,D.factor=1),c.stage===b.FadeInOutStages.SWITCH&&(d.ensureClouds(a.data)&&a.renderingStage!==d.CloudsRenderingStages.RENDERING||a.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(a.startTime=e,c.factor=0,c.stage=b.FadeInOutStages.FADE_IN,
h.copy(a.parallax.anchorPointClouds,l),a.crossFade.enabled=!1,D.factor=1,a.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(a.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS)),1>c.factor&&c.stage===b.FadeInOutStages.FADE_IN?c.factor=f?t.clamp((e-a.startTime)/(1*f),0,1):1:1<=c.factor&&c.stage===b.FadeInOutStages.FADE_IN&&(c.stage=b.FadeInOutStages.FINISHED,c.factor=1))}}else if(m>a.crossFade.distanceThresholdFactor*k.cloudsHeight||a.crossFade.enabled||a.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS){g=
(g!==E.RenderState.IDLE||!d.ensureClouds(a.data))&&a.renderingStage!==d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS;{({crossFade:m}=a);const c=a.parallax.anchorPointClouds;if(!a.crossFade.enabled||g)h.copy(a.parallaxNew.anchorPointClouds,l),a.startTime=e,m.factor=0,a.crossFade.enabled=!0;1>m.factor&&a.crossFade.enabled?m.factor=f?t.clamp((e-a.startTime)/(1.3*f),0,1):1:1<=m.factor&&a.crossFade.enabled&&(a.crossFade.enabled=!1,m.factor=1,h.copy(c,a.parallaxNew.anchorPointClouds),a.renderingStage===
d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(a.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS))}}else C=!1;g=q-v.earth.radius;(g>1.7*n.weatherHeightLimit||g<-n.weatherHeightLimit)&&1>a.fadeInOutHeight.factor?a.fadeInOutHeight.factor=1:(g>n.weatherHeightLimit||g<-.35*n.weatherHeightLimit)&&1>a.fadeInOutHeight.factor?A(a,!1,e,f):g<n.weatherHeightLimit&&g>-.35*n.weatherHeightLimit&&0<a.fadeInOutHeight.factor?A(a,!0,e,f):a.fadeInOutHeight.stage=b.FadeHeightStages.FINISHED;a.renderingStage===
d.CloudsRenderingStages.SWITCH_CHANNELS&&(a.readChannels=1-a.readChannels,a.renderingStage=d.CloudsRenderingStages.FINISHED);k.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(q*q-v.earth.radius*v.earth.radius,0))/q;u.fromPoints(B,k.anchorPointClouds,r);y.rotate(k.transform,z.IDENTITY,r[3],u.axis(r));C&&({parallaxNew:e}=a,u.fromPoints(B,e.anchorPointClouds,r),y.rotate(e.transform,z.IDENTITY,r[3],u.axis(r)));h.copy(a.cameraPositionLastFrame,p.eye)};w.weatherfadingNeedsRender=function(a){return a.crossFade.enabled||
a.fadeInOut.stage!==b.FadeInOutStages.FINISHED||a.fadeIn.stage!==b.FadeInStages.FINISHED||a.fadeInOutHeight.stage!==b.FadeHeightStages.FINISHED||a.renderingStage!==d.CloudsRenderingStages.FINISHED};Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});