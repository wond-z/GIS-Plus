// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/colorUtils ../../../../../core/Evented ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../dragEventPipeline3D ../ManipulatorType ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(B,C,K,L,M,N,y,O,m,q,P,v,Q,D,l,z,A,R,E,F,G,n){A=function(H){function w(a){var b=H.call(this)||this;b._radius=z.DISC_RADIUS;b.events=new L;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulator();b.forEachManipulator(e=>b._tool.manipulators.add(e));return b}C._inheritsLoose(w,H);var r=w.prototype;r.destroy=function(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()})};r.forEachManipulator=function(a){a(this._manipulator,D.ManipulatorType.TRANSLATE_Z)};
r.createGraphicDragPipeline=function(a,b,e){const d=N.unwrap(b.graphic.geometry).spatialReference;return R.createGraphicMoveDragPipeline(b,e,f=>this.createDragPipeline((k,g,c,t,x)=>f(k,a(k,g,c,t,x),c),d),this._view.state.viewingMode)};r.createDragPipeline=function(a,b){const e=this._view;return G.createManipulatorDragEventPipeline(this._manipulator,(d,f,k,g,c)=>{f=f.next(t=>({...t,manipulatorType:D.ManipulatorType.TRANSLATE_Z})).next(Q.screenToZConstrained(e,d.renderLocation,b)).next(G.addScreenDelta());
a(d,f,k,g,c)})};r._updateManipulator=function(){var a=this._radius/z.DISC_RADIUS;const b=l.settings.zManipulator.height*a;var e=l.settings.zManipulator.coneHeight*a;const d=l.settings.zManipulator.coneWidth*a;a*=l.settings.zManipulator.width;var f=[q.fromValues(0,0,0),q.fromValues(0,0,b)];f=E.createTubeGeometry(f,a/2,16,!1);const k=E.createConeGeometry(e,d/2,16,!1);e=[q.fromValues(0,0,0),q.fromValues(0,0,b+e)];const g=(p=>{const h=O.create();y.translate(h,h,[0,0,b]);y.rotateX(h,h,Math.PI/2);p&&(p=
1+2*p/d,y.scale(h,h,[p,p,p]));return h})(0);var c=(p,h)=>{h=K.darken(l.settings.zManipulator.color,h);return[h.r/255,h.g/255,h.b/255,l.settings.zManipulator.color.a*p]};const t=v.createManipulatorMaterial(c(1,.25),F.RenderOccludedFlag.Occlude),x=v.createManipulatorMaterial(c(1,0),F.RenderOccludedFlag.Occlude),I=v.createManipulatorMaterial(c(.7,0),l.settings.zManipulator.renderOccluded);c=v.createManipulatorMaterial(c(.85,0),l.settings.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:k,
transform:g,material:t,stateMask:n.ManipulatorStateFlags.Unfocused},{geometry:f,material:t,stateMask:n.ManipulatorStateFlags.Unfocused},{geometry:k,transform:g,material:x,stateMask:n.ManipulatorStateFlags.Focused},{geometry:f,material:x,stateMask:n.ManipulatorStateFlags.Focused},{geometry:k,transform:g,material:I,stateMask:n.ManipulatorStateFlags.Unfocused},{geometry:f,material:I,stateMask:n.ManipulatorStateFlags.Unfocused},{geometry:k,transform:g,material:c,stateMask:n.ManipulatorStateFlags.Focused},
{geometry:f,material:c,stateMask:n.ManipulatorStateFlags.Focused}];this._manipulator.radius=a/2+2;this._manipulator.collisionType={type:"line",paths:[e]}};r._createManipulator=function(){const a=new P.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});a.applyObjectTransform=b=>{var e=this._view.state.camera,d=J;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,
d);const f=m.dist(e.eye,d),k=e.computeRenderPixelSizeAtDist(f);var g=m.subtract(u,d,e.eye);m.normalize(g,g);var c=S;this._view.renderCoordsHelper.worldUpAtPosition(J,c);d=Math.abs(m.dot(g,c));g=m.cross(u,g,c);c=m.cross(u,g,c);d=M.clamp(d,.01,1);e=1-Math.sqrt(1-d*d)/d/e.fullWidth;d=this._radius/z.DISC_RADIUS*l.settings.zManipulator.width;m.scale(c,m.normalize(c,c),(1/e-1)*f+k*d);b[12]-=u[0];b[13]-=u[1];b[14]-=u[2]};this._manipulator=a;this._updateManipulator()};C._createClass(w,[{key:"radius",get:function(){return this._radius},
set:function(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]);return w}(A.Manipulation);const J=q.create(),u=q.create(),S=q.create();B.MoveZManipulation=A;Object.defineProperties(B,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});