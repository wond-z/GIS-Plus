// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../geometry/support/clipRay ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/ray ./LaserlineVisualElement ./Object3DVisualElement ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(f,x,y,B,e,C,n,l,q,w,r,D,k,t,E,u,F,G,H,I){y=function(g){function v(a){var b=g.call(this,a)||this;b._ray=t.create();b._externalResources=null;b._handles=new B;b._isWorldDown=!1;b._start=l.create();b._end=l.fromValues(1,0,0);b._width=1;b._color=w.fromValues(1,0,1,1);b._polygonOffset=!1;b._writeDepthEnabled=!0;b._innerWidth=0;b._innerColor=w.fromValues(1,1,1,1);b._stipplePattern=null;b._stippleOffColor=null;b._stipplePreferContinuous=!0;b._falloff=0;b._extensionType=f.ExtensionType.LINE;b._laserlineStyle=
null;b._laserlineEnabled=!1;b._renderOccluded=G.RenderOccludedFlag.OccludeAndTransparent;b._fadedExtensions=z;b.applyProps(a);return b}x._inheritsLoose(v,g);var h=v.prototype;h.createExternalResources=function(){const a=new I.RibbonLineMaterial(this.materialParameters);this._handles.add(C.watch(()=>this.view.state.camera,()=>{this._updateGeometry()}));const b=new E.LaserlineVisualElement({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:a,laserline:b}};h.destroyExternalResources=
function(){e.isSome(this._externalResources)&&this._externalResources.laserline.destroy();this._externalResources=null;this._handles.removeAll()};h.forEachExternalMaterial=function(a){e.isSome(this._externalResources)&&a(this._externalResources.material)};h.createGeometries=function(a){var b=[l.create(),l.create()],c=this.extensionType===f.ExtensionType.FADED;c&&b.push(l.create(),l.create());c=c?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null;b=F.createPolylineGeometry(b,null,c);a.addGeometry(b,
e.unwrap(this._externalResources).material);this._updateVertices(a)};h.updateVisibility=function(a){g.prototype.updateVisibility.call(this,a);e.isSome(this._externalResources)&&(this._externalResources.laserline.visible=a)};h.setStartEndFromWorldDownAtLocation=function(a){this._isWorldDown=!0;n.copy(this._start,a);this.view.renderCoordsHelper.worldUpAtPosition(a,this._end);n.subtract(this._end,a,this._end);t.fromPoints(this._start,this._end,this._ray);this._updateGeometry()};h._updateMaterial=function(){e.isNone(this._externalResources)||
this._externalResources.material.setParameters(this.materialParameters)};h._updateGeometry=function(){e.isSome(this.object)&&this._updateVertices(this.object)};h._updateVertices=function(a){const b=this._extensionType===f.ExtensionType.FADED?this._updateLineSegmentFinite(A):this._updateLineSegmentInfinite(this._extensionType,A);this._updateVertexAttributes(a,b);e.isSome(this._externalResources)&&(this._externalResources.laserline.intersectsLine=b)};h._updateLineSegmentFinite=function(a){return k.fromPoints(this._start,
this._end,a)};h._updateLineSegmentInfinite=function(a,b){var c=this.view.state.camera;r.fromRay(this._ray,m);switch(a){case f.ExtensionType.LINE:m.c0=-Number.MAX_VALUE;break;case f.ExtensionType.RAY:case f.ExtensionType.GROUND_RAY:var d=this._ray.origin;a=e.unwrapOr(this.view.elevationProvider.getElevation(d[0],d[1],d[2],this.view.renderCoordsHelper.spatialReference,"ground"),0);d=this.view.renderCoordsHelper.getAltitude(d);this._isWorldDown&&d<a&&n.negate(m.ray.direction,m.ray.direction);this._extensionType===
f.ExtensionType.GROUND_RAY&&null!=a&&(m.c1=Math.abs(d-a))}if(!D.intersectClipRay(c.frustum,m))return k.fromPoints(this._start,this._end,b);c=r.getStart(m,p);a=r.getEnd(m,J);return k.fromPoints(c,a,b)};h._updateVertexAttributes=function(a,b){const c=a.geometries[0].getMutableAttribute(H.VertexAttribute.POSITION).data;if(this.extensionType===f.ExtensionType.FADED){var d=k.pointAt(b,-this.fadedExtensions.start,p);c[0]=d[0];c[1]=d[1];c[2]=d[2];d=k.pointAt(b,0,p);c[3]=d[0];c[4]=d[1];c[5]=d[2];d=k.pointAt(b,
1,p);c[6]=d[0];c[7]=d[1];c[8]=d[2];b=k.pointAt(b,1+this.fadedExtensions.end,p);c[9]=b[0];c[10]=b[1];c[11]=b[2]}else d=k.pointAt(b,0,p),c[0]=d[0],c[1]=d[1],c[2]=d[2],b=k.pointAt(b,1,p),c[3]=b[0],c[4]=b[1],c[5]=b[2];a.geometryVertexAttrsUpdated(a.geometryRecords[0])};x._createClass(v,[{key:"start",get:function(){return this._start},set:function(a){this._isWorldDown=!1;n.exactEquals(this._start,a)||(n.copy(this._start,a),t.fromPoints(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",
get:function(){return this._end},set:function(a){this._isWorldDown=!1;n.exactEquals(this._end,a)||(n.copy(this._end,a),t.fromPoints(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(a){a!==this._width&&(this._width=a,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(a){q.exactEquals(a,this._color)||(q.copy(this._color,a),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},
set:function(a){a!==this._polygonOffset&&(this._polygonOffset=a,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(a){this._writeDepthEnabled!==a&&(this._writeDepthEnabled=a,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=a,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(a){q.exactEquals(a,this._innerColor)||
(q.copy(this._innerColor,a),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(a){const b=e.isSome(a)!==e.isSome(this._stipplePattern);this._stipplePattern=a;b?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(a){if(e.isNone(a)||e.isNone(this._stippleOffColor)||!q.exactEquals(a,this._stippleOffColor))this._stippleOffColor=e.isSome(a)?w.clone(a):null,this._updateMaterial()}},
{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(a){a!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=a,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(a){a!==this._falloff&&(this._falloff=a,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(a){a!==this._extensionType&&(this._extensionType=a,this._updateGeometry())}},{key:"_laserlineAttached",
get:function(){return this._laserlineEnabled&&e.isSome(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;e.isSome(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,e.isSome(a)&&(this._externalResources.laserline.style=a))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,e.isSome(this._externalResources)&&
(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(a){this._fadedExtensions=e.unwrapOr(a,z);this.recreateGeometry()}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,
stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}}]);return v}(u.Object3DVisualElement);const m=r.create(),p=l.create(),J=l.create(),A=k.create();f.ExtensionType=void 0;(function(g){g[g.LINE=0]="LINE";g[g.RAY=1]="RAY";g[g.GROUND_RAY=2]="GROUND_RAY";g[g.FADED=3]="FADED"})(f.ExtensionType||(f.ExtensionType={}));
u=1/3;const z={start:u,end:u};f.ExtendedLineVisualElement=y;Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});