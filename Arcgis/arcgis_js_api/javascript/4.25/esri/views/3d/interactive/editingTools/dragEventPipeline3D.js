// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../../../support/elevationInfoUtils ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../interactive/dragEventPipeline".split(" "),
function(h,k,p,m,q,v,t,I,J,w,x,y,K,z,A,L){function B(a,b){return C(a,()=>b)}function C(a,b){const c=q.create(),f=q.create();let g=!1;return e=>{const l=b(e);if("start"===e.action){var d=p.screenPointObjectToArray(e.screenStart,p.castScreenPointArray(w.sv2d.get()));d=y.fromScreen(a.state.camera,d,D);k.isSome(d)&&(g=t.intersectRay(l,d,c))}if(!g)return null;d=p.screenPointObjectToArray(e.screenEnd,p.castScreenPointArray(w.sv2d.get()));d=y.fromScreen(a.state.camera,d,D);return k.isNone(d)?null:t.intersectRay(l,
d,f)?{...e,renderStart:c,renderEnd:f,plane:l,ray:d}:null}}function M(a,b,c,f=null,g=null){let e=null;return l=>{if("start"===l.action&&(e=a.sceneIntersectionHelper.intersectElevationFromScreen(p.createScreenPointArray(l.screenStart.x,l.screenStart.y),b,c,g),k.isSome(e)&&k.isSome(f)&&!v.projectPoint(e,e,f))||k.isNone(e))return null;const d=a.sceneIntersectionHelper.intersectElevationFromScreen(p.createScreenPointArray(l.screenEnd.x,l.screenEnd.y),b,c,g);return k.isSome(d)?k.isSome(f)&&!v.projectPoint(d,
d,f)?null:{...l,mapStart:e,mapEnd:d}:null}}function E(a,b,c,f=null,g=null){b=x.getZForElevationMode(b,a,c);return M(a,c,b,f,g)}function F(a,b,c,f=null,g=null){return E(a,c,x.getGraphicEffectiveElevationInfo(b),f,g)}function N(a,b){const c=O,f=P,g=t.create();a.renderCoordsHelper.worldUpAtPosition(b,c);a=m.cross(g,c,m.subtract(f,b,a.state.camera.eye));m.cross(a,a,c);return t.fromPositionAndNormal(b,a,g)}function G(a,b){const c=q.create(),f=m.length(b);a.renderCoordsHelper.worldUpAtPosition(b,c);const g=
q.create(),e=q.create(),l=d=>{m.subtract(d,d,b);J.projectPoint(c,d,d);"global"===a.viewingMode&&m.length(d)*Math.sign(m.dot(c,d))<-f+.001&&m.subtract(d,m.scale(d,c,.001),b);m.add(d,d,b);return d};return d=>{d.renderStart=l(m.copy(g,d.renderStart));d.renderEnd=l(m.copy(e,d.renderEnd));return d}}function H(a,b){const c=a.renderCoordsHelper;return f=>{const g=c.fromRenderCoords(f.renderStart,b),e=c.fromRenderCoords(f.renderEnd,b);return k.isSome(g)&&k.isSome(e)?{...f,mapStart:g,mapEnd:e}:null}}h.SurfaceType=
void 0;(function(a){a[a.GROUND=0]="GROUND";a[a.OTHER=1]="OTHER"})(h.SurfaceType||(h.SurfaceType={}));const O=q.create(),P=q.create(),D=I.create();h.convertToMapCoordinates=H;h.hideManipulatorWhileDragging=function(a){let b=null;return c=>{switch(c.action){case "start":b=a.disableDisplay();break;case "end":case "cancel":k.isSome(b)&&(b.remove(),b=null)}return c}};h.projectToWorldUp=G;h.screenToMap3D=function(a,b=null){const c=K.newIntersector(a.state.viewingMode);c.options.selectionMode=!0;c.options.store=
z.StoreResults.MIN;c.options.hud=!1;const f=p.createScreenPointArray(),g={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},e=q.create(),l=k.unwrapOr(b,a.spatialReference),d=n=>{a.map.ground&&1>a.map.ground.opacity?g.exclude.add(A.TERRAIN_ID):g.exclude.delete(A.TERRAIN_ID);a.sceneIntersectionHelper.intersectIntersectorScreen(p.screenPointObjectToArray(n,f),c,g);n=c.results.min;if(n.getIntersectionPoint(e))n=n.intersector===z.IntersectorType.TERRAIN?h.SurfaceType.GROUND:h.SurfaceType.OTHER;
else if(c.results.ground.getIntersectionPoint(e))n=h.SurfaceType.GROUND;else return null;return{location:a.renderCoordsHelper.fromRenderCoords(e,l),surfaceType:n}};let u;return n=>{if("start"===n.action){var r=d(n.screenStart);u=k.isSome(r)?r.location:null}if(k.isNone(u))return null;r=d(n.screenEnd);return k.isSome(r)&&k.isSome(r.location)?{...n,mapStart:u,mapEnd:r.location,surfaceType:r.surfaceType}:null}};h.screenToMapXYAtLocation=E;h.screenToMapXYForGraphic=function(a,b,c,f){a=b.toMap(a.screenStart,
{include:[c]});return k.isSome(a)?F(b,c,a,f):null};h.screenToMapXYForGraphicAtLocation=F;h.screenToRenderPlane=B;h.screenToRenderPlaneFromEvent=function(a){return C(a,b=>b.plane)};h.screenToZConstrained=function(a,b,c){let f=null;const g=new L.EventPipeline;g.next(B(a,N(a,b))).next(G(a,b)).next(H(a,c)).next(e=>{e.mapEnd.x=e.mapStart.x;e.mapEnd.y=e.mapStart.y;f=e});return e=>{f=null;g.execute(e);return f}};Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});