// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/vectorStacks ../../../layers/graphics/hydratedFeatures ./Manipulator3D ../layers/graphics/graphicUtils ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Material ../webgl-engine/lib/VertexAttribute ../webgl-engine/materials/ColorMaterial ../webgl-engine/materials/ImageMaterial ../webgl-engine/materials/NativeLineMaterial ../webgl-engine/materials/RibbonLineMaterial ../webgl-engine/materials/ShadedColorMaterial ../../interactive/interfaces".split(" "),
function(e,q,I,l,w,r,h,J,z,K,x,L,y,t,u,A,M,N,O,P,m){function B(a,b=t.RenderOccludedFlag.OccludeAndTransparent,c=!0){const d=r.fromValues(a[0],a[1],a[2],3<a.length?a[3]:1);a=1>a[3];return c?new P.ShadedColorMaterial({color:d,transparent:a,writeDepth:!0,cullFace:x.CullFaceOptions.Back,renderOccluded:b}):new A.ColorMaterial({color:d,transparent:a,writeDepth:!0,cullFace:x.CullFaceOptions.Back,renderOccluded:b})}function C(a,b){const c=b.material??new M.ImageMaterial({transparent:!0,writeDepth:!1,textureId:b.texture?.id,
renderOccluded:t.RenderOccludedFlag.Opaque}),d=b.focusMultiplier??p.focusMultiplier,f=b.calloutLength??p.calloutLength,v=p.discRadius*(b.discScale??1),D=v*d,F=g=>{const E=[0,1,2,2,3,0];return new L.Geometry([[u.VertexAttribute.POSITION,{size:3,data:[f-g,-g,0,f+g,-g,0,f+g,g,0,f-g,g,0],exclusive:!0}],[u.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[u.VertexAttribute.POSITION,E],[u.VertexAttribute.UV0,E]])},Q=y.createPolylineGeometry([[0,0,0],[f-v,0,0]]),R=y.createPolylineGeometry([[0,0,0],
[f-D,0,0]]);var n=p.calloutColor,k=b.calloutWidth??p.calloutWidth;n=new (1<k?O.RibbonLineMaterial:N.NativeLineMaterial)({width:k,color:r.fromValues(n[0],n[1],n[2],b.calloutOpacity??1),renderOccluded:t.RenderOccludedFlag.OccludeAndTransparent});k=b.customStateMask??m.ManipulatorStateCustomFlags.None;a.collisionType={type:"disc",direction:[0,0,1],offset:[f,0,0]};a.focusMultiplier=d;a.metadata=b.metadata;a.radius=v;a.renderObjects=[{geometry:F(v),material:c,stateMask:m.ManipulatorStateFlags.Unfocused|
k},{geometry:Q,material:n,stateMask:m.ManipulatorStateFlags.Unfocused|k},{geometry:F(D),material:c,stateMask:m.ManipulatorStateFlags.Focused|k},{geometry:R,material:n,stateMask:m.ManipulatorStateFlags.Focused|k}]}function G(a,b,c,d){a=l.normalize(h.sv3d.get(),a);b=l.normalize(h.sv3d.get(),b);const f=l.cross(h.sv3d.get(),a,b);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=0;d[4]=b[0];d[5]=b[1];d[6]=b[2];d[7]=0;d[8]=f[0];d[9]=f[1];d[10]=f[2];d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d}function H(a,
b){const c=a.getViewForGraphic(b);return q.isSome(c)&&"computeAttachmentOrigin"in c?c.computeAttachmentOrigin(b,a.spatialReference):null}const p=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:w.fromValues(1,.5,0)});w=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});e.calculateInputRotationTransform=function(a,b,c,d){a=l.subtract(h.sv3d.get(),a,c);d=l.cross(h.sv3d.get(),d,a);c=G(a,d,c,h.sm4d.get());I.invert(c,c);b=l.transformMat4(h.sv3d.get(),
b,c);return Math.atan2(b[1],b[0])};e.calculateTranslateRotateFromBases=G;e.createManipulatorMaterial=B;e.createManipulatorOutlineMaterial=function(a,b=t.RenderOccludedFlag.OccludeAndTransparent){a=r.fromValues(a[0],a[1],a[2],4===a.length?a[3]:1);return new A.ColorMaterial({color:a,transparent:!0,writeDepth:!0,cullFace:x.CullFaceOptions.Front,renderOccluded:b})};e.createRotateManipulator=function(a,b){a=new z.Manipulator3D({view:a,autoScaleRenderObjects:!1,collisionPriority:1,metadata:b.metadata});
C(a,b);return a};e.createSphereManipulator=function(a,b,c,d=m.ManipulatorStateCustomFlags.None){return new z.Manipulator3D({view:a,renderObjects:[{geometry:y.createSphereGeometry(1,32,32),material:B(r.fromValues(b[0],b[1],b[2],null!=c?c:1)),stateMask:d}]})};e.getGraphicAttachmentOrigin=H;e.placeAtGraphic=function(a,b,c){a=H(a,c);q.isSome(a)?b.elevationAlignedLocation=a:(c=c.geometry,q.isNone(c)||(c="mesh"===c.type?c.anchor:K.computeCentroid(c),q.isNone(c)||(b.location=J.hydrateGeometry(c))))};e.updateRotateManipulator=
C;e.worldScaledManipulatorSettings=w;Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});