// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(y,r,p,v,t,k,q,z,A,B,w,G,C,D,x,u){w=function(m){function n(a={}){var b=m.call(this)||this;b.type=G.ContentObjectType.Object;
b._geometryRecords=[];b._geometries=[];b._objectTransformation=t.create();b._bvObjectSpace=new E;b._bvWorldSpace=new E;b._bvDirty=!0;b._hasVolatileTransformation=!1;b._visible=!0;b.castShadow=null!=a.castShadow?a.castShadow:!0;b.metadata=a.metadata;b.metadata&&b.metadata.isElevationSource&&(b.metadata.lastValidElevationBB=new F);const {geometries:c,materials:h,transformations:e,origins:g}=a;if(!Array.isArray(c))return r._assertThisInitialized(b);x.assert(h.length===c.length,"Object3D: materials don't match geometries");
x.assert(e.length===c.length,"Object3D: transformations don't match geometries");b._geometryRecords.length=c.length;b._geometries.length=c.length;for(a=0;a<c.length;a++)b._geometries[a]=c[a],b._geometryRecords[a]=C.GeometryRecord.pool.acquire(c[a],h[a],t.clone(e[a]),{highlights:null,occludees:null,visible:b._visible},g&&g[a]);return b}r._inheritsLoose(n,m);var f=n.prototype;f.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};f.addGeometry=function(a,b,c,h,e){c=c?c:t.IDENTITY;
this._geometries.push(a);a=C.GeometryRecord.pool.acquire(a,b,c,{highlights:null,occludees:null,visible:this._visible},h,e);this._geometryRecords.push(a);this._hasVolatileTransformation=this._hasVolatileTransformation||p.isSome(a.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:a});this._invalidateBoundingVolume();return a};f.removeGeometry=function(a){const b=this._geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=p.isSome(b.shaderTransformation)?this._geometryRecords.some(c=>
p.isSome(c.shaderTransformation)):this._hasVolatileTransformation;b.dispose();this._geometries.splice(a,1);this._emit("objectGeometryRemoved",{object:this,record:b});this._invalidateBoundingVolume();return b};f.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};f.geometryVertexAttrsUpdated=function(a){this._emit("vertexAttrsUpdated",{object:this,record:a});this._invalidateBoundingVolume()};f.setVisible=function(a){if(this._visible!==a){this._visible=a;for(const b of this._geometryRecords)b.instanceParameters.visible=
this._visible;this._emit("visibilityChanged",this)}};f.maskOccludee=function(){const a=new D.Object3DStateID(B.Object3DState.MaskOccludee);for(const b of this._geometryRecords)b.instanceParameters.occludees=u.addObject3DStateID(b.instanceParameters.occludees,a);this._emit("occlusionChanged",this);return a};f.removeOcclude=function(a){for(const b of this._geometryRecords)b.instanceParameters.occludees=u.removeObject3DStateID(b.instanceParameters.occludees,a);this._emit("occlusionChanged",this)};f.highlight=
function(){const a=new D.Object3DStateID(B.Object3DState.Highlight);for(const b of this._geometryRecords)b.instanceParameters.highlights=u.addObject3DStateID(b.instanceParameters.highlights,a);this._emit("highlightChanged",this);return a};f.removeHighlight=function(a){for(const b of this._geometryRecords)b.instanceParameters.highlights=u.removeObject3DStateID(b.instanceParameters.highlights,a);this._emit("highlightChanged",this)};f.getCombinedStaticTransformation=function(a,b){return v.multiply(b,
this.transformation,a.getStaticTransformation())};f._getCombinedShaderTransformation=function(a){return v.multiply(t.create(),this.transformation,a.getShaderTransformation())};f.hasVolativeTransformation=function(){return this._hasVolatileTransformation};f._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this._geometryRecords.length;++a){var b=this._geometryRecords[a],c=this._geometries[a].boundingInfo;
p.isSome(c)&&(this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,b.getShaderTransformation()),this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this._getCombinedShaderTransformation(b)))}k.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);k.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);a=q.create();b=q.create();c=A.maxScale(this.transformation);for(let d=0;d<this._geometryRecords.length;++d){var h=this._geometries[d].boundingInfo;
if(!p.isNone(h)){var e=this._geometryRecords[d].getShaderTransformation(),g=A.maxScale(e);k.transformMat4(a,h.getCenter(),e);e=k.distance(a,this._bvObjectSpace.bounds);h=h.getBSRadius()*g;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],e+h);k.transformMat4(b,a,this.transformation);g=k.distance(b,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],g+h*c)}}this._bvDirty=!1}};f._calculateTransformedBoundingVolume=function(a,b,c){const h=
a.getBBMin();a=a.getBBMax();const e=q.clone(h),g=q.clone(a);k.transformMat4(e,e,c);k.transformMat4(g,g,c);for(var d=0;3>d;++d)b.min[d]=Math.min(b.min[d],e[d],g[d]),b.max[d]=Math.max(b.max[d],e[d],g[d]);for(d=0;3>d;++d){k.copy(e,h);k.copy(g,a);e[d]=a[d];g[d]=h[d];k.transformMat4(e,e,c);k.transformMat4(g,g,c);for(let l=0;3>l;++l)b.min[l]=Math.min(b.min[l],e[l],g[l]),b.max[l]=Math.max(b.max[l],e[l],g[l])}};f._invalidateBoundingVolume=function(){this._bvDirty=!0;p.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,
this._bvWorldSpace.bounds)};f._emit=function(a,b){p.isSome(this._parentLayer)&&this._parentLayer.events.emit(a,b)};r._createClass(n,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(a){v.copy(this._objectTransformation,a);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},
set:function(a){x.assert(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const a=this;return{hasGeometry:b=>a._geometries.includes(b),getGeometryIndex:b=>
a._geometries.indexOf(b)}}}]);return n}(w.ContentObject);let F=function(){function m(){this.min=q.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=q.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}m.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return m}(),E=function(m){function n(){var f=m.apply(this,arguments)||this;f.bounds=z.create();return f}r._inheritsLoose(n,m);n.prototype.init=function(){k.set(this.min,
Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);k.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);z.clear(this.bounds)};return n}(F);y.Object3D=w;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});