// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(l,r,m,C,n,g,D,E){function t(){return u.apply(this,arguments)}function u(){u=r._asyncToGenerator(function*(){m.isNone(q)&&(q=C.getBasisTranscoder(),e=yield q);return q});return u.apply(this,arguments)}function x(a,c,d,b,f){c=E.getBytesPerElementFormat(c?g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:
g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(d*b*c*(f&&1<a?(4**a-1)/(3*4**(a-1)):1))}function y(a){return 1<=a.getNumImages()&&!a.isUASTC()}function z(a){return 1<=a.getFaces()&&a.isETC1S()}function v(){v=r._asyncToGenerator(function*(a,c,d){m.isNone(e)&&(e=yield t());const b=new e.BasisFile(new Uint8Array(d));if(!y(b))return null;b.startTranscoding();a=A(a,c,b.getNumLevels(0),b.getHasAlpha(),b.getImageWidth(0,0),b.getImageHeight(0,0),(f,h)=>b.getImageTranscodedSizeInBytes(0,f,
h),(f,h,k)=>b.transcodeImage(k,0,f,h,0,0));b.close();b.delete();return a});return v.apply(this,arguments)}function w(){w=r._asyncToGenerator(function*(a,c,d){m.isNone(e)&&(e=yield t());const b=new e.KTX2File(new Uint8Array(d));if(!z(b))return null;b.startTranscoding();a=A(a,c,b.getLevels(),b.getHasAlpha(),b.getWidth(),b.getHeight(),(f,h)=>b.getImageTranscodedSizeInBytes(f,0,0,h),(f,h,k)=>b.transcodeImage(k,f,0,0,h,0,-1,-1));b.close();b.delete();return a});return w.apply(this,arguments)}function A(a,
c,d,b,f,h,k,F){const {compressedTextureETC:G,compressedTextureS3TC:H}=a.capabilities,[B,I]=G?b?[n.TextureFormat.ETC2_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[n.TextureFormat.ETC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:H?b?[n.TextureFormat.BC3_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[n.TextureFormat.BC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[n.TextureFormat.RGBA32,g.PixelFormat.RGBA];b=c.hasMipmap?d:Math.min(1,d);d=[];for(let p=
0;p<b;p++)d.push(new Uint8Array(k(p,B))),F(p,B,d[p]);k=1<d.length;return new D.Texture(a,{...c,samplingMode:k?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:g.TextureSamplingMode.LINEAR,hasMipmap:k,internalFormat:I,width:f,height:h},{type:"compressed",levels:d})}let e=null,q=null;l.createTextureBasis=function(a,c,d){return v.apply(this,arguments)};l.createTextureKTX2=function(a,c,d){return w.apply(this,arguments)};l.estimateMemoryBasis=function(a,c){if(m.isNone(e))return a.byteLength;a=new e.BasisFile(new Uint8Array(a));
c=y(a)?x(a.getNumLevels(0),a.getHasAlpha(),a.getImageWidth(0,0),a.getImageHeight(0,0),c):0;a.close();a.delete();return c};l.estimateMemoryKTX2=function(a,c){if(m.isNone(e))return a.byteLength;a=new e.KTX2File(new Uint8Array(a));c=z(a)?x(a.getLevels(),a.getHasAlpha(),a.getWidth(),a.getHeight(),c):0;a.close();a.delete();return c};l.loadBasis=t;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});