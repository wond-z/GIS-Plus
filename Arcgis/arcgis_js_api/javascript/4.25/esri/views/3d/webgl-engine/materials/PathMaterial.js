// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(t,u,y,z,G,H,I,h,v,J,K,w,L,x,M,k,q,A,N){function r(f,d,b,a){if(d.vertexAttributes.has(f)){const c=d.vertexAttributes.get(f);d=d.indices.get(f);M.assert(4===c.size);if(b=b.getField(f,H.BufferViewVec4f))A.writeBufferVec4(d,c.data,b,a);else throw Error("unable to acquire view for "+f);}}w=function(f){function d(a){a=f.call(this,a,new B)||this;a.supportsEdges=!0;a._vertexAttributeLocations=q.vertexAttributeLocations;a._configuration=new q.PathTechniqueConfiguration;a._vertexBufferLayout=d.getVertexBufferLayout(a.parameters);
return a}u._inheritsLoose(d,f);var b=d.prototype;b.getConfiguration=function(a,c){this._configuration.output=a;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(a===h.ShaderOutput.Color||
a===h.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.WindingOrder:v.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=c.ssaoHelper.ready?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=
c.transparencyPassType;this._configuration.hasMultipassTerrain=c.multipassTerrain.enabled;this._configuration.cullAboveGround=c.multipassTerrain.cullAboveGround;return this._configuration};b.isVisibleForOutput=function(a){return a===h.ShaderOutput.Shadow||a===h.ShaderOutput.ShadowExludeHighlight||a===h.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};b.isVisible=function(){return f.prototype.isVisible.call(this)&&0<this.parameters.opacity};b.intersect=function(a,c,g,l,m,p,C){if(L.isPathGeometry(a)){c=
a.path;g=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var e=this.parameters.vvSizeOffset,n=this.parameters.vvSizeFactor;const D=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,F=c.sizeAttributeValue;g[0]*=y.clamp(e[0]+F*n[0],D[0],E[0]);g[1]*=y.clamp(e[2]+F*n[2],D[2],E[2])}e=Math.max(g[0],g[1]);a=a.boundingInfo;z.isNone(a)?this._intersectTriangles(c,g,m,p,C):(a=G.fromValues(a.bbMin[0]-e,a.bbMin[1]-e,a.bbMin[2]-e,a.bbMax[0]+e,a.bbMax[1]+e,a.bbMax[2]+
e),e=[p[0]-m[0],p[1]-m[1],p[2]-m[2]],n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),N.intersectAabbInvDir(a,m,[n/e[0],n/e[1],n/e[2]],l.tolerance)&&this._intersectTriangles(c,g,m,p,C))}};b._intersectTriangles=function(a,c,g,l,m){a.baked.size&&a.baked.size[0]===c[0]&&a.baked.size[1]===c[1]||a.baked.bake(c);a.baked.intersect(g,l,m)};b.computeAttachmentOrigin=function(a,c){a=a.vertexAttributes;if(!a)return null;a=a.get(k.VertexAttribute.POSITION);return J.computeAttachmentOriginLines(a,null,!1,c)};b.createBufferWriter=
function(){return new O(this._vertexBufferLayout)};b.requiresSlot=function(a,c){switch(c){case h.ShaderOutput.Shadow:case h.ShaderOutput.ShadowHighlight:case h.ShaderOutput.ShadowExludeHighlight:if(!this.parameters.castShadows)return!1;case h.ShaderOutput.Color:case h.ShaderOutput.Alpha:case h.ShaderOutput.Depth:case h.ShaderOutput.Normal:case h.ShaderOutput.Highlight:case h.ShaderOutput.ObjectAndLayerIdColor:return a===(this.parameters.transparent?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.OPAQUE_MATERIAL)||
a===x.RenderSlot.DRAPED_MATERIAL;default:return!1}};b.createGLMaterial=function(a){return new P(a)};d.getVertexBufferLayout=function(a){const c=I.newLayout().vec3f(k.VertexAttribute.POSITION).vec4f(k.VertexAttribute.PROFILERIGHT).vec4f(k.VertexAttribute.PROFILEUP).vec4f(k.VertexAttribute.PROFILEVERTEXANDNORMAL);(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)&&c.vec4f(k.VertexAttribute.FEATUREVALUE);return c};return d}(w.Material);let P=function(f){function d(){return f.apply(this,arguments)||
this}u._inheritsLoose(d,f);var b=d.prototype;b._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};b._updateShadowState=function(a){(z.isNone(this.technique)||a.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:a.shadowMap.enabled})};b.beginSlot=function(a){if(this._output===h.ShaderOutput.Color||this._output===h.ShaderOutput.Alpha)this._updateShadowState(a),
this._updateOccludeeState(a);return this.ensureTechnique(q.PathTechnique,a)};return d}(K),B=function(f){function d(){var b=f.apply(this,arguments)||this;b.doubleSided=!1;b.doubleSidedType="normal";b.receiveSSAO=!0;b.receiveShadows=!1;b.castShadows=!0;b.hasSlicePlane=!1;b.transparent=!1;b.hasOccludees=!1;return b}u._inheritsLoose(d,f);return d}(q.PathPassParameters),O=function(){function f(b){this.vertexBufferLayout=b}var d=f.prototype;d.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};
d.elementCount=function(b){return b.indices.get(k.VertexAttribute.POSITION).length};d.write=function(b,a,c,g,l){r(k.VertexAttribute.PROFILERIGHT,c,g,l);r(k.VertexAttribute.PROFILEUP,c,g,l);r(k.VertexAttribute.PROFILEVERTEXANDNORMAL,c,g,l);this.vertexBufferLayout.hasField(k.VertexAttribute.FEATUREVALUE)&&r(k.VertexAttribute.FEATUREVALUE,c,g,l);A.writeDefaultAttributes(c,this.vertexBufferLayout,b,a,g,l)};return f}();t.PathMaterial=w;t.PathMaterialParameters=B;Object.defineProperties(t,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});