// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutput ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(N,O,da,H,E,ea,g,w,fa,I,z,l,V,J,ha,ia,W,P,ja,v,ka,Q,la,ma,na,oa){var K;(function(n){n[n.START=0]="START";n[n.END=1]="END"})(K||(K={}));let ta=function(n){function p(a){a=n.call(this,a,new X)||this;a._configuration=new oa.NativeLineTechniqueConfiguration;return a}O._inheritsLoose(p,n);var b=p.prototype;b.getConfiguration=function(a,c){this._configuration.output=a;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.draped=c.slot===P.RenderSlot.DRAPED_MATERIAL;a=H.isSome(this.parameters.stipplePattern);this._configuration.stippleEnabled=a;this._configuration.stippleOffColorEnabled=a&&H.isSome(this.parameters.stippleOffColor);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous;return this._configuration};b.intersect=
function(a,c,d,e,u,m,h,k,f){H.isSome(f)?la.intersectDrapedRenderLineGeometry(a,e,f,m,1,h):this._intersectLineGeometry(a,c,d,e,h)};b._intersectLineGeometry=function(a,c,d,e,u){if(e.options.selectionMode&&!ma.isInstanceHidden(c))if(ja.isTranslationMatrix(d)){var m=a.vertexAttributes.get(v.VertexAttribute.POSITION).data,h=e.camera,k=pa;ea.copy(k,e.point);g.set(G[0],k[0]-2,k[1]+2,0);g.set(G[1],k[0]+2,k[1]+2,0);g.set(G[2],k[0]+2,k[1]-2,0);g.set(G[3],k[0]-2,k[1]-2,0);for(a=0;4>a;a++)if(!h.unprojectFromRenderScreen(G[a],
y[a]))return;l.fromPoints(h.eye,y[0],y[1],R);l.fromPoints(h.eye,y[1],y[2],S);l.fromPoints(h.eye,y[2],y[3],T);l.fromPoints(h.eye,y[3],y[0],U);c=Number.MAX_VALUE;a=0;for(let q=0;q<m.length-5;q+=3)if(r[0]=m[q]+d[12],r[1]=m[q+1]+d[13],r[2]=m[q+2]+d[14],t[0]=m[q+3]+d[12],t[1]=m[q+4]+d[13],t[2]=m[q+5]+d[14],!(0>l.signedDistance(R,r)&&0>l.signedDistance(R,t)||0>l.signedDistance(S,r)&&0>l.signedDistance(S,t)||0>l.signedDistance(T,r)&&0>l.signedDistance(T,t)||0>l.signedDistance(U,r)&&0>l.signedDistance(U,
t))){h.projectToRenderScreen(r,A);h.projectToRenderScreen(t,B);if(0>A[2]&&0<B[2]){g.subtract(x,r,t);var f=h.frustum;f=-l.signedDistance(f[I.PlaneIndex.NEAR],r)/g.dot(x,l.normal(f[I.PlaneIndex.NEAR]));g.scale(x,x,f);g.add(r,r,x);h.projectToRenderScreen(r,A)}else if(0<A[2]&&0>B[2])g.subtract(x,t,r),f=h.frustum,f=-l.signedDistance(f[I.PlaneIndex.NEAR],t)/g.dot(x,l.normal(f[I.PlaneIndex.NEAR])),g.scale(x,x,f),g.add(t,t,x),h.projectToRenderScreen(t,B);else if(0>A[2]&&0>B[2])continue;A[2]=0;B[2]=0;f=z.distance2(z.fromPoints(A,
B,Y),k);f<c&&(c=f,g.copy(Z,r),g.copy(aa,t),a=q/3)}d=e.rayBegin;e=e.rayEnd;4>c&&(c=Number.MAX_VALUE,z.closestLineSegmentPoint(z.fromPoints(Z,aa,Y),z.fromPoints(d,e,qa),C)&&(g.subtract(C,C,d),c=g.length(C),g.scale(C,C,1/c),c/=g.distance(d,e)),u(c,C,a,!1))}else da.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")};b.computeAttachmentOrigin=function(a,c){a=a.vertexAttributes;if(!a)return!1;a=a.get(v.VertexAttribute.POSITION);return ha.computeAttachmentOriginLines(a,
null,!1,c)};b.requiresSlot=function(a,c){return(c===J.ShaderOutput.Color||c===J.ShaderOutput.Highlight||c===J.ShaderOutput.ObjectAndLayerIdColor)&&(a===P.RenderSlot.OPAQUE_MATERIAL||a===P.RenderSlot.DRAPED_MATERIAL)};b.createGLMaterial=function(a){return new ra(a)};b.createBufferWriter=function(){const a=this.parameters.hasVertexColors?Q.PositionColorLayout:Q.PositionLayout;return H.isNone(this.parameters.stipplePattern)?new Q.DefaultBufferWriter(a):new sa(a.clone().vec3f(v.VertexAttribute.AUXPOS1).vec2f(v.VertexAttribute.UV0))};
return p}(W.Material),ra=function(n){function p(){var a=n.apply(this,arguments)||this;a._stipplePattern=null;return a}O._inheritsLoose(p,n);var b=p.prototype;b.dispose=function(){n.prototype.dispose.call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};b._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};b.beginSlot=function(a){this._output===J.ShaderOutput.Color&&
this._updateOccludeeState(a);const c=this._material.parameters.stipplePattern;this._stipplePattern!==c&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,c)),this._stipplePattern=c);return this.ensureTechnique(na.NativeLineTechnique,a)};return p}(ia),sa=function(){function n(b){this.vertexBufferLayout=b}var p=n.prototype;p.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};p.elementCount=function(b){return b.indices.get(v.VertexAttribute.POSITION).length};
p.write=function(b,a,c,d,e){ka.writeDefaultAttributes(c,this.vertexBufferLayout,b,a,d,e);this._writeAuxpos1(b,c,d,e);this._writeUV0(b,c,d,e)};p._writeAuxpos1=function(b,a,c,d){var e=c.getField(v.VertexAttribute.AUXPOS1,V.BufferViewVec3f);c=a.indices.get(v.VertexAttribute.POSITION);a=a.vertexAttributes.get(v.VertexAttribute.POSITION).data;const u=e.typedBufferStride;e=e.typedBuffer;d*=u;for(let h=0;h<c.length-1;h+=2)for(const k of[1,0]){var m=3*c[h+k];const f=a[m],q=a[m+1];m=a[m+2];const L=b[1]*f+
b[5]*q+b[9]*m+b[13],M=b[2]*f+b[6]*q+b[10]*m+b[14];e[d]=b[0]*f+b[4]*q+b[8]*m+b[12];e[d+1]=L;e[d+2]=M;d+=u}};p._writeUV0=function(b,a,c,d){var e=c.getField(v.VertexAttribute.UV0,V.BufferViewVec2f),u=a.indices.get(v.VertexAttribute.POSITION);c=a.vertexAttributes.get(v.VertexAttribute.POSITION).data;const m=a.vertexAttributes.get(v.VertexAttribute.DISTANCETOSTART)?.data;a=e.typedBufferStride;e=e.typedBuffer;d*=a;let h=0;e[d]=K.START;e[d+1]=h;d+=a;var k=3*u[0];k=g.set(r,c[k],c[k+1],c[k+2]);b&&g.transformMat4(k,
k,b);const f=t,q=u.length-1;let L=1;const M=m?(F,ba,ca)=>h=m[ca]:(F,ba,ca)=>h+=g.distance(F,ba);for(let F=1;F<q;F+=2){var D=3*u[F];g.set(f,c[D],c[D+1],c[D+2]);b&&g.transformMat4(f,f,b);M(k,f,L++);for(D=0;2>D;++D)e[d]=1-D,e[d+1]=h,d+=a;g.copy(k,f)}u=3*u[q];g.set(f,c[u],c[u+1],c[u+2]);b&&g.transformMat4(f,f,b);M(k,f,L);e[d]=K.END;e[d+1]=h};return n}(),X=function(n){function p(){var b=n.apply(this,arguments)||this;b.color=fa.ONES;b.hasVertexColors=!1;b.hasSlicePlane=!1;b.width=1;b.stipplePreferContinuous=
!0;b.hasOccludees=!1;b.stippleTexture=null;return b}O._inheritsLoose(p,n);return p}(W.MaterialParameters);const r=w.create(),t=w.create(),x=w.create(),C=w.create(),A=E.createRenderScreenPointArray3(),B=E.createRenderScreenPointArray3(),Z=w.create(),aa=w.create(),Y=z.create(),qa=z.create(),pa=w.create(),G=[E.createRenderScreenPointArray3(),E.createRenderScreenPointArray3(),E.createRenderScreenPointArray3(),E.createRenderScreenPointArray3()],y=[w.create(),w.create(),w.create(),w.create()],R=l.create(),
S=l.create(),T=l.create(),U=l.create();N.NativeLineMaterial=ta;N.Parameters=X;Object.defineProperties(N,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});