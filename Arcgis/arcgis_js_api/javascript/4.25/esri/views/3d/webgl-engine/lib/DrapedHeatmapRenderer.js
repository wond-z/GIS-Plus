// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(b,r,c,l,w,d,F,G,x,y,z,A,p,e,B,C,D){b.DrapedHeatmapRenderer=function(t){function n(a){a=t.call(this,a)||this;a.pixelRatio=1;a._colorRampData=new Uint8ClampedArray(4);a.type="draped-heatmap";a._heatmapParameters=new p.HeatmapPassParameters;return a}r._inheritsLoose(n,t);var q=n.prototype;q.initialize=function(){this._densityMap=new B.FramebufferObject(this.rctx,{colorTarget:e.TargetType.TEXTURE,depthStencilTarget:e.DepthStencilTargetType.NONE,width:0,height:0},{target:e.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=z.createQuadVAO(this.rctx);var a=this._colorRampData;this._colorRamp=new C.Texture(this.rctx,{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,samplingMode:e.TextureSamplingMode.LINEAR,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:a.length/4,height:1},a);a=new p.HeatmapTechniqueConfiguration;
a.usesHalfFloat=this.dataType!==e.PixelType.FLOAT;this._technique=new p.HeatmapTechnique({rctx:this.rctx,viewingMode:y.ViewingMode.Local},a);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(w.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};q.destroy=function(){this._technique=l.releaseMaybe(this._technique);this._densityMap=l.disposeMaybe(this._densityMap);
this._quad=l.disposeMaybe(this._quad);this._colorRamp=l.disposeMaybe(this._colorRamp)};q.render=function(a,g){const m=this._sortedMaterialRenderers,u=m.length;if(!(1>u)){var E=this.rctx.getBoundFramebufferObject(),h=this.rctx.getViewport(),{pixelRatio:f}=this,k=Math.ceil(h.width*f);f=Math.ceil(h.height*f);this._densityMap.resize(k,f);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,k,f);this.rctx.clear(e.ClearBufferBit.COLOR_BUFFER_BIT);k=!1;for(f=0;f<u;f++){const v=m.getItemAt(f);
v.material.shouldRender(a)&&(k=k||v.materialRenderer.render(a.output,g))}this.rctx.bindFramebuffer(E);this.rctx.setViewport(h.x,h.y,h.width,h.height);k&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,a.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,D.vertexCount(this._quad,"geometry")))}};r._createClass(n,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(a){a!==this._heatmapParameters.searchRadius&&
(this._heatmapParameters.searchRadius=a,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(a){a!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=a,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(a){a!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=a,this.notifyChange("maxDensity"))}},{key:"fieldTotal",
get:function(){return this._heatmapParameters.fieldTotal},set:function(a){this._heatmapParameters.fieldTotal=a;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(a){const {colorRamp:g}=this._heatmapParameters;if(l.isSome(g)&&a!==this._colorRampData){const m=a.length/4;m!==g.descriptor.width&&g.resize(m,1);g.setData(a)}this._colorRampData=a}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(a){this._heatmapParameters.colorRamp=
a}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return n}(A.SortedRenderGeometryRenderer);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"fieldTotal",
null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"dataType",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([d.property({constructOnly:!0})],
b.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);b.DrapedHeatmapRenderer=c.__decorate([x.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],b.DrapedHeatmapRenderer);Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});