// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(d,D,E,q,t,A,k,r,B,F,f,p,m,u,x,G,H,I,v){let J=function(){function l(a=null,b=null,e=null){this._viewUp=p.create();this._viewForward=p.create();this._viewRight=p.create();this._ray=G.create();this._viewport=u.fromValues(0,0,1,1);this._padding=u.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=F.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=r.create();this._projectionDirty=!0;this._projectionMatrix=r.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=r.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=r.create();this._inverseProjectionDirty=!0;this._inverseProjectionMatrix=null;this._frustumDirty=!0;this._frustum=x.create();this._fullViewport=u.create();this._pixelRatio=1;this.relativeElevation=0;t.isSome(a)&&f.copy(this._ray.origin,a);this._center=t.isSome(b)?p.clone(b):p.create();this._up=t.isSome(e)?p.clone(e):p.fromValues(0,0,1)}var g=l.prototype;g.depthNDCToWorld=function(a){return 2*this.near*this.far/(this.far+this.near-
(2*a-1)*(this.far-this.near))};g.copyFrom=function(a){f.copy(this._ray.origin,a.eye);f.copy(this._center,a.center);f.copy(this._up,a.up);m.copy(this._viewport,a.viewport);m.copy(this._padding,a.padding);B.copy(this._nearFar,a.nearFar);this._fov=a.fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(k.copy(this._viewMatrix,a.viewMatrix),f.copy(this._viewRight,a.viewRight),f.copy(this._viewUp,a.viewUp),f.copy(this._viewForward,a.viewForward));a._projectionDirty?
this._projectionDirty=!0:(k.copy(this._projectionMatrix,a.projectionMatrix),this._projectionDirty=!1);this._inverseProjectionDirty=this._viewProjectionDirty=!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(x.copy(this._frustum,a.frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(k.copy(this._viewInverseTransposeMatrix,a.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);m.copy(this._fullViewport,a.fullViewport);
this._pixelRatio=a.pixelRatio;return this};g.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};g.clone=function(){return(new l).copyFrom(this)};g.equals=function(a){return f.exactEquals(this.eye,a.eye)&&f.exactEquals(this._center,a.center)&&f.exactEquals(this._up,a.up)&&m.exactEquals(this._viewport,a.viewport)&&m.exactEquals(this._padding,a.padding)&&B.exactEquals(this._nearFar,a.nearFar)&&this._fov===a.fov&&this._pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};
g.almostEquals=function(a){if(this._pixelRatio!==a.pixelRatio||.001<=Math.abs(a.fov-this._fov))return!1;const b=1-1E-10;f.sub(h,a.eye,a.center);f.sub(y,this.eye,this._center);const e=f.dot(h,y),n=f.sqrLen(h),C=f.sqrLen(y);return e*e>=b*n*C&&f.sqrDist(a.eye,this.eye)<2.5E-7*Math.max(n,C)&&.5>m.squaredDistance(a.padding,this._padding)&&.5>m.squaredDistance(a.viewport,this._viewport)};g.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(a))};g.computeRenderPixelSizeAtDist=
function(a){return a*this.perRenderPixelRatio};g.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(a))};g._viewDirectionDistance=function(a){return Math.abs(H.projectPointSignedLength(this.viewForward,f.subtract(h,a,this.eye)))};g.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};g.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};g.getScreenCenter=function(a=A.createScreenPointArray()){a[0]=
(this.padding[d.PaddingSide.LEFT]+this.width/2)/this._pixelRatio;a[1]=(this.padding[d.PaddingSide.TOP]+this.height/2)/this._pixelRatio;return a};g.getRenderCenter=function(a,b=.5,e=.5){a[0]=this.padding[d.PaddingSide.LEFT]+this.width*b;a[1]=this.padding[d.PaddingSide.BOTTOM]+this.height*e;a[2]=.5;return a};g.setGLViewport=function(a){const b=this.viewport,e=this.padding;a.setViewport(b[0]-e[3],b[1]-e[2],b[2]+e[1]+e[3],b[3]+e[0]+e[2])};g.applyProjection=function(a,b){a!==c&&f.copy(c,a);c[3]=1;m.transformMat4(c,
c,this.projectionMatrix);a=Math.abs(c[3]);f.scale(c,c,1/a);const e=this.fullViewport;b[0]=q.lerp(0,e[0]+e[2],.5+.5*c[0]);b[1]=q.lerp(0,e[1]+e[3],.5+.5*c[1]);b[2]=.5*(c[2]+1);b[3]=a};g.unapplyProjection=function(a,b){const e=this.fullViewport;c[0]=(a[0]/(e[0]+e[2])*2-1)*a[3];c[1]=(a[1]/(e[1]+e[3])*2-1)*a[3];c[2]=(2*a[2]-1)*a[3];c[3]=a[3];m.transformMat4(c,c,this.inverseProjectionMatrix);b[0]=c[0];b[1]=c[1];b[2]=c[2]};g.projectToScreen=function(a,b){this.projectToRenderScreen(a,z);this.renderToScreen(z,
b);return b};g.projectToRenderScreen=function(a,b){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=1;m.transformMat4(c,c,this.viewProjectionMatrix);if(0===c[3])return null;f.scale(c,c,1/Math.abs(c[3]));a=this.fullViewport;"x"in b?(b.x=q.lerp(0,a[0]+a[2],.5+.5*c[0]),b.y=q.lerp(0,a[1]+a[3],.5+.5*c[1])):(b[0]=q.lerp(0,a[0]+a[2],.5+.5*c[0]),b[1]=q.lerp(0,a[1]+a[3],.5+.5*c[1]),2<b.length&&(b[2]=.5*(c[2]+1)));return b};g.unprojectFromScreen=function(a,b){return this.unprojectFromRenderScreen(this.screenToRender(a,z),
b)};g.unprojectFromRenderScreen=function(a,b){k.multiply(w,this.projectionMatrix,this.viewMatrix);if(!k.invert(w,w))return null;const e=this.fullViewport;c[0]=2*(a[0]-e[0])/e[2]-1;c[1]=2*(a[1]-e[1])/e[3]-1;c[2]=2*a[2]-1;c[3]=1;m.transformMat4(c,c,w);if(0===c[3])return null;b[0]=c[0]/c[3];b[1]=c[1]/c[3];b[2]=c[2]/c[3];return b};g.constrainWindowSize=function(a,b,e,n=e){a*=this._pixelRatio;b*=this._pixelRatio;return[Math.max(a-e/2,0),Math.max(this.fullHeight-b-n/2,0),e- -Math.min(a-e/2,0)- -Math.min(this.fullWidth-
a-e/2,0),n- -Math.min(this.fullHeight-b-n/2,0)- -Math.min(b-n/2,0)]};g.computeUp=function(a){a===I.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};g.screenToRender=function(a,b){const e=this.fullHeight-a[1]*this._pixelRatio;b[0]=a[0]*this._pixelRatio;b[1]=e;return b};g.renderToScreen=function(a,b){const e=(this.fullHeight-a[1])/this._pixelRatio;b[0]=a[0]/this._pixelRatio;b[1]=e};g._computeUpGlobal=function(){f.subtract(h,this.center,this.eye);const a=f.length(this.center);1>a?(f.set(this._up,
0,0,1),this._markViewDirty()):Math.abs(f.dot(h,this.center))>.9999*f.length(h)*a||(f.cross(this._up,h,this.center),f.cross(this._up,this._up,h),f.normalize(this._up,this._up),this._markViewDirty())};g._computeUpLocal=function(){f.direction(h,this.eye,this.center);.9999>=Math.abs(h[2])&&(f.scale(h,h,h[2]),f.set(this._up,-h[0],-h[1],1-h[2]),f.normalize(this._up,this._up),this._markViewDirty())};g._compareAndSetView=function(a,b){"number"===typeof a[0]&&isFinite(a[0])&&"number"===typeof a[1]&&isFinite(a[1])&&
"number"===typeof a[2]&&isFinite(a[2])?f.exactEquals(a,b)||(f.copy(b,a),this._markViewDirty()):E.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")};g._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};g._recomputeFrustum=function(){this._frustumDirty&&(x.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};g._ensureViewClean=function(){this._viewDirty&&(k.lookAt(this._viewMatrix,
this.eye,this._center,this._up),f.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),f.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),f.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};D._createClass(l,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(a){this._pixelRatio=0<a?a:1}},{key:"eye",get:function(){return this._ray.origin},
set:function(a){this._compareAndSetView(a,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)}},{key:"ray",get:function(){f.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){k.copy(this._viewMatrix,a);this._viewDirty=
!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(a){this._nearFar[0]!==a&&(this._nearFar[0]=a,this._frustumDirty=
this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(a){this._nearFar[1]!==a&&(this._nearFar[1]=a,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(a){a+=this._padding[d.PaddingSide.LEFT];
this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(a){a+=this._padding[d.PaddingSide.BOTTOM];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=
a,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[d.PaddingSide.RIGHT]+this._padding[d.PaddingSide.LEFT]},set:function(a){this.width=a-(this._padding[d.PaddingSide.RIGHT]+
this._padding[d.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[d.PaddingSide.TOP]+this._padding[d.PaddingSide.BOTTOM]},set:function(a){this.height=a-(this._padding[d.PaddingSide.TOP]+this._padding[d.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[d.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[d.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=
this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(a){if(this._padding[d.PaddingSide.TOP]!==a[d.PaddingSide.TOP]||this._padding[d.PaddingSide.RIGHT]!==a[d.PaddingSide.RIGHT]||this._padding[d.PaddingSide.BOTTOM]!==a[d.PaddingSide.BOTTOM]||this._padding[d.PaddingSide.LEFT]!==a[d.PaddingSide.LEFT])this._viewport[0]+=a[d.PaddingSide.LEFT]-this._padding[d.PaddingSide.LEFT],this._viewport[1]+=
a[d.PaddingSide.BOTTOM]-this._padding[d.PaddingSide.BOTTOM],this._viewport[2]-=a[d.PaddingSide.RIGHT]+a[d.PaddingSide.LEFT]-(this._padding[d.PaddingSide.RIGHT]+this._padding[d.PaddingSide.LEFT]),this._viewport[3]-=a[d.PaddingSide.TOP]+a[d.PaddingSide.BOTTOM]-(this._padding[d.PaddingSide.TOP]+this._padding[d.PaddingSide.BOTTOM]),m.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&
(k.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const a=this.width,b=this.height,e=this.near*Math.tan(this.fovY/2),n=e*this.aspect;k.frustum(this._projectionMatrix,-n*(1+2*this._padding[d.PaddingSide.LEFT]/a),n*(1+2*this._padding[d.PaddingSide.RIGHT]/a),-e*(1+2*this._padding[d.PaddingSide.BOTTOM]/b),e*(1+2*this._padding[d.PaddingSide.TOP]/
b),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=!0}},{key:"inverseProjectionMatrix",get:function(){t.isNone(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=r.create());this._inverseProjectionDirty&&k.invert(this._inverseProjectionMatrix,this.projectionMatrix);return this._inverseProjectionMatrix}},{key:"fov",
get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return v.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=v.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return v.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=
v.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return f.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)k.invert(this._viewInverseTransposeMatrix,this.viewMatrix),k.transpose(this._viewInverseTransposeMatrix,
this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this._pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&0<=this.relativeElevation}}]);return l}();const c=u.create(),w=r.create(),h=p.create(),y=p.create(),z=A.createRenderScreenPointArray3();
d.PaddingSide=void 0;(function(l){l[l.TOP=0]="TOP";l[l.RIGHT=1]="RIGHT";l[l.BOTTOM=2]="BOTTOM";l[l.LEFT=3]="LEFT"})(d.PaddingSide||(d.PaddingSide={}));d.Camera=J;Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});