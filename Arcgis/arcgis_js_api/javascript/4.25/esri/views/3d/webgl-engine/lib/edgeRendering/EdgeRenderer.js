// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),function(k,r,l,p,t,u,v,w,x,y,z,A,c,h,B){const C={type:"uber",
hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},D={solid:h.EdgeUtilMode.SOLID,sketch:h.EdgeUtilMode.SKETCH,uber:h.EdgeUtilMode.MIXED};h=function(){function m(b,a,d){this._rctx=b;this._shaderTechniqueRepository=a;this._configuration=new A.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[c.Transparency.TRANSPARENT]:{[c.Transparency.TRANSPARENT]:new l,[c.Transparency.OPAQUE]:new l},[c.Transparency.OPAQUE]:{[c.Transparency.TRANSPARENT]:new l,
[c.Transparency.OPAQUE]:new l}};this._renderablesDirty=!1;this._drawParameters=new y.EdgeDrawParameters;this._settings={...C,...d};this.key=m.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:v.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=D[this._settings.type];this._configuration.silhouette=!1;this._configuration.antialiasing=
!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=w.doublePrecisionRequiresObfuscation(b);this._configuration.spherical=d.spherical}var e=m.prototype;e.dispose=function(){this._technique=r.releaseMaybe(this._technique)};e.addRenderable=function(b){this._renderables.add(b);this._renderablesDirty=!0};e.removeRenderable=function(b){this._renderables.delete(b);this._renderablesDirty=!0};e.setRenderablesDirty=
function(){this._renderablesDirty=!0};e.forEachRenderable=function(b,a){this._renderablesDirty&&this._sortRenderables();this._sortedRenderables[a][c.Transparency.TRANSPARENT].forAll(b);this._sortedRenderables[a][c.Transparency.OPAQUE].forAll(b)};e.updateTechnique=function(b,a){this._configuration.hasMultipassTerrain=!!b.multipassTerrain.enabled;this._configuration.cullAboveGround=!!b.multipassTerrain.cullAboveGround;this._configuration.silhouette=a;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(z.EdgeShaderTechnique,
this._configuration,this._technique)};e.bindRegularEdges=function(b,a){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(a,!1),b,a)};e.bindSilhouetteEdges=function(b,a){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(a,!0),b,a)};e.renderRegularEdges=function(b,a,d,f,g){this._render(b,a,a.regular.vao,d,f,g)};e.renderSilhouetteEdges=function(b,a,d,f,g){this._render(b,a,a.silhouette.vao,d,f,g)};e._render=function(b,a,d,f,g,n){0<n&&(this._bindDraw(b,
a,f,g),this._rctx.bindVAO(d),this._rctx.capabilities.instancing.drawArraysInstanced(B.PrimitiveType.TRIANGLE_FAN,0,4,n))};e._bindDraw=function(b,a,d,f){this._drawParameters.componentDataTexture=a.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in a.transform)this._lastOriginId!==a.transform.origin.origin.id&&(b.setUniformMatrix4fv("localView",a.transform.origin.viewMatrix),this._lastOriginId=a.transform.origin.origin.id),b.setUniformMatrix4fv("model",
a.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=a.transform.origin.origin.vec3;else{const g=new x.TwoVectorPosition(a.transform.position),n=p.transpose(q,p.invert(q,a.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=g.low;this._drawParameters.transformWorldFromModelTH=g.high;this._drawParameters.transformWorldFromModelRS=a.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=n;a=f.camera.viewInverseTransposeMatrix;u.set(this._drawParameters.slicePlaneLocalOrigin,
a[3],a[7],a[11])}b.bindDraw(this._drawParameters,f,d)};e._sortRenderables=function(){this._renderablesDirty=!1;this._sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.TRANSPARENT].clear();this._sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.OPAQUE].clear();this._sortedRenderables[c.Transparency.OPAQUE][c.Transparency.TRANSPARENT].clear();this._sortedRenderables[c.Transparency.OPAQUE][c.Transparency.OPAQUE].clear();this._renderables.forEach(a=>{a.objectTransparency!==c.Transparency.INVISIBLE&&
a.edgeTransparency!==c.Transparency.INVISIBLE&&this._sortedRenderables[a.objectTransparency][a.edgeTransparency].push(a)});const b=(a,d)=>"origin"in a.transform?"origin"in d.transform?a.transform.origin.origin.id<d.transform.origin.origin.id?-1:a.transform.origin.origin.id>d.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.TRANSPARENT].sort(b);this._sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.OPAQUE].sort(b);this._sortedRenderables[c.Transparency.OPAQUE][c.Transparency.TRANSPARENT].sort(b);
this._sortedRenderables[c.Transparency.OPAQUE][c.Transparency.OPAQUE].sort(b)};m.getKey=function(b,a,d){return`edges-t:${b}:${a}:${d}`};return m}();const q=t.create();k.EXTENSION_LENGTH_OFFSET=128;k.EdgeRenderer=h;k.LINE_WIDTH_FRACTION_FACTOR=8;Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});