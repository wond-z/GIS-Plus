// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(h,f,m,k){let r=function(){function l(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";this.colorZero=new k.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}var g=l.prototype;g.setUidToObjectAndLayerId=
function(a,b,c,d,e,n=null,p=null,q=null){a&&b&&c&&d&&(this._layerUidToId.set(d,c),this._layerUidToPopupEnabled.set(d,e),e&&(c=this._layerUidToGraphicsUidToObjectId.get(d),c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(d,c)),c.set(b,{objectId:a,attributeNodeId:n,attributeIndex:p,subLayerId:q})))};g.getObjectAndLayerIdColor=function(a){a=this.getObjectAndLayerIdColorArray(a);return m.fromValues(a.get(0,1),a.get(0,2),a.get(0,3),255)};g.getObjectAndLayerIdColorArray=function(a){if(!a.layerUid||
!a.graphicUid)return this.colorZero;var b=this._layerUidToPopupEnabled.get(a.layerUid);if(void 0===b)return f.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+a.layerUid),this.colorZero;if(!1===b)return this.colorZero;let c=this._uidToRenderColor.get(a.layerUid);c||(c=new Map,this._uidToRenderColor.set(a.layerUid,c));b=c.get(a.graphicUid);if(!b){for(;!b;){const d=Math.floor(16777214*Math.random())+1;this._colorToUID.has(d)||(b=d)}if(16777215<b)throw Error("Object ID Overflow");
c.set(a.graphicUid,b);this._colorToUID.set(b,a)}a=new ArrayBuffer(4);(new DataView(a)).setUint32(0,b,!1);return new k.BufferViewVec4u8(a)};g.getColorToObjectAndLayerIdMapping=function(){const a=new Map;for(const [c,d]of this._colorToUID.entries()){var b=this._layerUidToGraphicsUidToObjectId.get(d.layerUid);let e=null;b?(e=b.get(d.graphicUid))||f.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+d.graphicUid):f.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+
d.layerUid);(b=this._layerUidToId.get(d.layerUid))||f.getLogger(this.declaredClass).warn("no layerId found for uid "+d.layerUid);e&&b&&a.set(c,e.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:e.objectId,lid:b,attrId:e.attributeNodeId,attrIdx:e.attributeIndex,subLayerId:e.subLayerId}:{type:"object-and-layer-id",oid:e.objectId,lid:b})}return a};return l}();h.ObjectAndLayerIdRenderHelper=r;Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});