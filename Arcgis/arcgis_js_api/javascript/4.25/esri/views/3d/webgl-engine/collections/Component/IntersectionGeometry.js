// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/Indices ../../materials/internal/MaterialUtil".split(" "),function(C,l,D,E,F,G,A,H,I,x){let N=function(){function y(a,b){this._indices=l.isSome(a.indices)?a.indices:I.generateDefaultIndexArray(a.positions.length/
3);this._positions=new G.BufferViewVec3f(a.positions);this._components=b;this._componentIntersectionData=Array(b.count)}var u=y.prototype;u.getComponentAabb=function(a,b){if(l.isSome(this._perComponentAabbs)){for(let e=0;6>e;e++)b[e]=this._perComponentAabbs[6*a+e];return b}this._computePerComponentAabbs();return this.getComponentAabb(a,b)};u.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];
b.endIndex=this._components.offsets[a+1]};u.intersect=function(a,b,e,z,g,h,n){const k={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},m=this._indices,v=this._components.offsets,p=x.computeInvDir(a,b,J),q=a[2],r=b[2];this._components.visibility.forEachComponent(c=>{if(!H.getVisibility(this._components.pickability,c))return!0;var f=this.getComponentAabb(c,K);if(l.isSome(h)){var d=h[c];l.isSome(g)?g.componentOffset=d:(a[2]=q-d,b[2]=r-d)}l.isSome(g)&&g.applyToAabb(f);
if(!x.intersectAabbInvDir(f,a,p,e))return!0;f=v[c]/3;d=v[c+1]/3;const t=(L,B,M)=>{n(c,L,D.transformMat3(B,B,z),M)},w=d-f;l.isNone(g)&&w>A.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[c]&&(this._componentIntersectionData[c]=new A.ComponentIntersectionData(this._indices,f,d,k)),this._componentIntersectionData[c].intersectRay({r0:a,r1:b},t)):x.intersectTriangles(a,b,f,d,m,k,void 0,g,t);return!0})};u._computePerComponentAabbs=function(){const a=this._components.count;
this._perComponentAabbs=new Float32Array(6*a);const b=this._indices,e=this._positions.typedBuffer,z=this._positions.typedBufferStride,g=this._components.offsets;let h=0;for(let m=0;m<a;m++){var n=g[m];const v=g[m+1];let p=Infinity,q=Infinity,r=Infinity,c=-Infinity,f=-Infinity,d=-Infinity;for(;n<v;n++){var k=b[n]*z;const t=e[k],w=e[k+1];k=e[k+2];p=Math.min(p,t);q=Math.min(q,w);r=Math.min(r,k);c=Math.max(c,t);f=Math.max(f,w);d=Math.max(d,k)}this._perComponentAabbs[h++]=p;this._perComponentAabbs[h++]=
q;this._perComponentAabbs[h++]=r;this._perComponentAabbs[h++]=c;this._perComponentAabbs[h++]=f;this._perComponentAabbs[h++]=d}};C._createClass(y,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return y}();const J=E.create(),K=F.create();return N});