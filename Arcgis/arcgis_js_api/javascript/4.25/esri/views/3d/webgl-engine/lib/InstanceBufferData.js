// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["../../../../core/mathUtils"],function(k){return function(){function g(a,b=0){this._count=this._capacity=0;this._emptySlots=[];this._emptySlotCount=0;this._id2slot=new Map;this._slot2id=[];this.layout=a;this._resize(b)}var c=g.prototype;c.prepareAllocate=function(a){a=this._count+a;a>this._capacity&&this._resize(a)};c.allocate=function(a){this._count>=this._capacity&&this._resize(this._count+1);const b=0<this._emptySlotCount?this._emptySlots[--this._emptySlotCount]:this._count;this._id2slot.set(a,
b);this._slot2id[b]=a;this._count++;return b};c.prepareFree=function(a){this._emptySlots.length+=a};c.free=function(a){const b=this._id2slot.get(a);null!=b&&(this._emptySlots.length<=this._emptySlotCount&&(this._emptySlots.length=this._emptySlotCount+1),this._emptySlots[this._emptySlotCount++]=b,this._id2slot.delete(a),this._slot2id[b]=null,this._count--)};c.getCount=function(){return this._count};c.getSlot=function(a){return this._id2slot.get(a)};c.hasSlot=function(a){return this._id2slot.has(a)};
c.getBuffer=function(){return this._buffer};c.compact=function(){if(0<this._emptySlotCount){const a=this._emptySlots;let b=this._emptySlotCount,d=this._count+b;a.length=b;for(a.sort((e,f)=>e-f);0<b;){if(a[b-1]!==d-1){const e=d-1,f=a[b-1];this._buffer.copyFrom(this._buffer,e,f,1);const h=this._slot2id[e];this._slot2id[e]=null;this._slot2id[f]=h;this._id2slot.set(h,f)}b--;d--}}this._emptySlotCount=0;this._emptySlots.length=0;this._resize(this._count)};c._resize=function(a){var b=this._capacity;a=Math.max(0,
a);0<a&&(a=k.nextHighestPowerOfTwo(a));if(a>b){const d=this.layout.createBuffer(a);this._buffer&&d.copyFrom(this._buffer,0,0,b);this._buffer=d}else a<b&&(b=this.layout.createBuffer(a),b.copyFrom(this._buffer,0,0,a),this._buffer=b);this._buffer||(this._buffer=this.layout.createBuffer(0));this._capacity=a;this._slot2id.length=a};return g}()});