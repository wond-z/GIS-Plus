// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(p,w,x,r,u){function q(g,h,a){g.canvas||(g.canvas=document.createElement("canvas"));g.canvas.width=h;g.canvas.height=a;return g.canvas}let A=function(){function g(a,c,b,d=2048){this.text=a;this._alignment=c;this._parameters=b;this._maxSize=d;this._textWidths=[];this._lineWidths=[];this._heightMetricsCached=this._displayWidth=this._renderPixelRatio=
null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${a}`;this._lines=a.split(/\r?\n/)}var h=g.prototype;h._getLineXOffset=function(a){switch(this._alignment){case p.TextRenderAlignment.Left:return this._backgroundHorizontalPadding;case p.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[a])/2;case p.TextRenderAlignment.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[a]}};h.render=function(a,c=0,b=0){a.save();c/=this.renderPixelRatio;
b/=this.renderPixelRatio;const d=c,e=b;var f=this._haloSize,k=this._firstLineYOffset;c+=f;b+=k+this._baselinePosition;const l=0<this._haloSize;l&&this._renderHalo(a,d,e,f,k);this._setFontProperties(a,this._renderedFontSize);for(f=0;f<this._lines.length;++f){const m=this._lines[f],n=this._getLineXOffset(f);l&&(a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",this._fillText(a,m,c+n,b),this._renderLineDecoration(a,c+n,b,this._textWidths[f]));a.globalCompositeOperation="source-over";
a.fillStyle=this._parameters.textStyle;this._fillText(a,m,c+this._getLineXOffset(f),b);this._renderLineDecoration(a,c+n,b,this._textWidths[f]);b+=this._lineSpacing}if(u.TEXT_SHOW_BASELINE)for(a.strokeStyle="rgb(255, 0, 255, 0.5)",a.setLineDash([2,2]),a.lineWidth=1,c=e+k,b=0;b<this._lines.length;++b)k=c+this._baselinePosition,this._drawLine(a,[d,k],[d+this.displayWidth,k]),c+=this._lineSpacing;u.TEXT_SHOW_BORDER&&(a.strokeStyle="rgb(255, 0, 255, 0.5)",a.setLineDash([]),a.lineWidth=1,this._drawBox(a,
[d,e],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(a,d,e,this._parameters.definition.background.borderRadius*this.renderPixelRatio),a.globalCompositeOperation="destination-over",a.fillStyle=this._parameters.backgroundStyle,a.fill());a.restore()};h._renderLineDecoration=function(a,c,b,d,e=!1){if("none"!==this._parameters.definition.font.decoration&&0!==d){var f=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":b+=
2*f;break;case "line-through":b-=.33*this._baselinePosition}var k=e?this._haloSize:0;a.strokeStyle=e?this._parameters.haloStyle:this._parameters.textStyle;a.lineWidth=this._toRenderUnit(f+2*k);a.beginPath();a.moveTo(this._toRenderUnit(c-k),this._toRenderUnit(b));a.lineTo(this._toRenderUnit(c+d+k),this._toRenderUnit(b));a.stroke()}};h._roundedRect=function(a,c,b,d){c=this._toRenderUnit(c);b=this._toRenderUnit(b);const e=this.renderedWidth,f=this.renderedHeight;0===d?a.rect(c,b,e,f):(d=x.clamp(d,0,
Math.floor(f/2)),a.beginPath(),a.moveTo(c,b+d),a.arcTo(c,b,c+d,b,d),a.lineTo(c+e-d,b),a.arcTo(c+e,b,c+e,b+d,d),a.lineTo(c+e,b+f-d),a.arcTo(c+e,b+f,c+e-d,b+f,d),a.lineTo(c+d,b+f),a.arcTo(c,b+f,c,b+f-d,d),a.closePath())};h._renderHalo=function(a,c,b,d,e){const f=this.renderedWidth,k=this.renderedHeight,l=q(t,Math.max(f,512),Math.max(k,512)),m=l.getContext("2d");m.clearRect(0,0,f,k);this._setFontProperties(m,this._renderedFontSize);m.fillStyle=this._parameters.haloStyle;m.strokeStyle=this._parameters.haloStyle;
var n=3>this._renderedHaloSize;m.lineJoin=n?"miter":"round";n?this._renderHaloEmulated(m,d,e):this._renderHaloNative(m,d,e);e+=this._baselinePosition;for(n=0;n<this._lines.length;++n){const y=this._getLineXOffset(n);this._renderLineDecoration(m,d+y,e,this._textWidths[n],!0);e+=this._lineSpacing}a.globalAlpha=this._parameters.definition.halo.color[3];a.drawImage(l,0,0,f,k,this._toRenderUnit(c),this._toRenderUnit(b),f,k);a.globalAlpha=1};h._renderHaloEmulated=function(a,c,b){b+=this._baselinePosition;
for(let d=0;d<this._lines.length;++d){const e=this._lines[d],f=this._getLineXOffset(d);for(const [k,l]of v)this._fillText(a,e,c+f+this._haloSize*k,b+this._haloSize*l);b+=this._lineSpacing}};h._renderHaloNative=function(a,c,b){const d=2*this._haloSize;b+=this._baselinePosition;for(let e=0;e<this._lines.length;++e){const f=this._lines[e],k=this._getLineXOffset(e);for(let l=0;5>l;l++)a.lineWidth=this._toRenderUnit((.6+.1*l)*d),this._strokeText(a,f,c+k,b);b+=this._lineSpacing}};h._setFontProperties=function(a,
c){a.font=this._parameters.fontString(c);a.textAlign="left";a.textBaseline="alphabetic"};h._ensureTextWidth=function(){if(r.isSome(this._displayWidth))return this._displayWidth;const a=q(t,512,512).getContext("2d");this._setFontProperties(a,this._fontSize);let c=2*this._haloSize;var b=this._parameters.definition.font;if("italic"===b.style||"oblique"===b.style||"bold"===b.weight||"bolder"===b.weight)c+=.3*a.measureText("A").width;this._textWidths.length=0;b=this._lineWidths.length=0;for(const d of this._lines){const e=
a.measureText(d).width,f=e+c;this._textWidths.push(e);this._lineWidths.push(f);b=Math.max(b,f)}return this._displayWidth=b};h._ensureHeightMetrics=function(){if(r.isNone(this._heightMetricsCached)){var a=q(t,512,512).getContext("2d");this._setFontProperties(a,this._fontSize);const c=a.measureText(this.text+z),b=this._hasBackground?a.measureText(this._lines[0]):c;a=1===this._lines.length?b:this._hasBackground?a.measureText(this._lines[this._lines.length-1]):c;this._heightMetricsCached={paddingTop:c.actualBoundingBoxAscent-
b.actualBoundingBoxAscent,paddingBottom:c.actualBoundingBoxDescent-a.actualBoundingBoxDescent,lineHeight:c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,baselinePosition:c.actualBoundingBoxAscent}}return this._heightMetricsCached};h._toRenderUnit=function(a){return a*this.renderPixelRatio};h._toRoundedRenderUnit=function(a){return Math.round(a*this.renderPixelRatio)};h._fillText=function(a,c,b,d){a.fillText(c,this._toRenderUnit(b),this._toRenderUnit(d))};h._strokeText=function(a,c,b,d){a.strokeText(c,
this._toRenderUnit(b),this._toRenderUnit(d))};h._drawLine=function(a,c,b){a.beginPath();a.moveTo(this._toRoundedRenderUnit(c[0])+.5,this._toRoundedRenderUnit(c[1])+.5);a.lineTo(this._toRoundedRenderUnit(b[0])+.5,this._toRoundedRenderUnit(b[1])+.5);a.stroke()};h._drawBox=function(a,c,b){var d=this._toRenderUnit(c[0]);c=this._toRenderUnit(c[1]);var e=this._toRenderUnit(b[0]);const f=this._toRenderUnit(b[1]);b=Math.floor(d)+.5;d=Math.ceil(d+e)-.5;e=Math.floor(c)+.5;c=Math.ceil(c+f)-.5;a.beginPath();
a.moveTo(b,e);a.lineTo(d,e);a.lineTo(d,c);a.lineTo(b,c);a.lineTo(b,e);a.stroke()};w._createClass(g,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this._lineSpacing*(this._lines.length-1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",
get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},{key:"_heightMetrics",get:function(){return this._ensureHeightMetrics()}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",
get:function(){return this._heightMetrics.lineHeight}},{key:"_linePadding",get:function(){return.2*this._lineHeight}},{key:"_baselinePosition",get:function(){return this._heightMetrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},
{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingBottom)}},
{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(r.isNone(this._renderPixelRatio)){const a=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this._maxSize?Math.min(a,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):a}return this._renderPixelRatio}}]);return g}();const v=[];for(let g=0;360>g;g+=22.5)v.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);p.TextRenderAlignment=void 0;
(function(g){g[g.Left=0]="Left";g[g.Center=1]="Center";g[g.Right=2]="Right"})(p.TextRenderAlignment||(p.TextRenderAlignment={}));const t={canvas:null},z=(()=>{let g="";for(let h=32;127>h;h++)g+=String.fromCharCode(h);return g})();p.TextRenderer=A;p.getTextHelperCanvas=q;Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});