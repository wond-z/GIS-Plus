// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(f,x,p,Z,va,r,E,wa,xa,d,n,F,A,B,R,ya,G,H,aa,za){function S(a,c,b){b=r.fromRotation(G.sm4d.get(),b[3],F.axis(b));Z.isNone(b)||r.exactEquals(b,E.IDENTITY)||(d.subtract(l,a.eye,c),d.transformMat4(l,l,b),a.eye=d.add(l,l,c),d.subtract(l,a.center,c),d.transformMat4(l,l,b),a.center=d.add(l,l,c),a.up=d.transformMat4(l,a.up,b))}function ba(a,c,b,e){return Math.sin(a/d.length(c))*(b+e.radius)}function ca(a,c,b,e){b=H.fromScreenAtEye(c,b,T);if(Z.isNone(b))return!1;R.closestPointOnSilhouette(a,b,I);return R.intersectRay(a,
b,e)?d.squaredDistance(I,b.origin)<d.squaredDistance(e,b.origin)?(d.copy(e,I),!1):!0:(d.subtract(y,c.eye,c.center),d.normalize(y,y),B.fromNormalAndOffset(y,-d.dot(d.normalize(y,y),I),da),B.intersectRay(da,b,e),!1)}function ea(a,c,b,e,h,k){var g=0;d.cross(J,a,c);d.subtract(K,a,c);d.length(a)<=h||!e.aboveGround?(d.cross(b,K,e.eye),g=d.dot(a,c)/(d.length(a)*d.length(c)),.9999>g?g=p.acosClamped(g):(a=d.length(d.cross(n.create(),a,c))/(d.length(a)*d.length(c)),g=p.asinClamped(a)),k=Math.cos(p.clamp(x.cyclicalPI.normalize(p.deg2rad(k)),
0,U)),g=-g-Math.max(0,d.length(c)-h)/(k*h)):(d.subtract(fa,e.eye,e.center),d.cross(b,K,fa),g=-d.length(K)/h);d.normalize(b,b);d.scale(b,b,d.length(J));return g}function V(a,c,b,e){e=Math.cos(p.clamp(x.cyclicalPI.normalize(p.deg2rad(e)),0,U));c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):p.acosClamped(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):p.acosClamped(a/b))-c)*b}function ha(a,c,b,e,h,k,g,m,q,t){m=V(a[2],c[2],k[3],m);c=q?V(a[0],c[0],k[3],180):c[0]-a[0];a=Math.sin(g)*c-Math.cos(g)*m;
g=Math.cos(g)*c+Math.sin(g)*m;d.normalize(l,h);h=q?a/Math.sqrt(Math.abs(k[3]**2-d.dot(b,l)**2)):a/k[3];b=g/Math.sqrt(Math.abs(k[3]**2-d.dot(b,e)**2));wa.set(t,h,b)}function ia(a,c,b,e,h,k,g,m,q,t){d.cross(J,a,c);A.coordinateSystemFromOneAxisAndNormalVector(k.up,k.eye,L,M,N);A.coordinateSystemFromOneAxisAndNormalVector([0,0,1],k.eye,u,v,ja);d.copy(b,v);d.copy(e,u);d.normalize(b,b);d.scale(b,b,d.length(J));A.vectorCoordinates(a,d.normalize(M,M),d.normalize(N,N),d.normalize(L,L),ka);A.vectorCoordinates(c,
M,N,L,la);ha(ka,la,a,u,v,g,m,q,t,h)}function ma(a,c,b,e,h,k,g){r.fromRotation(O,h,e);r.fromRotation(P,g,k);r.multiply(z,O,P);d.subtract(c,a,b);d.transformMat4(c,c,z);d.add(c,c,b)}function na(a,c,b,e,h,k){r.fromRotation(O,e,b);r.fromRotation(P,k,h);r.multiply(z,O,P);d.subtract(l,a.eye,c);d.transformMat4(l,l,z);a.eye=d.add(l,l,c);d.subtract(l,a.center,c);d.transformMat4(l,l,z);a.center=d.add(l,l,c);d.subtract(l,a.up,c);d.transformMat4(l,l,z);a.up=d.add(l,l,c)}function W(a,c,b,e,h,k){return(Math.abs(e)>
Math.PI-C.Angle||Math.abs(e)<C.Angle)&&(Math.abs(a[2])<b*C.Pole||Math.abs(c)>b)&&k.aboveGround&&h<C.Tilt}function oa(a,c,b,e,h,k){k?(F.fromPoints(b,e,pa),S(c,a,pa)):(b=ea(b,e,qa,c,a[3],h),S(c,a,F.wrapAxisAngle(qa,b)))}function ra(a,c,b,e,h,k,g){const m=g?20:1;d.copy(w,e);Q.copyFrom(c);let q;for(let t=0;t<m&&1E-12<d.squaredDistance(b,w);t++)if(e=d.squaredDistance(b,w),ia(b,w,v,u,D,Q,a,h,k,g),na(Q,a,u,D[1],v,D[0]),ma(w,w,a,u,D[1],v,D[0]),q=d.squaredDistance(b,w),q<e||0===t)c.copyFrom(Q);else break}
f.SpherePickPointFallback=void 0;(function(a){a[a.Ellipsoid=0]="Ellipsoid";a[a.Silhouette=1]="Silhouette"})(f.SpherePickPointFallback||(f.SpherePickPointFallback={}));const sa=va.createScreenPointArray();f.NavigationMode=void 0;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(f.NavigationMode||(f.NavigationMode={}));const X={Elevation:3E4,Angle:p.deg2rad(6)},C={Pole:.95,Angle:p.deg2rad(18),Tilt:45},U=p.deg2rad(80),Y=n.create(),I=n.create(),y=n.create(),da=B.create(),fa=n.create(),
u=n.create(),v=n.create(),ja=n.create(),L=n.create(),M=n.create(),N=n.create(),ka=n.create(),la=n.create(),D=xa.create(),pa=F.create(),O=E.create(),P=E.create(),z=E.create(),w=n.create(),l=n.create(),K=n.create(),Q=new za.Camera,J=n.create(),qa=n.create(),T={origin:n.create(),direction:n.create()},ta={origin:n.create(),direction:n.create()};f.DISTANCE_CLAMP_VALUES=[1,3E8];f.PIVOT_DISTANCE_MODIFIER=30;f.PreservingHeadingThreshold=C;f.SCREEN_PIXEL_AREA=70;f.TiltThresholdPanningSpeed=U;f.VerticalPanTresholds=
X;f.applyPanPlanar=function(a,c,b){d.subtract(Y,b,c);a.eye=d.subtract(l,a.eye,Y);a.center=d.subtract(l,a.center,Y)};f.applyPanSphericalDirectRotation=oa;f.applyPanSphericalPreserveHeading=ra;f.applyRotation=S;f.applyRotationWithTwoAxes=na;f.applyZoomOnSphere=function(a,c,b){c.getScreenCenter(sa);aa.intersectScreen(a,c,sa,l)&&(c.center=l);a=c.distance;b*=a;1E-6>Math.abs(a-b)||(b=d.scale(G.sv3d.get(),c.viewForward,b),c.eye=d.subtract(l,c.center,b))};f.applyZoomToPoint=function(a,c,b,e){const h=G.sv3d.get();
b=1-b;d.subtract(h,c,a.eye);const k=d.length(h);let g=k*(1-b);0<=b&&g<e&&(g=e,b=-(g-k)/k);1E-6>Math.abs(k-g)||(d.scale(h,h,b),a.eye=d.add(l,a.eye,h),a.center=d.lerp(l,a.center,c,b))};f.centroid=function(a,c){d.set(c,0,0,0);for(const b of a)d.add(c,c,b);d.scale(c,c,1/a.length)};f.decideNavigationMode=function(a,c,b,e){if(d.length(a.eye)-e.radius>X.Elevation)return f.NavigationMode.Horizontal;if(!b)return f.NavigationMode.Vertical;H.fromScreenAtEye(a,c,ta);return-Math.sign(a.relativeElevation)*(.5*
Math.PI+ya.angle(a.eye,ta.direction))<X.Angle?f.NavigationMode.Vertical:f.NavigationMode.Horizontal};f.intersectPlaneFromScreenPoint=function(a,c,b,e){return B.intersectRay(a,H.fromScreen(c,b,T),e)};f.intersectPlaneFromScreenPointAtEye=function(a,c,b,e){return B.intersectRay(a,H.fromScreenAtEye(c,b,T),e)};f.lengthFromPoints=V;f.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);b[1]=c[1]/(a.fullHeight/a.pixelRatio);return b};f.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=
2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};f.offSurfaceTiltToEyeTiltGlobal=function(a,c,b,e){return ba(Math.PI/2,c,b,e)+(a-Math.PI/2)};f.onSurfaceTiltToEyeTiltGlobal=ba;f.panMotionToRotationMatrix=function(a,c,b,e,h,k,g,m,q){if(W(a.center,d.dot(a.up,a.center),d.length(a.center),-x.cyclicalPI.normalize(p.deg2rad(k)),g,c))switch(a=-x.cyclicalPI.normalize(p.deg2rad(h)),{eye:h}=c,A.coordinateSystemFromOneAxisAndNormalVector([0,0,1],h,u,v,ja),h=b.translation[0]*e.pan,k="zoom"===q.mode?0:b.translation[1]*
e.pan,c=Math.max(Math.sqrt(Math.abs(1-d.dot(c.center,u)**2/d.length(c.center)**2)),.5),g=-Math.cos(a)*k+Math.sin(a)*h,r.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(a)*k+Math.cos(a)*h)/c,u),m.pan.enabled=!0,q.mode){case "pan":r.rotate(m.pan.matrix,m.pan.matrix,g,v);m.pan.enabled=!0;break;case "zoom":m.zoom=-b.translation[1]*e.zoom}else{const {eye:t,viewRight:ua}=c;c=d.cross(G.sv3d.get(),ua,t);a=b.translation[0]*e.pan;0!==a&&(r.rotate(m.pan.matrix,m.pan.matrix,-a,c),m.pan.enabled=!0);switch(q.mode){case "pan":b=
b.translation[1]*e.pan;0!==b&&(r.rotate(m.pan.matrix,m.pan.matrix,b,ua),m.pan.enabled=!0);break;case "zoom":m.zoom=-b.translation[1]*e.zoom}}};f.panToPosition=function(a,c,b,e,h,k,g){W(b,d.dot(c.up,b),a[3],-x.cyclicalPI.normalize(p.deg2rad(h)),k,c)?ra(a,c,b,e,-x.cyclicalPI.normalize(p.deg2rad(h)),k,g):oa(a,c,b,e,k,g)};f.pickPointAndInitSphere=function(a,c,b,e,h,k){const g=n.create(),m=R.create();let q=!0,t=!0;a.intersectScreen(b,g,k)?m[3]=d.length(g):(t=!1,m[3]=c.aboveGround&&h!==f.SpherePickPointFallback.Ellipsoid?
Math.max(d.length(c.center),.9*e.radius):d.length(c.eye)-c.relativeElevation,h===f.SpherePickPointFallback.Silhouette?ca(m,c,b,g):q=aa.intersectScreen(m,c,b,g));return{sphere:m,scenePickPoint:q?g:null,hasGeometryIntersection:t}};f.preserveHeadingThreshold=W;f.rotatePointAroundTwoAxes=ma;f.rotationAngleAndAxisDirectRotation=ea;f.rotationAnglesAndAxesHeadingPreserving=ia;f.rotationAnglesHeadingPreserving=ha;f.sphereOrPlanePointFromScreenPoint=ca;Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});