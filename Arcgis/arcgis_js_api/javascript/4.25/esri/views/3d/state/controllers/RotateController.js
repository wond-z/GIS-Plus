// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(c,y,z,A,q,E,F,M,N,G,B,H,I,C,d,k,J,K,r,v,w,D,L,t){c.PivotPoint=void 0;(function(l){l[l.CENTER=0]="CENTER";l[l.EYE=1]="EYE"})(c.PivotPoint||(c.PivotPoint={}));c.RotateController=function(l){function u(a){a=l.call(this,a)||this;a.pivot=c.PivotPoint.CENTER;a._lastPoint=C.create();a._tmpWorldUp=k.create();a._tmpViewDir=k.create();a._tmpRotCurPoint=C.create();a._tmpTransf=H.create();a._tmpAxis=k.create();a._tmpPivotPoint=k.create();a._pivotPos=k.create();a._constraintOptions={selection:r.ConstraintTypes.ALL,
interactionType:v.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:w.TiltMode.TUMBLE};return a}y._inheritsLoose(u,l);var m=u.prototype;m.initialize=function(){this._rotScale=this.pivot===c.PivotPoint.CENTER?3:1.5};m.begin=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:d.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=v.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=w.TiltMode.LOOK_AROUND;
this._constraintOptions.selection=r.ConstraintTypes.NONE;break;case c.PivotPoint.CENTER:const e=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos);e||d.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(a,e);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=v.InteractionType.TUMBLE;this._constraintOptions.tiltMode=w.TiltMode.TUMBLE;this._constraintOptions.selection=r.ConstraintTypes.ALL&~r.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=
this.startCamera;t.normalizeCoordinate(this.startCamera,a,this._lastPoint)}};m._constrainPivotPoint=function(a,e){const b=this.startCamera,f=k.create();d.subtract(f,this._pivotPos,b.eye);const n=d.length(f);let g=Math.min(n,7*Math.abs(this.view.camera.position.z));var p=J.getReferenceEllipsoid(this.view.spatialReference),h=E.createScreenPointArray(b.width/b.pixelRatio*.5,b.height/b.pixelRatio*.5);p=t.decideNavigationMode(this.startCamera,h,!0,p);h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
b.fullWidth/b.pixelRatio*.5,b.fullHeight/b.pixelRatio*.5,b,225,90);a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,a[0],a[1],b,90);if(q.isSome(h)||q.isSome(a))h=q.unwrapOr(h,a),a=q.isNone(a)||p===t.NavigationMode.Horizontal?h:a,g=h>a?a:h,g=e?Math.min(g,n):g;d.normalize(f,f);d.copy(this._pivotPos,d.add(this._tmpPivotPoint,b.eye,d.scale(this._tmpPivotPoint,f,g)))};m.update=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
a,this.currentCamera.center,this._pivotPos);break;case c.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,a,this.currentCamera.eye,this._pivotPos)}K.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}};m.end=function(){this.active&&this.finishController()};m._applyRotation=function(a,e,b,f){this.view.renderCoordsHelper.worldUpAtPosition(f,this._tmpWorldUp);t.normalizeCoordinate(a,e,this._tmpRotCurPoint);
e=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;d.subtract(this._tmpViewDir,b,f);b=d.length(this._tmpViewDir);b=A.acosClamped(d.dot(this._tmpViewDir,this._tmpWorldUp)/b);if(this.pivot===c.PivotPoint.EYE){const g=.5*Math.PI-b,p=.495*Math.PI;e=g-Math.max(-p,Math.min(p,g+-.5*e))}e=A.clamp(e+b,D.TiltDefault.min,D.TiltDefault.max)-b;d.cross(this._tmpAxis,a.up,this._tmpViewDir);this.pivot===c.PivotPoint.CENTER&&(n=-n);B.fromRotation(this._tmpTransf,
n,this._tmpWorldUp);B.rotate(this._tmpTransf,this._tmpTransf,e,this._tmpAxis);d.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);a.up=d.transformMat4(x,a.up,this._tmpTransf);d.add(x,f,this._tmpViewDir);I.copy(this._lastPoint,this._tmpRotCurPoint);return x};y._createClass(u,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return u}(L.InteractiveController);z.__decorate([F.property()],c.RotateController.prototype,"pivot",void 0);c.RotateController=
z.__decorate([G.subclass("esri.views.3d.state.controllers.RotateController")],c.RotateController);const x=k.create();Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});