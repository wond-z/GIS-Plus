// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(d,l,h,p,q,m,t,u,r,n){d.TextureCollection=function(k){function f(a,b){var e=k.call(this,{})||this;e._stage=a;e._textureRequests=new Map;e._frameTask=b?.registerTask(n.TaskPriority.TEXTURE_UNLOAD)??
n.ImmediateTask;return e}l._inheritsLoose(f,k);var c=f.prototype;c.normalizeCtorArgs=function(){return{}};c.destroy=function(){k.prototype.destroy.call(this);this._frameTask.remove();this._textureRequests.forEach(a=>this._releaseTextureRequest(a));this._textureRequests.clear()};c.fromData=function(a,b,e){const g=this.makeUid(a);a=this._textureRequests.get(g);a||(a={referenceCount:0,texture:b(),textureAsync:null,abortController:null,onRemove:e},this._stage&&(this._stage.add(a.texture),this._stage.loadImmediate(a.texture)),
this._textureRequests.set(g,a));a.referenceCount++;return{uid:g,texture:a.texture,release:()=>this._release(g)}};c._release=function(a){const b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)};c._releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);
!b||0<b.referenceCount||(this._releaseTextureRequest(b),this._textureRequests.delete(a))}};c._releaseTextureRequest=function(a){if(a.onRemove)a.onRemove();a.texture?this._stage?.remove(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};c.makeUid=function(a,b=null){return q.isSome(b)?`${a}.${b}px`:a};l._createClass(f,[{key:"updating",get:function(){return this._frameTask.updating}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return f}(p);
h.__decorate([m.property()],d.TextureCollection.prototype,"_frameTask",void 0);h.__decorate([m.property()],d.TextureCollection.prototype,"updating",null);d.TextureCollection=h.__decorate([r.subclass("esri.views.3d.support.TextureCollection")],d.TextureCollection);Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});