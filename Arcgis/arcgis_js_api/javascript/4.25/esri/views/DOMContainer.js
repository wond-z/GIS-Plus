// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(t,l,f,m,A,u,k,v,g,E,F,B,w,x){function y(e){e&&(m.empty(e),e.parentNode&&e.parentNode.removeChild(e))}const p=[0,0];t.DOMContainer=e=>{e=function(z){function n(...a){var b=
z.call(this,...a)||this;b._freqInfo={freq:16,time:750};b._overlayRenderTaskHandle=null;b.height=0;b.overlay=null;b.position=null;b.resizing=!1;b.root=null;b.surface=null;b.suspended=!0;b.ui=null;b.userContent=null;b.width=0;b.widthBreakpoint=null;if(0===a.length||void 0===a[0]?.popup)b.popup=new x({view:l._assertThisInitialized(b)});b.handles.add([k.watch(()=>b.cursor,c=>{const {surface:d}=l._assertThisInitialized(b);d&&d.setAttribute("data-cursor",c)}),k.watch(()=>b.interacting,c=>{const {surface:d}=
l._assertThisInitialized(b);d&&d.setAttribute("data-interacting",c.toString())})]);return b}l._inheritsLoose(n,z);var h=n.prototype;h.initialize=function(){this.handles.add(k.watch(()=>this.ui,(a,b)=>this._handleUIChange(a,b)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};h.destroy=function(){this.destroyed||(this.ui=u.destroyMaybe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=
null)};h.blur=function(){this.surface&&this.surface.blur()};h.focus=function(){this.surface&&this.surface.focus()};h.pageToContainer=function(a,b,c){const d=this.position;a-=d?d[0]:0;b-=d?d[1]:0;c?(c[0]=a,c[1]=b):c=[a,b];return c};h.containerToPage=function(a,b,c){const d=this.position;a+=d?d[0]:0;b+=d?d[1]:0;c?(c[0]=a,c[1]=b):c=[a,b];return c};h._handleUIChange=function(a,b){b&&(this.handles.remove("ui"),b.destroy());a&&this._wireUI(a);this._set("ui",a)};h._wireUI=function(a){this.handles.remove("ui");
a&&(a.view=this,this.handles.add([k.watch(()=>this.root,b=>{if(b){const c=document.createElement("div");b.appendChild(c);b=c}else b=null;a.container=b},k.initial),k.watch(()=>this.popup,(b,c)=>{c&&a.remove(c,"popup");b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))},k.initial)],"ui"))};h._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};h._startMeasuring=function(){const a=this._freqInfo;a.freq=16;a.time=750;this.handles.add([(()=>
{const b=()=>{a.freq=16;a.time=750};window.addEventListener("resize",b);return{remove(){window.removeEventListener("resize",b)}}})(),v.addFrameTask({prepare:b=>{const c=this._measure(),d=this._freqInfo;d.time+=b.deltaTime;c&&(d.freq=16,this._get("resizing")||this._set("resizing",!0));d.time<d.freq||(d.time=0,this._position()||c?d.freq=16:d.freq=Math.min(750,2*d.freq),!c&&512<=d.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};h._measure=function(){var a=
this.container;const b=a?a.clientWidth:0;a=a?a.clientHeight:0;if(0===b||0===a)return this.suspended||this._set("suspended",!0),!1;const c=this.width,d=this.height;if(b===c&&a===d)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",a);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:c,oldHeight:d,width:b,height:a});return!0};h._position=function(){var a=this.container;const b=this.position;var c;if(c=a)c=(a.ownerDocument||window.document).defaultView,
a=a.getBoundingClientRect(),p[0]=a.left+(c?.pageXOffset??0),p[1]=a.top+(c?.pageYOffset??0),c=p;a=c;return a?b&&a[0]===b[0]&&a[1]===b[1]?!1:(this._set("position",[a[0],a[1]]),!0):!1};h.forceDOMReadyCycle=function(){};l._createClass(n,[{key:"container",get:function(){return this._get("container")??null},set:function(a){const b=this._get("container");var c=m.byId(a);(c=c instanceof HTMLDivElement?c:null)||"string"!==typeof a||A.getLogger(this.declaredClass).error("#container",`element with id '${a}' not found`);
if(b!==c)if(this.handles.remove("dom-size"),this._stopMeasuring(),b&&(b.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(y(this.root),this._set("root",null)),this.userContent&&(m.reparent(this.userContent,b),y(this.userContent),this._set("userContent",null))),c){c.classList.add("esri-view");a=document.createElement("div");a.className=
"esri-view-user-storage";m.reparent(c,a);c.appendChild(a);this._set("userContent",a);a=document.createElement("div");a.className="esri-view-root";c.insertBefore(a,c.firstChild);this._set("root",a);var d=document.createElement("div");d.className="esri-view-surface";d.setAttribute("role","application");d.tabIndex=0;a.appendChild(d);this._set("surface",d);var q=new w;a.appendChild(q.surface);this._set("overlay",q);k.watch(()=>q.needsRender,r=>{this._overlayRenderTaskHandle=r&&!this._overlayRenderTaskHandle?
v.addFrameTask({render:()=>this.overlay?.render()}):u.removeMaybe(this._overlayRenderTaskHandle)});this.forceDOMReadyCycle();this.handles.add(k.watch(()=>this.size,r=>{const [C,D]=r;C>=document.body.clientWidth||D>=document.body.clientHeight?d.classList.add("esri-view-surface--inset-outline"):d.classList.remove("esri-view-surface--inset-outline")},k.initial),"dom-size");this._set("container",c);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",
!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const a=document.activeElement===this.surface;return document.hasFocus()&&a}},{key:"popup",set:function(a){const b=this._get("popup");b&&b!==a&&b.destroy();this._set("popup",a)}},{key:"size",get:function(){return[this.width,this.height]}}]);return n}(e);f.__decorate([g.property()],e.prototype,"container",null);f.__decorate([g.property({readOnly:!0})],e.prototype,"focused",null);f.__decorate([g.property({readOnly:!0})],
e.prototype,"height",void 0);f.__decorate([g.property({type:x})],e.prototype,"popup",null);f.__decorate([g.property({type:w})],e.prototype,"overlay",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"position",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"resizing",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"root",void 0);f.__decorate([g.property({value:null,readOnly:!0})],e.prototype,"size",null);f.__decorate([g.property({readOnly:!0})],e.prototype,"surface",
void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"suspended",void 0);f.__decorate([g.property()],e.prototype,"ui",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"userContent",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"width",void 0);f.__decorate([g.property()],e.prototype,"widthBreakpoint",void 0);return e=f.__decorate([B.subclass("esri.views.DOMContainer")],e)};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});