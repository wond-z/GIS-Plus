// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
require({cache:{"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){function w(ca=W){return{plane:e.create(ca.plane),origin:h.clone(ca.origin),basis1:h.clone(ca.basis1),basis2:h.clone(ca.basis2)}}
function u(ca,fa,ea){const da=ma.get();da.origin=ca;da.basis1=fa;da.basis2=ea;da.plane=e.wrap(0,0,0,0);C(da);return da}function z(ca,fa=w()){return B(ca.origin,ca.basis1,ca.basis2,fa)}function y(ca,fa){g.copy(fa.origin,ca.origin);g.copy(fa.basis1,ca.basis1);g.copy(fa.basis2,ca.basis2);e.copy(fa.plane,ca.plane)}function B(ca,fa,ea,da=w()){g.copy(da.origin,ca);g.copy(da.basis1,fa);g.copy(da.basis2,ea);C(da);1E-6<Math.abs(g.dot(da.basis1,da.basis2)/(g.length(da.basis1)*g.length(da.basis2)))&&X.warn("fromValues()",
"Provided basis vectors are not perpendicular");1E-6<Math.abs(g.dot(da.basis1,S(da)))&&X.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-g.dot(S(da),da.origin)-da.plane[3])&&X.warn("fromValues()","Plane offset is not consistent with plane origin");return da}function C(ca){e.fromVectorsAndPoint(ca.basis2,ca.basis1,ca.origin,ca.plane)}function k(ca,fa,ea){ca!==ea&&z(ca,ea);ca=g.scale(t.sv3d.get(),S(ca),fa);g.add(ea.origin,ea.origin,ca);ea.plane[3]-=fa;return ea}
function q(ca,fa,ea){x(fa,ea);k(ea,E(ca,ca.origin),ea);return ea}function x(ca,fa=w()){const ea=(ca[2]-ca[0])/2,da=(ca[3]-ca[1])/2;g.set(fa.origin,ca[0]+ea,ca[1]+da,0);g.set(fa.basis1,ea,0,0);g.set(fa.basis2,0,da,0);e.fromValues(0,0,1,0,fa.plane);return fa}function v(ca,fa,ea){return e.intersectRay(ca.plane,fa,ea)?U(ca,ea):!1}function D(ca,fa,ea){if(v(ca,fa,ea))return ea;ca=F(ca,fa,t.sv3d.get());g.add(ea,fa.origin,g.scale(t.sv3d.get(),fa.direction,g.distance(fa.origin,ca)/g.length(fa.direction)));
return ea}function F(ca,fa,ea){const da=aa.get();var la=aa.get();R(ca,fa,da,la);la=Number.POSITIVE_INFINITY;for(const ra of ha){var oa=V(ca,ra,ba.get());const Aa=t.sv3d.get();e.intersectLineSegment(da,oa,Aa)&&(oa=g.direction(t.sv3d.get(),fa.origin,Aa),oa=Math.abs(r.acosClamped(g.dot(fa.direction,oa))),oa<la&&(la=oa,g.copy(ea,Aa)))}return la===Number.POSITIVE_INFINITY?G(ca,fa,ea):ea}function G(ca,fa,ea){if(v(ca,fa,ea))return ea;const da=aa.get(),la=aa.get();R(ca,fa,da,la);let oa=Number.POSITIVE_INFINITY;
for(const Aa of ha){var ra=V(ca,Aa,ba.get());const ua=t.sv3d.get();e.intersectLineSegmentClamp(da,ra,ua)&&(ra=l.distance2(fa,ua),e.isPointInside(la,ua)&&ra<oa&&(oa=ra,g.copy(ea,ua)))}K(ca,fa.origin)<oa&&J(ca,fa.origin,ea);return ea}function J(ca,fa,ea){var da=e.projectPoint(ca.plane,fa,t.sv3d.get());fa=f.projectPointClamp(Y(ca,ca.basis1),da,-1,1,t.sv3d.get());da=f.projectPointClamp(Y(ca,ca.basis2),da,-1,1,t.sv3d.get());g.subtract(ea,g.add(t.sv3d.get(),fa,da),ca.origin);return ea}function L(ca,fa,
ea){const {origin:da,basis1:la,basis2:oa}=ca,ra=g.subtract(t.sv3d.get(),fa,da);fa=A.projectPointSignedLength(la,ra);const Aa=A.projectPointSignedLength(oa,ra);ca=A.projectPointSignedLength(S(ca),ra);return g.set(ea,fa,Aa,ca)}function K(ca,fa){fa=L(ca,fa,t.sv3d.get());const {basis1:ea,basis2:da}=ca;ca=g.length(ea);var la=g.length(da);ca=Math.max(Math.abs(fa[0])-ca,0);la=Math.max(Math.abs(fa[1])-la,0);fa=fa[2];return ca*ca+la*la+fa*fa}function O(ca,fa){return Math.sqrt(K(ca,fa))}function P(ca,fa){let ea=
Number.NEGATIVE_INFINITY;for(const la of ha){var da=V(ca,la,ba.get());da=f.distance2(da,fa);da>ea&&(ea=da)}return Math.sqrt(ea)}function N(ca,fa){return e.isPointInside(ca.plane,fa)&&U(ca,fa)}function H(ca,fa,ea,da){switch(ea){case d.Axis.X:g.copy(da,ca.basis1);g.normalize(da,da);break;case d.Axis.Y:g.copy(da,ca.basis2);g.normalize(da,da);break;case d.Axis.Z:g.copy(da,S(ca))}return da}function E(ca,fa){const ea=-ca.plane[3];return A.projectPointSignedLength(S(ca),fa)-ea}function I(ca,fa,ea,da){const la=
E(ca,fa);ca=g.scale(ia,S(ca),ea-la);g.add(da,fa,ca);return da}function M(ca,fa){return g.exactEquals(ca.basis1,fa.basis1)&&g.exactEquals(ca.basis2,fa.basis2)&&g.exactEquals(ca.origin,fa.origin)}function Q(ca,fa,ea){ca!==ea&&z(ca,ea);n.invert(ka,fa);n.transpose(ka,ka);g.transformMat4(ea.basis1,ca.basis1,ka);g.transformMat4(ea.basis2,ca.basis2,ka);g.transformMat4(e.normal(ea.plane),e.normal(ca.plane),ka);g.transformMat4(ea.origin,ca.origin,fa);e.setOffsetFromPoint(ea.plane,ea.plane,ea.origin);return ea}
function T(ca,fa,ea,da){ca!==da&&z(ca,da);n.fromRotation(Z,fa,ea);g.transformMat4(da.basis1,ca.basis1,Z);g.transformMat4(da.basis2,ca.basis2,Z);C(da);return da}function S(ca){return e.normal(ca.plane)}function U(ca,fa){const ea=g.subtract(t.sv3d.get(),fa,ca.origin);fa=g.squaredLength(ca.basis1);const da=g.squaredLength(ca.basis2),la=g.dot(ca.basis1,ea);ca=g.dot(ca.basis2,ea);return 0>-la-fa&&0>la-fa&&0>-ca-da&&0>ca-da}function Y(ca,fa){const ea=ba.get();g.copy(ea.origin,ca.origin);g.copy(ea.vector,
fa);return ea}function V(ca,fa,ea){const {basis1:da,basis2:la,origin:oa}=ca;ca=g.scale(t.sv3d.get(),da,fa.origin[0]);const ra=g.scale(t.sv3d.get(),la,fa.origin[1]);g.add(ea.origin,ca,ra);g.add(ea.origin,ea.origin,oa);ca=g.scale(t.sv3d.get(),da,fa.direction[0]);fa=g.scale(t.sv3d.get(),la,fa.direction[1]);g.scale(ea.vector,g.add(ca,ca,fa),2);return ea}function R(ca,fa,ea,da){ca=S(ca);e.fromVectorsAndPoint(ca,fa.direction,fa.origin,ea);e.fromVectorsAndPoint(e.normal(ea),ca,fa.origin,da)}const X=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");
b=function(){this.plane=e.create();this.origin=h.create();this.basis1=h.create();this.basis2=h.create()};const W={plane:e.create(),origin:h.fromValues(0,0,0),basis1:h.fromValues(1,0,0),basis2:h.fromValues(0,1,0)},aa=new m.ObjectStack(e.create),ba=new m.ObjectStack(f.create),ia=h.create(),ma=new m.ObjectStack(()=>w()),ha=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ka=p.create(),Z=p.create();m=Object.freeze(Object.defineProperty({__proto__:null,
BoundedPlaneClass:b,create:w,wrap:u,copy:z,copyWithoutVerify:y,fromValues:B,updateUnboundedPlane:C,elevate:k,setExtent:q,fromAABoundingRect:x,intersectRay:v,intersectRayClosestSilhouette:D,closestPointOnSilhouette:F,closestPoint:G,projectPoint:J,projectPointLocal:L,distance2:K,distance:O,distanceToSilhouette:P,extrusionContainsPoint:N,axisAt:H,altitudeAt:E,setAltitudeAt:I,equals:M,transform:Q,rotate:T,normal:S,UP:W},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.UP=W;a.altitudeAt=E;
a.axisAt=H;a.boundedPlane=m;a.closestPoint=G;a.closestPointOnSilhouette=F;a.copy=z;a.copyWithoutVerify=y;a.create=w;a.distance=O;a.distance2=K;a.distanceToSilhouette=P;a.elevate=k;a.equals=M;a.extrusionContainsPoint=N;a.fromAABoundingRect=x;a.fromValues=B;a.intersectRay=v;a.intersectRayClosestSilhouette=D;a.normal=S;a.projectPoint=J;a.projectPointLocal=L;a.rotate=T;a.setAltitudeAt=I;a.setExtent=q;a.transform=Q;a.updateUnboundedPlane=C;a.wrap=u})},"esri/core/ObjectStack":function(){define(["exports",
"./nextTick"],function(a,b){let c=function(){function r(n){this._allocator=n;this._items=[];this._itemsPtr=0;this._grow()}var m=r.prototype;m.get=function(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};m._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};m._grow=function(){for(let n=0;n<Math.max(8,Math.min(this._items.length,
1024));n++)this._items.push(this._allocator())};return r}();a.ObjectStack=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]]}function r(g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){return[g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q]}function m(g,h){return new Float64Array(g,
h,16)}const n=b(),p=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,IDENTITY:n},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=n;a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.mat4f64=p})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,b,c,r,m,n){function p(t){return t?{origin:m.clone(t.origin),vector:m.clone(t.vector)}:{origin:m.create(),vector:m.create()}}function g(t,w){const u=A.get();u.origin=t;u.vector=w;return u}function h(t,w,u=p()){r.copy(u.origin,t);r.copy(u.vector,w);return u}function d(t,w){w=r.subtract(n.sv3d.get(),w,t.origin);var u=r.dot(t.vector,w);const z=r.dot(t.vector,t.vector);u=b.clamp(u/z,0,1);t=r.subtract(n.sv3d.get(),r.scale(n.sv3d.get(),t.vector,u),w);return r.dot(t,t)}function f(t,w,u,z,y){const {vector:B,
origin:C}=t;w=r.subtract(n.sv3d.get(),w,C);w=r.dot(B,w)/r.squaredLength(B);r.scale(y,B,b.clamp(w,u,z));return r.add(y,y,t.origin)}function e(t,w,u,z){const y=t.origin;var B=r.add(n.sv3d.get(),y,t.vector);t=w.origin;var C=r.add(n.sv3d.get(),t,w.vector),k=n.sv3d.get();w=n.sv3d.get();k[0]=y[0]-t[0];k[1]=y[1]-t[1];k[2]=y[2]-t[2];w[0]=C[0]-t[0];w[1]=C[1]-t[1];w[2]=C[2]-t[2];if(1E-6>Math.abs(w[0])&&1E-6>Math.abs(w[1])&&1E-6>Math.abs(w[2]))return!1;C=n.sv3d.get();C[0]=B[0]-y[0];C[1]=B[1]-y[1];C[2]=B[2]-
y[2];if(1E-6>Math.abs(C[0])&&1E-6>Math.abs(C[1])&&1E-6>Math.abs(C[2]))return!1;B=k[0]*w[0]+k[1]*w[1]+k[2]*w[2];var q=w[0]*C[0]+w[1]*C[1]+w[2]*C[2];const x=w[0]*w[0]+w[1]*w[1]+w[2]*w[2],v=(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])*x-q*q;if(1E-6>Math.abs(v))return!1;k=(B*q-(k[0]*C[0]+k[1]*C[1]+k[2]*C[2])*x)/v;B=(B+q*k)/x;u&&(k=b.clamp(k,0,1),B=b.clamp(B,0,1));u=n.sv3d.get();q=n.sv3d.get();u[0]=y[0]+k*C[0];u[1]=y[1]+k*C[1];u[2]=y[2]+k*C[2];q[0]=t[0]+B*w[0];q[1]=t[1]+B*w[1];q[2]=t[2]+B*w[2];z.tA=k;z.tB=B;z.pA=u;
z.pB=q;z.distance2=r.squaredDistance(u,q);return!0}const l={tA:0,tB:0,pA:m.create(),pB:m.create(),distance2:0},A=new c.ObjectStack(()=>p());a.closestLineSegmentDistance2=function(t,w){return e(t,w,!0,l)?l.distance2:null};a.closestLineSegmentPoint=function(t,w,u){return e(t,w,!0,l)?(r.copy(u,l.pA),!0):!1};a.closestRayDistance2=function(t,w){if(e(t,g(w.origin,w.direction),!1,l)){const {tA:u,pB:z,distance2:y}=l;if(0<=u&&1>=u)return y;if(0>u)return r.squaredDistance(t.origin,z);if(1<u)return r.squaredDistance(r.add(n.sv3d.get(),
t.origin,t.vector),z)}return null};a.copy=function(t,w=p()){return h(t.origin,t.vector,w)};a.create=p;a.distance=function(t,w){return Math.sqrt(d(t,w))};a.distance2=d;a.fromPoints=function(t,w,u=p()){r.copy(u.origin,t);r.subtract(u.vector,w,t);return u};a.fromValues=h;a.pointAt=function(t,w,u){return r.add(u,t.origin,r.scale(u,t.vector,w))};a.projectPoint=function(t,w,u){return f(t,w,0,1,u)};a.projectPointClamp=f;a.wrap=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),r=b.VectorStack.createVec3f64(),m=b.VectorStack.createVec4f64(),n=b.VectorStack.createMat3f64(),p=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=n;a.sm4d=p;a.sq4d=b;a.sv2d=c;a.sv3d=r;a.sv4d=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(){function l(t,w,u){this._itemByteSize=t;this._itemCreate=w;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(u/this._itemByteSize)}var A=l.prototype;A.get=function(){0===this._itemsPtr&&r.nextTick(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const w=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let u=0;u<this._itemsPerBuffer;++u)this._items.push(this._itemCreate(w,
u*this._itemByteSize));this._buffers.push(w)}return this._items[this._itemsPtr++]};A._reset=function(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};l.createVec2f64=function(t=e){return new l(16,g.createView,t)};l.createVec3f64=function(t=e){return new l(24,h.createView,t)};l.createVec4f64=function(t=e){return new l(32,d.createView,t)};l.createMat3f64=function(t=
e){return new l(72,m.createView,t)};l.createMat4f64=function(t=e){return new l(128,n.createView,t)};l.createQuatf64=function(t=e){return new l(32,p.createView,t)};b._createClass(l,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}]);return l}();const e=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/byteSizeEstimations":function(){define(["exports"],
function(a){function b(m){return 32+m.length}function c(m){if(!m)return 0;if(Array.isArray(m)){var n=m.length;if(0===n||"number"===typeof m[0])m=32+8*n;else{var p=32;for(let g=0;g<n;g++)p+=r(m[g]);m=p}return m}p=32;for(n in m)m.hasOwnProperty(n)&&(p+=r(m[n]));return p}function r(m){switch(typeof m){case "object":return c(m);case "string":return b(m);case "number":return 16;case "boolean":return 4;default:return 8}}a.ByteSizeUnit=void 0;(function(m){m[m.KILOBYTES=1024]="KILOBYTES";m[m.MEGABYTES=1048576]=
"MEGABYTES";m[m.GIGABYTES=1073741824]="GIGABYTES"})(a.ByteSizeUnit||(a.ByteSizeUnit={}));a.estimateAttributesObjectSize=function(m){if(!m)return 0;let n=32;for(const p in m)if(m.hasOwnProperty(p)){const g=m[p];switch(typeof g){case "string":n+=b(g);break;case "number":n+=16;break;case "boolean":n+=4}}return n};a.estimateFixedArraySize=function(m,n){return 32+m.length*n};a.estimateNestedObjectSize=c;a.estimateNumberByteSize=function(m){return 16};a.estimateStringByteSize=b;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(p){return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8]]}function r(p,g,h,d,f,e,l,A,t){return[p,g,h,d,f,e,l,A,t]}function m(p,g){return new Float64Array(p,g,9)}const n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;
a.createView=m;a.fromValues=r;a.mat3f64=n})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function c(g){return[g[0],g[1],g[2],g[3]]}function r(g,h,d,f){return[g,h,d,f]}function m(g,h){return new Float64Array(g,h,4)}const n=b(),p=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,IDENTITY:n},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=n;a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.quatf64=p})},
"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function c(w){return[w[0],w[1]]}function r(w,u){return[w,u]}function m(w){const u=[0,0],z=Math.min(2,w.length);for(let y=0;y<z;++y)u[y]=w[y];return u}function n(w,u){return new Float64Array(w,u,2)}function p(){return[0,0]}function g(){return[1,1]}function h(){return[1,0]}function d(){return[0,1]}const f=[0,0],e=[1,1],l=[1,0],A=[0,1],t=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,
fromArray:m,createView:n,zeros:p,ones:g,unitX:h,unitY:d,ZEROS:f,ONES:e,UNIT_X:l,UNIT_Y:A},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=l;a.UNIT_Y=A;a.ZEROS=f;a.clone=c;a.create=b;a.createView=n;a.fromArray=m;a.fromValues=r;a.ones=g;a.unitX=h;a.unitY=d;a.vec2f64=t;a.zeros=p})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(G=x){return[G[0],G[1],G[2],G[3]]}function f(G,J){return e(J[0],J[1],J[2],J[3],G)}function e(G,J,L,K,O=d()){O[0]=G;O[1]=J;O[2]=L;O[3]=K;return O}function l(G,J,L){var K=J[0]*J[0]+J[1]*J[1]+J[2]*J[2];K=1E-5<Math.abs(K-1)&&1E-12<K?1/Math.sqrt(K):1;L[0]=J[0]*K;L[1]=J[1]*K;L[2]=J[2]*K;L[3]=-(L[0]*G[0]+L[1]*G[1]+L[2]*G[2]);return L}function A(G,J,L,K=d()){var O=L[0]-J[0],P=L[1]-J[1],N=L[2]-J[2];L=G[0]-J[0];const H=G[1]-J[1],E=G[2]-J[2];J=P*E-N*H;N=N*L-O*E;O=O*H-P*
L;P=J*J+N*N+O*O;P=1E-5<Math.abs(P-1)&&1E-12<P?1/Math.sqrt(P):1;K[0]=J*P;K[1]=N*P;K[2]=O*P;K[3]=-(K[0]*G[0]+K[1]*G[1]+K[2]*G[2]);return K}function t(G,J,L,K,O){if(3>G.count)return!1;G.getVec(L,y);let P=K,N=!1;for(;P<G.count-1&&!N;)G.getVec(P,B),P++,N=!r.exactEquals(y,B);if(!N)return!1;P=Math.max(P,O);for(N=!1;P<G.count&&!N;)G.getVec(P,C),P++,r.subtract(k,y,B),r.normalize(k,k),r.subtract(q,B,C),r.normalize(q,q),N=!r.exactEquals(y,C)&&!r.exactEquals(B,C)&&.99619469809>Math.abs(r.dot(k,q));if(!N)return 0===
L&&1===K&&2===O?!1:t(G,J,0,1,2);A(y,B,C,J);return!0}function w(G,J,L){G=r.scale(g.sv3d.get(),G,r.dot(G,J));r.subtract(L,J,G);return L}function u(G,J){return r.dot(G,J)+G[3]}function z(G,J,L,K,O){const P=r.dot(G,L);if(0===P)return!1;G=-(r.dot(G,J)+G[3])/P;K&v.CLAMP&&(G=b.clamp(G,0,1));if(!(K&v.INFINITE_MIN)&&0>G||!(K&v.INFINITE_MAX)&&1<G)return!1;r.add(O,J,r.scale(O,L,G));return!0}const y=m.create(),B=m.create(),C=m.create(),k=m.create(),q=m.create(),x=[0,0,1,0];var v;(function(G){G[G.NONE=0]="NONE";
G[G.CLAMP=1]="CLAMP";G[G.INFINITE_MIN=4]="INFINITE_MIN";G[G.INFINITE_MAX=8]="INFINITE_MAX"})(v||(v={}));const D=v.INFINITE_MIN|v.INFINITE_MAX,F=v.INFINITE_MAX;a.UP=x;a.clip=function(G,J){const L=r.dot(G,J.ray.direction);G=-u(G,J.ray.origin);if(0>G&&0<=L)return!1;if(-1E-6<L&&1E-6>L)return 0<G;if((0>G||0>L)&&!(0>G&&0>L))return!0;G/=L;0<L?G<J.c1&&(J.c1=G):G>J.c0&&(J.c0=G);return J.c0<=J.c1};a.clipInfinite=function(G,J){const L=r.dot(G,J.ray.direction);G=-u(G,J.ray.origin);if(-1E-6<L&&1E-6>L)return 0<
G;G/=L;0<L?G<J.c1&&(J.c1=G):G>J.c0&&(J.c0=G);return J.c0<=J.c1};a.copy=f;a.create=d;a.distance=function(G,J){return Math.abs(u(G,J))};a.fromManyPoints=function(G,J){return t(G,J,0,1,2)};a.fromManyPointsSampleAt=t;a.fromNormalAndOffset=function(G,J,L){r.copy(L,G);L[3]=J;return L};a.fromPoints=A;a.fromPositionAndNormal=l;a.fromValues=e;a.fromVectorsAndPoint=function(G,J,L,K){r.cross(C,J,G);return l(L,C,K)};a.intersectLine=function(G,J,L,K){L=r.subtract(g.sv3d.get(),L,J);return z(G,J,L,D,K)};a.intersectLineSegment=
function(G,J,L){return z(G,J.origin,J.vector,v.NONE,L)};a.intersectLineSegmentClamp=function(G,J,L){return z(G,J.origin,J.vector,v.CLAMP,L)};a.intersectRay=function(G,J,L){return c.isSome(J)?z(G,J.origin,J.direction,F,L):!1};a.isPointInside=function(G,J){return 0<=u(G,J)};a.isPointOutside=function(G,J){return 0>u(G,J)};a.isSphereFullyInside=function(G,J){return 0<=u(G,n.getCenter(J))-J[3]};a.isSphereFullyOutside=function(G,J){return 0>u(G,n.getCenter(J))+J[3]};a.negate=function(G,J){J[0]=-G[0];J[1]=
-G[1];J[2]=-G[2];J[3]=-G[3];return J};a.normal=function(G){return G};a.projectPoint=function(G,J,L){const K=r.scale(g.sv3d.get(),G,-G[3]);J=r.subtract(g.sv3d.get(),J,K);G=w(G,J,g.sv3d.get());r.add(L,G,K);return L};a.projectPointLocal=function(G,J,L,K){var O=g.sv3d.get(),P=g.sv3d.get();h.tangentFrame(G,O,P);J=r.subtract(g.sv3d.get(),L,J);O=p.projectPointSignedLength(O,J);P=p.projectPointSignedLength(P,J);G=p.projectPointSignedLength(G,J);return r.set(K,O,P,G)};a.projectVector=w;a.setOffsetFromPoint=
function(G,J,L){J!==G&&f(G,J);G[3]=-r.dot(G,L);return G};a.signedDistance=u;a.wrap=function(G=x[0],J=x[1],L=x[2],K=x[3]){return e(G,J,L,K,g.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(){return d.create()}function w(S,U=t()){return h.copy(U,S)}function u(S,U){return d.fromValues(S[0],S[1],S[2],U)}function z(S){return S}function y(S){S[0]=S[1]=S[2]=S[3]=0}function B(S,U){S[0]=S[1]=S[2]=0;S[3]=U;return S}function C(S){return S[3]}function k(S){return S}function q(S,U,Y,V){return d.fromValues(S,U,Y,V)}function x(S,U,Y){S!==Y&&p.copy(Y,S);Y[3]=S[3]+U;return Y}function v(S,U,Y){c.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");
return S===Y?Y:w(S,Y)}function D(S,U,Y){if(m.isNone(U))return!1;const {origin:V,direction:R}=U;var X=M;X[0]=V[0]-S[0];X[1]=V[1]-S[1];X[2]=V[2]-S[2];U=R[0]*R[0]+R[1]*R[1]+R[2]*R[2];if(0===U)return!1;const W=2*(R[0]*X[0]+R[1]*X[1]+R[2]*X[2]);S=W*W-4*U*(X[0]*X[0]+X[1]*X[1]+X[2]*X[2]-S[3]*S[3]);if(0>S)return!1;X=Math.sqrt(S);S=(-W-X)/(2*U);U=(-W+X)/(2*U);if(0>S||U<S&&0<U)S=U;if(0>S)return!1;Y&&(Y[0]=V[0]+R[0]*S,Y[1]=V[1]+R[1]*S,Y[2]=V[2]+R[2]*S);return!0}function F(S,U){return D(S,U,null)}function G(S,
U,Y){if(D(S,U,Y))return Y;S=J(S,U,A.sv3d.get());p.add(Y,U.origin,p.scale(A.sv3d.get(),U.direction,p.distance(U.origin,S)/p.length(U.direction)));return Y}function J(S,U,Y){const V=A.sv3d.get(),R=A.sm4d.get();p.cross(V,U.origin,U.direction);const X=S[3];p.cross(Y,V,U.origin);p.scale(Y,Y,1/p.length(Y)*X);S=P(S,U.origin);U=l.angle(U.origin,Y);n.fromRotation(R,U+S,V);p.transformMat4(Y,Y,R);return Y}function L(S,U,Y){if(D(S,U,Y))return Y;e.closestPoint(U,S,Y);return K(S,Y,Y)}function K(S,U,Y){U=p.subtract(A.sv3d.get(),
U,S);U=p.scale(A.sv3d.get(),U,S[3]/p.length(U));return p.add(Y,U,S)}function O(S,U){U=p.subtract(A.sv3d.get(),U,S);U=p.squaredLength(U);return Math.sqrt(Math.abs(U-S[3]*S[3]))}function P(S,U){U=p.subtract(A.sv3d.get(),U,S);U=p.length(U);S=S[3];return r.acosClamped(S/(S+Math.abs(S-U)))}function N(S,U,Y,V){S=p.subtract(Q,U,S);switch(Y){case f.Axis.X:return Y=r.cartesianToSpherical(S,Q)[2],p.set(V,-Math.sin(Y),Math.cos(Y),0);case f.Axis.Y:return S=r.cartesianToSpherical(S,Q),Y=S[1],S=S[2],U=Math.sin(Y),
p.set(V,-U*Math.cos(S),-U*Math.sin(S),Math.cos(Y));case f.Axis.Z:return p.normalize(V,S)}}function H(S,U){U=p.subtract(T,U,S);return p.length(U)-S[3]}function E(S,U,Y,V){const R=H(S,U);S=N(S,U,f.Axis.Z,T);Y=p.scale(T,S,Y-R);return p.add(V,U,Y)}function I(S,U){U=p.squaredDistance(S,U);S=S[3];return U<=S*S}const M=g.create(),Q=g.create(),T=g.create();b=t();g=Object.freeze(Object.defineProperty({__proto__:null,create:t,copy:w,fromCenterAndRadius:u,wrap:z,clear:y,fromRadius:B,getRadius:C,getCenter:k,
fromValues:q,elevate:x,setExtent:v,intersectRay:D,intersectsRay:F,intersectRayClosestSilhouette:G,closestPointOnSilhouette:J,closestPoint:L,projectPoint:K,distanceToSilhouette:O,angleToSilhouette:P,axisAt:N,altitudeAt:H,setAltitudeAt:E,containsPoint:I,tmpSphere:b},Symbol.toStringTag,{value:"Module"}));a.altitudeAt=H;a.angleToSilhouette=P;a.axisAt=N;a.clear=y;a.closestPoint=L;a.closestPointOnSilhouette=J;a.containsPoint=I;a.copy=w;a.create=t;a.distanceToSilhouette=O;a.elevate=x;a.fromCenterAndRadius=
u;a.fromRadius=B;a.fromValues=q;a.getCenter=k;a.getRadius=C;a.intersectRay=D;a.intersectRayClosestSilhouette=G;a.intersectsRay=F;a.projectPoint=K;a.setAltitudeAt=E;a.setExtent=v;a.sphere=g;a.tmpSphere=b;a.wrap=z})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,r,m,n){function p(e){return e?g(m.clone(e.origin),m.clone(e.direction)):g(m.create(),m.create())}function g(e,
l){return{origin:e,direction:l}}function h(e,l,A=p()){r.copy(A.origin,e);r.copy(A.direction,l);return A}function d(e,l){e=r.cross(n.sv3d.get(),r.normalize(n.sv3d.get(),e.direction),r.subtract(n.sv3d.get(),l,e.origin));return r.dot(e,e)}const f=new c.ObjectStack(()=>p());a.closestPoint=function(e,l,A){l=r.dot(e.direction,r.subtract(A,l,e.origin));r.add(A,e.origin,r.scale(A,e.direction,l));return A};a.copy=function(e,l=p()){return h(e.origin,e.direction,l)};a.create=p;a.distance=function(e,l){return Math.sqrt(d(e,
l))};a.distance2=d;a.equals=function(e,l){return b.equals(e.origin,l.origin)&&b.equals(e.direction,l.direction)};a.fromPoints=function(e,l,A=p()){r.copy(A.origin,e);r.subtract(A.direction,l,e);return A};a.fromValues=h;a.wrap=function(e,l){const A=f.get();A.origin=e;A.direction=l;return A};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],
function(a,b,c,r){const m=r.create(),n=r.create();a.angle=function(p,g){p=c.dot(p,g)/(c.length(p)*c.length(g));return-b.acosClamped(p)};a.angleAroundAxis=function(p,g,h){c.normalize(m,p);c.normalize(n,g);p=c.dot(m,n);p=b.acosClamped(p);g=c.cross(m,m,n);return 0>c.dot(g,h)?2*Math.PI-p:p};a.projectPoint=function(p,g,h){g=c.dot(p,g)/c.dot(p,p);return c.scale(h,p,g)};a.projectPointSignedLength=function(p,g){return c.dot(p,g)/c.length(p)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,r){const m=r.create(),n=r.create(),p=r.create(),g=r.create(),h=r.create();a.angle=function(d,f,e){d=c.normalize(g,d);f=c.normalize(h,f);const l=b.acosClamped(c.dot(d,f));return e&&(d=c.cross(p,d,f),0>c.dot(d,e))?-l:l};a.bilerp=function(d,f,e,l,A,t){d+=(f-d)*A;return d+(e+(l-e)*A-d)*t};a.cosCapped=function(d,f){return d>f?Math.cos(f):Math.cos(d)};
a.fovx2fovy=function(d,f,e){return 2*Math.atan(e*Math.tan(.5*d)/f)};a.fovy2fovx=function(d,f,e){return 2*Math.atan(f*Math.tan(.5*d)/e)};a.makeOrthonormal=function(d,f,e){e=e||d;const l=c.dot(d,f);c.set(e,d[0]-l*f[0],d[1]-l*f[1],d[2]-l*f[2]);c.normalize(e,e)};a.makePiecewiseLinearFunction=function(d){const f=d.length;return e=>{if(e<=d[0][0])return d[0][1];if(e>=d[f-1][0])return d[f-1][1];let l=1;for(;e>d[l][0];)l++;const A=d[l][0];e=(A-e)/(A-d[l-1][0]);return e*d[l-1][1]+(1-e)*d[l][1]}};a.maxScale=
function(d){return Math.sqrt(Math.max(d[0]*d[0]+d[4]*d[4]+d[8]*d[8],d[1]*d[1]+d[5]*d[5]+d[9]*d[9],d[2]*d[2]+d[6]*d[6]+d[10]*d[10]))};a.moduloPositive=function(d,f){return(d%f+f)%f};a.planeFromPoints=function(d,f,e,l){c.subtract(m,f,d);c.subtract(n,e,d);c.cross(l,m,n);c.normalize(l,l);l[3]=-c.dot(d,l)};a.scaleFromMatrix=function(d,f){c.set(d,Math.sqrt(f[0]*f[0]+f[4]*f[4]+f[8]*f[8]),Math.sqrt(f[1]*f[1]+f[5]*f[5]+f[9]*f[9]),Math.sqrt(f[2]*f[2]+f[6]*f[6]+f[10]*f[10]));return d};a.slerp=function(d,f,e,
l=r.create()){const A=c.length(d);var t=c.length(f),w=c.dot(d,f)/(A*t);if(.9999999999999999>w){w=Math.acos(w);const u=((1-e)*A+e*t)/Math.sin(w);t=u/t*Math.sin(e*w);c.scale(g,d,u/A*Math.sin((1-e)*w));c.scale(h,f,t);return c.add(l,g,h)}return c.lerp(l,d,f,e)};a.slerpTangent=function(d,f,e,l=r.create(),A=r.create()){const t=c.length(d),w=c.length(f);var u=c.dot(d,f)/(t*w);if(.9999999999999999>u){u=Math.acos(u);const z=Math.sin(u),y=Math.sin(e*u),B=Math.sin((1-e)*u),C=(1-e)*t+e*w,k=C/z,q=k/w*y;c.scale(g,
d,k/t*B);c.scale(h,f,q);c.add(l,g,h);c.scale(g,d,1/t*(-Math.cos((1-e)*u)*u*C+B*(-t+w)));c.scale(h,f,1/w*(Math.cos(e*u)*u*C+y*(-t+w)));c.add(A,g,h);c.scale(A,A,1/z);return A}c.lerp(l,d,f,e);c.subtract(A,f,d);c.normalize(A,A);return A};a.tangentFrame=function(d,f,e){Math.abs(d[0])>Math.abs(d[1])?c.set(f,0,1,0):c.set(f,1,0,0);c.cross(e,d,f);c.normalize(f,f);c.cross(f,e,d);c.normalize(e,e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../SpatialReference ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(u){return{operations:u,value:u.create()}}function f(u,z,y=d(u)){y.operations=u;u.copy(z,y.value);return y}function e(u,z,y,B){return u.operations.setAltitudeAt(u.value,z,y,B)}const l=2**50,A=r.create(),t={operations:null,value:null},w=r.create();a.altitudeAt=function(u,z){return u.operations.altitudeAt(u.value,z)};a.axisAt=function(u,z,y,B){return u.operations.axisAt(u.value,z,y,B)};a.closestPoint=function(u,z,y){return u.operations.closestPoint(u.value,z,y)};
a.closestPointOnSilhouette=function(u,z,y){return u.operations.closestPointOnSilhouette(u.value,z,y)};a.coordinateSystemFromOneAxisAndNormalVector=function(u,z,y,B,C){c.copy(y,u);c.copy(w,z);c.normalize(w,w);c.cross(B,w,y);c.cross(C,B,y)};a.create=function(u){const {value:z,operations:y}=u;return{operations:y,value:y.create(z)}};a.createFromOperations=d;a.createGlobal=function(u){return f(h.sphere,h.fromValues(0,0,0,m.getReferenceEllipsoid(u).radius))};a.createLocal=function(){return f(g.boundedPlane,
g.fromValues([0,0,0],[l,0,0],[0,l,0]))};a.distanceToSilhouette=function(u,z){return u.operations.distanceToSilhouette(u.value,z)};a.elevate=function(u,z,y){return u.operations.elevate(u.value,z,y.value)};a.fromValues=f;a.intersectRay=function(u,z,y){return u.operations.intersectRay(u.value,z,y)};a.intersectRayClosestSilhouette=function(u,z,y){return u.operations.intersectRayClosestSilhouette(u.value,z,y)};a.intersectsRay=function(u,z){return u.operations.intersectRay(u.value,z,null)};a.normalAt=function(u,
z,y){return u.operations.axisAt(u.value,z,p.Axis.Z,y)};a.renderSRFromViewSR=function(u,z){return u?m.getSphericalPCPF(z):z.isGeographic?n.PlateCarree:z};a.setAltitudeAt=e;a.setAltitudeOfTransformation=function(u,z,y,B){z!==B&&b.copy(B,z);c.set(A,B[12],B[13],B[14]);e(u,A,y,A);B[12]=A[0];B[13]=A[1];B[14]=A[2];return B};a.setExtent=function(u,z,y){u.operations.setExtent(u.value,z,y.value);return y};a.vectorCoordinates=function(u,z,y,B,C){C[0]=c.dot(u,z);C[1]=c.dot(u,y);C[2]=c.dot(u,B);return C};a.wrap=
function(u,z){t.operations=u;t.value=z;return t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(a,b){function c(r,m){m=b.getMetersPerUnitForSR(m);return r/(m*b.inchesPerMeter*96)}a.getExtentForScale=function(r,m){const n=r.extent;r=r.width-(r.padding?r.padding.left+r.padding.right:0);m=c(m,n.spatialReference);return n.clone().expand(m*r/n.width)};a.getResolutionForScale=
c;a.getResolutionInMetersForScale=function(r){return r/(96*b.inchesPerMeter)};a.getScale=function(r,m){m=m||r.extent;r=r.width;const n=b.getMetersPerUnitForSR(m&&m.spatialReference);return m&&r?m.width/r*n*b.inchesPerMeter*96:0};a.getScaleForResolution=function(r,m){m=b.getMetersPerUnitForSR(m);return r*m*b.inchesPerMeter*96};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute=
"OBJECTID";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){function e(t,w){return w?l[t].valueToClassName[w].split(" "):
[]}const l={widthBreakpoint:{getValue(t){const w=t.viewSize[0];t=t.breakpoints;const u=this.values;return w<=t.xsmall?u.xsmall:w<=t.small?u.small:w<=t.medium?u.medium:w<=t.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue(t){const w=t.viewSize[1];t=t.breakpoints;const u=this.values;return w<=t.xsmall?u.xsmall:w<=t.small?u.small:w<=t.medium?u.medium:w<=t.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue(t){t=t.viewSize;const w=this.values;return t[1]>=t[0]?w.portrait:w.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},A={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=t=>{t=function(w){function u(...y){y=w.call(this,...y)||this;y._breakpointsHandles=new m;y.orientation=null;y.widthBreakpoint=null;y.heightBreakpoint=null;y.breakpoints=A;return y}
b._inheritsLoose(u,w);var z=u.prototype;z.initialize=function(){this._breakpointsHandles.add(p.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),p.initial))};z.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=n.destroyMaybe(this._breakpointsHandles))};z._updateClassNames=function(){if(this.container){var y=r.acquire(),B=r.acquire(),C=!1,k;for(k in l){const q=this[k],x=l[k].getValue({viewSize:this.size,breakpoints:this.breakpoints});q!==
x&&(C=!0,this[k]=x,e(k,q).forEach(v=>B.push(v)),e(k,x).forEach(v=>y.push(v)))}C&&(this._applyClassNameChanges(y,B),r.release(y),r.release(B))}};z._applyClassNameChanges=function(y,B){const C=this.container;C&&(B.forEach(k=>C.classList.remove(k)),y.forEach(k=>C.classList.add(k)))};z._removeActiveClassNames=function(){const y=this.container;if(y)for(var B in l)e(B,this[B]).forEach(C=>y.classList.remove(C))};b._createClass(u,[{key:"breakpoints",set:function(y){var B=this._get("breakpoints");if(y!==B){B=
(B=y)&&B.xsmall<B.small&&B.small<B.medium&&B.medium<B.large;if(!B){const C=JSON.stringify(A,null,2);console.warn("provided breakpoints are not valid, using defaults:"+C)}y=B?y:A;this._set("breakpoints",{...y})}}}]);return u}(t);c.__decorate([g.property()],t.prototype,"breakpoints",null);c.__decorate([g.property()],t.prototype,"orientation",void 0);c.__decorate([g.property()],t.prototype,"widthBreakpoint",void 0);c.__decorate([g.property()],t.prototype,"heightBreakpoint",void 0);return t=c.__decorate([f.subclass("esri.views.BreakpointsOwner")],
t)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(a,b,c,r,
m,n,p,g,h,d,f,e,l,A){function t(u){u&&(r.empty(u),u.parentNode&&u.parentNode.removeChild(u))}const w=[0,0];a.DOMContainer=u=>{u=function(z){function y(...C){var k=z.call(this,...C)||this;k._freqInfo={freq:16,time:750};k._overlayRenderTaskHandle=null;k.height=0;k.overlay=null;k.position=null;k.resizing=!1;k.root=null;k.surface=null;k.suspended=!0;k.ui=null;k.userContent=null;k.width=0;k.widthBreakpoint=null;if(0===C.length||void 0===C[0]?.popup)k.popup=new A({view:b._assertThisInitialized(k)});k.handles.add([p.watch(()=>
k.cursor,q=>{const {surface:x}=b._assertThisInitialized(k);x&&x.setAttribute("data-cursor",q)}),p.watch(()=>k.interacting,q=>{const {surface:x}=b._assertThisInitialized(k);x&&x.setAttribute("data-interacting",q.toString())})]);return k}b._inheritsLoose(y,z);var B=y.prototype;B.initialize=function(){this.handles.add(p.watch(()=>this.ui,(C,k)=>this._handleUIChange(C,k)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};
B.destroy=function(){this.destroyed||(this.ui=n.destroyMaybe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)};B.blur=function(){this.surface&&this.surface.blur()};B.focus=function(){this.surface&&this.surface.focus()};B.pageToContainer=function(C,k,q){const x=this.position;C-=x?x[0]:0;k-=x?x[1]:0;q?(q[0]=C,q[1]=k):q=[C,k];return q};B.containerToPage=function(C,k,q){const x=this.position;C+=x?x[0]:0;k+=x?x[1]:0;q?(q[0]=C,q[1]=k):q=[C,k];return q};B._handleUIChange=
function(C,k){k&&(this.handles.remove("ui"),k.destroy());C&&this._wireUI(C);this._set("ui",C)};B._wireUI=function(C){this.handles.remove("ui");C&&(C.view=this,this.handles.add([p.watch(()=>this.root,k=>{if(k){const q=document.createElement("div");k.appendChild(q);k=q}else k=null;C.container=k},p.initial),p.watch(()=>this.popup,(k,q)=>{q&&C.remove(q,"popup");k&&(k.view=C.view,C.add(k,{key:"popup",position:"manual"}))},p.initial)],"ui"))};B._stopMeasuring=function(){this.handles.remove("measuring");
this._get("resizing")&&this._set("resizing",!1)};B._startMeasuring=function(){const C=this._freqInfo;C.freq=16;C.time=750;this.handles.add([(()=>{const k=()=>{C.freq=16;C.time=750};window.addEventListener("resize",k);return{remove(){window.removeEventListener("resize",k)}}})(),g.addFrameTask({prepare:k=>{const q=this._measure(),x=this._freqInfo;x.time+=k.deltaTime;q&&(x.freq=16,this._get("resizing")||this._set("resizing",!0));x.time<x.freq||(x.time=0,this._position()||q?x.freq=16:x.freq=Math.min(750,
2*x.freq),!q&&512<=x.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};B._measure=function(){var C=this.container;const k=C?C.clientWidth:0;C=C?C.clientHeight:0;if(0===k||0===C)return this.suspended||this._set("suspended",!0),!1;const q=this.width,x=this.height;if(k===q&&C===x)return this.suspended&&this._set("suspended",!1),!1;this._set("width",k);this._set("height",C);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:q,
oldHeight:x,width:k,height:C});return!0};B._position=function(){var C=this.container;const k=this.position;var q;if(q=C)q=(C.ownerDocument||window.document).defaultView,C=C.getBoundingClientRect(),w[0]=C.left+(q?.pageXOffset??0),w[1]=C.top+(q?.pageYOffset??0),q=w;C=q;return C?k&&C[0]===k[0]&&C[1]===k[1]?!1:(this._set("position",[C[0],C[1]]),!0):!1};B.forceDOMReadyCycle=function(){};b._createClass(y,[{key:"container",get:function(){return this._get("container")??null},set:function(C){const k=this._get("container");
var q=r.byId(C);(q=q instanceof HTMLDivElement?q:null)||"string"!==typeof C||m.getLogger(this.declaredClass).error("#container",`element with id '${C}' not found`);if(k!==q)if(this.handles.remove("dom-size"),this._stopMeasuring(),k&&(k.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(t(this.root),this._set("root",null)),this.userContent&&
(r.reparent(this.userContent,k),t(this.userContent),this._set("userContent",null))),q){q.classList.add("esri-view");C=document.createElement("div");C.className="esri-view-user-storage";r.reparent(q,C);q.appendChild(C);this._set("userContent",C);C=document.createElement("div");C.className="esri-view-root";q.insertBefore(C,q.firstChild);this._set("root",C);var x=document.createElement("div");x.className="esri-view-surface";x.setAttribute("role","application");x.tabIndex=0;C.appendChild(x);this._set("surface",
x);var v=new l;C.appendChild(v.surface);this._set("overlay",v);p.watch(()=>v.needsRender,D=>{this._overlayRenderTaskHandle=D&&!this._overlayRenderTaskHandle?g.addFrameTask({render:()=>this.overlay?.render()}):n.removeMaybe(this._overlayRenderTaskHandle)});this.forceDOMReadyCycle();this.handles.add(p.watch(()=>this.size,D=>{const [F,G]=D;F>=document.body.clientWidth||G>=document.body.clientHeight?x.classList.add("esri-view-surface--inset-outline"):x.classList.remove("esri-view-surface--inset-outline")},
p.initial),"dom-size");this._set("container",q);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const C=document.activeElement===this.surface;return document.hasFocus()&&C}},{key:"popup",set:function(C){const k=this._get("popup");k&&k!==C&&k.destroy();this._set("popup",C)}},{key:"size",get:function(){return[this.width,this.height]}}]);return y}(u);
c.__decorate([h.property()],u.prototype,"container",null);c.__decorate([h.property({readOnly:!0})],u.prototype,"focused",null);c.__decorate([h.property({readOnly:!0})],u.prototype,"height",void 0);c.__decorate([h.property({type:A})],u.prototype,"popup",null);c.__decorate([h.property({type:l})],u.prototype,"overlay",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"position",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"resizing",void 0);c.__decorate([h.property({readOnly:!0})],
u.prototype,"root",void 0);c.__decorate([h.property({value:null,readOnly:!0})],u.prototype,"size",null);c.__decorate([h.property({readOnly:!0})],u.prototype,"surface",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"suspended",void 0);c.__decorate([h.property()],u.prototype,"ui",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"userContent",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"width",void 0);c.__decorate([h.property()],u.prototype,"widthBreakpoint",
void 0);return u=c.__decorate([e.subclass("esri.views.DOMContainer")],u)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){c=function(e){function l(){var t=e.apply(this,arguments)||this;t.items=new r;t._watchUpdatingTracking=new h.WatchUpdatingTracking;t._callbacks=new Map;t._projector=f.createProjector();t._hiddenProjector=f.createProjector();return t}a._inheritsLoose(l,e);var A=l.prototype;A.initialize=function(){const t=document.createElement("div");t.className="esri-overlay-surface";this._set("surface",t);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");t.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,w=>{for(const u of w.added){const z=()=>u.render();this._callbacks.set(u,z);this._projector.append(this.surface,z)}for(const u of w.removed)w=this._projector.detach(this._callbacks.get(u)),this.surface.removeChild(w.domNode),this._callbacks.delete(u)})};A.addItem=function(t){this.items.add(t)};A.removeItem=function(t){this.items.remove(t)};A.destroy=function(){this.items.removeAll();
this._callbacks.forEach(t=>this._projector.detach(t));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};A.render=function(){this._projector.renderNow()};A.computeBoundingRect=function(t){const w=this._hiddenSurface,u=this._hiddenProjector;let z=null;const y=()=>z=t.render();u.append(w,y);u.renderNow();const B={left:0,top:0,right:0,bottom:0};if(z&&z.domNode){const C=z.domNode.getBoundingClientRect();B.left=C.left;B.top=C.top;B.right=C.right;B.bottom=C.bottom}for(u.detach(y);w.firstChild;)w.removeChild(w.firstChild);
return B};A.overlaps=function(t,w){t=this.computeBoundingRect(t);w=this.computeBoundingRect(w);return Math.max(t.left,w.left)<=Math.min(t.right,w.right)&&Math.max(t.top,w.top)<=Math.min(t.bottom,w.bottom)};A.prepare=function(){var t=a._asyncToGenerator(function*(){yield document.fonts.load(this._fontString()).catch(()=>{})});return function(){return t.apply(this,arguments)}}();A.renderCanvas=function(t){if(this.items.some(u=>u.visible)){var w=t.getContext("2d");w.save();w.font=this._fontString();
this.items.forEach(u=>{w.save();u.renderCanvas(w);w.restore()});w.restore()}};A._fontString=function(){return`10px ${getComputedStyle(this.surface).fontFamily}`};a._createClass(l,[{key:"needsRender",get:function(){return 0<this.items.length}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some(t=>t.visible)}}]);return l}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([m.property({readOnly:!0})],
c.prototype,"items",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"needsRender",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"updating",null);return c=b.__decorate([g.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/resources ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../support/themeUtils ../intl/substitute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J){function L(P,N){return void 0===N?`${"esri-popup"}__${P}`:`${"esri-popup"}__${P}-${N}`}const K={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},O={closeButton:!0,featureNavigation:!0};r=function(P){function N(E,I){var M=P.call(this,E,I)||this;M._blurClose=!1;M._blurContainer=!1;M._containerNode=null;M._mainContainerNode=null;M._featureMenuNode=null;M._actionsMenuNode=null;M._focusClose=!1;M._focusContainer=!1;M._focusDockButton=
!1;M._focusFeatureMenuButton=!1;M._focusActionsMenuButton=!1;M._focusFirstFeature=!1;M._focusFirstAction=!1;M._handles=new p;M._pointerOffsetInPx=16;M._spinner=null;M._feature=null;M._featureMenuIntersectionObserverCallback=([Q])=>{Q?.isIntersecting&&M.viewModel.featurePage++};M._featureMenuIntersectionObserver=new IntersectionObserver(M._featureMenuIntersectionObserverCallback,{root:window.document});M._displaySpinnerThrottled=f.throttle(()=>M._displaySpinner(),0);M._exitRelatedRecordsActions=new WeakMap;
M._flowItems=new m;M.alignment="auto";M.collapsed=!1;M.collapseEnabled=!0;M.dockEnabled=!1;M.featureMenuOpen=!1;M.headingLevel=2;M.maxInlineActions=3;M.messages=null;M.messagesCommon=null;M.spinnerEnabled=!0;M.viewModel=new C;M.visibleElements={...O};M._addSelectedFeatureIndexHandle();M.addHandles([d.watch(()=>M.viewModel?.screenLocation,()=>M._positionContainer()),d.watch(()=>[M.viewModel?.active,M.dockEnabled],()=>M._toggleScreenLocationEnabled()),d.watch(()=>M.viewModel?.screenLocation,(Q,T)=>
{!!Q!==!!T&&M.reposition()}),d.watch(()=>[M.viewModel?.view?.padding,M.viewModel?.view?.size,M.viewModel?.active,M.viewModel?.location,M.alignment],()=>M.reposition()),d.watch(()=>M.spinnerEnabled,Q=>M._spinnerEnabledChange(Q)),d.watch(()=>M.viewModel?.view?.size,(Q,T)=>M._updateDockEnabledForViewSize(Q,T)),d.watch(()=>M.viewModel?.view,(Q,T)=>M._viewChange(Q,T)),d.watch(()=>M.viewModel?.view?.ready,(Q,T)=>M._viewReadyChange(Q,T)),d.watch(()=>[M.viewModel?.waitingForResult,M.viewModel?.location],
()=>{M._hideSpinner();M._displaySpinnerThrottled()}),d.watch(()=>M.selectedFeatureWidget,()=>M._destroyFlowItemWidgets()),d.watch(()=>[M.selectedFeatureWidget?.viewModel?.title,M.selectedFeatureWidget?.viewModel?.state],()=>M._setTitleFromFeatureWidget()),d.watch(()=>[M.selectedFeatureWidget?.viewModel?.content,M.selectedFeatureWidget?.viewModel?.state],()=>M._setContentFromFeatureWidget()),d.when(()=>!M.collapsed,()=>{"xsmall"===M.viewModel?.view?.widthBreakpoint&&M.viewModel.active&&M.collapseEnabled&&
M.viewModel.centerAtLocation()}),d.on(()=>M.viewModel?.allActions,"change",()=>M._watchActions()),d.watch(()=>M.viewModel?.allActions,()=>M._watchActions(),d.initial),d.watch(()=>M.viewModel?.featureViewModels,()=>M._featureMenuViewportScrollTop()),d.on(()=>M._flowItems,"change",()=>{M.notifyChange("_activeFlowItemWidget");M.scheduleRender()}),d.watch(()=>[M._activeFlowItemWidget?.viewModel?.state,M._activeFlowItemWidget?.viewModel?.title],()=>M.scheduleRender())]);return M}b._inheritsLoose(N,P);
var H=N.prototype;H.loadDependencies=function(){return Promise.all([new Promise((E,I)=>a(["../chunks/calcite-flow"],E,I)),new Promise((E,I)=>a(["../chunks/calcite-flow-item"],E,I)),new Promise((E,I)=>a(["../chunks/calcite-action"],E,I)),new Promise((E,I)=>a(["../chunks/calcite-tooltip"],E,I)),new Promise((E,I)=>a(["../chunks/calcite-icon"],E,I))])};H.destroy=function(){this._destroyFlowItemWidgets();this._destroySelectedFeatureWidget();this._destroySpinner();this._handles?.destroy();this._unobserveFeatureMenuObserver();
this._featureMenuIntersectionObserver?.disconnect();this._handles=null};H.castVisibleElements=function(E){return{...O,...E}};H.blur=function(){const {active:E}=this.viewModel;E||g.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};H.clear=function(){return this.viewModel.clear()};H.close=function(){this.visible=!1};H.fetchFeatures=function(E,I){return this.viewModel.fetchFeatures(E,
I)};H.focus=function(){const {active:E}=this.viewModel;E||g.getLogger(this.declaredClass).warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};H.next=function(){return this.viewModel.next()};H.open=function(E){this._handles.remove("selected-index");const I={collapsed:E?!!E.collapsed:!1,actionsMenuOpen:E?!!E.actionsMenuOpen:!1,featureMenuOpen:E?!!E.featureMenuOpen:!1};"xsmall"===this.viewModel?.view?.widthBreakpoint&&
(I.collapsed=!0);this.set(I);this.viewModel.open(E);this._shouldFocus(E);this._addSelectedFeatureIndexHandle()};H.previous=function(){return this.viewModel.previous()};H.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};H.triggerAction=function(E){return this.viewModel.triggerAction(E)};H.render=function(){const {actionsMenuOpen:E,dockEnabled:I,featureMenuVisible:M,dividedActions:Q,currentAlignment:T,currentDockPosition:S}=this,{active:U}=this.viewModel,
{menuActions:Y}=Q,V=this.selectedFeature?.layer?.title,R=this.selectedFeature?.layer?.id;return D.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===T,["esri-popup--aligned-bottom-center"]:"bottom-center"===T,["esri-popup--aligned-top-left"]:"top-left"===T,["esri-popup--aligned-bottom-left"]:"bottom-left"===T,["esri-popup--aligned-top-right"]:"top-right"===T,["esri-popup--aligned-bottom-right"]:"bottom-right"===T,["esri-popup--is-docked"]:U&&I,["esri-popup--shadow"]:U&&
!I,["esri-popup--is-docked-top-left"]:"top-left"===S,["esri-popup--is-docked-top-center"]:"top-center"===S,["esri-popup--is-docked-top-right"]:"top-right"===S,["esri-popup--is-docked-bottom-left"]:"bottom-left"===S,["esri-popup--is-docked-bottom-center"]:"bottom-center"===S,["esri-popup--is-docked-bottom-right"]:"bottom-right"===S,["esri-popup--feature-menu-open"]:M,["esri-popup--actions-menu-open"]:U&&1<Y.length&&E}),role:"presentation","data-layer-title":V,"data-layer-id":R,bind:this,afterCreate:this._positionContainer,
afterUpdate:this._positionContainer},U?[this.renderMainContainer(),this.renderPointer()]:null)};H.renderLoadingIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};H.renderNavigationLoading=function(){const {messagesCommon:E}=this;return this.viewModel.pendingPromisesCount?D.tsx("div",{key:L("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":E.loading,title:E.loading},
this.renderLoadingIcon()):null};H.renderPreviousIcon=function(){const E=F.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:E,["esri-popup__pagination-previous-icon--rtl"]:E,["esri-icon-left-triangle-arrow"]:!E,["esri-popup__pagination-previous-icon"]:!E})})};H.renderPreviousButton=function(){const {messages:E}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,
class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":E.previous,title:E.previous},this.renderPreviousIcon())};H.renderNextIcon=function(){const E=F.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:E,["esri-popup__pagination-next-icon--rtl"]:E,["esri-icon-right-triangle-arrow"]:!E,["esri-popup__pagination-next-icon"]:!E})})};H.renderNextButton=function(){const {messages:E}=this;
return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":E.next,title:E.next},this.renderNextIcon())};H.renderFeatureMenuButton=function(){const {featureMenuOpen:E,featureMenuId:I,messagesCommon:M}=this,{featureCount:Q,selectedFeatureIndex:T}=this.viewModel;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":I,"aria-expanded":E.toString(),"aria-label":M.menu,title:M.menu},this._getPageText(Q,T))};H.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null};H.renderDockIcon=
function(){const {dockEnabled:E}=this,I=this._wouldDockTo();return D.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:E,["esri-popup__icon--dock-icon"]:!E,["esri-icon-dock-right"]:!E&&("top-right"===I||"bottom-right"===I),["esri-icon-dock-left"]:!E&&("top-left"===I||"bottom-left"===I),["esri-icon-maximize"]:!E&&"top-center"===I,["esri-icon-dock-bottom"]:!E&&"bottom-center"===I},"esri-popup__icon")})};H.renderDockButton=function(){const {dockEnabled:E,messages:I}=this,M=
E?I.undock:I.dock;return"xsmall"!==this.viewModel?.view?.widthBreakpoint&&this.dockOptions?.buttonEnabled?D.tsx("div",{role:"button","aria-label":M,title:M,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},this.renderDockIcon()):null};H.renderTitle=function(){const {title:E}=this.viewModel,{titleId:I,collapsible:M,contentCollapsed:Q,
messagesCommon:T}=this;var S={["esri-popup__header-container--button"]:M};const U=D.tsx(k.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:E});S=M?D.tsx("button",{key:`${E}--collapsible`,id:I,title:Q?T.expand:T.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",S),"aria-expanded":Q?"false":"true",onclick:this._toggleCollapsed,type:"button"},U,D.tsx("calcite-icon",{class:"esri-popup__collapse-icon",key:"collapse-icon",
icon:Q?"chevron-down":"chevron-up",scale:"m"})):D.tsx("div",{key:E,id:I,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",S)},U);return E?S:null};H.renderCloseIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};H.renderCloseButton=function(){const {visibleElements:E,messagesCommon:I}=this;return E.closeButton?D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,
onkeydown:this._close,class:"esri-popup__button","aria-label":I.close,title:I.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};H.renderHeader=function(){return D.tsx("header",{class:"esri-popup__header"},this.renderTitle(),D.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};H.renderContentContainer=function(){const {contentId:E,hasContent:I,contentCollapsed:M,_flowItems:Q,messagesCommon:T}=
this,{content:S}=this.viewModel,U=Q.toArray(),Y={["esri-content--has-flows"]:!!U.length};return I&&!M?D.tsx("div",{key:S,enterAnimation:this._createFeatureUpdatedAnimation(),id:E,class:this.classes("esri-popup__content",Y)},D.tsx("calcite-flow",{bind:this,onCalciteFlowItemBack:this._handleBackClick},D.tsx("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode","intl-back":T.back,afterCreate:F.storeNode,key:"root-flow-item"},this.renderContent()),U.map(V=>this.renderFlowItem(V))),U.map(V=>
this.renderFlowItemTooltip(V))):null};H.renderFlowItem=function(E){const {messages:I,messagesCommon:M}=this,Q=G.isDarkTheme();return D.tsx("calcite-flow-item",{class:this.classes({["calcite-theme-dark"]:!Q,["calcite-theme-light"]:Q}),heading:E.title,"intl-back":M.back,description:this._getFlowItemDescription(E),key:`flow-item-${E.viewModel.uid}`},D.tsx("calcite-action",{class:"esri-popup__action--exit",icon:"move-up",label:I?.exitRelatedRecords,text:I?.exitRelatedRecords,slot:"header-actions-start",
bind:this,afterCreate:T=>this._storeExitRelatedRecordsAction(E,T),onclick:this._destroyFlowItemWidgets}),D.tsx("div",{class:this.classes("esri-content__flow-item",{["calcite-theme-dark"]:Q,["calcite-theme-light"]:!Q})},E.render()))};H.renderFlowItemTooltip=function(E){const {messages:I,_exitRelatedRecordsActions:M}=this,Q=G.isDarkTheme();return D.tsx("calcite-tooltip",{class:this.classes({["calcite-theme-dark"]:!Q,["calcite-theme-light"]:Q}),key:`exit-related-records-tooltip-${E.viewModel.uid}`,label:I?.exitRelatedRecords,
overlayPositioning:"fixed",referenceElement:M.get(E),placement:"top"},I?.exitRelatedRecords)};H.renderActionsMenuButton=function(){const {actionsMenuId:E,actionsMenuButtonId:I,actionsMenuOpen:M,dividedActions:Q,messagesCommon:T}=this,S=M?T.close:T.open,{menuActions:U}=Q;return U.length?D.tsx("div",{key:L("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:I,"aria-haspopup":"true","aria-controls":M?E:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,
onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":S,title:S},D.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};H.renderMenuActions=function(){const {actionsMenuId:E,actionsMenuButtonId:I,actionsMenuOpen:M,dividedActions:Q}=this,{menuActions:T}=Q;return T.length&&M?D.tsx("ul",{id:E,role:"menu","aria-labelledby":I,key:L("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,
afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},T.toArray().map(S=>this.renderAction({action:S,type:"menu-item"}))):null};H.renderInlineActions=function(){const {inlineActions:E}=this.dividedActions;return!!E.length&&E.toArray().map(I=>this.renderAction({action:I,type:"inline"}))};H.renderInlineActionsContainer=function(){const {inlineActions:E,menuActions:I}=this.dividedActions,M=!!E.length,Q=!!I.length;return M||Q?D.tsx("div",{key:"inline-actions-container","data-inline-actions":M.toString(),
"data-menu-actions":Q.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};H.renderNavigation=function(){return this.featureNavigationVisible?D.tsx("section",{key:L("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null};H.renderFooter=function(){const {featureNavigationVisible:E,dividedActions:I}=this,{inlineActions:M,menuActions:Q}=I,T=!!M.length,S={["esri-popup__footer--has-pagination"]:E,
["esri-popup__footer--has-actions"]:T,["esri-popup__footer--has-actions-menu"]:!!Q.length};return E||T?D.tsx("div",{key:L("feature-buttons"),class:this.classes("esri-popup__footer",S)},this.renderInlineActionsContainer(),this.renderNavigation()):null};H.renderFeatureMenuContainer=function(){var {messages:E}=this;const {featureViewModels:I,isLoadingFeature:M}=this.viewModel;E=J.substitute(E.selectedFeatures,{total:I.length});return D.tsx("section",{key:L("menu"),class:"esri-popup__feature-menu"},D.tsx("strong",
{class:"esri-popup__feature-menu-header"},E),D.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:F.storeNode},this.renderFeatureMenu(),D.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),M?D.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))};H.renderPointer=function(){return this.dockEnabled?null:D.tsx("div",{key:L("pointer"),
class:"esri-popup__pointer",role:"presentation"},D.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};H.renderMainContainer=function(){const {dockEnabled:E,currentAlignment:I,currentDockPosition:M,titleId:Q,contentId:T,collapsible:S,hasContent:U,contentCollapsed:Y,visibleElements:V}=this,{title:R}=this.viewModel,X="bottom-left"===I||"bottom-center"===I||"bottom-right"===I||"top-left"===M||"top-center"===M||"top-right"===M,W="top-left"===I||"top-center"===I||"top-right"===
I||"bottom-left"===M||"bottom-center"===M||"bottom-right"===M;return D.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:E,["esri-popup--is-collapsible"]:S,["esri-popup--is-collapsed"]:Y}),tabIndex:V.closeButton?null:-1,role:"dialog","aria-labelledby":R?Q:"","aria-describedby":U&&!Y?T:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},X?this.renderFooter():null,X?this.renderFeatureMenuContainer():
null,this.renderHeader(),this.renderContentContainer(),W?this.renderFooter():null,W?this.renderFeatureMenuContainer():null)};H.renderContent=function(){const E=this.viewModel?.content;return E?"string"===typeof E?D.tsx("div",{class:y.CSS.contentNode,key:E,innerHTML:E}):this.renderNodeContent(E):null};H.renderActionText=function(E){return D.tsx("span",{key:"text",class:"esri-popup__action-text"},E)};H.renderActionIcon=function(E){const I=this._getActionClass(E),M=this._getActionImage(E),Q={["esri-icon-loading-indicator"]:E.active,
["esri-rotating"]:E.active,["esri-popup__icon"]:!!I,["esri-popup__action-image"]:!E.active&&!!M};I&&(Q[I]=!E.active);return D.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",Q),styles:this._getIconStyles(M)})};H.renderAction=function(E){const {action:I,type:M}=E;E=this._getActionTitle(I);const Q={["esri-popup__action"]:"toggle"!==I.type,["esri-popup__action-toggle"]:"toggle"===I.type,["esri-popup__action-toggle--on"]:"toggle"===I.type&&I.value,["esri-popup__button--disabled"]:I.disabled},
T=[this.renderActionIcon(I),this.renderActionText(E)];E="menu-item"===M?D.tsx("li",{key:I.uid,role:"menuitem",tabIndex:0,title:E,"aria-label":E,class:this.classes("esri-popup__button",Q),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":I.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},T):D.tsx("div",{key:I.uid,role:"button",tabIndex:0,title:E,"aria-label":E,class:this.classes("esri-popup__button",Q),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":I.uid,
onclick:this._triggerAction,onkeydown:this._triggerAction},T);return I.visible?E:null};H.renderFeatureMenuItem=function(E,I){const {messages:M,messagesCommon:Q}=this,{selectedFeatureIndex:T,selectedFeatureViewModel:S}=this.viewModel;var U=E===S;const Y={["esri-popup__feature-menu-item--selected"]:U};U=U?D.tsx("span",{key:L(`feature-menu-selected-feature-${T}`),title:M.selectedFeature,"aria-label":M.selectedFeature,class:"esri-icon-check-mark"}):null;E=D.tsx("span",{innerHTML:E.title||Q.untitled});
return D.tsx("li",{role:"menuitem",tabIndex:-1,key:L(`feature-menu-feature-${T}`),class:this.classes(Y,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":I,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},D.tsx("span",{class:"esri-popup__feature-menu-title"},E,U))};H.renderFeatureMenu=function(){const {featureMenuId:E}=
this,{featureViewModels:I}=this.viewModel;return 1<I.length?D.tsx("ol",{class:"esri-popup__feature-menu-list",id:E,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},I.filter(M=>!!M.graphic).map((M,Q)=>this.renderFeatureMenuItem(M,Q))):null};H._storeExitRelatedRecordsAction=function(E,I){this._exitRelatedRecordsActions.set(E,I);this.scheduleRender()};H._getFlowItemDescription=function(E){return"featureCountDescription"in
E?E.featureCountDescription:E.viewModel.description};H._destroyFlowItemWidgets=function(){this._flowItems.removeAll().forEach(E=>{"showAllEnabled"in E.viewModel&&(E.viewModel.showAllEnabled=!1);E.viewModel=null;E.destroy()})};H._handleBackClick=function(){const E=this._flowItems.pop();this._exitRelatedRecordsActions.delete(E);"showAllEnabled"in E.viewModel&&(E.viewModel.showAllEnabled=!1);E&&(E.viewModel=null,E.destroy())};H._getActionTitle=function(E){const {messages:I,selectedFeature:M,messagesCommon:Q}=
this,{id:T}=E,S=M?.attributes;return(E="zoom-to-feature"===T?J.substitute(E.title,{messages:I}):"remove-selected-feature"===T?J.substitute(E.title,{messages:Q}):"zoom-to-clustered-features"===T?J.substitute(E.title,{messages:I}):"browse-clustered-features"===T?J.substitute(E.title,{messages:I}):E.title)&&S?J.substitute(E,S):E};H._getActionClass=function(E){var {selectedFeature:I}=this;I=I?.attributes;const {className:M,image:Q}=E;return(E=Q||M?M:"esri-icon-default-action")&&I?J.substitute(E,I):E};
H._getActionImage=function(E){var {selectedFeature:I}=this;I=I?.attributes;({image:E}=E);return E&&I?J.substitute(E,I):E};H._createFeatureUpdatedAnimation=function(){return F.cssTransition("enter","esri-popup--feature-updated")};H._getInlineActionCount=function(){const {maxInlineActions:E,featureNavigationVisible:I}=this;if("number"!==typeof E)return null;const M=Math.round(E);return Math.max(I?M-1:M,0)};H._watchActions=function(){const {allActions:E}=this.viewModel;this.notifyChange("dividedActions");
this._handles.remove("actions");E&&E.forEach(I=>{this._handles.add(d.watch(()=>[I.uid,I.active,I.className,I.disabled,I.id,I.title,I.image,I.visible],()=>this.scheduleRender()),"actions")})};H._divideActions=function(){var {allActions:E}=this.viewModel;E=E.filter(T=>T.visible);const I=this._getInlineActionCount(),M=null===I,Q=0===I;return{inlineActions:M?E.slice(0):Q?new m:E.slice(0,I),menuActions:M?new m:Q?E.slice(0):E.slice(I)}};H._featureMenuOpenChanged=function(E){E?this._focusFirstFeature=!0:
this._focusFeatureMenuButton=!0};H._actionsMenuOpenChanged=function(E){E?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};H._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:E,messagesCommon:I}=this;E&&(this.viewModel.title="error"===E.viewModel?.state?I.errorMessage:E.viewModel?.title||"")};H._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:E}=this;E&&(this.viewModel.content=E)};H._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&
this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};H._featureMenuIntersectionObserverCreated=function(E){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(E);this._featureMenuIntersectionObserverNode=E};H._handleFeatureMenuKeyup=function(E){"Escape"===n.eventKey(E)&&(E.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};H._handleActionMenuKeyup=function(E){"Escape"===n.eventKey(E)&&
(E.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};H._setActiveFeature=function(E){const {viewModel:I}=this;I.activeFeature=I.features[E.currentTarget["data-feature-index"]]||null};H._removeActiveFeature=function(){this.viewModel.activeFeature=null};H._handleFeatureMenuItemKeyup=function(E){const I=n.eventKey(E);var {_featureMenuNode:M}=this;const Q=E.currentTarget["data-feature-index"];if(M){M=M.querySelectorAll("li");var T=M.length;"ArrowUp"===I?
(E.stopPropagation(),M[(Q-1+T)%T].focus()):"ArrowDown"===I?(E.stopPropagation(),M[(Q+1+T)%T].focus()):"Home"===I?(E.stopPropagation(),M[0].focus()):"End"===I&&(E.stopPropagation(),M[M.length-1].focus())}};H._handleActionMenuItemKeyup=function(E){const I=n.eventKey(E);var {_actionsMenuNode:M}=this;const Q=E.currentTarget.dataset.actionUid;var {menuActions:T}=this.dividedActions;T=T.findIndex(U=>U.uid===Q);if(M){M=M.querySelectorAll("li");var S=M.length;"ArrowUp"===I?(E.stopPropagation(),M[(T-1+S)%
S].focus()):"ArrowDown"===I?(E.stopPropagation(),M[(T+1+S)%S].focus()):"Home"===I?(E.stopPropagation(),M[0].focus()):"End"===I&&(E.stopPropagation(),M[M.length-1].focus())}};H._handleMainKeyup=function(E){const I=n.eventKey(E);"ArrowLeft"===I&&(E.stopPropagation(),this.previous());"ArrowRight"===I&&(E.stopPropagation(),this.next())};H._spinnerEnabledChange=function(E){this._destroySpinner();E&&(E=this.get("viewModel.view"),this._createSpinner(E))};H._hideSpinner=function(){const {_spinner:E}=this;
E&&(E.location=null,E.hide())};H._displaySpinner=function(){const {_spinner:E}=this;if(E){var {location:I,waitingForResult:M}=this.viewModel;M?E.show({location:I}):E.hide()}};H._getIconStyles=function(E){return{"background-image":E?`url(${E})`:""}};H._shouldFocus=function(){var E=b._asyncToGenerator(function*(I){I.shouldFocus&&(yield d.whenOnce(()=>!0===this.viewModel?.active),this.focus())});return function(I){return E.apply(this,arguments)}}();H._addSelectedFeatureIndexHandle=function(){const E=
d.watch(()=>this.viewModel?.selectedFeatureIndex,(I,M)=>this._selectedFeatureIndexUpdated(I,M));this._handles.add(E,"selected-index")};H._selectedFeatureIndexUpdated=function(E,I){const {featureCount:M}=this;M&&E!==I&&-1!==E&&(this._destroyFlowItemWidgets(),this.featureMenuOpen=this.actionsMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))};H._destroySelectedFeatureWidget=function(){const {_feature:E}=
this;E&&(E.viewModel=null,E&&!E.destroyed&&E.destroy());this._feature=null};H._isScreenLocationWithinView=function(E,I){return-1<E.x&&-1<E.y&&E.x<=I.width&&E.y<=I.height};H._isOutsideView=function(E){const {popupHeight:I,popupWidth:M,screenLocation:Q,side:T,view:S}=E;if(isNaN(M)||isNaN(I)||!S||!Q)return!1;E=S.padding;return"right"===T&&Q.x+M/2>S.width-E.right||"left"===T&&Q.x-M/2<E.left||"top"===T&&Q.y-I<E.top||"bottom"===T&&Q.y+I>S.height-E.bottom?!0:!1};H._calculateAutoAlignment=function(E){if("auto"!==
E)return E;const {_pointerOffsetInPx:I,_containerNode:M,_mainContainerNode:Q,viewModel:T}=this,{screenLocation:S,view:U}=T;if(h.isNone(S)||!U||!M)return"top-center";if(!this._isScreenLocationWithinView(S,U))return this._get("currentAlignment")||"top-center";var Y=(E=Q?window.getComputedStyle(Q,null):null)?parseInt(E.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,V=E?parseInt(E.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:R,width:X}=M.getBoundingClientRect();
E=X+I;const W=Math.max(R,Y,V)+I;Y=this._isOutsideView({popupHeight:W,popupWidth:E,screenLocation:S,side:"right",view:U});V=this._isOutsideView({popupHeight:W,popupWidth:E,screenLocation:S,side:"left",view:U});const aa=this._isOutsideView({popupHeight:W,popupWidth:E,screenLocation:S,side:"top",view:U});E=this._isOutsideView({popupHeight:W,popupWidth:E,screenLocation:S,side:"bottom",view:U});return V?aa?"bottom-right":"top-right":Y?aa?"bottom-left":"top-left":aa?E?"top-center":"bottom-center":"top-center"};
H._callCurrentAlignment=function(E){return"function"===typeof E?E.call(this):E};H._getCurrentAlignment=function(){const {alignment:E,dockEnabled:I}=this;return I||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(E)))};H._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};H._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};H._calculatePositionResult=
function(E){const I=["left","right"];F.isRTL(this.container)&&I.reverse();return E.replace(/leading/gi,I[0]).replace(/trailing/gi,I[1])};H._callDockPosition=function(E){return"function"===typeof E?E.call(this):E};H._getDockPosition=function(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))};H._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};H._wouldDockTo=function(){return this.dockEnabled?
null:this._getDockPosition()};H._calculateAutoDockPosition=function(E){if("auto"!==E)return E;var I=this.viewModel?.view;E=F.isRTL(this.container)?"top-left":"top-right";if(!I)return E;var M=I.padding||{left:0,right:0,top:0,bottom:0};M=I.width-M.left-M.right;({breakpoints:I}=I);return I&&M<=I.xsmall?"bottom-center":E};H._positionContainer=function(E=this._containerNode){E&&(this._containerNode=E);if(E){var {screenLocation:I}=this.viewModel,{width:M}=E.getBoundingClientRect();if(I=this._calculatePositionStyle(I,
M))E.style.top=I.top,E.style.left=I.left,E.style.bottom=I.bottom,E.style.right=I.right}};H._calculateFullWidth=function(E){const {currentAlignment:I,_pointerOffsetInPx:M}=this;return"top-left"===I||"bottom-left"===I||"top-right"===I||"bottom-right"===I?E+M:E};H._calculateAlignmentPosition=function(E,I,M,Q){const {currentAlignment:T,_pointerOffsetInPx:S}=this;Q/=2;const U=M.height-I;M=M.width-E;const {padding:Y}=this.view;if("bottom-center"===T)return{top:I+S-Y.top,left:E-Q-Y.left};if("top-left"===
T)return{bottom:U+S-Y.bottom,right:M+S-Y.right};if("bottom-left"===T)return{top:I+S-Y.top,right:M+S-Y.right};if("top-right"===T)return{bottom:U+S-Y.bottom,left:E+S-Y.left};if("bottom-right"===T)return{top:I+S-Y.top,left:E+S-Y.left};if("top-center"===T)return{bottom:U+S-Y.bottom,left:E-Q-Y.left}};H._calculatePositionStyle=function(E,I){const {dockEnabled:M,view:Q}=this;if(Q){if(M)return{left:"",top:"",right:"",bottom:""};if(!h.isNone(E)&&I&&(I=this._calculateFullWidth(I),E=this._calculateAlignmentPosition(E.x,
E.y,Q,I)))return{top:void 0!==E.top?`${E.top}px`:"auto",left:void 0!==E.left?`${E.left}px`:"auto",bottom:void 0!==E.bottom?`${E.bottom}px`:"auto",right:void 0!==E.right?`${E.right}px`:"auto"}}};H._viewChange=function(E,I){E&&I&&(this.close(),this.clear())};H._viewReadyChange=function(E,I){E?(E=this.get("viewModel.view"),this._wireUpView(E)):I&&(this.close(),this.clear())};H._wireUpView=function(E){this._destroySpinner();if(E){var {spinnerEnabled:I}=this;I&&this._createSpinner(E);this._setDockEnabledForViewSize(this.dockOptions)}};
H._dockingThresholdCrossed=function(E,I,M){const [Q,T]=E,[S,U]=I,{width:Y,height:V}=M;return Q<=Y&&S>Y||Q>Y&&S<=Y||T<=V&&U>V||T>V&&U<=V};H._updateDockEnabledForViewSize=function(E,I){if(E&&I){var M=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},Q=M.left+M.right,T=M.top+M.bottom;M=[];var S=[];M[0]=E[0]-Q;M[1]=E[1]-T;S[0]=I[0]-Q;S[1]=I[1]-T;({dockOptions:E}=this);this._dockingThresholdCrossed(M,S,E.breakpoint)&&this._setDockEnabledForViewSize(E);this._setCurrentDockPosition()}};
H._focusDockButtonNode=function(E){this._focusDockButton&&(this._focusDockButton=!1,E.focus())};H._closeButtonNodeUpdated=function(E){this._focusClose?(this._focusClose=!1,E.focus()):this._blurClose&&(this._blurClose=!1,E.blur())};H._mainContainerNodeUpdated=function(E){this._mainContainerNode=E;this._focusContainer?(this._focusContainer=!1,E.focus()):this._blurContainer&&(this._blurContainer=!1,E.blur())};H._featureMenuNodeUpdated=function(E){(this._featureMenuNode=E)&&this._focusFirstFeature&&(this._focusFirstFeature=
!1,E=E.querySelectorAll("li"),E.length&&E[0].focus())};H._actionsMenuNodeUpdated=function(E){(this._actionsMenuNode=E)&&this._focusFirstAction&&(this._focusFirstAction=!1,E=E.querySelectorAll("li"),E.length&&E[0].focus())};H._focusFeatureMenuButtonNode=function(E){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,E.focus())};H._focusActionsMenuButtonNode=function(E){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,E.focus())};H._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&
(this._featureMenuViewportNode.scrollTop=0)};H._toggleScreenLocationEnabled=function(){const {dockEnabled:E,viewModel:I}=this;I&&(I.screenLocationEnabled=I.active&&!E)};H._shouldDockAtCurrentViewSize=function(E){E=E.breakpoint;var I=this.viewModel?.view?.ui;if(!I)return!1;const {width:M,height:Q}=I;if(isNaN(M)||isNaN(Q))return!1;I=E.hasOwnProperty("width")&&M<=E.width;E=E.hasOwnProperty("height")&&Q<=E.height;return I||E};H._setDockEnabledForViewSize=function(E){E.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(E))};
H._getPageText=function(E,I){return this.featureNavigationVisible?J.substitute(this.messages.pageText,{index:I+1,total:E}):null};H._destroySpinner=function(){const {_spinner:E,view:I}=this;E&&(I&&I.ui&&I.ui.remove(this._spinner,"popup-spinner"),E.destroy(),this._spinner=null)};H._createSpinner=function(E){E&&(this._spinner=new u({view:E}),E.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};H._toggleCollapsed=function(){this.collapsed=!this.collapsed};H._close=function(){this.close();
this.view&&this.view.focus()};H._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};H._toggleFeatureMenu=function(){const E=!this.featureMenuOpen;this._featureMenuOpenChanged(E);this.actionsMenuOpen=!1;this.featureMenuOpen=E};H._toggleActionsMenu=function(){const E=!this.actionsMenuOpen;this._actionsMenuOpenChanged(E);this.featureMenuOpen=!1;this.actionsMenuOpen=E};H._triggerAction=function(E){const I=E.currentTarget.dataset.actionUid;var {allActions:M}=
this.viewModel;E=M.findIndex(Q=>Q.uid===I);(M=M.getItemAt(E))&&"toggle"===M.type&&(M.value=!M.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(E)};H._selectFeature=function(E){E=E.currentTarget["data-feature-index"];isNaN(E)||(this.viewModel.selectedFeatureIndex=E);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};H._next=function(){this.next()};H._previous=function(){this.previous()};b._createClass(N,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},
{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){const {selectedFeatureWidget:E,viewModel:I}=this;if(!E)return!!I?.content;var M=E.viewModel;if(M?.waitingForContent||"error"===M?.state)return!0;M=M?.content;return Array.isArray(M)?!!M.length:
!!M}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},
{key:"_activeFlowItemWidget",get:function(){const {_flowItems:E}=this;return E.getItemAt(E.length-1)||null}},{key:"actions",get:function(){return this.viewModel.actions},set:function(E){this.viewModel.actions=E}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(E){this._set("actionsMenuOpen",!!E)}},{key:"autoCloseEnabled",get:function(){return this.viewModel.autoCloseEnabled},set:function(E){this.viewModel.autoCloseEnabled=E}},{key:"autoOpenEnabled",
get:function(){return this.viewModel.autoOpenEnabled},set:function(E){this.viewModel.autoOpenEnabled=E}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(E){this.viewModel.defaultPopupTemplateEnabled=E}},{key:"content",get:function(){return this.viewModel.content},set:function(E){this.viewModel.content=E}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},
{key:"dockOptions",get:function(){return this._get("dockOptions")||K},set:function(E){var I={...K};const M=this.get("viewModel.view.breakpoints");var Q={};M&&(Q.width=M.xsmall,Q.height=M.xsmall);E={...I,...E};I={...I.breakpoint,...Q};({breakpoint:Q}=E);!0===Q?E.breakpoint=I:"object"===typeof Q&&(E.breakpoint={...I,...Q});this._set("dockOptions",E);this._setCurrentDockPosition();this.reposition()}},{key:"featureCount",get:function(){return this.viewModel.featureCount}},{key:"features",get:function(){return this.viewModel.features},
set:function(E){this.viewModel.features=E}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(E){this.viewModel.goToOverride=E}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(E){this.viewModel.highlightEnabled=E}},{key:"location",get:function(){return this.viewModel.location},set:function(E){this.viewModel.location=E}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(E){this._overrideIfSome("label",
E)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(E){this.viewModel.promises=E}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},set:function(E){this.viewModel.selectedFeatureIndex=E}},{key:"selectedFeatureWidget",get:function(){const {_feature:E,visibleElements:I,headingLevel:M,_flowItems:Q}=this,{selectedFeatureViewModel:T}=this.viewModel,S={...I,title:!1};
if(!T)return null;E?(E.viewModel=T,E.visibleElements=S):this._feature=new w({flowItems:Q,headingLevel:M+1,viewModel:T,visibleElements:S});return this._feature}},{key:"title",get:function(){return this.viewModel.title},set:function(E){this.viewModel.title=E}},{key:"updateLocationEnabled",get:function(){return this.viewModel.updateLocationEnabled},set:function(E){this.viewModel.updateLocationEnabled=E}},{key:"view",get:function(){return this.viewModel.view},set:function(E){this.viewModel.view=E}},{key:"visible",
get:function(){return this.viewModel.visible},set:function(E){this.viewModel.visible=E}}]);return N}(B.FeatureContentMixin(z));c.__decorate([e.property({readOnly:!0})],r.prototype,"actionsMenuId",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"actionsMenuButtonId",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"featureMenuId",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"titleId",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"contentId",null);c.__decorate([e.property({readOnly:!0})],
r.prototype,"hasContent",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"featureNavigationVisible",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"collapsible",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"featureMenuVisible",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"contentCollapsed",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"dividedActions",null);c.__decorate([e.property({readOnly:!0,dependsOn:["_flowItems.length"]})],r.prototype,
"_activeFlowItemWidget",null);c.__decorate([e.property()],r.prototype,"actions",null);c.__decorate([e.property()],r.prototype,"actionsMenuOpen",null);c.__decorate([e.property()],r.prototype,"alignment",void 0);c.__decorate([e.property()],r.prototype,"autoCloseEnabled",null);c.__decorate([e.property()],r.prototype,"autoOpenEnabled",null);c.__decorate([e.property()],r.prototype,"defaultPopupTemplateEnabled",null);c.__decorate([e.property()],r.prototype,"content",null);c.__decorate([e.property()],r.prototype,
"collapsed",void 0);c.__decorate([e.property()],r.prototype,"collapseEnabled",void 0);c.__decorate([e.property({readOnly:!0})],r.prototype,"currentAlignment",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"currentDockPosition",null);c.__decorate([e.property()],r.prototype,"dockOptions",null);c.__decorate([e.property()],r.prototype,"dockEnabled",void 0);c.__decorate([e.property({readOnly:!0})],r.prototype,"featureCount",null);c.__decorate([e.property()],r.prototype,"featureMenuOpen",void 0);
c.__decorate([e.property()],r.prototype,"features",null);c.__decorate([e.property()],r.prototype,"goToOverride",null);c.__decorate([e.property()],r.prototype,"headingLevel",void 0);c.__decorate([e.property()],r.prototype,"highlightEnabled",null);c.__decorate([e.property()],r.prototype,"location",null);c.__decorate([e.property()],r.prototype,"label",null);c.__decorate([e.property()],r.prototype,"maxInlineActions",void 0);c.__decorate([e.property(),x.messageBundle("esri/widgets/Popup/t9n/Popup")],r.prototype,
"messages",void 0);c.__decorate([e.property(),x.messageBundle("esri/t9n/common")],r.prototype,"messagesCommon",void 0);c.__decorate([e.property()],r.prototype,"promises",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"selectedFeature",null);c.__decorate([e.property()],r.prototype,"selectedFeatureIndex",null);c.__decorate([e.property({readOnly:!0})],r.prototype,"selectedFeatureWidget",null);c.__decorate([e.property()],r.prototype,"spinnerEnabled",void 0);c.__decorate([e.property()],r.prototype,
"title",null);c.__decorate([e.property()],r.prototype,"updateLocationEnabled",null);c.__decorate([e.property()],r.prototype,"view",null);c.__decorate([e.property({type:C}),v.vmEvent(["triggerAction","trigger-action"])],r.prototype,"viewModel",void 0);c.__decorate([e.property()],r.prototype,"visible",null);c.__decorate([e.property()],r.prototype,"visibleElements",void 0);c.__decorate([A.cast("visibleElements")],r.prototype,"castVisibleElements",null);c.__decorate([q.accessibleHandler()],r.prototype,
"_close",null);c.__decorate([q.accessibleHandler()],r.prototype,"_toggleDockEnabled",null);c.__decorate([q.accessibleHandler()],r.prototype,"_toggleFeatureMenu",null);c.__decorate([q.accessibleHandler()],r.prototype,"_toggleActionsMenu",null);c.__decorate([q.accessibleHandler()],r.prototype,"_triggerAction",null);c.__decorate([q.accessibleHandler()],r.prototype,"_selectFeature",null);c.__decorate([q.accessibleHandler()],r.prototype,"_next",null);c.__decorate([q.accessibleHandler()],r.prototype,"_previous",
null);return r=c.__decorate([t.subclass("esri.widgets.Popup")],r)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,r,m){let n=null,p=1E3;"number"===typeof c?(p=c,m=r):(n=c??null,p=r);let g=0,h;const d=()=>{g=0;b.apply(m,h)};c=(...f)=>{n&&n.apply(m,f);h=f;p?g||(g=setTimeout(d,p)):d()};c.remove=()=>{g&&(clearTimeout(g),g=0)};c.forceUpdate=()=>{g&&(clearTimeout(g),d())};c.hasPendingUpdates=()=>!!g;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureRelationship ./Feature/FeatureViewModel ./Feature/resources ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){var v;const D={title:!0,content:!0,lastEditedInfo:!0};r=v=function(F){function G(L,K){L=F.call(this,L,K)||this;L._contentWidgets=[];L.flowItems=null;L.headingLevel=2;L.messages=null;L.messagesCommon=null;L.messagesURIUtils=null;L.visibleElements={...D};L.viewModel=new u;return L}b._inheritsLoose(G,F);var J=G.prototype;J.initialize=function(){this.addHandles(m.watch(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),m.initial))};
J.loadDependencies=function(){return new Promise((L,K)=>a(["../chunks/calcite-notice"],L,K))};J.destroy=function(){this._destroyContentWidgets()};J.castVisibleElements=function(L){return{...D,...L}};J.render=function(){var {state:L}=this.viewModel;L=q.tsx("div",{class:z.CSS.container,key:"container"},this.renderTitle(),"error"===L?this.renderError():"loading"===L?this.renderLoading():this.renderContentContainer());return q.tsx("div",{class:this.classes(z.CSS.base,z.CSS.esriWidget)},L)};J.setActiveMedia=
function(L,K){return this.viewModel.setActiveMedia(L,K)};J.nextMedia=function(L){return this.viewModel.nextMedia(L)};J.previousMedia=function(L){return this.viewModel.previousMedia(L)};J.renderError=function(){const {messagesCommon:L,messages:K,visibleElements:O}=this;return q.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},O.title?q.tsx("div",{key:"error-title",slot:"title"},L.errorMessage):null,q.tsx("div",{key:"error-message",slot:"message"},K.loadingError))};
J.renderLoading=function(){return q.tsx("div",{key:"loading-container",class:z.CSS.loadingSpinnerContainer},q.tsx("span",{class:this.classes(z.CSS.iconLoading,z.CSS.spinner)}))};J.renderContentContainer=function(){const {visibleElements:L}=this;return L.content?q.tsx("div",{class:z.CSS.main},[this.renderContent(),this.renderLastEditInfo()]):null};J.renderTitle=function(){const {visibleElements:L,title:K}=this;return L.title?q.tsx(B.Heading,{level:this.headingLevel,class:z.CSS.title,innerHTML:K}):
null};J.renderContent=function(){var L=this.viewModel.content;return L?Array.isArray(L)?L.length?q.tsx("div",{class:z.CSS.contentNode,key:"content-content-elements"},L.map(this.renderContentElement,this)):null:"string"===typeof L?(L=this._contentWidgets[0],!L||L.destroyed?null:q.tsx("div",{class:z.CSS.contentNode,key:"content-content"},L.render())):this.renderNodeContent(L):null};J.renderContentElement=function(L,K){const {visibleElements:O}=this;if("boolean"!==typeof O.content&&!O.content[L.type])return null;
switch(L.type){case "attachments":return this.renderAttachments(K);case "custom":return this.renderCustom(L,K);case "fields":return this.renderFields(K);case "media":return this.renderMedia(K);case "text":return this.renderText(L,K);case "expression":return this.renderExpression(K);case "relationship":return this.renderRelationship(K);default:return null}};J.renderAttachments=function(L){const K=this._contentWidgets[L];if(!K||K.destroyed)return null;const {state:O,attachmentInfos:P}=K.viewModel;return"loading"===
O||0<P.length?q.tsx("div",{key:this._buildKey("attachments-element",L),class:this.classes(z.CSS.contentElement)},K.render()):null};J.renderRelationship=function(L){const K=this._contentWidgets[L];return K&&!K.destroyed&&this.flowItems?q.tsx("div",{key:this._buildKey("relationship-element",L),class:z.CSS.contentElement},K.render()):null};J.renderExpression=function(L){const K=this._contentWidgets[L];return!K||K.destroyed?null:q.tsx("div",{key:this._buildKey("expression-element",L),class:z.CSS.contentElement},
K.render())};J.renderCustom=function(L,K){({creator:L}=L);const O=this._contentWidgets[K];return!O||O.destroyed?null:L?q.tsx("div",{key:this._buildKey("custom-element",K),class:z.CSS.contentElement},O.render()):null};J.renderFields=function(L){const K=this._contentWidgets[L];return!K||K.destroyed?null:q.tsx("div",{key:this._buildKey("fields-element",L),class:z.CSS.contentElement},K.render())};J.renderMedia=function(L){const K=this._contentWidgets[L];return!K||K.destroyed?null:q.tsx("div",{key:this._buildKey("media-element",
L),class:z.CSS.contentElement},K.render())};J.renderLastEditInfo=function(){const {visibleElements:L,messages:K}=this;var {lastEditInfo:O}=this.viewModel;if(!O||!L.lastEditedInfo)return null;const {date:P,user:N}=O;O=x.substitute("edit"===O.type?N?K.lastEditedByUser:K.lastEdited:N?K.lastCreatedByUser:K.lastCreated,{date:P,user:N});return q.tsx("div",{key:"edit-info-element",class:this.classes(z.CSS.lastEditedInfo,z.CSS.contentElement)},O)};J.renderText=function(L,K){const O=this._contentWidgets[K];
return!O||O.destroyed?null:L.text?q.tsx("div",{key:this._buildKey("text-element",K),class:this.classes(z.CSS.contentElement,z.CSS.text)},O.render()):null};J._buildKey=function(L,...K){const O=this.get("viewModel.graphic.uid")||"0";K=K.join("-");return`${L}__${O}-${K}`};J._destroyContentWidget=function(L){L&&(L.viewModel=null,!L.destroyed&&L.destroy())};J._destroyContentWidgets=function(){this.removeHandles("relationship-handles");this._contentWidgets.forEach(L=>this._destroyContentWidget(L));this._contentWidgets=
[]};J._addFeatureRelationshipHandles=function(L){const {flowItems:K,visibleElements:O}=this;this.addHandles([m.on(()=>L,"select-record",({featureViewModel:P})=>{K&&(P.abilities={relationshipContent:!0},K.push(new v({flowItems:K,viewModel:P,visibleElements:O})))}),m.on(()=>L,"show-all-records",()=>{if(K){var {viewModel:P}=L;P.showAllEnabled=!0;P=new w({visibleElements:{title:!1,description:!1},viewModel:P});this._addFeatureRelationshipHandles(P);K.push(P)}})],"relationship-handles")};J._setupContentWidgets=
function(){this._destroyContentWidgets();const {headingLevel:L,visibleElements:K}=this;var O=this.get("viewModel.content");const {contentViewModels:P}=this.viewModel;Array.isArray(O)?O.forEach((N,H)=>{"attachments"===N.type&&(this._contentWidgets[H]=new f({displayType:N.displayType,headingLevel:K.title?L+1:L,viewModel:P[H]}));"fields"===N.type&&(this._contentWidgets[H]=new A({viewModel:P[H]}));"media"===N.type&&(this._contentWidgets[H]=new t({viewModel:P[H]}));"text"===N.type&&(this._contentWidgets[H]=
new e({viewModel:P[H]}));"custom"===N.type&&(this._contentWidgets[H]=new e({viewModel:P[H]}));"expression"===N.type&&(this._contentWidgets[H]=new l({viewModel:P[H]}));"relationship"===N.type&&(N=new w({viewModel:P[H]}),this._addFeatureRelationshipHandles(N),this._contentWidgets[H]=N)},this):(O=P[0])&&!O.destroyed&&(this._contentWidgets[0]=new e({viewModel:O}));this.scheduleRender()};b._createClass(G,[{key:"graphic",get:function(){return this.viewModel.graphic},set:function(L){this.viewModel.graphic=
L}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(L){this.viewModel.defaultPopupTemplateEnabled=L}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(L){this._overrideIfSome("label",L)}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(L){this.viewModel.spatialReference=L}},{key:"title",get:function(){return this.viewModel.title}},{key:"map",get:function(){return this.viewModel.map},
set:function(L){this.viewModel.map=L}},{key:"view",get:function(){return this.viewModel.view},set:function(L){this.viewModel.view=L}}]);return G}(y.FeatureContentMixin(d));c.__decorate([n.property()],r.prototype,"graphic",null);c.__decorate([n.property()],r.prototype,"defaultPopupTemplateEnabled",null);c.__decorate([n.property()],r.prototype,"flowItems",void 0);c.__decorate([n.property()],r.prototype,"headingLevel",void 0);c.__decorate([n.property()],r.prototype,"label",null);c.__decorate([n.property(),
k.messageBundle("esri/widgets/Feature/t9n/Feature")],r.prototype,"messages",void 0);c.__decorate([n.property(),k.messageBundle("esri/t9n/common")],r.prototype,"messagesCommon",void 0);c.__decorate([n.property(),k.messageBundle("esri/widgets/support/t9n/uriUtils")],r.prototype,"messagesURIUtils",void 0);c.__decorate([n.property()],r.prototype,"spatialReference",null);c.__decorate([n.property({readOnly:!0})],r.prototype,"title",null);c.__decorate([n.property()],r.prototype,"visibleElements",void 0);
c.__decorate([g.cast("visibleElements")],r.prototype,"castVisibleElements",null);c.__decorate([n.property()],r.prototype,"map",null);c.__decorate([n.property()],r.prototype,"view",null);c.__decorate([n.property({type:u})],r.prototype,"viewModel",void 0);return r=v=c.__decorate([h.subclass("esri.widgets.Feature")],r)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){m=function(A){function t(u,z){u=A.call(this,u,z)||this;u._featureElementInfo=null;u.attachmentsWidget=new g;u.headingLevel=2;u.viewModel=new d;return u}a._inheritsLoose(t,A);var w=t.prototype;w.initialize=function(){this._featureElementInfo=new f;this.addHandles([c.watch(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),c.initial),c.watch(()=>this.viewModel?.graphic,u=>this.attachmentsWidget.graphic=u,
c.initial)])};w.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};w.render=function(){const {attachmentsWidget:u}=this;return l.tsx("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),u?.render())};w._setupFeatureElementInfo=function(){const {description:u,title:z,headingLevel:y}=this;this._featureElementInfo.set({description:u,title:z,headingLevel:y})};a._createClass(t,[{key:"description",get:function(){return this.viewModel.description},
set:function(u){this.viewModel.description=u}},{key:"displayType",get:function(){return this.attachmentsWidget.displayType},set:function(u){this.attachmentsWidget.displayType=u}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(u){this.viewModel.graphic=u}},{key:"title",get:function(){return this.viewModel.title},set:function(u){this.viewModel.title=u}}]);return t}(h);b.__decorate([r.property({readOnly:!0})],m.prototype,"attachmentsWidget",void 0);b.__decorate([r.property()],
m.prototype,"description",null);b.__decorate([r.property()],m.prototype,"displayType",null);b.__decorate([r.property()],m.prototype,"graphic",null);b.__decorate([r.property()],m.prototype,"headingLevel",void 0);b.__decorate([r.property()],m.prototype,"title",null);b.__decorate([r.property({type:d})],m.prototype,"viewModel",void 0);return m=b.__decorate([p.subclass("esri.widgets.Feature.FeatureAttachments")],m)})},"esri/widgets/Attachments":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/maybe ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){const z={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},y=window.CSS;h=function(B){function C(q,x){q=B.call(this,q,x)||this;q.displayType="auto";q.messages=null;q.messagesUnits=null;q.selectedFile=null;q.submitting=!1;q.viewModel=new l;q.visibleElements={...z};q._supportsImageOrientation=y&&y.supports&&y.supports("image-orientation","from-image");q._addAttachmentForm=
null;q._updateAttachmentForm=null;return q}b._inheritsLoose(C,B);var k=C.prototype;k.initialize=function(){this.addHandles([n.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),n.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),n.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),n.initial)])};k.loadDependencies=function(){return Promise.all([new Promise((q,x)=>a(["../chunks/calcite-icon"],q,x))])};k.castVisibleElements=function(q){return{...z,...q}};
k.addAttachment=function(){const {_addAttachmentForm:q,viewModel:x}=this;this._set("submitting",!0);this._set("error",null);return x.addAttachment(q).then(v=>{this._set("submitting",!1);this._set("error",null);x.mode="view";return v}).catch(v=>{this._set("submitting",!1);this._set("error",new r("attachments:add-attachment",this.messages.addErrorMessage,v));throw v;})};k.deleteAttachment=function(q){const {viewModel:x}=this;this._set("submitting",!0);this._set("error",null);return x.deleteAttachment(q).then(v=>
{this._set("submitting",!1);this._set("error",null);x.mode="view";return v}).catch(v=>{this._set("submitting",!1);this._set("error",new r("attachments:delete-attachment",this.messages.deleteErrorMessage,v));throw v;})};k.updateAttachment=function(){const {viewModel:q}=this,{_updateAttachmentForm:x}=this;this._set("submitting",!0);this._set("error",null);return q.updateAttachment(x).then(v=>{this._set("submitting",!1);this._set("error",null);q.mode="view";return v}).catch(v=>{this._set("submitting",
!1);this._set("error",new r("attachments:update-attachment",this.messages.updateErrorMessage,v));throw v;})};k.addFile=function(){const q=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);this.viewModel.mode="view";return q};k.updateFile=function(){const {viewModel:q}=this,x=q.updateFile(this.selectedFile,this._updateAttachmentForm,q.activeFileInfo);q.mode="view";return x};k.deleteFile=function(q){q=this.viewModel.deleteFile(q||this.viewModel.activeFileInfo.file);this.viewModel.mode=
"view";return q};k.render=function(){const {submitting:q,viewModel:x}=this,{state:v}=x;return u.tsx("div",{class:this.classes("esri-attachments","esri-widget")},q?this.renderProgressBar():null,"loading"===v?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};k.renderErrorMessage=function(){const {error:q,visibleElements:x}=this;return q&&x.errorMessage?u.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},q.message):null};k.renderAttachments=function(){const {activeFileInfo:q,
mode:x,activeAttachmentInfo:v}=this.viewModel;return"add"===x?this.renderAddForm():"edit"===x?this.renderDetailsForm(v||q):this.renderAttachmentContainer()};k.renderLoading=function(){return u.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},u.tsx("div",{class:"esri-attachments__loader"}))};k.renderProgressBar=function(){return this.visibleElements.progressBar?u.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};k.renderAddForm=function(){const {submitting:q,
selectedFile:x}=this;var v=q||!x,D=this.visibleElements.cancelAddButton?u.tsx("button",{type:"button",bind:this,disabled:q,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",q&&"esri-button--disabled")},this.messages.cancel):null;v=this.visibleElements.addSubmitButton?u.tsx("button",{type:"submit",disabled:v,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:v})},
this.messages.add):null;const F=x?u.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},x.name):null;D=u.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},u.tsx("fieldset",{class:"esri-attachments__file-fieldset"},F,u.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},x?this.messages.changeFile:this.messages.selectFile,u.tsx("input",{class:"esri-attachments__file-input",
type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),v,D);return u.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};k.renderDetailsForm=function(q){const {visibleElements:x,viewModel:v,selectedFile:D,submitting:F}=this;var {abilities:G}=v,J=F||!D;let L;if(D){var K=D.type;L=D.name;var O=D.size}else if("file"in q)K=q.file.type,L=q.file.name,O=q.file.size;else{K=q.contentType;L=q.name;O=q.size;var P=q.url}var N=G.editing&&G.operations.delete&&x.deleteButton?
u.tsx("button",{key:"delete-button",type:"button",disabled:F,bind:this,onclick:E=>this._submitDeleteAttachment(E,q),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:F})},this.messages.delete):void 0;J=G.editing&&G.operations.update&&x.updateButton?u.tsx("button",{disabled:J,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:J})},
this.messages.update):void 0;const H=this.visibleElements.cancelUpdateButton?u.tsx("button",{disabled:F,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:F})},this.messages.cancel):void 0;G=G.editing&&G.operations.update?u.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},u.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},
L),u.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,u.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0;O=u.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},u.tsx("label",null,p.formatFileSize(this.messagesUnits,O)));K=u.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},u.tsx("label",
null,K));P=m.isSome(P)?u.tsx("a",{class:"esri-attachments__item-link",href:P,rel:"noreferrer",target:"_blank"},this.renderImageMask(q,400),u.tsx("div",{class:"esri-attachments__item-link-overlay"},u.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},u.tsx("calcite-icon",{icon:"launch"})))):this.renderImageMask(q,400);N=u.tsx("form",{bind:this,afterCreate:t.storeNode,afterRemoved:t.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:E=>this._submitUpdateAttachment(E,q)},u.tsx("div",
{class:"esri-attachments__metadata"},O,K),G,u.tsx("div",{class:"esri-attachments__actions"},N,H,J));return u.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},P,N)};k.renderImageMask=function(q,x){return"file"in q?this.renderGenericImageMask(q.file.name,q.file.type):this.renderImageMaskForAttachment(q,x)};k.renderGenericImageMask=function(q,x){var {supportsResizeAttachments:v}=this.viewModel;x=A.getIconPath(x);v={["esri-attachments__image--resizable"]:v};return u.tsx("div",
{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask")},u.tsx("img",{title:q,alt:q,src:x,class:this.classes(v,"esri-attachments__image")}))};k.renderImageMaskForAttachment=function(q,x){var {supportsResizeAttachments:v}=this.viewModel;const {contentType:D,name:F,url:G}=q;if(!v||!A.isSupportedImage(D))return this.renderGenericImageMask(F,D);q=(q=this._getCSSTransform(q))?{transform:q,"image-orientation":"none"}:{};x=`${G}${G.includes("?")?"\x26":"?"}w=${x}`;v={["esri-attachments__image--resizable"]:v};
return u.tsx("div",{class:this.classes("esri-attachments__item-mask")},u.tsx("img",{styles:q,alt:F,title:F,src:x,class:this.classes(v,"esri-attachments__image")}))};k.renderFile=function(q){const {file:x}=q;return u.tsx("li",{class:"esri-attachments__item",key:x},u.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(q),type:"button"},this.renderImageMask(q),
u.tsx("label",{class:"esri-attachments__label"},u.tsx("span",{class:"esri-attachments__filename"},x.name||this.messages.noTitle),u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",t.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}))))};k.renderAttachmentInfo=function({attachmentInfo:q,displayType:x}){const {viewModel:v,effectiveDisplayType:D}=this,{abilities:F,supportsResizeAttachments:G}=v,{contentType:J,name:L,url:K}=q;x=this.renderImageMask(q,
"list"===x?48:400);var O=F.editing?u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",t.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;O="preview"===D&&G&&A.isSupportedImage(J)?null:u.tsx("label",{class:"esri-attachments__label"},u.tsx("span",{class:"esri-attachments__filename"},L||this.messages.noTitle),O);x=[x,O];x=F.editing?u.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,
"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":q.id,onclick:()=>this._startEditAttachment(q),type:"button"},x):u.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:K,target:"_blank"},x);return u.tsx("li",{class:"esri-attachments__item",key:q},x)};k.renderAttachmentContainer=function(){const {effectiveDisplayType:q,viewModel:x,visibleElements:v}=this,{attachmentInfos:D,abilities:F,fileInfos:G}=x;var J=!!D?.length;const L=!!G?.length,K={["esri-attachments__container--list"]:"preview"!==
q,["esri-attachments__container--preview"]:"preview"===q},O=F.editing&&F.operations.add&&v.addButton?u.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):void 0,P=J?u.tsx("ul",{key:"attachments-list",class:"esri-attachments__items"},D.toArray().map(H=>
this.renderAttachmentInfo({attachmentInfo:H,displayType:q}))):void 0,N=L?u.tsx("ul",{key:"file-list",class:"esri-attachments__items"},G.toArray().map(H=>this.renderFile(H))):void 0;J=L||J?void 0:u.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return u.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",K)},P,N,J,O)};k._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};k._handleFileInputChange=function(q){q=
(q=q.target)&&q.files&&q.files.item(0);this._set("selectedFile",q)};k._submitDeleteAttachment=function(q,x){q.preventDefault();"file"in x?this.deleteFile(x.file):this.deleteAttachment(x)};k._submitAddAttachment=function(q){q.preventDefault();this.viewModel.filesEnabled?this.addFile():this.addAttachment()};k._submitUpdateAttachment=function(q,x){q.preventDefault();"file"in x?this.updateFile():this.updateAttachment()};k._startEditAttachment=function(q){const {viewModel:x}=this;x.activeFileInfo=null;
x.activeAttachmentInfo=q;x.mode="edit"};k._startEditFile=function(q){const {viewModel:x}=this;x.activeAttachmentInfo=null;x.activeFileInfo=q;x.mode="edit"};k._startAddAttachment=function(){this.viewModel.mode="add"};k._cancelForm=function(q){q.preventDefault();this.viewModel.mode="view"};k._getCSSTransform=function(q){({orientationInfo:q}=q);return!this._supportsImageOrientation&&q?[q.rotation?`rotate(${q.rotation}deg)`:"",q.mirrored?"scaleX(-1)":""].join(" "):""};b._createClass(C,[{key:"abilities",
get:function(){return this.viewModel.abilities},set:function(q){this.viewModel.abilities=q}},{key:"effectiveDisplayType",get:function(){const {displayType:q}=this;return q&&"auto"!==q?q:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(q){this.viewModel.graphic=q}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(q){this._overrideIfSome("label",q)}}]);return C}(e);c.__decorate([g.property()],
h.prototype,"abilities",null);c.__decorate([g.property()],h.prototype,"displayType",void 0);c.__decorate([g.property({readOnly:!0})],h.prototype,"effectiveDisplayType",null);c.__decorate([g.property()],h.prototype,"graphic",null);c.__decorate([g.property()],h.prototype,"label",null);c.__decorate([g.property(),w.messageBundle("esri/widgets/Attachments/t9n/Attachments")],h.prototype,"messages",void 0);c.__decorate([g.property(),w.messageBundle("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0);
c.__decorate([g.property({readOnly:!0})],h.prototype,"selectedFile",void 0);c.__decorate([g.property({readOnly:!0})],h.prototype,"submitting",void 0);c.__decorate([g.property({readOnly:!0})],h.prototype,"error",void 0);c.__decorate([g.property({type:l})],h.prototype,"viewModel",void 0);c.__decorate([g.property()],h.prototype,"visibleElements",void 0);c.__decorate([d.cast("visibleElements")],h.prototype,"castVisibleElements",null);return h=c.__decorate([f.subclass("esri.widgets.Attachments")],h)})},
"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./Cyclical ./mathUtils ./maybe ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,r,m,n,p,g){function h(t,w,u){return t.units[w][u]}function d(t,w,u,z=2,y="abbr"){return`${g.formatNumber(w,{minimumFractionDigits:z,maximumFractionDigits:z,signDisplay:0<w?"never":"exceptZero"})} ${h(t,u,y)}`}function f(t,w,u,z=2,y="abbr"){return`${g.formatNumber(w,{minimumFractionDigits:z,maximumFractionDigits:z,signDisplay:"exceptZero"})} ${h(t,
u,y)}`}function e(t,w){const u=JSON.stringify(w);let z=l.get(u);z||(z=new Intl.NumberFormat("en-US",w),l.set(u,z));return/\-?\+?360/.test(z.format(t))?0:t}const l=new Map,A=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(t,w,u,z,y){y=m.unwrapOr(y,2);var B=c.cyclicalDegrees,C=B.normalize;a:if(t=p.convertUnit(t,w,"degrees"),u===z)u=t;else{switch(z){case "arithmetic":u=-t+90;break a;case "geographic":u=-t-90;break a}u=void 0}B=C.call(B,u,0,!0);y={style:"unit",unitDisplay:"narrow",unit:"degree",
maximumFractionDigits:y,minimumFractionDigits:y,signDisplay:0<B?"never":"exceptZero"};B=e(B,y);return g.formatNumber(B,y)};a.formatDMS=function(t,w,u=2){t=p.convertUnit(t,w,"degrees");w=t-Math.floor(t);t-=w;w*=60;let z=w-Math.floor(w);w-=z;z*=60;return`${t.toFixed()}\u00b0 ${w.toFixed()}' ${z.toFixed(u)}"`};a.formatDecimal=d;a.formatFileSize=function(t,w){let u=0===w?0:Math.floor(Math.log(w)/Math.log(b.ByteSizeUnit.KILOBYTES));u=r.clamp(u,0,A.length-1);w=g.formatNumber(w/b.ByteSizeUnit.KILOBYTES**
u,{maximumFractionDigits:2});return n.replace(t.units.bytes[A[u]],{fileSize:w})};a.formatImperialArea=function(t,w,u,z=2,y="abbr"){const B=p.preferredImperialAreaUnit(w,u);return d(t,p.convertUnit(w,u,B),B,z,y)};a.formatImperialLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredImperialLengthUnit(w,u);return d(t,p.convertUnit(w,u,B),B,z,y)};a.formatImperialRelativeLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredImperialLengthUnit(w,u);return f(t,p.convertUnit(w,u,B),B,z,y)};a.formatImperialRelativeVerticalLength=
function(t,w,u,z=2,y="abbr"){const B=p.preferredImperialVerticalLengthUnit(w,u);return f(t,p.convertUnit(w,u,B),B,z,y)};a.formatImperialVerticalLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredImperialVerticalLengthUnit(w,u);return d(t,p.convertUnit(w,u,B),B,z,y)};a.formatMetricArea=function(t,w,u,z=2,y="abbr"){const B=p.preferredMetricAreaUnit(w,u);return d(t,p.convertUnit(w,u,B),B,z,y)};a.formatMetricLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredMetricLengthUnit(w,u);return d(t,p.convertUnit(w,
u,B),B,z,y)};a.formatMetricRelativeLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredMetricLengthUnit(w,u);return f(t,p.convertUnit(w,u,B),B,z,y)};a.formatMetricRelativeVerticalLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredMetricVerticalLengthUnit(w,u);return f(t,p.convertUnit(w,u,B),B,z,y)};a.formatMetricVerticalLength=function(t,w,u,z=2,y="abbr"){const B=p.preferredMetricVerticalLengthUnit(w,u);return d(t,p.convertUnit(w,u,B),B,z,y)};a.formatRelativeAngleDegrees=function(t,w,u,z,y){u!==
z&&(t=-t);y=m.unwrapOr(y,2);u={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:y,minimumFractionDigits:y,signDisplay:"exceptZero"};t=p.convertUnit(t,w,"degrees")%360;t=e(t,u);return g.formatNumber(t,u)};a.formatRelativeDecimal=f;a.unitName=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){const w={editing:!1,operations:{add:!0,update:!0,delete:!0}},u=m.ofType(l);r=function(z){function y(C){var k=z.call(this,C)||this;k._getAttachmentsPromise=null;k._attachmentLayer=null;k.abilities={...w};k.activeAttachmentInfo=null;k.activeFileInfo=null;k.attachmentInfos=new u;k.fileInfos=new m;k.graphic=null;k.mode="view";k.filesEnabled=!1;k.addHandles(g.watch(()=>k.graphic,()=>k._graphicChanged(),g.initial));return k}a._inheritsLoose(y,z);var B=y.prototype;
B.destroy=function(){this.graphic=this._attachmentLayer=null};B.castAbilities=function(C){return{...w,...C}};B.getAttachments=function(){var C=a._asyncToGenerator(function*(){const {_attachmentLayer:k,attachmentInfos:q}=this;if(!k||"function"!==typeof k.queryAttachments)throw new n("invalid-layer","getAttachments(): A valid layer is required.");const x=this._getObjectId();var v=new A({objectIds:[x],returnMetadata:!0});const D=[];this._getAttachmentsPromise=v=k.queryAttachments(v).then(F=>F[x]||D).catch(()=>
D);this.notifyChange("state");v=yield v;q.removeAll();v.length&&q.addMany(v);this._getAttachmentsPromise=null;this.notifyChange("state");return v});return function(){return C.apply(this,arguments)}}();B.addAttachment=function(){var C=a._asyncToGenerator(function*(k,q=this.graphic){const {_attachmentLayer:x,attachmentInfos:v,abilities:D}=this;if(!q)throw new n("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:q});if(!k)throw new n("invalid-attachment","addAttachment(): An attachment is required.",
{attachment:k});if(!D.operations.add)throw new n("invalid-abilities","addAttachment(): add abilities are required.");if(!x||"function"!==typeof x.addAttachment)throw new n("invalid-layer","addAttachment(): A valid layer is required.");k=yield x.addAttachment(q,k).then(F=>this._queryAttachment(F.objectId,q));v.add(k);return k});return function(k){return C.apply(this,arguments)}}();B.deleteAttachment=function(){var C=a._asyncToGenerator(function*(k){const {_attachmentLayer:q,attachmentInfos:x,graphic:v,
abilities:D}=this;if(!k)throw new n("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:k});if(!D.operations.delete)throw new n("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!q||"function"!==typeof q.deleteAttachments)throw new n("invalid-layer","deleteAttachment(): A valid layer is required.");const F=yield q.deleteAttachments(v,[k.id]).then(()=>k);x.remove(F);return F});return function(k){return C.apply(this,arguments)}}();
B.updateAttachment=function(){var C=a._asyncToGenerator(function*(k,q=this.activeAttachmentInfo){const {_attachmentLayer:x,attachmentInfos:v,graphic:D,abilities:F}=this;if(!k)throw new n("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:k});if(!q)throw new n("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:q});if(!F.operations.update)throw new n("invalid-abilities","updateAttachment(): Update abilities are required.");const G=
v.findIndex(J=>J===q);if(!x||"function"!==typeof x.updateAttachment)throw new n("invalid-layer","updateAttachment(): A valid layer is required.");k=yield x.updateAttachment(D,q.id,k).then(J=>this._queryAttachment(J.objectId));v.splice(G,1,k);return k});return function(k){return C.apply(this,arguments)}}();B.commitFiles=function(){var C=a._asyncToGenerator(function*(){yield Promise.all(this.fileInfos.items.map(k=>this.addAttachment(k.form)));this.fileInfos.removeAll();return this.getAttachments()});
return function(){return C.apply(this,arguments)}}();B.addFile=function(C,k){if(!C||!k)return null;C={file:C,form:k};this.fileInfos.add(C);return C};B.updateFile=function(C,k,q=this.activeFileInfo){if(!C||!k||!q)return null;const x=this.fileInfos.findIndex(v=>q===v);-1<x&&this.fileInfos.splice(x,1,{file:C,form:k});return this.fileInfos.items[x]};B.deleteFile=function(C){const k=this.fileInfos.find(q=>q.file===C);return this.fileInfos.remove(k)??null};B._queryAttachment=function(){var C=a._asyncToGenerator(function*(k,
q){if(!k)throw new n("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:x}=this,v=this._getObjectId(q);k=new A({objectIds:[v],attachmentsWhere:`AttachmentId=${k}`,returnMetadata:!0});return x.queryAttachments(k).then(D=>D[v][0])});return function(k,q){return C.apply(this,arguments)}}();B._getObjectId=function(C=this.graphic){return C?.getObjectId()??null};B._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};B._setAttachmentLayer=
function(){var {graphic:C}=this;this._attachmentLayer=(C=t.getSourceLayer(C))?"scene"===C.type&&p.isSome(C.associatedLayer)?C.associatedLayer:C:null};a._createClass(y,[{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){var {graphic:C}=this;if(!C)return!1;C=C.layer||C.sourceLayer;return C?.loaded&&"capabilities"in C&&"operations"in C.capabilities&&"supportsResizeAttachments"in C.capabilities.operations&&
C.capabilities.operations.supportsResizeAttachments||!1}}]);return y}(r);b.__decorate([h.property()],r.prototype,"abilities",void 0);b.__decorate([f.cast("abilities")],r.prototype,"castAbilities",null);b.__decorate([h.property()],r.prototype,"activeAttachmentInfo",void 0);b.__decorate([h.property()],r.prototype,"activeFileInfo",void 0);b.__decorate([h.property({readOnly:!0,type:u})],r.prototype,"attachmentInfos",void 0);b.__decorate([h.property()],r.prototype,"fileInfos",void 0);b.__decorate([h.property({type:c})],
r.prototype,"graphic",void 0);b.__decorate([h.property()],r.prototype,"mode",void 0);b.__decorate([h.property({readOnly:!0})],r.prototype,"state",null);b.__decorate([h.property()],r.prototype,"filesEnabled",void 0);b.__decorate([h.property({readOnly:!0})],r.prototype,"supportsResizeAttachments",null);return r=b.__decorate([e.subclass("esri.widgets.Attachments.AttachmentsViewModel")],r)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(){e=b._asyncToGenerator(function*(ba,ia){return"function"===typeof ba?ba.call(null,ia):ba});return e.apply(this,arguments)}function l(ba){return ba?S.test(ba):!1}function A(ba,ia){if(!l(ia)||!ba)return null;const ma=ia.replace(S,"").toLowerCase();let ha;ba.some(ka=>ka.name.toLowerCase()===ma?(ha=ka,!0):!1);return ha}function t(ba,ia){return(ia=w(ia,ba))?ia.name:ba}function w(ba,ia){return ba&&"function"===typeof ba.getField?ba.getField(ia):null}function u({formattedAttributes:ba,
template:ia,fieldInfoMap:ma}){return`${n.replace(n.replace(ia,ha=>{const ka=ma.get(ha.toLowerCase());return`{${ka&&ka.fieldName||ha}}`}),ba).replace(M,"")}`.trim()}function z(ba,ia,ma=!1){const ha=ia[ba];"string"===typeof ha&&(ma=(ma?encodeURIComponent(ha):ha).replace(T,"%27"),ia[ba]=ma)}function y(ba,ia=!1){const ma={...ba};Object.keys(ma).forEach(ha=>z(ha,ma,ia));return ma}function B(ba,ia){return ba.replace(Q,(ma,ha,ka)=>(ma=w(ia,ka))?`{${ma.name}}`:ha)}function C(ba,ia,ma){return(ba=B(ba,ma))?
ba.replace(V,(ha,ka,Z)=>{ka=`${ka||Z}`.trim();return n.replace(ha,y(ia,ka&&"{"!==ka[0]))}):ba}function k(ba,ia){var ma=ia.fieldName,ha=q(ia.fieldInfos,ma)?.clone();const ka=ia.preventPlacesFormatting;ia=ia.layer;var Z=w(ia,ma);ha&&"date"===Z?.type&&(Z=ha.format||new d,Z.dateFormat=Z.dateFormat||"short-date-short-time",Z.dateTimeFormatOptions=!ia?.layer&&"feature"===ia?.type&&ia.datesInUnknownTimezone||ia?.layer&&"map-image"===ia.layer?.type&&ia.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,ha.format=
Z);ha=ha&&ha.format;if("string"===typeof ba&&h.isRasterPixelValueField(ma)&&ha)return ha.formatRasterPixelValue(ba);"string"!==typeof ba||!ha||null!=ha.dateFormat||null==ha.places&&null==ha.digitSeparator||(ma=Number(ba),isNaN(ma)||(ba=ma));return"string"===typeof ba||null==ba||null==ha?D(ba):ka?g.formatNumber(ba,{...g.convertNumberFormatToIntlOptions(ha),minimumFractionDigits:0,maximumFractionDigits:20}):ha.format(ba)}function q(ba,ia){if(ba&&ba.length&&ia){var ma=ia.toLowerCase(),ha=void 0;ba.some(ka=>
ka.fieldName&&ka.fieldName.toLowerCase()===ma?(ha=ka,!0):!1);return ha}}function x({fieldName:ba,graphic:ia,layer:ma}){if(P(ba)||!ma||"function"!==typeof ma.getFeatureType)return null;const {typeIdField:ha}=ma;return ha&&ba===ha?(ba=ma.getFeatureType(ia))?ba.name:null:null}function v({fieldName:ba,value:ia,graphic:ma,layer:ha}){return P(ba)||!ha||"function"!==typeof ha.getFieldDomain?null:(ba=ha.getFieldDomain(ba,{feature:ma}))&&"coded-value"===ba.type?ba.getName(ia):null}function D(ba){return"string"===
typeof ba?ba.replace(U,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):ba}function F(ba){const {value:ia,fieldName:ma,fieldInfos:ha,fieldInfoMap:ka,layer:Z,graphic:ca}=ba;return null==ia?"":(ba=v({fieldName:ma,value:ia,graphic:ca,layer:Z}))||(ba=x({fieldName:ma,graphic:ca,layer:Z}))?ba:ka.get(ma.toLowerCase())?k(ia,{fieldInfos:ha||Array.from(ka.values()),fieldName:ma,layer:Z}):(ba=Z&&Z.fieldsIndex)&&ba.isDateField(ma)?p.formatDate(ia,X):D(ia)}function G(ba,ia){return J.apply(this,arguments)}function J(){J=
b._asyncToGenerator(function*(ba,ia){const {layer:ma,graphic:ha,outFields:ka,objectIds:Z,returnGeometry:ca,spatialReference:fa}=ba;ba=Z[0];if("number"!==typeof ba&&"string"!==typeof ba)return I.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:ma,graphic:ha,objectId:ba,requiredFields:ka}),null;if(!ma.capabilities?.operations?.supportsQuery)return I.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:ma,
graphic:ha,requiredFields:ka,returnGeometry:ca}),null;ba=ma.createQuery();ba.objectIds=Z;ba.outFields=ka?.length?ka:[ma.objectIdField];ba.returnGeometry=!!ca;ba.returnZ=!!ca;ba.returnM=!!ca;ba.outSpatialReference=fa;return(yield ma.queryFeatures(ba,ia)).features[0]});return J.apply(this,arguments)}function L(ba){return K.apply(this,arguments)}function K(){K=b._asyncToGenerator(function*(ba){if(!ba.expressionInfos?.length)return!1;var ia=yield f.loadArcade();({arcadeUtils:{hasGeometryFunctions:ia}}=
ia);return ia(ba)});return K.apply(this,arguments)}function O(){O=b._asyncToGenerator(function*({graphic:ba,popupTemplate:ia,layer:ma,spatialReference:ha},ka){if(ma&&ia&&("function"===typeof ma.load&&(yield ma.load(ka)),ba.attributes)){var Z=ba.attributes[ma.objectIdField];if(null!=Z){Z=[Z];var ca=yield ia.getRequiredFields(ma.fieldsIndex),fa=h.featureHasFields(ca,ba);ca=fa?[]:ca;ia=ia.returnGeometry||(yield L(ia));if(!fa||ia)if(ma=yield G({layer:ma,graphic:ba,outFields:ca,objectIds:Z,returnGeometry:ia,
spatialReference:ha},ka))ma.geometry&&(ba.geometry=ma.geometry),ma.attributes&&(ba.attributes={...ba.attributes,...ma.attributes})}}});return O.apply(this,arguments)}function P(ba=""){return ba?ba.includes("relationships/"):!1}function N({attributes:ba,graphic:ia,relatedInfo:ma,fieldInfos:ha,fieldInfoMap:ka,layer:Z}){ba&&ia&&ma&&Object.keys(ia.attributes).forEach(ca=>{var fa=(fa={layerId:ma.relation.id.toString(),fieldName:ca},`${"relationships/"}${fa.layerId}/${fa.fieldName}`);ba[fa]=F({fieldName:fa,
fieldInfos:ha,fieldInfoMap:ka,layer:Z,value:ia.attributes[ca],graphic:ia})})}function H({attributes:ba,relatedInfo:ia,fieldInfoMap:ma,fieldInfos:ha,layer:ka}){ba&&ia&&(ia.relatedFeatures&&ia.relatedFeatures&&ia.relatedFeatures.forEach(Z=>N({attributes:ba,graphic:Z,relatedInfo:ia,fieldInfoMap:ma,fieldInfos:ha,layer:ka})),ia.relatedStatsFeatures&&ia.relatedStatsFeatures&&ia.relatedStatsFeatures.forEach(Z=>N({attributes:ba,graphic:Z,relatedInfo:ia,fieldInfoMap:ma,fieldInfos:ha,layer:ka})))}function E(ba,
ia,ma){return ba.find(ha=>ha!==ia&&"feature"===ha.type&&ha.url===ia.url&&ha.layerId===ma.relatedTableId)}const I=r.getLogger("esri.widgets.Feature.support.featureUtils"),M=/href=(""|'')/gi,Q=/(\{([^\{\r\n]+)\})/g,T=/'/g,S=/^\s*expression\//i,U=/(\n)/gi,Y=/[\u00A0-\u9999<>&]/gim,V=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,R=/^(?:mailto:|tel:)/,X=p.convertDateFormatToIntlOptions("short-date-short-time"),W=ba=>{if(!ba)return!1;ba=ba.toUpperCase();return ba.includes("CURRENT_TIMESTAMP")||ba.includes("CURRENT_DATE")||
ba.includes("CURRENT_TIME")},aa=({layer:ba,method:ia,query:ma,definitionExpression:ha})=>{ba.capabilities?.query?.supportsCacheHint&&"attachments"!==ia&&(ba=m.isSome(ma.where)&&ma.where,ia=m.isSome(ma.geometry)&&ma.geometry,W(ha)||W(ba)||"extent"===ia?.type||"tile"===ma.resultType||(ma.cacheHint=!0))};a.applyTextFormattingHTML=D;a.createfieldInfoMap=function(ba,ia){const ma=new Map;ba&&ba.forEach(ha=>{const ka=t(ha.fieldName,ia);ha.fieldName=ka;ma.set(ka.toLowerCase(),ha)});return ma};a.findRelatedLayer=
function(ba,ia,ma){return ba&&ia&&ma?E(ba.allLayers,ia,ma)||E(ba.allTables,ia,ma):null};a.fixTokens=B;a.formatAttributes=function({fieldInfos:ba,attributes:ia,layer:ma,graphic:ha,fieldInfoMap:ka,relatedInfos:Z}){const ca={};Z?.forEach(fa=>H({attributes:ca,relatedInfo:fa,fieldInfoMap:ka,fieldInfos:ba,layer:ma}));Object.keys(ia).forEach(fa=>{ca[fa]=F({fieldName:fa,fieldInfos:ba,fieldInfoMap:ka,layer:ma,value:ia[fa],graphic:ha})});return ca};a.formatEditInfo=function(ba,ia){const {creatorField:ma,creationDateField:ha,
editorField:ka,editDateField:Z}=ba;if(ia){ba=ia[Z];if("number"===typeof ba)return ia=ia[ka],{type:"edit",date:p.formatDate(ba,X),user:ia};ba=ia[ha];return"number"===typeof ba?(ia=ia[ma],{type:"create",date:p.formatDate(ba,X),user:ia}):null}};a.formatValueToFieldInfo=k;a.getAllFieldInfos=function(ba){const ia=[];if(!ba)return ia;const {fieldInfos:ma,content:ha}=ba;ma&&ia.push(...ma);if(!ha||!Array.isArray(ha))return ia;ha.forEach(ka=>{"fields"===ka.type&&(ka=ka&&ka.fieldInfos)&&ia.push(...ka)});return ia};
a.getFieldInfo=q;a.getFieldInfoLabel=function(ba,ia){return(ia=A(ia,ba?.fieldName))?ia.title||null:ba?ba.label||ba.fieldName:null};a.getFixedFieldName=t;a.getFixedFieldNames=function(ba,ia){return ba&&ba.map(ma=>t(ma,ia))};a.getSourceLayer=function(ba){if(!m.isNone(ba))return ba.get("sourceLayer")||ba.get("layer")};a.graphicCallback=function(ba,ia){return e.apply(this,arguments)};a.htmlEntities=function(ba){return ba.replace(Y,ia=>`&#${ia.charCodeAt(0)};`)};a.isExpressionField=l;a.isRelatedField=
P;a.preLayerQueryCallback=({query:ba,layer:ia,method:ma})=>{aa({layer:ia,method:ma,query:ba,definitionExpression:`${ia.definitionExpression} ${ia.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:ba,layer:ia,method:ma})=>{aa({layer:ia,method:ma,query:ba,definitionExpression:`${ia.definitionExpression} ${ia.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(ba,ia){return O.apply(this,arguments)};a.shouldOpenInNewTab=function(ba=""){if(ba)return!R.test(ba.trim().toLowerCase())};
a.substituteAttributes=u;a.substituteFieldsInLinksAndAttributes=function({attributes:ba,globalAttributes:ia,layer:ma,text:ha,expressionAttributes:ka,fieldInfoMap:Z}){return ha?u({formattedAttributes:ia,template:C(ha,{...ia,...ka,...ba},ma),fieldInfoMap:Z}):""};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,b){a.getIconPath=function(c){const r=b.getAssetUrl("esri/themes/base/images/files/");
return c?"text/plain"===c?`${r}text-32.svg`:"application/pdf"===c?`${r}pdf-32.svg`:"text/csv"===c?`${r}csv-32.svg`:"application/gpx+xml"===c?`${r}gpx-32.svg`:"application/x-dwf"===c?`${r}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${r}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||
"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${r}zip-32.svg`:c.includes("image/")?`${r}image-32.svg`:c.includes("audio/")?`${r}sound-32.svg`:c.includes("video/")?`${r}video-32.svg`:c.includes("msexcel")||c.includes("ms-excel")||c.includes("spreadsheetml")?`${r}excel-32.svg`:c.includes("msword")||c.includes("ms-word")||c.includes("wordprocessingml")?`${r}word-32.svg`:c.includes("powerpoint")||c.includes("presentationml")?
`${r}report-32.svg`:`${r}generic-32.svg`:`${r}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,r,m,n,p){r=function(g){function h(d){d=g.call(this,d)||this;d.description=null;d.title=null;return d}a._inheritsLoose(h,g);return h}(p);b.__decorate([c.property()],r.prototype,"description",void 0);b.__decorate([c.property()],r.prototype,"title",void 0);return r=b.__decorate([n.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],r)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d){r=function(f){function e(A,t){A=f.call(this,A,t)||this;A.description=null;A.headingLevel=2;A.title=null;return A}a._inheritsLoose(e,f);var l=e.prototype;l.render=function(){return d.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};l.renderTitle=function(){const {title:A}=this;return A?d.tsx(g.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},A):null};l.renderDescription=function(){const {description:A}=
this;return A?d.tsx("div",{key:"description",class:"esri-feature-element-info__description"},A):null};return e}(p);b.__decorate([c.property()],r.prototype,"description",void 0);b.__decorate([c.property()],r.prototype,"headingLevel",void 0);b.__decorate([c.property()],r.prototype,"title",void 0);return r=b.__decorate([n.subclass("esri.widgets.Feature.support.FeatureElementInfo")],r)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./widgetUtils","./jsxFactory"],
function(a,b,c,r){const m={heading:"esri-widget__heading"};a.CSS=m;a.Heading=function(n,p){const g=b.clamp(Math.ceil(n.level),1,6),h=`h${g}`;delete n.level;return r.tsx(h,{...n,class:c.classes(m.heading,n.class),role:"heading","aria-level":String(g)},p)};a.incrementHeadingLevel=function(n,p=1){return b.clamp(Math.ceil(n+p),1,6)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){r=function(e){function l(t,w){t=e.call(this,t,w)||this;t.viewModel=null;t._addTargetToAnchors=u=>{Array.from(u.querySelectorAll("a")).forEach(z=>{h.shouldOpenInNewTab(z.href)&&!z.hasAttribute("target")&&z.setAttribute("target","_blank")})};return t}a._inheritsLoose(l,e);var A=l.prototype;A.renderLoading=function(){return f.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},f.tsx("div",{class:"esri-feature-content__loader"}))};A.renderCreated=function(){const t=
this.viewModel?.created;return t?t instanceof HTMLElement?f.tsx("div",{key:t,bind:t,afterCreate:this._attachToNode}):d.isWidget(t)?f.tsx("div",{key:t},!t.destroyed&&t.render()):f.tsx("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null};A.render=function(){return f.tsx("div",{class:"esri-feature-content"},"loading"===this.viewModel?.state?this.renderLoading():this.renderCreated())};A._attachToNode=function(t){t.appendChild(this)};a._createClass(l,[{key:"creator",get:function(){return this.viewModel.creator},
set:function(t){this.viewModel.creator=t}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(t){this.viewModel.graphic=t}}]);return l}(p);b.__decorate([c.property()],r.prototype,"creator",null);b.__decorate([c.property()],r.prototype,"graphic",null);b.__decorate([c.property({type:g})],r.prototype,"viewModel",void 0);return r=b.__decorate([n.subclass("esri.widgets.Feature.FeatureContent")],r)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){r=function(e){function l(t){var w=e.call(this,t)||this;w._loadingPromise=null;w.created=null;w.creator=null;w.destroyer=null;w.graphic=null;w.handles.add(n.watch(()=>w.creator,u=>{w._destroyContent();w._createContent(u)},n.initial));return w}a._inheritsLoose(l,e);var A=l.prototype;A.destroy=function(){this._destroyContent()};A._destroyContent=function(){const {created:t,graphic:w,destroyer:u}=this;t&&(f.graphicCallback(u,{graphic:w}).catch(()=>null),this._set("created",
null))};A._createContent=function(){var t=a._asyncToGenerator(function*(w){var {graphic:u}=this;this._loadingPromise=w=f.graphicCallback(w,{graphic:u}).catch(()=>null);this.notifyChange("state");u=yield w;w===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",u))});return function(w){return t.apply(this,arguments)}}();a._createClass(l,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return l}(m.HandleOwnerMixin(r));b.__decorate([p.property({readOnly:!0})],
r.prototype,"created",void 0);b.__decorate([p.property()],r.prototype,"creator",void 0);b.__decorate([p.property()],r.prototype,"destroyer",void 0);b.__decorate([p.property({type:c})],r.prototype,"graphic",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"state",null);return r=b.__decorate([d.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],r)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){m=function(t){function w(z,y){z=t.call(this,z,y)||this;z.viewModel=new e;return z}a._inheritsLoose(w,t);var u=w.prototype;u.initialize=function(){this.addHandles(c.watch(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),c.initial))};u.destroy=function(){this._destroyContentWidget()};u.renderLoading=function(){return A.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},A.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating",
"esri-feature__loading-spinner")}))};u.render=function(){const {state:z}=this.viewModel;return A.tsx("div",{class:"esri-feature-expression"},"loading"===z?this.renderLoading():"disabled"===z?null:this._contentWidget?.render())};u._destroyContentWidget=function(){const {_contentWidget:z}=this;z&&(z.viewModel=null,z.destroy());this._contentWidget=null};u._setupExpressionWidget=function(){const {contentElementViewModel:z,contentElement:y}=this.viewModel,B=y?.type;this._destroyContentWidget();this._contentWidget=
z?"fields"===B?new d({viewModel:z}):"media"===B?new f({viewModel:z}):"text"===B?new h({viewModel:z}):null:null;this.scheduleRender()};return w}(g);b.__decorate([r.property({type:e})],m.prototype,"viewModel",void 0);return m=b.__decorate([p.subclass("esri.widgets.Feature.FeatureExpression")],m)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){m=function(t){function w(z,y){z=t.call(this,z,y)||this;z._featureElementInfo=null;z.viewModel=new h;z.messages=null;z.messagesURIUtils=null;return z}a._inheritsLoose(w,t);var u=w.prototype;u.initialize=function(){this._featureElementInfo=new d;this.addHandles(c.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),c.initial))};u.destroy=function(){this._featureElementInfo.destroy()};u.renderFieldInfo=function(z,y){var {attributes:B}=
this.viewModel;const C=z.fieldName,k=z.label||C;B=B?null==B[C]?"":B[C]:"";z=!(!z.format||!z.format.dateFormat);B="number"!==typeof B||z?f.autoLink(this.messagesURIUtils,B):this._forceLTR(B);z={["esri-feature-fields__field-data--date"]:z};return A.tsx("tr",{key:`fields-element-info-row-${C}-${y}`},A.tsx("th",{key:`fields-element-info-row-header-${C}-${y}`,class:"esri-feature-fields__field-header",innerHTML:k}),A.tsx("td",{key:`fields-element-info-row-data-${C}-${y}`,class:this.classes("esri-feature-fields__field-data",
z),innerHTML:B}))};u.renderFields=function(){const {formattedFieldInfos:z}=this.viewModel;return z?.length?A.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},A.tsx("tbody",null,z.map((y,B)=>this.renderFieldInfo(y,B)))):null};u.render=function(){return A.tsx("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this.renderFields())};u._setupFeatureElementInfo=function(){const {description:z,title:y}=this;this._featureElementInfo.set({description:z,title:y})};
u._forceLTR=function(z){return`&lrm;${z}`};a._createClass(w,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(z){this.viewModel.attributes=z}},{key:"description",get:function(){return this.viewModel.description},set:function(z){this.viewModel.description=z}},{key:"expressionInfos",get:function(){return this.viewModel.expressionInfos},set:function(z){this.viewModel.expressionInfos=z}},{key:"fieldInfos",get:function(){return this.viewModel.fieldInfos},set:function(z){this.viewModel.fieldInfos=
z}},{key:"title",get:function(){return this.viewModel.title},set:function(z){this.viewModel.title=z}}]);return w}(g);b.__decorate([r.property()],m.prototype,"attributes",null);b.__decorate([r.property()],m.prototype,"description",null);b.__decorate([r.property()],m.prototype,"expressionInfos",null);b.__decorate([r.property()],m.prototype,"fieldInfos",null);b.__decorate([r.property()],m.prototype,"title",null);b.__decorate([r.property({type:h,nonNullable:!0})],m.prototype,"viewModel",void 0);b.__decorate([r.property(),
l.messageBundle("esri/widgets/Feature/t9n/Feature")],m.prototype,"messages",void 0);b.__decorate([r.property(),l.messageBundle("esri/widgets/support/t9n/uriUtils")],m.prototype,"messagesURIUtils",void 0);return m=b.__decorate([p.subclass("esri.widgets.Feature.FeatureFields")],m)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){c=function(f){function e(l){l=f.call(this,l)||this;l.attributes=null;l.expressionInfos=null;l.description=null;l.fieldInfos=null;l.title=null;return l}a._inheritsLoose(e,f);a._createClass(e,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:l,fieldInfos:A}=this,t=[];A?.forEach(w=>{if(!w.hasOwnProperty("visible")||w.visible)w=w.clone(),w.label=d.getFieldInfoLabel(w,l),t.push(w)});return t}}]);return e}(c);b.__decorate([r.property()],c.prototype,"attributes",
void 0);b.__decorate([r.property({type:[g]})],c.prototype,"expressionInfos",void 0);b.__decorate([r.property()],c.prototype,"description",void 0);b.__decorate([r.property({type:[h]})],c.prototype,"fieldInfos",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([r.property()],c.prototype,"title",void 0);return c=b.__decorate([p.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,b){function c(m){let n=null;r.some(p=>{p.pattern.test(m)&&(n=p);return!!n});return n}const r=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(m,n){if("string"!==typeof n||!n)return n;const p=c(n);if(!p)return n;const g=n.match(p.pattern);
m=b.replace(b.replace(p.label,{messages:m,hierPart:g&&g[2]}),{appName:p.appName});return n.replace(p.pattern,`<a${p.target?` target="${p.target}"`:""} href="$1"${"_blank"===p.target?' rel\x3d"noreferrer"':""}>${m}</a>`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){n=function(y){function B(k,q){var x=y.call(this,k,q)||this;x._refreshTimer=null;x._refreshIntervalInfo=null;x._featureElementInfo=null;x.viewModel=new f;x.messages=null;x._getChartDependencies=function(){var v=a._asyncToGenerator(function*(D){const F=yield A.loadChartsModule(),{destroyed:G,viewModel:J}=a._assertThisInitialized(x);if(!G&&J&&D){var {activeMediaInfo:L}=J,K=yield x._getRendererColors(F);x._renderChart({chartDiv:D,mediaInfo:L,chartsModule:F,
colorMap:K})}});return function(D){return v.apply(this,arguments)}}();return x}a._inheritsLoose(B,y);var C=B.prototype;C.initialize=function(){this._featureElementInfo=new e;this.addHandles([r.watch(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),r.initial),r.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),r.initial)])};C.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};
C.render=function(){return u.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())};C.renderMedia=function(){const {formattedMediaInfoCount:k}=this.viewModel;return k?u.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};C.renderImageMediaInfo=function(k){var {_refreshIntervalInfo:q}=this;
const {activeMediaInfoIndex:x,formattedMediaInfoCount:v}=this.viewModel,{value:D,refreshInterval:F,altText:G,title:J,type:L}=k,{sourceURL:K,linkURL:O}=D;k=l.shouldOpenInNewTab(O)?"_blank":"_self";const P="_blank"===k?"noreferrer":"";q=F?q:null;q=u.tsx("img",{alt:G||J,key:`media-${L}-${x}-${v}-${q?q.timestamp:0}`,src:q?q.sourceURL:K});return(k=O?u.tsx("a",{title:J,href:O,rel:P,target:k},q):null)?k:q};C.renderChartMediaInfo=function(k){const {activeMediaInfoIndex:q,formattedMediaInfoCount:x}=this.viewModel;
return u.tsx("div",{key:`media-${k.type}-${q}-${x}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};C.renderMediaInfoType=function(){const {activeMediaInfo:k}=this.viewModel;return k?"image"===k.type?this.renderImageMediaInfo(k):k.type.includes("chart")?this.renderChartMediaInfo(k):null:null};C.renderMediaInfo=function(){var {activeMediaInfo:k}=this.viewModel;if(!k)return null;const q=k.title?u.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",
innerHTML:k.title}):null;k=k.caption?u.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:k.caption}):null;return u.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},u.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),q,k)};C.renderMediaPageButton=function(k){if(2>this.viewModel.formattedMediaInfoCount)return null;const q=(k="previous"===k)?this.messages.previous:this.messages.next,x=k?this.classes("esri-feature-media__button",
"esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),v=k?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),D=k?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl",
"esri-icon-left-triangle-arrow");return u.tsx("button",{type:"button",key:k?"media-previous":"media-next",title:q,"aria-label":q,tabIndex:0,class:x,bind:this,onclick:k?this._previous:this._next},u.tsx("span",{"aria-hidden":"true",class:v}),u.tsx("span",{"aria-hidden":"true",class:D}))};C._setupFeatureElementInfo=function(){const {description:k,title:q}=this;this._featureElementInfo.set({description:k,title:q})};C._next=function(){this.viewModel.next()};C._previous=function(){this.viewModel.previous()};
C._getRendererColors=function(){var k=a._asyncToGenerator(function*(q){const {am4core:x}=q,v=new Map;q=this.viewModel?.layer?.renderer;if(!q)return v;const D=yield h.getColorsFromRenderer(q);D.delete("default");if(!Array.from(D.values()).every(F=>1===F?.length))return v;v.set("default-line-value",x.color({r:50,g:50,b:50,a:1}));Array.from(D.keys()).forEach(F=>{F&&v.set(F,x.color(D.get(F)[0].toCss(!0)))});return v});return function(q){return k.apply(this,arguments)}}();C._handleMediaKeyup=function(k){const q=
c.eventKey(k);"ArrowLeft"===q&&(k.stopPropagation(),this.viewModel.previous());"ArrowRight"===q&&(k.stopPropagation(),this.viewModel.next())};C._renderChart=function(k){const {abilities:q}=this.viewModel,{chartsModule:x,chartDiv:v,mediaInfo:D,colorMap:F}=k,{value:G,type:J}=D,{am4core:L}=x,K=A.getColorSet(L);z.isDarkTheme()&&L.useTheme(x.am4themes_dark);const O=window.matchMedia("(prefers-reduced-motion: reduce)");q.chartAnimation&&!O.matches?L.useTheme(x.am4themes_animated):L.unuseTheme(x.am4themes_animated);
L.useTheme(function(P){P instanceof L.ColorSet&&K&&(P.list=K)});k="pie-chart"===J?this._createPieChart(k):this._createXYChart(k);v.setAttribute("aria-label",D.altText||D.title);k.data=G.series.map(P=>({tooltip:P.tooltip,value:P.value,color:F.get(P.fieldName)})).filter(P=>"pie-chart"===J?0<P.value:!0)};C._customizeChartTooltip=function(k,q){k.label.wrap=!0;k.label.maxWidth=200;k.autoTextColor=!1;k.getFillFromObject=!1;k.label.fill=q.color("#ffffff");k.background.fill=q.color({r:0,g:0,b:0,a:.7})};C._createPieChart=
function(k){const {chartDiv:q,chartsModule:x}=k,{am4core:v,am4charts:D}=x;k=v.create(q,D.PieChart);k.rtl=t.isRTL(this.container);const F=k.series.push(new D.PieSeries);F.labels.template.disabled=!0;F.ticks.template.disabled=!0;F.dataFields.value="value";F.dataFields.category="tooltip";this._customizeChartTooltip(F.tooltip,v);F.slices.template.propertyFields.fill="color";F.slices.template.propertyFields.stroke="color";return k};C._getMinSeriesValue=function(k){let q=0;k.forEach(x=>q=Math.min(x.value,
q));return q};C._createColumnChart=function(k,q){const {chartsModule:x,mediaInfo:v}=q;({value:q}=v);const {am4core:D,am4charts:F}=x,G=k.xAxes.push(new F.CategoryAxis);G.dataFields.category="tooltip";G.renderer.labels.template.disabled=!0;this._customizeChartTooltip(G.tooltip,D);G.tooltip.events.on("sizechanged",()=>{G.tooltip.dy=-G.tooltip.contentHeight});var J=k.yAxes.push(new F.ValueAxis);const L=J.renderer.labels.template;J.renderer.minLabelPosition=.05;J.renderer.maxLabelPosition=.95;J.min=this._getMinSeriesValue(q.series);
this._customizeChartTooltip(J.tooltip,D);L.wrap=!0;J=k.series.push(new F.ColumnSeries);J.dataFields.valueY="value";J.dataFields.categoryX="tooltip";J.columns.template.propertyFields.fill="color";J.columns.template.propertyFields.stroke="color";k.cursor=new F.XYCursor;15<q.series.length&&(k.scrollbarX=new D.Scrollbar)};C._createBarChart=function(k,q){const {chartsModule:x,mediaInfo:v}=q;({value:q}=v);const {am4core:D,am4charts:F}=x,G=k.yAxes.push(new F.CategoryAxis);G.dataFields.category="tooltip";
G.renderer.inversed=!0;G.renderer.labels.template.disabled=!0;this._customizeChartTooltip(G.tooltip,D);G.tooltip.events.on("sizechanged",()=>{G.tooltip.dx=G.tooltip.contentWidth});var J=k.xAxes.push(new F.ValueAxis);const L=J.renderer.labels.template;J.renderer.minLabelPosition=.05;J.renderer.maxLabelPosition=.95;J.min=this._getMinSeriesValue(q.series);this._customizeChartTooltip(J.tooltip,D);L.wrap=!0;J=k.series.push(new F.ColumnSeries);J.dataFields.valueX="value";J.dataFields.categoryY="tooltip";
J.columns.template.propertyFields.fill="color";J.columns.template.propertyFields.stroke="color";k.cursor=new F.XYCursor;15<q.series.length&&(k.scrollbarY=new D.Scrollbar)};C._createLineChart=function(k,q){const {chartsModule:x,mediaInfo:v,colorMap:D}=q;({value:q}=v);const {am4core:F,am4charts:G}=x,J=k.xAxes.push(new G.CategoryAxis);J.dataFields.category="tooltip";J.renderer.labels.template.disabled=!0;this._customizeChartTooltip(J.tooltip,F);J.tooltip.events.on("sizechanged",()=>{J.tooltip.dy=-J.tooltip.contentHeight});
var L=k.yAxes.push(new G.ValueAxis),K=L.renderer.labels.template;L.renderer.minLabelPosition=.05;L.renderer.maxLabelPosition=.95;L.min=this._getMinSeriesValue(q.series);this._customizeChartTooltip(L.tooltip,F);K.wrap=!0;L=k.series.push(new G.LineSeries);L.dataFields.categoryX="tooltip";L.dataFields.valueY="value";L.strokeWidth=1;if(K=D.get("default-line-value"))L.stroke=K;L=L.bullets.push(new G.CircleBullet);L.propertyFields.fill="color";L.propertyFields.stroke="color";k.cursor=new G.XYCursor;15<
q.series.length&&(k.scrollbarX=new F.Scrollbar)};C._createXYChart=function(k){const {chartDiv:q,chartsModule:x,mediaInfo:v}=k,{type:D}=v,{am4core:F,am4charts:G}=x,J=F.create(q,G.XYChart);J.rtl=t.isRTL(this.container);"column-chart"===D&&this._createColumnChart(J,k);"bar-chart"===D&&this._createBarChart(J,k);"line-chart"===D&&this._createLineChart(J,k);return J};C._clearMediaRefreshTimer=function(){const {_refreshTimer:k}=this;k&&(clearTimeout(k),this._refreshTimer=null)};C._updateMediaInfoTimestamp=
function(k){const q=Date.now();this._refreshIntervalInfo={timestamp:q,sourceURL:this._getImageSource(k,q)};this.scheduleRender()};C._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:k}=this.viewModel;k&&"image"===k.type&&k.refreshInterval&&this._setRefreshTimeout(k)};C._setRefreshTimeout=function(k){const {refreshInterval:q,value:x}=k;q&&(k=6E4*q,this._updateMediaInfoTimestamp(x.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(x.sourceURL)},
k))};C._getImageSource=function(k,q){const x=k.includes("?")?"\x26":"?",[v,D=""]=k.split("#");return`${v}${x}timestamp=${q}${D?"#":""}${D}`};a._createClass(B,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(k){this.viewModel.attributes=k}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(k){this.viewModel.activeMediaInfoIndex=k}},{key:"description",get:function(){return this.viewModel.description},set:function(k){this.viewModel.description=
k}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(k){this.viewModel.fieldInfoMap=k}},{key:"layer",get:function(){return this.viewModel.layer},set:function(k){this.viewModel.layer=k}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(k){this.viewModel.mediaInfos=k}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},set:function(k){this.viewModel.popupTemplate=k}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},
set:function(k){this.viewModel.relatedInfos=k}},{key:"title",get:function(){return this.viewModel.title},set:function(k){this.viewModel.title=k}}]);return B}(d);b.__decorate([m.property()],n.prototype,"attributes",null);b.__decorate([m.property()],n.prototype,"activeMediaInfoIndex",null);b.__decorate([m.property()],n.prototype,"description",null);b.__decorate([m.property()],n.prototype,"fieldInfoMap",null);b.__decorate([m.property()],n.prototype,"layer",null);b.__decorate([m.property()],n.prototype,
"mediaInfos",null);b.__decorate([m.property()],n.prototype,"popupTemplate",null);b.__decorate([m.property()],n.prototype,"relatedInfos",null);b.__decorate([m.property()],n.prototype,"title",null);b.__decorate([m.property({type:f})],n.prototype,"viewModel",void 0);b.__decorate([m.property(),w.messageBundle("esri/widgets/Feature/t9n/Feature")],n.prototype,"messages",void 0);return n=b.__decorate([g.subclass("esri.widgets.Feature.FeatureMedia")],n)})},"esri/renderers/support/utils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../core/maybe ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(k,q,x){return A.apply(this,arguments)}function A(){A=b._asyncToGenerator(function*(k,q,x){m.getOrCreateMapValue(k,q,()=>[]).push(...x)});return A.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(k){const q=new Map;if(!k)return q;if("visualVariables"in k&&k.visualVariables){var x=k.visualVariables.filter(D=>"color"===D.type);for(var v of x)x=(yield f.getRampStops(v)).map(D=>D.color),yield l(q,v.field||v.valueExpression,x)}if("heatmap"===
k.type)v=e.getHeatmapRampStops(k).map(D=>D.color),yield l(q,k.field||k.valueExpression,v);else if("pie-chart"===k.type){for(const D of k.attributes)yield l(q,D.field||D.valueExpression,[D.color]);yield l(q,"default",[k?.othersCategory?.color,d.getColorFromSymbol(k.backgroundFillSymbol,null)])}else if("dot-density"===k.type){for(const D of k.attributes)yield l(q,D.field||D.valueExpression,[D.color]);yield l(q,"default",[k.backgroundColor])}else if("unique-value"===k.type)if("predominance"===k.authoringInfo?.type)for(const D of k.uniqueValueInfos??
[])yield l(q,D.value.toString(),[d.getColorFromSymbol(D.symbol,null)]);else{v=(k.uniqueValueInfos??[]).map(L=>d.getColorFromSymbol(L.symbol,null));const {field:D,field2:F,field3:G,valueExpression:J}=k;if(D||J)yield l(q,D||J,v);F&&(yield l(q,F,v));G&&(yield l(q,G,v))}else if("class-breaks"===k.type){v=k.classBreakInfos.map(G=>d.getColorFromSymbol(G.symbol,null));const {field:D,valueExpression:F}=k;yield l(q,D??F,v)}else"simple"===k.type&&(yield l(q,"default",[d.getColorFromSymbol(k.symbol,null)]));
"defaultSymbol"in k&&k.defaultSymbol&&(yield l(q,"default",[d.getColorFromSymbol(k.defaultSymbol,null)]));q.forEach((D,F)=>{D=c.unique(D.filter(Boolean),(G,J)=>JSON.stringify(G)===JSON.stringify(J));q.set(F,D)});return q});return t.apply(this,arguments)}function w(k){let q=k.minValue,x=k.maxValue;const v=k.isFirstBreak?"":y.gt+" ";k="percent-of-total"===k.normalizationType?y.pct:"";q=null==q?"":g.format(q);x=null==x?"":g.format(x);return v+q+k+" "+y.ld+" "+x+k}function u(k,q){return"normalizationField"in
k&&k.normalizationField?{type:"normalized-field",field:k.field,normalizationField:k.normalizationField}:"field"in k&&k.field?{type:"field",field:k.field}:"valueExpression"in k&&k.valueExpression?{type:"expression",expression:k.valueExpression,title:k.valueExpressionTitle,returnType:q}:null}const z=r.getLogger("esri.renderers.support.utils"),y={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},B={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},C={millisecond:"long-month-day-year-long-time",
second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};r=p.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(k){k=k.map(F=>new Date(F));const q=k.length;let x=Infinity,v=null;for(let F=0;F<q-1;F++){const G=k[F];let J=Infinity,L=null;for(let K=F+1;K<q;K++){var D=k[K];D=G.getFullYear()!==D.getFullYear()&&"year"||G.getMonth()!==D.getMonth()&&
"month"||G.getDate()!==D.getDate()&&"day"||G.getHours()!==D.getHours()&&"hour"||G.getMinutes()!==D.getMinutes()&&"minute"||G.getSeconds()!==D.getSeconds()&&"second"||"millisecond";const O=B[D];O<J&&(J=O,L=D)}J<x&&(x=J,v=L)}return v};a.createClassBreakLabel=w;a.createColorStops=function(k){const {values:q,colors:x,labelIndexes:v,isDate:D,dateFormatOptions:F}=k;return q.map((G,J)=>{var L=null;if(!v||v.includes(J)){let K;if(K=D?p.formatDate(G,F):g.format(G))L="",0===J?L=y.lt+" ":J===q.length-1&&(L=y.gt+
" "),L+=K}return new h({value:G,color:x[J],label:L})})};a.createUniqueValueLabel=function(k){const {value:q,domain:x,fieldInfo:v,dateFormatInterval:D}=k;k=String(q);const F=x&&"codedValues"in x&&x.codedValues?x.getName(q):null;F?k=F:"number"===typeof q&&(k=v&&"date"===v.type?p.formatDate(q,D&&p.convertDateFormatToIntlOptions(C[D])):g.format(q));return k};a.getAttribute=u;a.getAttributes=function(k,q){const x=[];if("class-breaks"===k.type||"heatmap"===k.type)x.push(u(k,"number"));else if("unique-value"===
k.type){var v=k.authoringInfo;if(v&&"relationship"===v.type){if(v.field1&&v.field2){var D=v.field2.field;const F=v.field2.normalizationField;x.push(u({field:v.field1.field,normalizationField:v.field1.normalizationField}));x.push(u({field:D,normalizationField:F}))}}else D=k.uniqueValueInfos?.[0],v=null,D&&D.value&&(D=typeof k.uniqueValueInfos[0].value,"string"===D||"number"===D)&&(v=D),x.push(u(k,v)),[k.field2,k.field3].forEach(F=>F&&x.push({type:"field",field:F}))}else"attributes"in k&&k.attributes?.forEach(F=>
x.push(u(F,"number")));(k=q?q(k):"visualVariables"in k?k.visualVariables:null)&&k.forEach(F=>x.push(u(F,"number")));return c.unique(x.filter(n.isSome),(F,G)=>"field"===F.type&&"field"===G.type?F.field===G.field:"normalized-field"===F.type&&"normalized-field"===G.type?F.field===G.field&&F.normalizationField===G.normalizationField:"expression"===F.type&&"expression"===G.type?F.expression===G.expression:!1)};a.getColorsFromRenderer=function(k){return t.apply(this,arguments)};a.setLabelsForClassBreaks=
function(k){const q=k.classBreakInfos,x=k.normalizationType;let v=[];if(q&&q.length)if("standard-deviation"===k.classificationMethod)z.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");else if(k.round){v.push(q[0].minValue);for(const D of q)v.push(D.maxValue);v=g.round(v);q.forEach((D,F)=>{D.label=w({minValue:0===F?v[0]:v[F],maxValue:v[F+1],isFirstBreak:0===F,normalizationType:x})})}else q.forEach((D,F)=>{D.label=w({minValue:D.minValue,
maxValue:D.maxValue,isFirstBreak:0===F,normalizationType:x})})};a.timelineDateFormatOptions=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/numberUtils":function(){define(["exports","../../intl","../../intl/number"],function(a,b,c){function r(f,e){return f-e}function m(f,e){let l;l=Number(f.toFixed(e));l<f?f=l+1/10**e:(f=l,l-=1/10**e);l=Number(l.toFixed(e));f=Number(f.toFixed(e));return[l,f]}function n(f,e,l,A,t){f=g(f,e,l,A);e=
null==f.next||f.next<=t;return(null==f.previous||f.previous<=t)&&e||f.previous+f.next<=2*t}function p(f){f=String(f);var e=f.match(h);if(e&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(f.toLowerCase().includes("e")&&(e=f.split("e"),f=e[0],e=e[1],f&&e)){f=Number(f);e=Number(e);const l=0<e;l||(e=Math.abs(e));f=p(f);l?(f.integer+=e,f.fractional=e>f.fractional?0:f.fractional-e):(f.fractional+=e,f.integer=e>f.integer?1:f.integer-e);return f}return{integer:0,fractional:0}}
function g(f,e,l,A){const t={previous:null,next:null};if(null!=l){const w=f-l;t.previous=Math.floor(Math.abs(100*(e-l-w)/w))}null!=A&&(f=A-f,t.next=Math.floor(Math.abs(100*(A-e-f)/f)));return t}const h=/^-?(\d+)(\.(\d+))?$/i,d={maximumFractionDigits:20};a.format=function(f){return c.formatNumber(f,d)};a.numDigits=p;a.percentChange=g;a.round=function(f,e={}){f=f.slice(0);const {tolerance:l=2,strictBounds:A=!1,indexes:t=f.map((u,z)=>z)}=e;t.sort(r);for(e=0;e<t.length;e++){const u=t[e],z=f[u],y=0===
u?null:f[u-1],B=u===f.length-1?null:f[u+1],C=p(z).fractional;if(C){let k=0,q=!1;for(var w=void 0;k<=C&&!q;)w=m(z,k),w=A&&0===e?w[1]:w[0],q=n(z,w,y,B,l),k++;q&&(f[u]=w)}}return f};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(K){K=K.symbolLayers;if(!K)return null;let O=null;K.forEach(P=>{if("object"!==P.type||null==P.resource?.href)O="water"===P.type?g.unwrap(P.color):g.isSome(P.material)?g.unwrap(P.material.color):null});return O?new r(O):null}function t(K,O){if(null==O||null==K)return K;K=K.toRgba();K[3]*=O;return new r(K)}function w(K,O,P){if(K=K.symbolLayers){var N=H=>{H=g.isSome(H)?H:null;O=O??H??(null!=P?L:null);return t(O,P)};K.forEach(H=>{if("object"!==H.type||null==
H.resource?.href||O)if("water"===H.type)H.color=N(H.color);else{var E=g.isSome(H.material)?H.material.color:null;E=N(E);g.isNone(H.material)?H.material=new l.Symbol3DMaterial({color:E}):H.material.color=E;null!=P&&"outline"in H&&g.isSome(H.outline)&&g.isSome(H.outline.color)&&(H.outline.color=t(H.outline.color,P))}})}}function u(K,O){return z.apply(this,arguments)}function z(){z=c._asyncToGenerator(function*(K,O){(K=K.symbolLayers)&&(yield n.forEach(K,function(){var P=c._asyncToGenerator(function*(N){return y(N,
O)});return function(N){return P.apply(this,arguments)}}()))});return z.apply(this,arguments)}function y(K,O){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(K,O){switch(K.type){case "extrude":K.size="number"===typeof O[2]?O[2]:0;break;case "icon":case "line":case "text":O=C(O);g.isSome(O)&&(K.size=O);break;case "path":const P=x(O,d.ONES,[K.width,void 0,K.height]);K.width=F(O[0],K.width,1,P);K.height=F(O[2],K.height,1,P);break;case "object":yield k(K,O)}});return B.apply(this,
arguments)}function C(K){for(const O of K)if("number"===typeof O)return O;return null}function k(K,O){return q.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*(K,O){const {resourceSize:P,symbolSize:N}=yield v(K),H=x(O,P,N);K.width=F(O[0],N[0],P[0],H);K.depth=F(O[1],N[1],P[1],H);K.height=F(O[2],N[2],P[2],H)});return q.apply(this,arguments)}function x(K,O,P){for(let N=0;3>N;N++){const H=K[N];switch(H){case "symbol-value":return K=P[N],null!=K?K/O[N]:1;case "proportional":break;default:if(H&&
O[N])return H/O[N]}}return 1}function v(K){return D.apply(this,arguments)}function D(){D=c._asyncToGenerator(function*(K){const O=yield(yield new Promise((M,Q)=>a(["./symbolLayerUtils"],M,Q))).computeObjectLayerResourceSize(K,10),{width:P,height:N,depth:H}=K;K=[P,H,N];let E=1;for(var I=0;3>I;I++){const M=K[I];if(null!=M){E=M/O[I];break}}for(I=0;3>I;I++)null==K[I]&&(K[I]=O[I]*E);return{resourceSize:O,symbolSize:K}});return D.apply(this,arguments)}function F(K,O,P,N){switch(K){case "proportional":return P*
N;case "symbol-value":return null!=O?O:P;default:return K}}function G(){G=c._asyncToGenerator(function*(K,O){if(K&&O){if(m.isSymbol3D(K))return u(K,O);if(m.isSymbol2D(K)&&(O=C(O),!g.isNone(O)))switch(K.type){case "simple-marker":K.size=O;break;case "picture-marker":const P=K.width/K.height;1<P?(K.width=O,K.height=O*P):(K.width=O*P,K.height=O);break;case "simple-line":K.width=O;break;case "text":K.font.size=O}}});return G.apply(this,arguments)}const J=/\/resource\/(.*?)\.svg$/,L=new r("white");b.applyColorToSymbol=
function(K,O,P){if(K&&(O||null!=P))if(O&&(O=new r(O)),m.isSymbol3D(K))w(K,O,P);else if(m.isSymbol2D(K)){if(O=O??K.color)K.color=t(O,P);null!=P&&"outline"in K&&K.outline&&K.outline.color&&(K.outline.color=t(K.outline.color,P))}};b.applyOpacityToColor=t;b.applyRotationToSymbol=function(K,O,P){K&&null!=O&&(m.isSymbol3D(K)?(K=K.symbolLayers)&&K.forEach(N=>{if(N&&"object"===N.type)switch(P){case "tilt":N.tilt=O;break;case "roll":N.roll=O;break;default:N.heading=O}}):!m.isSymbol2D(K)||"simple-marker"!==
K.type&&"picture-marker"!==K.type&&"text"!==K.type||(K.angle=O))};b.applySizesToSymbol=function(K,O){return G.apply(this,arguments)};b.getCSSFilterFromEffectList=function(K){if(!K)return null;K=K.effects.filter(O=>"bloom"!==O.type).map(O=>O.toJSON());return f.effectFunctionsFromJSON(K)};b.getColorFromSymbol=function(K,O){if(!K)return null;let P=null;m.isSymbol3D(K)?P=A(K):m.isSymbol2D(K)&&(P=K.color?new r(K.color):null);return P?t(P,O):null};b.getIconHref=function(K,O){O=g.unwrapOrThrow(O.resource).href;
return!p("esri-canvas-svg-support")&&K.styleOrigin&&J.test(O)?O.replace(J,"/resource/png/$1.png"):O};b.getSymbolOutlineSize=function(K){if(!K)return 0;if(m.isSymbol3D(K)){{const O=K.symbolLayers&&K.symbolLayers.length;O?(K=K.symbolLayers.getItemAt(O-1),K="outline"in K?g.get(K,"outline","size"):void 0):K=void 0}return g.isSome(K)?K:0}return h.px2pt(e.getStroke(K)?.width)};b.isVolumetricSymbol=function(K){if(g.isNone(K)||!("symbolLayers"in K)||g.isNone(K.symbolLayers))return!1;switch(K.type){case "point-3d":return K.symbolLayers.some(O=>
"object"===O.type);case "line-3d":return K.symbolLayers.some(O=>"path"===O.type);case "polygon-3d":return K.symbolLayers.some(O=>"object"===O.type||"extrude"===O.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(K){return g.isSome(K)&&"polygon-3d"===K.type&&K.symbolLayers.some(O=>"extrude"===O.type)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,b,c,r,m,n,p){function g(f){if(!f)return null;let e=null;switch(f.type){case "simple-fill":case "picture-fill":case "simple-marker":e=g(f.outline);break;case "simple-line":const l=n.pt2px(f.width);null!=f.style&&"none"!==f.style&&0!==l&&(e={color:f.color,style:d(f.style),width:l,cap:f.cap,join:"miter"===f.join?n.pt2px(f.miterLimit):f.join});break;default:e=null}return e}const h=new m(1E3),d=(()=>{const f={};return e=>{if(f[e])return f[e];const l=e.replace(/-/g,"");return f[e]=l}})();c=new c([128,
128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=d;a.getFill=function(f){const e=f.style;let l=null;if(f)switch(f.type){case "simple-marker":"cross"!==e&&"x"!==e&&(l=f.color);break;case "simple-fill":"solid"===e?l=f.color:"none"!==e&&(l={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case "picture-fill":l={type:"pattern",src:f.url,width:n.pt2px(f.width)*f.xscale,height:n.pt2px(f.height)*f.yscale,x:n.pt2px(f.xoffset),y:n.pt2px(f.yoffset)};
break;case "text":l=f.color;break;case "cim":l=p.getCIMSymbolColor(f)}return l};a.getPatternUrlWithColor=function(f,e){const l=f+"-"+e;return void 0!==h.get(l)?Promise.resolve(h.get(l)):r(f,{responseType:"image"}).then(A=>{A=A.data;const t=A.naturalWidth,w=A.naturalHeight,u=document.createElement("canvas");u.width=t;u.height=w;const z=u.getContext("2d");z.fillStyle=e;z.fillRect(0,0,t,w);z.globalCompositeOperation="destination-in";z.drawImage(A,0,0);A=u.toDataURL();h.put(l,A);return A})};a.getStroke=
g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function b(r,m){this._storage=new a.MemCacheStorage;this._storage.maxSize=r;m&&this._storage.registerRemoveFunc("",m)}var c=b.prototype;c.put=function(r,m){this._storage.put(r,m,1,1)};c.pop=function(r){return this._storage.pop(r)};c.get=function(r){return this._storage.get(r)};c.clear=function(){this._storage.clearAll()};
c.destroy=function(){this._storage.destroy()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function r(e){e=c.toCIMSymbolJSON(e);if("CIMTextSymbol"===e?.type)return e.height??0;let l=0;if(e?.symbolLayers)for(const A of e.symbolLayers)c.isCIMMarker(A)&&null!=A.size&&A.size>l?l=A.size:c.isCIMStroke(A)&&null!=A.width&&A.width>l?l=A.width:c.isCIMFill(A);return l}function m(e,l,A,t){if(e)if("CIMTextSymbol"===e.type)null!=
e.height&&(e.height*=l);else{if(A&&e.effects)for(const w of e.effects)g(w,l);if(e.symbolLayers)for(const w of e.symbolLayers)switch(w.type){case "CIMPictureMarker":case "CIMVectorMarker":n(w,l,t);break;case "CIMPictureStroke":case "CIMSolidStroke":!t?.preserveOutlineWidth&&w.width&&(w.width*=l);break;case "CIMPictureFill":w.height&&(w.height*=l);w.offsetX&&(w.offsetX*=l);w.offsetY&&(w.offsetY*=l);break;case "CIMHatchFill":m(w.lineSymbol,l,!0,{...t,preserveOutlineWidth:!1}),w.offsetX&&(w.offsetX*=
l),w.offsetY&&(w.offsetY*=l),w.separation&&(w.separation*=l)}}}function n(e,l,A){if(e&&(e.markerPlacement&&p(e.markerPlacement,l),e.offsetX&&(e.offsetX*=l),e.offsetY&&(e.offsetY*=l),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*l,y:e.anchorPoint.y*l}),e.size=null!=e.size?e.size*l:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const t of e.markerGraphics)e.scaleSymbolsProportionally||m(t.symbol,l,!0,A)}function p(e,l){c.isCIMMarkerStrokePlacement(e)&&e.offset&&
(e.offset*=l);switch(e.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":e.customEndingOffset&&(e.customEndingOffset*=l);e.offsetAlongLine&&(e.offsetAlongLine*=l);if(e.placementTemplate&&e.placementTemplate.length){var A=e.placementTemplate.map(t=>t*l);e.placementTemplate=A}break;case "CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset&&(e.maxRandomOffset*=l);e.placementTemplate&&e.placementTemplate.length&&(A=e.placementTemplate.map(t=>t*l),e.placementTemplate=
A);break;case "CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=l);break;case "CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=l);break;case "CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=l);e.endPosition&&(e.endPosition*=l);break;case "CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=l);e.offsetY&&(e.offsetY*=l);break;case "CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=l),e.offsetY&&(e.offsetY*=l),e.stepX&&(e.stepX*=
l),e.stepY&&(e.stepY*=l)}}function g(e,l){switch(e.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":e.width&&(e.width*=l);break;case "CIMGeometricEffectBuffer":e.size&&(e.size*=l);break;case "CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=l);e.endCut&&(e.endCut*=l);e.middleCut&&(e.middleCut*=l);break;case "CIMGeometricEffectDashes":e.customEndingOffset&&(e.customEndingOffset*=l);e.offsetAlongLine&&(e.offsetAlongLine*=l);if(e.dashTemplate&&e.dashTemplate.length){const A=e.dashTemplate.map(t=>
t*l);e.dashTemplate=A}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":e.length&&(e.length*=l);break;case "CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=l);e.offsetY&&(e.offsetY*=l);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=l);break;case "CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=l);break;case "CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=l);e.length&&(e.length*=
l);e.toWidth&&(e.toWidth*=l);break;case "CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=l),e.period&&(e.period*=l)}}function h(e,l){if(e){var A="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===e.type;if(A?.symbolLayers)for(const t of A.symbolLayers)if(!(t.colorLocked||e&&(c.isCIMStroke(t)||c.isCIMMarker(t)&&t.markerPlacement&&c.isCIMMarkerStrokePlacement(t.markerPlacement))))switch(t.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":t.tintColor&&d(l,t.tintColor);
break;case "CIMVectorMarker":t.markerGraphics?.forEach(w=>{h(w.symbol,l)});break;case "CIMSolidStroke":case "CIMSolidFill":d(l,t.color);break;case "CIMHatchFill":h(t.lineSymbol,l)}}}function d(e,l){for(const A of e)if(A.join(".")===l.join("."))return;e.push(l)}function f(e,l,A){if(e){var t="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===t?.type;if(t?.symbolLayers)for(const w of t.symbolLayers)if(!w.colorLocked){if(e)if(A){if({layersToColor:t}=A,(c.isCIMStroke(w)||c.isCIMMarker(w)&&w.markerPlacement&&
c.isCIMMarkerStrokePlacement(w.markerPlacement))&&"fill"===t||c.isCIMFill(w)&&"outline"===t)continue}else if(c.isCIMStroke(w)||c.isCIMMarker(w)&&w.markerPlacement&&c.isCIMMarkerStrokePlacement(w.markerPlacement))continue;t=l.toArray();switch(w.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":w.tintColor=t;break;case "CIMVectorMarker":w.markerGraphics?.forEach(u=>{f(u.symbol,l,A)});break;case "CIMSolidStroke":case "CIMSolidFill":w.color=t;break;case "CIMHatchFill":f(w.lineSymbol,
l,A)}}}}a.applyCIMSymbolColor=function(e,l,A){l instanceof b||(l=new b(l));(e=c.toCIMSymbolJSON(e))&&f(e,l,A)};a.applyCIMSymbolRotation=function(e,l,A=!1){e=c.toCIMSymbolJSON(e);A&&0!==l&&(l=360-l);if("CIMTextSymbol"===e?.type)e.angle=l;else if("CIMPointSymbol"===e?.type&&e.symbolLayers){A=l-(e.angle||0);for(const t of e.symbolLayers)if(c.isCIMMarker(t)){let w=t.rotation||0;w=t.rotateClockwise?w-A:w+A;t.rotation=w}e.angle=l}};a.getCIMSymbolColor=function(e){e=c.toCIMSymbolJSON(e);const l=[];h(e,l);
return l.length?new b(c.fromCIMColor(l[0])):null};a.getCIMSymbolRotation=function(e,l=!1){e=c.toCIMSymbolJSON(e);return"CIMTextSymbol"===e?.type||"CIMPointSymbol"===e?.type?(e=e.angle,null!=e&&0!==e&&l?360-e:e??0):0};a.getCIMSymbolSize=r;a.getCIMSymbolType=function(e){e=c.toCIMSymbolJSON(e);if(!e)return null;switch(e.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=n;a.scaleCIMSymbol=m;a.scaleCIMSymbolTo=function(e,l,A){if(e){var t=c.toCIMSymbolJSON(e);e=r(e);if(0===e){if(t)if("CIMTextSymbol"===t.type)t.height=l;else if(t.symbolLayers)for(const w of t.symbolLayers)switch(w.type){case "CIMPictureMarker":case "CIMVectorMarker":w.size=l;break;case "CIMPictureStroke":case "CIMSolidStroke":w.width=l}}else m(t,l/e,!1,A)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(d){let f=d.length;for(;f--;)if(!" /-,\n".includes(d.charAt(f)))return!1;return!0}function r(d,f){const e=[];var l=0;let A=-1;do A=d.indexOf("[",l),A>=l&&(A>l&&(l=d.substr(l,A-l),e.push([l,null,c(l)])),l=A+1,A=d.indexOf("]",l),A>=l&&(A>l&&(l=d.substr(l,A-l),(l=f[l])&&e.push([null,l,!1])),l=A+1));while(-1!==A);l<d.length-1&&(d=d.substr(l),e.push([d,null,c(d)]));return e}function m(d,f,e){let l="",A=null;for(const t of f){const [w,
u,z]=t;if(w)z?A=w:(A&&(l+=A,A=null),l+=w);else if(f=d.attributes[u])A&&(l+=A,A=null),l+=f}return n(l,e)}function n(d,f){"string"!==typeof d&&(d=String(d));switch(f){case "LowerCase":return d.toLowerCase();case "Allcaps":return d.toUpperCase();default:return d}}function p(d){if(!d)return null;switch(d.type){case "CIMPolygonSymbol":if(d.symbolLayers)for(const f of d.symbolLayers)if(d=p(f),null!=d)return d;break;case "CIMTextSymbol":return p(d.symbol);case "CIMSolidFill":return d.color}}function g(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d.symbolLayers)for(const f of d.symbolLayers)if(d=
g(f),void 0!==d)return d;break;case "CIMTextSymbol":return g(d.symbol);case "CIMSolidStroke":case "CIMSolidFill":return d.color}}function h(d){if(d)switch(d.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(d.symbolLayers)for(const f of d.symbolLayers)if(d=h(f),void 0!==d)return d;break;case "CIMTextSymbol":return h(d.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return d.width}}b.adjustTextCase=n;b.analyzeTextParts=r;b.assignTextValuesFromFeature=m;b.attributesToFields=
function(d){return(d?Object.keys(d):[]).map(f=>({name:f,alias:f,type:"string"===typeof d[f]?"esriFieldTypeString":"esriFieldTypeDouble"}))};b.colorToArray=function(d){return[d.r,d.g,d.b,d.a]};b.createLabelOverrideFunction=function(d,f,e){const l=r(f,d);return A=>m(A,l,e)};b.evaluateValueOrFunction=function(d,f,e,l){return"function"===typeof d?d(f,e,l):d};b.fromCIMColor=function(d){return d?{r:d[0],g:d[1],b:d[2],a:d[3]/255}:{r:0,g:0,b:0,a:0}};b.fromCIMFontDecoration=function(d){return d.underline?
"underline":d.strikethrough?"line-through":"none"};b.fromCIMFontStyle=function(d){let f="",e="";d&&(d=d.toLowerCase(),d.includes("italic")?f="italic":d.includes("oblique")&&(f="oblique"),d.includes("bold")?e="bold":d.includes("light")&&(e="lighter"));return{style:f,weight:e}};b.fromCIMHorizontalAlignment=function(d){switch(d){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};b.fromCIMVerticalAlignment=function(d){switch(d){default:return"top";
case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};b.getFillColor=p;b.getFontStyle=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};b.getFontWeight=function(d){if(!d)return"normal";switch(d.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};b.getStrokeColor=g;b.getStrokeWidth=h;b.getValue=(d,
f=0)=>isNaN(d)||null==d?f:d;b.importGeometryEngine=function(){return new Promise((d,f)=>a(["../../geometry/geometryEngineJSON"],d,f))};b.isCIMFill=function(d){return"CIMGradientFill"===d.type||"CIMHatchFill"===d.type||"CIMPictureFill"===d.type||"CIMSolidFill"===d.type||"CIMWaterFill"===d.type};b.isCIMMarker=function(d){return"CIMVectorMarker"===d.type||"CIMPictureMarker"===d.type||"CIMBarChartMarker"===d.type||"CIMCharacterMarker"===d.type||"CIMPieChartMarker"===d.type||"CIMStackedBarChartMarker"===
d.type};b.isCIMMarkerStrokePlacement=function(d){return"CIMMarkerPlacementAlongLineRandomSize"===d.type||"CIMMarkerPlacementAlongLineSameSize"===d.type||"CIMMarkerPlacementAlongLineVariableSize"===d.type||"CIMMarkerPlacementAtExtremities"===d.type||"CIMMarkerPlacementAtMeasuredUnits"===d.type||"CIMMarkerPlacementAtRatioPositions"===d.type||"CIMMarkerPlacementOnLine"===d.type||"CIMMarkerPlacementOnVertices"===d.type};b.isCIMStroke=function(d){return"CIMGradientStroke"===d.type||"CIMPictureStroke"===
d.type||"CIMSolidStroke"===d.type};b.isGeometryEngineRequired=d=>{if(!d)return!1;for(const f of d)switch(f.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":return!0}return!1};b.isSVGImage=d=>d.includes("data:image/svg+xml");b.mapCIMSymbolToGeometryType=function(d){if(!d)return null;switch(d.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};
b.resampleHermite=function(d,f,e,l,A,t,w=!0){const u=f/A;e/=t;const z=Math.ceil(u/2),y=Math.ceil(e/2);for(let k=0;k<t;k++)for(let q=0;q<A;q++){const x=4*(q+(w?t-k-1:k)*A);var B=0;let v=0,D=0,F=0,G=0,J=0,L=0;const K=(k+.5)*e;for(let O=Math.floor(k*e);O<(k+1)*e;O++){var C=Math.abs(K-(O+.5))/y;const P=(q+.5)*u;C*=C;for(let N=Math.floor(q*u);N<(q+1)*u;N++){let H=Math.abs(P-(N+.5))/z;B=Math.sqrt(C+H*H);-1<=B&&1>=B&&(B=2*B*B*B-3*B*B+1,0<B&&(H=4*(N+O*f),L+=B*d[H+3],D+=B,255>d[H+3]&&(B=B*d[H+3]/250),F+=B*
d[H],G+=B*d[H+1],J+=B*d[H+2],v+=B))}}l[x]=F/v;l[x+1]=G/v;l[x+2]=J/v;l[x+3]=L/D}};b.toCIMSymbolJSON=function(d){return d.data?.symbol??null};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","./utils"],function(a,b,c,r,m){function n(l,A){const t=[],w=l.length-1;5===l.length?t.push(0,2,4):t.push(0,w);return l.map((u,
z)=>t.includes(z)?m.createStopLabel(u,z,w,A):null)}function p(){p=c._asyncToGenerator(function*(l,A,t){let w=!1,u=[],z=[];if(l.stops){var y=l.stops;u=y.map(C=>C.value);(w=y.some(C=>!!C.label))&&(z=y.map(C=>C.label))}y=u[u.length-1];if(null==u[0]&&null==y)return null;const B=w?null:n(u,t);return(yield Promise.all(u.map(function(){var C=c._asyncToGenerator(function*(k,q){const x="opacity"===l.type?yield g(k,l,A):(yield new Promise((v,D)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],
v,D))).getColor(l,k);return{value:k,color:x,label:w?z[q]:B[q]}});return function(k,q){return C.apply(this,arguments)}}()))).reverse()});return p.apply(this,arguments)}function g(l,A){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*(l,A,t=e){t=new r(t);l=(yield new Promise((w,u)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],w,u))).getOpacity(A,l);null!=l&&(t.a=l);return t});return h.apply(this,arguments)}function d(l,A){const {startIndex:t,endIndex:w,
weight:u}=f(l,A);if(t===w)return A[t].color;l=r.blendColors(A[t].color,A[w].color,u);return new r(l)}function f(l,A){let t=0,w=A.length-1;A.some((u,z)=>{if(l<u.value)return w=z,!0;t=z;return!1});return{startIndex:t,endIndex:w,weight:(l-A[t].value)/(A[w].value-A[t].value)}}const e=new r([64,64,64]);b.getColorFromPointCloudStops=d;b.getRampStops=function(l,A,t){return p.apply(this,arguments)};b.getRampStopsForPointCloud=function(l){let A=!1,t=[],w=[];t=l.map(y=>y.value);(A=l.some(y=>!!y.label))&&(w=
l.map(y=>y.label));const u=t[t.length-1];if(null==t[0]&&null==u)return null;const z=A?null:n(t,!1);return t.map((y,B)=>{const C=d(y,l);return{value:y,color:C,label:A?w[B]:z[B]}}).reverse()};b.getStrectchRampStops=function(l,A){let t=[];if(l&&"multipart"===l.type)l.colorRamps.reverse().forEach((w,u)=>{0===u?t.push({value:A.max,color:new r(w.toColor),label:"high"}):t.push({value:null,color:new r(w.toColor),label:""});u===l.colorRamps.length-1?t.push({value:A.min,color:new r(w.fromColor),label:"low"}):
t.push({value:null,color:new r(w.fromColor),label:""})});else{let w,u;l&&"algorithmic"===l.type?(w=l.fromColor,u=l.toColor):(w=[0,0,0,1],u=[255,255,255,1]);t=[{value:A.max,color:new r(u),label:"high"},{value:A.min,color:new r(w),label:"low"}]}return t};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../symbols ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/SimpleLineSymbol".split(" "),
function(a,b,c,r,m,n,p){function g(e){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*(e){if(!("visualVariables"in e&&e.visualVariables))return null;e=e.visualVariables.find(t=>"color"===t.type);if(!e)return null;var l=null,A=null;if(e.stops){if(1===e.stops.length)return e.stops[0].color;l=e.stops[0].value;A=e.stops[e.stops.length-1].value}l+=(A-l)/2;({getColor:A}=yield new Promise((t,w)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],t,w)));return A(e,
l)});return h.apply(this,arguments)}function d(){d=c._asyncToGenerator(function*(e,l){const A=e.trailCap,t=e.trailWidth||1;e=l||(yield g(e))||e.color;return new p({cap:A,color:e,width:t})});return d.apply(this,arguments)}const f=m.convertDateFormatToIntlOptions("short-date");b.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];b.SPECIAL_CHARS_GREATER_THAN="\x3e";b.SPECIAL_CHARS_LESS_THAN="\x3c";b.createStopLabel=function(e,l,A,t){let w="";0===l?w="\x3c ":l===A&&(w="\x3e ");l=null;l=t?m.formatDate(e,f):n.format(e);return w+l};b.getMedianColor=g;b.getSymbolForFlowRenderer=function(e,l){return d.apply(this,arguments)};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,b){a.getHeatmapRampStops=function(c){if(!c.colorStops)return[];const r=[...c.colorStops].filter(n=>0<n.color?.a);let m=r.length-1;if(r&&r[0]){const n=r[m];n&&1!==n.ratio&&(r.push(new b({ratio:1,color:n.color})),m++)}return r.map((n,p)=>{let g="";0===p?g=c.legendOptions?.minLabel||"low":p===m&&(g=c.legendOptions?.maxLabel||
"high");return{color:n.color,label:g,ratio:n.ratio}}).reverse()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){const e={chartAnimation:!0};c=function(l){function A(w){w=l.call(this,w)||this;w.abilities={...e};w.activeMediaInfoIndex=0;w.attributes=null;w.description=null;w.fieldInfoMap=null;w.formattedAttributes=null;w.expressionAttributes=null;w.layer=null;w.mediaInfos=null;w.popupTemplate=null;w.relatedInfos=null;w.title=null;return w}a._inheritsLoose(A,l);var t=A.prototype;t.castAbilities=function(w){return{...e,...w}};t.setActiveMedia=function(w){this._setContentElementMedia(w)};
t.next=function(){this._pageContentElementMedia(1)};t.previous=function(){this._pageContentElementMedia(-1)};t._setContentElementMedia=function(w){const {formattedMediaInfoCount:u}=this;this.activeMediaInfoIndex=(w+u)%u};t._pageContentElementMedia=function(w){const {activeMediaInfoIndex:u}=this;this._setContentElementMedia(u+w)};t._formatMediaInfos=function(){const {attributes:w,mediaInfos:u,formattedAttributes:z,expressionAttributes:y,fieldInfoMap:B,layer:C}=this;return u?.map(k=>{k=k?.clone();if(!k)return null;
k.title=d.substituteFieldsInLinksAndAttributes({attributes:w,fieldInfoMap:B,globalAttributes:z,expressionAttributes:y,layer:C,text:k.title});k.caption=d.substituteFieldsInLinksAndAttributes({attributes:w,fieldInfoMap:B,globalAttributes:z,expressionAttributes:y,layer:C,text:k.caption});k.altText=d.substituteFieldsInLinksAndAttributes({attributes:w,fieldInfoMap:B,globalAttributes:z,expressionAttributes:y,layer:C,text:k.altText});if("image"===k.type){var {value:q}=k;this._setImageValue({value:q,formattedAttributes:z,
layer:C});return k.value.sourceURL?k:void 0}return"pie-chart"===k.type||"line-chart"===k.type||"column-chart"===k.type||"bar-chart"===k.type?({value:q}=k,this._setChartValue({value:q,chartType:k.type,attributes:w,formattedAttributes:z,layer:C,expressionAttributes:y}),k):null}).filter(Boolean)};t._setImageValue=function(w){const {fieldInfoMap:u}=this,{value:z,formattedAttributes:y,layer:B}=w,{linkURL:C,sourceURL:k}=z;k&&(w=d.fixTokens(k,B),z.sourceURL=d.substituteAttributes({formattedAttributes:y,
template:w,fieldInfoMap:u}));C&&(w=d.fixTokens(C,B),z.linkURL=d.substituteAttributes({formattedAttributes:y,template:w,fieldInfoMap:u}))};t._setChartValue=function(w){const {value:u,attributes:z,formattedAttributes:y,chartType:B,layer:C,expressionAttributes:k}=w,{popupTemplate:q,relatedInfos:x}=this,{fields:v,normalizeField:D}=u;u.fields=d.getFixedFieldNames(v,C);D&&(u.normalizeField=d.getFixedFieldName(D,C));if(v.some(G=>!!(null!=y[G]||d.isRelatedField(G)&&x.size))){var F=q?.fieldInfos;v.forEach(G=>
{d.isRelatedField(G)?u.series=[...u.series,...this._getRelatedChartInfos({fieldInfos:F,fieldName:G,formattedAttributes:y,chartType:B,value:u})]:(G=this._getChartOption({value:u,attributes:z,chartType:B,formattedAttributes:y,expressionAttributes:k,fieldName:G,fieldInfos:F}),u.series.push(G))})}};t._getRelatedChartInfos=function(w){const {fieldInfos:u,fieldName:z,formattedAttributes:y,chartType:B,value:C}=w,k=[];w=f.getRelatedFieldInfo(z);const {layerId:q,fieldName:x}=w;w=this.relatedInfos?.get(q.toString());
if(!w)return k;const {relatedFeatures:v,relation:D}=w;if(!D||!v)return k;({cardinality:w}=D);v.forEach(F=>{const {attributes:G}=F;G&&Object.keys(G).forEach(J=>{J===x&&k.push(this._getChartOption({value:C,attributes:G,formattedAttributes:y,fieldName:z,chartType:B,relatedFieldName:J,fieldInfos:u}))})});return"one-to-many"===w||"many-to-many"===w?k:[k[0]]};t._getTooltip=function({label:w,value:u,chartType:z}){return"pie-chart"===z?`${w}`:`${w}: ${u}`};t._getChartOption=function(w){const {value:u,attributes:z,
formattedAttributes:y,expressionAttributes:B,fieldName:C,relatedFieldName:k,fieldInfos:q,chartType:x}=w,{layer:v,fieldInfoMap:D}=this,{normalizeField:F,tooltipField:G}=u;w=F?d.isRelatedField(F)?z[f.getRelatedFieldInfo(F).fieldName]:z[F]:null;var J=d.isExpressionField(C)&&B&&void 0!==B[C]?B[C]:k&&void 0!==z[k]?z[k]:void 0!==z[C]?z[C]:y[C];w=new h({fieldName:C,value:void 0===J?null:J&&w?J/w:J});if(d.isRelatedField(C)){J=D.get(C.toLowerCase());var L=D.get(G.toLowerCase());w.tooltip=this._getTooltip({label:y[L?.fieldName??
G]??J?.label??J?.fieldName??k,value:y[J?.fieldName??C],chartType:x});return w}L=d.getFieldInfo(q,C);J=d.getFixedFieldName(C,v);L=G&&void 0!==y[G]?y[G]:d.getFieldInfoLabel(L||new g({fieldName:J}),this.popupTemplate?.expressionInfos);w.tooltip=this._getTooltip({label:L,value:y[J],chartType:x});return w};a._createClass(A,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||
[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return A}(c);b.__decorate([r.property()],c.prototype,"abilities",void 0);b.__decorate([n.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([r.property()],c.prototype,"activeMediaInfoIndex",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([r.property()],c.prototype,"attributes",void 0);b.__decorate([r.property()],c.prototype,"description",void 0);
b.__decorate([r.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([r.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([r.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([r.property()],c.prototype,"layer",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",null);b.__decorate([r.property()],c.prototype,"mediaInfos",void 0);b.__decorate([r.property()],
c.prototype,"popupTemplate",void 0);b.__decorate([r.property()],c.prototype,"relatedInfos",void 0);b.__decorate([r.property()],c.prototype,"title",void 0);return c=b.__decorate([p.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../core/has ../../../layers/support/source/DataLayerSource ../../../rest/query/executeQueryJSON ../../../config ../../../kernel ../../../core/arrayUtils ../../../core/urlUtils ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/featureConversionUtils ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/normalizeUtils ../../../core/pbf ../../../rest/support/FeatureSet ../../../rest/support/Query ../../../rest/query/support/AttachmentInfo ../../../rest/support/AttachmentQuery ../../../geometry ../../../rest/support/RelationshipQuery ../../../rest/support/TopFeaturesQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N){function H(R,X){if(!X.relationships)return null;let W=null;({relationships:X}=X);X.some(aa=>aa.id===parseInt(R,10)?(W=aa,!0):!1);return W}function E({originRelationship:R,relationships:X,layerId:W}){let aa;X&&X.some(ba=>{`${ba.relatedTableId}`===W&&ba.id===R.id&&(aa=ba);return!!aa});return aa}function I(R,X){X=X.toLowerCase();for(const W in R)if(W.toLowerCase()===X)return R[W];return null}function M(R,X,W,aa){const ba=new K;
ba.outFields=["*"];ba.relationshipId="number"===typeof X.id?X.id:parseInt(X.id,10);ba.objectIds=[R.attributes[W.objectIdField]];return W.queryRelatedFeatures(ba,aa)}function Q(R,X,W){let aa=0;const ba=[];for(;aa<X.length;)ba.push(`${R} IN (${X.slice(aa,W+aa)})`),aa+=W;return ba.join(" OR ")}function T(R,X,W,aa){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(R,X,W,aa){var ba=W.layerId.toString();const {layerInfo:ia,relation:ma,relatedFields:ha,outStatistics:ka,url:Z,sourceSpatialReference:ca}=
X;ba=E({originRelationship:ma,relationships:ia.relationships,layerId:ba});if(ba.relationshipTableId&&ba.keyFieldInRelationshipTable){W=(yield M(R,ba,W,aa))[R.attributes[W.objectIdField]];if(!W)return null;const fa=W.features.map(ea=>ea.attributes[ia.objectIdField]);if(0<ka?.length&&ia.supportsStatistics)return X=new F,X.where=Q(ia.objectIdField,fa,1E3),X.outFields=ha,X.outStatistics=ka,X.sourceSpatialReference=ca,X={features:Promise.resolve(W),statsFeatures:d.executeQueryJSON(Z,X)},n.eachAlways(X)}return(ba=
ba?.keyField)?(W=p.isNumericField(U(ia.fields,ba)),R=I(R.attributes,ma.keyField),ba=W?`${ba}=${R}`:`${ba}='${R}'`,R=d.executeQueryJSON(Z,new F({where:ba,outFields:X.relatedFields,sourceSpatialReference:ca}),aa),X=X.outStatistics&&0<X.outStatistics.length&&ia.supportsStatistics?d.executeQueryJSON(Z,new F({where:ba,outFields:X.relatedFields,outStatistics:X.outStatistics,sourceSpatialReference:ca}),aa):null,aa={features:R},X&&(aa.statsFeatures=X),n.eachAlways(aa)):null});return S.apply(this,arguments)}
function U(R,X){if(null!=R){X=X.toLowerCase();for(const W of R)if(W&&W.name.toLowerCase()===X)return W}return null}const Y=m.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),V=new Map;a.createRelatedInfo=function(R,X){if(R=H(R,X))return{url:`${X.url}/${R.relatedTableId}`,sourceSpatialReference:X.spatialReference,relation:R,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=E;a.getRelatedFieldInfo=function(R){if(!N.isRelatedField(R))return null;const [X,W]=R.split("/").slice(1);
return{layerId:X,fieldName:W}};a.queryLayerInfos=function({relatedInfos:R,layer:X},W){const aa={};R.forEach((ba,ia)=>{({relation:ba}=ba);if(!ba)throw ia=new r("relation-required","A relation is required on a layer to retrieve related records."),Y.error(ia),ia;({relatedTableId:ba}=ba);if("number"!==typeof ba)throw ia=new r("A related table ID is required on a layer to retrieve related records."),Y.error(ia),ia;ba=`${X.url}/${ba}`;const ma=V.get(ba),ha=ma?ma:c(ba,{query:{f:"json"},signal:W&&W.signal});
ma||V.set(ba,ha);aa[ia]=ha});return n.eachAlways(aa)};a.queryRelatedFeatures=function({graphic:R,relatedInfos:X,layer:W},aa){const ba={};X.forEach((ia,ma)=>{ia.layerInfo&&(ba[ma]=T(R,ia,W,aa))});return n.eachAlways(ba)};a.setRelatedFeatures=function(R,X){if(X&&R){var {features:W,statsFeatures:aa}=R;R=W&&W.value;X.relatedFeatures=R?R.features:[];R=aa&&aa.value;X.relatedStatsFeatures=R?R.features:[]}};a.updateRelatedInfo=function({relatedInfo:R,fieldName:X,fieldInfo:W}){R.relatedFields.push(X);W.statisticType&&
(X=new P({statisticType:W.statisticType,onStatisticField:X,outStatisticFieldName:X}),R.outStatistics.push(X))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),function(a,b,c,r,m,n){function p(l){if(!l)return"en-us";if(d.has(l.toLowerCase()))return l.toLowerCase();l=l.split("-")[0].toLowerCase();
let A=null;for(const t of d.keys())if(t.startsWith(l)){A=t;break}return A||"en-us"}function g(){g=c._asyncToGenerator(function*(l=n.getLocale()){l=p(l);if(f&&l===e)return f;f=(new Promise((A,t)=>a(["../../chunks/index"],A,t))).then(A=>A.index);e=l;try{const [A,t]=yield Promise.all([f,d.get(e)()]);e===l&&(A.am4core.options.defaultLocale=t.default);A.am4core.options.suppressWarnings=!0;A.am4core.options.autoDispose=!0}catch{return e=f=null}return f});return g.apply(this,arguments)}r="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var h=[{name:"default",colors:[].concat(r.slice(30,39),r.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const d=new Map([["ar",()=>(new Promise((l,A)=>a(["../../chunks/ar"],l,A))).then(l=>l.ar)],["bg-bg",()=>(new Promise((l,
A)=>a(["../../chunks/bg_BG"],l,A))).then(l=>l.bg_BG)],["bs-ba",()=>(new Promise((l,A)=>a(["../../chunks/bs_BA"],l,A))).then(l=>l.bs_BA)],["ca-es",()=>(new Promise((l,A)=>a(["../../chunks/ca_ES"],l,A))).then(l=>l.ca_ES)],["cs-cz",()=>(new Promise((l,A)=>a(["../../chunks/cs_CZ"],l,A))).then(l=>l.cs_CZ)],["da-dk",()=>(new Promise((l,A)=>a(["../../chunks/da_DK"],l,A))).then(l=>l.da_DK)],["de-de",()=>(new Promise((l,A)=>a(["../../chunks/de_DE"],l,A))).then(l=>l.de_DE)],["de-ch",()=>(new Promise((l,A)=>
a(["../../chunks/de_CH"],l,A))).then(l=>l.de_CH)],["el-gr",()=>(new Promise((l,A)=>a(["../../chunks/el_GR"],l,A))).then(l=>l.el_GR)],["en-us",()=>(new Promise((l,A)=>a(["../../chunks/en_US"],l,A))).then(l=>l.en_US)],["en-ca",()=>(new Promise((l,A)=>a(["../../chunks/en_CA"],l,A))).then(l=>l.en_CA)],["es-es",()=>(new Promise((l,A)=>a(["../../chunks/es_ES"],l,A))).then(l=>l.es_ES)],["et-ee",()=>(new Promise((l,A)=>a(["../../chunks/et_EE"],l,A))).then(l=>l.et_EE)],["fi-fi",()=>(new Promise((l,A)=>a(["../../chunks/fi_FI"],
l,A))).then(l=>l.fi_FI)],["fr-fr",()=>(new Promise((l,A)=>a(["../../chunks/fr_FR"],l,A))).then(l=>l.fr_FR)],["he-il",()=>(new Promise((l,A)=>a(["../../chunks/he_IL"],l,A))).then(l=>l.he_IL)],["hr-hr",()=>(new Promise((l,A)=>a(["../../chunks/hr_HR"],l,A))).then(l=>l.hr_HR)],["hu-hu",()=>(new Promise((l,A)=>a(["../../chunks/hu_HU"],l,A))).then(l=>l.hu_HU)],["id-id",()=>(new Promise((l,A)=>a(["../../chunks/id_ID"],l,A))).then(l=>l.id_ID)],["it-it",()=>(new Promise((l,A)=>a(["../../chunks/it_IT"],l,A))).then(l=>
l.it_IT)],["ja-jp",()=>(new Promise((l,A)=>a(["../../chunks/ja_JP"],l,A))).then(l=>l.ja_JP)],["ko-kr",()=>(new Promise((l,A)=>a(["../../chunks/ko_KR"],l,A))).then(l=>l.ko_KR)],["lt-lt",()=>(new Promise((l,A)=>a(["../../chunks/lt_LT"],l,A))).then(l=>l.lt_LT)],["lv-lv",()=>(new Promise((l,A)=>a(["../../chunks/lv_LV"],l,A))).then(l=>l.lv_LV)],["nb-no",()=>(new Promise((l,A)=>a(["../../chunks/nb_NO"],l,A))).then(l=>l.nb_NO)],["nl-nl",()=>(new Promise((l,A)=>a(["../../chunks/nl_NL"],l,A))).then(l=>l.nl_NL)],
["pl-pl",()=>(new Promise((l,A)=>a(["../../chunks/pl_PL"],l,A))).then(l=>l.pl_PL)],["pt-br",()=>(new Promise((l,A)=>a(["../../chunks/pt_BR"],l,A))).then(l=>l.pt_BR)],["pt-pt",()=>(new Promise((l,A)=>a(["../../chunks/pt_PT"],l,A))).then(l=>l.pt_PT)],["ro-ro",()=>(new Promise((l,A)=>a(["../../chunks/ro_RO"],l,A))).then(l=>l.ro_RO)],["ru-ru",()=>(new Promise((l,A)=>a(["../../chunks/ru_RU"],l,A))).then(l=>l.ru_RU)],["sk-sk",()=>(new Promise((l,A)=>a(["../../chunks/sk_SK"],l,A))).then(l=>l.sk_SK)],["sl-sl",
()=>(new Promise((l,A)=>a(["../../chunks/sl_SL"],l,A))).then(l=>l.sl_SL)],["sr-rs",()=>(new Promise((l,A)=>a(["../../chunks/sr_RS"],l,A))).then(l=>l.sr_RS)],["sv-se",()=>(new Promise((l,A)=>a(["../../chunks/sv_SE"],l,A))).then(l=>l.sv_SE)],["th-th",()=>(new Promise((l,A)=>a(["../../chunks/th_TH"],l,A))).then(l=>l.th_TH)],["tr-tr",()=>(new Promise((l,A)=>a(["../../chunks/tr_TR"],l,A))).then(l=>l.tr_TR)],["uk-ua",()=>(new Promise((l,A)=>a(["../../chunks/uk_UA"],l,A))).then(l=>l.uk_UA)],["vi-vn",()=>
(new Promise((l,A)=>a(["../../chunks/vi_VN"],l,A))).then(l=>l.vi_VN)],["zh-cn",()=>(new Promise((l,A)=>a(["../../chunks/zh_Hans"],l,A))).then(l=>l.zh_Hans)],["zh-hk",()=>(new Promise((l,A)=>a(["../../chunks/zh_Hant"],l,A))).then(l=>l.zh_Hant)],["zh-tw",()=>(new Promise((l,A)=>a(["../../chunks/zh_Hant"],l,A))).then(l=>l.zh_Hant)]]);let f,e;b.getChartLocale=p;b.getColorSet=function(l,A="default"){const t=h.find(w=>w.name===A);return t?t.colors.map(w=>l.color(w)):null};b.loadChartsModule=function(){return g.apply(this,
arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/RelationshipContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){r=function(v){function D(F){var G=v.call(this,F)||this;G._abortController=null;G.expressionInfo=null;G.graphic=null;G.contentElement=null;G.contentElementViewModel=null;G.interceptor=null;G.view=null;G._cancelQuery=()=>{const {_abortController:J}=a._assertThisInitialized(G);J&&J.abort();G._abortController=null};G._createVM=()=>{var J=G.contentElement?.type;G.contentElementViewModel?.destroy();J="fields"===J?new k:"media"===J?new q:"text"===
J?new C:null;G._set("contentElementViewModel",J)};G._compile=a._asyncToGenerator(function*(){G._cancelQuery();const J=new AbortController;G._abortController=J;yield G._compileExpression();G._abortController===J&&(G._abortController=null)});G._compileThrottled=p.throttle(G._compile,1,a._assertThisInitialized(G));G._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:J,graphic:L,interceptor:K,spatialReference:O,map:P,view:N,_abortController:H}=a._assertThisInitialized(G);if(J&&L&&
O&&P){var E=yield x.loadArcadeUtils();if(H===G._abortController)if((E=yield x.createCompiledExpression({arcadeUtils:E,expressionInfo:J,graphic:L,interceptor:K,map:P,spatialReference:O,view:N}))&&"esri.arcade.Dictionary"===E.declaredClass){E=yield E.castAsJsonAsync(H.signal);var I=E?.type;E="media"===I?u.fromJSON(E):"text"===I?y.fromJSON(E):"fields"===I?w.fromJSON(E):null;G._set("contentElement",E)}else G._set("contentElement",null)}else G._set("contentElement",null)});G.handles.add([n.watch(()=>[G.expressionInfo,
G.graphic,G.map,G.spatialReference,G.view],()=>G._compileThrottled(),n.initial),n.watch(()=>[G.contentElement],()=>G._createVM(),n.initial)]);return G}a._inheritsLoose(D,v);D.prototype.destroy=function(){this._cancelQuery();this.contentElementViewModel?.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(D,[{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(F){this._override("spatialReference",F)}},{key:"state",
get:function(){const {_abortController:F,contentElement:G,contentElementViewModel:J}=this;return F?"loading":G||J?"ready":"disabled"}},{key:"map",get:function(){return this.view?.map??null},set:function(F){this._override("map",F)}}]);return D}(m.HandleOwnerMixin(r));b.__decorate([g.property()],r.prototype,"_abortController",void 0);b.__decorate([g.property({type:B})],r.prototype,"expressionInfo",void 0);b.__decorate([g.property({type:c})],r.prototype,"graphic",void 0);b.__decorate([g.property({readOnly:!0})],
r.prototype,"contentElement",void 0);b.__decorate([g.property({readOnly:!0})],r.prototype,"contentElementViewModel",void 0);b.__decorate([g.property()],r.prototype,"interceptor",void 0);b.__decorate([g.property()],r.prototype,"spatialReference",null);b.__decorate([g.property({readOnly:!0})],r.prototype,"state",null);b.__decorate([g.property()],r.prototype,"map",null);b.__decorate([g.property()],r.prototype,"view",void 0);return r=b.__decorate([f.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],
r)})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),function(a,b,c,r,m,n,p){function g(y){return`<ul class="esri-widget__list">${y.map(B=>`<li>${"string"===typeof B?p.applyTextFormattingHTML(p.htmlEntities(B)):B}</li>`).join("")}</ul>`}function h(y){return`<table class="esri-widget__table">${y.keys().map(B=>{var C=
y.field(B);C="string"===typeof C?p.applyTextFormattingHTML(p.htmlEntities(C)):C;return`<tr><th>${B}</th><td>${C}</td></tr>`}).join("")}</table>`}function d({aggregatedFeatures:y,arcadeUtils:B,featureSetVars:C,context:k,viewInfo:q,map:x,graphic:v,interceptor:D}){C.forEach(F=>{F=F.toLowerCase();var G={map:x,spatialReference:q.sr,interceptor:D};"$map"===F&&(k.vars[F]=B.convertMapToFeatureSetCollection(G));"$layer"===F&&(k.vars[F]=B.convertFeatureLayerToFeatureSet({layer:v.sourceLayer,spatialReference:q.sr,
interceptor:D}));"$datastore"===F&&(k.vars[F]=B.convertServiceUrlToWorkspace({url:v.sourceLayer.url,spatialReference:q.sr,interceptor:D}));if("$aggregatedfeatures"===F){G=v.layer;const {fields:J,objectIdField:L,geometryType:K,spatialReference:O,displayField:P}=G;G=new n({fields:J,objectIdField:L,geometryType:K,spatialReference:O,displayField:P,...("feature"===G.type?{templates:G.templates,typeIdField:G.typeIdField,types:G.types}:null),source:y});k.vars[F]=B.convertFeatureLayerToFeatureSet({layer:G,
spatialReference:q.sr,interceptor:D})}})}function f(){return new Promise((y,B)=>a(["../../../support/arcadeUtils"],y,B))}function e(y){return l.apply(this,arguments)}function l(){l=c._asyncToGenerator(function*({graphic:y,view:B}){const {isAggregate:C,layer:k}=y;if(!C||!k||"2d"!==B?.type)return[];B=yield B.whenLayerView(k);if(!("createQuery"in B&&"queryFeatures"in B))return[];const q=B.createQuery();q.aggregateIds=[y.getObjectId()];({features:y}=yield B.queryFeatures(q));return y});return l.apply(this,
arguments)}function A(y){return t.apply(this,arguments)}function t(){t=c._asyncToGenerator(function*({expressionInfo:y,arcadeUtils:B,interceptor:C,spatialReference:k,map:q,graphic:x,view:v}){if(!y||!y.expression)return null;const D=B.createSyntaxTree(y.expression),F=u.filter(J=>B.hasVariable(D,J));[v]=yield Promise.all([e({graphic:x,view:v}),B.loadScriptDependencies(D,!0,F)]);const G=B.getViewInfo({spatialReference:k});k=B.createExecContext(x,G);k.interceptor=C;k.useAsync=!0;d({aggregatedFeatures:v,
arcadeUtils:B,featureSetVars:F,context:k,viewInfo:G,map:q,graphic:x,interceptor:C});C=B.createFunction(D,k);return B.executeAsyncFunction(C,k).catch(J=>z.error("arcade-execution-error",{error:J,graphic:x,expressionInfo:y}))});return t.apply(this,arguments)}function w(){w=c._asyncToGenerator(function*({expressionInfos:y,spatialReference:B,graphic:C,interceptor:k,map:q,view:x}){if(!y||!y.length)return{};const v=yield f(),D={};for(const F of y)D[`expression/${F.name}`]=A({expressionInfo:F,arcadeUtils:v,
interceptor:k,spatialReference:B,map:q,graphic:C,view:x});y=yield m.eachAlways(D);B={};for(const F in y)C=y[F].value,C="string"===typeof C?p.applyTextFormattingHTML(p.htmlEntities(C)):Array.isArray(C)?g(C):"esri.arcade.Dictionary"===C?.declaredClass?h(C):C,B[F]=C;return B});return w.apply(this,arguments)}const u=["$datastore","$map","$layer","$aggregatedfeatures"],z=r.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=A;b.createCompiledExpressions=function(y){return w.apply(this,
arguments)};b.loadArcadeUtils=f;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureRelationship":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){const y={title:!0,description:!0};r=function(B){function C(q,x){var v=B.call(this,q,x)||this;v._featureElementInfo=null;v._relatedFeatureIntersectionObserver=new IntersectionObserver(([D])=>{D?.isIntersecting&&v._increaseFeaturePage()},{root:window.document});v.headingLevel=2;v.viewModel=new l;v.messages=null;v.messagesCommon=null;v.visibleElements={...y};v._increaseFeaturePage=()=>{const {state:D,showAllEnabled:F,relatedFeatures:G,featuresPerPage:J,featurePage:L}=
v.viewModel;"ready"===D&&F&&G.length>=J*L&&v.viewModel.featurePage++};return v}b._inheritsLoose(C,B);var k=C.prototype;k.initialize=function(){this._featureElementInfo=new A;this.addHandles([p.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),p.initial),p.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),p.on(()=>this.viewModel.relatedFeatureViewModels,
"change",()=>this._setupRelatedFeatureViewModels())])};k.loadDependencies=function(){return Promise.all([new Promise((q,x)=>a(["../../chunks/calcite-list"],q,x)),new Promise((q,x)=>a(["../../chunks/calcite-list-item"],q,x)),new Promise((q,x)=>a(["../../chunks/calcite-icon"],q,x)),new Promise((q,x)=>a(["../../chunks/calcite-notice"],q,x))])};k.destroy=function(){this._unobserveRelatedFeatureObserver();this._featureElementInfo=m.destroyMaybe(this._featureElementInfo)};k.castVisibleElements=function(q){return{...y,
...q}};k.renderStickyLoading=function(){return"querying"===this.viewModel.state?u.tsx("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null};k.renderLoadingIcon=function(){return u.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})};k.renderLoading=function(){return u.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},this.renderLoadingIcon())};k.renderShowAllIconNode=
function(){return u.tsx("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})};k.renderChevronIconNode=function(){const q=t.isRTL(this.container)?"chevron-left":"chevron-right";return u.tsx("calcite-icon",{scale:"s",icon:q,slot:"content-end"})};k.renderRelatedFeature=function(q){var {itemDescriptionFieldName:x}=this.viewModel;const v=q.title;q.description=x&&q.formattedAttributes?.global[x];x="loading"===q.state;return u.tsx("calcite-list-item",{key:q.uid,label:x?`${this.messagesCommon?.loading}\u2026`:
v,description:x?"\u2026":q.description,onclick:()=>this.emit("select-record",{featureViewModel:q})},this.renderChevronIconNode())};k.renderShowAllListItem=function(){return this.displayShowAllButton?u.tsx("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,onclick:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null};k.renderNoRelatedFeaturesMessage=function(){return u.tsx("calcite-notice",{key:"no-related-features-message",
icon:"information",open:!0,color:"blue",scale:"s",width:"full"},u.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))};k.renderFeatureObserver=function(){return u.tsx("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})};k.renderList=function(){const {relatedFeatureViewModels:q}=this.viewModel;return u.tsx("calcite-list",null,q.toArray().map(x=>this.renderRelatedFeature(x)),this.renderShowAllListItem())};
k.renderRelatedFeatures=function(){const {displayListItems:q}=this,{state:x}=this.viewModel;return u.tsx("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===x})},q?this.renderList():"ready"===x?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())};k.renderRelationshipNotFound=function(){return u.tsx("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",
open:!0,color:"red",scale:"s",width:"full"},u.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))};k.render=function(){const {state:q}=this.viewModel;return u.tsx("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===q?this.renderLoading():"disabled"===q?this.renderRelationshipNotFound():this.renderRelatedFeatures())};k._setupRelatedFeatureViewModels=function(){const {relatedFeatureViewModels:q}=this.viewModel;this.removeHandles("related-feature-viewmodels");
q?.forEach(x=>{this.addHandles(p.watch(()=>[x.title,x.state],()=>this.scheduleRender(),p.initial),"related-feature-viewmodels")});this.scheduleRender()};k._setupFeatureElementInfo=function(){const {headingLevel:q,visibleElements:x}=this;this._featureElementInfo.set({description:x.description&&this.description,title:x.title&&this.title,headingLevel:q})};k._handleRelatedFeatureObserverChange=function(){var q=b._asyncToGenerator(function*(){this._unobserveRelatedFeatureObserver();const {state:x,showAllEnabled:v}=
this.viewModel;yield n.after(0);this._relatedFeatureIntersectionObserverNode&&"ready"===x&&v&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)});return function(){return q.apply(this,arguments)}}();k._relatedFeatureIntersectionObserverCreated=function(q){this._relatedFeatureIntersectionObserverNode=q};k._unobserveRelatedFeatureObserver=function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)};
b._createClass(C,[{key:"displayShowAllButton",get:function(){const {showAllEnabled:q,featureCount:x,displayCount:v}=this.viewModel;return!q&&(x>v||0===v)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}},{key:"description",get:function(){return this.viewModel.description},set:function(q){this.viewModel.description=q}},{key:"featureCountDescription",get:function(){const {messages:q}=this,{featureCount:x}=this.viewModel;return z.substitute(1===
x?q?.numberRecord:q?.numberRecords,{number:x})}},{key:"title",get:function(){return this.viewModel.title},set:function(q){this.viewModel.title=q}}]);return C}(e);c.__decorate([g.property()],r.prototype,"_relatedFeatureIntersectionObserverNode",void 0);c.__decorate([g.property({readOnly:!0})],r.prototype,"displayShowAllButton",null);c.__decorate([g.property({readOnly:!0})],r.prototype,"displayListItems",null);c.__decorate([g.property()],r.prototype,"description",null);c.__decorate([g.property({readOnly:!0})],
r.prototype,"featureCountDescription",null);c.__decorate([g.property()],r.prototype,"headingLevel",void 0);c.__decorate([g.property()],r.prototype,"title",null);c.__decorate([g.property({type:l})],r.prototype,"viewModel",void 0);c.__decorate([g.property(),w.messageBundle("esri/widgets/Feature/t9n/Feature")],r.prototype,"messages",void 0);c.__decorate([g.property(),w.messageBundle("esri/t9n/common")],r.prototype,"messagesCommon",void 0);c.__decorate([g.property()],r.prototype,"visibleElements",void 0);
c.__decorate([d.cast("visibleElements")],r.prototype,"castVisibleElements",null);return r=c.__decorate([f.subclass("esri.widgets.Feature.FeatureRelationship")],r)})},"esri/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Clonable ../../../core/Collection ../../../core/HandleOwner ../../../core/Identifiable ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../rest/support/RelationshipQuery ../support/featureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){r=function(z){function y(C){var k=z.call(this,C)||this;k._queryAbortController=null;k._queryPageAbortController=null;k._queryFeatureCountAbortController=null;k.featuresPerPage=10;k.description=null;k.graphic=null;k.layer=null;k.map=null;k.orderByFields=null;k.featureCount=0;k.relationshipId=null;k.showAllEnabled=!1;k.title=null;k._cancelQuery=()=>{const {_queryAbortController:q}=a._assertThisInitialized(k);q&&q.abort();k._queryAbortController=null};k._cancelQueryFeatureCount=
()=>{const {_queryFeatureCountAbortController:q}=a._assertThisInitialized(k);q&&q.abort();k._queryFeatureCountAbortController=null};k._cancelQueryPage=()=>{const {_queryPageAbortController:q}=a._assertThisInitialized(k);q&&q.abort();k._queryPageAbortController=null};k._queryController=a._asyncToGenerator(function*(){k._cancelQuery();const q=new AbortController;k._queryAbortController=q;yield h.ignoreAbortErrors(k._query());k._queryAbortController===q&&(k._queryAbortController=null)});k._queryFeatureCountController=
a._asyncToGenerator(function*(){k._cancelQueryFeatureCount();const q=new AbortController;k._queryFeatureCountAbortController=q;yield h.ignoreAbortErrors(k._queryFeatureCount());k._queryFeatureCountAbortController===q&&(k._queryFeatureCountAbortController=null)});k._queryPageController=a._asyncToGenerator(function*(){const q=new AbortController;k._queryPageAbortController=q;yield h.ignoreAbortErrors(k._queryPage());k._queryPageAbortController===q&&(k._queryPageAbortController=null)});k._queryThrottled=
f.throttle(k._queryController,100,a._assertThisInitialized(k));k._queryFeatureCountThrottled=f.throttle(k._queryFeatureCountController,100,a._assertThisInitialized(k));k._queryPageThrottled=f.throttle(k._queryPageController,100,a._assertThisInitialized(k));k._query=a._asyncToGenerator(function*(){const {_queryAbortController:q,relatedFeatures:x}=a._assertThisInitialized(k);k._destroyRelatedFeatureViewModels();k.featurePage=1;x.removeAll();x.addMany(k._sliceFeatures(yield k._queryRelatedFeatures({signal:q?.signal})))});
k.handles.add([d.watch(()=>[k.displayCount,k.graphic,k.layer,k.map,k.orderByFieldsFixedCasing,k.relationshipId,k.featuresPerPage,k.showAllEnabled],()=>k._queryThrottled(),d.initial),d.watch(()=>[k.featurePage,k.showAllEnabled],()=>k._queryPageThrottled()),d.watch(()=>[k.layer,k.relationshipId,k.objectId],()=>k._queryFeatureCountThrottled())]);return k}a._inheritsLoose(y,z);var B=y.prototype;B.destroy=function(){this._destroyRelatedFeatureViewModels();this.relatedFeatures.removeAll();this._cancelQuery();
this._cancelQueryFeatureCount();this._cancelQueryPage()};B._destroyRelatedFeatureViewModels=function(){this.relatedFeatureViewModels?.forEach(C=>!C.destroyed&&C.destroy());this.relatedFeatureViewModels.removeAll()};B._queryFeatureCount=function(){var C=a._asyncToGenerator(function*(){const {layer:k,relatedLayer:q,relationshipId:x,objectId:v,_queryFeatureCountAbortController:D}=this;yield k?.load();if(q&&"number"===typeof v&&k?.capabilities?.queryRelated?.supportsCount){yield q.load();var F=q.createQuery();
F=new w({cacheHint:k.capabilities?.queryRelated?.supportsCacheHint??!1,relationshipId:x,returnGeometry:!1,objectIds:[v],where:F.where});F=yield k.queryRelatedFeaturesCount(F,{signal:D?.signal});this._set("featureCount",F[v]||0)}else this._set("featureCount",0)});return function(){return C.apply(this,arguments)}}();B._sliceFeatures=function(C){const {showAllEnabled:k,displayCount:q}=this;return k?C:q?C.slice(0,q):[]};B._queryPage=function(){var C=a._asyncToGenerator(function*(){const {relatedFeatures:k,
featurePage:q,showAllEnabled:x,_queryPageAbortController:v}=this;!x||2>q||k.addMany(yield this._queryRelatedFeatures({signal:v?.signal}))});return function(){return C.apply(this,arguments)}}();B._queryRelatedFeatures=function(){var C=a._asyncToGenerator(function*(k){const {orderByFieldsFixedCasing:q,showAllEnabled:x,featuresPerPage:v,displayCount:D,layer:F,relationshipId:G,featurePage:J,featureCount:L,relatedLayer:K}=this;yield F?.load();const {relationship:O,objectId:P}=this;if(!O||"number"!==typeof P||
!F?.capabilities?.queryRelated?.supportsPagination)return[];var N=x?((J-1)*v+L)%L:0;const H=x?v:D;if(!K)return[];yield K.load();var E=K.objectIdField;E=[...q?.map(T=>T.field),E];const I=q?.map(T=>`${T.field} ${T.order}`),M=F.capabilities?.queryRelated?.supportsCacheHint||!1,Q=K.createQuery();N=new w({orderByFields:I,start:N,num:H,outFields:E,cacheHint:M,relationshipId:G,returnGeometry:!1,objectIds:[P],where:Q.where});k=(yield F.queryRelatedFeatures(N,{signal:k?.signal}))[P]?.features||[];k.forEach(T=>
T.sourceLayer=K);return k});return function(k){return C.apply(this,arguments)}}();a._createClass(y,[{key:"featurePage",get:function(){return this._get("featurePage")},set:function(C){const {featuresPerPage:k,featureCount:q}=this;this._set("featurePage",Math.min(Math.max(C,1),Math.ceil(q/k)||1))}},{key:"orderByFieldsFixedCasing",get:function(){const {orderByFields:C,relatedLayer:k}=this;return C&&k?.loaded?C.map(q=>{const x=q.clone();q=u.getFixedFieldName(q.field,k);x.field=q;return x}):C}},{key:"itemDescriptionFieldName",
get:function(){return this.orderByFieldsFixedCasing?.[0]?.field||null}},{key:"displayCount",get:function(){return this._get("displayCount")},set:function(C){this._set("displayCount",Math.min(Math.max(C,0),10))}},{key:"objectId",get:function(){return this.graphic?.attributes?.[this.objectIdField]??null}},{key:"objectIdField",get:function(){return this.layer?.objectIdField||null}},{key:"relatedFeatures",get:function(){return this._get("relatedFeatures")||new n}},{key:"relatedLayer",get:function(){const {layer:C,
map:k,relationship:q}=this;return C?.loaded?u.findRelatedLayer(k,C,q):null}},{key:"relationship",get:function(){const {relationshipId:C,layer:k}=this;return"number"===typeof C?k?.relationships?.find(({id:q})=>q===C)??null:null}},{key:"relatedFeatureViewModels",get:function(){return this._get("relatedFeatureViewModels")||new n}},{key:"state",get:function(){const {_queryAbortController:C,_queryFeatureCountAbortController:k,_queryPageAbortController:q,graphic:x,relatedLayer:v}=this;return k?"loading":
C||q?"querying":x&&v?"ready":"disabled"}}]);return y}(m.ClonableMixin(g.IdentifiableMixin(p.HandleOwnerMixin(r))));b.__decorate([e.property()],r.prototype,"_queryAbortController",void 0);b.__decorate([e.property()],r.prototype,"_queryPageAbortController",void 0);b.__decorate([e.property()],r.prototype,"_queryFeatureCountAbortController",void 0);b.__decorate([e.property({value:1})],r.prototype,"featurePage",null);b.__decorate([e.property()],r.prototype,"featuresPerPage",void 0);b.__decorate([e.property({readOnly:!0})],
r.prototype,"orderByFieldsFixedCasing",null);b.__decorate([e.property()],r.prototype,"description",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"itemDescriptionFieldName",null);b.__decorate([e.property({value:3})],r.prototype,"displayCount",null);b.__decorate([e.property({type:c})],r.prototype,"graphic",void 0);b.__decorate([e.property()],r.prototype,"layer",void 0);b.__decorate([e.property()],r.prototype,"map",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"objectId",
null);b.__decorate([e.property({readOnly:!0})],r.prototype,"objectIdField",null);b.__decorate([e.property()],r.prototype,"orderByFields",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"relatedFeatures",null);b.__decorate([e.property({readOnly:!0})],r.prototype,"relatedLayer",null);b.__decorate([e.property({readOnly:!0})],r.prototype,"relationship",null);b.__decorate([e.property({readOnly:!0})],r.prototype,"featureCount",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"relatedFeatureViewModels",
null);b.__decorate([e.property()],r.prototype,"relationshipId",void 0);b.__decorate([e.property()],r.prototype,"showAllEnabled",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"state",null);b.__decorate([e.property()],r.prototype,"title",void 0);return r=b.__decorate([t.subclass("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],r)})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Identifiable ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./FeatureRelationship/FeatureRelationshipViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D){var F;const G={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};m=F=function(J){function L(O){var P=J.call(this,O)||this;P._handles=new n;P._error=null;P._featureAbortController=null;P._graphicChangedThrottled=e.throttle(P._graphicChanged,1,a._assertThisInitialized(P));P._expressionAttributes=null;P._graphicExpressionAttributes=null;P.abilities=
{...G};P.content=null;P.contentViewModels=[];P.description=null;P.defaultPopupTemplateEnabled=!1;P.formattedAttributes=null;P.lastEditInfo=null;P.relatedInfos=new Map;P.title="";P.view=null;P._isAllowedContentType=N=>{const {abilities:H}=a._assertThisInitialized(P);return"attachments"===N.type&&H.attachmentsContent||"custom"===N.type&&H.customContent||"fields"===N.type&&H.fieldsContent||"media"===N.type&&H.mediaContent||"text"===N.type&&H.textContent||"expression"===N.type&&H.expressionContent||"relationship"===
N.type&&H.relationshipContent};P._handles.add(f.watch(()=>[P.graphic,P._effectivePopupTemplate,P.abilities],()=>P._graphicChangedThrottled(),f.initial));return P}a._inheritsLoose(L,J);var K=L.prototype;K.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};K.castAbilities=function(O){return{...G,...O}};K.setActiveMedia=function(O,P){O=this.contentViewModels[O];
O instanceof k&&O.setActiveMedia(P)};K.nextMedia=function(O){O=this.contentViewModels[O];O instanceof k&&O.next()};K.previousMedia=function(O){O=this.contentViewModels[O];O instanceof k&&O.previous()};K._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};K._graphicChanged=function(){var O=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:P}=this;if(P){var N=new AbortController;this._featureAbortController=
N;try{yield this._queryFeature({signal:N.signal})}catch(H){d.isAbortError(H)||(this._error=H,g.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:H,graphic:P,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===N&&(this._featureAbortController=null)}});return function(){return O.apply(this,arguments)}}();K._cancelFeatureQuery=function(){const {_featureAbortController:O}=this;O&&O.abort();this._featureAbortController=
null};K._compileContentElement=function(O,P){if("attachments"===O.type)return this._compileAttachments(O,P);if("custom"===O.type)return this._compileCustom(O,P);if("fields"===O.type)return this._compileFields(O,P);if("media"===O.type)return this._compileMedia(O,P);if("text"===O.type)return this._compileText(O,P);if("expression"===O.type)return this._compileExpression(O,P);if("relationship"===O.type)return this._compileRelationship(O,P)};K._compileContent=function(O){this._destroyContentViewModels();
if(this.graphic)return Array.isArray(O)?O.filter(this._isAllowedContentType).map((P,N)=>this._compileContentElement(P,N)):"string"===typeof O?this._compileText(new u({text:O}),0).text:O};K._destroyContentViewModels=function(){this._handles?.remove("relationship-view-models");this._handles?.remove("content-view-models");this.contentViewModels.forEach(O=>O&&!O.destroyed&&O.destroy());this._set("contentViewModels",[])};K._matchesFeature=function(O,P){O=O?.graphic?.getObjectId();P=P?.getObjectId();return h.isSome(O)&&
h.isSome(P)&&O===P};K._setRelatedFeaturesViewModels=function({relatedFeatureViewModels:O,relatedFeatures:P,map:N}){P?.filter(Boolean).forEach(H=>{O.find(E=>this._matchesFeature(E,H))||O.add(new F({abilities:{relationshipContent:!1},map:N,graphic:H}))});O.forEach(H=>{P?.find(E=>this._matchesFeature(H,E))||O.remove(H)})};K._setExpressionContentVM=function(O,P){const {formattedAttributes:N}=this,{contentElement:H,contentElementViewModel:E}=O;O=H?.type;E&&O&&("fields"===O&&(this._createFieldsFormattedAttributes({contentElement:H,
contentElementIndex:P,formattedAttributes:N}),E.set(this._createFieldsVMParams(H,P))),"media"===O&&(this._createMediaFormattedAttributes({contentElement:H,contentElementIndex:P,formattedAttributes:N}),E.set(this._createMediaVMParams(H,P))),"text"===O&&E.set(this._createTextVMParams(H)))};K._compileRelationship=function(O,P){const {displayCount:N,orderByFields:H,relationshipId:E,title:I,description:M}=O,{_sourceLayer:Q,graphic:T,map:S}=this,U=new q({displayCount:N,graphic:T,orderByFields:H,relationshipId:E,
layer:Q,map:S,...this._compileTitleAndDesc({title:I,description:M})});this.contentViewModels[P]=U;this._handles.add(f.on(()=>U.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(U)),"relationship-view-models");return O};K._compileExpression=function(O,P){const {expressionInfo:N}=O,{graphic:H,map:E,spatialReference:I,view:M}=this,Q=new B({expressionInfo:N,graphic:H,interceptor:F.interceptor,map:E,spatialReference:I,view:M});this.contentViewModels[P]=Q;this._handles.add(f.watch(()=>Q.contentElementViewModel,
()=>this._setExpressionContentVM(Q,P),f.initial),"content-view-models");return O};K._compileAttachments=function(O,P){const {graphic:N}=this,{description:H,title:E}=O;this.contentViewModels[P]=new z({graphic:N,...this._compileTitleAndDesc({title:E,description:H})});return O};K._compileCustom=function(O,P){const {graphic:N}=this,{creator:H,destroyer:E}=O;this.contentViewModels[P]=new y({graphic:N,creator:H,destroyer:E});return O};K._compileTitleAndDesc=function({title:O,description:P}){const {_fieldInfoMap:N,
_sourceLayer:H,graphic:E,formattedAttributes:I,_expressionAttributes:M}=this,{attributes:Q}=E,T=I.global;return{title:v.substituteFieldsInLinksAndAttributes({attributes:Q,fieldInfoMap:N,globalAttributes:T,expressionAttributes:M,layer:H,text:O}),description:v.substituteFieldsInLinksAndAttributes({attributes:Q,fieldInfoMap:N,globalAttributes:T,expressionAttributes:M,layer:H,text:P})}};K._createFieldsVMParams=function(O,P){const {_effectivePopupTemplate:N,formattedAttributes:H}=this,E={...H.global,...H.content[P]};
P=(O?.fieldInfos||N?.fieldInfos)?.filter(({fieldName:Q})=>v.isExpressionField(Q)||v.isRelatedField(Q)||E.hasOwnProperty(Q));const {description:I,title:M}=O;return{attributes:E,expressionInfos:N?.expressionInfos,fieldInfos:P,...this._compileTitleAndDesc({title:M,description:I})}};K._compileFields=function(O,P){const N=O.clone();O=new C(this._createFieldsVMParams(O,P));this.contentViewModels[P]=O;N.fieldInfos=O.formattedFieldInfos.slice(0);return N};K._createMediaVMParams=function(O,P){const {abilities:N,
graphic:H,_fieldInfoMap:E,formattedAttributes:I,_effectivePopupTemplate:M,relatedInfos:Q,_sourceLayer:T,_expressionAttributes:S}=this,{attributes:U}=H,{description:Y,mediaInfos:V,title:R}=O;return{abilities:{chartAnimation:N.chartAnimation},activeMediaInfoIndex:O.activeMediaInfoIndex||0,attributes:U,layer:T,fieldInfoMap:E,formattedAttributes:{...I.global,...I.content[P]},expressionAttributes:S,mediaInfos:V,popupTemplate:M,relatedInfos:Q,...this._compileTitleAndDesc({title:R,description:Y})}};K._compileMedia=
function(O,P){const N=O.clone();O=new k(this._createMediaVMParams(O,P));N.mediaInfos=O.formattedMediaInfos.slice(0);this.contentViewModels[P]=O;return N};K._createTextVMParams=function(O){const {graphic:P,_fieldInfoMap:N,_sourceLayer:H,_expressionAttributes:E}=this;if(O&&O.text){const {attributes:I}=P;O.text=v.substituteFieldsInLinksAndAttributes({attributes:I,fieldInfoMap:N,globalAttributes:this.formattedAttributes.global,expressionAttributes:E,layer:H,text:O.text})}return{graphic:P,creator:O.text}};
K._compileText=function(O,P){O=O.clone();this.contentViewModels[P]=new y(this._createTextVMParams(O));return O};K._compileLastEditInfo=function(){const {_effectivePopupTemplate:O,_sourceLayer:P,graphic:N}=this;if(O){var {lastEditInfoEnabled:H}=O,E=P?.editFieldsInfo;if(H&&E)return v.formatEditInfo(E,N.attributes)}};K._compileTitle=function(O){const {_fieldInfoMap:P,_sourceLayer:N,graphic:H,_expressionAttributes:E}=this,{attributes:I}=H;return v.substituteFieldsInLinksAndAttributes({attributes:I,fieldInfoMap:P,
globalAttributes:this.formattedAttributes.global,expressionAttributes:E,layer:N,text:O})};K._getTitle=function(){var O=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:N}=this;return v.graphicCallback(P?.title,{graphic:N})});return function(){return O.apply(this,arguments)}}();K._getContent=function(){var O=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:N}=this;return v.graphicCallback(P?.content,{graphic:N})});return function(){return O.apply(this,
arguments)}}();K._queryFeature=function(){var O=a._asyncToGenerator(function*(P){const {_featureAbortController:N,_sourceLayer:H,graphic:E,_effectivePopupTemplate:I,spatialReference:M,map:Q,view:T}=this;if(N===this._featureAbortController&&E){yield v.queryUpdatedFeature({graphic:E,popupTemplate:I,layer:H,spatialReference:M},P);var {content:{value:S},title:{value:U}}=yield d.eachAlways({content:this._getContent(),title:this._getTitle()});({expressionAttributes:{value:P}}=yield d.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(P),
expressionAttributes:x.createCompiledExpressions({expressionInfos:I?.expressionInfos,spatialReference:M,graphic:E,map:Q,interceptor:F.interceptor,view:T})}));N===this._featureAbortController&&E&&(this._expressionAttributes=P,this._graphicExpressionAttributes={...E.attributes,...P},this._set("formattedAttributes",this._createFormattedAttributes(S)),this._set("title",this._compileTitle(U)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(S)||null))}});
return function(P){return O.apply(this,arguments)}}();K._createMediaFormattedAttributes=function({contentElement:O,contentElementIndex:P,formattedAttributes:N}){const {_effectivePopupTemplate:H,graphic:E,relatedInfos:I,_sourceLayer:M,_fieldInfoMap:Q,_graphicExpressionAttributes:T}=this;N.content[P]=v.formatAttributes({fieldInfos:H?.fieldInfos,graphic:E,attributes:{...T,...O.attributes},layer:M,fieldInfoMap:Q,relatedInfos:I})};K._createFieldsFormattedAttributes=function({contentElement:O,contentElementIndex:P,
formattedAttributes:N}){if(O.fieldInfos){const {graphic:H,relatedInfos:E,_sourceLayer:I,_fieldInfoMap:M,_graphicExpressionAttributes:Q}=this;N.content[P]=v.formatAttributes({fieldInfos:O.fieldInfos,graphic:H,attributes:{...Q,...O.attributes},layer:I,fieldInfoMap:M,relatedInfos:E})}};K._createFormattedAttributes=function(O){const {_effectivePopupTemplate:P,graphic:N,relatedInfos:H,_sourceLayer:E,_fieldInfoMap:I,_graphicExpressionAttributes:M}=this,Q={global:v.formatAttributes({fieldInfos:P?.fieldInfos,
graphic:N,attributes:M,layer:E,fieldInfoMap:I,relatedInfos:H}),content:[]};Array.isArray(O)&&O.forEach((T,S)=>{"fields"===T.type&&this._createFieldsFormattedAttributes({contentElement:T,contentElementIndex:S,formattedAttributes:Q});"media"===T.type&&this._createMediaFormattedAttributes({contentElement:T,contentElementIndex:S,formattedAttributes:Q})});return Q};K._checkForRelatedFeatures=function(O){const {graphic:P,_effectivePopupTemplate:N}=this;return this._queryRelatedInfos(P,v.getAllFieldInfos(N),
O)};K._queryRelatedInfos=function(){var O=a._asyncToGenerator(function*(P,N,H){const {relatedInfos:E,_sourceLayer:I}=this;E.clear();const M=h.isSome(I.associatedLayer)?yield I.associatedLayer.load(H):I;if(M){var Q=N.filter(U=>U&&v.isRelatedField(U.fieldName));if(Q&&Q.length){N.forEach(U=>this._configureRelatedInfo(U,M));var T=yield D.queryLayerInfos({relatedInfos:E,layer:M},H);Object.keys(T).forEach(U=>{const Y=E.get(U.toString());U=T[U]?.value;Y&&U&&(Y.layerInfo=U.data)});var S=yield D.queryRelatedFeatures({graphic:P,
relatedInfos:E,layer:M},H);Object.keys(S).forEach(U=>{D.setRelatedFeatures(S[U]?.value,E.get(U.toString()))})}}});return function(P,N,H){return O.apply(this,arguments)}}();K._configureRelatedInfo=function(O,P){const {relatedInfos:N}=this,H=D.getRelatedFieldInfo(O.fieldName);if(H){var {layerId:E,fieldName:I}=H;E&&(P=N.get(E.toString())||D.createRelatedInfo(E,P))&&(D.updateRelatedInfo({relatedInfo:P,fieldName:I,fieldInfo:O}),this.relatedInfos.set(E,P))}};a._createClass(L,[{key:"_effectivePopupTemplate",
get:function(){return h.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return v.createfieldInfoMap(v.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return v.getSourceLayer(this.graphic)}},{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(O){this._set("graphic",
O?O.clone():null)}},{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(O){this._override("spatialReference",O)}},{key:"map",get:function(){return this.view?.map||null},set:function(O){this._override("map",O)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return L}(p.IdentifiableMixin(m));m.interceptor=new r.FeatureSetQueryInterceptor(v.preLayerQueryCallback,v.preRequestCallback);b.__decorate([l.property()],m.prototype,
"_error",void 0);b.__decorate([l.property()],m.prototype,"_featureAbortController",void 0);b.__decorate([l.property({readOnly:!0})],m.prototype,"_effectivePopupTemplate",null);b.__decorate([l.property({readOnly:!0})],m.prototype,"_fieldInfoMap",null);b.__decorate([l.property({readOnly:!0})],m.prototype,"_sourceLayer",null);b.__decorate([l.property()],m.prototype,"abilities",void 0);b.__decorate([t.cast("abilities")],m.prototype,"castAbilities",null);b.__decorate([l.property({readOnly:!0})],m.prototype,
"content",void 0);b.__decorate([l.property({readOnly:!0})],m.prototype,"contentViewModels",void 0);b.__decorate([l.property()],m.prototype,"description",void 0);b.__decorate([l.property({type:Boolean})],m.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([l.property({readOnly:!0})],m.prototype,"state",null);b.__decorate([l.property({readOnly:!0})],m.prototype,"formattedAttributes",void 0);b.__decorate([l.property({type:c,value:null})],m.prototype,"graphic",null);b.__decorate([l.property({readOnly:!0})],
m.prototype,"lastEditInfo",void 0);b.__decorate([l.property({readOnly:!0})],m.prototype,"relatedInfos",void 0);b.__decorate([l.property()],m.prototype,"spatialReference",null);b.__decorate([l.property({readOnly:!0})],m.prototype,"title",void 0);b.__decorate([l.property()],m.prototype,"map",null);b.__decorate([l.property({readOnly:!0})],m.prototype,"waitingForContent",null);b.__decorate([l.property()],m.prototype,"view",void 0);return m=F=b.__decorate([w.subclass("esri.widgets.FeatureViewModel")],
m)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(b,c){this.preLayerQueryCallback=b;this.preRequestCallback=c;this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{});this.preRequestCallback||(this.preLayerQueryCallback=r=>{})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/resources":function(){define(["exports"],function(a){a.CSS=
{iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",
fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/Error ../../../core/has ../../../core/accessorSupport/decorators/subclass ../resources ../../support/widget ../../support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.FeatureContentMixin=l=>{l=function(A){function t(){var w=A.apply(this,arguments)||this;w.renderNodeContent=u=>f.isWidget(u)&&!u.destroyed?e.tsx("div",{class:d.CSS.contentNode,key:u},u.render()):u instanceof HTMLElement?e.tsx("div",{class:d.CSS.contentNode,key:u,bind:u,afterCreate:w._attachToNode}):f.hasDomNode(u)?e.tsx("div",{class:d.CSS.contentNode,key:u,bind:u.domNode,afterCreate:w._attachToNode}):null;return w}b._inheritsLoose(t,A);t.prototype._attachToNode=
function(w){w.appendChild(this)};return t}(l);return l=c.__decorate([h.subclass("esri.widgets.Feature.ContentMixin")],l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){p=function(A){function t(u,z){u=A.call(this,u,z)||this;u._animationDelay=500;u._animationPromise=null;u.viewModel=new f;return u}a._inheritsLoose(t,A);var w=t.prototype;w.initialize=function(){this.addHandles(m.watch(()=>this.visible,u=>this._visibleChange(u)))};w.destroy=function(){this._animationPromise=null};w.show=function(u){const {location:z,promise:y}=u;z&&(this.viewModel.location=z);this.visible=!0;u=()=>this.hide();y&&y.catch(()=>{}).then(u)};w.hide=function(){this.visible=
!1};w.render=function(){var {visible:u}=this,{screenLocation:z}=this.viewModel;z=!!z;u={["esri-spinner--start"]:u&&z,["esri-spinner--finish"]:!u&&z};z=this._getPositionStyles();return l.tsx("div",{class:this.classes("esri-spinner",u),styles:z})};w._visibleChange=function(u){if(u)this.viewModel.screenLocationEnabled=!0;else{var z=r.after(this._animationDelay);this._animationPromise=z;z.catch(()=>{}).then(()=>{this._animationPromise===z&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=
null)})}};w._getPositionStyles=function(){const {screenLocation:u,view:z}=this.viewModel;if(c.isNone(z)||c.isNone(u))return{};const {padding:y}=z;return{left:`${u.x-y.left}px`,top:`${u.y-y.top}px`}};a._createClass(t,[{key:"location",get:function(){return this.viewModel.location},set:function(u){this.viewModel.location=u}},{key:"view",get:function(){return this.viewModel.view},set:function(u){this.viewModel.view=u}},{key:"visible",get:function(){return this.viewModel.visible},set:function(u){this.viewModel.visible=
u}}]);return t}(d);b.__decorate([n.property()],p.prototype,"location",null);b.__decorate([n.property()],p.prototype,"view",null);b.__decorate([n.property({type:f})],p.prototype,"viewModel",void 0);b.__decorate([n.property()],p.prototype,"visible",null);return p=b.__decorate([h.subclass("esri.widgets.Spinner")],p)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),
function(a,b,c,r,m,n,p){r=function(g){function h(d){d=g.call(this,d)||this;d.visible=!1;return d}a._inheritsLoose(h,g);return h}(p);b.__decorate([c.property()],r.prototype,"visible",void 0);return r=b.__decorate([n.subclass("esri.widgets.CompassViewModel")],r)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h,d){const f=Symbol("anchorHandles");c=function(l){function A(t){var w=l.call(this,t)||this;w[e]=new r;w.location=null;w.screenLocationEnabled=!1;w.view=null;w[f].add([n.when(()=>m.applySome(w.screenLocationEnabled?w.view:null,u=>[u.size,"3d"===u.type?u.camera:u.viewpoint]),()=>w.notifyChange("screenLocation")),n.watch(()=>w.screenLocation,(u,z)=>{m.isSome(u)&&m.isSome(z)&&w.emit("view-change")})]);return w}a._inheritsLoose(A,l);A.prototype.destroy=function(){this.view=null;
this[f]=m.destroyMaybe(this[f])};a._createClass(A,[{key:"screenLocation",get:function(){const {location:t,view:w,screenLocationEnabled:u}=this;return u&&m.isSome(t)&&m.isSome(w)&&w.ready?w.toScreen(t):null}}]);return A}(c.EventedAccessor);var e=f;b.__decorate([p.property()],c.prototype,"location",void 0);b.__decorate([p.property()],c.prototype,"screenLocation",null);b.__decorate([p.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([p.property()],c.prototype,"view",void 0);return c=
b.__decorate([d.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../layers/LayerConstants ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../symbols/SimpleFillSymbol ../../geometry/Point".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K){const O=n.ofType({key:"type",defaultKeyValue:"button",base:y,typeMap:{button:B,toggle:C}});c=function(P){function N(E){E=P.call(this,E)||this;E._handles=new g;E._pendingPromises=new Set;E._fetchFeaturesController=null;E._selectedClusterFeature=null;E.featurePage=null;E.actions=new O;E.activeFeature=null;E.defaultPopupTemplateEnabled=!1;E.autoCloseEnabled=!1;E.autoOpenEnabled=!0;E.browseClusterEnabled=!1;E.content=null;E.featuresPerPage=
20;E.featureViewModelAbilities=null;E.featureViewModels=[];E.highlightEnabled=!0;E.includeDefaultActions=!0;E.selectedClusterBoundaryFeature=new r({symbol:new L({outline:{width:1.5,color:"cyan"},style:"none"})});E.title=null;E.updateLocationEnabled=!1;E.view=null;E.visible=!1;E.zoomFactor=4;E.zoomToLocation=null;return E}a._inheritsLoose(N,P);var H=N.prototype;H.initialize=function(){this._handles.add([f.watch(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",
()=>this._autoClose()),f.watch(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),f.watch(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),f.watch(()=>this.view?.animation?.state,E=>this._animationStateChange(E)),f.watch(()=>this.location,E=>this._locationChange(E)),f.watch(()=>this.selectedFeature,E=>this._selectedFeatureChange(E)),f.watch(()=>[this.selectedFeatureIndex,this.featureCount,
this.featuresPerPage],()=>this._selectedFeatureIndexChange()),f.watch(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),f.watch(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",E=>F.triggerAction({event:E,view:this.view})),f.when(()=>!this.waitingForResult,()=>this._waitingForResultChange(),f.sync),f.watch(()=>[this.features,this.view?.map,this.view?.spatialReference],
()=>this._updateFeatureVMs()),f.watch(()=>this.view?.scale,()=>this._viewScaleChange()),f.when(()=>!this.visible,()=>this.browseClusterEnabled=!1),f.watch(()=>this.browseClusterEnabled,E=>E?this.enableClusterBrowsing():this.disableClusterBrowsing())])};H.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};H.centerAtLocation=function(){const {view:E}=this,I=F.getSelectedTarget(this);
return I?this.callGoTo({target:{target:I,scale:E.scale}}):Promise.reject(new p("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:I,view:E}))};H.zoomTo=function(E){return this.callGoTo(E)};H.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})};H.fetchFeatures=function(E,I){const {view:M}=this;if(!M||!E)throw new p("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",
{screenPoint:E,view:M});return M.fetchPopupFeatures(E,{event:I&&I.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:I&&I.signal})};H.open=function(E){E={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...E,visible:!0};var {fetchFeatures:I}=E;delete E.fetchFeatures;I&&this._setFetchFeaturesPromises(E.location);I=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const M of I)delete E[M];this.set(E)};H.triggerAction=function(E){(E=this.allActions.getItemAt(E))&&!E.disabled&&
this.emit("trigger-action",{action:E})};H.next=function(){this.selectedFeatureIndex+=1;return this};H.previous=function(){--this.selectedFeatureIndex;return this};H.disableClusterBrowsing=function(){F.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};H.enableClusterBrowsing=function(){var E=a._asyncToGenerator(function*(){const {view:I,selectedFeature:M}=this;"2d"!==I?.type?h.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",
M):F.isClusterFeature(M)?(yield F.displayClusterExtent(this),yield F.browseAggregateFeatures(this)):h.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",M)});return function(){return E.apply(this,arguments)}}();H._animationStateChange=function(E){this.zoomToLocation||(D.zoomToFeature.disabled="waiting-for-target"===E)};H._clearBrowsedClusterGraphics=function(){const E=this.view?.graphics;E&&(E.remove(this.selectedClusterBoundaryFeature),
E.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};H._viewScaleChange=function(){F.isClusterFeature(this.selectedFeature)?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.features=[this.selectedFeature])};H._locationChange=function(E){const {selectedFeature:I,updateLocationEnabled:M}=this;M&&E&&(!I||I.geometry)&&this.centerAtLocation()};H._selectedFeatureIndexChange=function(){this.featurePage=
1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};H._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};H._setGraphicOnFeatureViewModels=function(){const {features:E,featureCount:I,featurePage:M,featuresPerPage:Q,featureViewModels:T}=this;if(null!==M){var S=((M-1)*Q+I)%I;T.slice(S,S+Q).forEach((U,Y)=>{U&&!U.graphic&&(U.graphic=E[S+Y])})}};H._selectedFeatureChange=function(){var E=a._asyncToGenerator(function*(I){if(I){var {location:M,
updateLocationEnabled:Q,view:T}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&(T.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),F.isClusterFeature(I)||(I.symbol=yield k.getDisplayedSymbol(I),this._selectedClusterFeature=I,T.graphics.add(this._selectedClusterFeature))):!Q&&M||!I.geometry?Q&&!I.geometry&&this.centerAtLocation().then(()=>{this.location=T.center.clone()}):this.location=d.unwrap(this._getPointFromGeometry(I.geometry))}});return function(I){return E.apply(this,
arguments)}}();H._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};H._setFetchFeaturesPromises=function(E){return this._fetchFeaturesWithController(this._getScreenPoint(E||this.location)).then(I=>{const {clientOnlyGraphics:M,promisesPerLayerView:Q}=I;I=Promise.resolve(M);const T=Q.map(S=>S.promise);this.promises=[I,...T]})};H._destroyFeatureVMs=function(){this.featureViewModels.forEach(E=>E&&!E.destroyed&&E.destroy());this._set("featureViewModels",[])};H._updateFeatureVMs=
function(){const {selectedFeature:E,features:I,featureViewModels:M}=this;F.isClusterFeature(E)||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(I&&I.length){var Q=M.slice(0),T=[];I.forEach((S,U)=>{if(S){var Y=null;Q.some((V,R)=>{V&&V.graphic===S&&(Y=V,Q.splice(R,1));return!!Y});if(Y)T[U]=Y;else{const V=new v({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:this.view?.spatialReference,graphic:S===E?S:null,map:this.view?.map,
view:this.view});T[U]=V}}});Q.forEach(S=>S&&!S.destroyed&&S.destroy());this._set("featureViewModels",T)}};H._getScreenPoint=function(E){const {view:I}=this;return I&&E&&"function"===typeof I.toScreen?I.toScreen(E):null};H._autoOpenEnabledChange=function(){const {_handles:E,autoOpenEnabled:I}=this;E.remove("auto-fetch-features");if(I&&this.view){const M=this.view.on("click",Q=>{"mouse"===Q.pointerType&&0!==Q.button||this._fetchFeaturesAndOpen(Q)},q.ViewEventPriorities.WIDGET);E.add(M,"auto-fetch-features")}};
H._cancelFetchingFeatures=function(){const E=this._fetchFeaturesController;E&&E.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};H._fetchFeaturesWithController=function(E,I){this._cancelFetchingFeatures();const M=new AbortController,{signal:Q}=M;this._fetchFeaturesController=M;this.notifyChange("waitingForResult");E=this.fetchFeatures(E,{signal:Q,event:I});E.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return E};
H._fetchFeaturesAndOpen=function(E){const {screenPoint:I,mapPoint:M}=E,{view:Q}=this;this._fetchFeaturesWithController(I,E).then(T=>{const {clientOnlyGraphics:S,promisesPerLayerView:U,location:Y}=T,V=[Promise.resolve(S),...U.map(R=>R.promise)];Q.popup.open({location:Y||M,promises:V});return T})};H._updatePendingPromises=function(E){E&&this._pendingPromises.has(E)&&(this._pendingPromises.delete(E),this.notifyChange("pendingPromisesCount"))};H._autoClose=function(){this.autoCloseEnabled&&(this.visible=
!1)};H._getPointFromGeometry=function(E){return d.isNone(E)?null:"point"===E.type?E:"extent"===E.type?E.center:"polygon"===E.type?E.centroid:"multipoint"===E.type||"polyline"===E.type?E.extent?.center:null};H._getLayerView=function(){var E=a._asyncToGenerator(function*(I,M){yield I.when();return I.whenLayerView(M)});return function(I,M){return E.apply(this,arguments)}}();H._getHighlightLayer=function(E){const {layer:I,sourceLayer:M}=E;return M&&"layer"in M&&M.layer?M.layer:"map-notes"===M?.type||
"subtype-group"===M?.type?M:I};H._getHighlightTarget=function(E,I){I="imagery"===I.type?void 0:"objectIdField"in I?I.objectIdField||z.fallbackObjectIDAttribute:null;const M=E.attributes;return M&&I&&M[I]||E};H._highlightActiveFeature=function(){var E=a._asyncToGenerator(function*(){this._handles.remove("highlight-active-feature");const {highlightEnabled:I,view:M,activeFeature:Q,visible:T}=this;if(Q&&M&&I&&T){var S=this._getHighlightLayer(Q);if(S&&S instanceof u){var U=this._getLayerView(M,S);this._highlightActiveFeaturePromise=
U;var Y=yield U;Y&&x.highlightsSupported(Y)&&this._highlightActiveFeaturePromise===U&&this.activeFeature&&this.highlightEnabled&&(S=Y.highlight(this._getHighlightTarget(Q,S)),this._handles.add(S,"highlight-active-feature"))}}});return function(){return E.apply(this,arguments)}}();H._highlightSelectedFeature=function(){var E=a._asyncToGenerator(function*(){this._handles.remove("highlight-selected-feature");const {selectedFeature:I,highlightEnabled:M,view:Q,visible:T}=this;if(I&&Q&&M&&T){var S=this._getHighlightLayer(I);
if(S&&S instanceof u){var U=this._getLayerView(Q,S);this._highlightSelectedFeaturePromise=U;var Y=yield U;Y&&x.highlightsSupported(Y)&&this._highlightSelectedFeaturePromise===U&&this.selectedFeature&&this.highlightEnabled&&this.visible&&(S=Y.highlight(this._getHighlightTarget(I,S)),this._handles.add(S,"highlight-selected-feature"))}}});return function(){return E.apply(this,arguments)}}();H._updateFeatures=function(E){const {features:I}=this;E&&E.length&&(I.length?(E=E.filter(M=>!I.includes(M)),this.features=
I.concat(E)):this.features=E)};a._createClass(N,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(E=>E.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const E=this._get("allActions")||new O;E.removeAll();const {actions:I,defaultActions:M,defaultPopupTemplateEnabled:Q,includeDefaultActions:T,selectedFeature:S}=this;var U=T?M.concat(I):I;const Y=S&&("function"===typeof S.getEffectivePopupTemplate&&
S.getEffectivePopupTemplate(Q)||S.popupTemplate),V=Y&&Y.actions;(U=Y&&Y.overwriteActions?V:V?V.concat(U):U)&&U.filter(Boolean).forEach(R=>E.add(R));return E}},{key:"defaultActions",get:function(){const E=this._get("defaultActions")||new O;E.removeAll();E.addMany(F.isClusterFeature(this.selectedFeature)?[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:[D.zoomToFeature.clone()]);return E}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||
[]},set:function(E){E=E||[];this._set("features",E);const {pendingPromisesCount:I,promiseCount:M,selectedFeatureIndex:Q}=this,T=M&&E.length;T&&I&&-1===Q?this.selectedFeatureIndex=0:T&&-1!==Q||(this.selectedFeatureIndex=E.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(E){const I=this.get("view.spatialReference.isWebMercator");E&&E.get("spatialReference.isWGS84")&&I&&(E=w.geographicToWebMercator(E));this._set("location",E)}},{key:"pendingPromisesCount",
get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(E){this._pendingPromises.clear();this.features=[];Array.isArray(E)&&E.length?(this._set("promises",E),E=E.slice(0),E.forEach(I=>{this._pendingPromises.add(I);I.then(M=>{this._pendingPromises.has(I)&&
this._updateFeatures(M);this._updatePendingPromises(I)},()=>this._updatePendingPromises(I))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:E,selectedFeatureIndex:I}=this;return-1===I?null:E[I]||null}},{key:"selectedFeatureIndex",get:function(){const E=this._get("selectedFeatureIndex");return"number"===typeof E?E:-1},set:function(E){const {featureCount:I}=this;E=isNaN(E)||-1>E||!I?-1:(E+I)%I;this.activeFeature=null;this._set("selectedFeatureIndex",
E)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return N}(J.GoToMixin(G));b.__decorate([e.property()],c.prototype,"featurePage",void 0);b.__decorate([e.property()],c.prototype,"isLoadingFeature",null);b.__decorate([e.property({type:O})],c.prototype,"actions",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([e.property()],
c.prototype,"activeFeature",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([e.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([e.property()],c.prototype,"autoCloseEnabled",void 0);b.__decorate([e.property()],c.prototype,"autoOpenEnabled",void 0);b.__decorate([e.property()],c.prototype,"browseClusterEnabled",void 0);b.__decorate([e.property()],c.prototype,"content",void 0);b.__decorate([e.property({type:O,readOnly:!0})],
c.prototype,"defaultActions",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([e.property()],c.prototype,"features",null);b.__decorate([e.property()],c.prototype,"featuresPerPage",void 0);b.__decorate([e.property()],c.prototype,"featureViewModelAbilities",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([e.property()],c.prototype,"highlightEnabled",void 0);b.__decorate([e.property()],c.prototype,"includeDefaultActions",
void 0);b.__decorate([e.property({type:K})],c.prototype,"location",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedClusterBoundaryFeature",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"waitingForResult",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"promiseCount",null);b.__decorate([e.property()],c.prototype,"promises",null);b.__decorate([e.property({value:null,readOnly:!0})],
c.prototype,"selectedFeature",null);b.__decorate([e.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([e.property()],c.prototype,"title",void 0);b.__decorate([e.property()],c.prototype,"updateLocationEnabled",void 0);b.__decorate([e.property()],c.prototype,"view",void 0);b.__decorate([e.property()],c.prototype,"visible",
void 0);b.__decorate([e.property()],c.prototype,"zoomFactor",void 0);b.__decorate([e.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([e.property()],c.prototype,"centerAtLocation",null);return c=b.__decorate([t.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(y,B){if(B&&(y.style.filter=d.getCSSFilterFromEffectList(B),B=B.effects))for(const C of B)if("drop-shadow"===C?.type){0>C.offsetX?y.style.marginLeft=`${Math.abs(C.offsetX)}px`:y.style.marginRight=`${C.offsetX}px`;break}}function e(y,B){return l.apply(this,arguments)}function l(){l=c._asyncToGenerator(function*(y,B){switch(y.type){case "web-style":var {previewWebStyleSymbol:C}=yield new Promise((k,q)=>a(["./previewWebStyleSymbol"],k,q));return C(y,e,B);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:C}=
yield new Promise((k,q)=>a(["./previewSymbol3D"],k,q)),C(y,B);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:C}=yield new Promise((k,q)=>a(["./previewSymbol2D"],k,q)),C(y,B);case "cim":return{previewCIMSymbol:C}=yield new Promise((k,q)=>a(["./previewCIMSymbol"],k,q)),C(y,B)}});return l.apply(this,arguments)}function A(y){return y&&"opacity"in y?y.opacity*A(y.parent):1}function t(){t=c._asyncToGenerator(function*(y,
B){if(y){var C=y.sourceLayer,k=(m.isSome(B)&&(B.useSourceLayer??!1)?C:y.layer)??C;C=A(k);if(m.isSome(y.symbol)&&(!m.isSome(B)||!0!==B.ignoreGraphicSymbol))return y="web-style"===y.symbol.type?yield y.symbol.fetchSymbol({...B,cache:m.isSome(B)?B.webStyleCache:null}):y.symbol.clone(),d.applyColorToSymbol(y,null,C),y;var q=(m.isSome(B)?B.renderer:null)??(k&&"renderer"in k?k.renderer:null);if(k=q&&"getSymbolAsync"in q?yield q.getSymbolAsync(y,B):null){k="web-style"===k.type?yield k.fetchSymbol({...B,
cache:m.isSome(B)?B.webStyleCache:null}):k.clone();if(!(q&&"visualVariables"in q&&q.visualVariables&&q.visualVariables.length))return d.applyColorToSymbol(k,null,C),k;"arcadeRequiredForVisualVariables"in q&&q.arcadeRequiredForVisualVariables&&(m.isNone(B)||m.isNone(B.arcade))&&(B={...m.unwrap(B)},B.arcade=yield n.loadArcade());var x=yield new Promise((L,K)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],L,K)),v=[],D=[],F=[],G=[];for(var J of q.visualVariables)switch(J.type){case "color":v.push(J);
break;case "opacity":D.push(J);break;case "rotation":G.push(J);break;case "size":J.target||F.push(J)}J=(J=!!v.length&&v[v.length-1])?x.getColor(J,y,B):null;D=(D=!!D.length&&D[D.length-1])?x.getOpacity(D,y,B):null;null!=C&&(D=null!=D?D*C:C);d.applyColorToSymbol(k,J,D);F.length&&(C=x.getAllSizes(F,y,B),yield d.applySizesToSymbol(k,C));for(const L of G)d.applyRotationToSymbol(k,x.getRotationAngle(L,y,B),L.axis);return k}}});return t.apply(this,arguments)}function w(){w=c._asyncToGenerator(function*(y,
B){if(y){var C=A(y.layer||y.sourceLayer);if(m.isSome(y.symbol)&&(!m.isSome(B)||!0!==B.ignoreGraphicSymbol))return y="web-style"===y.symbol.type?yield y.symbol.fetchSymbol(B):y.symbol.clone(),d.getColorFromSymbol(y,C);var k=m.isSome(B)&&B.renderer||y.get("layer.renderer")||y.get("sourceLayer.renderer"),q=yield k.getSymbolAsync(y,B);if(q){q="web-style"===q.type?yield q.fetchSymbol(B):q.clone();var x=d.getColorFromSymbol(q,C);if(!("visualVariables"in k)||"visualVariables"in k&&!k.visualVariables||"visualVariables"in
k&&!k.visualVariables?.length)return x;k.arcadeRequiredForVisualVariables&&(m.isNone(B)||m.isNone(B.arcade))&&(B={...m.unwrap(B)},B.arcade=yield n.loadArcade());q=yield new Promise((F,G)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],F,G));var v=[],D=[];for(const F of k.visualVariables)switch(F.type){case "color":v.push(F);break;case "opacity":D.push(F)}k=(k=0<v.length?v[v.length-1]:null)?q.getColor(k,y,B):x;y=(x=0<D.length?D[D.length-1]:null)?q.getOpacity(x,y,B):null;null!=C&&
(y=null!=y?y*C:C);return k?d.applyOpacityToColor(k,y):null}}});return w.apply(this,arguments)}let u=null;const z=[255,255,255];b.getDisplayedColor=function(y,B){return w.apply(this,arguments)};b.getDisplayedSymbol=function(y,B){return t.apply(this,arguments)};b.renderColorRampPreviewHTML=function(y,B={}){var C="horizontal"===B.align;const {width:k=C?75:24,height:q=C?24:75,gradient:x=!0}=B;var v=window.devicePixelRatio,D=k*v,F=q*v;v=document.createElement("canvas");v.width=D;v.height=F;v.style.width=
`${k}px`;v.style.height=`${q}px`;const G=v.getContext("2d");var J=C?D:0,L=C?0:F;if(x){const K=G.createLinearGradient(0,0,J,L);C=y.length;const O=1===C?0:1/(C-1);y.forEach((P,N)=>K.addColorStop(N*O,P.toString()));G.fillStyle=K;G.fillRect(0,0,D,F)}else{D=C?D/y.length:D;F=C?F:F/y.length;L=J=0;for(const K of y)G.fillStyle=K.toString(),G.fillRect(J,L,D,F),J=C?J+D:0,L=C?0:L+F}y=document.createElement("div");y.style.width=`${k}px`;y.style.height=`${q}px`;f(y,B?.effectList);y.appendChild(v);return y};b.renderDotDensityPreviewHTML=
function(y,B,C){const {backgroundColor:k,outline:q,dotSize:x}=y;C=C&&C.swatchSize||g.SymbolSizeDefaults.size;const v=Math.round(C*C/x**2*.8),D=window.devicePixelRatio;y=document.createElement("canvas");const F=C*D;y.width=F;y.height=F;y.style.width=`${y.width/D}px`;y.style.height=`${y.height/D}px`;const G=y.getContext("2d");k&&(G.fillStyle=k.toCss(!0),G.fillRect(0,0,F,F),G.fill());G.fillStyle=B.toCss(!0);if(u&&u.length/2===v)for(B=0;B<2*v;B+=2)G.fillRect(u[B],u[B+1],x*D,x*D),G.fill();else for(u=[],
B=0;B<2*v;B+=2){const J=Math.floor(Math.random()*(F-0+1)),L=Math.floor(Math.random()*(F-0+1));u.push(J,L);G.fillRect(J,L,x*D,x*D);G.fill()}q&&(q.color&&(G.strokeStyle=q.color.toCss(!0)),G.lineWidth=q.width,G.strokeRect(0,0,F,F));C=new Image(C,C);C.src=y.toDataURL();return C};b.renderPieChartPreviewHTML=function(y,B={}){const C=B.radius||40;var k=2*Math.PI*C,q=y.length;const x=k/q,v=[],D=p.getStroke(B.outline);null!=D?.width&&(D.width*=2);(D||B.backgroundColor)&&v.push({shape:{type:"circle",cx:C,cy:C,
r:C},fill:B.backgroundColor,stroke:D,offset:[0,0]});const F=B.values,G=F&&F.length===q&&100===F.reduce((L,K)=>L+K,0),J=[0];for(let L=0;L<q;L++){let K=null;G&&(K=F[L]*k/100,J.push(K+J[L]));v.push({shape:{type:"circle",cx:C,cy:C,r:C/2},fill:[0,0,0,0],stroke:{width:C,dashArray:`${(K??x)/2} ${k}`,dashoffset:`-${G?J[L]/2:x/2*L}`,color:y[L]},offset:[0,0]})}q=null;y=2*C+(D?.width||0);if(k=B.holePercentage)D&&v.push({shape:{type:"circle",cx:C,cy:C,r:C*k},fill:null,stroke:D,offset:[0,0]}),q=y/2,q=[[{shape:{type:"circle",
cx:q,cy:q,r:q},fill:z,stroke:D?{...D,color:z}:null,offset:[0,0]},{shape:{type:"circle",cx:q,cy:q,r:C*k},fill:[0,0,0],stroke:null,offset:[0,0]}]];return h.renderSymbol([v],[y,y],{effectView:B.effectList,ignoreStrokeWidth:!0,masking:q,rotation:-90})};b.renderPreviewHTML=e;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(r,m){return Math.round(Math.min(Math.max(r+
191.25*m,0),255))}a.SymbolSizeDefaults=void 0;(function(r){r[r.size=22]="size";r[r.lineWidth=50]="lineWidth";r[r.maxSize=120]="maxSize";r[r.maxOutlineSize=80]="maxOutlineSize";r[r.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(r,m){if(null==r)return new b;if("type"in r&&("linear"===r.type||"pattern"===r.type))return r;r=new b(r);return new b([c(r.r,m),c(r.g,m),c(r.b,m),r.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=
function(r,m){let n=m?a.SymbolSizeDefaults.tallSymbolWidth:r;m=m?4:6;n=n<=a.SymbolSizeDefaults.size?n-.5*m:n-m;m=.15*n;const p=n;r-=m;return[{type:"ellipse",cx:.5*n,cy:r,rx:.5*n,ry:m},{type:"path",path:[{command:"M",values:[.5*p,0]},{command:"L",values:[p,r]},{command:"L",values:[0,r]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(r,m){let n=m?a.SymbolSizeDefaults.tallSymbolWidth:r;var p=m?4:6;p=n=n<=a.SymbolSizeDefaults.size?n-.5*p:n-p;m=m?.35*n:.5*n;return[{type:"path",path:[{command:"M",
values:[.5*p,0]},{command:"L",values:[p,.5*m]},{command:"L",values:[.5*p,m]},{command:"L",values:[0,.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[.5*p,m]},{command:"L",values:[.5*p,r]},{command:"L",values:[0,r-.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*p,m]},{command:"L",values:[.5*p,r]},{command:"L",values:[p,r-.5*m]},{command:"L",values:[p,.5*m]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(r,m){var n=
m?a.SymbolSizeDefaults.tallSymbolWidth:r;m=m?4:6;n=n<=a.SymbolSizeDefaults.size?n-.5*m:n-m;m=.5*n;const p=.15*n;r-=p;return[{type:"ellipse",cx:.5*n,cy:r,rx:m,ry:p},{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[0,r]},{command:"L",values:[n,r]},{command:"L",values:[n,p]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*n,cy:p,rx:m,ry:p}]};a.getDiamondShapes=function(r){var m=r;m=m<a.SymbolSizeDefaults.size?m-2:m-4;const n=Math.floor(r/10)-1||1;return[{type:"path",path:[{command:"M",
values:[.45*m,0]},{command:"L",values:[m,.5*r-n]},{command:"L",values:[.45*m-n,.5*r+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[.45*m-n,.5*r+n]},{command:"L",values:[0,.5*r-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*r-n]},{command:"L",values:[.45*m-n,.5*r+n]},{command:"L",values:[.45*m,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*m,r]},{command:"L",values:[m,.5*r-n]},{command:"L",
values:[.45*m-n,.5*r+n]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(r){const m=a.SymbolSizeDefaults.size;r*=.5;return[{type:"path",path:[{command:"M",values:[0,.35*m]},{command:"L",values:[.3*m,.7*m]},{command:"L",values:[.3*m,.7*m+r]},{command:"L",values:[0,.7*m+r-.35*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*m,.7*m]},{command:"L",values:[.3*m,.7*m+r]},{command:"L",values:[m,r]},{command:"L",values:[m,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.3*m,0]},{command:"L",values:[m,0]},{command:"L",values:[.3*m,.7*m]},{command:"L",values:[0,.35*m]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(r){let m=r;m=m<a.SymbolSizeDefaults.size?m-3:m-6;const n=.15*m,p=m;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[p,0]},{command:"L",values:[.5*p,r-n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*m,cy:0,rx:.5*m,ry:n}]};a.getPathSymbolShapes=function(r,m,n){var p=a.SymbolSizeDefaults.size;let g=p,h=p;
1>r?g*=.75:1<r&&(h*=1.25);r=p;m&&n&&(g=h=r=p=0);return[{type:"path",path:[{command:"M",values:[r,0]},{command:"L",values:[n?r:.875*r,0]},{command:"L",values:[n?g-.5*r:0,h-.5*p]},{command:"L",values:[g-.5*r,h-.5*p]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[r,0]},{command:"L",values:[r,m?0:.125*p]},{command:"L",values:[g-.5*r,m?h-.5*p:p]},{command:"L",values:[g-.5*r,h-.5*p]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[g-.5*r,h-.5*p]},{command:"L",values:[n?
g-.5*r:0,h-.5*p]},{command:"L",values:[n?g-.5*r:0,m?h-.5*p:p]},{command:"L",values:[g-.5*r,m?h-.5*p:p]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(r){var m=r;m=m<a.SymbolSizeDefaults.size?m-1:m-2;return[{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[r,m]},{command:"L",values:[.45*r,.6*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[.45*r,.6*m]},{command:"L",values:[0,m]},{command:"Z",values:[]}]},{type:"path",
path:[{command:"M",values:[0,m]},{command:"L",values:[.45*r,.6*m]},{command:"L",values:[r,m]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/renderUtils":function(){define("exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../libs/maquette/projection ../../libs/maquette/projector ./svgUtils ./utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(l,A,t){return l?c(l,{responseType:"image"}).then(w=>{w=w.data;const u=w.width,z=w.height,y=u/z;let B=A;t&&(B=Math.min(B,Math.max(u,z)));return{image:w,width:1>=y?Math.ceil(B*y):B,height:1>=y?B:Math.ceil(B/y)}}):Promise.reject(new m("renderUtils: imageDataSize","href not provided."))}const e=g.createProjector();a.renderSymbol=function(l,A,t){const w=Math.ceil(A[0]);A=Math.ceil(A[1]);if(!l.some(z=>!!z.length))return null;const u=t&&t.node||document.createElement("div");
null!=t.opacity&&(u.style.opacity=t.opacity.toString());null!=t.effectView&&(u.style.filter=d.getCSSFilterFromEffectList(t.effectView));e.append(u,h.renderSVG.bind(null,l,w,A,t));return u};a.tintImageWithColor=function(l,A,t,w,u){return f(l,A,u).then(z=>{const y=z.width?z.width:A,B=z.height?z.height:A;var C;if(C=z.image)C=t&&"ignore"!==w?"multiply"===w&&255===t.r&&255===t.g&&255===t.b&&1===t.a?!1:!0:!1;if(C){var k=z.image.width,q=z.image.height;n("edge")&&/\.svg$/i.test(l)&&(--k,--q);C=Math.ceil(y);
var x=Math.ceil(B);var v=document.createElement("canvas");v.width=C;v.height=x;v.style.width=C+"px";v.style.height=x+"px";v=v.getContext("2d");v.clearRect(0,0,C,x);C=v;C.drawImage(z.image,0,0,k,q,0,0,y,B);x=C.getImageData(0,0,y,B);v=[t.r/255,t.g/255,t.b/255,t.a];const F=r.toHSV(t);for(let G=0;G<x.data.length;G+=4){z=x.data;k=G;q=v;var D=F;switch(w){case "multiply":z[k+0]*=q[0];z[k+1]*=q[1];z[k+2]*=q[2];z[k+3]*=q[3];break;default:const J=r.toHSV({r:z[k+0],g:z[k+1],b:z[k+2]});J.h=D.h;J.s=D.s;J.v=J.v/
100*D.v;D=r.toRGB(J);z[k+0]=D.r;z[k+1]=D.g;z[k+2]=D.b;z[k+3]*=q[3]}}C.putImageData(x,0,0);l=C.canvas.toDataURL("image/png")}else(C=b.id&&b.id.findCredential(l))&&C.token&&(z=l.includes("?")?"\x26":"?",l=`${l}${z}token=${C.token}`);return{url:l,width:y,height:B}}).catch(()=>({url:l,width:A,height:A}))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function b(d,f){const e=[];let l,A;if(d[0].length!==
f.length)throw"dimensions do not match";const t=d.length,w=d[0].length;let u=0;for(l=0;l<t;l++){for(A=u=0;A<w;A++)u+=d[l][A]*f[A];e.push(u)}return e}function c(d){d=[d.r/255,d.g/255,d.b/255].map(f=>.04045>=f?f/12.92:((f+.055)/1.055)**2.4);d=b(g,d);return{x:100*d[0],y:100*d[1],z:100*d[2]}}function r(d){d=b(h,[d.x/100,d.y/100,d.z/100]).map(f=>Math.min(1,Math.max(.0031308>=f?12.92*f:1.055*f**(1/2.4)-.055,0)));return{r:Math.round(255*d[0]),g:Math.round(255*d[1]),b:Math.round(255*d[2])}}function m(d){d=
[d.x/95.047,d.y/100,d.z/108.883].map(f=>f>(6/29)**3?f**(1/3):1/3*(29/6)**2*f+4/29);return{l:116*d[1]-16,a:500*(d[0]-d[1]),b:200*(d[1]-d[2])}}function n(d){const f=d.l;d=[(f+16)/116+d.a/500,(f+16)/116,(f+16)/116-d.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*d[0],y:100*d[1],z:108.883*d[2]}}function p(d){if("r"in d&&"g"in d&&"b"in d)return d;if("l"in d&&"c"in d&&"h"in d){var f=d.c,e=d.h;return r(n({l:d.l,a:f*Math.cos(e),b:f*Math.sin(e)}))}if("l"in d&&"a"in d&&"b"in d)return r(n(d));
if("x"in d&&"y"in d&&"z"in d)return r(d);if("h"in d&&"s"in d&&"v"in d){e=(d.h+360)%360/60;f=d.v/100*255;d=d.s/100*f;const l=d*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:d,g:l,b:0};break;case 1:e={r:l,g:d,b:0};break;case 2:e={r:0,g:d,b:l};break;case 3:e={r:0,g:l,b:d};break;case 4:e={r:l,g:0,b:d};break;case 5:case 6:e={r:d,g:0,b:l};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+f-d);e.g=Math.round(e.g+f-d);e.b=Math.round(e.b+f-d);return e}return d}const g=[[.4124,.3576,.1805],[.2126,.7152,
.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(d,f){d=m(c(d));d.l*=1-f;return r(n(d))};a.toHSV=function(d){if("h"in d&&"s"in d&&"v"in d)return d;var f=p(d);d=f.r;const e=f.g,l=f.b;f=Math.max(d,e,l);const A=f-Math.min(d,e,l);d=0===A?0:f===d?(e-l)/A%6:f===e?(l-d)/A+2:(d-e)/A+4;0>d&&(d+=6);return{h:60*d,s:100*(0===A?0:A/f),v:100/255*f}};a.toLAB=function(d){return"l"in d&&"a"in d&&"b"in d?d:m(c(p(d)))};a.toLCH=function(d){if(!("l"in
d&&"c"in d&&"h"in d)){var f=m(c(p(d)));d=f.l;var e=f.a;const l=f.b;f=Math.sqrt(e*e+l*l);e=Math.atan2(l,e);e=0<e?e:e+2*Math.PI;d={l:d,c:f,h:e}}return d};a.toRGB=p;a.toXYZ=function(d){return"x"in d&&"y"in d&&"z"in d?d:c(p(d))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/svgUtils":function(){define("exports ../../Color ../../core/has ../../core/maybe ../../chunks/mat2df32 ../../chunks/mat2d ../../widgets/support/widgetUtils ../../widgets/support/jsxFactory".split(" "),
function(a,b,c,r,m,n,p,g){function h(H,E){H*=P/180;return Math.abs(E*Math.sin(H))+Math.abs(E*Math.cos(H))}function d(H){return H.map(E=>`${E.command} ${E.values.join(" ")}`).join(" ").trim()}function f(H,E,I,M){if(H){if("circle"===H.type)return g.tsx("circle",{fill:E,"fill-rule":"evenodd",stroke:I.color,"stroke-width":I.width,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-dasharray":I.dashArray,"stroke-dashoffset":I.dashOffset,"stroke-miterlimit":"4",cx:H.cx,cy:H.cy,r:H.r});if("ellipse"===
H.type)return g.tsx("ellipse",{fill:E,"fill-rule":"evenodd",stroke:I.color,"stroke-width":I.width,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-dasharray":I.dashArray,"stroke-miterlimit":"4",cx:H.cx,cy:H.cy,rx:H.rx,ry:H.ry});if("rect"===H.type)return g.tsx("rect",{fill:E,"fill-rule":"evenodd",stroke:I.color,"stroke-width":I.width,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-dasharray":I.dashArray,"stroke-miterlimit":"4",x:H.x,y:H.y,width:H.width,height:H.height});if("image"===
H.type)return g.tsx("image",{href:H.src,x:H.x,y:H.y,width:H.width,height:H.height,preserveAspectRatio:"none"});if("path"===H.type)return H="string"!==typeof H.path?d(H.path):H.path,g.tsx("path",{fill:E,"fill-rule":"evenodd",stroke:I.color,"stroke-width":I.width,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-dasharray":I.dashArray,"stroke-miterlimit":"4",d:H});if("text"===H.type)return r.assertIsSome(M),g.tsx("text",{"dominant-baseline":M.dominantBaseline,fill:E,"fill-rule":"evenodd",stroke:I.color,
"stroke-width":I.width,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-dasharray":I.dashArray,"stroke-miterlimit":"4","text-anchor":M.align,"text-decoration":M.decoration,kerning:M.kerning,rotate:M.rotate,"text-rendering":F,"font-style":M.font.style,"font-variant":M.font.variant,"font-weight":M.font.weight,"font-size":M.font.size,"font-family":M.font.family,x:H.x,y:H.y},H.text)}return null}function e(H){const E={fill:"none",pattern:null,linearGradient:null};if(H)if("type"in H&&"pattern"===
H.type){var I=`patternId-${++v}`;E.fill=`url(#${I})`;E.pattern={id:I,x:H.x,y:H.y,width:H.width,height:H.height,image:{x:0,y:0,width:H.width,height:H.height,href:H.src}}}else"type"in H&&"linear"===H.type?(I=`linearGradientId-${++D}`,E.fill=`url(#${I})`,E.linearGradient={id:I,x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,stops:H.colors.map(M=>({offset:M.offset,color:M.color&&(new b(M.color)).toString()}))}):H&&(H=new b(H),E.fill=H.toString());return E}function l(H){const E={color:"none",width:1,cap:"butt",join:"4",
dashArray:"none",dashOffset:"0"};if(H&&(null!=H.width&&(E.width=H.width),H.cap&&(E.cap=H.cap),H.join&&(E.join=H.join.toString()),H.color&&(E.color=(new b(H.color)).toString()),H.dashArray&&(E.dashArray=H.dashArray),H.dashArray&&(E.dashOffset=H.dashoffset),H.style)){let I=null;H.style in O&&(I=O[H.style]);if(Array.isArray(I)){I=I.slice(0);const M=H.width??0;for(let Q=0;Q<I.length;++Q)I[Q]*=M;if("butt"!==H.cap){for(H=0;H<I.length;H+=2)I[H]-=M,1>I[H]&&(I[H]=1);for(H=1;H<I.length;H+=2)I[H]+=M}I=I.join(",")}E.dashArray=
I}return E}function A(H,E){const I={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(H){const M=H.alignBaseline;I.align=H.align;I.dominantBaseline="baseline"===M?"auto":"top"===M?"text-top":"bottom"===M?"hanging":M;I.decoration=H.decoration;I.kerning=H.kerning?"auto":"0";I.rotate=H.rotated?"90":"0";r.assertIsSome(E);I.font.style=E.style||"normal";I.font.variant=E.variant||"normal";I.font.weight=E.weight||"normal";I.font.size=
E.size&&E.size.toString()||"10pt";I.font.family=E.family||"serif"}return I}function t(H){const {pattern:E,linearGradient:I}=H;return E?g.tsx("pattern",{id:E.id,patternUnits:"userSpaceOnUse",x:E.x,y:E.y,width:E.width,height:E.height},g.tsx("image",{x:E.image.x,y:E.image.y,width:E.image.width,height:E.image.height,href:E.image.href})):I?(H=I.stops.map((M,Q)=>g.tsx("stop",{key:`${Q}-stop`,offset:M.offset,"stop-color":M.color})),g.tsx("linearGradient",{id:I.id,gradientUnits:"userSpaceOnUse",x1:I.x1,y1:I.y1,
x2:I.x2,y2:I.y2},H)):null}function w(H,E){if(!H)return null;const I=[];for(const M of H){const {shape:Q,fill:T,stroke:S,font:U}=M;H=e(T);const Y=l(S),V="text"===Q.type?A(Q,U):null;(H=f(Q,H.fill,Y,V))&&I.push(H)}return g.tsx("mask",{id:E,maskUnits:"userSpaceOnUse"},g.tsx("g",null,I))}function u(H,E,I,M,Q){n.scale(H,n.identity(H),[E,I]);H[4]=H[4]*E-M*E+M;H[5]=H[5]*I-Q*I+Q;return H}function z(H,E){if(L&&"left"in L){null!=L.left&&L.left>H&&(L.left=H);if(null==L.right||L.right<H)L.right=H;if(null==L.top||
L.top>E)L.top=E;if(null==L.bottom||L.bottom<E)L.bottom=E}else L={left:H,bottom:E,right:H,top:E}}function y(H){const E=H.args,I=E.length;switch(H.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(H=0;H<I;H+=2)z(E[H],E[H+1]);K.x=E[I-2];K.y=E[I-1];break;case "H":for(H=0;H<I;++H)z(E[H],K.y);K.x=E[I-1];break;case "V":for(H=0;H<I;++H)z(K.x,E[H]);K.y=E[I-1];break;case "m":H=0;"x"in K||(z(K.x=E[0],K.y=E[1]),H=2);for(;H<I;H+=2)z(K.x+=E[H],K.y+=E[H+1]);break;case "l":case "t":for(H=0;H<I;H+=
2)z(K.x+=E[H],K.y+=E[H+1]);break;case "h":for(H=0;H<I;++H)z(K.x+=E[H],K.y);break;case "v":for(H=0;H<I;++H)z(K.x,K.y+=E[H]);break;case "c":for(H=0;H<I;H+=6)z(K.x+E[H],K.y+E[H+1]),z(K.x+E[H+2],K.y+E[H+3]),z(K.x+=E[H+4],K.y+=E[H+5]);break;case "s":case "q":for(H=0;H<I;H+=4)z(K.x+E[H],K.y+E[H+1]),z(K.x+=E[H+2],K.y+=E[H+3]);break;case "A":for(H=0;H<I;H+=7)z(E[H+5],E[H+6]);K.x=E[I-2];K.y=E[I-1];break;case "a":for(H=0;H<I;H+=7)z(K.x+=E[H+5],K.y+=E[H+6])}}function B(H,E,I){const M=G[H.toLowerCase()];"number"===
typeof M&&(M?E.length>=M&&(H={action:H,args:E.slice(0,E.length-E.length%M)},I.push(H),y(H)):(H={action:H,args:[]},I.push(H),y(H)))}function C(H){const E={x:0,y:0,width:0,height:0};if("circle"===H.type)E.x=H.cx-H.r,E.y=H.cy-H.r,E.width=2*H.r,E.height=2*H.r;else if("ellipse"===H.type)E.x=H.cx-H.rx,E.y=H.cy-H.ry,E.width=2*H.rx,E.height=2*H.ry;else if("image"===H.type||"rect"===H.type)E.x=H.x,E.y=H.y,E.width=H.width,E.height=H.height;else if("path"===H.type){var I=r.unwrapOrThrow;{const T=("string"!==
typeof H.path?d(H.path):H.path).match(J),S=[];L={};K={};if(T){H="";var M=[],Q=T.length;for(let U=0;U<Q;++U){const Y=T[U],V=parseFloat(Y);isNaN(V)?(H&&B(H,M,S),M=[],H=Y):M.push(V)}B(H,M,S);H={x:0,y:0,width:0,height:0};L&&"left"in L&&(H.x=L.left,H.y=L.top,H.width=L.right-L.left,H.height=L.bottom-L.top)}else H=null}I=I.call(r,H);E.x=I.x;E.y=I.y;E.width=I.width;E.height=I.height}return E}function k(H){const E={x:0,y:0,width:0,height:0};let I=null,M=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;
for(const T of H)I?(I.x=Math.min(I.x,T.x),I.y=Math.min(I.y,T.y),M=Math.max(M,T.x+T.width),Q=Math.max(Q,T.y+T.height)):(I=E,I.x=T.x,I.y=T.y,M=T.x+T.width,Q=T.y+T.height);I&&(I.width=M-I.x,I.height=Q-I.y);return I}function q(H,E,I,M,Q,T,S,U,Y){var V=(S&&T?h(T,E):E)/2,R=(S&&T?h(T,I):I)/2;if(Y){var X=Y[0];Y=Y[1];V=(S&&T?h(T,X):X)/2;R=(S&&T?h(T,Y):Y)/2}X=H.width+M;var W=H.height+M;Y=m.create();S=m.create();var aa=!1;if(Q&&0!==X&&0!==W){Q=E!==I?E/I:X/W;aa=E>I?E:I;let ba=1,ia=1;isNaN(aa)||(1<Q?(ba=aa/X,
ia=aa/Q/W):(ia=aa/W,ba=aa*Q/X));n.multiply(S,S,u(Y,ba,ia,V,R));aa=!0}Q=H.x+(X-M)/2;H=H.y+(W-M)/2;M=n.multiply;V-=Q;R-=H;V=n.translate(Y,n.identity(Y),[V,R]);M.call(n,S,S,V);!aa&&(X>E||W>I)&&(V=X/E>W/I,E=(V?E:I)/(V?X:W),n.multiply(S,S,u(Y,E,E,Q,H)));T&&(E=n.multiply,I=T%360*Math.PI/180,n.rotate(Y,n.identity(Y),I),T=Math.cos(I),I=Math.sin(I),X=Y[4],W=Y[5],Y[4]=X*T-W*I+H*I-Q*T+Q,Y[5]=W*T+X*I-Q*I-H*T+H,E.call(n,S,S,Y));U&&(T=n.multiply,E=U[0],U=U[1],U=n.translate(Y,n.identity(Y),[E,U]),T.call(n,S,S,U));
return`matrix(${S[0]},${S[1]},${S[2]},${S[3]},${S[4]},${S[5]})`}function x(H,E,I){H=H?.effects.find(U=>"bloom"===U.type);if(!H)return null;const {strength:M,radius:Q}=H;H=0<M?Q:0;const T=(M+H)*E,S=4*M+1;return g.tsx("filter",{id:`bloom${I}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},g.tsx("feMorphology",{operator:"dilate",radius:(M+.5*H)*5**(E/100)*(.4+E/100),in:"SourceGraphic",result:"dilate"}),g.tsx("feGaussianBlur",{in:"dilate",stdDeviation:T/25,result:"blur"}),
g.tsx("feGaussianBlur",{in:"blur",stdDeviation:T/50,result:"intensityBlur"}),g.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},g.tsx("feFuncR",{type:"linear",slope:S}),g.tsx("feFuncG",{type:"linear",slope:S}),g.tsx("feFuncB",{type:"linear",slope:S})),g.tsx("feMerge",null,g.tsx("feMergeNode",{in:"intensityBlur"}),g.tsx("feMergeNode",{in:"intensityBrightness"}),g.tsx("feGaussianBlur",{stdDeviation:M/10})))}let v=0,D=0;p=c("android");const F=c("chrome")||p&&4<=p?"auto":"optimizeLegibility",
G={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},J=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let L={},K={};const O={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},P=Math.PI;let N=1;a.computeBBox=k;a.generateFillAttributes=e;a.generateStrokeAttributes=l;a.generateTextAttributes=A;a.getBoundingBox=C;a.getTransformMatrix=q;a.renderDef=t;a.renderSVG=
function(H,E,I,M={}){const Q=[],T=[],S=++N,U=x(M.effectView,E,S);var Y=null;U&&(Y=M.effectView?.effects.find(aa=>"bloom"===aa.type),Y=(Y.strength?Y.strength+Y.radius/2:0)/3,Y=[Math.max(E+E*Y,10),Math.max(I+I*Y,10)]);for(let aa=0;aa<H.length;aa++){var V=H[aa];const ba=[];var R=[],X=0,W=0;let ia=0;for(const ma of V){const {shape:ha,fill:ka,stroke:Z,font:ca,offset:fa}=ma;M.ignoreStrokeWidth||(X+=Z&&Z.width||0);V=e(ka);const ea=l(Z),da="text"===ha.type?A(ha,ca):null;Q.push(t(V));ba.push(f(ha,V.fill,ea,
da));R.push(C(ha));fa&&(W+=fa[0],ia+=fa[1])}R=r.unwrapOrThrow(k(R));X=q(R,E,I,X,M.scale??!1,M.rotation,M.useRotationSize??!1,[W,ia],Y);W=null;M.masking&&(W=`mask-${aa}`,Q.push(w(M.masking[aa],W)),W=`url(#${W})`);T.push(W?g.tsx("g",{mask:W},g.tsx("g",{transform:X},ba)):g.tsx("g",{transform:X},ba))}M.useRotationSize&&M.rotation&&(E=h(M.rotation,E),I=h(M.rotation,I));U&&(r.assertIsSome(Y),E=Y[0],I=Y[1]);return g.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:E,height:I,style:"display: block;"},
U,g.tsx("defs",null,Q),U?g.tsx("g",{filter:`url(#bloom${S})`},T):T)};a.renderShape=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const h=new Float32Array(6);h[0]=1;h[3]=1;return h}function c(h){const d=new Float32Array(6);d[0]=h[0];d[1]=h[1];d[2]=h[2];d[3]=h[3];d[4]=h[4];d[5]=h[5];return d}function r(h,d,f,e,l,A){const t=new Float32Array(6);t[0]=h;t[1]=d;t[2]=f;t[3]=e;t[4]=
l;t[5]=A;return t}function m(h,d){return new Float32Array(h,d,6)}function n(h,d,f,e){const l=d[e];d=d[e+1];h[e]=f[0]*l+f[2]*d+f[4];h[e+1]=f[1]*l+f[3]*d+f[5]}function p(h,d,f,e=0,l=0,A=2){for(l=l||d.length/A;e<l;e++)n(h,d,f,e*A)}const g=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,transform:n,transformMany:p},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.mat2df32=g;a.transform=n;a.transformMany=p})},"esri/chunks/mat2d":function(){define(["exports",
"./common"],function(a,b){function c(x,v){x[0]=v[0];x[1]=v[1];x[2]=v[2];x[3]=v[3];x[4]=v[4];x[5]=v[5];return x}function r(x){x[0]=1;x[1]=0;x[2]=0;x[3]=1;x[4]=0;x[5]=0;return x}function m(x,v,D,F,G,J,L){x[0]=v;x[1]=D;x[2]=F;x[3]=G;x[4]=J;x[5]=L;return x}function n(x,v){const D=v[0],F=v[1],G=v[2],J=v[3],L=v[4];v=v[5];let K=D*J-F*G;if(!K)return null;K=1/K;x[0]=J*K;x[1]=-F*K;x[2]=-G*K;x[3]=D*K;x[4]=(G*v-J*L)*K;x[5]=(F*L-D*v)*K;return x}function p(x){return x[0]*x[3]-x[1]*x[2]}function g(x,v,D){const F=
v[0],G=v[1],J=v[2],L=v[3],K=v[4];v=v[5];const O=D[0],P=D[1],N=D[2],H=D[3],E=D[4];D=D[5];x[0]=F*O+J*P;x[1]=G*O+L*P;x[2]=F*N+J*H;x[3]=G*N+L*H;x[4]=F*E+J*D+K;x[5]=G*E+L*D+v;return x}function h(x,v,D){const F=v[0],G=v[1],J=v[2],L=v[3],K=v[4];v=v[5];const O=Math.sin(D);D=Math.cos(D);x[0]=F*D+J*O;x[1]=G*D+L*O;x[2]=F*-O+J*D;x[3]=G*-O+L*D;x[4]=K;x[5]=v;return x}function d(x,v,D){const F=v[1],G=v[2],J=v[3],L=v[4],K=v[5],O=D[0];D=D[1];x[0]=v[0]*O;x[1]=F*O;x[2]=G*D;x[3]=J*D;x[4]=L;x[5]=K;return x}function f(x,
v,D){const F=v[0],G=v[1],J=v[2],L=v[3],K=v[4];v=v[5];const O=D[0];D=D[1];x[0]=F;x[1]=G;x[2]=J;x[3]=L;x[4]=F*O+J*D+K;x[5]=G*O+L*D+v;return x}function e(x,v){const D=Math.sin(v);v=Math.cos(v);x[0]=v;x[1]=D;x[2]=-D;x[3]=v;x[4]=0;x[5]=0;return x}function l(x,v){x[0]=v[0];x[1]=0;x[2]=0;x[3]=v[1];x[4]=0;x[5]=0;return x}function A(x,v){x[0]=1;x[1]=0;x[2]=0;x[3]=1;x[4]=v[0];x[5]=v[1];return x}function t(x){return"mat2d("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+")"}function w(x){return Math.sqrt(x[0]**
2+x[1]**2+x[2]**2+x[3]**2+x[4]**2+x[5]**2+1)}function u(x,v,D){x[0]=v[0]+D[0];x[1]=v[1]+D[1];x[2]=v[2]+D[2];x[3]=v[3]+D[3];x[4]=v[4]+D[4];x[5]=v[5]+D[5];return x}function z(x,v,D){x[0]=v[0]-D[0];x[1]=v[1]-D[1];x[2]=v[2]-D[2];x[3]=v[3]-D[3];x[4]=v[4]-D[4];x[5]=v[5]-D[5];return x}function y(x,v,D){x[0]=v[0]*D;x[1]=v[1]*D;x[2]=v[2]*D;x[3]=v[3]*D;x[4]=v[4]*D;x[5]=v[5]*D;return x}function B(x,v,D,F){x[0]=v[0]+D[0]*F;x[1]=v[1]+D[1]*F;x[2]=v[2]+D[2]*F;x[3]=v[3]+D[3]*F;x[4]=v[4]+D[4]*F;x[5]=v[5]+D[5]*F;return x}
function C(x,v){return x[0]===v[0]&&x[1]===v[1]&&x[2]===v[2]&&x[3]===v[3]&&x[4]===v[4]&&x[5]===v[5]}function k(x,v){const D=x[0],F=x[1],G=x[2],J=x[3],L=x[4];x=x[5];const K=v[0],O=v[1],P=v[2],N=v[3],H=v[4];v=v[5];const E=b.getEpsilon();return Math.abs(D-K)<=E*Math.max(1,Math.abs(D),Math.abs(K))&&Math.abs(F-O)<=E*Math.max(1,Math.abs(F),Math.abs(O))&&Math.abs(G-P)<=E*Math.max(1,Math.abs(G),Math.abs(P))&&Math.abs(J-N)<=E*Math.max(1,Math.abs(J),Math.abs(N))&&Math.abs(L-H)<=E*Math.max(1,Math.abs(L),Math.abs(H))&&
Math.abs(x-v)<=E*Math.max(1,Math.abs(x),Math.abs(v))}const q=Object.freeze(Object.defineProperty({__proto__:null,copy:c,identity:r,set:m,invert:n,determinant:p,multiply:g,rotate:h,scale:d,translate:f,fromRotation:e,fromScaling:l,fromTranslation:A,str:t,frob:w,add:u,subtract:z,multiplyScalar:y,multiplyScalarAndAdd:B,exactEquals:C,equals:k,mul:g,sub:z},Symbol.toStringTag,{value:"Module"}));a.add=u;a.copy=c;a.determinant=p;a.equals=k;a.exactEquals=C;a.frob=w;a.fromRotation=e;a.fromScaling=l;a.fromTranslation=
A;a.identity=r;a.invert=n;a.mat2d=q;a.mul=g;a.multiply=g;a.multiplyScalar=y;a.multiplyScalarAndAdd=B;a.rotate=h;a.scale=d;a.set=m;a.str=t;a.sub=z;a.subtract=z;a.translate=f})},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){c=c.effectiveScaleRange;return{minScale:c?.minScale??0,maxScale:c?.maxScale??0}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,
r){return 0<c||0<r};a.occludeesSupported=function(c){return c&&"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,r,m){return b.isNone(c)||c>m&&(0===r||c<r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),r=new b({id:"remove-selected-feature",
title:"{messages.remove}",className:"esri-icon-trash"}),m=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});b=new b({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,r,b,m];a.browseClusteredFeatures=b;a.removeSelectedFeature=r;a.zoomToClusteredFeatures=m;a.zoomToFeature=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/promiseUtils ./actions".split(" "),
function(a,b,c,r,m,n){function p(z){const {selectedFeature:y,location:B,view:C}=z;return C?"3d"===C.type?y||B:z.get("selectedFeature.geometry")||B:null}function g(z){return z?.isAggregate&&"cluster"===z?.sourceLayer?.featureReduction?.type}function h(z,y){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(z,y){if("3d"!==y?.type||!z||"esri.Graphic"!==z.declaredClass)return!0;if((y=y.getViewForGraphic(z))&&"whenGraphicBounds"in y){let B;try{B=yield y.whenGraphicBounds(z,{useViewElevation:!0})}catch(C){}return!B||
!B.boundingBox||B.boundingBox[0]===B.boundingBox[3]&&B.boundingBox[1]===B.boundingBox[4]&&B.boundingBox[2]===B.boundingBox[5]}return!0});return d.apply(this,arguments)}function f(z){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(z){const {location:y,selectedFeature:B,view:C,zoomFactor:k}=z,q=p(z);if(!q)throw z=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:q,view:C}),u.error(z),z;const x=C.scale/k,v=z.get("selectedFeature.geometry")||
y,D=v&&"point"===v.type&&(yield h(B,C));n.zoomToFeature.active=!0;n.zoomToFeature.disabled=!0;try{yield z.zoomTo({target:{target:q,scale:D?x:void 0}})}catch(F){const G=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:B});u.error(G)}finally{n.zoomToFeature.active=!1,n.zoomToFeature.disabled=!1,z.zoomToLocation=null,D&&(z.location=v)}});return e.apply(this,arguments)}function l(z){return A.apply(this,arguments)}function A(){A=b._asyncToGenerator(function*(z){const {selectedFeature:y,
view:B}=z;if("2d"!==B?.type)throw z=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:B}),u.error(z),z;if(!g(y))throw z=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:y}),u.error(z),z;var C=yield B.whenLayerView(y.sourceLayer);const k=C.createQuery();k.aggregateIds=[y.getObjectId()];n.zoomToClusteredFeatures.active=!0;n.zoomToClusteredFeatures.disabled=!0;({extent:C}=yield C.queryExtent(k));yield z.zoomTo({target:C});
n.zoomToClusteredFeatures.active=!1;n.zoomToClusteredFeatures.disabled=!1});return A.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(z){const {selectedFeature:y,view:B}=z;var C=yield B.whenLayerView(y.sourceLayer);const k=C.createQuery();k.aggregateIds=[y.getObjectId()];({extent:C}=yield C.queryExtent(k));z.selectedClusterBoundaryFeature.geometry=C;B.graphics.add(z.selectedClusterBoundaryFeature)});return t.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(z){const {selectedFeature:y,
view:B}=z;z=yield B.whenLayerView(y.sourceLayer);const C=z.createQuery();C.aggregateIds=[y.getObjectId()];n.browseClusteredFeatures.active=!0;n.browseClusteredFeatures.disabled=!0;({features:z}=yield z.queryFeatures(C));n.browseClusteredFeatures.active=!1;n.browseClusteredFeatures.disabled=!1;B.popup.open({features:[y].concat(z),featureMenuOpen:!0})});return w.apply(this,arguments)}const u=r.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(z){return w.apply(this,arguments)};
a.displayClusterExtent=function(z){return t.apply(this,arguments)};a.getSelectedTarget=p;a.isClusterFeature=g;a.removeClusteredFeaturesForBrowsing=function(z){const y=z.features.filter(B=>g(B));y.length&&(z.features=y)};a.triggerAction=z=>{const {event:y,view:B}=z;({action:z}=y);var C=B&&B.popup;if(!z)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));if(!C)return Promise.reject(new c("trigger-action:missing-arguments","view.popup is missing"));const {disabled:k,
id:q}=z;if(!q)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(k)return Promise.reject(new c("trigger-action:invalid-action","Action is disabled"));if(q===n.zoomToFeature.id)return f(C.viewModel).catch(m.throwIfNotAbortError);if(q===n.zoomToClusteredFeatures.id)return l(C.viewModel);if(q===n.browseClusteredFeatures.id)return C.featureMenuOpen=!C.featureMenuOpen,C.viewModel.browseClusterEnabled=!C.viewModel.browseClusterEnabled,Promise.resolve();C.viewModel.browseClusterEnabled=
!1;if(q===n.removeSelectedFeature.id){C.close();({selectedFeature:z}=C);if(!z)return Promise.reject(new c(`trigger-action:${n.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:z}));({sourceLayer:C}=z);C?C.remove(z):B.graphics.remove(z)}return Promise.resolve()};a.zoomToClusterExtent=l;a.zoomToLocation=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p){a.GoToMixin=g=>{g=function(h){function d(...f){f=h.call(this,...f)||this;f.goToOverride=null;f.view=null;return f}b._inheritsLoose(d,h);d.prototype.callGoTo=function(f){const {view:e}=this;return this.goToOverride?this.goToOverride(e,f):e.goTo(f.target,f.options)};return d}(g);c.__decorate([r.property()],g.prototype,"goToOverride",void 0);c.__decorate([r.property()],g.prototype,"view",void 0);return g=c.__decorate([p.subclass("esri.widgets.support.GoTo")],g)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){c=function(e){function l(t){t=e.call(this,
t)||this;t._handles=new m;t.view=null;t.layerViews=new r;return t}a._inheritsLoose(l,e);var A=l.prototype;A.initialize=function(){this._handles.add(n.when(()=>this.view?.map?.ground,t=>t.load()));this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};A.destroy=function(){this._set("view",null);this._handles&&(this._handles.destroy(),this._handles=null)};A._layerViewsAfterChangesHandler=function(){this._handles.remove("updating");this._handles.add(this.layerViews.map(t=>
n.watch(()=>t.updating,()=>this._updateUpdating(),n.sync)).toArray(),"updating");this._updateUpdating()};A._updateUpdating=function(){this.notifyChange("updating")};a._createClass(l,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new f({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(t=>t.updating)}},{key:"suspended",get:function(){return!this.view||
this.view.suspended}}]);return l}(c);b.__decorate([p.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([p.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([p.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([p.property({type:r,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([d.subclass("esri.views.GroundView")],c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){c=function(t){function w(z){z=t.call(this,z)||this;z.demResolution={min:-1,max:-1};z.noDataValue=A.ELEVATION_NODATA_VALUE;return z}a._inheritsLoose(w,t);var u=w.prototype;u.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};u.elevationAt=function(z,y){if(m.isNone(this.extent)||!e.extentContainsXYZ(this.extent,z,y)){const B=m.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:
null;r.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${z}, ${y}) is outside of the sampler extent (${B})`);return this.noDataValue}return m.unwrapOr(this.view.elevationProvider.getElevation(z,y,0,this.spatialReference,"ground"),this.noDataValue)};u.queryElevation=function(z){return l.updateGeometryElevation(z.clone(),this)};a._createClass(w,[{key:"extent",get:function(){const z=this.view.basemapTerrain;if(m.isNone(z.extent)||m.isNone(z.spatialReference))return null;
const y=f.toExtent(z.extent,z.spatialReference);y.zmin=z.visibleElevationBounds.min;y.zmax=z.visibleElevationBounds.max;return y}},{key:"spatialReference",get:function(){return m.unwrapOr(this.view.basemapTerrain.spatialReference,d.WGS84)}}]);return w}(c.EventedAccessor);b.__decorate([n.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([n.property()],
c.prototype,"spatialReference",null);b.__decorate([n.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([h.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(u,z){const y=e(u,z.spatialReference);if(!y)return null;switch(u.type){case "point":u.z=z.elevationAt(y.x,y.y);break;case "polyline":t.spatialReference=y.spatialReference;var B=u.hasM&&!u.hasZ;for(var C=0;C<u.paths.length;C++){var k=u.paths[C],q=y.paths[C];for(let x=0;x<k.length;x++){const v=k[x],D=q[x];t.x=D[0];t.y=D[1];B&&(v[3]=v[2]);v[2]=z.elevationAt(t.x,t.y)}}u.hasZ=!0;break;case "multipoint":t.spatialReference=y.spatialReference;B=u.hasM&&!u.hasZ;for(C=
0;C<u.points.length;C++)k=u.points[C],q=y.points[C],t.x=q[0],t.y=q[1],B&&(k[3]=k[2]),k[2]=z.elevationAt(t.x,t.y);u.hasZ=!0}return u}function e(u,z){if(n.isNone(u))return null;const y=u.spatialReference;if(y.equals(z))return u;(u=h.project(u,z))||l.error(`Cannot project geometry spatial reference (wkid:${y.wkid}) to elevation sampler spatial reference (wkid:${z.wkid})`);return u}const l=m.getLogger("esri.layers.support.ElevationSampler");c=function(){function u(){}var z=u.prototype;z.queryElevation=
function(y){return f(y.clone(),this)};z.on=function(){return w};z.projectIfRequired=function(y,B){return e(y,B)};return u}();let A=function(u){function z(B,C,k){var q=u.call(this)||this;q.tile=B;q.noDataValue=k;k=B.tile.extent;q.extent=g.toExtent(k,C.spatialReference);q.extent.zmin=B.zmin;q.extent.zmax=B.zmax;q._aaExtent=k;k=p.getMetersPerUnitForSR(C.spatialReference);B=C.lodAt(B.tile.level).resolution*k;q.demResolution={min:B,max:B};return q}b._inheritsLoose(z,u);var y=z.prototype;y.contains=function(B){B=
this.projectIfRequired(B,this.spatialReference);return n.isNone(B)?!1:this.containsAt(B.x,B.y)};y.containsAt=function(B,C){return g.containsXY(this._aaExtent,B,C)};y.elevationAt=function(B,C){if(!this.containsAt(B,C)){const k=this.extent;l.warn("#elevationAt()",`Point used to sample elevation (${B}, ${C}) is outside of the sampler extent (${`${k.xmin}, ${k.ymin}, ${k.xmax}, ${k.ymax}`})`);return this.noDataValue}return n.unwrapOr(this.tile.sample(B,C),this.noDataValue)};b._createClass(z,[{key:"spatialReference",
get:function(){return this.extent.spatialReference}}]);return z}(c);r=function(u){function z(y,B,C){var k=u.call(this)||this;let q;"number"===typeof B?(k.noDataValue=B,q=null):(q=B,k.noDataValue=C);k.samplers=q?y.map(x=>new A(x,q,k.noDataValue)):y;if(y=k.samplers[0]){k.extent=y.extent.clone();const {min:x,max:v}=y.demResolution;k.demResolution={min:x,max:v};for(y=1;y<k.samplers.length;y++)B=k.samplers[y],k.extent.union(B.extent),k.demResolution.min=Math.min(k.demResolution.min,B.demResolution.min),
k.demResolution.max=Math.max(k.demResolution.max,B.demResolution.max)}else k.extent=g.toExtent(g.create(),q.spatialReference),k.demResolution={min:0,max:0};return k}b._inheritsLoose(z,u);z.prototype.elevationAt=function(y,B){for(const C of this.samplers)if(C.containsAt(y,B))return C.elevationAt(y,B);l.warn("#elevationAt()",`Point used to sample elevation (${y}, ${B}) is outside of the sampler`);return this.noDataValue};b._createClass(z,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);
return z}(c);const t=new d,w={remove(){}};a.ElevationSamplerBase=c;a.MultiTileElevationSampler=r;a.TileElevationSampler=A;a.updateGeometryElevation=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,r){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const m=c.create();r.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,
0,0,m);c=c.create([-180,-90,180,90]);let n=4;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=m;a.getElevationDesiredResolutionLevel=
p=>4>p?3:n;a.test={setElevationDesiredMaxUpscalingDistance(p){n=p}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}let t=function(){function u(y){var B=u.checkUnsupported(y);if(m.isSome(B))throw B;y=m.unwrap(y);this.spatialReference=y.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=g.canProjectToWGS84ComparableLonLat(this.spatialReference)||f.isMars(this.spatialReference)||f.isMoon(this.spatialReference);this.origin=[y.origin.x,y.origin.y];
this.pixelSize=y.size[0];this.dpi=y.dpi;var C=y.lods.reduce((x,v,D)=>{v.level<x.min&&(x.min=v.level,x.minIndex=D);x.max=Math.max(x.max,v.level);return x},{min:Infinity,minIndex:0,max:-Infinity}),k=y.lods[C.minIndex];const q=2**k.level;B=k.resolution*q;k=k.scale*q;this.levels=Array(C.max+1);for(C=0;C<this.levels.length;C++)this.levels[C]={resolution:B,scale:k,tileSize:[B*y.size[0],B*y.size[1]]},B/=2,k/=2}var z=u.prototype;z.clone=function(){return new u(this.toTileInfo())};z.toTileInfo=function(){return new l({dpi:this.dpi,
origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((y,B)=>({level:B,scale:y.scale,resolution:y.resolution}))})};z.getExtent=function(y,B,C,k){var q=this.levels[y];y=q.tileSize[0];q=q.tileSize[1];k[0]=this.origin[0]+C*y;k[2]=this.origin[0]+(C+1)*y;k[3]=this.origin[1]-B*q;k[1]=this.origin[1]-(B+1)*q};z.convertExtentToRadians=function(y,B){this._isWebMercator?(B[0]=e.x2lon(y[0]),
B[1]=e.y2lat(y[1]),B[2]=e.x2lon(y[2]),B[3]=e.y2lat(y[3])):this._isGCS&&(B[0]=r.deg2rad(y[0]),B[1]=r.deg2rad(y[1]),B[2]=r.deg2rad(y[2]),B[3]=r.deg2rad(y[3]))};z.getExtentGeometry=function(y,B,C,k=new p){this.getExtent(y,B,C,w);k.spatialReference=this.spatialReference;k.xmin=w[0];k.ymin=w[1];k.xmax=w[2];k.ymax=w[3];k.zmin=void 0;k.zmax=void 0;return k};z.ensureMaxLod=function(y){if(null==y)return!1;for(var B=!1;this.levels.length<=y;){B=this.levels[this.levels.length-1];const C=B.resolution/2;this.levels.push({resolution:C,
scale:B.scale/2,tileSize:[C*this.pixelSize,C*this.pixelSize]});B=!0}return B};z.capMaxLod=function(y){this.levels.length>y+1&&(this.levels.length=y+1)};z.getMaxLod=function(){return this.levels.length-1};z.scaleAtLevel=function(y){return this.levels[0].scale/2**y};z.levelAtScale=function(y){const B=this.levels[0].scale;return y>=B?0:Math.log(B/y)*Math.LOG2E};z.resolutionAtLevel=function(y){return this.levels[0].resolution/2**y};z.compatibleWith=function(y){if(!(y instanceof u)){if(u.checkUnsupported(y))return!1;
y=new u(y)}if(!y.spatialReference.equals(this.spatialReference)||y.pixelSize!==this.pixelSize)return!1;const B=Math.min(this.levels.length,y.levels.length)-1,C=this.levels[B].resolution;let k=.5*C;if(!r.floatEqualAbsolute(y.origin[0],this.origin[0],k)||!r.floatEqualAbsolute(y.origin[1],this.origin[1],k))return!1;k=.5*C/2**B/this.pixelSize*12;return r.floatEqualAbsolute(C,y.levels[B].resolution,k)};z.rootTilesInExtent=function(y,B=null,C=Infinity){const k=[],q=this.levels[0].tileSize;if(m.isNone(y)||
0===q[0]||0===q[1])return k;u.computeRowColExtent(y,q,this.origin,w);y=w[1];let x=w[3],v=w[0],D=w[2];var F=D-v;const G=x-y;F*G>C&&(C=Math.floor(Math.sqrt(C)),G>C&&(y=y+Math.floor(.5*G)-Math.floor(.5*C),x=y+C),F>C&&(v=v+Math.floor(.5*F)-Math.floor(.5*C),D=v+C));for(C=y;C<x;C++)for(F=v;F<D;F++)k.push([0,C,F]);m.isSome(B)&&(B[0]=this.origin[0]+v*q[0],B[1]=this.origin[1]-x*q[1],B[2]=this.origin[0]+D*q[0],B[3]=this.origin[1]-y*q[1]);return k};u.computeRowColExtent=function(y,B,C,k){const q=.001*(y[2]-
y[0]+(y[3]-y[1]));k[0]=Math.max(0,Math.floor((y[0]+q-C[0])/B[0]));k[2]=Math.max(0,Math.ceil((y[2]-q-C[0])/B[0]));k[1]=Math.max(0,Math.floor((C[1]-y[3]+q)/B[1]));k[3]=Math.max(0,Math.ceil((C[1]-y[1]-q)/B[1]))};u.isPowerOfTwo=function(y){y=y.lods;const B=y[0].resolution*2**y[0].level;return!y.some(C=>!r.floatEqualRelative(C.resolution,B/2**C.level))};u.hasGapInLevels=function(y){y=y.lods.map(B=>B.level);y.sort((B,C)=>B-C);for(let B=1;B<y.length;B++)if(y[B]!==y[0]+B)return!0;return!1};u.tileSizeSupported=
function(y){const B=y.size[1];return B===y.size[0]&&0===(B&B-1)&&128<=B&&512>=B};u.hasOriginPerLODs=function(y){const B=y.origin;return y.lods.some(C=>null!=C.origin&&(C.origin[0]!==B.x||C.origin[1]!==B.y))};u.getMissingTileInfoError=function(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};u.checkUnsupported=function(y){return m.isNone(y)?A():1>y.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):u.isPowerOfTwo(y)?
u.hasGapInLevels(y)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):u.tileSizeSupported(y)?u.hasOriginPerLODs(y)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")};u.fromExtent=function(y,B){const C=y[2]-y[0],k=y[3]-y[1],q=n.getMetersPerUnitForSR(B),
x=1.2*Math.max(C,k);y=new u(new l({size:[256,256],origin:{x:y[0]-.5*(x-C),y:y[3]+.5*(x-k)},lods:[{level:0,resolution:x/256,scale:1/(256/96*.0254/(x*q))}],spatialReference:B}));y.ensureMaxLod(20);return y};u.makeWebMercatorAuxiliarySphere=function(y){const B=new u(u.WebMercatorAuxiliarySphereTileInfo);B.ensureMaxLod(y);return B};u.makeGCSWithTileSize=function(y,B=256,C=16){const k=256/B;y=new u(new l({size:[B,B],origin:{x:-180,y:90,spatialReference:y},spatialReference:y,lods:[{level:0,resolution:.703125*
k,scale:2.95497598570834E8*k}]}));y.ensureMaxLod(C);return y};b._createClass(u,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return u}();t.WebMercatorAuxiliarySphereTileInfo=new l({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:h.WebMercator},spatialReference:h.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});t.WebMercatorAuxiliarySphere=t.makeWebMercatorAuxiliarySphere(19);const w=
d.create();a.TilingScheme=t;a.getMissingTileInfoError=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){var B;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});r=B=function(C){function k(x){x=C.call(this,x)||this;x.dpi=96;x.format=null;x.origin=null;x.minScale=0;x.maxScale=0;x.size=null;x.spatialReference=null;return x}a._inheritsLoose(k,C);k.create=function(x=
{}){const {resolutionFactor:v=1,scales:D,size:F=256,spatialReference:G=A.WebMercator,numLODs:J=24}=x;if(!w.isValid(G)){x=[];if(D)for(var L=0;L<D.length;L++){var K=D[L];x.push({level:L,scale:K,resolution:K})}else for(L=5E-4,K=J-1;0<=K;K--)x.unshift({level:K,scale:L,resolution:L}),L*=2;return new B({dpi:96,lods:x,origin:new l(0,0,G),size:[F,F],spatialReference:G})}L=w.getInfo(G);x=x.origin?new l({x:x.origin.x,y:x.origin.y,spatialReference:G}):L?new l({x:L.origin[0],y:L.origin[1],spatialReference:G}):
new l({x:0,y:0,spatialReference:G});L=1/(39.37*n.getMetersPerUnitForSR(G)*96);K=[];if(D)for(var O=0;O<D.length;O++){var P=D[O];K.push({level:O,scale:P,resolution:P*L})}else{var N=w.isGeographic(G)?512/F*5.916575275917094E8:256/F*5.91657527591555E8;O=Math.ceil(J/v);K.push({level:0,scale:N,resolution:N*L});for(P=1;P<O;P++)N/=2**v,K.push({level:P,scale:N,resolution:N*L})}return new B({dpi:96,lods:K,origin:x,size:[F,F],spatialReference:G})};var q=k.prototype;q.readOrigin=function(x,v){return l.fromJSON({spatialReference:v.spatialReference,
...x})};q.readSize=function(x,v){return[v.cols,v.rows]};q.writeSize=function(x,v){v.cols=x[0];v.rows=x[1]};q.zoomToScale=function(x){const v=this.scales;if(0>=x)return v[0];if(x>=v.length-1)return v[v.length-1];const D=Math.floor(x);return v[D]/(v[D]/v[D+1])**(x-D)};q.scaleToZoom=function(x){const v=this.scales,D=v.length-1;let F=0;for(;F<D;F++){const G=v[F],J=v[F+1];if(G<=x)break;if(J===x)return F+1;if(G>x&&J<x)return F+Math.log(G/x)/Math.log(G/J)}return F};q.snapScale=function(x,v=.95){x=this.scaleToZoom(x);
return x%Math.floor(x)>=v?this.zoomToScale(Math.ceil(x)):this.zoomToScale(Math.floor(x))};q.tileAt=function(x,v,D,F){var G=this.lodAt(x);if(!G)return null;let J;if("number"===typeof v)J=v,v=D;else{if(w.equals(v.spatialReference,this.spatialReference))J=v.x,v=v.y;else{F=u.project(v,this.spatialReference);if(m.isNone(F))return null;J=F.x;v=F.y}F=D}D=G.resolution*this.size[0];G=G.resolution*this.size[1];F||(F=new y.TileKey(null,0,0,0,t.create()));F.level=x;F.row=Math.floor((this.origin.y-v)/G+.001);
F.col=Math.floor((J-this.origin.x)/D+.001);this.updateTileInfo(F);return F};q.updateTileInfo=function(x,v=B.ExtrapolateOptions.NONE){var D=this.lodAt(x.level);D||v!==B.ExtrapolateOptions.POWER_OF_TWO||(v=this.lods[this.lods.length-1],v.level<x.level&&(D=v));if(D){var F=x.level-D.level;v=D.resolution*this.size[0]/2**F;D=D.resolution*this.size[1]/2**F;x.id=`${x.level}/${x.row}/${x.col}`;x.extent||(x.extent=t.create());x.extent[0]=this.origin.x+x.col*v;x.extent[1]=this.origin.y-(x.row+1)*D;x.extent[2]=
x.extent[0]+v;x.extent[3]=x.extent[1]+D}};q.upsampleTile=function(x){const v=this._upsampleLevels[x.level];if(!v||-1===v.parentLevel)return!1;x.level=v.parentLevel;x.row=Math.floor(x.row/v.factor+.001);x.col=Math.floor(x.col/v.factor+.001);this.updateTileInfo(x);return!0};q.getTileBounds=function(x,v){var D=this.lodAt(v.level);if(null==D)return null;var {resolution:F}=D;D=F*this.size[0];F*=this.size[1];x[0]=this.origin.x+v.col*D;x[1]=this.origin.y-(v.row+1)*F;x[2]=x[0]+D;x[3]=x[1]+F;return x};q.lodAt=
function(x){return this._levelToLOD?.[x]??null};q.clone=function(){return B.fromJSON(this.write({}))};q.getOrCreateCompatible=function(x,v){if(256===this.size[0]&&256===this.size[1])return 256===x?this:null;const D=[],F=this.lods.length;for(let G=0;G<F;G++){const J=this.lods[G];D.push(new z({level:J.level,scale:J.scale,resolution:J.resolution*v}))}return new B({size:[x,x],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,
lods:D})};q._initializeUpsampleLevels=function(){const x=this.lods;this._upsampleLevels=[];let v=null;for(let D=0;D<x.length;D++){const F=x[D];this._upsampleLevels[F.level]={parentLevel:v?v.level:-1,factor:v?v.resolution/F.resolution:0};v=F}};a._createClass(k,[{key:"isWrappable",get:function(){const {spatialReference:x,origin:v}=this;if(x&&v){const D=w.getInfo(x);return x.isWrappable&&!!D&&Math.abs(D.origin[0]-v.x)<=D.dx}return!1}},{key:"lods",set:function(x){let v=0,D=0;const F=[],G=this._levelToLOD=
{};x&&(v=-Infinity,D=Infinity,x.forEach(J=>{F.push(J.scale);v=J.scale>v?J.scale:v;D=J.scale<D?J.scale:D;G[J.level]=J}));this._set("scales",F);this._set("minScale",v);this._set("maxScale",D);this._set("lods",x);this._initializeUpsampleLevels()}}]);return k}(r.JSONSupport);b.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"compressionQuality",void 0);b.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"dpi",void 0);b.__decorate([p.property({type:String,json:{read:c.read,
write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],r.prototype,"format",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"isWrappable",null);b.__decorate([p.property({type:l,json:{write:!0}})],r.prototype,"origin",void 0);b.__decorate([d.reader("origin")],r.prototype,"readOrigin",null);b.__decorate([p.property({type:[z],value:null,json:{write:!0}})],r.prototype,"lods",null);b.__decorate([p.property({readOnly:!0})],r.prototype,"minScale",void 0);b.__decorate([p.property({readOnly:!0})],
r.prototype,"maxScale",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"scales",void 0);b.__decorate([p.property({cast:C=>Array.isArray(C)?C:"number"===typeof C?[C,C]:[256,256]})],r.prototype,"size",void 0);b.__decorate([d.reader("size",["rows","cols"])],r.prototype,"readSize",null);b.__decorate([e.writer("size",{cols:{type:h.Integer},rows:{type:h.Integer}})],r.prototype,"writeSize",null);b.__decorate([p.property({type:A,json:{write:!0}})],r.prototype,"spatialReference",void 0);r=B=b.__decorate([f.subclass("esri.layers.support.TileInfo")],
r);(function(C){C=C.ExtrapolateOptions||(C.ExtrapolateOptions={});C[C.NONE=0]="NONE";C[C.POWER_OF_TWO=1]="POWER_OF_TWO"})(r||(r={}));return r})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p){var g;c=g=function(h){function d(f){f=
h.call(this,f)||this;f.cols=null;f.level=0;f.levelValue=null;f.origin=null;f.resolution=0;f.rows=null;f.scale=0;return f}a._inheritsLoose(d,h);d.prototype.clone=function(){return new g({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return d}(c.JSONSupport);b.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);b.__decorate([r.property({type:n.Integer,
json:{write:!0}})],c.prototype,"level",void 0);b.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);b.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);b.__decorate([r.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);b.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,
"rows",void 0);b.__decorate([r.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=g=b.__decorate([p.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){a.TileKey=function(b,c,r,m,n){this.id=b;this.level=c;this.row=r;this.col=m;this.extent=n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/Error ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.PopupView=e=>{e=function(l){function A(){return l.apply(this,arguments)||this}b._inheritsLoose(A,l);var t=A.prototype;t.fetchPopupFeatures=function(){var w=b._asyncToGenerator(function*(u,z){yield this.when();const {location:y,queryArea:B,layerViewsAndGraphics:C,clientOnlyGraphics:k}=yield this._prepareFetchPopupFeatures(u,z);u=Promise.resolve(k);z=this._queryLayerPopupFeatures(B,C,z);const q=z.map(x=>x.promise);u=m.eachAlwaysValues([u,...q]).then(x=>Array.from(new Set(x.flat())));
return{location:y,clientOnlyGraphics:k,allGraphicsPromise:u,promisesPerLayerView:z}});return function(u,z){return w.apply(this,arguments)}}();t._queryLayerPopupFeatures=function(w,u,z){return u.map(({layerView:y,graphics:B})=>{B={clientGraphics:B,event:r.isSome(z)?z.event:null,signal:r.isSome(z)?z.signal:null,defaultPopupTemplateEnabled:r.isSome(z)?!!z.defaultPopupTemplateEnabled:!1};B=y.fetchPopupFeatures(w,B);return{layerView:y,promise:B}})};t._isValidPopupGraphic=function(w,u){return w&&!!w.getEffectivePopupTemplate(r.isSome(u)&&
u.defaultPopupTemplateEnabled)};t._prepareFetchPopupFeatures=function(){var w=b._asyncToGenerator(function*(u,z){const {clientGraphics:y,queryArea:B,location:C}=yield this._popupHitTestGraphics(u,z);u=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:k,clientOnlyGraphics:q}=this._graphicsPerFetchPopupLayerView(y,u);return{clientOnlyGraphics:q,layerViewsAndGraphics:k,queryArea:B,location:C}});return function(u,z){return w.apply(this,arguments)}}();t._popupHitTestGraphics=function(){var w=
b._asyncToGenerator(function*(u,z){const {results:y,mapPoint:B}=yield this.popupHitTest(u);u=y.filter(k=>"graphic"===k.type&&this._isValidPopupGraphic(k.graphic,z));const C=u.length?u[0].mapPoint:null;return{clientGraphics:u.map(k=>k.graphic),queryArea:B,location:B||C}});return function(u,z){return w.apply(this,arguments)}}();t._getFetchPopupLayerViews=function(){const w=[];this.allLayerViews.forEach(u=>{this._isValidPopupLayerView(u)&&w.push(u)});r.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&
w.push(this.graphicsView);return w.reverse()};t._isValidPopupLayerView=function(w){return r.isSome(w)&&(!("layer"in w)||!w.suspended)&&"fetchPopupFeatures"in w};t._graphicsPerFetchPopupLayerView=function(w,u){const z=[],y=new Map;u=u.map(B=>{const C=[];"layer"in B?y.set(B.layer,C):y.set(B.graphics,C);return{layerView:B,graphics:C}});for(const B of w)(w=y.get(B.layer)||y.get(B.sourceLayer)||null)?w.push(B):z.push(B);return{layerViewsAndGraphics:u,clientOnlyGraphics:z}};return A}(e);return e=c.__decorate([f.subclass("esri.views.PopupView")],
e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,r){const m=h=>Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"})),n=()=>new Promise((h,d)=>a(["./layers/TileLayerView3D"],f=>h(m(f)),d)),p=()=>new Promise((h,d)=>a(["./layers/ElevationLayerView3D"],f=>h(m(f)),d)),g={"base-dynamic":()=>
new Promise((h,d)=>a(["./layers/BaseDynamicLayerView3D"],f=>h(m(f)),d)),"base-elevation":p,"base-tile":n,"bing-maps":n,"building-scene":()=>new Promise((h,d)=>a(["./layers/BuildingSceneLayerView3D"],f=>h(m(f)),d)),csv:()=>new Promise((h,d)=>a(["./layers/CSVLayerView3D"],f=>h(m(f)),d)),dimension:()=>new Promise((h,d)=>a(["./layers/DimensionLayerView3D"],f=>h(m(f)),d)),elevation:p,feature:()=>new Promise((h,d)=>a(["./layers/FeatureLayerView3D"],f=>h(m(f)),d)),geojson:()=>new Promise((h,d)=>a(["./layers/GeoJSONLayerView3D"],
f=>h(m(f)),d)),graphics:()=>new Promise((h,d)=>a(["./layers/GraphicsLayerView3D"],f=>h(m(f)),d)),group:()=>new Promise((h,d)=>a(["../layers/GroupLayerView"],f=>h(m(f)),d)),imagery:()=>new Promise((h,d)=>a(["./layers/ImageryLayerView3D"],f=>h(m(f)),d)),"integrated-mesh":()=>new Promise((h,d)=>a(["./layers/IntegratedMeshLayerView3D"],f=>h(m(f)),d)),"line-of-sight":()=>new Promise((h,d)=>a(["./layers/LineOfSightLayerView3D"],f=>h(m(f)),d)),"map-image":()=>new Promise((h,d)=>a(["./layers/MapImageLayerView3D"],
f=>h(m(f)),d)),media:()=>new Promise((h,d)=>a(["./layers/MediaLayerView3D"],f=>h(m(f)),d)),"ogc-feature":()=>new Promise((h,d)=>a(["./layers/OGCFeatureLayerView3D"],f=>h(m(f)),d)),"open-street-map":n,"oriented-imagery":()=>new Promise((h,d)=>a(["./layers/FeatureLayerView3D"],f=>h(m(f)),d)),"point-cloud":()=>new Promise((h,d)=>a(["./layers/PointCloudLayerView3D"],f=>h(m(f)),d)),voxel:()=>new Promise((h,d)=>a(["./layers/VoxelLayerView3D"],f=>h(m(f)),d)),route:()=>new Promise((h,d)=>a(["./layers/RouteLayerView3D"],
f=>h(m(f)),d)),scene:h=>null==h.profile||"mesh-pyramids"===h.profile?new Promise((d,f)=>a(["./layers/SceneLayerView3D"],e=>d(m(e)),f)):new Promise((d,f)=>a(["./layers/SceneLayerGraphicsView3D"],e=>d(m(e)),f)),stream:()=>new Promise((h,d)=>a(["./layers/StreamLayerView3D"],f=>h(m(f)),d)),tile:n,"imagery-tile":()=>new Promise((h,d)=>a(["./layers/ImageryTileLayerView3D"],f=>h(m(f)),d)),"vector-tile":()=>new Promise((h,d)=>a(["./layers/VectorTileLayerView3D"],f=>h(m(f)),d)),wcs:()=>new Promise((h,d)=>
a(["./layers/ImageryTileLayerView3D"],f=>h(m(f)),d)),"web-tile":n,wfs:()=>new Promise((h,d)=>a(["./layers/WFSLayerView3D"],f=>h(m(f)),d)),wms:()=>new Promise((h,d)=>a(["./layers/WMSLayerView3D"],f=>h(m(f)),d)),wmts:()=>new Promise((h,d)=>a(["./layers/WMTSLayerView3D"],f=>h(m(f)),d)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:h=>r.isSome(g[h.type]),importLayerView:h=>{var d=g[h.type];if(r.isNone(d))throw h=
h.declaredClass?h.declaredClass.slice(h.declaredClass.lastIndexOf(".")+1):"Unknown",d=h.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new c(`${d}:view-not-supported`,`${h} is not supported in 3D`);return d(h)}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(){const z=d.createResolver();z.promise.catch(()=>{});return z}const t=z=>Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));var w;(function(z){z[z.PENDING=0]="PENDING";z[z.CREATED=1]="CREATED"})(w||(w={}));var u;(function(z){z[z.ADDED=0]="ADDED";z[z.REMOVED=1]="REMOVED"})(u||(u={}));p=function(z){function y(C){C=z.call(this,C)||this;C._allAnalysisViews=new m;C._creatingViewCount=0;C._items=new Map;C._scheduledUpdateHandle=
null;C._attachedToViewResolver=A();C._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return C}b._inheritsLoose(y,z);var B=y.prototype;B.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(d.createAbortError("AnalysisViewManager was destroyed"))};B.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};B.detach=function(){this._disconnectOwners();
this._attachedToViewResolver.reject(d.createAbortError());this._attachedToViewResolver=A()};B.whenAnalysisView=function(){var C=b._asyncToGenerator(function*(k){yield this._attachedToViewResolver.promise;const q=this._items.get(k);if(h.isNone(q)||q.state.list===u.REMOVED)throw new n("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:k});return q.createAnalysisViewTask.promise});return function(k){return C.apply(this,arguments)}}();B._connectOwners=
function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),"analyses-owner-handles")};B._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};B._connectAnalysesCollection=function(C){for(const x of C)this._addAnalysis(x);const k=C.on("after-add",x=>this._addAnalysis(x.item)),q=C.on("after-remove",x=>this._removeAnalysis(x.item));return{remove:()=>{k.remove();q.remove();for(const x of C)this._removeAnalysis(x)}}};B._addAnalysis=
function(C){const k=this._items.get(C);if(null==k){const q={state:{view:w.PENDING,list:u.ADDED},analysis:C,view:null,createAnalysisViewTask:null};this._items.set(C,q);q.createAnalysisViewTask=r.createTask(x=>this._createAnalysisViewPromise(q,x))}else k.state.list=u.ADDED};B._removeAnalysis=function(C){C=this._items.get(C);null==C?g.getLogger(this.declaredClass).error("Trying to remove analysis which was not added"):(C.state.list=u.REMOVED,this._scheduleUpdate())};B._scheduleUpdate=function(){h.isSome(this._scheduledUpdateHandle)||
(this._scheduledUpdateHandle=f.schedule(()=>this._update()))};B._update=function(){this._scheduledUpdateHandle=h.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(C=>{if(C.state.list===u.REMOVED)switch(this._items.delete(C.analysis),C.state.view){case w.PENDING:C.createAnalysisViewTask=h.abortMaybe(C.createAnalysisViewTask);break;case w.CREATED:h.isSome(C.view)&&(this._allAnalysisViews.remove(C.view),C.view=h.destroyMaybe(C.view),C.createAnalysisViewTask=null)}})};B._createAnalysisViewPromise=
function(){var C=b._asyncToGenerator(function*(k,q){var x=k.analysis;const v=x.type,D=this._analysisModules[v];this._creatingViewCount+=1;if(h.isNone(D.module))try{D.module=yield this._loadAnalysisModule(v)}catch(F){throw--this._creatingViewCount,F;}if(d.isAborted(q))throw--this._creatingViewCount,d.createAbortError("AnalysisView creation aborted");x=new D.module.default({analysis:x,view:this.view});try{yield x.when()}catch(F){throw--this._creatingViewCount,F;}if(d.isAborted(q))throw--this._creatingViewCount,
x.destroy(),d.createAbortError("AnalysisView creation aborted");k.view=x;k.state.view=w.CREATED;this._allAnalysisViews.add(x);--this._creatingViewCount;return x});return function(k,q){return C.apply(this,arguments)}}();B._loadAnalysisModule=function(C){switch(C){case "area-measurement":return new Promise((k,q)=>a(["./AreaMeasurementAnalysisView3D"],x=>k(t(x)),q));case "dimension":return new Promise((k,q)=>a(["./DimensionAnalysisView3D"],x=>k(t(x)),q));case "direct-line-measurement":return new Promise((k,
q)=>a(["./DirectLineMeasurementAnalysisView3D"],x=>k(t(x)),q));case "line-of-sight":return new Promise((k,q)=>a(["./LineOfSightAnalysisView3D"],x=>k(t(x)),q));case "slice":return new Promise((k,q)=>a(["./SliceAnalysisView3D"],x=>k(t(x)),q))}};b._createClass(y,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(C=>C.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return y}(p.HandleOwner);c.__decorate([e.property()],
p.prototype,"updating",null);c.__decorate([e.property({constructOnly:!0})],p.prototype,"view",void 0);c.__decorate([e.property()],p.prototype,"_allAnalysisViews",void 0);c.__decorate([e.property()],p.prototype,"_creatingViewCount",void 0);return p=c.__decorate([l.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],p)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.Constraints=function(e){function l(){var A=e.apply(this,arguments)||this;A.tilt=new f.TiltConstraint;A.altitude=new h.AltitudeConstraint;A.clipDistance=new d.ClipDistanceConstraint;return A}b._inheritsLoose(l,e);return l}(r);c.__decorate([m.property({type:f.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);c.__decorate([m.property({type:h.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);c.__decorate([m.property({type:d.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=c.__decorate([g.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,r,m,n,p,g,h){a.AltitudeConstraint=function(d){function f(){var e=d.apply(this,arguments)||this;e.min=h.earthAltitudeConstraint.min;e.max=h.earthAltitudeConstraint.max;return e}b._inheritsLoose(f,d);return f}(r);c.__decorate([m.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([m.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.Constraints=function(u){function z(B){B=u.call(this,B)||this;B.collision=new w;B.distance=Infinity;B.minimumPoiDistance=4;B.tilt=null;return B}b._inheritsLoose(z,u);var y=z.prototype;y.clampAltitude=function(B){return this.altitude?n.clamp(B,this.altitude.min,this.altitude.max):B};y.clampTilt=function(B,C){if(!this.tilt)return C;B=this.tilt(B);return n.clamp(C,B.min,B.max)};y.clampDistance=function(B){return Math.min(B,this.distance)};y.createDefaultTilt=function(){return this.mode===
e.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};y.createConstantMaxTilt=function(B){return(C,k=t)=>{k.min=A.min;k.max=B;return k}};y._createDefaultTiltLocal=function(){const B=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,A.max],[1E4,n.deg2rad(88)],[6E6,n.deg2rad(88)]]):()=>A.max;return(C,k=t)=>{k.min=A.min;k.max=B(C);return k}};y._createDefaultTiltGlobal=function(){const B=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,A.max],[5E4,n.deg2rad(88)],
[6E6,n.deg2rad(88)],[2E7,A.min]]):l.makePiecewiseLinearFunction([[3E5,A.max],[3E6,n.deg2rad(88)],[6E6,n.deg2rad(88)],[2E7,A.min]]);return(C,k=t)=>{k.min=A.min;k.max=B(C);return k}};b._createClass(z,[{key:"altitude",get:function(){return this.mode===e.ViewingMode.Local?null:this._get("altitude")||null},set:function(B){this.mode===e.ViewingMode.Local?m.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",B)}}]);return z}(r);c.__decorate([p.property()],
a.Constraints.prototype,"altitude",null);c.__decorate([p.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([p.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([p.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([p.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([p.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([d.subclass("esri.views.3d.state.Constraints")],
a.Constraints);g={min:-2E5,max:4*f.earth.radius};const A={min:n.deg2rad(.5),max:n.deg2rad(179.5)},t={min:0,max:0};let w=function(u){function z(){var y=u.apply(this,arguments)||this;y.enabled=!0;y.elevationMargin=5;return y}b._inheritsLoose(z,u);return z}(r);c.__decorate([p.property({type:Boolean})],w.prototype,"enabled",void 0);c.__decorate([p.property({type:Number})],w.prototype,"elevationMargin",void 0);w=c.__decorate([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],w);a.TiltDefault=
A;a.earthAltitudeConstraint=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){a.ClipDistanceConstraint=
function(h){function d(){var e=h.apply(this,arguments)||this;e.mode="auto";return e}b._inheritsLoose(d,h);var f=d.prototype;f.castNear=function(e){return Math.max(1E-8,e)};f.castFar=function(e){return Math.max(1E-8,e)};f.autoUpdate=function(e,l){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==l&&this._set("far",l))};b._createClass(d,[{key:"near",get:function(){return this._get("near")},set:function(e){this._set("near",e);e>=this._get("far")&&(this.far=e+1E-9);this.mode=
"manual"}},{key:"far",get:function(){return this._get("far")},set:function(e){this._set("far",e);e<=this._get("near")&&(this.near=e-1E-9);this.mode="manual"}}]);return d}(r);c.__decorate([m.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([p.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([m.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);c.__decorate([p.cast("far")],a.ClipDistanceConstraint.prototype,
"castFar",null);c.__decorate([m.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([g.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f=m.rad2deg(d.TiltDefault.min),e=m.rad2deg(d.TiltDefault.max);a.TiltConstraint=function(l){function A(){var w=l.apply(this,arguments)||this;w.mode="auto";return w}b._inheritsLoose(A,l);var t=A.prototype;t.castMax=function(w){return m.clamp(w,f,e)};t.autoUpdate=function(w){"auto"===this.mode&&this._get("max")!==w&&this._set("max",w)};b._createClass(A,[{key:"max",get:function(){return this._get("max")},set:function(w){this._set("max",w);this.mode="manual"}}]);return A}(r);
c.__decorate([n.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([n.property({type:Number,value:e})],a.TiltConstraint.prototype,"max",null);c.__decorate([g.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([h.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){var w;l=w=function(u){function z(B){B=u.call(this,B)||this;B.atmosphere=new d.SceneViewAtmosphere;B.lighting=new f;B.cachedCameraTrackingEnabled=null;return B}a._inheritsLoose(z,u);z.fromWebsceneEnvironment=function(B){B=B.cloneConstructProperties();return new w({...B,lighting:"virtual"===B.lighting.type?e.fromWebsceneLighting(B.lighting):f.fromWebsceneLighting(B.lighting)})};var y=z.prototype;y.castLighting=function(B){return this._convertLighting(B)};y.applyLighting=
function(B){this.lighting=this._convertLighting(B)};y._convertLighting=function(B){return B?B instanceof f||B instanceof e?B:B instanceof A?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new f({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):B instanceof t?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new e({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):
g.ensureOneOfType(h.lightingTypes,B):new f};y.clone=function(){return new w({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:r.clone(this.background)})};y.cloneWithWebsceneEnvironment=function(B){return new w({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:r.clone(this.background),
...B.cloneConstructProperties(),lighting:this._getLighting(B)})};y._getLighting=function(B){switch(B.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):f.fromWebsceneLighting(B.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):e.fromWebsceneLighting(B.lighting);default:return c.neverReached(B.lighting),f.fromWebsceneLighting(B.lighting)}};return z}(l);
b.__decorate([m.property({type:d.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],l.prototype,"atmosphere",void 0);b.__decorate([m.property({nonNullable:!0})],l.prototype,"lighting",void 0);b.__decorate([n.cast("lighting")],l.prototype,"castLighting",null);return l=w=b.__decorate([p.subclass("esri.views.3d.environment.SceneViewEnvironment")],l)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,c,r,m,n,p,g,h){var d;c=d=function(e){function l(t){t=e.call(this,t)||this;t.cameraTrackingEnabled=!0;t.ambientOcclusionEnabled=!1;t.waterReflectionEnabled=!1;t.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var w=(new Date).getFullYear();w=new Date("March 15, "+w+" 12:00:00 UTC");t._set("defaultDate",w);t._set("date",w);return t}a._inheritsLoose(l,e);l.fromWebsceneLighting=function(t){return new d(t.cloneConstructProperties())};var A=l.prototype;A.autoUpdate=function(t,
w){const u=d.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=w.hours;this.positionTimezoneInfo.minutes=w.minutes;this.positionTimezoneInfo.seconds=w.seconds;w=null;r.isSome(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(w=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(w=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const z=d.calculateTimezoneOffset(this.positionTimezoneInfo);u!==z&&(f.target=this,f.timezoneOffset=
z,this.emit("timezone-will-change",f));if(r.isSome(t))return isNaN(t.getTime())?!0:w!==t.getTime()};A.clone=function(){const t=this._get("date")===this._get("defaultDate"),w=new d({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});t&&w._set("date",w._get("defaultDate"));w.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;
w.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;w.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;w.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return w};A.cloneWithWebsceneLighting=function(t){const w=this.clone();null!=t.date&&(w.date=t.date);w.directShadowsEnabled=t.directShadowsEnabled;w.displayUTCOffset=t.displayUTCOffset;return w};A.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,
cameraTrackingEnabled:this.cameraTrackingEnabled}};a._createClass(l,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(t){const w=this._get("date")===this._get("defaultDate");t=new Date(t.getTime());this._set("defaultDate",t);w&&this._set("date",t)}},{key:"date",set:function(t){null!=t&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}}]);return l}(c.EventedMixin(h));b.__decorate([m.property({type:Boolean})],c.prototype,
"cameraTrackingEnabled",void 0);b.__decorate([m.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([m.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);b.__decorate([m.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([m.property({type:Date})],c.prototype,"date",null);c=d=b.__decorate([g.subclass("esri.views.3d.environment.SunLighting")],c);(function(e){e.calculateTimezoneOffset=function({hours:l,minutes:A,seconds:t}){return Math.round(l+
A/60+t/3600)}})(c||(c={}));const f={target:null,timezoneOffset:0};return c})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,b,c,r,m,n,p,g,h){var d;c=d=function(f){function e(A){A=
f.call(this,A)||this;A.type="sun";A.date=null;A.directShadowsEnabled=!1;A.displayUTCOffset=null;return A}a._inheritsLoose(e,f);var l=e.prototype;l.readDate=function(A,t){return null!=t.datetime&&new Date(t.datetime)||null};l.writeDate=function(A,t,w){t[w]=A.getTime()};l.readDirectShadowsEnabled=function(A,t){return!!t.directShadows};l.writedirectShadowsEnabled=function(A,t,w){A&&(t[w]=A)};l.writeDisplayUTCOffset=function(A,t){null!=A&&(t.displayUTCOffset=A)};l.clone=function(){return new d(this.cloneConstructProperties())};
l.cloneConstructProperties=function(){const A={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(A.date=new Date(this.date.getTime()));return A};return e}(c.JSONSupport);b.__decorate([r.property({readOnly:!0,type:["sun"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([r.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([p.reader("date",["datetime"])],
c.prototype,"readDate",null);b.__decorate([h.writer("date")],c.prototype,"writeDate",null);b.__decorate([r.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([p.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([h.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);b.__decorate([r.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",
void 0);b.__decorate([h.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=d=b.__decorate([g.subclass("esri.webscene.SunLighting")],c)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,r,m,n,p,g){var h;c=h=function(d){function f(l){l=d.call(this,l)||this;l.ambientOcclusionEnabled=!1;l.waterReflectionEnabled=!1;l.cameraTrackingEnabled=!0;return l}a._inheritsLoose(f,d);var e=f.prototype;e.clone=function(){return new h({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})};f.fromWebsceneLighting=function(l){return new h(l.cloneConstructProperties())};
e.cloneWithWebsceneLighting=function(l){const A=this.clone();A.directShadowsEnabled=l.directShadowsEnabled;return A};e.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}};return f}(c.EventedMixin(g));b.__decorate([r.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([r.property({type:Boolean})],c.prototype,
"waterReflectionEnabled",void 0);b.__decorate([r.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);return c=h=b.__decorate([p.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,
c,r,m,n,p){var g;c=g=function(h){function d(e){e=h.call(this,e)||this;e.type="virtual";e.directShadowsEnabled=!1;return e}a._inheritsLoose(d,h);var f=d.prototype;f.clone=function(){return new g(this.cloneConstructProperties())};f.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return d}(c.JSONSupport);b.__decorate([r.property({readOnly:!0,type:["virtual"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([r.property({type:Boolean,json:{default:!1,
name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0);return c=g=b.__decorate([p.subclass("esri.webscene.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,c,r,m,n,p,g){var h;a.SceneViewAtmosphere=h=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);f.prototype.clone=function(){return new h({quality:this.quality})};b._createClass(f,[{key:"quality",set:function(e){["low","high"].includes(e)&&this._set("quality",e)}}]);return f}(r);c.__decorate([m.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=h=c.__decorate([g.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){var t;const w=m.getLogger("esri.webscene.Environment");m=(u,z,y)=>({enabled:!y||!y.isPresentation});c=t=function(u){function z(B){B=u.call(this,B)||this;B.lighting=new e;B.background=null;B.atmosphereEnabled=!0;B.starsEnabled=!0;return B}a._inheritsLoose(z,u);var y=z.prototype;y.clone=function(){return new t(this.cloneConstructProperties())};y.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?l.prototype.clone.call(this.lighting):
e.prototype.clone.call(this.lighting),background:r.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(z,[{key:"weather",set:function(B){d.validateWeatherType(B?.type,w)&&this._set("weather",B)}}]);return z}(c.JSONSupport);b.__decorate([n.property({types:f.lightingTypes,nonNullable:!0,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([n.property(A.backgroundProperty)],c.prototype,"background",void 0);
b.__decorate([n.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([n.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],c.prototype,"starsEnabled",void 0);b.__decorate([n.property({types:d.weatherTypes,nonNullable:!0,json:{write:!0},value:new h})],c.prototype,"weather",null);return c=t=b.__decorate([g.subclass("esri.webscene.Environment")],c)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){var h;c=h=function(d){function f(e){e=d.call(this,e)||this;e.type="sunny";e.cloudCover=.5;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover})};return f}(c.JSONSupport);b.__decorate([p.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=h=b.__decorate([g.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,r,m,n){b={key:"type",base:n,typeMap:{sunny:n,cloudy:b,rainy:r,snowy:m,foggy:c}};const p=Object.keys(b.typeMap);a.validateWeatherType=function(g,h){return p.includes(g)?!0:(h.error(`"${g}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=p;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){var h;c=h=function(d){function f(e){e=d.call(this,
e)||this;e.type="cloudy";e.cloudCover=.5;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover})};return f}(c.JSONSupport);b.__decorate([p.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=h=b.__decorate([g.subclass("esri.views.3d.environment.CloudyWeather")],c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){var h;c=h=function(d){function f(e){e=d.call(this,e)||this;e.type="foggy";e.fogStrength=.5;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({fogStrength:this.fogStrength})};return f}(c.JSONSupport);b.__decorate([p.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0);return c=h=b.__decorate([g.subclass("esri.views.3d.environment.FoggyWeather")],
c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){var h;c=h=function(d){function f(e){e=d.call(this,e)||this;e.type="rainy";e.cloudCover=
.5;e.precipitation=.5;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover,precipitation:this.precipitation})};return f}(c.JSONSupport);b.__decorate([p.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",
void 0);return c=h=b.__decorate([g.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,
g){var h;c=h=function(d){function f(e){e=d.call(this,e)||this;e.type="snowy";e.cloudCover=.5;e.precipitation=.5;e.snowCover="disabled";return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return f}(c.JSONSupport);b.__decorate([p.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",
void 0);b.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);b.__decorate([r.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0);return c=h=b.__decorate([g.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",
base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(r){return(m,n,p)=>{if(!m)return m;for(const g in r.typeMap)if(m.type===g)return n=new r.typeMap[g],n.read(m,p),n}}(b),write:{overridePolicy:(r,m,n)=>({enabled:!n||!n.isPresentation})}}};a.backgroundProperty=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p){c=function(g){function h(d){return g.call(this,d)||this}a._inheritsLoose(h,
g);h.prototype.clone=function(){};return h}(c.JSONSupport);b.__decorate([r.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([p.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;m={...h.colorAndTransparencyProperty,nonNullable:!0};d=f=function(e){function l(t){t=e.call(this,t)||this;t.type="color";t.color=new c([0,0,0,1]);return t}a._inheritsLoose(l,e);var A=l.prototype;A.clone=function(){return new f(this.cloneProperties())};A.cloneProperties=function(){return{color:this.color.clone()}};return l}(d);b.__decorate([p.enumeration({color:"color"},{readOnly:!0})],d.prototype,"type",void 0);b.__decorate([r.property(m)],d.prototype,"color",void 0);
return d=f=b.__decorate([g.subclass("esri.webscene.background.ColorBackground")],d)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){a.SceneViewEnvironmentManager=function(O){function P(){var H=O.call(this)||this;H._referencePointUpdateDelay=200;H._referencePointUpdateInterval=3E3;H._referencePointUpdateDistThreshold=1E6;H._referencePosUpdateQuery=null;H._referencePosMapCoordsRequested=null;H._viewHandles=new n;H._preserveAbsoluteDateTime=!1;H._trackingEnabled=!1;H._referencePosResetPreserveAbsoluteTime=!1;H._referencePosUpdateTimer=null;H._referencePosMapCoords=null;
H._mainLight=new x.MainLight;H._ambientLight=new x.AmbientLight;H._moonLight=new x.FillLight;H.disableQueries=!1;H._disableWeather=!1;H._renderer=null;H._referencePosWGS84Comparable=null;H._resetReferencePosition();return H}b._inheritsLoose(P,O);var N=P.prototype;N.destroy=function(){this.disconnectView();this._viewHandles.destroy()};N.connectView=function(H){if(!this._renderer){this._renderer=new B.EnvironmentRenderer({view:H});var E=()=>this._updateRenderParameters(),I=()=>this._cameraHandler();
this._viewHandles.add([h.watch(()=>H.environment.lighting,M=>this._updateLightingHandler(M),h.sync),h.watch(()=>"virtual"!==H.environment.lighting.type?H.environment.lighting.date:null,M=>this._lightingDateHandler(M),h.sync),h.watch(()=>H.stationary,()=>this._interactingStationaryHandler()),h.watch(()=>H.environment.lighting.directShadowsEnabled,E,h.sync),h.watch(()=>H.environment.lighting.ambientOcclusionEnabled,E,h.sync),h.watch(()=>H.environment.lighting.waterReflectionEnabled,E,h.sync),h.watch(()=>
H.environment.background?.color,E,h.sync),h.watch(()=>H.spatialReference,()=>this._resetReferencePosition(!0),h.sync),h.watch(()=>H.environment.weather.type,()=>this._updateLighting(null,q.Update.Faded),h.sync),h.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,q.Update.Faded),h.sync),h.watch(()=>H.viewingMode,()=>this._resetReferencePosition(!0),h.syncAndInitial),h.watch(()=>"virtual"!==H.environment.lighting.type?H.environment.lighting.cameraTrackingEnabled:!1,M=>this._updateCameraTracking(M),
h.syncAndInitial),h.watch(()=>H.state.camera,I,h.syncAndInitial),h.watch(()=>this.disableQueries,I)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};N.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=p.destroyMaybe(this._renderer)};N._updateLightingHandler=function(H){this._updateCameraTracking("virtual"!==H.type?H.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==H.type?
H.date:null);this._updateRenderParameters()};N._updateCameraTracking=function(H){(this._trackingEnabled=H)?this._cameraHandler():(H=this._view.environment.lighting,"virtual"!==H?.type&&(H.positionTimezoneInfo.autoUpdated=!1))};N._lightingDateHandler=function(H){const E=this._view.environment.lighting;if("virtual"===E?.type)this._updateLighting();else if(H){if(!E.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var I=
this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(I)){this._requestReferencePositionUpdate(I);return}}this._preupdateTracking(H);p.isSome(this._referencePosWGS84Comparable)&&(I=C.positionToTimezoneInfo(this._referencePosWGS84Comparable,J),p.isSome(I)&&(E.autoUpdate(null,I),this._trackingEnabled&&(E.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(H)}};N._preupdateTracking=function(H){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&
this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(H)};N._cameraHandler=function(H=null){var E=this._view;E.ready&&(E=E.stateManager.camera)&&(this._cameraHandlerClientSide(E,H)||this._cameraHandlerServerSide(E))};N._cameraHandlerClientSide=function(H,E){const I=z.isEarth(this._view.spatialReference);if(I&&!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;H=H.position;p.isNone(this._referencePosWGS84Comparable)&&
(this._referencePosWGS84Comparable=t.create());I?u.projectPointToWGS84ComparableLonLat(H,this._referencePosWGS84Comparable):A.set(this._referencePosWGS84Comparable,H.longitude,H.latitude,H.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,E)||this._updateLighting(E);return!0};N._cameraHandlerServerSide=function(H){H=H.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(H))&&
this._requestReferencePositionUpdate(H,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=H.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};N._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};N._updateLighting=function(H,E=q.Update.Immediate){var I=this._view;H=H||("virtual"===I.environment.lighting.type?null:I.environment.lighting.date);var M=this._referencePosWGS84Comparable;
const Q=p.isSome(M)?D:F;var T=this.weatherVisible?I.environment.weather.type:"disabled";p.isSome(M)?k.computeColorAndIntensity(H,M,I.state.viewingMode,T,I.state.camera,Q):"virtual"===I.environment.lighting.type&&k.computeVirtualLightDirection(I.state.camera,I.state.viewingMode,Q.direct.directionToLightSource);H=this._mainLight;I=Q.direct;A.scale(H.intensity,I.color,I.intensity*Math.PI);A.copy(H.direction,I.directionToLightSource);H.specularStrength=Q.specularStrength;H.environmentStrength=Q.environmentStrength;
M=this._ambientLight;A.scale(M.intensity,Q.ambient.color,Q.ambient.intensity);T=this._moonLight;A.lerp(T.intensity,L,K,Q.globalFactor);A.scale(T.intensity,T.intensity,(1-.5*Q.globalFactor)*(1-.4*Q.noonFactor*(1-Q.globalFactor)));A.copy(T.direction,I.directionToLightSource);this._renderer.updateLightSources([H,M,T],Q.noonFactor,Q.globalFactor,E);this._updateRenderParameters()};N._autoUpdateTimezone=function(H,E=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||
p.isNone(H))return!1;const I=G;I.setTime((E||this._view.environment.lighting.date).getTime());H=C.positionToTimezoneInfo(H,J);if(p.isNone(H))return!1;var M=this._view.environment.lighting.positionTimezoneInfo;if(!M.autoUpdated)M=H;else if(M.hours===H.hours&&M.minutes===H.minutes&&M.seconds===H.seconds)return!1;const Q=I.getUTCHours()-(H.hours-M.hours),T=I.getUTCMinutes()-(H.minutes-M.minutes);M=I.getUTCSeconds()-(H.seconds-M.seconds);I.setUTCHours(Q);I.setUTCMinutes(T);I.setUTCSeconds(M);return E?
!1:this._view.environment.lighting.autoUpdate(I,H)};N._updateRenderParameters=function(){const H=this._view._stage;if(H){var E=p.mapOr(this._referencePosWGS84Comparable,!0,M=>k.computeShadowsEnabled(M[2],this._view.state.viewingMode)),I=this._view.environment.background;I=I instanceof v?{type:"color",color:w.fromArray(r.toUnitRGBA(I.color))}:{type:"color",color:w.fromValues(0,0,0,1)};H.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&E,background:I,environment:this._view.environment,
weatherVisible:this._view.environmentManager.weatherVisible})}};N._resetReferencePosition=function(H=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");H&&this._cameraHandler()};N._requestReferencePositionUpdate=function(H,E=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(H):
this._referencePosMapCoordsRequested=H.clone(),this._referencePosResetPreserveAbsoluteTime=!!E,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const I=this._referencePosUpdateQuery=g.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===I)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==I)}).catch(Q=>{"mapcoordshelper:missing-geometry-service"===Q.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===
I&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),M=this._referencePosUpdateTimer=g.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===M&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};N._doReferencePositionUpdateQuery=function(){var H=b._asyncToGenerator(function*(E){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const I=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);E()||isNaN(I[0])||isNaN(I[1])||(E=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=I[0],this._referencePosWGS84Comparable[1]=I[1],this._referencePosWGS84Comparable[2]=E):this._referencePosWGS84Comparable=[I[0],I[1],E],this._referencePosChanged())});return function(E){return H.apply(this,arguments)}}();N._executePendingReferencePositionUpdate=function(){const H=this._referencePosMapCoordsRequested;H&&this._requestReferencePositionUpdate(H,this._referencePosResetPreserveAbsoluteTime)};N._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};N._exceedsReferencePosDistThreshold=function(H){return this._referencePosMapCoords?(H=this._referencePosMapCoords.distance(H),this._view.mapCoordsHelper&&(H*=this._view.mapCoordsHelper.unitInMeters),H>this._referencePointUpdateDistThreshold):!0};N._cancelReferencePosUpdates=function(){const H=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=
this._referencePosUpdateQuery=null;return H};b._createClass(P,[{key:"_view",get:function(){return this._renderer?.view}},{key:"updating",get:function(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}},{key:"weatherEnabled",get:function(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===y.ViewingMode.Global&&z.isEarth(this._view.spatialReference)}},{key:"weatherVisible",
get:function(){return this.weatherEnabled&&this._renderer?.weatherVisible}},{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const H=this;return{get renderer(){return H._renderer},set referencePointUpdateInterval(E){H._referencePointUpdateInterval=E},set referencePointUpdateDistThreshold(E){H._referencePointUpdateDistThreshold=E},set referencePosUpdateTimer(E){H._referencePosUpdateTimer=E},set referencePointUpdateDelay(E){H._referencePointUpdateDelay=
E},set disableWeather(E){H._disableWeather=E}}}}]);return P}(m.EventedAccessor);c.__decorate([d.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,
"weatherVisible",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([l.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new k.ColorAndIntensity,
F=new k.ColorAndIntensity,G=new Date,J={hours:0,minutes:0,seconds:0},L=t.fromValues(.22,.22,.33),K=t.fromValues(.22,.22,.22);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsCompositionParameters ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ./SimpleAtmosphere ./SimpleHaze ./Stars ./weather ./weatherUtils ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E){var I;const M=[H.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,H.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=I=function(Y){function V(X){X=Y.call(this,X)||this;X._handles=new n;X._context=null;X._atmosphere=null;X._oldWeatherParameters=new Q;X._newWeatherParameters=new Q;X._fadedWeatherParameters=new Q;X._weatherParameters=X._newWeatherParameters;return X}b._inheritsLoose(V,Y);var R=V.prototype;
R.initialize=function(){this.view._stage.addRenderPlugin(M,this)};R.destroy=function(){null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._handles=g.destroyMaybe(this._handles);this._set("view",null)};R.updateAnimation=function(X){return g.isSome(this._precipitation)?this._precipitation.update(X):!1};R.initializeRenderContext=function(X=null){this._context=X;X=()=>this._setNeedsRender();this._handles.add([h.when(()=>this.view?.basemapTerrain,()=>this._updateBasemapTerrain(),h.syncAndInitial),
h.watch(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),h.syncAndInitial),h.watch(()=>this._stars,X),h.watch(()=>this._precipitation,X),h.watch(()=>this._clouds,()=>this._updateWeather(),h.initial),h.watch(()=>this._fog,()=>this._updateFogHaze(),h.initial),h.watch(()=>this._simpleHaze,()=>this._updateFogHaze(),h.initial),h.watch(()=>this._weatherUpdateParameters,
()=>{this._updateWeather();this._updateFogHaze()},h.syncAndInitial)])};R.uninitializeRenderContext=function(){this._context=null;this._atmosphere=g.destroyMaybe(this._atmosphere);this._set("_stars",g.destroyMaybe(this._stars));this._set("_precipitation",g.destroyMaybe(this._precipitation));this._set("_clouds",g.destroyMaybe(this._clouds));this._set("_cloudsComposition",g.destroyMaybe(this._cloudsComposition));this._set("_fog",g.destroyMaybe(this._fog));this._set("_simpleHaze",g.destroyMaybe(this._simpleHaze))};
R.prepareRender=function(X){X.bindParameters.cloudsFade.data=q.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&(P.updateWeatherFading(X.bindParameters.cloudsFade,X.bindParameters.camera,this.view.state.mode,I.test.time||X.time,this.view.qualitySettings.weatherFadeDuration),this._updateWeatherFading(X.bindParameters),X.bindParameters.cloudsFade.renderingStage===q.CloudsRenderingStages.FINISHED&&g.isSome(this._clouds)&&0===this._clouds.coverage&&!1===this._clouds.running&&
this._clouds.destroyFrameBufferCube())};R.render=function(X){if(X.output===N.ShaderOutput.Color)switch(X.bindParameters.slot){case H.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:g.isSome(this._stars)&&this._stars.render(X);g.isSome(this._atmosphere)&&(this._atmosphere.render(X),g.isSome(this._cloudsComposition)&&g.isSome(X.bindParameters.cloudsFade.data)&&(this.weatherVisible&&g.isSome(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(X)),P.weatherfadingNeedsRender(X.bindParameters.cloudsFade)&&
g.isSome(this._context)&&this._context.requestRender());break;case H.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(g.isSome(this._atmosphere)&&(this._atmosphere.renderHaze(X,this._weatherParameters.haze.amount),0<this._weatherParameters.haze.amount&&this._selectAtmosphereType()!==y.AtmosphereType.Realistic&&g.isSome(this._simpleHaze)&&this._simpleHaze.render(X,this._weatherParameters.haze),0<this._weatherParameters.fog.amount&&g.isSome(this._fog)&&this._fog.render(X,this._weatherParameters.fog),
g.isSome(this._precipitation))){const W=this.view.environment.weather;"rainy"!==W.type&&"snowy"!==W.type||this._precipitation.render(X,W.precipitation,W.type)}}};R.updateLightSources=function(X,W,aa,ba){if(g.isSome(this._context)){const ia=this._context.renderContext;ia.bindParameters.oldLighting.copyFrom(ia.bindParameters.lighting);ia.bindParameters.newLighting.noonFactor=W;ia.bindParameters.newLighting.globalFactor=aa;ia.bindParameters.newLighting.set(X);ba===E.Update.Faded||ia.bindParameters.weatherFading?
ia.bindParameters.fadeLighting(0):ia.bindParameters.fadeLighting(1);this._context.requestRender()}};R._updateWeatherFading=function(X){if(X.weatherFading){var W=X.cloudsFade;W.fadeIn.stage===k.FadeInStages.FADE_IN?(X.fadeLighting(W.fadeIn.factor),this._fadeWeather(W.fadeIn.factor)):W.fadeInOut.stage===k.FadeInOutStages.FADE_IN?(X.fadeLighting(W.fadeInOut.factor),this._fadeWeather(W.fadeInOut.factor)):W.crossFade.enabled?(X.fadeLighting(W.crossFade.factor),this._fadeWeather(W.crossFade.factor)):(X.fadeLighting(0),
this._fadeWeather(0))}};R._fadeWeather=function(X){const {_newWeatherParameters:W,_oldWeatherParameters:aa}=this;1<=X?this._weatherParameters=W:(this._fadedWeatherParameters.lerp(aa,W,X),this._weatherParameters=this._fadedWeatherParameters)};R._updateWeather=function(){const X=this._weatherUpdateParameters;g.isNone(X)||g.isNone(this._clouds)||(this._clouds.applyPreset(v.cloudPresets[X.type],X.weatherAdjustment),this._setNeedsRender())};R._setNeedsRender=function(){g.isSome(this._context)&&this._context.requestRender()};
R._updateFogHaze=function(){const X=this._weatherUpdateParameters;if(!(g.isNone(this._fog)||g.isNone(this._simpleHaze)||g.isNone(X)||g.isNone(this._context))){var W=this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(X.type){case "foggy":this._newWeatherParameters.fog.strength=p.lerp(3E-5,.005,X.weatherAdjustment**3);t.copy(this._newWeatherParameters.fog.color,S);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=
0;this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===y.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=p.lerp(4E-6,2E-4,X.effect**3);t.copy(this._newWeatherParameters.fog.color,T);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=p.lerp(4E-6,2E-4,X.effect**3);t.copy(this._newWeatherParameters.fog.color,
S);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===y.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4E-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}W.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}};R._updateAtmosphere=function(){var X=
this._selectAtmosphereType();this.atmosphereType!==X&&((X=this._getAtmosphereClass(),X)?g.isSome(this._context)&&(g.destroyMaybe(this._atmosphere),this._atmosphere=new X(this.view),this._atmosphere.initializeRenderContext(this._context),this._setNeedsRender(),this._updateBasemapTerrain()):(g.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()))};R._getAtmosphereClass=function(){switch(this._selectAtmosphereType()){case y.AtmosphereType.None:return null;
case y.AtmosphereType.Realistic:return B.ChapmanAtmosphere;case y.AtmosphereType.Panoramic:return F.PanoramicAtmosphere;case y.AtmosphereType.Simple:return J}};R._selectAtmosphereType=function(){const X=this.view.get("environment.atmosphereEnabled"),W=this.view.get("environment.atmosphere.quality"),aa=this.view.viewingMode;return!X||null==W||z.isMoon(this.view.spatialReference)?y.AtmosphereType.None:"local"===aa?y.AtmosphereType.Panoramic:"high"===W&&g.isSome(this._context)&&B.ChapmanAtmosphere.isSupported(this._context)&&
z.isEarth(this.view.spatialReference)?y.AtmosphereType.Realistic:y.AtmosphereType.Simple};R._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=g.isSome(this._atmosphere)&&this.atmosphereType===y.AtmosphereType.Simple)};b._createClass(V,[{key:"atmosphereType",get:function(){return g.isSome(this._atmosphere)?this._atmosphere.type:y.AtmosphereType.None}},{key:"canRender",get:function(){return!!this.view.basemapTerrain?.renderer.canRender||"global"!==
this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return g.isSome(this._atmosphere)&&this._atmosphere.type===y.AtmosphereType.Realistic}},{key:"updating",get:function(){return g.isSome(this._stars)&&this._stars.updating||g.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return t.length(this.view.state.camera.eye)-u.getReferenceEllipsoid(this.view.spatialReference).radius<=O.weatherHeightLimit}},{key:"_stars",get:function(){const X=this.view,W=X.environment?.starsEnabled??
!1,aa=this._get("_stars");return!W||g.isNone(this._context)?(g.destroyMaybe(aa),null):g.isSome(aa)?aa:new K.Stars({view:X,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const X=this._get("_precipitation");if(!this._precipitationEnabled||g.isNone(this._context))return g.destroyMaybe(X),null;const W=this.view,aa=this._context;if(g.isSome(X)&&X.context===aa)return X;g.destroyMaybe(X);return new G.Precipitation({context:aa,view:W})}},{key:"_clouds",get:function(){const X=
this._get("_clouds");if(!this.weatherEnabled||g.isNone(this._context))return g.destroyMaybe(X),null;if(g.isSome(X))return X;const W=this.view,aa=this._context;g.destroyMaybe(X);return new x.CloudsGenerator({context:aa,view:W,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",get:function(){const X=this._get("_cloudsComposition");if(!this.weatherEnabled||g.isNone(this._context))return g.destroyMaybe(X),null;const W=this.view.state.viewingMode,aa=this._context.renderContext.rctx,
ba=u.getReferenceEllipsoid(this.view.spatialReference).radius;if(g.isSome(X)&&X.viewingMode===W&&X.planetRadius===ba)return X;g.destroyMaybe(X);return new C.CloudsComposition({rctx:aa,viewingMode:W,planetRadius:ba,requestRender:()=>this._setNeedsRender()})}},{key:"_fog",get:function(){const X=this._get("_fog");return!this.weatherEnabled||g.isNone(this._context)?(g.destroyMaybe(X),null):g.isSome(X)?X:new D.Fog({context:this._context,view:this.view})}},{key:"_simpleHaze",get:function(){const X=this._get("_simpleHaze");
return!this.weatherEnabled||g.isNone(this._context)?(g.destroyMaybe(X),null):g.isSome(X)?X:new L.SimpleHaze({context:this._context,view:this.view})}},{key:"weatherEnabled",get:function(){return!!this.view?.environmentManager?.weatherEnabled}},{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",get:function(){const X=this.weatherEnabled?this.view.environment.weather:
null;return g.isNone(X)?null:"rainy"===X.type||"snowy"===X.type?{type:X.type,weatherAdjustment:X.cloudCover,effect:X.precipitation}:{type:X.type,weatherAdjustment:"foggy"===X.type?X.fogStrength:X.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:X=>{U=I.prototype._getAtmosphereClass;I.prototype._getAtmosphereClass=X},restoreGetAtmosphereClass:()=>{I.prototype._getAtmosphereClass=
U}}}}]);return V}(r);a.EnvironmentRenderer.test={time:d.Milliseconds(0)};c.__decorate([f.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([f.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,
"_stars",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_simpleHaze",null);c.__decorate([f.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=I=c.__decorate([A.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let Q=function(){function Y(){this.fog=new D.FogParameters;this.haze=new L.HazeParameters}var V=Y.prototype;V.copyFrom=
function(R){this.fog.amount=R.fog.amount;this.haze.amount=R.haze.amount;this.fog.strength=R.fog.strength;this.haze.strength=R.haze.strength;t.copy(this.fog.color,R.fog.color)};V.lerp=function(R,X,W){this.fog.amount=p.lerp(R.fog.amount,X.fog.amount,W);this.haze.amount=p.lerp(R.haze.amount,X.haze.amount,W);this.fog.strength=p.lerp(R.fog.strength,X.fog.strength,W);this.haze.strength=p.lerp(R.haze.strength,X.haze.strength,W);t.lerp(this.fog.color,R.fog.color,X.fog.color,W)};return Y}();const T=w.fromValues(.5,
.5,.5),S=w.fromValues(1.5,1.5,1.5);let U;a.WeatherParameters=Q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Simple=0]="Simple";b[b.Realistic=1]="Realistic";b[b.Panoramic=2]="Panoramic";b[b.None=3]="None";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec4 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),function(a,b,c,r,m,n,p,
g,h,d,f,e,l,A,t,w){let u=function(){function z(B){this._view=B;this.type=d.AtmosphereType.Realistic;this._passParameters=new e.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=h.earth.radius;this._fadeHaze=0;this._updateRadius(h.earth.radius)}var y=z.prototype;y.destroy=function(){this._atmosphereTechnique=r.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=r.releaseMaybe(this._atmosphereHazeTechnique);this._vao=r.disposeMaybe(this._vao);
this._handles=r.destroyMaybe(this._handles)};y.initializeRenderContext=function(B){const C=B.renderContext.rctx;var k=this._handles=new b;this._updateRootTileElevationBounds();k.add(m.watch(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()));k.add(m.watch(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds()));k=new l.ChapmanAtmosphereTechniqueConfiguration;k.haze=!1;this._atmosphereTechnique=B.shaderTechniqueRepository.acquire(e.ChapmanAtmosphereTechnique,
k);k.haze=!0;this._atmosphereHazeTechnique=B.shaderTechniqueRepository.acquire(e.ChapmanAtmosphereTechnique,k);this._vao=t.createQuadVAO(C,A.Pos2Tex)};y.render=function(B){this._render(B,this._atmosphereTechnique,B.offscreenRenderingHelper.depthTexture)};y.renderHaze=function(B,C){this._fadeHaze=C;this._render(B,this._atmosphereHazeTechnique,B.offscreenRenderingHelper.linearDepthTexture)};y._render=function(B,C,k){if(!r.isNone(k)){this._update(B.bindParameters.camera);this._passParameters.depthTex=
k;var q=B.rctx.bindTechnique(C,this._passParameters,B.bindParameters);B.offscreenRenderingHelper.renderDepthDetached(()=>{this._renderCommon(q,B)})}};y._renderCommon=function(B,C){r.isNone(this._vao)||(C.rctx.bindVAO(this._vao),B.assertCompatibleVertexAttributeLocations(this._vao),C.rctx.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,4))};y._adjustRadiusForTesselation=function(B){return B*Math.cos(Math.PI/16/16)};y._updateRootTileElevationBounds=function(){const B=this._view.basemapTerrain.rootTileElevationBounds.min;
B!==this._rootTileElevationMin&&(this._rootTileElevationMin=B,this._lowerBoundEarthRadius=h.earth.radius,this._updateVisibleElevationBounds())};y._updateVisibleElevationBounds=function(){const B=this._adjustRadiusForTesselation(h.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);B<this._lowerBoundEarthRadius&&this._updateRadius(B)};y._updateRadius=function(B){this._lowerBoundEarthRadius=B;n.set(this._passParameters.radii,B,B+f.atmosphereHeight);this._passParameters.innerFadeDistance=
2*Math.sqrt((2*B-f.innerAtmosphereDepth)*f.innerAtmosphereDepth)};y._update=function(B){if(!r.isNone(B)){B=p.length(B.eye);var C=B*B;g.set(this._passParameters.heightParameters,B,C,C-this._passParameters.radii[1]*this._passParameters.radii[1],Math.min(1,Math.max(0,(B-this._passParameters.radii[0])/f.atmosphereHeight)));this._passParameters.altitudeFade=f.computeInnerAltitudeFade(B-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=c.lerp(c.lerp(.6,1,c.smoothstep(9500,10500,B-h.earth.radius)),
1,this._fadeHaze)}};z.isSupported=function(B){return B.renderContext.rctx.capabilities.depthTexture};return z}();a.ChapmanAtmosphere=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function c(M,Q){M[0]=Q[0];M[1]=Q[1];return M}function r(M,Q,T){M[0]=Q;M[1]=T;return M}function m(M,Q,T){M[0]=Q[0]+T[0];M[1]=Q[1]+T[1];return M}function n(M,Q,T){M[0]=Q[0]-T[0];M[1]=Q[1]-T[1];return M}
function p(M,Q,T){M[0]=Q[0]*T[0];M[1]=Q[1]*T[1];return M}function g(M,Q,T){M[0]=Q[0]/T[0];M[1]=Q[1]/T[1];return M}function h(M,Q){M[0]=Math.ceil(Q[0]);M[1]=Math.ceil(Q[1]);return M}function d(M,Q){M[0]=Math.floor(Q[0]);M[1]=Math.floor(Q[1]);return M}function f(M,Q,T){M[0]=Math.min(Q[0],T[0]);M[1]=Math.min(Q[1],T[1]);return M}function e(M,Q,T){M[0]=Math.max(Q[0],T[0]);M[1]=Math.max(Q[1],T[1]);return M}function l(M,Q){M[0]=Math.round(Q[0]);M[1]=Math.round(Q[1]);return M}function A(M,Q,T){M[0]=Q[0]*
T;M[1]=Q[1]*T;return M}function t(M,Q,T,S){M[0]=Q[0]+T[0]*S;M[1]=Q[1]+T[1]*S;return M}function w(M,Q){const T=Q[0]-M[0];M=Q[1]-M[1];return Math.sqrt(T*T+M*M)}function u(M,Q){const T=Q[0]-M[0];M=Q[1]-M[1];return T*T+M*M}function z(M){const Q=M[0];M=M[1];return Math.sqrt(Q*Q+M*M)}function y(M){const Q=M[0];M=M[1];return Q*Q+M*M}function B(M,Q){M[0]=-Q[0];M[1]=-Q[1];return M}function C(M,Q){M[0]=1/Q[0];M[1]=1/Q[1];return M}function k(M,Q){var T=Q[0];const S=Q[1];T=T*T+S*S;0<T&&(T=1/Math.sqrt(T),M[0]=
Q[0]*T,M[1]=Q[1]*T);return M}function q(M,Q){return M[0]*Q[0]+M[1]*Q[1]}function x(M,Q,T){Q=Q[0]*T[1]-Q[1]*T[0];M[0]=M[1]=0;M[2]=Q;return M}function v(M,Q,T,S){const U=Q[0];Q=Q[1];M[0]=U+S*(T[0]-U);M[1]=Q+S*(T[1]-Q);return M}function D(M,Q){Q=Q||1;const T=2*b.RANDOM()*Math.PI;M[0]=Math.cos(T)*Q;M[1]=Math.sin(T)*Q;return M}function F(M,Q,T){const S=Q[0];Q=Q[1];M[0]=T[0]*S+T[2]*Q;M[1]=T[1]*S+T[3]*Q;return M}function G(M,Q,T){const S=Q[0];Q=Q[1];M[0]=T[0]*S+T[2]*Q+T[4];M[1]=T[1]*S+T[3]*Q+T[5];return M}
function J(M,Q,T){const S=Q[0];Q=Q[1];M[0]=T[0]*S+T[3]*Q+T[6];M[1]=T[1]*S+T[4]*Q+T[7];return M}function L(M,Q,T){const S=Q[0];Q=Q[1];M[0]=T[0]*S+T[4]*Q+T[12];M[1]=T[1]*S+T[5]*Q+T[13];return M}function K(M,Q,T,S){const U=Q[0]-T[0];Q=Q[1]-T[1];const Y=Math.sin(S);S=Math.cos(S);M[0]=U*S-Q*Y+T[0];M[1]=U*Y+Q*S+T[1];return M}function O(M,Q){var T=M[0];M=M[1];const S=Q[0];Q=Q[1];let U=T*T+M*M;0<U&&(U=1/Math.sqrt(U));let Y=S*S+Q*Q;0<Y&&(Y=1/Math.sqrt(Y));T=(T*S+M*Q)*U*Y;return 1<T?0:-1>T?Math.PI:Math.acos(T)}
function P(M){return"vec2("+M[0]+", "+M[1]+")"}function N(M,Q){return M[0]===Q[0]&&M[1]===Q[1]}function H(M,Q){const T=M[0];M=M[1];const S=Q[0];Q=Q[1];const U=b.getEpsilon();return Math.abs(T-S)<=U*Math.max(1,Math.abs(T),Math.abs(S))&&Math.abs(M-Q)<=U*Math.max(1,Math.abs(M),Math.abs(Q))}function E(M,Q,T,S,U){let Y=Q[0]-T[0];T=Q[1]-T[1];U=(S[0]*Y+S[1]*T)*(U-1);Y=S[0]*U;T=S[1]*U;M[0]=Q[0]+Y;M[1]=Q[1]+T;return M}const I=Object.freeze(Object.defineProperty({__proto__:null,copy:c,set:r,add:m,subtract:n,
multiply:p,divide:g,ceil:h,floor:d,min:f,max:e,round:l,scale:A,scaleAndAdd:t,distance:w,squaredDistance:u,length:z,squaredLength:y,negate:B,inverse:C,normalize:k,dot:q,cross:x,lerp:v,random:D,transformMat2:F,transformMat2d:G,transformMat3:J,transformMat4:L,rotate:K,angle:O,str:P,exactEquals:N,equals:H,projectAndScale:E,len:z,sub:n,mul:p,div:g,dist:w,sqrDist:u,sqrLen:y},Symbol.toStringTag,{value:"Module"}));a.add=m;a.angle=O;a.ceil=h;a.copy=c;a.cross=x;a.dist=w;a.distance=w;a.div=g;a.divide=g;a.dot=
q;a.equals=H;a.exactEquals=N;a.floor=d;a.inverse=C;a.len=z;a.length=z;a.lerp=v;a.max=e;a.min=f;a.mul=p;a.multiply=p;a.negate=B;a.normalize=k;a.projectAndScale=E;a.random=D;a.rotate=K;a.round=l;a.scale=A;a.scaleAndAdd=t;a.set=r;a.sqrDist=u;a.sqrLen=y;a.squaredDistance=u;a.squaredLength=y;a.str=P;a.sub=n;a.subtract=n;a.transformMat2=F;a.transformMat2d=G;a.transformMat3=J;a.transformMat4=L;a.vec2=I})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports"],function(a){a.atmosphereHeight=
1E5;a.computeInnerAltitudeFade=function(b){return Math.min(1,Math.max(0,(b-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){p=function(A){function t(){var w=A.apply(this,arguments)||this;w.heightParameters=m.create();w.radii=r.create();w.innerFadeDistance=0;w.altitudeFade=0;w.hazeStrength=1;return w}c._inheritsLoose(t,A);return t}(p.NoParameters);h=function(A){function t(){return A.apply(this,arguments)||this}c._inheritsLoose(t,A);var w=t.prototype;w.initializeProgram=function(u){return new f.Program(u.rctx,t.shader.get().build(this.configuration),d.Default3D)};w.initializePipeline=
function(){return this.configuration.haze?l.makePipelineState({blending:l.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:l.defaultColorWriteParams}):l.makePipelineState({blending:l.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})};return t}(h.ShaderTechnique);
h.shader=new g.ReloadableShaderModule(n.ChapmanAtmosphere,()=>new Promise((A,t)=>a(["./ChapmanAtmosphere.glsl"],A,t)));b.ChapmanAtmospherePassParameters=p;b.ChapmanAtmosphereTechnique=h;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){function y(x){const v=new w.ShaderBuilder;v.attributes.add(z.VertexAttribute.POSITION,"vec2");v.include(n.TextureCoordinateAttribute,{textureCoordinateType:n.TextureCoordinateAttributeType.Default});v.varyings.add("worldRay","vec3");v.varyings.add("eyeDir","vec3");const {vertex:D,fragment:F}=v;D.uniforms.add([new t.Matrix4PassUniform("inverseProjectionMatrix",(G,J)=>J.camera.inverseProjectionMatrix),new t.Matrix4PassUniform("inverseViewMatrix",(G,J)=>
b.invert(q,J.camera.viewMatrix))]);D.code.add(A.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);F.uniforms.add([new d.Float2PassUniform("radii",G=>G.radii),new f.Float3PassUniform("cameraPosition",(G,J)=>J.camera.eye),new e.Float4PassUniform("heightParameters",G=>G.heightParameters),new l.FloatPassUniform("innerFadeDistance",G=>G.innerFadeDistance),new l.FloatPassUniform("altitudeFade",G=>G.altitudeFade),new u.Texture2DPassUniform("depthTex",G=>G.depthTex),new l.FloatPassUniform("hazeStrength",G=>G.hazeStrength)]);F.constants.add("betaRayleigh","vec3",B);F.constants.add("betaCombined","vec3",
k);F.constants.add("betaMie","float",3.996E-6);F.constants.add("scaleHeight","float",m.rayLeighScaleHeight*m.atmosphereHeight);h.addMainLightDirection(F);v.include(g.Gamma);x.haze&&(F.include(p.ReadLinearDepth),F.uniforms.add(new d.Float2PassUniform("nearFar",(G,J)=>J.camera.nearFar)));F.code.add(A.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);F.code.add(A.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);F.code.add(A.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);F.code.add(A.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${x.haze?A.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${x.haze?A.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${x.haze?"":A.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${x.haze?A.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:A.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${x.haze?A.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:A.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${x.haze?A.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:A.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${x.haze?"":A.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `);return v}const B=r.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),C=r.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),k=r.fromValues(parseFloat(Number(B[0]+C[0]).toFixed(6)),parseFloat(Number(B[1]+C[1]).toFixed(6)),parseFloat(Number(B[2]+C[2]).toFixed(6))),q=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:B,
build:y},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=c;a.betaRayleigh=B;a.build=y})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,r){a.TextureCoordinateAttributeType=void 0;(function(m){m[m.None=0]="None";m[m.Default=1]="Default";m[m.Atlas=2]="Atlas";m[m.Compressed=3]="Compressed";m[m.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(m,n){switch(n.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:m.attributes.add(r.VertexAttribute.UV0,"vec2");m.varyings.add("vuv0","vec2");m.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:m.attributes.add(r.VertexAttribute.UV0,"vec2");m.varyings.add("vuv0","vec2");m.vertex.code.add(c.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:m.attributes.add(r.VertexAttribute.UV0,"vec2");m.varyings.add("vuv0","vec2");m.attributes.add(r.VertexAttribute.UVREGION,"vec4");m.varyings.add("vuvRegion","vec4");m.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(n.textureCoordinateType);case a.TextureCoordinateAttributeType.None:m.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(c,...r){let m="";for(let n=0;n<r.length;n++)m+=c[n]+r[n];return m+=c[c.length-1]}(function(c){c.int=
function(r){return Math.round(r).toString()};c.float=function(r){return r.toPrecision(8)}})(b||(b={}));a.NoParameters=function(){};a.glsl=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.MAPPOS="mapPos";
b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.NORMALCOMPRESSED="normalCompressed";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL=
"profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0=
"position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced";Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(r){r.include(b.RgbaFloatEncoding);r.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces"],function(a,b,c,r){function m(g){g.uniforms.add(new b.Float3PassUniform("mainLightDirection",(h,d)=>d.lighting.mainLight.direction))}function n(g){g.uniforms.add(new b.Float3PassUniform("mainLightIntensity",
(h,d)=>d.lighting.mainLight.intensity))}function p(g,h){h.useLegacyTerrainShading?g.uniforms.add(new c.FloatPassUniform("lightingFixedFactor",(d,f)=>f.lighting.noonFactor*(1-f.lighting.globalFactor))):g.constants.add("lightingFixedFactor","float",0)}a.MainLighting=function(g,h){g=g.fragment;m(g);n(g);p(g,h);g.code.add(r.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=m;a.addMainLightIntensity=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec3",r.BindType.Pass,(h,d,f)=>h.setUniform3fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);
a.Float3PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../core/maybe","../shaderTechnique/BindType"],function(a,b,c){let r=function(){function m(n,p,g,h,d=null){this.name=n;this.type=p;this.arraySize=d;this.bind={[c.BindType.Pass]:null,[c.BindType.Draw]:null};b.isSome(g)&&b.isSome(h)&&(this.bind[g]=h)}m.prototype.equals=function(n){return this.type===
n.type&&this.name===n.name&&this.arraySize===n.arraySize};return m}();a.Uniform=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"float",r.BindType.Pass,(h,d,f)=>h.setUniform1f(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.FloatPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec2",r.BindType.Pass,(h,d,f)=>h.setUniform2fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Float2PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec4",r.BindType.Pass,(h,d,f)=>h.setUniform4fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Float4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,
g){return m.call(this,p,"mat4",r.BindType.Pass,(h,d,f)=>h.setUniformMatrix4fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../../../../../core/Logger","../../../../../core/maybe"],function(a,b,c,r,m){const n=
r.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");r=function(){function t(){this._includedModules=new Map}t.prototype.include=function(w,u){if(this._includedModules.has(w)){const z=this._includedModules.get(w);if(z!==u){n.error("Trying to include shader module multiple times with different sets of options.");u=new Set;for(const y of Object.keys(z))z[y]!==w[y]&&u.add(y);for(const y of Object.keys(w))z[y]!==w[y]&&u.add(y);u.forEach(y=>console.error(`  ${y}: current ${z[y]} new ${w[y]}`))}}else this._includedModules.set(w,
u),w(this.builder,u)};return t}();let p=function(t){function w(){var z=t.apply(this,arguments)||this;z.vertex=new d;z.fragment=new d;z.attributes=new f;z.varyings=new e;z.extensions=new l;z.constants=new A;return z}b._inheritsLoose(w,t);var u=w.prototype;u.generate=function(z){const y=this.extensions.generateSource(z),B=this.attributes.generateSource(z),C=this.varyings.generateSource();var k="vertex"===z?this.vertex:this.fragment;const q=k.uniforms.generateSource(),x=k.code.generateSource();z="vertex"===
z?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";k=this.constants.generateSource().concat(k.constants.generateSource());return`\n${y.join("\n")}\n\n${z}\n\n${k.join("\n")}\n\n${q.join("\n")}\n\n${B.join("\n")}\n\n${C.join("\n")}\n\n${x.join("\n")}`};u.generateBind=function(z,y){const B=new Map;this.vertex.uniforms.entries.forEach(q=>
{const x=q.bind[z];m.isSome(x)&&B.set(q.name,x)});this.fragment.uniforms.entries.forEach(q=>{const x=q.bind[z];m.isSome(x)&&B.set(q.name,x)});const C=Array.from(B.values()),k=C.length;return(q,x,v)=>{for(let D=0;D<k;++D)C[D](y,q,x,v)}};b._createClass(w,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return w}(r),g=function(){function t(){this._entries=new Map}var w=t.prototype;w.add=function(u){if(!Array.isArray(u))return this._add(u);
for(const z of u)this._add(z)};w.get=function(u){return this._entries.get(u)};w._add=function(u){if(m.isNone(u))n.error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(u.name)&&!this._entries.get(u.name).equals(u))throw new c(`Duplicate uniform name ${u.name} for different uniform type`);this._entries.set(u.name,u)}};w.generateSource=function(){return Array.from(this._entries.values()).map(u=>m.isSome(u.arraySize)?`uniform ${u.type} ${u.name}[${u.arraySize}];`:`uniform ${u.type} ${u.name};`)};
b._createClass(t,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return t}(),h=function(){function t(){this._entries=[]}var w=t.prototype;w.add=function(u){this._entries.push(u)};w.generateSource=function(){return this._entries};return t}(),d=function(t){function w(){var u=t.apply(this,arguments)||this;u.uniforms=new g;u.code=new h;u.constants=new A;return u}b._inheritsLoose(w,t);b._createClass(w,[{key:"builder",get:function(){return this}}]);return w}(r),f=function(){function t(){this._entries=
[]}var w=t.prototype;w.add=function(u,z){this._entries.push([u,z])};w.generateSource=function(u){return"fragment"===u?[]:this._entries.map(z=>`attribute ${z[1]} ${z[0]};`)};return t}(),e=function(){function t(){this._entries=[]}var w=t.prototype;w.add=function(u,z){this._entries.push([u,z])};w.generateSource=function(){return this._entries.map(u=>`varying ${u[1]} ${u[0]};`)};return t}(),l=function(){function t(){this._entries=new Set}var w=t.prototype;w.add=function(u){this._entries.add(u)};w.generateSource=
function(u){const z="vertex"===u?t.ALLOWLIST_VERTEX:t.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(y=>z.includes(y)).map(y=>`#extension ${y} : enable`)};return t}();l.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];l.ALLOWLIST_VERTEX=[];let A=function(){function t(){this._entries=new Set}var w=t.prototype;w.add=function(u,z,y){let B="ERROR_CONSTRUCTOR_STRING";switch(z){case "float":B=t._numberToFloatStr(y);break;case "int":B=t._numberToIntStr(y);break;
case "bool":B=y.toString();break;case "vec2":B=`vec2(${t._numberToFloatStr(y[0])},                            ${t._numberToFloatStr(y[1])})`;break;case "vec3":B=`vec3(${t._numberToFloatStr(y[0])},                            ${t._numberToFloatStr(y[1])},                            ${t._numberToFloatStr(y[2])})`;break;case "vec4":B=`vec4(${t._numberToFloatStr(y[0])},                            ${t._numberToFloatStr(y[1])},                            ${t._numberToFloatStr(y[2])},                            ${t._numberToFloatStr(y[3])})`;
break;case "ivec2":B=`ivec2(${t._numberToIntStr(y[0])},                             ${t._numberToIntStr(y[1])})`;break;case "ivec3":B=`ivec3(${t._numberToIntStr(y[0])},                             ${t._numberToIntStr(y[1])},                             ${t._numberToIntStr(y[2])})`;break;case "ivec4":B=`ivec4(${t._numberToIntStr(y[0])},                             ${t._numberToIntStr(y[1])},                             ${t._numberToIntStr(y[2])},                             ${t._numberToIntStr(y[3])})`;
break;case "mat2":case "mat3":case "mat4":B=`${z}(${Array.prototype.map.call(y,C=>t._numberToFloatStr(C)).join(", ")})`}this._entries.add(`const ${z} ${u} = ${B};`);return this};t._numberToIntStr=function(u){return u.toFixed(0)};t._numberToFloatStr=function(u){return Number.isInteger(u)?u.toFixed(1):u.toString()};w.generateSource=function(){return Array.from(this._entries)};return t}();a.Code=h;a.Includes=r;a.ShaderBuilder=p;a.Stage=d;a.Uniforms=g;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../shaderLibrary/util/WebGL2Utils ./Float2PassUniform ./TextureSizeUniformType ./Uniform ../shaderTechnique/BindType".split(" "),function(a,b,c,r,m,n,p,g,h,d){let f=function(l){function A(t,w){return l.call(this,t,"sampler2D",d.BindType.Pass,
(u,z,y)=>u.bindTexture(t,w(z,y)))||this}b._inheritsLoose(A,l);return A}(h.Uniform);const e=m.create();a.Texture2DPassUniform=f;a.createTexture2DPassSizeUniforms=function(l,A,t=g.TextureSizeUniformType.None){const w=[new f(l,A)];t&g.TextureSizeUniformType.Size&&w.push(new p.Float2PassUniform(l+n.TEXTURE_SIZE_UNIFORM_SUFFIX,(u,z)=>{u=A(u,z);return c.isSome(u)?r.set(e,u.descriptor.width,u.descriptor.height):m.ZEROS}));t&g.TextureSizeUniformType.InvSize&&w.push(new p.Float2PassUniform(l+n.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX,
(u,z)=>{u=A(u,z);return c.isSome(u)?r.set(e,1/u.descriptor.width,1/u.descriptor.height):m.ZEROS}));return w};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/WebGL2Utils":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX="InvSize";a.TEXTURE_SIZE_UNIFORM_SUFFIX="Size";a.texelFetch=function(c,r,m,n=null,p=0){if(c.hasWebGL2Context)return b.glsl`texelFetch(${r}, ivec2(${m}), ${b.glsl.int(p)})`;
c=b.glsl`texture2D(${r}, ${m} * `;return c=n?c+b.glsl`(${n}))`:c+b.glsl`${r+"InvSize"})`};a.textureSize=function(c,r,m=!1,n=0){return c.hasWebGL2Context?(c=b.glsl`vec2(textureSize(${r}, ${b.glsl.int(n)}))`,m?"(1.0 / "+c+")":c):m?r+"InvSize":r+"Size"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureSizeUniformType":function(){define(["exports"],function(a){a.TextureSizeUniformType=void 0;var b=a.TextureSizeUniformType||
(a.TextureSizeUniformType={});b[b.None=0]="None";b[b.Size=1]="Size";b[b.InvSize=2]="InvSize";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n,p){this._module=n;this._loadModule=p}var m=r.prototype;m.get=function(){return this._module};m.reload=function(){var n=
b._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return n.apply(this,arguments)}}();return r}();a.ReloadableShaderModule=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,c,r){let m=function(){function n(g,
h,d){this.release=d;this.initializeConfiguration(g,h);this._configuration=h.snapshot();this._program=this.initializeProgram(g);this._pipeline=this.initializePipeline(g.rctx.capabilities)}var p=n.prototype;p.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._configuration=null};p.reload=function(g){c.disposeMaybe(this._program);this._program=this.initializeProgram(g);this._pipeline=this.initializePipeline(g.rctx.capabilities)};p.bindPipelineState=function(g,h=null,
d){g.setPipelineState(this.getPipelineState(h,d))};p.ensureAttributeLocations=function(g){this.program.assertCompatibleVertexAttributeLocations(g)};p.getPipelineState=function(g,h){return this._pipeline};p.initializeConfiguration=function(g,h){};b._createClass(n,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.isCompiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},
{key:"primitiveType",get:function(){return r.PrimitiveType.TRIANGLES}}]);return n}();a.ShaderTechnique=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=
void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";
b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=
32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||
(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||
(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";
b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=
33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=
34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]=
"LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=
35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]=
"SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";
b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=
5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=
33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=
35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";
b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=
4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";
b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=
36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=
33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]=
"FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";
b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";
b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||
(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";
b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,
6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../core/shaderTechnique/BindType ../../../webgl/checkWebGLError".split(" "),
function(a,b,c,r,m,n){let p=function(){function g(d,f,e){this._context=d;this._locations=e;this._textures=new Map;this._freeTextureUnits=new r({deallocator:null});this._glProgram=d.programCache.acquire(f.generate("vertex"),f.generate("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=f.generateBind(m.BindType.Pass,this);this.bindDraw=f.generateBind(m.BindType.Draw,this);this._fragmentUniforms=n.webglDebugEnabled()?f.fragmentUniforms:null}var h=
g.prototype;h.dispose=function(){this._glProgram.dispose()};h.setUniform1b=function(d,f){this._glProgram.setUniform1i(d,f?1:0)};h.setUniform1i=function(d,f){this._glProgram.setUniform1i(d,f)};h.setUniform1f=function(d,f){this._glProgram.setUniform1f(d,f)};h.setUniform2fv=function(d,f){this._glProgram.setUniform2fv(d,f)};h.setUniform3fv=function(d,f){this._glProgram.setUniform3fv(d,f)};h.setUniform4fv=function(d,f){this._glProgram.setUniform4fv(d,f)};h.setUniformMatrix3fv=function(d,f){this._glProgram.setUniformMatrix3fv(d,
f)};h.setUniformMatrix4fv=function(d,f){this._glProgram.setUniformMatrix4fv(d,f)};h.setUniform1fv=function(d,f){this._glProgram.setUniform1fv(d,f)};h.setUniform1iv=function(d,f){this._glProgram.setUniform1iv(d,f)};h.setUniform2iv=function(d,f){this._glProgram.setUniform3iv(d,f)};h.setUniform3iv=function(d,f){this._glProgram.setUniform3iv(d,f)};h.setUniform4iv=function(d,f){this._glProgram.setUniform4iv(d,f)};h.assertCompatibleVertexAttributeLocations=function(d){d.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};
h.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};h.bindTexture=function(d,f){if(c.isNone(f)||null==f.glName){if(f=this._textures.get(d))this._context.bindTexture(null,f.unit),this._freeTextureUnit(f),this._textures.delete(d);return null}let e=this._textures.get(d);null==e?(e=this._allocTextureUnit(f),this._textures.set(d,e)):e.texture=f;this._context.useProgram(this);this.setUniform1i(d,e.unit);this._context.bindTexture(f,e.unit);return e.unit};h.rebindTextures=function(){this._context.useProgram(this);
this._textures.forEach((d,f)=>{this._context.bindTexture(d.texture,d.unit);this.setUniform1i(f,d.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(d=>{"sampler2D"!==d.type&&"samplerCube"!==d.type||this._textures.has(d.name)||console.error(`Texture sampler ${d.name} has no bound texture`)})};h._allocTextureUnit=function(d){return{texture:d,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};h._freeTextureUnit=function(d){this._freeTextureUnits.push(d.unit)};
b._createClass(g,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}}]);return g}();a.Program=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,c,r){function m(g,h){switch(h){case g.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case g.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case g.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case g.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case g.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case g.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const n=r.getLogger("esri.views.webgl.checkWebGLError"),p=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(g){if(p){const h=g.getError();h&&(g=m(g,h),n.error(new b("webgl-error","WebGL error occured",{message:g,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=p;a.webglDebugEnabled=function(){return p};a.webglValidateShadersEnabled=function(){return p};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c){function r(P){return x.intern(P)}function m(P){return v.intern(P)}function n(P){return D.intern(P)}function p(P){return F.intern(P)}function g(P){return G.intern(P)}function h(P){return J.intern(P)}function d(P){return L.intern(P)}function f(P){return K.intern(P)}function e(P){return"["+P.join(",")+"]"}function l(P){return P?e([P.srcRgb,P.srcAlpha,P.dstRgb,P.dstAlpha,P.opRgb,P.opAlpha,P.color.r,P.color.g,P.color.b,P.color.a]):null}
function A(P){return P?e([P.face,P.mode]):null}function t(P){return P?e([P.factor,P.units]):null}function w(P){return P?e([P.func]):null}function u(P){return P?e([P.function.func,P.function.ref,P.function.mask,P.operation.fail,P.operation.zFail,P.operation.zPass]):null}function z(P){return P?e([P.zNear,P.zFar]):null}function y(P){return P?e([P.r,P.g,P.b,P.a]):null}function B(P){return P?e([P.mask]):null}const C={face:c.Face.BACK,mode:c.CullMode.CCW},k={face:c.Face.FRONT,mode:c.CullMode.CCW};var q=
function(){function P(N,H){this._makeKey=N;this._makeRef=H;this._interns=new Map}P.prototype.intern=function(N){if(!N)return null;const H=this._makeKey(N),E=this._interns;E.has(H)||E.set(H,this._makeRef(N));return E.get(H)??null};return P}();const x=new q(l,P=>({__tag:"Blending",...P})),v=new q(A,P=>({__tag:"Culling",...P})),D=new q(t,P=>({__tag:"PolygonOffset",...P})),F=new q(w,P=>({__tag:"DepthTest",...P})),G=new q(u,P=>({__tag:"StencilTest",...P})),J=new q(z,P=>({__tag:"DepthWrite",...P})),L=new q(y,
P=>({__tag:"ColorWrite",...P})),K=new q(B,P=>({__tag:"StencilWrite",...P})),O=new q(function(P){return P?e([l(P.blending),A(P.culling),t(P.polygonOffset),w(P.depthTest),u(P.stencilTest),z(P.depthWrite),y(P.colorWrite),B(P.stencilWrite)]):null},P=>({blending:r(P.blending),culling:m(P.culling),polygonOffset:n(P.polygonOffset),depthTest:p(P.depthTest),stencilTest:g(P.stencilTest),depthWrite:h(P.depthWrite),colorWrite:d(P.colorWrite),stencilWrite:f(P.stencilWrite)}));q=function(){function P(H){this._stencilWriteInvalid=
this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=H}var N=P.prototype;N.setPipeline=function(H){if(this._pipelineInvalid||H!==this._pipeline)this._setBlending(H.blending),this._setCulling(H.culling),this._setPolygonOffset(H.polygonOffset),this._setDepthTest(H.depthTest),this._setStencilTest(H.stencilTest),this._setDepthWrite(H.depthWrite),
this._setColorWrite(H.colorWrite),this._setStencilWrite(H.stencilWrite),this._pipeline=H;this._pipelineInvalid=!1};N.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};N.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};N.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};N.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};N.invalidateStencilTest=function(){this._pipelineInvalid=
this._stencilTestInvalid=!0};N.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};N.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};N.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};N._setBlending=function(H){this._blending=this._setSubState(H,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};N._setCulling=function(H){this._culling=this._setSubState(H,
this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};N._setPolygonOffset=function(H){this._polygonOffset=this._setSubState(H,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};N._setDepthTest=function(H){this._depthTest=this._setSubState(H,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};N._setStencilTest=function(H){this._stencilTest=this._setSubState(H,
this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};N._setDepthWrite=function(H){this._depthWrite=this._setSubState(H,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};N._setColorWrite=function(H){this._colorWrite=this._setSubState(H,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};N._setStencilWrite=function(H){this._stencilWrite=this._setSubState(H,
this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};N._setSubState=function(H,E,I,M){if(I||H!==E)M(H),this._pipelineInvalid=!0;return H};return P}();a.StateTracker=q;a.backFaceCullingParams=C;a.cullingParams=P=>P===b.CullFaceOptions.Back?C:P===b.CullFaceOptions.Front?k:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=k;a.makeBlending=r;a.makeColorWrite=d;a.makeCulling=
m;a.makeDepthTest=p;a.makeDepthWrite=h;a.makePipelineState=function(P){return O.intern(P)};a.makePolygonOffset=n;a.makeStencilTest=g;a.makeStencilWrite=f;a.separateBlendingParams=function(P,N,H,E,I=c.BlendOperation.ADD,M=c.BlendOperation.ADD,Q=[0,0,0,0]){return{srcRgb:P,srcAlpha:N,dstRgb:H,dstAlpha:E,opRgb:I,opAlpha:M,color:{r:Q[0],g:Q[1],b:Q[2],a:Q[3]}}};a.simpleBlendingParams=function(P,N,H=c.BlendOperation.ADD,E=[0,0,0,0]){return{srcRgb:P,srcAlpha:P,dstRgb:N,dstAlpha:N,opRgb:H,opAlpha:H,color:{r:E[0],
g:E[1],b:E[2],a:E[3]}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction=
{}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.UpdatePolicy=
void 0;(function(b){b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC"})(a.UpdatePolicy||(a.UpdatePolicy={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PrimitiveType=void 0;(function(b){b[b.Triangle=0]="Triangle";b[b.Point=1]="Point";b[b.Line=2]="Line"})(a.PrimitiveType||(a.PrimitiveType={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||
(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.haze=!1;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter()],m.prototype,"haze",void 0);
a.ChapmanAtmosphereTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}r.prototype.snapshot=
function(){const m=this._parameterNames,n={key:this.key};for(const p of m)n[p]=this[p];return n};b._createClass(r,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return r}();a.ShaderTechniqueConfiguration=c;a.parameter=function(r={}){return(m,n)=>{m._parameterNames=m._parameterNames??[];m._parameterNames.push(n);if(null!=r.constValue)Object.defineProperty(m,n,{get(){return r.constValue}});else{const p=
m._parameterNames.length-1,g=Math.ceil(Math.log2(r.count||2)),h=m._parameterBits??[0];let d=0;for(;16<h[d]+g;)d++,d>=h.length&&h.push(0);m._parameterBits=h;const f=h[d],e=(1<<g)-1<<f;h[d]+=g;Object.defineProperty(m,n,{get(){return this[p]},set(l){if(this[p]!==l&&(this[p]=l,this._keyDirty=!0,this._parameterBits[d]=this._parameterBits[d]&~e|+l<<f&e,"number"!==typeof l&&"boolean"!==typeof l))throw"Configuration value for "+n+" must be boolean or number, got "+typeof l;}})}}};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,r){const m=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],n=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new r.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,
12,20)],p=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new r.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,c.DataType.FLOAT,12,32),new r.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],g=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new r.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],h=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,
0,8)];b=[new r.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new r.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,8,16)];a.Pos2=h;a.Pos2Tex=b;a.Pos3=m;a.Pos3Col=g;a.Pos3NormalTex=p;a.Pos3Tex=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(b,c,r,m,n,p=!1,g=0){this.name=b;this.count=c;this.type=
r;this.offset=m;this.stride=n;this.normalized=p;this.divisor=g};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,r,m,n,p){a.createColorTexture=function(g,h,d=4){const f=new Uint8Array(d*d*4);for(let e=0;e<f.length;e+=
4)f[e+0]=255*h[0],f[e+1]=255*h[1],f[e+2]=255*h[2],f[e+3]=255*h[3];return new p.Texture(g,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:d,height:d},f)};a.createEmptyDepthTexture=function(g){return new p.Texture(g,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,255,255,
255]))};a.createEmptyTexture=function(g,h=4){return new p.Texture(g,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:h,height:h})};a.createQuadVAO=function(g,h=c.Pos2,d=b.Default3D,f=-1,e=1){let l=null;switch(h){case c.Pos2Tex:l=new Float32Array([f,f,0,0,e,f,1,0,f,e,0,1,e,e,1,1]);break;default:l=new Float32Array([f,f,e,f,f,e,e,e])}return new r.VertexArrayObject(g,d,{geometry:h},{geometry:m.BufferObject.createVertex(g,
n.Usage.STATIC_DRAW,l)})};a.createScreenSizeTriangleVAO=function(g,h=c.Pos2,d=b.Default3D){const f=new Float32Array([-1,-1,3,-1,-1,3]);return new r.VertexArrayObject(g,d,{geometry:h},{geometry:m.BufferObject.createVertex(g,n.Usage.STATIC_DRAW,f)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/VertexArrayObject"],
function(a,b,c){c=function(r){function m(){return r.apply(this,arguments)||this}b._inheritsLoose(m,r);return m}(c.VertexArrayObject);a.VertexArrayObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),function(a,b,c,r,m,n){const p=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function g(d,
f,e,l,A=null){this._context=d;this._locations=f;this._layout=e;this._buffers=l;this._indexBuffer=A;this._glName=null;this._initialized=!1;d.instanceCounter.increment(m.ResourceType.VertexArrayObject,this)}var h=g.prototype;h.dispose=function(d=!0){if(this._context){if(this._glName){const f=this._context?.capabilities?.vao;f?(f.deleteVertexArray(this._glName),this._glName=null):p.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(d){for(const f in this._buffers)this._buffers[f]?.dispose(),
delete this._buffers[f];this._indexBuffer=r.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(m.ResourceType.VertexArrayObject,this);this._context=r.nullifyNonNullableForDispose(this._context)}else(this._glName||d&&0<Object.getOwnPropertyNames(this._buffers).length)&&p.warn("Leaked WebGL VAO")};h.initialize=function(){if(!this._initialized){var d=this._context.capabilities.vao;if(d){const f=d.createVertexArray();d.bindVertexArray(f);this._bindLayout();d.bindVertexArray(null);
this._glName=f}this._initialized=!0}};h.bind=function(){this.initialize();const d=this._context.capabilities.vao;d?d.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};h._bindLayout=function(){const {_buffers:d,_layout:f,_indexBuffer:e}=this;d||p.error("Vertex buffer dictionary is empty!");const l=this._context.gl;for(const A in d){const t=d[A];t||p.error("Vertex buffer is uninitialized!");const w=f[A];w||p.error("Vertex element descriptor is empty!");n.bindVertexBufferLayout(this._context,
this._locations,t,w)}r.isSome(e)&&(this._context.capabilities.vao?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))};h.unbind=function(){this.initialize();const d=this._context.capabilities.vao;d?d.bindVertexArray(null):this._unbindLayout()};h._unbindLayout=function(){const {_buffers:d,_layout:f}=this;d||p.error("Vertex buffer dictionary is empty!");for(const e in d){const l=d[e];l||p.error("Vertex buffer is uninitialized!");n.unbindVertexBufferLayout(this._context,this._locations,
l,f[e])}r.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((d,f)=>d+this._buffers[f].size,r.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",
get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return g}();a.VertexArrayObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,r){function m(g){return g[0].stride}function n(g){switch(g){case r.PixelFormat.ALPHA:case r.PixelFormat.LUMINANCE:case r.PixelFormat.RED:case r.PixelFormat.RED_INTEGER:case r.SizedPixelFormat.R8:case r.SizedPixelFormat.R8I:case r.SizedPixelFormat.R8UI:case r.SizedPixelFormat.R8_SNORM:case r.RenderbufferFormat.STENCIL_INDEX8:return 1;
case r.PixelFormat.LUMINANCE_ALPHA:case r.PixelFormat.RG:case r.PixelFormat.RG_INTEGER:case r.SizedPixelFormat.RGBA4:case r.SizedPixelFormat.R16F:case r.SizedPixelFormat.R16I:case r.SizedPixelFormat.R16UI:case r.SizedPixelFormat.RG8:case r.SizedPixelFormat.RG8I:case r.SizedPixelFormat.RG8UI:case r.SizedPixelFormat.RG8_SNORM:case r.SizedPixelFormat.RGB565:case r.SizedPixelFormat.RGB5_A1:case r.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case r.PixelFormat.DEPTH_COMPONENT:case r.PixelFormat.RGB:case r.PixelFormat.RGB_INTEGER:case r.SizedPixelFormat.RGB8:case r.SizedPixelFormat.RGB8I:case r.SizedPixelFormat.RGB8UI:case r.SizedPixelFormat.RGB8_SNORM:case r.SizedPixelFormat.SRGB8:case r.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case r.PixelFormat.DEPTH_STENCIL:case r.PixelFormat.RGBA:case r.PixelFormat.RGBA_INTEGER:case r.SizedPixelFormat.RGBA8:case r.SizedPixelFormat.R32F:case r.SizedPixelFormat.R11F_G11F_B10F:case r.SizedPixelFormat.RG16F:case r.SizedPixelFormat.R32I:case r.SizedPixelFormat.R32UI:case r.SizedPixelFormat.RG16I:case r.SizedPixelFormat.RG16UI:case r.SizedPixelFormat.RGBA8I:case r.SizedPixelFormat.RGBA8UI:case r.SizedPixelFormat.RGBA8_SNORM:case r.SizedPixelFormat.SRGB8_ALPHA8:case r.SizedPixelFormat.RGB9_E5:case r.SizedPixelFormat.RGB10_A2UI:case r.SizedPixelFormat.RGB10_A2:case r.RenderbufferFormat.DEPTH_STENCIL:case r.RenderbufferFormat.DEPTH_COMPONENT32F:case r.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case r.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case r.SizedPixelFormat.RGB16F:case r.SizedPixelFormat.RGB16I:case r.SizedPixelFormat.RGB16UI:return 6;case r.SizedPixelFormat.RG32F:case r.SizedPixelFormat.RG32I:case r.SizedPixelFormat.RG32UI:case r.SizedPixelFormat.RGBA16F:case r.SizedPixelFormat.RGBA16I:case r.SizedPixelFormat.RGBA16UI:return 8;case r.SizedPixelFormat.RGB32F:case r.SizedPixelFormat.RGB32I:case r.SizedPixelFormat.RGB32UI:return 12;case r.SizedPixelFormat.RGBA32F:case r.SizedPixelFormat.RGBA32I:case r.SizedPixelFormat.RGBA32UI:return 16;
case r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case r.CompressedTextureFormat.COMPRESSED_R11_EAC:case r.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case r.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case r.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case r.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case r.CompressedTextureFormat.COMPRESSED_RG11_EAC:case r.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case r.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function p(g){if(c.isNone(g))return 0;if("descriptor"in g)return g.glName?p(g.descriptor):0;const h=g.internalFormat||"pixelFormat"in g&&g.pixelFormat;if(!h)return 0;const d="hasMipmap"in g&&g.hasMipmap?1.3:1;g=g.width*g.height;return n(h)*g*d}a.bindVertexBufferLayout=
function(g,h,d,f,e=0){const l=g.gl,A=g.capabilities.instancing;g.bindBuffer(d);for(const t of f)if(g=h.get(t.name),void 0===g&&console.error(`There is no location for vertex attribute '${t.name}' defined.`),d=e*t.stride,4>=t.count)l.vertexAttribPointer(g,t.count,t.type,t.normalized,t.stride,t.offset+d),l.enableVertexAttribArray(g),0<t.divisor&&A&&A.vertexAttribDivisor(g,t.divisor);else if(9===t.count)for(f=0;3>f;f++)l.vertexAttribPointer(g+f,3,t.type,t.normalized,t.stride,t.offset+12*f+d),l.enableVertexAttribArray(g+
f),0<t.divisor&&A&&A.vertexAttribDivisor(g+f,t.divisor);else if(16===t.count)for(f=0;4>f;f++)l.vertexAttribPointer(g+f,4,t.type,t.normalized,t.stride,t.offset+16*f+d),l.enableVertexAttribArray(g+f),0<t.divisor&&A&&A.vertexAttribDivisor(g+f,t.divisor);else console.error("Unsupported vertex attribute element count: "+t.count)};a.getBytesPerElementFormat=n;a.getErrorString=function(g){g=g.gl;switch(g.getError()){case g.NO_ERROR:return null;case g.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case g.INVALID_VALUE:return"A numeric argument is out of range";case g.INVALID_OPERATION:return"The specified command is not allowed for the current state";case g.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case g.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case g.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=p;a.getStride=m;a.unbindVertexBufferLayout=function(g,h,d,f){const e=
g.gl,l=g.capabilities.instancing;g.bindBuffer(d);for(const A of f)if(d=h.get(A.name),4>=A.count)e.disableVertexAttribArray(d),A.divisor&&0<A.divisor&&l&&l.vertexAttribDivisor(d,0);else if(9===A.count)for(f=0;3>f;f++)e.disableVertexAttribArray(d+f),A.divisor&&0<A.divisor&&l&&l.vertexAttribDivisor(d+f,0);else if(16===A.count)for(f=0;4>f;f++)e.disableVertexAttribArray(d+f),A.divisor&&0<A.divisor&&l&&l.vertexAttribDivisor(d+f,0);else console.error("Unsupported vertex attribute element count: "+A.count);
g.unbindBuffer(r.BufferType.ARRAY_BUFFER)};a.vertexCount=function(g,h){return g.vertexBuffers[h].size/m(g.layout[h])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(a,b,c,r,m,n,p,g,h){const d=r.getLogger("esri.views.webgl.BufferObject");
r=function(){function f(l,A,t,w){this._context=l;this.bufferType=A;this.usage=t;this._glName=null;this._size=-1;this._indexType=void 0;l.instanceCounter.increment(h.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();p.checkWebGLError(this._context.gl);w&&this.setData(w)}f.createIndex=function(l,A,t){return new f(l,h.BufferType.ELEMENT_ARRAY_BUFFER,A,t)};f.createVertex=function(l,A,t){return new f(l,h.BufferType.ARRAY_BUFFER,A,t)};f.createUniform=function(l,A,t){if(l.type!==
g.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new f(l,h.BufferType.UNIFORM_BUFFER,A,t)};f.createPixelPack=function(l,A=h.Usage.STREAM_READ,t){if(l.type!==g.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");l=new f(l,h.BufferType.PIXEL_PACK_BUFFER,A);t&&l.setSize(t);return l};f.createPixelUnpack=function(l,A=h.Usage.STREAM_DRAW,t){if(l.type!==g.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new f(l,h.BufferType.PIXEL_UNPACK_BUFFER,A,t)};var e=f.prototype;e.dispose=function(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(h.ResourceType.BufferObject,this),this._context=m.nullifyNonNullableForDispose(this._context)):this._glName&&d.warn("Leaked WebGL buffer object")};e.setSize=function(l,A=null){0>=l&&d.error("Buffer size needs to be positive!");if(this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER&&
m.isSome(A))switch(this._indexType=A,A){case h.DataType.UNSIGNED_SHORT:l*=2;break;case h.DataType.UNSIGNED_INT:l*=4}this._setBufferData(l)};e.setData=function(l){if(l){var A=l.byteLength;this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER&&(n.isUint16Array(l)&&(A/=2,this._indexType=h.DataType.UNSIGNED_SHORT),n.isUint32Array(l)&&(A/=4,this._indexType=h.DataType.UNSIGNED_INT));this._setBufferData(A,l)}};e._setBufferData=function(l,A=null){this._size=l;const t=this._context.getBoundVAO();this._isVAOAware&&
this._context.bindVAO(null);this._context.bindBuffer(this);const w=this._context.gl;m.isSome(A)?w.bufferData(this.bufferType,A,this.usage):w.bufferData(this.bufferType,l,this.usage);p.checkWebGLError(w);this._isVAOAware&&this._context.bindVAO(t)};e.setSubData=function(l,A,t,w){if(l){(0>A||A>=this._size)&&d.error("offset is out of range!");t>=w&&d.error("end must be bigger than start!");A+(w-t)>this._size&&d.error("An attempt to write beyond the end of the buffer!");var u=this._context.getBoundVAO();
this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var z=this._context.gl;this._context.type===g.ContextType.WEBGL2?z.bufferSubData(this.bufferType,A*l.BYTES_PER_ELEMENT,l,t,w-t):(t=0===t&&w===l.length?l:l.subarray(t,w),z.bufferSubData(this.bufferType,A*l.BYTES_PER_ELEMENT,t));p.checkWebGLError(z);this._isVAOAware&&this._context.bindVAO(u)}};e.getSubData=function(l,A=0,t,w){if(this._context.type!==g.ContextType.WEBGL2)d.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>t||0>w)d.error("Problem getting subdata: offset and length were less than zero!");else{var u=c.isArrayLike(l)?l.BYTES_PER_ELEMENT:1;u*((t??0)+(w??0))>l.byteLength?d.error("Problem getting subdata: offset and length exceeded destination size!"):(A+u*(w??0)>this.byteSize&&d.warn("Potential problem getting subdata: requested data exceeds buffer size!"),u=this._context.gl,this._context.bindBuffer(this,h.BufferType.COPY_READ_BUFFER),u.getBufferSubData(h.BufferType.COPY_READ_BUFFER,A,l,t,w),this._context.unbindBuffer(h.BufferType.COPY_READ_BUFFER))}};
e.getSubDataAsync=function(){var l=b._asyncToGenerator(function*(A,t=0,w,u){this._context.type!==g.ContextType.WEBGL2?d.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(A,t,w,u))});return function(A){return l.apply(this,arguments)}}();b._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===
h.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===h.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===h.BufferType.ARRAY_BUFFER}}]);return f}();a.BufferObject=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,b,c){function r(g){const h=
b("esri-force-webgl");if(h===a.ContextType.WEBGL1||h===a.ContextType.WEBGL2)return[h];switch(g){case "2d":return b("mac")&&b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function m(g,h,d={}){if(!window.WebGLRenderingContext)return p(g,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),null;
h=n(g,h,d);c.isNone(h)&&p(g,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return h}function n(g,h,d={}){h=h===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let f=null;for(const e of h){try{f=g.getContext(e,d)}catch(l){}if(f)break}return f}function p(g,h){(g=g.parentNode)&&(g.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
h+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(g){g[g.WEBGL1=1]="WEBGL1";g[g.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=n;a.createContextOrErrorHTML=function(g,h,d={}){for(g=r(g);1<g.length;){const f=n(h,g.shift(),d);if(c.isSome(f))return f}return m(h,g.shift(),d)};a.getContextTypes=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(t){return m.isSome(t)&&"type"in t&&"compressed"===t.type}function f(t){var w;if(w=m.isSome(t)&&!d(t))w=!(m.isSome(t)&&"byteLength"in t);return w}function e(t){return t===g.TextureType.TEXTURE_3D||t===g.TextureType.TEXTURE_2D_ARRAY}function l(t,w,u,z=1){w=Math.max(w,u);t===g.TextureType.TEXTURE_3D&&(w=Math.max(w,z));return Math.round(Math.log(w)/Math.LN2)+1}const A={target:g.TextureType.TEXTURE_2D,samplingMode:g.TextureSamplingMode.LINEAR,wrapMode:g.TextureWrapMode.REPEAT,
flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1};c=function(){function t(u,z,y=null){this._context=u;this.type="texture";this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;u.instanceCounter.increment(g.ResourceType.Texture,this);this._descriptor={...A,...z};for(const B in A)void 0===this._descriptor[B]&&(this._descriptor[B]=A[B]);if(u.type!==p.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=
!1),e(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");this._descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(y):this.setData(y)}var w=t.prototype;w.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.ResourceType.Texture,this))};w.release=function(){this.dispose()};w.resize=function(u,z){const y=
this._descriptor;if(y.width!==u||y.height!==z){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");y.width=u;y.height=z;this._descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};w._setDataCubeMap=function(u=null){for(let z=g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;z<=g.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;z++)this._setData(u,z)};w.setData=function(u){this._setData(u)};w._setData=function(u,z){if(this._context&&this._context.gl){var y=
this._context.gl;this._glName||(this._glName=y.createTexture());void 0===u&&(u=null);var B=this._descriptor,C=z??B.target,k=e(C);null===u&&(B.width=B.width||4,B.height=B.height||4,k&&(B.depth=B.depth??1));z=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);t._validateTexture(this._context,B);this._configurePixelStorage();n.checkWebGLError(y);var q=B.pixelFormat,x=B.internalFormat??this._deriveInternalFormat(q,B.dataType);if(f(u)){q=
u.width;let v=u.height;u instanceof HTMLVideoElement&&(q=u.videoWidth,v=u.videoHeight);B.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(C,x,B.hasMipmap,q,v,1);this._texImage(C,0,x,q,v,1,u);n.checkWebGLError(y);B.hasMipmap&&this.generateMipmap();void 0===B.width&&(B.width=q);void 0===B.height&&(B.height=v);k&&void 0===B.depth&&(B.depth=1)}else{const {width:v,height:D,depth:F}=B;if(null==v||null==D)throw Error("Width and height must be specified!");if(k&&null==F)throw Error("Depth must be specified!");
B.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(C,x,B.hasMipmap,v,D,F);y.DEPTH24_STENCIL8&&x===y.DEPTH_STENCIL&&(x=y.DEPTH24_STENCIL8);if(d(u)){const G=u.levels;u=l(C,v,D,F);k=Math.min(u-1,G.length-1);h(y)?y.texParameteri(B.target,y.TEXTURE_MAX_LEVEL,k):B.hasMipmap=B.hasMipmap&&u===G.length;const J=x;if(!(J in g.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((L,K,O,P)=>{this._compressedTexImage(C,L,J,K,
O,P,G[Math.min(L,G.length-1)])},k)}else m.isSome(u)?(this._texImage(C,0,x,v,D,F,u),n.checkWebGLError(y),B.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((G,J,L,K)=>{this._texImage(C,G,x,J,L,K,null);n.checkWebGLError(y)})}t._applySamplingMode(y,this._descriptor);t._applyWrapMode(y,this._descriptor);t._applyAnisotropicFilteringParameters(this._context,this._descriptor);n.checkWebGLError(y);this._context.bindTexture(z,t.TEXTURE_UNIT_FOR_UPDATES)}};w.updateData=function(u,z,y,B,C,k,q=0){k||
console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const x=this._context.gl,v=this._descriptor,{pixelFormat:D,dataType:F,target:G,isImmutable:J}=v,L=v.internalFormat??this._deriveInternalFormat(D,F);if(J&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const K=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES,!0);(0>z||0>y||B>v.width||C>v.height||z+B>v.width||y+C>v.height)&&
console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(q){if(!h(x)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}x.pixelStorei(x.UNPACK_SKIP_ROWS,q)}f(k)?h(x)?x.texSubImage2D(G,u,z,y,B,C,D,F,k):x.texSubImage2D(G,u,z,y,D,F,k):d(k)?x.compressedTexSubImage2D(G,u,z,y,B,C,L,k.levels[u]):x.texSubImage2D(G,u,z,y,B,C,D,F,k);if(q){if(!h(x)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}x.pixelStorei(x.UNPACK_SKIP_ROWS,
0)}this._context.bindTexture(K,t.TEXTURE_UNIT_FOR_UPDATES)};w.updateData3D=function(u,z,y,B,C,k,q,x){x||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const v=this._context.gl;if(!h(v))throw Error("3D textures are not supported in WebGL1");const D=this._descriptor,{pixelFormat:F,dataType:G,isImmutable:J,target:L}=D,K=D.internalFormat??this._deriveInternalFormat(F,G);if(J&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");
e(L)||console.warn("Attempting to set 3D texture data on a non-3D texture");const O=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);(0>z||0>y||0>B||C>D.width||k>D.height||q>D.depth||z+C>D.width||y+k>D.height||B+q>D.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();d(x)?(x=x.levels[u],v.compressedTexSubImage3D(L,u,z,y,B,C,k,q,K,x)):v.texSubImage3D(L,u,z,y,B,C,k,q,F,G,x);this._context.bindTexture(O,
t.TEXTURE_UNIT_FOR_UPDATES)};w.generateMipmap=function(){const u=this._descriptor;if(!u.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=u.hasMipmap=!0;t._validateTexture(this._context,u)}u.samplingMode===g.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,u.samplingMode=g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):u.samplingMode===g.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,u.samplingMode=
g.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const z=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(u.target);this._context.bindTexture(z,t.TEXTURE_UNIT_FOR_UPDATES)};w.setSamplingMode=function(u){u!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=u,this._samplingModeDirty=!0)};w.setWrapMode=function(u){u!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=u,t._validateTexture(this._context,
this._descriptor),this._wrapModeDirty=!0)};w.applyChanges=function(){const u=this._context.gl,z=this._descriptor;this._samplingModeDirty&&(t._applySamplingMode(u,z),this._samplingModeDirty=!1);this._wrapModeDirty&&(t._applyWrapMode(u,z),this._wrapModeDirty=!1)};w._deriveInternalFormat=function(u,z){if(this._context.type===p.ContextType.WEBGL1)return u;switch(z){case g.PixelType.FLOAT:switch(u){case g.PixelFormat.RGBA:return g.SizedPixelFormat.RGBA32F;case g.PixelFormat.RGB:return g.SizedPixelFormat.RGB32F;
default:throw Error("Unable to derive format");}case g.PixelType.UNSIGNED_BYTE:switch(u){case g.PixelFormat.RGBA:return g.SizedPixelFormat.RGBA8;case g.PixelFormat.RGB:return g.SizedPixelFormat.RGB8}default:return u}};w._configurePixelStorage=function(){const u=this._context.gl,{unpackAlignment:z,flipped:y,preMultiplyAlpha:B}=this._descriptor;u.pixelStorei(u.UNPACK_ALIGNMENT,z);u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,y?1:0);u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B?1:0)};w._texStorage=function(u,
z,y,B,C,k){const q=this._context.gl;if(!h(q))throw Error("Immutable textures are not supported in WebGL1");if(!(z in g.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){y=y?l(u,B,C,k):1;if(e(u)){if(null==k)throw Error("Missing depth dimension for 3D texture upload");q.texStorage3D(u,y,z,B,C,k)}else q.texStorage2D(u,y,z,B,C);this._wasImmutablyAllocated=!0}};w._texImage=function(u,z,y,B,C,k,q){const x=this._context.gl;let v=null;const D=
this._context.type===p.ContextType.WEBGL2,F=e(u),{isImmutable:G,pixelFormat:J,dataType:L}=this._descriptor;D&&(v=x);if(!D&&f(q))x.texImage2D(u,0,y,J,L,q);else if(G){if(m.isSome(q))if(F){if(null==k)throw Error("Missing depth dimension for 3D texture upload");v.texSubImage3D(u,z,0,0,0,B,C,k,J,L,q)}else x.texSubImage2D(u,z,0,0,B,C,J,L,q)}else if(q=m.unwrap(q),F){if(null==k)throw Error("Missing depth dimension for 3D texture upload");v.texImage3D(u,z,y,B,C,k,0,J,L,q)}else x.texImage2D(u,z,y,B,C,0,J,L,
q)};w._compressedTexImage=function(u,z,y,B,C,k,q){const x=this._context.gl;let v=null;const D=e(u),F=this._descriptor.isImmutable;if(D){if(this._context.type!==p.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");v=x}if(F){if(m.isSome(q))if(D){if(null==k)throw Error("Missing depth dimension for 3D texture upload");v.compressedTexSubImage3D(u,z,0,0,0,B,C,k,y,q)}else x.compressedTexSubImage2D(u,z,0,0,B,C,y,q)}else if(D){if(null==k)throw Error("Missing depth dimension for 3D texture upload");
v.compressedTexImage3D(u,z,y,B,C,k,0,q)}else x.compressedTexImage2D(u,z,y,B,C,0,q)};w._forEachMipmapLevel=function(u,z=Infinity){let {width:y,height:B,depth:C,hasMipmap:k,target:q}=this._descriptor;const x=q===g.TextureType.TEXTURE_3D;if(null==y||null==B||x&&null==C)throw Error("Missing texture dimensions for mipmap calculation");for(let v=0;;++v){u(v,y,B,C);if(!k||1===y&&1===B&&(!x||1===C)||v>=z)break;y=Math.max(1,y>>1);B=Math.max(1,B>>1);x&&(C=Math.max(1,C>>1))}};t._validateTexture=function(u,z){(null!=
z.width&&0>z.width||null!=z.height&&0>z.height||null!=z.depth&&0>z.depth)&&console.error("Negative dimension parameters are not allowed!");u=h(u.gl);const y=null!=z.width&&r.isPowerOfTwo(z.width)&&null!=z.height&&r.isPowerOfTwo(z.height);u||!z.isImmutable&&!e(z.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");u||y||("number"===typeof z.wrapMode?z.wrapMode!==g.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):
(z.wrapMode.s!==g.TextureWrapMode.CLAMP_TO_EDGE||z.wrapMode.t!==g.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),z.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};t._applySamplingMode=function(u,z){let y=z.samplingMode,B=z.samplingMode;if(y===g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||y===g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)y=g.TextureSamplingMode.LINEAR,z.hasMipmap||(B=g.TextureSamplingMode.LINEAR);
else if(y===g.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||y===g.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)y=g.TextureSamplingMode.NEAREST,z.hasMipmap||(B=g.TextureSamplingMode.NEAREST);u.texParameteri(z.target,u.TEXTURE_MAG_FILTER,y);u.texParameteri(z.target,u.TEXTURE_MIN_FILTER,B)};t._applyWrapMode=function(u,z){"number"===typeof z.wrapMode?(u.texParameteri(z.target,u.TEXTURE_WRAP_S,z.wrapMode),u.texParameteri(z.target,u.TEXTURE_WRAP_T,z.wrapMode)):(u.texParameteri(z.target,u.TEXTURE_WRAP_S,z.wrapMode.s),
u.texParameteri(z.target,u.TEXTURE_WRAP_T,z.wrapMode.t))};t._applyAnisotropicFilteringParameters=function(u,z){const y=u.capabilities.textureFilterAnisotropic;y&&u.gl.texParameterf(z.target,y.TEXTURE_MAX_ANISOTROPY,z.maxAnisotropy??1)};b._createClass(t,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return t}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=
c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.CloudsComposition=function(t){function w(z){var y=t.call(this,z)||this;y._technique=new d.CloudsCompositionTechnique(z);y._vao=e.createQuadVAO(z.rctx);return y}b._inheritsLoose(w,t);var u=w.prototype;u.destroy=function(){this._technique=m.releaseMaybe(this._technique);this._vao=m.disposeMaybe(this._vao)};u.render=function(z){var y=z.bindParameters.cloudsFade;m.isNone(this._vao)||m.isNone(y.data)||(this._technique.compiled?(y=z.rctx.bindTechnique(this._technique,
A,z.bindParameters),z.rctx.bindVAO(this._vao),y.assertCompatibleVertexAttributeLocations(this._vao),z.rctx.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4)):this.requestRender())};return w}(r);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);c.__decorate([n.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=c.__decorate([h.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const A=new f.NoParameters;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){n=function(e){function l(t){var w;return w=e.call(this,t,new p.ShaderTechniqueConfiguration,()=>w.destroy())||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new h.Program(t.rctx,l.shader.get().build(),g.Default3D)};A.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};
return l}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(r.CloudsCompositionShader,()=>new Promise((e,l)=>a(["./CloudsComposition.glsl"],e,l)));b.CloudsCompositionTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(){const y=new t.ShaderBuilder;y.attributes.add(w.VertexAttribute.POSITION,"vec2");y.varyings.add("worldRay","vec3");const {vertex:B,fragment:C}=y;B.uniforms.add([new A.Matrix4PassUniform("inverseProjectionMatrix",(k,q)=>q.camera.inverseProjectionMatrix),new A.Matrix4PassUniform("inverseViewMatrix",(k,q)=>b.invert(z,q.camera.viewMatrix))]);B.code.add(l.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);C.include(d.ColorConversion);C.include(f.RgbaFloatEncoding);y.include(r.EvaluateAmbientLighting,{pbrMode:p.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});y.include(g.PiUtils);y.include(m.Gamma);y.include(n.MainLighting,{useLegacyTerrainShading:!1});y.include(h.CloudsParallaxShading,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1});C.uniforms.add([new e.Float3PassUniform("cameraPosition",(k,q)=>q.camera.eye)]);C.code.add(l.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return y}const z=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=c;a.build=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,r,m,n,p,g,h){const d=c.create(),f=m.create();a.EvaluateAmbientLighting=function(e,l){e=e.fragment;const A=void 0!==l.lightingSphericalHarmonicsOrder?l.lightingSphericalHarmonicsOrder:2;0===A?(e.uniforms.add(new p.Float3PassUniform("lightingAmbientSH0",(t,w)=>b.set(d,w.lighting.sh.r[0],w.lighting.sh.g[0],w.lighting.sh.b[0]))),e.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===A?(e.uniforms.add([new g.Float4PassUniform("lightingAmbientSH_R",(t,w)=>r.set(f,w.lighting.sh.r[0],w.lighting.sh.r[1],w.lighting.sh.r[2],w.lighting.sh.r[3])),new g.Float4PassUniform("lightingAmbientSH_G",(t,w)=>r.set(f,w.lighting.sh.g[0],w.lighting.sh.g[1],w.lighting.sh.g[2],w.lighting.sh.g[3])),new g.Float4PassUniform("lightingAmbientSH_B",(t,w)=>r.set(f,w.lighting.sh.b[0],w.lighting.sh.b[1],w.lighting.sh.b[2],w.lighting.sh.b[3]))]),e.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===A&&(e.uniforms.add([new p.Float3PassUniform("lightingAmbientSH0",(t,w)=>b.set(d,w.lighting.sh.r[0],w.lighting.sh.g[0],w.lighting.sh.b[0])),new g.Float4PassUniform("lightingAmbientSH_R1",(t,w)=>r.set(f,w.lighting.sh.r[1],w.lighting.sh.r[2],w.lighting.sh.r[3],w.lighting.sh.r[4])),new g.Float4PassUniform("lightingAmbientSH_G1",(t,w)=>r.set(f,w.lighting.sh.g[1],w.lighting.sh.g[2],w.lighting.sh.g[3],w.lighting.sh.g[4])),new g.Float4PassUniform("lightingAmbientSH_B1",(t,w)=>r.set(f,w.lighting.sh.b[1],
w.lighting.sh.b[2],w.lighting.sh.b[3],w.lighting.sh.b[4])),new g.Float4PassUniform("lightingAmbientSH_R2",(t,w)=>r.set(f,w.lighting.sh.r[5],w.lighting.sh.r[6],w.lighting.sh.r[7],w.lighting.sh.r[8])),new g.Float4PassUniform("lightingAmbientSH_G2",(t,w)=>r.set(f,w.lighting.sh.g[5],w.lighting.sh.g[6],w.lighting.sh.g[7],w.lighting.sh.g[8])),new g.Float4PassUniform("lightingAmbientSH_B2",(t,w)=>r.set(f,w.lighting.sh.b[5],w.lighting.sh.b[6],w.lighting.sh.b[7],w.lighting.sh.b[8]))]),e.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),l.pbrMode!==n.PBRMode.Normal&&l.pbrMode!==n.PBRMode.Schematic||e.code.add(h.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../util/WebGL2Utils ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){c=c.fromValues(0,.6,.2);a.PBRMode=void 0;(function(A){A[A.Disabled=0]="Disabled";A[A.Normal=1]="Normal";A[A.Schematic=2]="Schematic";A[A.Water=3]="Water";A[A.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";A[A.COUNT=5]="COUNT"})(a.PBRMode||(a.PBRMode={}));l=function(A){function t(){return A.apply(this,arguments)||this}b._inheritsLoose(t,A);return t}(l.GLTextureMaterialBindParameters);a.PBRBindParameters=l;a.PBRSchematicMRRValues=c;a.PhysicallyBasedRenderingParameters=
function(A,t){const w=A.fragment,u=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;t.pbrMode===a.PBRMode.Normal&&u&&A.include(r.VertexTextureCoordinates,t);if(t.pbrMode===a.PBRMode.Schematic)w.code.add(g.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else if(t.pbrMode===a.PBRMode.Disabled)w.code.add(g.glsl`float getBakedOcclusion() { return 1.0; }`);else if(t.pbrMode===a.PBRMode.Normal){w.code.add(g.glsl`vec3 mrr;
vec3 emission;
float occlusion;`);A=t.supportsTextureAtlas?t.hasWebGL2Context?f.TextureSizeUniformType.None:f.TextureSizeUniformType.Size:f.TextureSizeUniformType.None;const z=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(w.uniforms.add(z===e.BindType.Pass?d.createTexture2DPassSizeUniforms("texMetallicRoughness",y=>y.textureMetallicRoughness,A):h.createTexture2DDrawSizeUniforms("texMetallicRoughness",y=>y.textureMetallicRoughness,A)),w.code.add(g.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`));t.hasEmissionTexture&&(w.uniforms.add(z===e.BindType.Pass?d.createTexture2DPassSizeUniforms("texEmission",y=>y.textureEmissive,A):h.createTexture2DDrawSizeUniforms("texEmission",y=>y.textureEmissive,A)),w.code.add(g.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`));t.hasOcclusionTexture?(w.uniforms.add(z===e.BindType.Pass?d.createTexture2DPassSizeUniforms("texOcclusion",y=>y.textureOcclusion,A):h.createTexture2DDrawSizeUniforms("texOcclusion",y=>y.textureOcclusion,A)),w.code.add(g.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):w.code.add(g.glsl`float getBakedOcclusion() { return 1.0; }`);w.uniforms.add(z===e.BindType.Pass?[new p.Float3PassUniform("emissionFactor",y=>y.emissiveFactor),new p.Float3PassUniform("mrrFactors",y=>y.mrrFactors)]:[new n.Float3DrawUniform("emissionFactor",y=>y.emissiveFactor),new n.Float3DrawUniform("mrrFactors",y=>y.mrrFactors)]);w.code.add(g.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${u?g.glsl`vtc.uv = vuv0;`:""}
      ${t.hasMetallicRoughnessTextureTransform?g.glsl`vtc.uv = metallicRoughnessUV;`:""}
      ${t.hasMetallicRoughnessTexture?t.supportsTextureAtlas?g.glsl`
                vtc.size = ${m.textureSize(t,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:g.glsl`applyMetallnessAndRoughness(vtc);`:""}
      ${t.hasEmissiveTextureTransform?g.glsl`vtc.uv = emissiveUV;`:""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?g.glsl`
                vtc.size = ${m.textureSize(t,"texEmission")};
                applyEmission(vtc);`:g.glsl`applyEmission(vtc);`:""}
      ${t.hasOcclusionTextureTransform?g.glsl`vtc.uv = occlusionUV;`:""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?g.glsl`
                vtc.size = ${m.textureSize(t,"texOcclusion")};
                applyOcclusion(vtc);`:g.glsl`applyOcclusion(vtc);`:""}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function c(u){const z=new Float32Array(3);z[0]=u[0];z[1]=u[1];z[2]=u[2];return z}function r(u,z,y){const B=new Float32Array(3);B[0]=u;B[1]=z;B[2]=y;return B}function m(u,z){return new Float32Array(u,z,3)}function n(){return b()}function p(){return r(1,1,1)}function g(){return r(1,0,0)}function h(){return r(0,
1,0)}function d(){return r(0,0,1)}const f=b(),e=p(),l=g(),A=h(),t=d(),w=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,zeros:n,ones:p,unitX:g,unitY:h,unitZ:d,ZEROS:f,ONES:e,UNIT_X:l,UNIT_Y:A,UNIT_Z:t},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=l;a.UNIT_Y=A;a.UNIT_Z=t;a.ZEROS=f;a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.ones=p;a.unitX=g;a.unitY=h;a.unitZ=d;a.vec3f32=w;a.zeros=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports",
"../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,r,m){a.VertexTextureCoordinates=function(n,p){n.include(c.TextureCoordinateAttribute,p);n.fragment.code.add(m.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${p.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);switch(p.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:case c.TextureCoordinateAttributeType.Compressed:n.fragment.code.add(m.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:n.include(r.TextureAtlasLookup);n.fragment.code.add(m.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);break;default:b.neverReached(p.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.extensions.add("GL_EXT_shader_texture_lod");c.extensions.add("GL_OES_standard_derivatives");
c.fragment.code.add(b.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec3",r.BindType.Draw,(h,d,f,e)=>h.setUniform3fv(p,g(d,f,e)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Float3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../shaderLibrary/util/WebGL2Utils ./Float2DrawUniform ./TextureSizeUniformType ./Uniform ../shaderTechnique/BindType".split(" "),function(a,b,c,r,m,n,p,g,h,d){let f=function(l){function A(t,w){return l.call(this,
t,"sampler2D",d.BindType.Draw,(u,z,y)=>u.bindTexture(t,w(z,y)))||this}b._inheritsLoose(A,l);return A}(h.Uniform);const e=m.create();a.Texture2DDrawUniform=f;a.createTexture2DDrawSizeUniforms=function(l,A,t=g.TextureSizeUniformType.None){const w=[new f(l,A)];t&g.TextureSizeUniformType.Size&&w.push(new p.Float2DrawUniform(l+n.TEXTURE_SIZE_UNIFORM_SUFFIX,(u,z)=>{u=A(u,z);return c.isSome(u)?r.set(e,u.descriptor.width,u.descriptor.height):m.ZEROS}));t&g.TextureSizeUniformType.InvSize&&w.push(new p.Float2DrawUniform(l+
n.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX,(u,z)=>{u=A(u,z);return c.isSome(u)?r.set(e,1/u.descriptor.width,1/u.descriptor.height):m.ZEROS}));return w};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec2",
r.BindType.Draw,(h,d,f,e)=>h.setUniform2fv(p,g(d,f,e)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Float2DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,c,r,m,n,p){p=function(h){function d(e){var l=
h.call(this,e)||this;l._numLoading=0;l._disposed=!1;l._textureRepository=e.textureRep;l._textureId=e.textureId;l._acquire(e.textureId,A=>l._texture=A);l._acquire(e.normalTextureId,A=>l._textureNormal=A);l._acquire(e.emissiveTextureId,A=>l._textureEmissive=A);l._acquire(e.occlusionTextureId,A=>l._textureOcclusion=A);l._acquire(e.metallicRoughnessTextureId,A=>l._textureMetallicRoughness=A);return l}b._inheritsLoose(d,h);var f=d.prototype;f.dispose=function(){this._texture=c.releaseMaybe(this._texture);
this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};f.ensureResources=function(e){return 0===this._numLoading?n.ResourceState.LOADED:n.ResourceState.LOADING};f.updateTexture=function(e){if(c.isNone(this._texture)||e!==this._texture.id)this._texture=c.releaseMaybe(this._texture),
this._textureId=e,this._acquire(this._textureId,l=>this._texture=l)};f._acquire=function(e,l){c.isNone(e)?l(null):(e=this._textureRepository.acquire(e),r.isPromiseLike(e)?(++this._numLoading,e.then(A=>{this._disposed?(c.releaseMaybe(A),l(null)):l(A)}).finally(()=>--this._numLoading)):l(e))};b._createClass(d,[{key:"textureBindParameters",get:function(){return new g(c.isSome(this._texture)?this._texture.glTexture:null,c.isSome(this._textureNormal)?this._textureNormal.glTexture:null,c.isSome(this._textureEmissive)?
this._textureEmissive.glTexture:null,c.isSome(this._textureOcclusion)?this._textureOcclusion.glTexture:null,c.isSome(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}}]);return d}(p);let g=function(h){function d(f=null,e=null,l=null,A=null,t=null){var w=h.call(this)||this;w.texture=f;w.textureNormal=e;w.textureEmissive=l;w.textureOcclusion=A;w.textureMetallicRoughness=t;return w}b._inheritsLoose(d,h);return d}(m.NoParameters);a.GLTextureMaterial=p;a.GLTextureMaterialBindParameters=
g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b){return function(){function c(m){this._material=m.material;this._techniqueRepository=m.techniqueRep;this._output=m.output}var r=c.prototype;r.dispose=function(){this._techniqueRepository.release(this._technique)};r.ensureTechnique=function(m,n,p=this._output){return this._technique=
this._techniqueRepository.releaseAndAcquire(m,this._material.getConfiguration(p,n),this._technique)};r.ensureResources=function(m){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",get:function(){return this._technique}},{key:"_stippleTextureRepository",get:function(){return this._techniqueRepository.constructionContext.stippleTextureRepository}}]);return c}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],
function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../../../environment/CloudsData ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.CloudsParallaxShading=function(A){A=A.fragment;A.uniforms.add([new e.Matrix4PassUniform("rotationMatrixClouds",(t,w)=>w.cloudsFade.parallax.transform),new e.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(t,w)=>w.cloudsFade.parallaxNew.transform),new h.Float3PassUniform("anchorPosition",(t,w)=>w.cloudsFade.parallax.anchorPointClouds),new h.Float3PassUniform("anchorPositionCrossFade",(t,w)=>w.cloudsFade.parallaxNew.anchorPointClouds),new d.FloatPassUniform("cloudsHeight",
(t,w)=>w.cloudsFade.parallax.cloudsHeight),new d.FloatPassUniform("radiusCurvatureCorrectionFactor",(t,w)=>w.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new d.FloatPassUniform("totalFadeInOut",(t,w)=>w.cloudsFade.fadeInOut.stage===m.FadeInOutStages.FINISHED?w.cloudsFade.fadeInOutHeight.factor+1-w.cloudsFade.fadeIn.factor:w.cloudsFade.fadeInOutHeight.factor+1-w.cloudsFade.fadeInOut.factor),new d.FloatPassUniform("crossFadeAnchorFactor",(t,w)=>b.clamp(w.cloudsFade.crossFade.factor,0,1)),new l.TextureCubePassUniform("cubeMap",
(t,w)=>c.isSome(w.cloudsFade.data)&&c.isSome(w.cloudsFade.data.cubeMap)?w.cloudsFade.data.cubeMap.colorTexture:null),new g.BooleanPassUniform("crossFade",(t,w)=>w.cloudsFade.crossFade.enabled),new g.BooleanPassUniform("readChannelsRG",(t,w)=>w.cloudsFade.readChannels===n.CloudsTextureChannels.RG),new g.BooleanPassUniform("fadeTextureChannels",(t,w)=>w.cloudsFade.renderingStage===n.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)]);A.constants.add("planetRadius","float",r.earth.radius);A.code.add(f.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);A.code.add(f.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);A.code.add(f.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);p.addMainLightDirection(A);p.addMainLightIntensity(A);A.code.add(f.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);A.code.add(f.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);A.code.add(f.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);A.code.add(f.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);A.code.add(f.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat4f64","../../../chunks/vec3f64","./CloudsData"],function(a,b,c,r,m){let n=function(){function g(){this.readChannels=m.CloudsTextureChannels.RG;this.renderingStage=m.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=
r.create();this.isCameraPositionFinal=!0;this.parallax=new p;this.parallaxNew=new p;this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:1,distanceThresholdFactor:.6};this.fadeIn={stage:a.FadeInStages.FINISHED,factor:1,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}}b._createClass(g,[{key:"isFading",get:function(){return this.fadeInOut.stage===a.FadeInOutStages.FADE_OUT||this.fadeInOut.stage===
a.FadeInOutStages.FADE_IN||this.fadeIn.stage===a.FadeInStages.FADE_IN||this.fadeInOutHeight.stage!==a.FadeHeightStages.FINISHED||this.renderingStage===m.CloudsRenderingStages.FADING_TEXTURE_CHANNELS}}]);return g}();a.FadeInStages=void 0;(function(g){g[g.FINISHED=0]="FINISHED";g[g.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";g[g.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(g){g[g.FINISHED=0]="FINISHED";g[g.FADE_OUT=1]="FADE_OUT";g[g.SWITCH=2]="SWITCH";g[g.FADE_IN=
3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages={}));a.FadeHeightStages=void 0;(function(g){g[g.FINISHED=0]="FINISHED";g[g.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages={}));let p=function(){this.anchorPointClouds=r.create();this.cloudsHeight=1E5;this.radiusCurvatureCorrectionFactor=0;this.transform=c.create()};a.CloudsFadeParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsData":function(){define(["exports",
"../../../core/maybe"],function(a,b){a.CloudsRenderingStages=void 0;(function(c){c[c.RENDERING=0]="RENDERING";c[c.FINISHED_RENDERING=1]="FINISHED_RENDERING";c[c.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS";c[c.SWITCH_CHANNELS=3]="SWITCH_CHANNELS";c[c.FINISHED=4]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(c){c[c.RG=0]="RG";c[c.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(c){return b.isSome(c)&&
!c.running};a.isReadyCloudsData=function(c){return b.isSome(c)&&b.isSome(c.cubeMap)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"bool",r.BindType.Pass,(h,d,f)=>h.setUniform1b(p,g(d,f)))||this}b._inheritsLoose(n,
m);return n}(c.Uniform);a.BooleanPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"samplerCube",r.BindType.Pass,(h,d,f)=>h.bindTexture(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);
a.TextureCubePassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ../../../chunks/Clouds.glsl ./CloudsData ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){a.CloudsGenerator=function(N){function H(I){I=N.call(this,I)||this;I.runOncePerFrame=!0;I._handles=new m;I._techniques=[];I._techniqueConfiguration=new x.CloudsTechniqueConfiguration;I._bindParameters=new D.BindParameters(null,null,null);I._passParameters=new B.CloudsPassParameters;I._drawParameters=new B.CloudsDrawParameters;I._weatherTile=u.create();I._weatherTileCount=128;I._faceIndex=0;I._tileIndex=0;I.coverage=n.lerp(k.cloudPresets.default.coverage[0],
k.cloudPresets.default.coverage[1],.5);I.density=n.lerp(k.cloudPresets.default.density[0],k.cloudPresets.default.density[1],.5);I.absorption=n.lerp(k.cloudPresets.default.absorption[0],k.cloudPresets.default.absorption[1],.5);I.cloudSize=n.lerp(k.cloudPresets.default.cloudSize[0],k.cloudPresets.default.cloudSize[1],.5);I.detailSize=n.lerp(k.cloudPresets.default.detailSize[0],k.cloudPresets.default.detailSize[1],.5);I.smoothness=n.lerp(k.cloudPresets.default.smoothness[0],k.cloudPresets.default.smoothness[1],
.5);I.cloudHeight=n.lerp(k.cloudPresets.default.cloudHeight[0],k.cloudPresets.default.cloudHeight[1],.5);I.raymarchingSteps=k.cloudPresets.default.raymarchingSteps;I._viewMatrix=t.create();I._dirty=!1;I.running=!1;return I}b._inheritsLoose(H,N);var E=H.prototype;E._getTechnique=function(I){const M=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,Q=M===C.CloudsTextureChannels.RG?2*I:2*I+1,T=this._techniques[Q];if(T)return T;this._techniqueConfiguration.writeTextureChannels=M;this._techniqueConfiguration.steps=
I;this._techniques[Q]=new q.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[Q]};E.updateWeatherTile=function(){w.set(this._weatherTile,(this.view.camera.position.latitude+90)/180,(this.view.camera.position.longitude+180)/360);var I=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]);this._weatherTile[1]=
Math.floor(4*(this._weatherTileCount-I)*this._weatherTile[1]);var M=I=0;p.isSome(this.view.environment)&&"virtual"!==this.view.environment.lighting.type&&p.isSome(this.view.environment.lighting.date)&&(M=new Date(this.view.environment.lighting.date),M.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),I=31*M.getUTCMonth()+M.getUTCDate(),M=M.getUTCFullYear());this._weatherTile[0]=(this._weatherTile[0]+I)%(2*this._weatherTileCount);this._weatherTile[1]=
(this._weatherTile[1]+M%100)%(4*this._weatherTileCount);w.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()};E.initialize=function(){this._vao=F.createQuadVAO(this.context.renderContext.rctx);const I=y.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*I.radius;this.setDirty();this.updateWeatherTile();this._handles.add([this.view.resourceController.scheduler.registerTask(G.TaskPriority.CLOUDS_GENERATOR,this),g.watch(()=>[this.coverage,this.density,
this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),g.initial)])};E.destroy=function(){this._handles.destroy();this._techniques.forEach(I=>p.releaseMaybe(I));this._frameBufferCube=p.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao=p.disposeMaybe(this._vao);this._passParameters.noiseTexture=p.destroyMaybe(this._passParameters.noiseTexture)};E._ensureNoiseTexture=function(){p.isSome(this._passParameters.noiseTexture)||
(this._passParameters.noiseTexture=new v.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return p.isSome(this._passParameters.noiseTexture.textureAtlas)};E._ensureFrameBufferCube=function(I){p.isNone(this._frameBufferCube)&&(this._frameBufferCube=new L.FramebufferObject(this.context.renderContext.rctx,{colorTarget:J.TargetType.CUBEMAP,width:I,height:I},{target:J.TextureType.TEXTURE_CUBE_MAP,pixelFormat:J.PixelFormat.RGBA,
dataType:J.PixelType.UNSIGNED_BYTE,wrapMode:J.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:J.TextureSamplingMode.LINEAR,hasMipmap:!1,width:I,height:I}));return this._frameBufferCube};E.destroyFrameBufferCube=function(){this._frameBufferCube=p.disposeMaybe(this._frameBufferCube)};E.applyPreset=function(I,M){const Q=I.median,T=S=>{const U=n.lerp(S[0],S[1],Q);return.5>M?n.lerp(S[0],U,2*M):n.lerp(U,S[1],2*(M-.5))};this.coverage=T(I.coverage);this.density=T(I.density);this.absorption=T(I.absorption);this.cloudSize=
T(I.cloudSize);this.detailSize=T(I.detailSize);this.smoothness=T(I.smoothness);this.cloudHeight=T(I.cloudHeight);this.raymarchingSteps=I.raymarchingSteps};E.setDirty=function(){this._dirty=this.running=!0};E.runTask=function(I){if(p.isNone(this._vao))this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=C.CloudsRenderingStages.FINISHED_RENDERING;else{0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),
w.copy(this._passParameters.weatherTile,this._weatherTile));var M=this._getTechnique(this._passParameters.raymarchingSteps);if(M.compiled&&this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal&&!this.context.renderContext.bindParameters.cloudsFade.isFading&&this._ensureNoiseTexture()){0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=C.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=
this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);var Q=this.context.renderContext.rctx,T=Q.bindTechnique(M,this._passParameters,this._bindParameters);Q.bindVAO(this._vao);T.assertCompatibleVertexAttributeLocations(this._vao);var S=Q.getViewport();M=M.configuration.cubeMapSize;var U=M/
this._tilesPerFace;Q.setViewport(0,this._tileIndex*U,M,U);M=this._ensureFrameBufferCube(M);Q.bindFramebuffer(M);A.targetTo(this._viewMatrix,P,K[this._faceIndex],O[this._faceIndex]);l.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);M.setColorTextureTarget(J.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);T.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);Q.gl.drawArrays(Q.gl.TRIANGLE_STRIP,0,4);Q.gl.flush();Q.setViewport(S.x,S.y,S.width,S.height);this.requestRender();
I.madeProgress();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=C.CloudsRenderingStages.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0)}}};b._createClass(H,[{key:"_tilesPerFace",get:function(){switch(this._techniqueConfiguration.steps){case x.RayMarchingSteps.SIXTEEN:return 1;case x.RayMarchingSteps.HUNDRED:return 4;
case x.RayMarchingSteps.COUNT:case x.RayMarchingSteps.TWOHUNDRED:return 8}}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return H}(r);c.__decorate([h.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);c.__decorate([h.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([h.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"coverage",void 0);
c.__decorate([h.property()],a.CloudsGenerator.prototype,"density",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,
"raymarchingSteps",void 0);c.__decorate([h.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=c.__decorate([e.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const K=[z.fromValues(1,0,0),z.fromValues(-1,0,0),z.fromValues(0,1,0),z.fromValues(0,-1,0),z.fromValues(0,0,1)],O=[z.fromValues(0,1,0),z.fromValues(0,1,0),z.fromValues(0,0,-1),z.fromValues(0,0,1),z.fromValues(0,1,0)],P=z.zeros();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function c(N,H){N[0]=H[0];N[1]=H[1];N[2]=H[2];N[3]=H[4];N[4]=H[5];N[5]=H[6];N[6]=H[8];N[7]=H[9];N[8]=H[10];return N}function r(N,H){N[0]=H[0];N[1]=H[1];N[2]=H[2];N[3]=H[3];N[4]=H[4];N[5]=H[5];N[6]=H[6];N[7]=H[7];N[8]=H[8];return N}function m(N,H,E,I,M,Q,T,S,U,Y){N[0]=H;N[1]=E;N[2]=I;N[3]=M;N[4]=Q;N[5]=T;N[6]=S;N[7]=U;N[8]=Y;return N}function n(N){N[0]=1;N[1]=0;N[2]=0;N[3]=0;N[4]=1;N[5]=0;N[6]=0;N[7]=0;N[8]=1;return N}function p(N,
H){if(N===H){const E=H[1],I=H[2],M=H[5];N[1]=H[3];N[2]=H[6];N[3]=E;N[5]=H[7];N[6]=I;N[7]=M}else N[0]=H[0],N[1]=H[3],N[2]=H[6],N[3]=H[1],N[4]=H[4],N[5]=H[7],N[6]=H[2],N[7]=H[5],N[8]=H[8];return N}function g(N,H){const E=H[0],I=H[1],M=H[2],Q=H[3],T=H[4],S=H[5],U=H[6],Y=H[7];H=H[8];const V=H*T-S*Y,R=-H*Q+S*U,X=Y*Q-T*U;let W=E*V+I*R+M*X;if(!W)return null;W=1/W;N[0]=V*W;N[1]=(-H*I+M*Y)*W;N[2]=(S*I-M*T)*W;N[3]=R*W;N[4]=(H*E-M*U)*W;N[5]=(-S*E+M*Q)*W;N[6]=X*W;N[7]=(-Y*E+I*U)*W;N[8]=(T*E-I*Q)*W;return N}function h(N,
H){const E=H[0],I=H[1],M=H[2],Q=H[3],T=H[4],S=H[5],U=H[6],Y=H[7];H=H[8];N[0]=T*H-S*Y;N[1]=M*Y-I*H;N[2]=I*S-M*T;N[3]=S*U-Q*H;N[4]=E*H-M*U;N[5]=M*Q-E*S;N[6]=Q*Y-T*U;N[7]=I*U-E*Y;N[8]=E*T-I*Q;return N}function d(N){const H=N[3],E=N[4],I=N[5],M=N[6],Q=N[7],T=N[8];return N[0]*(T*E-I*Q)+N[1]*(-T*H+I*M)+N[2]*(Q*H-E*M)}function f(N,H,E){const I=H[0],M=H[1],Q=H[2],T=H[3],S=H[4],U=H[5],Y=H[6],V=H[7];H=H[8];const R=E[0],X=E[1],W=E[2],aa=E[3],ba=E[4],ia=E[5],ma=E[6],ha=E[7];E=E[8];N[0]=R*I+X*T+W*Y;N[1]=R*M+X*
S+W*V;N[2]=R*Q+X*U+W*H;N[3]=aa*I+ba*T+ia*Y;N[4]=aa*M+ba*S+ia*V;N[5]=aa*Q+ba*U+ia*H;N[6]=ma*I+ha*T+E*Y;N[7]=ma*M+ha*S+E*V;N[8]=ma*Q+ha*U+E*H;return N}function e(N,H,E){const I=H[0],M=H[1],Q=H[2],T=H[3],S=H[4],U=H[5],Y=H[6],V=H[7];H=H[8];const R=E[0];E=E[1];N[0]=I;N[1]=M;N[2]=Q;N[3]=T;N[4]=S;N[5]=U;N[6]=R*I+E*T+Y;N[7]=R*M+E*S+V;N[8]=R*Q+E*U+H;return N}function l(N,H,E){const I=H[0],M=H[1],Q=H[2],T=H[3],S=H[4],U=H[5],Y=H[6],V=H[7];H=H[8];const R=Math.sin(E);E=Math.cos(E);N[0]=E*I+R*T;N[1]=E*M+R*S;N[2]=
E*Q+R*U;N[3]=E*T-R*I;N[4]=E*S-R*M;N[5]=E*U-R*Q;N[6]=Y;N[7]=V;N[8]=H;return N}function A(N,H,E){const I=E[0],M=E[1];E=E[2];N[0]=I*H[0];N[1]=I*H[1];N[2]=I*H[2];N[3]=M*H[3];N[4]=M*H[4];N[5]=M*H[5];N[6]=E*H[6];N[7]=E*H[7];N[8]=E*H[8];return N}function t(N,H,E){const I=E[0];E=E[1];N[0]=I*H[0];N[1]=I*H[1];N[2]=I*H[2];N[3]=E*H[3];N[4]=E*H[4];N[5]=E*H[5];return N}function w(N,H){N[0]=1;N[1]=0;N[2]=0;N[3]=0;N[4]=1;N[5]=0;N[6]=H[0];N[7]=H[1];N[8]=1;return N}function u(N,H){const E=Math.sin(H);H=Math.cos(H);
N[0]=H;N[1]=E;N[2]=0;N[3]=-E;N[4]=H;N[5]=0;N[6]=0;N[7]=0;N[8]=1;return N}function z(N,H){N[0]=H[0];N[1]=0;N[2]=0;N[3]=0;N[4]=H[1];N[5]=0;N[6]=0;N[7]=0;N[8]=1;return N}function y(N,H){N[0]=H[0];N[1]=H[1];N[2]=0;N[3]=H[2];N[4]=H[3];N[5]=0;N[6]=H[4];N[7]=H[5];N[8]=1;return N}function B(N,H){var E=H[0],I=H[1],M=H[2];H=H[3];var Q=E+E,T=I+I;const S=M+M;E*=Q;const U=I*Q;I*=T;const Y=M*Q,V=M*T;M*=S;Q*=H;T*=H;H*=S;N[0]=1-I-M;N[3]=U-H;N[6]=Y+T;N[1]=U+H;N[4]=1-E-M;N[7]=V-Q;N[2]=Y-T;N[5]=V+Q;N[8]=1-E-I;return N}
function C(N,H){const E=H[0],I=H[1],M=H[2],Q=H[4],T=H[5],S=H[6],U=H[8],Y=H[9];H=H[10];const V=H*T-S*Y,R=-H*Q+S*U,X=Y*Q-T*U;var W=E*V+I*R+M*X;if(!W)return null;W=1/W;N[0]=V*W;N[1]=(-H*I+M*Y)*W;N[2]=(S*I-M*T)*W;N[3]=R*W;N[4]=(H*E-M*U)*W;N[5]=(-S*E+M*Q)*W;N[6]=X*W;N[7]=(-Y*E+I*U)*W;N[8]=(T*E-I*Q)*W;return N}function k(N,H){const E=H[0],I=H[1],M=H[2],Q=H[3],T=H[4],S=H[5],U=H[6],Y=H[7];var V=H[8],R=H[9],X=H[10],W=H[11];const aa=H[12],ba=H[13],ia=H[14];H=H[15];const ma=E*S-I*T,ha=E*U-M*T,ka=E*Y-Q*T,Z=I*
U-M*S,ca=I*Y-Q*S,fa=M*Y-Q*U,ea=V*ba-R*aa,da=V*ia-X*aa;V=V*H-W*aa;const la=R*ia-X*ba;R=R*H-W*ba;X=X*H-W*ia;W=ma*X-ha*R+ka*la+Z*V-ca*da+fa*ea;if(!W)return null;W=1/W;N[0]=(S*X-U*R+Y*la)*W;N[1]=(U*V-T*X-Y*da)*W;N[2]=(T*R-S*V+Y*ea)*W;N[3]=(M*R-I*X-Q*la)*W;N[4]=(E*X-M*V+Q*da)*W;N[5]=(I*V-E*R-Q*ea)*W;N[6]=(ba*fa-ia*ca+H*Z)*W;N[7]=(ia*ka-aa*fa-H*ha)*W;N[8]=(aa*ca-ba*ka+H*ma)*W;return N}function q(N,H,E){N[0]=2/H;N[1]=0;N[2]=0;N[3]=0;N[4]=-2/E;N[5]=0;N[6]=-1;N[7]=1;N[8]=1;return N}function x(N){return"mat3("+
N[0]+", "+N[1]+", "+N[2]+", "+N[3]+", "+N[4]+", "+N[5]+", "+N[6]+", "+N[7]+", "+N[8]+")"}function v(N){return Math.sqrt(N[0]**2+N[1]**2+N[2]**2+N[3]**2+N[4]**2+N[5]**2+N[6]**2+N[7]**2+N[8]**2)}function D(N,H,E){N[0]=H[0]+E[0];N[1]=H[1]+E[1];N[2]=H[2]+E[2];N[3]=H[3]+E[3];N[4]=H[4]+E[4];N[5]=H[5]+E[5];N[6]=H[6]+E[6];N[7]=H[7]+E[7];N[8]=H[8]+E[8];return N}function F(N,H,E){N[0]=H[0]-E[0];N[1]=H[1]-E[1];N[2]=H[2]-E[2];N[3]=H[3]-E[3];N[4]=H[4]-E[4];N[5]=H[5]-E[5];N[6]=H[6]-E[6];N[7]=H[7]-E[7];N[8]=H[8]-
E[8];return N}function G(N,H,E){N[0]=H[0]*E;N[1]=H[1]*E;N[2]=H[2]*E;N[3]=H[3]*E;N[4]=H[4]*E;N[5]=H[5]*E;N[6]=H[6]*E;N[7]=H[7]*E;N[8]=H[8]*E;return N}function J(N,H,E,I){N[0]=H[0]+E[0]*I;N[1]=H[1]+E[1]*I;N[2]=H[2]+E[2]*I;N[3]=H[3]+E[3]*I;N[4]=H[4]+E[4]*I;N[5]=H[5]+E[5]*I;N[6]=H[6]+E[6]*I;N[7]=H[7]+E[7]*I;N[8]=H[8]+E[8]*I;return N}function L(N,H){return N[0]===H[0]&&N[1]===H[1]&&N[2]===H[2]&&N[3]===H[3]&&N[4]===H[4]&&N[5]===H[5]&&N[6]===H[6]&&N[7]===H[7]&&N[8]===H[8]}function K(N,H){const E=N[0],I=
N[1],M=N[2],Q=N[3],T=N[4],S=N[5],U=N[6],Y=N[7];N=N[8];const V=H[0],R=H[1],X=H[2],W=H[3],aa=H[4],ba=H[5],ia=H[6],ma=H[7];H=H[8];const ha=b.getEpsilon();return Math.abs(E-V)<=ha*Math.max(1,Math.abs(E),Math.abs(V))&&Math.abs(I-R)<=ha*Math.max(1,Math.abs(I),Math.abs(R))&&Math.abs(M-X)<=ha*Math.max(1,Math.abs(M),Math.abs(X))&&Math.abs(Q-W)<=ha*Math.max(1,Math.abs(Q),Math.abs(W))&&Math.abs(T-aa)<=ha*Math.max(1,Math.abs(T),Math.abs(aa))&&Math.abs(S-ba)<=ha*Math.max(1,Math.abs(S),Math.abs(ba))&&Math.abs(U-
ia)<=ha*Math.max(1,Math.abs(U),Math.abs(ia))&&Math.abs(Y-ma)<=ha*Math.max(1,Math.abs(Y),Math.abs(ma))&&Math.abs(N-H)<=ha*Math.max(1,Math.abs(N),Math.abs(H))}function O(N){const H=b.getEpsilon(),E=N[0],I=N[1],M=N[2],Q=N[3],T=N[4],S=N[5],U=N[6],Y=N[7];N=N[8];return Math.abs(1-(E*E+Q*Q+U*U))<=H&&Math.abs(1-(I*I+T*T+Y*Y))<=H&&Math.abs(1-(M*M+S*S+N*N))<=H}const P=Object.freeze(Object.defineProperty({__proto__:null,fromMat4:c,copy:r,set:m,identity:n,transpose:p,invert:g,adjoint:h,determinant:d,multiply:f,
translate:e,rotate:l,scale:A,scaleByVec2:t,fromTranslation:w,fromRotation:u,fromScaling:z,fromMat2d:y,fromQuat:B,normalFromMat4Legacy:C,normalFromMat4:k,projection:q,str:x,frob:v,add:D,subtract:F,multiplyScalar:G,multiplyScalarAndAdd:J,exactEquals:L,equals:K,isOrthoNormal:O,mul:f,sub:F},Symbol.toStringTag,{value:"Module"}));a.add=D;a.adjoint=h;a.copy=r;a.determinant=d;a.equals=K;a.exactEquals=L;a.frob=v;a.fromMat2d=y;a.fromMat4=c;a.fromQuat=B;a.fromRotation=u;a.fromScaling=z;a.fromTranslation=w;a.identity=
n;a.invert=g;a.isOrthoNormal=O;a.mat3=P;a.mul=f;a.multiply=f;a.multiplyScalar=G;a.multiplyScalarAndAdd=J;a.normalFromMat4=k;a.normalFromMat4Legacy=C;a.projection=q;a.rotate=l;a.scale=A;a.scaleByVec2=t;a.set=m;a.str=x;a.sub=F;a.subtract=F;a.translate=e;a.transpose=p})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ../core/maybe ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(q){const x=new w.ShaderBuilder;x.include(f.ScreenSpacePass,!1);const v=x.fragment;v.uniforms.add([new l.FloatPassUniform("cloudRadius",D=>D.cloudRadius),new l.FloatPassUniform("power",D=>c.lerp(35,120,D.absorption)),new l.FloatPassUniform("sigmaE",D=>1+D.absorption),new l.FloatPassUniform("density",D=>c.lerp(0,.3,D.density)),new l.FloatPassUniform("cloudSize",D=>c.lerp(0,.02,Math.max(.01,1-D.cloudSize))),new l.FloatPassUniform("detailSize",D=>
c.lerp(0,.2,Math.max(.01,1-D.detailSize))),new l.FloatPassUniform("smoothness",D=>c.lerp(0,.5,1-D.smoothness)),new l.FloatPassUniform("cloudHeight",D=>c.lerp(0,1500,D.cloudHeight)),new l.FloatPassUniform("coverage",D=>D.coverage),new t.Matrix3DrawUniform("view",D=>D.viewMatrix),new u.Texture2DPassUniform("cloudShapeTexture",D=>r.isSome(D.noiseTexture)?D.noiseTexture.textureAtlas:null),new e.Float2PassUniform("cloudVariables",D=>n.set(C,D.coverage,D.absorption))]);v.constants.add("halfCubeMapSize",
"float",.5*q.cubeMapSize);v.code.add(A.glsl`
    const int STEPS = ${q.steps===h.RayMarchingSteps.SIXTEEN?A.glsl`16`:q.steps===h.RayMarchingSteps.HUNDRED?A.glsl`100`:A.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);v.code.add(A.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${A.glsl.float(d.ATLAS_SIZE)};
      const float dataWidth = ${A.glsl.float(d.ATLAS_SIZE)};
      const float tileRows = ${A.glsl.float(d.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${A.glsl.float(d.TILE_SIZE)}, ${A.glsl.float(d.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${A.glsl.float(d.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${A.glsl.float(d.WEATHER_MAP_SCALE)} * p) / ${A.glsl.float(d.ATLAS_SIZE)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `);v.code.add(A.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);v.code.add(A.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);v.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
v.code.add(A.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);v.code.add(A.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);v.code.add(A.glsl`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return x}let y=function(q){function x(){var v=q.apply(this,arguments)||this;v.cloudRadius=0;v.cloudSize=0;v.detailSize=0;v.absorption=0;v.density=0;v.smoothness=0;v.cloudHeight=0;v.coverage=0;v.raymarchingSteps=g.cloudPresets.default.raymarchingSteps;v.weatherTile=p.create();return v}b._inheritsLoose(x,q);return x}(A.NoParameters),B=function(q){function x(){var v=q.apply(this,arguments)||this;v.viewMatrix=m.create();return v}b._inheritsLoose(x,q);return x}(A.NoParameters);const C=p.create(),k=
Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:y,CloudsDrawParameters:B,build:z},Symbol.toStringTag,{value:"Module"}));a.Clouds=k;a.CloudsDrawParameters=B;a.CloudsPassParameters=y;a.build=z})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){let c=function(m,n,p,g,h,d,f,e,l=.5){this.coverage=m;this.density=n;this.absorption=p;this.cloudSize=g;this.detailSize=h;this.smoothness=d;this.cloudHeight=f;this.raymarchingSteps=
e;this.median=l};const r=new c([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN);b={sunny:r,cloudy:new c([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new c([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new c([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new c([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,
.3],b.RayMarchingSteps.SIXTEEN),default:r};a.CloudPresets=c;a.cloudPresets=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ./CloudsData ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),function(a,b,c,r,m,n){a.RayMarchingSteps=void 0;(function(g){g[g.SIXTEEN=
0]="SIXTEEN";g[g.HUNDRED=1]="HUNDRED";g[g.TWOHUNDRED=2]="TWOHUNDRED";g[g.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let p=function(g){function h(){var d=g.apply(this,arguments)||this;d.steps=a.RayMarchingSteps.SIXTEEN;d.writeTextureChannels=m.CloudsTextureChannels.RG;return d}b._inheritsLoose(h,g);return h}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.RayMarchingSteps.COUNT})],p.prototype,"steps",void 0);c.__decorate([n.parameter({constValue:r("esri-mobile")?
1024:2048})],p.prototype,"cubeMapSize",void 0);c.__decorate([n.parameter()],p.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(b)),r=(b+2)*c;a.ATLAS_SIZE=r;a.TEXTURE_SCALE=b/128;a.TILE_ROWS=c;a.TILE_SIZE=b;a.WEATHER_MAP_SCALE=
r/1560;a.WEATHER_MAP_SIZE=1E5;a.WEATHER_TILE_SIZE=128;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(r,m=!0){r.attributes.add(c.VertexAttribute.POSITION,"vec2");m&&r.varyings.add("uv","vec2");r.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${m?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"mat3",r.BindType.Draw,(h,d,f)=>h.setUniformMatrix3fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h,
d,f){p=function(e){function l(t,w){var u;return u=e.call(this,t,w,()=>u.destroy())||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new h.Program(t.rctx,l.shader.get().build(this.configuration),g.Default3D)};A.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(d.BlendFactor.CONSTANT_COLOR,d.BlendFactor.ONE_MINUS_CONSTANT_COLOR,d.BlendOperation.ADD,this.configuration.writeTextureChannels===m.CloudsTextureChannels.RG?[1,1,0,
0]:[0,0,1,1]),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return l}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(r.Clouds,()=>new Promise((e,l)=>a(["./Clouds.glsl"],e,l)));b.CloudsTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){a.NoiseTextureAtlas=function(z){function y(C){var k=z.call(this,C)||this;k._needsRender=!0;k._passParameters=new f.NoiseTextureAtlasPassParameters;k._frameBuffer=new u.FramebufferObject(C.context.renderContext.rctx,{colorTarget:w.TargetType.TEXTURE,width:l.ATLAS_SIZE,height:l.ATLAS_SIZE},{target:w.TextureType.TEXTURE_2D,pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:w.TextureSamplingMode.LINEAR,
hasMipmap:!1,width:l.ATLAS_SIZE,height:l.ATLAS_SIZE});k._vao=t.createQuadVAO(C.context.renderContext.rctx);return k}b._inheritsLoose(y,z);var B=y.prototype;B._setDirty=function(){this._needsRender=!0};B.updateWeatherMap=function(C){if(this._passParameters.weatherTile[0]!==C[0]||this._passParameters.weatherTile[1]!==C[1])d.copy(this._passParameters.weatherTile,C),this._setDirty()};B.destroy=function(){this._fullTechniqueCached=m.releaseMaybe(this._fullTechniqueCached);this._weatherMapTechniqueCached=
m.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=m.disposeMaybe(this._frameBuffer);this._vao=m.disposeMaybe(this._vao)};B._render=function(C){if(m.isNone(this._vao)||m.isNone(this._frameBuffer))return null;var k=C===e.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;C=this.context.renderContext.rctx;const q=C.getViewport();C.setViewport(0,0,l.ATLAS_SIZE,l.ATLAS_SIZE);C.bindFramebuffer(this._frameBuffer);k=C.bindTechnique(k,this._passParameters,null);C.bindVAO(this._vao);
k.assertCompatibleVertexAttributeLocations(this._vao);C.gl.drawArrays(C.gl.TRIANGLE_STRIP,0,4);C.setViewport(q.x,q.y,q.width,q.height);this._needsRender=!1;return this._frameBuffer.colorTexture};b._createClass(y,[{key:"_techniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"textureAtlas",get:function(){m.isSome(this._texture)?m.isSome(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(e.NoiseTextureRenderMode.WeatherMap)):
m.isSome(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(e.NoiseTextureRenderMode.Full));return this._texture}},{key:"_fullTechnique",get:function(){if(m.isNone(this._fullTechniqueCached)){const C=new e.NoiseTextureAtlasTechniqueConfiguration;C.mode=e.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(A.NoiseTextureAtlasTechnique,C)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(m.isNone(this._weatherMapTechniqueCached)){const C=
new e.NoiseTextureAtlasTechniqueConfiguration;C.mode=e.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(A.NoiseTextureAtlasTechnique,C)}return this._weatherMapTechniqueCached}}]);return y}(r);c.__decorate([n.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);c.__decorate([n.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=c.__decorate([h.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(l){const A=new h.ShaderBuilder;A.include(n.ScreenSpacePass,!1);A.fragment.code.add(g.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);l.mode===r.NoiseTextureRenderMode.Full&&A.fragment.code.add(g.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${g.glsl.float(m.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${g.glsl.float(8)});

      float worley0 = worley(p, ${g.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${g.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${g.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${g.glsl.float(2)});
      float worley1 = worley(p, ${g.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${g.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${g.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);A.fragment.uniforms.add(new p.Float2PassUniform("weatherTile",t=>t.weatherTile));A.fragment.code.add(g.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${g.glsl.float(m.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${g.glsl.float(m.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${g.glsl.float(m.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);A.fragment.code.add(g.glsl`void main() {`);l.mode===r.NoiseTextureRenderMode.Full&&A.fragment.code.add(g.glsl`
        float padWidth = 1.0;
        float paddedSize = ${g.glsl.float(m.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${g.glsl.float(m.TILE_ROWS)} * ${g.glsl.float(m.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${g.glsl.float(m.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${g.glsl.float(m.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${g.glsl.float(m.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${g.glsl.float(m.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${g.glsl.float(m.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${g.glsl.float(m.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${g.glsl.float(m.TILE_ROWS)} * ${g.glsl.float(m.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${g.glsl.float(m.TILE_ROWS)} * ${g.glsl.float(m.TILE_ROWS)});
        p = p_;
        p.z /= (${g.glsl.float(m.TILE_ROWS)} * ${g.glsl.float(m.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);A.fragment.code.add(g.glsl`
      vec2 mapUV = ${g.glsl.float(m.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${g.glsl.float(m.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${l.mode===r.NoiseTextureRenderMode.Full?g.glsl`gl_FragColor.ba = vec2(0.0, map);`:g.glsl`gl_FragColor = vec4(map);`};
    }
  `);return A}let f=function(l){function A(){var t=l.apply(this,arguments)||this;t.weatherTile=c.fromValues(0,0);return t}b._inheritsLoose(A,l);return A}(g.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=e;a.NoiseTextureAtlasPassParameters=f;a.build=d})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){a.NoiseTextureRenderMode=void 0;(function(n){n[n.Full=0]="Full";n[n.WeatherMap=1]="WeatherMap";n[n.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.mode=a.NoiseTextureRenderMode.Full;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter({count:a.NoiseTextureRenderMode.COUNT})],
m.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){p=function(e){function l(){return e.apply(this,arguments)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new h.Program(t.rctx,l.shader.get().build(this.configuration),g.Default3D)};A.initializePipeline=function(){return f.makePipelineState({blending:this.configuration.mode===m.NoiseTextureRenderMode.Full?f.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO):f.separateBlendingParams(d.BlendFactor.ZERO,d.BlendFactor.ONE,d.BlendFactor.ONE,
d.BlendFactor.ZERO),depthTest:{func:d.CompareFunction.ALWAYS},colorWrite:f.defaultColorWriteParams})};return l}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(r.NoiseTextureAtlas,()=>new Promise((e,l)=>a(["./NoiseTextureAtlas.glsl"],e,l)));b.NoiseTextureAtlasTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(y){return null!=y&&"type"in y&&"texture"===y.type}function l(y){return null!=y&&"type"in y&&"renderbuffer"===y.type}function A(y){return e(y)||null!=y&&"pixelFormat"in y}function t(y,B){y.target!==g.TextureType.TEXTURE_2D&&y.target!==g.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===y.width&&B.height===y.height||console.error("Color attachment texture must match the framebuffer's!"):
(B.width=y.width,B.height=y.height)}function w(y,B){void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===y.width&&B.height===y.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(B.width=y.width,B.height=y.height)}function u(y){return y.descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:g.TextureType.TEXTURE_2D}let z=function(){function y(C,k,q=null,x=null){this._context=C;this._stencilAttachment=this._depthAttachment=
this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=null;this._initialized=!1;this._desc={...k};C.instanceCounter.increment(g.ResourceType.FramebufferObject,this);if(r.isSome(q))for(Array.isArray(q)||(q=[q]),C=0;C<q.length;++C){k=q[C];const v=g.ColorAttachment.COLOR_ATTACHMENT0+C;let D;A(k)?(e(k)?(D=k.descriptor,this._colorAttachments.set(v,k)):(D=k,this._colorAttachments.set(v,new d.Texture(this._context,D))),t(D,this._desc)):(l(k)?(D=k.descriptor,this._colorAttachments.set(v,
k)):(D=k,this._colorAttachments.set(v,new h.Renderbuffer(this._context,D))),w(D,this._desc));this._validateColorAttachmentPoint(v)}r.isSome(x)&&(A(x)?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),e(x)?(q=x.descriptor,this._depthStencilTexture=x):(q=x,this._depthStencilTexture=new d.Texture(this._context,q)),t(q,this._desc)):(l(x)?q=x.descriptor:(q=x,x=new h.Renderbuffer(this._context,q)),C=this._desc.depthStencilTarget??
g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,C===g.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=x:C===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER||C===g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=x:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=C,w(q,this._desc)))}var B=y.prototype;B.dispose=function(){if(this._desc){var C=
this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(C);this._context.instanceCounter.decrement(g.ResourceType.FramebufferObject,this);this._desc=null}};B.getColorTexture=function(C){return(C=this._colorAttachments.get(C))&&e(C)?C:null};B.attachColorTexture=function(C,k=g.ColorAttachment.COLOR_ATTACHMENT0){C&&(this._validateColorAttachmentPoint(k),
t(C.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(C.glName,k)),this._colorAttachments.set(k,C))};B.detachColorTexture=function(C=g.ColorAttachment.COLOR_ATTACHMENT0){const k=this._colorAttachments.get(C);if(e(k))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,C)),this._colorAttachments.delete(C),k};B.setColorTextureTarget=function(C,k=g.ColorAttachment.COLOR_ATTACHMENT0){const q=
this._colorAttachments.get(k);e(q)&&this._framebufferTexture2D(q.glName,k,C)};B.attachDepthStencilTexture=function(C){if(!r.isNone(C)){var k=C.descriptor;k.pixelFormat!==g.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");k.dataType!==g.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
t(k,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(C.glName,g.DepthStencilAttachment));this._depthStencilTexture=C}};B.detachDepthStencilTexture=function(){const C=this._depthStencilTexture;C&&this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(null,g.DepthStencilAttachment));this._depthStencilTexture=null;return C};B.attachDepthStencilBuffer=function(C){if(!r.isNone(C)){var k=C.descriptor;k.internalFormat!==g.RenderbufferFormat.DEPTH_STENCIL&&k.internalFormat!==g.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");w(k,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=k.internalFormat===g.RenderbufferFormat.DEPTH_STENCIL?g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:
g.DepthStencilTargetType.DEPTH_RENDER_BUFFER;this._initialized&&(this._context.bindFramebuffer(this),k=this._context.gl,k.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?k.DEPTH_ATTACHMENT:k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,C.glName));this._depthAttachment=C}};B.detachDepthStencilBuffer=function(){const C=this._context.gl,k=this._depthAttachment;k&&this._initialized&&(this._context.bindFramebuffer(this),C.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?C.DEPTH_ATTACHMENT:C.DEPTH_STENCIL_ATTACHMENT,C.RENDERBUFFER,null));this._depthAttachment=null;return k};B.detachAll=function(){this._colorAttachments.forEach((C,k)=>this._detachColorAttachment(k));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};B.copyToTexture=function(C,k,q,x,v,D,F){(0>C||0>k||0>v||0>D)&&console.error("Offsets cannot be negative!");(0>=q||0>=x)&&console.error("Copy width and height must be greater than zero!");
var G=this._desc;const J=F.descriptor;F.descriptor.target!==g.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==G?.width||null==G?.height||null==J?.width||null==J?.height||C+q>G.width||k+x>G.height||v+q>J.width||D+x>J.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");G=this._context;F=G.bindTexture(F,d.Texture.TEXTURE_UNIT_FOR_UPDATES);G.setActiveTexture(d.Texture.TEXTURE_UNIT_FOR_UPDATES);G.bindFramebuffer(this);
G.gl.copyTexSubImage2D(g.TextureType.TEXTURE_2D,0,v,D,C,k,q,x);G.bindTexture(F,d.Texture.TEXTURE_UNIT_FOR_UPDATES)};B.readPixels=function(C,k,q,x,v,D,F){(0>=q||0>=x)&&console.error("Copy width and height must be greater than zero!");F||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(C,k,q,x,v,D,F)};B.readPixelsAsync=function(){var C=b._asyncToGenerator(function*(k,q,x,v,D,F,G){if(this._context.type!==p.ContextType.WEBGL2)n.webglDebugEnabled()&&
console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(k,q,x,v,D,F,G);else{var J=this._context.gl,L=m.BufferObject.createPixelPack(this._context,g.Usage.STREAM_READ,G.byteLength);this._context.bindBuffer(L);this._context.bindFramebuffer(this);J.readPixels(k,q,x,v,D,F,0);this._context.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);yield L.getSubDataAsync(G);L.dispose()}});return function(k,q,x,v,D,F,G){return C.apply(this,arguments)}}();B.resize=function(C,
k){const q=this._desc;if(q.width!==C||q.height!==k)if(this._initialized){q.width=C;q.height=k;this._colorAttachments.forEach(x=>{x&&x.resize(C,k)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(C,k);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(C,k),this._stencilAttachment&&this._stencilAttachment.resize(C,k);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else q.width=
C,q.height=k,this._colorAttachments.forEach(x=>{x&&x.resize(C,k)}),this._depthStencilTexture&&this._depthStencilTexture.resize(C,k)};B.initializeAndBind=function(C=g.FramebufferTarget.FRAMEBUFFER){const k=this._context.gl;if(this._initialized)k.bindFramebuffer(C,this.glName);else{this._glName&&k.deleteFramebuffer(this._glName);var q=this._context,x=k.createFramebuffer(),v=this._desc,D=v.colorTarget??g.TargetType.RENDER_BUFFER,F=v.width??1,G=v.height??1;k.bindFramebuffer(C,x);0===this._colorAttachments.size&&
(D===g.TargetType.TEXTURE||D===g.TargetType.CUBEMAP?this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,new d.Texture(q,{target:this.descriptor.colorTarget===g.TargetType.CUBEMAP?g.TextureType.TEXTURE_CUBE_MAP:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,width:v.width,height:v.height})):(D=new h.Renderbuffer(q,{internalFormat:g.SizedPixelFormat.RGBA4,width:F,
height:G}),this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,D)));this._colorAttachments.forEach((J,L)=>{J&&(e(J)?this._framebufferTexture2D(J.glName,L,u(J),C):k.framebufferRenderbuffer(C,L,k.RENDERBUFFER,J.glName))});D=v.depthStencilTarget??g.DepthStencilTargetType.NONE;switch(D){case g.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new h.Renderbuffer(q,{internalFormat:v.depthStencilTarget===
g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?g.RenderbufferFormat.DEPTH_COMPONENT16:g.RenderbufferFormat.DEPTH_STENCIL,width:F,height:G}));k.framebufferRenderbuffer(C,D===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?k.DEPTH_ATTACHMENT:k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,this._depthAttachment.glName);break;case g.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new h.Renderbuffer(q,{internalFormat:g.RenderbufferFormat.STENCIL_INDEX8,width:F,height:G}));
k.framebufferRenderbuffer(C,k.STENCIL_ATTACHMENT,k.RENDERBUFFER,this._stencilAttachment.glName);break;case g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(q.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new d.Texture(q,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.DEPTH_STENCIL,dataType:g.PixelType.UNSIGNED_INT_24_8,
samplingMode:g.TextureSamplingMode.NEAREST,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,width:F,height:G})),this._framebufferTexture2D(this._depthStencilTexture.glName,k.DEPTH_STENCIL_ATTACHMENT,u(this._depthStencilTexture),C)}n.webglDebugEnabled()&&k.checkFramebufferStatus(C)!==k.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=x;this._initialized=!0}};B._framebufferTexture2D=function(C,k=g.ColorAttachment.COLOR_ATTACHMENT0,q=g.TextureType.TEXTURE_2D,x=g.FramebufferTarget.FRAMEBUFFER,
v=0){this._context.gl.framebufferTexture2D(x,k,q,C,v)};B._detachColorAttachment=function(C){n.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const k=this._context.gl,q=this._colorAttachments.get(C);e(q)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,C)):this._initialized&&(this._context.bindFramebuffer(this),k.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,C,k.RENDERBUFFER,
null));this._colorAttachments.delete(C);return q};B._disposeColorAttachments=function(){this._colorAttachments.forEach((C,k)=>{this._detachColorAttachment(k);C.dispose()});this._colorAttachments.clear()};B._disposeDepthStencilAttachments=function(){const C=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),C.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?C.DEPTH_ATTACHMENT:
C.DEPTH_STENCIL_ATTACHMENT,C.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),C.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,C.STENCIL_ATTACHMENT,C.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,C.DEPTH_STENCIL_ATTACHMENT)),
this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};B._validateColorAttachmentPoint=function(C){if(-1===y._MAX_COLOR_ATTACHMENTS){const k=this._context.capabilities.drawBuffers;y._MAX_COLOR_ATTACHMENTS=k?this._context.gl.getParameter(k.MAX_COLOR_ATTACHMENTS):1}C-=g.ColorAttachment.COLOR_ATTACHMENT0;C+1>y._MAX_COLOR_ATTACHMENTS&&c.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${C+1}. Implementation supports up to ${y._MAX_COLOR_ATTACHMENTS} color attachments`)};
b._createClass(y,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const C=this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0);return C&&e(C)?C:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",
get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width??0}},{key:"height",get:function(){return this._desc.height??0}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((C,[,k])=>C+f.getGpuMemoryUsage(k),0)+f.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return y}();z._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Renderbuffer":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util","./enums"],function(a,b,c,r,m){let n=function(){function p(h,d){this._context=h;this._desc=d;this.type="renderbuffer";this._context.instanceCounter.increment(m.ResourceType.Renderbuffer,this);h=this._context.gl;this.glName=h.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,height:e,internalFormat:l,multisampled:A}=d;if(A){if(this._context.type!==r.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");
h.renderbufferStorageMultisample(h.RENDERBUFFER,this.samples,l,f,e)}else h.renderbufferStorage(h.RENDERBUFFER,l,f,e)}var g=p.prototype;g.resize=function(h,d){const f=this._desc;if(f.width!==h||f.height!==d)f.width=h,f.height=d,h=this._context.gl,this._context.bindRenderbuffer(this),f.multisampled?h.renderbufferStorageMultisample(h.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):h.renderbufferStorage(h.RENDERBUFFER,f.internalFormat,f.width,f.height)};g.dispose=function(){this._context&&
(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(m.ResourceType.Renderbuffer,this),this._context=c.nullifyNonNullableForDispose(this._context))};b._createClass(p,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const h=this._desc.samples,d=this._context.parameters.maxSamples;return h?Math.min(h,d):d}}]);return p}();a.Renderbuffer=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./RenderSlot ../lighting/SceneLighting".split(" "),function(a,b,c,r,m,n,p,g,h){let d=function(){function f(e,l,A){this.shadowMap=e;this.ssaoHelper=
l;this.slicePlane=A;this.slot=g.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this._inverseViewport=c.create();this.oldLighting=new h.SceneLighting;this.newLighting=new h.SceneLighting;this._fadedLighting=new h.SceneLighting;this._lighting=this.newLighting;this.ssr=new p.SSRUniforms;this.multipassTerrain=new n.MultipassTerrainUniforms;this.multipassGeometry=new m.MultipassGeometryUniforms;this.overlays=[];this.cloudsFade=new r.CloudsFadeParameters}f.prototype.fadeLighting=
function(e){const {oldLighting:l,newLighting:A}=this;1<=e?this._lighting=A:(this._fadedLighting.lerpLighting(l,A,e),this._lighting=this._fadedLighting)};b._createClass(f,[{key:"camera",get:function(){return this._camera},set:function(e){this._camera=this.ssr.camera=e;this._inverseViewport[0]=1/e.fullViewport[2];this._inverseViewport[1]=1/e.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",
get:function(){return this._lighting===this._fadedLighting}}]);return f}();a.BindParameters=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,r,m){a.MultipassGeometryUniforms=function(){this.enabled=
!1};a.multipassGeometryTest=function(n){n.include(b.ReadLinearDepth);n.uniforms.add([new m.Texture2DPassUniform("geometryDepthTexture",(p,g)=>g.multipassGeometry.linearDepthTexture),new c.Float2PassUniform("nearFar",(p,g)=>g.camera.nearFar)]);n.code.add(r.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,r,m){a.MultipassTerrainUniforms=function(){this.cullAboveGround=this.enabled=!1};a.multipassTerrainTest=function(n,p){p.hasMultipassTerrain&&
(n.fragment.include(b.ReadLinearDepth),n.fragment.uniforms.add(new m.Texture2DPassUniform("terrainDepthTexture",(g,h)=>h.multipassTerrain.linearDepthTexture)),n.fragment.uniforms.add(new c.Float2PassUniform("nearFar",(g,h)=>h.camera.nearFar)),n.fragment.uniforms.add(new c.Float2PassUniform("inverseViewport",(g,h)=>h.inverseViewport)),n.fragment.code.add(r.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${p.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,r,m,n,p,g){a.SSRUniforms=
function(){this.reprojectionMatrix=b.create()};a.ScreenSpaceReflections=function(h,d){h=h.fragment;h.include(c.ReadLinearDepth);h.uniforms.add(new r.Float2PassUniform("nearFar",(f,e)=>e.camera.nearFar));h.uniforms.add(new g.Texture2DPassUniform("depthMap",(f,e)=>e.linearDepthTexture));h.uniforms.add(new p.Matrix4PassUniform("proj",(f,e)=>e.ssr.camera.projectionMatrix));h.uniforms.add(new m.FloatPassUniform("invResolutionHeight",(f,e)=>1/e.ssr.camera.height));h.uniforms.add(new p.Matrix4PassUniform("reprojectionMatrix",
(f,e)=>e.ssr.reprojectionMatrix));h.code.add(n.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${d.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=
5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=12]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL";
b[b.HUD_MATERIAL=14]="HUD_MATERIAL";b[b.LABEL_MATERIAL=15]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=16]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";b[b.DRAPED_WATER=19]="DRAPED_WATER";b[b.VOXEL=20]="VOXEL";b[b.MAX_SLOTS=21]="MAX_SLOTS";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),
function(a,b,c,r,m,n,p){let g=function(){this.color=m.create();this.intensity=1},h=function(){this.direction=m.create();this.ambient=new g;this.diffuse=new g},d=function(){function e(){this._shOrder=2;this._legacy=new h;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new n.SphericalHarmonicsAmbientLight;this._mainLight=new n.MainLight(m.create(),m.fromValues(1,0,0),!1)}var l=e.prototype;l.set=function(A){p.combineLights(A,this._shOrder,this._mainLight,this._sphericalHarmonics);r.copy(this._legacy.direction,
this._mainLight.direction);A=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*A;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*A;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*A;r.scale(this._legacy.diffuse.color,this._mainLight.intensity,A);r.copy(f,this._legacy.diffuse.color);r.scale(f,f,.4*this.globalFactor);r.add(this._legacy.ambient.color,this._legacy.ambient.color,f)};l.copyFrom=function(A){this._sphericalHarmonics.r=Array.from(A.sh.r);
this._sphericalHarmonics.g=Array.from(A.sh.g);this._sphericalHarmonics.b=Array.from(A.sh.b);this._mainLight.direction=m.clone(A.mainLight.direction);this._mainLight.intensity=m.clone(A.mainLight.intensity);this._mainLight.castShadows=A.mainLight.castShadows;this._mainLight.specularStrength=A.mainLight.specularStrength;this._mainLight.environmentStrength=A.mainLight.environmentStrength;this.globalFactor=A.globalFactor;this.noonFactor=A.noonFactor};l.lerpLighting=function(A,t,w){r.lerp(this._mainLight.intensity,
A.mainLight.intensity,t.mainLight.intensity,w);this._mainLight.environmentStrength=c.lerp(A.mainLight.environmentStrength,t.mainLight.environmentStrength,w);this._mainLight.specularStrength=c.lerp(A.mainLight.specularStrength,t.mainLight.specularStrength,w);r.copy(this._mainLight.direction,t.mainLight.direction);this._mainLight.castShadows=t.mainLight.castShadows;this.globalFactor=c.lerp(A.globalFactor,t.globalFactor,w);this.noonFactor=c.lerp(A.noonFactor,t.noonFactor,w);if(A.sh.r.length===t.sh.r.length)for(let u=
0;u<t.sh.r.length;u++)this._sphericalHarmonics.r[u]=c.lerp(A.sh.r[u],t.sh.r[u],w),this._sphericalHarmonics.g[u]=c.lerp(A.sh.g[u],t.sh.g[u],w),this._sphericalHarmonics.b[u]=c.lerp(A.sh.b[u],t.sh.b[u],w);else for(A=0;A<t.sh.r.length;A++)this._sphericalHarmonics.r[A]=t.sh.r[A],this._sphericalHarmonics.g[A]=t.sh.g[A],this._sphericalHarmonics.b[A]=t.sh.b[A]};b._createClass(e,[{key:"legacy",get:function(){return this._legacy}},{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",
get:function(){return this._mainLight}}]);return e}();const f=m.create();a.SceneLighting=d;a.ambientBoost=.4;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){a.AmbientLight=function(c=b.create()){this.intensity=c};a.FillLight=function(c=b.create(),r=b.fromValues(.57735,.57735,.57735)){this.intensity=c;this.direction=r};a.MainLight=function(c=
b.create(),r=b.fromValues(.57735,.57735,.57735),m=!0,n=1,p=1){this.intensity=c;this.direction=r;this.castShadows=m;this.specularStrength=n;this.environmentStrength=p};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,c,r,m,n){function p(B){return(B+1)*(B+1)}function g(B){return b.clamp(Math.floor(Math.sqrt(B)-1),0,2)}function h(B,C,k){const q=B[0],x=B[1];B=B[2];k=k||[];k.length=p(C);0<=C&&(k[0]=.28209479177);1<=C&&(k[1]=.4886025119*q,k[2]=.4886025119*B,k[3]=.4886025119*x);2<=C&&(k[4]=1.09254843059*q*x,k[5]=1.09254843059*x*B,k[6]=.31539156525*(3*B*B-1),k[7]=1.09254843059*q*B,k[8]=.54627421529*(q*q-x*x));return k}function d(B,C){B=p(B);C=C||{r:[],g:[],b:[]};C.r.length=C.g.length=C.b.length=B;for(let k=
0;k<B;k++)C.r[k]=C.g[k]=C.b[k]=0;return C}function f(B,C){const k=g(C.r.length);for(const q of B)c.negate(z,q.direction),h(z,k,w),m.elementwiseProduct(w,y),m.scalarProduct(w,q.intensity[0],u),m.add(C.r,u),m.scalarProduct(w,q.intensity[1],u),m.add(C.g,u),m.scalarProduct(w,q.intensity[2],u),m.add(C.b,u);return C}function e(B,C){h(z,0,w);for(const k of B)C.r[0]+=w[0]*y[0]*k.intensity[0]*4*Math.PI,C.g[0]+=w[0]*y[0]*k.intensity[1]*4*Math.PI,C.b[0]+=w[0]*y[0]*k.intensity[2]*4*Math.PI;return C}const l=[],
A=[],t=[],w=[0],u=[0],z=r.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(B,C,k,q){d(C,q);c.set(k.intensity,0,0,0);C=!1;l.length=0;A.length=0;t.length=0;for(const x of B)x instanceof n.MainLight&&!C?(c.copy(k.direction,x.direction),c.copy(k.intensity,x.intensity),k.specularStrength=x.specularStrength,k.environmentStrength=x.environmentStrength,k.castShadows=x.castShadows,C=!0):x instanceof n.MainLight||x instanceof n.FillLight?l.push(x):
x instanceof n.AmbientLight?A.push(x):x instanceof n.SphericalHarmonicsAmbientLight&&t.push(x);f(l,q);e(A,q);for(const x of t)m.add(q.r,x.r),m.add(q.g,x.g),m.add(q.b,x.b)};a.computeCoefficients=h;a.initSHCoefficients=d;a.numberOfCoefficients=p;a.orderFromNumberOfCoefficients=g;a.projectAmbientLights=e;a.projectFillLights=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=
function(b,c,r){r=r||b;r.length=b.length;for(let m=0;m<b.length;m++)r[m]=b[m]+c[m];return r};a.dotProduct=function(b,c){let r=0;for(let m=0;m<b.length;m++)r+=b[m]*c[m];return r};a.elementwiseProduct=function(b,c,r){r=r||b;r.length=b.length;for(let m=0;m<b.length;m++)r[m]=b[m]*c[m];return r};a.scalarProduct=function(b,c,r){r=r||b;r.length=b.length;for(let m=0;m<b.length;m++)r[m]=b[m]*c;return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){a.Fog=function(q){function x(D){var F=q.call(this,D)||this;F._passParameters=new t.FogHazePassParameters;F._vao=y.createQuadVAO(D.context.renderContext.rctx,z.Pos2Tex);D=l.getReferenceEllipsoid(D.view.spatialReference);F._planetRadius=D.radius;F._atmosphereRadius=D.radius+A.atmosphereHeight;return F}b._inheritsLoose(x,q);var v=x.prototype;v.destroy=function(){this._thickFogTechniqueCached=n.releaseMaybe(this._thickFogTechniqueCached);this._vao=n.disposeMaybe(this._vao)};
v.render=function(D,F){this._update(D,F);if(!(0>=this._passParameters.fogAmount)){var G=this._thickFogTechnique;if(G.compiled){var J=D.offscreenRenderingHelper;J.renderDepthDetached(()=>{this._passParameters.depthTexture=J.depthTexture;const L=D.rctx.bindTechnique(G,this._passParameters,D.bindParameters);this._renderFog(L,D)})}else this.context.requestRender()}};v._renderFog=function(D,F){n.isNone(this._vao)||(F=F.rctx,F.bindVAO(this._vao),D.assertCompatibleVertexAttributeLocations(this._vao),F.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,
0,4))};v._update=function(D,F){var G=D.bindParameters.camera;f.normalize(C,G.eye);D=Math.max(0,f.dot(C,D.bindParameters.lighting.mainLight.direction));const J=F.color;f.scale(k,J,.1);f.lerp(this._passParameters.fogColor,k,J,D);G=f.length(G.eye);this._passParameters.atmosphereC=G*G-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-m.smoothstep(.95*u.weatherHeightLimit,1*u.weatherHeightLimit,Math.abs(G-this._planetRadius)))*F.amount;this._passParameters.fogStrength=F.strength};
x.isSupported=function(D){return D.capabilities.depthTexture};b._createClass(x,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"strength",get:function(){return this._passParameters.fogStrength},set:function(D){this._passParameters.fogStrength=D}},{key:"_thickFogTechnique",get:function(){if(n.isNone(this._thickFogTechniqueCached)){const D=new w.FogHazeTechniqueConfiguration;D.haze=!1;this._thickFogTechniqueCached=this._shaderTechniqueRepository.acquire(w.FogTechnique,
D)}return this._thickFogTechniqueCached}}]);return x}(r);c.__decorate([p.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([p.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([d.subclass("esri.views.3d.environment.Fog")],a.Fog);const C=e.create(),k=e.create();a.FogParameters=function(){this.color=e.create();this.amount=this.strength=0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/FogHaze.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(B){const C=new A.ShaderBuilder;C.attributes.add(w.VertexAttribute.POSITION,"vec2");C.include(n.TextureCoordinateAttribute,{textureCoordinateType:n.TextureCoordinateAttributeType.Default});C.varyings.add("worldRay","vec3");C.varyings.add("eyeDir","vec3");const {vertex:k,fragment:q}=C;k.uniforms.add([new l.Matrix4PassUniform("inverseProjectionMatrix",(x,v)=>v.camera.inverseProjectionMatrix),new l.Matrix4PassUniform("inverseViewMatrix",(x,v)=>c.invert(y,
v.camera.viewMatrix))]);k.code.add(e.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);q.uniforms.add(new f.FloatPassUniform("atmosphereC",x=>x.atmosphereC));q.uniforms.add(new d.Float3PassUniform("cameraPosition",(x,v)=>v.camera.eye));q.uniforms.add(new h.Float2PassUniform("nearFar",(x,v)=>v.camera.nearFar));q.uniforms.add(new t.Texture2DPassUniform("depthTex",x=>x.depthTexture));q.uniforms.add(new f.FloatPassUniform("fogStrength",x=>B.haze?x.hazeStrength:x.fogStrength));q.uniforms.add(new f.FloatPassUniform("fogAmount",x=>B.haze?x.hazeAmount:x.fogAmount));q.uniforms.add(new d.Float3PassUniform("fogColor",
x=>B.haze?x.hazeColor:x.fogColor));C.include(g.Gamma);q.include(p.ReadLinearDepth);q.code.add(e.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);q.code.add(e.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);q.code.add(e.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${B.haze?e.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return C}let z=function(B){function C(){var k=B.apply(this,arguments)||this;k.fogColor=m.create();k.hazeColor=m.create();k.fogStrength=4E-6;k.hazeStrength=4E-6;k.atmosphereC=1;return k}b._inheritsLoose(C,B);return C}(e.NoParameters);const y=r.create();r=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:z,build:u},Symbol.toStringTag,{value:"Module"}));a.FogHazePassParameters=z;a.Haze=r;a.build=u})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){p=function(l){function A(){return l.apply(this,arguments)||this}c._inheritsLoose(A,l);var t=A.prototype;t.initializeProgram=function(w){return new d.Program(w.rctx,A.shader.get().build(this.configuration),h.Default3D)};t.initializePipeline=function(){return this.configuration.haze?e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_COLOR,f.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.SRC_ALPHA,
f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})};return A}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(m.Haze,()=>new Promise((l,A)=>a(["./FogHaze.glsl"],l,A)));m=function(l){function A(){var t=l.apply(this,arguments)||this;t.haze=!1;return t}c._inheritsLoose(A,l);return A}(g.ShaderTechniqueConfiguration);r.__decorate([g.parameter()],m.prototype,"haze",void 0);b.FogHazeTechniqueConfiguration=m;b.FogTechnique=p;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){let B=function(){function q(){this.type=m.AtmosphereType.Panoramic;this._configuration=new g.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new n.SimpleAtmospherePassParameters}var x=q.prototype;x.destroy=function(){this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);this._vao=b.disposeMaybe(this._vao)};x.initializeRenderContext=function(v){this._configuration.geometry=g.SimpleAtmosphereGeometry.Cylinder;this._technique=
v.shaderTechniqueRepository.acquire(p.SimpleAtmosphereTechnique,this._configuration);const D=v.renderContext.rctx;this._vao=this._createVertexArrayObject(D);this._vaoCount=y.vertexCount(this._vao,"geometry");this._passParameters.texture=new z.Texture(D,{pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:u.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},h.earthAtmosphereTextureSimple);v.requestRender()};x.render=function(v){if(!b.isNone(this._vao)&&
!b.isNone(this._passParameters.texture)){var D=v.rctx,F=D.bindTechnique(this._technique,this._passParameters,v.bindParameters),G=C;c.copy(G,v.bindParameters.camera.viewMatrix);G[12]=0;G[13]=0;G[14]=0;G[15]=1;F.setUniformMatrix4fv("view",C);D.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);D.drawArrays(u.PrimitiveType.TRIANGLES,0,this._vaoCount)}};x.renderHaze=function(){return!1};x._createVertexArrayObject=function(v){var D=l.createPolySphereGeometry(1,2,!1);const F=D.indices.get(t.VertexAttribute.POSITION);
for(var G=0;G<F.length;G+=3){var J=F[G];F[G]=F[G+2];F[G+2]=J}D=D.vertexAttributes.get(t.VertexAttribute.POSITION).data;G=k.createBuffer(F.length);J=G.position;for(let L=0;L<F.length;++L){const K=3*F[L];J.set(L,0,D[K]);J.set(L,1,D[K+1]);J.set(L,2,D[K+2])}return new A.VertexArrayObject(v,e.Default3D,{geometry:d.glLayout(k)},{geometry:w.BufferObject.createVertex(v,u.Usage.STATIC_DRAW,G.buffer)})};return q}();const C=r.create(),k=f.newLayout().vec3f(t.VertexAttribute.POSITION);a.PanoramicAtmosphere=B;
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){function w(B){const C=new l.ShaderBuilder,{vertex:k,fragment:q}=C;p.addMainLightDirection(k);B.geometry===m.SimpleAtmosphereGeometry.Underground?(C.attributes.add(t.VertexAttribute.POSITION,"vec2"),C.varyings.add("color","vec4"),k.uniforms.add([new h.Float3PassUniform("cameraPosition",(x,v)=>v.camera.eye),new d.FloatPassUniform("undergroundFadeAlpha",x=>x.undergroundFadeAlpha)]),k.code.add(f.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),q.code.add(f.glsl`void main() {
gl_FragColor = color;
}`)):(C.include(n.Transform,B),C.attributes.add(t.VertexAttribute.POSITION,"vec3"),C.varyings.add("vtc","vec2"),C.varyings.add("falloff","float"),B=B.geometry===m.SimpleAtmosphereGeometry.Cylinder,k.uniforms.add([new e.Matrix4PassUniform("proj",(x,v)=>v.camera.projectionMatrix),new e.Matrix4PassUniform("view",(x,v)=>v.camera.viewMatrix)]),B||(C.varyings.add("innerFactor","float"),k.uniforms.add(new h.Float3PassUniform("silCircleCenter",x=>x.silhouette.center)),k.uniforms.add(new h.Float3PassUniform("silCircleV1",
x=>x.silhouette.v1)),k.uniforms.add(new h.Float3PassUniform("silCircleV2",x=>x.silhouette.v2)),k.uniforms.add(new g.Float2PassUniform("texV",x=>x.texV)),k.uniforms.add(new d.FloatPassUniform("innerScale",x=>x.innerScale))),k.code.add(f.glsl`
		void main(void) {
      ${B?f.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:f.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${f.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${f.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),q.uniforms.add(new A.Texture2DPassUniform("tex",x=>x.texture)),B||q.uniforms.add(new d.FloatPassUniform("altitudeFade",x=>x.altitudeFade)),q.code.add(f.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${B?f.glsl`gl_FragColor = atmosphereColor;`:f.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return C}let u=function(B){function C(){var k=B.apply(this,arguments)||this;k.texV=c.create();k.altitudeFade=0;k.innerScale=0;k.undergroundFadeAlpha=0;k.silhouette=new z;return k}b._inheritsLoose(C,B);return C}(f.NoParameters),z=function(){this.center=r.create();this.v1=r.create();this.v2=r.create()};const y=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:u,SilhouetteCircle:z,build:w},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=z;a.SimpleAtmosphere=
y;a.SimpleAtmospherePassParameters=u;a.build=w})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,c,r,m){a.SimpleAtmosphereGeometry=void 0;(function(n){n[n.Cone=0]="Cone";n[n.Cylinder=1]="Cylinder";n[n.Underground=2]="Underground";n[n.COUNT=
3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));m=function(n){function p(){var g=n.apply(this,arguments)||this;g.geometry=a.SimpleAtmosphereGeometry.Cone;return g}b._inheritsLoose(p,n);return p}(m.DefaultTechniqueConfiguration);c.__decorate([r.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],m.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r,m){let n=function(p){function g(){var h=p.apply(this,arguments)||this;h.hasWebGL2Context=!1;return h}b._inheritsLoose(g,p);return g}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({constValue:!0})],n.prototype,"hasSliceHighlight",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"hasSliceInVertexProgram",
void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"instancedDoublePrecision",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"useLegacyTerrainShading",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"hasModelTransformation",void 0);c.__decorate([m.parameter({constValue:r.BindType.Pass})],n.prototype,"pbrTextureBindType",void 0);c.__decorate([m.parameter()],n.prototype,"hasWebGL2Context",void 0);a.DefaultTechniqueConfiguration=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,c){a.Transform=function(r,m){b.addCalculateLinearDepth(r);m.hasModelTransformation?(r.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),r.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`)):(r.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),r.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,c,r,m){function n(h){h.varyings.add("linearDepth","float")}function p(h){h.vertex.uniforms.add(new r.Float2PassUniform("nearFar",(d,f)=>f.camera.nearFar))}function g(h){h.vertex.code.add(m.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(h,d){const {vertex:f}=h;switch(d.output){case b.ShaderOutput.Color:if(d.receiveShadows){n(h);f.code.add(m.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.Depth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExludeHighlight:h.include(c.VertexPosition,d);n(h);p(h);g(h);f.code.add(m.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}f.code.add(m.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=g;a.addLinearDepth=n;a.addNearFar=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.ShadowHighlight=4]="ShadowHighlight";
b[b.ShadowExludeHighlight=5]="ShadowExludeHighlight";b[b.Highlight=6]="Highlight";b[b.Alpha=7]="Alpha";b[b.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor";b[b.COUNT=9]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(u){function z(){var y=u.apply(this,arguments)||this;y.transformWorldFromViewTH=n.create();y.transformWorldFromViewTL=n.create();y.transformViewFromCameraRelativeRS=c.create();y.transformProjFromView=r.create();return y}b._inheritsLoose(z,u);return z}(f.NoParameters),w=function(u){function z(){var y=u.apply(this,arguments)||this;y.transformWorldFromModelRS=c.create();y.transformWorldFromModelTH=m.create();y.transformWorldFromModelTL=m.create();return y}
b._inheritsLoose(z,u);return z}(f.NoParameters);a.VertexPosition=function(u,z){u.include(p.PositionAttribute);const y=u.vertex;y.include(g.DoublePrecision,z);u.varyings.add("vPositionWorldCameraRelative","vec3");u.varyings.add("vPosition_view","vec3");y.uniforms.add([new d.Float3PassUniform("transformWorldFromViewTH",B=>B.transformWorldFromViewTH),new d.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL),new l.Matrix3PassUniform("transformViewFromCameraRelativeRS",B=>B.transformViewFromCameraRelativeRS),
new A.Matrix4PassUniform("transformProjFromView",B=>B.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",B=>B.transformWorldFromModelRS),new h.Float3DrawUniform("transformWorldFromModelTH",B=>B.transformWorldFromModelTH),new h.Float3DrawUniform("transformWorldFromModelTL",B=>B.transformWorldFromModelTL)]);y.code.add(f.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);y.code.add(f.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${z.spherical?f.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:f.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);u.fragment.uniforms.add(new d.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL));y.code.add(f.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);u.fragment.code.add(f.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=w;a.VertexPositionPassParameters=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(r){r.attributes.add(c.VertexAttribute.POSITION,"vec3");r.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces"],function(a,b,c){a.DoublePrecision=function({code:r},m){m.doublePrecisionRequiresObfuscation?r.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):r.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(r){return b("force-double-precision-obfuscation")?!0:r.driverTest.doublePrecisionRequiresObfuscation};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,
p,"mat3",r.BindType.Pass,(h,d,f)=>h.setUniformMatrix3fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix3PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){p=function(e){function l(){return e.apply(this,arguments)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new h.Program(t.rctx,l.shader.get().build(this.configuration),g.Default3D)};A.initializePipeline=function(){return this.configuration.geometry===m.SimpleAtmosphereGeometry.Cylinder?f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),
culling:f.backFaceCullingParams,depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return l}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(r.SimpleAtmosphere,()=>new Promise((e,l)=>a(["./SimpleAtmosphere.glsl"],e,
l)));b.SimpleAtmosphereTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,
0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,
14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,
0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,
48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,
12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,
37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,
97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,
119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,
164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,
92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,
134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,
242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports",
"../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const r={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(m,n=0){const p=m.stride;return m.fieldNames.filter(g=>{g=m.fields.get(g).optional;return!(g&&g.glPadding)}).map(g=>{const h=m.fields.get(g),d=h.constructor.ElementCount;var f=r[h.constructor.ElementType];if(!f)throw Error("BufferType not supported in WebGL");
return new c.VertexElementDescriptor(g,d,f,h.offset,p,!(!h.optional||!h.optional.glNormalized),n)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,b,c,r){let m=function(){function p(h,d){this.layout=h;this.buffer="number"===typeof d?
new ArrayBuffer(d*h.stride):d;for(const f of h.fieldNames)d=h.fields.get(f),this[f]=new d.constructor(this.buffer,d.offset,this.stride)}var g=p.prototype;g.getField=function(h,d){return(h=this[h])&&h.elementCount===d.ElementCount&&h.elementType===d.ElementType?h:null};g.slice=function(h,d){return new p(this.layout,this.buffer.slice(h*this.stride,d*this.stride))};g.copyFrom=function(h,d,f,e){const l=this.stride;0===l%4?(h=new Uint32Array(h.buffer,d*l,e*l/4),(new Uint32Array(this.buffer,f*l,e*l/4)).set(h)):
(h=new Uint8Array(h.buffer,d*l,e*l),(new Uint8Array(this.buffer,f*l,e*l)).set(h))};b._createClass(p,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return p}(),n=function(){function p(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var g=p.prototype;g.vec2f=function(h,d){this._appendField(h,c.BufferViewVec2f,d);return this};g.vec2f64=function(h,
d){this._appendField(h,c.BufferViewVec2f64,d);return this};g.vec3f=function(h,d){this._appendField(h,c.BufferViewVec3f,d);return this};g.vec3f64=function(h,d){this._appendField(h,c.BufferViewVec3f64,d);return this};g.vec4f=function(h,d){this._appendField(h,c.BufferViewVec4f,d);return this};g.vec4f64=function(h,d){this._appendField(h,c.BufferViewVec4f64,d);return this};g.mat3f=function(h,d){this._appendField(h,c.BufferViewMat3f,d);return this};g.mat3f64=function(h,d){this._appendField(h,c.BufferViewMat3f64,
d);return this};g.mat4f=function(h,d){this._appendField(h,c.BufferViewMat4f,d);return this};g.mat4f64=function(h,d){this._appendField(h,c.BufferViewMat4f64,d);return this};g.vec4u8=function(h,d){this._appendField(h,c.BufferViewVec4u8,d);return this};g.f32=function(h,d){this._appendField(h,c.BufferViewFloat,d);return this};g.f64=function(h,d){this._appendField(h,c.BufferViewFloat64,d);return this};g.u8=function(h,d){this._appendField(h,c.BufferViewUint8,d);return this};g.u16=function(h,d){this._appendField(h,
c.BufferViewUint16,d);return this};g.i8=function(h,d){this._appendField(h,c.BufferViewInt8,d);return this};g.vec2i8=function(h,d){this._appendField(h,c.BufferViewVec2i8,d);return this};g.vec2i16=function(h,d){this._appendField(h,c.BufferViewVec2i16,d);return this};g.vec2u8=function(h,d){this._appendField(h,c.BufferViewVec2u8,d);return this};g.vec4u16=function(h,d){this._appendField(h,c.BufferViewVec4u16,d);return this};g.u32=function(h,d){this._appendField(h,c.BufferViewUint32,d);return this};g._appendField=
function(h,d,f){const e=d.ElementCount*r.elementTypeSize(d.ElementType);this.fields.set(h,{size:e,constructor:d,offset:this.stride,optional:f});this.stride+=e;this.fieldNames.push(h)};g.alignTo=function(h){this.stride=Math.floor((this.stride+h-1)/h)*h;return this};g.hasField=function(h){return this.fieldNames.includes(h)};g.createBuffer=function(h){return new m(this,h)};g.createView=function(h){return new m(this,h)};g.clone=function(){const h=new p;h.stride=this.stride;h.fields=new Map;this.fields.forEach((d,
f)=>h.fields.set(f,d));h.fieldNames=this.fieldNames.slice();h.BufferType=this.BufferType;return h};return p}();a.InterleavedBuffer=m;a.InterleavedLayout=n;a.newLayout=function(){return new n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);h.ElementType="f32";let d=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,
U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);d.ElementType="f32";let f=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);f.ElementType="f32";let e=
function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);e.ElementType="f32";let l=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,
U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(c.BufferViewMat3Impl);l.ElementType="f32";c=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(c.BufferViewMat3Impl);
c.ElementType="f64";let A=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float32Array,S,U,Y,V)||this;S.elementType="f32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(r.BufferViewMat4Impl);A.ElementType="f32";r=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(r.BufferViewMat4Impl);r.ElementType="f64";let t=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);
t.ElementType="f64";let w=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);w.ElementType="f64";let u=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);u.ElementType="f64";let z=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Float64Array,S,U,Y,V)||this;S.elementType="f64";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);
z.ElementType="f64";let y=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint8Array,S,U,Y,V)||this;S.elementType="u8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);y.ElementType="u8";let B=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint8Array,S,U,Y,V)||this;S.elementType="u8";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);B.ElementType="u8";let C=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint8Array,S,U,Y,V)||this;S.elementType="u8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);
C.ElementType="u8";let k=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint8Array,S,U,Y,V)||this;S.elementType="u8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);k.ElementType="u8";let q=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint16Array,S,U,Y,V)||this;S.elementType="u16";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);q.ElementType="u16";let x=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint16Array,S,U,Y,V)||this;S.elementType="u16";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);
x.ElementType="u16";let v=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint16Array,S,U,Y,V)||this;S.elementType="u16";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);v.ElementType="u16";let D=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint16Array,S,U,Y,V)||this;S.elementType="u16";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);D.ElementType="u16";let F=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint32Array,S,U,Y,V)||this;S.elementType="u32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);
F.ElementType="u32";let G=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint32Array,S,U,Y,V)||this;S.elementType="u32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);G.ElementType="u32";let J=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint32Array,S,U,Y,V)||this;S.elementType="u32";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);J.ElementType="u32";let L=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Uint32Array,S,U,Y,V)||this;S.elementType="u32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);
L.ElementType="u32";let K=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int8Array,S,U,Y,V)||this;S.elementType="i8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);K.ElementType="i8";let O=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int8Array,S,U,Y,V)||this;S.elementType="i8";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);O.ElementType="i8";let P=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int8Array,S,U,Y,V)||this;S.elementType="i8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);
P.ElementType="i8";let N=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int8Array,S,U,Y,V)||this;S.elementType="i8";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);N.ElementType="i8";let H=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int16Array,S,U,Y,V)||this;S.elementType="i16";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);H.ElementType="i16";let E=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int16Array,S,U,Y,V)||this;S.elementType="i16";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);
E.ElementType="i16";let I=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int16Array,S,U,Y,V)||this;S.elementType="i16";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);I.ElementType="i16";let M=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int16Array,S,U,Y,V)||this;S.elementType="i16";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);M.ElementType="i16";m=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int32Array,S,U,Y,V)||this;S.elementType="i32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(m.BufferViewScalarImpl);
m.ElementType="i32";n=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int32Array,S,U,Y,V)||this;S.elementType="i32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(n.BufferViewVec2Impl);n.ElementType="i32";p=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int32Array,S,U,Y,V)||this;S.elementType="i32";return S}b._inheritsLoose(T,Q);T.prototype.slice=
function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(p.BufferViewVec3Impl);p.ElementType="i32";g=function(Q){function T(S,U=0,Y,V){S=Q.call(this,Int32Array,S,U,Y,V)||this;S.elementType="i32";return S}b._inheritsLoose(T,Q);T.prototype.slice=function(S,U){return this.sliceBuffer(T,S,U)};T.fromTypedArray=function(S,U){return new T(S.buffer,S.byteOffset,U,S.byteOffset+S.byteLength)};return T}(g.BufferViewVec4Impl);
g.ElementType="i32";a.BufferViewFloat=h;a.BufferViewFloat64=t;a.BufferViewInt16=H;a.BufferViewInt32=m;a.BufferViewInt8=K;a.BufferViewMat3f=l;a.BufferViewMat3f64=c;a.BufferViewMat4f=A;a.BufferViewMat4f64=r;a.BufferViewUint16=q;a.BufferViewUint32=F;a.BufferViewUint8=y;a.BufferViewVec2f=d;a.BufferViewVec2f64=w;a.BufferViewVec2i16=E;a.BufferViewVec2i32=n;a.BufferViewVec2i8=O;a.BufferViewVec2u16=x;a.BufferViewVec2u32=G;a.BufferViewVec2u8=B;a.BufferViewVec3f=f;a.BufferViewVec3f64=u;a.BufferViewVec3i16=
I;a.BufferViewVec3i32=p;a.BufferViewVec3i8=P;a.BufferViewVec3u16=v;a.BufferViewVec3u32=J;a.BufferViewVec3u8=C;a.BufferViewVec4f=e;a.BufferViewVec4f64=z;a.BufferViewVec4i16=M;a.BufferViewVec4i32=g;a.BufferViewVec4i8=N;a.BufferViewVec4u16=D;a.BufferViewVec4u32=L;a.BufferViewVec4u8=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,
b){let c=function(){function r(n,p,g=0,h,d){this.TypedArrayConstructor=n;this.elementCount=9;n=this.TypedArrayConstructor;void 0===h&&(h=9*n.BYTES_PER_ELEMENT);const f=0===p.byteLength?0:g;this.typedBuffer=null==d?new n(p,f):new n(p,f,(d-g)/n.BYTES_PER_ELEMENT);this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var m=r.prototype;m.sliceBuffer=function(n,p,
g=this.count-p){p=this.typedBuffer.byteOffset+p*this.stride;return new n(this.buffer,p,this.stride,p+g*this.stride)};m.getMat=function(n,p){n*=this.typedBufferStride;for(let g=0;9>g;g++)p[g]=this.typedBuffer[n++];return p};m.setMat=function(n,p){n*=this.typedBufferStride;for(let g=0;9>g;g++)this.typedBuffer[n++]=p[g]};m.get=function(n,p){return this.typedBuffer[n*this.typedBufferStride+p]};m.set=function(n,p,g){this.typedBuffer[n*this.typedBufferStride+p]=g};m.copyFrom=function(n,p,g){const h=this.typedBuffer,
d=p.typedBuffer;n*=this.typedBufferStride;p=g*p.typedBufferStride;for(g=0;9>g;++g)h[n++]=d[p++]};b._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n,p,g=0,h,d){this.TypedArrayConstructor=
n;this.elementCount=16;n=this.TypedArrayConstructor;void 0===h&&(h=16*n.BYTES_PER_ELEMENT);const f=0===p.byteLength?0:g;this.typedBuffer=null==d?new n(p,f):new n(p,f,(d-g)/n.BYTES_PER_ELEMENT);this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var m=r.prototype;m.sliceBuffer=function(n,p,g=this.count-p){p=this.typedBuffer.byteOffset+p*this.stride;return new n(this.buffer,
p,this.stride,p+g*this.stride)};m.getMat=function(n,p){n*=this.typedBufferStride;for(let g=0;16>g;g++)p[g]=this.typedBuffer[n++];return p};m.setMat=function(n,p){n*=this.typedBufferStride;for(let g=0;16>g;g++)this.typedBuffer[n++]=p[g]};m.get=function(n,p){return this.typedBuffer[n*this.typedBufferStride+p]};m.set=function(n,p,g){this.typedBuffer[n*this.typedBufferStride+p]=g};m.copyFrom=function(n,p,g){const h=this.typedBuffer,d=p.typedBuffer;n*=this.typedBufferStride;p=g*p.typedBufferStride;for(g=
0;16>g;++g)h[n++]=d[p++]};b._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n,p,g=0,h,d){this.TypedArrayConstructor=n;this.elementCount=1;n=this.TypedArrayConstructor;
void 0===h&&(h=n.BYTES_PER_ELEMENT);const f=0===p.byteLength?0:g;this.typedBuffer=null==d?new n(p,f):new n(p,f,(d-g)/n.BYTES_PER_ELEMENT);this.stride=h;this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}var m=r.prototype;m.sliceBuffer=function(n,p,g=this.count-p){p=this.typedBuffer.byteOffset+p*this.stride;return new n(this.buffer,p,this.stride,p+g*this.stride)};m.get=function(n){return this.typedBuffer[n*this.typedBufferStride]};m.set=
function(n,p){this.typedBuffer[n*this.typedBufferStride]=p};b._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let r=function(){function m(p,g,h=0,d,f){this.TypedArrayConstructor=
p;this.elementCount=2;p=this.TypedArrayConstructor;void 0===d&&(d=2*p.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:h;this.typedBuffer=null==f?new p(g,e):new p(g,e,(f-h)/p.BYTES_PER_ELEMENT);this.typedBufferStride=d/p.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=m.prototype;n.sliceBuffer=function(p,g,h=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new p(this.buffer,
g,this.stride,g+h*this.stride)};n.getVec=function(p,g){p*=this.typedBufferStride;return c.set(g,this.typedBuffer[p],this.typedBuffer[p+1])};n.setVec=function(p,g){p*=this.typedBufferStride;this.typedBuffer[p++]=g[0];this.typedBuffer[p]=g[1]};n.get=function(p,g){return this.typedBuffer[p*this.typedBufferStride+g]};n.set=function(p,g,h){this.typedBuffer[p*this.typedBufferStride+g]=h};n.setValues=function(p,g,h){p*=this.typedBufferStride;this.typedBuffer[p++]=g;this.typedBuffer[p]=h};n.copyFrom=function(p,
g,h){const d=this.typedBuffer,f=g.typedBuffer;p*=this.typedBufferStride;g=h*g.typedBufferStride;d[p++]=f[g++];d[p]=f[g]};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();r.ElementCount=2;a.BufferViewVec2Impl=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,
b,c){let r=function(){function m(p,g,h=0,d,f){this.TypedArrayConstructor=p;this.elementCount=3;p=this.TypedArrayConstructor;void 0===d&&(d=3*p.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:h;this.typedBuffer=null==f?new p(g,e):new p(g,e,(f-h)/p.BYTES_PER_ELEMENT);this.typedBufferStride=d/p.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=m.prototype;n.sliceBuffer=function(p,
g,h=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new p(this.buffer,g,this.stride,g+h*this.stride)};n.getVec=function(p,g){p*=this.typedBufferStride;return c.set(g,this.typedBuffer[p],this.typedBuffer[p+1],this.typedBuffer[p+2])};n.setVec=function(p,g){p*=this.typedBufferStride;this.typedBuffer[p++]=g[0];this.typedBuffer[p++]=g[1];this.typedBuffer[p]=g[2]};n.get=function(p,g){return this.typedBuffer[p*this.typedBufferStride+g]};n.set=function(p,g,h){this.typedBuffer[p*this.typedBufferStride+
g]=h};n.setValues=function(p,g,h,d){p*=this.typedBufferStride;this.typedBuffer[p++]=g;this.typedBuffer[p++]=h;this.typedBuffer[p]=d};n.copyFrom=function(p,g,h){const d=this.typedBuffer,f=g.typedBuffer;p*=this.typedBufferStride;g=h*g.typedBufferStride;d[p++]=f[g++];d[p++]=f[g++];d[p]=f[g]};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();r.ElementCount=3;a.BufferViewVec3Impl=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,b,c){let r=function(){function m(p,g,h=0,d,f){this.TypedArrayConstructor=p;this.start=h;this.elementCount=4;p=this.TypedArrayConstructor;void 0===d&&(d=4*p.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:h;this.typedBuffer=null==f?new p(g,e):new p(g,e,(f-h)/p.BYTES_PER_ELEMENT);this.typedBufferStride=d/p.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/
this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=m.prototype;n.sliceBuffer=function(p,g,h=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new p(this.buffer,g,this.stride,g+h*this.stride)};n.getVec=function(p,g){p*=this.typedBufferStride;return c.set(g,this.typedBuffer[p++],this.typedBuffer[p++],this.typedBuffer[p++],this.typedBuffer[p])};n.setVec=function(p,g){p*=this.typedBufferStride;this.typedBuffer[p++]=g[0];this.typedBuffer[p++]=
g[1];this.typedBuffer[p++]=g[2];this.typedBuffer[p]=g[3]};n.get=function(p,g){return this.typedBuffer[p*this.typedBufferStride+g]};n.set=function(p,g,h){this.typedBuffer[p*this.typedBufferStride+g]=h};n.setValues=function(p,g,h,d,f){p*=this.typedBufferStride;this.typedBuffer[p++]=g;this.typedBuffer[p++]=h;this.typedBuffer[p++]=d;this.typedBuffer[p]=f};n.copyFrom=function(p,g,h){const d=this.typedBuffer,f=g.typedBuffer;p*=this.typedBufferStride;g=h*g.typedBufferStride;d[p++]=f[g++];d[p++]=f[g++];d[p++]=
f[g++];d[p]=f[g]};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();r.ElementCount=4;a.BufferViewVec4Impl=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;
case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;
case "f64":return 1.79769E308}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./basicInterfaces ./BufferVectorMath ./Geometry ./Indices ./Util ./VertexAttribute".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e){function l(k,q,x,v,D,F=c.fromValues(0,
0,0)){var G=k.length;const J=new Float32Array(q.length*G*3+(6*x.length||0)),L=new Float32Array(q.length*G*3+(x?6:0)),K=[],O=[];let P=0;var N=0;const H=c.create(),E=c.create(),I=c.create(),M=c.create(),Q=c.create(),T=c.create(),S=c.create(),U=r.create(),Y=c.create(),V=c.create(),R=c.create(),X=c.create(),W=c.create(),aa=m.create();b.set(Y,0,1,0);b.subtract(E,q[1],q[0]);b.normalize(E,E);D?(b.add(U,q[0],F),b.normalize(I,U)):b.set(I,0,0,1);t(E,I,Y,Y,Q,I,.99619469809);b.copy(M,I);b.copy(X,Q);for(var ba=
0;ba<x.length;ba++)b.scale(T,Q,x[ba][0]),b.scale(U,I,x[ba][2]),b.add(T,T,U),b.add(T,T,q[0]),J[P++]=T[0],J[P++]=T[1],J[P++]=T[2];L[N++]=-E[0];L[N++]=-E[1];L[N++]=-E[2];for(ba=0;ba<v.length;ba++)K.push(0<v[ba][0]?v[ba][0]:-v[ba][0]-1+x.length),K.push(0<v[ba][1]?v[ba][1]:-v[ba][1]-1+x.length),K.push(0<v[ba][2]?v[ba][2]:-v[ba][2]-1+x.length),O.push(0),O.push(0),O.push(0);ba=x.length;const ia=x.length-1;for(let ha=0;ha<q.length;ha++){let ka=!1;0<ha&&(b.copy(H,E),ha<q.length-1?(b.subtract(E,q[ha+1],q[ha]),
b.normalize(E,E)):ka=!0,b.add(V,H,E),b.normalize(V,V),b.add(R,q[ha-1],M),m.fromPositionAndNormal(q[ha],V,aa),m.intersectRay(aa,n.wrap(R,H),U)?(b.subtract(U,U,q[ha]),b.normalize(I,U),b.cross(Q,V,I),b.normalize(Q,Q)):t(V,M,X,Y,Q,I,.99619469809),b.copy(M,I),b.copy(X,Q));D&&(b.add(U,q[ha],F),b.normalize(W,U));for(let Z=0;Z<G;Z++)if(b.scale(T,Q,k[Z][0]),b.scale(U,I,k[Z][1]),b.add(T,T,U),b.normalize(S,T),L[N++]=S[0],L[N++]=S[1],L[N++]=S[2],b.add(T,T,q[ha]),J[P++]=T[0],J[P++]=T[1],J[P++]=T[2],!ka){var ma=
(Z+1)%G;K.push(ba+Z);K.push(ba+G+Z);K.push(ba+ma);K.push(ba+ma);K.push(ba+G+Z);K.push(ba+G+ma);for(ma=0;6>ma;ma++)O.push(K[K.length-6+ma]-ia)}ba+=G}k=q[q.length-1];for(q=0;q<x.length;q++)b.scale(T,Q,x[q][0]),b.scale(U,I,x[q][1]),b.add(T,T,U),b.add(T,T,k),J[P++]=T[0],J[P++]=T[1],J[P++]=T[2];x=N/3;L[N++]=E[0];L[N++]=E[1];L[N++]=E[2];G=ba-G;for(N=0;N<v.length;N++)K.push(0<=v[N][0]?ba+v[N][0]:-v[N][0]-1+G),K.push(0<=v[N][2]?ba+v[N][2]:-v[N][2]-1+G),K.push(0<=v[N][1]?ba+v[N][1]:-v[N][1]-1+G),O.push(x),
O.push(x),O.push(x);return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:J,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:L,exclusive:!0}]],[[e.VertexAttribute.POSITION,K],[e.VertexAttribute.NORMAL,O]])}function A(k,q,x,v,D){if(Math.abs(b.dot(q,k))>D)return!1;b.cross(x,k,q);b.normalize(x,x);b.cross(v,x,k);b.normalize(v,v);return!0}function t(k,q,x,v,D,F,G){return A(k,q,D,F,G)||A(k,x,D,F,G)||A(k,v,D,F,G)}const w=g.Vec3Compact;var u;(function(k){const q=[[-.5,-.5,.5],[.5,-.5,.5],[.5,
.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],x=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],v=[0,0,1,0,1,1,0,1],D=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],F=Array(36);for(var G=0;6>G;G++)for(let L=0;6>L;L++)F[6*G+L]=G;const J=Array(36);for(G=0;6>G;G++)J[6*G]=0,J[6*G+1]=1,J[6*G+2]=2,J[6*G+3]=2,J[6*G+4]=3,J[6*G+5]=0;k.createGeometry=function(L){Array.isArray(L)||(L=[L,L,L]);const K=Array(24);for(let O=0;8>O;O++)K[3*O]=q[O][0]*L[0],K[3*O+1]=q[O][1]*
L[1],K[3*O+2]=q[O][2]*L[2];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:K,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:x}],[e.VertexAttribute.UV0,{size:2,data:v}]],[[e.VertexAttribute.POSITION,D],[e.VertexAttribute.NORMAL,F],[e.VertexAttribute.UV0,J]])}})(u||(u={}));var z;(function(k){const q=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],x=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],v=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],D=
[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];k.createGeometry=function(F){Array.isArray(F)||(F=[F,F,F]);const G=Array(18);for(let J=0;6>J;J++)G[3*J]=q[J][0]*F[0],G[3*J+1]=q[J][1]*F[1],G[3*J+2]=q[J][2]*F[2];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:G,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:x}]],[[e.VertexAttribute.POSITION,v],[e.VertexAttribute.NORMAL,D]])}})(z||(z={}));var y;(function(k){const q=c.fromValues(-.5,0,-.5),x=c.fromValues(.5,0,-.5),v=c.fromValues(0,
0,.5),D=c.fromValues(0,.5,0),F=c.create(),G=c.create(),J=c.create(),L=c.create(),K=c.create();b.subtract(F,q,D);b.subtract(G,q,x);b.cross(J,F,G);b.normalize(J,J);b.subtract(F,x,D);b.subtract(G,x,v);b.cross(L,F,G);b.normalize(L,L);b.subtract(F,v,D);b.subtract(G,v,q);b.cross(K,F,G);b.normalize(K,K);const O=[q,x,v,D],P=[0,-1,0,J[0],J[1],J[2],L[0],L[1],L[2],K[0],K[1],K[2]],N=[0,1,2,3,1,0,3,2,1,3,0,2],H=[0,0,0,1,1,1,2,2,2,3,3,3];k.createGeometry=function(E){Array.isArray(E)||(E=[E,E,E]);const I=Array(12);
for(let M=0;4>M;M++)I[3*M]=O[M][0]*E[0],I[3*M+1]=O[M][1]*E[1],I[3*M+2]=O[M][2]*E[2];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:I,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:P}]],[[e.VertexAttribute.POSITION,N],[e.VertexAttribute.NORMAL,H]])}})(y||(y={}));g=u.createGeometry;z=z.createGeometry;y=y.createGeometry;const B=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],C=c.create();a.cgToGIS=function(k,q=k){var x=k.vertexAttributes;k=x.get(e.VertexAttribute.POSITION).data;if(x=x.get(e.VertexAttribute.NORMAL).data){var v=
q.getMutableAttribute(e.VertexAttribute.NORMAL).data;for(var D=0;D<x.length;D+=3){const F=x[D+1];v[D+1]=-x[D+2];v[D+2]=F}}if(k)for(x=q.getMutableAttribute(e.VertexAttribute.POSITION).data,v=0;v<k.length;v+=3)D=k[v+1],x[v+1]=-k[v+2],x[v+2]=D;return q};a.createBoxGeometry=g;a.createConeGeometry=function(k,q,x,v,D=!0,F=!0){let G=0;var J=c.fromValues(0,G,0),L=c.fromValues(0,G+k,0),K=c.fromValues(0,-1,0),O=c.fromValues(0,1,0);v&&(G=k,L=c.fromValues(0,0,0),J=c.fromValues(0,G,0),K=c.fromValues(0,1,0),O=
c.fromValues(0,-1,0));J=[L,J];K=[K,O];O=x+2;L=Math.sqrt(k*k+q*q);if(v)for(v=x-1;0<=v;v--){var P=2*Math.PI/x*v,N=c.fromValues(Math.cos(P)*q,G,Math.sin(P)*q);J.push(N);P=c.fromValues(k*Math.cos(P)/L,-q/L,k*Math.sin(P)/L);K.push(P)}else for(v=0;v<x;v++)P=2*Math.PI/x*v,N=c.fromValues(Math.cos(P)*q,G,Math.sin(P)*q),J.push(N),P=c.fromValues(k*Math.cos(P)/L,q/L,k*Math.sin(P)/L),K.push(P);k=[];q=[];if(D){for(D=3;D<J.length;D++)k.push(1),k.push(D-1),k.push(D),q.push(0),q.push(0),q.push(0);k.push(J.length-
1);k.push(2);k.push(1);q.push(0);q.push(0);q.push(0)}if(F){for(F=3;F<J.length;F++)k.push(F),k.push(F-1),k.push(0),q.push(F),q.push(F-1),q.push(1);k.push(0);k.push(2);k.push(J.length-1);q.push(1);q.push(2);q.push(K.length-1)}F=new Float32Array(3*O);for(D=0;D<O;D++)F[3*D]=J[D][0],F[3*D+1]=J[D][1],F[3*D+2]=J[D][2];J=new Float32Array(3*O);for(D=0;D<O;D++)J[3*D]=K[D][0],J[3*D+1]=K[D][1],J[3*D+2]=K[D][2];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:F,exclusive:!0}],[e.VertexAttribute.NORMAL,
{size:3,data:J,exclusive:!0}]],[[e.VertexAttribute.POSITION,k],[e.VertexAttribute.NORMAL,q]])};a.createCylinderGeometry=function(k,q,x,v,D,F){v=v?c.clone(v):c.fromValues(1,0,0);D=D?c.clone(D):c.fromValues(0,0,0);F=null==F?!0:F;var G=c.create();b.normalize(G,v);var J=c.create();b.scale(J,G,Math.abs(k));var L=c.create();b.scale(L,J,-.5);b.add(L,L,D);const K=c.fromValues(0,1,0);.2>Math.abs(1-b.dot(G,K))&&b.set(K,0,0,1);const O=c.create();b.cross(O,G,K);b.normalize(O,O);b.cross(K,O,G);k=2*x+(F?2:0);D=
x+(F?2:0);v=new Float32Array(3*k);const P=new Float32Array(3*D),N=new Float32Array(2*k),H=Array(3*x*(F?4:2)),E=Array(3*x*(F?4:2));F&&(v[3*(k-2)]=L[0],v[3*(k-2)+1]=L[1],v[3*(k-2)+2]=L[2],N[2*(k-2)]=0,N[2*(k-2)+1]=0,v[3*(k-1)]=v[3*(k-2)]+J[0],v[3*(k-1)+1]=v[3*(k-2)+1]+J[1],v[3*(k-1)+2]=v[3*(k-2)+2]+J[2],N[2*(k-1)]=1,N[2*(k-1)+1]=1,P[3*(D-2)]=-G[0],P[3*(D-2)+1]=-G[1],P[3*(D-2)+2]=-G[2],P[3*(D-1)]=G[0],P[3*(D-1)+1]=G[1],P[3*(D-1)+2]=G[2]);G=0;const I=c.create(),M=c.create();for(let U=0;U<x;U++){var Q=
2*Math.PI/x*U;b.scale(I,K,Math.sin(Q));b.scale(M,O,Math.cos(Q));b.add(I,I,M);P[3*U]=I[0];P[3*U+1]=I[1];P[3*U+2]=I[2];b.scale(I,I,q);b.add(I,I,L);v[3*U]=I[0];v[3*U+1]=I[1];v[3*U+2]=I[2];N[2*U]=U/x;N[2*U+1]=0;v[3*(U+x)]=v[3*U]+J[0];v[3*(U+x)+1]=v[3*U+1]+J[1];v[3*(U+x)+2]=v[3*U+2]+J[2];N[2*(U+x)]=U/x;N[2*U+1]=1;Q=(U+1)%x;var T=G++,S=U;H[T]=U;E[T]=S;T=G++;S=U;H[T]=U+x;E[T]=S;T=G++;S=Q;H[T]=Q;E[T]=S;T=G++;S=Q;H[T]=Q;E[T]=S;T=G++;S=U;H[T]=U+x;E[T]=S;T=G++;S=Q;H[T]=Q+x;E[T]=S}if(F){for(q=0;q<x;q++)F=(q+
1)%x,J=G++,L=D-2,H[J]=k-2,E[J]=L,J=G++,L=D-2,H[J]=q,E[J]=L,J=G++,L=D-2,H[J]=F,E[J]=L;for(q=0;q<x;q++)F=(q+1)%x,J=G++,L=D-1,H[J]=q+x,E[J]=L,J=G++,L=D-1,H[J]=k-1,E[J]=L,J=G++,L=D-1,H[J]=F+x,E[J]=L}return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:v,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:P,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:N,exclusive:!0}]],[[e.VertexAttribute.POSITION,H],[e.VertexAttribute.NORMAL,E],[e.VertexAttribute.UV0,H]])};a.createDiamondGeometry=z;
a.createExtrudedTriangle=function(k,q,x,v,D=0){const F=Array(18);k=[[-q,D,v/2],[x,D,v/2],[0,k+D,v/2],[-q,D,-v/2],[x,D,-v/2],[0,k+D,-v/2]];for(q=0;6>q;q++)F[3*q]=k[q][0],F[3*q+1]=k[q][1],F[3*q+2]=k[q][2];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:F,exclusive:!0}]],[[e.VertexAttribute.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])};a.createPathExtrusionGeometry=l;a.createPointArrayGeometry=function(k,q){const x=new Float32Array(3*k.length),v=new Float32Array(q?3*
k.length:3),D=Array(k.length),F=Array(k.length).fill(0);for(let G=0;G<k.length;G++)x[3*G]=k[G][0],x[3*G+1]=k[G][1],x[3*G+2]=k[G][2],q&&(v[3*G]=q[G][0],v[3*G+1]=q[G][1],v[3*G+2]=q[G][2]),D[G]=G;q||(v[0]=0,v[1]=1,v[2]=0);return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:x,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:v,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,D],[e.VertexAttribute.NORMAL,q?D:F],[e.VertexAttribute.UV0,
F]],p.PrimitiveType.Point)};a.createPointGeometry=function(k,q,x,v,D,F,G,J){q=q?[q[0],q[1],q[2]]:[0,0,0];k=k?[k[0],k[1],k[2]]:[0,0,1];F=F||[0,0];x=[[e.VertexAttribute.POSITION,{size:3,data:q,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:k,exclusive:!0}],[e.VertexAttribute.UV0,{size:F.length,data:F}],[e.VertexAttribute.COLOR,{size:4,data:x?[255*x[0],255*x[1],255*x[2],3<x.length?255*x[3]:255]:[255,255,255,255],exclusive:!0}],[e.VertexAttribute.SIZE,{size:2,data:null!=v&&2===v.length?v:[1,1]}]];
null!=D&&(D=new Float32Array([D[0],D[1],D[2],D[3]]),x.push([e.VertexAttribute.AUXPOS1,{size:4,data:D}]));null!=G&&(G=new Float32Array([G[0],G[1],G[2],G[3]]),x.push([e.VertexAttribute.AUXPOS2,{size:4,data:G}]));return new h.Geometry(x,null,p.PrimitiveType.Point,J)};a.createPolySphereGeometry=function(k,q,x){function v(J,L){J>L&&([J,L]=[L,J]);const K=J.toString()+"."+L.toString();if(G[K])return G[K];let O=D.length;D.length+=3;w.add(D,3*J,D,3*L,D,O);w.scale(D,O,k/w.length(D,O));O/=3;return G[K]=O}let D;
x?(D=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],x=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(x=k*(1+Math.sqrt(5))/2,D=[-k,x,0,k,x,0,-k,-x,0,k,-x,0,0,-k,x,0,k,x,0,-k,-x,0,k,-x,x,0,-k,x,0,k,-x,0,-k,-x,0,k],x=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var F=0;F<D.length;F+=3)w.scale(D,F,k/w.length(D,F));let G={};for(F=0;F<q;F++){const J=x.length,L=Array(4*J);for(let K=0;K<J;K+=3){const O=x[K],P=x[K+1],
N=x[K+2],H=v(O,P),E=v(P,N),I=v(N,O),M=4*K;L[M]=O;L[M+1]=H;L[M+2]=I;L[M+3]=P;L[M+4]=E;L[M+5]=H;L[M+6]=N;L[M+7]=I;L[M+8]=E;L[M+9]=H;L[M+10]=E;L[M+11]=I}x=L;G={}}q=new Float32Array(D);for(F=0;F<q.length;F+=3)w.normalize(q,F);x=[[e.VertexAttribute.POSITION,x],[e.VertexAttribute.NORMAL,x]];q=[[e.VertexAttribute.POSITION,{size:3,data:new Float32Array(D),exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:q,exclusive:!0}]];return new h.Geometry(q,x)};a.createPolylineGeometry=function(k,q,x){f.assert(1<
k.length,"createPolylineGeometry(): polyline needs at least 2 points");f.assert(3===k[0].length,"createPolylineGeometry(): malformed vertex");f.assert(null==q||q.length===k.length,"createPolylineGeometry: need same number of points and normals");f.assert(null==q||3===q[0].length,"createPolylineGeometry(): malformed normal");var v=new Float64Array(3*k.length);const D=Array(2*(k.length-1));var F=0,G=0;for(var J=0;J<k.length;J++){for(var L=0;3>L;L++)v[F++]=k[J][L];0<J&&(D[G++]=J-1,D[G++]=J)}F=[];G=[];
F.push([e.VertexAttribute.POSITION,D]);G.push([e.VertexAttribute.POSITION,{size:3,data:v,exclusive:!0}]);if(q){v=new Float32Array(3*q.length);J=0;for(L=0;L<k.length;L++)for(let K=0;3>K;K++)v[J++]=q[L][K];F.push([e.VertexAttribute.NORMAL,D]);G.push([e.VertexAttribute.NORMAL,{size:3,data:v,exclusive:!0}])}x&&(G.push([e.VertexAttribute.COLOR,{size:4,data:x}]),F.push([e.VertexAttribute.COLOR,d.generateDefaultIndexArray(x.length/4)]));return new h.Geometry(G,F,p.PrimitiveType.Line)};a.createSphereGeometry=
function(k,q,x,v={uv:!0}){var D=-Math.PI,F=2*Math.PI,G=-Math.PI/2,J=Math.PI;q=Math.max(3,Math.floor(q));const L=Math.max(2,Math.floor(x));var K=(q+1)*(L+1);x=new Float32Array(3*K);const O=new Float32Array(3*K);K=new Float32Array(2*K);const P=[];var N=0;for(var H=0;H<=L;H++){const I=[],M=H/L,Q=G+M*J,T=Math.cos(Q);for(let S=0;S<=q;S++){const U=S/q;var E=D+U*F;const Y=Math.cos(E)*T,V=Math.sin(Q);E=-Math.sin(E)*T;x[3*N]=Y*k;x[3*N+1]=V*k;x[3*N+2]=E*k;O[3*N]=Y;O[3*N+1]=V;O[3*N+2]=E;K[2*N]=U;K[2*N+1]=M;
I.push(N);++N}P.push(I)}k=[];for(D=0;D<L;D++)for(F=0;F<q;F++)G=P[D][F],J=P[D][F+1],N=P[D+1][F+1],H=P[D+1][F],0===D?(k.push(G),k.push(N),k.push(H)):D===L-1?(k.push(G),k.push(J),k.push(N)):(k.push(G),k.push(J),k.push(N),k.push(N),k.push(H),k.push(G));q=[[e.VertexAttribute.POSITION,k],[e.VertexAttribute.NORMAL,k]];x=[[e.VertexAttribute.POSITION,{size:3,data:x,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:O,exclusive:!0}]];v.uv&&(x.push([e.VertexAttribute.UV0,{size:2,data:K,exclusive:!0}]),q.push([e.VertexAttribute.UV0,
k]));v.offset&&(q[0][0]=e.VertexAttribute.OFFSET,x[0][0]=e.VertexAttribute.OFFSET,q.push([e.VertexAttribute.POSITION,Array(k.length).fill(0)]),x.push([e.VertexAttribute.POSITION,{size:3,data:Float64Array.from(v.offset),exclusive:!0}]));return new h.Geometry(x,q)};a.createSquareGeometry=function(k=B){const q=Array(12);for(var x=0;4>x;x++)for(let v=0;3>v;v++)q[3*x+v]=k[x][v];k=[0,1,2,2,3,0];x=[0,0,0,0,0,0];return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:q,exclusive:!0}],[e.VertexAttribute.NORMAL,
{size:3,data:[0,0,1],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[e.VertexAttribute.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[e.VertexAttribute.POSITION,k],[e.VertexAttribute.NORMAL,x],[e.VertexAttribute.UV0,k],[e.VertexAttribute.COLOR,x]])};a.createTetrahedronGeometry=y;a.createTriangleGeometry=function(){return new h.Geometry([[e.VertexAttribute.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,
1,0],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,[0,1,2]],[e.VertexAttribute.NORMAL,[0,0,0]],[e.VertexAttribute.UV0,[0,0,0]]])};a.createTubeGeometry=function(k,q,x,v,D){x=x||10;v=null!=v?v:!0;f.assert(1<k.length);const F=[],G=[];for(let J=0;J<x;J++){F.push([0,-J-1,-((J+1)%x)-1]);const L=J/x*2*Math.PI;G.push([Math.cos(L)*q,Math.sin(L)*q])}return l(G,k,[[0,0,0]],F,v,D)};a.makeOrthoBasisDirUp=A;a.makeOrthoBasisDirUpFallback=t;a.transformInPlace=
function(k,q){k=k.getMutableAttribute(e.VertexAttribute.POSITION).data;for(let x=0;x<k.length;x+=3)b.set(C,k[x],k[x+1],k[x+2]),b.transformMat4(C,C,q),k[x]=C[0],k[x+1]=C[1],k[x+2]=C[2]};a.updatePointGeometry=function(k,q,x,v,D,F,G,J){if(null!=k){const {data:L}=J.getMutableAttribute(e.VertexAttribute.NORMAL);L[0]=k[0];L[1]=k[1];L[2]=k[2]}null!=q&&({data:k}=J.getMutableAttribute(e.VertexAttribute.POSITION),k[0]=q[0],k[1]=q[1],k[2]=q[2]);null!=x&&({data:q}=J.getMutableAttribute(e.VertexAttribute.COLOR),
q[0]=x[0],q[1]=x[1],q[2]=x[2],q[3]=x[3]);null!=v&&({data:x}=J.getMutableAttribute(e.VertexAttribute.SIZE),x[0]=v[0],x[1]=v[1]);null!=D&&({data:v}=J.getMutableAttribute(e.VertexAttribute.AUXPOS1),v[0]=D[0],v[1]=D[1],v[2]=D[2],v[3]=D[3]);null!=F&&({data:D}=J.getMutableAttribute(e.VertexAttribute.UV0),D[0]=F[0],D[1]=F[1]);null!=G&&({data:F}=J.getMutableAttribute(e.VertexAttribute.AUXPOS2),F[0]=G[0],F[1]=G[1],F[2]=G[2],F[3]=G[3])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(c,r){const m=c[r],n=c[r+1];c=c[r+2];return Math.sqrt(m*m+n*n+c*c)};b.normalize=function(c,r){var m=c[r];const n=c[r+1],p=c[r+2];m=1/Math.sqrt(m*m+n*n+p*p);c[r]*=m;c[r+1]*=m;c[r+2]*=m};b.scale=function(c,r,m){c[r]*=m;c[r+1]*=m;c[r+2]*=m};b.add=function(c,r,m,n,p,g=r){p=p||c;p[g]=c[r]+m[n];p[g+1]=c[r+1]+m[n+1];p[g+2]=c[r+2]+m[n+2]};b.subtract=function(c,r,m,
n,p,g=r){p=p||c;p[g]=c[r]-m[n];p[g+1]=c[r+1]-m[n+1];p[g+2]=c[r+2]-m[n+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Indices ./Util ./VertexAttribute".split(" "),function(a,b,c,r,m,n,p,g,
h,d,f){n=function(e){function l(t,w=[],u=r.PrimitiveType.Triangle,z=null,y=-1){var B=e.call(this)||this;B._primitiveType=u;B.objectAndLayerIdColor=z;B.edgeIndicesLength=y;B.type=p.ContentObjectType.Geometry;B._vertexAttributes=new Map;B._indices=new Map;B._boundingInfo=null;for(const [C,k]of t)k&&B._vertexAttributes.set(C,{...k});if(null==w||0===w.length){t=B._vertexAttributes.values().next().value;t=null==t?0:t.data.length/t.size;w=h.generateDefaultIndexArray(t);B.edgeIndicesLength=0>B.edgeIndicesLength?
t:B.edgeIndicesLength;for(const C of B._vertexAttributes.keys())B._indices.set(C,w)}else for(const [C,k]of w)k&&(B._indices.set(C,h.compactIndices(k)),C===f.VertexAttribute.POSITION&&(B.edgeIndicesLength=0>B.edgeIndicesLength?B._indices.get(C).length:B.edgeIndicesLength));return B}b._inheritsLoose(l,e);var A=l.prototype;A.cloneShallow=function(){const t=new l([],void 0,this._primitiveType,this.objectAndLayerIdColor,void 0),{_vertexAttributes:w,_indices:u}=t;this._vertexAttributes.forEach((z,y)=>w.set(y,
z));this._indices.forEach((z,y)=>u.set(y,z));t.screenToWorldRatio=this.screenToWorldRatio;t._boundingInfo=this._boundingInfo;return t};A.getMutableAttribute=function(t){(t=this._vertexAttributes.get(t))&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0);return t};A.computeAttachmentOrigin=function(t){return this.primitiveType===r.PrimitiveType.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)};A._computeAttachmentOriginTriangles=function(t){const w=this.indices.get(f.VertexAttribute.POSITION),
u=this.vertexAttributes.get(f.VertexAttribute.POSITION);return g.computeAttachmentOriginTriangles(u,w,t)};A._computeAttachmentOriginPoints=function(t){const w=this.indices.get(f.VertexAttribute.POSITION),u=this.vertexAttributes.get(f.VertexAttribute.POSITION);return g.computeAttachmentOriginPoints(u,w,t)};A.invalidateBoundingInfo=function(){this._boundingInfo=null};A._calculateBoundingInfo=function(){const t=this.indices.get(f.VertexAttribute.POSITION);if(!t||0===t.length)return null;const w=this.primitiveType===
r.PrimitiveType.Triangle?3:1;d.assert(0===t.length%w,"Indexing error: "+t.length+" not divisible by "+w);const u=h.generateDefaultIndexArray(t.length/w),z=this.vertexAttributes.get(f.VertexAttribute.POSITION);return z?new m.BoundingInfo(u,w,t,z):null};b._createClass(l,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const t=this._indices.values().next().value;return t?t.length:0}},{key:"primitiveType",
get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return l}(n.ContentObject);a.Geometry=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3",
"../../../../chunks/vec3f64","./Util"],function(a,b,c,r,m){let n=function(){function g(d,f,e,l){this.primitiveIndices=d;this._numIndexPerPrimitive=f;this.indices=e;this.position=l;this.center=r.create();this._children=void 0;m.assert(1<=d.length);m.assert(0===e.length%this._numIndexPerPrimitive);m.assert(e.length>=d.length*this._numIndexPerPrimitive);m.assert(3===l.size||4===l.size);const {data:A,size:t}=l;l=d.length;f=t*e[this._numIndexPerPrimitive*d[0]];p.clear();p.push(f);this.bbMin=r.fromValues(A[f],
A[f+1],A[f+2]);this.bbMax=r.clone(this.bbMin);for(var w=0;w<l;++w){var u=this._numIndexPerPrimitive*d[w];for(var z=0;z<this._numIndexPerPrimitive;++z){f=t*e[u+z];p.push(f);let y=A[f];this.bbMin[0]=Math.min(y,this.bbMin[0]);this.bbMax[0]=Math.max(y,this.bbMax[0]);y=A[f+1];this.bbMin[1]=Math.min(y,this.bbMin[1]);this.bbMax[1]=Math.max(y,this.bbMax[1]);y=A[f+2];this.bbMin[2]=Math.min(y,this.bbMin[2]);this.bbMax[2]=Math.max(y,this.bbMax[2])}}c.lerp(this.center,this.bbMin,this.bbMax,.5);this.radius=.5*
Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);d=this.radius*this.radius;for(e=0;e<p.length;++e)f=p.getItemAt(e),l=A[f]-this.center[0],w=A[f+1]-this.center[1],f=A[f+2]-this.center[2],u=l*l+w*w+f*f,u<=d||(u=Math.sqrt(u),z=.5*(u-this.radius),this.radius+=z,d=this.radius*this.radius,u=z/u,this.center[0]+=l*u,this.center[1]+=w*u,this.center[2]+=f*u);p.clear()}var h=g.prototype;h.getCenter=function(){return this.center};h.getBSRadius=function(){return this.radius};
h.getBBMin=function(){return this.bbMin};h.getBBMax=function(){return this.bbMax};h.getChildren=function(){if(this._children)return this._children;if(1<c.squaredDistance(this.bbMin,this.bbMax)){var d=c.lerp(r.create(),this.bbMin,this.bbMax,.5),f=this.primitiveIndices.length;const t=new Uint8Array(f),w=Array(8);for(var e=0;8>e;++e)w[e]=0;const {data:u,size:z}=this.position;for(e=0;e<f;++e){var l=0;const y=this._numIndexPerPrimitive*this.primitiveIndices[e];var A=z*this.indices[y];let B=u[A],C=u[A+
1],k=u[A+2];for(let q=1;q<this._numIndexPerPrimitive;++q){A=z*this.indices[y+q];const x=u[A],v=u[A+1];A=u[A+2];x<B&&(B=x);v<C&&(C=v);A<k&&(k=A)}B<d[0]&&(l|=1);C<d[1]&&(l|=2);k<d[2]&&(l|=4);t[e]=l;++w[l]}d=0;for(e=0;8>e;++e)0<w[e]&&++d;if(2>d)return;d=Array(8);for(e=0;8>e;++e)d[e]=0<w[e]?new Uint32Array(w[e]):void 0;for(e=0;8>e;++e)w[e]=0;for(e=0;e<f;++e)l=t[e],d[l][w[l]++]=this.primitiveIndices[e];this._children=Array(8);for(f=0;8>f;++f)void 0!==d[f]&&(this._children[f]=new g(d[f],this._numIndexPerPrimitive,
this.indices,this.position))}return this._children};g.prune=function(){p.prune()};return g}();const p=new b({deallocator:null});a.BoundingInfo=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,r){function m(g,h){if(!g)throw h=h||"assert",console.log(Error(h).stack),new p(h);}const n=r.create();
let p=function(){function g(h){this.message=h}g.prototype.toString=function(){return`AssertException: ${this.message}`};return g}();a.assert=m;a.fovd2fovx=function(g,h,d){return 2*Math.atan(h*Math.tan(.5*g)/Math.sqrt(h*h+d*d))};a.fovd2fovy=function(g,h,d){return 2*Math.atan(d*Math.tan(.5*g)/Math.sqrt(h*h+d*d))};a.fovx2fovd=function(g,h,d){return 2*Math.atan(Math.sqrt(h*h+d*d)*Math.tan(.5*g)/h)};a.fovy2fovd=function(g,h,d){return 2*Math.atan(Math.sqrt(h*h+d*d)*Math.tan(.5*g)/d)};a.isTranslationMatrix=
function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&1===g[15]};a.logWithBase=function(g,h){return Math.log(g)/Math.log(h)};a.project=function(g,h,d,f,e){e||(e=g);n[0]=g[0];n[1]=g[1];n[2]=g[2];n[3]=1;c.transformMat4(n,n,h);2<e.length&&(e[2]=-n[2]);c.transformMat4(n,n,d);m(0!==n[3]);e[0]=n[0]/n[3];e[1]=n[1]/n[3];e[2]=n[2]/n[3];e[0]=(.5*e[0]+.5)*f[2]+f[0];e[1]=(.5*e[1]+.5)*f[3]+f[1]};a.rayBoxTest=function(g,h,d,
f){let e,l=(d[0]-g[0])/h[0],A=(f[0]-g[0])/h[0];l>A&&(e=l,l=A,A=e);let t=(d[1]-g[1])/h[1],w=(f[1]-g[1])/h[1];t>w&&(e=t,t=w,w=e);if(l>w||t>A)return!1;t>l&&(l=t);w<A&&(A=w);d=(d[2]-g[2])/h[2];g=(f[2]-g[2])/h[2];d>g&&(e=d,d=g,g=e);if(l>g||d>A)return!1;g<A&&(A=g);return 0>A?!1:!0};a.rayRay2D=function(g,h,d,f,e,l=b.create()){const A=(f[e]-d[e])*(h[0]-g[0])-(f[0]-d[0])*(h[e]-g[e]);if(0===A)return!1;d=((f[0]-d[0])*(g[e]-d[e])-(f[e]-d[e])*(g[0]-d[0]))/A;l[0]=g[0]+d*(h[0]-g[0]);l[1]=g[e]+d*(h[e]-g[e]);return!0};
a.setMatrixTranslation3=function(g,h,d,f){g[12]=h;g[13]=d;g[14]=f};a.verify=function(g,h){g||console.warn("Verify failed: "+(h||"")+"\n"+Error("verify").stack)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){let c=function(){function r(){this.id=b.generateUID()}r.prototype.unload=function(){};return r}();a.ContentObject=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Geometry=2]="Geometry";b[b.Material=3]="Material";b[b.Texture=4]="Texture";b[b.COUNT=5]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,b,c,r){const m=c.create(),n=c.create(),p=c.create(),g=c.create();a.computeAttachmentOriginLines=function(h,d,f,e){if(!h)return!1;const {size:l,data:A}=h;b.set(e,0,0,0);b.set(g,0,0,0);let t=h=0;const w=d?d.length-1:A.length/l-1;f=w+(f?2:0);for(let y=0;y<f;y+=2){var u=y<w?y:w,z=y<w?y+1:0;u=(d?d[u]:u)*l;z=(d?d[z]:z)*l;m[0]=A[u+0];m[1]=A[u+1];m[2]=A[u+2];n[0]=A[z+0];n[1]=A[z+1];n[2]=A[z+2];b.scale(m,
b.add(m,m,n),.5);z=b.dist(m,n);0<z?(b.add(e,e,b.scale(m,m,z)),h+=z):(b.add(g,g,m),t++)}return 0!==h?(b.scale(e,e,1/h),!0):0!==t?(b.scale(e,g,1/t),!0):!1};a.computeAttachmentOriginPoints=function(h,d,f){if(!h||!d)return!1;const {size:e,data:l}=h;b.set(f,0,0,0);h=-1;let A=0;for(let t=0;t<d.length;t++){const w=d[t]*e;h!==w&&(f[0]+=l[w+0],f[1]+=l[w+1],f[2]+=l[w+2],A++);h=w}1<A&&b.scale(f,f,1/A);return 0<A};a.computeAttachmentOriginTriangles=function(h,d,f){if(!h||!d)return!1;const {size:e,data:l}=h;b.set(f,
0,0,0);b.set(g,0,0,0);let A=h=0;for(let w=0;w<d.length-2;w+=3){var t=d[w+0]*e;const u=d[w+1]*e,z=d[w+2]*e;b.set(m,l[t+0],l[t+1],l[t+2]);b.set(n,l[u+0],l[u+1],l[u+2]);b.set(p,l[z+0],l[z+1],l[z+2]);(t=r.areaPoints3d(m,n,p))?(b.add(m,m,n),b.add(m,m,p),b.scale(m,m,1/3*t),b.add(f,f,m),h+=t):(b.add(g,g,m),b.add(g,g,n),b.add(g,g,p),A+=3)}return 0===A&&0===h?!1:0!==h?(b.scale(f,f,1/h),!0):0!==A?(b.scale(f,g,1/A),!0):!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,r,m,n){function p(A){return A?{p0:r.clone(A.p0),p1:r.clone(A.p1),p2:r.clone(A.p2)}:{p0:r.create(),p1:r.create(),p2:r.create()}}function g(A,t,w,u=p()){c.copy(u.p0,A);c.copy(u.p1,t);c.copy(u.p2,w);return u}function h(A,t,w){return.5*Math.abs((t[0]-A[0])*(w[1]-A[1])-(t[1]-A[1])*(w[0]-A[0]))}const d=new b.ObjectStack(m.create),
f=new b.ObjectStack(()=>p()),e=r.create(),l=r.create();a.area2d=function(A){return h(A.p0,A.p1,A.p2)};a.areaPoints2d=h;a.areaPoints3d=function(A,t,w){c.subtract(e,t,A);c.subtract(l,w,A);return c.length(c.cross(e,e,l))/2};a.copy=function(A,t=p()){return g(A.p0,A.p1,A.p2,t)};a.create=p;a.distance2=function(A,t){var w=A.p0,u=A.p1;A=A.p2;const z=c.subtract(n.sv3d.get(),u,w),y=c.subtract(n.sv3d.get(),A,u),B=c.subtract(n.sv3d.get(),w,A),C=c.subtract(n.sv3d.get(),t,w);var k=c.subtract(n.sv3d.get(),t,u),
q=c.subtract(n.sv3d.get(),t,A);const x=c.cross(z,z,B),v=c.dot(c.cross(n.sv3d.get(),z,x),C);k=c.dot(c.cross(n.sv3d.get(),y,x),k);q=c.dot(c.cross(n.sv3d.get(),B,x),q);if(0<v&&0<k&&0<q)return t=c.dot(x,C),t*t/c.dot(x,x);w=m.distance2(m.fromValues(w,z,d.get()),t);u=m.distance2(m.fromValues(u,y,d.get()),t);t=m.distance2(m.fromValues(A,B,d.get()),t);return Math.min(w,u,t)};a.fromValues=g;a.intersectRay=function(A,t,w){const {direction:u,origin:z}=t,{p0:y,p1:B,p2:C}=A;var k=B[0]-y[0],q=B[1]-y[1],x=B[2]-
y[2];A=C[0]-y[0];t=C[1]-y[1];const v=C[2]-y[2];var D=u[1]*v-t*u[2],F=u[2]*A-v*u[0];const G=u[0]*t-A*u[1];var J=k*D+q*F+x*G;if(-1E-5<J&&1E-5>J)return!1;J=1/J;const L=z[0]-y[0],K=z[1]-y[1],O=z[2]-y[2];D=J*(L*D+K*F+O*G);if(0>D||1<D)return!1;F=K*x-q*O;x=O*k-x*L;k=L*q-k*K;q=J*(u[0]*F+u[1]*x+u[2]*k);if(0>q||1<D+q)return!1;w&&(c.scale(w,u,J*(A*F+t*x+v*k)),c.add(w,z,w));return!0};a.wrap=function(A,t,w){const u=f.get();u.p0=A;u.p1=t;u.p2=w;return u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Indices":function(){define(["exports"],function(a){let b=(()=>{const m=new Uint32Array(131072);for(let n=0;n<m.length;++n)m[n]=n;return m})();const c=[0],r=(()=>{const m=new Uint16Array(65536);for(let n=0;n<m.length;++n)m[n]=n;return m})();a.compactIndices=function(m){if(Array.isArray(m)){if(1024>m.length)return m;for(const n of m)if(65536<=n)return new Uint32Array(m);return new Uint16Array(m)}if(m.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return m;for(const n of m)if(65536<=
n)return m;return new Uint16Array(m)};a.generateDefaultIndexArray=function(m){if(1===m)return c;if(1024>m)return Array.from(new Uint16Array(r.buffer,0,m));if(m<r.length)return new Uint16Array(r.buffer,0,m);if(m>b.length){b=new Uint32Array(Math.max(2*b.length,m));for(let n=0;n<b.length;n++)b[n]=n}return new Uint32Array(b.buffer,0,m)};a.generateIndexArray=function(m){if(1===m)return c;if(1024>m)return Array.from(new Uint16Array(r.buffer,0,m));if(m<r.length)return new Uint16Array(r.slice(0,m));if(m>
b.length){m=new Uint32Array(m);for(let n=0;n<m.length;n++)m[n]=n;return m}return new Uint32Array(b.slice(0,m))};a.newIndexArray=function(m){m*=3;return 1024>=m?Array(m):65536>=m?new Uint16Array(m):new Uint32Array(m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../../geometry/projectionEllipsoid ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){a.Precipitation=function(D){function F(J){var L=D.call(this,J)||this;L._numParticles=25E4;L._rainSpeed=.1;L._snowSpeed=.01;L._passParameters=new A.PrecipitationPassParameters;L._animation=new z.AnimationTimer;L._updatingTracking=new e.WatchUpdatingTracking;L._passParameters.time=0;L._passParameters.radius=l.getReferenceEllipsoid(J.view.spatialReference).radius;L._shaderTechniqueRepository=J.context.shaderTechniqueRepository;return L}b._inheritsLoose(F,
D);var G=F.prototype;G.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechniqueCached=n.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=n.releaseMaybe(this._rainTechniqueCached);this._vao=n.disposeMaybe(this._vao);this._instanceIdBuffer=n.disposeMaybe(this._instanceIdBuffer)};G.update=function(J){return this._animation.advance(J)};G.render=function(J,L,K){const O="rainy"===K?this._rainTechnique:this._snowTechnique;if(O.compiled){var P=J.rctx;this._ensureResources(P);
n.isNone(O)||n.isNone(this._vao)||n.isNone(this._instanceIdBuffer)||(n.isSome(J.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-J.bindParameters.cloudsFade.fadeInOutHeight.factor),0>=this._passParameters.opacity||(L=.5>L?m.lerp(0,.35,2*L):m.lerp(.35,1,2*(L-.5)),this._passParameters.time=("rainy"===K?this._rainSpeed:this._snowSpeed)*p.secondsFromMilliseconds(this._animation.time)%1E5,J=P.bindTechnique(O,this._passParameters,J.bindParameters),P.bindVAO(this._vao),J.assertCompatibleVertexAttributeLocations(this._vao),
q.bindVertexBufferLayout(P,A.attributeLocations,this._instanceIdBuffer,v,0),P.capabilities.instancing.drawArraysInstanced(k.PrimitiveType.TRIANGLES,0,3,this._numParticles*L),q.unbindVertexBufferLayout(P,A.attributeLocations,this._instanceIdBuffer,v)))}else this.context.requestRender()};G._ensureResources=function(J){n.isNone(this._vao)&&(this._vao=this._createVertexArrayObject(J));n.isNone(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(J))};G._createInstanceIndices=function(J){const L=
[];for(let K=0;K<this._numParticles;K++)L.push(K);return C.BufferObject.createVertex(J,k.Usage.STATIC_DRAW,new Float32Array(L))};G._createVertexArrayObject=function(J){const L=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new y.VertexArrayObject(J,A.attributeLocations,{geometry:w.glLayout(x)},{geometry:C.BufferObject.createVertex(J,k.Usage.STATIC_DRAW,L)})};b._createClass(F,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"_rainTechnique",get:function(){if(n.isNone(this._rainTechniqueCached)){const J=
new t.PrecipitationTechniqueConfiguration;J.type=t.PrecipitationType.Rain;this._rainTechniqueCached=this._shaderTechniqueRepository.acquire(A.PrecipitationTechnique,J)}return this._rainTechniqueCached}},{key:"_snowTechnique",get:function(){if(n.isNone(this._snowTechniqueCached)){const J=new t.PrecipitationTechniqueConfiguration;J.type=t.PrecipitationType.Snow;this._snowTechniqueCached=this._shaderTechniqueRepository.acquire(A.PrecipitationTechnique,J)}return this._snowTechniqueCached}}]);return F}(r);
c.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);c.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([g.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);c.__decorate([g.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([f.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const x=u.newLayout().vec3f(B.VertexAttribute.POSITION),
v=w.glLayout(u.newLayout().f32(B.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){m=function(l){function A(){var t=l.apply(this,arguments)||this;t.time=0;t.radius=1;t.width=500;t.opacity=1;return t}c._inheritsLoose(A,l);return A}(m.NoParameters);p=function(l){function A(){return l.apply(this,arguments)||this}c._inheritsLoose(A,l);var t=A.prototype;t.initializeProgram=function(w){return new g.Program(w.rctx,A.shader.get().build(this.configuration),e)};t.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.ONE,
d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return A}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(r.Precipitation,()=>new Promise((l,A)=>a(["./Precipitation.glsl"],l,A)));const e=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=m;b.PrecipitationTechnique=p;b.attributeLocations=e;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(w){const u=new h.ShaderBuilder;u.attributes.add(d.VertexAttribute.POSITION,"vec3");u.attributes.add(d.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");u.vertex.uniforms.add(new m.Float3PassUniform("cameraPosition",(z,y)=>y.camera.eye));u.vertex.uniforms.add(new m.Float3PassUniform("offset",(z,y)=>{y=y.camera.eye;var B=.5*z.width;const C=1/z.width;B=b.floor(e,b.set(e,(y[0]+B)*C,(y[1]+B)*C,(y[2]+B)*C));return b.sub(B,y,b.scale(B,B,z.width))}));u.vertex.uniforms.add(new n.FloatPassUniform("width",
z=>z.width));u.vertex.uniforms.add(new g.Matrix4PassUniform("proj",(z,y)=>y.camera.projectionMatrix));u.vertex.uniforms.add(new g.Matrix4PassUniform("view",(z,y)=>y.camera.viewMatrix));u.vertex.uniforms.add(new n.FloatPassUniform("time",z=>z.time));u.varyings.add("vUv","vec2");u.vertex.code.add(p.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${w.type===r.PrecipitationType.Rain?p.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:p.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);u.fragment.uniforms.add([new n.FloatPassUniform("opacity",z=>z.opacity),new m.Float3PassUniform("particleColor",(z,y)=>{z=w.type===r.PrecipitationType.Rain?t:A;const B=b.scale(e,z,.7);b.normalize(l,y.camera.eye);y=Math.max(0,b.dot(l,y.lighting.mainLight.direction));return b.lerp(B,B,z,y)})]);u.fragment.code.add(p.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${w.type===r.PrecipitationType.Rain?p.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:p.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return u}const e=c.create(),l=c.create(),A=c.fromValues(1,1,1),t=c.fromValues(.85,.85,.85);c=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.Precipitation=c;a.build=f})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){a.PrecipitationType=void 0;
(function(n){n[n.Rain=0]="Rain";n[n.Snow=1]="Snow";n[n.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.type=a.PrecipitationType.Rain;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter({count:a.PrecipitationType.COUNT})],m.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/time"],function(a,b,c){let r=function(){function m(){this.enabled=!0;this._time=c.Milliseconds(0)}m.prototype.advance=function(n){if(this._time===n.time)return!1;this._time=n.time;return!0};b._createClass(m,[{key:"time",get:function(){return this._time}}]);return m}();a.AnimationTimer=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){function K(M,Q,T,S,U){const Y=g.length(M),V=S*Math.sqrt(Y*Y-S*S)/Y,R=U.v1,X=U.v2;g.scale(U.center,M,Math.sqrt(S*S-V*V)/Y);g.cross(R,M,Q);1>g.squaredLength(R)&&g.cross(R,M,T);g.scale(R,R,V/g.length(R));g.cross(X,R,M);g.scale(X,X,V/g.length(X));return V}const O=-l.innerAtmosphereDepth,P=y.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);y=function(){function M(T){this.view=T;this.type=e.AtmosphereType.Simple;
this._passParameters=new A.SimpleAtmospherePassParameters;this._fadeVaoCount=0;this._texV1=1;this._isOnMars=f.isMars(T.spatialReference);T=d.getReferenceEllipsoid(T.spatialReference);this._planetRadius=T.radius;this._outerRimWidth=T.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+O)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=
this._texV1-this._texV0}var Q=M.prototype;Q.destroy=function(){this._cameraChangeHandle=c.removeMaybe(this._cameraChangeHandle);this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._fadeVao=c.disposeMaybe(this._fadeVao);this._vao=c.disposeMaybe(this._vao)};Q.initializeRenderContext=function(){var T=a._asyncToGenerator(function*(S){this._shaderTechniqueRepository=S.shaderTechniqueRepository;const U=S.renderContext.rctx;this._cameraChangeHandle=r.watch(()=>this.view.state?.camera,
()=>S.requestRender(),r.syncAndInitial);this._vao=this._createRibbon(U);this._vaoCount=L.vertexCount(this._vao,"geometry");this._fadeVao=q.createQuadVAO(U);this._fadeVaoCount=L.vertexCount(this._fadeVao,"geometry");this._passParameters.texture=new J.Texture(U,{pixelFormat:G.PixelFormat.RGBA,dataType:G.PixelType.UNSIGNED_BYTE,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:G.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},this._isOnMars?u.marsAtmosphereTextureSimple:z.earthAtmosphereTextureSimple);
S.requestRender()});return function(S){return T.apply(this,arguments)}}();Q.render=function(T){if(!c.isNone(this._vao)&&!c.isNone(this._passParameters.texture)){this._update(T.bindParameters.camera);var S=T.rctx;1>this._passParameters.undergroundFadeAlpha&&(S.bindTechnique(this._coneTechnique,this._passParameters,T.bindParameters),S.bindVAO(this._vao),S.drawArrays(G.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(S.bindTechnique(this._undergroundTechnique,
this._passParameters,T.bindParameters),S.bindVAO(this._fadeVao),S.drawArrays(G.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))}};Q.renderHaze=function(){};Q._update=function(T){var S=h.create();const U=this._planetRadius;var Y=g.length(T.eye);const V=Y-U;this._passParameters.undergroundFadeAlpha=0>V?Math.min(-V/5E3,1):0;var R=U+O,X=U+Math.max(50,V);this._passParameters.innerScale=X*X/(Math.sqrt(X*X-U*U)*Math.sqrt(X*X-R*R)+U*R)-1;this._passParameters.altitudeFade=l.computeInnerAltitudeFade(V);
g.scale(S,T.eye,(U+50)/Y);K(S,T.center,T.up,U,this._passParameters.silhouette);S=this._computeScreenRimWidth(T,S,T.up,this._passParameters.silhouette);Y=P(V);R=this._texV0+.001953125*this._texVScale;X=this._texV0+S*Y*this._texVScale;50<V&&(K(T.eye,T.center,T.up,U,this._passParameters.silhouette),T=this._computeScreenRimWidth(T,T.eye,T.up,this._passParameters.silhouette),T=b.clamp((T-1.5)/(S-1.5),0,1),R=this._texV0+.001953125*T*this._texVScale,X=this._texV0+b.lerp(this._texV1,S*Y,T)*this._texVScale);
p.set(this._passParameters.texV,R,X)};Q._createRibbon=function(T){const S=new Float32Array(1155),U=new Uint32Array(1920);S[0]=0;S[1]=0;S[2]=-1;for(var Y=0;128>Y;Y++){var V=9*Y+3;S[V+0]=Y;S[V+1]=this._innerRimFactor;S[V+2]=-1;S[V+3]=Y;S[V+4]=this._middleRimFactor;S[V+5]=0;S[V+6]=Y;S[V+7]=this._outerRimFactor;S[V+8]=1;V=3*Y+1;var R=127===Y?1:V+3,X=15*Y;U[X+0]=V;U[X+1]=V+1;U[X+2]=R+1;U[X+3]=R+1;U[X+4]=R;U[X+5]=V;U[X+6]=V+1;U[X+7]=V+2;U[X+8]=R+2;U[X+9]=R+2;U[X+10]=R+1;U[X+11]=V+1;U[X+12]=V;U[X+13]=R;
U[X+14]=0}Y=I.createBuffer(U.length);V=Y.position;for(R=0;R<U.length;++R)X=3*U[R],V.set(R,0,S[X]),V.set(R,1,S[X+1]),V.set(R,2,S[X+2]);return new v.VertexArrayObject(T,k.Default3D,{geometry:B.glLayout(I)},{geometry:F.BufferObject.createVertex(T,G.Usage.STATIC_DRAW,Y.buffer)})};Q._computeScreenRimWidth=function(T,S,U,Y){g.add(H,Y.center,Y.v2);g.scale(E,H,this._outerRimFactor);m.lookAt(N,S,H,U);x.project(H,N,T.projectionMatrix,T.viewport);x.project(E,N,T.projectionMatrix,T.viewport);return g.distance(H,
E)/T.height};a._createClass(M,[{key:"_coneTechnique",get:function(){if(c.isNone(this._coneTechniqueCached)){const T=new w.SimpleAtmosphereTechniqueConfiguration;T.geometry=w.SimpleAtmosphereGeometry.Cone;this._coneTechniqueCached=this._shaderTechniqueRepository.acquire(t.SimpleAtmosphereTechnique,T)}return this._coneTechniqueCached}},{key:"_undergroundTechnique",get:function(){if(c.isNone(this._undergroundTechniqueCached)){const T=new w.SimpleAtmosphereTechniqueConfiguration;T.geometry=w.SimpleAtmosphereGeometry.Underground;
this._undergroundTechniqueCached=this._shaderTechniqueRepository.acquire(t.SimpleAtmosphereTechnique,T)}return this._undergroundTechniqueCached}}]);return M}();const N=n.create(),H=h.create(),E=h.create(),I=C.newLayout().vec3f(D.VertexAttribute.POSITION);return y})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,
4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,
11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,
49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,
20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,
27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,
39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,
53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,
159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,
180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,
38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,
96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,
230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SimpleHaze":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./SimpleHazeTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){a.SimpleHaze=function(v){function D(G){var J=v.call(this,G)||this;J._passParameters=new t.FogHazePassParameters;J._vao=B.createQuadVAO(G.context.renderContext.rctx,y.Pos2Tex);G=l.getReferenceEllipsoid(G.view.spatialReference);J._planetRadius=G.radius;J._atmosphereRadius=G.radius+A.atmosphereHeight;return J}b._inheritsLoose(D,v);var F=D.prototype;F.destroy=function(){this._hazeTechniqueCached=n.releaseMaybe(this._hazeTechniqueCached);this._vao=n.disposeMaybe(this._vao)};
F.render=function(G,J){if(0!==this.view.basemapTerrain.baseOpacity&&(this._update(G,J),!(0>=this._passParameters.hazeAmount))){var L=this._hazeTechnique;if(L.compiled){var K=G.offscreenRenderingHelper;K.renderDepthDetached(()=>{this._passParameters.depthTexture=K.depthTexture;const O=G.rctx.bindTechnique(L,this._passParameters,G.bindParameters);this._renderSimpleHaze(O,G)})}else this.context.requestRender()}};F._renderSimpleHaze=function(G,J){n.isNone(this._vao)||(J=J.rctx,J.bindVAO(this._vao),G.assertCompatibleVertexAttributeLocations(this._vao),
J.drawArrays(C.PrimitiveType.TRIANGLE_STRIP,0,4))};F._update=function(G,J){var L=G.bindParameters.camera;f.normalize(q,L.eye);G=Math.max(0,f.dot(q,G.bindParameters.lighting.mainLight.direction));const K=k;f.scale(x,K,0);f.lerp(this._passParameters.hazeColor,x,K,G);L=f.length(L.eye);this._passParameters.atmosphereC=L*L-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.hazeAmount=(1-m.smoothstep(.7*z.weatherHeightLimit,1*z.weatherHeightLimit,Math.abs(L-this._planetRadius)))*J.amount;
this._passParameters.fogStrength=J.strength};D.isSupported=function(G){return G.capabilities.depthTexture};b._createClass(D,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"strength",get:function(){return this._passParameters.hazeStrength},set:function(G){this._passParameters.hazeStrength=G}},{key:"_hazeTechnique",get:function(){if(n.isNone(this._hazeTechniqueCached)){const G=new w.FogHazeTechniqueConfiguration;G.haze=!0;this._hazeTechniqueCached=
this._shaderTechniqueRepository.acquire(u.SimpleHazeTechnique,G)}return this._hazeTechniqueCached}}]);return D}(r);c.__decorate([p.property({constructOnly:!0})],a.SimpleHaze.prototype,"context",void 0);c.__decorate([p.property({constructOnly:!0})],a.SimpleHaze.prototype,"view",void 0);a.SimpleHaze=c.__decorate([d.subclass("esri.views.3d.environment.SimpleHaze")],a.SimpleHaze);const k=e.fromValues(.24,.44,.8),q=e.create(),x=e.create();a.HazeParameters=function(){this.amount=this.strength=0};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SimpleHazeTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h,d){n=function(f){function e(){return f.apply(this,
arguments)||this}c._inheritsLoose(e,f);var l=e.prototype;l.initializeProgram=function(A){return new g.Program(A.rctx,e.shader.get().build(this.configuration),p.Default3D)};l.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams})};return e}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(r.Haze,()=>new Promise((f,e)=>a(["./FogHaze.glsl"],
f,e)));b.SimpleHazeTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D){a.Stars=function(O){function P(H){H=O.call(this,H)||this;H._loadDataTask=null;H._numPoints=0;H._renderParameter=new y.StarPassParameters;H._updatingTracking=new z.WatchUpdatingTracking;return H}b._inheritsLoose(P,O);var N=P.prototype;N.initialize=function(){this._loadDataTask=this._createLoadDataTask()};N.destroy=function(){this._loadDataTask=h.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();this._numPoints=0;this._technique=
h.releaseMaybe(this._technique);this._vao=h.disposeMaybe(this._vao)};N.render=function(H){const {rctx:E}=H;this._ensureResources(E);h.isNone(this._technique)||h.isNone(this._vao)||(this._technique.compiled?(H=E.bindTechnique(this._technique,this._renderParameter,H.bindParameters),E.bindVAO(this._vao),H.assertCompatibleVertexAttributeLocations(this._vao),E.drawArrays(D.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};N._ensureResources=function(H){if(!h.isSome(this._technique)&&!h.isNone(K)){this._technique=
new y.StarsTechnique({rctx:H,viewingMode:this.view.state.viewingMode});this._numPoints=K.byteLength/9;var E=new Float32Array(K,0,2*this._numPoints),I=new Uint8Array(K,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(H,E,I,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,M=>this._update(M),f.initial)}};N._computeDayDuration=function(H){const E=new Date(H.getFullYear(),0,1,11,58,56),I=new Date(H.getFullYear()+
1,0,1,11,58,55);return(+H-+E)/(+I-+E)};N._update=function(H){if(H){var E=H.getHours()/12,I=H.getMinutes()/60*(2/24),M=H.getSeconds()/60*(2/1440);E=(E+I+M-.9972222)%2;H=2*this._computeDayDuration(H);I=w.copy(this._renderParameter.modelMatrix,J);w.rotateZ(I,I,-H*Math.PI);w.multiply(I,G,I);w.rotateZ(I,I,-E*Math.PI);this.requestRender()}};N._hexToRGB=function(H){return[parseInt(H.substring(0,2),16),parseInt(H.substring(2,4),16),parseInt(H.substring(4,6),16)]};N._unpackUint8Attributes=function(H){return 192<=
H?[2.9,H-192]:160<=H?[2.5,H-160]:128<=H?[2,H-128]:96<=H?[1.5,H-96]:64<=H?[1,H-64]:32<=H?[.7,H-32]:[.4,H]};N._createVertexArrayObject=function(H,E,I,M){const Q=L.createBuffer(M),T=Q.position,S=Q.color,U=Q.size;for(let R=0;R<M;R++){var Y=E[2*R],V=E[2*R+1];T.set(R,0,-Math.cos(Y)*Math.sin(V));T.set(R,1,-Math.sin(Y)*Math.sin(V));T.set(R,2,-Math.cos(V));Y=this._unpackUint8Attributes(I[R]);V=this._hexToRGB(F[Y[1]]);S.set(R,0,255*V[0]);S.set(R,1,255*V[1]);S.set(R,2,255*V[2]);S.set(R,3,255);U.set(R,Y[0])}return new q.VertexArrayObject(H,
k.Default3D,{geometry:B.glLayout(L)},{geometry:v.BufferObject.createVertex(H,D.Usage.STATIC_DRAW,Q.buffer)})};N._createLoadDataTask=function(){var H=this;if(h.isSome(K))return null;const E=n.createTask(function(){var I=b._asyncToGenerator(function*(M){({data:M}=yield r.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:M}));H._verifyStarData(M);K=M});return function(M){return I.apply(this,arguments)}}());E.promise.catch(I=>{d.isAbortError(I)||g.getLogger(this.declaredClass).error(I)}).then(()=>
{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return E};N._verifyStarData=function(H){if(!H)throw new p("stars:no-data-received","Failed to create stars because star catalogue is missing");H=H.byteLength/9;if(0!==H%1||5E4<H||5E3>H)throw new p("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(P,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return h.isSome(this._loadDataTask)&&
!this._loadDataTask.finished}}]);return P}(m);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=c.__decorate([t.subclass("esri.views.3d.environment.Stars")],
a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=u.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),J=u.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),L=C.newLayout().vec3f(x.VertexAttribute.POSITION).vec4u8(x.VertexAttribute.COLOR).f32(x.VertexAttribute.SIZE);
let K=null;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){n=function(A){function t(){var w=A.apply(this,arguments)||this;w.modelMatrix=r.create();return w}c._inheritsLoose(t,A);return t}(n.NoParameters);g=function(A){function t(u){var z;return z=A.call(this,u,new h.ShaderTechniqueConfiguration,()=>z.destroy())||this}c._inheritsLoose(t,A);var w=t.prototype;w.initializeProgram=function(u){return new f.Program(u.rctx,t.shader.get().build(),d.Default3D)};w.initializePipeline=function(){return l.makePipelineState({blending:l.separateBlendingParams(e.BlendFactor.SRC_ALPHA,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})};return t}(g.ShaderTechnique);g.shader=new p.ReloadableShaderModule(m.Stars,()=>new Promise((A,t)=>a(["./Stars.glsl"],A,t)));b.StarPassParameters=n;b.StarsTechnique=g;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(){const l=new h.ShaderBuilder;l.attributes.add(d.VertexAttribute.POSITION,"vec3");l.attributes.add(d.VertexAttribute.COLOR,"vec4");l.attributes.add(d.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add([new g.Matrix4PassUniform("transform",(A,t)=>{b.copy(e,t.camera.projectionMatrix);e[10]=2.4E-7-1;e[11]=-1;e[14]=(2.4E-7-2)*t.camera.near;b.multiply(e,e,t.camera.viewMatrix);return b.multiply(e,e,
A.modelMatrix)}),new m.Float4PassUniform("viewport",(A,t)=>t.camera.fullViewport),new n.FloatPassUniform("pixelRatio",(A,t)=>t.camera.pixelRatio)]);l.include(r.AlignPixel);l.vertex.code.add(p.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);l.fragment.code.add(p.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return l}const e=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.Stars=c;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const r=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,m=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(r);c.vertex.code.add(m);c.fragment.code.add(r);c.fragment.code.add(m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/weatherUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsCompositionParameters ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(z,y,B,C){const k=z.fadeInOutHeight,q=k.stage===h.FadeHeightStages.FINISHED?B:z.startTimeHeightFade;0!==C?(C=(B-q)/(1*C),k.factor+=y?-C:C):k.factor=y?0:1;z.startTimeHeightFade=B;k.factor=b.clamp(k.factor,0,1);k.stage=h.FadeHeightStages.HEIGHT_FADE}const A=m.fromValues(0,0,1),t=p.create(),w=m.create(),u=m.create();a.updateWeatherFading=function(z,y,B,C,k){z.renderingStage===d.CloudsRenderingStages.FINISHED_RENDERING&&(z.renderingStage=d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS);
const q=r.length(y.eye);0>z.fadeInOutHeight.factor&&(z.fadeInOutHeight.factor=q-g.earth.radius>f.weatherHeightLimit?1:0);z.isCameraPositionFinal=r.equals(z.cameraPositionLastFrame,y.eye);r.normalize(w,y.eye);r.scale(w,w,g.earth.radius);const x=z.parallax;0===x.anchorPointClouds[0]&&0===x.anchorPointClouds[1]&&0===x.anchorPointClouds[2]&&r.copy(x.anchorPointClouds,w);var v=r.length(r.subtract(u,x.anchorPointClouds,w));let D=!0;if(v>z.fadeIn.distanceThresholdFactor*x.cloudsHeight||z.fadeIn.stage!==
h.FadeInStages.FINISHED)B=z.parallax.anchorPointClouds,z.fadeIn.stage===h.FadeInStages.FINISHED&&(z.fadeIn.factor=0,r.copy(B,w),z.fadeIn.stage=h.FadeInStages.CHANGE_ANCHOR,z.crossFade.enabled=!1,z.fadeInOut.stage=h.FadeInOutStages.FINISHED),z.fadeIn.stage===h.FadeInStages.CHANGE_ANCHOR&&z.isCameraPositionFinal&&(d.ensureClouds(z.data)&&z.renderingStage!==d.CloudsRenderingStages.RENDERING||z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(r.copy(B,w),z.fadeIn.stage=h.FadeInStages.FADE_IN,
z.startTime=C,z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS)),1>z.fadeIn.factor&&z.fadeIn.stage===h.FadeInStages.FADE_IN?z.fadeIn.factor=k?b.clamp((C-z.startTime)/(1*k),0,1):1:1<=z.fadeIn.factor&&z.fadeIn.stage===h.FadeInStages.FADE_IN&&(z.fadeIn.stage=h.FadeInStages.FINISHED,z.fadeIn.factor=1);else if(v>z.fadeInOut.distanceThresholdFactor*x.cloudsHeight||z.fadeInOut.stage!==h.FadeInOutStages.FINISHED){{const {fadeInOut:F,
crossFade:G}=z;F.stage===h.FadeInOutStages.FINISHED&&(z.startTime=C,F.factor=1,F.stage=h.FadeInOutStages.FADE_OUT);0<F.factor&&F.stage===h.FadeInOutStages.FADE_OUT?F.factor=k?1-b.clamp((C-z.startTime)/(.5*k),0,1):0:(0>=F.factor&&F.stage===h.FadeInOutStages.FADE_OUT&&(F.factor=0,r.copy(z.parallax.anchorPointClouds,w)),0>=F.factor&&F.stage===h.FadeInOutStages.FADE_OUT&&z.isCameraPositionFinal&&(F.factor=0,F.stage=h.FadeInOutStages.SWITCH,z.crossFade.enabled=!1,G.factor=1),F.stage===h.FadeInOutStages.SWITCH&&
(d.ensureClouds(z.data)&&z.renderingStage!==d.CloudsRenderingStages.RENDERING||z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(z.startTime=C,F.factor=0,F.stage=h.FadeInOutStages.FADE_IN,r.copy(z.parallax.anchorPointClouds,w),z.crossFade.enabled=!1,G.factor=1,z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS)),1>F.factor&&F.stage===h.FadeInOutStages.FADE_IN?F.factor=k?b.clamp((C-z.startTime)/(1*k),0,1):
1:1<=F.factor&&F.stage===h.FadeInOutStages.FADE_IN&&(F.stage=h.FadeInOutStages.FINISHED,F.factor=1))}}else if(v>z.crossFade.distanceThresholdFactor*x.cloudsHeight||z.crossFade.enabled||z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS){B=(B!==e.RenderState.IDLE||!d.ensureClouds(z.data))&&z.renderingStage!==d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS;{({crossFade:v}=z);const F=z.parallax.anchorPointClouds;if(!z.crossFade.enabled||B)r.copy(z.parallaxNew.anchorPointClouds,w),z.startTime=
C,v.factor=0,z.crossFade.enabled=!0;1>v.factor&&z.crossFade.enabled?v.factor=k?b.clamp((C-z.startTime)/(1.3*k),0,1):1:1<=v.factor&&z.crossFade.enabled&&(z.crossFade.enabled=!1,v.factor=1,r.copy(F,z.parallaxNew.anchorPointClouds),z.renderingStage===d.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=d.CloudsRenderingStages.SWITCH_CHANNELS))}}else D=!1;B=q-g.earth.radius;(B>1.7*f.weatherHeightLimit||B<-f.weatherHeightLimit)&&1>z.fadeInOutHeight.factor?z.fadeInOutHeight.factor=1:(B>f.weatherHeightLimit||
B<-.35*f.weatherHeightLimit)&&1>z.fadeInOutHeight.factor?l(z,!1,C,k):B<f.weatherHeightLimit&&B>-.35*f.weatherHeightLimit&&0<z.fadeInOutHeight.factor?l(z,!0,C,k):z.fadeInOutHeight.stage=h.FadeHeightStages.FINISHED;z.renderingStage===d.CloudsRenderingStages.SWITCH_CHANNELS&&(z.readChannels=1-z.readChannels,z.renderingStage=d.CloudsRenderingStages.FINISHED);x.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(q*q-g.earth.radius*g.earth.radius,0))/q;p.fromPoints(A,x.anchorPointClouds,t);c.rotate(x.transform,
n.IDENTITY,t[3],p.axis(t));D&&({parallaxNew:C}=z,p.fromPoints(A,C.anchorPointClouds,t),c.rotate(C.transform,n.IDENTITY,t[3],p.axis(t)));r.copy(z.cameraPositionLastFrame,y.eye)};a.weatherfadingNeedsRender=function(z){return z.crossFade.enabled||z.fadeInOut.stage!==h.FadeInOutStages.FINISHED||z.fadeIn.stage!==h.FadeInStages.FINISHED||z.fadeInOutHeight.stage!==h.FadeHeightStages.FINISHED||z.renderingStage!==d.CloudsRenderingStages.FINISHED};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/axisAngleDegrees":function(){define(["exports","../../core/mathUtils","../../chunks/quat","../../chunks/quatf64","../../chunks/vec3"],function(a,b,c,r,m){function n(A=d){return[A[0],A[1],A[2],A[3]]}function p(A,t,w,u,z=n()){z[0]=A;z[1]=t;z[2]=w;z[3]=u;return z}function g(A){return b.deg2rad(A[3])}function h(A,t){A[3]=t;return A}const d=[0,0,1,0],f=r.create(),e=r.create(),l=n();a.UP=d;a.angle=function(A){return A[3]};a.angleRad=g;a.axis=function(A){return A};a.compose=function(A,
t,w=n()){c.setAxisAngle(f,A,g(A));c.setAxisAngle(e,t,g(t));c.multiply(f,e,f);return h(w,b.rad2deg(c.getAxisAngle(w,f)))};a.copy=function(A,t=n()){return p(A[0],A[1],A[2],A[3],t)};a.create=n;a.fromAxisAndAngle=function(A,t,w=n()){m.copy(w,A);w[3]=t;return w};a.fromPoints=function(A,t,w=n()){m.cross(w,A,t);m.normalize(w,w);w[3]=-m.angle(A,t);return w};a.fromValues=p;a.setAngle=h;a.wrap=function(A,t,w,u){return p(A,t,w,u,l)};a.wrapAxisAngle=function(A,t){return p(A[0],A[1],A[2],t,l)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,b,c,r,m,n,p){function g(U){U[0]=0;U[1]=0;U[2]=0;U[3]=1;return U}function h(U,Y,V){V*=.5;const R=Math.sin(V);U[0]=R*Y[0];U[1]=R*Y[1];U[2]=R*Y[2];U[3]=Math.cos(V);return U}function d(U,Y){const V=2*Math.acos(Y[3]),R=Math.sin(V/2);R>m.getEpsilon()?(U[0]=Y[0]/R,U[1]=Y[1]/R,U[2]=Y[2]/R):(U[0]=1,U[1]=0,U[2]=0);return V}
function f(U,Y,V){const R=Y[0],X=Y[1],W=Y[2];Y=Y[3];const aa=V[0],ba=V[1],ia=V[2];V=V[3];U[0]=R*V+Y*aa+X*ia-W*ba;U[1]=X*V+Y*ba+W*aa-R*ia;U[2]=W*V+Y*ia+R*ba-X*aa;U[3]=Y*V-R*aa-X*ba-W*ia;return U}function e(U,Y,V){V*=.5;const R=Y[0],X=Y[1],W=Y[2];Y=Y[3];const aa=Math.sin(V);V=Math.cos(V);U[0]=R*V+Y*aa;U[1]=X*V+W*aa;U[2]=W*V-X*aa;U[3]=Y*V-R*aa;return U}function l(U,Y,V){V*=.5;const R=Y[0],X=Y[1],W=Y[2];Y=Y[3];const aa=Math.sin(V);V=Math.cos(V);U[0]=R*V-W*aa;U[1]=X*V+Y*aa;U[2]=W*V+R*aa;U[3]=Y*V-X*aa;
return U}function A(U,Y,V){V*=.5;const R=Y[0],X=Y[1],W=Y[2];Y=Y[3];const aa=Math.sin(V);V=Math.cos(V);U[0]=R*V+X*aa;U[1]=X*V-R*aa;U[2]=W*V+Y*aa;U[3]=Y*V-W*aa;return U}function t(U,Y){const V=Y[0],R=Y[1];Y=Y[2];U[0]=V;U[1]=R;U[2]=Y;U[3]=Math.sqrt(Math.abs(1-V*V-R*R-Y*Y));return U}function w(U,Y,V,R){const X=Y[0],W=Y[1],aa=Y[2];Y=Y[3];let ba=V[0],ia=V[1],ma=V[2];V=V[3];let ha;let ka;var Z=X*ba+W*ia+aa*ma+Y*V;0>Z&&(Z=-Z,ba=-ba,ia=-ia,ma=-ma,V=-V);1-Z>m.getEpsilon()?(ha=Math.acos(Z),ka=Math.sin(ha),Z=
Math.sin((1-R)*ha)/ka,R=Math.sin(R*ha)/ka):Z=1-R;U[0]=Z*X+R*ba;U[1]=Z*W+R*ia;U[2]=Z*aa+R*ma;U[3]=Z*Y+R*V;return U}function u(U){var Y=m.RANDOM,V=Y();const R=Y();Y=Y();const X=Math.sqrt(1-V);V=Math.sqrt(V);U[0]=X*Math.sin(2*Math.PI*R);U[1]=X*Math.cos(2*Math.PI*R);U[2]=V*Math.sin(2*Math.PI*Y);U[3]=V*Math.cos(2*Math.PI*Y);return U}function z(U,Y){const V=Y[0],R=Y[1],X=Y[2];Y=Y[3];var W=V*V+R*R+X*X+Y*Y;W=W?1/W:0;U[0]=-V*W;U[1]=-R*W;U[2]=-X*W;U[3]=Y*W;return U}function y(U,Y){U[0]=-Y[0];U[1]=-Y[1];U[2]=
-Y[2];U[3]=Y[3];return U}function B(U,Y){var V=Y[0]+Y[4]+Y[8];if(0<V)V=Math.sqrt(V+1),U[3]=.5*V,V=.5/V,U[0]=(Y[5]-Y[7])*V,U[1]=(Y[6]-Y[2])*V,U[2]=(Y[1]-Y[3])*V;else{let R=0;Y[4]>Y[0]&&(R=1);Y[8]>Y[3*R+R]&&(R=2);const X=(R+1)%3,W=(R+2)%3;V=Math.sqrt(Y[3*R+R]-Y[3*X+X]-Y[3*W+W]+1);U[R]=.5*V;V=.5/V;U[3]=(Y[3*X+W]-Y[3*W+X])*V;U[X]=(Y[3*X+R]+Y[3*R+X])*V;U[W]=(Y[3*W+R]+Y[3*R+W])*V}return U}function C(U,Y,V,R){var X=.5*Math.PI/180;Y*=X;V*=X;R*=X;X=Math.sin(Y);Y=Math.cos(Y);const W=Math.sin(V);V=Math.cos(V);
const aa=Math.sin(R);R=Math.cos(R);U[0]=X*V*R-Y*W*aa;U[1]=Y*W*R+X*V*aa;U[2]=Y*V*aa-X*W*R;U[3]=Y*V*R+X*W*aa;return U}function k(U){return"quat("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+")"}function q(U,Y,V){const R=n.dot(Y,V);if(-.999999>R)return n.cross(E,I,Y),1E-6>n.len(E)&&n.cross(E,M,Y),n.normalize(E,E),h(U,E,Math.PI),U;if(.999999<R)return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U;n.cross(E,Y,V);U[0]=E[0];U[1]=E[1];U[2]=E[2];U[3]=1+R;return N(U,U)}function x(U,Y,V,R,X,W){w(Q,Y,X,W);w(T,V,R,W);w(U,Q,T,2*W*(1-W));
return U}function v(U,Y,V,R){const X=S;X[0]=V[0];X[3]=V[1];X[6]=V[2];X[1]=R[0];X[4]=R[1];X[7]=R[2];X[2]=-Y[0];X[5]=-Y[1];X[8]=-Y[2];return N(U,B(U,X))}const D=p.copy,F=p.set,G=p.add,J=p.scale,L=p.dot,K=p.lerp,O=p.length,P=p.squaredLength,N=p.normalize,H=p.exactEquals;p=p.equals;const E=r.create(),I=r.fromValues(1,0,0),M=r.fromValues(0,1,0),Q=c.create(),T=c.create(),S=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,identity:g,setAxisAngle:h,getAxisAngle:d,multiply:f,rotateX:e,rotateY:l,
rotateZ:A,calculateW:t,slerp:w,random:u,invert:z,conjugate:y,fromMat3:B,fromEuler:C,str:k,copy:D,set:F,add:G,mul:f,scale:J,dot:L,lerp:K,length:O,len:O,squaredLength:P,sqrLen:P,normalize:N,exactEquals:H,equals:p,rotationTo:q,sqlerp:x,setAxes:v},Symbol.toStringTag,{value:"Module"}));a.add=G;a.calculateW=t;a.conjugate=y;a.copy=D;a.dot=L;a.equals=p;a.exactEquals=H;a.fromEuler=C;a.fromMat3=B;a.getAxisAngle=d;a.identity=g;a.invert=z;a.len=O;a.length=O;a.lerp=K;a.mul=f;a.multiply=f;a.normalize=N;a.quat=
b;a.random=u;a.rotateX=e;a.rotateY=l;a.rotateZ=A;a.rotationTo=q;a.scale=J;a.set=F;a.setAxes=v;a.setAxisAngle=h;a.slerp=w;a.sqlerp=x;a.sqrLen=P;a.squaredLength=P;a.str=k})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";b[b.Faded=1]="Faded";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/earthUtils":function(){define(["exports",
"../../../core/mathUtils","../../../core/maybe","../../../geometry/Point","../../../geometry/projectionEllipsoid"],function(a,b,c,r,m){function n(h,d,f){if(c.isNone(d.longitude)||c.isNone(d.latitude)||c.isNone(f.longitude)||c.isNone(f.latitude))throw Error("Invalid points: no lon/lat");return p(h,d.longitude,d.latitude,f.longitude,f.latitude)}function p(h,d,f,e,l){f=b.deg2rad(f);l=b.deg2rad(l);d=b.deg2rad(d);const A=b.deg2rad(e);e=Math.sin((f-l)/2);d=Math.sin((d-A)/2);f=2*b.asinClamped(Math.sqrt(e*
e+Math.cos(f)*Math.cos(l)*d*d));return Math.round(f*h*1E4)/1E4}function g(h,d){h/=15;d||(h=Math.round(h));return h}a.getGreatCircleDistance=p;a.getGreatCircleDistanceFromPoints=n;a.getGreatCircleSpanAt=function(h,d,f){const e=d.spatialReference,l=m.getReferenceEllipsoid(e),A=new r(d.x,h.y,e),t=new r(f.x,h.y,e);d=new r(h.x,d.y,e);h=new r(h.x,f.y,e);return{lon:n(l.radius,A,t),lat:n(l.radius,d,h)}};a.getLatDeltaForDistance=function(h,d){return b.rad2deg(h/d)};a.getLonDeltaForDistance=function(h,d,f){d/=
f;h=b.deg2rad(h);d=Math.sin(d/2);h=Math.cos(h);h=2*b.asinClamped(Math.sqrt(d*d/(h*h)));return b.rad2deg(h)};a.longitudeToTimezone=g;a.positionToTimezoneInfo=function(h,d){d||(d={hours:0,minutes:0,seconds:0});d.hours=g(h[0],!0);h=d.hours%1;d.hours-=h;d.minutes=60*h;h=d.minutes%1;d.minutes-=h;d.seconds=Math.round(60*h);return d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(v,D,F){D===g.ViewingMode.Global?n.normalize(k,v.eye):n.set(k,0,0,1);n.scale(q,v.viewForward,-1);D=d.angle(q,k);const G=Math.max(D-.5,0);r.fromRotation(C,-Math.max(.25,D-.25-.85*G/(G+1)),v.viewRight);n.transformMat4(F,q,C);n.add(F,F,n.scale(x,v.viewRight,.2));n.normalize(F,F)}function e(v,D,F,G){const J=y,L=r.identity(z);if(F===g.ViewingMode.Global)h.SunCalc.getPosition(v,0,0,J),n.set(G,0,0,-1),r.rotateX(L,L,-J.azimuth),r.rotateY(L,L,-J.altitude);else{var K=
w.planarDirection;F=K.globalAngles;K=(Math.abs(D[2])-K.localAltitude)/(K.globalAltitude-K.localAltitude);K=b.clamp(K,0,1);1>K?(h.SunCalc.getPosition(v,D[1],D[0],J),J.azimuth=(1-K)*J.azimuth+K*F.azimuth,J.altitude=(1-K)*J.altitude+K*F.altitude):(J.azimuth=F.azimuth,J.altitude=F.altitude);n.set(G,0,-1,0);r.rotateZ(L,L,-J.azimuth);r.rotateX(L,L,-J.altitude)}n.transformMat4(G,G,L)}function l(v){switch(v){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};
case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function A(v,D){const F=(v[0]+v[1]+v[2])/3;for(let G=0;3>G;G++)v[G]+=(F-v[G])*D;return v}function t(v,D,F,G){const J=[];for(let L=0;L<F.length;L++)J[L]=(G[L]-F[L])*v/D+F[L];return J}const w={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,
globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},u=p.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),z=m.create(),y={azimuth:0,altitude:0},B=new Date(0),C=m.create(),k=p.create(),q=p.create(),x=p.create();a.ColorAndIntensity=function(){this.ambient={color:p.fromValues(1,1,1),intensity:.55};this.direct={color:p.fromValues(1,1,1),intensity:.55,directionToLightSource:p.clone(u)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=
1};a.computeColorAndIntensity=function(v,D,F,G,J,L){n.set(L.ambient.color,1,1,1);L.ambient.intensity=w.global.ambient;n.set(L.direct.color,1,1,1);L.direct.intensity=w.global.direct;var K=b.clamp((Math.abs(D[2])-w.local.altitude)/(w.global.altitude-w.local.altitude),0,1);L.globalFactor=K;var O;c.isSome(v)&&(O=h.SunCalc.getTimes(v,D[1],D[0]));if(1>K){if(c.isSome(v)){var P=O;var N=v.valueOf();if(P.polarException===h.SunCalc.PolarException.MIDNIGHT_SUN){var H=N-36E5*(v.getHours()+48)-6E4*v.getMinutes();
var E=H+432E6}else P.polarException===h.SunCalc.PolarException.POLAR_NIGHT?(H=N-2,E=N-1):(H=P.sunrise.valueOf(),E=P.sunset.valueOf());var I=E-H;P=H+I/2;var M=I/4;var Q=P-M;M=P+M;var T=.06*I;I=H-T/2;H+=T/2;const U=E-T/2,Y=E+T/2;E=w.local;T=[.01,E.ambientAtNight];const V=[.8,.8,1],R=[.01,.01,.01],X=[E.directAtTwilight,E.ambientAtTwilight],W=[1,.6,.5],aa=[.8,.8,1],ba=[.9*E.directAtNoon,E.ambientAtNoon],ia=[1,.98,.98],ma=[.98,.98,1],ha=[E.directAtNoon,E.ambientAtNoon],ka=[1,1,1],Z=[1,1,1];E=[0,0];let ca=
[0,0,0];var S=[0,0,0];N<I||N>Y?(E=T,ca=R,S=V):N<H?(S=H-I,E=t(N-I,S,T,X),ca=t(N-I,S,R,W),S=t(N-I,S,V,aa)):N<Q?(S=Q-H,E=t(N-H,S,X,ba),ca=t(N-H,S,W,ia),S=t(N-H,S,aa,ma)):N<P?(S=P-Q,E=t(N-Q,S,ba,ha),ca=t(N-Q,S,ia,ka),S=t(N-Q,S,ma,Z)):N<M?(S=M-P,E=t(N-P,S,ha,ba),ca=t(N-P,S,ka,ia),S=t(N-P,S,Z,ma)):N<U?(S=U-M,E=t(N-M,S,ba,X),ca=t(N-M,S,ia,W),S=t(N-M,S,ma,aa)):N<Y&&(S=Y-U,E=t(N-U,S,X,T),ca=t(N-U,S,W,R),S=t(N-U,S,aa,V));N=0;switch(G){case "rainy":case "foggy":N=.9;case "snowy":N=.5}0<N&&(ca=A(ca,N),S=A(S,
N));P=p.fromValues(ca[0],ca[1],ca[2]);Q=p.fromValues(S[0],S[1],S[2]);M=l(G);N=E[0]*M.direct;E=E[1]*M.ambient}else Q=l(G),N=w.local.directAtNoon*Q.direct,P=p.fromValues(1,1,1),E=w.local.ambientAtNoon*Q.ambient,Q=p.fromValues(1,1,1);n.lerp(L.ambient.color,Q,L.ambient.color,K);L.ambient.intensity=b.lerp(E,L.ambient.intensity,K);n.lerp(L.direct.color,P,L.direct.color,K);L.direct.intensity=b.lerp(N,L.direct.intensity,K);L.specularStrength="rainy"===G||"snowy"===G||"foggy"===G?0:1;L.environmentStrength=
"rainy"===G?.7:"snowy"===G||"foggy"===G?.75:1}c.isSome(v)?(G=v.valueOf(),O.polarException===h.SunCalc.PolarException.MIDNIGHT_SUN?(K=G-36E5*(v.getHours()+48)-6E4*v.getMinutes(),O=K+432E6):O.polarException===h.SunCalc.PolarException.POLAR_NIGHT?(K=G-2,O=G-1):(K=O.sunrise.valueOf(),O=O.sunset.valueOf()),G=1-b.clamp(Math.abs(G-(K+(O-K)/2))/432E5,0,1)):G=1;L.noonFactor=G;c.isSome(v)?e(v,D,F,L.direct.directionToLightSource):f(J,F,L.direct.directionToLightSource)};a.computeDirectionsOverTime=function(v,
D,F,G,J){v=v.getTime();D=D.getTime()-v;D=Math.floor(D/F)+1;const L=Array(D);for(let K=0;K<D;++K)B.setTime(v+F*K),L[K]=p.create(),e(B,G,J,L[K]);return L};a.computeShadowsEnabled=function(v,D){return D===g.ViewingMode.Global?!0:Math.abs(v)<w.planarDirection.localAltitude};a.computeVirtualLightDirection=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(r){r=
r();void 0!==r&&(c.exports=r)})(function(){function r(v){return new Date(864E5*(v+.5-2440588))}function m(v,D){return z(A(v)*t(k)-w(D)*A(k),t(v))}function n(v,D){return u(A(D)*t(k)+t(D)*A(k)*A(v))}function p(v,D,F){return z(A(v),t(v)*A(D)-w(F)*t(D))}function g(v,D,F){return u(A(D)*A(F)+t(D)*t(F)*t(v))}function h(v){return B*(1.9148*A(v)+.02*A(2*v)+3E-4*A(3*v))}function d(v,D){v=B*(357.5291+.98560028*v);var F=h(v);v=v+F+102.9372*B+l;D||(D={dec:0,ra:0});D.dec=n(v,0);D.ra=m(v,0);return D}function f(v,
D,F){return 2451545+v+.0053*A(D)-.0069*A(2*F)}function e(v){var D=B*(134.963+13.064993*v),F=B*(93.272+13.22935*v);v=B*(218.316+13.176396*v)+6.289*B*A(D);F=5.128*B*A(F);D=385001-20905*t(D);return{ra:m(v,F),dec:n(v,F),dist:D}}var l=Math.PI,A=Math.sin,t=Math.cos,w=Math.tan,u=Math.asin,z=Math.atan2,y=Math.acos,B=l/180,C={dec:0,ra:0},k=23.4397*B,q={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(v,D,F,G){F=B*-F;D*=B;var J=v.valueOf()/864E5-.5+2440588-2451545;v=d(J,C);F=B*(280.16+
360.9856235*J)-F-v.ra;G||(G={azimuth:0,altitude:0});G.azimuth=p(F,D,v.dec);G.altitude=g(F,D,v.dec);return G}},x=[[-.83,"sunrise","sunset"]];q.addTime=function(v,D,F){x.push([v,D,F])};q.getTimes=function(v,D,F){function G(Q){var T=L,S=N;Q=y((A(Q)-A(T)*A(S))/(t(T)*t(S)));return f(9E-4+(Q+J)/(2*l)+K,O,P)}var J=B*-F,L=B*D,K=Math.round(v.valueOf()/864E5-.5+2440588-2451545-9E-4-J/(2*l));v=9E-4+(0+J)/(2*l)+K;var O=B*(357.5291+.98560028*v);D=h(O);var P=O+D+102.9372*B+l,N=n(P,0);v=f(v,O,P);D={solarNoon:r(v),
nadir:r(v-.5),polarException:q.PolarException.NORMAL};var H;F=0;for(H=x.length;F<H;F+=1){var E=x[F];var I=G(E[0]*B);var M=v-(I-v);D[E[1]]=r(M);D[E[2]]=r(I)}D.polarException=function(Q){Q=(A(Q)-A(L)*A(N))/(t(L)*t(N));return-1>Q?q.PolarException.MIDNIGHT_SUN:1<Q?q.PolarException.POLAR_NIGHT:q.PolarException.NORMAL}(x[0][0]*B);return D};q.getMoonPosition=function(v,D,F){F=B*-F;D*=B;var G=v.valueOf()/864E5-.5+2440588-2451545;v=e(G);F=B*(280.16+360.9856235*G)-F-v.ra;G=g(F,D,v.dec);G+=.017*B/w(G+10.26*
B/(G+5.1*B));return{azimuth:p(F,D,v.dec),altitude:G,distance:v.dist}};q.getMoonFraction=function(v){var D=v.valueOf()/864E5-.5+2440588-2451545;v=d(D);D=e(D);v=y(A(v.dec)*A(D.dec)+t(v.dec)*t(D.dec)*t(v.ra-D.ra));v=z(149598E3*A(v),D.dist-149598E3*t(v));return(1+t(v))/2};return q})})(b);a.SunCalc=b.exports})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){c=function(O){function P(){var H=O.apply(this,arguments)||this;H._handles=new r;return H}a._inheritsLoose(P,O);var N=P.prototype;N.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};N.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager=m.destroyMaybe(this._inputManager)};N.connect=function(){const H=this.view;this._source=new k.BrowserEventSource(this.view.surface,
H.input);var E=[new D.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new G.SingleAndDoubleClick,new v.Drag(this.view.navigation),new J.VerticalTwoFingerDrag];this._inputManager=E=new q.InputManager({eventSource:this._source,recognizers:E});E.installHandlers("prevent-context-menu",[new x.PreventContextMenu],q.ViewEventPriorities.INTERNAL);this._modeDragPan=new u.PinchAndPanNavigation(H,"primary");this._modeDragRotate=new e.DragRotate(H,"secondary",L.PivotPoint.CENTER);this._modeDragZoom=new l.DragZoom(H,
"tertiary");E.installHandlers("navigation",[new z.PointerDownCancelAnimation(H),new f.DoubleClickZoom(H),new A.GamepadNavigation(H),new t.KeyboardNavigation(H,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new w.MouseWheelZoom(H),new B.SingleKeyResetTilt(H,"p"),new y.SingleKeyResetHeading(H,"n"),new e.DragRotate(H,"primary",L.PivotPoint.EYE,["b"]),new e.DragRotate(H,"secondary",
L.PivotPoint.CENTER,["b"]),new u.PinchAndPanNavigation(H,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new C.TwoFingerTilt(H)],q.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(E);this._updateMode();this._handles.add(n.watch(()=>this.view.navigation?.browserTouchPanEnabled,I=>{this._source.browserTouchPanningEnabled=!I},n.initial))};N._updateMode=function(){var H=this.primaryDragAction;H=K.get(this.mode).get(H);this._modeDragPan&&(this._modeDragPan.pointerAction=
H.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=H.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=H.zoom)};a._createClass(P,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(H){"pan"!==H&&"rotate"!==H||H===this._get("primaryDragAction")||(this._set("primaryDragAction",H),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(H){"default"!==H&&"pro"!==H||H===this._get("mode")||(this._set("mode",
H),this._updateMode())}},{key:"hasPendingInputs",get:function(){return this._inputManager?.hasPendingInputs}},{key:"latestPointerType",get:function(){return this._inputManager?.latestPointerType}},{key:"latestPointerLocation",get:function(){return this._inputManager?.latestPointerLocation}},{key:"multiTouchActive",get:function(){return this._inputManager?.multiTouchActive??!1}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,
modeDragZoom:this._modeDragZoom}}}]);return P}(c);b.__decorate([p.property()],c.prototype,"view",void 0);b.__decorate([p.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([p.property({value:"default"})],c.prototype,"mode",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"hasPendingInputs",null);b.__decorate([p.property()],c.prototype,"latestPointerType",null);b.__decorate([p.property()],c.prototype,"latestPointerLocation",null);b.__decorate([p.property()],c.prototype,
"multiTouchActive",null);b.__decorate([p.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],c);const K=new Map;b=new Map;p=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});p.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});p.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});K.set("default",b);K.set("pro",p);return c})},
"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,r,m,n,p){n=function(g){function h(d,f){var e=g.call(this,!0)||this;e._view=d;e.registerIncoming("double-click",f,l=>e._handleDoubleClick(l));return e}b._inheritsLoose(h,
g);h.prototype._handleDoubleClick=function(d){const f=d.data;if(p.eventMatchesPointerAction(f,"primary")){const e=this._view.state.isGlobal?new r.ZoomStepController({view:this._view,mode:"animation"}):new m.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/Math.log(.6),c.createScreenPointArray(f.x,f.y));d.stopPropagation()}};return h}(n.InputHandler);a.DoubleClickZoom=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G){a.ZoomStepController=function(O){function P(){var H=O.apply(this,arguments)||this;H._zoomLocation=l.create();H._tmpCamera=new v.Camera;H._tmpViewDir=l.create();H._tmpRayDir={origin:l.create(),direction:l.create()};H._targetOnSphere=l.create();H._tmpCenter=l.create();H._constraintOptions={selection:u.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:z.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new v.Camera,
interactionDirection:null,tiltMode:B.TiltMode.TUMBLE};H._sphere=t.create();return H}b._inheritsLoose(P,O);var N=P.prototype;N.initialize=function(){this._intersector=D.newIntersector(this.view.state.viewingMode)};N.zoomStep=function(H,E){if(this.active){var I=this.view.state,{interactionStartCamera:M}=this._constraintOptions;this.animation.finished?M.copyFrom(I.camera):this.animation.cameraAt(1,M);var Q=M=!1;this.intersectionHelper.intersectScreen(E,this._zoomLocation,0===this.view.map.ground.opacity?
K:{})&&(M=0<H?!0:!1,Q=!0);this._tmpCamera.copyFrom(I.camera);M?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,H,this._zoomLocation,E,Q);this.begin(this._tmpCamera)}};N.animationSettings=function(){return{apex:null,
duration:m.Milliseconds(600),easing:G.outExpo}};N._updateCamera=function(H,E,I,M,Q){var T=A.getReferenceEllipsoid(this.view.spatialReference);T=k.decideNavigationMode(H,M,Q,T);var S;this.view.camera.position.hasZ&&(S=Math.abs(this.view.camera.position.z));e.normalize(L,H.eye);e.scale(L,L,-1);q.fromScreenAtEye(H,M,this._tmpRayDir);e.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const U=Math.max(Math.min(12,1/Math.abs(e.dot(L,this._tmpRayDir.direction)))*S,200);if(T===k.NavigationMode.Horizontal){E=
.6**E;this._sphere[3]=e.length(I);e.subtract(this._tmpViewDir,H.center,H.eye);Q=Math.min(e.length(this._tmpViewDir),U);T=Q*E;1>=E&&4>T&&(T=4,E=T/Q);if(1E-6>Math.abs(Q-T))return;Q=e.length(H.center);this._sphere[3]!==Q&&(H.center=e.scale(J,H.center,(this._sphere[3]+E*(Q-this._sphere[3]))/Q));e.scale(this._tmpViewDir,this._tmpViewDir,-E);H.eye=e.add(J,H.center,this._tmpViewDir);w.applyAll(this.view,H,this._constraintOptions);1E-12<e.squaredDistance(I,H.center)&&x.intersectScreen(this._sphere,H,M,this._targetOnSphere)&&
k.panToPosition(this._sphere,H,I,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{T=.6**Math.abs(E);S=0<E?1:-1;e.subtract(this._tmpViewDir,I,H.eye);const Y=e.length(this._tmpViewDir);M=this.view._stage.renderView.getMinimalDepthForArea(null,M[0],M[1],this.view.state.camera,60);M=r.isSome(M)?Math.min(U,M):U;M=Q?Math.min(M,Y):M;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,M);e.add(I,this._tmpRayDir.origin,this._tmpRayDir.direction);I=M*T;Q=Math.max(4,1.01*
H.nearFar[0]);0<E&&I<Q&&(I=Q,T=I/M);if(1E-6>Math.abs(M-I))return;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,S*(1-T));H.eye=e.add(J,H.eye,this._tmpRayDir.direction);H.center=e.add(J,H.center,this._tmpRayDir.direction)}y.applySurfaceCollisionConstraint(this.view,H)};return P}(C.PointToPointAnimationController);a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const J=l.create(),L=l.create(),K={exclude:new Set([F.TERRAIN_ID])};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ./constraintUtils/TiltMode ../../animation/easing".split(" "),function(a,b,c,r,m,n,p,g,h,d){const f=[{type:r.ConstraintTypes.TILT,error:function(l,
A,t){return g.getTiltConstraintError(l,A,t)*A.distance},apply:g.applyTiltConstraint},{type:r.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:r.ConstraintTypes.DISTANCE,error:m.getDistanceConstraintError,apply:m.applyDistanceConstraint}],e={selection:r.ConstraintTypes.ALL,interactionType:n.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:h.TiltMode.TUMBLE};a.applyAll=function(l,A,t=e,w=A){w!==
A&&w.copyFrom(A);w.computeUp(l.state.viewingMode);A=!1;for(let z=0;5>z;z++){let y=0;for(var u of f)if(c.hasConstraintType(t.selection,u.type)){const B=Math.abs(u.error(l,w,t));u.apply(l,w,t)&&(A=!0,y+=B)}if(0===y)break}u=c.hasConstraintType(t.selection,r.ConstraintTypes.COLLISION);a:switch(t.interactionType){case n.InteractionType.PAN:t=p.Mode.EYE_AND_CENTER;break a;case n.InteractionType.ASCEND:t=l.state.isGlobal?p.Mode.EYE_AND_CENTER_SCALE:p.Mode.EYE_AND_CENTER;break a;default:t=p.Mode.EYE}u&&p.applySurfaceCollisionConstraint(l,
w,t)&&(A=!0);A&&w.computeUp(l.state.viewingMode);return A};a.pixelDistanceToInteractionFactor=function(l){return d.inOutCubic(Math.min(1,l/150))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(u,z,y=p.defaultConstraintOptions){var B=u.state.constraints.altitude;B=u.state.isGlobal&&B?y.interactionType===h.InteractionType.TUMBLE&&p.hasConstraintType(y.selection,g.ConstraintTypes.TILT)?!1:!0:!1;if(!B)return 0;var C=u.state.constraints.altitude;B=e;B.min=C.min;B.max=C.max;C=y.interactionType;if(C!==h.InteractionType.NONE){var {min:k,max:q}=B,{interactionStartCamera:x,interactionFactor:v}=y;y=C===h.InteractionType.TUMBLE||C===h.InteractionType.ZOOM;C=
f(u,x);var D=0===C?0:u.renderCoordsHelper.getAltitude(x.eye);B.min=k;B.max=q;p.adjustRangeForInteraction(C,D,y,v,.05*D,B)}u=u.renderCoordsHelper.getAltitude(z.eye);u=b.clamp(u,B.min,B.max)-u;return 1E-6>=Math.abs(u)?0:u}const e={min:0,max:0},l=m.create(),A=m.create(),t=m.create(),w=m.create();a.applyAltitudeConstraint=function(u,z,y=p.defaultConstraintOptions){var B=f(u,z,y);if(0===B)return!1;const C=u.renderCoordsHelper,k=C.getAltitude(z.eye)+B;var q=p.interactionDirectionTowardsConstraintMinimization;
y=y.interactionDirection;B=Math.sign(B);u.renderCoordsHelper.worldUpAtPosition(z.eye,A);r.scale(A,A,B);q=q.call(p,z,y,A,l);u=r.copy(t,z.viewForward);q=C.intersectInfiniteManifold(n.wrap(z.eye,q),k,w);z.eye=c.isSome(q)?q:C.setAltitude(w,k,z.eye);z.center=d.closestPointOnRay(w,z.eye,u,z.center);return!0};a.getAltitudeConstraintError=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports",
"../../../../chunks/vec3","./ConstraintTypes","./InteractionType","./TiltMode"],function(a,b,c,r,m){c={selection:c.ConstraintTypes.NONE,interactionType:r.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(n,p,g,h,d,f){0!==n&&(g?(f.min=Math.min(f.min,p),f.max=Math.max(f.max,p)):null!=h?(f.min-=Math.max(0,(p-f.min)*(1-h)),f.max+=Math.max(0,(p-f.max)*(1-h))):d&&(f.min-=Math.max(0,p-f.min-d),f.max+=
Math.max(0,p-f.max-d)))};a.defaultConstraintOptions=c;a.hasConstraintType=function(n,p){return 0!==(n&p)};a.interactionDirectionTowardsConstraintMinimization=function(n,p,g,h){p=p||n.viewForward;b.copy(h,p);b.scale(h,h,Math.sign(b.dot(p,g)));return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes=
{});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=
2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports",
"../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,b,c,r,m){function n(h,d,f,e){const l=g;h?(f&&e&&(l.len=c.distance(d,f)),c.copy(l.dir,h)):e?(l.len=c.distance(d,f),c.subtract(l.dir,f,d),c.scale(l.dir,l.dir,1/l.len)):(c.subtract(l.dir,f,d),c.normalize(l.dir,l.dir));return l}function p(h,d,f,e){e.clip[0]=0;e.clip[1]=f?e.len:Number.MAX_VALUE;for(f=0;f<h.length;f++){{var l=h[f],A=d;var t=e;const w=c.dot(m.normal(l),t.dir);l=-m.signedDistance(l,
A);0>l&&0<=w?t=!1:-1E-6<w&&1E-6>w?t=0<l:!(0>l||0>w)||0>l&&0>w?(l/=w,0<w?l<t.clip[1]&&(t.clip[1]=l):l>t.clip[0]&&(t.clip[0]=l),t=t.clip[0]<=t.clip[1]):t=!0}if(!t)return!1}return!0}const g={dir:r.create(),len:0,clip:b.create()};a.closestPointOnRay=function(h,d,f,e){e=c.dot(f,c.subtract(h,e,d));return c.add(h,d,c.scale(h,f,e))};a.frustumLineSegment=function(h,d,f,e){e=n(e,d,f,!0);return p(h,d,f,e)};a.frustumPoint=function(h,d){for(let f=0;6>f;f++)if(0<m.signedDistance(h[f],d))return!1;return!0};a.frustumRay=
function(h,d,f,e){f=n(e,d,f,!1);return p(h,d,null,f)};a.frustumSphere=function(h,d,f){const e=d[0],l=d[1];d=d[2];return h[0][0]*e+h[0][1]*l+h[0][2]*d+h[0][3]>f||h[1][0]*e+h[1][1]*l+h[1][2]*d+h[1][3]>f||h[2][0]*e+h[2][1]*l+h[2][2]*d+h[2][3]>f||h[3][0]*e+h[3][1]*l+h[3][2]*d+h[3][3]>f||h[4][0]*e+h[4][1]*l+h[4][2]*d+h[4][3]>f||h[5][0]*e+h[5][1]*l+h[5][2]*d+h[5][3]>f?!1:!0};a.planeSphere=function(h,d,f){return h[0]*d[0]+h[1]*d[1]+h[2]*d[2]+h[3]<f};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),function(a,b,c,r,m,n,p,g){function h(w,u,z=p.defaultConstraintOptions){if(!w.state.isLocal)return 0;var y=w.state.constraints.distance;if(!w.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===y)return 0;d.min=0;d.max=y;y=d;var B=z.interactionType;
if(B!==g.InteractionType.NONE){var {min:C,max:k}=y,{interactionStartCamera:q,interactionFactor:x}=z;z=B===g.InteractionType.ZOOM||B===g.InteractionType.PAN;B=h(w,q);var v=0===B?0:c.distance(q.eye,w.pointsOfInterest.surfaceOrigin.renderLocation);y.min=C;y.max=k;p.adjustRangeForInteraction(B,v,z,x,.05*v,y)}w=c.distance(u.eye,w.pointsOfInterest.surfaceOrigin.renderLocation);w=d.max-w;return-1E-6<=w?0:w}const d={min:0,max:0},f=r.create(),e=r.create(),l=r.create(),A=r.create(),t=r.create();a.applyDistanceConstraint=
function(w,u,z=p.defaultConstraintOptions){var y=h(w,u,z);if(0===y)return!1;var B=w.pointsOfInterest.surfaceOrigin;y=c.distance(u.eye,w.pointsOfInterest.surfaceOrigin.renderLocation)+y;const C=c.copy(f,u.eye);var k=p.interactionDirectionTowardsConstraintMinimization;z=z.interactionDirection;var q=c.direction(A,u.eye,w.pointsOfInterest.surfaceOrigin.renderLocation);k=k.call(p,u,z,q,l);if(!n.intersectRay(n.fromCenterAndRadius(B.renderLocation,y),m.wrap(u.eye,k),t))return!1;u.eye=t;B=c.subtract(e,u.eye,
C);u.center=c.add(t,u.center,B);B=w.renderCoordsHelper.getAltitude(u.center);w=w.renderCoordsHelper.intersectInfiniteManifold(u.ray,B,t);b.isSome(w)&&(u.center=w);return!0};a.getDistanceConstraintError=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,r){a.Mode=void 0;(function(p){p[p.EYE=
0]="EYE";p[p.EYE_AND_CENTER=1]="EYE_AND_CENTER";p[p.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const m=c.create(),n=c.create();a.applySurfaceCollisionConstraint=function(p,g,h=a.Mode.EYE){var d=p.state.constraints;if(!d.collision.enabled)return!1;var f=r.surfaceElevationBelowRenderLocation(p,g.eye);const e=p.renderCoordsHelper.getAltitude(g.eye);d=f+d.collision.elevationMargin;if(e>=d)return!1;f=b.length(g.eye);b.subtract(m,g.center,g.eye);g.eye=p.renderCoordsHelper.setAltitude(n,
d,g.eye);h===a.Mode.EYE_AND_CENTER?g.center=b.add(m,g.eye,m):h===a.Mode.EYE_AND_CENTER_SCALE&&(g.center=b.scale(m,g.center,(f-e+d)/f));return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,
b,c,r,m,n,p){function g(t,w){return t.elevationProvider?b.unwrapOr(t.elevationProvider.getElevation(w[0],w[1],w[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function h(t,w,u){if(!t.state.isGlobal)return!1;const z=g(t,w);({far:t}=t.stateManager.constraintsManager.nearFarHeuristic.compute(w,u,t.renderDataExtent,z,A));t*=t;return c.squaredDistance(w,u)>t}const d={},f=r.create(),e=r.create(),l=r.create(),A={near:0,far:0};a.cameraOnContentAlongViewDirection=function(t,w,u,z){const y=t.state.camera.clone();
w&&(y.eye=w,y.center=u,y.up=z);w=y.ray;u=d[t.viewingMode];u||(u=p.newIntersector(t.state.viewingMode),u.options.backfacesTerrain=!t.state.isGlobal,u.options.invisibleTerrain=!0,d[t.viewingMode]=u);({isGlobal:z}=t.state);t.sceneIntersectionHelper.intersectRay(w,u,e)&&!h(t,w.origin,e)?w=!0:!t.renderCoordsHelper.intersectManifold(w,0,e)||h(t,w.origin,e)?z?(u=m.getReferenceEllipsoid(t.spatialReference).radius,u=c.dot(w.origin,w.origin)-u*u,c.scale(e,w.direction,(0<u?Math.sqrt(u)/3:1)/c.length(w.direction)),
c.add(e,e,w.origin),w=!0):w=!1:w=!0;w||c.copy(e,y.center);u=t.state.constraints;z=u.minimumPoiDistance;c.squaredDistance(y.eye,e)<z&&(w=u.collision.enabled,c.copy(l,y.viewForward),c.scale(l,l,z),w?y.eye=c.subtract(f,e,l):c.add(e,y.eye,l),t=t.renderCoordsHelper,z=t.getAltitude(y.eye),u=u.collision.elevationMargin,w&&z<u&&(c.subtract(l,e,y.eye),y.eye=t.setAltitude(f,u,y.eye),c.add(e,y.eye,l)));y.center=e;return y};a.eyeWithinExtent=function(t,w,u,z){return b.isSome(t.renderCoordsHelper.fromRenderCoords(w.eye,
f,z))&&n.containsPoint(u,f)};a.surfaceElevationBelowRenderLocation=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){let w=function(){function k(x){this.options=new e.IntersectorOptions;this._results=new u;this.transform=new A.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=d.create();this._rayEnd=p.create();this._rayBeginTransformed=p.create();this._rayEndTransformed=p.create();this.viewingMode=null==x?f.ViewingMode.Global:x}var q=k.prototype;q.reset=function(x,v,D){this.resetWithRay(d.fromPoints(x,v,this._ray),D)};q.resetWithRay=function(x,v){this.camera=
v;x!==this._ray&&d.copy(x,this._ray);0!==this.options.verticalOffset?this.viewingMode===f.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;n.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};q.intersect=function(x=null,v,D,F,G){this.point=v;this.filterPredicate=F;this.tolerance=null==D?1E-5:D;v=A.getVerticalOffsetObject3D(this.verticalOffset);if(c.isSome(x)&&0<x.length){const J=
G?L=>{G(L)&&this.intersectObject(L)}:L=>{this.intersectObject(L)};for(const L of x)x=L.getSpatialQueryAccelerator&&L.getSpatialQueryAccelerator(),c.isSome(x)?(c.isSome(v)?x.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,J,v):x.forEachAlongRay(this._ray.origin,this._ray.direction,J),this.options.selectionMode&&this.options.hud&&x.forEachDegenerateObject(J)):L.objects.forAll(K=>J(K))}this.sortResults()};q.intersectObject=function(x){const v=x.geometryRecords;if(v){var D=x.transformation,
F=A.getVerticalOffsetObject3D(this.verticalOffset);for(const G of v){const {geometry:J,material:L,instanceParameters:K}=G;if(t.isInstanceHidden(K))continue;const O=J.id;this.transform.setAndInvalidateLazyTransforms(D,G.getShaderTransformation());n.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);n.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const P=this.transform.transform;c.isSome(F)&&(F.objectTransform=this.transform);L.intersect(J,K,this.transform.transform,
this,this._rayBeginTransformed,this._rayEndTransformed,(N,H,E,I,M,Q)=>{if(0<=N&&(!c.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,N))){var T=I?this._results.hud:this._results,S=I?U=>{const Y={object:x,geometryId:O,triangleNr:E,center:c.isSome(Q)?[Q[0],Q[1],Q[2]]:null};U.set(e.IntersectorType.HUD,Y,N,H,m.IDENTITY,M)}:U=>U.set(e.IntersectorType.OBJECT,{object:x,geometryId:O,triangleNr:E},N,H,P,M);(null==T.min.drapedLayerOrder||M>=T.min.drapedLayerOrder)&&(null==T.min.dist||
N<T.min.dist)&&S(T.min);this.options.store!==e.StoreResults.MIN&&(null==T.max.drapedLayerOrder||M<T.max.drapedLayerOrder)&&(null==T.max.dist||N>T.max.dist)&&S(T.max);this.options.store===e.StoreResults.ALL&&(I?(I=new y(this._ray),S(I),this._results.hud.all.push(I)):(I=new z(this._ray),S(I),this._results.all.push(I)))}},G.shaderTransformation)}}};q.sortResults=function(x=this._results.all){x.sort((v,D)=>v.dist!==D.dist?c.unwrapOr(v.dist,0)-c.unwrapOr(D.dist,0):v.drapedLayerOrder!==D.drapedLayerOrder?
c.unwrapOr(v.drapedLayerOrder,Number.MAX_VALUE)-c.unwrapOr(D.drapedLayerOrder,Number.MAX_VALUE):c.unwrapOr(D.drapedLayerGraphicOrder,Number.MIN_VALUE)-c.unwrapOr(v.drapedLayerGraphicOrder,Number.MIN_VALUE))};b._createClass(k,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return k}(),u=function(){function k(){this.min=new z(d.create());this.max=
new z(d.create());this.hud={min:new y(d.create()),max:new y(d.create()),all:[]};this.ground=new z(d.create());this.all=[]}k.prototype.init=function(q){this.min.init(q);this.max.init(q);this.ground.init(q);this.all.length=0;this.hud.min.init(q);this.hud.max.init(q);this.hud.all.length=0};return k}(),z=function(){function k(x){this.intersector=e.IntersectorType.OBJECT;this.normal=p.create();this.transformation=m.create();this._ray=d.create();this.init(x)}var q=k.prototype;q.getIntersectionPoint=function(x){if(!l.isValidIntersectorResult(this))return!1;
n.scale(B,this.ray.direction,this.dist);n.add(x,this.ray.origin,B);return!0};q.getTransformedNormal=function(x){n.copy(C,this.normal);C[3]=0;g.transformMat4(C,C,this.transformation);n.copy(x,C);return n.normalize(x,x)};q.init=function(x){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=e.IntersectorType.OBJECT;d.copy(x,this._ray)};q.set=function(x,v,D,F,G,J,L){this.intersector=x;this.dist=D;n.copy(this.normal,c.unwrapOr(F,p.UNIT_Z));r.copy(this.transformation,
c.unwrapOr(G,m.IDENTITY));this.target=v;this.drapedLayerOrder=J;this.drapedLayerGraphicOrder=L};q.copy=function(x){d.copy(x.ray,this._ray);this.intersector=x.intersector;this.dist=x.dist;this.target=x.target;this.drapedLayerOrder=x.drapedLayerOrder;this.drapedLayerGraphicOrder=x.drapedLayerGraphicOrder;n.copy(this.normal,x.normal);r.copy(this.transformation,x.transformation)};b._createClass(k,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return c.isSome(this.dist)?
(n.scale(B,this.ray.direction,this.dist),n.length(B)):null}}]);return k}(),y=function(k){function q(){var x=k.apply(this,arguments)||this;x.intersector=e.IntersectorType.HUD;return x}b._inheritsLoose(q,k);return q}(z);const B=p.create(),C=h.create();a.DEFAULT_TOLERANCE=1E-5;a.newIntersector=function(k){return new w(k)};a.newIntersectorResult=function(k){return new z(k)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],
function(a){a.IntersectorType=void 0;(function(b){b[b.OBJECT=0]="OBJECT";b[b.HUD=1]="HUD";b[b.TERRAIN=2]="TERRAIN";b[b.OVERLAY=3]="OVERLAY";b[b.I3S=4]="I3S";b[b.PCL=5]="PCL";b[b.LOD=6]="LOD";b[b.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(b){b[b.MIN=0]="MIN";b[b.MINMAX=1]="MINMAX";b[b.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=
!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=a.StoreResults.ALL};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),function(a,b,c,r,m,n){function p(h){return b.isSome(h)&&b.isSome(h.dist)}const g=r.create();
a.isHudIntersectorResult=function(h){return p(h)&&h.intersector===n.IntersectorType.HUD&&!!h.target&&b.isSome(h.target.center)};a.isObjectIntersectorResult=function(h){return p(h)&&h.intersector===n.IntersectorType.OBJECT&&!!h.target};a.isValidIntersectorResult=p;a.sliceFilterPredicate=function(h){return(d,f,e)=>{c.lerp(g,d,f,e);return!m.extrusionContainsPoint(h,g)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/sphere".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(){function D(){this._transform=p.create();this._transformInverse=new t({value:this._transform},n.invert,p.create);this._transformInverseTranspose=new t(this._transformInverse,n.transpose,p.create);this._transformTranspose=new t({value:this._transform},n.transpose,p.create);this._transformInverseRotation=new t({value:this._transform},r.normalFromMat4Legacy,m.create)}var F=D.prototype;F._invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};F.setTransformMatrix=function(G){n.copy(this._transform,G)};F.multiplyTransform=function(G){n.multiply(this._transform,this._transform,G)};F.set=function(G){n.copy(this._transform,G);this._invalidateLazyTransforms()};F.setAndInvalidateLazyTransforms=function(G,J){this.setTransformMatrix(G);this.multiplyTransform(J);this._invalidateLazyTransforms()};b._createClass(D,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return D}(),t=function(){function D(F,G,J){this._original=F;this._update=G;this._dirty=!0;this._transform=J()}D.prototype.invalidate=function(){this._dirty=
!0};b._createClass(D,[{key:"value",get:function(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}]);return D}(),w=function(){function D(G=0){this.offset=G;this.tmpVertex=e.create()}var F=D.prototype;F.applyToVertex=function(G,J,L){const K=G+this.localOrigin[0],O=J+this.localOrigin[1],P=L+this.localOrigin[2],N=this.offset/Math.sqrt(K*K+O*O+P*P);this.tmpVertex[0]=G+K*N;this.tmpVertex[1]=J+O*N;this.tmpVertex[2]=L+P*N;return this.tmpVertex};F.applyToAabb=
function(G){for(var J=0;3>J;++J)u[J]=G[0+J]+this.localOrigin[J],z[J]=G[3+J]+this.localOrigin[J],y[J]=u[J];J=this.applyToVertex(u[0],u[1],u[2]);for(var L=0;3>L;++L)G[L]=J[L],G[L+3]=J[L];J=O=>{O=this.applyToVertex(O[0],O[1],O[2]);for(let P=0;3>P;++P)G[P+0]=Math.min(G[P+0],O[P]),G[P+3]=Math.max(G[P+3],O[P])};for(L=1;8>L;++L){for(var K=0;3>K;++K)y[K]=0===(L&1<<K)?u[K]:z[K];J(y)}L=0;for(K=0;3>K;++K)0>u[K]*z[K]&&(L|=1<<K);if(0!==L&&7!==L)for(K=0;8>K;++K)if(0===(L&K)){for(let O=0;3>O;++O)y[O]=L[O]?0:0!==
(K&1<<O)?u[O]:z[O];J(y)}for(J=0;3>J;++J)G[J+0]-=this.localOrigin[J],G[J+3]-=this.localOrigin[J];return G};return D}();const u=e.create(),z=e.create(),y=e.create();let B=function(){function D(G=0){this.componentLocalOriginLength=0;this._tmpVertex=e.create();this._mbs=l.create();this._obb={center:e.create(),halfSize:f.create(),quaternion:null};this._offset=this._totalOffset=0;this._resetOffset(G)}var F=D.prototype;F._resetOffset=function(G){this._totalOffset=this._offset=G};F.applyToVertex=function(G,
J,L){const K=L+this.componentLocalOriginLength,O=this._totalOffset/Math.sqrt(G*G+J*J+K*K);this._tmpVertex[0]=G+G*O;this._tmpVertex[1]=J+J*O;this._tmpVertex[2]=L+K*O;return this._tmpVertex};F.applyToAabb=function(G){const J=G[0],L=G[1],K=G[2]+this.componentLocalOriginLength,O=G[3],P=G[4],N=G[5]+this.componentLocalOriginLength;var H=0>J*O?0:Math.min(Math.abs(J),Math.abs(O)),E=0>L*P?0:Math.min(Math.abs(L),Math.abs(P)),I=0>K*N?0:Math.min(Math.abs(K),Math.abs(N));H=Math.sqrt(H*H+E*E+I*I);if(H<this._totalOffset)return G[0]-=
0>J?this._totalOffset:0,G[1]-=0>L?this._totalOffset:0,G[2]-=0>K?this._totalOffset:0,G[3]+=0<O?this._totalOffset:0,G[4]+=0<P?this._totalOffset:0,G[5]+=0<N?this._totalOffset:0,G;E=Math.max(Math.abs(J),Math.abs(O));I=Math.max(Math.abs(L),Math.abs(P));const M=Math.max(Math.abs(K),Math.abs(N));E=this._totalOffset/Math.sqrt(E*E+I*I+M*M);H=this._totalOffset/H;G[0]+=J*(0<J?E:H);G[1]+=L*(0<L?E:H);G[2]+=K*(0<K?E:H);G[3]+=O*(0>O?E:H);G[4]+=P*(0>P?E:H);G[5]+=N*(0>N?E:H);return G};F.applyToMbs=function(G){const J=
Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]),L=this._totalOffset/J;this._mbs[0]=G[0]+G[0]*L;this._mbs[1]=G[1]+G[1]*L;this._mbs[2]=G[2]+G[2]*L;this._mbs[3]=G[3]+G[3]*this._totalOffset/J;return this._mbs};F.applyToObb=function(G){var J=G.center;const L=this._totalOffset/Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]);this._obb.center[0]=J[0]+J[0]*L;this._obb.center[1]=J[1]+J[1]*L;this._obb.center[2]=J[2]+J[2]*L;d.transformQuat(this._obb.halfSize,G.halfSize,G.quaternion);d.add(this._obb.halfSize,this._obb.halfSize,
G.center);J=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);this._obb.halfSize[0]+=this._obb.halfSize[0]*J;this._obb.halfSize[1]+=this._obb.halfSize[1]*J;this._obb.halfSize[2]+=this._obb.halfSize[2]*J;d.subtract(this._obb.halfSize,this._obb.halfSize,G.center);g.conjugate(v,G.quaternion);d.transformQuat(this._obb.halfSize,this._obb.halfSize,v);this._obb.halfSize[0]*=0>this._obb.halfSize[0]?
-1:1;this._obb.halfSize[1]*=0>this._obb.halfSize[1]?-1:1;this._obb.halfSize[2]*=0>this._obb.halfSize[2]?-1:1;this._obb.quaternion=G.quaternion;return this._obb};b._createClass(D,[{key:"offset",get:function(){return this._offset},set:function(G){this._resetOffset(G)}},{key:"componentOffset",set:function(G){this._totalOffset=this._offset+G}},{key:"localOrigin",set:function(G){this.componentLocalOriginLength=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2])}}]);return D}(),C=function(){function D(G=0){this.offset=
G;this.sphere=l.create();this.tmpVertex=e.create()}var F=D.prototype;F.applyToVertex=function(G,J,L){const K=this.objectTransform.transform;let O=K[0]*G+K[4]*J+K[8]*L+K[12],P=K[1]*G+K[5]*J+K[9]*L+K[13];G=K[2]*G+K[6]*J+K[10]*L+K[14];J=this.offset/Math.sqrt(O*O+P*P+G*G);O+=O*J;P+=P*J;G+=G*J;J=this.objectTransform.inverse;this.tmpVertex[0]=J[0]*O+J[4]*P+J[8]*G+J[12];this.tmpVertex[1]=J[1]*O+J[5]*P+J[9]*G+J[13];this.tmpVertex[2]=J[2]*O+J[6]*P+J[10]*G+J[14];return this.tmpVertex};F.applyToMinMax=function(G,
J){const L=this.offset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);G[0]+=G[0]*L;G[1]+=G[1]*L;G[2]+=G[2]*L;G=this.offset/Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]);J[0]+=J[0]*G;J[1]+=J[1]*G;J[2]+=J[2]*G};F.applyToAabb=function(G){var J=this.offset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);G[0]+=G[0]*J;G[1]+=G[1]*J;G[2]+=G[2]*J;J=this.offset/Math.sqrt(G[3]*G[3]+G[4]*G[4]+G[5]*G[5]);G[3]+=G[3]*J;G[4]+=G[4]*J;G[5]+=G[5]*J;return G};F.applyToBoundingSphere=function(G){const J=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*
G[2]),L=this.offset/J;this.sphere[0]=G[0]+G[0]*L;this.sphere[1]=G[1]+G[1]*L;this.sphere[2]=G[2]+G[2]*L;this.sphere[3]=G[3]+G[3]*this.offset/J;return this.sphere};return D}();const k=new C,q=new B,x=new w,v=h.create();a.I3SVerticalOffsetGlobalViewingMode=B;a.IntersectorTransform=A;a.Object3DVerticalOffsetGlobalViewingMode=C;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=w;a.getVerticalOffsetI3S=function(D){return c.isSome(D)?(q.offset=D,q):null};a.getVerticalOffsetObject3D=function(D){return c.isSome(D)?
(k.offset=D,k):null};a.getVerticalOffsetTerrain=function(D){return c.isSome(D)?(x.offset=D,x):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../../../webgl/doublePrecisionUtils".split(" "),function(a,b,c,r,m,n){const p=new Float64Array(3),g=new Float32Array(6),h=r.create();
a.addObject3DStateID=function(d,f){b.isNone(d)&&(d=[]);d.push(f);return d};a.calculateTransformRelativeToOrigin=function(d,f,e){const l=d.origin.vec3;m.setMatrixTranslation3(h,-l[0],-l[1],-l[2]);b.isSome(d.transformation)?c.multiply(f,h,d.transformation):c.copy(f,h);c.invert(e,f);c.transpose(e,e)};a.encodeDoubleVec3=function(d,f,e,l,A){p[0]=d.get(f,0);p[1]=d.get(f,1);p[2]=d.get(f,2);n.encodeDoubleArray(p,g,3);e.set(A,0,g[0]);l.set(A,0,g[1]);e.set(A,1,g[2]);l.set(A,1,g[3]);e.set(A,2,g[4]);l.set(A,
2,g[5])};a.isInstanceHidden=function(d){return b.isSome(d)?!d.visible:!1};a.removeObject3DStateID=function(d,f){if(b.isNone(d))return null;d=d.filter(e=>e!==f);return 0===d.length?null:d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(c,r,m){for(let n=0;n<m;++n)r[n]=c[2*n]+c[2*n+1]};a.encodeDoubleArray=function(c,r,
m){for(let n=0;n<m;++n)r[2*n]=c[n],r[2*n+1]=c[n]-r[2*n]};a.encodeDoubleHi=function(c,r){const m=c.length;for(let n=0;n<m;++n)b[0]=c[n],r[n]=b[0];return r};a.encodeDoubleLo=function(c,r){const m=c.length;for(let n=0;n<m;++n)b[0]=c[n],b[1]=c[n]-b[0],r[n]=b[1];return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){function w(F,G,J=f.defaultConstraintOptions,L=!0){D.eyeCenterDistance=0;D.requiresTwoSteps=!1;const K=u(F,G,J,void 0,D);if(0===K)return!1;m.fromRotation(C,-K,G.viewRight);switch(J.tiltMode){case A.TiltMode.LOOK_AROUND:p.transformMat4(B,G.viewForward,C);p.scale(B,B,D.eyeCenterDistance);G.center=p.add(k,G.eye,B);break;case A.TiltMode.TUMBLE:p.subtract(B,G.center,G.eye);p.transformMat4(B,B,C);G.eye=p.subtract(k,G.center,B);break;default:b.neverReached(J.tiltMode)}G.up=
p.transformMat4(k,G.up,C);return D.requiresTwoSteps&&L?w(F,G,J,!1):!0}function u(F,G,J=f.defaultConstraintOptions,L=f.defaultConstraintOptions,K){if(!F.state.constraints.tilt)return 0;var O=F.state.constraints.tilt(G.distance,x);if(J.interactionType!==l.InteractionType.NONE){var {interactionStartCamera:P,interactionFactor:N}=J,{min:H,max:E}=O,I=u(F,P,f.defaultConstraintOptions,J),M=0===I?0:t.viewAngle(F.renderCoordsHelper,P.center,P.eye);O.min=H;O.max=E;J.interactionType===l.InteractionType.TUMBLE?
(f.hasConstraintType(J.selection,e.ConstraintTypes.ALTITUDE)&&y(F,P,O),f.adjustRangeForInteraction(I,M,!0,N,q,O)):f.adjustRangeForInteraction(I,M,!1,N,q,O)}L.interactionType===l.InteractionType.TUMBLE&&f.hasConstraintType(L.selection,e.ConstraintTypes.ALTITUDE)&&y(F,L.interactionStartCamera,O);if(J.tiltMode===A.TiltMode.LOOK_AROUND||L.tiltMode===A.TiltMode.LOOK_AROUND){a:switch(K&&(K.requiresTwoSteps=!1),F.viewingMode){case "global":J=v;I=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
L=I+h.getReferenceEllipsoid(F.spatialReference).radius;I=F.renderCoordsHelper.intersectManifold(G.ray,I,k);J.eyeCenterDistance=G.distance;J.centerIsOnSurface=!1;r.isSome(I)?(J.eyeCenterDistance=p.distance(G.eye,I),J.tiltAtCenter=t.viewAngle(F.renderCoordsHelper,I,G.eye),J.centerIsOnSurface=!0):F.state.isLocal?J.tiltAtCenter=t.viewAngle(F.renderCoordsHelper,G.center,G.eye):(d.closestPointOnSilhouette(d.fromRadius(d.tmpSphere,L),G.ray,k),J.eyeCenterDistance=p.distance(G.eye,k),J.tiltAtCenter=c.acosClamped(-p.dot(G.viewForward,
p.normalize(k,k))));J.radius=L;J.eyeRadius=p.length(G.eye);J.constraints=F.state.constraints;G=c.clamp(J.tiltAtCenter,O.min,O.max);if(1E-9<Math.abs(J.tiltAtCenter-G)){if(J.centerIsOnSurface){{const {constraints:Q,eyeCenterDistance:T,tiltAtCenter:S}=J;G=S;F=Q.clampTilt(T,S);O=z(J,F);if(Q.clampTilt(O,S)!==F)for(O=0;10>O&&1E-9<Math.abs(F-G);)L=(G+F)/2,I=z(J,L),I=Q.clampTilt(I,L),1E-9<Math.abs(I-L)?G=L:F=L,O++;G=F}O=G;F=c.asinClamped(J.radius/J.eyeRadius*Math.sin(J.tiltAtCenter));O=c.asinClamped(J.radius/
J.eyeRadius*Math.sin(O));F=J.eyeRadius>J.radius?F-O:O-F}else G=J.constraints.clampTilt(J.eyeCenterDistance,J.tiltAtCenter),K&&G<Math.PI/2&&(K.requiresTwoSteps=!0,G=Math.PI/2-1E-5),F=J.tiltAtCenter-Math.PI/2-(G-Math.PI/2);K&&(K.eyeCenterDistance=z(J,G));K=F}else K=0;break a;case "local":L=t.viewAngle(F.renderCoordsHelper,G.center,G.eye);J=c.clamp(L,O.min,O.max);O=L-J;1E-9<Math.abs(O)?(K&&(L=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,F=F.renderCoordsHelper.getAltitude(G.eye)-
L,J=Math.cos(J),K.eyeCenterDistance=1E-4<Math.abs(J)?F/J:G.distance),K=O):K=0;break a;default:b.neverReached(F.viewingMode),K=void 0}return K}K=t.viewAngle(F.renderCoordsHelper,G.center,G.eye);J=c.clamp(K,O.min,O.max);K-=J;K=1E-9<Math.abs(K)?K:0;return K}function z(F,G){if(!F.centerIsOnSurface)return F.eyeCenterDistance;G=Math.PI-c.clamp(G,0,Math.PI);const J=c.asinClamped(F.radius/F.eyeRadius*Math.sin(G)),L=Math.sin(Math.PI-G-J)/Math.sin(G);return F.eyeRadius<F.radius&&1<L?Math.sin(Math.PI-G-(Math.PI-
J))/Math.sin(G)*F.eyeRadius:L*F.eyeRadius}function y(F,G,J){if(!F.state.isLocal){var L=F.state.constraints;if(L.altitude){var K=p.squaredLength(G.center),O=Math.sqrt(K);G=G.distance;var P=h.getReferenceEllipsoid(F.spatialReference).radius;F=L.altitude.min+P;L=L.altitude.max+P;F=(F*F-G*G-K)/(-2*O*G);J.min=Math.max(J.min,Math.min(Math.PI-c.acosClamped((L*L-G*G-K)/(-2*O*G)),J.max));J.max=Math.min(J.max,Math.PI-c.acosClamped(F))}}}const B=g.create(),C=n.create(),k=g.create(),q=c.deg2rad(5),x={min:0,max:0},
v={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},D={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=w;a.getTiltConstraintError=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,r){const m=r.create(),n=r.create();a.viewAngle=function(p,
g,h){p.worldUpAtPosition(g,m);c.subtract(n,h,g);p=c.length(n);return 0===p?0:b.acosClamped(c.dot(n,m)/p)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(M){return M}function c(M){const Q=2*(M-Math.sqrt((M-1)*M)),T=Q/2/M;return S=>S<T?M*S*S:Q*S-Q+1}function r(M,Q){return(T,S)=>T<Q?Q*M(T/Q,S):1-M((1-T)/(1-Q),S)*(1-Q)}const m=M=>M*M,n=M=>1-m(1-M),p=M=>.5>M?m(2*M)/2:(1-m(1-2*
(M-.5))+1)/2,g=M=>M*M*M,h=M=>1-g(1-M),d=M=>.5>M?g(2*M)/2:(1-g(1-2*(M-.5))+1)/2,f=M=>M*M*M*M,e=M=>1-f(1-M),l=M=>.5>M?f(2*M)/2:(1-f(1-2*(M-.5))+1)/2,A=M=>M*M*M*M*M,t=M=>1-A(1-M),w=M=>.5>M?A(2*M)/2:(1-A(1-2*(M-.5))+1)/2,u=M=>-Math.cos(M*Math.PI/2)+1,z=M=>1-u(1-M),y=M=>.5>M?u(2*M)/2:(1-u(1-2*(M-.5))+1)/2,B=M=>2**(10*(M-1)),C=M=>1-2**(10*(1-M-1)),k=M=>.5>M?2**(10*(2*M-1))/2:(1-2**(10*(1-2*(M-.5)-1))+1)/2,q=M=>-(Math.sqrt(1-M*M)-1),x=M=>1-q(1-M),v=M=>.5>M?q(2*M)/2:(1-q(1-2*(M-.5))+1)/2,D=r(c(1),1),F=r(c(1),
0),G=r(c(1),.5),J=r(c(2),1),L=r(c(2),0),K=r(c(2),.5),O=r(c(3),1),P=r(c(3),0),N=r(c(3),.5),H=r(c(4),1),E=r(c(4),0),I=r(c(4),.5);a.EasingFunctions={linear:b,"in-quad":m,"out-quad":n,"in-out-quad":p,"in-coast-quad":D,"out-coast-quad":F,"in-out-coast-quad":G,"in-cubic":g,"out-cubic":h,"in-out-cubic":d,"in-coast-cubic":J,"out-coast-cubic":L,"in-out-coast-cubic":K,"in-quart":f,"out-quart":e,"in-out-quart":l,"in-coast-quart":O,"out-coast-quart":P,"in-out-coast-quart":N,"in-quint":A,"out-quint":t,"in-out-quint":w,
"in-coast-quint":H,"out-coast-quint":E,"in-out-coast-quint":I,"in-sine":u,"out-sine":z,"in-out-sine":y,"in-expo":B,"out-expo":C,"in-out-expo":k,"in-circ":q,"out-circ":x,"in-out-circ":v};a.inCirc=q;a.inCoastCubic=J;a.inCoastQuad=D;a.inCoastQuart=O;a.inCoastQuint=H;a.inCubic=g;a.inExpo=B;a.inOutCirc=v;a.inOutCoastCubic=K;a.inOutCoastQuad=G;a.inOutCoastQuart=N;a.inOutCoastQuint=I;a.inOutCubic=d;a.inOutExpo=k;a.inOutQuad=p;a.inOutQuart=l;a.inOutQuint=w;a.inOutSine=y;a.inQuad=m;a.inQuart=f;a.inQuint=A;
a.inSine=u;a.linear=b;a.outCirc=x;a.outCoastCubic=L;a.outCoastQuad=F;a.outCoastQuart=P;a.outCoastQuint=E;a.outCubic=h;a.outExpo=C;a.outQuad=n;a.outQuart=e;a.outQuint=t;a.outSine=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){a.PointToPointAnimationController=function(u){function z(B){B=u.call(this,B)||this;B.mode="interaction";B._hasTarget=!1;return B}b._inheritsLoose(z,u);var y=z.prototype;y.initialize=function(){this.animation=new d.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new h};y.begin=function(B,C){this._hasTarget=!0;C=this.animationSettings(C);t.copyFrom(this.view.state.camera);const k=l.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(t.ray,k,w)&&(t.center=w);this.animation.update(t,B,C);this.animation.finished&&this.finish()};y.finish=function(){this.animation.currentTime=this.animation.time;u.prototype.finish.call(this)};y.stepController=function(B,C){this._hasTarget&&this.animation.step(B,C)};y.onControllerEnd=function(B){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,B),this.animation.currentTime=this.animation.time);u.prototype.onControllerEnd.call(this,
B)};y.animationSettings=function(B={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...B,easing:"string"===typeof B.easing?A.EasingFunctions[B.easing]:B.easing}};b._createClass(z,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this._hasTarget&&this.animation.finished}}]);
return z}(f.AnimationController);c.__decorate([r.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);c.__decorate([r.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=c.__decorate([p.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const t=new e.Camera,w=g.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,b,c,r,m,n,p,g){const h=m.create();m=function(){function d(e){this.currentTime=c.Milliseconds(0);this._animation=new g.Animation(()=>new n(e));this._current=new n(e)}var f=d.prototype;f.update=function(e,
l,A){const t=this._animation.definition.source,w=this._animation.definition.target,u=r.subtract(h,l.center,e.center),z=r.length(u);1E-5<=z?(u[0]/=z,u[1]/=z,u[2]/=z):(u[0]=0,u[1]=1,u[0]=0);r.copy(t.lookAtDirection,u);r.copy(w.lookAtDirection,u);t.copyFromRenderCamera(e);w.copyFromRenderCamera(l);this._current.copyFrom(t);this._animation.update(t,w,A);this.currentTime=c.Milliseconds(0);e.almostEquals(l)&&(this.currentTime=this._animation.time)};f.cameraAt=function(e,l){this._animation.cameraAt(e,this._current);
l=l||new p.Camera;this._current.copyToRenderCamera(l);return l};f.step=function(e,l){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,l)};b._createClass(d,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return d}();a.Animation=m;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,c,r,m,n,p){const g=m.create(),h=m.create(),d=m.create(),f=m.create(),e=m.create(),l=m.create();var A=m.fromValues(0,0,1),t=m.fromValues(0,1,0),w=m.fromValues(1,0,0);const u=c.create();return function(){function z(B=
n.ViewingMode.Global){this.viewingMode=B;this.center=m.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=m.clone(t)}var y=z.prototype;y.pixelsPerPanAtZoom=function(B){return this.size/2/(this._zoomToPanScale*B)};y.zoomAtPixelsPerPan=function(B){return this.size/2/(this._zoomToPanScale*B)};y.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};y.compareTo=function(B,C){C||(C={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===
n.ViewingMode.Global){var k=r.length(this.center);const q=r.length(B.center);k=(k+q)/2;C.pan=p.angle(this.center,B.center)*k}else C.pan=r.distance(this.center,B.center);k=Math.abs(B.yaw-this.yaw);k>=Math.PI&&(k=2*Math.PI-k);C.rotate=Math.max(k,Math.abs(B.pitch-this.pitch));C.sourceZoom=this.distance;C.targetZoom=B.distance;return C};y.interpolate=function(B,C,k){this.viewingMode===n.ViewingMode.Global?p.slerp(B.center,C.center,k.pan,this.center):r.lerp(this.center,B.center,C.center,k.pan);this.distance=
isFinite(C.distance)?a.lerp(B.distance,C.distance,k.zoom):B.distance;this.pitch=a.lerp(B.pitch,C.pitch,k.rotate);B=B.yaw;C=C.yaw;Math.abs(C-B)>=Math.PI&&(B+=2*(B<C?1:-1)*Math.PI);this.yaw=a.lerp(B,C,k.rotate)};y.copyFrom=function(B){r.copy(this.center,B.center);this.pitch=B.pitch;this.yaw=B.yaw;this.distance=B.distance;r.copy(this.lookAtDirection,B.lookAtDirection);this.size=B.size;this.copyFromCommon(B);this.viewingMode=B.viewingMode};y.copyFromRenderCamera=function(B){const C=this._lookAtOrientation(B.center,
u);r.copy(this.center,B.center);r.subtract(f,B.center,B.eye);r.transformMat3(f,f,C);r.transformMat3(e,B.up,C);this.distance=r.length(f);0!==this.distance&&(f[0]/=this.distance,f[1]/=this.distance,f[2]/=this.distance);this.pitch=this._eyeUpToPitch(f);this.yaw=this._eyeUpToYaw(f,e);this.size=Math.sqrt(B.width*B.width+B.height*B.height);this.copyFromCommon(B)};y.copyFromCommon=function(B){this.fov=B.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};y.copyToRenderCamera=function(B){const C=this._lookAtOrientation(this.center,
u);b.transpose(C,C);this._axisAngleVec3(w,this.pitch-Math.PI/2,t,f);this._axisAngleVec3(A,this.yaw,f);this._axisAngleVec3(w,this.pitch-Math.PI/2,A,e);this._axisAngleVec3(A,this.yaw,e);r.scale(f,f,this.distance);r.transformMat3(f,f,C);r.transformMat3(e,e,C);B.center=this.center;B.eye=r.subtract(f,this.center,f);B.up=e};y._axisAngleVec3=function(B,C,k,q=k){const x=Math.cos(C);C=Math.sin(C);r.scale(g,k,x);r.cross(h,B,k);r.scale(h,h,C);r.scale(d,B,(1-x)*r.dot(B,k));return r.add(q,r.add(q,g,h),d)};y._lookAtOrientation=
function(B,C=c.create()){this._upAtLookAt(B,d);r.cross(g,this.lookAtDirection,d);r.normalize(g,g);0===g[0]&&0===g[1]&&0===g[2]&&r.copy(g,w);r.cross(h,d,g);r.normalize(h,h);C[0]=g[0];C[1]=h[0];C[2]=d[0];C[3]=g[1];C[4]=h[1];C[5]=d[1];C[6]=g[2];C[7]=h[2];C[8]=d[2];return C};y._upAtLookAt=function(B,C){return this.viewingMode===n.ViewingMode.Local?r.copy(C,A):r.normalize(C,B)};y._eyeUpToPitch=function(B){return Math.PI-p.angle(A,B)};y._eyeUpToYaw=function(B,C){.5>Math.abs(C[2])?(r.copy(l,C),0<B[2]&&r.scale(l,
l,-1)):r.copy(l,B);r.cross(h,l,A);r.normalize(h,h);return p.angle(w,h,A)};return z}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){let B=function(){function D(G=null,J=null,L=null){this._viewUp=e.create();this._viewForward=e.create();this._viewRight=e.create();this._ray=w.create();this._viewport=A.fromValues(0,0,1,1);this._padding=A.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=d.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=g.create();this._projectionDirty=!0;this._projectionMatrix=g.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=g.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=g.create();this._inverseProjectionDirty=!0;this._inverseProjectionMatrix=null;this._frustumDirty=!0;this._frustum=t.create();this._fullViewport=A.create();this._pixelRatio=1;this.relativeElevation=0;m.isSome(G)&&f.copy(this._ray.origin,G);this._center=m.isSome(J)?e.clone(J):e.create();this._up=m.isSome(L)?e.clone(L):e.fromValues(0,0,1)}var F=D.prototype;F.depthNDCToWorld=function(G){return 2*this.near*this.far/(this.far+this.near-
(2*G-1)*(this.far-this.near))};F.copyFrom=function(G){f.copy(this._ray.origin,G.eye);f.copy(this._center,G.center);f.copy(this._up,G.up);l.copy(this._viewport,G.viewport);l.copy(this._padding,G.padding);h.copy(this._nearFar,G.nearFar);this._fov=G.fov;this.relativeElevation=G.relativeElevation;this._viewDirty=G._viewDirty;this._viewDirty||(p.copy(this._viewMatrix,G.viewMatrix),f.copy(this._viewRight,G.viewRight),f.copy(this._viewUp,G.viewUp),f.copy(this._viewForward,G.viewForward));G._projectionDirty?
this._projectionDirty=!0:(p.copy(this._projectionMatrix,G.projectionMatrix),this._projectionDirty=!1);this._inverseProjectionDirty=this._viewProjectionDirty=!0;this._frustumDirty=G._frustumDirty;this._frustumDirty||(t.copy(this._frustum,G.frustum),this._frustumDirty=!1);G._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(p.copy(this._viewInverseTransposeMatrix,G.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);l.copy(this._fullViewport,G.fullViewport);
this._pixelRatio=G.pixelRatio;return this};F.copyViewFrom=function(G){this.eye=G.eye;this.center=G.center;this.up=G.up};F.clone=function(){return(new D).copyFrom(this)};F.equals=function(G){return f.exactEquals(this.eye,G.eye)&&f.exactEquals(this._center,G.center)&&f.exactEquals(this._up,G.up)&&l.exactEquals(this._viewport,G.viewport)&&l.exactEquals(this._padding,G.padding)&&h.exactEquals(this._nearFar,G.nearFar)&&this._fov===G.fov&&this._pixelRatio===G.pixelRatio&&this.relativeElevation===G.relativeElevation};
F.almostEquals=function(G){if(this._pixelRatio!==G.pixelRatio||.001<=Math.abs(G.fov-this._fov))return!1;const J=1-1E-10;f.sub(q,G.eye,G.center);f.sub(x,this.eye,this._center);const L=f.dot(q,x),K=f.sqrLen(q),O=f.sqrLen(x);return L*L>=J*K*O&&f.sqrDist(G.eye,this.eye)<2.5E-7*Math.max(K,O)&&.5>l.squaredDistance(G.padding,this._padding)&&.5>l.squaredDistance(G.viewport,this._viewport)};F.computeRenderPixelSizeAt=function(G){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(G))};F.computeRenderPixelSizeAtDist=
function(G){return G*this.perRenderPixelRatio};F.computeScreenPixelSizeAt=function(G){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(G))};F._viewDirectionDistance=function(G){return Math.abs(u.projectPointSignedLength(this.viewForward,f.subtract(q,G,this.eye)))};F.computeScreenPixelSizeAtDist=function(G){return G*this.perScreenPixelRatio};F.computeDistanceFromRadius=function(G,J){return G/Math.tan(Math.min(this.fovX,this.fovY)/(2*(J||1)))};F.getScreenCenter=function(G=n.createScreenPointArray()){G[0]=
(this.padding[a.PaddingSide.LEFT]+this.width/2)/this._pixelRatio;G[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this._pixelRatio;return G};F.getRenderCenter=function(G,J=.5,L=.5){G[0]=this.padding[a.PaddingSide.LEFT]+this.width*J;G[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*L;G[2]=.5;return G};F.setGLViewport=function(G){const J=this.viewport,L=this.padding;G.setViewport(J[0]-L[3],J[1]-L[2],J[2]+L[1]+L[3],J[3]+L[0]+L[2])};F.applyProjection=function(G,J){G!==C&&f.copy(C,G);C[3]=1;l.transformMat4(C,
C,this.projectionMatrix);G=Math.abs(C[3]);f.scale(C,C,1/G);const L=this.fullViewport;J[0]=r.lerp(0,L[0]+L[2],.5+.5*C[0]);J[1]=r.lerp(0,L[1]+L[3],.5+.5*C[1]);J[2]=.5*(C[2]+1);J[3]=G};F.unapplyProjection=function(G,J){const L=this.fullViewport;C[0]=(G[0]/(L[0]+L[2])*2-1)*G[3];C[1]=(G[1]/(L[1]+L[3])*2-1)*G[3];C[2]=(2*G[2]-1)*G[3];C[3]=G[3];l.transformMat4(C,C,this.inverseProjectionMatrix);J[0]=C[0];J[1]=C[1];J[2]=C[2]};F.projectToScreen=function(G,J){this.projectToRenderScreen(G,v);this.renderToScreen(v,
J);return J};F.projectToRenderScreen=function(G,J){C[0]=G[0];C[1]=G[1];C[2]=G[2];C[3]=1;l.transformMat4(C,C,this.viewProjectionMatrix);if(0===C[3])return null;f.scale(C,C,1/Math.abs(C[3]));G=this.fullViewport;"x"in J?(J.x=r.lerp(0,G[0]+G[2],.5+.5*C[0]),J.y=r.lerp(0,G[1]+G[3],.5+.5*C[1])):(J[0]=r.lerp(0,G[0]+G[2],.5+.5*C[0]),J[1]=r.lerp(0,G[1]+G[3],.5+.5*C[1]),2<J.length&&(J[2]=.5*(C[2]+1)));return J};F.unprojectFromScreen=function(G,J){return this.unprojectFromRenderScreen(this.screenToRender(G,v),
J)};F.unprojectFromRenderScreen=function(G,J){p.multiply(k,this.projectionMatrix,this.viewMatrix);if(!p.invert(k,k))return null;const L=this.fullViewport;C[0]=2*(G[0]-L[0])/L[2]-1;C[1]=2*(G[1]-L[1])/L[3]-1;C[2]=2*G[2]-1;C[3]=1;l.transformMat4(C,C,k);if(0===C[3])return null;J[0]=C[0]/C[3];J[1]=C[1]/C[3];J[2]=C[2]/C[3];return J};F.constrainWindowSize=function(G,J,L,K=L){G*=this._pixelRatio;J*=this._pixelRatio;return[Math.max(G-L/2,0),Math.max(this.fullHeight-J-K/2,0),L- -Math.min(G-L/2,0)- -Math.min(this.fullWidth-
G-L/2,0),K- -Math.min(this.fullHeight-J-K/2,0)- -Math.min(J-K/2,0)]};F.computeUp=function(G){G===z.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};F.screenToRender=function(G,J){const L=this.fullHeight-G[1]*this._pixelRatio;J[0]=G[0]*this._pixelRatio;J[1]=L;return J};F.renderToScreen=function(G,J){const L=(this.fullHeight-G[1])/this._pixelRatio;J[0]=G[0]/this._pixelRatio;J[1]=L};F._computeUpGlobal=function(){f.subtract(q,this.center,this.eye);const G=f.length(this.center);1>G?(f.set(this._up,
0,0,1),this._markViewDirty()):Math.abs(f.dot(q,this.center))>.9999*f.length(q)*G||(f.cross(this._up,q,this.center),f.cross(this._up,this._up,q),f.normalize(this._up,this._up),this._markViewDirty())};F._computeUpLocal=function(){f.direction(q,this.eye,this.center);.9999>=Math.abs(q[2])&&(f.scale(q,q,q[2]),f.set(this._up,-q[0],-q[1],1-q[2]),f.normalize(this._up,this._up),this._markViewDirty())};F._compareAndSetView=function(G,J){"number"===typeof G[0]&&isFinite(G[0])&&"number"===typeof G[1]&&isFinite(G[1])&&
"number"===typeof G[2]&&isFinite(G[2])?f.exactEquals(G,J)||(f.copy(J,G),this._markViewDirty()):c.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")};F._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};F._recomputeFrustum=function(){this._frustumDirty&&(t.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};F._ensureViewClean=function(){this._viewDirty&&(p.lookAt(this._viewMatrix,
this.eye,this._center,this._up),f.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),f.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),f.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};b._createClass(D,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(G){this._pixelRatio=0<G?G:1}},{key:"eye",get:function(){return this._ray.origin},
set:function(G){this._compareAndSetView(G,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(G){this._compareAndSetView(G,this._center)}},{key:"ray",get:function(){f.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(G){this._compareAndSetView(G,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(G){p.copy(this._viewMatrix,G);this._viewDirty=
!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(G){this._nearFar[0]!==G&&(this._nearFar[0]=G,this._frustumDirty=
this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(G){this._nearFar[1]!==G&&(this._nearFar[1]=G,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(G){this.x=G[0];this.y=G[1];this.width=G[2];this.height=G[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(G){G+=this._padding[a.PaddingSide.LEFT];
this._viewport[0]!==G&&(this._viewport[0]=G,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(G){G+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==G&&(this._viewport[1]=G,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(G){this._viewport[2]!==G&&(this._viewport[2]=
G,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(G){this._viewport[3]!==G&&(this._viewport[3]=G,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(G){this.width=G-(this._padding[a.PaddingSide.RIGHT]+
this._padding[a.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]},set:function(G){this.height=G-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=
this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(G){if(this._padding[a.PaddingSide.TOP]!==G[a.PaddingSide.TOP]||this._padding[a.PaddingSide.RIGHT]!==G[a.PaddingSide.RIGHT]||this._padding[a.PaddingSide.BOTTOM]!==G[a.PaddingSide.BOTTOM]||this._padding[a.PaddingSide.LEFT]!==G[a.PaddingSide.LEFT])this._viewport[0]+=G[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=
G[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=G[a.PaddingSide.RIGHT]+G[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=G[a.PaddingSide.TOP]+G[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),l.copy(this._padding,G),this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&
(p.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const G=this.width,J=this.height,L=this.near*Math.tan(this.fovY/2),K=L*this.aspect;p.frustum(this._projectionMatrix,-K*(1+2*this._padding[a.PaddingSide.LEFT]/G),K*(1+2*this._padding[a.PaddingSide.RIGHT]/G),-L*(1+2*this._padding[a.PaddingSide.BOTTOM]/J),L*(1+2*this._padding[a.PaddingSide.TOP]/
J),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(G){p.copy(this._projectionMatrix,G);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=!0}},{key:"inverseProjectionMatrix",get:function(){m.isNone(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=g.create());this._inverseProjectionDirty&&p.invert(this._inverseProjectionMatrix,this.projectionMatrix);return this._inverseProjectionMatrix}},{key:"fov",
get:function(){return this._fov},set:function(G){this._fov=G;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return y.fovd2fovx(this._fov,this.width,this.height)},set:function(G){this._fov=y.fovx2fovd(G,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return y.fovd2fovy(this._fov,this.width,this.height)},set:function(G){this._fov=
y.fovy2fovd(G,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return f.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)p.invert(this._viewInverseTransposeMatrix,this.viewMatrix),p.transpose(this._viewInverseTransposeMatrix,
this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this._pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&0<=this.relativeElevation}}]);return D}();const C=A.create(),k=g.create(),q=e.create(),x=e.create(),v=n.createRenderScreenPointArray3();
a.PaddingSide=void 0;(function(D){D[D.TOP=0]="TOP";D[D.RIGHT=1]="RIGHT";D[D.BOTTOM=2]="BOTTOM";D[D.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.Camera=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,r,m,n,p,g,
h,d){function f(){return[m.create(),m.create(),m.create(),m.create(),m.create(),m.create(),m.create(),m.create()]}function e(z,y){h.fromPoints(y[a.PointIndex.FAR_BOTTOM_LEFT],y[a.PointIndex.NEAR_BOTTOM_LEFT],y[a.PointIndex.NEAR_TOP_LEFT],z[a.PlaneIndex.LEFT]);h.fromPoints(y[a.PointIndex.NEAR_BOTTOM_RIGHT],y[a.PointIndex.FAR_BOTTOM_RIGHT],y[a.PointIndex.FAR_TOP_RIGHT],z[a.PlaneIndex.RIGHT]);h.fromPoints(y[a.PointIndex.FAR_BOTTOM_LEFT],y[a.PointIndex.FAR_BOTTOM_RIGHT],y[a.PointIndex.NEAR_BOTTOM_RIGHT],
z[a.PlaneIndex.BOTTOM]);h.fromPoints(y[a.PointIndex.NEAR_TOP_LEFT],y[a.PointIndex.NEAR_TOP_RIGHT],y[a.PointIndex.FAR_TOP_RIGHT],z[a.PlaneIndex.TOP]);h.fromPoints(y[a.PointIndex.NEAR_BOTTOM_LEFT],y[a.PointIndex.NEAR_BOTTOM_RIGHT],y[a.PointIndex.NEAR_TOP_RIGHT],z[a.PlaneIndex.NEAR]);h.fromPoints(y[a.PointIndex.FAR_BOTTOM_RIGHT],y[a.PointIndex.FAR_BOTTOM_LEFT],y[a.PointIndex.FAR_TOP_LEFT],z[a.PlaneIndex.FAR])}function l(z,y){for(let B=0;B<a.NumPlanes.NUM;B++)if(!h.clip(z[B],y))return!1;return!0}a.PlaneIndex=
void 0;(function(z){z[z.LEFT=0]="LEFT";z[z.RIGHT=1]="RIGHT";z[z.BOTTOM=2]="BOTTOM";z[z.TOP=3]="TOP";z[z.NEAR=4]="NEAR";z[z.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(z){z[z.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";z[z.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";z[z.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";z[z.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";z[z.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";z[z.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";z[z.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";z[z.FAR_TOP_LEFT=
7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const A={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,
a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(z){z[z.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(z){z[z.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const t=[p.fromValues(-1,-1,-1,1),p.fromValues(1,-1,-1,1),p.fromValues(1,1,
-1,1),p.fromValues(-1,1,-1,1),p.fromValues(-1,-1,1,1),p.fromValues(1,-1,1,1),p.fromValues(1,1,1,1),p.fromValues(-1,1,1,1)],w=new b.ObjectStack(g.create),u=f();a.computePlanes=e;a.copy=function(z,y){for(let B=0;B<a.NumPlanes.NUM;B++)h.copy(z[B],y[B])};a.create=function(z){return z?[h.create(z[0]),h.create(z[1]),h.create(z[2]),h.create(z[3]),h.create(z[4]),h.create(z[5])]:[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()]};a.createPoints=f;a.fromMatrix=function(z,y,B,C=u){z=c.multiply(d.sm4d.get(),
y,z);c.invert(z,z);for(y=0;y<a.NumPoints.NUM;++y){const k=n.transformMat4(d.sv4d.get(),t[y],z);r.set(C[y],k[0]/k[3],k[1]/k[3],k[2]/k[3])}e(B,C)};a.intersectClipRay=function(z,y){for(let B=0;B<a.NumPlanes.NUM;B++)if(!h.clipInfinite(z[B],y))return!1;return!0};a.intersectsLineSegment=function(z,y,B){return l(z,g.fromLineSegmentAndDirection(y,B,w.get()))};a.intersectsPoint=function(z,y){for(let B=0;B<a.NumPlanes.NUM;B++)if(0<h.signedDistance(z[B],y))return!1;return!0};a.intersectsRay=function(z,y){return l(z,
g.fromRay(y,w.get()))};a.intersectsSphere=function(z,y){for(let B=0;B<a.NumPlanes.NUM;B++){const C=z[B];if(C[0]*y[0]+C[1]*y[1]+C[2]*y[2]+C[3]>=y[3])return!1}return!0};a.planePointIndices=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,b,c,r,m){function n(f){return f?{ray:r.create(f.ray),c0:f.c0,c1:f.c1}:{ray:r.create(),
c0:0,c1:Number.MAX_VALUE}}function p(f,e,l,A=n()){r.copy(f,A.ray);A.c0=e;A.c1=l;return A}function g(f,e,l=n()){const A=c.length(f.vector);r.fromValues(f.origin,e,l.ray);l.c0=0;l.c1=A;return l}function h(f,e,l){return c.add(l,f.ray.origin,c.scale(l,f.ray.direction,e))}const d=new b.ObjectStack(()=>n());a.copy=function(f,e=n()){return p(f.ray,f.c0,f.c1,e)};a.create=n;a.fromLineSegment=function(f,e=n()){const l=c.normalize(m.sv3d.get(),f.vector);return g(f,l,e)};a.fromLineSegmentAndDirection=g;a.fromRay=
function(f,e=n()){r.copy(f,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};a.fromValues=p;a.getAt=h;a.getEnd=function(f,e){return h(f,f.c1,e)};a.getStart=function(f,e){return h(f,f.c0,e)};a.wrap=function(f,e,l){const A=d.get();A.ray=f;A.c0=e;A.c1=l;return A};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(a,b,c,r,m,n,p){const g={zoom:0,pan:0,rotate:0};let h=function(){function d(e){this._createCamera=e;this._time=c.Milliseconds(0);this.definition=new m.Definition(e);this.path=new p.Path}var f=d.prototype;f.update=function(e,l,A){this.definition.update(e,l,A);this.path.update(this.definition,A);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:c.Seconds(0)),A);this._easing=A.easing?A.easing:1E3<=this._time?r.inOutCoastQuad:r.outExpo};f.cameraAt=
function(e,l){l=l||this._createCamera();e=Math.min(Math.max(0,e),1);e=this._normalizedEasing(e);e=this.path.interpolateComponentsAt(e,g);l.interpolate(this.definition.source,this.definition.target,e);return l};f._normalizedEasing=function(e){const l=this._easing(0,this._time),A=this._easing(1,this._time);return(this._easing(e,this._time)-l)/(A-l)};f._applyTimeSettings=function(e,l){const A=null!=l.speedFactor?l.speedFactor:1;null!=l.duration?e=l.duration:null!=l.speedFactor&&(e=c.Milliseconds(e/A));
return c.Milliseconds(Math.min(Math.max(null!=l.minDuration?l.minDuration:n.defaultSettings.minDuration/A,e),null!=l.maxDuration?l.maxDuration:n.defaultSettings.maxDuration/A))};b._createClass(d,[{key:"time",get:function(){return this._time}}]);return d}();a.Animation=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,
b,c){let r=function(){function m(p){this._createCamera=p;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=p();this.target=p()}var n=m.prototype;n.clone=function(){const p=new m(this._createCamera);p.copyFrom(this);return p};n.copyFrom=function(p){this.update(p.source,p.target,p.settings)};n.update=function(p,g,h){this.source!==p&&this.source.copyFrom(p);this.target!==g&&this.target.copyFrom(g);this.compared=
this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=h.desiredScreenFlow?h.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};n.halfWindowPanAtZoom=function(p){p=this.target.pixelsPerPanAtZoom(p);return this.halfWindowSize/p};b._createClass(m,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",
get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return m}();a.Definition=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),function(a,b,c,r,m,n){r=function(p){function g(d,f){var e=p.call(this)||this;e._preallocSegments=[new m.Segment,new m.Segment,new m.Segment];e.update(d,f);return e}b._inheritsLoose(g,p);var h=g.prototype;h.update=function(d,f){if(d){this.definition?this.definition.copyFrom(d):this.definition=
d.clone();var e=null;f&&f.apex&&(e=n.optimalDistance(d,f.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==e?this._updateWithoutApex():this._updateWithApex(e,f.apex)}};h.segmentInterpolateComponentsAt=function(d,f,e){e=d.interpolateComponentsAt(f,e);d===this._ascensionSegment?e.zoom=c.outQuad(e.zoom):d===this._descensionSegment&&(e.zoom=c.inQuad(e.zoom));return e};h._updateWithApex=function(d,f){const [e,l,A]=this._preallocSegments,t=null!=f.ascensionFactor?f.ascensionFactor:
.5;f=Math.min(1-t,null!=f.ascensionFactor?f.descensionFactor:.5);const w=1-t-f;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();e.definition.compared.targetZoom=d;e.definition.compared.pan=this.definition.compared.pan*t;e.definition.compared.rotate=this.definition.compared.rotate*t;e.update();this._ascensionSegment=e;this.segments.push(e);0<w&&(l.definition?l.definition.copyFrom(this.definition):l.definition=this.definition.clone(),l.definition.copyFrom(this.definition),
l.definition.compared.sourceZoom=d,l.definition.compared.targetZoom=d,l.definition.compared.pan=this.definition.compared.pan*w,l.definition.compared.rotate=this.definition.compared.rotate*w,l.update(),this.segments.push(l));A.definition?A.definition.copyFrom(this.definition):A.definition=this.definition.clone();A.definition.compared.sourceZoom=d;A.definition.compared.pan=this.definition.compared.pan*f;A.definition.compared.rotate=this.definition.compared.rotate*f;A.update();this._descensionSegment=
A;this.segments.push(A)};h._updateWithoutApex=function(){const [d]=this._preallocSegments;d.update(this.definition);this.segments.push(d)};return g}(r.Path);a.Path=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let r=function(){function m(){this.segments=[]}var n=m.prototype;n.interpolateComponentsAt=
function(p,g){p=Math.min(Math.max(p,0),1);p*=this.time;let h=0,d=0;const f=this.definition;for(let e=0;e<this.segments.length;e++){const l=this.segments[e],A=l.definition;if(p<=l.time||e===this.segments.length-1)return g=this.segmentInterpolateComponentsAt(l,0===l.time?0:p/l.time,g),f.hasPan&&!isNaN(g.pan)&&isFinite(f.compared.pan)?g.pan=(h+A.compared.pan*g.pan)/f.compared.pan:g.pan=1,f.hasRotate&&!isNaN(g.rotate)&&isFinite(f.compared.rotate)?g.rotate=(d+A.compared.rotate*g.rotate)/f.compared.rotate:
g.rotate=1,f.hasZoom&&!isNaN(g.zoom)&&isFinite(A.compared.targetZoom)?(p=this.segments[0].definition.compared.sourceZoom,g.zoom=(g.zoom*(A.compared.targetZoom-A.compared.sourceZoom)+A.compared.sourceZoom-p)/(this.segments[this.segments.length-1].definition.compared.targetZoom-p)):g.zoom=1,g;p-=l.time;h+=A.compared.pan;d+=A.compared.rotate}};n.segmentInterpolateComponentsAt=function(p,g,h){return p.interpolateComponentsAt(g,h)};b._createClass(m,[{key:"time",get:function(){return this.segments.reduce((p,
g)=>c.Seconds(p+g.time),c.Seconds(0))}}]);return m}();a.Path=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let r=function(){function m(p){p&&this.update(p)}var n=m.prototype;n.update=function(p){p&&(this.definition?this.definition.copyFrom(p):this.definition=p.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};n._updatePrecomputedVariables=function(){var p=this.definition;const g=p.compared,h=g.sourceZoom,d=g.targetZoom;this._zoomSign=h>d?1:-1;this._panPixelsAtSource=g.pan*p.source.pixelsPerPanAtZoom(h);p=(p.source.pixelsPerRotateAtZoom(h)+p.target.pixelsPerRotateAtZoom(d))/2;this._rotatePixels=g.rotate*p};n._updatePixelFlow=function(){var p=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom;const {hasZoom:h,hasPan:d,hasRotate:f}=this.definition;var e=0,l=
0;h&&(d&&(e=(g/p-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),f&&(l=Math.log(p/g)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;p=this.definition.desiredPixelFlow;h&&d&&f?(g=e+l+e*l,this._zoomPixelFlow=e*l/g*p,this._panPixelFlow=l/g*p,this._rotatePixelFlow=e/g*p):h&&d?(l=1+e,this._zoomPixelFlow=e/l*p,this._panPixelFlow=1/l*p):h&&f?(e=1+l,this._zoomPixelFlow=l/e*
p,this._rotatePixelFlow=1/e*p):d&&f?(e=this._panPixelsAtSource/this._rotatePixels,l=1+e,this._panPixelFlow=e/l*p,this._rotatePixelFlow=1/l*p):d?this._panPixelFlow=p:h?this._zoomPixelFlow=p:f&&(this._rotatePixelFlow=p);this._time=f?this.rotateTime:h?this.zoomTime:d?this.panTime:c.Seconds(0)};n._interpolateComponentsZoom=function(p){if(0===p||1===p)return p;if(this.definition.hasZoom){const g=this.definition.compared.sourceZoom,h=this.definition.compared.targetZoom;return(g*(g/h)**-p-g)/(h-g)}return p};
n._interpolateComponentsPan=function(p){if(0===p||1===p)return p;if(this.definition.hasPan&&this.definition.hasZoom){const g=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(g*p*this._time)-1)/(g*Math.LN2)}return p};n._interpolateComponentsRotate=function(p){return p};n.interpolateComponentsAt=function(p,g){p=Math.min(Math.max(p,0),1);const h=this._interpolateComponentsZoom(p),d=this._interpolateComponentsPan(p);p=this._interpolateComponentsRotate(p);
g?(g.zoom=h,g.pan=d,g.rotate=p):g={zoom:h,pan:d,rotate:p};return g};b._createClass(m,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):c.Seconds(0)}},
{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const p=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*p+1)/(p*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);return m}();a.Segment=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,b){function c(r,m){const n=Math.max(r.compared.sourceZoom,r.compared.targetZoom);r=r.source.zoomAtPixelsPerPan(r.desiredPixelFlow/r.compared.pan)/2;return r<n?null!=m.maximumDistance?n+(m.maximumDistance-n)/2:1.5*n:m.maximumDistance?Math.min(m.maximumDistance,r):r}a.optimalDistance=function(r,m){let n=c(r,m);const p={ascensionFactor:null!=m.ascensionFactor?m.ascensionFactor:.5,descensionFactor:null!=m.descensionFactor?m.descensionFactor:.5};var g=0===p.ascensionFactor,h=
0===p.descensionFactor;const d=g?b.tAscensionZoomOnly:b.tAscensionZoomPan,f=g?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,e=g?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,l=h?b.tDescensionZoomOnly:b.tDescensionZoomPan,A=h?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,t=h?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;g=k=>d(r,k,p)+b.tPanion(r,k,p)+l(r,k,p);h=k=>f(r,k,p)+b.dtPanion(r,k,p)+A(r,k,p);const w=k=>e(r,k,p)+b.ddtPanion(r,k,p)+t(r,k,p);let u=g(n);const z=b.tBaseLine(r),y=m.maximumIterations||
20,B=null!=m.maximumDistance?m.maximumDistance:Infinity;for(m=0;m<y;m++){var C=(h(n)+1E-6)/w(n);if(isNaN(C)||n>=B&&0>C){if(!isFinite(B))return null;n=B;u=g(n);break}n-=C;if(n<r.compared.sourceZoom||n<r.compared.targetZoom)return null;C=g(n);if(.005>=Math.abs(C-u)/u)break;u=C}return u>.7*z||n<r.compared.sourceZoom||n<r.compared.targetZoom?null:n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],
function(a){a.ddtAscensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,c,r){const m=c-b.compared.sourceZoom,n=1/m,p=1/c,g=Math.log(b.compared.sourceZoom*p);r=(r.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(m))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*n*(-2*n*p*r+2*n*g+2*p-2*g*r/(m*m)-r/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*
Math.LN2)};a.ddtDescensionZoomPan=function(b,c,r){const m=c-b.compared.targetZoom,n=1/m,p=1/c,g=Math.log(c/b.compared.targetZoom);r=(b.halfWindowPanAtZoom(c)+r.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*n*(-2*n*p*r-2*n*g+2*p+2*g*r/(m*m)-r/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,c,r){return-2*b.compared.pan*b.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*
c*c))};a.dtAscensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,c,r){const m=1/c,n=Math.log(b.compared.sourceZoom*m),p=1/b.desiredPixelFlow,g=1/Math.LN2;c-=b.compared.sourceZoom;const h=1/c;r=(r.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*p*g*h*r-b.halfWindowSize*n*p*g*h+b.halfWindowSize*n*p*g*r/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/
(c*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,c,r){const m=Math.log(c/b.compared.targetZoom),n=1/b.desiredPixelFlow,p=1/Math.LN2,g=-c+b.compared.targetZoom,h=1/g;r=(-b.halfWindowPanAtZoom(c)-r.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*m*n*p*h+b.halfWindowSize*m*n*p*r/(g*g)+b.halfWindowSize*n*p*h*r/c};a.dtPanion=function(b,c,r){return b.compared.pan*b.halfWindowSize*(r.ascensionFactor+
r.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,r){const m=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(r.ascensionFactor*Math.LN2*b.compared.pan+m)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2*m)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,r=b.halfWindowPanAtZoom(b.compared.sourceZoom-
b.compared.targetZoom),m=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*r);return b.compared.sourceZoom<=b.compared.targetZoom?m*(c-r):m*(c+r)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,c,r){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-r.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/
b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=function(b,c,r){return-b.compared.pan*b.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.AnimationController=function(A){function t(){var u=A.apply(this,arguments)||this;u._asyncResult=null;return u}b._inheritsLoose(t,A);var w=t.prototype;w.onControllerStart=function(){this.state=l.State.Running;r.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};w.updateStateFromViewAnimation=function(){!r.isSome(this.viewAnimation)||this.state!==l.State.Ready&&this.state!==l.State.Running||
(this.viewAnimation.state===e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=l.State.Stopped))};w.onControllerEnd=function(){r.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===l.State.Finished?this.viewAnimation.finish():this.state===l.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(m.createAbortError()))};w.finish=function(){this.finishController()};
b._createClass(t,[{key:"canStop",get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(u){this._asyncResult&&(this._asyncResult.reject(m.createAbortError()),this._asyncResult=null);this.state===l.State.Finished||this.state===l.State.Stopped?(r.assertIsSome(u),this.state===l.State.Finished?u.resolve():u.reject(m.createAbortError())):this._asyncResult=u}}]);return t}(l.CameraController);a.AnimationController=c.__decorate([f.subclass("esri.views.3d.state.controllers.AnimationController")],
a.AnimationController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,
n,p,g){a.State=void 0;(function(h){h.Ready="ready";h.Rejected="rejected";h.Running="running";h.Stopped="stopped";h.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(h){function d(e){e=h.call(this,e)||this;e.state=a.State.Ready;return e}b._inheritsLoose(d,h);var f=d.prototype;f.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};f.finishController=function(){this.state=a.State.Finished};b._createClass(d,[{key:"active",get:function(){return this.state===
a.State.Running}},{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return d}(r);c.__decorate([m.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);c.__decorate([m.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([m.property()],a.CameraController.prototype,"state",void 0);c.__decorate([m.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",
null);a.CameraController=c.__decorate([g.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){function C(ua,za,va){va=n.fromRotation(u.sm4d.get(),va[3],e.axis(va));r.isNone(va)||n.exactEquals(va,p.IDENTITY)||(d.subtract(fa,ua.eye,za),d.transformMat4(fa,fa,va),ua.eye=d.add(fa,fa,za),d.subtract(fa,ua.center,za),d.transformMat4(fa,fa,va),ua.center=d.add(fa,fa,za),ua.up=d.transformMat4(fa,ua.up,va))}function k(ua,za,va,Ja){return Math.sin(ua/d.length(za))*(va+Ja.radius)}function q(ua,za,va,Ja){va=z.fromScreenAtEye(za,va,ra);if(r.isNone(va))return!1;
t.closestPointOnSilhouette(ua,va,M);return t.intersectRay(ua,va,Ja)?d.squaredDistance(M,va.origin)<d.squaredDistance(Ja,va.origin)?(d.copy(Ja,M),!1):!0:(d.subtract(Q,za.eye,za.center),d.normalize(Q,Q),A.fromNormalAndOffset(Q,-d.dot(d.normalize(Q,Q),M),T),A.intersectRay(T,va,Ja),!1)}function x(ua,za,va,Ja,pa,Ba){var Ha=0;d.cross(la,ua,za);d.subtract(ea,ua,za);d.length(ua)<=pa||!Ja.aboveGround?(d.cross(va,ea,Ja.eye),Ha=d.dot(ua,za)/(d.length(ua)*d.length(za)),.9999>Ha?Ha=c.acosClamped(Ha):(ua=d.length(d.cross(f.create(),
ua,za))/(d.length(ua)*d.length(za)),Ha=c.asinClamped(ua)),Ba=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ba)),0,E)),Ha=-Ha-Math.max(0,d.length(za)-pa)/(Ba*pa)):(d.subtract(S,Ja.eye,Ja.center),d.cross(va,ea,S),Ha=-d.length(ea)/pa);d.normalize(va,va);d.scale(va,va,d.length(la));return Ha}function v(ua,za,va,Ja){Ja=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ja)),0,E));za=za>va?-(za-va)/(Ja*va):za<-va?Math.PI-(za+va)/(Ja*va):c.acosClamped(za/va);return((ua>va?-(ua-va)/(Ja*va):ua<-va?Math.PI-
(ua+va)/(Ja*va):c.acosClamped(ua/va))-za)*va}function D(ua,za,va,Ja,pa,Ba,Ha,wa,ya,Na){wa=v(ua[2],za[2],Ba[3],wa);za=ya?v(ua[0],za[0],Ba[3],180):za[0]-ua[0];ua=Math.sin(Ha)*za-Math.cos(Ha)*wa;Ha=Math.cos(Ha)*za+Math.sin(Ha)*wa;d.normalize(fa,pa);pa=ya?ua/Math.sqrt(Math.abs(Ba[3]**2-d.dot(va,fa)**2)):ua/Ba[3];va=Ha/Math.sqrt(Math.abs(Ba[3]**2-d.dot(va,Ja)**2));g.set(Na,pa,va)}function F(ua,za,va,Ja,pa,Ba,Ha,wa,ya,Na){d.cross(la,ua,za);l.coordinateSystemFromOneAxisAndNormalVector(Ba.up,Ba.eye,R,X,W);
l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ba.eye,U,Y,V);d.copy(va,Y);d.copy(Ja,U);d.normalize(va,va);d.scale(va,va,d.length(la));l.vectorCoordinates(ua,d.normalize(X,X),d.normalize(W,W),d.normalize(R,R),aa);l.vectorCoordinates(za,X,W,R,ba);D(aa,ba,ua,U,Y,Ha,wa,ya,Na,pa)}function G(ua,za,va,Ja,pa,Ba,Ha){n.fromRotation(ha,pa,Ja);n.fromRotation(ka,Ha,Ba);n.multiply(Z,ha,ka);d.subtract(za,ua,va);d.transformMat4(za,za,Z);d.add(za,za,va)}function J(ua,za,va,Ja,pa,Ba){n.fromRotation(ha,Ja,va);
n.fromRotation(ka,Ba,pa);n.multiply(Z,ha,ka);d.subtract(fa,ua.eye,za);d.transformMat4(fa,fa,Z);ua.eye=d.add(fa,fa,za);d.subtract(fa,ua.center,za);d.transformMat4(fa,fa,Z);ua.center=d.add(fa,fa,za);d.subtract(fa,ua.up,za);d.transformMat4(fa,fa,Z);ua.up=d.add(fa,fa,za)}function L(ua,za,va,Ja,pa,Ba){return(Math.abs(Ja)>Math.PI-H.Angle||Math.abs(Ja)<H.Angle)&&(Math.abs(ua[2])<va*H.Pole||Math.abs(za)>va)&&Ba.aboveGround&&pa<H.Tilt}function K(ua,za,va,Ja,pa,Ba){Ba?(e.fromPoints(va,Ja,ma),C(za,ua,ma)):(va=
x(va,Ja,oa,za,ua[3],pa),C(za,ua,e.wrapAxisAngle(oa,va)))}function O(ua,za,va,Ja,pa,Ba,Ha){const wa=Ha?20:1;d.copy(ca,Ja);da.copyFrom(za);let ya;for(let Na=0;Na<wa&&1E-12<d.squaredDistance(va,ca);Na++)if(Ja=d.squaredDistance(va,ca),F(va,ca,Y,U,ia,da,ua,pa,Ba,Ha),J(da,ua,U,ia[1],Y,ia[0]),G(ca,ca,ua,U,ia[1],Y,ia[0]),ya=d.squaredDistance(va,ca),ya<Ja||0===Na)za.copyFrom(da);else break}a.SpherePickPointFallback=void 0;(function(ua){ua[ua.Ellipsoid=0]="Ellipsoid";ua[ua.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));const P=m.createScreenPointArray();a.NavigationMode=void 0;(function(ua){ua[ua.Vertical=0]="Vertical";ua[ua.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const N={Elevation:3E4,Angle:c.deg2rad(6)},H={Pole:.95,Angle:c.deg2rad(18),Tilt:45},E=c.deg2rad(80),I=f.create(),M=f.create(),Q=f.create(),T=A.create(),S=f.create(),U=f.create(),Y=f.create(),V=f.create(),R=f.create(),X=f.create(),W=f.create(),aa=f.create(),ba=f.create(),ia=h.create(),ma=e.create(),
ha=p.create(),ka=p.create(),Z=p.create(),ca=f.create(),fa=f.create(),ea=f.create(),da=new B.Camera,la=f.create(),oa=f.create(),ra={origin:f.create(),direction:f.create()},Aa={origin:f.create(),direction:f.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=H;a.SCREEN_PIXEL_AREA=70;a.TiltThresholdPanningSpeed=E;a.VerticalPanTresholds=N;a.applyPanPlanar=function(ua,za,va){d.subtract(I,va,za);ua.eye=d.subtract(fa,ua.eye,I);ua.center=d.subtract(fa,ua.center,
I)};a.applyPanSphericalDirectRotation=K;a.applyPanSphericalPreserveHeading=O;a.applyRotation=C;a.applyRotationWithTwoAxes=J;a.applyZoomOnSphere=function(ua,za,va){za.getScreenCenter(P);y.intersectScreen(ua,za,P,fa)&&(za.center=fa);ua=za.distance;va*=ua;1E-6>Math.abs(ua-va)||(va=d.scale(u.sv3d.get(),za.viewForward,va),za.eye=d.subtract(fa,za.center,va))};a.applyZoomToPoint=function(ua,za,va,Ja){const pa=u.sv3d.get();va=1-va;d.subtract(pa,za,ua.eye);const Ba=d.length(pa);let Ha=Ba*(1-va);0<=va&&Ha<
Ja&&(Ha=Ja,va=-(Ha-Ba)/Ba);1E-6>Math.abs(Ba-Ha)||(d.scale(pa,pa,va),ua.eye=d.add(fa,ua.eye,pa),ua.center=d.lerp(fa,ua.center,za,va))};a.centroid=function(ua,za){d.set(za,0,0,0);for(const va of ua)d.add(za,za,va);d.scale(za,za,1/ua.length)};a.decideNavigationMode=function(ua,za,va,Ja){if(d.length(ua.eye)-Ja.radius>N.Elevation)return a.NavigationMode.Horizontal;if(!va)return a.NavigationMode.Vertical;z.fromScreenAtEye(ua,za,Aa);return-Math.sign(ua.relativeElevation)*(.5*Math.PI+w.angle(ua.eye,Aa.direction))<
N.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(ua,za,va,Ja){return A.intersectRay(ua,z.fromScreen(za,va,ra),Ja)};a.intersectPlaneFromScreenPointAtEye=function(ua,za,va,Ja){return A.intersectRay(ua,z.fromScreenAtEye(za,va,ra),Ja)};a.lengthFromPoints=v;a.normalizeCoordinate=function(ua,za,va){va[0]=za[0]/(ua.fullWidth/ua.pixelRatio);va[1]=za[1]/(ua.fullHeight/ua.pixelRatio);return va};a.normalizeRotationDelta=function(ua){for(;ua>Math.PI;)ua-=
2*Math.PI;for(;ua<-Math.PI;)ua+=2*Math.PI;return ua};a.offSurfaceTiltToEyeTiltGlobal=function(ua,za,va,Ja){return k(Math.PI/2,za,va,Ja)+(ua-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=k;a.panMotionToRotationMatrix=function(ua,za,va,Ja,pa,Ba,Ha,wa,ya){if(L(ua.center,d.dot(ua.up,ua.center),d.length(ua.center),-b.cyclicalPI.normalize(c.deg2rad(Ba)),Ha,za))switch(ua=-b.cyclicalPI.normalize(c.deg2rad(pa)),{eye:pa}=za,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],pa,U,Y,V),pa=va.translation[0]*Ja.pan,
Ba="zoom"===ya.mode?0:va.translation[1]*Ja.pan,za=Math.max(Math.sqrt(Math.abs(1-d.dot(za.center,U)**2/d.length(za.center)**2)),.5),Ha=-Math.cos(ua)*Ba+Math.sin(ua)*pa,n.rotate(wa.pan.matrix,wa.pan.matrix,(Math.sin(ua)*Ba+Math.cos(ua)*pa)/za,U),wa.pan.enabled=!0,ya.mode){case "pan":n.rotate(wa.pan.matrix,wa.pan.matrix,Ha,Y);wa.pan.enabled=!0;break;case "zoom":wa.zoom=-va.translation[1]*Ja.zoom}else{const {eye:Na,viewRight:Ra}=za;za=d.cross(u.sv3d.get(),Ra,Na);ua=va.translation[0]*Ja.pan;0!==ua&&(n.rotate(wa.pan.matrix,
wa.pan.matrix,-ua,za),wa.pan.enabled=!0);switch(ya.mode){case "pan":va=va.translation[1]*Ja.pan;0!==va&&(n.rotate(wa.pan.matrix,wa.pan.matrix,va,Ra),wa.pan.enabled=!0);break;case "zoom":wa.zoom=-va.translation[1]*Ja.zoom}}};a.panToPosition=function(ua,za,va,Ja,pa,Ba,Ha){L(va,d.dot(za.up,va),ua[3],-b.cyclicalPI.normalize(c.deg2rad(pa)),Ba,za)?O(ua,za,va,Ja,-b.cyclicalPI.normalize(c.deg2rad(pa)),Ba,Ha):K(ua,za,va,Ja,Ba,Ha)};a.pickPointAndInitSphere=function(ua,za,va,Ja,pa,Ba){const Ha=f.create(),wa=
t.create();let ya=!0,Na=!0;ua.intersectScreen(va,Ha,Ba)?wa[3]=d.length(Ha):(Na=!1,wa[3]=za.aboveGround&&pa!==a.SpherePickPointFallback.Ellipsoid?Math.max(d.length(za.center),.9*Ja.radius):d.length(za.eye)-za.relativeElevation,pa===a.SpherePickPointFallback.Silhouette?q(wa,za,va,Ha):ya=y.intersectScreen(wa,za,va,Ha));return{sphere:wa,scenePickPoint:ya?Ha:null,hasGeometryIntersection:Na}};a.preserveHeadingThreshold=L;a.rotatePointAroundTwoAxes=G;a.rotationAngleAndAxisDirectRotation=x;a.rotationAnglesAndAxesHeadingPreserving=
F;a.rotationAnglesHeadingPreserving=D;a.sphereOrPlanePointFromScreenPoint=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),function(a,b,c,r,m,n){function p(l=d){return[l[0],l[1],l[2],l[3]]}function g(l,A,t,w,u=p()){u[0]=l;u[1]=A;u[2]=t;u[3]=w;return u}function h(l,A){l[3]=A;return l}const d=[0,0,1,0],
f=c.create(),e=c.create();a.UP=d;a.angle=function(l){return l[3]};a.axis=function(l){return l};a.compose=function(l,A,t){b.setAxisAngle(f,l,l[3]);b.setAxisAngle(e,A,A[3]);b.multiply(f,e,f);return h(t,b.getAxisAngle(t,f))};a.copy=function(l,A=p()){return g(l[0],l[1],l[2],l[3],A)};a.create=p;a.fromAxisAndAngle=function(l,A){const t=p();r.copy(t,l);t[3]=A;return t};a.fromPoints=function(l,A,t){r.cross(t,l,A);r.normalize(t,t);t[3]=m.angle(l,A);return t};a.fromValues=g;a.setAngle=h;a.wrap=function(l,A,
t,w){return g(l,A,t,w,n.sv4d.get())};a.wrapAxisAngle=function(l,A){return g(l[0],l[1],l[2],A,n.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),function(a,b,c,r,m,n){function p(h,d,f){const e=c.castRenderScreenPointArray3(r.copy(n.sv3d.get(),
d));e[2]=0;if(!h.unprojectFromRenderScreen(e,f.origin))return null;d=c.castRenderScreenPointArray3(r.copy(n.sv3d.get(),d));d[2]=1;h=h.unprojectFromRenderScreen(d,n.sv3d.get());if(b.isNone(h))return null;m.subtract(f.direction,h,f.origin);return f}function g(h,d,f){m.copy(f.origin,h.eye);d=m.set(n.sv3d.get(),d[0],d[1],1);h=h.unprojectFromRenderScreen(d,n.sv3d.get());if(b.isNone(h))return null;m.subtract(f.direction,h,f.origin);return f}a.fromRender=p;a.fromRenderAtEye=g;a.fromScreen=function(h,d,f){return p(h,
h.screenToRender(d,c.castRenderScreenPointArray3(n.sv3d.get())),f)};a.fromScreenAtEye=function(h,d,f){return g(h,h.screenToRender(d,c.castRenderScreenPointArray3(n.sv3d.get())),f)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,c,r){const m=b.create();a.intersectScreen=function(n,p,g,h){p=r.fromScreenAtEye(p,
g,m);return c.intersectRay(n,p,h)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k){a.ZoomStepController=function(F){function G(){var L=F.apply(this,arguments)||this;L._zoomLocation=l.create();L._tmpCamera=new y.Camera;L._tmpRayDir=l.create();L._tmpCenter=l.create();L._constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:w.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new y.Camera,interactionDirection:null,tiltMode:u.TiltMode.TUMBLE};return L}b._inheritsLoose(G,F);var J=G.prototype;J.zoomStep=
function(L,K){if(this.active){var O=this.view.state,{interactionStartCamera:P}=this._constraintOptions;this.animation.finished?P.copyFrom(O.camera):this.animation.cameraAt(1,P);this._tmpCamera.copyFrom(O.camera);O=B.newIntersector(this.view.state.viewingMode);0<L?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(K,this._zoomLocation,D):this.intersectionHelper.intersectScreenFreePointFallback(K,this._zoomLocation),this.intersectionHelper.intersectRay(this._tmpCamera.ray,
O,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,O,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);L=.6**L;K=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,K[0],K[1],this.view.state.camera,60);e.subtract(v,this._tmpCamera.eye,this._zoomLocation);e.normalize(v,v);O=Math.max(Math.min(14,1/Math.abs(e.dot(x,v)))*Math.abs(this.view.camera.position.z),
200);if(K=r.isSome(K)?Math.min(K,O):O)O=l.create(),e.subtract(O,this._zoomLocation,this._tmpCamera.eye),K<e.length(O)&&(e.normalize(O,O),e.add(this._zoomLocation,this._tmpCamera.eye,e.scale(O,O,K)));this._updateCamera(this._tmpCamera,L,this._zoomLocation);this.begin(this._tmpCamera)}};J.animationSettings=function(){return{apex:null,duration:m.Milliseconds(600),easing:k.outExpo}};J._updateCamera=function(L,K,O){e.subtract(this._tmpRayDir,O,L.eye);const P=e.length(this._tmpRayDir);let N=P*K;const H=
Math.max(4,1.01*L.nearFar[0]);0!==N&&(1>=K&&N<H&&(N=H,K=N/P),1E-6>Math.abs(P-N)||(e.scale(this._tmpRayDir,this._tmpRayDir,K),L.eye=e.subtract(q,O,this._tmpRayDir),L.center=e.lerp(q,L.center,O,1-K),A.applyAll(this.view,L,this._constraintOptions)))};return G}(z.PointToPointAnimationController);a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const q=l.create(),x=l.fromValues(0,0,1),v=l.create(),D={exclude:new Set([C.TERRAIN_ID])};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==
b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,r,m,n){m=function(p){function g(h,d,f,e){var l=p.call(this,
!0)||this;l._view=h;l.pointerAction=d;l._pivot=f;l.registerIncoming("drag",e,A=>l._handleDrag(A));return l}b._inheritsLoose(g,p);g.prototype._handleDrag=function(h){const d=h.data;if(!(1<d.pointers.size)&&n.eventMatchesMousePointerAction(h.data,this.pointerAction)){var f=c.createScreenPointArray(d.center.x,d.center.y);switch(d.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new r.RotateController({view:this._view,pivot:this._pivot});
this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(f);break;case "update":this._cameraController&&this._cameraController.update(f);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}h.stopPropagation()}};return g}(m.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>r.PivotPoint});a.DragRotate=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){a.PivotPoint=void 0;(function(D){D[D.CENTER=0]="CENTER";D[D.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(D){function F(J){J=D.call(this,J)||this;J.pivot=a.PivotPoint.CENTER;J._lastPoint=A.create();J._tmpWorldUp=w.create();J._tmpViewDir=w.create();J._tmpRotCurPoint=A.create();J._tmpTransf=e.create();J._tmpAxis=w.create();J._tmpPivotPoint=w.create();J._pivotPos=w.create();J._constraintOptions={selection:y.ConstraintTypes.ALL,
interactionType:B.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:C.TiltMode.TUMBLE};return J}b._inheritsLoose(F,D);var G=F.prototype;G.initialize=function(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};G.begin=function(J){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:t.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=B.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=C.TiltMode.LOOK_AROUND;
this._constraintOptions.selection=y.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const L=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos);L||t.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(J,L);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=B.InteractionType.TUMBLE;this._constraintOptions.tiltMode=C.TiltMode.TUMBLE;this._constraintOptions.selection=y.ConstraintTypes.ALL&~y.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=
this.startCamera;x.normalizeCoordinate(this.startCamera,J,this._lastPoint)}};G._constrainPivotPoint=function(J,L){const K=this.startCamera,O=w.create();t.subtract(O,this._pivotPos,K.eye);const P=t.length(O);let N=Math.min(P,7*Math.abs(this.view.camera.position.z));var H=u.getReferenceEllipsoid(this.view.spatialReference),E=n.createScreenPointArray(K.width/K.pixelRatio*.5,K.height/K.pixelRatio*.5);H=x.decideNavigationMode(this.startCamera,E,!0,H);E=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
K.fullWidth/K.pixelRatio*.5,K.fullHeight/K.pixelRatio*.5,K,225,90);J=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,J[0],J[1],K,90);if(m.isSome(E)||m.isSome(J))E=m.unwrapOr(E,J),J=m.isNone(J)||H===x.NavigationMode.Horizontal?E:J,N=E>J?J:E,N=L?Math.min(N,P):N;t.normalize(O,O);t.copy(this._pivotPos,t.add(this._tmpPivotPoint,K.eye,t.scale(this._tmpPivotPoint,O,N)))};G.update=function(J){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
J,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,J,this.currentCamera.eye,this._pivotPos)}z.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}};G.end=function(){this.active&&this.finishController()};G._applyRotation=function(J,L,K,O){this.view.renderCoordsHelper.worldUpAtPosition(O,this._tmpWorldUp);x.normalizeCoordinate(J,L,this._tmpRotCurPoint);
L=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let P=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;t.subtract(this._tmpViewDir,K,O);K=t.length(this._tmpViewDir);K=r.acosClamped(t.dot(this._tmpViewDir,this._tmpWorldUp)/K);if(this.pivot===a.PivotPoint.EYE){const N=.5*Math.PI-K,H=.495*Math.PI;L=N-Math.max(-H,Math.min(H,N+-.5*L))}L=r.clamp(L+K,k.TiltDefault.min,k.TiltDefault.max)-K;t.cross(this._tmpAxis,J.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(P=-P);f.fromRotation(this._tmpTransf,
P,this._tmpWorldUp);f.rotate(this._tmpTransf,this._tmpTransf,L,this._tmpAxis);t.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);J.up=t.transformMat4(v,J.up,this._tmpTransf);t.add(v,O,this._tmpViewDir);l.copy(this._lastPoint,this._tmpRotCurPoint);return v};b._createClass(F,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return F}(q.InteractiveController);c.__decorate([p.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=
c.__decorate([d.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const v=w.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,r,m,n,p,g,h,d){a.InteractiveController=function(f){function e(){var A=f.apply(this,arguments)||this;A.startCamera=new d.Camera;A.currentCamera=new d.Camera;A._lastInteraction=0;return A}b._inheritsLoose(e,f);var l=e.prototype;l.stepController=function(A,t){t.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(t)};l.onControllerStart=function(A){this.state=h.State.Running;this.startCamera.copyFrom(A);this.currentCamera.copyFrom(A)};l.onControllerEnd=function(A){A.copyViewFrom(this.currentCamera)};
l.commitCamera=function(){this._lastInteraction=performance.now();setTimeout(()=>this.notifyChange("isInteractive"),g.INTERACTING_TIMEOUT);this.view.state.updateCamera(A=>this.stepController(0,A));this.steppingFinished&&this.finishController()};b._createClass(e,[{key:"isInteractive",get:function(){return performance.now()-this._lastInteraction<g.INTERACTING_TIMEOUT}}]);return e}(h.CameraController);c.__decorate([r.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);c.__decorate([r.property()],
a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=c.__decorate([p.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H){a.ViewStateManager=function(U){function Y(R){var X=U.call(this,R)||this;X._propertiesPool=new O.PropertiesPool({frustum:G.Frustum},b._assertThisInitialized(X));X._handles=new p;X._cameraSetByUser=!1;X._gotoOperation=null;X.ready=!1;X._windowDevicePixelRatio=1;X._devicePixelRatioOverride=null;X._maximumPixelRatioOverride=null;X._cameraChangeTime=0;X.test={contentCameraResetState:new Map,setDevicePixelRatio:W=>X._devicePixelRatioOverride=
W,setMaximumPixelRatio:W=>X._maximumPixelRatioOverride=W,renderState:null};return X}b._inheritsLoose(Y,U);var V=Y.prototype;V.installContentCameraReset=function(R){this._handles.remove("contentCameraReset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const X=this.zoom,W=this.view.state.camera.distance**2,aa=z.fromArray(this.view.state.camera.center),ba=R.sticky?this.contentCamera.clone():null;this._handles.add([d.watch(()=>this.contentCamera,()=>{R.sticky||
(this._handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),d.watch(()=>this.zoom,ia=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(ia-X)/2);2<Math.abs(ia-X)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ba)}),d.watch(()=>this.view.state.camera,ia=>{ia=u.squaredDistance(aa,ia.center);this.test.contentCameraResetState.set("camera.center",ia/W);ia>W?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=
ba)})],"contentCameraReset");return!0};V._paddingToArray=function(R,X,W){R?y.set(W,R.top||0,R.right||0,R.bottom||0,R.left||0):y.set(W,0,0,0,0);for(R=0;4>R;R++)W[R]=Math.round(W[R]*X)};V.initialize=function(){this._cameraChangeTime=performance.now();this._handles.add([d.on(()=>this.view.state.events,"before-camera-change",R=>this._updateElevation(R.camera)),d.watch(()=>this.view.state?.camera,(R,X)=>this._cameraChangedHandler(R,X),d.sync)]);d.when(()=>this.view.state?.camera,R=>this._updateElevation(R),
{once:!0,sync:!0});this._handles.add([f.addFrameTask({prepare:()=>this._prepareFrame()}),d.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this._handles.remove("pending-initial-view")}),d.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])};V.destroy=function(){this.exit();this._handles&&(this._handles.destroy(),this._handles=null);this._propertiesPool&&(this._propertiesPool.destroy(),this._propertiesPool=null)};V.init=function(){this.constraintsManager=
new F.ConstraintsManager({view:this.view});this._prepareFrame();var R=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const X of R)this.set(X.name,X.value);this._cameraSetByUser||((R=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(R)?this._setInitialView(R):this.view.state.viewingMode===x.ViewingMode.Local&&this._handles.add(d.when(()=>this.view.basemapTerrain.ready,()=>{this._handles.remove("pending-initial-view");
this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))};V.exit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this._handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};V.goTo=function(){var R=b._asyncToGenerator(function*(X,W){W={animate:!0,...W};h.isSome(this._gotoOperation)&&
this._gotoOperation.abort(W.animate);this._gotoOperation=new J.GoToOperation(X,W,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation});return function(X,W){return R.apply(this,arguments)}}();V.debugSetCameraOnContent=function(){this.setStateCamera(D.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};V.step=function(R){const X=this.view.state,W=X?.cameraController;W&&(X.updateCamera(aa=>W.stepController(R,aa)),W.steppingFinished&&W.finishController())};
V._cancelGoToOperation=function(){h.isSome(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)};V._getInitialProperties=function(){const R=new Set,X=[];for(const {propertyName:W,overrides:aa}of I){const ba=R.has(W),ia=this._isOverridden(W);!ba&&ia&&X.push({name:W,value:this._get(W)});this._clearOverride(W);(ba||ia)&&aa.forEach(ma=>R.add(ma))}return X};V._setInitialView=function(R){if(!h.isNone(R)&&!this._cameraSetByUser)if(R instanceof r)this.setStateCamera(K.externalToInternal(this.view,
R),{applyConstraints:!1});else if(R instanceof m)if(R.targetGeometry instanceof C){var X=K.fromExtent(this.view,R.targetGeometry,0,.5,K.OrientationMode.LOCKED);h.isSome(X)&&this.setStateCamera(K.externalToInternal(this.view,X),{applyConstraints:!0})}else X={applyConstraints:!R.camera},R=this._viewpointToCamera(R),this.setStateCamera(R,X);else X=K.fromExtent(this.view,R,0,.5,K.OrientationMode.LOCKED),h.isSome(X)&&this.setStateCamera(K.externalToInternal(this.view,X),{applyConstraints:!0})};V._updatePropertyBeforeReady=
function(R,X){if(this.ready)return!1;this._override(R,X);X&&E.includes(R)&&this._override("hasInitialView",!0);return!0};V.isCompatible=function(R){return h.isNone(R)?!1:R instanceof m?R.camera?this.isCompatible(R.camera):this.isCompatible(R.targetGeometry):R instanceof r?this.isCompatible(R.position):R.spatialReference&&q.canProject(R.spatialReference,this.view.spatialReference)};V._getPreservingHeadingTilt=function(R=M){this._cameraSetByUser?(R.heading=this.camera.heading,R.tilt=this.camera.tilt):
(R.heading=0,R.tilt=.5);return R};V._centerPointAtDistanceToCamera=function(R,X,W=T){const {heading:aa,tilt:ba}=this._getPreservingHeadingTilt();R=K.getObserverForPointAtDistance(this.view,aa,ba,R,X,K.OrientationMode.ADJUST);if(h.isNone(R))return null;W.copyFrom(this.view.state.camera);W.eye=R.eye;W.center=R.center;W.up=R.up;return W};V._centerToCamera=function(R){const X=this.view.pointsOfInterest.centerOnContent;X.runTask();return this._centerPointAtDistanceToCamera(R,X.distance)};V._extentToCamera=
function(R){const {heading:X,tilt:W}=this._getPreservingHeadingTilt();R=K.fromExtent(this.view,R,X,W,K.OrientationMode.ADJUST,Q);return h.isSome(R)?K.externalToInternal(this.view,R):null};V._scaleToCamera=function(R){if(null==R)return null;const X=this.view.pointsOfInterest.centerOnContent;X.runTask();const W=X.renderLocation;R=K.scaleToDistance(this.view,R,X.location.latitude);return this._centerPointAtDistanceToCamera(W,R)};V._zoomToCamera=function(R){return this._scaleToCamera(K.zoomToScale(this.view,
R))};V._viewpointToCamera=function(R){return K.externalToInternal(this.view,P.toCamera(this.view,R))};V.setStateCamera=function(R,X){if(h.isNone(R)||!this.view.state.stopActiveCameraController())return!1;this._cameraSetByUser=!0;X.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(W=>{X.positionAndOrientationOnly?(W.eye=R.eye,W.center=R.center,W.up=R.up):W.copyFrom(R);X.applyConstraints&&v.applyAll(this.view,W)});X.applyConstraints||(this.view.state.cameraController=
new L.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:R}));return!0};V._prepareFrame=function(){const {surface:R,canvas:X}=this.view;if(R&&X){this._windowDevicePixelRatio=window.devicePixelRatio;var W=this._devicePixelRatio,aa=Math.round(R.clientWidth*W),ba=Math.round(R.clientHeight*W);if(0!==aa&&0!==ba){if(X.width!==aa||X.height!==ba)X.width=aa,X.height=ba;if(this.view.state){const ia=this.view.state.camera;if(ia.fullWidth!==aa||ia.fullHeight!==ba||ia.pixelRatio!==W)T.copyFrom(ia),
T.pixelRatio!==W&&(this._paddingToArray(this.padding,W,S),T.padding=S),T.fullWidth=aa,T.fullHeight=ba,T.pixelRatio=W,this.view.state.camera=T;this._updateRenderState()}}}};V._updateElevation=function(R){var X=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const W=this.view.renderCoordsHelper?.getAltitude(R.eye)??0;X=X?D.surfaceElevationBelowRenderLocation(this.view,R.eye):0;R.relativeElevation=W-X};V._updateRenderState=function(){h.isSome(this.test.renderState)?this.view.state.mode=
this.test.renderState:this.view.animation?this.view.state.mode=H.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=H.RenderState.INTERACTING:(this.view.state.mode===H.RenderState.ANIMATING&&(this._cameraChangeTime=0),300>=performance.now()-this._cameraChangeTime?this.view.state.mode=H.RenderState.INTERACTING:this.view.state.mode=H.RenderState.IDLE)};V._cameraChangedHandler=function(R,X){R&&X&&R.almostEquals(X)||(this._cameraChangeTime=performance.now(),this._updateRenderState())};b._createClass(Y,
[{key:"camera",get:function(){const R=this._get("camera");if(!this.ready)return R;const X=K.internalToExternal(this.view,this.view.state.camera,Q);return X&&R&&X.equals(R)?R:X.clone()},set:function(R){this._updatePropertyBeforeReady("camera",R)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(K.externalToInternal(this.view,R),{applyConstraints:!1})||g.getLogger(this.declaredClass).error("#camera\x3d","Invalid camera",R),this.view.elevationProvider.enableElevationCache(!1))}},
{key:"contentCamera",get:function(){const R=this._get("contentCamera");if(!this.ready)return R;const X=K.internalToExternal(this.view,this.view.state.contentCamera,Q);return X&&R&&X.equals(R)?R:X.clone()},set:function(R){this._updatePropertyBeforeReady("contentCamera",R)||(R=K.externalToInternal(this.view,R),h.isNone(R)?this.view.state.contentCamera=null:(this._updateElevation(R),this.view.state.contentCamera=R))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:
this._get("center")},set:function(R){this._updatePropertyBeforeReady("center",R)||(R?this.isCompatible(R)?this.setStateCamera(this._centerToCamera(R),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():g.getLogger(this.declaredClass).error("#center\x3d","Invalid center",R):g.getLogger(this.declaredClass).error("#center\x3d","Center has an incompatible spatial reference (center: "+(R.spatialReference?R.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+
")",R):g.getLogger(this.declaredClass).error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var R=this.view;R=K.toExtent(R,R.state.camera,R.pointsOfInterest.centerOnContent.renderLocation);return h.isSome(R)?R:this._get("extent")},set:function(R){this._updatePropertyBeforeReady("extent",R)||(R?this.isCompatible(R)?this.setStateCamera(this._extentToCamera(R),{applyConstraints:!0})||g.getLogger(this.declaredClass).error("#extent\x3d",
"Invalid extent",R):g.getLogger(this.declaredClass).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(R.spatialReference?R.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",R):g.getLogger(this.declaredClass).error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const R=this._propertiesPool.get("frustum");R.renderCoordsHelper=this.view.renderCoordsHelper;R.update(this.view.state.camera);return R}},{key:"hasInitialView",
get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const R=this.view.pointsOfInterest.centerOnContent;return K.distanceToScale(this.view,R.distance,R.location.latitude)}return this._get("scale")},set:function(R){this._updatePropertyBeforeReady("scale",R)||this.setStateCamera(this._scaleToCamera(R),{applyConstraints:!0})||g.getLogger(this.declaredClass).error("#scale\x3d","Invalid scale",R)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");
var R=this.view.state.camera,X=R.padding;const W=R.pixelRatio;R=this._get("padding");const aa=Math.round(X[N.PaddingSide.TOP]/W),ba=Math.round(X[N.PaddingSide.RIGHT]/W),ia=Math.round(X[N.PaddingSide.BOTTOM]/W);X=Math.round(X[N.PaddingSide.LEFT]/W);return null!=R&&R.top===aa&&R.right===ba&&R.bottom===ia&&R.left===X?R:{top:aa,right:ba,bottom:ia,left:X}},set:function(R){this._updatePropertyBeforeReady("padding",R)||(this._paddingToArray(R,this.view.state.camera.pixelRatio,S),this.view.state.updateCamera(X=>
X.padding=S))}},{key:"screenCenter",get:function(){const R=this.padding;return e.createScreenPoint((this.view.width-(R.left+R.right))/2+R.left,(this.view.height-(R.top+R.bottom))/2+R.top)}},{key:"viewpoint",get:function(){return this.ready?P.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(R){if(!this._updatePropertyBeforeReady("viewpoint",R))if(R)if(this.isCompatible(R))this.setStateCamera(this._viewpointToCamera(R),{applyConstraints:!R.camera})||g.getLogger(this.declaredClass).error("#viewpoint\x3d",
"Invalid viewpoint",R);else{var X=h.isSome(R.camera)?R.camera.position:R.targetGeometry;X=h.isSome(X)&&X.spatialReference;g.getLogger(this.declaredClass).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(X?X.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",R)}else g.getLogger(this.declaredClass).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?K.scaleToZoom(this.view,this.scale):this._get("zoom")},
set:function(R){this._updatePropertyBeforeReady("zoom",R)||this.setStateCamera(this._zoomToCamera(R),{applyConstraints:!0})||g.getLogger(this.declaredClass).error("#zoom\x3d","Invalid zoom",R)}},{key:"maximumPixelRatio",get:function(){if(h.isSome(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let R=Infinity;const {maximumPixelRatio:X,maximumRenderResolution:W}=this.view.qualitySettings;null!=X&&(R=Math.min(R,X));null!=W&&(R=Math.min(R,W/Math.max(this.view.width,this.view.height)));
return R}},{key:"_devicePixelRatio",get:function(){return h.isNone(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}}]);return Y}(n);c.__decorate([l.property({type:r,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);c.__decorate([l.property({type:r,dependsOn:["view.state.contentCamera","ready"]})],a.ViewStateManager.prototype,"contentCamera",null);c.__decorate([l.property({type:k})],a.ViewStateManager.prototype,
"center",null);c.__decorate([l.property({type:C})],a.ViewStateManager.prototype,"extent",null);c.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);c.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);c.__decorate([l.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);c.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"scale",null);c.__decorate([l.property()],a.ViewStateManager.prototype,
"padding",null);c.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"screenCenter",null);c.__decorate([l.property({constructOnly:!0})],a.ViewStateManager.prototype,"view",void 0);c.__decorate([l.property({type:m})],a.ViewStateManager.prototype,"viewpoint",null);c.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);c.__decorate([l.property()],a.ViewStateManager.prototype,"maximumPixelRatio",null);c.__decorate([l.property()],a.ViewStateManager.prototype,
"_devicePixelRatio",null);c.__decorate([l.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);c.__decorate([l.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);c.__decorate([l.property()],a.ViewStateManager.prototype,"_maximumPixelRatioOverride",void 0);a.ViewStateManager=c.__decorate([w.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);const E="camera viewpoint extent scale center zoom".split(" "),I=[{propertyName:"camera",overrides:["viewpoint"]},
{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],M={heading:0,tilt:0},Q=new r,T=new N.Camera,S=B.create();a.INTERACTING_TIMEOUT=100;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ../camera/constraintUtils/TiltMode ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){a.ConstraintsManager=function(C){function k(x){var v=C.call(this,x)||this;v._handles=new m;v.nearFarHeuristic=y.createNearFarHeuristic(x.view.state.viewingMode,x.view.basemapTerrain,x.view.renderCoordsHelper.spatialReference);return v}b._inheritsLoose(k,C);var q=k.prototype;q.initialize=function(){this._handles.add([g.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),
g.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",x=>this._updateCameraNearFar(x.camera)),g.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),g.sync),g.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),g.sync),g.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),g.sync),g.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),
g.sync),g.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),g.sync),g.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),g.sync)]);this.view.state.isLocal&&this._handles.add(g.watch(()=>this.view.renderDataExtent,x=>this._updateLocalSurfaceDistance(x),g.initial));this._updateNearFar();this.view.state.viewingMode!==l.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();
this._set("surfaceCollisionConstraint",new B.SurfaceCollisionConstraint({view:this.view}))};q.destroy=function(){this._handles=p.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};q._clipDistanceNearFarChanged=function(){const x=this.view.constraints?.clipDistance;x&&"auto"!==x.mode&&this.view.state.updateCamera(v=>this._updateCameraNearFarManual(v,x))};q._updateNearFar=function(){this.view.state.updateCamera(x=>
this._updateCameraNearFar(x))};q._updateCameraNearFar=function(x){const v=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(v?v.mode:"auto")?this._updateCameraNearFarManual(x,v):this._updateCameraNearFarAuto(x,v)};q._updateCameraNearFarAuto=function(x,v){this.nearFarHeuristic.compute(x.eye,x.center,this.view.renderDataExtent,t.surfaceElevationBelowRenderLocation(this.view,x.eye),x);v&&v.autoUpdate(x.near,x.far)};q._updateCameraNearFarManual=function(x,v){v&&(x.near=v.near,x.far=
v.far)};q._updateCollision=function(){var x=this.view.map?.ground?.navigationConstraint?.type;x=x?"stay-above"===x:!0;const v=this.view.state.constraints.collision;x!==v.enabled&&((v.enabled=x)&&this._reapplyConstraints(w.ConstraintTypes.COLLISION),(x=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==x.mode||this._updateTiltAuto())};q._updateAltitude=function(){const x=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=x&&this.view.state.viewingMode!==
l.ViewingMode.Local?{min:x.min,max:x.max}:null;this._reapplyConstraints()};q._updateTiltMax=function(){const x=this.view.constraints&&this.view.constraints.tilt;x&&"auto"!==x.mode&&(this._updateTiltManual(x),this._reapplyConstraints())};q._updateTilt=function(){const x=this.view.constraints&&this.view.constraints.tilt;"manual"===(x?x.mode:"auto")?this._updateTiltManual(x):this._updateTiltAuto();this._reapplyConstraints()};q._updateTiltManual=function(x){const v=this.view.state.constraints;v.tilt=
v.createConstantMaxTilt(n.deg2rad(x.max))};q._updateTiltAuto=function(){const x=this.view.state.constraints;x.tilt=x.createDefaultTilt();this._updateTiltAutoMax()};q._updateTiltAutoMax=function(){const x=this.view.constraints&&this.view.constraints.tilt;if(x&&"auto"===x.mode){var v=this.view.state.constraints;v.tilt&&(v=v.tilt(this.view.state.camera.distance).max,x.autoUpdate(n.rad2deg(v)))}};q._updateLocalSurfaceDistance=function(x){if(!p.isNone(x)){var v=Math.max(x.width,x.height);0>=v||(x.hasZ&&
(v=Math.max(v,x.zmax-x.zmin)),x=this.view.state,v=3*v/Math.atan(x.camera.fov/2),v!==x.constraints.distance&&(x.constraints.distance=v))}};q._reapplyConstraints=function(x=w.ConstraintTypes.ALL){this.view.state.updateCamera(v=>A.applyAll(this.view,v,{selection:x,interactionType:u.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE}))};return k}(r);c.__decorate([h.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",
void 0);c.__decorate([h.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([e.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid ../../ViewingMode".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(t,w,u,z){u=2/u;t/w>u?(z.far=t,z.near=z.far/w):(z.near=u,z.far=z.near*w);return z}let f=function(){function t(w,u){this._elevationProvider=w;this._referenceEllipsoid=g.getReferenceEllipsoid(u);this._unitInMeters=r.getMetersPerUnitForSR(u,this._referenceEllipsoid.metersPerDegree)}t.prototype.compute=function(w,u,z,y,B){B||(B={near:0,far:0});var C=w[2]*this._unitInMeters,k=C;y=C-y;var q=this._elevationProvider?.visibleElevationBounds;q&&(C=0<=y?k-this._unitInMeters*
q.min:this._unitInMeters*q.max-k);z=c.isSome(z)?z:new p({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});k=Math.max(z.xmax-z.xmin,z.ymax-z.ymin,4*Math.max(z.xmax-z.xmin,z.ymax-z.ymin));m.subtract(A,u,w);l[0]=0<A[0]?z.xmax:z.xmin;l[1]=0<A[1]?z.ymax:z.ymin;l[2]=0<A[2]?k/2:-k/2;m.subtract(l,l,w);m.normalize(A,A);w=1.1*m.dot(l,A)*this._unitInMeters;u=Math.sqrt(C*(C+2*this._referenceEllipsoid.radius));z=Math.max(z.xmax-z.xmin,z.ymax-z.ymin);q=1E-4*z*this._unitInMeters;C=b.clamp((C-q)/(.001*z*this._unitInMeters-
q),0,1);C=Math.min(b.lerp(u,w,C*C*C),u);C*=Math.max(Math.log(Math.abs(y)),1);C=Math.min(C,Math.max(34064E4,k));C/=this._unitInMeters;return d(C,2E4,this._unitInMeters,B)};return t}(),e=function(){function t(w){this._referenceEllipsoid=g.getReferenceEllipsoid(w)}t.prototype.compute=function(w,u,z,y,B){B||(B={near:0,far:0});w=m.length(w)-this._referenceEllipsoid.radius;w=Math.max(Math.abs(w-y),Math.abs(w));y=Math.sqrt(w*(w+2*(this._referenceEllipsoid.radius+Math.min(0,y))));w=b.clamp(2E4-(Math.log(w)-
7.983)/9.011*19E3,1E3,2E4);return d(1.2*y,w,1,B)};return t}();const l=n.create(),A=n.create();a.createNearFarHeuristic=function(t,w,u){return t===h.ViewingMode.Global?new e(u):new f(w,u)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.SurfaceCollisionConstraint=function(l){function A(w){w=l.call(this,w)||this;w._handles=new m;return w}b._inheritsLoose(A,l);var t=A.prototype;t.initialize=function(){this._handles.add(this.view.basemapTerrain.on("elevation-change",w=>this._handleElevationChangeEvent(w)))};t.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};t._handleElevationChangeEvent=function(w){if(!this.view.state.cameraController){var u=this.view.state.camera;n.isSome(w.spatialReference)&&
f.eyeWithinExtent(this.view,u,w.extent,w.spatialReference)&&this._applyToCurrentCamera()}};t._applyToCurrentCamera=function(){this.view.state.updateCamera(w=>e.applySurfaceCollisionConstraint(this.view,w,e.Mode.EYE_AND_CENTER))};return A}(r);c.__decorate([p.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([d.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,r,m){function n(g,h,d){g.origin=h;g.endpoint=d;c.direction(g.direction,h,d)}let p=function(){function g(d){this.renderCoordsHelper=d;this.frustum=m.create();this._points=m.createPoints();this.lines=Array(12);this._origin=r.create();
this._direction=r.create();this._altitude=null;for(d=0;12>d;d++)this.lines[d]={origin:null,direction:r.create(),endpoint:null}}var h=g.prototype;h.update=function(d){m.fromMatrix(d.viewMatrix,d.projectionMatrix,this.frustum,this._points);c.copy(this._origin,d.eye);c.copy(this._direction,d.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};h.updatePoints=function(d){for(let f=0;f<this._points.length;f++)c.copy(this._points[f],d[f]);m.computePlanes(this.frustum,
this._points);this._updateLines()};h.intersectsSphere=function(d){return m.intersectsSphere(this.frustum,d)};h.intersectsRay=function(d){return m.intersectsRay(this.frustum,d)};h.intersectsLineSegment=function(d,f){return m.intersectsLineSegment(this.frustum,d,f)};h.intersectsPoint=function(d){return m.intersectsPoint(this.frustum,d)};h._updateLines=function(){const d=this._points;for(let f=0;4>f;f++){const e=f+4;n(this.lines[f],d[f],d[e]);n(this.lines[f+4],d[f],3===f?d[0]:d[f+1]);n(this.lines[f+
8],d[e],3===f?d[4]:d[e+1])}};b._createClass(g,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return g}();p.planePointIndices=m.planePointIndices;p.nearFarLineIndices=[[m.PointIndex.NEAR_BOTTOM_LEFT,m.PointIndex.FAR_BOTTOM_LEFT],[m.PointIndex.NEAR_BOTTOM_RIGHT,m.PointIndex.FAR_BOTTOM_RIGHT],
[m.PointIndex.NEAR_TOP_RIGHT,m.PointIndex.FAR_TOP_RIGHT],[m.PointIndex.NEAR_TOP_LEFT,m.PointIndex.FAR_TOP_LEFT]];a.Frustum=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){let w=function(){function u(y,B,C){this.target=y;this.options=B;this.view=C;this.state="pending";this._animationController=this._abortController=null;this._promise=new Promise((k,q)=>{this._resolveCallback=k;this._rejectCallback=q;k=new AbortController;if(n.isSome(this.options.signal))p.onAbort(this.options.signal,()=>{this.abort()});this._abortController=k;this.waitForReady()})}var z=u.prototype;z.then=function(y,B){return this._promise.then(y,B)};z.catch=
function(y){return this._promise.catch(y)};z.resolve=function(y){this.state="finished";return this._resolveCallback(y)};z.reject=function(y){this.state="finished";return this._rejectCallback(y)};z.abort=function(y=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(p.createAbortError());break;case "wait-for-animation-finish":!y&&n.isSome(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&
this._animationController.stopController(),this.reject(p.createAbortError())}};z.waitForReady=function(){var y=b._asyncToGenerator(function*(){this.state="wait-for-ready";if(!this.view.ready)try{yield g.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(B){return this.reject(B)}this.createViewPoint()});return function(){return y.apply(this,arguments)}}();z.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?
this._getAnimationController():null,t.create(this.view,this.target,this._abortController.signal).then(y=>{"finished"!==this.state&&(y=this._getCameraFromViewpoint(y),n.isNone(y)||(this.options.animate?n.isNone(this._animationController)||this.startAnimation(y,this._animationController):(this.view.stateManager.setStateCamera(y.camera,{applyConstraints:!y.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},y=>{this.reject(y)}))};z._getCameraFromViewpoint=
function(y){const B=!!(this.target instanceof r&&this.target.camera||this.target instanceof c);var C=y.camera;if(n.isNone(C))return null;if(!this.view.stateManager.isCompatible(C))return y=(y=C.position)&&y.spatialReference,this.reject(new m("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${y?y.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:C})),null;C=A.externalToInternal(this.view,C);return n.isNone(C)?(this.reject(new m("GotoAnimation:invalid-camera",
"Resulting camera is invalid")),null):{viewpoint:y,camera:C,isFullySpecified:B}};z.startAnimation=function(y,B){this.state="wait-for-animation-finish";const C=B.viewAnimation;if(n.isNone(C))this.reject(new m("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{C.update(y.viewpoint,"running");if(!B.active||n.isNone(B.viewAnimation)||B.viewAnimation.target!==y.viewpoint||this.view.state.cameraController!==B)return this.abort();if(y.isFullySpecified){var k=new l.SurfaceCollisionCorrectionController({view:this.view,
desiredCamera:y.camera});d.applySurfaceCollisionConstraint(this.view,y.camera,d.Mode.EYE_AND_CENTER)}else h.applyAll(this.view,y.camera);B.begin(y.camera,this.options);var q=x=>{if(!n.isNone(this.view.state))switch(B.state){case f.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case f.State.Ready:case f.State.Rejected:case f.State.Running:case f.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(x)}}};
C.when(()=>{const x=this.view.state.cameraController;k&&(x&&x.active?x instanceof e.PointToPointAnimationController&&n.isSome(x.viewAnimation)&&x.viewAnimation.target===y.viewpoint&&(this.view.state.cameraController=k):n.isSome(B.viewAnimation)&&B.viewAnimation.target===y.viewpoint&&"finished"===B.state&&(this.view.state.cameraController=k))},x=>q(x));B.asyncResult={resolve:()=>q(),reject:x=>q(x)}}};z._getAnimationController=function(){let y;var B=null;B=this.view.state.cameraController;B instanceof
e.PointToPointAnimationController&&(B.updateStateFromViewAnimation(),B.active&&(y=B,B=y.viewAnimation));return null!=y||(y=new e.PointToPointAnimationController({view:this.view,mode:"animation"}),B=y.viewAnimation,this.view.state.switchCameraController(y))?y:(n.isSome(B)&&B.stop(),this.reject(new m("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return u}();a.GoToOperation=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.SurfaceCollisionCorrectionController=function(l){function A(w){w=l.call(this,w)||this;w._handles=new r;return w}b._inheritsLoose(A,l);var t=A.prototype;t.onControllerStart=function(){this.state=e.State.Running;this._handles.add(this.view.basemapTerrain.on("elevation-change",w=>this._handleElevationChangeEvent(w)));this._applyCorrection()};t.onControllerEnd=function(){this._handles.removeAll()};t.stepController=function(){};t._handleElevationChangeEvent=function(w){m.isSome(w.spatialReference)&&
!d.eyeWithinExtent(this.view,this.desiredCamera,w.extent,w.spatialReference)||this._applyCorrection()};t._applyCorrection=function(){this.view.state.updateCamera(w=>{w.copyViewFrom(this.desiredCamera);f.applySurfaceCollisionConstraint(this.view,w,f.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=e.State.Stopped)})};b._createClass(A,[{key:"desiredCamera",set:function(w){this._set("desiredCamera",w.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return A}(e.CameraController);c.__decorate([n.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([h.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){function k(W){return"global"===W.viewingMode?z.cameraUtilsSpherical:u.cameraUtilsPlanar}function q(W,aa,ba){const ia=W.state.camera,ma=ia.width/2/ia.pixelRatio;W.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=ba&&(aa*=Math.cos(n.deg2rad(ba)));aa/=W.renderCoordsHelper.unitInMeters;return ma/(96*39.37/aa)/Math.tan(ia.fovX/2)}function x(W,aa,ba){const ia=W.state.camera;aa=96*39.37/(ia.width/2/ia.pixelRatio/(aa*Math.tan(ia.fovX/2)));W.renderCoordsHelper.viewingMode===
t.ViewingMode.Global&&(aa/=Math.cos(n.deg2rad(ba)));return aa*=W.renderCoordsHelper.unitInMeters}function v(W,aa,ba,ia,ma,ha){if(I(ha)){const ka=new X(ha.signal);P(W,ia.heading,ia.tilt,aa,ba,ma,ka);ka.resolver.promise.then(Z=>{Z=E(W,Z,ia.fov);if(p.isNone(Z))ha.resolver.reject();else return ha.resolver.resolve(Z)},Z=>ha.resolver.reject(Z))}else return aa=P(W,ia.heading,ia.tilt,aa,ba,ma),E(W,aa,ia.fov,ha)}function D(W,aa,ba,ia,ma){return k(W).directionToHeadingTilt(aa,ba,ia,ma)}function F(W,aa){return!!(W.basemapTerrain&&
W.renderCoordsHelper.fromRenderCoords(aa,U,W.spatialReference)&&p.unwrapOr(B.getElevationAtPoint(W.elevationProvider,U),0)>U.z-1)}function G(W,aa,ba){return J.apply(this,arguments)}function J(){J=b._asyncToGenerator(function*(W,aa,ba){if(!W.renderCoordsHelper.fromRenderCoords(aa,U,W.spatialReference))return!1;W=yield W.elevationProvider.queryElevation(U.x,U.y,U.z,U.spatialReference,"ground",ba);return p.unwrapOr(W,0)>U.z-1});return J.apply(this,arguments)}function L(W,aa,ba){return K.apply(this,arguments)}
function K(){K=b._asyncToGenerator(function*(W,aa,ba){const ia=d.create();aa?aa instanceof f?(e.projectPointToVector(aa,ia,W.renderSpatialReference),null==aa.z&&null!=W.basemapTerrain&&(aa=yield W.elevationProvider.queryElevation(aa.x,aa.y,aa.z,aa.spatialReference,"ground",ba),p.isSome(aa)&&W.renderCoordsHelper.setAltitude(ia,aa))):h.copy(ia,aa):h.copy(ia,W.state.camera.center);return ia});return K.apply(this,arguments)}function O(W,aa){const ba=d.create();aa&&aa instanceof f?(e.projectPointToVector(aa,
ba,W.renderSpatialReference),null==aa.z&&null!=W.basemapTerrain&&(aa=B.getElevationAtPoint(W.elevationProvider,aa),p.isSome(aa)&&W.renderCoordsHelper.setAltitude(ba,aa))):aa?h.copy(ba,aa):h.copy(ba,W.state.camera.center);return ba}function P(W,aa,ba,ia,ma,ha,ka){const Z=ia&&ia instanceof f?ia:null;if(I(ka))return L(W,ia,ka.signal).then(ca=>{N(W,aa,ba,Z,ca,ma,ha,ka)},ca=>ka.resolver.reject(ca)),null;ia=O(W,ia);return N(W,aa,ba,Z,ia,ma,ha,ka)}function N(W,aa,ba,ia,ma,ha,ka,Z){if(p.isNone(ia)&&(ia=e.projectVectorToPoint(ma,
W.renderSpatialReference,W.spatialReference||A.WGS84),p.isNone(ia)))return null;ha=Math.max(ha,W.state.constraints.minimumPoiDistance);var ca=H(W,aa,ba,ma,ha,ka);const fa=k(W).eyeForCenterWithHeadingTilt,ea=fa(ma,ha,ca.heading,ca.tilt);if(ka===a.OrientationMode.ADJUST&&"global"===W.viewingMode&&0<ba){const da=()=>{var la=ha,oa=ha;var ra=W.state.constraints.tilt(oa);oa=k(W).eyeTiltToLookAtTilt(ba,ma,oa);oa=Math.min(oa,.5*Math.PI);ra=ra.min*(1-.7)+.7*oa;la=k(W).lookAtTiltToEyeTilt(ra,ma,la);ka=1>ba-
la?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return N(W,aa,la,ia,ma,ha,ka,Z)};ca=W.map.ground.navigationConstraint;if(!ca||"stay-above"===ca.type){if(F(W,ea.eye))return da();if(I(Z))return G(W,ea.eye,Z.signal).then(la=>{if(la)return da();Z.resolver.resolve({eye:ea.eye,up:ea.up,center:d.clone(ma),heading:ea.heading,tilt:ea.tilt});return null}),null}}ca=!Z||I(Z)?{center:d.create(),eye:d.create(),up:d.create(),tilt:0,heading:0}:Z;ca.eye=ea.eye;ca.up=ea.up;ca.center=d.clone(ma);ca.heading=ea.heading;
ca.tilt=ea.tilt;I(Z)&&Z.resolver.resolve(ca);return ca}function H(W,aa,ba,ia,ma,ha){var ka=0;if(ha=ha===a.OrientationMode.ADJUST)if(ka=W.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(ma/ka)/Math.LN2)ha=!0;else{var Z=W.renderSpatialReference,ca=W.spatialReference||A.WGS84;ha=e.projectVectorToPoint(ia,Z,ca);Z=e.projectVectorToPoint(W.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,Z,ca);p.isNone(ha)||p.isNone(Z)?ha=!1:(ka*=Math.tan(.5*W.state.camera.fov),ha=5<Z.distance(ha)/ka)}ha?
(aa=0,ha=W.state.constraints.tilt(ma),ha.max=Math.min(ha.max,.5*Math.PI),ha=ha.min*(1-.7)+.7*ha.max,ba=k(W).eyeTiltToLookAtTilt(ba,ia,ma),ka=Math.min(ba,ha)):ka=k(W).eyeTiltToLookAtTilt(ba,ia,ma);ba=ka=W.state.constraints.clampTilt(ma,ka);ba=k(W).lookAtTiltToEyeTilt(ba,ia,ma);return{heading:aa,tilt:ba}}function E(W,aa,ba,ia){if(p.isNone(aa))return null;W=e.projectVectorToPoint(aa.eye,W.renderSpatialReference,W.spatialReference||A.WGS84);return p.isNone(W)?null:p.isSome(ia)?(ia.position=W,ia.heading=
aa.heading,ia.tilt=aa.tilt,ia.fov=ba,ia):new c(W,aa.heading,aa.tilt,ba)}function I(W){return W&&"resolver"in W}const M=m.getLogger("esri.views.3d.support.cameraUtils"),Q=d.create(),T=d.create(),S={heading:0,tilt:0},U=new f,Y=new r.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),V=new r.Cyclical(-180,180);a.OrientationMode=void 0;(function(W){W[W.LOCKED=0]="LOCKED";W[W.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const R=d.create();let X=function(W){this.signal=W;this.resolver=
g.createResolver()};a.AsyncContext=X;a.computeScale=function(W,aa,ba){const ia=W.renderSpatialReference;aa||(aa=W.state.camera);var ma=A.WGS84;aa instanceof c?(ma=aa.position.latitude,e.projectPointToVector(aa.position,Q,ia),e.projectPointToVector(ba,T,ia),aa=h.distance(Q,T)):(e.projectVectorToVector(aa.center,ia,T,ma),ma=T[1],aa=aa.distance);return x(W,aa,ma)};a.directionToHeadingTilt=D;a.distanceToScale=x;a.externalToInternal=function(W,aa){if(p.isNone(aa))return null;var ba=W.renderSpatialReference;
const ia=k(W).headingTiltToDirectionUp,ma=d.create();if(!e.projectPointToVector(aa.position,ma,ba))return null;ba=ia(ma,aa.heading,aa.tilt);h.scale(ba.direction,ba.direction,W.state.camera.distance);h.add(ba.direction,ba.direction,ma);W=w.cameraOnContentAlongViewDirection(W,ma,ba.direction,ba.up);W.fov=n.deg2rad(aa.fov);return W};a.fromCenterDistance=v;a.fromCenterScale=function(W,aa,ba,ia,ma,ha){ba=q(W,ba,aa.latitude);return v(W,aa,ba,ia,ma,ha)};a.fromExtent=function(W,aa,ba,ia,ma,ha=null){var ka=
null!=aa.zmax&&null!=aa.zmin;let Z;if(W.state.isGlobal){if(!C.isSpatialReferenceSupported(aa.spatialReference,t.ViewingMode.Global))return I(ha)&&ha.resolver.reject(),null;var ca=new f(aa.xmin,aa.ymin,aa.spatialReference);const da=new f(aa.xmax,aa.ymax,aa.spatialReference),la=aa.spatialReference.isGeographic?V:Y;var fa=new f({x:la.center(ca.x,da.x),y:(da.y+ca.y)/2,z:ka?(aa.zmax+aa.zmin)/2:null,spatialReference:aa.spatialReference});const oa=l.getReferenceEllipsoid(aa.spatialReference);var ea=y.getGreatCircleSpanAt(fa,
ca,da);Z=ea.lon;ea=ea.lat;la.diff(ca.x,da.x)>la.range/2&&(Z+=oa.halfCircumference);Z=Math.min(Z,oa.halfCircumference);ea=Math.min(ea,oa.halfCircumference)}else fa=p.unwrapOr(W.renderSpatialReference,aa.spatialReference),fa.equals(aa.spatialReference)||(aa=e.project(aa,fa)),Z=aa.xmax-aa.xmin,ea=aa.ymax-aa.ymin,fa=new f({x:aa.xmin+.5*Z,y:aa.ymin+.5*ea,z:ka?(aa.zmax+aa.zmin)/2:null,spatialReference:fa});ca=W.state.camera;aa=Math.max(1/Math.tan(ca.fovX/2)*Z*.5,1/Math.tan(ca.fovY/2)*ea*.5,1/Math.tan(ca.fov/
2)*(ka?aa.zmax-aa.zmin:0)*.5)/1;if(I(ha))ka=new X(ha.signal),P(W,ba,ia,fa,aa,ma,ka),ka.resolver.promise.then(da=>{da=E(W,da,W.camera.fov);if(p.isNone(da))ha.resolver.reject();else return ha.resolver.resolve(da)},da=>ha.resolver.reject(da));else return ba=P(W,ba,ia,fa,aa,ma),E(W,ba,W.camera.fov,ha)};a.getObserverForPointAtDistance=P;a.headingTiltToDirectionUp=function(W,aa,ba,ia,ma){return k(W).headingTiltToDirectionUp(aa,ba,ia,ma)};a.internalToExternal=function(W,aa,ba){const ia=W.renderSpatialReference,
ma=D(W,aa.eye,aa.viewForward,aa.up,S);W=W.spatialReference||A.WGS84;e.projectVectorToVector(aa.eye,ia,R,W)||(W=A.WGS84,e.projectVectorToVector(aa.eye,ia,R,W));if(p.isNone(ba))return new c(new f(R,W),ma.heading,ma.tilt,n.rad2deg(aa.fov));ba.position.x=R[0];ba.position.y=R[1];ba.position.z=R[2];ba.position.spatialReference=W;ba.heading=ma.heading;ba.tilt=ma.tilt;ba.fov=n.rad2deg(aa.fov);return ba};a.observerToCamera=E;a.scaleToDistance=q;a.scaleToZoom=function(W,aa){if(W=W.basemapTerrain?.tilingScheme)return W.levelAtScale(aa);
M.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(W,aa,ba){const ia=e.projectVectorToPoint(ba,W.renderSpatialReference,W.spatialReference||A.WGS84);if(p.isNone(ia))return null;var ma=Math.tan(aa.fovX/2),ha=Math.tan(aa.fovY/2);aa=h.dist(aa.eye,ba);ma*=2*aa;ha*=2*aa;return"global"===W.viewingMode?z.toExtent(W,ia,ma,ha):u.toExtent(W,ia,ma,ha)};a.zoomToScale=function(W,aa){if(W=W.basemapTerrain?.tilingScheme)return W.scaleAtLevel(aa);M.error("#zoomToScale()",
"Cannot compute scale from zoom without a tiling scheme")};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,b,c,r,m,n,p,g,h){function d(C,k,q,x=h.createDirectionUp()){const {direction:v,up:D}=x;c.fromZRotation(z,-b.deg2rad(k));c.rotateX(z,z,b.deg2rad(q));
m.transformMat4(v,u,z);m.scale(v,v,-1);m.transformMat4(D,w,z);return x}function f(C,k,q,x){return h.directionToHeadingTilt(k,q,x,u,w)}function e(C,k,q,x){const v=d(C,q,x),D=n.create();m.scale(D,v.direction,-k);m.add(D,D,C);return{up:v.up,eye:D,heading:q,tilt:x}}function l(C){return b.rad2deg(C)}function A(C){return b.deg2rad(C)}function t(C,k,q,x,v){const D=C.renderSpatialReference;C=C.map&&C.spatialReference||k.spatialReference;g.projectPointToVector(k,y,D);g.projectPointToVector(k,B,D);y[0]-=q/
2;B[0]+=q/2;y[1]-=x/2;B[1]+=x/2;g.projectVectorToVector(y,D,y,C);g.projectVectorToVector(B,D,B,C);v?(v.xmin=y[0],v.ymin=y[1],v.xmax=B[0],v.ymax=B[1],v.spatialReference=C):v=new p(y[0],y[1],B[0],B[1],C);return v}const w=n.fromValues(0,1,0),u=n.fromValues(0,0,1),z=r.create(),y=n.create(),B=n.create();r=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:d,directionToHeadingTilt:f,eyeForCenterWithHeadingTilt:e,lookAtTiltToEyeTilt:l,eyeTiltToLookAtTilt:A,toExtent:t},Symbol.toStringTag,
{value:"Module"}));a.cameraUtilsPlanar=r;a.directionToHeadingTilt=f;a.eyeForCenterWithHeadingTilt=e;a.eyeTiltToLookAtTilt=A;a.headingTiltToDirectionUp=d;a.lookAtTiltToEyeTilt=l;a.toExtent=t})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,r){const m=r.create(),n=r.create();a.createDirectionUp=function(){return{direction:r.create(),up:r.create()}};a.directionToHeadingTilt=function(p,
g,h,d,f){let e=c.normalize(m,p),l=c.dot(e,d);const A=0<l;l=Math.abs(l);.99<l&&(l=Math.abs(c.dot(g,d)),.99>l?(c.copy(e,g),A&&c.scale(e,e,-1)):e=null);g=0;e&&(c.scale(n,d,c.dot(d,e)),c.subtract(e,e,n),g=c.dot(e,f)/(c.length(e)*c.length(f)),c.cross(n,e,f),g=(0<c.dot(n,d)?1:-1)*b.rad2deg(b.acosClamped(g)));p=b.rad2deg(b.acosClamped(-c.dot(d,p)/c.length(p)));if(!h)return{heading:g,tilt:p};h.heading=g;h.tilt=p;return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(G,J,L,K=e.createDirectionUp()){n.cross(D,G,k);0===n.dot(D,D)&&n.cross(D,G,q);r.fromRotation(v,-c.deg2rad(J),G);r.rotate(v,v,
-c.deg2rad(L),D);const {up:O,direction:P}=K;n.cross(O,D,G);n.normalize(O,O);n.transformMat4(O,O,v);n.normalize(P,G);n.negate(P,P);n.transformMat4(P,P,v);return K}function t(G,J,L,K){const O=D,P=F;n.normalize(O,G);n.cross(F,O,k);0===n.dot(F,F)&&n.cross(F,O,q);n.cross(P,F,O);return e.directionToHeadingTilt(J,L,K,O,P)}function w(G,J,L,K){const O={eye:p.create(),up:null,tilt:K,heading:L},P=D;P[0]=G[0];P[1]=G[2];P[2]=-G[1];L=c.deg2rad(L);var N=c.deg2rad(K);K=Math.sin(L);L=Math.cos(L);var H=Math.sin(N),
E=Math.cos(N);const I=n.length(P);if(1E-8>Math.abs(N))N=J+I;else{var M=I/H,Q=c.asinClamped(J/M);N=M*Math.sin(Math.PI-N-Q)}E*=J;M=J*J*H*H;Q=L*L*M;const T=N-E,S=T*T;var U=Q*(Q+S-P[1]*P[1]);if(0>U)return n.scale(O.eye,P,N/I),O.tilt=0,O;var Y=Math.sqrt(U);const V=P[1]*T;U=Q+S;Y=0<L?-Y+V:Y+V;if(1E-8>Math.abs(U))return 1E-8>I?(O.eye[0]=0,O.eye[1]=0,O.eye[2]=J):n.scale(O.eye,P,N/I),O.tilt=0,u(O.eye),z(O,G);O.eye[1]=Y/U;J*=H;Y=O.eye[1]*O.eye[1];H=1-Y;U=Math.sqrt(H);M=Q*Y+K*K*M-2*L*J*O.eye[1]*U*T+H*S;if(1E-8>
Math.abs(M))return n.scale(O.eye,P,N/I),O.tilt=0,u(O.eye),z(O,G);O.eye[0]=(H*(N*P[0]-E*P[0])-J*U*(P[0]*O.eye[1]*L+P[2]*K))/M;O.eye[2]=(H*(N*P[2]-E*P[2])-J*U*(P[2]*O.eye[1]*L-P[0]*K))/M;n.scale(O.eye,O.eye,N);u(O.eye);return z(O,G)}function u(G){const J=G[1];G[1]=-G[2];G[2]=J}function z(G,J){J=A(J,G.heading,G.tilt);G.up=J.up;return G}function y(G,J,L){J=n.length(J);L=c.asinClamped(L/(Math.sqrt(L*L+J*J-2*L*J*Math.cos(Math.PI-G))/Math.sin(G)));return c.rad2deg(G-L)}function B(G,J,L){G=c.deg2rad(G);J=
n.length(J);return c.asinClamped(L/(J/Math.sin(G)))+G}function C(G,J,L,K,O){function P(I){const M=Math.PI/2;I=b.cyclical2PI.normalize(I,-M);I>M&&(I=Math.PI-I);return I}var N=J.latitude;var H=h.getReferenceEllipsoid(G.spatialReference).radius;J=J.longitude;var E=l.getLonDeltaForDistance(N,L,H)/2;L=J-E;J+=E;N=c.deg2rad(N);N=(1+Math.sin(N))/(1-Math.sin(N));E=(N+1)*Math.tan(K/H/2);N=1.5*Math.PI-2*Math.atan(.5*(E+Math.sqrt(4*N+E*E)));K=N+K/H;N=P(N);K=P(K);K<N&&(H=K,K=N,N=H);N=Math.max(c.rad2deg(N),-90);
K=Math.min(c.rad2deg(K),90);J=x.monotonic(L,J);180<J-L&&(H=(J-L-180)/2,L+=H,J-=H);H=G.spatialReference&&G.spatialReference.isGeographic?G.spatialReference:d.WGS84;O?(O.xmin=L,O.ymin=N,O.xmax=J,O.ymax=K,O.spatialReference=H):O=new g(L,N,J,K,H);G.spatialReference&&G.spatialReference.isWebMercator&&f.geographicToWebMercator(O,!1,O);return O}const k=p.fromValues(0,0,1),q=n.normalize(p.create(),p.fromValues(1,1,1)),x=new b.Cyclical(-180,180),v=m.create(),D=p.create(),F=p.create();m=Object.freeze(Object.defineProperty({__proto__:null,
headingTiltToDirectionUp:A,directionToHeadingTilt:t,eyeForCenterWithHeadingTilt:w,lookAtTiltToEyeTilt:y,eyeTiltToLookAtTilt:B,toExtent:C},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=m;a.directionToHeadingTilt=t;a.eyeForCenterWithHeadingTilt=w;a.eyeTiltToLookAtTilt=B;a.headingTiltToDirectionUp=A;a.lookAtTiltToEyeTilt=y;a.toExtent=C})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,
b,c){function r(m){return"array"in m}a.SamplePosition=function(m,n=null,p=0){this.array=m;this.spatialReference=n;this.offset=p};a.getElevationAtPoint=function(m,n,p="ground"){if(c.isDehydratedPoint(n))return m.getElevation(n.x,n.y,n.z||0,n.spatialReference,p);if(r(n)){let g=n.offset;return m.getElevation(n.array[g++],n.array[g++],n.array[g]||0,b.unwrapOr(n.spatialReference,m.spatialReference),p)}return m.getElevation(n[0],n[1],n[2]||0,m.spatialReference,p)};a.isSamplePosition=r;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,c){a.isSpatialReferenceSupported=function(r,m){return null==
r?!1:null==m?!0:m===c.ViewingMode.Local?r.isGeographic?r.isWGS84||r.wkid===b.SupportedGCSWkids.CGCS2000:!0:r.isWebMercator||r.isWGS84||r.wkid===b.SupportedGCSWkids.CGCS2000||r.wkid===b.SupportedGCSWkids.GCSMARS2000||r.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||r.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){function K(pa){return 360-h.cyclicalDegrees.normalize(pa)}function O(pa){return h.cyclicalDegrees.normalize(360-pa)}function P(pa){f.isSome(pa)&&pa.resolver&&pa.resolver.reject();return null}function N(pa,Ba,Ha,wa=null){if(!Ba)return P(wa);var ya=pa.spatialReference||G.WGS84;if(f.isSome(Ba.camera)){pa=q.project(Ba.camera.position,ya);if(f.isNone(pa))return P(wa);Ba=Ba.camera.clone();Ba.position=pa;pa=Ba;f.isSome(wa)&&wa.resolver&&
wa.resolver.resolve(pa);return pa}if(f.isNone(Ba.targetGeometry))return P(wa);var Na=Ba.get("targetGeometry.spatialReference");if(Na&&!q.canProject(Na,ya))return P(wa);ya=v.internalToExternal(pa,pa.state.camera);Na=v.OrientationMode.ADJUST;null!=Ba.rotation&&(ya.heading=K(Ba.rotation),Na=v.OrientationMode.LOCKED);null!=Ha&&(ya.tilt=Ha);if("point"===Ba.targetGeometry.type){const Ra=Ba.targetGeometry;Ha=Ba.targetGeometry.clone();Ba=null!=Ba.scale?v.scaleToDistance(pa,Ba.scale,Ra.latitude):pa.state.camera.distance;
return v.fromCenterDistance(pa,Ha,Ba,ya,Na,wa)}return v.fromExtent(pa,Ba.targetGeometry.extent,ya.heading,ya.tilt,Na,wa)}function H(){H=b._asyncToGenerator(function*(pa,Ba,Ha){if(Ba&&pa.spatialReference){var wa={target:null};if("declaredClass"in Ba||Array.isArray(Ba))wa.target=Ba;else{for(var ya in Ba)wa[ya]=Ba[ya];Ba.center&&!wa.target&&(wa.target=Ba.center)}Ba=wa}else Ba=null;if(!Ba)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");wa=new c({fov:pa.camera.fov});
ya=new n({camera:wa});if(Ba.target instanceof n)return pa=yield V(pa,Ba.target,Ba,Ha,ya),ca(pa);if(Ba.target instanceof c)return ca(X(pa,Ba.target,ya));var Na=null!=Ba.scale||null!=Ba.zoom;if(Ba.target instanceof J){var Ra=Ba.target.xmin===Ba.target.xmax||Ba.target.ymin===Ba.target.ymax;return Na||Ra?ca(yield W(pa,Ba,Ba.target.center,wa,Ha,ya)):ca(yield ma(pa,Ba,Ba.target,wa,Ha,ya))}Ra={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]};var Sa=Na?k.getResolutionInMetersForScale(E(pa,Ba)):void 0;
yield U(pa,Ba.target,Sa,Ra);if(isFinite(Ra.boundingBox[0])){y.center(Ra.boundingBox,fa);va.x=fa[0];va.y=fa[1];va.z=fa[2];va.spatialReference=pa.spatialReference;isFinite(va.z)&&Ra.hasZ?Sa=y.isPoint(Ra.boundingBox):(va.z=void 0,Sa=B.isPoint(y.toRect(Ra.boundingBox,oa)));if(Na||Sa)return ca(yield W(pa,Ba,va,wa,Ha,ya));Na=Ra.screenSpaceObjects;if(Na.length){Sa=Number.NEGATIVE_INFINITY;for(let ja=0;ja<Na.length;ja++){const Ta=Na[ja].screenSpaceBoundingRect;Sa=Math.max(Sa,Math.abs(Ta[0]),Math.abs(Ta[1]),
Math.abs(Ta[2]),Math.abs(Ta[3]))}Na=.66-Sa/Math.min(pa.width,pa.height)*2}else Na=.66;return ca(yield ka(pa,Ba,va,Ra.boundingBox,Na,wa,Ha,ya))}return Ba.position?(Ha=x.cameraOnContentAlongViewDirection(pa),w.copy(ra,Ha.viewForward),v.directionToHeadingTilt(pa,Ha.eye,ra,Ha.up,za),wa.position=new F(Ba.position),wa.heading=null!=Ba.heading?Ba.heading:za.heading,wa.tilt=null!=Ba.tilt?Ba.tilt:za.tilt,pa=M(pa,null,wa,ya),ca(pa)):ca(yield ba(pa,Ba,wa,Ha,ya))});return H.apply(this,arguments)}function E(pa,
Ba){return null==Ba.scale&&null!=Ba.zoom?v.zoomToScale(pa,Ba.zoom):Ba.scale}function I(pa,Ba){let Ha=!1;null!=Ba.heading?(pa.heading=Ba.heading,Ha=!0):null!=Ba.rotation&&(pa.heading=K(Ba.rotation),Ha=!0);null!=Ba.tilt&&(pa.tilt=Ba.tilt,Ha=!0);null!=Ba.fov&&(pa.fov=Ba.fov);return Ha}function M(pa,Ba,Ha,wa){const ya=pa.spatialReference||G.WGS84;Ba=f.isSome(Ba)?Ba:v.externalToInternal(pa,Ha);if(f.isNone(Ba))return wa;wa.targetGeometry=z.projectVectorToPoint(Ba.center,pa.renderSpatialReference,ya);wa.scale=
v.computeScale(pa,Ba);wa.rotation=O(Ha.heading);wa.camera=Ha;return wa}function Q(pa,Ba,Ha){var wa=()=>new d("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!Ba)throw wa();if(!q.canProject(Ba.spatialReference,pa.spatialReference))throw new d("viewpointutils:incompatible-spatialreference",`Spatial reference (${Ba.spatialReference?Ba.spatialReference.wkid:"unknown"}) is incompatible with the view (${pa.spatialReference.wkid})`,{geometry:Ba});const ya=[];if(!Ba.hasZ&&pa.basemapTerrain){switch(Ba.type){case "point":var Na=
Ba;break;case "multipoint":case "polyline":Na=Ba.extent?.center;break;case "mesh":Na=Ba.origin;break;case "extent":Na=Ba.center;break;case "polygon":Na=Ba.centroid}Na&&f.isSome(pa.basemapTerrain.spatialReference)&&q.canProject(Na,pa.basemapTerrain.spatialReference)?fa[2]=f.unwrapOr(D.getElevationAtPoint(pa.elevationProvider,Na),0):fa[2]=0}(0,Ja[Ba.type])(Ba,Ra=>{ya.push(Ra[0],Ra[1],Ra[2])},fa);Na=ya.length/3;if(0===Na)throw wa();wa=Array(ya.length);if(z.projectBuffer(ya,Ba.spatialReference,0,wa,pa.spatialReference,
0,Na))for(Ba.hasZ&&(Ha.hasZ=!0),pa=0;pa<wa.length;pa+=3)Ba.hasZ?(fa[0]=wa[pa+0],fa[1]=wa[pa+1],fa[2]=wa[pa+2]):(fa[0]=wa[pa+0],fa[1]=wa[pa+1]),y.expandWithVec3(Ha.boundingBox,fa)}function T(pa,Ba,Ha,wa){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(pa,Ba,Ha,wa){const ya=yield p.result(pa.whenViewForGraphic(Ba));if(!1!==ya.ok&&!f.isNone(ya.value)&&"whenGraphicBounds"in ya.value)if(Ha=yield p.result(ya.value.whenGraphicBounds(Ba,{minDemResolution:Ha})),!1===Ha.ok)Q(pa,
Ba.geometry,wa);else{var {screenSpaceObjects:Na,boundingBox:Ra}=Ha.value;y.expandWithAABB(wa.boundingBox,Ra);Na&&Na.forEach(Sa=>{wa.screenSpaceObjects.push(Sa)});isFinite(Ra[2])&&(wa.hasZ=!0)}else Q(pa,Ba.geometry,wa)});return S.apply(this,arguments)}function U(pa,Ba,Ha,wa){return Y.apply(this,arguments)}function Y(){Y=b._asyncToGenerator(function*(pa,Ba,Ha,wa){if(Array.isArray(Ba)&&2===Ba.length){const ya=Ba[0],Na=Ba[1];if("number"===typeof ya&&"number"===typeof Na){va.x=ya;va.y=Na;va.z=void 0;va.spatialReference=
pa.spatialReference.isGeographic?pa.spatialReference:G.WGS84;Q(pa,va,wa);return}}Ba&&"function"===typeof Ba.map?yield e.eachAlways(Ba.map(ya=>U(pa,ya,Ha,wa))):Ba instanceof L?Q(pa,Ba,wa):Ba instanceof m&&(yield T(pa,Ba,Ha,wa))});return Y.apply(this,arguments)}function V(pa,Ba,Ha,wa,ya){return R.apply(this,arguments)}function R(){R=b._asyncToGenerator(function*(pa,Ba,Ha,wa,ya){if(f.isSome(Ba.camera))return X(pa,Ba.camera,ya);ya.scale=Ba.scale;ya.rotation=Ba.rotation;ya.targetGeometry=f.isSome(Ba.targetGeometry)?
Ba.targetGeometry.clone():null;ya.camera=null;null!=Ha.heading?ya.rotation=O(Ha.heading):null!=Ha.rotation&&(ya.rotation=Ha.rotation);Ba=E(pa,Ha);null!=Ba&&(ya.scale=Ba);wa=new v.AsyncContext(wa);N(pa,ya,Ha.tilt,wa);ya.camera=yield wa.resolver.promise;return ya});return R.apply(this,arguments)}function X(pa,Ba,Ha){const wa=q.project(Ba.position,pa.spatialReference);if(f.isNone(wa))return null;Ba=Ba.clone();Ba.fov=pa.camera.fov;Ba.position=wa;return M(pa,null,Ba,Ha)}function W(pa,Ba,Ha,wa,ya,Na){return aa.apply(this,
arguments)}function aa(){aa=b._asyncToGenerator(function*(pa,Ba,Ha,wa,ya,Na){if(f.isNone(Ha))throw new d("createfromcenter","invalid point");Na.targetGeometry=Ha.clone();const Ra=x.cameraOnContentAlongViewDirection(pa);if(Ba.position)return Ha=Na.targetGeometry,ya=pa.renderSpatialReference,z.projectPointToVector(Ba.position,Aa,ya),z.projectPointToVector(Ha,ua,ya),Na.targetGeometry=new F(Ha),wa.position=new F(Ba.position),w.subtract(ra,ua,Aa),v.directionToHeadingTilt(pa,Aa,ra,Ra.up,wa),Na.scale=v.distanceToScale(pa,
w.distance(Aa,ua),Na.targetGeometry.latitude),Na.rotation=O(wa.heading),Na.camera=wa,Na;if(Ba.zoomFactor){var Sa=Ra.distance/Ba.zoomFactor;const ja=w.scale(fa,Ra.viewForward,-Sa);Ra.eye=w.add(fa,Ra.center,ja);Na.scale=v.distanceToScale(pa,Sa,Ha.latitude)}v.internalToExternal(pa,Ra,wa);Sa=I(wa,Ba)?v.OrientationMode.LOCKED:v.OrientationMode.ADJUST;Ba.zoomFactor||(Na.scale=E(pa,Ba),null==Na.scale&&(z.projectPointToVector(Ha,fa,pa.renderSpatialReference),C.intersectsPoint(Ra.frustum,fa)?Na.scale=v.distanceToScale(pa,
w.distance(Ra.eye,fa),Ha.latitude):Na.scale=v.computeScale(pa,Ra)),Ba=new v.AsyncContext(ya),v.fromCenterScale(pa,Na.targetGeometry,Na.scale,wa,Sa,Ba),Na.camera=yield Ba.resolver.promise);return Na});return aa.apply(this,arguments)}function ba(pa,Ba,Ha,wa,ya){return ia.apply(this,arguments)}function ia(){ia=b._asyncToGenerator(function*(pa,Ba,Ha,wa,ya){var Na=x.cameraOnContentAlongViewDirection(pa);Na=z.projectVectorToPoint(Na.center,pa.renderSpatialReference,pa.spatialReference);return W(pa,Ba,Na,
Ha,wa,ya)});return ia.apply(this,arguments)}function ma(pa,Ba,Ha,wa,ya,Na){return ha.apply(this,arguments)}function ha(){ha=b._asyncToGenerator(function*(pa,Ba,Ha,wa,ya,Na){Na.targetGeometry=Ha.clone();const Ra=x.cameraOnContentAlongViewDirection(pa);v.internalToExternal(pa,Ra,wa);Ba=I(wa,Ba)?v.OrientationMode.LOCKED:v.OrientationMode.ADJUST;ya=new v.AsyncContext(ya);v.fromExtent(pa,Ha,wa.heading,wa.tilt,Ba,ya);Na.camera=yield ya.resolver.promise;return Na});return ha.apply(this,arguments)}function ka(pa,
Ba,Ha,wa,ya,Na,Ra,Sa){return Z.apply(this,arguments)}function Z(){Z=b._asyncToGenerator(function*(pa,Ba,Ha,wa,ya,Na,Ra,Sa){Sa.targetGeometry=Ha.clone();const ja=x.cameraOnContentAlongViewDirection(pa);var Ta=0;Ha.hasZ?Ta=Ha.z:pa.basemapTerrain&&(Ta=f.unwrap(D.getElevationAtPoint(pa.elevationProvider,Ha)));w.set(fa,Ha.x,Ha.y,Ta);z.computeTranslationToOriginAndRotation(pa.spatialReference,fa,ea,pa.renderSpatialReference);l.fromMat4(da,ea);l.transpose(da,da);y.empty(la);Ha=[[0,1,2],[3,1,2],[0,4,2],[3,
4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var qa=0;qa<Ha.length;qa++){const Ea=Ha[qa];let Oa=wa[Ea[2]];isFinite(Oa)||(Oa=Ta);w.set(fa,wa[Ea[0]],wa[Ea[1]],Oa);z.projectVectorToVector(fa,pa.spatialReference,fa,pa.renderSpatialReference);y.expandWithVec3(la,w.transformMat3(fa,fa,da))}wa=y.width(la);Ta=y.height(la);Ha=y.depth(la);qa=1/Math.tan(ja.fovY/2);ya=Math.max(.5*Math.sqrt(wa*wa+Ha*Ha)*Math.max(qa,1/Math.tan(ja.fovX/2))+.5*Ta,.5*Ta*qa+.5*Math.max(wa,Ha))/ya;v.internalToExternal(pa,ja,Na);Ba=I(Na,
Ba)?v.OrientationMode.LOCKED:v.OrientationMode.ADJUST;Sa.scale=v.distanceToScale(pa,ya,Sa.targetGeometry.latitude);Ra=new v.AsyncContext(Ra);v.fromCenterScale(pa,Sa.targetGeometry,Sa.scale,Na,Ba,Ra);Sa.camera=yield Ra.resolver.promise;return Sa});return Z.apply(this,arguments)}function ca(pa){pa&&f.isSome(pa.camera)&&(pa.rotation=O(pa.camera.heading));return pa}const fa=u.create(),ea=t.create(),da=A.create(),la=y.create(),oa=B.create(),ra=u.create(),Aa=u.create(),ua=u.create(),za={heading:0,tilt:0},
va=new F,Ja={point(pa,Ba,Ha){Ha[0]=pa.x;Ha[1]=pa.y;pa.hasZ&&(Ha[2]=pa.z);Ba(Ha)},polygon(pa,Ba,Ha){const wa=pa.hasZ;for(let ya=0;ya<pa.rings.length;ya++){const Na=pa.rings[ya];for(let Ra=0;Ra<Na.length;Ra++)Ha[0]=Na[Ra][0],Ha[1]=Na[Ra][1],wa&&(Ha[2]=Na[Ra][2]),Ba(Ha)}},polyline(pa,Ba,Ha){const wa=pa.hasZ;for(let ya=0;ya<pa.paths.length;ya++){const Na=pa.paths[ya];for(let Ra=0;Ra<Na.length;Ra++)Ha[0]=Na[Ra][0],Ha[1]=Na[Ra][1],wa&&(Ha[2]=Na[Ra][2]),Ba(Ha)}},multipoint(pa,Ba,Ha){const wa=pa.points;pa=
pa.hasZ;for(let ya=0;ya<wa.length;ya++)Ha[0]=wa[ya][0],Ha[1]=wa[ya][1],pa&&(Ha[2]=wa[ya][2]),Ba(Ha)},extent(pa,Ba,Ha){pa.hasZ?(Ba(w.set(Ha,pa.xmin,pa.ymin,pa.zmin)),Ba(w.set(Ha,pa.xmax,pa.ymin,pa.zmin)),Ba(w.set(Ha,pa.xmin,pa.ymax,pa.zmin)),Ba(w.set(Ha,pa.xmax,pa.ymax,pa.zmin)),Ba(w.set(Ha,pa.xmin,pa.ymin,pa.zmax)),Ba(w.set(Ha,pa.xmax,pa.ymin,pa.zmax)),Ba(w.set(Ha,pa.xmin,pa.ymax,pa.zmax)),Ba(w.set(Ha,pa.xmax,pa.ymax,pa.zmax))):(Ba(w.set(Ha,pa.xmin,pa.ymin,Ha[2])),Ba(w.set(Ha,pa.xmax,pa.ymin,Ha[2])),
Ba(w.set(Ha,pa.xmin,pa.ymax,Ha[2])),Ba(w.set(Ha,pa.xmax,pa.ymax,Ha[2])))},mesh(pa,Ba,Ha){if(pa=pa.vertexAttributes&&pa.vertexAttributes.position)for(let wa=0;wa<pa.length;wa+=3)Ba(w.set(Ha,pa[wa+0],pa[wa+1],pa[wa+2]))}};a.create=function(pa,Ba,Ha){return H.apply(this,arguments)};a.fromCamera=function(pa,Ba,Ha=null){f.isNone(Ha)&&(Ha=new n);return M(pa,null,Ba.clone(),Ha)};a.headingToRotation=O;a.rotationToHeading=K;a.toCamera=N;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,r,m,n,p){n=function(g){function h(d,f,e){var l=g.call(this,!0)||this;l._view=d;l.pointerAction=f;l.registerIncoming("drag",e,A=>l._handleDrag(A));return l}b._inheritsLoose(h,g);h.prototype._handleDrag=
function(d){const f=d.data;if(!(1<f.pointers.size)&&p.eventMatchesMousePointerAction(d.data,this.pointerAction)){var e=c.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?new r.ZoomController({view:this._view}):new m.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);
break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}d.stopPropagation()}};return h}(n.InputHandler);a.DragZoom=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G){a.ZoomController=function(K){function O(){var N=K.apply(this,arguments)||this;N._pickPoint=w.create();N._tmpP0=A.create();N._panAxisAngle=z.create();N._tmpRayDir=w.create();N._tmpRayDirPick=w.create();N._targetOnSphere=w.create();N._tmpRay={origin:w.create(),direction:w.create()};N.dragBeginPoint=n.createScreenPointArray();N._normalizedAnchorPoint=A.create();N._constraintOptions={selection:C.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:k.InteractionType.ZOOM,
interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};N._sphere=y.create();N._hasPickPoint=!1;return N}b._inheritsLoose(O,K);var P=O.prototype;P.begin=function(N){if(this.active){l.copy(this.dragBeginPoint,N);D.normalizeCoordinate(this.startCamera,N,this._normalizedAnchorPoint);var H=u.getReferenceEllipsoid(this.view.spatialReference),E=D.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,N,H,D.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?
L:{});this._navMode=D.decideNavigationMode(this.startCamera,N,E.hasGeometryIntersection,H);if(this._navMode===D.NavigationMode.Horizontal)this._hasPickPoint=!!E.scenePickPoint,this._pickPoint=m.unwrapOr(E.scenePickPoint,this._pickPoint),this._sphere=E.sphere;else{F.fromScreenAtEye(this.startCamera,N,this._tmpRay);t.normalize(this._tmpRay.direction,this._tmpRay.direction);let I,M;m.isSome(E.scenePickPoint)&&(t.subtract(this._tmpRayDirPick,this.startCamera.eye,E.scenePickPoint),M=t.length(this._tmpRayDirPick));
this.view.camera.position.hasZ&&(I=Math.abs(this.view.camera.position.z));H=r.clamp(D.PIVOT_DISTANCE_MODIFIER*I,D.DISTANCE_CLAMP_VALUES[0],D.DISTANCE_CLAMP_VALUES[1]);N=this.view._stage.renderView.getMinimalDepthForArea(null,N[0],N[1],this.view.state.camera,D.SCREEN_PIXEL_AREA);H=m.isSome(N)?Math.min(H,N):H;H=E.scenePickPoint?Math.min(H,M):H;this._hasPickPoint=!0;t.scale(this._tmpRay.direction,this._tmpRay.direction,H);t.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=
this.startCamera}};P.update=function(N){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===D.NavigationMode.Horizontal){t.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var H=t.length(this._tmpRayDir);D.normalizeCoordinate(this.currentCamera,N,this._tmpP0);var E=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),I=H*2**E;const M=this.view.state.constraints.minimumPoiDistance;
0>E&&I<M&&(I=M);if(1E-6>Math.abs(H-I))return;this._hasPickPoint&&I<H&&(E=1-(1-I/H)*(1-this._sphere[3]/t.length(this.currentCamera.center)),this.currentCamera.center=t.scale(J,this.currentCamera.center,E));t.scale(this._tmpRayDir,this._tmpRayDir,-I/H);this.currentCamera.eye=t.add(J,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=B.pixelDistanceToInteractionFactor(l.distance(this.dragBeginPoint,N));B.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._hasPickPoint&&(D.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),z.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),D.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{H=t.length(this._tmpRay.direction);D.normalizeCoordinate(this.currentCamera,N,this._tmpP0);N=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);I=H*2**N;E=this.view.state.constraints.minimumPoiDistance;0>N&&I<E&&(I=E);if(1E-6>
Math.abs(H-I))return;t.scale(this._tmpRayDir,this._tmpRay.direction,1-I/H);this.currentCamera.eye=t.add(J,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=t.add(J,this.currentCamera.center,this._tmpRayDir)}q.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}};P.end=function(){this.active&&this.finishController()};b._createClass(O,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return O}(v.InteractiveController);
a.ZoomController=c.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const J=w.create(),L={exclude:new Set([G.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){a.ZoomController=function(F){function G(){var L=F.apply(this,arguments)||this;L._tmpP=w.create();L._tmpDir=w.create();L._tmpN=w.create();L._tmpP0=A.create();L._tmpPoi=w.create();L._tmpRayDir=w.create();L.dragBeginPoint=n.createScreenPointArray();L._normalizedAnchorPoint=A.create();L._constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:B.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:w.create(),
tiltMode:C.TiltMode.TUMBLE};L._plane=u.create();return L}b._inheritsLoose(G,F);var J=G.prototype;J.begin=function(L){if(this.active){l.copy(this.dragBeginPoint,L);q.normalizeCoordinate(this.startCamera,L,this._normalizedAnchorPoint);var K=this._intersectionHelper.intersectScreenFreePointFallback(L,this._tmpP,0===this.view.map.ground.opacity?D:{});t.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var O=t.length(this._tmpDir);t.normalize(this._tmpDir,this._tmpDir);var P;this.view.camera.position.hasZ&&
(P=Math.abs(this.view.camera.position.z));P=r.clamp(q.PIVOT_DISTANCE_MODIFIER*P,q.DISTANCE_CLAMP_VALUES[0],q.DISTANCE_CLAMP_VALUES[1]);L=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,L[0],L[1],this.view.state.camera,q.SCREEN_PIXEL_AREA);P=m.isSome(L)?Math.min(P,L):P;P=K?Math.min(P,O):P;t.scale(this._tmpDir,this._tmpDir,P);t.add(this._tmpP,this.startCamera.eye,this._tmpDir);t.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);t.normalize(this._tmpN,this._tmpN);
0>this._tmpN[1]&&t.negate(this._tmpN,this._tmpN);u.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}};J.update=function(L){if(this.active){q.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||t.copy(this._tmpPoi,this.currentCamera.center);q.normalizeCoordinate(this.currentCamera,L,this._tmpP0);var K=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);l.copy(this._normalizedAnchorPoint,
this._tmpP0);t.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var O=t.length(this._tmpRayDir),P=O*(1-K);t.copy(this._constraintOptions.interactionDirection,this._tmpRayDir);t.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(K)/O);var N=this.view.state.constraints.minimumPoiDistance;0<=K&&P<N&&(P=N,K=-(P-O)/O);1E-6>Math.abs(O-P)||(t.scale(this._tmpRayDir,this._tmpRayDir,K),this.currentCamera.eye=t.add(v,this.currentCamera.eye,
this._tmpRayDir),t.lerp(v,this.currentCamera.center,this._tmpPoi,K),v[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],v[2]):Math.min(this.startCamera.center[2],v[2]),this.currentCamera.center=v,this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(l.distance(this.dragBeginPoint,L)),z.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}};J.end=function(){this.active&&this.finishController()};b._createClass(G,[{key:"_intersectionHelper",
get:function(){return this.view.sceneIntersectionHelper}}]);return G}(k.InteractiveController);a.ZoomController=c.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const v=w.create(),D={exclude:new Set([x.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,b,c,r,m,n){n=function(p){function g(d){var f=p.call(this,!0)||this;f._view=d;f._watchHandles=new c;f._handle=f.registerIncoming("gamepad",e=>f._handleEventGamepad(e));f._handle.pause();return f}b._inheritsLoose(g,p);var h=g.prototype;h.onInstall=function(d){p.prototype.onInstall.call(this,d);this._watchHandles.add([r.watch(()=>this._view.navigation.gamepad.enabled,f=>{f?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),
this._cameraControllerGamepad=null))},r.initial),r.watch(()=>this._view.navigation.gamepad.device,f=>{this._cameraControllerGamepad&&f&&this._cameraControllerGamepad.gamepadDevice!==f&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])};h.onUninstall=function(){this._watchHandles.removeAll();p.prototype.onUninstall.call(this)};h._handleEventGamepad=function(d){var f=this._view.navigation.gamepad.device;if(!f||d.data.device===f)if((f=this._cameraControllerGamepad&&
this._cameraControllerGamepad.active)||m.GamepadKeyboardController.activatesFor(this._view,d.data))f||(f=new m.GamepadKeyboardController({view:this._view,gamepadDevice:d.data.device}),this._view.state.switchCameraController(f)&&(this._cameraControllerGamepad=f)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===d.data.device&&this._cameraControllerGamepad.handleEventGamepad(d.data)};return g}(n.InputHandler);a.GamepadNavigation=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){a.GamepadKeyboardController=function(Q){function T(U){U=Q.call(this,U)||this;U._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};U._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];U._tmpCamera=new J.Camera;U._constraintOptions={selection:B.ConstraintTypes.ALL,interactionType:C.InteractionType.NONE,interactionStartCamera:new J.Camera,interactionFactor:0,interactionDirection:null,tiltMode:k.TiltMode.LOOK_AROUND};return U}b._inheritsLoose(T,
Q);var S=T.prototype;S.handleEventGamepad=function(U){const Y=L.extractTransformation(U,this.view.navigation.gamepad,this._transformation);("end"===U.action||L.isZeroTransformation(Y))&&this.finishController()};S.activateDirection=function(U){this._keysButtonState[U]=1;L.extractTransformationKeyboard(this._keysButtonState,this._transformation)};S.deactivateDirection=function(U){this._keysButtonState[U]=0;U=L.extractTransformationKeyboard(this._keysButtonState,this._transformation);L.isZeroTransformation(U)&&
this.finishController()};S.onControllerStart=function(U){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;Q.prototype.onControllerStart.call(this,U)};S._updateFilteredSurfaceElevation=function(U){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*U};S.stepController=function(U,Y){this._updateStartHeading();this._updateFilteredSurfaceElevation(U);this.currentCamera.copyViewFrom(Y);
this._updateCameraCenter();this._constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this._calculateControlTransformation(U,this.currentCamera,H);this._applyDisabledMovementTypes(H);this._applyPan(H.pan);this._applyRotate(H.rotate);this._applyZoom(H.zoom);this._applyAscend(H.ascend);this._constraintOptions.interactionType=C.InteractionType.NONE;this._constraintOptions.selection=B.ConstraintTypes.COLLISION;y.applyAll(this.view,this.currentCamera,this._constraintOptions);Q.prototype.stepController.call(this,
U,Y)};S._updateStartHeading=function(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)};S._applyRotate=function(U){if(U.enabled){var Y=this.currentCamera;l.subtract(E,Y.center,Y.eye);l.transformMat4(E,E,U.matrix);Y.center=l.add(E,E,Y.eye);Y.up=l.transformMat4(E,Y.up,U.matrix);this._constraintOptions.interactionType=C.InteractionType.LOOK_AROUND;this._constraintOptions.selection=B.ConstraintTypes.ALL_EXCEPT_COLLISION;y.applyAll(this.view,Y,this._constraintOptions)}};
S._applyPan=function(U,Y=this.currentCamera){U.enabled&&(Y.eye=l.transformMat4(E,Y.eye,U.matrix),Y.center=l.transformMat4(E,Y.center,U.matrix),this.view.state.isGlobal&&(Y.up=l.transformMat4(E,Y.up,U.matrix)),this._constraintOptions.interactionType=C.InteractionType.PAN,this._constraintOptions.selection=B.ConstraintTypes.ALL,y.applyAll(this.view,Y,this._constraintOptions))};S._applyZoom=function(U){if(U){var Y=this.currentCamera.viewForward;this.currentCamera.eye=l.add(E,this.currentCamera.eye,l.scale(z.sv3d.get(),
Y,U));l.copy(I,Y);l.negate(I,I);this._constraintOptions.interactionDirection=I;this._constraintOptions.interactionType=C.InteractionType.ZOOM;this._constraintOptions.selection=B.ConstraintTypes.ALL_EXCEPT_COLLISION;y.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};S._applyAscend=function(U){if(U){var Y=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,z.sv3d.get());this._constraintOptions.interactionDirection=l.copy(I,
Y);this.view.state.isGlobal?(Y=l.length(this.currentCamera.eye),U=(Y+U)/Y,this.currentCamera.eye=l.scale(E,this.currentCamera.eye,U),this.currentCamera.center=l.scale(E,this.currentCamera.center,U)):(U=l.scale(z.sv3d.get(),Y,U),this.currentCamera.eye=l.add(E,this.currentCamera.eye,U),this.currentCamera.center=l.add(E,this.currentCamera.center,U));this._updateCameraCenter();this._constraintOptions.interactionType=C.InteractionType.ASCEND;this._constraintOptions.selection=B.ConstraintTypes.COLLISION;
y.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=B.ConstraintTypes.ALL_EXCEPT_COLLISION;y.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};S._calculateControlTransformation=function(U,Y,V){V.zoom=0;V.ascend=0;V.pan.enabled=!1;f.identity(V.pan.matrix);V.rotate.enabled=!1;f.identity(V.rotate.matrix);U=this._computeVelocities(U);this.view.state.isLocal?this._calculateControlTransformationLocal(U,
Y,V):this._calculateControlTransformationGlobal(U,Y,V)};S._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,E)};S._calculateControlTransformationLocal=function(U,Y,V){const {viewRight:R,viewForward:X}=Y,W=this._transformation;var aa=this.view.navigation.gamepad,ba=l.set(z.sv3d.get(),X[0],X[1],0);l.normalize(ba,ba);var ia=W.translation[0]*
U.pan;0!==ia&&(ia=l.scale(z.sv3d.get(),R,ia),f.translate(V.pan.matrix,V.pan.matrix,ia),V.pan.enabled=!0);switch(aa.mode){case "pan":aa=-W.translation[1]*U.pan;0!==aa&&(ba=l.scale(z.sv3d.get(),ba,aa),f.translate(V.pan.matrix,V.pan.matrix,ba),V.pan.enabled=!0);V.zoom=W.zoom*U.zoom;break;case "zoom":V.zoom=(-W.translation[1]+W.zoom)*U.zoom;break;default:r.neverReached(aa.mode)}V.ascend=W.translation[2]*U.ascend;ba=-W.heading*U.rotate;0!==ba&&(f.rotate(V.rotate.matrix,V.rotate.matrix,ba,this.view.renderCoordsHelper.worldUpAtPosition(Y.eye,
z.sv3d.get())),V.rotate.enabled=!0);U=W.tilt*U.rotate;Y=D.viewAngle(this.view.renderCoordsHelper,Y.center,Y.eye);if(Y=m.clamp(Y+U,q.TiltDefault.min,q.TiltDefault.max)-Y)f.rotate(V.rotate.matrix,V.rotate.matrix,Y,R),V.rotate.enabled=!0};S._calculateControlTransformationGlobal=function(U,Y,V){const {eye:R,viewRight:X}=Y,W=this._transformation;var aa=this.view.navigation.gamepad,ba=l.cross(z.sv3d.get(),X,R);l.normalize(ba,ba);l.negate(ba,ba);v.panMotionToRotationMatrix(this.startCamera,Y,W,U,this.view.camera.heading,
this._headingStart,this.view.camera.tilt,V,aa);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(H.pan,this._tmpCamera);aa=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;V.ascend=W.translation[2]*U.ascend;ba=-W.heading*U.rotate;0!==ba&&(f.rotate(V.rotate.matrix,V.rotate.matrix,ba,this._tmpCamera.eye),V.rotate.enabled=!0);Y=this._clampTiltDeltaGlobalToValidRange(W.tilt*U.rotate,Y.ray,aa);0!==Y&&(f.rotate(V.rotate.matrix,V.rotate.matrix,Y,this._tmpCamera.viewRight),
V.rotate.enabled=!0);V.zoom+=W.zoom*U.zoom};S._clampTiltDeltaGlobalToValidRange=function(U,Y,V){const R=t.getReferenceEllipsoid(this.view.spatialReference),X=v.onSurfaceTiltToEyeTiltGlobal(q.TiltDefault.min,Y.origin,V,R);var W=0;let aa=0;W=z.sv3d.get();this.view.renderCoordsHelper.intersectManifold(Y,V,W)?(W=D.viewAngle(this.view.renderCoordsHelper,W,Y.origin),W=v.onSurfaceTiltToEyeTiltGlobal(W,Y.origin,V,R),aa=v.onSurfaceTiltToEyeTiltGlobal(q.TiltDefault.max,Y.origin,V,R)):(u.closestPointOnSilhouette(u.fromRadius(u.tmpSphere,
V+R.radius),Y,W),W=m.acosClamped(-l.dot(Y.direction,l.normalize(W,W))),W=v.offSurfaceTiltToEyeTiltGlobal(W,Y.origin,V,R),aa=v.offSurfaceTiltToEyeTiltGlobal(q.TiltDefault.max,Y.origin,V,R));return m.clamp(W+U,X,aa)-W};S._getPointAbsoluteSurfaceElevation=function(U,Y,V){const {renderCoordsHelper:R}=this.view,X=R.getAltitude(U);Y+=Math.abs(X-Y);R.setAltitude(V,Y,U);return Y};S._clampedDistanceToSurface=function(U,Y){const {renderCoordsHelper:V}=this.view,{camera:R}=this.view.state;var {direction:X}=
F.headingTiltToDirectionUp(this.view,Y,0,80,M);X=V.intersectManifoldClosestSilhouette(w.wrap(Y,X),U,z.sv3d.get());X=l.distance(Y,X);U=V.intersectManifoldClosestSilhouette(w.wrap(Y,l.direction(z.sv3d.get(),Y,R.center)),U,z.sv3d.get());Y=l.distance(Y,U);return Math.min(X,Y)};S._computeHeadingRotateRadius=function(U){const {renderCoordsHelper:Y,state:V}=this.view,{camera:R,isGlobal:X}=V;var W=Y.intersectManifoldClosestSilhouette(R.ray,this._filteredSurfaceElevation,z.sv3d.get());if(X){const aa=l.subtract(z.sv3d.get(),
U,W);W=l.length(aa);l.scale(aa,aa,1/W);U=l.normalize(z.sv3d.get(),U);U=m.acosClamped(l.dot(U,aa));return W*Math.sin(Math.min(O,U))}U=l.copy(z.sv3d.get(),U);Y.setAltitude(U,this._filteredSurfaceElevation);return l.distance(W,U)};S._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};S._computeVelocities=function(U){var Y=this._filteredSurfaceElevation,V=Y+t.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:R,isGlobal:X}=this.view.state;var W=
z.sv3d.get();const aa=this._getPointAbsoluteSurfaceElevation(R.eye,Y,W);var ba=this._clampedDistanceToSurface(Y,W);const ia=R.width/2,ma=.75*R.width,ha=.75*R.width;var ka=ba*Math.tan(.5*R.fovX)/ia;V=ka/V;W=ka/this._computeHeadingRotateRadius(W);ka=(X?V:ka)*ma*U;Y=aa-Y;Y=Math.max(this._minimumAscendVelocity()*U,2**(ma*U/ia)*Y-Y);ba=2**(ma*U/ia)*ba-ba;U*=m.clamp(W*ha,P,N);return{pan:ka,ascend:Y,zoom:ba,rotate:U}};S._applyDisabledMovementTypes=function(U){!n.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&
this.view.state.viewingMode!==this.disableMovements.mode||(U.zoom=this.disableMovements.zoom?0:U.zoom,U.ascend=this.disableMovements.ascend?0:U.ascend,U.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&f.identity(U.pan.matrix),U.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&f.identity(U.rotate.matrix))};T.activatesFor=function(U,Y){U=L.extractTransformation(Y,U.navigation.gamepad,K);return!("end"===Y.action||L.isZeroTransformation(U))};return T}(x.InteractiveController);
c.__decorate([p.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([p.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([d.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const K={translation:[0,0,0],heading:0,tilt:0,zoom:0},O=m.deg2rad(80),P=m.deg2rad(30),N=m.deg2rad(80),H={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.create()},
rotate:{enabled:!1,matrix:e.create()}},E=A.create(),I=A.create(),M=G.createDirectionUp();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(r){let m=r*r;0>r&&(m*=-1);return m}a.extractTransformation=function(r,m,n){const p=r.state;r=r.device;m="forward-down"===m.tiltDirection?1:-1;"standard"===r.deviceType?(n.translation[0]=c(p.axes[0]),
n.translation[1]=c(p.axes[1]),n.translation[2]=c(p.buttons[7])-c(p.buttons[6]),n.heading=c(p.axes[2]),n.tilt=c(p.axes[3])):"spacemouse"===r.deviceType&&(n.translation[0]=1.2*c(p.axes[0]),n.translation[1]=1.2*c(p.axes[1]),n.translation[2]=2*-c(p.axes[2]),n.heading=1.2*c(p.axes[5]),n.tilt=1.2*c(p.axes[3]));n.tilt*=m;b.scale(n.translation,n.translation,1);return n};a.extractTransformationKeyboard=function(r,m){m.translation[0]=r[1]-r[0];m.translation[1]=r[3]-r[2];m.translation[2]=r[4]-r[5];m.heading=
r[7]-r[6];m.tilt=r[8]-r[9];m.zoom=r[10]-r[11];return m};a.isZeroTransformation=function(r){return 0===r.translation[0]&&0===r.translation[1]&&0===r.translation[2]&&0===r.heading&&0===r.tilt&&0===r.zoom};a.resetTransformation=function(r){r.translation[0]=0;r.translation[1]=0;r.translation[2]=0;r.heading=0;r.tilt=0;return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,r,m){var n;(function(p){p[p.LEFT=0]="LEFT";p[p.RIGHT=1]="RIGHT";p[p.FORWARD=2]="FORWARD";p[p.BACKWARD=3]="BACKWARD";p[p.UP=4]="UP";p[p.DOWN=5]="DOWN";p[p.HEADINGLEFT=6]="HEADINGLEFT";p[p.HEADINGRIGHT=7]="HEADINGRIGHT";p[p.TILTUP=8]="TILTUP";p[p.TILTDOWN=9]="TILTDOWN";p[p.ZOOMIN=10]="ZOOMIN";p[p.ZOOMOUT=11]="ZOOMOUT"})(n||(n={}));m=function(p){function g(d,f){var e=p.call(this,!0)||
this;e._view=d;e._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};e._keyToNumber={[f.left]:n.LEFT,[f.right]:n.RIGHT,[f.forward]:n.FORWARD,[f.backward]:n.BACKWARD,[f.up]:n.UP,[f.down]:n.DOWN,[f.headingLeft]:n.HEADINGLEFT,[f.headingRight]:n.HEADINGRIGHT,[f.tiltUp]:n.TILTUP,[f.tiltDown]:n.TILTDOWN,[f.zoomIn]:n.ZOOMIN,[f.zoomOut]:n.ZOOMOUT};e.registerIncoming("key-down",null,l=>e._handleKeyDown(l));e.registerIncoming("key-up",null,l=>e._handleKeyUp(l));e.registerIncoming("blur",
null,()=>e._handleBlur());return e}b._inheritsLoose(g,p);var h=g.prototype;h._handleKeyDown=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var f=this._keyToNumber[d.data.key];null!=f&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new r.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&
(this._cameraControllerKeyboard.activateDirection(f),d.stopPropagation()))}};h._handleBlur=function(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)};h._handleKeyUp=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var f=this._keyToNumber[d.data.key];null!=f&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(f),
d.stopPropagation())}};return g}(m.InputHandler);a.KeyboardNavigation=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(a,b,c,r,m,n){n=function(p){function g(h,d){var f=
p.call(this,!0)||this;f._view=h;f.registerIncoming("mouse-wheel",d,e=>f._handleMouseWheel(e));return f}b._inheritsLoose(g,p);g.prototype._handleMouseWheel=function(h){if(this._view.navigation.mouseWheelZoomEnabled){var d=h.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new r.ZoomStepController({view:this._view,mode:"interaction"}):new m.ZoomStepController({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));
this._cameraController.zoomStep(-1/60*d.deltaY,c.createScreenPointArray(d.x,d.y));h.preventDefault();h.stopPropagation()}};return g}(n.InputHandler);a.MouseWheelZoom=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,r,m,n){m=function(p){function g(d,f,e){var l=p.call(this,!0)||this;l._view=d;l.pointerAction=f;l._lastEndTimestamp=0;l._lastTimestamp=0;l.registerIncoming("drag",e,A=>l._handleDrag(A));return l}b._inheritsLoose(g,p);var h=g.prototype;h._handleDrag=function(d){if("mouse"!==d.data.pointerType||n.eventMatchesMousePointerAction(d.data,this.pointerAction)){var f=d.timestamp-this._lastEndTimestamp;f=this._momentum&&this._momentum.active&&40>f;switch(d.data.action){case "start":case "update":if(f)break;
this._controller&&this._controller.active?2<d.data.timestamp-this._lastTimestamp&&(this._controller.update(d.data),this._lastTimestamp=d.timestamp):this._startController(d);break;case "end":case "removed":this._endController(d,!0);break;case "added":this._endController(d,!1),this._startController(d)}d.stopPropagation()}};h._endController=function(d,f){this._controller&&this._controller.active&&(this._lastEndTimestamp=d.timestamp,d=this._controller.end(d.data),f&&d&&(this._momentum=d,this._view.state.switchCameraController(this._momentum)));
this._controller=null};h._startController=function(d){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(d.data);this._lastTimestamp=d.timestamp};h._createController=function(){return this._view.state.isGlobal?new c.PinchAndPanController({view:this._view}):new r.PinchAndPanController({view:this._view})};return g}(m.InputHandler);a.PinchAndPanNavigation=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I){a.PinchAndPanController=function(M){function Q(){var S=M.apply(this,arguments)||this;S._smoothRotation=new v.ExponentialFalloff(.05);S._rotationAxis=w.create();S._panningPlane=y.create();S._smoothScaling=new v.ExponentialFalloff(.05);S._zoomCenterScreen=p.createScreenPointArray();S._zoomMomentumEstimator=new I.ZoomMomentumEstimator;S._rotationMomentumEstimator=new E.RotationMomentumEstimator;S._panSphericalMomentumEstimator=
new H.PanSphericalMomentumEstimator;S._panPlanarMomentumEstimator=new N.PanPlanarMomentumEstimator;S._adjustedSphere=B.create();S._tmp3d=w.create();S._tmpScreenPointArray=p.createScreenPointArray();S._beginScreenPoint=p.createScreenPointArray();S._beginScenePoint=w.create();S._screenPickPoint=p.createScreenPointArray();S._mode=O.NavigationMode.Horizontal;S._tmpInteractionDirection=w.create();S._constraintOptions={selection:k.ConstraintTypes.ALL,interactionType:q.InteractionType.NONE,interactionFactor:0,
interactionStartCamera:new P.Camera,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};return S}b._inheritsLoose(Q,M);var T=Q.prototype;T.begin=function(S){if(this.active){var U=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=U;this._rotationMomentumEstimator.enabled=U;this._panPlanarMomentumEstimator.enabled=U;this._panSphericalMomentumEstimator.enabled=U;this._beginHeading=-r.cyclicalPI.normalize(m.deg2rad(this.view.camera.heading));this._beginRadius=S.radius;this._pointerCount=
S.pointers.size;this._beginAngle=S.angle;this._smoothRotation.reset();p.screenPointObjectToArray(S.center,this._screenPickPoint);A.copy(this._beginScreenPoint,this._screenPickPoint);U=u.getReferenceEllipsoid(this.view.spatialReference);var Y=O.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,U,O.SpherePickPointFallback.Silhouette);n.isNone(Y.scenePickPoint)||(this._scenePickPoint=Y.scenePickPoint,this._sphere=Y.sphere,t.copy(this._beginScenePoint,this._scenePickPoint),
this._mode=O.decideNavigationMode(this.startCamera,this._screenPickPoint,Y.hasGeometryIntersection,U),this._mode===O.NavigationMode.Vertical&&this._preparePlanarPanMode(S),this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera))}};T.update=function(S){if(this.active){this.currentCamera.copyFrom(this.startCamera);var U=1<S.pointers.size;this._mode===O.NavigationMode.Horizontal?(U&&this._zoomSpherical(S),this._panningSpherical(S),U&&this._rotateSpherical(S)):(U&&this._zoomPlanar(S),
this._panningPlanar(S),U&&this._rotatePlanar(S));this.commitCamera()}};T.end=function(S){S.pointers.size===this._pointerCount&&this.update(S);this.finishController();if(S=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===O.NavigationMode.Horizontal?new K.ZoomSphericalMomentumController({view:this.view,momentum:S,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new L.ZoomPlanarMomentumController({view:this.view,momentum:S,zoomCenter:this._beginScenePoint});
if(S=this._rotationMomentumEstimator.evaluateMomentum())return new J.RotationMomentumController({view:this.view,momentum:S,center:this._sphere,axis:this._rotationAxis});if(this._mode===O.NavigationMode.Horizontal){if(S=this._panSphericalMomentumEstimator.evaluateMomentum())return new G.PanSphericalMomentumController({view:this.view,momentum:S})}else if(S=this._panPlanarMomentumEstimator.evaluateMomentum())return new F.PanPlanarMomentumController({view:this.view,momentum:S});return null};T._preparePlanarPanMode=
function(S){var U=t.negate(this._tmp3d,this.startCamera.viewForward);y.fromPositionAndNormal(this._scenePickPoint,U,this._panningPlane);var Y=p.createScreenPointArray(this._screenPickPoint[0],0);U=w.create();var V=t.length(this.startCamera.eye);this._adjustedSphere[3]=V<this._sphere[3]?V-100:this._sphere[3];O.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,this.startCamera,Y,U);Y=p.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(U,Y);this._screenPickPoint[1]=Math.min(this._screenPickPoint[1],
.9*Y[1]);(U=this._intersectionHelper.intersectScreen(this._screenPickPoint,this._scenePickPoint))&&y.fromPositionAndNormal(this._scenePickPoint,y.normal(this._panningPlane),this._panningPlane);Y=w.create();V=w.create();const R=w.create();t.subtract(Y,this._scenePickPoint,this.currentCamera.eye);const X=t.length(Y);t.normalize(Y,Y);var W=5*Math.max(Math.abs(this.view.camera.position.z),50);const aa=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],
this.view.state.camera,80);W=n.isSome(aa)?Math.min(aa,W):W;W=U?Math.min(W,X):W;t.copy(R,t.add(V,this.currentCamera.eye,t.scale(V,Y,W)));this._panningPlane[3]=-t.dot(this._panningPlane,R);this.startCamera.center=t.add(V,this.startCamera.eye,t.scale(V,this.startCamera.viewForward,W));S=p.screenPointObjectToArray(S.center,this._tmpScreenPointArray);O.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,S,this._beginScenePoint)};T._zoomSpherical=function(S){const U=this._beginRadius/
S.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(S.radius,40),120);this._smoothScaling.update(U);O.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);p.screenPointObjectToArray(S.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*S.timestamp);this._constraintOptions.interactionType=q.InteractionType.ZOOM;this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(S.radius-this._beginRadius);C.applyAll(this.view,
this.currentCamera,this._constraintOptions)};T._panningSpherical=function(S){const U=p.screenPointObjectToArray(S.center,this._tmpScreenPointArray);O.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,U,this._tmp3d);O.preserveHeadingThreshold(this._beginScenePoint,t.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(O.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,
this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(U,this._tmp3d,.001*S.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(O.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(U,this._tmp3d,.001*S.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=
q.InteractionType.PAN;this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(A.distance(this._screenPickPoint,U));C.applyAll(this.view,this.currentCamera,this._constraintOptions)};T._rotateSpherical=function(S){t.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||t.negate(this._rotationAxis,this._rotationAxis);var U=this._smoothRotation.value,Y=O.normalizeRotationDelta(S.angle-U);U+=Y;this._smoothRotation.gain=.00125*Math.min(Math.max(S.radius,
40),120);this._smoothRotation.update(U);Y=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(Y,.001*S.timestamp);O.applyRotation(this.currentCamera,this._sphere,z.wrapAxisAngle(this._rotationAxis,Y));this._constraintOptions.interactionType=q.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(S.radius*U);C.applyAll(this.view,this.currentCamera,this._constraintOptions)};T._panningPlanar=function(S){const U=p.screenPointObjectToArray(S.center,
this._tmpScreenPointArray);O.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,U,this._tmp3d)&&(O.applyPanPlanar(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(U,this._tmp3d,.001*S.timestamp),this._constraintOptions.interactionType=q.InteractionType.PAN,this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(A.distance(this._beginScreenPoint,U)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this._tmpInteractionDirection),C.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)};T._zoomPlanar=function(S){const U=this._beginRadius/S.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(S.radius,40),120);this._smoothScaling.update(U);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*S.timestamp);O.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this._constraintOptions.interactionType=q.InteractionType.ZOOM;this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(S.radius-this._beginRadius);C.applyAll(this.view,this.currentCamera,this._constraintOptions)};T._rotatePlanar=function(S){t.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||t.negate(this._rotationAxis,this._rotationAxis);var U=this._smoothRotation.value;let Y=S.angle-U;Y=O.normalizeRotationDelta(Y);this._smoothRotation.gain=.00125*
Math.min(Math.max(S.radius,40),120);this._smoothRotation.update(U+Y);U=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(U,.001*S.timestamp);O.applyRotation(this.currentCamera,this._sphere,z.wrapAxisAngle(this._rotationAxis,U));this._constraintOptions.interactionType=q.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(S.radius*U);C.applyAll(this.view,this.currentCamera,this._constraintOptions)};b._createClass(Q,[{key:"_intersectionHelper",
get:function(){return this.view.sceneIntersectionHelper}}]);return Q}(D.InteractiveController);a.PinchAndPanController=c.__decorate([l.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n){this._gain=n}var m=r.prototype;
m.reset=function(n){this._value=n};m.update=function(n){this._value=void 0===this._value?n:this._gain*n+(1-this._gain)*this._value};b._createClass(r,[{key:"gain",set:function(n){this._gain=n}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return r}();a.ExponentialFalloff=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.PanPlanarMomentumController=function(l){function A(t){t=l.call(this,t)||this;t.interactionType=d.InteractionType.PAN;t._tmpPan=h.create();return t}b._inheritsLoose(A,l);A.prototype.momentumStep=function(t,w){t=this.momentum.value(t);g.scale(this._tmpPan,this.momentum.direction,t);w.eye=g.subtract(e,w.eye,this._tmpPan);w.center=g.subtract(e,w.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan};return A}(f.MomentumController);c.__decorate([r.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([p.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const e=h.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){a.MomentumController=function(u){function z(){var B=u.apply(this,arguments)||this;B._beginCamera=new w.Camera;B._elapsedTimeSec=0;B.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:l.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new w.Camera,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};return B}b._inheritsLoose(z,u);var y=z.prototype;y.initialize=function(){this.constraintOptions.interactionType=this.interactionType;
this.viewAnimation=new d};y.onControllerStart=function(B){this._beginCamera.copyFrom(B);this.constraintOptions.interactionStartCamera=this._beginCamera;u.prototype.onControllerStart.call(this,B)};y.stepController=function(B,C){C.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=B;this.momentumStep(this._elapsedTimeSec,C);f.applyAll(this.view,C,this.constraintOptions)};b._createClass(z,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this._elapsedTimeSec)}}]);return z}(t.AnimationController);
a.MomentumController=c.__decorate([h.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){const l=h.create(),A=h.create();a.PanSphericalMomentumController=function(t){function w(u){u=t.call(this,u)||this;u.interactionType=d.InteractionType.PAN;return u}b._inheritsLoose(w,t);w.prototype.momentumStep=function(u,z){const y=this.momentum.value1(u);u=this.momentum.value2(u);g.copy(A,z.eye);g.normalize(A,A);g.cross(this.momentum.axis2,A,this.momentum.axis1);e.applyRotationWithTwoAxes(z,l,this.momentum.axis1,y,this.momentum.axis2,u)};return w}(f.MomentumController);
c.__decorate([r.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([p.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.RotationMomentumController=function(l){function A(t){t=l.call(this,t)||this;t.interactionType=d.InteractionType.TUMBLE;return t}b._inheritsLoose(A,l);A.prototype.momentumStep=function(t,w){t=this.momentum.value(t);e.applyRotation(w,this.center,h.wrapAxisAngle(this.axis,t))};b._createClass(A,[{key:"center",set:function(t){this._set("center",g.clone(t))}},{key:"axis",set:function(t){this._set("axis",g.clone(t))}}]);return A}(f.MomentumController);c.__decorate([r.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([r.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([r.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([p.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.ZoomPlanarMomentumController=function(l){function A(t){t=l.call(this,t)||this;t.interactionType=d.InteractionType.ZOOM;t.constraintOptions.interactionDirection=h.create();return t}b._inheritsLoose(A,l);A.prototype.momentumStep=function(t,w){g.copy(this.constraintOptions.interactionDirection,w.eye);t=this.momentum.valueDelta(0,t);e.applyZoomToPoint(w,this.zoomCenter,t,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=g.direction(this.constraintOptions.interactionDirection,
w.eye,this.constraintOptions.interactionDirection)};b._createClass(A,[{key:"zoomCenter",set:function(t){this._set("zoomCenter",h.clone(t))}}]);return A}(f.MomentumController);c.__decorate([r.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([r.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([p.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.ZoomSphericalMomentumController=function(w){function u(y){y=w.call(this,y)||this;y.interactionType=l.InteractionType.ZOOM;y.radius=0;y._tmpSceneCenter=h.create();y._tmpZoomAxisAngle=d.create();y._sphere=f.create();return y}b._inheritsLoose(u,w);var z=u.prototype;z.initialize=function(){this._sphere[3]=this.radius};z.momentumStep=function(y,B){y=this.momentum.valueDelta(0,y);t.applyZoomOnSphere(this._sphere,B,y);this.constraintOptions.interactionType=l.InteractionType.ZOOM;
e.applyAll(this.view,B,this.constraintOptions);t.sphereOrPlanePointFromScreenPoint(this._sphere,B,this.screenCenter,this._tmpSceneCenter);d.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);t.applyRotation(B,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=l.InteractionType.PAN};b._createClass(u,[{key:"screenCenter",set:function(y){this._set("screenCenter",r.createScreenPointArray(y[0],y[1]))}},{key:"sceneCenter",set:function(y){this._set("sceneCenter",
h.clone(y))}}]);return u}(A.MomentumController);c.__decorate([m.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([m.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([m.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([m.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,r,m,n){let p=function(g){function h(d,f,e,l,A){d=g.call(this,
d,f,e)||this;d._sceneVelocity=l;d.direction=A;return d}b._inheritsLoose(h,g);h.prototype.value=function(d){return g.prototype.valueFromInitialVelocity.call(this,this._sceneVelocity,d)};return h}(n.Momentum);n=function(){function g(d=300,f=12,e=.84){this._minimumInitialVelocity=d;this._stopVelocity=f;this._friction=e;this.enabled=!0;this._time=new m.FilteredFiniteDifference(.6);this._screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this._scene=[new m.FilteredFiniteDifference(.6),
new m.FilteredFiniteDifference(.6),new m.FilteredFiniteDifference(.6)];this._tmpDirection=r.create()}var h=g.prototype;h.add=function(d,f,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(d[0]),this._screen[1].update(d[1]),this._scene[0].update(f[0]),this._scene[1].update(f[1]),this._scene[2].update(f[2]),this._time.update(e))};h.reset=function(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();
this._time.reset()};h.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var d=this._screen[0].filteredDelta,f=this._screen[1].filteredDelta;d=null==d||null==f?0:Math.sqrt(d*d+f*f);f=this._time.filteredDelta;d=null==f||null==d?0:d/f;return Math.abs(d)<this._minimumInitialVelocity?null:this.createMomentum(d,this._stopVelocity,this._friction)};h.createMomentum=function(d,f,e){c.set(this._tmpDirection,this._scene[0].filteredDelta??
0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const l=c.length(this._tmpDirection);0<l&&c.scale(this._tmpDirection,this._tmpDirection,1/l);const A=this._time.filteredDelta;return new p(d,f,e,null==A?0:l/A,this._tmpDirection)};return g}();a.PanPlanarMomentum=p;a.PanPlanarMomentumEstimator=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){let b=
function(){function c(m){this._gain=m;this.filteredDelta=this.lastValue=void 0}var r=c.prototype;r.update=function(m){if(this.hasLastValue()){const n=this.computeDelta(m);this._updateDelta(n)}this.lastValue=m};r.reset=function(){this.filteredDelta=this.lastValue=void 0};r.hasLastValue=function(){return void 0!==this.lastValue};r.hasFilteredDelta=function(){return void 0!==this.filteredDelta};r.computeDelta=function(m){return void 0===this.lastValue?NaN:m-this.lastValue};r._updateDelta=function(m){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*m:m};return c}();a.FilteredFiniteDifference=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n,p,g){this._initialVelocity=n;this._stopVelocity=p;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/
Math.log(1-this._friction))}var m=r.prototype;m.isFinished=function(n){return n>this.duration};m.value=function(n){return this.valueFromInitialVelocity(this._initialVelocity,n)};m.valueDelta=function(n,p){const g=this.value(n);return this.value(n+p)-g};m.valueFromInitialVelocity=function(n,p){p=Math.min(p,this.duration);const g=1-this.friction;return n*(g**p-1)/Math.log(g)};b._createClass(r,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);
return r}();a.Momentum=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,b,c,r,m,n,p,g,h){let d=function(f){function e(A,t,w,u,z,y=0,B){A=f.call(this,A,t,w)||this;A._angularVelocity1=
u;A.axis1=z;A.angularVelocity2=y;A.axis2=B;return A}b._inheritsLoose(e,f);var l=e.prototype;l.value1=function(A){return f.prototype.valueFromInitialVelocity.call(this,this._angularVelocity1,A)};l.value2=function(A){return f.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,A)};return e}(h.Momentum);h=function(){function f(l=300,A=12,t=.84){this._minimumInitialVelocity=l;this._stopVelocity=A;this._friction=t;this.enabled=!0;this._tmpAxis1=m.create();this._tmpAxis2=m.create();this._tmpAngles=
c.create();this._time=new p.FilteredFiniteDifference(.3);this._screen=[new p.FilteredFiniteDifference(.4),new p.FilteredFiniteDifference(.4)];this._angle1=new g.FilteredValue(.6);this._angle2=new g.FilteredValue(.6);this._axis1=m.create();this._axis2=m.create();this._lastScene=m.create()}var e=f.prototype;e.addMomentumDirectRotation=function(l,A,t,w,u,z){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(t))return;w=n.rotationAngleAndAxisDirectRotation(this._lastScene,A,
this._tmpAxis2,w,u,z);this._angle2.update(0);1E-5>r.squaredLength(this._tmpAxis2)?w=0:r.normalize(this._axis1,this._tmpAxis2);this._angle1.update(w);r.copy(this._lastScene,A)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(t)}};e.addMomentumPreserveHeading=function(l,A,t,w,u,z,y){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(t))return;n.rotationAnglesAndAxesHeadingPreserving(this._lastScene,A,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,
w,u,z,y,!1);1E-5>r.squaredLength(this._tmpAxis2)?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),r.normalize(this._axis1,this._tmpAxis1),r.normalize(this._axis2,this._tmpAxis2));r.copy(this._lastScene,A)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(t)}};e.reset=function(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()};e.evaluateMomentum=
function(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var l=this._screen[0].filteredDelta,A=this._screen[1].filteredDelta;l=null==l||null==A?null:Math.sqrt(l*l+A*A);A=this._time.filteredDelta;l=null==l||null==A?0:l/A;return Math.abs(l)<this._minimumInitialVelocity?null:this.createMomentum(l,this._stopVelocity,this._friction)};e.createMomentum=function(l,A,t){const w=this._time.filteredDelta,u=this._angle1.filteredValue,z=this._angle2.filteredValue;return new d(l,A,t,null==w||
null==u?0:u/w,this._axis1,null==w||null==z?0:z/w,this._axis2)};return f}();a.PanSphericalMomentum=d;a.PanSphericalMomentumEstimator=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(n){this._gain=n}var m=r.prototype;m.update=function(n){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+
this._gain*n:n};m.reset=function(){this.filteredValue=void 0};b._createClass(r,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return r}();a.FilteredValue=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(r){function m(n=3,p=.01,g=.95,h=12){return r.call(this,
n,p,g,h)||this}b._inheritsLoose(m,r);m.prototype.add=function(n,p){const g=this.value.lastValue;if(null!=g){for(n-=g;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;n=g+n}r.prototype.add.call(this,n,p)};return m}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,
b,c,r){let m=function(){function n(g=2.5,h=.01,d=.95,f=12){this._minimumInitialVelocity=g;this._stopVelocity=h;this._friction=d;this._maxVelocity=f;this.enabled=!0;this.value=new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}var p=n.prototype;p.add=function(g,h){if(this.enabled&&null!=h){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(h))return;if(this.value.hasFilteredDelta()){const d=this.value.computeDelta(g);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(h);
this.value.update(g)}};p.reset=function(){this.value.reset();this.time.reset()};p.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let g=this.value.filteredDelta/this.time.filteredDelta;g=b.clamp(g,-this._maxVelocity,this._maxVelocity);return Math.abs(g)<this._minimumInitialVelocity?null:this.createMomentum(g,this._stopVelocity,this._friction)};p.createMomentum=function(g,h,d){return new r.Momentum(g,h,d)};return n}();a.MomentumEstimator=
m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,b,c,r){let m=function(n){function p(h,d,f){return n.call(this,h,d,f)||this}b._inheritsLoose(p,n);var g=p.prototype;g.value=function(h){h=n.prototype.value.call(this,h);return Math.exp(h)};g.valueDelta=function(h,d){const f=n.prototype.value.call(this,
h);h=n.prototype.value.call(this,h+d);return Math.exp(h-f)};return p}(c.Momentum);c=function(n){function p(h=2.5,d=.01,f=.95,e=12){return n.call(this,h,d,f,e)||this}b._inheritsLoose(p,n);var g=p.prototype;g.add=function(h,d){n.prototype.add.call(this,Math.log(h),d)};g.createMomentum=function(h,d,f){return new m(h,d,f)};return p}(r.MomentumEstimator);a.ZoomMomentum=m;a.ZoomMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K){const O=t.fromValues(0,0,1);var P=16/180*Math.PI;a.PinchAndPanController=function(N){function H(){var I=N.apply(this,arguments)||this;I._rotationValueSmooth=new k.ExponentialFalloff(.05);I._scalingValueSmooth=new k.ExponentialFalloff(.05);I._planeHorizontal=u.create();I._planeVertical=u.create();I._rotationMomentumEstimator=new L.RotationMomentumEstimator;I._panMomentumEstimator=new J.PanPlanarMomentumEstimator(300,12,.9);I._zoomMomentumEstimator=
new K.ZoomMomentumEstimator;I._beginCenter=t.create();I._tmpPoints=[];I._beginCenterScreen=n.createScreenPointArray();I._tmpCentroid3d=t.create();I._tmpCentroid2d=n.createScreenPointArray();I._tmp2d=n.createScreenPointArray();I._constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:B.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.Camera,interactionDirection:null,tiltMode:C.TiltMode.TUMBLE};return I}b._inheritsLoose(H,N);var E=H.prototype;E.begin=function(I){if(this.active){var M=
this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=M;this._rotationMomentumEstimator.enabled=M;this._panMomentumEstimator.enabled=M;this._beginRadius=I.radius;this._pointerCount=I.pointers.size;this._beginAngle=I.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();n.screenPointObjectToArray(I.center,this._beginCenterScreen);u.fromNormalAndOffset(O,0,this._planeHorizontal);var Q=t.create();M=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,
Q);var T=t.create();A.negate(T,this.startCamera.viewForward);var S=t.create();A.copy(S,O);var U=A.dot(T,S);this._panMode=r.asinClamped(0>U?-U:U)>=P?F.NavigationMode.Horizontal:F.NavigationMode.Vertical;u.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,Q);this.startCamera.aboveGround||u.negate(this._planeHorizontal,this._planeHorizontal);if(this._panMode===F.NavigationMode.Vertical){A.scale(S,S,U);A.subtract(this._planeVertical,T,S);A.normalize(this._planeVertical,this._planeVertical);
u.setOffsetFromPoint(this._planeVertical,this._planeVertical,Q);T=t.create();S=t.create();U=t.create();A.subtract(T,Q,this.currentCamera.eye);Q=A.length(T);A.normalize(T,T);var Y=5*Math.max(Math.abs(this.view.camera.position.z),50);const V=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,80);Y=m.isSome(V)?Math.min(V,Y):Y;Y=M?Math.min(Y,Q):Y;A.copy(U,A.add(S,this.currentCamera.eye,A.scale(S,T,Y)));this._planeVertical[3]=
-A.dot(this._planeVertical,U);this._computePlanePoints(I.pointers,this._planeVertical,this.startCamera,this._tmpPoints)}else this._computePlanePoints(I.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints);F.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};E.update=function(I){if(this.active){this.currentCamera.copyFrom(this.startCamera);var M=1<I.pointers.size,Q=this._panMode===F.NavigationMode.Horizontal?this._planeHorizontal:
this._planeVertical,T=this._beginCenter;if(M){var S=this._beginRadius/I.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(I.radius,40),120);this._scalingValueSmooth.update(S);F.applyZoomToPoint(this.currentCamera,T,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*I.timestamp);this._constraintOptions.interactionType=B.InteractionType.ZOOM;this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(Math.abs(I.radius-
this._beginRadius));z.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(I.pointers,Q,this.currentCamera,this._tmpPoints);F.centroid(this._tmpPoints,this._tmpCentroid3d);n.screenPointObjectToArray(I.center,this._tmpCentroid2d);F.applyPanPlanar(this.currentCamera,T,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*I.timestamp);this._constraintOptions.interactionType=B.InteractionType.PAN;this._constraintOptions.interactionFactor=
z.pixelDistanceToInteractionFactor(l.distance(this._beginCenterScreen,this._tmpCentroid2d));z.applyAll(this.view,this.currentCamera,this._constraintOptions);M&&(M=this._planeHorizontal,Q=this._rotationValueSmooth.value,S=F.normalizeRotationDelta(I.angle-Q),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(I.radius,40),120),this._rotationValueSmooth.update(Q+S),Q=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(Q,.001*I.timestamp),F.applyRotation(this.currentCamera,
T,w.wrapAxisAngle(M,Q)),this._constraintOptions.interactionType=B.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(Math.abs(I.radius*Q)),z.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}};E.end=function(I){I.pointers.size===this._pointerCount&&this.update(I);this.finishController();return(I=this._zoomMomentumEstimator.evaluateMomentum())?new D.ZoomPlanarMomentumController({view:this.view,momentum:I,zoomCenter:this._beginCenter}):
(I=this._rotationMomentumEstimator.evaluateMomentum())?new v.RotationMomentumController({view:this.view,momentum:I,center:this._beginCenter,axis:u.normal(this._planeHorizontal)}):(I=this._panMomentumEstimator.evaluateMomentum())?new x.PanPlanarMomentumController({view:this.view,momentum:I}):null};E._computePlanePoints=function(I,M,Q,T){T.length=I.size;const S=this._tmp2d;let U=0;I.forEach(Y=>{S[0]=Y.x;S[1]=Y.y;void 0===T[U]&&(T[U]=t.create());F.intersectPlaneFromScreenPointAtEye(M,Q,S,T[U]);U+=1});
return T};b._createClass(H,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return H}(q.InteractiveController);a.PinchAndPanController=c.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../input/InputHandler"],function(a,b,c){c=function(r){function m(n,p){var g=r.call(this,!0)||this;g.view=n;g.registerIncoming("pointer-down",p,()=>g.view.state.stopActiveCameraController());return g}b._inheritsLoose(m,r);return m}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./SingleKey"],function(a,b,c){c=function(r){function m(n,p,g){p=r.call(this,p,g)||this;p.view=n;return p}b._inheritsLoose(m,r);m.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return m}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,
b,c){c=function(r){function m(n,p){var g=r.call(this,!0)||this;g.key=n;g.registerIncoming("key-down",p,h=>g._handleKeyDown(h));return g}b._inheritsLoose(m,r);m.prototype._handleKeyDown=function(n){n.data.key===this.key&&(this.activate(),n.stopPropagation())};return m}(c.InputHandler);a.SingleKey=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./SingleKey"],function(a,b,c){c=function(r){function m(n,p,g){p=r.call(this,p,g)||this;p.view=n;return p}b._inheritsLoose(m,r);m.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return m}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController",
"../../../input/InputHandler"],function(a,b,c,r,m){m=function(n){function p(g,h=!1){var d=n.call(this,!0)||this;d._view=g;d._invert=h;d.registerIncoming("vertical-two-finger-drag",f=>d._handleTwoFinger(f));return d}b._inheritsLoose(p,n);p.prototype._handleTwoFinger=function(g){const h=c.createScreenPointArray(0,g.data.delta*(this._invert?-1:1));switch(g.data.action){case "begin":this._cameraController?.end();this._cameraController=new r.RotateController({view:this._view,pivot:r.PivotPoint.CENTER});
this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(h);break;case "update":this._cameraController?.update(h);break;case "end":this._cameraController?.end(),this._cameraController=null}};return p}(m.InputHandler);a.TwoFingerTilt=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),
function(a,b,c,r,m,n,p){const g=c("trident"),h=c("edge"),d=c("chrome"),f=c("ff"),e=c("safari");c=function(){function A(w,u){this._input=u;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=w;w.getAttribute("tabindex")||w.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,
"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new n.GamepadSource(w,this._input);this._gamepadSource.onEvent=z=>this._callback("gamepad",z)}var t=A.prototype;t.destroy=function(){this.activeEvents=
this._callback=null;this._activePointerCaptures.forEach(w=>{this._releasePointerCaptureSafe(w)});this._gamepadSource=r.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};t.setPointerCapture=function(w,u){u?(this._element.setPointerCapture(w.pointerId),this._activePointerCaptures.add(w.pointerId)):(this._releasePointerCaptureSafe(w.pointerId),this._activePointerCaptures.delete(w.pointerId))};
t._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};t._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};
t._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};t._releasePointerCaptureSafe=function(w){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(w)||this._element.releasePointerCapture(w)}catch(u){}};t._updateNormalizedPointerLikeEvent=function(w,u){w=p.createScreenPointFromNativeEvent(this._element,
w);A.test.disableSubpixelCoordinates&&(w.x=Math.round(w.x),w.y=Math.round(w.y));u.x=w.x;u.y=w.y;return u};t._handleKey=function(w,u){const z=m.eventKey(u);z&&"key-up"===w&&this._keyDownState.delete(z);u={native:u,key:z,repeat:z&&this._keyDownState.has(z)};z&&"key-down"===w&&this._keyDownState.add(u.key);this._callback(w,u)};t._handlePointer=function(w,u){u=this._updateNormalizedPointerLikeEvent(u,{native:u,x:0,y:0,pointerType:u.pointerType,button:u.button,buttons:u.buttons,eventId:this._eventId++});
this._callback(w,u)};t._handlePointerPreventDefault=function(w,u){const z=this._updateNormalizedPointerLikeEvent(u,{native:u,x:0,y:0,pointerType:u.pointerType,button:u.button,buttons:u.buttons,eventId:this._eventId++});u.preventDefault();this._callback(w,z)};t._handleMouseWheel=function(w,u){let z=u.deltaY;switch(u.deltaMode){case 0:if(g||h)z=z/document.documentElement.clientHeight*600;break;case 1:z*=30;break;case 2:z*=900}g||h?z*=.7:d||e?z*=.6:f&&(z*=1.375);const y=Math.abs(z);100<y&&(z=z/y*200/
(1+Math.exp(-.02*(y-100))));u=this._updateNormalizedPointerLikeEvent(u,{native:u,x:0,y:0,deltaY:z});this._callback(w,u)};t._handlePointerCaptureLost=function(w,u){this._activePointerCaptures.delete(u.pointerId);this._handleDefault(w,u)};t._handleDefault=function(w,u){const z={native:u};u.preventDefault();this._callback(w,z)};t._preventAltKeyDefault=function(w){"Alt"===w.key&&w.preventDefault()};t._preventMultiTouchPanning=function(w){1<w.touches.length&&w.preventDefault()};b._createClass(A,[{key:"browserTouchPanningEnabled",
get:function(){return this._browserTouchPanningEnabled},set:function(w){this._browserTouchPanningEnabled=w;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(w){this._callback=w}},{key:"activeEvents",set:function(w){for(const u in this._active)w&&w.has(u)||(this._element.removeEventListener(l[u],this._active[u]),delete this._active[u]);w&&w.forEach(u=>{if(!this._active[u]&&l[u]){const z=(this._eventHandlers[u]||this._handleDefault).bind(this,u);this._element.addEventListener(l[u],
z);this._active[u]=z}});this._gamepadSource.hasEventListeners=w&&w.has("gamepad")}}]);return A}();c.test={disableSubpixelCoordinates:!1};const l={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",
blur:"blur"};a.BrowserEventSource=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,r,m){let n=function(){function p(h,d){this._element=h;this._input=d;this._hasEventListeners=!1;this._onConnectGamepad=f=>{this._connectGamepad(f.gamepad)};this._onDisconnectGamepad=
f=>{f=f.gamepad;const e=f.index,l=this._inputDevices[e];l&&(this._emitGamepadEvent(f,m.extractState(l),!1),this._inputDevices.splice(e,1),this._latestUpdate.splice(e,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;h=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&h)this._forEachGamepad(f=>this._connectGamepad(f)),window.addEventListener("gamepadconnected",this._onConnectGamepad),
window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}var g=p.prototype;g.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};g._connectGamepad=function(h){const d=new r(h);"unknown"!==d.deviceType&&(this._inputDevices[h.index]=d,this._input.gamepad.devices.add(d));this.ensurePollingState()};g.ensurePollingState=
function(){this._eventsEnabled?this._startPolling():this._stopPolling()};g._startPolling=function(){null==this._frameTask&&(this._frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};g._stopPolling=function(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=[])};g._readGamepadState=function(){const h=document.hasFocus(),d=this._element.contains(document.activeElement),f="document"===this._input.gamepad.enabledFocusMode&&!h||"view"===this._input.gamepad.enabledFocusMode&&
!d;this._forEachGamepad(e=>{var l=this._inputDevices[e.index];if(l){var A=this._latestUpdate[e.index];l=m.extractState(l);var t=f||m.stateIdle(l);A&&(A.timestamp===e.timestamp||!A.active&&t||m.stateEqual(A.state,l))||this._emitGamepadEvent(e,l,!t)}})};g._forEachGamepad=function(h){const d=window.navigator.getGamepads();for(let f=0;f<d.length;f++){const e=d[f];this._validate(e)&&h(e)}};g._emitGamepadEvent=function(h,d,f){var e=this._latestUpdate[h.index];if((e=e&&e.active)||f)this._latestUpdate[h.index]=
{timestamp:h.timestamp,state:d,active:f},this._callback&&this._callback({device:this._inputDevices[h.index],state:d,action:!e&&f?"start":e&&f?"update":"end"})};g._validate=function(h){if(!h||!h.connected)return!1;for(let d=0;d<h.axes.length;d++)if(isNaN(h.axes[d]))return!1;return!0};b._createClass(p,[{key:"hasEventListeners",set:function(h){this._hasEventListeners!==h&&(this._hasEventListeners=h,this.ensurePollingState())}},{key:"_eventsEnabled",get:function(){return this.supported&&0<this._inputDevices.length&&
this._hasEventListeners}},{key:"onEvent",set:function(h){this._callback=h}}]);return p}();a.GamepadSource=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:c.axes.map(r=>{{var m=b.axisThreshold;const n=Math.abs(r);r=n<m?0:Math.sign(r)*(n-m)/(1-m)}return r})}:{buttons:[],
axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;for(var r=0;r<b.axes.length;r++)if(b.axes[r]!==c.axes[r])return!1;for(r=0;r<b.buttons.length;r++)if(b.buttons[r]!==c.buttons[r])return!1;return!0};a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,b,c){c=function(r){function m(){var n=r.call(this,!0)||this;n.registerIncoming("context-menu",p=>{p.data.native.preventDefault()});return n}b._inheritsLoose(m,r);return m}(c.InputHandler);a.PreventContextMenu=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),
function(a,b,c,r,m,n){function p(f){const e=[];f.forEach(l=>{e.push(c.createScreenPoint(l.event.x,l.event.y))});return n.fitCircleLSQ(e)}function g(f){const e=p(f);let l=0;f.forEach(A=>{var t=d(A,e);for(t-=A.lastAngle;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;t=A.lastAngle+t;A.lastAngle=t;l+=t-A.initialAngle});l/=f.size||1;return{angle:l,radius:e.radius,center:e.center}}function h(f){const e=new Map;f.forEach((l,A)=>e.set(A,l.event));return e}function d(f,e){f=f.event;return Math.atan2(f.y-
e.center.y,f.x-e.center.x)}m=function(f){function e(A){var t=f.call(this,!1)||this;t._navigationTouch=A;t._startStateModifiers=new Set;t._activePointerMap=new Map;t._isDragging=!1;t._isCurrentDragSuppressed=!1;t._drag=t.registerOutgoing("drag");t.registerIncoming("pointer-drag",t._handlePointerDrag.bind(b._assertThisInitialized(t)));t.registerIncoming("pointer-up",t._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(t)));t.registerIncoming("pointer-capture-lost",t._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(t)));
t.registerIncoming("pointer-cancel",t._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(t)));return t}b._inheritsLoose(e,f);var l=e.prototype;l._createPayload=function(A,t,w,u){return{action:A,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:u,pointers:h(this._activePointerMap),pointer:t,angle:w.angle,radius:w.radius,center:w.center}};l._addPointer=function(A){var t=A.native.pointerId;const w=g(this._activePointerMap).angle;A={event:A,initialAngle:0,lastAngle:0};
this._activePointerMap.set(t,A);t=d(A,p(this._activePointerMap));A.initialAngle=t;A.lastAngle=t;this._updatePointerAngles(w)};l._updatePointer=function(A){if(!A||null!=A.x||null!=A.y){var t=this._activePointerMap.get(A.native.pointerId);t?t.event=A:this._addPointer(A)}};l._removePointer=function(A){const t=g(this._activePointerMap).angle;this._activePointerMap.delete(A);this._updatePointerAngles(t)};l._updatePointerAngles=function(A){const t=g(this._activePointerMap);this._activePointerMap.forEach(w=>
{w.initialAngle=d(w,t)-A;w.lastAngle=d(w,t)-A})};l._emitEvent=function(A,t,w){const u=g(this._activePointerMap);this._drag.emit(this._createPayload(A,t,u,w),void 0,this._startStateModifiers)};l._handlePointerUpAndPointerLost=function(A){const t=A.data.native.pointerId,w=r.Milliseconds(A.timestamp);this._activePointerMap.get(t)&&(1===this._activePointerMap.size?(this._updatePointer(A.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",A.data,w),this._isCurrentDragSuppressed=this._isDragging=
!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",A.data,r.Milliseconds(A.timestamp))))};l._handlePointerDrag=function(A){const t=A.data,w=t.currentEvent,u=r.Milliseconds(A.timestamp);switch(t.action){case "start":case "update":this._isDragging?this._activePointerMap.has(w.native.pointerId)?(this._updatePointer(w),!this._isCurrentDragSuppressed&&this._emitEvent("update",w,u)):(this._addPointer(w),this._emitEvent("added",w,u),this._isCurrentDragSuppressed=this._isSuppressed):
(this._updatePointer(w),this._pointerType=A.data.startEvent.pointerType,this._mouseButton=A.data.startEvent.button,this._startStateModifiers=A.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",w,u))}};b._createClass(e,[{key:"_isSuppressed",get:function(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}]);return e}(m.InputHandler);
a.Button=void 0;(function(f){f[f.Left=0]="Left";f[f.Middle=1]="Middle";f[f.Right=2]="Right";f[f.Back=3]="Back";f[f.Forward=4]="Forward";f[f.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,r){const m=r.x-c.x;c=r.y-c.y;return Math.sqrt(m*m+c*c)};a.fitCircleLSQ=
function(c,r){r?(r.radius=0,r.center.x=0,r.center.y=0):r={radius:0,center:b.createScreenPoint()};if(0===c.length)return r;if(1===c.length)return r.center.x=c[0].x,r.center.y=c[0].y,r;if(2===c.length){const [w,u]=c,[z,y]=[u.x-w.x,u.y-w.y];r.radius=Math.sqrt(z*z+y*y)/2;r.center.x=(w.x+u.x)/2;r.center.y=(w.y+u.y)/2;return r}let m=0,n=0;for(r=0;r<c.length;r++)m+=c[r].x,n+=c[r].y;m/=c.length;n/=c.length;var p=c.map(w=>w.x-m),g=c.map(w=>w.y-n);let h=r=0;var d=0,f=0,e=0,l=0,A=0;for(var t=0;t<p.length;t++){const w=
p[t],u=g[t],z=w*w,y=u*u;r+=z;h+=y;d+=w*u;f+=z*w;e+=y*u;l+=w*y;A+=u*z}p=r;g=d;t=h;f=.5*(f+l);e=.5*(e+A);A=p*t-d*g;l=(f*t-e*g)/A;e=(p*e-d*f)/A;A=b.createScreenPoint(l+m,e+n);return{radius:Math.sqrt(l*l+e*e+(r+h)/c.length),center:A}};a.getPointerId=function(c){({native:c}=c);const {pointerId:r,button:m,pointerType:n}=c;return"mouse"===n?`${r}:${m}`:`${n}`};a.manhattanDistance=function(c,r){return Math.abs(r.x-c.x)+Math.abs(r.y-c.y)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,b,c,r,m,n){r=function(p){function g(d=m.DefaultParameters.maximumDoubleClickDelay,f=m.DefaultParameters.maximumDoubleClickDistance,e=m.DefaultParameters.maximumDoubleTouchDelay,l=m.DefaultParameters.maximumDoubleTouchDistance,A=c.clock){var t=p.call(this,!1)||this;t._maximumDoubleClickDelay=
d;t._maximumDoubleClickDistance=f;t._maximumDoubleTouchDelay=e;t._maximumDoubleTouchDistance=l;t._clock=A;t._pointerState=new Map;t._immediateDoubleClick=t.registerOutgoing("immediate-double-click");t.registerIncoming("pointer-down",t._handlePointerDown.bind(b._assertThisInitialized(t)));t.registerIncoming("pointer-up",t._handlePointerUp.bind(b._assertThisInitialized(t)));return t}b._inheritsLoose(g,p);var h=g.prototype;h.onUninstall=function(){this._pointerState.forEach(d=>{d.immediateDoubleClick&&
d.immediateDoubleClick.timeoutHandle.remove()});p.prototype.onUninstall.call(this)};h._handlePointerDown=function(d){d=d.data;const f=n.getPointerId(d);this._pointerState.has(f)||(this._pointerState.set(f,{downButton:d.native.button,immediateDoubleClick:null}),this.startCapturingPointer(d.native))};h._handlePointerUp=function(d){const f=d.data;var e=n.getPointerId(f);if((e=this._pointerState.get(e))&&e.downButton===f.native.button){const l=e.immediateDoubleClick;if(l){l.timeoutHandle.remove();const A=
"touch"===d.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n.manhattanDistance(l,d.data)>A?this._startImmediateDoubleClick(d,e):(this._immediateDoubleClick.emit(d.data,void 0,l.modifiers),this._removeState(f))}else this._startImmediateDoubleClick(d,e)}};h._startImmediateDoubleClick=function(d,f){f.immediateDoubleClick={x:d.data.x,y:d.data.y,modifiers:d.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(d.data),"touch"===d.data.native.pointerType?
this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}};h._removeState=function(d){const f=n.getPointerId(d);this._pointerState.delete(f);this.stopCapturingPointer(d.native);this.refreshHasPendingInputs()};return g}(r.InputHandler);a.ImmediateDoubleClick=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,c,r,m,n,p){const g={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(h){function d(e=g.maximumDoubleClickDelay,l=g.maximumDoubleClickDistance,A=g.maximumDoubleTouchDelay,t=g.maximumDoubleTouchDistance,w=c.clock){var u=h.call(this,!1)||this;u._maximumDoubleClickDelay=e;u._maximumDoubleClickDistance=l;u._maximumDoubleTouchDelay=A;u._maximumDoubleTouchDistance=t;u._clock=w;u._pointerState=new Map;u._click=u.registerOutgoing("click");
u._doubleClick=u.registerOutgoing("double-click");u.registerIncoming("immediate-click",u._handleImmediateClick.bind(b._assertThisInitialized(u)));u.registerIncoming("pointer-down",u._handlePointerDown.bind(b._assertThisInitialized(u)));return u}b._inheritsLoose(d,h);var f=d.prototype;f.onUninstall=function(){this._pointerState.forEach(e=>e.doubleClickTimer=m.removeMaybe(e.doubleClickTimer))};f._clearDoubleClickTimer=function(e,l){const A=this._pointerState.get(e);A&&(A.doubleClickTimer=m.removeMaybe(A.doubleClickTimer),
l&&this._click.emit(A.event.data,void 0,A.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())};f._doubleClickTimeoutExceeded=function(e){const l=this._pointerState.get(e);1===l.pointerDownCount&&this._click.emit(l.event.data,void 0,l.event.modifiers);l.doubleClickTimer=null;this._pointerState.delete(e);this.refreshHasPendingInputs()};f._getPointerId=function(e){const {pointerId:l,pointerType:A,button:t}=e.native;return"mouse"===A?`${l}:${t}`:`${A}`};f._handleImmediateClick=
function(e){const l=e.data;var {pointerType:A}=l.native;const t=this._getPointerId(l);if(this._pointerState.has(t)){var w=this._pointerState.get(t),{data:u,modifiers:z}=w.event;A="touch"===A?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;p.manhattanDistance(u,l)>A?(this._clearDoubleClickTimer(t,!0),this._startClick(e)):(this._clearDoubleClickTimer(t,!1),2===w.pointerDownCount&&this._doubleClick.emit(u,void 0,z))}else this._startClick(e)};f._handlePointerDown=function(e){e=p.getPointerId(e.data);
if(e=this._pointerState.get(e))e.pointerDownCount+=1};f._startClick=function(e){var {data:l}=e;const {native:{pointerType:A}}=l,t=p.getPointerId(l);l=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(t),"touch"===A?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(t,{event:e,doubleClickTimer:l,pointerDownCount:1});this.refreshHasPendingInputs()};b._createClass(d,[{key:"hasPendingInputs",get:function(){return r.someMap(this._pointerState,e=>null!=e.doubleClickTimer)}}]);
return d}(n.InputHandler);a.DefaultParameters=g;a.SingleAndDoubleClick=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,r,m,n){const p={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};
m=function(g){function h(f=p.maximumClickDelay,e=p.movementUntilMouseDrag,l=p.movementUntilPenDrag,A=p.movementUntilTouchDrag,t=p.holdDelay,w=c.clock){var u=g.call(this,!1)||this;u._maximumClickDelay=f;u._movementUntilMouseDrag=e;u._movementUntilPenDrag=l;u._movementUntilTouchDrag=A;u._holdDelay=t;u._clock=w;u._pointerState=new Map;u._pointerDrag=u.registerOutgoing("pointer-drag");u._immediateClick=u.registerOutgoing("immediate-click");u._pointerHold=u.registerOutgoing("hold");u.registerIncoming("pointer-down",
u._handlePointerDown.bind(b._assertThisInitialized(u)));u.registerIncoming("pointer-up",z=>{u._handlePointerLoss(z,"pointer-up")});u.registerIncoming("pointer-capture-lost",z=>{u._handlePointerLoss(z,"pointer-capture-lost")});u.registerIncoming("pointer-cancel",z=>{u._handlePointerLoss(z,"pointer-cancel")});u._moveHandle=u.registerIncoming("pointer-move",u._handlePointerMove.bind(b._assertThisInitialized(u)));u._moveHandle.pause();return u}b._inheritsLoose(h,g);var d=h.prototype;d.onUninstall=function(){this._pointerState.forEach(f=>
{f.holdTimeout=r.removeMaybe(f.holdTimeout)});g.prototype.onUninstall.call(this)};d._handlePointerDown=function(f){const e=f.data,l=e.native.pointerId;var A=null;0===this._pointerState.size&&(A=this._clock.setTimeout(()=>{const t=this._pointerState.get(l);t&&(t.isDragging||(this._pointerHold.emit(t.previousEvent,void 0,f.modifiers),t.holdEmitted=!0),t.holdTimeout=null)},this._holdDelay));A={startEvent:e,previousEvent:e,startTimestamp:f.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:A,
modifiers:new Set};this._pointerState.set(l,A);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(f)};d._createPointerDragData=function(f,e,l){return{action:f,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:l}};d._handlePointerMove=function(f){const e=f.data,l=this._pointerState.get(e.native.pointerId);if(l){if(l.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",l,e),void 0,l.modifiers);else{const A=
n.euclideanDistance(e,l.startEvent),t=this._getDragThreshold(e.native.pointerType);A>t&&this._startDragging(f)}l.previousEvent=e}};d._getDragThreshold=function(f){switch(f){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}};d._startDragging=function(f){const e=f.data,l=e.native.pointerId;this._pointerState.forEach(A=>{null!=A.holdTimeout&&(A.holdTimeout.remove(),A.holdTimeout=null);A.isDragging||(A.modifiers=
f.modifiers,A.isDragging=!0,l===A.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",A,e)):this._pointerDrag.emit(this._createPointerDragData("start",A,A.previousEvent),f.timestamp))})};d._handlePointerLoss=function(f,e){const l=f.data,A=l.native.pointerId,t=this._pointerState.get(A);t&&(null!=t.holdTimeout&&(t.holdTimeout.remove(),t.holdTimeout=null),t.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",t,"pointer-up"===e?l:t.previousEvent),void 0,
t.modifiers):"pointer-up"===e&&t.downButton===l.native.button&&f.timestamp-t.startTimestamp<=this._maximumClickDelay&&!t.holdEmitted&&this._immediateClick.emit(l),this._pointerState.delete(A),this.stopCapturingPointer(l.native),0===this._pointerState.size&&this._moveHandle.pause())};return h}(m.InputHandler);a.DefaultParameters=p;a.PointerClickHoldAndDrag=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,b,c,r){r=function(m){function n(g=20,h=40){var d=m.call(this,!1)||this;d._threshold=g;d._maxDelta=h;d._state="ready";d._emittedArtificalEnd2=!1;d._vertical=d.registerOutgoing("vertical-two-finger-drag");d._artificalDrag=d.registerOutgoing("drag");d._dragEventSeparator=new c.DragEventSeparator({start:(f,e)=>d._observeStart(f,e),update:(f,e,l)=>d._observeUpdate(f,e,l),end:(f,e)=>d._observeEnd(e)});d.registerIncoming("drag",
f=>d._dragEventSeparator.handle(f));return d}b._inheritsLoose(n,m);var p=n.prototype;p._observeStart=function(g,h){1===g&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,timestamp:h.data.timestamp,pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),h.stopPropagation());this._state=2===g?"ready":"failed"};p._observeUpdate=
function(g,h,d){"failed"!==this._state&&2===g&&("active"===this._state?(this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"update"}),h.stopPropagation()):this._checkMovementWithinLimits(h.data,d.data)?this._checkVerticalThresholdReached(h.data,d.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=h.data.center,this._artificalDrag.emit({action:"end",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,timestamp:h.data.timestamp,
pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),h.stopPropagation()):this._state="failed")};p._observeEnd=function(g){"active"===this._state&&(this._vertical.emit({delta:g.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",g.stopPropagation())};p._checkMovementWithinLimits=function(g,h){let d=-Infinity,f=Infinity,e=-Infinity,
l=Infinity;for(const {x:z,y}of h.pointers.values())d=Math.max(d,z),f=Math.min(f,z),e=Math.max(e,y),l=Math.min(l,y);let A=-Infinity,t=Infinity,w=-Infinity,u=Infinity;for(const {x:z,y}of g.pointers.values())A=Math.max(A,z),t=Math.min(t,z),w=Math.max(w,y),u=Math.min(u,y);return Math.abs(g.center.x-h.center.x)<this._threshold&&Math.abs(A-t-(d-f))<=this._maxDelta&&Math.abs(w-u-(e-l))<=this._maxDelta};p._checkVerticalThresholdReached=function(g,h){let d=Math.abs(g.center.y-h.center.y);g.pointers.forEach((f,
e)=>{e=h.pointers.get(e);d=Math.min(d,Math.abs(f.y-e.y))});return d>=this._threshold};b._createClass(n,[{key:"failed",get:function(){return"failed"===this._state}}]);return n}(r.InputHandler);a.VerticalTwoFingerDrag=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let b=function(){function c(m){this._callbacks=m;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=
()=>!0)}var r=c.prototype;r.handle=function(m){const n=m.data,p=n.pointers.size;switch(n.action){case "start":this._currentCount=p;this._emitStart(m);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=p;this._emitStart(m);break;case "update":this._emitUpdate(m);break;case "removed":this._startEvent&&this._emitEnd(this._previousEvent);this._currentCount=p;this._emitStart(m);break;case "end":this._emitEnd(m),this._currentCount=0}this._previousEvent=m};r._emitStart=function(m){this._startEvent=
m;this._callbacks.condition?.(this._currentCount,m)&&this._callbacks.start(this._currentCount,m,this._startEvent)};r._emitUpdate=function(m){this._callbacks.condition?.(this._currentCount,m)&&this._callbacks.update(this._currentCount,m,this._startEvent)};r._emitEnd=function(m){this._callbacks.condition?.(this._currentCount,m)&&this._callbacks.end(this._currentCount,m,this._startEvent);this._startEvent=null};return c}();a.DragEventSeparator=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){function y(C){C=C.layer;return!(!C||!C.featureReduction||"selection"!==C.featureReduction.type)}function B(C){(C=C.graphics3DGraphics)&&C.forEach(k=>k.clearVisibilityFlag(w.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(C){function k(){var x=C.apply(this,arguments)||this;x._handles=new r;x._contexts=new Map;x._viewState=new t.DeconflictorViewState;x.visibilityGroup=w.VisibilityGroup.GRAPHIC;x._iconMarginFactor=-.1;return x}b._inheritsLoose(k,
C);var q=k.prototype;q.initialize=function(){this._handles.add([p.watch(()=>this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),p.watch(()=>this.view?.map?.ground?.opacity,(x,v)=>{1!==x&&1!==v||this.setDirty()}),p.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},p.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(z.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new u.LabelDeconflictor({view:this.view,parent:this})};
q.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};q.setDirty=function(){0<this._contexts.size&&(C.prototype.setDirty.call(this),this._labels.setDirty())};q.runTask=function(x){C.prototype.runTask.call(this,x);this.running||this._labels.setDirty()};q.setInitialIconVisibilityFlag=function(x,v){x=!(this._graphicSupportsDeconfliction(v)&&y(x));v.setVisibilityFlag(w.VisibilityFlag.DECONFLICTION,
x,w.VisibilityGroup.GRAPHIC)};q._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};q._updateSlicePlane=function(){const x=this.view?this.view.slicePlane:null;n.isSome(x)&&A.transform(x,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=n.isSome(x)};q._slicePlaneChanged=function(){m.someMap(this._contexts,(x,v)=>v.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};
q.addGraphicsOwner=function(x){let v=this._contexts.get(x);null==v&&(v=new Map,this._contexts.set(x,v),this.setDirty());return{addGraphic:D=>this._addGraphic(x,v,D),removeGraphic:D=>this._removeGraphic(v,D),labelingInfoChange:()=>this._labels.enabledChanged(x,v),featureReductionChange:()=>this.enabledChanged(x,v),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(x,v),clear:()=>v.forEach(D=>this._removeGraphic(v,D.graphics3DGraphic))}};q.removeGraphicsOwner=function(x){const v=this._contexts.get(x);
v&&(v.forEach(D=>this._removeGraphic(v,D.graphics3DGraphic)),this._contexts.delete(x),this.setDirty())};q._addGraphic=function(x,v,D){const F=D.graphic.uid;D=new t.DeconflictorGraphic(D,x.symbolCreationContext.slicePlaneEnabled);v.set(F,D);y(x)&&this.addToActiveGraphics(D);x.labelsEnabled&&this._labels.addToActiveGraphics(D)};q._removeGraphic=function(x,v){v=v.graphic.uid;const D=x.get(v);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),x.delete(v),this.setDirty())};q.enabledChanged=
function(x,v){const D=y(x);D||B(x);this.modifyGraphics(v,D)};q._slicePlaneEnabledChanged=function(x,v){const D=x.symbolCreationContext.slicePlaneEnabled;v.forEach(F=>F.slicePlaneEnabled=D);this.setDirty()};q.getGraphicsLayers=function(x){return x.graphics};q._graphicSupportsDeconfliction=function(x){if(x.isDraped)return!1;x=x.graphics;if(!x||!x.length)return!1;for(const v of x)if(this.layerSupportsDeconfliction(v))return!0;return!1};b._createClass(k,[{key:"labels",get:function(){return this._labels}},
{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(x){this._iconMarginFactor=x;this.setDirty()}}]);return k}(t.Deconflictor);a.GraphicsDeconflictor=c.__decorate([l.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){function*K(ba){if(Map.prototype.entries){ba=ba.entries();for(let ia=ba.next();!ia.done;ia=ba.next())yield ia.value[1]}else yield*ba.values()}function*O(ba,ia,ma){ia.clear();ba.forEach((ka,Z)=>{const ca=ia.pushNew();ca.id=Z;ca.prio=ka.info?-ka.info[ma].distance:Number.MAX_VALUE});yield;const ha=ia.iterableSort((ka,Z)=>Z.prio-ka.prio);for(let ka=ha.next();!ka.done;ka=ha.next())yield;ia.forAll(ka=>{const Z=ba.get(ka.id);Z&&(ba.delete(ka.id),
ba.set(ka.id,Z))});ia.clear()}const P=w.create(),N=z.create(),H=z.create(),E=w.create(),I=l.create(),M=q.create(),Q=k.create(),T=w.create(),S=B.create();let U=function(){this.aabr=B.create();this.distance=0;this.visible=this.culled=!1},Y=function(){function ba(){this.active=new Map;this.visible=new Map}ba.prototype.clear=function(){this.active.clear();this.visible.clear()};return ba}(),V=function(){},R=function(){this.sortArray=new p({allocator:ba=>ba||new V})};a.State=void 0;(function(ba){ba[ba.Idle=
0]="Idle";ba[ba.Process=1]="Process";ba[ba.Sort=2]="Sort";ba[ba.Deconflict=3]="Deconflict";ba[ba.NumStates=4]="NumStates"})(a.State||(a.State={}));let X=function(){function ba(){this.camera=new F.Camera;this.slicePlane=C.create();this.slicePlaneEnabled=!1}ba.prototype.copyFrom=function(ia){this.camera.copyFrom(ia.camera);C.copy(ia.slicePlane,this.slicePlane);this.slicePlaneEnabled=ia.slicePlaneEnabled};return ba}();a.Deconflictor=function(ba){function ia(ha){ha=ba.call(this,ha)||this;ha._dirty=!1;
ha._runningViewState=new X;ha._state=a.State.Idle;ha._graphics=new Y;ha._iterators=new R;ha._accBinsNumX=15;ha._accBinsNumY=20;ha._accBinsSizeX=0;ha._accBinsSizeY=0;ha._accBins=null;ha.accNumTests=0;return ha}b._inheritsLoose(ia,ba);var ma=ia.prototype;ma.destroy=function(){this._graphics.clear();this._iterators=null};ma.setDirty=function(){!this._dirty&&0<this._graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};ma.runTask=function(ha){switch(this._state){case a.State.Idle:this._startUpdate(),
ha.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ha))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ha))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ha))break;default:x.drawAccelerationStruct(this,this._graphics.visible),this._state=a.State.Idle,this.notifyChange("updating")}};ma.modifyGraphics=function(ha,ka){ka?ha.forEach(Z=>this.addToActiveGraphics(Z)):ha.forEach(Z=>
this.removeFromActiveGraphics(Z));this.setDirty()};ma.layerSupportsDeconfliction=function(ha){if(n.isNone(ha)||"object3d"!==ha.type)return!1;ha=ha.stageObject;return 1===(ha?ha.geometryRecords.length:0)&&ha.geometryRecords[0].material instanceof L.HUDMaterial?!0:!1};ma._startUpdate=function(){x.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ha,fullHeight:ka}=this._runningViewState.camera;this._initBins(ha,ka);this._resetIterators()};ma.addToActiveGraphics=
function(ha){ha.info[this.visibilityGroup]=new U;this._graphics.active.set(ha.graphics3DGraphic.graphic.uid,ha);this.setDirty()};ma.removeFromActiveGraphics=function(ha){this._removeFromVisibleGraphics(ha);const ka=ha.graphics3DGraphic;ka.destroyed||ka.clearVisibilityFlag(v.VisibilityFlag.DECONFLICTION,this.visibilityGroup);delete ha.info[this.visibilityGroup];this._graphics.active.delete(ha.graphics3DGraphic.graphic.uid);this.setDirty()};ma._addToVisibleGraphics=function(ha){this._graphics.visible.set(ha.graphics3DGraphic.graphic.uid,
ha)};ma._removeFromVisibleGraphics=function(ha){this._graphics.visible.delete(ha.graphics3DGraphic.graphic.uid)};ma._processActiveGraphics=function(ha){const ka=this._ensureActiveGraphicsIterator(),Z=e.invert(I,this._runningViewState.camera.projectionMatrix),ca="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?M:null;let fa=0;n.isSome(ca)&&(t.transformMat4(ca,w.ZEROS,this._runningViewState.camera.viewMatrix),ca[3]=y.getReferenceEllipsoid(this.view.spatialReference).radius,
fa=q.distanceToSilhouette(ca,w.ZEROS));for(;!ha.done;){ha.madeProgress();var ea=ka.next();if(!0===ea.done)return this._resetActiveGraphicsIterator(),!0;const da=(ea=ea.value)&&ea.info[this.visibilityGroup];da&&(this._collectGraphics3DGraphics(ea,Z,ca,fa),da.culled?this._removeFromVisibleGraphics(ea):this._addToVisibleGraphics(ea))}return!1};ma._sortVisibleGraphics=function(ha){const ka=this._ensureSortGraphicsIterator();for(;!ha.done;){const Z=ka.next();ha.madeProgress();if(!0===Z.done)return this._resetSortGraphicsIterator(),
!0}return!1};ma._deconflictVisibleGraphics=function(ha){const ka=this._ensureVisibleGraphicsIterator(),Z=this.visibilityGroup===v.VisibilityGroup.LABEL;for(;!ha.done;){ha.madeProgress();var ca=ka.next();if(!0===ca.done)return this._resetVisibleGraphicsIterator(),!0;ca=ca.value;const ea=ca.info[this.visibilityGroup];if(ea&&!ea.culled){var fa=ca.graphics3DGraphic;(fa=(!Z||fa.isVisible())&&!this._isConflicted(ca))&&this._addToBins(ca);ea.visible=fa;this._setGraphicVisibility(ca,fa);x.drawPoly(ea,fa)}}return!1};
ma._resetIterators=function(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null};ma._ensureActiveGraphicsIterator=function(){this._iterators.active||(this._iterators.active=K(this._graphics.active));return this._iterators.active};ma._resetActiveGraphicsIterator=function(){this._iterators.active=null};ma._ensureVisibleGraphicsIterator=function(){this._iterators.visible||(this._iterators.visible=K(this._graphics.visible));return this._iterators.visible};ma._resetVisibleGraphicsIterator=
function(){this._iterators.visible=null};ma._ensureSortGraphicsIterator=function(){this._iterators.sort||(this._iterators.sort=O(this._graphics.visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort};ma._resetSortGraphicsIterator=function(){this._iterators.sort=null};ma._collectGraphics3DGraphics=function(ha,ka,Z,ca){var fa=ha.graphics3DGraphic;if(!fa.destroyed){var ea=ha.info[this.visibilityGroup];if(fa.isVisible(v.VisibilityGroup.GRAPHIC,v.VisibilityFlag.DECONFLICTION)){var da=
this.getGraphicsLayers(fa);B.empty(ea.aabr);fa=null;for(const la of da)if(this.layerSupportsDeconfliction(la)){da=la.stageObject.geometryRecords[0].material;if(n.isNone(fa)){fa=this._getProjectionInfo(la,ka,aa);if(fa.isOutsideScreen||this._isCulledBySlice(ha,P)||n.isSome(Z)&&this._isCulledByHorizon(fa,Z,ca)){ea.culled=!0;return}!D.TESTS_DISABLE_OPTIMIZATIONS&&ea.visible&&(fa.distance*=.7)}this._expandBoundingRect(ea,la,da,fa)}n.isNone(fa)?ea.culled=!0:(ea.distance=fa.distance,ea.culled=!1)}else ea.culled=
!0}};ma._getProjectionInfo=function(ha,ka,Z){const ca=this._runningViewState.camera;ha=ha.stageObject;var fa=ha.geometryRecords[0];const ea=fa.material;var da=q.getCenter(ha.boundingVolumeWorldSpace.bounds);t.transformMat4(P,da,ca.viewMatrix);da=fa.geometry.vertexAttributes;fa=da.get(J.VertexAttribute.NORMAL).data;da=da.get(J.VertexAttribute.AUXPOS1).data;ea.applyShaderOffsetsView(P,fa,ha.transformation,da,ca,Z.scaleInfo,P);u.set(N,P[0],P[1],P[2],1);u.transformMat4(H,N,ca.projectionMatrix);t.scale(Z.positionNDC,
H,1/H[3]);ea.applyShaderOffsetsNDC(Z.positionNDC,da,ca,Z.positionNDC,E);Z.distanceWithoutPolygonOffset=ca.depthNDCToWorld(E[2]);Z.distance=E[2]===Z.positionNDC[2]?Z.distanceWithoutPolygonOffset:ca.depthNDCToWorld(Z.positionNDC[2]);u.set(H,Z.positionNDC[0],Z.positionNDC[1],Z.positionNDC[2],1);u.transformMat4(N,H,ka);u.scale(N,N,1/N[3]);t.set(Z.positionView,P[0],P[1],P[2]);return Z};ma._isCulledByHorizon=function(ha,ka,Z){t.copy(Q.direction,ha.positionView);t.set(Q.origin,0,0,0);return q.intersectRay(ka,
Q,T)?ha.distanceWithoutPolygonOffset>Z:!1};ma._isCulledBySlice=function(ha,ka){return ha.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&C.extrusionContainsPoint(this._runningViewState.slicePlane,ka)};ma._expandBoundingRect=function(ha,ka,Z,{positionNDC:ca,scaleInfo:fa}){const ea=this._runningViewState.camera;ka=ka.getScreenSize(W);G.applyPrecomputedScaleFactor(ka,fa.factor,ka);ka[0]*=ea.pixelRatio;ka[1]*=ea.pixelRatio;Z=B.offset(Z.calculateRelativeScreenBounds(ka,fa.factorAlignment.scale,
S),m.lerp(0,ea.fullWidth,.5+.5*ca[0]),m.lerp(0,ea.fullHeight,.5+.5*ca[1]));ca=this.iconMarginFactor;0!==ca&&(ca*=Math.min(B.width(Z),B.height(Z)),Z[0]-=ca,Z[1]-=ca,Z[2]+=ca,Z[3]+=ca);B.expand(ha.aabr,Z,ha.aabr)};ma._isConflicted=function(ha){const ka=ha.graphics3DGraphic.graphic.uid;ha=ha.info[this.visibilityGroup];for(let Z=Math.floor(ha.aabr[0]/this._accBinsSizeX);Z<=Math.floor(ha.aabr[2]/this._accBinsSizeX);Z++)if(!(0>Z||Z>=this._accBinsNumX))for(let ca=Math.floor(ha.aabr[1]/this._accBinsSizeY);ca<=
Math.floor(ha.aabr[3]/this._accBinsSizeY);ca++){if(0>ca||ca>=this._accBinsNumY)continue;const fa=this._accBins[Z][ca];for(let ea=0;ea<fa.length;ea++){const da=fa.data[ea],la=da.info[this.visibilityGroup];if(la&&la.visible&&da.graphics3DGraphic.graphic.uid!==ka&&(this.accNumTests++,B.intersects(la.aabr,ha.aabr)))return!0}}return!1};ma._initBins=function(ha,ka){if(null==this._accBins){this._accBins=[];for(var Z=0;Z<this._accBinsNumX;Z++){this._accBins.push([]);var ca=this._accBins[this._accBins.length-
1];for(let fa=0;fa<this._accBinsNumY;fa++)ca.push(new p)}}else for(Z=0;Z<this._accBinsNumX;Z++)for(ca=0;ca<this._accBinsNumY;ca++)this._accBins[Z][ca].clear();this._accBinsSizeX=ha/this._accBinsNumX;this._accBinsSizeY=ka/this._accBinsNumY;this.accNumTests=0};ma._addToBins=function(ha){var ka=ha.info[this.visibilityGroup],Z=Math.floor(ka.aabr[0]/this._accBinsSizeX);const ca=Math.floor(ka.aabr[2]/this._accBinsSizeX),fa=Math.floor(ka.aabr[1]/this._accBinsSizeY);for(ka=Math.floor(ka.aabr[3]/this._accBinsSizeY);Z<=
ca;Z++)if(!(0>Z||Z>=this._accBinsNumX))for(let ea=fa;ea<=ka;ea++)0>ea||ea>=this._accBinsNumY||this._accBins[Z][ea].push(ha)};ma._setGraphicVisibility=function(ha,ka){ha=ha.graphics3DGraphic;ha.destroyed||(ha.setVisibilityFlag(v.VisibilityFlag.DECONFLICTION,ka,this.visibilityGroup),this.visibilityGroup===v.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ha,ka))};b._createClass(ia,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",
get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ha=this._state/a.State.NumStates;return this._dirty?.5*ha:ha}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return ia}(r);c.__decorate([g.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=
c.__decorate([f.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);const W=A.create(),aa=new (function(){function ba(){this.positionView=w.create();this.positionNDC=w.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}b._createClass(ba,[{key:"isOutsideScreen",get:function(){const ia=this.positionNDC;return-1>ia[0]||-1>ia[1]||-1>ia[2]||
1<=ia[0]||1<=ia[1]}}]);return ba}());a.DeconflictorGraphic=function(ba,ia,ma={}){this.graphics3DGraphic=ba;this.slicePlaneEnabled=ia;this.info=ma};a.DeconflictorViewState=X;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(f,e,l,A,t){g&&(g(),g=null);const w=h.height,u=d;u.beginPath();u.lineWidth=1;u.strokeStyle=t;u.moveTo(f,w-
l);u.lineTo(e,w-l);u.stroke();u.lineTo(e,w-A);u.stroke();u.lineTo(e,w-l);u.stroke();u.lineTo(f,w-l);u.stroke();u.lineTo(f,w-l);u.stroke();u.closePath()}let r=!1,m=!1,n=!1,p=!1,g=null,h,d;a.drawAccelerationStruct=function(f,e){if(m&&d){g&&(g(),g=null);var l=d,A=0;for(let t=0;t<f.accBinsNumX;t++)for(let w=0;w<f.accBinsNumY;w++){const u=f.accBins[t][f.accBinsNumY-1-w];A+=u.length;const z=t*f.accBinsSizeX,y=(t+1)*f.accBinsSizeX,B=w*f.accBinsSizeY,C=(w+1)*f.accBinsSizeY;l.fillText(u.length.toFixed(),z+
5,B+15);c(z,y,B,C,"blue")}l.fillText("total totalShownLabels: "+A,70,40);l.fillText("total visible labels: "+e.size,70,50);l.fillText("total numTests: "+f.accNumTests,70,30)}};a.drawPoly=function(f,e){r&&(e&&n||!e&&p)&&c(f.aabr[0],f.aabr[2],f.aabr[1],f.aabr[3],e?"green":"red")};a.prepare=function(f){n=b.DECONFLICTOR_SHOW_VISIBLE;p=b.DECONFLICTOR_SHOW_INVISIBLE;r=n||p;m=b.DECONFLICTOR_SHOW_GRID;g=null;r||m?g=()=>{null==h&&(h=document.createElement("canvas"),h.setAttribute("id","canvas2d"),f.surface.parentElement.style.position=
"relative",f.surface.parentElement.appendChild(h));var {state:e}=f;const {camera:l,pixelRatio:A}=e,{width:t,height:w}=l;e=w*A;h.setAttribute("width",`${t*A}px`);h.setAttribute("height",`${e}px`);h.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${t}px;height:${w}px`);d=h.getContext("2d");d.clearRect(0,0,t,w);d.font="12px Arial"}:h&&(h.parentElement.removeChild(h),h=null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,r){function m(e,l,A){const t=A.parameters;A=A.paddingPixelsOverride;d.scale=Math.min(t.divisor/(l-t.offset),1);d.factor=Math.abs(e*e*e);d.minPixelSize=t.minPixelSize;d.paddingPixels=A;return d}function n(e,l){return 0===e?l.minPixelSize:l.minPixelSize*(1+
2*l.paddingPixels/e)}function p(e,l){return Math.max(c.lerp(e*l.scale,e,l.factor),n(e,l))}let g=function(){function e(A,t,w,u={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},z){this._viewingMode=A;this._description=t;this._ellipsoidRadius=w;this.parameters=u;this._paddingPixelsOverride=z;this._viewingMode===r.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):
(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}var l=e.prototype;l.update=function(A){if(this.parameters&&this.parameters.camera.fovY===A.fovY&&this.parameters.camera.distance===A.distance)return!1;this._calculateParameters(A,this._ellipsoidRadius,this.parameters);return!0};l.overridePadding=function(A){return A!==this.paddingPixelsOverride?new e(this._viewingMode,this._description,
this._ellipsoidRadius,this.parameters,A):this};l._calculateParameters=function(A,t,w){const {scaleStart:u,scaleFallOffRange:z,minPixelSize:y}=this._description,{fovY:B,distance:C}=A;var k=this._calculateCurvatureDependentParameters(A,t);t=this._coverageCompensation(A,t,k);const {tiltAngle:q,scaleFallOffFactor:x}=k,v=Math.sin(q)*C,D=.5*Math.PI-q-B*(.5-u*t);k=v/Math.cos(D);t=(k-v/Math.cos(D+B*z*t)*x)/(1-x);w.camera.fovY=A.fovY;w.camera.distance=A.distance;w.offset=t;w.divisor=k-t;w.minPixelSize=y;return w};
l._calculateCurvatureDependentParametersLocal=function(A,t,w=f){w.tiltAngle=this._description.curvatureDependent.min.tiltAngle;w.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return w};l._calculateCurvatureDependentParametersGlobal=function(A,t,w=f){const u=this._description.curvatureDependent;A=1+A.distance/t;A=Math.sqrt(A*A-1);const [z,y]=[u.min.curvature,u.max.curvature];A=c.clamp((A-z)/(y-z),0,1);const [B,C]=[u.min,u.max];w.tiltAngle=c.lerp(B.tiltAngle,C.tiltAngle,
A);w.scaleFallOffFactor=c.lerp(B.scaleFallOffFactor,C.scaleFallOffFactor,A);return w};l._surfaceCoverageCompensationLocal=function(A,t,w){return(A.fovY-w.tiltAngle)/A.fovY};l._surfaceCoverageCompensationGlobal=function(A,t,w){const u=t*t;w=w.tiltAngle+.5*Math.PI;const {fovY:z,distance:y}=A;A=y*y+u-2*Math.cos(w)*y*t;const B=Math.sqrt(A);return(Math.acos(Math.sqrt(A-u)/B)-Math.asin(t/(B/Math.sin(w)))+.5*z)/z};b._createClass(e,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels}}]);return e}();const h={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},f={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,l,A=[0,0]){l=Math.min(Math.max(l.scale,n(e[1],l)/Math.max(1E-5,e[1])),1);A[0]=e[0]*l;A[1]=e[1]*
l;return A};a.applyScaleFactor=p;a.getLabelSettings=function(e,l){const {curvatureDependent:A,scaleStart:t,scaleFallOffRange:w}=h;return new g(e,{curvatureDependent:{min:{curvature:A.min.curvature,tiltAngle:A.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:A.max.curvature,tiltAngle:A.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:t,scaleFallOffRange:w,minPixelSize:14},l)};a.getSettings=function(e,l){return new g(e,h,l)};a.precomputeScaleFactor=function(e,l,A,t){e=m(e,l,A);e.minPixelSize=0;
e.paddingPixels=0;e=p(1,e);t.scale=e;t.factor=0;t.minPixelSize=A.parameters.minPixelSize;t.paddingPixels=A.paddingPixelsOverride};a.scale=function(e,l,A,t){return p(e,m(l,A,t))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/geometryDataUtils ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P){function N(ea,da,la,oa=Q){d.copy(oa,ea.anchorPosition);oa[0]*=-da[0];oa[1]*=-da[1];oa[0]+=ea.screenOffset[0]*la;oa[1]+=ea.screenOffset[1]*la;return oa}function H(ea,da,la,oa,ra,Aa,ua,za){da=da-ra-(0<za[0]?oa[0]*za[0]:0);let va=da+oa[0]+2*ra;la=la-ra-(0<za[1]?oa[1]*za[1]:0);ra=la+oa[1]+2*ra;za=ua.distanceFieldBoundingBox;ua.textureIsSignedDistanceField&&m.isSome(za)&&(da+=oa[0]*za[0],la+=oa[1]*za[1],va-=oa[0]*(1-za[2]),ra-=
oa[1]*(1-za[3]),da-=Aa,va+=Aa,la-=Aa,ra+=Aa);return ea[0]>da&&ea[0]<va&&ea[1]>la&&ea[1]<ra}let E=function(ea){function da(oa){oa=ea.call(this,oa,new ka)||this;oa._configuration=new P.HUDMaterialTechniqueConfiguration;return oa}b._inheritsLoose(da,ea);var la=da.prototype;la.getConfiguration=function(oa,ra){this._configuration.output=oa;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?B.HUDSpace.Screen:B.HUDSpace.World;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.isDraped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this._configuration.vvSize=!!this.parameters.vvSizeEnabled;this._configuration.vvColor=!!this.parameters.vvColorEnabled;this._configuration.occlusionPass=ra.slot===x.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(oa===y.ShaderOutput.Color||oa===y.ShaderOutput.Alpha);oa===y.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder);oa===y.ShaderOutput.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);
this._configuration.depthEnabled=this.parameters.depthEnabled;this._configuration.transparencyPassType=ra.transparencyPassType;this._configuration.hasMultipassGeometry=ra.multipassGeometry.enabled;this._configuration.hasMultipassTerrain=ra.multipassTerrain.enabled;this._configuration.cullAboveGround=ra.multipassTerrain.cullAboveGround;return this._configuration};la.intersect=function(oa,ra,Aa,ua,za,va,Ja,pa,Ba){m.isSome(Ba)?this._intersectDrapedHudGeometry(oa,va,Ja,pa,Ba):this._intersectHudGeometry(oa,
ra,Aa,ua,Ja,pa)};la._intersectDrapedHudGeometry=function(oa,ra,Aa,ua,za){const va=oa.vertexAttributes.get(F.VertexAttribute.POSITION),Ja=oa.vertexAttributes.get(F.VertexAttribute.SIZE),pa=this.parameters,Ba=K.calculateAnchorPosForRendering(pa);let Ha=1;var wa=1;m.isSome(ua)&&(wa=ua(ia),Ha=wa[0],wa=wa[5]);Ha*=oa.screenToWorldRatio;wa*=oa.screenToWorldRatio;ua=2*oa.screenToWorldRatio;for(let Na=0;Na<va.data.length/va.size;Na++){var ya=Na*va.size;const Ra=va.data[ya];ya=va.data[ya+1];const Sa=Na*Ja.size;
ma[0]=Ja.data[Sa]*Ha;ma[1]=Ja.data[Sa+1]*wa;let ja;pa.textureIsSignedDistanceField&&(ja=pa.outlineSize*oa.screenToWorldRatio/2);H(ra,Ra,ya,ma,ua,ja,pa,Ba)&&Aa(za.dist,za.normal,-1,!1)}};la._intersectHudGeometry=function(oa,ra,Aa,ua,za,va){if(ua.options.selectionMode&&ua.options.hud&&!L.isInstanceHidden(ra)){ra=this.parameters;var Ja=1,pa=1;n.fromMat4(R,Aa);if(m.isSome(va)){pa=va(ia);Ja=pa[0];pa=pa[5];va=R;var Ba=va[0],Ha=va[1],wa=va[2],ya=va[3],Na=va[4],Ra=va[5],Sa=va[6],ja=va[7],Ta=va[8],qa=1/Math.sqrt(Ba*
Ba+Ha*Ha+wa*wa);const Ea=1/Math.sqrt(ya*ya+Na*Na+Ra*Ra),Oa=1/Math.sqrt(Sa*Sa+ja*ja+Ta*Ta);va[0]=Ba*qa;va[1]=Ha*qa;va[2]=wa*qa;va[3]=ya*Ea;va[4]=Na*Ea;va[5]=Ra*Ea;va[6]=Sa*Oa;va[7]=ja*Oa;va[8]=Ta*Oa}va=oa.vertexAttributes.get(F.VertexAttribute.POSITION);Ba=oa.vertexAttributes.get(F.VertexAttribute.SIZE);Ha=oa.vertexAttributes.get(F.VertexAttribute.NORMAL);oa=oa.vertexAttributes.get(F.VertexAttribute.AUXPOS1);D.assert(3<=va.size);wa=ua.point;ya=ua.camera;Na=K.calculateAnchorPosForRendering(ra);Ja*=
ya.pixelRatio;pa*=ya.pixelRatio;Ra="screen"===this.parameters.centerOffsetUnits;for(Sa=0;Sa<va.data.length/va.size;Sa++)if(ja=Sa*va.size,e.set(T,va.data[ja],va.data[ja+1],va.data[ja+2]),e.transformMat4(T,T,Aa),ja=Sa*Ba.size,ma[0]=Ba.data[ja]*Ja,ma[1]=Ba.data[ja+1]*pa,e.transformMat4(T,T,ya.viewMatrix),ja=Sa*oa.size,e.set(aa,oa.data[ja+0],oa.data[ja+1],oa.data[ja+2]),Ra||(T[0]+=aa[0],T[1]+=aa[1],0!==aa[2]&&(ja=aa[2],e.normalize(aa,T),e.subtract(T,T,e.scale(aa,aa,ja)))),ja=Sa*Ha.size,e.set(S,Ha.data[ja],
Ha.data[ja+1],Ha.data[ja+2]),this._normalAndViewAngle(S,R,ya,ba),this._applyVerticalOffsetTransformationView(T,ba,ya,M),ya.applyProjection(T,U),-1<U[0]){U[0]=Math.floor(U[0]);U[1]=Math.floor(U[1]);Ra&&(aa[0]||aa[1])&&(U[0]+=aa[0],0!==aa[1]&&(U[1]+=v.applyScaleFactor(aa[1],M.factorAlignment)),ya.unapplyProjection(U,T));U[0]+=this.parameters.screenOffset[0];U[1]+=this.parameters.screenOffset[1];v.applyPrecomputedScaleFactor(ma,M.factor,ma);ja=1*ya.pixelRatio;let Ea;ra.textureIsSignedDistanceField&&
(Ea=ra.outlineSize*ya.pixelRatio/2);H(wa,U[0],U[1],ma,ja,Ea,ra,Na)&&(Ta=ua.ray,e.transformMat4(V,T,g.invert(W,ya.viewMatrix)),U[0]=wa[0],U[1]=wa[1],ya.unprojectFromRenderScreen(U,T)&&(ja=l.create(),e.copy(ja,Ta.direction),qa=1/e.length(ja),e.scale(ja,ja,qa),Ta=e.distance(Ta.origin,T)*qa,za(Ta,ja,-1,!0,1,V)))}}};la.computeAttachmentOrigin=function(oa,ra){var Aa=oa.vertexAttributes;if(!Aa)return!1;Aa=Aa.get(F.VertexAttribute.POSITION);oa=oa.indices.get(F.VertexAttribute.POSITION);return C.computeAttachmentOriginPoints(Aa,
oa,ra)};la.createBufferWriter=function(){return new fa(this)};la._normalAndViewAngle=function(oa,ra,Aa,ua){t.isMat4(ra)&&(ra=n.fromMat4(X,ra));e.transformMat3(ua.normal,oa,ra);e.transformMat4(ua.normal,ua.normal,Aa.viewInverseTransposeMatrix);ua.cosAngle=e.dot(Y,ha);return ua};la._updateScaleInfo=function(oa,ra,Aa){const ua=this.parameters;m.isSome(ua.screenSizePerspective)?v.precomputeScaleFactor(Aa,ra,ua.screenSizePerspective,oa.factor):(oa.factor.scale=1,oa.factor.factor=0,oa.factor.minPixelSize=
0,oa.factor.paddingPixels=0);m.isSome(ua.screenSizePerspectiveAlignment)?v.precomputeScaleFactor(Aa,ra,ua.screenSizePerspectiveAlignment,oa.factorAlignment):(oa.factorAlignment.factor=oa.factor.factor,oa.factorAlignment.scale=oa.factor.scale,oa.factorAlignment.minPixelSize=oa.factor.minPixelSize,oa.factorAlignment.paddingPixels=oa.factor.paddingPixels)};la.applyShaderOffsetsView=function(oa,ra,Aa,ua,za,va,Ja){ra=this._normalAndViewAngle(ra,Aa,za,ba);this._applyVerticalGroundOffsetView(oa,ra,za,Ja);
this._applyVerticalOffsetTransformationView(Ja,ra,za,va);this._applyPolygonOffsetView(Ja,ra,ua[3],za,Ja);this._applyCenterOffsetView(Ja,ua,Ja);return Ja};la.applyShaderOffsetsNDC=function(oa,ra,Aa,ua,za){this._applyCenterOffsetNDC(oa,ra,Aa,ua);m.isSome(za)&&e.copy(za,ua);this._applyPolygonOffsetNDC(ua,ra,Aa,ua);return ua};la._applyPolygonOffsetView=function(oa,ra,Aa,ua,za){var va=ua.aboveGround?1:-1;Aa=Math.sign(Aa);0===Aa&&(Aa=va);va*=Aa;if(0>=this.parameters.shaderPolygonOffset)return e.copy(za,
oa);ra=r.clamp(Math.abs(ra.cosAngle),.01,1);ua=1-Math.sqrt(1-ra*ra)/ra/ua.viewport[2];0<va?e.scale(za,oa,ua):e.scale(za,oa,1/ua);return za};la._applyVerticalGroundOffsetView=function(oa,ra,Aa,ua){const za=e.length(oa),va=Aa.aboveGround?1:-1;Aa=.5*Aa.computeRenderPixelSizeAtDist(za);ra=e.scale(T,ra.normal,va*Aa);e.add(ua,oa,ra);return ua};la._applyVerticalOffsetTransformationView=function(oa,ra,Aa,ua){const za=this.parameters;if(!za.verticalOffset||!za.verticalOffset.screenLength){if(za.screenSizePerspective||
za.screenSizePerspectiveAlignment){var va=e.length(oa);this._updateScaleInfo(ua,va,ra.cosAngle)}else ua.factor.scale=1,ua.factorAlignment.scale=1;return oa}va=e.length(oa);const Ja=m.unwrapOr(za.screenSizePerspectiveAlignment,za.screenSizePerspective);Aa=J.verticalOffsetAtDistance(Aa,va,za.verticalOffset,ra.cosAngle,Ja);this._updateScaleInfo(ua,va,ra.cosAngle);e.scale(ra.normal,ra.normal,Aa);return e.add(oa,oa,ra.normal)};la._applyCenterOffsetView=function(oa,ra,Aa){const ua="screen"!==this.parameters.centerOffsetUnits;
Aa!==oa&&e.copy(Aa,oa);ua&&(Aa[0]+=ra[0],Aa[1]+=ra[1],ra[2]&&(e.normalize(S,Aa),e.add(Aa,Aa,e.scale(S,S,ra[2]))));return Aa};la._applyCenterOffsetNDC=function(oa,ra,Aa,ua){const za="screen"!==this.parameters.centerOffsetUnits;ua!==oa&&e.copy(ua,oa);za||(ua[0]+=ra[0]/Aa.fullWidth*2,ua[1]+=ra[1]/Aa.fullHeight*2);return ua};la._applyPolygonOffsetNDC=function(oa,ra,Aa,ua){const za=this.parameters.shaderPolygonOffset;oa!==ua&&e.copy(ua,oa);za&&(oa=Aa.aboveGround?1:-1,ua[2]-=(oa*Math.sign(ra[3])||oa)*za);
return ua};la.requiresSlot=function(oa,ra){if(ra===y.ShaderOutput.Color||ra===y.ShaderOutput.Alpha||ra===y.ShaderOutput.Highlight||ra===y.ShaderOutput.ObjectAndLayerIdColor){if(oa===x.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:Aa,occlusionTest:ua}=this.parameters;return oa===(Aa?x.RenderSlot.LABEL_MATERIAL:x.RenderSlot.HUD_MATERIAL)||ua&&oa===x.RenderSlot.OCCLUSION_PIXELS}return!1};la.createGLMaterial=function(oa){return new I(oa)};la.calculateRelativeScreenBounds=function(oa,ra,
Aa=w.create()){N(this.parameters,oa,ra,Aa);Aa[2]=Aa[0]+oa[0];Aa[3]=Aa[1]+oa[1];return Aa};return da}(q.Material),I=function(ea){function da(oa){return ea.call(this,{...oa,...oa.material.parameters})||this}b._inheritsLoose(da,ea);var la=da.prototype;la.selectProgram=function(oa){return this.ensureTechnique(O.HUDMaterialTechnique,oa)};la.beginSlot=function(oa){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.selectProgram(oa)};
return da}(k.GLTextureMaterial);const M={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Q=f.create(),T=l.create(),S=l.create(),U=A.create(),Y=l.create(),V=l.create(),R=p.create(),X=p.create(),W=h.create(),aa=l.create(),ba={normal:Y,cosAngle:0},ia=h.create(),ma=[0,0],ha=l.fromValues(0,0,1);let ka=function(ea){function da(){var la=ea.apply(this,arguments)||this;la.renderOccluded=q.RenderOccludedFlag.Occlude;la.color=A.fromValues(1,
1,1,1);la.texCoordScale=[1,1];la.polygonOffset=!1;la.anchorPosition=f.fromValues(.5,.5);la.screenOffset=[0,0];la.shaderPolygonOffset=1E-5;la.textureIsSignedDistanceField=!1;la.outlineColor=A.fromValues(1,1,1,1);la.outlineSize=0;la.vvSizeEnabled=!1;la.vvSizeMinSize=[1,1,1];la.vvSizeMaxSize=[100,100,100];la.vvSizeOffset=[0,0,0];la.vvSizeFactor=[1,1,1];la.vvColorEnabled=!1;la.vvColorValues=[0,0,0,0,0,0,0,0];la.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];la.hasSlicePlane=
!1;la.pixelSnappingEnabled=!0;la.occlusionTest=!0;la.binaryHighlightOcclusion=!0;la.debugDrawLabelBorder=!1;la.centerOffsetUnits="world";la.drawInSecondSlot=!1;la.depthEnabled=!0;la.isDraped=!1;return la}b._inheritsLoose(da,ea);return da}(k.GLTextureMaterialBindParameters);const Z=z.newLayout().vec3f(F.VertexAttribute.POSITION).vec3f(F.VertexAttribute.NORMAL).vec2f(F.VertexAttribute.UV0).vec4u8(F.VertexAttribute.COLOR).vec2f(F.VertexAttribute.SIZE).vec4f(F.VertexAttribute.AUXPOS1).vec4f(F.VertexAttribute.AUXPOS2),
ca=Z.clone().vec4u8(F.VertexAttribute.OBJECTANDLAYERIDCOLOR);let fa=function(){function ea(la){this._material=la;this.vertexBufferLayout=c("enable-feature:objectAndLayerId-rendering")?ca:Z}var da=ea.prototype;da.allocate=function(la){return this.vertexBufferLayout.createBuffer(la)};da.elementCount=function(la){return 6*la.indices.get(F.VertexAttribute.POSITION).length};da.write=function(la,oa,ra,Aa,ua){G.writePosition(ra.indices.get(F.VertexAttribute.POSITION),ra.vertexAttributes.get(F.VertexAttribute.POSITION).data,
la,Aa.position,ua,6);G.writeNormal(ra.indices.get(F.VertexAttribute.NORMAL),ra.vertexAttributes.get(F.VertexAttribute.NORMAL).data,oa,Aa.normal,ua,6);var za=ra.vertexAttributes.get(F.VertexAttribute.UV0).data;if(null==za||4>za.length){za=this._material.parameters;oa=la=0;var va=za.texCoordScale[0];za=za.texCoordScale[1]}else la=za[0],oa=za[1],va=za[2],za=za[3];va=Math.min(1.99999,va+1);za=Math.min(1.99999,za+1);var Ja=ra.indices.get(F.VertexAttribute.POSITION).length,pa=Aa.uv0,Ba=ua;for(var Ha=0;Ha<
Ja;++Ha)pa.set(Ba,0,la),pa.set(Ba,1,oa),Ba+=1,pa.set(Ba,0,va),pa.set(Ba,1,oa),Ba+=1,pa.set(Ba,0,va),pa.set(Ba,1,za),Ba+=1,pa.set(Ba,0,va),pa.set(Ba,1,za),Ba+=1,pa.set(Ba,0,la),pa.set(Ba,1,za),Ba+=1,pa.set(Ba,0,la),pa.set(Ba,1,oa),Ba+=1;G.writeColor(ra.indices.get(F.VertexAttribute.COLOR),ra.vertexAttributes.get(F.VertexAttribute.COLOR).data,4,Aa.color,ua,6);la=ra.indices.get(F.VertexAttribute.SIZE);oa=ra.vertexAttributes.get(F.VertexAttribute.SIZE).data;va=la.length;za=Aa.size;Ja=ua;for(pa=0;pa<va;++pa){Ba=
oa[2*la[pa]];Ha=oa[2*la[pa]+1];for(let wa=0;6>wa;++wa)za.set(Ja,0,Ba),za.set(Ja,1,Ha),Ja+=1}ra.indices.get(F.VertexAttribute.AUXPOS1)&&ra.vertexAttributes.get(F.VertexAttribute.AUXPOS1)&&G.writeBufferVec4(ra.indices.get(F.VertexAttribute.AUXPOS1),ra.vertexAttributes.get(F.VertexAttribute.AUXPOS1).data,Aa.auxpos1,ua,6);ra.indices.get(F.VertexAttribute.AUXPOS2)&&ra.vertexAttributes.get(F.VertexAttribute.AUXPOS2)&&G.writeBufferVec4(ra.indices.get(F.VertexAttribute.AUXPOS2),ra.vertexAttributes.get(F.VertexAttribute.AUXPOS2).data,
Aa.auxpos2,ua,6);m.isSome(ra.objectAndLayerIdColor)&&4===ra.objectAndLayerIdColor.length&&ra.indices.get(F.VertexAttribute.POSITION)&&(la=ra.indices.get(F.VertexAttribute.POSITION).length,Aa=Aa.getField(F.VertexAttribute.OBJECTANDLAYERIDCOLOR,u.BufferViewVec4u8),G.writeObjectAndLayerIdColor(ra.objectAndLayerIdColor,Aa,la,ua,6))};return ea}();a.HUDMaterial=E;a.Parameters=ka;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],
function(a){function b(r){return r instanceof Float32Array&&16<=r.length}function c(r){return Array.isArray(r)&&16<=r.length}a.isMat4=function(r){return b(r)||c(r)};a.isMat4f32=b;a.isMat4f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d){a.HUDSpace=void 0;(function(f){f[f.World=0]="World";f[f.Screen=1]="Screen";f[f.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(f,e){f.include(r.ScreenSizePerspective);f.attributes.add(d.VertexAttribute.POSITION,"vec3");f.attributes.add(d.VertexAttribute.NORMAL,"vec3");f.attributes.add(d.VertexAttribute.AUXPOS1,"vec4");f=f.vertex;m.addProjViewLocalOrigin(f,e);m.addCameraPosition(f,e);f.uniforms.add([new n.Float4PassUniform("viewport",(l,A)=>A.camera.fullViewport),
new p.FloatPassUniform("polygonOffset",l=>l.shaderPolygonOffset),new p.FloatPassUniform("cameraGroundRelative",(l,A)=>A.camera.aboveGround?1:-1),new p.FloatPassUniform("renderTransparentlyOccludedHUD",(l,A)=>A.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.Occluded?1:A.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.NotOccluded?0:.75),new h.Texture2DPassUniform("hudVisibilityTexture",(l,A)=>A.hudVisibilityTexture)]);e.hasVerticalOffset&&b.addVerticalOffset(f);f.constants.add("smallOffsetAngle",
"float",.984807753012208);f.code.add(g.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);f.code.add(g.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);e.isDraped&&!e.hasVerticalOffset||m.addViewNormal(f);e.isDraped||(f.uniforms.add(new p.FloatPassUniform("perDistancePixelRatio",(l,A)=>Math.tan(A.camera.fovY/2)/(A.camera.fullViewport[2]/2))),f.code.add(g.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&f.uniforms.add(new p.FloatPassUniform("pixelRatio",(l,A)=>A.camera.pixelRatio));e.hasScreenSizePerspective&&r.addScreenSizePerspectiveAlignment(f);f.code.add(g.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective?e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${e.hasVerticalOffset?g.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?g.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?e.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);f.code.add(g.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,r,m,n,p){function g(d){d.uniforms.add(new n.Float4PassUniform("verticalOffset",(f,e)=>
{const {minWorldLength:l,maxWorldLength:A,screenLength:t}=f.verticalOffset;return b.set(h,t*(e.camera.pixelRatio||1),Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),l,A)}))}const h=c.create();a.VerticalOffset=function(d,f){const e=d.vertex;f.hasVerticalOffset?(g(e),f.hasScreenSizePerspective&&(d.include(r.ScreenSizePerspective),r.addScreenSizePerspectiveAlignment(e),m.addCameraPosition(d.vertex,f)),e.code.add(p.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${f.spherical?p.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:p.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${f.hasScreenSizePerspective?p.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:p.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):e.code.add(p.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,b,c,r,m){function n(g){return b.set(p,
g.parameters.divisor,g.parameters.offset,g.parameters.minPixelSize,g.paddingPixelsOverride)}const p=c.create();a.ScreenSizePerspective=function(g){g.vertex.code.add(m.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);g.vertex.code.add(m.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);g.vertex.code.add(m.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);g.vertex.code.add(m.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);g.vertex.code.add(m.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);g.vertex.code.add(m.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);g.vertex.code.add(m.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(g){g.uniforms.add(new r.Float4PassUniform("screenSizePerspective",h=>n(h.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(g){g.uniforms.add(new r.Float4PassUniform("screenSizePerspectiveAlignment",h=>n(h.screenSizePerspectiveAlignment||h.screenSizePerspective)))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h){const d=c.create(),f=m.create();a.addCameraPosition=function(e,l){l.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",m.ZEROS):e.uniforms.add(new n.Float3DrawUniform("cameraPosition",(A,t)=>r.set(f,t.camera.viewInverseTransposeMatrix[3]-A.origin[0],t.camera.viewInverseTransposeMatrix[7]-A.origin[1],t.camera.viewInverseTransposeMatrix[11]-A.origin[2])))};a.addProjViewLocalOrigin=function(e,l){l.instancedDoublePrecision?e.uniforms.add([new h.Matrix4PassUniform("proj",
(A,t)=>t.camera.projectionMatrix),new h.Matrix4PassUniform("view",(A,t)=>b.translate(d,t.camera.viewMatrix,r.set(f,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]))),new p.Float3PassUniform("localOrigin",(A,t)=>r.set(f,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]))]):e.uniforms.add([new h.Matrix4PassUniform("proj",(A,t)=>t.camera.projectionMatrix),new g.Matrix4DrawUniform("view",
(A,t)=>b.translate(d,t.camera.viewMatrix,A.origin)),new n.Float3DrawUniform("localOrigin",A=>A.origin)])};a.addViewNormal=function(e){e.uniforms.add(new h.Matrix4PassUniform("viewNormal",(l,A)=>A.camera.viewInverseTransposeMatrix))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"mat4",r.BindType.Draw,(h,d,f)=>h.setUniformMatrix4fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var b=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle=
{});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderModules/interfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,r,m,
n,p,g){m=function(h){function d(e,l){var A=h.call(this)||this;A.type=n.ContentObjectType.Material;A.supportsEdges=!1;A._visible=!0;A._renderPriority=0;A._insertOrder=0;A._vertexAttributeLocations=p.Default3D;A._parameters=g.copyParameters(e,l);A.validateParameters(A._parameters);return A}b._inheritsLoose(d,h);var f=d.prototype;f.dispose=function(){};f.update=function(e){return!1};f.setParameters=function(e,l=!0){g.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),l&&
this.parametersChanged())};f.validateParameters=function(e){};f.shouldRender=function(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&0!==(this.renderOccluded&e.renderOccludedMask)};f.isVisibleForOutput=function(e){return!0};f.isVisible=function(){return this._visible};f.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};b._createClass(d,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},
set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);
return d}(m.ContentObject);a.RenderOccludedFlag=void 0;(function(h){h[h.Occlude=1]="Occlude";h[h.Transparent=2]="Transparent";h[h.OccludeAndTransparent=4]="OccludeAndTransparent";h[h.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";h[h.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));r=function(h){function d(){var f=h.apply(this,arguments)||this;f.renderOccluded=a.RenderOccludedFlag.Occlude;return f}b._inheritsLoose(d,h);return d}(r.NoParameters);a.Material=m;a.MaterialParameters=
r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/basicInterfaces ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute ../renderers/utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(D,F,G,J,L,K){if(!r.isNone(D)){var O=w(F,G,k);p.setMin(C,D.getBBMin());p.setMax(C,D.getBBMax());r.isSome(L)&&L.applyToAabb(C);if(u(C,F,O,J)){const {primitiveIndices:P,indices:N,position:H}=D;O=P?P.length:N.length/3;if(1E3<O&&(D=D.getChildren(),void 0!==D)){for(O=0;8>O;++O)void 0!==D[O]&&l(D[O],F,G,J,L,K);return}A(F,G,0,O,N,H,P,L,K)}}}function A(D,F,G,J,L,K,O,P,N){if(O){var H=K.data;K=K.stride||K.size;var E=D[0],I=D[1];D=D[2];var M=F[0]-E,Q=F[1]-I;for(F=
F[2]-D;G<J;++G){var T=O[G],S=3*T,U=K*L[S++],Y=H[U++],V=H[U++],R=H[U];U=K*L[S++];var X=H[U++],W=H[U++],aa=H[U];U=K*L[S];S=H[U++];var ba=H[U++];U=H[U];r.isSome(P)&&([Y,V,R]=P.applyToVertex(Y,V,R,G),[X,W,aa]=P.applyToVertex(X,W,aa,G),[S,ba,U]=P.applyToVertex(S,ba,U,G));X-=Y;W-=V;aa-=R;S-=Y;ba-=V;U-=R;var ia=Q*U-ba*F,ma=F*S-U*M;const ka=M*ba-S*Q;var ha=X*ia+W*ma+aa*ka;if(!(Math.abs(ha)<=Number.EPSILON)){Y=E-Y;V=I-V;R=D-R;ia=Y*ia+V*ma+R*ka;if(0<ha){if(0>ia||ia>ha)continue}else if(0<ia||ia<ha)continue;
ma=V*aa-W*R;R=R*X-aa*Y;V=Y*W-X*V;Y=M*ma+Q*R+F*V;if(0<ha){if(0>Y||ia+Y>ha)continue}else if(0<Y||ia+Y<ha)continue;R=(S*ma+ba*R+U*V)/ha;0<=R&&(X=t(X,W,aa,S,ba,U,q),N(R,X,T,!1))}}}else{O=K.data;H=K.stride||K.size;K=D[0];E=D[1];I=D[2];D=F[0]-K;M=F[1]-E;Q=F[2]-I;for(let ka=G,Z=3*G;ka<J;++ka)if(S=H*L[Z++],V=O[S++],R=O[S++],aa=O[S],S=H*L[Z++],F=O[S++],G=O[S++],T=O[S],S=H*L[Z++],X=O[S++],W=O[S++],S=O[S],r.isSome(P)&&([V,R,aa]=P.applyToVertex(V,R,aa,ka),[F,G,T]=P.applyToVertex(F,G,T,ka),[X,W,S]=P.applyToVertex(X,
W,S,ka)),F-=V,G-=R,T-=aa,X-=V,W-=R,S-=aa,U=M*S-W*Q,Y=Q*X-S*D,ha=D*W-X*M,ba=F*U+G*Y+T*ha,!(Math.abs(ba)<=Number.EPSILON)){V=K-V;R=E-R;aa=I-aa;U=V*U+R*Y+aa*ha;if(0<ba){if(0>U||U>ba)continue}else if(0<U||U<ba)continue;Y=R*T-G*aa;aa=aa*F-T*V;R=V*G-F*R;V=D*Y+M*aa+Q*R;if(0<ba){if(0>V||U+V>ba)continue}else if(0<V||U+V<ba)continue;aa=(X*Y+W*aa+S*R)/ba;0<=aa&&(F=t(F,G,T,X,W,S,q),N(aa,F,ka,!1))}}}function t(D,F,G,J,L,K,O){m.set(x,D,F,G);m.set(v,J,L,K);m.cross(O,x,v);m.normalize(O,O);return O}function w(D,F,
G){return m.set(G,1/(F[0]-D[0]),1/(F[1]-D[1]),1/(F[2]-D[2]))}function u(D,F,G,J){return z(D,F,G,J,Infinity)}function z(D,F,G,J,L){var K=(D[0]-J-F[0])*G[0],O=(D[3]+J-F[0])*G[0];let P=Math.min(K,O);K=Math.max(K,O);O=(D[1]-J-F[1])*G[1];const N=(D[4]+J-F[1])*G[1];K=Math.min(K,Math.max(O,N));if(0>K)return!1;P=Math.max(P,Math.min(O,N));if(P>K)return!1;O=(D[2]-J-F[2])*G[2];D=(D[5]+J-F[2])*G[2];K=Math.min(K,Math.max(O,D));if(0>K)return!1;P=Math.max(P,Math.min(O,D));return P>K?!1:P<L}function y(D,F){F=F?y(F):
{};for(const G in D){let J=D[G];J&&J.forEach&&(J=B(J));null==J&&G in F||(F[G]=J)}return F}function B(D){const F=[];D.forEach(G=>F.push(G));return F}const C=p.create(),k=n.create(),q=n.create(),x=n.create(),v=n.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=w;a.computeNormal=t;a.copyParameters=y;a.intersectAabbInvDir=u;a.intersectAabbInvDirBefore=z;a.intersectDrapedRenderLineGeometry=function(D,F,G,J,L,K){if(F.options.selectionMode){F=D.vertexAttributes.get(f.VertexAttribute.POSITION).data;
var O=D.vertexAttributes.get(f.VertexAttribute.SIZE),P=J[0];J=J[1];D=(((O&&O.data[0])+L)/2+4)*D.screenToWorldRatio;L=Number.MAX_VALUE;O=0;for(let M=0;M<F.length-5;M+=3){var N=F[M],H=F[M+1],E=P-N,I=J-H;N=F[M+3]-N;H=F[M+4]-H;const Q=c.clamp((N*E+H*I)/(N*N+H*H),0,1);E=N*Q-E;I=H*Q-I;I=E*E+I*I;I<L&&(L=I,O=M/3)}L<D*D&&K(G.dist,G.normal,O,!1)}};a.intersectTriangleGeometry=function(D,F,G,J,L,K,O){e.isInstanceHidden(F)||(D.boundingInfo?(d.assert(D.primitiveType===g.PrimitiveType.Triangle),l(D.boundingInfo,
J,L,G.tolerance,K,O)):(F=D.indices.get(f.VertexAttribute.POSITION),D=D.vertexAttributes.get(f.VertexAttribute.POSITION),A(J,L,0,F.length/3,F,D,void 0,K,O)))};a.intersectTriangles=A;a.updateParameters=function(D,F){let G=!1;for(const J in F){const L=F[J];void 0!==L&&(Array.isArray(L)?null===D[J]?(D[J]=L.slice(),G=!0):b.update(D[J],L)&&(G=!0):D[J]!==L&&(G=!0,D[J]=L))}return G};a.verticalOffsetAtDistance=function(D,F,G,J,L){let K=(G.screenLength||0)*D.pixelRatio;r.isSome(L)&&(K=h.scale(K,J,F,L));return c.clamp(K*
Math.tan(.5*D.fovY)/(.5*D.fullHeight)*F,G.minWorldLength||0,null!=G.maxWorldLength?G.maxWorldLength:Infinity)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../geometry/support/buffer/BufferView ../../lib/Util ../../lib/VertexAttribute".split(" "),function(a,b,c,r,m,n){function p(w,u,z,y){const B=
z.typedBuffer;z=z.typedBufferStride;const C=w.length;y*=z;for(let k=0;k<C;++k){const q=2*w[k];B[y]=u[q];B[y+1]=u[q+1];y+=z}}function g(w,u,z,y,B){const C=z.typedBuffer;z=z.typedBufferStride;const k=w.length;y*=z;if(null==B||1===B)for(B=0;B<k;++B){var q=3*w[B];C[y]=u[q];C[y+1]=u[q+1];C[y+2]=u[q+2];y+=z}else for(q=0;q<k;++q){const x=3*w[q];for(let v=0;v<B;++v)C[y]=u[x],C[y+1]=u[x+1],C[y+2]=u[x+2],y+=z}}function h(w,u,z,y,B=1){const C=z.typedBuffer;z=z.typedBufferStride;const k=w.length;y*=z;if(1===
B)for(B=0;B<k;++B){var q=4*w[B];C[y]=u[q];C[y+1]=u[q+1];C[y+2]=u[q+2];C[y+3]=u[q+3];y+=z}else for(q=0;q<k;++q){const x=4*w[q];for(let v=0;v<B;++v)C[y]=u[x],C[y+1]=u[x+1],C[y+2]=u[x+2],C[y+3]=u[x+3],y+=z}}function d(w,u,z,y,B,C=1){if(z){var k=y.typedBuffer;y=y.typedBufferStride;var q=w.length,x=z[0],v=z[1],D=z[2],F=z[4],G=z[5],J=z[6],L=z[8],K=z[9],O=z[10],P=z[12],N=z[13],H=z[14];B*=y;var E=0,I=0,M=0;z=t(z)?Q=>{E=u[Q]+P;I=u[Q+1]+N;M=u[Q+2]+H}:Q=>{const T=u[Q],S=u[Q+1];Q=u[Q+2];E=x*T+F*S+L*Q+P;I=v*T+
G*S+K*Q+N;M=D*T+J*S+O*Q+H};if(1===C)for(C=0;C<q;++C)z(3*w[C]),k[B]=E,k[B+1]=I,k[B+2]=M,B+=y;else for(let Q=0;Q<q;++Q){z(3*w[Q]);for(let T=0;T<C;++T)k[B]=E,k[B+1]=I,k[B+2]=M,B+=y}}else g(w,u,y,B,C)}function f(w,u,z,y,B,C=1){if(z){var k=y.typedBuffer;y=y.typedBufferStride;var q=w.length,x=z[0],v=z[1],D=z[2],F=z[4],G=z[5],J=z[6],L=z[8],K=z[9],O=z[10],P=!c.isOrthoNormal(z);B*=y;var N=0,H=0,E=0;z=t(z)?M=>{N=u[M];H=u[M+1];E=u[M+2]}:M=>{const Q=u[M],T=u[M+1];M=u[M+2];N=x*Q+F*T+L*M;H=v*Q+G*T+K*M;E=D*Q+J*
T+O*M};if(1===C)if(P)for(C=0;C<q;++C)z(3*w[C]),P=N*N+H*H+E*E,.999999>P&&1E-6<P?(P=1/Math.sqrt(P),k[B]=N*P,k[B+1]=H*P,k[B+2]=E*P):(k[B]=N,k[B+1]=H,k[B+2]=E),B+=y;else for(C=0;C<q;++C)z(3*w[C]),k[B]=N,k[B+1]=H,k[B+2]=E,B+=y;else for(let M=0;M<q;++M){z(3*w[M]);if(P){var I=N*N+H*H+E*E;.999999>I&&1E-6<I&&(I=1/Math.sqrt(I),N*=I,H*=I,E*=I)}for(I=0;I<C;++I)k[B]=N,k[B+1]=H,k[B+2]=E,B+=y}}else g(w,u,y,B,C)}function e(w,u,z,y,B,C=1){if(z){var k=y.typedBuffer;y=y.typedBufferStride;var q=w.length,x=z[0],v=z[1],
D=z[2],F=z[4],G=z[5],J=z[6],L=z[8],K=z[9],O=z[10];z=!c.isOrthoNormal(z);B*=y;if(1===C)for(C=0;C<q;++C){var P=4*w[C],N=u[P],H=u[P+1],E=u[P+2];P=u[P+3];var I=x*N+F*H+L*E,M=v*N+G*H+K*E;N=D*N+J*H+O*E;z&&(H=I*I+M*M+N*N,.999999>H&&1E-6<H&&(H=1/Math.sqrt(H),I*=H,M*=H,N*=H));k[B]=I;k[B+1]=M;k[B+2]=N;k[B+3]=P;B+=y}else for(P=0;P<q;++P){I=4*w[P];H=u[I];E=u[I+1];const Q=u[I+2];I=u[I+3];M=x*H+F*E+L*Q;N=v*H+G*E+K*Q;H=D*H+J*E+O*Q;z&&(E=M*M+N*N+H*H,.999999>E&&1E-6<E&&(E=1/Math.sqrt(E),M*=E,N*=E,H*=E));for(E=0;E<
C;++E)k[B]=M,k[B+1]=N,k[B+2]=H,k[B+3]=I,B+=y}}else h(w,u,y,B,C)}function l(w,u,z,y,B,C=1){var k=y.typedBuffer,q=y.typedBufferStride,x=w.length;B*=q;if(z===u.length&&4===z)for(k[B]=u[0],k[B+1]=u[1],k[B+2]=u[2],k[B+3]=u[3],w=new Uint32Array(y.typedBuffer.buffer,y.start),q/=4,B/=4,u=w[B],B+=q,x*=C,k=1;k<x;++k)w[B]=u,B+=q;else if(1===C)if(4===z)for(C=0;C<x;++C)z=4*w[C],k[B]=u[z],k[B+1]=u[z+1],k[B+2]=u[z+2],k[B+3]=u[z+3],B+=q;else for(C=0;C<x;++C)z=3*w[C],k[B]=u[z],k[B+1]=u[z+1],k[B+2]=u[z+2],k[B+3]=255,
B+=q;else if(4===z)for(z=0;z<x;++z){y=4*w[z];for(var v=0;v<C;++v)k[B]=u[y],k[B+1]=u[y+1],k[B+2]=u[y+2],k[B+3]=u[y+3],B+=q}else for(z=0;z<x;++z)for(y=3*w[z],v=0;v<C;++v)k[B]=u[y],k[B+1]=u[y+1],k[B+2]=u[y+2],k[B+3]=255,B+=q}function A(w,u,z,y,B=1){const C=u.typedBuffer;u=u.typedBufferStride;y*=u;if(1===B)for(B=0;B<z;++B)C[y]=w[0],C[y+1]=w[1],C[y+2]=w[2],C[y+3]=w[3],y+=u;else for(let k=0;k<z;++k)for(let q=0;q<B;++q)C[y]=w[0],C[y+1]=w[1],C[y+2]=w[2],C[y+3]=w[3],y+=u}function t(w){return 1===w[0]&&0===
w[1]&&0===w[2]&&0===w[4]&&1===w[5]&&0===w[6]&&0===w[8]&&0===w[9]&&1===w[10]}a.writeBufferFloat=function(w,u,z,y,B=1){const C=z.typedBuffer;z=z.typedBufferStride;const k=w.length;y*=z;if(1===B)for(B=0;B<k;++B)C[y]=u[w[B]],y+=z;else for(let q=0;q<k;++q){const x=u[w[q]];for(let v=0;v<B;v++)C[y]=x,y+=z}};a.writeBufferMat3f=function(w,u,z,y){const B=z.typedBuffer;z=z.typedBufferStride;const C=w.length;y*=z;for(let k=0;k<C;++k){const q=9*w[k];for(let x=0;9>x;++x)B[y+x]=u[q+x];y+=z}};a.writeBufferMat4f=
function(w,u,z,y){const B=z.typedBuffer;z=z.typedBufferStride;const C=w.length;y*=z;for(let k=0;k<C;++k){const q=16*w[k];for(let x=0;16>x;++x)B[y+x]=u[q+x];y+=z}};a.writeBufferVec2=p;a.writeBufferVec3=g;a.writeBufferVec4=h;a.writeColor=l;a.writeDefaultAttributes=function(w,u,z,y,B,C){for(const x of u.fieldNames){u=w.vertexAttributes.get(x);var k=w.indices.get(x);if(u&&k)switch(x){case n.VertexAttribute.POSITION:m.assert(3===u.size);var q=B.getField(x,r.BufferViewVec3f);q&&d(k,u.data,z,q,C);break;
case n.VertexAttribute.NORMAL:m.assert(3===u.size);(q=B.getField(x,r.BufferViewVec3f))&&f(k,u.data,y,q,C);break;case n.VertexAttribute.UV0:m.assert(2===u.size);(q=B.getField(x,r.BufferViewVec2f))&&p(k,u.data,q,C);break;case n.VertexAttribute.COLOR:m.assert(3===u.size||4===u.size);(q=B.getField(x,r.BufferViewVec4u8))&&l(k,u.data,u.size,q,C);break;case n.VertexAttribute.SYMBOLCOLOR:m.assert(3===u.size||4===u.size);(q=B.getField(x,r.BufferViewVec4u8))&&l(k,u.data,u.size,q,C);break;case n.VertexAttribute.TANGENT:m.assert(4===
u.size),(q=B.getField(x,r.BufferViewVec4f))&&e(k,u.data,y,q,C)}else x===n.VertexAttribute.OBJECTANDLAYERIDCOLOR&&b.isSome(w.objectAndLayerIdColor)&&4===w.objectAndLayerIdColor.length&&(u=w.indices.get(n.VertexAttribute.POSITION))&&(u=u.length,k=B.getField(x,r.BufferViewVec4u8),A(w.objectAndLayerIdColor,k,u,C))}};a.writeNormal=f;a.writeObjectAndLayerIdColor=A;a.writePosition=d;a.writeTangent=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/support/engineContent/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4sPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/VisualVariablePassParameters".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J){function L(N){const H=new v.ShaderBuilder;var E=N.signedDistanceFieldEnabled;H.include(d.AlignPixel);H.include(f.HUD,N);H.include(g.SliceDraw,N);if(N.occlusionPass)return H.include(e.HUDOcclusionPass,N),H;const {vertex:I,fragment:M}=H;H.include(z.ScreenSizePerspective);M.include(u.RgbaFloatEncoding);M.include(w.ColorConversion);H.include(A.VisualVariables,N);H.include(h.ObjectAndLayerIdColor,N);H.varyings.add("vcolor","vec4");H.varyings.add("vtc",
"vec2");H.varyings.add("vsize","vec2");N.binaryHighlightOcclusionEnabled&&H.varyings.add("voccluded","float");I.uniforms.add([new B.Float4PassUniform("viewport",(S,U)=>U.camera.fullViewport),new y.Float2PassUniform("screenOffset",(S,U)=>c.set(O,2*S.screenOffset[0]*U.camera.pixelRatio,2*S.screenOffset[1]*U.camera.pixelRatio)),new y.Float2PassUniform("anchorPosition",S=>K(S)),new B.Float4PassUniform("materialColor",S=>S.color),new k.FloatPassUniform("pixelRatio",(S,U)=>U.camera.pixelRatio)]);E&&(I.uniforms.add(new B.Float4PassUniform("outlineColor",
S=>S.outlineColor)),M.uniforms.add([new B.Float4PassUniform("outlineColor",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineColor:m.ZEROS),new k.FloatPassUniform("outlineSize",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineSize:0)]));N.hasScreenSizePerspective&&(z.addScreenSizePerspective(I),z.addScreenSizePerspectiveAlignment(I));(N.debugDrawLabelBorder||N.binaryHighlightOcclusionEnabled)&&H.varyings.add("debugBorderCoords","vec4");H.attributes.add(G.VertexAttribute.UV0,"vec2");H.attributes.add(G.VertexAttribute.COLOR,
"vec4");H.attributes.add(G.VertexAttribute.SIZE,"vec2");H.attributes.add(G.VertexAttribute.AUXPOS2,"vec4");I.code.add(x.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${N.hasScreenSizePerspective?x.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${N.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${N.occlusionTestEnabled||N.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${N.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var Q=x.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const T=N.pixelSnappingEnabled?E?x.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x.glsl`posProj += quadOffset;`;N.vvColor&&I.uniforms.add([new C.Float4sPassUniform("vvColorColors",S=>S.vvColorColors,J.vvColorNumber),new q.FloatsPassUniform("vvColorValues",S=>S.vvColorValues,J.vvColorNumber)]);I.uniforms.add(new y.Float2PassUniform("textureCoordinateScaleFactor",S=>b.isSome(S.texture)&&b.isSome(S.texture.descriptor.textureCoordinateScaleFactor)?S.texture.descriptor.textureCoordinateScaleFactor:r.ONES));I.code.add(x.glsl`
    ${N.occlusionTestEnabled?"if (visible) {":""}
    ${Q}
    ${N.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.glsl.float(t.symbolAlphaCutoff)};
    ${E?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.glsl.float(t.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${T}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${N.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${N.occlusionTestEnabled?x.glsl`} else { vtc = vec2(0.0);
      ${N.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);M.uniforms.add(new D.Texture2DPassUniform("tex",S=>S.texture));Q=N.debugDrawLabelBorder?x.glsl`(isBorder > 0.0 ? 0.0 : ${x.glsl.float(t.defaultMaskAlphaCutoff)})`:x.glsl.float(t.defaultMaskAlphaCutoff);E=x.glsl`
    ${N.debugDrawLabelBorder?x.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${E?x.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.glsl.float(n.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${Q} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.glsl.float(t.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${Q}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${Q}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${N.debugDrawLabelBorder?x.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;N.output===p.ShaderOutput.Alpha&&M.code.add(x.glsl`
      void main() {
        ${E}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);N.output===p.ShaderOutput.ObjectAndLayerIdColor&&M.code.add(x.glsl`
      void main() {
        ${E}
        outputObjectAndLayerIdColor();
      }
      `);N.output===p.ShaderOutput.Color&&M.code.add(x.glsl`
    void main() {
      ${E}
      ${N.transparencyPassType===F.TransparencyPassType.FrontFace?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);N.output===p.ShaderOutput.Highlight&&(H.include(l.OutputHighlight,N),M.code.add(x.glsl`
    void main() {
      ${E}
      ${N.binaryHighlightOcclusionEnabled?x.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return H}function K(N,H=O){if(N.textureIsSignedDistanceField){var E=N.anchorPosition;N=N.distanceFieldBoundingBox;b.isSome(N)?c.set(H,E[0]*(N[2]-N[0])+N[0],E[1]*(N[3]-N[1])+N[1]):c.set(H,0,0)}else c.copy(H,N.anchorPosition);return H}const O=r.create(),P=Object.freeze(Object.defineProperty({__proto__:null,build:L,calculateAnchorPosForRendering:K},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=P;a.build=L;a.calculateAnchorPosForRendering=K})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,c,r,m){function n(y,B=128,C=.5*B,k=0){switch(y){case "circle":return p(B,C);case "square":return g(B,C);case "cross":return d(B,C,k);case "x":return f(B,C,k);case "kite":return h(B,C);case "triangle":return e(B,C);case "arrow":return l(B,C);default:return p(B,C)}}function p(y,B){const C=y/2-.5;return z(y,w(C,C,B/2))}function g(y,B){return A(y,B,!1)}function h(y,B){return A(y,B,
!0)}function d(y,B,C=0){return t(y,B,!1,C)}function f(y,B,C=0){return t(y,B,!0,C)}function e(y,B){return z(y,u(y/2,B,B/2))}function l(y,B){const C=B/2,k=y/2,q=.8*B,x=w(k,(y-B)/2-q,Math.sqrt(q*q+C*C)),v=u(k,B,C);return z(y,(D,F)=>Math.max(v(D,F),-x(D,F)))}function A(y,B,C){C&&(B/=Math.SQRT2);return z(y,(k,q)=>{k=k-.5*y+.25;q=-q+.5*y-.75;if(C){const x=(k+q)/Math.SQRT2;q=(q-k)/Math.SQRT2;k=x}return Math.max(Math.abs(k),Math.abs(q))-.5*B})}function t(y,B,C,k=0){B-=k;C&&(B*=Math.SQRT2);const q=.5*B;return z(y,
(x,v)=>{x-=.5*y;v=-v+.5*y-1;if(C){const D=(x+v)/Math.SQRT2;v=(v-x)/Math.SQRT2;x=D}x=Math.abs(x);v=Math.abs(v);x=x>v?x>q?Math.sqrt((x-q)*(x-q)+v*v):v:v>q?Math.sqrt(x*x+(v-q)*(v-q)):x;return x-=k/2})}function w(y,B,C){return(k,q)=>{k-=y;q-=B;return Math.sqrt(k*k+q*q)-C}}function u(y,B,C){const k=Math.sqrt(B*B+C*C);return(q,x)=>{x=x-y+B/2+.75;return Math.max((B*(Math.abs(q-y)-C)+C*x)/k,-x)}}function z(y,B){const C=new Uint8Array(4*y*y);for(let k=0;k<y;k++)for(let q=0;q<y;q++){const x=q+y*k;let v=B(q,
k);v=v/y+.5;c.packFloatRGBA(v,C,4*x)}return C}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=l;a.createCircle=p;a.createCross=d;a.createKite=h;a.createSquare=g;a.createTexture=function(y,B=128,C=.5*B,k=0){y=n(y,B,C,k);return new r.Texture(y,{mipmap:!1,wrap:{s:m.TextureWrapMode.CLAMP_TO_EDGE,t:m.TextureWrapMode.CLAMP_TO_EDGE},width:B,height:B,components:4,noUnpackFlip:!0})};a.createTriangle=e;a.createX=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(p,g=0){let h=0;for(let d=0;4>d;d++)h+=p[g+d]*m[d];return h}const r=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],n=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(p,g,h=0){p=b.clamp(p,0,n);for(let e=0;4>e;e++){var d=Math,f=p*r[e];g[h+e]=d.floor.call(d,256*(f-Math.floor(f)))}};a.unpackFloatRGBA=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ../../../../chunks/TextureOnly.glsl ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){w=function(F){function G(L,K){var O=F.call(this)||this;O._data=L;O.type=u.ContentObjectType.Texture;O._glTexture=null;O._powerOfTwoStretchInfo=null;O._loadingPromise=null;O._loadingController=null;O.events=new m;O._passParameters=new l.TextureOnlyPassParameters;O.params=K||{};O.params.mipmap=!1!==O.params.mipmap;O.params.noUnpackFlip=O.params.noUnpackFlip||!1;O.params.preMultiplyAlpha=O.params.preMultiplyAlpha||!1;O.params.wrap=O.params.wrap||
{s:C.TextureWrapMode.REPEAT,t:C.TextureWrapMode.REPEAT};O.params.powerOfTwoResizeMode=O.params.powerOfTwoResizeMode||A.PowerOfTwoResizeMode.STRETCH;O.estimatedTexMemRequired=G._estimateTexMemRequired(O._data,O.params);O._startPreload();return O}b._inheritsLoose(G,F);var J=G.prototype;J._startPreload=function(){const L=this._data;p.isNone(L)||(L instanceof HTMLVideoElement?this._startPreloadVideoElement(L):L instanceof HTMLImageElement&&this._startPreloadImageElement(L))};J._startPreloadVideoElement=
function(L){if(!(d.isBlobProtocol(L.src)||"auto"===L.preload&&L.crossOrigin)){L.preload="auto";L.crossOrigin="anonymous";const K=!L.paused;L.src=L.src;if(K&&L.autoplay){const O=()=>{L.removeEventListener("canplay",O);L.play()};L.addEventListener("canplay",O)}}};J._startPreloadImageElement=function(L){d.isDataProtocol(L.src)||d.isBlobProtocol(L.src)||L.crossOrigin||(L.crossOrigin="anonymous",L.src=L.src)};G._getDataDimensions=function(L){return L instanceof HTMLVideoElement?{width:L.videoWidth,height:L.videoHeight}:
L};G._estimateTexMemRequired=function(L,K){if(p.isNone(L))return 0;if(h.isArrayBuffer(L)||h.isUint8Array(L))return K.encoding===G.KTX2_ENCODING?t.estimateMemoryKTX2(L,K.mipmap):K.encoding===G.BASIS_ENCODING?t.estimateMemoryBasis(L,K.mipmap):L.byteLength;const {width:O,height:P}=L instanceof Image||L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof HTMLVideoElement?G._getDataDimensions(L):K;return(K.mipmap?4/3:1)*O*P*(K.components||4)||0};J.dispose=function(){this._data=void 0};J._createDescriptor=
function(L){return{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?C.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:C.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?L.parameters.maxMaxAnisotropy:1)}};J.load=function(L,K){if(p.isSome(this._glTexture))return this._glTexture;
if(p.isSome(this._loadingPromise))return this._loadingPromise;const O=this._data;return p.isNone(O)?this._glTexture=new q.Texture(L,this._createDescriptor(L),null):"string"===typeof O?this._loadFromURL(L,K,O):O instanceof Image?this._loadFromImageElement(L,K,O):O instanceof HTMLVideoElement?this._loadFromVideoElement(L,K,O):O instanceof ImageData||O instanceof HTMLCanvasElement?this._loadFromImage(L,O,K):(h.isArrayBuffer(O)||h.isUint8Array(O))&&this.params.encoding===G.DDS_ENCODING?(this._data=void 0,
this._loadFromDDSData(L,O)):(h.isArrayBuffer(O)||h.isUint8Array(O))&&this.params.encoding===G.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(L,O)):(h.isArrayBuffer(O)||h.isUint8Array(O))&&this.params.encoding===G.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(L,O)):h.isUint8Array(O)?this._loadFromPixelData(L,O):h.isArrayBuffer(O)?this._loadFromPixelData(L,new Uint8Array(O)):null};J.frameUpdate=function(L,K,O){if(!(this._data instanceof HTMLVideoElement)||p.isNone(this._glTexture)||this._data.readyState<
D.HAVE_CURRENT_DATA||O===this._data.currentTime)return O;if(p.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:P,vao:N,sourceTexture:H}=this._powerOfTwoStretchInfo;H.setData(this._data);this._drawStretchedTexture(L,K,P,N,H,this._glTexture)}else{const {videoWidth:P,videoHeight:N}=this._data,{width:H,height:E}=this._glTexture.descriptor;P!==H||N!==E?this._glTexture.updateData(0,0,0,Math.min(P,H),Math.min(N,E),this._data):this._glTexture.setData(this._data)}this._glTexture.descriptor.hasMipmap&&
this._glTexture.generateMipmap();this.params.updateCallback&&this.params.updateCallback();return this._data.currentTime};J._loadFromDDSData=function(L,K){return this._glTexture=z.createDDSTexture(L,this._createDescriptor(L),K)};J._loadFromKTX2=function(L,K){return this._loadAsync(()=>t.createTextureKTX2(L,this._createDescriptor(L),K).then(O=>this._glTexture=O))};J._loadFromBasis=function(L,K){return this._loadAsync(()=>t.createTextureBasis(L,this._createDescriptor(L),K).then(O=>this._glTexture=O))};
J._loadFromPixelData=function(L,K){B.assert(0<this.params.width&&0<this.params.height);const O=this._createDescriptor(L);O.pixelFormat=1===this.params.components?C.PixelFormat.LUMINANCE:3===this.params.components?C.PixelFormat.RGB:C.PixelFormat.RGBA;O.width=this.params.width;O.height=this.params.height;return this._glTexture=new q.Texture(L,O,K)};J._loadFromURL=function(L,K,O){var P=this;return this._loadAsync(function(){var N=b._asyncToGenerator(function*(H){const E=yield f.requestImage(O,{signal:H});
g.throwIfAborted(H);return P._loadFromImage(L,E,K)});return function(H){return N.apply(this,arguments)}}())};J._loadFromImageElement=function(L,K,O){var P=this;return O.complete?this._loadFromImage(L,O,K):this._loadAsync(function(){var N=b._asyncToGenerator(function*(H){const E=yield e.loadImageAsync(O,O.src,!1,H);g.throwIfAborted(H);return P._loadFromImage(L,E,K)});return function(H){return N.apply(this,arguments)}}())};J._loadFromVideoElement=function(L,K,O){return O.readyState>=D.HAVE_CURRENT_DATA?
this._loadFromImage(L,O,K):this._loadFromVideoElementAsync(L,K,O)};J._loadFromVideoElementAsync=function(L,K,O){return this._loadAsync(P=>new Promise((N,H)=>{const E=()=>{O.removeEventListener("loadeddata",I);O.removeEventListener("error",M);p.removeMaybe(Q)},I=()=>{O.readyState>=D.HAVE_CURRENT_DATA&&(E(),N(this._loadFromImage(L,O,K)))},M=T=>{E();H(T||new r("Failed to load video"))};O.addEventListener("loadeddata",I);O.addEventListener("error",M);const Q=g.onAbort(P,()=>M(g.createAbortError()))}))};
J._loadFromImage=function(L,K,O){const P=G._getDataDimensions(K);this.params.width=P.width;this.params.height=P.height;const N=this._createDescriptor(L);N.pixelFormat=3===this.params.components?C.PixelFormat.RGB:C.PixelFormat.RGBA;if(this._requiresPowerOfTwo(L,N)&&(!n.isPowerOfTwo(P.width)||!n.isPowerOfTwo(P.height)))return this._glTexture=this._makePowerOfTwoTexture(L,K,P,N,O);N.width=P.width;N.height=P.height;return this._glTexture=new q.Texture(L,N,K)};J._loadAsync=function(L){const K=new AbortController;
this._loadingController=K;const O=L(K.signal);this._loadingPromise=O;L=()=>{this._loadingController===K&&(this._loadingController=null);this._loadingPromise===O&&(this._loadingPromise=null)};O.then(L,L);return O};J._requiresPowerOfTwo=function(L,K){var O=C.TextureWrapMode.CLAMP_TO_EDGE;O="number"===typeof K.wrapMode?K.wrapMode===O:K.wrapMode.s===O&&K.wrapMode.t===O;return!v(L.gl)&&(K.hasMipmap||!O)};J._makePowerOfTwoTexture=function(L,K,O,P,N){const {width:H,height:E}=O;O=n.nextHighestPowerOfTwo(H);
const I=n.nextHighestPowerOfTwo(E);P.width=O;P.height=I;let M;switch(this.params.powerOfTwoResizeMode){case A.PowerOfTwoResizeMode.PAD:P.textureCoordinateScaleFactor=[H/O,E/I];M=new q.Texture(L,P);M.updateData(0,0,0,H,E,K);break;case A.PowerOfTwoResizeMode.STRETCH:case null:case void 0:M=this._stretchToPowerOfTwo(L,K,P,N());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}P.hasMipmap&&M.generateMipmap();return M};J._stretchToPowerOfTwo=function(L,K,O,P){const N=new q.Texture(L,O),H=
new k.FramebufferObject(L,{colorTarget:C.TargetType.TEXTURE,depthStencilTarget:C.DepthStencilTargetType.NONE},N);K=new q.Texture(L,{target:C.TextureType.TEXTURE_2D,pixelFormat:O.pixelFormat,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:C.TextureSamplingMode.LINEAR,flipped:!!O.flipped,maxAnisotropy:8,preMultiplyAlpha:O.preMultiplyAlpha},K);O=y.createQuadVAO(L);const E=L.getBoundFramebufferObject();this._drawStretchedTexture(L,P,H,O,K,N);this.requiresFrameUpdates?
this._powerOfTwoStretchInfo={vao:O,sourceTexture:K,framebuffer:H}:(O.dispose(!0),K.dispose(),H.detachColorTexture(),H.dispose());L.bindFramebuffer(E);return N};J._drawStretchedTexture=function(L,K,O,P,N,H){this._passParameters.texture=N;L.bindFramebuffer(O);O=L.getViewport();L.setViewport(0,0,H.descriptor.width,H.descriptor.height);L.bindTechnique(K,this._passParameters,null);L.bindVAO(P);L.drawArrays(C.PrimitiveType.TRIANGLE_STRIP,0,x.vertexCount(P,"geometry"));L.bindFramebuffer(null);L.setViewport(O.x,
O.y,O.width,O.height);this._passParameters.texture=null};J.unload=function(){if(p.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:L,vao:K,sourceTexture:O}=this._powerOfTwoStretchInfo;K.dispose(!0);O.dispose();L.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}p.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);if(p.isSome(this._loadingController)){const L=this._loadingController;this._loadingPromise=this._loadingController=null;L.abort()}this.events.emit("unloaded")};
b._createClass(G,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",get:function(){return this._data instanceof HTMLVideoElement}}]);return G}(w.ContentObject);w.DDS_ENCODING="image/vnd-ms.dds";w.KTX2_ENCODING="image/ktx2";w.BASIS_ENCODING="image/x.basis";var D;(function(F){F[F.HAVE_NOTHING=0]="HAVE_NOTHING";F[F.HAVE_METADATA=1]="HAVE_METADATA";F[F.HAVE_CURRENT_DATA=
2]="HAVE_CURRENT_DATA";F[F.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";F[F.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(D||(D={}));a.Texture=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,b,c){function r(){r=b._asyncToGenerator(function*(m,n){({data:m}=yield c(m,{responseType:"image",...n}));return m});return r.apply(this,arguments)}a.requestImage=
function(m,n){return r.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g){function h(){const e=new p.ShaderBuilder;e.include(r.ScreenSpacePass);e.fragment.uniforms.add([new g.Texture2DPassUniform("tex",l=>l.texture),new m.Float4PassUniform("uColor",l=>l.color)]);e.fragment.code.add(n.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return e}let d=function(e){function l(){var A=e.apply(this,arguments)||this;A.color=c.fromValues(1,1,1,1);return A}b._inheritsLoose(l,e);return l}(n.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:d,build:h},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=f;a.TextureOnlyPassParameters=d;a.build=h})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g){function h(){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(){c.isNone(z)&&(z=r.getBasisTranscoder(),u=yield z);return z});return d.apply(this,arguments)}function f(y,B,C,k,q){B=g.getBytesPerElementFormat(B?n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(C*k*B*(q&&1<y?(4**y-1)/(3*4**(y-1)):1))}function e(y){return 1<=y.getNumImages()&&!y.isUASTC()}function l(y){return 1<=y.getFaces()&&
y.isETC1S()}function A(){A=b._asyncToGenerator(function*(y,B,C){c.isNone(u)&&(u=yield h());const k=new u.BasisFile(new Uint8Array(C));if(!e(k))return null;k.startTranscoding();y=w(y,B,k.getNumLevels(0),k.getHasAlpha(),k.getImageWidth(0,0),k.getImageHeight(0,0),(q,x)=>k.getImageTranscodedSizeInBytes(0,q,x),(q,x,v)=>k.transcodeImage(v,0,q,x,0,0));k.close();k.delete();return y});return A.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(y,B,C){c.isNone(u)&&(u=yield h());const k=new u.KTX2File(new Uint8Array(C));
if(!l(k))return null;k.startTranscoding();y=w(y,B,k.getLevels(),k.getHasAlpha(),k.getWidth(),k.getHeight(),(q,x)=>k.getImageTranscodedSizeInBytes(q,0,0,x),(q,x,v)=>k.transcodeImage(v,q,0,0,x,0,-1,-1));k.close();k.delete();return y});return t.apply(this,arguments)}function w(y,B,C,k,q,x,v,D){const {compressedTextureETC:F,compressedTextureS3TC:G}=y.capabilities,[J,L]=F?k?[m.TextureFormat.ETC2_RGBA,n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[m.TextureFormat.ETC1_RGB,n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:
G?k?[m.TextureFormat.BC3_RGBA,n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[m.TextureFormat.BC1_RGB,n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[m.TextureFormat.RGBA32,n.PixelFormat.RGBA];k=B.hasMipmap?C:Math.min(1,C);C=[];for(let K=0;K<k;K++)C.push(new Uint8Array(v(K,J))),D(K,J,C[K]);v=1<C.length;return new p.Texture(y,{...B,samplingMode:v?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR,hasMipmap:v,internalFormat:L,width:q,height:x},{type:"compressed",
levels:C})}let u=null,z=null;a.createTextureBasis=function(y,B,C){return A.apply(this,arguments)};a.createTextureKTX2=function(y,B,C){return t.apply(this,arguments)};a.estimateMemoryBasis=function(y,B){if(c.isNone(u))return y.byteLength;y=new u.BasisFile(new Uint8Array(y));B=e(y)?f(y.getNumLevels(0),y.getHasAlpha(),y.getImageWidth(0,0),y.getImageHeight(0,0),B):0;y.close();y.delete();return B};a.estimateMemoryKTX2=function(y,B){if(c.isNone(u))return y.byteLength;y=new u.KTX2File(new Uint8Array(y));
B=l(y)?f(y.getLevels(),y.getHasAlpha(),y.getWidth(),y.getHeight(),B):0;y.close();y.delete();return B};a.loadBasis=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,b,c,r){let m;b.getBasisTranscoder=function(){if(r.isNone(m)){const n=p=>c.getAssetUrl(`esri/libs/basisu/${p}`);m=(new Promise((p,g)=>a(["../../chunks/basis_transcoder"],p,g))).then(p=>
p.basis_transcoder).then(({default:p})=>p({locateFile:n}).then(g=>{g.initializeBasis();delete g.then;return g}))}return m};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";
b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,r,m,n){function p(l){return l.charCodeAt(0)+(l.charCodeAt(1)<<8)+(l.charCodeAt(2)<<16)+(l.charCodeAt(3)<<24)}function g(l,A){var t=new Int32Array(l,0,31);if(542327876!==t[0])return h.error("Invalid magic number in DDS header"),
null;if(!(t[20]&4))return h.error("Unsupported format, must contain a FourCC code"),null;var w=t[21];let u;switch(w){case d:w=8;u=m.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case f:w=16;u=m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:w=16;u=m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return h.error("Unsupported FourCC code:",String.fromCharCode(w&255,w>>8&255,w>>16&255,w>>24&255)),null}let z=1,y=t[4],B=t[3];if(0!==(y&3)||0!==(B&3))h.warn("Rounding up compressed texture size to nearest multiple of 4."),
y=y+3&-4,B=B+3&-4;const C=y,k=B;t[2]&131072&&!1!==A&&(z=Math.max(1,t[7]));1===z||c.isPowerOfTwo(y)&&c.isPowerOfTwo(B)||(h.warn("Ignoring mipmaps of non power of two sized compressed texture."),z=1);let q=t[1]+4;const x=[];for(let v=0;v<z;++v)t=(y+3>>2)*(B+3>>2)*w,A=new Uint8Array(l,q,t),x.push(A),q+=t,y=Math.max(1,y>>1),B=Math.max(1,B>>1);return{textureData:{type:"compressed",levels:x},internalFormat:u,width:C,height:k}}const h=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),d=p("DXT1"),f=p("DXT3"),
e=p("DXT5");a.createDDSTexture=function(l,A,t){const {textureData:w,internalFormat:u,width:z,height:y}=r.unwrapOrThrow(g(t,A.hasMipmap??!1));A.samplingMode=1<w.levels.length?m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:m.TextureSamplingMode.LINEAR;A.hasMipmap=1<w.levels.length;A.internalFormat=u;A.width=z;A.height=y;return new n.Texture(l,A,w)};a.createDDSTextureData=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(k,q,x){if(q.hasSlicePlane){k.extensions.add("GL_OES_standard_derivatives");q.hasSliceInVertexProgram&&k.vertex.uniforms.add(x);k.fragment.uniforms.add(x);x=d.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var v=d.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;v=q.hasSliceHighlight?d.glsl`
        ${v}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:d.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;q.hasSliceInVertexProgram&&k.vertex.code.add(x);k.fragment.code.add(x);k.fragment.code.add(v)}else x=d.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,q.hasSliceInVertexProgram&&k.vertex.code.add(x),k.fragment.code.add(x)}function e(k,q,x){return k.instancedDoublePrecision?n.set(z,x.camera.viewInverseTransposeMatrix[3],x.camera.viewInverseTransposeMatrix[7],x.camera.viewInverseTransposeMatrix[11]):q.slicePlaneLocalOrigin}function l(k,q){return c.isSome(k)?n.subtract(y,q.origin,k):q.origin}function A(k,q,x){return k.hasSliceTranslatedView?c.isSome(q)?r.translate(C,x.camera.viewMatrix,q):x.camera.viewMatrix:
null}function t(k,q,x){if(c.isNone(x.slicePlane))return p.ZEROS;const v=e(k,q,x);q=l(v,x.slicePlane);k=A(k,v,x);return c.isSome(k)?n.transformMat4(y,q,k):q}function w(k,q,x,v){if(c.isNone(v)||c.isNone(x.slicePlane))return p.ZEROS;const D=e(k,q,x);q=l(D,x.slicePlane);k=A(k,D,x);return c.isSome(k)?(n.add(B,v,q),n.transformMat4(y,q,k),n.transformMat4(B,B,k),n.subtract(B,B,y)):v}let u=function(k){function q(x){var v=k.call(this)||this;v.slicePlaneLocalOrigin=x;return v}b._inheritsLoose(q,k);return q}(d.NoParameters);
const z=p.create(),y=p.create(),B=p.create(),C=m.create();a.SliceDraw=function(k,q){f(k,q,[new g.Float3DrawUniform("slicePlaneOrigin",(x,v)=>t(q,x,v)),new g.Float3DrawUniform("slicePlaneBasis1",(x,v)=>w(q,x,v,c.unwrap(v.slicePlane)?.basis1)),new g.Float3DrawUniform("slicePlaneBasis2",(x,v)=>w(q,x,v,c.unwrap(v.slicePlane)?.basis2))])};a.SlicePass=function(k,q){f(k,q,[new h.Float3PassUniform("slicePlaneOrigin",(x,v)=>t(q,x,v)),new h.Float3PassUniform("slicePlaneBasis1",(x,v)=>w(q,x,v,c.unwrap(v.slicePlane)?.basis1)),
new h.Float3PassUniform("slicePlaneBasis2",(x,v)=>w(q,x,v,c.unwrap(v.slicePlane)?.basis2))])};a.SlicePlaneParameters=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,r){a.ObjectAndLayerIdColor=function(m,n){const p=n.output===b.ShaderOutput.ObjectAndLayerIdColor;
n=n.objectAndLayerIdColorInstanced;p&&(m.varyings.add("objectAndLayerIdColorVarying","vec4"),n?m.attributes.add(r.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):m.attributes.add(r.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));m.vertex.code.add(c.glsl`
     void forwardObjectAndLayerIdColor() {
      ${p?n?c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:c.glsl``} }`);m.fragment.code.add(c.glsl`
      void outputObjectAndLayerIdColor() {
        ${p?c.glsl`gl_FragColor = objectAndLayerIdColorVarying;`:c.glsl``} }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../util/WebGL2Utils ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,b,c,r,m,n,p,g,h){a.HUDOcclusionPass=function(d,f){const {vertex:e,fragment:l}=d;f.hasMultipassGeometry&&e.include(c.multipassGeometryTest);f.hasMultipassTerrain&&d.varyings.add("depth","float");e.code.add(p.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${f.hasMultipassGeometry?p.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${f.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);f.hasMultipassTerrain&&l.include(b.ReadLinearDepth);f.hasMultipassTerrain&&l.uniforms.add([...g.createTexture2DPassSizeUniforms("terrainDepthTexture",(A,t)=>t.multipassTerrain.linearDepthTexture,f.hasWebGL2Context?h.TextureSizeUniformType.None:h.TextureSizeUniformType.InvSize),new n.Float2PassUniform("nearFar",(A,t)=>t.camera.nearFar)]);l.include(r.RgbaFloatEncoding);l.code.add(p.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${f.hasMultipassTerrain?p.glsl`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${m.texelFetch(f,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),function(a,b,c,r,m,n){const p=b.fromValues(1,1,0,1),g=b.fromValues(1,0,1,1);a.OutputHighlight=function(h,d){h.fragment.uniforms.add(m.createTexture2DPassSizeUniforms("depthTex",
(f,e)=>e.highlightDepthTexture,d.hasWebGL2Context?n.TextureSizeUniformType.None:n.TextureSizeUniformType.InvSize));h.fragment.constants.add("occludedHighlightFlag","vec4",p).add("unoccludedHighlightFlag","vec4",g);h.fragment.code.add(r.glsl`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${c.texelFetch(d,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)};a.occludedHighlightFlag=p;a.unoccludedHighlightFlag=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,r,m,n,p,g){a.VisualVariables=function(h,d){d.hasVvInstancing&&(d.vvSize||d.vvColor)&&h.attributes.add(p.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");h=h.vertex;d.vvSize?(h.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",f=>f.vvSizeMinSize)),h.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",f=>f.vvSizeMaxSize)),h.uniforms.add(new b.Float3PassUniform("vvSizeOffset",f=>f.vvSizeOffset)),h.uniforms.add(new b.Float3PassUniform("vvSizeFactor",f=>f.vvSizeFactor)),h.uniforms.add(new n.Matrix3PassUniform("vvSymbolRotationMatrix",
f=>f.vvSymbolRotationMatrix)),h.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",f=>f.vvSymbolAnchor)),h.code.add(m.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),h.code.add(m.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${d.hasVvInstancing?m.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):h.code.add(m.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);d.vvColor?(h.constants.add("vvColorNumber","int",g.vvColorNumber),d.hasVvInstancing&&h.uniforms.add([new r.FloatsPassUniform("vvColorValues",f=>f.vvColorValues,g.vvColorNumber),new c.Float4sPassUniform("vvColorColors",f=>f.vvColorColors,g.vvColorNumber)]),h.code.add(m.glsl`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${d.hasVvInstancing?m.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):h.code.add(m.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g,h){return m.call(this,p,"vec4",r.BindType.Pass,(d,f,e)=>d.setUniform4fv(p,g(f,e)),h)||this}b._inheritsLoose(n,
m);return n}(c.Uniform);a.Float4sPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g,h){return m.call(this,p,"float",r.BindType.Pass,(d,f,e)=>d.setUniform1fv(p,g(f,e)),h)||this}b._inheritsLoose(n,m);return n}(c.Uniform);
a.FloatsPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f64","../../../../chunks/vec3f64","../lib/Material"],function(a,b,c,r,m){m=function(n){function p(){var g=n.apply(this,arguments)||this;g.vvSizeEnabled=!1;g.vvSizeMinSize=r.fromValues(1,1,1);g.vvSizeMaxSize=r.fromValues(100,
100,100);g.vvSizeOffset=r.fromValues(0,0,0);g.vvSizeFactor=r.fromValues(1,1,1);g.vvSizeValue=r.fromValues(1,1,1);g.vvColorEnabled=!1;g.vvColorValues=[0,0,0,0,0,0,0,0];g.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];g.vvOpacityEnabled=!1;g.vvOpacityValues=[0,0,0,0,0,0,0,0];g.vvOpacityOpacities=[1,1,1,1,1,1,1,1];g.vvSymbolAnchor=[0,0,0];g.vvSymbolRotationMatrix=c.create();return g}b._inheritsLoose(p,n);return p}(m.MaterialParameters);a.VisualVariablePassParameters=
m;a.vvColorNumber=8;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=void 0;var b=a.TransparencyPassType||
(a.TransparencyPassType={});b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){p=function(z){function y(){return z.apply(this,arguments)||this}c._inheritsLoose(y,z);var B=y.prototype;B.initializeConfiguration=function(C,k){k.hasWebGL2Context=C.rctx.type===l.ContextType.WEBGL2;k.spherical=C.viewingMode===r.ViewingMode.Global};B.initializeProgram=function(C){return new d.Program(C.rctx,y.shader.get().build(this.configuration),g.Default3D)};B._setPipelineState=function(C){const k=this.configuration,q=C===f.TransparencyPassType.NONE;var x=
C===f.TransparencyPassType.FrontFace;const v=this.configuration.hasPolygonOffset&&w;x=(q||x)&&k.output!==m.ShaderOutput.Highlight?(k.depthEnabled||k.occlusionPass)&&t.defaultDepthWriteParams:null;return t.makePipelineState({blending:k.output===m.ShaderOutput.Color||k.output===m.ShaderOutput.Alpha||k.output===m.ShaderOutput.Highlight?q?u:h.oitBlending(C):null,depthTest:{func:A.CompareFunction.LEQUAL},depthWrite:x,colorWrite:t.defaultColorWriteParams,polygonOffset:v})};B.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
c._createClass(y,[{key:"primitiveType",get:function(){return this.configuration.occlusionPass?A.PrimitiveType.POINTS:A.PrimitiveType.TRIANGLES}}]);return y}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(e.HUDMaterial,()=>new Promise((z,y)=>a(["./HUDMaterial.glsl"],z,y)));const w={factor:0,units:-4},u=t.simpleBlendingParams(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,r){const m=r.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),n=r.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),p=r.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),g={factor:-1,units:-2};a.OITPolygonOffset=
g;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=p;a.blendingColor=n;a.blendingDefault=m;a.getOITPolygonOffset=function(h){return h?g:null};a.oitBlending=function(h){return h===b.TransparencyPassType.FrontFace?null:h===b.TransparencyPassType.Alpha?p:n};a.oitDepthTest=function(h,d=c.CompareFunction.LESS){return h===b.TransparencyPassType.NONE||h===b.TransparencyPassType.FrontFace?d:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(h){return h===b.TransparencyPassType.FrontFace?r.defaultDepthWriteParams:
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,r,m,n,p,g){g=
function(h){function d(){var f=h.apply(this,arguments)||this;f.output=r.ShaderOutput.Color;f.screenCenterOffsetUnitsEnabled=m.HUDSpace.World;f.transparencyPassType=p.TransparencyPassType.NONE;f.spherical=!1;f.occlusionTestEnabled=!0;f.signedDistanceFieldEnabled=!1;f.vvSize=!1;f.vvColor=!1;f.hasVerticalOffset=!1;f.hasScreenSizePerspective=!1;f.debugDrawLabelBorder=!1;f.binaryHighlightOcclusionEnabled=!0;f.hasSlicePlane=!1;f.hasPolygonOffset=!1;f.depthEnabled=!0;f.pixelSnappingEnabled=!0;f.isDraped=
!1;f.hasMultipassGeometry=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;f.occlusionPass=!1;f.objectAndLayerIdColorInstanced=!1;return f}b._inheritsLoose(d,h);return d}(g.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:r.ShaderOutput.COUNT})],g.prototype,"output",void 0);c.__decorate([n.parameter({count:m.HUDSpace.COUNT})],g.prototype,"screenCenterOffsetUnitsEnabled",void 0);c.__decorate([n.parameter({count:p.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",void 0);
c.__decorate([n.parameter()],g.prototype,"spherical",void 0);c.__decorate([n.parameter()],g.prototype,"occlusionTestEnabled",void 0);c.__decorate([n.parameter()],g.prototype,"signedDistanceFieldEnabled",void 0);c.__decorate([n.parameter()],g.prototype,"vvSize",void 0);c.__decorate([n.parameter()],g.prototype,"vvColor",void 0);c.__decorate([n.parameter()],g.prototype,"hasVerticalOffset",void 0);c.__decorate([n.parameter()],g.prototype,"hasScreenSizePerspective",void 0);c.__decorate([n.parameter()],
g.prototype,"debugDrawLabelBorder",void 0);c.__decorate([n.parameter()],g.prototype,"binaryHighlightOcclusionEnabled",void 0);c.__decorate([n.parameter()],g.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],g.prototype,"hasPolygonOffset",void 0);c.__decorate([n.parameter()],g.prototype,"depthEnabled",void 0);c.__decorate([n.parameter()],g.prototype,"pixelSnappingEnabled",void 0);c.__decorate([n.parameter()],g.prototype,"isDraped",void 0);c.__decorate([n.parameter()],g.prototype,"hasMultipassGeometry",
void 0);c.__decorate([n.parameter()],g.prototype,"hasMultipassTerrain",void 0);c.__decorate([n.parameter()],g.prototype,"cullAboveGround",void 0);c.__decorate([n.parameter()],g.prototype,"occlusionPass",void 0);c.__decorate([n.parameter()],g.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([n.parameter({constValue:!0})],g.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([n.parameter({constValue:!1})],g.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=
g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState".split(" "),function(a,b,c,
r,m,n,p,g,h,d){a.LabelDeconflictor=function(f){function e(A){A=f.call(this,A)||this;A.visibilityGroup=h.VisibilityGroup.LABEL;A.iconMarginFactor=0;A._lastDeconfliction=0;return A}b._inheritsLoose(e,f);var l=e.prototype;l.runTask=function(A){if(!this.parent.running){var t=performance.now();if(A.state===d.RenderState.IDLE||2E3<t-this._lastDeconfliction)f.prototype.runTask.call(this,A),this.state===g.State.Idle&&(this._lastDeconfliction=t)}};l.enabledChanged=function(A,t){this.modifyGraphics(t,A.labelsEnabled)};
l.getGraphicsLayers=function(A){return A.labelGraphics};b._createClass(e,[{key:"viewState",get:function(){return this.parent.viewState}}]);return e}(g.Deconflictor);c.__decorate([r.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([p.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O){a.Labeler=function(N){function H(I){I=N.call(this,I)||this;I._dirty=!1;I._labels=new Map;I._labelsToAdd=new Map;I._labelsToRemove=new Map;I._labelingContexts=[];return I}b._inheritsLoose(H,N);var E=H.prototype;E.setup=function(){this.dispose();this._handles=new n;this._handles.add([f.watch(()=>this.view.state?.camera,()=>this.setDirty()),f.watch(()=>this.view.state?.pixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(O.TaskPriority.LABELER,
this)]);this._textTextureAtlas=new L.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new F.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new F.MaterialCollection(this.view._stage)};E.dispose=function(){this._handles=h.destroyMaybe(this._handles);this._textTextureAtlas=h.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=h.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=h.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=
0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};E._activateLabelingContext=function(I){I.labels.forEach((M,Q)=>{this._labels.set(Q,M);M.graphics3DGraphic.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,!0,B.VisibilityGroup.LABEL)});I.active=!0};E._deactivateLabelingContext=function(I){I.labels.forEach((M,Q)=>{M.graphics3DGraphic.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,!1,B.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(M.graphics3DGraphic,!1);this._labels.delete(Q)});
I.active=!1};E._addLabelTextureToAtlas=function(I){for(const M of I.graphics3DGraphic.labelGraphics){if(!M._labelClass)continue;const Q=I.textTextureResources.textRenderers[M._labelIndex];h.isSome(Q)&&this._textTextureAtlas.addTextTexture(Q,M.stageObject)}I.rendered=!0};E._removeLabelTextureFromAtlas=function(I){for(const M of I.graphics3DGraphic.labelGraphics){if(!M._labelClass)continue;const Q=I.textTextureResources.textRenderers[M._labelIndex];h.isSome(Q)&&this._textTextureAtlas.removeTextTexture(Q,
M.stageObject)}I.rendered=!1};E.runTask=function(I){this._updateLabels(I);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(I)};E._updateLabels=function(I){if(this._dirty){this._dirty=!1;for(const M of this._labelingContexts)if(M.active&&z.areLabelsVisible(M.layer)){if(!M.labelClassContexts||!M.labelClassContexts.length){if(null===M.labelClassContexts){this._deactivateLabelingContext(M);continue}this._createLabelClassContext(M);if(M.labelClassPromise&&M.labelClassAbortController){this._dirty=
!0;continue}if(!M.labelClassContexts||!M.labelClassContexts.length)continue}g.someMap(M.labelsToInitialize,(Q,T)=>{this._ensureGraphics3DResources(Q)&&(this._labels.set(T,Q),this.deconflictor.setDirty(),I.madeProgress());if(Q.visible&&Q.textTextureResources.initialized||!Q.visible&&Q.hasGraphics3DResources)M.labelsToInitialize.delete(T),I.madeProgress();return I.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(M=>this._removeLabelTextureFromAtlas(M));this._labelsToAdd.forEach(M=>this._addLabelTextureToAtlas(M));
this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};E._createLabelClassContextAsync=function(){var I=b._asyncToGenerator(function*(M){var Q=this;const T=M.labelClassAbortController.signal;yield M.layer.when();d.throwIfAborted(T);M.scaleVisibility&&M.scaleVisibility.updateScaleRangeActive();const S=M.graphics3DCore;var U=S.layer;if((U=U.labelingInfo&&U.labelingInfo.filter(R=>!!R.symbol))&&0!==U.length){var Y=Array(U.length),V=!1;yield m.forEach(U,function(){var R=
b._asyncToGenerator(function*(X,W){var aa=X.symbol;const ba=q.getGraphics3DSymbol(S.getOrCreateGraphics3DSymbol(aa));if(h.isNone(ba))p.getLogger(Q.declaredClass).error("Failed to create Graphics3DSymbol for label");else{yield ba.load();d.throwIfAborted(T);var ia=null;y.hasCalloutSupport(aa)&&aa.hasVisibleCallout()&&(ia=C.make(aa,S.symbolCreationContext),yield ia.load(),d.throwIfAborted(T));aa=yield m.result(u.createLabelFunction(X,M.layer.fieldsIndex,Q.view.spatialReference));d.throwIfAborted(T);
if(!0===aa.ok){const ma=yield Q._createTextRenderParameters(ba.symbol);d.throwIfAborted(T);Y[W]={labelClass:X,labelFunction:aa.value,graphics3DSymbol:ba,graphics3DCalloutSymbolLayer:ia,calloutSymbolLayerIndex:0,textRenderParameters:ma}}else p.getLogger(Q.declaredClass).error(`Label expression failed to evaluate: ${aa.error}`),V=!0}});return function(X,W){return R.apply(this,arguments)}}());d.throwIfAborted(T);V||(M.labelClassContexts=Y)}});return function(M){return I.apply(this,arguments)}}();E._createLabelClassContext=
function(){var I=b._asyncToGenerator(function*(M){M.labelClassPromise||(M.labelClassPromise=this._createLabelClassContextAsync(M).catch(Q=>{if(d.isAbortError(Q))throw Q;M.labelClassContexts=null}).then(()=>{M.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return M.labelClassPromise});return function(M){return I.apply(this,arguments)}}();E._createTextRenderParameters=function(){var I=b._asyncToGenerator(function*(M){return(M=M.symbolLayers.getItemAt(0))&&
"text"===M.type?J.TextRenderParameters.fromSymbol(M,this.view.state.pixelRatio):null});return function(M){return I.apply(this,arguments)}}();E._destroyLabelClassContext=function(I){for(var M of I.labelClassContexts)--M.graphics3DSymbol.referenced,M.graphics3DSymbol=null;M=I.labelClassAbortController;I.labelClassAbortController=new AbortController;M&&M.abort();I.labelClassContexts=[];I.labelClassPromise=null;this.notifyChange("updating")};E._createTextSymbolGraphic=function(I,M,Q,T,S){I={text:I.text,
centerOffset:Q.centerOffset,translation:Q.translation,elevationOffset:Q.elevationOffset,screenOffset:Q.screenOffset,centerOffsetUnits:Q.centerOffsetUnits,horizontalPlacement:v.horizontalPlacementFromAnchor(Q.anchor),verticalPlacement:v.verticalPlacementFromAnchor(Q.anchor),verticalOffset:Q.verticalOffset,debugDrawLabelBorder:D.LABELS_SHOW_BORDER,displayWidth:I.displayWidth,displayHeight:I.displayHeight};P.graphic=M;P.renderingInfo=null;P.layer=T;return S.createLabel(P,I,this._hudMaterialCollection,
this._textTextureAtlas)};E._createLineCalloutGraphic=function(I,M,Q,T,S){M={symbol:M,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,centerOffset:T.centerOffset,centerOffsetUnits:T.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};P.graphic=I;P.renderingInfo=M;P.layer=S;return Q.createGraphics3DGraphic(P)};E._ensureGraphics3DResources=function(I){if(I.hasGraphics3DResources)return!1;const M=I.graphics3DGraphic;if(M.destroyed)return!1;this._ensureTextTextureResources(I);
const {textTextureResources:Q}=I,T=I.labelingContext,S=T.labelClassContexts;if(!S||0===S.length||!T.emptySymbolLabelSupported&&0===M.graphics.length)return!1;var U=!1,Y=M.graphic;const V=T.layer;var R=z.areLabelsVisible(T.layer);const X=this.view._stage;for(let aa=0;aa<S.length;aa++){const ba=Q.textRenderers[aa],ia=Q.labelPlacements[aa];if(h.isNone(ba)||h.isNone(ia))continue;const ma=S[aa];var W=ma.graphics3DSymbol;const ha=W.symbol&&"label-3d"===W.symbol.type?W.symbol:null;if(W=W.symbolLayers[0]){W.setElevationInfoOverride(T.elevationInfoOverride);
U=this._createTextSymbolGraphic(ba,Y,ia,V,W);if(!U)return!1;U._labelClass=ma.labelClass;U._labelIndex=aa;M.addLabelGraphic(U,X,T.stageLayer);M.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,R,B.VisibilityGroup.LABEL);M.clearVisibilityFlag(B.VisibilityFlag.SCALE_RANGE,B.VisibilityGroup.LABEL);M.setVisibilityFlag(B.VisibilityFlag.DECONFLICTION,!1,B.VisibilityGroup.LABEL);U=!0;(R=ma.graphics3DCalloutSymbolLayer)&&ia.hasLabelVerticalOffset&&(R.setElevationInfoOverride(T.elevationInfoOverride),Y=this._createLineCalloutGraphic(Y,
ha,R,ia,V),h.isSome(Y)&&(ma.calloutSymbolLayerIndex=M.labelGraphics.length,M.addLabelGraphic(Y,X,T.stageLayer)));break}}T.scaleVisibility&&U&&T.scaleVisibility.updateGraphicLabelScaleVisibility(M);return I.hasGraphics3DResources=!0};E._destroyGraphics3DResources=function(I){const M=I.labelingContext.labelClassContexts;for(const Q of I.graphics3DGraphic.labelGraphics){if(null==Q._labelClass)continue;const T=M[Q._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=T)T.onRemoveGraphic(Q)}I.graphics3DGraphic.clearLabelGraphics();
I.hasGraphics3DResources=!1};E._ensureTextTextureResources=function(I){const {textTextureResources:M}=I;if(!M.initialized){var Q=I.labelingContext,T=Q.labelClassContexts;if(T&&0!==T.length){var S=I.graphics3DGraphic.graphic;for(let V=0;V<T.length;V++){const R=T[V];M.textRenderers[V]=null;M.labelPlacements[V]=null;if(!R.textRenderParameters)continue;var U=R.labelFunction;let X;if("arcade"===U.type)try{const W=U.needsHydrationToEvaluate()?w.hydrateGraphic(S,Q.layer):S;X=U.evaluate(W)}catch(W){X=null}else X=
U.evaluate(S);if(!h.isNone(X)&&""!==X&&!/^\s+$/.test(X)&&(U=R.graphics3DSymbol,U.symbolLayers[0]&&(U=x.get({graphics3DGraphic:I.graphics3DGraphic,labelSymbol:U.symbol&&"label-3d"===U.symbol.type?U.symbol:null,labelClass:R.labelClass,disablePlacement:Q.disablePlacement}),!h.isNone(U)))){var Y=v.horizontalPlacementFromAnchor(U.anchor);Y=v.textRenderAlignmentFromHorizontalPlacement(Y);M.textRenderers[V]=new G.TextRenderer(X,Y,R.textRenderParameters);M.labelPlacements[V]=U}}M.initialized=!0}}};E._destroyTextTextureResources=
function(I){({textTextureResources:I}=I);I.initialized=!1;I.textRenderers=[];I.labelPlacements=[]};E._addGraphic=function(I,M){const Q={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:I,graphics3DGraphic:M,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}};M=M.graphic.uid;I.labels.set(M,Q);I.labelsToInitialize.set(M,Q);this.setDirty();this.deconflictor.setDirty()};E._removeGraphic=function(I,M){M=M.graphic.uid;const Q=I.labels.get(M);Q&&(this._destroyGraphic(Q,
M),I.labels.delete(M),I.labelsToInitialize.delete(M),this.setDirty(),this.deconflictor.setDirty())};E._destroyGraphic=function(I,M){this._labels.has(M)&&(this._labels.delete(M),this._labelsToAdd.delete(M),this._labelsToRemove.delete(M));I.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(I),this._destroyTextTextureResources(I));I.hasGraphics3DResources&&this._destroyGraphics3DResources(I)};E._labelingInfoChange=function(){var I=b._asyncToGenerator(function*(M,Q){if(Q)for(const T of Q){if(Q=
M.labels.get(T))this._removeGraphic(M,Q.graphics3DGraphic),this._addGraphic(M,Q.graphics3DGraphic)}else return this._visibilityInfoChange(M),this._resetLabels(M),this._createLabelClassContext(M)});return function(M,Q){return I.apply(this,arguments)}}();E._globalPropertyChanged=function(I,M){for(const Q of M.labelClassContexts){const T=new Map;M.labels.forEach(S=>{S=S.graphics3DGraphic;T.set(S.graphic.uid,S)});h.unwrap(Q.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(I,T,S=>S.labelGraphics[0]);
Q.graphics3DCalloutSymbolLayer&&Q.graphics3DCalloutSymbolLayer.globalPropertyChanged(I,T,S=>S.labelGraphics[Q.calloutSymbolLayerIndex])}};E._visibilityInfoChange=function(I){const M=I.layer.labelsVisible;M&&!I.active&&this._activateLabelingContext(I);!M&&I.active&&this._deactivateLabelingContext(I);this.setDirty()};E._resetAllLabels=function(){for(const I of this._labelingContexts)this._resetLabels(I)};E._resetLabels=function(I){I.labels.forEach((M,Q)=>{this._destroyGraphic(M,Q);M.visible=!1;M.rendered=
!1;I.labelsToInitialize.set(Q,M)});this._destroyLabelClassContext(I);this.setDirty();this.deconflictor.setDirty()};E._findLabelingContext=function(I){for(const M of this._labelingContexts)if(M.graphics3DCore===I)return M;return null};E.addGraphicsOwner=function(I,M,Q){const T=Q&&Q.emptySymbolLabelSupported||!1,S=Q&&Q.elevationInfoOverride||null;Q=Q&&Q.disablePlacement||null;if(!this._findLabelingContext(I)){var U=I.layer,Y={graphics3DCore:I,layer:U,scaleVisibility:M,emptySymbolLabelSupported:T,elevationInfoOverride:S,
disablePlacement:Q,active:U.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new K.WebGLLayer({isPickable:!0},U.uid)};this.view._stage.add(Y.stageLayer);this._labelingContexts.push(Y);this.setDirty();return{addGraphic:V=>this._addGraphic(Y,V),removeGraphic:V=>this._removeGraphic(Y,V),featureReductionChange:()=>{},layerLabelsEnabled:()=>z.areLabelsVisible(Y.layer),labelingInfoChange:V=>this._labelingInfoChange(Y,
V),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Y),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Y),visibilityInfoChange:()=>this._visibilityInfoChange(Y),reset:()=>this._resetLabels(Y),clear:()=>{}}}};E.removeGraphicsOwner=function(I){const M=this._findLabelingContext(I);M&&(I=this._labelingContexts.indexOf(M),this._labelingContexts.splice(I,1),M.labels.forEach(Q=>this._removeGraphic(M,Q.graphics3DGraphic)),this.view._stage.remove(M.stageLayer),
M.stageLayer=null,this.setDirty())};E.setLabelGraphicVisibility=function(I,M){I=I.graphic.uid;const Q=this._labels.get(I);Q&&Q.visible!==M&&(M&&!Q.rendered?(this._labelsToAdd.set(I,Q),this._labelsToRemove.delete(I),Q.textTextureResources.initialized||Q.labelingContext.labelsToInitialize.set(I,Q)):!M&&Q.rendered&&(this._labelsToRemove.set(I,Q),this._labelsToAdd.delete(I)),Q.visible=M,this.setDirty())};E.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};
b._createClass(H,[{key:"running",get:function(){return this.view.ready&&(this._dirty||this._textTextureAtlas?.updating||this.deconflictor.running)}},{key:"updating",get:function(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(I=>I.labelClassPromise&&!!I.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const I=0<this._labelingContexts.length?this._labelingContexts.reduce((M,
Q)=>M+(Q.labelClassPromise&&Q.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*I+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return H}(r);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",
void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([t.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const P=new k(null,null,null);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures ../../geometry/SpatialReference".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(B){return"declaredClass"in B}function e(B){return"declaredClass"in B}function l(B){return"declaredClass"in B}function A(B){return n.isNone(B)?null:f(B)?B:g.fromJSON(t(B))}function t(B){const {wkid:C,wkt:k,latestWkid:q}=B.spatialReference,x={wkid:C,wkt:k,latestWkid:q};switch(B.type){case "point":const {x:v,y:D,z:F,m:G}=B;return{x:v,y:D,z:F,m:G,spatialReference:x};case "polygon":const {rings:J,hasZ:L,hasM:K}=B;return{rings:w(J),hasZ:L,hasM:K,spatialReference:x};
case "polyline":const {paths:O,hasZ:P,hasM:N}=B;return{paths:w(O),hasZ:P,hasM:N,spatialReference:x};case "extent":const {xmin:H,xmax:E,ymin:I,ymax:M,zmin:Q,zmax:T,mmin:S,mmax:U,hasZ:Y,hasM:V}=B;return{xmin:H,xmax:E,ymin:I,ymax:M,zmin:Q,zmax:T,mmin:S,mmax:U,hasZ:Y,hasM:V,spatialReference:x};case "multipoint":const {points:R,hasZ:X,hasM:W}=B;return{points:y(R)?u(R):R,hasZ:X,hasM:W,spatialReference:x}}}function w(B){return z(B)?B.map(C=>u(C)):B}function u(B){return B.map(C=>p.toArray(C))}function z(B){for(const C of B)if(0!==
C.length)return y(C);return!1}function y(B){return B.length&&(p.isFloat32Array(B[0])||p.isFloat64Array(B[0]))}a.clonePoint=function(B,C){if(!B)return null;if(e(B)){if(null==C)return B.clone();if(e(C))return C.copy(B)}null!=C?(C.x=B.x,C.y=B.y,C.spatialReference=B.spatialReference,B.hasZ?(C.z=B.z,C.hasZ=B.hasZ):(C.z=null,C.hasZ=!1),B.hasM?(C.m=B.m,C.hasM=!0):(C.m=null,C.hasM=!1)):(C=h.makeDehydratedPoint(B.x,B.y,B.z,B.spatialReference),B.hasM&&(C.m=B.m,C.hasM=!0));return C};a.hydrateGeometry=A;a.hydrateGraphic=
function(B,C){if(!B)return null;if(l(B))return B;C=new c({layer:C,sourceLayer:C});C.visible=B.visible;C.symbol=m.clone(B.symbol);C.attributes=m.clone(B.attributes);C.geometry=A(B.geometry);return C};a.hydratedSpatialReference=function(B){const {wkid:C,wkt:k,latestWkid:q}=B;return d.fromJSON({wkid:C,wkt:k,latestWkid:q})};a.isHydratedGeometry=f;a.isHydratedGraphic=l;a.isHydratedPoint=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(B,C,k){if(r.isNone(B))return null;switch(C){case "point":return{x:B.x,y:B.y,z:B.z,m:B.m,hasZ:null!=B.z,hasM:null!=B.m,type:"point",spatialReference:k};case "polyline":return{paths:B.paths,hasZ:!!B.hasZ,hasM:!!B.hasM,type:"polyline",spatialReference:k};case "polygon":return{rings:B.rings,hasZ:!!B.hasZ,hasM:!!B.hasM,type:"polygon",spatialReference:k};case "multipoint":return{points:B.points,hasZ:!!B.hasZ,hasM:!!B.hasM,type:"multipoint",spatialReference:k}}}
function t(B){if(r.isNone(B))return 0;let C=32;switch(B.type){case "point":C+=42;break;case "polyline":case "polygon":var k=0;const q=2+(B.hasZ?1:0)+(B.hasM?1:0);B="polyline"===B.type?B.paths:B.rings;for(const x of B)k+=x.length;C+=8*k*q+64;C+=128*k;C=C+34+32*(B.length+1);break;case "multipoint":k=B.points.length;C+=8*k*(2+(B.hasZ?1:0)+(B.hasM?1:0))+64;C+=128*k;C=C+34+32;break;case "extent":C+=98;B.hasM&&(C+=32);B.hasZ&&(C+=32);break;case "mesh":C+=m.estimateSize(B.vertexAttributes.position),C+=m.estimateSize(B.vertexAttributes.normal),
C+=m.estimateSize(B.vertexAttributes.uv),C+=m.estimateSize(B.vertexAttributes.tangent)}return C}function w(B,C){g.empty(C);"mesh"===B.type&&(B=B.extent);switch(B.type){case "point":C[0]=C[3]=B.x;C[1]=C[4]=B.y;B.hasZ&&(C[2]=C[5]=B.z);break;case "polyline":for(var k=0;k<B.paths.length;k++)g.expandWithNestedArray(C,B.paths[k],B.hasZ);break;case "polygon":for(k=0;k<B.rings.length;k++)g.expandWithNestedArray(C,B.rings[k],B.hasZ);break;case "multipoint":g.expandWithNestedArray(C,B.points,B.hasZ);break;
case "extent":C[0]=B.xmin,C[1]=B.ymin,C[3]=B.xmax,C[4]=B.ymax,null!=B.zmin&&(C[2]=B.zmin),null!=B.zmax&&(C[5]=B.zmax)}}function u(B,C){h.empty(C);"mesh"===B.type&&(B=B.extent);switch(B.type){case "point":C[0]=C[2]=B.x;C[1]=C[3]=B.y;break;case "polyline":for(var k=0;k<B.paths.length;k++)h.expandWithNestedArray(C,B.paths[k]);break;case "polygon":for(k=0;k<B.rings.length;k++)h.expandWithNestedArray(C,B.rings[k]);break;case "multipoint":h.expandWithNestedArray(C,B.points);break;case "extent":C[0]=B.xmin,
C[1]=B.ymin,C[2]=B.xmax,C[3]=B.ymax}}const z=g.create(),y=h.create();a.equals=l.equals;a.DehydratedFeatureClass=function(B,C,k){this.uid=B;this.geometry=C;this.attributes=k;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=
w;a.computeAABR=u;a.estimateGeometryObjectSize=t;a.estimateSize=function(B){let C;C=32+b.estimateAttributesObjectSize(B.attributes);return C=C+3+(8+t(B.geometry))};a.expandAABB=function(B,C){w(B,z);g.expandWithAABB(C,z)};a.expandAABR=function(B,C){r.isSome(B)&&(u(B,y),h.expand(C,y,C))};a.fromFeatureSetJSON=function(B){const C=f.featureGeometryTypeKebabDictionary.fromJSON(B.geometryType),k=p.fromJSON(B.spatialReference),q=B.transform,x=B.features.map(v=>{var D=B.objectIdFieldName;v={uid:n.generateUID(),
objectId:D&&v.attributes?v.attributes[D]:null,attributes:v.attributes,geometry:A(v.geometry,C,k),visible:!0};D=v.geometry;if(r.isSome(D)&&q)switch(D.type){case "point":v.geometry=d.unquantizePoint(q,D,D,D.hasZ,D.hasM);break;case "multipoint":v.geometry=d.unquantizeMultipoint(q,D,D,D.hasZ,D.hasM);break;case "polygon":v.geometry=d.unquantizePolygon(q,D,D,D.hasZ,D.hasM);break;case "polyline":v.geometry=d.unquantizePolyline(q,D,D,D.hasZ,D.hasM);break;case "extent":v.geometry=D;break;case "mesh":v.geometry=
D}return v});return{geometryType:C,features:x,spatialReference:k,fields:B.fields?B.fields.map(v=>e.fromJSON(v)):null,objectIdFieldName:B.objectIdFieldName,globalIdFieldName:B.globalIdFieldName,geohashFieldName:B.geohashFieldName,geometryProperties:B.geometryProperties,hasZ:B.hasZ,hasM:B.hasM,exceededTransferLimit:B.exceededTransferLimit,transform:null}};a.fromJSONGeometry=A;a.getObjectId=function(B,C){return null!=B.objectId?B.objectId:B.attributes&&C?B.attributes[C]:null};a.hasGeometry=function(B){return r.isSome(B.geometry)};
a.hasVertices=function(B){if(r.isNone(B))return!1;switch(B.type){case "extent":case "point":return!0;case "polyline":for(const C of B.paths)if(0<C.length)return!0;return!1;case "polygon":for(const C of B.rings)if(0<C.length)return!0;return!1;case "multipoint":return 0<B.points.length;case "mesh":return!B.loaded||0<B.vertexAttributes.position.length}};a.isFeatureGeometry=function(B){return f.isFeatureGeometryType(B.type)};a.makeDehydratedPoint=function(B,C,k,q){return{x:B,y:C,z:k,hasZ:null!=k,hasM:!1,
spatialReference:q,type:"point"}};a.numVertices=function(B){if(r.isNone(B))return 0;switch(B.type){case "point":return 1;case "polyline":var C=0;for(var k of B.paths)C+=k.length;return C;case "polygon":k=0;for(C of B.rings)k+=C.length;return k;case "multipoint":return B.points.length;case "extent":return 2;case "mesh":return(B=B.vertexAttributes&&B.vertexAttributes.position)?B.length/3:0}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/quantizationUtils":function(){define(["exports",
"../../core/maybe","./jsonUtils"],function(a,b,c){function r({scale:F,translate:G},J){return Math.round((J-G[0])/F[0])}function m({scale:F,translate:G},J){return Math.round((G[1]-J)/F[1])}function n(F,G,J){const L=[];let K,O,P,N;for(let H=0;H<J.length;H++){const E=J[H];if(0<H){if(P=r(F,E[0]),N=m(F,E[1]),P!==K||N!==O)L.push(G(E,P-K,N-O)),K=P,O=N}else K=r(F,E[0]),O=m(F,E[1]),L.push(G(E,K,O))}return 0<L.length?L:null}function p(F,G,J,L){return n(F,J?L?D:v:L?v:x,G)}function g(F,G,J,L){const K=[];J=J?
L?D:v:L?v:x;for(L=0;L<G.length;L++){const O=n(F,J,G[L]);O&&3<=O.length&&K.push(O)}return K.length?K:null}function h(F,G,J,L){const K=[];J=J?L?D:v:L?v:x;for(L=0;L<G.length;L++){const O=n(F,J,G[L]);O&&2<=O.length&&K.push(O)}return K.length?K:null}function d({scale:F,translate:G},J){return J*F[0]+G[0]}function f({scale:F,translate:G},J){return G[1]-J*F[1]}function e(F,G,J){const L=Array(J.length);if(!J.length)return L;const [K,O]=F.scale;let P=d(F,J[0][0]);F=f(F,J[0][1]);L[0]=G(J[0],P,F);for(let N=1;N<
J.length;N++){const H=J[N];P+=H[0]*K;F-=H[1]*O;L[N]=G(H,P,F)}return L}function l(F,G,J){const L=Array(J.length);for(let K=0;K<J.length;K++)L[K]=e(F,G,J[K]);return L}function A(F,G,J,L){return e(F,J?L?D:v:L?v:x,G)}function t(F,G,J,L){return l(F,J?L?D:v:L?v:x,G)}function w(F,G,J,L){return l(F,J?L?D:v:L?v:x,G)}function u(F,G,J){let [L,K]=J[0],O=Math.min(L,G[0]),P=Math.min(K,G[1]),N=Math.max(L,G[2]);G=Math.max(K,G[3]);for(let H=1;H<J.length;H++){const [E,I]=J[H];L+=E;K+=I;0>E&&(O=Math.min(O,L));0<E&&
(N=Math.max(N,L));0>I?P=Math.min(P,K):0<I&&(G=Math.max(G,K))}F[0]=O;F[1]=P;F[2]=N;F[3]=G;return F}function z(F,G){if(!G.length)return null;F[0]=F[1]=Number.POSITIVE_INFINITY;F[2]=F[3]=Number.NEGATIVE_INFINITY;for(let J=0;J<G.length;J++)u(F,F,G[J]);return F}function y(F,G,J,L,K){G.xmin=r(F,J.xmin);G.ymin=m(F,J.ymin);G.xmax=r(F,J.xmax);G.ymax=m(F,J.ymax);G!==J&&(L&&(G.zmin=J.zmin,G.zmax=J.zmax),K&&(G.mmin=J.mmin,G.mmax=J.mmax));return G}function B(F,G,J,L,K){G.points=p(F,J.points,L,K)??[];return G}
function C(F,G,J,L,K){G.x=r(F,J.x);G.y=m(F,J.y);G!==J&&(L&&(G.z=J.z),K&&(G.m=J.m));return G}function k(F,G,J,L,K){F=g(F,J.rings,L,K);if(!F)return null;G.rings=F;return G}function q(F,G,J,L,K){F=h(F,J.paths,L,K);if(!F)return null;G.paths=F;return G}const x=(F,G,J)=>[G,J],v=(F,G,J)=>[G,J,F[2]],D=(F,G,J)=>[G,J,F[2],F[3]];a.equals=function(F,G){if(F===G||null==F&&null==G)return!0;if(null==F||null==G)return!1;let J,L,K,O;F&&"upperLeft"===F.originPosition?(J=F.translate[0],L=F.translate[1],F=F.scale[0]):
(J=b.isSome(F.extent)?F.extent.xmin:0,L=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);G&&"upperLeft"===G.originPosition?(K=G.translate[0],O=G.translate[1],G=G.scale[0]):(K=b.isSome(G.extent)?G.extent.xmin:0,O=b.isSome(G.extent)?G.extent.ymax:0,G=G.tolerance);return J===K&&L===O&&F===G};a.getQuantizedBoundsCoordsArray=u;a.getQuantizedBoundsCoordsArrayArray=z;a.getQuantizedBoundsPaths=function(F){return z([0,0,0,0],F)};a.getQuantizedBoundsPoints=function(F){const G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return u(G,G,F)};a.getQuantizedBoundsRings=function(F){return z([0,0,0,0],F)};a.quantizeBounds=function(F,G,J){G[0]=r(F,J[0]);G[3]=m(F,J[1]);G[2]=r(F,J[2]);G[1]=m(F,J[3]);return G};a.quantizeExtent=y;a.quantizeGeometry=function(F,G){return F&&G?c.isPoint(G)?C(F,{},G,!1,!1):c.isPolyline(G)?q(F,{},G,!1,!1):c.isPolygon(G)?k(F,{},G,!1,!1):c.isMultipoint(G)?B(F,{},G,!1,!1):c.isExtent(G)?y(F,{},G,!1,!1):null:null};a.quantizeMultipoint=B;a.quantizePaths=
h;a.quantizePoint=C;a.quantizePoints=p;a.quantizePolygon=k;a.quantizePolyline=q;a.quantizeRings=g;a.quantizeX=r;a.quantizeY=m;a.toQuantizationTransform=function(F){return F?{originPosition:"upper-left"===F.originPosition?"upperLeft":"lower-left"===F.originPosition?"lowerLeft":F.originPosition,scale:F.tolerance?[F.tolerance,F.tolerance]:[1,1],translate:b.isSome(F.extent)?[F.extent.xmin,F.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(F,G,J){return J?(G[0]=d(F,J[0]),G[1]=f(F,J[3]),G[2]=d(F,J[2]),
G[3]=f(F,J[1]),G):[d(F,G[0]),f(F,G[3]),d(F,G[2]),f(F,G[1])]};a.unquantizeCoordsArray=e;a.unquantizeCoordsArrayArray=l;a.unquantizeExtent=function(F,G,J,L,K){G.xmin=d(F,J.xmin);G.ymin=f(F,J.ymin);G.xmax=d(F,J.xmax);G.ymax=f(F,J.ymax);G!==J&&(L&&(G.zmin=J.zmin,G.zmax=J.zmax),K&&(G.mmin=J.mmin,G.mmax=J.mmax));return G};a.unquantizeMultipoint=function(F,G,J,L,K){b.isSome(J)&&(G.points=A(F,J.points,L,K));return G};a.unquantizePaths=t;a.unquantizePoint=function(F,G,J,L,K){if(b.isNone(J))return G;G.x=d(F,
J.x);G.y=f(F,J.y);G!==J&&(L&&(G.z=J.z),K&&(G.m=J.m));return G};a.unquantizePoints=A;a.unquantizePolygon=function(F,G,J,L,K){b.isSome(J)&&(G.rings=w(F,J.rings,L,K));return G};a.unquantizePolyline=function(F,G,J,L,K){b.isSome(J)&&(G.paths=t(F,J.paths,L,K));return G};a.unquantizeRings=w;a.unquantizeX=d;a.unquantizeY=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has",
"../../core/maybe","../../geometry/support/spatialReferenceUtils"],function(a,b,c,r){function m(d,f){if(d===f)return!0;if(null==d||null==f||d.length!==f.length)return!1;for(let e=0;e<d.length;e++){const l=d[e],A=f[e];if(l.length!==A.length)return!1;for(let t=0;t<l.length;t++)if(l[t]!==A[t])return!1}return!0}function n(d,f){if(d===f)return!0;if(null==d||null==f||d.length!==f.length)return!1;for(let e=0;e<d.length;e++)if(!m(d[e],f[e]))return!1;return!0}function p(d,f){return d===f||c.isSome(d)&&c.isSome(f)&&
r.equals(d.spatialReference,f.spatialReference)&&d.x===f.x&&d.y===f.y&&d.z===f.z&&d.m===f.m}function g(d,f){if(d===f)return!0;if(c.isNone(d)||c.isNone(f)||d.type!==f.type)return!1;switch(d.type){case "point":return p(d,f);case "extent":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:r.equals(d.spatialReference,f.spatialReference)?d.xmin===f.xmin&&d.ymin===f.ymin&&d.zmin===f.zmin&&d.xmax===f.xmax&&d.ymax===f.ymax&&d.zmax===f.zmax:!1,d;case "polyline":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:r.equals(d.spatialReference,
f.spatialReference)?n(d.paths,f.paths):!1,d;case "polygon":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:r.equals(d.spatialReference,f.spatialReference)?n(d.rings,f.rings):!1,d;case "multipoint":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:r.equals(d.spatialReference,f.spatialReference)?m(d.points,f.points):!1,d;case "mesh":return!1}}function h(d,f){if(d===f)return!0;if(!d||!f)return!1;const e=Object.keys(d),l=Object.keys(f);if(e.length!==l.length)return!1;for(const A of e)if(d[A]!==f[A])return!1;
return!0}a.equals=function(d,f){return d===f?!0:null!=d&&null!=f&&d.objectId===f.objectId&&g(d.geometry,f.geometry)&&h(d.attributes,f.attributes)?!0:!1};a.pointEquals=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/maybe ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(){e=c._asyncToGenerator(function*(u,z,y){if(!u||!u.symbol)return t;const B=u.where,C=d.getLabelExpression(u);u=B?yield new Promise((k,q)=>a(["../../core/sql/WhereClause"],k,q)):null;if("arcade"===C.type){const k=yield f.createLabelExpression(C.expression,y,z);if(n.isNone(k))return t;y={type:"arcade",evaluate(q){try{const x=k.evaluate({$feature:"attributes"in q?k.repurposeFeature(q):q});if(null!=x)return x.toString()}catch(x){A.error(new r("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{feature:q,expression:C}))}return null},needsHydrationToEvaluate(){return null==d.getSingleFieldArcadeExpression(C.expression)}}}else y={type:"simple",evaluate(k){return C.expression.replace(/{[^}]*}/g,q=>{var x=q.slice(1,-1);x=z.get(x);if(!x)return q;q=null;"attributes"in k?k&&k.attributes&&(q=k.attributes[x.name]):q=k.field(x.name);return null==q?"":l(q,x)})}};if(B){let k;try{k=u.WhereClause.create(B,z)}catch(x){return A.error(new r("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:B,error:x})),t}const q=y.evaluate;y.evaluate=x=>{const v="attributes"in x?void 0:w;try{if(k.testFeature(x,v))return q(x)}catch(D){A.error(new r("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:B,feature:x,error:D}))}return null}}return y});return e.apply(this,arguments)}function l(u,z){if(null==u)return"";const y=z.domain;if(y)if("codedValue"===y.type||"coded-value"===y.type)for(var B of y.codedValues){if(B.code===
u)return B.name}else if("range"===y.type){B=+u;const C="range"in y?y.range[1]:y.maxValue;if(("range"in y?y.range[0]:y.minValue)<=B&&B<=C)return y.name}"date"===z.type||"esriFieldTypeDate"===z.type?u=p.formatDate(u,p.convertDateFormatToIntlOptions("short-date")):h.isNumericField(z)&&(u=g.formatNumber(+u));return u?u:""}const A=m.getLogger("esri.layers.support.labelFormatUtils"),t={type:"simple",evaluate(){return null}},w={getAttribute(u,z){return u.field(z)}};b.createLabelFunction=function(u,z,y){return e.apply(this,
arguments)};b.formatField=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,r){const m=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),n={line:r.Graphics3DLineCalloutSymbolLayer};a.make=function(p,g){if(!c.hasCalloutSupport(p))return m.error("Graphics3DCalloutSymbolLayerFactory#make",
`symbol of type '${p.type}' does not support callouts`),null;if(!p.callout)return null;const h=n[p.callout.type];return h?new h(p,g):(m.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${p.callout.type}`),null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){e=function(v){function D(G,J){G=v.call(this,G,null,J,x)||this;G._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inheritsLoose(D,v);var F=D.prototype;F.doLoad=function(){var G=b._asyncToGenerator(function*(){this._material=new B.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)});return function(){return G.apply(this,arguments)}}();F.destroy=function(){v.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};F._perInstanceMaterialParameters=function(G){const J=this._materialParameters;J.screenOffset=G.screenOffset||n.ZEROS;J.centerOffsetUnits=G.centerOffsetUnits||"world";return J};F._defaultElevationInfoNoZ=function(){return q};F.createGraphics3DGraphic=function(G){const J=G.renderingInfo;G=G.graphic;const L=this.setGraphicElevationContext(G,new d.ElevationContext,J.elevationOffset||0);var K=J.symbol;const O="on-the-ground"===this._elevationContext.mode&&
("cim"===K.type||!K.symbolLayers.some(P=>"object"===P.type||"text"===P.type));if("label-3d"!==K.type&&O||"point-3d"===K.type&&K.symbolLayers.every(P=>"text"===P.type&&!p.textSymbolLayerSupportsVerticalOffset(P)))return null;K=l.computeCentroid(G.geometry);return r.isNone(K)?null:this._createAs3DShape(K,L,J,G.uid)};F.layerOpacityChanged=function(){r.isSome(this._material)&&this._material.setParameters(this._materialParameters)};F.layerElevationInfoChanged=function(G,J,L){L=h.elevationModeChangeUpdateType(D.elevationModeChangeTypes,
L,this._elevationContext.mode);if(L!==h.SymbolUpdateType.UPDATE)return L;G.forEach(K=>{const O=J(K);r.isSome(O)&&this.updateGraphicElevationContext(K.graphic,O)});return L};F.slicePlaneEnabledChanged=function(){if(r.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.pixelRatioChanged=function(){return!0};F.setGraphicElevationContext=function(G,J,L=0){G=v.prototype.setGraphicElevationContext.call(this,
G,J);G.addOffsetRenderUnits(L);return G};F.updateGraphicElevationContext=function(G,J){this.setGraphicElevationContext(G,J.elevationContext,J.metadata.elevationOffset);J.needsElevationUpdates=h.needsElevationUpdates2D(J.elevationContext.mode)};F.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:t.emptySymbolComplexity.memory}};F._createVertexData=function(G){const {translation:J,centerOffset:L}=G;return[[y.VertexAttribute.POSITION,
J?{size:3,data:[J[0],J[1],J[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[y.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[y.VertexAttribute.AUXPOS1,L?{size:4,data:[L[0],L[1],L[2],L[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};F._getOrCreateMaterial=function(G){const J=this._perInstanceMaterialParameters(G),L=B.LineCalloutMaterial.uniqueMaterialIdentifier(J);if(r.isSome(this._material)&&L===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};
if(G.materialCollection){let K=G.materialCollection.get(L);r.isNone(K)&&(K=new B.LineCalloutMaterial(J),G.materialCollection.add(L,K));return{material:K,isUnique:!1}}return{material:new B.LineCalloutMaterial(J),isUnique:!0}};F._createAs3DShape=function(G,J,L,K){var O=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:K,layerUid:this._context.layer.uid});O=[new u.Geometry(this._createVertexData(L),k,w.PrimitiveType.Point,O)];const P=this._getOrCreateMaterial(L);K=A.createStageObjectForHUD(this._context,
G,O,[P.material],J,this._context.layer.uid,K);if(null===K)return null;O=new f.Graphics3DObject3DGraphicLayer(this,K.object,O,P.isUnique?[P.material]:null,null,g.perObjectElevationAligner,J);O.metadata={elevationOffset:L.elevationOffset||0};O.alignedSampledElevation=K.sampledElevation;O.needsElevationUpdates=h.needsElevationUpdates2D(J.mode);A.extendPointGraphicElevationContext(O,G,this._context.elevationProvider);return O};b._createClass(D,[{key:"_materialParameters",get:function(){const G=this.symbol;
var J=G.callout;const L=r.isSome(J.color)?c.toUnitRGBA(J.color):[0,0,0,0];L[3]*=this._getLayerOpacity();const K=m.pt2px(J.size||0);let O=null;if(G.verticalOffset){const {screenLength:N,minWorldLength:H,maxWorldLength:E}=G.verticalOffset;O={screenLength:m.pt2px(N),minWorldLength:H||0,maxWorldLength:r.isSome(E)?E:Infinity}}J=r.isSome(J.border)&&r.isSome(J.border.color)?c.toUnitRGBA(J.border.color):null;const P="object"===G.symbolLayers.getItemAt(0).type;return{color:L,size:K,verticalOffset:O,screenSizePerspective:this._context.screenSizePerspectiveEnabled?
this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:J,occlusionTest:!P,shaderPolygonOffset:P?0:void 0,depthHUDAlignStart:"label-3d"===G.type,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:z.RenderOccludedFlag.Occlude,__tagStrict:"NoParameters"}}}]);return D}(e.Graphics3DSymbolLayer);e.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.UPDATE,staysOnTheGround:h.SymbolUpdateType.UPDATE,onTheGroundChanged:h.SymbolUpdateType.RECREATE};
const C=[0],k=[[y.VertexAttribute.POSITION,C],[y.VertexAttribute.NORMAL,C],[y.VertexAttribute.AUXPOS1,C]],q={mode:"relative-to-ground",offset:0},x={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(C,k,q,x){let v=!1;const D=q.spatialReference;var F=C.geometry,G=C.getShaderTransformation();C=k.requiresSampledElevationInfo;w[0]=G[12];w[1]=G[13];w[2]=G[14];F.invalidateBoundingInfo();var J=F.getMutableAttribute(e.VertexAttribute.POSITION);G=J.data;var L=F.vertexAttributes.get(e.VertexAttribute.MAPPOS).data;F=J.size;J=G.length/F;L=new f.SamplePosition(L,D);let K=0,O=0;for(let P=0;P<J;P++){u[0]=G[K];u[1]=G[K+1];u[2]=G[K+2];g.evaluateElevationInfoAtPoint(L,
q,k,x,B);C&&(O+=B.sampledElevation);if(d.TESTS_DISABLE_OPTIMIZATIONS)G[K]=L.array[L.offset],G[K+1]=L.array[L.offset+1],G[K+2]=B.z,p.projectBuffer(G,D,K,G,x.spatialReference,K,1),G[K]-=w[0],G[K+1]-=w[1],G[K+2]-=w[2],v=!0;else{t[0]=G[K]+w[0];t[1]=G[K+1]+w[1];t[2]=G[K+2]+w[2];x.setAltitude(t,B.z);G[K]=t[0]-w[0];G[K+1]=t[1]-w[1];G[K+2]=t[2]-w[2];const N=.01/x.unitInMeters;if(Math.abs(u[0]-G[K])>=N||Math.abs(u[1]-G[K+1])>=N||Math.abs(u[2]-G[K+2])>=N)v=!0}K+=F;L.offset+=3}return{update:v,averageGeometrySampledElevation:O/
J}}const A=r.create(),t=n.create(),w=n.create(),u=n.create(),z=r.create(),y=n.create(),B=new g.SampleElevationInfo;a.perLodInstanceElevationAligner=function(C,k,q,x){var v=C.graphics3DSymbolLayer.lodRenderer;if(b.isNone(v))return 0;const D=k.centerPointInElevationSR;g.evaluateElevationInfoAtPoint(D,q,k,x,B);k="absolute-height"!==k.mode?B.sampledElevation:0;v=v.instanceData;C=C.instanceIndex;v.getGlobalTransform(C,z);q=m.set(y,z[12],z[13],z[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(t[0]=D.x,t[1]=D.y,t[2]=
B.z,p.computeTranslationToOriginAndRotation(D.spatialReference,t,z,x.spatialReference)&&v.setGlobalTransform(C,z)):x.setAltitudeOfTransformation(B.z,z);x=.01/x.unitInMeters;(d.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(z[12]-q[0])>=x||Math.abs(z[13]-q[1])>=x||Math.abs(z[14]-q[2])>=x)&&v.setGlobalTransform(C,z);return k};a.perObjectElevationAligner=function(C,k,q,x){C=C.stageObject;const v=k.centerPointInElevationSR;let D=0;C.metadata.usesVerticalDistanceToGround?(g.evaluateElevationInfoAtPoint(v,q,k,x,
B),h.updateVertexAttributeAuxpos1w(C,B.verticalDistanceToGround),D=B.sampledElevation):(g.evaluateElevationInfoAtPoint(v,q,k,x,B),"absolute-height"!==k.mode&&(D=B.sampledElevation));k=c.copy(A,C.transformation);q=m.set(y,k[12],k[13],k[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(t[0]=v.x,t[1]=v.y,t[2]=B.z,p.computeTranslationToOriginAndRotation(v.spatialReference,t,k,x.spatialReference)&&(C.transformation=k)):x.setAltitudeOfTransformation(B.z,k);x=.01/x.unitInMeters;if(Math.abs(k[12]-q[0])>=x||Math.abs(k[13]-
q[1])>=x||Math.abs(k[14]-q[2])>=x)C.transformation=k;return D};a.perVertexElevationAligner=function(C,k,q,x){C=C.stageObject;const v=C.geometryRecords;let D=0;for(const F of v){const {update:G,averageGeometrySampledElevation:J}=l(F,k,q,x);D+=J;G&&C.geometryVertexAttrsUpdated(F)}return D/v.length};a.sharedGeometryElevationAligner=function(C,k,q,x){C=C.stageObject;const v=C.geometryRecords;if(0===v.length)return 0;let D=0,F=null,G=0,J=!1;for(const L of v){const K=L.geometry.vertexAttributes.get(e.VertexAttribute.POSITION);
if(K!==F){const {update:O,averageGeometrySampledElevation:P}=l(L,k,q,x);G=P;F=K;J=O}J&&C.geometryVertexAttrsUpdated(L);D+=G}return D/v.length};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(u,z,y,B,C){const k=(g.isDehydratedPoint(u)?u.z:d.isSamplePosition(u)?u.array[u.offset+2]:u[2])||0;switch(y.mode){case "on-the-ground":y=c.unwrapOr(d.getElevationAtPoint(z,u,"ground"),0);C.verticalDistanceToGround=0;C.sampledElevation=y;C.z=y;break;case "relative-to-ground":u=c.unwrapOr(d.getElevationAtPoint(z,u,"ground"),0);y=y.geometryZWithOffset(k,B);C.verticalDistanceToGround=y;C.sampledElevation=u;C.z=y+u;break;case "relative-to-scene":u=c.unwrapOr(d.getElevationAtPoint(z,
u,"scene"),0);y=y.geometryZWithOffset(k,B);C.verticalDistanceToGround=y;C.sampledElevation=u;C.z=y+u;break;case "absolute-height":y=y.geometryZWithOffset(k,B);B=c.unwrapOr(d.getElevationAtPoint(z,u,"ground"),0);C.verticalDistanceToGround=y-B;C.sampledElevation=B;C.z=y;break;default:b.neverReached(y.mode),C.z=0}}let e=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(u){u[u.NONE=0]="NONE";u[u.UPDATE=1]="UPDATE";u[u.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||
(a.SymbolUpdateType={}));const l={"absolute-height":{applyElevationAlignmentBuffer:function(u,z,y,B,C,k,q,x){k=x.calculateOffsetRenderUnits(q);x=x.featureExpressionInfoContext;z*=3;B*=3;for(q=0;q<C;++q){const v=u[z+1],D=u[z+2];y[B+0]=u[z+0];y[B+1]=v;y[B+2]=null==x?D+k:k;z+=3;B+=3}return 0},requiresAlignment:function(u){const z=u.featureExpressionInfoContext;return 0!==u.meterUnitOffset||null!=z}},"on-the-ground":{applyElevationAlignmentBuffer:function(u,z,y,B,C,k){let q=0;const x=k.spatialReference;
z*=3;B*=3;for(let v=0;v<C;++v){const D=u[z+0],F=u[z+1],G=c.unwrapOr(k.getElevation(D,F,u[z+2],x,"ground"),0);q+=G;y[B+0]=D;y[B+1]=F;y[B+2]=G;z+=3;B+=3}return q/C},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(u,z,y,B,C,k,q,x){let v=0;q=x.calculateOffsetRenderUnits(q);x=x.featureExpressionInfoContext;const D=k.spatialReference;z*=3;B*=3;for(let F=0;F<C;++F){const G=u[z+0],J=u[z+1],L=u[z+2],K=c.unwrapOr(k.getElevation(G,J,L,D,"ground"),0);v+=K;y[B+0]=G;y[B+1]=
J;y[B+2]=null==x?L+K+q:K+q;z+=3;B+=3}return v/C},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(u,z,y,B,C,k,q,x){let v=0;q=x.calculateOffsetRenderUnits(q);x=x.featureExpressionInfoContext;const D=k.spatialReference;z*=3;B*=3;for(let F=0;F<C;++F){const G=u[z+0],J=u[z+1],L=u[z+2],K=c.unwrapOr(k.getElevation(G,J,L,D,"scene"),0);v+=K;y[B+0]=G;y[B+1]=J;y[B+2]=null==x?L+K+q:K+q;z+=3;B+=3}return v/C},requiresAlignment:()=>!0}},A=m.create(),t=new e,w=n.create();a.SampleElevationInfo=
e;a.applyElevationAlignmentForHUD=function(u,z,y,B,C){f(z,y,C,B,t);h.updateVertexAttributeAuxpos1w(u,t.verticalDistanceToGround);y=t.sampledElevation;C=r.copy(A,u.transformation);w[0]=z.x;w[1]=z.y;w[2]=t.z;p.computeTranslationToOriginAndRotation(z.spatialReference,w,C,B.spatialReference)?u.transformation=C:console.warn("Could not locate symbol object properly, it might be misplaced");return y};a.applyPerVertexElevationAlignment=function(u,z,y,B,C,k,q,x,v,D,F){const G=l[F.mode];let J=0;if(p.projectBuffer(u,
z,y,B,v.spatialReference,C,x)&&(G.requiresAlignment(F)?(J=G.applyElevationAlignmentBuffer(B,C,k,q,x,v,D,F),u=k,C=q):u=B,p.projectBuffer(u,v.spatialReference,C,k,D.spatialReference,q,x)))return J};a.elevationModeChangeUpdateType=function(u,z,y){return null==z||null==y?u.definedChanged:"on-the-ground"===z&&"on-the-ground"===y?u.staysOnTheGround:z===y||"on-the-ground"!==z&&"on-the-ground"!==y?a.SymbolUpdateType.UPDATE:u.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(u,z,y,B){f(u,z,
y,B,t);return t.z};a.evaluateElevationInfoAtPoint=f;a.needsElevationUpdates2D=function(u){return"relative-to-ground"===u||"relative-to-scene"===u};a.needsElevationUpdates3D=function(u){return"absolute-height"!==u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(B){var C=B.paths[0];if(!C||0===C.length)return null;C=l.getPointOnPath(C,l.getPathLength(C)/2);return A.makeDehydratedPoint(C[0],C[1],C[2],B.spatialReference)}function z(B,C,k){k=k?B:t.clonePoint(B);return C&&B?h.projectPoint(B,k,C)?k:null:k}function y(B){if(Array.isArray(B)){for(const C of B)if(!y(C))return!1;return!0}return null==B||0<=B}a.computeCentroid=function(B,C){if("point"===B.type)return z(B,C,!1);if(t.isHydratedGeometry(B))switch(B.type){case "extent":return z(B.center,
C,!1);case "polygon":return z(B.centroid,C,!1);case "polyline":return z(u(B),C,!0);case "mesh":return z(B.origin,C,!1)}else switch(B.type){case "extent":var k=isFinite(B.zmin);B=A.makeDehydratedPoint(.5*(B.xmax+B.xmin),.5*(B.ymax+B.ymin),k?.5*(B.zmax+B.zmin):void 0,B.spatialReference);return z(B,C,!0);case "polygon":return(k=B.rings[0])&&0!==k.length?(k=e.ringsCentroid(B.rings,B.hasZ),B=A.makeDehydratedPoint(k[0],k[1],k[2],B.spatialReference)):B=null,z(B,C,!0);case "polyline":return z(u(B),C,!0)}};
a.computeObjectRotation=function(B,C,k,q=m.create()){B=B||0;C=C||0;k=k||0;0!==B&&r.rotateZ(q,q,-B/180*Math.PI);0!==C&&r.rotateX(q,q,C/180*Math.PI);0!==k&&r.rotateY(q,q,k/180*Math.PI);return q};a.computeObjectScale=function(B=n.ONES,C,k,q=1){const x=Array(3);if(b.isNone(C)||b.isNone(k))x[0]=1,x[1]=1,x[2]=1;else{let D=0;for(let F=2;0<=F;F--){const G=B[F];let J;const L=null!=G,K=0===F&&!v&&!L,O=k[F];"symbol-value"===G||K?J=0!==O?C[F]/O:1:L&&"proportional"!==G&&isFinite(G)&&(J=0!==O?G/O:1);if(null!=J){var v=
x[F]=J;D=Math.max(D,Math.abs(J))}}for(B=2;0<=B;B--)null==x[B]?x[B]=v:0===x[B]&&(x[B]=.001*D)}for(v=2;0<=v;v--)x[v]/=q;return n.fromArray(x)};a.demResolutionForBoundingBox=function(B,C,k){if(null!=k.minDemResolution)return k.minDemResolution;const q=c.getMetersPerUnitForSR(C),x=d.width(B)*q,v=d.depth(B)*q;B=d.height(B)*(C.isGeographic?1:q);return 0===x&&0===v&&0===B?k.minDemResolutionForPoints:.01*Math.max(x,v,B)};a.enlargeExtent=function(B,C,k,q=0){if(B){C||(C=f.create());let x=.5*B.width*(k-1);k=
.5*B.height*(k-1);B.width<1E-7*B.height?x+=k/20:B.height<1E-7*B.width&&(k+=x/20);p.set(C,B.xmin-x-q,B.ymin-k-q,B.xmax+x+q,B.ymax+k+q);return C}return null};a.isValidSize=y;a.mixinColorAndOpacity=function(B,C){const k=g.clone(g.ONES);b.isSome(B)&&(k[0]=B[0],k[1]=B[1],k[2]=B[2]);b.isSome(C)?k[3]=C:b.isSome(B)&&3<B.length&&(k[3]=B[3]);return k};a.overrideColor=function(B,C,k,q,x,v=[0,0,0,0]){for(let D=0;3>D;++D)b.isSome(B)&&null!=B[D]?v[D]=B[D]:b.isSome(k)&&null!=k[D]?v[D]=k[D]:v[D]=x[D];b.isSome(C)?
v[3]=C:b.isSome(q)?v[3]=q:v[3]=x[3];return v};a.updateVertexAttributeAuxpos1w=function(B,C){for(let k=0;k<B.geometries.length;++k){const q=B.geometries[k].getMutableAttribute(w.VertexAttribute.AUXPOS1);q&&q.data[3]!==C&&(q.data[3]=C,B.geometryVertexAttrsUpdated(B.geometryRecords[k]))}};a.validateSymbolLayerSize=function(B){null!=B.isPrimitive&&(B=[B.width,B.depth,B.height]);return y(B)?null:"Symbol sizes may not be negative values"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,c,r,m){let n=function(){function p(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var g=p.prototype;g.reset=function(){this.mode=
null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};g.addOffsetRenderUnits=function(h){this._renderUnitOffset+=h};g.geometryZWithOffset=function(h,d){d=this.calculateOffsetRenderUnits(d);return null!=this.featureExpressionInfoContext?d:h+d};g.calculateOffsetRenderUnits=function(h){let d=this._meterUnitOffset;const f=this.featureExpressionInfoContext;null!=f&&(d+=m.execute(f)*this._metersPerElevationInfoUnit);return d/h.unitInMeters+this._renderUnitOffset};
g.setFromElevationInfo=function(h){this.mode=h.mode;this.unit=r.supportsUnit(h.unit)?h.unit:"meters";this.offsetElevationInfoUnits=c.unwrapOr(h.offset,0)};g.updateFeatureExpressionInfoContext=function(h,d,f){if(c.isNone(h))this._featureExpressionInfoContext=null;else{var e=h&&h.arcade;e&&c.isSome(d)&&c.isSome(f)?(this._featureExpressionInfoContext=m.clone(h),m.setContextFeature(this._featureExpressionInfoContext,m.createFeature(e.modules,d,f))):this._featureExpressionInfoContext=h}};p.fromElevationInfo=
function(h){const d=new p;c.isSome(h)&&d.setFromElevationInfo(h);return d};b._createClass(p,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(h){this._unit=h;this._metersPerElevationInfoUnit=r.getMetersPerUnit(h)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(h){this._meterUnitOffset=
h;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(h){this._meterUnitOffset=h*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return p}();a.ElevationContext=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/promiseUtils ../../../../layers/graphics/hydratedFeatures ../../../../support/arcadeOnDemand".split(" "),
function(a,b,c,r,m,n){function p(){p=b._asyncToGenerator(function*(h,d,f,e){h=h&&h.expression;if("string"!==typeof h)return null;var l="0"===h?0:null;if(null!=l)return{cachedResult:l};l=yield n.loadArcade();r.throwIfAborted(f);f=l.arcadeUtils;h=f.createSyntaxTree(h);return f.dependsOnView(h)?(null!=e&&e.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:f.createFunction(h),context:f.createExecContext(null,{sr:d}),modules:l}}});return p.apply(this,
arguments)}const g=c.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(h){return{cachedResult:h.cachedResult,arcade:h.arcade?{func:h.arcade.func,context:h.arcade.modules.arcadeUtils.createExecContext(null,{sr:h.arcade.context.spatialReference}),modules:h.arcade.modules}:null}};a.createContext=function(h,d,f,e){return p.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(h){h=h&&h.expression;return"string"===typeof h&&(h="0"===h?0:null,null!=
h)?{cachedResult:h}:null};a.createFeature=function(h,d,f){return h.arcadeUtils.createFeature(d.attributes,d.geometry,f)};a.execute=function(h){if(null!=h){if(null!=h.cachedResult)return h.cachedResult;var d=h.arcade;d=h.arcade.modules.arcadeUtils.executeFunction(d.func,d.context);"number"!==typeof d&&(d=h.cachedResult=0);return d}return 0};a.extractExpressionInfo=function(h,d=!1){const f=(h=h&&h.featureExpressionInfo)&&h.expression;d||"0"===f||(h=null);return h};a.setContextFeature=function(h,d){null!=
h&&null==h.cachedResult&&(d&&h.arcade?(d._geometry&&(d._geometry=m.hydrateGeometry(d._geometry)),h.arcade.modules.arcadeUtils.updateExecContext(h.arcade.context,d)):g.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(z){return z.isVisible?z.parameters.transparent?f.Transparency.TRANSPARENT:f.Transparency.OPAQUE:f.Transparency.INVISIBLE}let l=function(){function z(B,C,k,q,x,v,D,F=null){this.graphics3DSymbolLayer=B;this.stageObject=C;this._uniqueGeometries=k;this._uniqueMaterials=q;this._sharedResource=x;this.elevationAligner=v;this.elevationContext=D;this._edgeState=F;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=
0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=B;this.stageObject=C}var y=z.prototype;y.initialize=function(B,C){this._stageLayer=C;this._stage=B;B.addMany(this._uniqueMaterials);B.addMany(this._uniqueGeometries);B.add(this.stageObject)};y.destroy=function(){var B=this._stage;this._stageLayer&&(B.removeMany(this._uniqueMaterials),B.removeMany(this._uniqueGeometries));B.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),
this._addedToStage=!1);B=this._stage.renderView.ensureEdgeView();B.hasObject(this.stageObject)&&B.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};y.layerOpacityChanged=function(B,C){if(!c.isNone(this._edgeState)){var k=e(this._edgeState.baseMaterial),q=!1;for(const x of this._edgeState.edgeMaterials)x.objectTransparency!==k&&(x.objectTransparency=k,q=!0);q&&this._resetEdgeObject(C);
this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[B])}};y.slicePlaneEnabledChanged=function(B,C){c.isNone(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:B},!C),this._edgeState.properties.hasSlicePlane=B)};y.setVisibility=function(B){if(null!=this._stage&&this._visible!==B&&((this._visible=B)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),
this._addedToStage=!0):this.stageObject.setVisible(!1),c.isSome(this._edgeState))){const C=this._stage.renderView.ensureEdgeView();C.hasObject(this.stageObject)?C.updateObjectVisibility(this.stageObject,B):B&&this._addOrUpdateEdgeObject(C,!1)}};y.alignWithElevation=function(B,C,k,q){null!=this.elevationAligner&&(c.isSome(k)&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,k),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,B,C),this._resetEdgeObject(q))};
y.getCenterObjectSpace=function(B=m.create()){return r.copy(B,p.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};y.getBoundingBoxObjectSpace=function(B=n.create()){const C=this.stageObject.boundingVolumeObjectSpace;n.setMin(B,C.min);n.setMax(B,C.max);return B};y.computeAttachmentOrigin=function(B){if(this.useObjectOriginAsAttachmentOrigin){var C=this.stageObject.transformation;B.render.origin[0]+=C[12];B.render.origin[1]+=C[13];B.render.origin[2]+=C[14];B.render.num++}else for(C of this.stageObject.geometryRecords)C.computeAttachmentOrigin(w)&&
(r.transformMat4(w,w,this.stageObject.transformation),r.add(B.render.origin,B.render.origin,w),B.render.num++)};y.getProjectedBoundingBox=function(){var B=b._asyncToGenerator(function*(C,k,q,x,v){v=this.getBoundingBoxObjectSpace(v);var D=u,F=n.isPoint(v)?1:D.length;for(var G=0;G<F;G++){const J=D[G];t[0]=v[J[0]];t[1]=v[J[1]];t[2]=v[J[2]];r.transformMat4(t,t,this.stageObject.transformation);A[3*G]=t[0];A[3*G+1]=t[1];A[3*G+2]=t[2]}if(!C(A,0,F))return null;n.empty(v);C=null;this.calculateRelativeScreenBounds&&
(C=this.calculateRelativeScreenBounds());for(D=0;D<3*F;D+=3){for(G=0;3>G;G++)v[G]=Math.min(v[G],A[D+G]),v[G+3]=Math.max(v[G+3],A[D+G]);C&&q.push({location:A.slice(D,D+3),screenSpaceBoundingRect:C})}if(k&&k.service&&"absolute-height"!==this.elevationContext.mode){n.center(v,w);q="relative-to-scene"===this.elevationContext.mode?"scene":"ground";F=0;if(k.useViewElevation)F=c.unwrapOr(k.service.getElevation(w[0],w[1],q),0);else try{const J=h.demResolutionForBoundingBox(v,k.service.spatialReference,k);
F=c.unwrapOr(yield k.service.queryElevation(w[0],w[1],x,J,q),0)}catch(J){}n.offset(v,0,0,-this.alignedSampledElevation+F)}return v});return function(C,k,q,x,v){return B.apply(this,arguments)}}();y.addObjectState=function(B,C){B===d.Object3DState.Highlight&&C.addObject(this.stageObject,this.stageObject.highlight());B===d.Object3DState.MaskOccludee&&C.addObject(this.stageObject,this.stageObject.maskOccludee())};y.removeObjectState=function(B){B.removeObject(this.stageObject)};y._resetEdgeObject=function(B){if(!c.isNone(this._edgeState)){var C=
this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(C,B):C.removeObject(this.stageObject)}};y._addOrUpdateEdgeObject=function(B,C){const k=this._edgeState;if(!c.isNone(k)){var q=e(k.baseMaterial);for(const x of k.edgeMaterials)x.objectTransparency=q;B.addOrUpdateObject3D(this.stageObject,k.edgeMaterials,k.properties,!C).then(()=>this._stageLayer?.sync())}};b._createClass(z,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},
{key:"visible",get:function(){return this._visible}}]);return z}();const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=m.create(),w=m.create(),u=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency=
{});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){function w(k,q){k=null!=k?q.attributes[k]:0;return null!=k&&isFinite(k)?k:0}function u(k){const q={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};k&&"visualVariables"in k&&k.visualVariables&&k.visualVariables.forEach(x=>{switch(x.type){case "color":q.color=!0;if(x.stops)for(let v=0;v<x.stops.length;v++){const D=x.stops[v].color;D&&(q.opacity=!0,1>D.a&&(q.opacityAlwaysOpaque=!1))}break;case "opacity":q.opacity=!0;q.opacityAlwaysOpaque=!1;break;case "size":q.size=
!0}});return q}const z=m.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");r=function(k){function q(v,D,F,G){var J=k.call(this,F.schedule)||this;J._context=F;J._elevationInfoOverride=null;J._ignoreDrivers=!1;J._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};J.complexity=null;J.logger=z;J._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};J.symbol=v;J.symbolLayer=D;J._renderPriority=G.renderPriority;J._renderPriorityStep=G.renderPriorityStep;
J._elevationContext=new d.ElevationContext;J.complexity=J.computeComplexity();J._ignoreDrivers=G.ignoreDrivers;J._ignoreDrivers||(J._drivenProperties=u(J._context.renderer));J._updateElevationContext();return J}b._inheritsLoose(q,k);var x=q.prototype;x.getCachedSize=function(){return null};x._drivenPropertiesChanged=function(v){if(this._ignoreDrivers)return!1;const D=this._drivenProperties;v=u(v);return v.color!==D.color||v.opacity!==D.opacity||v.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||v.size!==
D.size};x._logGeometryCreationWarnings=function(v,D,F,G){const J="polygons"in v?v.polygons:null,L=`${G} geometry failed to be created`;let K=null;v.projectionSuccess?!this._logGeometryValidationWarnings(D,F,G)&&J&&0===J.length&&"rings"===F&&0<D.length&&2<D[0].length&&(K=`${L} (filled rings should use clockwise winding - try reversing the order of vertices)`):K=`${L} (failed to project geometry to view spatial reference)`;K&&z.warnOncePerTick(K)};x._logGeometryValidationWarnings=function(v,D,F){F=
`${F} geometry failed to be created`;return!v.length||1===v.length&&!v[0].length?(z.warnOncePerTick(`${F} (no ${D} were defined)`),!0):Array.isArray(v)&&Array.isArray(v[0])?!1:(z.warnOncePerTick(`${F} (${D} should be defined as a 2D array)`),!0)};x._validateGeometry=function(v,D=null,F=null){return n.isSome(D)&&!D.includes(v.type)?(this.logger.warn("unsupported geometry type for "+F+` symbol: ${v.type}`),!1):"point"!==v.type||isFinite(v.x)&&isFinite(v.y)?!0:(z.warn("point coordinate is not a valid number, graphic skipped"),
!1)};x._defaultElevationInfoNoZ=function(){return y};x._defaultElevationInfoZ=function(){return B};x._updateElevationContext=function(){n.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};x.getDefaultElevationInfo=function(v){return v.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};x.getGeometryElevationMode=function(v,D=this.getDefaultElevationInfo(v)){return this._elevationContext.mode||D.mode};x.setElevationInfoOverride=function(v){this._elevationInfoOverride=v;this._updateElevationContext()};x.setGraphicElevationContext=function(v,D){var F=n.unwrap(v.geometry);const G=this.getDefaultElevationInfo(F);D.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:G.unit;D.mode=this.getGeometryElevationMode(F,G);D.offsetMeters=n.unwrapOr(this._elevationContext.meterUnitOffset,n.unwrapOr(G.offset,0));if(F=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode="relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(F?f.zeroContext:this._elevationContext.featureExpressionInfoContext,v,this._context.layer);return D};x.prepareSymbolLayerPatch=function(v){};x.updateGeometry=function(v,D){return!1};
x.onRemoveGraphic=function(v){};x._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const v=this._context.layer.opacity;return null==v?1:v};x._getCombinedOpacity=function(v,D=C){let F=1;this.draped||(F*=this._getLayerOpacity());if(this._drivenProperties.opacity)return F;n.isSome(v)?F*=v.a:D.hasIntrinsicColor||(F=0);return F};x._getCombinedOpacityAndColor=function(v,D=C){D=this._getCombinedOpacity(v,
D);if(this._drivenProperties.color)return e.mixinColorAndOpacity(null,D);v=n.isSome(v)?c.toUnitRGB(v):p.ONES;return e.mixinColorAndOpacity(v,D)};x._getVertexOpacityAndColor=function(v,D=null){v=e.mixinColorAndOpacity(this._drivenProperties.color?v.color:null,this._drivenProperties.opacity?v.opacity:null);n.isSome(D)&&(v[0]*=D,v[1]*=D,v[2]*=D,v[3]*=D);return v};x.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};x.computeComplexity=function(){return t.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)};x.globalPropertyChanged=function(v,D,F){switch(v){case "opacity":return this.layerOpacityChanged(D,F),!0;case "elevationInfo":return v=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(D,F,v)===h.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,F);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};
x.updateGraphics3DGraphicElevationInfo=function(v,D,F){let G=h.SymbolUpdateType.UPDATE;v.forEach(J=>{const L=D(J);n.isSome(L)?(this.setGraphicElevationContext(J.graphic,L.elevationContext),L.needsElevationUpdates=F(L.elevationContext.mode)):G=h.SymbolUpdateType.RECREATE});return G};x.applyRendererDiff=function(v,D){return l.ApplyRendererDiffResult.Recreate_Symbol};x.getFastUpdateAttrValues=function(v){if(!this._fastUpdates.enabled)return null;const D=this._fastUpdates.visualVariables,F=D.size?w(D.size.field,
v):0,G=D.color?w(D.color.field,v):0;v=D.opacity?w(D.opacity.field,v):0;return g.fromValues(F,G,v,0)};x.ensureDrapedStatus=function(v){if(null==this._draped)return this._draped=v,!0;v!==this.draped&&z.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};x.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables?.size?.field??
null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null})}};b._createClass(q,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return q}(A.Loadable);const y={mode:"on-the-ground",
offset:0,unit:"meters"},B={mode:"absolute-height",offset:0,unit:"meters"},C={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=r;a.getAttributeValue=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";
b[b.Fast_Update=2]="Fast_Update";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,c,r){let m=function(){function n(g){this.schedule=g;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}var p=n.prototype;p.destroy=
function(){this.abortLoad()};p.load=function(g,h){if(this._loadStatus===a.LoadStatus.LOADED)return g&&g(),c.unwrapOr(this._loader,Promise.resolve());if(this._loadStatus===a.LoadStatus.FAILED)return h&&h(this._loadError),c.unwrapOr(this._loader,Promise.resolve());c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},d=>{this._loadError=d;this._abortController=
null;this._loadStatus=a.LoadStatus.FAILED;!r.isAbortError(d)&&this.logger&&d.message&&this.logger.warn(d.message);throw d;}));this._loader.then(g,h).catch(()=>{});return this._loader};p.abortLoad=function(){c.isSome(this._abortController)?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};b._createClass(n,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return n}();a.LoadStatus=void 0;
(function(n){n[n.LOADING=0]="LOADING";n[n.LOADED=1]="LOADED";n[n.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,b,c,r,m,n,p,g){function h(w){let u=0,z=0,y=0,B=!1,C=0;const k={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const q of w)c.isNone(q)||(u+=q.primitivesPerFeature,z+=q.primitivesPerCoordinate,y+=q.drawCallsPerFeature,k.bytesPerFeature+=q.memory.bytesPerFeature,k.bytesPerFeatureLabel+=q.memory.bytesPerFeatureLabel,k.bytesPerCoordinate+=q.memory.bytesPerCoordinate,k.resourceBytes+=q.memory.resourceBytes,
k.draped.bytesPerFeature+=q.memory.bytesPerFeature,k.draped.bytesPerFeatureLabel+=q.memory.bytesPerFeatureLabel,k.draped.bytesPerCoordinate+=q.memory.bytesPerCoordinate,B=B||q.estimated,++C);return{primitivesPerFeature:u,primitivesPerCoordinate:z,drawCallsPerFeature:y,estimated:B,memory:k,numComplexities:C}}function d(w,u){const z=f(w,u);var y=n.hasEdges(u)?2:0;switch(u.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:y,estimated:!1,memory:z};case "fill":return"mesh-3d"===
w.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:y,estimated:!1,memory:z}:c.isSome(u.outline)&&0<u.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:z}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:z};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:z};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,
drawCallsPerFeature:0,estimated:!1,memory:z};case "object":return u.resource&&u.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:z}:{...e(u.resource&&u.resource.primitive||r.defaultPrimitive),memory:z};case "path":var B=w=0;switch(u.profile){case "circle":w=10;break;case "quad":w=4;break;default:b.neverReached(u.profile);return}switch(u.join){case "round":B=3;break;case "miter":case "bevel":B=1;break;default:b.neverReached(u.join);return}y=
2*w;B=w*B*2;let C=-2*B-y;switch(u.cap){case "none":break;case "butt":case "square":C+=2*(w-1);break;case "round":C+=2*(4*w+w);break;default:return}return{primitivesPerFeature:C,primitivesPerCoordinate:B+y,drawCallsPerFeature:0,estimated:!1,memory:z};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:z}}}function f(w,u){w="point-3d"===w.type;switch(u.type){case "extrude":return u.edges&&0<u.edges.size?t.EXTRUDE_EDGES:t.EXTRUDE;
case "fill":return c.isSome(u.outline)&&0<u.outline.size?t.FILL_OUTLINE:t.FILL;case "water":return t.FILL;case "line":return"round"===u.join?t.LINE_ROUND:t.LINE_MITER;case "path":switch(u.join){case "round":switch(u.profile){case "circle":return t.PATH_ROUND_CIRCLE;case "quad":return t.PATH_ROUND_QUAD;default:b.neverReached(u.profile);return}case "miter":case "bevel":switch(u.profile){case "circle":return t.PATH_MITER_CIRCLE;case "quad":return t.PATH_MITER_QUAD;default:b.neverReached(u.profile);return}default:b.neverReached(u.join);
return}case "object":return w?t.OBJECT_POINT:t.OBJECT_POLYGON;case "icon":case "text":return w?t.ICON_POINT:t.ICON_POLYGON}}function e(w){var u=A[w];if(u)return u;u=m.primitiveLodResources(w,null);u={primitivesPerFeature:g.geometriesFromLodLevelResources(u.levels[0]).reduce((z,y)=>z+y.indices.get(p.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return A[w]=u}const l={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,
memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},A={},t={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,
resourceBytes:0,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,resourceBytes:0,
draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,resourceBytes:0,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,
resourceBytes:0,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,resourceBytes:0,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,
resourceBytes:0,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,resourceBytes:0,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,resourceBytes:0,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,resourceBytes:0,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,resourceBytes:0,
draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,resourceBytes:0,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,
resourceBytes:0,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(w){w=h(w);0<w.numComplexities&&(w.primitivesPerFeature/=w.numComplexities,w.primitivesPerCoordinate/=w.numComplexities,w.drawCallsPerFeature/=w.numComplexities,w.memory.bytesPerFeature/=w.numComplexities,w.memory.bytesPerFeatureLabel/=w.numComplexities,w.memory.bytesPerCoordinate/=w.numComplexities,w.memory.resourceBytes/=w.numComplexities,
w.memory.draped.bytesPerFeature/=w.numComplexities,w.memory.draped.bytesPerFeatureLabel/=w.numComplexities,w.memory.draped.bytesPerCoordinate/=w.numComplexities);return w};a.defaultSymbolComplexity=function(w){if("web-style"===w.type)return l;const u=w.symbolLayers.toArray().map(z=>d(w,z));return h(u)};a.defaultSymbolLayerComplexity=d;a.defaultSymbolLayerMemoryComplexity=f;a.emptySymbolComplexity=l;a.memoryEstimators=t;a.totalSymbolComplexities=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],function(a,b,c){const r=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(m){switch(m){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(m,n){const p=
(g,h,d=!1)=>({levels:g.map(f=>{const e=h(f.tesselation);d&&c.cgToGIS(e);return{components:[{geometry:e,material:n}],faceCount:e.indexCount/3,minScreenSpaceRadius:f.minScreenSpaceRadius}})});switch(m){case "sphere":return p([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],g=>c.createPolySphereGeometry(.5,g,!0));case "cube":return p([{tesselation:0,
minScreenSpaceRadius:0}],()=>c.createBoxGeometry(1));case "cone":return p(r,g=>c.createConeGeometry(1,.5,g,!1),!0);case "inverted-cone":return p(r,g=>c.createConeGeometry(1,.5,g,!0),!0);case "cylinder":return p(r,g=>c.createCylinderGeometry(1,.5,g,[0,0,1],[0,0,.5]));case "tetrahedron":return p([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(1),!0);case "diamond":return p([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(1),!0)}};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,r,m,n,p,g){function h(l,A){if(r.isNone(l))return null;const t=r.isSome(l.color)?n.fromArray(b.toUnitRGBA(l.color)):n.fromValues(0,0,0,0),w=m.pt2px(l.size),u=m.pt2px(l.extensionLength);
switch(l.type){case "solid":return d({color:t,size:w,extensionLength:u,...A});case "sketch":return{...e,color:t,size:w,extensionLength:u,...A,type:"sketch"}}}function d(l){return{...f,...l,type:"solid"}}const f={color:n.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,hasSlicePlane:!1},e={color:n.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(l,A){return h(l&&
l.enabled&&l.edges||null,A)};a.createMaterialFromEdges=h;a.createSolidEdgeMaterial=d;a.hasEdges=function(l){return l&&l.enabled&&(p.isExtrudeSymbol3DLayer(l)||p.isFillSymbol3DLayer(l))&&r.isSome(l.edges)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],function(a,b){function c(r){const m=[];r.components.forEach(n=>{m.push(n.geometry)});return b.unique(m)}a.computeFaceCount=function(r){return c(r).reduce((m,n)=>m+n.indexCount/3,0)};a.geometriesFromLodLevelResources=c;a.geometriesFromLodResources=function(r){const m=[];r.levels.forEach(n=>
{n.components.forEach(p=>{m.push(p.geometry)})});return b.unique(m)};a.materialsFromLodResources=function(r){const m=[];r.levels.forEach(n=>{n.components.forEach(p=>{m.push(p.material)})});return b.unique(m)};a.texturesFromLodResources=function(r){const m=[];r.levels.forEach(n=>{n.components.forEach(p=>{p.textures&&m.push(...p.textures)})});return b.unique(m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){const e=r.create();a.createStageObjectForHUD=function(l,A,t,w,u,z,y,B){const C=t?t.length:0;var k=l.clippingExtent;m.projectPointToVector(A,e,l.elevationProvider.spatialReference);if(b.isSome(k)&&!n.containsPoint(k,e))return null;m.projectPointToVector(A,e,l.renderCoordsHelper.spatialReference);k=l.localOriginFactory.getOrigin(e);z=new f.Object3D({castShadow:!1,metadata:{layerUid:z,graphicUid:y,usesVerticalDistanceToGround:!0}});for(y=0;y<C;y++)z.addGeometry(t[y],w[y],
c.IDENTITY,k,B);l=h.applyElevationAlignmentForHUD(z,A,l.elevationProvider,l.renderCoordsHelper,u);return{object:z,sampledElevation:l}};a.extendPointGraphicElevationContext=function(l,A,t){l=l.elevationContext;t=t.spatialReference;m.projectPointToVector(A,e,t);l.centerPointInElevationSR=g.makeDehydratedPoint(e[0],e[1],A.hasZ?e[2]:0,b.isSome(t)?t:null)};a.placePointOnGeometry=function(l){switch(l.type){case "point":return l;case "polygon":case "extent":return d.computeCentroid(l);case "polyline":var A=
l.paths[0];if(!A||0===A.length)break;A=p.getPointOnPath(A,p.getPathLength(A)/2);return g.makeDehydratedPoint(A[0],A[1],A[2],l.spatialReference);case "mesh":return l.origin}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){f=function(y){function B(k={}){var q=y.call(this)||this;q.type=e.ContentObjectType.Object;q._geometryRecords=[];q._geometries=[];q._objectTransformation=m.create();q._bvObjectSpace=new z;q._bvWorldSpace=new z;q._bvDirty=!0;q._hasVolatileTransformation=!1;q._visible=!0;q.castShadow=null!=k.castShadow?k.castShadow:!0;q.metadata=k.metadata;q.metadata&&q.metadata.isElevationSource&&(q.metadata.lastValidElevationBB=new u);const {geometries:x,materials:v,transformations:D,
origins:F}=k;if(!Array.isArray(x))return b._assertThisInitialized(q);t.assert(v.length===x.length,"Object3D: materials don't match geometries");t.assert(D.length===x.length,"Object3D: transformations don't match geometries");q._geometryRecords.length=x.length;q._geometries.length=x.length;for(k=0;k<x.length;k++)q._geometries[k]=x[k],q._geometryRecords[k]=l.GeometryRecord.pool.acquire(x[k],v[k],m.clone(D[k]),{highlights:null,occludees:null,visible:q._visible},F&&F[k]);return q}b._inheritsLoose(B,y);
var C=B.prototype;C.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};C.addGeometry=function(k,q,x,v,D){x=x?x:m.IDENTITY;this._geometries.push(k);k=l.GeometryRecord.pool.acquire(k,q,x,{highlights:null,occludees:null,visible:this._visible},v,D);this._geometryRecords.push(k);this._hasVolatileTransformation=this._hasVolatileTransformation||c.isSome(k.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:k});this._invalidateBoundingVolume();return k};C.removeGeometry=
function(k){const q=this._geometryRecords.splice(k,1)[0];this._hasVolatileTransformation=c.isSome(q.shaderTransformation)?this._geometryRecords.some(x=>c.isSome(x.shaderTransformation)):this._hasVolatileTransformation;q.dispose();this._geometries.splice(k,1);this._emit("objectGeometryRemoved",{object:this,record:q});this._invalidateBoundingVolume();return q};C.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};C.geometryVertexAttrsUpdated=function(k){this._emit("vertexAttrsUpdated",
{object:this,record:k});this._invalidateBoundingVolume()};C.setVisible=function(k){if(this._visible!==k){this._visible=k;for(const q of this._geometryRecords)q.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}};C.maskOccludee=function(){const k=new A.Object3DStateID(d.Object3DState.MaskOccludee);for(const q of this._geometryRecords)q.instanceParameters.occludees=w.addObject3DStateID(q.instanceParameters.occludees,k);this._emit("occlusionChanged",this);return k};C.removeOcclude=
function(k){for(const q of this._geometryRecords)q.instanceParameters.occludees=w.removeObject3DStateID(q.instanceParameters.occludees,k);this._emit("occlusionChanged",this)};C.highlight=function(){const k=new A.Object3DStateID(d.Object3DState.Highlight);for(const q of this._geometryRecords)q.instanceParameters.highlights=w.addObject3DStateID(q.instanceParameters.highlights,k);this._emit("highlightChanged",this);return k};C.removeHighlight=function(k){for(const q of this._geometryRecords)q.instanceParameters.highlights=
w.removeObject3DStateID(q.instanceParameters.highlights,k);this._emit("highlightChanged",this)};C.getCombinedStaticTransformation=function(k,q){return r.multiply(q,this.transformation,k.getStaticTransformation())};C._getCombinedShaderTransformation=function(k){return r.multiply(m.create(),this.transformation,k.getShaderTransformation())};C.hasVolativeTransformation=function(){return this._hasVolatileTransformation};C._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();
this._bvWorldSpace.init();for(var k=0;k<this._geometryRecords.length;++k){var q=this._geometryRecords[k],x=this._geometries[k].boundingInfo;c.isSome(x)&&(this._calculateTransformedBoundingVolume(x,this._bvObjectSpace,q.getShaderTransformation()),this._calculateTransformedBoundingVolume(x,this._bvWorldSpace,this._getCombinedShaderTransformation(q)))}n.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);n.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,
.5);k=p.create();q=p.create();x=h.maxScale(this.transformation);for(let G=0;G<this._geometryRecords.length;++G){var v=this._geometries[G].boundingInfo;if(!c.isNone(v)){var D=this._geometryRecords[G].getShaderTransformation(),F=h.maxScale(D);n.transformMat4(k,v.getCenter(),D);D=n.distance(k,this._bvObjectSpace.bounds);v=v.getBSRadius()*F;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],D+v);n.transformMat4(q,k,this.transformation);F=n.distance(q,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=
Math.max(this._bvWorldSpace.bounds[3],F+v*x)}}this._bvDirty=!1}};C._calculateTransformedBoundingVolume=function(k,q,x){const v=k.getBBMin();k=k.getBBMax();const D=p.clone(v),F=p.clone(k);n.transformMat4(D,D,x);n.transformMat4(F,F,x);for(var G=0;3>G;++G)q.min[G]=Math.min(q.min[G],D[G],F[G]),q.max[G]=Math.max(q.max[G],D[G],F[G]);for(G=0;3>G;++G){n.copy(D,v);n.copy(F,k);D[G]=k[G];F[G]=v[G];n.transformMat4(D,D,x);n.transformMat4(F,F,x);for(let J=0;3>J;++J)q.min[J]=Math.min(q.min[J],D[J],F[J]),q.max[J]=
Math.max(q.max[J],D[J],F[J])}};C._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};C._emit=function(k,q){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(k,q)};b._createClass(B,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(k){r.copy(this._objectTransformation,
k);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(k){t.assert(null==this._parentLayer||null==k,"Object3D can only be added to a single Layer");this._parentLayer=k}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();
return this._bvObjectSpace}},{key:"test",get:function(){const k=this;return{hasGeometry:q=>k._geometries.includes(q),getGeometryIndex:q=>k._geometries.indexOf(q)}}}]);return B}(f.ContentObject);let u=function(){function y(){this.min=p.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=p.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}y.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return y}(),z=
function(y){function B(){var C=y.apply(this,arguments)||this;C.bounds=g.create();return C}b._inheritsLoose(B,y);B.prototype.init=function(){n.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);n.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);g.clear(this.bounds)};return B}(u);a.Object3D=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,b,c,r,m,n){let p=function(){function g(){this._disposed=!1}var h=g.prototype;h.acquire=function(d,f,e,l,A,t){this.id=m.generateUID();this.geometry=d;this.material=f;this.transformation=e;this.instanceParameters=l;this.origin=A;this._shaderTransformation=t;this._disposed=!1};h.release=function(){this._disposed=!1};h.dispose=function(){this._disposed=!0};h.getStaticTransformation=function(){return this.transformation};h.getShaderTransformation=function(){return c.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};h.computeAttachmentOrigin=function(d){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,d):this.geometry.computeAttachmentOrigin(d))?(n.transformMat4(d,d,this.getStaticTransformation()),!0):!1};b._createClass(g,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return g}();p.pool=new r(p);a.GeometryRecord=
p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){a.Object3DStateID=function(c){this.channel=c;this.id=b.generateUID()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){let w=function(k){function q(v){v=k.call(this,v,new z)||this;v._configuration=new t.LineCalloutTechniqueConfiguration;v._uniqueMaterialIdentifier=q.uniqueMaterialIdentifier(v.parameters);return v}b._inheritsLoose(q,k);var x=q.prototype;x.getPassParameters=function(){return this.parameters};x.getConfiguration=function(v,D){v=D?.slot!==f.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=
c.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this._configuration.depthHudEnabled=v;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?g.HUDSpace.Screen:g.HUDSpace.World;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasMultipassGeometry=D.multipassGeometry.enabled;
return this._configuration};x.intersect=function(){};x.requiresSlot=function(v,D){if(D===p.ShaderOutput.Color)switch(v){case f.RenderSlot.LINE_CALLOUTS:case f.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};x.createGLMaterial=function(v){return new u(v)};x.createBufferWriter=function(){return new C};x.validateParameters=function(v){v=q.uniqueMaterialIdentifier(v);v!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=v)};q.uniqueMaterialIdentifier=function(v){return JSON.stringify({screenOffset:v.screenOffset||
[0,0],centerOffsetUnits:v.centerOffsetUnits||"world"})};b._createClass(q,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return q}(d.Material),u=function(k){function q(){return k.apply(this,arguments)||this}b._inheritsLoose(q,k);q.prototype.beginSlot=function(x){return this.ensureTechnique(A.LineCalloutTechnique,x)};return q}(h),z=function(k){function q(){var x=k.apply(this,arguments)||this;x.screenOffset=m.ZEROS;x.color=[0,0,0,1];x.size=1;x.occlusionTest=
!1;x.shaderPolygonOffset=1E-5;x.depthHUDAlignStart=!1;x.centerOffsetUnits="world";x.hasSlicePlane=!1;return x}b._inheritsLoose(q,k);return q}(d.MaterialParameters);const y=n.newLayout().vec3f(e.VertexAttribute.POSITION).vec3f(e.VertexAttribute.NORMAL).vec2f(e.VertexAttribute.UV0).vec4f(e.VertexAttribute.AUXPOS1),B=[r.fromValues(0,0),r.fromValues(1,0),r.fromValues(0,1),r.fromValues(1,0),r.fromValues(1,1),r.fromValues(0,1)];let C=function(){function k(){this.vertexBufferLayout=y}var q=k.prototype;q.allocate=
function(x){return this.vertexBufferLayout.createBuffer(x)};q.elementCount=function(x){return 6*x.indices.get(e.VertexAttribute.POSITION).length};q.write=function(x,v,D,F,G){l.writePosition(D.indices.get(e.VertexAttribute.POSITION),D.vertexAttributes.get(e.VertexAttribute.POSITION).data,x,F.position,G,6);l.writeNormal(D.indices.get(e.VertexAttribute.NORMAL),D.vertexAttributes.get(e.VertexAttribute.NORMAL).data,v,F.normal,G,6);l.writeBufferVec4(D.indices.get(e.VertexAttribute.AUXPOS1),D.vertexAttributes.get(e.VertexAttribute.AUXPOS1).data,
F.auxpos1,G,6);for(x=0;x<B.length;++x)F.uv0.setVec(G+x,B[x])};return k}();a.LineCalloutMaterial=w;a.Parameters=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(t){const w=new Float32Array(2);w[0]=t[0];w[1]=t[1];return w}function r(t,w){const u=new Float32Array(2);u[0]=t;u[1]=w;return u}function m(t,w){return new Float32Array(t,w,2)}function n(){return b()}
function p(){return r(1,1)}function g(){return r(1,0)}function h(){return r(0,1)}const d=b(),f=p(),e=g(),l=h(),A=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,zeros:n,ones:p,unitX:g,unitY:h,ZEROS:d,ONES:f,UNIT_X:e,UNIT_Y:l},Symbol.toStringTag,{value:"Module"}));a.ONES=f;a.UNIT_X=e;a.UNIT_Y=l;a.ZEROS=d;a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.ones=p;a.unitX=g;a.unitY=h;a.vec2f32=A;a.zeros=n})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){n=function(e){function l(){return e.apply(this,arguments)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeConfiguration=function(t,w){w.spherical=t.viewingMode===r.ViewingMode.Global};A.initializeProgram=function(t){return new g.Program(t.rctx,l.shader.get().build(this.configuration),p.Default3D)};A.setPipelineState=function(t){t=t?d.CompareFunction.ALWAYS:d.CompareFunction.LESS;return this.configuration.depthHudEnabled?f.makePipelineState({depthTest:{func:t},
depthWrite:f.defaultDepthWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:f.defaultColorWriteParams})};A.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return l}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(h.LineCallout,()=>new Promise((e,l)=>a(["./LineCallout.glsl"],e,l)));
b.LineCalloutTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(B){const C=new t.ShaderBuilder;C.include(p.AlignPixel);C.include(g.HUD,B);C.include(n.SliceDraw,B);C.attributes.add(w.VertexAttribute.UV0,"vec2");const {vertex:k,fragment:q}=C;k.uniforms.add([new e.Float4PassUniform("viewport",(x,v)=>v.camera.fullViewport),new l.FloatPassUniform("lineSize",(x,v)=>Math.ceil(x.size)*v.camera.pixelRatio),new f.Float2PassUniform("pixelToNDC",(x,v)=>c.set(y,2/v.camera.fullViewport[2],2/v.camera.fullViewport[3])),new l.FloatPassUniform("borderSize",
(x,v)=>b.isSome(x.borderColor)?v.camera.pixelRatio:0),new f.Float2PassUniform("screenOffset",(x,v)=>c.set(y,x.screenOffset[0]*v.camera.pixelRatio,x.screenOffset[1]*v.camera.pixelRatio))]);C.varyings.add("coverageSampling","vec4");C.varyings.add("lineSizes","vec2");B.hasMultipassGeometry&&C.varyings.add("depth","float");B.hasScreenSizePerspective&&d.addScreenSizePerspectiveAlignment(k);k.code.add(A.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${B.occlusionTestEnabled?A.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${B.hasScreenSizePerspective?A.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:A.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${B.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${B.depthHudEnabled?B.depthHudAlignStartEnabled?A.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:A.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${B.hasScreenSizePerspective?A.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:A.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);q.uniforms.add([new e.Float4PassUniform("uColor",x=>z(x.color)),new e.Float4PassUniform("borderColor",x=>z(x.borderColor))]);B.hasMultipassGeometry&&(q.include(h.multipassGeometryTest,B),q.uniforms.add(new f.Float2PassUniform("inverseViewport",(x,v)=>v.inverseViewport)));q.code.add(A.glsl`
    void main() {
      ${B.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${B.depthHudEnabled?A.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:A.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return C}function z(B){return b.isSome(B)?B:m.ZEROS}const y=r.create();r=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));a.LineCallout=r;a.build=u})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n){n=function(p){function g(){var h=p.apply(this,arguments)||this;h.screenCenterOffsetUnitsEnabled=r.HUDSpace.World;h.spherical=!1;h.occlusionTestEnabled=!0;h.hasVerticalOffset=!1;h.hasScreenSizePerspective=!1;h.depthHudEnabled=!1;h.depthHudAlignStartEnabled=!1;h.hasSlicePlane=!1;h.hasMultipassGeometry=!1;return h}b._inheritsLoose(g,p);return g}(n.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.HUDSpace.COUNT})],n.prototype,"screenCenterOffsetUnitsEnabled",void 0);
c.__decorate([m.parameter()],n.prototype,"spherical",void 0);c.__decorate([m.parameter()],n.prototype,"occlusionTestEnabled",void 0);c.__decorate([m.parameter()],n.prototype,"hasVerticalOffset",void 0);c.__decorate([m.parameter()],n.prototype,"hasScreenSizePerspective",void 0);c.__decorate([m.parameter()],n.prototype,"depthHudEnabled",void 0);c.__decorate([m.parameter()],n.prototype,"depthHudAlignStartEnabled",void 0);c.__decorate([m.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],
n.prototype,"hasMultipassGeometry",void 0);c.__decorate([m.parameter({constValue:!0})],n.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"isDraped",void 0);a.LineCalloutTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,b,c){this.graphic=a;this.renderingInfo=b;this.layer=
c}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(r){return r instanceof c?r.graphics3DSymbol:r instanceof b?r:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,r,m,n,p,g,h,d){const f={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(e){function l(t,w,u){var z=e.call(this,w.schedule)||this;z._symbol=t;z._context=w;z._backgroundLayers=u;z._destroyed=!1;z.symbolLayers=[];z.referenced=0;z._extentPadding=0;return z}a._inheritsLoose(l,e);var A=l.prototype;A.doLoad=function(){var t=a._asyncToGenerator(function*(w){var u=this;let z=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(z=this._backgroundLayers.concat(z));
const y=z.length;for(;this.symbolLayers.length<z.length;)this.symbolLayers.push(null);this.symbolLayers.length=z.length;const B=[];for(let C=0;C<y;C++){const k=z.getItemAt(C);if(!1===k.enabled)continue;f.renderPriority=1-(1+C)/y;f.renderPriorityStep=1/y;f.ignoreDrivers=k._ignoreDrivers;const q=p.make(this.symbol,k,this._context,f);B.push(r.onAbortOrThrow(w,()=>{this.symbolLayers[C]=null;q.destroy()}));this.symbolLayers[C]=q}yield b.forEach(this.symbolLayers,function(){var C=a._asyncToGenerator(function*(k,
q){if(c.isSome(k))try{yield k.load(),u._extentPadding+=Math.max(u._extentPadding,k.extentPadding)}catch{u.symbolLayers[q]=null}});return function(k,q){return C.apply(this,arguments)}}());for(const C of B)C?.remove();B.length=0;r.throwIfAborted(w);if(this.symbolLayers.length&&!this.symbolLayers.some(C=>!!C))throw Error();});return function(w){return t.apply(this,arguments)}}();A.getSymbolLayerSize=function(t){t=this.symbolLayers[t];return c.isSome(t)?t.getCachedSize():null};A.createGraphics3DGraphic=
function(t,w){const u=t.graphic,z=Array(this.symbolLayers.length);for(let y=0;y<this.symbolLayers.length;y++){const B=this.symbolLayers[y];z[y]=c.isSome(B)?B.createGraphics3DGraphic(t):null}return new m(u,w||this,z,t.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};A.globalPropertyChanged=function(t,w){const u=this.symbolLayers.length;for(let z=0;z<u;z++){const y=
this.symbolLayers[z],B=C=>{C=C.graphics[z];return C instanceof n.Graphics3DObject3DGraphicLayer?C:null};if(c.isSome(y)&&!y.globalPropertyChanged(t,w,B))return!1}return!0};A.applyRendererDiff=function(t,w){return this.loadStatus!==h.LoadStatus.LOADED?g.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((u,z)=>u!==g.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(z)?Math.min(u,z.applyRendererDiff(t,w)):u,g.ApplyRendererDiffResult.Fast_Update)};A.prepareSymbolPatch=function(t){if(this.loadStatus!==
h.LoadStatus.FAILED&&"partial"===t.diff.type){var w=t.diff.diff;if(w.symbolLayers&&"partial"===w.symbolLayers.type){var u=w.symbolLayers.diff;this.symbolLayers.forEach((z,y)=>{if(!c.isNone(z)){var B=u[y];if(B){const C={diff:B,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};z.prepareSymbolLayerPatch(C);t.symbolStatePatches.push(...C.symbolLayerStatePatches);C.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((k,q)=>{const x=k.graphics[y];c.isSome(x)&&C.graphics3DGraphicPatches.forEach(v=>
v(x,q))})}}})}}};A.updateGeometry=function(t,w){for(let u=0;u<this.symbolLayers.length;u++){const z=this.symbolLayers[u];if(c.isNone(z))continue;const y=t.graphics[u];if(c.isNone(y)||!z.updateGeometry(y,w))return!1}return!0};A.onRemoveGraphic=function(t){for(let w=0;w<this.symbolLayers.length;w++){const u=this.symbolLayers[w];if(c.isNone(u))continue;const z=t.graphics[w];if(c.isSome(z))u.onRemoveGraphic(z)}};A.getFastUpdateStatus=function(){let t=0,w=0,u=0;this.symbolLayers.forEach(z=>{c.isNone(z)||
(z.loadStatus===h.LoadStatus.LOADING?t++:z.isFastUpdatesEnabled()?u++:w++)});return{loading:t,slow:w,fast:u}};A.queryForSnapping=function(){var t=a._asyncToGenerator(function*(w,u,z,y){var B=this.symbolLayers.filter(c.isSome).filter(C=>c.isSome(C.queryForSnapping)).map(C=>C.queryForSnapping(w,u,z,y));B=yield Promise.all(B);r.throwIfAborted(y);return B.flat()});return function(w,u,z,y){return t.apply(this,arguments)}}();A.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{e.prototype.destroy.call(this);for(const t of this.symbolLayers)c.isSome(t)&&t.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(l,[{key:"symbol",get:function(){return this._symbol},set:function(t){this._symbol=t;for(let w=0;w<t.symbolLayers.length;w++){const u=this.symbolLayers[w];c.isNone(u)||(u.symbol=t,u.symbolLayer=t.symbolLayers.items[w])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(t=>
c.isSome(t)&&t.queryForSnapping)}},{key:"complexity",get:function(){return d.totalSymbolComplexities(this.symbolLayers.map(t=>c.get(t,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return l}(h.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){const y=new m(Array,C=>e.set(C,e.ZERO),null,10,5),B=l.create();return function(){function C(q,x,v,D,F){this.graphic=q;this.graphics3DSymbol=x;this.graphics=v;this._labelGraphics=[];this._auxiliaryGraphics=[];var G=u.VisibilityFlag._COUNT;const J=Array(u.VisibilityGroup._COUNT);for(let L=0;L<J.length;L++)J[L]=Array(G);this._visibilityFlags=J;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=
!1;++x.referenced;this._featureExpressionFeature=F?z.createFeature(F,q,D):null;for(const L of v)r.isSome(L)&&(this.isElevationSource=this.isElevationSource||L.isElevationSource)}var k=C.prototype;k.initialize=function(q,x){this._layer=x;this._stage=q;this._forEachSymbolLayerGraphic(v=>{v.initialize(q,x);v.setVisibility(this.isVisible())})};k.destroy=function(){this._forEachSymbolLayerGraphic(q=>q.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=
null};k.clearLabelGraphics=function(){this._forEachLabelGraphic(q=>q.destroy());this._labelGraphics.length=0};k.addLabelGraphic=function(q,x,v){this._labelGraphics.push(q);q.initialize(x,v);q.setVisibility(this.isVisible(u.VisibilityGroup.LABEL))};k.addAuxiliaryGraphic=function(q){this._auxiliaryGraphics.push(q);this._layer&&(q.initialize(this._stage,this._layer),q.setVisibility(this.isVisible()))};k.isVisible=function(q=u.VisibilityGroup.GRAPHIC,x){for(let v=0;v<=q;v++){const D=this._visibilityFlags[v];
for(let F=0;F<D.length;++F)if(!1===D[F]&&F!==x)return!1}return!0};k.hasVisibilityFlag=function(q,x){return null!=this._visibilityFlags[x][q]};k.setVisibilityFlag=function(q,x,v){const D=this.isVisible(v);this._visibilityFlags[v][q]=x;const F=this.isVisible(v);if(D===F)return!1;if(v===u.VisibilityGroup.LABEL)this._forEachLabelGraphic(G=>G.setVisibility(F));else{this._forEachSymbolLayerGraphic(J=>J.setVisibility(F));const G=this.isVisible(u.VisibilityGroup.LABEL);this._forEachLabelGraphic(J=>J.setVisibility(G))}return!0};
k.clearVisibilityFlag=function(q,x=u.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(q,void 0,x)};k.computeExtent=function(q){if(!this._extent){var x=this.graphic.geometry;if(r.isNone(x))return!1;this._extent=l.create();t.computeAABR(x,this._extent);x=x.spatialReference;if(!A.equals(x,q)&&!f.projectBoundingRect(this._extent,x,this._extent,q))return this._extent=null,!1}return!0};k.getAsOptimizedGeometry=function(q,x){if(r.isSome(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===
q&&this._optimizedGeometry.hasM===x)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,q,x);this._optimizedGeometry.hasZ=q;this._optimizedGeometry.hasM=x;return this._optimizedGeometry.geometry};k._convertGraphicToOptimizedGeometry=function(q,x,v){q=q.geometry;if("mesh"===q.type||"extent"===q.type)q=d.fromExtent("mesh"===q.type?q.extent:q);return w.convertFromGeometry(q,x,v)};k.computeAttachmentOrigin=function(){const q={render:{origin:h.create(),
num:0},draped:{origin:p.create(),num:0}};for(const x of this.graphics)r.isNone(x)||x.computeAttachmentOrigin(q);q.render.num&&g.scale(q.render.origin,q.render.origin,1/q.render.num);q.draped.num&&n.scale(q.draped.origin,q.draped.origin,1/q.draped.num);return q};k.getProjectedBoundingBox=function(){var q=a._asyncToGenerator(function*(x,v,D,F,G){G||(G={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});G.boundingBox?e.empty(G.boundingBox):G.boundingBox=e.empty();G.requiresDrapedElevation=
!1;yield b.forEach(this.graphics,function(){var J=a._asyncToGenerator(function*(L){if(!r.isNone(L)){var K="draped"===L.type?v:x,O=y.acquire();L=yield L.getProjectedBoundingBox(K,D,G.screenSpaceObjects,F,O);isFinite(L[2])&&isFinite(L[5])||(G.requiresDrapedElevation=!0);L&&e.expandWithAABB(G.boundingBox,O);y.release(O)}});return function(L){return J.apply(this,arguments)}}());return e.allFinite(G.boundingBox)||l.allFinite(e.toRect(G.boundingBox,B))?G:null});return function(x,v,D,F,G){return q.apply(this,
arguments)}}();k.needsElevationUpdates=function(){for(const q of this.graphics)if(r.isSome(q)&&("object3d"===q.type||"lod-instance"===q.type)&&q.needsElevationUpdates)return!0;for(const q of this._labelGraphics)if(q&&q.needsElevationUpdates)return!0;return!1};k.alignWithElevation=function(q,x,v){this._forEachRenderedGraphic(D=>{"object3d"!==D.type&&"lod-instance"!==D.type||D.alignWithElevation(q,x,this._featureExpressionFeature,v)})};k.addObjectStateSet=function(q,x){this._forEachSymbolLayerGraphic(v=>
v.addObjectState(q,x))};k.removeObjectState=function(q){this._forEachSymbolLayerGraphic(x=>x.removeObjectState(q))};k._forEachGraphicList=function(q,x){q.forEach(v=>v&&x(v))};k._forEachSymbolLayerGraphic=function(q){this._forEachGraphicList(this.graphics,q);this._forEachGraphicList(this._auxiliaryGraphics,q)};k._forEachLabelGraphic=function(q){this._forEachGraphicList(this._labelGraphics,q)};k._forEachRenderedGraphic=function(q){this._forEachSymbolLayerGraphic(q);this._forEachLabelGraphic(q)};a._createClass(C,
[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"isDraped",get:function(){let q=!1;this._forEachSymbolLayerGraphic(x=>{"draped"===x.type&&(q=!0)});return q}},{key:"usedMemory",get:function(){let q=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(x=>{const v=x.graphics3DSymbolLayer.complexity;r.isNone(v)||(x="draped"===x.type?
v.memory.draped:v.memory,q+=x.bytesPerFeature,x.bytesPerCoordinate&&(q+=t.numVertices(this.graphic.geometry)*x.bytesPerCoordinate))});return q}}]);return C}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){const e={icon:r.Graphics3DIconSymbolLayer,object:p.Graphics3DObjectSymbolLayer,line:m.Graphics3DLineSymbolLayer,path:g.Graphics3DPathSymbolLayer,fill:h.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:d.Graphics3DTextSymbolLayer,water:f.Graphics3DWaterSymbolLayer},l={"mesh-3d":{fill:n.Graphics3DMeshFillSymbolLayer}};a.make=function(A,t,w,u){const z=l[A.type]&&l[A.type][t.type]||e[t.type];return z?new z(A,t,w,u):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${t.type}`),null)};a.setSymbolClass=function(A,t){e[A]=t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I){function M(fa,ea,da,la,oa){var ra=Array(fa.length).fill(0);la=[[E.VertexAttribute.POSITION,{size:3,data:da.positions,exclusive:!0}],[E.VertexAttribute.NORMAL,{size:3,data:da.normals,exclusive:!0}],[E.VertexAttribute.COLOR,{size:4,data:la,exclusive:!0}],[E.VertexAttribute.SIZE,{size:1,data:da.heights,exclusive:!0}]];ra=[[E.VertexAttribute.POSITION,fa],[E.VertexAttribute.NORMAL,fa],[E.VertexAttribute.COLOR,ra]];da.elevation&&
(la.push([E.VertexAttribute.MAPPOS,{size:3,data:da.elevation}]),ra.push([E.VertexAttribute.MAPPOS,fa]));return new N.Geometry(la,ra,P.PrimitiveType.Triangle,oa,ea)}function Q(fa,ea,da,la,oa,ra,Aa,ua,za,va,Ja,pa,Ba){let Ha=0;var wa=2*la.count,ya=la.index,Na=la.count,Ra=da.length/3,Sa=wa;l.copy(ha,pa);const ja=0<Ja?1:-1;wa=3*ya;let Ta=0;ya=3*Ta;let qa=Na;pa=3*qa;for(let Ea=0;Ea<Na;++Ea)Ba&&(ha[0]=fa[wa+0],ha[1]=fa[wa+1],ha[2]=fa[wa+2],l.normalize(ha,ha)),oa[ya+0]=fa[wa+0],oa[ya+1]=fa[wa+1],oa[ya+2]=
fa[wa+2],ra[ya+0]=ea[wa+0],ra[ya+1]=ea[wa+1],ra[ya+2]=ea[wa+2],Aa[ya+0]=-ja*ha[0],Aa[ya+1]=-ja*ha[1],Aa[ya+2]=-ja*ha[2],ua[Ta]=0,oa[pa+0]=fa[wa+0]+Ja*ha[0],oa[pa+1]=fa[wa+1]+Ja*ha[1],oa[pa+2]=fa[wa+2]+Ja*ha[2],ra[pa+0]=ea[wa+0],ra[pa+1]=ea[wa+1],ra[pa+2]=ea[wa+2],Aa[pa+0]=ja*ha[0],Aa[pa+1]=ja*ha[1],Aa[pa+2]=ja*ha[2],ua[qa]=Ja,ya+=3,pa+=3,wa+=3,Ta+=1,qa+=1;ya=wa=0;pa=3*Sa;fa=0>Ja?ca:Z;ea=0>Ja?Z:ca;for(Ba=0;Ba<Ra;++Ba)va[ya+0]=da[wa+fa[0]],va[ya+1]=da[wa+fa[1]],va[ya+2]=da[wa+fa[2]],za[pa+0]=da[wa+
ea[0]]+Na,za[pa+1]=da[wa+ea[1]]+Na,za[pa+2]=da[wa+ea[2]]+Na,ya+=3,pa+=3,wa+=3;da=2*la.count;wa=0;S(oa,ra,ua,Aa,Ha,la.pathLengths[0],la.count,da,za,wa,Ja);da+=4*la.pathLengths[0];wa+=2*la.pathLengths[0];Ha+=la.pathLengths[0];for(va=1;va<la.pathLengths.length;++va)S(oa,ra,ua,Aa,Ha,la.pathLengths[va],la.count,da,za,wa,Ja),da+=4*la.pathLengths[va],wa+=2*la.pathLengths[va],Ha+=la.pathLengths[va]}function T(fa,ea,da,la,oa,ra,Aa){la[ra]=la[Aa];Aa*=3;ra*=3;fa[ra+0]=fa[Aa+0];fa[ra+1]=fa[Aa+1];fa[ra+2]=fa[Aa+
2];ea[ra+0]=ea[Aa+0];ea[ra+1]=ea[Aa+1];ea[ra+2]=ea[Aa+2];da[ra+0]=oa[0];da[ra+1]=oa[1];da[ra+2]=oa[2]}function S(fa,ea,da,la,oa,ra,Aa,ua,za,va,Ja){let pa=oa,Ba=oa+1,Ha=oa+Aa,wa=oa+Aa+1,ya=ua,Na=ua+1,Ra=ua+2*ra;ua=ua+2*ra+1;0>Ja&&(pa=oa+Aa+1,wa=oa);va*=3;for(let Oa=0;Oa<ra;++Oa){Oa===ra-1&&(0<Ja?(Ba=oa,wa=oa+Aa):(Ba=oa,pa=oa+Aa));var Sa=fa,ja=pa,Ta=Ba,qa=Ha,Ea=V;ja*=3;Ta*=3;qa*=3;l.set(R,Sa[ja++],Sa[ja++],Sa[ja++]);l.set(X,Sa[Ta++],Sa[Ta++],Sa[Ta++]);l.set(W,Sa[qa++],Sa[qa++],Sa[qa++]);l.subtract(aa,
X,R);l.subtract(ba,W,R);l.cross(Ea,ba,aa);l.normalize(Ea,Ea);T(fa,ea,la,da,V,ya,pa);T(fa,ea,la,da,V,Na,Ba);T(fa,ea,la,da,V,Ra,Ha);T(fa,ea,la,da,V,ua,wa);za[va++]=ya;za[va++]=Ra;za[va++]=ua;za[va++]=ya;za[va++]=ua;za[va++]=Na;pa++;Ba++;Ha++;wa++;ya+=2;Na+=2;Ra+=2;ua+=2}}function U(fa,ea,da,la){fa=fa.stageObject;const oa=fa.geometryRecords,ra=oa.length,Aa="absolute-height"!==ea.mode;let ua=0;const za=fa.transformation,va=f.invert(e.create(),za);for(let pa=0;pa<ra;pa+=2){const Ba=oa[pa].geometry,Ha=
Ba.getMutableAttribute(E.VertexAttribute.POSITION).data,wa=Ba.vertexAttributes.get(E.VertexAttribute.SIZE).data;var Ja=Ba.vertexAttributes.get(E.VertexAttribute.MAPPOS).data;Ja=new K.SamplePosition(Ja);const ya=Ha.length/3;let Na=0,Ra=!1,Sa=0;const ja=da.spatialReference;for(let Ta=0;Ta<ya;Ta++){ia[0]=Ha[Na];ia[1]=Ha[Na+1];ia[2]=Ha[Na+2];k.evaluateElevationInfoAtPoint(Ja,da,ea,la,ka);Aa&&(Sa+=ka.sampledElevation);L.TESTS_DISABLE_OPTIMIZATIONS?(l.set(ma,Ja.array[Ja.offset+0],Ja.array[Ja.offset+1],
ka.z+wa[Na/3]),n.isSome(ja)&&la.toRenderCoords(ma,ja,ma)):(l.set(ma,Ha[Na+0],Ha[Na+1],Ha[Na+2]),l.transformMat4(ma,ma,za),la.setAltitude(ma,ka.z+wa[Na/3]));l.transformMat4(ma,ma,va);Ha[Na]=ma[0];Ha[Na+1]=ma[1];Ha[Na+2]=ma[2];const qa=.01/la.unitInMeters;if(Math.abs(ia[0]-Ha[Na])>=qa||Math.abs(ia[1]-Ha[Na+1])>=qa||Math.abs(ia[2]-Ha[Na+2])>=qa)Ra=!0;Ja.offset+=3;Na+=3}Ra&&(Ba.invalidateBoundingInfo(),fa.geometryVertexAttrsUpdated(oa[pa]),oa[pa+1].geometry.invalidateBoundingInfo(),fa.geometryVertexAttrsUpdated(oa[pa+
1]));ua+=Sa/ya}return ua/ra}const Y=["polygon","extent"];c=function(fa){function ea(la,oa,ra,Aa){la=fa.call(this,la,oa,ra,Aa)||this;la.ensureDrapedStatus(!1);return la}b._inheritsLoose(ea,fa);var da=ea.prototype;da.doLoad=function(){var la=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){var oa=D.validateSymbolLayerSize(this._getSymbolSize());if(oa)throw new r("graphics3dextrudesymbollayer:invalid-size",oa);}oa=n.get(this.symbolLayer,"material","color");var ra=this._getCombinedOpacityAndColor(oa);
oa=A.fromArray(ra);ra=ra[3];const Aa=1>ra||this.needsDrivenTransparentPass;oa={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:oa,ambient:oa,opacity:ra,transparent:Aa,cullFace:Aa?P.CullFaceOptions.None:P.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new I.DefaultMaterial(oa);this._bottomMaterial=new I.DefaultMaterial({...oa,cullFace:P.CullFaceOptions.Back});
this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return la.apply(this,arguments)}}();da.destroy=function(){fa.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};da.createGraphics3DGraphic=function(la){const oa=la.graphic;if(!this._validateGeometry(oa.geometry,Y,this.symbolLayer.type))return null;const ra=this._getVertexOpacityAndColor(la.renderingInfo,255),
Aa=this.setGraphicElevationContext(oa,new q.ElevationContext);return this._createAs3DShape(oa,la.renderingInfo,ra,Aa,oa.uid)};da.layerOpacityChanged=function(la,oa){var ra=n.get(this.symbolLayer,"material","color");ra=this._getCombinedOpacity(ra);const Aa=1>ra||this.needsDrivenTransparentPass;this._material.setParameters({opacity:ra,transparent:Aa});this._bottomMaterial.setParameters({opacity:ra,transparent:Aa});const ua=this._getLayerOpacity();la.forEach(za=>{za=oa(za);n.isSome(za)&&za.layerOpacityChanged(ua,
this._context.isAsync)})};da.layerElevationInfoChanged=function(la,oa){return this.updateGraphics3DGraphicElevationInfo(la,oa,k.needsElevationUpdates3D)};da.slicePlaneEnabledChanged=function(la,oa){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});la.forEach(ra=>{ra=oa(ra);n.isSome(ra)&&ra.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};da.physicalBasedRenderingChanged=
function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};da.pixelRatioChanged=function(){return!0};da._getExtrusionSize=function(la){la=la.size&&this._drivenProperties.size?B.getDriverAxisSizeValue(la.size,2)??0:this._getSymbolSize();return la/=this._context.renderCoordsHelper.unitInMeters};da.applyRendererDiff=function(la,oa){return this._drivenPropertiesChanged(oa)?
F.ApplyRendererDiffResult.Recreate_Symbol:F.ApplyRendererDiffResult.Recreate_Graphics};da.queryForSnapping=function(){var la=b._asyncToGenerator(function*(oa,ra,Aa,ua){ra=this._getExtrusionSize(Aa)*this._context.renderCoordsHelper.unitInMeters/p.getMetersPerVerticalUnitForSR(ra);const {objectId:za,target:va}=oa;Aa=m.clone(va);Aa.z=(Aa.z??0)+ra;switch(oa.type){case "edge":const {start:Ja,end:pa}=oa;oa=m.clone(Ja);ua=m.clone(pa);oa.z=(oa.z??0)+ra;ua.z=(ua.z??0)+ra;return[y.makeEdgeCandidate(za,Aa,Infinity,
oa,ua)];case "vertex":return[y.makeVertexCandidate(za,Aa,Infinity),y.makeEdgeCandidate(za,va,Infinity,va,Aa)];default:return[]}});return function(oa,ra,Aa,ua){return la.apply(this,arguments)}}();da._getSymbolSize=function(){return this.symbolLayer.size??1};da._createAs3DShape=function(la,oa,ra,Aa,ua){var za=G.geometryAsPolygon(la.geometry);if(n.isNone(za))return null;if(0===za.rings.length||!za.rings.some(Xa=>0<Xa.length))return this._logGeometryValidationWarnings(za.rings,"rings","ExtrudeSymbol3DLayer"),
null;la=O.geometryToRenderInfo(za,this._context.elevationProvider,this._context.renderCoordsHelper,Aa);this._logGeometryCreationWarnings(la,za.rings,"rings","ExtrudeSymbol3DLayer");var va=D.computeCentroid(za);if(n.isNone(va))return null;var Ja=[];const pa=[],Ba=[],Ha=w.create(),wa=e.create(),ya=A.create(),Na=this._context.renderCoordsHelper.viewingMode===C.ViewingMode.Global;Na||this._context.renderCoordsHelper.worldUpAtPosition(null,ya);t.computeTranslationToOriginAndRotation(za.spatialReference,
[va.x,va.y,0],wa,this._context.renderCoordsHelper.spatialReference);za=e.create();f.invert(za,wa);va=d.create();h.normalFromMat4(va,za);const {polygons:Ra,mapPosition:Sa,position:ja}=la;var Ta=ja.length/3;const qa=new Float64Array(18*Ta),Ea=new Float64Array(18*Ta),Oa=new Float64Array(18*Ta);Ta=new Float64Array(6*Ta);let Va=0;for(let Xa=0;Xa<Ra.length;++Xa){var Ua=Ra[Xa];const cb=Ua.count;if(this._context.clippingExtent&&(w.empty(Ha),w.expandWithBuffer(Ha,Ua.mapPosition),!w.intersectsClippingArea(Ha,
this._context.clippingExtent)))continue;const db=g.earcut(Ua.mapPosition,Ua.holeIndices,3);if(0===db.length)continue;var La=Array(6*cb+db.length),ta=Array(db.length),xa=6*cb,Ia=3*qa.BYTES_PER_ELEMENT;Ia=new u.BufferViewVec3f64(qa.buffer,Va*Ia,Ia,(Va+xa)*Ia);var Qa=3*Ea.BYTES_PER_ELEMENT;Qa=new u.BufferViewVec3f64(Ea.buffer,Va*Qa,Qa,(Va+xa)*Qa);const fb=new Float64Array(Oa.buffer,3*Va*Oa.BYTES_PER_ELEMENT,3*xa);xa=new Float64Array(Ta.buffer,1*Va*Ta.BYTES_PER_ELEMENT,1*xa);const jb=this._getExtrusionSize(oa);
Q(ja,Sa,db,Ua,Ia.typedBuffer,fb,Qa.typedBuffer,xa,La,ta,jb,ya,Na);z.transformMat4(Ia,Ia,za);z.transformMat3(Qa,Qa,va);Va+=6*cb;Ua=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:ua,layerUid:this._context.layer.uid});La=M(La,La.length-ta.length,{positions:Ia.typedBuffer,elevation:fb,normals:Qa.typedBuffer,heights:xa},ra,Ua);Ja.push(La);pa.push(this._material);Ba.push(e.IDENTITY);ta=M(ta,0,{positions:Ia.typedBuffer,elevation:fb,normals:Qa.typedBuffer,heights:xa},ra,Ua);Ja.push(ta);
pa.push(this._bottomMaterial);Ba.push(e.IDENTITY)}if(0===Ja.length)return null;oa=new H.Object3D({geometries:Ja,materials:pa,transformations:Ba,metadata:{layerUid:this._context.layer.uid,graphicUid:ua,isElevationSource:!0}});oa.transformation=wa;ra=J.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});ra=n.isSome(ra)?{baseMaterial:this._material,edgeMaterials:[ra],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null;Ja=new x.Graphics3DObject3DGraphicLayer(this,
oa,Ja,null,null,U,Aa,ra);Ja.alignedSampledElevation=la.sampledElevation;Ja.needsElevationUpdates=k.needsElevationUpdates3D(Aa.mode);return Ja};return ea}(v.Graphics3DSymbolLayer);const V=A.create(),R=A.create(),X=A.create(),W=A.create(),aa=A.create(),ba=A.create(),ia=A.create(),ma=A.create(),ha=A.create(),ka=new k.SampleElevationInfo,Z=[0,2,1],ca=[0,1,2];a.Graphics3DExtrudeSymbolLayer=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/earcut":function(){define(["exports"],
function(a){var b={exports:{}};(function(c){(function(r){r=r();void 0!==r&&(c.exports=r)})(function(){function r(v,D,F){F=F||2;var G=D&&D.length,J=G?D[0]*F:v.length,L=m(v,0,J,F,!0),K=[];if(!L||L.next===L.prev)return K;var O;if(G){var P=L;var N=F;L=[];var H;G=0;for(H=D.length;G<H;G++){var E=D[G]*N;var I=G<H-1?D[G+1]*N:v.length;E=m(v,E,I,N,!1);E===E.next&&(E.steiner=!0);I=L;var M=I.push,Q=E,T=E;do{if(Q.x<T.x||Q.x===T.x&&Q.y<T.y)T=Q;Q=Q.next}while(Q!==E);M.call(I,T)}L.sort(h);for(G=0;G<L.length;G++)N=
L[G],D=P,(P=f(N,D))?(H=B(P,N),N=n(P,P.next),H=d(H),n(H,H.next),N=d(N),P=d(D===P?N:D)):P=D,P=n(P,P.next);L=P}if(v.length>80*F){var S=O=v[0];var U=G=v[1];for(N=F;N<J;N+=F)D=v[N],P=v[N+1],D<S&&(S=D),P<U&&(U=P),D>O&&(O=D),P>G&&(G=P);O=Math.max(O-S,G-U);O=0!==O?1/O:0}p(L,K,F,S,U,O);return K}function m(v,D,F,G,J){if(J===0<x(v,D,F,G))for(J=D;J<F;J+=G)var L=C(J,v[J],v[J+1],L);else for(J=F-G;J>=D;J-=G)L=C(J,v[J],v[J+1],L);L&&t(L,L.next)&&(v=L.next,k(L),L=v);return L}function n(v,D){if(!v)return v;D||(D=v);
do{var F=!1;if(v.steiner||!t(v,v.next)&&0!==A(v.prev,v,v.next))v=v.next;else{D=v.prev;k(v);v=D;if(v===v.next)break;F=!0}}while(F||v!==D);return D}function p(v,D,F,G,J,L,K){if(v){if(!K&&L){var O=v,P=O;do null===P.z&&(P.z=e(P.x,P.y,G,J,L)),P.prevZ=P.prev,P=P.nextZ=P.next;while(P!==O);P.prevZ.nextZ=null;P.prevZ=null;O=P;var N,H,E,I,M=1;do{P=O;var Q=O=null;for(H=0;P;){H++;var T=P;for(N=E=0;N<M&&(E++,T=T.nextZ,T);N++);for(I=M;0<E||0<I&&T;)0!==E&&(0===I||!T||P.z<=T.z)?(N=P,P=P.nextZ,E--):(N=T,T=T.nextZ,
I--),Q?Q.nextZ=N:O=N,N.prevZ=Q,Q=N;P=T}Q.nextZ=null;M*=2}while(1<H)}for(O=v;v.prev!==v.next;){P=v.prev;T=v.next;if(L)Q=g(v,G,J,L);else a:if(Q=v,H=Q.prev,E=Q,M=Q.next,0<=A(H,E,M))Q=!1;else{for(N=Q.next.next;N!==Q.prev;){if(l(H.x,H.y,E.x,E.y,M.x,M.y,N.x,N.y)&&0<=A(N.prev,N,N.next)){Q=!1;break a}N=N.next}Q=!0}if(Q)D.push(P.i/F),D.push(v.i/F),D.push(T.i/F),k(v),O=v=T.next;else if(v=T,v===O){if(!K)p(n(v),D,F,G,J,L,1);else if(1===K){v=n(v);K=D;O=F;P=v;do T=P.prev,Q=P.next.next,!t(T,Q)&&w(T,P,P.next,Q)&&
y(T,Q)&&y(Q,T)&&(K.push(T.i/O),K.push(P.i/O),K.push(Q.i/O),k(P),k(P.next),P=v=Q),P=P.next;while(P!==v);v=n(P);p(v,D,F,G,J,L,2)}else if(2===K)a:{K=v;do{for(O=K.next.next;O!==K.prev;){if(P=K.i!==O.i){Q=Q=Q=Q=void 0;P=K;T=O;if(Q=P.next.i!==T.i&&P.prev.i!==T.i){b:{Q=P;do{if(Q.i!==P.i&&Q.next.i!==P.i&&Q.i!==T.i&&Q.next.i!==T.i&&w(Q,Q.next,P,T)){Q=!0;break b}Q=Q.next}while(Q!==P);Q=!1}Q=!Q}if(Q){if(Q=y(P,T)&&y(T,P)){Q=P;H=!1;E=(P.x+T.x)/2;M=(P.y+T.y)/2;do Q.y>M!==Q.next.y>M&&Q.next.y!==Q.y&&E<(Q.next.x-
Q.x)*(M-Q.y)/(Q.next.y-Q.y)+Q.x&&(H=!H),Q=Q.next;while(Q!==P);Q=H}Q=Q&&(A(P.prev,P,T.prev)||A(P,T.prev,T))||t(P,T)&&0<A(P.prev,P,P.next)&&0<A(T.prev,T,T.next)}P=Q}if(P){v=B(K,O);K=n(K,K.next);v=n(v,v.next);p(K,D,F,G,J,L);p(v,D,F,G,J,L);break a}O=O.next}K=K.next}while(K!==v)}break}}}}function g(v,D,F,G){var J=v.prev,L=v.next;if(0<=A(J,v,L))return!1;var K=J.x>v.x?J.x>L.x?J.x:L.x:v.x>L.x?v.x:L.x,O=J.y>v.y?J.y>L.y?J.y:L.y:v.y>L.y?v.y:L.y,P=e(J.x<v.x?J.x<L.x?J.x:L.x:v.x<L.x?v.x:L.x,J.y<v.y?J.y<L.y?J.y:
L.y:v.y<L.y?v.y:L.y,D,F,G);D=e(K,O,D,F,G);F=v.prevZ;for(G=v.nextZ;F&&F.z>=P&&G&&G.z<=D;){if(F!==v.prev&&F!==v.next&&l(J.x,J.y,v.x,v.y,L.x,L.y,F.x,F.y)&&0<=A(F.prev,F,F.next))return!1;F=F.prevZ;if(G!==v.prev&&G!==v.next&&l(J.x,J.y,v.x,v.y,L.x,L.y,G.x,G.y)&&0<=A(G.prev,G,G.next))return!1;G=G.nextZ}for(;F&&F.z>=P;){if(F!==v.prev&&F!==v.next&&l(J.x,J.y,v.x,v.y,L.x,L.y,F.x,F.y)&&0<=A(F.prev,F,F.next))return!1;F=F.prevZ}for(;G&&G.z<=D;){if(G!==v.prev&&G!==v.next&&l(J.x,J.y,v.x,v.y,L.x,L.y,G.x,G.y)&&0<=
A(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function h(v,D){return v.x-D.x}function d(v){if(v.next.prev===v)return v;let D=v;do{const F=D.next;if(F.prev===D||F===D||F===v)break;D=F}while(1);return D}function f(v,D){var F=D,G=v.x,J=v.y,L=-Infinity;do{if(J<=F.y&&J>=F.next.y&&F.next.y!==F.y){var K=F.x+(J-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(K<=G&&K>L){L=K;if(K===G){if(J===F.y)return F;if(J===F.next.y)return F.next}var O=F.x<F.next.x?F:F.next}}F=F.next}while(F!==D);if(!O)return null;if(G===L)return O;
D=O;K=O.x;var P=O.y,N=Infinity;F=O;do{if(G>=F.x&&F.x>=K&&G!==F.x&&l(J<P?G:L,J,K,P,J<P?L:G,J,F.x,F.y)){var H=Math.abs(J-F.y)/(G-F.x);var E;if((E=y(F,v))&&!(E=H<N)&&(E=H===N)&&!(E=F.x>O.x)&&(E=F.x===O.x)){E=O;var I=F;E=0>A(E.prev,E,I.prev)&&0>A(I.next,E,E.next)}E&&(O=F,N=H)}F=F.next}while(F!==D);return O}function e(v,D,F,G,J){v=32767*(v-F)*J;D=32767*(D-G)*J;v=(v|v<<8)&16711935;v=(v|v<<4)&252645135;v=(v|v<<2)&858993459;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;return(v|v<<1)&1431655765|
((D|D<<1)&1431655765)<<1}function l(v,D,F,G,J,L,K,O){return 0<=(J-K)*(D-O)-(v-K)*(L-O)&&0<=(v-K)*(G-O)-(F-K)*(D-O)&&0<=(F-K)*(L-O)-(J-K)*(G-O)}function A(v,D,F){return(D.y-v.y)*(F.x-D.x)-(D.x-v.x)*(F.y-D.y)}function t(v,D){return v.x===D.x&&v.y===D.y}function w(v,D,F,G){var J=z(A(v,D,F)),L=z(A(v,D,G)),K=z(A(F,G,v)),O=z(A(F,G,D));return J!==L&&K!==O||0===J&&u(v,F,D)||0===L&&u(v,G,D)||0===K&&u(F,v,G)||0===O&&u(F,D,G)?!0:!1}function u(v,D,F){return D.x<=Math.max(v.x,F.x)&&D.x>=Math.min(v.x,F.x)&&D.y<=
Math.max(v.y,F.y)&&D.y>=Math.min(v.y,F.y)}function z(v){return 0<v?1:0>v?-1:0}function y(v,D){return 0>A(v.prev,v,v.next)?0<=A(v,D,v.next)&&0<=A(v,v.prev,D):0>A(v,D,v.prev)||0>A(v,v.next,D)}function B(v,D){var F=new q(v.i,v.x,v.y),G=new q(D.i,D.x,D.y),J=v.next,L=D.prev;v.next=D;D.prev=v;F.next=J;J.prev=F;G.next=F;F.prev=G;L.next=G;G.prev=L;return G}function C(v,D,F,G){v=new q(v,D,F);G?(v.next=G.next,v.prev=G,G.next.prev=v,G.next=v):(v.prev=v,v.next=v);return v}function k(v){v.next.prev=v.prev;v.prev.next=
v.next;v.prevZ&&(v.prevZ.nextZ=v.nextZ);v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function q(v,D,F){this.i=v;this.x=D;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function x(v,D,F,G){for(var J=0,L=F-G;D<F;D+=G)J+=(v[L]-v[D])*(v[D+1]+v[L+1]),L=D;return J}r.deviation=function(v,D,F,G){var J=D&&D.length,L=Math.abs(x(v,0,J?D[0]*F:v.length,F));if(J){J=0;for(var K=D.length;J<K;J++)L-=Math.abs(x(v,D[J]*F,J<K-1?D[J+1]*F:v.length,F))}for(J=D=0;J<G.length;J+=3){K=G[J]*F;var O=G[J+1]*
F,P=G[J+2]*F;D+=Math.abs((v[K]-v[P])*(v[O+1]-v[K+1])-(v[K]-v[O])*(v[P+1]-v[K+1]))}return 0===L&&0===D?0:Math.abs((D-L)/L)};r.flatten=function(v){for(var D=v[0][0].length,F={vertices:[],holes:[],dimensions:D},G=0,J=0;J<v.length;J++){for(var L=0;L<v[J].length;L++)for(var K=0;K<D;K++)F.vertices.push(v[J][L][K]);0<J&&(G+=v[J-1].length,F.holes.push(G))}return F};return r})})(b);a.earcut=b.exports})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(h,
d,f){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=h.count,l=f[0],A=f[1],t=f[2],w=f[4],u=f[5],z=f[6],y=f[8],B=f[9],C=f[10],k=f[12],q=f[13];f=f[14];var x=h.typedBuffer;h=h.typedBufferStride;var v=d.typedBuffer;d=d.typedBufferStride;for(let F=0;F<e;F++){const G=F*h;var D=F*d;const J=v[D],L=v[D+1];D=v[D+2];x[G]=l*J+w*L+y*D+k;x[G+1]=A*J+u*L+B*D+q;x[G+2]=t*J+z*L+C*D+f}}}function r(h,d,f){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var e=h.count,l=f[0],A=f[1],t=f[2],w=f[3],u=f[4],z=f[5],y=f[6],B=f[7];f=f[8];var C=h.typedBuffer;h=h.typedBufferStride;var k=d.typedBuffer;d=d.typedBufferStride;for(let x=0;x<e;x++){const v=x*h;var q=x*d;const D=k[q],F=k[q+1];q=k[q+2];C[v]=l*D+w*F+y*q;C[v+1]=A*D+u*F+B*q;C[v+2]=t*D+z*F+f*q}}}function m(h,d,f){const e=Math.min(h.count,d.count),l=h.typedBuffer;h=h.typedBufferStride;const A=d.typedBuffer;d=d.typedBufferStride;for(let t=0;t<e;t++){const w=t*h,u=t*d;l[w]=f*A[u];l[w+1]=f*A[u+1];l[w+
2]=f*A[u+2]}}function n(h,d){const f=Math.min(h.count,d.count),e=h.typedBuffer;h=h.typedBufferStride;const l=d.typedBuffer;d=d.typedBufferStride;for(let w=0;w<f;w++){const u=w*h;var A=w*d;const z=l[A],y=l[A+1];A=l[A+2];var t=z*z+y*y+A*A;0<t&&(t=1/Math.sqrt(t),e[u]=t*z,e[u+1]=t*y,e[u+2]=t*A)}}function p(h,d,f){const e=Math.min(h.count,d.count),l=h.typedBuffer;h=h.typedBufferStride;const A=d.typedBuffer;d=d.typedBufferStride;for(let t=0;t<e;t++){const w=t*h,u=t*d;l[w]=A[u]>>f;l[w+1]=A[u+1]>>f;l[w+2]=
A[u+2]>>f}}const g=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:r,scale:m,normalize:n,shiftRight:p},Symbol.toStringTag,{value:"Module"}));a.normalize=n;a.scale=m;a.shiftRight=p;a.transformMat3=r;a.transformMat4=c;a.vec3=g})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,c,r,m,n,p=!1){return{objectId:b,target:c,distance:r,type:"edge",start:m,end:n,draped:p}};a.makeVertexCandidate=function(b,c,r){return{objectId:b,target:c,distance:r,type:"vertex"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,r,m){function n(d,f){if(!d||d.symbol)return null;f=f&&f.renderer;return d&&r.isSome(f)&&f.getObservationRenderer?f.getObservationRenderer(d):f}function p(d,f){return g.apply(this,arguments)}function g(){g=b._asyncToGenerator(function*(d,f){if(r.isSome(d.symbol))return d.symbol;const e=n(d,f);return r.isSome(e)?e.getSymbolAsync(d,f):null});return g.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(d,
f){var e=n(d,f),l=yield p(d,f);if(!l)return null;l={renderer:e,symbol:l};if(!(e&&"visualVariables"in e&&e.visualVariables))return l;f=m.getVisualVariableValues(e,d,f)??[];d=["proportional","proportional","proportional"];for(const {variable:A,value:t}of f)"color"===A.type?l.color=c.toUnitRGBA(t):"size"===A.type?"outline"===A.target?l.outlineSize=t:(f=A.axis,e=A.useSymbolValue?"symbol-value":t,"width"===f?d[0]=e:"depth"===f?d[1]=e:"height"===f?d[2]=e:d[0]="width-and-depth"===f?d[1]=e:d[1]=d[2]=e):"opacity"===
A.type?l.opacity=t:"rotation"===A.type&&"tilt"===A.axis?l.tilt=t:"rotation"===A.type&&"roll"===A.axis?l.roll=t:"rotation"===A.type&&(l.heading=t);if(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))l.size=d;return l});return h.apply(this,arguments)}a.getDriverAxisSizeValue=function(d,f=0){d=d[f];return"number"===typeof d&&isFinite(d)?d:null};a.getDriverAxisSizeValueAny=function(d){for(let f=0;3>f;f++){const e=d[f];if("number"===typeof e)return isFinite(e)?e:0}return 0};a.getRenderer=n;a.getRenderingInfo=
function(d,f){const e=n(d,f);if(r.isSome(d.symbol))var l=d.symbol;else l=n(d,f),l=r.isSome(l)&&"dot-density"!==l.type?l.getSymbol(d,f):null;if(r.isNone(l))return null;l={renderer:e,symbol:l};if(r.isNone(e)||!("visualVariables"in e)||!e.visualVariables)return l;f=m.getVisualVariableValues(e,d,f)??[];d=["proportional","proportional","proportional"];for(const {variable:A,value:t}of f)switch(A.type){case "color":l.color=t.toRgba();break;case "size":if("outline"===A.target)l.outlineSize=t;else switch(f=
A.useSymbolValue?"symbol-value":t,A.axis){case "width":d[0]=f;break;case "depth":d[1]=f;break;case "height":d[2]=f;break;case "width-and-depth":d[0]=d[1]=f;break;default:d[0]=d[1]=d[2]=f}break;case "opacity":l.opacity=t;break;case "rotation":switch(A.axis){case "tilt":l.tilt=t;break;case "roll":l.roll=t;break;default:l.heading=t}}if("proportional"!==d[0]||"proportional"!==d[1]||"proportional"!==d[2])l.size=d;return l};a.getRenderingInfoAsync=function(d,f){return h.apply(this,arguments)};a.getSymbolAsync=
p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),function(a,b,c,r,m,n,p,g){a.PolygonCreationDataBase=function(h,d,f){this.renderData=h;this.layerUid=d;this.graphicsUid=
f;this.outGeometries=[];this.outMaterials=[];this.outTransforms=[]};a.createColorGeometry=function(h){const d=[[n.VertexAttribute.POSITION,h.indices]],f=[[n.VertexAttribute.POSITION,{size:3,data:h.attributeData.position,exclusive:!0}]];c.isSome(h.attributeData.color)&&(f.push([n.VertexAttribute.COLOR,{size:4,data:h.attributeData.color,exclusive:!0}]),d.push([n.VertexAttribute.COLOR,Array(h.indices.length).fill(0)]));c.isSome(h.attributeData.uvMapSpace)&&(f.push([n.VertexAttribute.UVMAPSPACE,{size:4,
data:h.attributeData.uvMapSpace,exclusive:!0}]),d.push([n.VertexAttribute.UVMAPSPACE,h.indices]));c.isSome(h.attributeData.boundingRect)&&(f.push([n.VertexAttribute.BOUNDINGRECT,{size:9,data:h.attributeData.boundingRect,exclusive:!0}]),d.push([n.VertexAttribute.BOUNDINGRECT,h.indices]));c.isSome(h.attributeData.mapPosition)&&(f.push([n.VertexAttribute.MAPPOS,{size:3,data:h.attributeData.mapPosition,exclusive:!0}]),d.push([n.VertexAttribute.MAPPOS,h.indices]));return new m.Geometry(f,d,r.PrimitiveType.Triangle,
h.attributeData.objectAndLayerIdColor)};a.createWaterGeometry=function(h){const d=[[n.VertexAttribute.POSITION,h.indices],[n.VertexAttribute.UV0,h.indices]],f=[[n.VertexAttribute.POSITION,{size:3,data:h.attributeData.position,exclusive:!0}],[n.VertexAttribute.UV0,{size:2,data:h.attributeData.uv0,exclusive:!0}]];c.isSome(h.attributeData.mapPosition)&&(f.push([n.VertexAttribute.MAPPOS,{size:3,data:h.attributeData.mapPosition,exclusive:!0}]),d.push([n.VertexAttribute.MAPPOS,h.indices]));return new m.Geometry(f,
d)};a.geometryAsPolygon=function(h){switch(h.type){case "extent":if(h instanceof p)return g.fromExtent(h);break;case "polygon":return h}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(a,b,c,r,m,n){function p(e,l,A){return e.filter(({count:t})=>1<t).map(({index:t,count:w})=>{const u=3*t,z=u+3*w;return A?new d(t,w,l.subarray(u,z),A.subarray(u,z)):new h(t,w,l.subarray(u,z))})}function g(e,l,A){const t=[];for(const {index:w,count:u,holeIndices:z,pathLengths:y}of e){if(1>=u)continue;e=3*w;const B=e+3*u,C=z.map(k=>k-w);t.push({index:w,count:u,holeIndices:C,pathLengths:y,position:l.subarray(e,B),mapPosition:A?A.subarray(e,B):void 0})}return t}let h=function(e,l,A){this.index=
e;this.count=l;this.position=A},d=function(e){function l(A,t,w,u){A=e.call(this,A,t,w)||this;A.mapPosition=u;return A}b._inheritsLoose(l,e);return l}(h),f=function(e,l,A,t,w,u){this.position=e;this.mapPosition=l;this.polygons=A;this.outlines=t;this.projectionSuccess=w;this.sampledElevation=u};a.PolygonRenderInfo=f;a.geometryToRenderInfo=function(e,l,A,t){const w=r.pathsToTriangulationInfo(e.rings,e.hasZ,r.CounterClockwiseMode.CCW_IS_HOLE),u=new Float64Array(w.position.length);e=m.applyPerVertexElevationAlignment(w.position,
e.spatialReference,0,u,0,w.position,0,w.position.length/3,l,A,t);l=null!=e;return new f(w.position,u,g(w.polygons,w.position,u),p(w.outlines,w.position,u),l,e)};a.geometryToRenderInfoDraped=function(e,l){const A=r.pathsToTriangulationInfo(e.rings,!1,r.CounterClockwiseMode.CCW_IS_HOLE);e=c.projectBuffer(A.position,e.spatialReference,0,A.position,l,0,A.position.length/3);for(l=2;l<A.position.length;l+=3)A.position[l]=n.DRAPED_Z;return{position:A.position,polygons:g(A.polygons,A.position),outlines:p(A.outlines,
A.position),projectionSuccess:e}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],function(a,b,c,r){function m(g,h,d){if(1===g.length)return g[0];h=new Float64Array(h);d=new Uint32Array(d);let f=0,e=0,l=0;for(const A of g){for(g=0;g<A.position.length;g++)h[f++]=A.position[g];for(g=0;g<A.faces.length;g++)d[e++]=A.faces[g]+
l;l=f/3}return{position:h,faces:d}}function n(g,h,d){const f=g.length,e=Array(f),l=Array(f),A=Array(f);let t=0,w=0,u=0;var z=0;for(var y=0;y<f;++y)z+=g[y].length;z=new Float64Array(3*z);y=0;for(let q=f-1;0<=q;q--){var B=g[q],C=d===a.CounterClockwiseMode.CCW_IS_HOLE?!c.isClockwise(B,!1,!1):!1;if(C&&1!==f)e[t++]=B;else{var k=B.length;for(let x=0;x<t;++x)k+=e[x].length;k={index:y,pathLengths:Array(t+1),count:k,holeIndices:Array(t)};k.pathLengths[0]=B.length;0<B.length&&(A[u++]={index:y,count:B.length});
y=C?p(B,B.length-1,-1,z,y,B.length,h):p(B,0,1,z,y,B.length,h);for(B=0;B<t;++B)C=e[B],k.holeIndices[B]=y,k.pathLengths[B+1]=C.length,0<C.length&&(A[u++]={index:y,count:C.length}),y=p(C,0,1,z,y,C.length,h);t=0;0<k.count&&(l[w++]=k)}}for(g=0;g<t;++g)d=e[g],0<d.length&&(A[u++]={index:y,count:d.length}),y=p(d,0,1,z,y,d.length,h);l.length=w;A.length=u;return{position:z,polygons:l,outlines:A}}function p(g,h,d,f,e,l,A){e*=3;for(let t=0;t<l;++t){const w=g[h];f[e++]=w[0];f[e++]=w[1];f[e++]=A?w[2]:0;h+=d}return e/
3}a.CounterClockwiseMode=void 0;(function(g){g[g.NONE=0]="NONE";g[g.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=n;a.triangulate=function(g){g=n(g.rings,g.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);const h=[];let d=0,f=0;for(var e of g.polygons){const A=e.index,t=new Float64Array(g.position.buffer,3*A*g.position.BYTES_PER_ELEMENT,3*e.count);var l=e.holeIndices.map(w=>w-A);l=new Uint32Array(b.earcut(t,l,3));h.push({position:t,faces:l});
d+=t.length;f+=l.length}e=m(h,d,f);g=r.deduplicate(e.position.buffer,6,{originalIndices:e.faces});e.position=new Float64Array(g.buffer);e.faces=g.indices;return e};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils"],function(a,b){let c=null;a.deduplicate=function(r,m,n){var p=r.byteLength/(4*m),g=new Uint32Array(r,0,p*m);r=new Uint32Array(p);var h=n?.minReduction??
0;const d=n?.originalIndices||null,f=d?d.length:0;var e=n?.componentOffsets||null;n=0;if(e)for(var l=0;l<e.length-1;l++){var A=e[l+1]-e[l];A>n&&(n=A)}else n=p;var t=Math.floor(1.1*n)+1;if(null==c||c.length<2*t)c=new Uint32Array(b.nextHighestPowerOfTwo(2*t));for(n=0;n<2*t;n++)c[n]=0;n=0;A=(l=!!e&&!!d)?f:p;var w=l?new Uint32Array(f):null,u=0!==h?Math.ceil(7.84*1.96/(h*h)*h*(1-h)):A,z=1,y=e?e[1]:A;for(var B=0;B<A;B++){if(B===u){var C=1-n/B;if(C+1.96*Math.sqrt(C*(1-C)/B)<h)return null;u*=2}if(B===y){for(y=
0;y<2*t;y++)c[y]=0;if(d)for(y=e[z-1];y<e[z];y++)w[y]=r[d[y]];y=e[++z]}C=l?d[B]:B;const v=C*m;var k=0;for(var q=0;q<m;q++)k=g[v+q]+k|0,k=k+(k<<11)+(k>>>2)|0;k>>>=0;q=k%t;let D=n;for(;0!==c[2*q+1];){if(c[2*q]===k){const F=c[2*q+1]-1;var x=F*m;a:{for(let G=0;G<m;G++)if(g[v+G]!==g[x+G]){x=!1;break a}x=!0}if(x){D=r[F];break}}q++;q>=t&&(q-=t)}D===n&&(c[2*q]=k,c[2*q+1]=C+1,n++);r[C]=D}if(0!==h&&1-n/p<h)return null;if(l){for(p=e[z-1];p<w.length;p++)w[p]=r[d[p]];r=w}p=new Uint32Array(m*n);n=0;for(z=0;z<A;z++)if(r[z]===
n){h=g;e=(l?d[z]:z)*m;t=p;w=n*m;u=m;for(B=0;B<u;B++)t[w+B]=h[e+B];n++}if(d&&!l){m=new Uint32Array(f);for(g=0;g<m.length;g++)m[g]=r[d[g]];r=m}return{buffer:p.buffer,indices:r,uniqueCount:n}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lighting/Lightsources ../webgl-engine/materials/StippleTextureRepository ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba){a.OverlayRenderer=function(Z){function ca(ea){ea=Z.call(this,ea)||this;ea._overlays=null;ea._overlayRenderTarget=null;ea._hasHighlights=!1;ea._rendersOccluded=!1;ea._hasWater=!1;ea._handles=new n;ea._renderers=new Map;ea._sortedDrapeSourceRenderersDirty=!1;ea._sortedRenderers=new h;ea._passParameters=new F.TextureOnlyPassParameters;ea._rctx=null;ea._materialRepository=null;ea._screenToWorldRatio=
1;ea._localOriginFactory=null;ea.worldToPCSRatio=1;ea.events=new m;ea.longitudeCyclical=null;return ea}b._inheritsLoose(ca,Z);var fa=ca.prototype;fa.initialize=function(){const ea=this.view._stage.renderView;this._rctx=ea.renderingContext;const da=ea.waterTextureRepository;this._stippleTextureRepository=new R.StippleTextureRepository(ea.renderingContext);this._shaderTechniqueRepository=new G.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:y.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,
waterTextureRepository:da});this._renderContext=new E.OverlayRenderContext(this._rctx,new M.ShadowMap(this._rctx,this.view.state.viewingMode),new T.SSAOHelper(this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([d.watch(()=>da.updating,()=>this.events.emit("content-changed"),d.syncAndInitial),d.watch(()=>this.spatialReference,la=>this._localOriginFactory=new N.GridLocalOriginFactory(la),d.syncAndInitial),d.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new O.GLMaterialRepository(ea.textureRepository,this._shaderTechniqueRepository,la=>{0<(la.renderOccluded&ka)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")},()=>this.events.emit("content-changed"));this._bindParameters.slot=I.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=P.createEmptyDepthTexture(this._rctx);this._bindParameters.camera=ha;this._bindParameters.transparencyPassType=
Y.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new V.AmbientLight(z.fromValues(1,1,1))]);this._handles.add(this.view.resourceController.scheduler.registerTask(X.TaskPriority.STAGE,this))};fa.dispose=function(){this._handles.destroy();this._renderers.forEach(ea=>ea.destroy());this._renderers.clear();this._debugTextureTechnique=g.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=
g.disposeMaybe(this._passParameters.texture);this._bindParameters.highlightDepthTexture=g.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=g.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=g.disposeMaybe(this._temporaryFBO);this._quadVAO=g.disposeMaybe(this._quadVAO);this.disposeOverlays()};fa.createGeometryDrapeSourceRenderer=function(ea){return this.createDrapeSourceRenderer(ea,Q.SortedRenderGeometryRenderer)};fa.createDrapeSourceRenderer=
function(ea,da,la){const oa=this._renderers.get(ea);g.isSome(oa)&&oa.destroy();da=new da({...la,rendererContext:this,drapeSource:ea});this._renderers.set(ea,da);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in ea&&this._handles.add(d.watch(()=>ea.fullOpacity,()=>this.events.emit("content-changed")),ea);return da};fa.removeDrapeSourceRenderer=function(ea){if(!g.isNone(ea)){var da=this._renderers.get(ea);g.isNone(da)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(ea),this._handles.remove(ea),
da.destroy())}};fa.collectUnusedRenderTargetMemory=function(ea){let da=!1;if(g.isSome(this._overlayRenderTarget))for(const la of this._overlayRenderTarget.renderTargets)da=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[la.type]||!this.overlays[1].validTargets[la.type],la,ea)||da;return da};fa.ensureDrapeTargets=function(ea){g.isSome(this._overlays)&&this._overlays.forEach(da=>da.hasTargetWithoutRasterImage=f.someSet(ea,la=>la.drapeTargetType===B.DrapeTargetType.WithoutRasterImage))};
fa.ensureDrapeSources=function(ea){g.isSome(this._overlays)&&this._overlays.forEach(da=>{da.hasDrapedFeatureSource=f.someSet(ea,la=>la.drapeSourceType===B.DrapeSourceType.Features);da.hasDrapedRasterSource=f.someSet(ea,la=>la.drapeSourceType===B.DrapeSourceType.RasterImage)})};fa.ensureOverlays=function(ea,da){g.isNone(this._overlays)&&(this._overlayRenderTarget=new v.OverlayRenderTarget(this._rctx),this._overlays=[new q.Overlay(k.OverlayIndex.INNER,this._overlayRenderTarget),new q.Overlay(k.OverlayIndex.OUTER,
this._overlayRenderTarget)]);this.ensureDrapeTargets(ea);this.ensureDrapeSources(da)};fa.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=g.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};fa.runTask=function(ea){this._processDrapeSources(ea,()=>!0)};fa._processDrapeSources=function(ea,da){let la=!1;for(const [oa,ra]of this._renderers){if(ea.done)break;(oa.destroyed||da(oa))&&ra.commitChanges()&&(la=!0,ea.madeProgress())}this._sortedDrapeSourceRenderersDirty&&
(this._sortedDrapeSourceRenderersDirty=!1,la=!0,this._updateSortedDrapeSourceRenderers());la&&(g.isSome(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};fa.processSyncDrapeSources=function(){this._processDrapeSources(X.noBudget,ea=>ea.updatePolicy===L.UpdatePolicy.SYNC)};fa.isEmpty=function(){if(C.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;
for(const ea of this._renderers.values())if(!ea.isEmpty)return!1;return!0};fa.updateAnimation=function(ea){let da=!1;this._renderers.forEach(la=>da=la.updateAnimation(ea)||da);return da};fa.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};fa.drawTarget=function(ea,da,la){const oa=ea.canvasGeometries;if(0===oa.numViews)return!1;this._screenToWorldRatio=la*ea.mapUnitsPerPixel;const ra=da.output;if(this.isEmpty()||ra===D.ShaderOutput.Highlight&&!this.hasHighlights||ra===D.ShaderOutput.Normal&&
!this.hasWater||!ea.hasSomeSizedView())return!1;const Aa=da.fbo;if(!Aa.isValid())return!1;const ua=2*ea.resolution,za=ea.resolution;Aa.resize(ua,za);const va=this._rctx;ha.pixelRatio=ea.pixelRatio*la;this._renderContext.output=ra;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=ra===D.ShaderOutput.Normal?I.RenderSlot.DRAPED_WATER:I.RenderSlot.DRAPED_MATERIAL;ea.applyViewport(this._rctx);
Aa.bind(va);ea.index===k.OverlayIndex.INNER&&(va.setClearColor(0,0,0,0),va.clearSafe(W.ClearBufferBit.COLOR_BUFFER_BIT));const Ja=da.type===k.RenderTargetType.ColorNoRasterImage?a.DrawPassOption.ExcludeRasterImage:da.type===k.RenderTargetType.Occluded?a.DrawPassOption.OccludedOnly:a.DrawPassOption.Normal;Ja===a.DrawPassOption.OccludedOnly&&(this._renderContext.renderOccludedMask=ka);if(C.OVERLAY_DRAW_DEBUG_TEXTURE&&Ja!==a.DrawPassOption.OccludedOnly)for(da=0;da<oa.numViews;da++)this._setViewParameters(oa.extents[da],
ea,ha),this._drawDebugTexture(ea.resolution,ma[ea.index]);0<this._renderers.size&&this._sortedRenderers.forAll(({drapeSource:pa,renderer:Ba})=>{if(Ja!==a.DrawPassOption.ExcludeRasterImage||pa.drapeSourceType!==B.DrapeSourceType.RasterImage){({fullOpacity:pa}=pa);var Ha=g.isSome(pa)&&1>pa&&ra===D.ShaderOutput.Color;Ha&&(this.bindTemporaryFramebuffer(this._rctx,ua,za),va.clearSafe(W.ClearBufferBit.COLOR_BUFFER_BIT));for(let wa=0;wa<oa.numViews;wa++)this._setViewParameters(oa.extents[wa],ea,ha),Ba.render(this._renderContext,
this._bindParameters);Ha&&g.isSome(this._temporaryFBO)&&(Aa.bind(va),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),pa,ea.index))}});va.bindFramebuffer(null);Aa.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};fa.bindTemporaryFramebuffer=function(ea,da,la){g.isNone(this._temporaryFBO)&&(this._temporaryFBO=new x.OverlayFramebufferObject(ea,!1));this._temporaryFBO.resize(da,la);this._temporaryFBO.bind(ea)};
fa.reloadShaders=function(){var ea=b._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return ea.apply(this,arguments)}}();fa.notifyContentChanged=function(){this.events.emit("content-changed")};fa.intersect=function(ea,da,la,oa){let ra=0;for(const Aa of this._renderers.values())ra=Aa.intersect?.(ea,da,la,oa,ra)??ra};fa._updateSortedDrapeSourceRenderers=function(){this._sortedRenderers.clear();if(0!==this._renderers.size){var ea=this.view.map.allLayers;
this._renderers.forEach((da,la)=>{const oa=ea.indexOf(la.layer);this._sortedRenderers.push(new ia(la,da,0>oa?Infinity:oa))});this._sortedRenderers.sort((da,la)=>da.index-la.index)}};fa._setViewParameters=function(ea,da,la){la.viewport[0]=la.viewport[1]=0;la.viewport[2]=la.viewport[3]=da.resolution;w.ortho(la.projectionMatrix,0,ea[2]-ea[0],0,ea[3]-ea[1],la.near,la.far);w.fromTranslation(la.viewMatrix,[-ea[0],-ea[1],0]);this._bindParameters.camera=la};fa._updateHasWater=function(){const ea=p.someMap(this._renderers,
da=>da.hasWater);ea!==this._hasWater&&(this._hasWater=ea,this.events.emit("has-water",ea))};fa._updateHasHighlights=function(){const ea=p.someMap(this._renderers,da=>da.hasHighlights);ea!==this._hasHighlights&&(this._hasHighlights=ea,this.events.emit("has-highlights",ea))};fa._updateRendersOccluded=function(){const ea=p.someMap(this._renderers,da=>da.rendersOccluded);ea!==this._rendersOccluded&&(this._rendersOccluded=ea,this.events.emit("renders-occluded",ea))};fa._drawDebugTexture=function(ea,da){this._ensureDebugPatternResources(ea,
ea,da);ea=this._rctx;ea.bindTechnique(this._debugTextureTechnique,this._passParameters,null);ea.bindVAO(this._quadVAO);ea.drawArrays(W.PrimitiveType.TRIANGLE_STRIP,0,ba.vertexCount(this._quadVAO,"geometry"))};fa._ensureDebugPatternResources=function(ea,da,la){u.set(this._passParameters.color,la[0],la[1],la[2]);if(!this._passParameters.texture){la=new Uint8Array(ea*da*4);var oa=0;for(let ra=0;ra<da;ra++)for(let Aa=0;Aa<ea;Aa++){const ua=Math.floor(Aa/10),za=Math.floor(ra/10);2>ua||2>za||10*ua>ea-20||
10*za>da-20?(la[oa++]=255,la[oa++]=255,la[oa++]=255,la[oa++]=255):(la[oa++]=255,la[oa++]=255,la[oa++]=255,ua&1&&za&1?la[oa++]=Aa&1^ra&1?0:255:la[oa++]=ua&1^za&1?0:128)}this._passParameters.texture=new aa.Texture(this._rctx,{target:W.TextureType.TEXTURE_2D,pixelFormat:W.PixelFormat.RGBA,dataType:W.PixelType.UNSIGNED_BYTE,samplingMode:W.TextureSamplingMode.NEAREST,width:ea,height:da},la);ea=new U.TextureTechniqueConfiguration;ea.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(S.TextureTechnique,
ea);this._quadVAO=P.createQuadVAO(this._rctx)}};b._createClass(ca,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||p.someMap(this._renderers,
ea=>ea.updating)}},{key:"hasOverlays",get:function(){return g.isSome(this._overlays)&&g.isSome(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return g.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return g.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",
get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{drapeSourceRenderers:this._renderers,getDrapeSourceRenderer:ea=>this._renderers.get(ea)}}}]);return ca}(J.AutoDisposableMixin(r));c.__decorate([e.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);c.__decorate([J.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([J.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);c.__decorate([e.property({constructOnly:!0})],
a.OverlayRenderer.prototype,"view",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=c.__decorate([t.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);a.DrawPassOption=void 0;(function(Z){Z[Z.Normal=0]="Normal";Z[Z.OccludedOnly=1]="OccludedOnly";
Z[Z.ExcludeRasterImage=2]="ExcludeRasterImage"})(a.DrawPassOption||(a.DrawPassOption={}));let ia=function(Z,ca,fa){this.drapeSource=Z;this.renderer=ca;this.index=fa};const ma=[[1,.5,.5],[.5,.5,1]],ha=new K.Camera;ha.near=1;ha.far=1E4;ha.relativeElevation=null;const ka=H.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=ka;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],
function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=
void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=
6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=
0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,b,c,r,m,n,p){a.OverlaySource=void 0;(function(d){d[d.None=0]="None";d[d.ColorAndWater=1]="ColorAndWater";d[d.Highlight=2]="Highlight";d[d.Occluded=3]="Occluded";d[d.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(a.OverlaySource||(a.OverlaySource={}));let g=function(){function d(e,l){this.index=e;this.renderTargets=l;this._extent=r.create();this.resolution=0;this.renderLocalOrigin=p.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new h;this.validTargets=
null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=e;this.validTargets=Array(l.renderTargets.length).fill(!1)}var f=d.prototype;f.getValidTexture=function(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null};f.getColorTexture=function(e){return(e=e===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(m.RenderTargetType.Color):e===a.OverlaySource.Highlight?this.renderTargets.getTarget(m.RenderTargetType.Highlight):
e===a.OverlaySource.ObjectAndLayerIdColor?this.renderTargets.getTarget(m.RenderTargetType.ObjectAndLayerIdColor):this.renderTargets.getTarget(m.RenderTargetType.Occluded))?e.getTexture():null};f.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?this.getValidTexture(m.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(m.RenderTargetType.Color):null};f.getNormalTexture=function(e){return(e=e===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(m.RenderTargetType.Water):
null)?e.getTexture():null};f.draw=function(e,l){const A=this.computeRenderTargetValidityBitfield();for(const t of this.renderTargets.renderTargets)this.validTargets[t.type]=t.type!==m.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?e.drawTarget(this,t,l):!1;e=this.computeRenderTargetValidityBitfield();return A^e?n.ValidationState.CHANGED:n.ValidationState.UNCHANGED};f.computeRenderTargetValidityBitfield=function(){const e=this.validTargets;return+e[m.RenderTargetType.Color]|
+e[m.RenderTargetType.ColorNoRasterImage]<<1|+e[m.RenderTargetType.Highlight]<<2|+e[m.RenderTargetType.Water]<<3|+e[m.RenderTargetType.Occluded]<<4};f.setupGeometryViewsCyclical=function(e){this.setupGeometryViewsDirect();var l=.001*e.range;if(this._extent[0]-l<=e.min){const A=this.canvasGeometries.extents[this.canvasGeometries.numViews++];r.offset(this._extent,e.range,0,A)}this._extent[2]+l>=e.max&&(l=this.canvasGeometries.extents[this.canvasGeometries.numViews++],r.offset(this._extent,-e.range,
0,l))};f.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;r.copy(this.canvasGeometries.extents[0],this._extent)};f.hasSomeSizedView=function(){for(let e=0;e<this.canvasGeometries.numViews;e++){const l=this.canvasGeometries.extents[e];if(l[0]!==l[2]&&l[1]!==l[3])return!0}return!1};f.applyViewport=function(e){e.setViewport(this.index===m.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};b._createClass(d,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",
get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return d}(),h=function(){this.extents=[r.create(),r.create(),r.create()];this.numViews=0};a.Overlay=g;a.computeOverlayResolution=function(d,f,e){return Math.min(c.nextHighestPowerOfTwo(Math.max(d,f)+256),e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],
function(a,b){let c=function(r,m){this.vec3=r;this.id=m};a.LocalOrigin=c;a.fromValues=function(r,m,n,p){return new c(b.fromValues(r,m,n),p)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,b,c,r,m,n){let p=function(){function g(d,
f){this._size=r.create();this._fbo=null;this._fbo=new n.FramebufferObject(d,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:f,maxAnisotropy:8,width:0,height:0})}var h=g.prototype;h.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};h.getTexture=function(){return this._fbo?
this._fbo.colorTexture:null};h.isValid=function(){return null!==this._fbo};h.resize=function(d,f){this._size[0]=d;this._size[1]=f;this._fbo.resize(this._size[0],this._size[1])};h.bind=function(d){d.bindFramebuffer(this._fbo)};h.generateMipMap=function(){const d=this._fbo.colorTexture;d.descriptor.hasMipmap&&d.generateMipmap()};h.disposeRenderTargetMemory=function(){this._fbo?.resize(0,0)};b._createClass(g,[{key:"gpuMemoryUsage",get:function(){return this._fbo?.gpuMemoryUsage??0}}]);return g}();a.OverlayFramebufferObject=
p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ./interfaces ./OverlayFramebufferObject ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),function(a,b,c,r,m,n){let p=function(h,d,f,e=!0){this.output=d;this.type=f;this.valid=!1;this.lastUsed=Infinity;this.fbo=new m.OverlayFramebufferObject(h,e)},g=function(){function h(f){this.renderTargets=
[new p(f,n.ShaderOutput.Color,r.RenderTargetType.Color),new p(f,n.ShaderOutput.Color,r.RenderTargetType.ColorNoRasterImage),new p(f,n.ShaderOutput.Highlight,r.RenderTargetType.Highlight,!1),new p(f,n.ShaderOutput.Normal,r.RenderTargetType.Water),new p(f,n.ShaderOutput.Color,r.RenderTargetType.Occluded)];c("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new p(f,n.ShaderOutput.ObjectAndLayerIdColor,r.RenderTargetType.ObjectAndLayerIdColor))}var d=h.prototype;d.getTarget=function(f){return this.renderTargets[f].fbo};
d.dispose=function(){for(const f of this.renderTargets)f.fbo.dispose()};d.disposeRenderTargetMemory=function(){for(const f of this.renderTargets)f.fbo.disposeRenderTargetMemory()};d.validateUsageForTarget=function(f,e,l){if(f)e.lastUsed=l;else if(1E3<l-e.lastUsed)e.fbo.disposeRenderTargetMemory(),e.lastUsed=Infinity;else if(Infinity>e.lastUsed)return!0;return!1};b._createClass(h,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((f,e)=>f+e.fbo.gpuMemoryUsage,0)}}]);return h}();
a.OverlayRenderTarget=g;a.RenderTargetDescriptor=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,c,r,m){let n=function(){function h(f){this._context=f;this._perConstructorInstances=new r.NestedMap;
this._frameCounter=0;this._keepAliveFrameCount=-1}var d=h.prototype;d.dispose=function(){this._perConstructorInstances.forEach(f=>f.forEach(e=>e.technique.destroy()));this._perConstructorInstances.clear()};d.acquire=function(f,e=g){const l=e.key;let A=this._perConstructorInstances.get(f,l);if(c.isNone(A)){const t=new f(this._context,e,()=>this.release(t));A=new p(t);this._perConstructorInstances.set(f,l,A)}++A.refCount;return A.technique};d.releaseAndAcquire=function(f,e,l){if(c.isSome(l)){if(e.key===
l.key)return l;this.release(l)}return this.acquire(f,e)};d.release=function(f){c.isNone(f)||this._perConstructorInstances.empty||(f=this._perConstructorInstances.get(f.constructor,f.key),c.isNone(f)||(--f.refCount,0===f.refCount&&(f.refZeroFrame=this._frameCounter)))};d.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((f,e)=>{f.forEach((l,A)=>{0===l.refCount&&l.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(l.technique.destroy(),
this._perConstructorInstances.delete(e,A))})})};d.reloadAll=function(){var f=b._asyncToGenerator(function*(){var e=this;const l=[];this._perConstructorInstances.forEach((A,t)=>{const w=function(){var u=b._asyncToGenerator(function*(z,y){if(y=y.shader)yield y.reload(),z.forEach(B=>B.technique.reload(e._context))});return function(z,y){return u.apply(this,arguments)}}();l.push(w(A,t))});yield Promise.all(l)});return function(){return f.apply(this,arguments)}}();b._createClass(h,[{key:"viewingMode",
get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return h}(),p=function(h){this.technique=h;this.refZeroFrame=this.refCount=0};const g=new m.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/NestedMap":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(){this._outer=
new Map}var m=r.prototype;m.clear=function(){this._outer.clear()};m.get=function(n,p){return this._outer.get(n)?.get(p)};m.set=function(n,p,g){const h=this._outer.get(n);h?h.set(p,g):this._outer.set(n,new Map([[p,g]]))};m.delete=function(n,p){const g=this._outer.get(n);g&&(g.delete(p),0===g.size&&this._outer.delete(n))};m.forEach=function(n){this._outer.forEach((p,g)=>n(p,g))};b._createClass(r,[{key:"empty",get:function(){return 0===this._outer.size}}]);return r}();a.NestedMap=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){const c=m=>function(n){function p(){var g=n.apply(this,arguments)||this;g._isDisposed=!1;return g}b._inheritsLoose(p,n);p.prototype.dispose=function(){for(const g of this._managedDisposables??[]){const h=this[g];this[g]=null;h&&"function"===typeof h.dispose&&h.dispose()}this._isDisposed=!0};b._createClass(p,
[{key:"isDisposed",get:function(){return this._isDisposed}}]);return p}(m);let r=function(m){function n(){return m.apply(this,arguments)||this}b._inheritsLoose(n,m);return n}(c(function(){return function(){}}()));a.AutoDisposable=r;a.AutoDisposableMixin=c;a.autoDispose=function(){return(m,n)=>{m.hasOwnProperty("_managedDisposables")||(m._managedDisposables=m._managedDisposables?.slice()??[]);m._managedDisposables?.unshift(n)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,r,m,n){let p=function(){function h(f,e,l,A){this._textureRepository=f;this._techniqueRepository=e;this.materialChanged=l;this.requestRender=A;this._id2glMaterialRef=new m.NestedMap}var d=h.prototype;d.dispose=function(){this._textureRepository.dispose()};d.acquire=function(f,
e,l){this._ownMaterial(f);if(!f.requiresSlot(e,l))return null;e=this._id2glMaterialRef.get(l,f.id);r.isNone(e)&&(e=f.createGLMaterial({material:f,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:l}),e=new g(e),this._id2glMaterialRef.set(l,f.id,e));e.ref();return e.glMaterial};d.release=function(f,e){const l=this._id2glMaterialRef.get(e,f.id);r.isSome(l)&&(l.unref(),l.referenced||(r.disposeMaybe(l.glMaterial),this._id2glMaterialRef.delete(e,f.id)))};d._ownMaterial=function(f){r.isSome(f.repository)&&
f.repository!==this&&c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");f.repository=this};return h}(),g=function(){function h(f){this.glMaterial=f;this._refCnt=0}var d=h.prototype;d.ref=function(){++this._refCnt};d.unref=function(){--this._refCnt;n.assert(0<=this._refCnt)};b._createClass(h,[{key:"referenced",get:function(){return 0<this._refCnt}}]);return h}();a.GLMaterialRepository=p;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./basicInterfaces ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){let z=function(){function B(k){this._originSR=k;this._origins=new Map;this._objects=new Map;this._gridSize=5E5;this._rootOriginId="root/"+r.generateUID()}var C=B.prototype;C.getOrigin=function(k){var q=this._origins.get(this._rootOriginId);if(null==q){q=A.gridLocalOriginFactory.rootOrigin;if(c.isSome(q))return this._origins.set(this._rootOriginId,e.fromValues(q[0],q[1],q[2],this._rootOriginId)),this.getOrigin(k);k=e.fromValues(k[0]+Math.random()-.5,k[1]+
Math.random()-.5,k[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,k);return k}var x=this._gridSize;const v=Math.round(k[0]/x),D=Math.round(k[1]/x),F=Math.round(k[2]/x),G=`${v}/${D}/${F}`;let J=this._origins.get(G);const L=.5*x;n.subtract(y,k,q.vec3);y[0]=Math.abs(y[0]);y[1]=Math.abs(y[1]);y[2]=Math.abs(y[2]);if(y[0]<L&&y[1]<L&&y[2]<L)return J&&(x=Math.max(...y),n.subtract(y,k,J.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max(...y)<x)?J:q;J||
(J=e.fromValues(v*x,D*x,F*x,G),this._origins.set(G,J));return J};C._drawOriginBox=function(k,q=g.fromValues(1,1,0,1)){const x=window.view,v=x._stage;var D=q.toString();if(!this._objects.has(D)){this._material=new u.RibbonLineMaterial({width:2,color:q});v.add(this._material);q=new w.WebGLLayer({isPickable:!1});var F=new l.Object3D({castShadow:!1});v.add(F);q.add(F);v.add(q);this._objects.set(D,F)}D=this._objects.get(D);q=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];F=q.length;const G=Array(3*F),J=[],L=
.5*this._gridSize;for(let K=0;K<F;K++)G[3*K]=k[0]+(q[K]&1?L:-L),G[3*K+1]=k[1]+(q[K]&2?L:-L),G[3*K+2]=k[2]+(q[K]&4?L:-L),0<K&&J.push(K-1,K);h.projectBuffer(G,this._originSR,0,G,x.renderSpatialReference,0,F);k=new f.Geometry([[t.VertexAttribute.POSITION,{size:3,data:G,exclusive:!0}]],[[t.VertexAttribute.POSITION,J]],d.PrimitiveType.Line);v.add(k);D.addGeometry(k,this._material,m.IDENTITY)};b._createClass(B,[{key:"test",get:function(){const k=this;return{set gridSize(q){k._gridSize=q}}}}]);return B}();
const y=p.create();a.GridLocalOriginFactory=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./basicInterfaces ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){g=function(e){function l(t,w=""){var u=e.call(this)||this;u.apiLayerUid=w;u.type=h.ContentObjectType.Layer;u.events=new c;u.isSliceable=!1;u._objects=new n;u._stageHandles=new r;u.apiLayerUid=w;u.isVisible=t?.isVisible??!0;u.isPickable=t?.isPickable??!0;u.updatePolicy=t?.updatePolicy??p.UpdatePolicy.ASYNC;return u}b._inheritsLoose(l,e);var A=l.prototype;A.destroy=function(){this.detachStage();this._stage=null};A.attachStage=function(t){this.detachStage();this._stage=
t;for(const w of d.DirtyEventNames)this._stageHandles.add(this.events.on(w,u=>t.handleEvent(w,u)))};A.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};A.add=function(t){this._objects.push(t);t.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:t});m.isSome(this._octree)&&this._octree.add([t])};A.remove=function(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),m.isSome(this._octree)&&
this._octree.remove([t]))};A.addMany=function(t){this._objects.pushArray(t);for(const w of t)w.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t});m.isSome(this._octree)&&this._octree.add(t)};A.removeMany=function(t){const w=[];this._objects.removeUnorderedMany(t,t.length,w);if(0!==w.length){for(const u of w)u.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:w});m.isSome(this._octree)&&this._octree.remove(w)}};A.sync=function(){m.isSome(this._stage)&&
this.updatePolicy!==p.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};A.notifyObjectBBChanged=function(t,w){m.isSome(this._octree)&&this._octree.update(t,w)};A.getSpatialQueryAccelerator=function(){m.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};A.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};A.invalidateSpatialQueryAccelerator=function(){this._octree=m.destroyMaybe(this._octree)};
A._createOctree=function(){this._octree=new f(t=>t.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,this._objects.length)};b._createClass(l,[{key:"objects",get:function(){return this._objects}}]);return l}(g.ContentObject);a.WebGLLayer=g;a.isWebGLLayer=function(e){return m.isSome(e)&&e.type===h.ContentObjectType.Layer};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],
function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(H,E,I){I[0]=H[0]+E;I[1]=H[1]+E;I[2]=H[2]+E}function e(H,E,I,M){if(1===E)H=I(H[0]),h.copy(H,M);else{v[0]=Infinity;v[1]=Infinity;v[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let U=0;U<E;U++){var Q=I(H[U]);if(w(Q[3])){var T=v,S=Q;T[0]=Math.min(T[0],S[0]-S[3]);T[1]=Math.min(T[1],S[1]-S[3]);T[2]=Math.min(T[2],S[2]-S[3]);T=D;T[0]=Math.max(T[0],Q[0]+Q[3]);T[1]=Math.max(T[1],Q[1]+Q[3]);T[2]=Math.max(T[2],Q[2]+Q[3])}}m.lerp(M,v,D,.5);M[3]=Math.max(D[0]-
v[0],D[1]-v[1],D[2]-v[2])/2}}function l(H,E,I){if(!P.length)for(var M=0;8>M;++M)P.push({index:0,distance:0});for(M=0;8>M;++M){const Q=y[M];P.data[M].index=M;P.data[M].distance=t(H,E,Q)}P.sort((Q,T)=>Q.distance-T.distance);for(H=0;8>H;++H)I[H]=P.data[H].index}function A(H,E){let I=Infinity,M;for(let Q=0;8>Q;++Q){const T=t(H,E,B[Q]);T<I&&(I=T,M=B[Q])}return M}function t(H,E,I){return E*(H[0]*I[0]+H[1]*I[1]+H[2]*I[2])}function w(H){return!isNaN(H)&&-Infinity!==H&&Infinity!==H&&0<H}let u=function(){function H(I,
M){this._objectToBoundingSphere=I;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new z;this._objectCount=0;M&&(void 0!==M.maximumObjectsPerNode&&(this._maximumObjectsPerNode=M.maximumObjectsPerNode),void 0!==M.maximumDepth&&(this._maximumDepth=M.maximumDepth))}var E=H.prototype;E.destroy=function(){this._degenerateObjects.clear();z.clearPool();k[0]=null;F.prune();P.prune()};E.add=function(I,M=I.length){this._objectCount+=M;this._grow(I,M);const Q=z.acquire();
for(let T=0;T<M;T++){const S=I[T];this._isDegenerate(S)?this._degenerateObjects.add(S):(Q.init(this._root),this._add(S,Q))}z.release(Q)};E.remove=function(I,M=null){this._objectCount-=I.length;const Q=z.acquire();for(const T of I)I=b.isSome(M)?M:h.copy(this._objectToBoundingSphere(T),G),w(I[3])?(Q.init(this._root),this._remove(T,I,Q)):this._degenerateObjects.delete(T);z.release(Q);this._shrink()};E.update=function(I,M){if(w(M[3])||!this._isDegenerate(I))k[0]=I,I=k,this.remove(I,M),this.add(I)};E.forEachAlongRay=
function(I,M,Q){const T=g.wrap(I,M);this._forEachNode(this._root,S=>{if(!this._intersectsNode(T,S))return!1;S=S.node;S.terminals.forAll(U=>{this._intersectsObject(T,U)&&Q(U)});null!==S.residents&&S.residents.forAll(U=>{this._intersectsObject(T,U)&&Q(U)});return!0})};E.forEachAlongRayWithVerticalOffset=function(I,M,Q,T){const S=g.wrap(I,M);this._forEachNode(this._root,U=>{if(!this._intersectsNodeWithOffset(S,U,T))return!1;U=U.node;U.terminals.forAll(Y=>{this._intersectsObjectWithOffset(S,Y,T)&&Q(Y)});
null!==U.residents&&U.residents.forAll(Y=>{this._intersectsObjectWithOffset(S,Y,T)&&Q(Y)});return!0})};E.forEach=function(I){this._forEachNode(this._root,M=>{M=M.node;M.terminals.forAll(I);null!==M.residents&&M.residents.forAll(I);return!0});this._degenerateObjects.forEach(I)};E.forEachDegenerateObject=function(I){this._degenerateObjects.forEach(I)};E.findClosest=function(I,M,Q,T=()=>!0,S=Infinity){let U=Infinity,Y=Infinity,V=null;const R=A(I,M),X=W=>{--S;if(T(W)){var aa=this._objectToBoundingSphere(W);
if(p.intersectsSphere(Q,aa)){var ba=t(I,M,h.getCenter(aa)),ia=ba-aa[3];aa=ba+aa[3];ia<U&&(U=ia,Y=aa,V=W)}}};this._forEachNodeDepthOrdered(this._root,W=>{if(0>=S||!p.intersectsSphere(Q,W.bounds))return!1;m.scale(x,R,W.halfSize);m.add(x,x,W.bounds);if(t(I,M,x)>Y)return!1;W=W.node;W.terminals.forAll(aa=>X(aa));null!==W.residents&&W.residents.forAll(aa=>X(aa));return!0},I,M);return V};E.forEachInDepthRange=function(I,M,Q,T,S,U,Y){let V=-Infinity,R=Infinity;const X={setRange:ma=>{Q===H.DepthOrder.FRONT_TO_BACK?
(V=Math.max(V,ma.near),R=Math.min(R,ma.far)):(V=Math.max(V,-ma.far),R=Math.min(R,-ma.near))}};X.setRange(T);const W=t(M,Q,I),aa=A(M,Q),ba=A(M,-Q),ia=ma=>{if(Y(ma)){var ha=this._objectToBoundingSphere(ma),ka=h.getCenter(ha);ka=t(M,Q,ka)-W;var Z=ka+ha[3];ka-ha[3]>R||Z<V||!p.intersectsSphere(U,ha)||S(ma,X)}};this._forEachNodeDepthOrdered(this._root,ma=>{if(!p.intersectsSphere(U,ma.bounds))return!1;m.scale(x,aa,ma.halfSize);m.add(x,x,ma.bounds);if(t(M,Q,x)-W>R)return!1;m.scale(x,ba,ma.halfSize);m.add(x,
x,ma.bounds);if(t(M,Q,x)-W<V)return!1;ma=ma.node;ma.terminals.forAll(ha=>ia(ha));null!==ma.residents&&ma.residents.forAll(ha=>ia(ha));return!0},M,Q)};E.forEachNode=function(I){this._forEachNode(this._root,M=>I(M.node,M.bounds,M.halfSize))};E.forEachNeighbor=function(I,M){const Q=h.getRadius(M),T=h.getCenter(M),S=V=>{const R=this._objectToBoundingSphere(V);var X=h.getRadius(R);X=Q+X;return 0>=m.squaredDistance(h.getCenter(R),T)-X*X?I(V):!0};let U=!0;const Y=V=>{U&&(U=S(V))};this._forEachNode(this._root,
V=>{var R=h.getRadius(V.bounds);R=Q+R;if(0<m.squaredDistance(h.getCenter(V.bounds),T)-R*R)return!1;V=V.node;V.terminals.forAll(Y);U&&null!==V.residents&&V.residents.forAll(Y);return U});U&&this.forEachDegenerateObject(Y)};E._intersectsNode=function(I,M){f(M.bounds,2*-M.halfSize,v);f(M.bounds,2*M.halfSize,D);return d.rayBoxTest(I.origin,I.direction,v,D)};E._intersectsNodeWithOffset=function(I,M,Q){f(M.bounds,2*-M.halfSize,v);f(M.bounds,2*M.halfSize,D);Q.applyToMinMax(v,D);return d.rayBoxTest(I.origin,
I.direction,v,D)};E._intersectsObject=function(I,M){M=this._objectToBoundingSphere(M);return 0<M[3]?h.intersectsRay(M,I):!0};E._intersectsObjectWithOffset=function(I,M,Q){M=this._objectToBoundingSphere(M);return 0<M[3]?h.intersectsRay(Q.applyToBoundingSphere(M),I):!0};E._forEachNode=function(I,M){I=z.acquire().init(I);const Q=[I];for(;0!==Q.length;){I=Q.pop();if(M(I)&&!I.isLeaf())for(let T=0;T<I.node.children.length;T++)I.node.children[T]&&Q.push(z.acquire().init(I).advance(T));z.release(I)}};E._forEachNodeDepthOrdered=
function(I,M,Q,T=H.DepthOrder.FRONT_TO_BACK){I=z.acquire().init(I);const S=[I];for(l(Q,T,N);0!==S.length;){I=S.pop();if(M(I)&&!I.isLeaf())for(Q=7;0<=Q;--Q)T=N[Q],I.node.children[T]&&S.push(z.acquire().init(I).advance(T));z.release(I)}};E._remove=function(I,M,Q){F.clear();M=Q.advanceTo(M,(T,S)=>{F.push(T.node);F.push(S)})?Q.node.terminals:Q.node.residents;M.removeUnordered(I);if(0===M.length)for(I=F.length-2;0<=I&&this._purge(F.data[I],F.data[I+1]);I-=2);};E._nodeIsEmpty=function(I){if(0!==I.terminals.length)return!1;
if(null!==I.residents)return 0===I.residents.length;for(let M=0;M<I.children.length;M++)if(I.children[M])return!1;return!0};E._purge=function(I,M){0<=M&&(I.children[M]=null);return this._nodeIsEmpty(I)?(null===I.residents&&(I.residents=new r({shrink:!0})),!0):!1};E._add=function(I,M){M.advanceTo(this._objectToBoundingSphere(I))?M.node.terminals.push(I):(M.node.residents.push(I),M.node.residents.length>this._maximumObjectsPerNode&&M.depth<this._maximumDepth&&this._split(M))};E._split=function(I){const M=
I.node.residents;I.node.residents=null;for(let Q=0;Q<M.length;Q++){const T=z.acquire().init(I);this._add(M.getItemAt(Q),T);z.release(T)}};E._grow=function(I,M){0!==M&&(e(I,M,Q=>this._objectToBoundingSphere(Q),J),w(J[3])&&!this._fitsInsideTree(J)&&(this._nodeIsEmpty(this._root.node)?(h.copy(J,this._root.bounds),this._root.halfSize=1.25*J[3]):(I=this._rootBoundsForRootAsSubNode(J),this._placingRootViolatesMaxDepth(I)?this._rebuildTree(J,I):this._growRootAsSubNode(I),z.release(I))))};E._rebuildTree=
function(I,M){m.copy(L,M.bounds);L[3]=M.halfSize;e([I,L],2,Q=>Q,K);I=z.acquire().init(this._root);this._root.initFrom(null,K,1.25*K[3]);this._forEachNode(I,Q=>{this.add(Q.node.terminals.data,Q.node.terminals.length);null!==Q.node.residents&&this.add(Q.node.residents.data,Q.node.residents.length);return!0});z.release(I)};E._placingRootViolatesMaxDepth=function(I){const M=Math.log(I.halfSize/this._root.halfSize)*Math.LOG2E;let Q=0;this._forEachNode(this._root,T=>{Q=Math.max(Q,T.depth);return Q+M<=this._maximumDepth});
return Q+M>this._maximumDepth};E._rootBoundsForRootAsSubNode=function(I){var M=I[3];let Q=-Infinity;const T=this._root.bounds,S=this._root.halfSize;for(var U=0;3>U;U++){var Y=Math.max(0,Math.ceil((T[U]-S-(I[U]-M))/(2*S)));const V=Math.max(0,Math.ceil((I[U]+M-(T[U]+S))/(2*S)))+1;Q=Math.max(Q,2**Math.ceil(Math.log(Y+V)*Math.LOG2E));O[U].min=Y;O[U].max=V}for(I=0;3>I;I++)M=O[I].min,U=O[I].max,Y=(Q-(M+U))/2,M+=Math.ceil(Y),U+=Math.floor(Y),q[I]=T[I]-S-M*S*2+(U+M)*S;q[3]=Q*S*C;return z.acquire().initFrom(null,
q,Q*S,0)};E._growRootAsSubNode=function(I){const M=this._root.node;m.copy(J,this._root.bounds);J[3]=this._root.halfSize;this._root.init(I);I.advanceTo(J,null,!0);I.node.children=M.children;I.node.residents=M.residents;I.node.terminals=M.terminals};E._shrink=function(){for(;;){const I=this._findShrinkIndex();if(-1===I)break;this._root.advance(I);this._root.depth=0}};E._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let I=null;const M=this._root.node.children;
let Q=0,T=0;for(;T<M.length&&null==I;)Q=T++,I=M[Q];for(;T<M.length;)if(M[T++])return-1;return Q};E._isDegenerate=function(I){I=this._objectToBoundingSphere(I)[3];return!w(I)};E._fitsInsideTree=function(I){const M=this._root.bounds,Q=this._root.halfSize;return I[3]<=Q&&I[0]>=M[0]-Q&&I[0]<=M[0]+Q&&I[1]>=M[1]-Q&&I[1]<=M[1]+Q&&I[2]>=M[2]-Q&&I[2]<=M[2]+Q};a._createClass(H,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},
{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return H}(),z=function(){function H(){this.bounds=h.create();this.halfSize=0;this.initFrom(null,null,0,0)}var E=H.prototype;E.init=function(I){return this.initFrom(I.node,I.bounds,I.halfSize,I.depth)};E.initFrom=function(I,M,Q,T=this.depth){this.node=b.isSome(I)?I:H.createEmptyNode();b.isSome(M)&&
h.copy(M,this.bounds);this.halfSize=Q;this.depth=T;return this};E.advance=function(I){let M=this.node.children[I];M||(M=H.createEmptyNode(),this.node.children[I]=M);this.node=M;this.halfSize/=2;this.depth++;I=y[I];this.bounds[0]+=I[0]*this.halfSize;this.bounds[1]+=I[1]*this.halfSize;this.bounds[2]+=I[2]*this.halfSize;this.bounds[3]=this.halfSize*C;return this};E.advanceTo=function(I,M,Q=!1){for(;;){if(this.isTerminalFor(I))return M&&M(this,-1),!0;if(this.isLeaf()){if(!Q)return M&&M(this,-1),!1;this.node.residents=
null}const T=this._childIndex(I);M&&M(this,T);this.advance(T)}};E.isLeaf=function(){return null!=this.node.residents};E.isTerminalFor=function(I){return I[3]>this.halfSize/2};E._childIndex=function(I){const M=this.bounds;return(M[0]<I[0]?1:0)+(M[1]<I[1]?2:0)+(M[2]<I[2]?4:0)};H.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}};H.acquire=function(){return H._pool.acquire()};H.release=function(I){H._pool.release(I)};
H.clearPool=function(){H._pool.prune()};return H}();z._pool=new c(z);(function(H){H=H.DepthOrder||(H.DepthOrder={});H[H.FRONT_TO_BACK=1]="FRONT_TO_BACK";H[H.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(u||(u={}));const y=[n.fromValues(-1,-1,-1),n.fromValues(1,-1,-1),n.fromValues(-1,1,-1),n.fromValues(1,1,-1),n.fromValues(-1,-1,1),n.fromValues(1,-1,1),n.fromValues(-1,1,1),n.fromValues(1,1,1)],B=[n.fromValues(-1,-1,-1),n.fromValues(-1,-1,1),n.fromValues(-1,1,-1),n.fromValues(-1,1,1),n.fromValues(1,-1,-1),n.fromValues(1,
-1,1),n.fromValues(1,1,-1),n.fromValues(1,1,1)],C=Math.sqrt(3),k=[null],q=h.create(),x=n.create(),v=n.create(),D=n.create(),F=new r,G=h.create(),J=h.create(),L=h.create(),K=h.create(),O=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],P=new r,N=[0,0,0,0,0,0,0,0];return u})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ./renderers/utils ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G){function J(fa,ea,da,la,oa){for(let ra=0;ra<oa;ra++)da[la++]=fa[ea++];return la}function L(fa,ea,da){ea=ea.get(k.VertexAttribute.POSITION).data;da=da?da.get(k.VertexAttribute.POSITION):null;return fa.isClosed?da?2<da.length:6<ea.length:!1}var K;(function(fa){fa[fa.LEFT_JOIN_START=-2]="LEFT_JOIN_START";fa[fa.LEFT_JOIN_END=-1]="LEFT_JOIN_END";fa[fa.LEFT_CAP_START=-4]="LEFT_CAP_START";fa[fa.LEFT_CAP_END=-5]="LEFT_CAP_END";fa[fa.RIGHT_JOIN_START=
2]="RIGHT_JOIN_START";fa[fa.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";fa[fa.RIGHT_CAP_START=4]="RIGHT_CAP_START";fa[fa.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(K||(K={}));let O=function(fa){function ea(la){la=fa.call(this,la,new N)||this;la._configuration=new G.RibbonLineTechniqueConfiguration;la._vertexAttributeLocations=F.vertexAttributeLocations;la._layout=la.createLayout();return la}b._inheritsLoose(ea,fa);var da=ea.prototype;da.isClosed=function(la,oa){return this.parameters.isClosed?oa?2<oa.length:6<la.length:
!1};da.getConfiguration=function(la,oa){this._configuration.output=la;this._configuration.draped=oa.slot===B.RenderSlot.DRAPED_MATERIAL;la=n.isSome(this.parameters.stipplePattern)&&la!==w.ShaderOutput.Highlight;this._configuration.stippleEnabled=la;this._configuration.stippleOffColorEnabled=la&&n.isSome(this.parameters.stippleOffColor);this._configuration.stippleScaleWithLineWidth=la&&this.parameters.stippleScaleWithLineWidth;this._configuration.stipplePreferContinuous=la&&this.parameters.stipplePreferContinuous;
this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;la=this._configuration;if(n.isSome(this.parameters.markerParameters)){var ra=this.parameters.markerParameters;ra=ra.anchor===v.LineMarkerAnchor.Tip&&ra.hideOnShortSegments&&"begin-end"===ra.placement&&ra.worldSpace}else ra=!1;la.applyMarkerOffset=ra;this._configuration.hasPolygonOffset=
this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvColor=this.parameters.vvColorEnabled;this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&n.isSome(this.parameters.innerColor);this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===y.RenderOccludedFlag.OccludeAndTransparentStencil;
this._configuration.transparencyPassType=oa.transparencyPassType;this._configuration.hasMultipassTerrain=oa.multipassTerrain.enabled;this._configuration.cullAboveGround=oa.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration};da.intersect=function(la,oa,ra,Aa,ua,za,va,Ja,pa){n.isSome(pa)?this._intersectDrapedLineGeometry(la,Aa,pa,za,va):this._intersectLineGeometry(la,oa,ra,Aa,va)};da._intersectDrapedLineGeometry=function(la,oa,ra,Aa,ua){if(oa.options.selectionMode){oa=
la.vertexAttributes.get(k.VertexAttribute.POSITION).data;var za=la.vertexAttributes.get(k.VertexAttribute.SIZE),va=this.parameters.width;this.parameters.vvSizeEnabled?(za=la.vertexAttributes.get(k.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],va*=m.clamp(this.parameters.vvSizeOffset[0]+za*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):za&&(va*=za.data[0]);za=Aa[0];Aa=Aa[1];la=(va/2+4)*la.screenToWorldRatio;va=Number.MAX_VALUE;var Ja=0;for(let ya=
0;ya<oa.length-5;ya+=3){var pa=oa[ya],Ba=oa[ya+1],Ha=za-pa,wa=Aa-Ba;pa=oa[ya+3]-pa;Ba=oa[ya+4]-Ba;const Na=m.clamp((pa*Ha+Ba*wa)/(pa*pa+Ba*Ba),0,1);Ha=pa*Na-Ha;wa=Ba*Na-wa;wa=Ha*Ha+wa*wa;wa<va&&(va=wa,Ja=ya/3)}va<la*la&&ua(ra.dist,ra.normal,Ja,!1)}};da._intersectLineGeometry=function(la,oa,ra,Aa,ua){if(Aa.options.selectionMode&&!x.isInstanceHidden(oa))if(C.isTranslationMatrix(ra)){var za=la.vertexAttributes,va=za.get(k.VertexAttribute.POSITION).data;oa=this.parameters.width;if(this.parameters.vvSizeEnabled){var Ja=
za.get(k.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];oa*=m.clamp(this.parameters.vvSizeOffset[0]+Ja*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else za.has(k.VertexAttribute.SIZE)&&(oa*=za.get(k.VertexAttribute.SIZE).data[0]);var pa=Aa.camera,Ba=T;g.copy(Ba,Aa.point);Ja=oa*pa.pixelRatio/2+4*pa.pixelRatio;h.set(ia[0],Ba[0]-Ja,Ba[1]+Ja,0);h.set(ia[1],Ba[0]+Ja,Ba[1]+Ja,0);h.set(ia[2],Ba[0]+Ja,Ba[1]-Ja,0);h.set(ia[3],Ba[0]-Ja,Ba[1]-Ja,0);for(oa=
0;4>oa;oa++)if(!pa.unprojectFromRenderScreen(ia[oa],ma[oa]))return;A.fromPoints(pa.eye,ma[0],ma[1],ha);A.fromPoints(pa.eye,ma[1],ma[2],ka);A.fromPoints(pa.eye,ma[2],ma[3],Z);A.fromPoints(pa.eye,ma[3],ma[0],ca);var Ha=Number.MAX_VALUE;oa=0;la=L(this.parameters,za,la.indices)?va.length-2:va.length-5;for(za=0;za<la;za+=3){E[0]=va[za]+ra[12];E[1]=va[za+1]+ra[13];E[2]=va[za+2]+ra[14];var wa=(za+3)%va.length;I[0]=va[wa]+ra[12];I[1]=va[wa+1]+ra[13];I[2]=va[wa+2]+ra[14];if(!(0>A.signedDistance(ha,E)&&0>A.signedDistance(ha,
I)||0>A.signedDistance(ka,E)&&0>A.signedDistance(ka,I)||0>A.signedDistance(Z,E)&&0>A.signedDistance(Z,I)||0>A.signedDistance(ca,E)&&0>A.signedDistance(ca,I))){pa.projectToRenderScreen(E,S);pa.projectToRenderScreen(I,U);if(0>S[2]&&0<U[2])h.subtract(M,E,I),wa=pa.frustum,wa=-A.signedDistance(wa[e.PlaneIndex.NEAR],E)/h.dot(M,A.normal(wa[e.PlaneIndex.NEAR])),h.scale(M,M,wa),h.add(E,E,M),pa.projectToRenderScreen(E,S);else if(0<S[2]&&0>U[2])h.subtract(M,I,E),wa=pa.frustum,wa=-A.signedDistance(wa[e.PlaneIndex.NEAR],
I)/h.dot(M,A.normal(wa[e.PlaneIndex.NEAR])),h.scale(M,M,wa),h.add(I,I,M),pa.projectToRenderScreen(I,U);else if(0>S[2]&&0>U[2])continue;S[2]=0;U[2]=0;wa=l.distance2(l.fromPoints(S,U,R),Ba);wa<Ha&&(Ha=wa,h.copy(Y,E),h.copy(V,I),oa=za/3)}}ra=Aa.rayBegin;Aa=Aa.rayEnd;Ha<Ja*Ja&&(va=Number.MAX_VALUE,l.closestLineSegmentPoint(l.fromPoints(Y,V,R),l.fromPoints(ra,Aa,X),Q)&&(h.subtract(Q,Q,ra),va=h.length(Q),h.scale(Q,Q,1/va),va/=h.distance(ra,Aa)),ua(va,Q,oa,!1))}else r.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")};
da.computeAttachmentOrigin=function(la,oa){const ra=la.vertexAttributes;if(!ra)return!1;la=la.indices;const Aa=ra.get(k.VertexAttribute.POSITION);return u.computeAttachmentOriginLines(Aa,la?la.get(k.VertexAttribute.POSITION):null,la&&L(this.parameters,ra,la),oa)};da.createLayout=function(){const la=t.newLayout().vec3f(k.VertexAttribute.POSITION).f32(k.VertexAttribute.SUBDIVISIONFACTOR).vec2f(k.VertexAttribute.UV0).vec3f(k.VertexAttribute.AUXPOS1).vec3f(k.VertexAttribute.AUXPOS2);this.parameters.vvSizeEnabled?
la.f32(k.VertexAttribute.SIZEFEATUREATTRIBUTE):la.f32(k.VertexAttribute.SIZE);this.parameters.vvColorEnabled?la.f32(k.VertexAttribute.COLORFEATUREATTRIBUTE):la.vec4f(k.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&la.f32(k.VertexAttribute.OPACITYFEATUREATTRIBUTE);c("enable-feature:objectAndLayerId-rendering")&&la.vec4u8(k.VertexAttribute.OBJECTANDLAYERIDCOLOR);return la};da.createBufferWriter=function(){return new H(this._layout,this.parameters)};da.requiresSlot=function(la,oa){return oa===
w.ShaderOutput.Color||oa===w.ShaderOutput.Alpha||oa===w.ShaderOutput.Highlight||oa===w.ShaderOutput.Depth||oa===w.ShaderOutput.ObjectAndLayerIdColor?la===B.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===y.RenderOccludedFlag.OccludeAndTransparentStencil?la===B.RenderSlot.OPAQUE_MATERIAL||la===B.RenderSlot.OCCLUDER_MATERIAL||la===B.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:oa===w.ShaderOutput.Color||oa===w.ShaderOutput.Alpha?la===(this.parameters.writeDepth?B.RenderSlot.TRANSPARENT_MATERIAL:
B.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):la===B.RenderSlot.OPAQUE_MATERIAL:!1};da.createGLMaterial=function(la){return new P(la)};da.validateParameters=function(la){"miter"!==la.join&&(la.miterLimit=0);n.isSome(la.markerParameters)&&(la.markerScale=la.markerParameters.width/la.width)};return ea}(y.Material),P=function(fa){function ea(){var la=fa.apply(this,arguments)||this;la._stipplePattern=null;return la}b._inheritsLoose(ea,fa);var da=ea.prototype;da.dispose=function(){fa.prototype.dispose.call(this);
this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};da._updateOccludeeState=function(la){la.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:la.hasOccludees})};da.beginSlot=function(la){this._output!==w.ShaderOutput.Color&&this._output!==w.ShaderOutput.Alpha||this._updateOccludeeState(la);const oa=this._material.parameters.stipplePattern;this._stipplePattern!==oa&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,
oa)),this._stipplePattern=oa);return this.ensureTechnique(F.RibbonLineTechnique,la)};return ea}(z),N=function(fa){function ea(){var da=fa.apply(this,arguments)||this;da.width=0;da.color=f.ONES;da.join="miter";da.cap=G.CapType.BUTT;da.miterLimit=5;da.writeDepth=!0;da.hasPolygonOffset=!1;da.stippleTexture=null;da.stippleScaleWithLineWidth=!1;da.stipplePreferContinuous=!0;da.markerParameters=null;da.markerScale=1;da.hasSlicePlane=!1;da.vvFastUpdate=!1;da.isClosed=!1;da.falloff=0;da.innerWidth=0;da.hasOccludees=
!1;da.wireframe=!1;return da}b._inheritsLoose(ea,fa);return ea}(q.VisualVariablePassParameters),H=function(){function fa(da,la){this._parameters=la;this.numJoinSubdivisions=0;this.vertexBufferLayout=da;da=la.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=da;break;case "round":this.numJoinSubdivisions=D.NUM_ROUND_JOIN_SUBDIVISIONS+da}}var ea=fa.prototype;ea._isClosed=function(da){return L(this._parameters,da.vertexAttributes,da.indices)};ea.allocate=
function(da){return this.vertexBufferLayout.createBuffer(da)};ea.elementCount=function(da){var la=da.indices.get(k.VertexAttribute.POSITION).length/2+1;da=this._isClosed(da);la=(da?2:4)+((da?la:la-1)-(da?0:1))*(2*this.numJoinSubdivisions+4);la+=2;this._parameters.wireframe&&(la=2+4*(la-2));return la};ea.write=function(da,la,oa,ra,Aa){la=W;const ua=aa,za=ba,va=oa.vertexAttributes.get(k.VertexAttribute.POSITION).data;var Ja=oa.indices&&oa.indices.get(k.VertexAttribute.POSITION);const pa=oa.vertexAttributes.get(k.VertexAttribute.DISTANCETOSTART)?.data;
Ja&&Ja.length!==2*(va.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let Ba=1,Ha=0;this._parameters.vvSizeEnabled?Ha=oa.vertexAttributes.get(k.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:oa.vertexAttributes.has(k.VertexAttribute.SIZE)&&(Ba=oa.vertexAttributes.get(k.VertexAttribute.SIZE).data[0]);let wa=[1,1,1,1],ya=0;this._parameters.vvColorEnabled?ya=oa.vertexAttributes.get(k.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:oa.vertexAttributes.has(k.VertexAttribute.COLOR)&&
(wa=oa.vertexAttributes.get(k.VertexAttribute.COLOR).data);let Na=null;c("enable-feature:objectAndLayerId-rendering")&&(Na=oa.objectAndLayerIdColor);let Ra=0;this._parameters.vvOpacityEnabled&&(Ra=oa.vertexAttributes.get(k.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);Ja=va.length/3;const Sa=new Float32Array(ra.buffer),ja=c("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ra.buffer):null,Ta=this.vertexBufferLayout.stride/4;let qa=Aa*Ta;Aa=qa;let Ea=0;const Oa=pa?(xa,Ia,Qa)=>Ea=pa[Qa]:
(xa,Ia,Qa)=>Ea+=h.distance(xa,Ia),Va=(xa,Ia,Qa,Xa,cb,db,fb)=>{Sa[qa++]=Ia[0];Sa[qa++]=Ia[1];Sa[qa++]=Ia[2];Sa[qa++]=Xa;Sa[qa++]=fb;Sa[qa++]=cb;Sa[qa++]=xa[0];Sa[qa++]=xa[1];Sa[qa++]=xa[2];Sa[qa++]=Qa[0];Sa[qa++]=Qa[1];Sa[qa++]=Qa[2];this._parameters.vvSizeEnabled?Sa[qa++]=Ha:Sa[qa++]=Ba;this._parameters.vvColorEnabled?Sa[qa++]=ya:(xa=Math.min(4*db,wa.length-4),Sa[qa++]=wa[xa+0],Sa[qa++]=wa[xa+1],Sa[qa++]=wa[xa+2],Sa[qa++]=wa[xa+3]);this._parameters.vvOpacityEnabled&&(Sa[qa++]=Ra);c("enable-feature:objectAndLayerId-rendering")&&
(n.isSome(Na)&&(ja[4*qa]=Na[0],ja[4*qa+1]=Na[1],ja[4*qa+2]=Na[2],ja[4*qa+3]=Na[3]),qa++)};qa+=Ta;h.set(ua,va[0],va[1],va[2]);da&&h.transformMat4(ua,ua,da);if(oa=this._isClosed(oa)){var Ua=va.length-3;h.set(la,va[Ua],va[Ua+1],va[Ua+2]);da&&h.transformMat4(la,la,da)}else h.set(za,va[3],va[4],va[5]),da&&h.transformMat4(za,za,da),Va(ua,ua,za,1,K.LEFT_CAP_START,0,0),Va(ua,ua,za,1,K.RIGHT_CAP_START,0,0),h.copy(la,ua),h.copy(ua,za);Ua=oa?0:1;const La=oa?Ja:Ja-1;for(let xa=Ua;xa<La;xa++){var ta=(xa+1)%Ja*
3;h.set(za,va[ta+0],va[ta+1],va[ta+2]);da&&h.transformMat4(za,za,da);Oa(la,ua,xa);Va(la,ua,za,0,K.LEFT_JOIN_END,xa,Ea);Va(la,ua,za,0,K.RIGHT_JOIN_END,xa,Ea);ta=this.numJoinSubdivisions;for(let Ia=0;Ia<ta;++Ia){const Qa=(Ia+1)/(ta+1);Va(la,ua,za,Qa,K.LEFT_JOIN_END,xa,Ea);Va(la,ua,za,Qa,K.RIGHT_JOIN_END,xa,Ea)}Va(la,ua,za,1,K.LEFT_JOIN_START,xa,Ea);Va(la,ua,za,1,K.RIGHT_JOIN_START,xa,Ea);h.copy(la,ua);h.copy(ua,za)}oa?(h.set(za,va[3],va[4],va[5]),da&&h.transformMat4(za,za,da),Ea=Oa(la,ua,La),Va(la,
ua,za,0,K.LEFT_JOIN_END,Ua,Ea),Va(la,ua,za,0,K.RIGHT_JOIN_END,Ua,Ea)):(Ea=Oa(la,ua,La),Va(la,ua,ua,0,K.LEFT_CAP_END,La,Ea),Va(la,ua,ua,0,K.RIGHT_CAP_END,La,Ea));J(Sa,Aa+Ta,Sa,Aa,Ta);qa=J(Sa,qa-Ta,Sa,qa,Ta);this._parameters.wireframe&&this._addWireframeVertices(ra,Aa,qa,Ta)};ea._addWireframeVertices=function(da,la,oa,ra){const Aa=new Float32Array(da.buffer,oa*Float32Array.BYTES_PER_ELEMENT);da=new Float32Array(da.buffer,la*Float32Array.BYTES_PER_ELEMENT,oa-la);la=0;for(oa=0;oa<da.length-1;oa+=2*ra)la=
J(da,oa,Aa,la,ra),la=J(da,oa+2*ra,Aa,la,ra),la=J(da,oa+1*ra,Aa,la,ra),la=J(da,oa+2*ra,Aa,la,ra),la=J(da,oa+1*ra,Aa,la,ra),la=J(da,oa+3*ra,Aa,la,ra)};return fa}();const E=d.create(),I=d.create(),M=d.create(),Q=d.create(),T=d.create(),S=p.createRenderScreenPointArray3(),U=p.createRenderScreenPointArray3(),Y=d.create(),V=d.create(),R=l.create(),X=l.create(),W=d.create(),aa=d.create(),ba=d.create(),ia=[p.createRenderScreenPointArray3(),p.createRenderScreenPointArray3(),p.createRenderScreenPointArray3(),
p.createRenderScreenPointArray3()],ma=[d.create(),d.create(),d.create(),d.create()],ha=A.create(),ka=A.create(),Z=A.create(),ca=A.create();a.Parameters=N;a.RibbonLineMaterial=O;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p){a.LineMarkerSpace=void 0;(function(g){g[g.Draped=0]="Draped";g[g.Screen=1]="Screen";g[g.World=2]="World";g[g.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(g){g[g.Center=0]="Center";g[g.Tip=1]="Tip";g[g.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));p=function(g){function h(){var d=g.apply(this,arguments)||this;d.output=r.ShaderOutput.Color;d.transparencyPassType=n.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=
!1;d.writeDepth=!1;d.space=a.LineMarkerSpace.Screen;d.hideOnShortSegments=!1;d.hasCap=!1;d.anchor=a.LineMarkerAnchor.Center;d.hasTip=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.hasOccludees=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;return d}b._inheritsLoose(h,g);return h}(p.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.ShaderOutput.COUNT})],p.prototype,"output",void 0);c.__decorate([m.parameter({count:n.TransparencyPassType.COUNT})],p.prototype,"transparencyPassType",void 0);
c.__decorate([m.parameter()],p.prototype,"occluder",void 0);c.__decorate([m.parameter()],p.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],p.prototype,"writeDepth",void 0);c.__decorate([m.parameter({count:a.LineMarkerSpace.COUNT})],p.prototype,"space",void 0);c.__decorate([m.parameter()],p.prototype,"hideOnShortSegments",void 0);c.__decorate([m.parameter()],p.prototype,"hasCap",void 0);c.__decorate([m.parameter({count:a.LineMarkerAnchor.COUNT})],p.prototype,"anchor",void 0);c.__decorate([m.parameter()],
p.prototype,"hasTip",void 0);c.__decorate([m.parameter()],p.prototype,"vvSize",void 0);c.__decorate([m.parameter()],p.prototype,"vvColor",void 0);c.__decorate([m.parameter()],p.prototype,"vvOpacity",void 0);c.__decorate([m.parameter()],p.prototype,"hasOccludees",void 0);c.__decorate([m.parameter()],p.prototype,"hasMultipassTerrain",void 0);c.__decorate([m.parameter()],p.prototype,"cullAboveGround",void 0);c.__decorate([m.parameter({constValue:!0})],p.prototype,"hasVvInstancing",void 0);c.__decorate([m.parameter({constValue:!0})],
p.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){function D(G){const J=new C.ShaderBuilder,{vertex:L,fragment:K}=J,O=G.hasMultipassTerrain&&(G.output===r.ShaderOutput.Color||G.output===r.ShaderOutput.Alpha);J.include(e.PiUtils);J.include(p.RibbonVertexPosition,G);J.include(h.LineStipple,G);const P=G.applyMarkerOffset&&!G.draped;P&&(L.uniforms.add(new z.FloatPassUniform("markerScale",T=>T.markerScale)),J.include(d.MarkerSizing,{space:x.LineMarkerSpace.World}));G.output===r.ShaderOutput.Depth&&
J.include(g.OutputDepth,G);J.include(n.ObjectAndLayerIdColor,G);t.addProjViewLocalOrigin(L,G);L.uniforms.add([new B.Matrix4PassUniform("inverseProjectionMatrix",(T,S)=>S.camera.inverseProjectionMatrix),new w.Float2PassUniform("nearFar",(T,S)=>S.camera.nearFar),new z.FloatPassUniform("miterLimit",T=>"miter"!==T.join?0:T.miterLimit),new u.Float4PassUniform("viewport",(T,S)=>S.camera.fullViewport)]);L.constants.add("LARGE_HALF_FLOAT","float",65500);J.attributes.add(q.VertexAttribute.POSITION,"vec3");
J.attributes.add(q.VertexAttribute.SUBDIVISIONFACTOR,"float");J.attributes.add(q.VertexAttribute.UV0,"vec2");J.attributes.add(q.VertexAttribute.AUXPOS1,"vec3");J.attributes.add(q.VertexAttribute.AUXPOS2,"vec3");J.varyings.add("vColor","vec4");J.varyings.add("vpos","vec3");c.addLinearDepth(J);O&&J.varyings.add("depth","float");const N=G.capType===v.CapType.ROUND,H=G.stippleEnabled&&G.stippleScaleWithLineWidth||N;H&&J.varyings.add("vLineWidth","float");const E=G.stippleEnabled&&G.stippleScaleWithLineWidth;
E&&J.varyings.add("vLineSizeInv","float");const I=G.innerColorEnabled||N;I&&J.varyings.add("vLineDistance","float");const M=G.stippleEnabled&&N,Q=G.falloffEnabled||M;Q&&J.varyings.add("vLineDistanceNorm","float");N&&(J.varyings.add("vSegmentSDF","float"),J.varyings.add("vReverseSegmentSDF","float"));L.code.add(y.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);L.code.add(y.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);c.addCalculateLinearDepth(J);L.code.add(y.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${O?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);L.uniforms.add(new z.FloatPassUniform("pixelRatio",(T,S)=>S.camera.pixelRatio));L.code.add(y.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${H?y.glsl`vLineWidth = lineWidth;`:""}
      ${E?y.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);P&&L.code.add(y.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);L.code.add(y.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(G.stippleEnabled||N)&&L.code.add(y.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${N?y.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);L.code.add(y.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);G.roundJoins?L.code.add(y.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${G.stippleEnabled?y.glsl`min(1.0, subdivisionFactor * ${y.glsl.float(1.5)})`:y.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):L.code.add(y.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);L.code.add(y.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${G.capType!==v.CapType.BUTT?y.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);L.code.add(y.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${Q||I?y.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${I?y.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${Q?y.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);N&&L.code.add(y.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);G.stippleEnabled&&(G.draped?L.uniforms.add(new z.FloatPassUniform("worldToScreenRatio",(T,S)=>1/S.screenToPCSRatio)):L.code.add(y.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),L.code.add(y.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),G.draped?L.code.add(y.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):L.code.add(y.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),L.uniforms.add(new z.FloatPassUniform("stipplePatternPixelSize",T=>h.computePixelSize(T))),L.code.add(y.glsl`
      float patternLength = ${G.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));L.code.add(y.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${G.wireframe&&!G.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);O&&J.include(f.multipassTerrainTest,G);J.include(m.SliceDraw,G);K.include(A.ColorConversion);K.code.add(y.glsl`
  void main() {
    discardBySlice(vpos);
    ${O?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);G.wireframe?K.code.add(y.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(N&&K.code.add(y.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${y.glsl.float(l.symbolAlphaCutoff)}) {
        discard;
      }
    `),M?K.code.add(y.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${y.glsl.float(l.symbolAlphaCutoff)}, stippleCoverage);
      `):K.code.add(y.glsl`float stippleAlpha = getStippleAlpha();`),K.uniforms.add(new u.Float4PassUniform("intrinsicColor",T=>T.color)),K.code.add(y.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),G.innerColorEnabled&&(K.uniforms.add(new u.Float4PassUniform("innerColor",T=>b.unwrapOr(T.innerColor,T.color))),K.uniforms.add(new z.FloatPassUniform("innerWidth",(T,S)=>T.innerWidth*S.camera.pixelRatio)),K.code.add(y.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),K.code.add(y.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),G.falloffEnabled&&(K.uniforms.add(new z.FloatPassUniform("falloff",T=>T.falloff)),K.code.add(y.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));K.code.add(y.glsl`
    if (finalColor.a < ${y.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${G.output===r.ShaderOutput.Alpha?y.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${G.output===r.ShaderOutput.Color?y.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${G.output===r.ShaderOutput.Color&&G.transparencyPassType===k.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${G.output===r.ShaderOutput.Highlight?y.glsl`gl_FragColor = vec4(1.0);`:""}
    ${G.output===r.ShaderOutput.Depth?y.glsl`outputDepth(linearDepth);`:""}
    ${G.output===r.ShaderOutput.ObjectAndLayerIdColor?y.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return J}const F=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:1,build:D},Symbol.toStringTag,{value:"Module"}));a.NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=F;a.build=D})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,r,m,n,p,g){a.RibbonVertexPosition=function(h,d){const f=h.vertex;f.uniforms.add(new r.FloatPassUniform("intrinsicWidth",e=>e.width));d.vvSize?(h.attributes.add(p.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),f.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",e=>e.vvSizeMinSize)),f.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",e=>e.vvSizeMaxSize)),f.uniforms.add(new b.Float3PassUniform("vvSizeOffset",e=>e.vvSizeOffset)),f.uniforms.add(new b.Float3PassUniform("vvSizeFactor",
e=>e.vvSizeFactor)),f.code.add(n.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(h.attributes.add(p.VertexAttribute.SIZE,"float"),f.code.add(n.glsl`float getSize(){
return intrinsicWidth * size;
}`));d.vvOpacity?(h.attributes.add(p.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),f.constants.add("vvOpacityNumber","int",8),f.uniforms.add([new m.FloatsPassUniform("vvOpacityValues",e=>e.vvOpacityValues,8),new m.FloatsPassUniform("vvOpacityOpacities",e=>e.vvOpacityOpacities,8)]),f.code.add(n.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):f.code.add(n.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);d.vvColor?(h.attributes.add(p.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),f.constants.add("vvColorNumber","int",g.vvColorNumber),f.uniforms.add(new m.FloatsPassUniform("vvColorValues",e=>e.vvColorValues,g.vvColorNumber)),f.uniforms.add(new c.Float4sPassUniform("vvColorColors",e=>e.vvColorColors,g.vvColorNumber)),f.code.add(n.glsl`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(h.attributes.add(p.VertexAttribute.COLOR,"vec4"),f.code.add(n.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,r){a.OutputDepth=function(m,n){m.fragment.include(c.RgbaFloatEncoding);switch(n.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExludeHighlight:m.extensions.add("GL_OES_standard_derivatives");
m.fragment.code.add(r.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.Depth:m.fragment.code.add(r.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../../../../../../core/maybe ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../util/WebGL2Utils ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../../materials/StippleTextureRepository ../../../shaders/ensureColor4".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(w,u){const z=!(u.draped&&u.stipplePreferContinuous),{vertex:y,fragment:B}=w;B.include(c.RgbaFloatEncoding);u.draped||(r.addCameraPosition(y,u),y.uniforms.add(new p.FloatPassUniform("worldToScreenPerDistanceRatio",(C,k)=>1/k.camera.perScreenPixelRatio)),y.code.add(g.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));w.varyings.add("vStippleDistance","float");u.stippleRequiresClamp&&w.varyings.add("vStippleDistanceLimits","vec2");u.stippleRequiresStretchMeasure&&w.varyings.add("vStipplePatternStretch","float");y.code.add(g.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${t};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);y.code.add(g.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);y.code.add(g.glsl`
    if (segmentLengthPseudoScreen >= ${z?"patternLength":"1e4"}) {
  `);y.uniforms.add(new p.FloatPassUniform("pixelRatio",(C,k)=>k.camera.pixelRatio));y.code.add(g.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${u.stippleRequiresStretchMeasure?g.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);B.constants.add("stippleTexturePadding","float",f.STIPPLE_TEXTURE_PADDING);B.uniforms.add(h.createTexture2DPassSizeUniforms("stipplePatternTexture",C=>C.stippleTexture,u.hasWebGL2Context?d.TextureSizeUniformType.None:d.TextureSizeUniformType.Size));B.uniforms.add([new p.FloatPassUniform("stipplePatternSDFNormalizer",C=>{C=C.stipplePattern;return b.isSome(C)?(Math.floor(.5*(f.computeLongestPattern(C)-1))+.5)/C.pixelRatio:1}),new p.FloatPassUniform("stipplePatternPixelSizeInv",C=>1/A(C))]);B.code.add(g.glsl`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${m.textureSize(u,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `);B.code.add(g.glsl`
    float getStippleSDF(out bool isClamped) {
      ${u.stippleRequiresClamp?g.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:g.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${u.stippleScaleWithLineWidth?g.glsl`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${u.stippleRequiresStretchMeasure?g.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:g.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${u.stippleScaleWithLineWidth?g.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:g.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);u.stippleOffColorEnabled?(B.uniforms.add(new n.Float4PassUniform("stippleOffColor",C=>e.ensureColor4(C.stippleOffColor))),B.code.add(g.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):B.code.add(g.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function A(w){const u=w.stipplePattern;return b.isSome(u)?f.computeTextureSize(w.stipplePattern)/u.pixelRatio:1}const t=g.glsl.float(.4);a.LineStipple=function(w,u){w.constants.add("stippleAlphaColorDiscard","float",.001);w.constants.add("stippleAlphaHighlightDiscard","float",.5);u.stippleEnabled?l(w,u):w.fragment.code.add(g.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../core/shaderModules/interfaces ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,b,c,r,m,n,p){function g(l){return l.pattern.map(A=>
Math.round(A*l.pixelRatio))}function h(l){if(r.isNone(l))return 1;l=g(l);return Math.floor(l.reduce((A,t)=>A+t))}function d(l){return g(l).reduce((A,t)=>Math.max(A,t))}let f=function(){function l(t){this._rctx=t;this._cache=new Map}var A=l.prototype;A.dispose=function(){this._cache.forEach(t=>r.disposeMaybe(t.stippleTexture));this._cache.clear()};A._acquire=function(t){if(r.isNone(t))return null;const w=this._patternId(t);var u=this._cache.get(w);if(u)return u.refCount++,u;var z=g(t),y=1/t.pixelRatio;
u=h(t);t=d(t);const B=(Math.floor(.5*(t-1))+.5)*y;t=[];let C=1;for(var k of z){for(let D=0;D<k;D++)t.push(C*(Math.min(D,k-1-D)+.5)*y/B*.5+.5);C=-C}k=Math.round(z[0]/2);k=[...t.slice(k),...t.slice(0,k)];u+=2;z=new Uint8Array(4*u);y=4;for(var q of k)c.packFloatRGBA(q,z,y),y+=4;z.copyWithin(0,y-4,y);z.copyWithin(y,4,8);const {encodedData:x,paddedPixels:v}={encodedData:z,paddedPixels:u};q=new e(new p.Texture(this._rctx,{width:v,height:1,internalFormat:n.PixelFormat.RGBA,pixelFormat:n.PixelFormat.RGBA,
dataType:n.PixelType.UNSIGNED_BYTE,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE},x));this._cache.set(w,q);return q};A.release=function(t){if(!r.isNone(t)){t=this._patternId(t);var w=this._cache.get(t);w&&(w.refCount--,0===w.refCount&&(r.isSome(w.stippleTexture)&&w.stippleTexture.dispose(),this._cache.delete(t)))}};A.swap=function(t,w){w=this._acquire(w);this.release(t);return w};A._patternId=function(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`};return l}(),e=function(l){function A(t){var w=l.call(this)||
this;w.stippleTexture=t;w.refCount=1;return w}b._inheritsLoose(A,l);return A}(m.NoParameters);a.STIPPLE_TEXTURE_PADDING=2;a.StippleTextureRepository=f;a.computeLongestPattern=d;a.computeTextureSize=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,r){const m=r.create();a.ensureColor4=
function(n){return b.isNone(n)?r.ZEROS:4===n.length?n:c.set(m,n[0],n[1],n[2],1)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../../../core/maybe ../../../../support/engineContent/marker ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),function(a,b,c,r,m,n){a.MarkerSizing=
function(p,g){const h=p.vertex;p.constants.add("markerSizePerLineWidth","float",c.MARKER_SIZE_PER_LINE_WIDTH);h.uniforms.add(new r.FloatPassUniform("pixelRatio",(d,f)=>f.camera.pixelRatio));b.isNone(h.uniforms.get("markerScale"))&&h.constants.add("markerScale","float",1);h.code.add(m.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);g.space===n.LineMarkerSpace.World&&(h.constants.add("maxSegmentLengthFraction","float",.45),h.uniforms.add(new r.FloatPassUniform("perRenderPixelRatio",(d,f)=>f.camera.perRenderPixelRatio)),h.code.add(m.glsl`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives"],function(a,b){a.MARKER_SIZE_PER_LINE_WIDTH=10;a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.MARKER_TIP_THICKNESS_FACTOR=.25;a.prepareMarkerResources=function(c,r){return c.fromData(`${r}-marker`,()=>b.createTexture(r,64,32,6.4))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,r,m,n,p){a.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.SQUARE=1]="SQUARE";g[g.ROUND=2]="ROUND";g[g.COUNT=3]="COUNT"})(a.CapType||(a.CapType=
{}));p=function(g){function h(){var d=g.apply(this,arguments)||this;d.output=r.ShaderOutput.Color;d.capType=a.CapType.BUTT;d.transparencyPassType=n.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=!1;d.hasPolygonOffset=!1;d.writeDepth=!1;d.draped=!1;d.stippleEnabled=!1;d.stippleOffColorEnabled=!1;d.stippleScaleWithLineWidth=!1;d.stipplePreferContinuous=!0;d.roundJoins=!1;d.applyMarkerOffset=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.falloffEnabled=!1;d.innerColorEnabled=!1;d.hasOccludees=
!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;d.wireframe=!1;d.objectAndLayerIdColorInstanced=!1;return d}b._inheritsLoose(h,g);return h}(p.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.ShaderOutput.COUNT})],p.prototype,"output",void 0);c.__decorate([m.parameter({count:a.CapType.COUNT})],p.prototype,"capType",void 0);c.__decorate([m.parameter({count:n.TransparencyPassType.COUNT})],p.prototype,"transparencyPassType",void 0);c.__decorate([m.parameter()],p.prototype,"occluder",
void 0);c.__decorate([m.parameter()],p.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],p.prototype,"hasPolygonOffset",void 0);c.__decorate([m.parameter()],p.prototype,"writeDepth",void 0);c.__decorate([m.parameter()],p.prototype,"draped",void 0);c.__decorate([m.parameter()],p.prototype,"stippleEnabled",void 0);c.__decorate([m.parameter()],p.prototype,"stippleOffColorEnabled",void 0);c.__decorate([m.parameter()],p.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([m.parameter()],
p.prototype,"stipplePreferContinuous",void 0);c.__decorate([m.parameter()],p.prototype,"roundJoins",void 0);c.__decorate([m.parameter()],p.prototype,"applyMarkerOffset",void 0);c.__decorate([m.parameter()],p.prototype,"vvSize",void 0);c.__decorate([m.parameter()],p.prototype,"vvColor",void 0);c.__decorate([m.parameter()],p.prototype,"vvOpacity",void 0);c.__decorate([m.parameter()],p.prototype,"falloffEnabled",void 0);c.__decorate([m.parameter()],p.prototype,"innerColorEnabled",void 0);c.__decorate([m.parameter()],
p.prototype,"hasOccludees",void 0);c.__decorate([m.parameter()],p.prototype,"hasMultipassTerrain",void 0);c.__decorate([m.parameter()],p.prototype,"cullAboveGround",void 0);c.__decorate([m.parameter()],p.prototype,"wireframe",void 0);c.__decorate([m.parameter({constValue:!0})],p.prototype,"stippleRequiresClamp",void 0);c.__decorate([m.parameter({constValue:!0})],p.prototype,"stippleRequiresStretchMeasure",void 0);c.__decorate([m.parameter({constValue:!0})],p.prototype,"hasVvInstancing",void 0);c.__decorate([m.parameter({constValue:!0})],
p.prototype,"hasSliceTranslatedView",void 0);c.__decorate([m.parameter()],p.prototype,"objectAndLayerIdColorInstanced",void 0);a.RibbonLineTechniqueConfiguration=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){const w=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.SUBDIVISIONFACTOR,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.AUXPOS2,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);n=function(z){function y(){return z.apply(this,arguments)||
this}c._inheritsLoose(y,z);var B=y.prototype;B.initializeProgram=function(C){return new g.Program(C.rctx,y.shader.get().build(this.configuration),w)};B._makePipelineState=function(C,k){const q=this.configuration,x=C===f.TransparencyPassType.NONE,v=C===f.TransparencyPassType.FrontFace;return t.makePipelineState({blending:q.output===r.ShaderOutput.Color||q.output===r.ShaderOutput.Alpha?x?p.blendingDefault:p.oitBlending(C):null,depthTest:{func:p.oitDepthTest(C)},depthWrite:x?q.writeDepth&&t.defaultDepthWriteParams:
p.oitDepthWrite(C),colorWrite:t.defaultColorWriteParams,stencilWrite:q.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:q.hasOccludees?k?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:x||v?q.hasPolygonOffset&&u:p.OITPolygonOffset})};B.initializePipeline=function(){var C=this.configuration;C.occluder&&(C=C.hasPolygonOffset&&u,this._occluderPipelineTransparent=t.makePipelineState({blending:p.blendingDefault,polygonOffset:C,depthTest:d.depthCompareAlways,depthWrite:null,
colorWrite:t.defaultColorWriteParams,stencilWrite:null,stencilTest:d.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=t.makePipelineState({blending:p.blendingDefault,polygonOffset:C,depthTest:d.depthCompareAlways,depthWrite:null,colorWrite:t.defaultColorWriteParams,stencilWrite:d.stencilWriteMaskOff,stencilTest:d.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=t.makePipelineState({blending:null,polygonOffset:C,depthTest:d.depthCompareLess,depthWrite:null,colorWrite:null,
stencilWrite:d.stencilWriteMaskOn,stencilTest:d.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(C,k){return k?this._occludeePipelineState:this.configuration.occluder?C===h.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:C===h.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:
z.prototype.getPipelineState.call(this,C,k)};c._createClass(y,[{key:"primitiveType",get:function(){return this.configuration.wireframe?A.PrimitiveType.LINES:A.PrimitiveType.TRIANGLE_STRIP}}]);return y}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(l.RibbonLine,()=>new Promise((z,y)=>a(["./RibbonLine.glsl"],z,y)));const u={factor:0,units:-4};b.RibbonLineTechnique=n;b.vertexAttributeLocations=w;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports",
"./basicInterfaces","../../../webgl/enums"],function(a,b,c){const r={func:c.CompareFunction.LESS},m={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},n={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},p={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};
a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=r;a.renderWhenBitIsNotSet=g=>({function:{func:c.CompareFunction.NOTEQUAL,ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=g=>({function:{func:c.CompareFunction.ALWAYS,ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=m;a.stencilToolMaskBaseParams=
n;a.stencilToolMaskOccluderParams=p;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,b,c,r,m,n,p){let g=function(){function f(e,
l,A,t=null){this.rctx=e;this.sliceHelper=t;this.lastFrameCamera=new n.Camera;this.output=r.ShaderOutput.Color;this.renderOccludedMask=d;this.bindParameters=new m.BindParameters(l,A,c.isSome(t)?t.plane:null)}f.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=d};return f}(),h=function(f){function e(l,A,t,w,u){l=f.call(this,l,t,w,u)||this;l.offscreenRenderingHelper=A;l.sliceHelper=u;return l}b._inheritsLoose(e,f);return e}(g);const d=p.RenderOccludedFlag.Occlude|p.RenderOccludedFlag.OccludeAndTransparent|
p.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=g;a.RenderContext=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./Camera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){function k(ca,fa){h.set(ha,ca[fa],ca[fa+3]);return ha}a.SnapshotSlot=void 0;(function(ca){ca[ca.Highlight=0]="Highlight";ca[ca.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let q=function(){this.camera=new w.Camera;this.lightMat=g.create()},x=function(){function ca(ea,da){this._rctx=ea;this._viewingMode=da;this._enabled=!1;this._snapshots=[];this._textureSize=0;this._numCascades=1;this._maxNumCascades=4;this._splitSchemeLambda=0;this._warp=
!0;this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=A.create();this._cascades=[new q,new q,new q,new q];this._maxTextureSize=Math.min(c("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}var fa=ca.prototype;fa.dispose=function(){this._discardDepthTexture();this._discardAllSnapshots()};fa.getSnapshot=function(ea){return this.enabled?this._snapshots[ea]:null};fa.getCascades=function(){for(let ea=0;ea<this._numCascades;++ea)Q[ea]=this._cascades[ea];Q.length=this._numCascades;
return Q};fa.start=function(ea,da,la){u.assert(this.enabled);this._textureSize=this._computeTextureSize(ea.fullWidth,ea.fullHeight);this._ensureDepthTexture();const {near:oa,far:ra}=this._clampNearFar(la);this._computeCascadeDistances(ra,oa);this._setupMatrices(ea,da);la=ea.viewMatrix;ea=ea.projectionMatrix;for(let Aa=0;Aa<this._numCascades;++Aa)this._constructCascade(Aa,ea,la,da);this._lastOrigin=null;this.clear()};fa.finish=function(ea){u.assert(this.enabled);this._rctx.bindFramebuffer(ea)};fa.getShadowMapMatrices=
function(ea){if(!this._lastOrigin||!f.exactEquals(ea,this._lastOrigin)){this._lastOrigin=this._lastOrigin||e.create();f.copy(this._lastOrigin,ea);for(let da=0;da<this._numCascades;++da){p.translate(T,this._cascades[da].lightMat,ea);for(let la=0;16>la;++la)S[16*da+la]=T[la]}}return S};fa.takeCascadeSnapshotTo=function(ea,da){u.assert(this.enabled);var la=this._ensureSnapshot(da);this._bindFbo();da=this._rctx;la=da.bindTexture(la,B.Texture.TEXTURE_UNIT_FOR_UPDATES);da.gl.copyTexSubImage2D(z.TextureType.TEXTURE_2D,
0,ea.camera.viewport[0],ea.camera.viewport[1],ea.camera.viewport[0],ea.camera.viewport[1],ea.camera.viewport[2],ea.camera.viewport[3]);da.bindTexture(la,B.Texture.TEXTURE_UNIT_FOR_UPDATES)};fa.clear=function(){const ea=this._rctx;this._bindFbo();ea.setClearColor(1,1,1,1);ea.clearSafe(z.ClearBufferBit.COLOR_BUFFER_BIT|z.ClearBufferBit.DEPTH_BUFFER_BIT)};fa._computeTextureSize=function(ea,da){return Math.min(this._maxTextureSize,2*2**Math.round(.5*Math.log(ea*ea+da*da)*Math.LOG2E+.35))};fa._ensureDepthTexture=
function(){m.isSome(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new B.Texture(this._rctx,{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:z.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new y.FramebufferObject(this._rctx,{colorTarget:z.TargetType.TEXTURE,depthStencilTarget:z.DepthStencilTargetType.DEPTH_RENDER_BUFFER,
width:this._textureSize,height:this._textureSize},this._depthTexture))};fa._ensureSnapshot=function(ea){let da=this._snapshots[ea];if(m.isSome(da)&&da.descriptor.width===this._textureSize)return da;this._discardSnapshot(ea);da=new B.Texture(this._rctx,{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:z.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize});return this._snapshots[ea]=
da};fa._discardDepthTexture=function(){this._fbo=m.disposeMaybe(this._fbo);this._depthTexture=m.disposeMaybe(this._depthTexture)};fa._discardSnapshot=function(ea){this._snapshots[ea]=m.disposeMaybe(this._snapshots[ea])};fa._discardAllSnapshots=function(){for(let ea=0;ea<this._snapshots.length;++ea)this._discardSnapshot(ea);this._snapshots.length=0};fa._bindFbo=function(){const ea=this._rctx;ea.unbindTexture(this._depthTexture);ea.bindFramebuffer(this._fbo)};fa._constructCascade=function(ea,da,la,
oa){const ra=this._cascades[ea];var Aa=-this._cascadeDistances[ea],ua=-this._cascadeDistances[ea+1];Aa=(da[10]*Aa+da[14])/Math.abs(da[11]*Aa+da[15]);da=(da[10]*ua+da[14])/Math.abs(da[11]*ua+da[15]);u.assert(Aa<da);for(ua=0;8>ua;++ua){l.set(G,0===ua%4||3===ua%4?-1:1,0===ua%4||1===ua%4?-1:1,4>ua?Aa:da,1);l.transformMat4(J[ua],G,F);for(let za=0;3>za;++za)J[ua][za]/=J[ua][3]}f.negate(M,J[0]);p.translate(v,I,M);ra.camera.viewMatrix=v;for(Aa=0;8>Aa;++Aa)f.transformMat4(J[Aa],J[Aa],ra.camera.viewMatrix);
f.copy(L,J[0]);f.copy(K,J[0]);for(Aa=1;8>Aa;++Aa)for(da=0;3>da;++da)L[da]=Math.min(L[da],J[Aa][da]),K[da]=Math.max(K[da],J[Aa][da]);L[2]-=200;K[2]+=200;ra.camera.near=-K[2];ra.camera.far=-L[2];this._warp?this._constructTrapezoidalProjection(la,oa,ra):this._constructOrthogonalProjection(ra);p.multiply(ra.lightMat,ra.camera.projectionMatrix,ra.camera.viewMatrix);la=this._textureSize/2;ra.camera.viewport[0]=0===ea%2?0:la;ra.camera.viewport[1]=0===Math.floor(ea/2)?0:la;ra.camera.viewport[2]=la;ra.camera.viewport[3]=
la};fa._constructOrthogonalProjection=function(ea){p.ortho(ea.camera.projectionMatrix,L[0],K[0],L[1],K[1],ea.camera.near,ea.camera.far)};fa._constructTrapezoidalProjection=function(ea,da,la){var oa=1/J[0][3],ra=1/J[4][3];u.assert(oa<ra);oa+=Math.sqrt(oa*ra);var Aa=Math.sin(r.acosClamped(ea[2]*da[0]+ea[6]*da[1]+ea[10]*da[2]));ea=J;var ua=oa/Aa;da=O;var za=P,va=N;ra=H;oa=E;h.set(U,0,0);for(var Ja=0;4>Ja;++Ja)h.add(U,U,ea[Ja]);h.scale(U,U,.25);h.set(Y,0,0);for(Ja=4;8>Ja;++Ja)h.add(Y,Y,ea[Ja]);h.scale(Y,
Y,.25);h.lerp(V[0],ea[4],ea[5],.5);h.lerp(V[1],ea[5],ea[6],.5);h.lerp(V[2],ea[6],ea[7],.5);h.lerp(V[3],ea[7],ea[4],.5);Ja=0;var pa=h.squaredDistance(V[0],U);for(var Ba=1;4>Ba;++Ba){var Ha=h.squaredDistance(V[Ba],U);Ha<pa&&(pa=Ha,Ja=Ba)}h.subtract(R,V[Ja],ea[Ja+4]);Ja=R[0];R[0]=-R[1];R[1]=Ja;h.subtract(X,Y,U);0>h.dot(X,R)&&h.negate(R,R);h.lerp(R,R,X,Aa);h.normalize(R,R);Aa=Ja=h.dot(h.subtract(W,ea[0],U),R);for(pa=1;8>pa;++pa)Ba=h.dot(h.subtract(W,ea[pa],U),R),Ba<Aa?Aa=Ba:Ba>Ja&&(Ja=Ba);h.copy(da,U);
h.scale(W,R,Aa-ua);h.add(da,da,W);Ba=-1;Ha=1;ua=pa=0;for(let wa=0;8>wa;++wa){h.subtract(aa,ea[wa],da);h.normalize(aa,aa);const ya=R[0]*aa[1]-R[1]*aa[0];0<ya?ya>Ba&&(Ba=ya,pa=wa):ya<Ha&&(Ha=ya,ua=wa)}u.verify(0<Ba,"leftArea");u.verify(0>Ha,"rightArea");h.scale(ba,R,Aa);h.add(ba,ba,U);h.scale(ia,R,Ja);h.add(ia,ia,U);ma[0]=-R[1];ma[1]=R[0];za=u.rayRay2D(da,ea[ua],ia,h.add(W,ia,ma),1,za);va=u.rayRay2D(da,ea[pa],ia,W,1,va);ra=u.rayRay2D(da,ea[pa],ba,h.add(W,ba,ma),1,ra);ea=u.rayRay2D(da,ea[ua],ba,W,1,
oa);u.verify(za,"rayRay");u.verify(va,"rayRay");u.verify(ra,"rayRay");u.verify(ea,"rayRay");va=O;ea=P;da=H;ra=E;oa=la.camera.projectionMatrix;h.subtract(ka,da,ra);h.scale(ka,ka,.5);Z[0]=ka[0];Z[1]=ka[1];Z[2]=0;Z[3]=ka[1];Z[4]=-ka[0];Z[5]=0;Z[6]=ka[0]*ka[0]+ka[1]*ka[1];Z[7]=ka[0]*ka[1]-ka[1]*ka[0];Z[8]=1;Z[6]=-h.dot(k(Z,0),va);Z[7]=-h.dot(k(Z,1),va);va=h.dot(k(Z,0),da)+Z[6];za=h.dot(k(Z,1),da)+Z[7];ua=h.dot(k(Z,0),ra)+Z[6];ra=h.dot(k(Z,1),ra)+Z[7];va=-(va+ua)/(za+ra);Z[0]+=Z[1]*va;Z[3]+=Z[4]*va;Z[6]+=
Z[7]*va;va=1/(h.dot(k(Z,0),da)+Z[6]);za=1/(h.dot(k(Z,1),da)+Z[7]);Z[0]*=va;Z[3]*=va;Z[6]*=va;Z[1]*=za;Z[4]*=za;Z[7]*=za;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=1;va=h.dot(k(Z,1),ea)+Z[7];za=h.dot(k(Z,2),ea)+Z[8];ua=h.dot(k(Z,1),da)+Z[7];ra=h.dot(k(Z,2),da)+Z[8];va=-.5*(va/za+ua/ra);Z[1]+=Z[2]*va;Z[4]+=Z[5]*va;Z[7]+=Z[8]*va;va=h.dot(k(Z,1),ea)+Z[7];za=h.dot(k(Z,2),ea)+Z[8];ua=-za/va;Z[1]*=ua;Z[4]*=ua;Z[7]*=ua;oa[0]=Z[0];oa[1]=Z[1];oa[2]=0;oa[3]=Z[2];oa[4]=Z[3];oa[5]=Z[4];oa[6]=0;oa[7]=Z[5];oa[8]=0;oa[9]=
0;oa[10]=1;oa[11]=0;oa[12]=Z[6];oa[13]=Z[7];oa[14]=0;oa[15]=Z[8];la.camera.projectionMatrix[10]=2/(L[2]-K[2]);la.camera.projectionMatrix[14]=-(L[2]+K[2])/(L[2]-K[2])};fa._setupMatrices=function(ea,da){p.multiply(D,ea.projectionMatrix,ea.viewMatrix);p.invert(F,D);ea=this._viewingMode===t.ViewingMode.Global?ea.eye:f.set(M,0,0,1);p.lookAt(I,[0,0,0],[-da[0],-da[1],-da[2]],ea)};fa._clampNearFar=function(ea){let {near:da,far:la}=ea;2>da&&(da=2);2>la&&(la=2);da>=la&&(da=2,la=4);return{near:da,far:la}};fa._computeCascadeDistances=
function(ea,da){this._numCascades=Math.min(1+Math.floor(u.logWithBase(ea/da,4)),this._maxNumCascades);const la=(ea-da)/this._numCascades;ea=(ea/da)**(1/this._numCascades);let oa=da;for(let ra=0;ra<this._numCascades+1;++ra)this._cascadeDistances[ra]=r.lerp(oa,da,this._splitSchemeLambda),oa*=ea,da+=la};b._createClass(ca,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},
{key:"cascadeDistances",get:function(){return l.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this._maxNumCascades},set:function(ea){this._maxNumCascades=r.clamp(Math.floor(ea),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(ea){this._enabled=ea;ea||(this._discardDepthTexture(),
this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&m.isSome(this._depthTexture)}},{key:"gpuMemoryUsage",get:function(){return this._snapshots.reduce((ea,da)=>ea+C.getGpuMemoryUsage(da),this._fbo?.gpuMemoryUsage??0)}},{key:"test",get:function(){const ea=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(da){ea._splitSchemeLambda=da},get splitSchemeLambda(){return ea._splitSchemeLambda},set warp(da){ea._warp=
da},get warp(){return ea._warp}}}}]);return ca}();const v=g.create(),D=g.create(),F=g.create(),G=A.create(),J=[];for(let ca=0;8>ca;++ca)J.push(A.create());const L=e.create(),K=e.create(),O=d.create(),P=d.create(),N=d.create(),H=d.create(),E=d.create(),I=g.create(),M=e.create(),Q=[],T=g.create(),S=new Float32Array(64),U=d.create(),Y=d.create(),V=[d.create(),d.create(),d.create(),d.create()],R=d.create(),X=d.create(),W=d.create(),aa=d.create(),ba=d.create(),ia=d.create(),ma=d.create(),ha=d.create(),
ka=d.create(),Z=n.create();a.ShadowMap=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){function y(q,x,v,D,F,G,J){const L={layerUid:G,graphicUid:J,triangleNr:x};x=K=>{K.set(t.IntersectorType.OVERLAY,L,q.dist,q.normal,q.transformation,v,D)};(null==F.results.min.drapedLayerOrder||v>=F.results.min.drapedLayerOrder)&&(null==F.results.min.dist||F.results.ground.dist<=F.results.min.dist)&&x(F.results.min);F.options.store!==t.StoreResults.MIN&&(null==F.results.max.drapedLayerOrder||v<F.results.max.drapedLayerOrder)&&(null==F.results.max.dist||F.results.ground.dist>
F.results.max.dist)&&x(F.results.max);F.options.store===t.StoreResults.ALL&&(G=A.newIntersectorResult(F.ray),x(G),F.results.all.push(G))}a.SortedRenderGeometryRenderer=function(q){function x(D){D=q.call(this,D)||this;D._pending=new B;D._changes=new l.ChangeSet;D._materialRenderers=new Map;D._sortedMaterialRenderers=new p;D._geometries=new Map;D._hasHighlights=!1;D._hasWater=!1;return D}b._inheritsLoose(x,q);var v=x.prototype;v.destroy=function(){this._changes.prune();this._materialRenderers.forEach(D=>
D.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear()};v.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let D=!1,F=!1,G=!1;u.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((J,L)=>{let K=this._materialRenderers.get(L);!K&&0<J.adds.length&&(K=new z.MergedRenderer(this.rctx,this._materialRepository,L),this._materialRenderers.set(L,K),G=F=D=!0);if(K){var O=F||K.hasHighlights,P=G||K.hasWater;K.modify(J);
F=F||O!==K.hasHighlights;G=G||P!==K.hasWater;K.isEmpty&&(this._materialRenderers.delete(L),K.dispose(),D=!0)}});this._changes.clear();D&&this._updateSortedMaterialRenderers();F&&(this._hasHighlights=m.someMap(this._materialRenderers,J=>J.hasHighlights));G&&(this._hasWater=m.someMap(this._materialRenderers,J=>J.hasWater));this.notifyChange("updating");return!0};v.addGeometries=function(D,F){if(0!==D.length){var G=this._validateRenderGeometries(D);for(var J of G)this._geometries.set(J.id,J);J=this._pending.empty;
for(const L of G)this._pending.adds.add(L);J&&this.notifyChange("updating");F===w.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(D)}};v.removeGeometries=function(D,F){const G=this._pending.empty,J=this._pending.adds;for(const L of D)J.has(L)?(this._pending.removed.add(L),J.delete(L)):this._pending.removed.has(L)||this._pending.removes.add(L),this._geometries.delete(n.unwrap(L.id));G&&!this._pending.empty&&this.notifyChange("updating");F===w.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(D)};
v.modifyGeometries=function(D,F){const G=0===this._changes.updates.length;for(const J of D){const L=this._changes.updates.pushNew();L.renderGeometry=this._validateRenderGeometry(J);L.updateType=F}G&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case w.DirtyState.TRANSFORMATION:case w.DirtyState.VERTEXATTRS:return this._notifyGraphicGeometryChanged(D);case w.DirtyState.VISIBILITIES:return this._notifyGraphicVisibilityChanged(D)}};v.updateAnimation=function(D){let F=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:G})=>
F=G.updateAnimation(D)||F);return F};v.render=function(D,F){for(let G=0;G<this._sortedMaterialRenderers.length;G++){const J=this._sortedMaterialRenderers.data[G];J.material.shouldRender(D)&&J.materialRenderer.render(D.output,F)}};v.intersect=function(D,F,G,J,L){this._geometries.forEach(K=>{if(!J||J(K)){this._intersectRenderGeometry(K,G,F,0,D,L);var O=this.rendererContext.longitudeCyclical;O&&(K.boundingSphere[0]-K.boundingSphere[3]<O.min&&this._intersectRenderGeometry(K,G,F,O.range,D,L),K.boundingSphere[0]+
K.boundingSphere[3]>O.max&&this._intersectRenderGeometry(K,G,F,-O.range,D,L));L++}});return L};v._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let D=0;this._materialRenderers.forEach((F,G)=>{G.insertOrder=D++;this._sortedMaterialRenderers.push({material:G,materialRenderer:F})});this._sortedMaterialRenderers.sort((F,G)=>{const J=G.material.renderPriority-F.material.renderPriority;return 0!==J?J:F.material.insertOrder-G.material.insertOrder})};v._processAddsRemoves=
function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let D=0;D<this._changes.updates.length;)this._pending.has(this._changes.updates.data[D].renderGeometry)?this._changes.updates.removeUnorderedIndex(D):D++;this._pending.clear()};v._intersectRenderGeometry=function(D,F,G,J,L,K){if(D.instanceParameters.visible){var O=0;n.isSome(D.transformation)&&(J+=D.transformation[12],
O=D.transformation[13]);C[0]=G[0]-J;C[1]=G[1]-O;C[2]=1;k[0]=G[0]-J;k[1]=G[1]-O;k[2]=0;D.screenToWorldRatio=this.rendererContext.screenToWorldRatio;D.material.intersect(D,null,D.getShaderTransformation(),L,C,k,(P,N,H)=>{y(F,H,D.material.renderPriority,K,L,D.layerUid,D.graphicUid)},D.calculateShaderTransformation,F)}};v._notifyGraphicGeometryChanged=function(D){if(!n.isNone(this.drapeSource.notifyGraphicGeometryChanged))for(const G of D)if(D=G.graphicUid,n.isSome(D)&&D!==F){this.drapeSource.notifyGraphicGeometryChanged(D);
var F=D}};v._notifyGraphicVisibilityChanged=function(D){if(!n.isNone(this.drapeSource.notifyGraphicVisibilityChanged))for(const G of D)if(D=G.graphicUid,n.isSome(D)&&D!==F){this.drapeSource.notifyGraphicVisibilityChanged(D);var F=D}};v._validateRenderGeometries=function(D){for(const F of D)this._validateRenderGeometry(F);return D};v._validateRenderGeometry=function(D){n.isNone(D.origin)&&(D.origin=this._localOriginFactory.getOrigin(D.boundingSphere));return D};b._createClass(x,[{key:"updating",get:function(){return!this._pending.empty||
0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return m.someMap(this._materialRenderers,D=>D.rendersOccluded)}},{key:"isEmpty",
get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return x}(r);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,
"rendererContext",void 0);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);a.SortedRenderGeometryRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let B=function(){function q(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var x=q.prototype;x.has=function(v){return this.adds.has(v)||
this.removes.has(v)||this.removed.has(v)};x.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(q,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return q}();const C=e.create(),k=e.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){let c=
function(){function m(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:p=>p||new r,deallocator:p=>{p.renderGeometry=null;return p}})}var n=m.prototype;n.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};n.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return m}(),r=function(){};a.ChangeSet=c;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITIES=1]="VISIBILITIES";b[b.VERTEXATTRS=2]="VERTEXATTRS";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHTS=8]="HIGHLIGHTS";b[b.OCCLUDEES=16]="OCCLUDEES"})(a.DirtyState||
(a.DirtyState={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(c){const r=new Map,m=n=>{let p=r.get(n);p||(p=new b.MaterialChangeSet,r.set(n,p));return p};c.removes.forAll(n=>{1<=n.data.indexCount&&m(n.material).removes.push(n)});c.adds.forAll(n=>{1<=n.data.indexCount&&m(n.material).adds.push(n)});
c.updates.forAll(n=>{1<=n.renderGeometry.data.indexCount&&m(n.renderGeometry.material).updates.push(n)});return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/Util ../DrawParameters ../WaterMaterial ./Instance ./MergedGeometryBuffer ./MergedGeometryBufferPool ./utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){function B(O,P){const N=new Map;for(const H of O)C(N,H,!0);for(const H of P)C(N,H,!1);return N}function C(O,P,N){const H=P.origin;if(!r.isNone(H)){var E=O.get(H.id);null==E&&(E=new v(H.vec3),O.set(H.id,E));N?E.add.push(P):E.remove.push(P)}}function k(O,P){let N;if(!O.some(E=>{if(E.to-E.from<P)return!1;N=E;return!0}))return null;const H=N.from;N.from+=P;N.from>=N.to&&O.removeUnordered(N);return H}function q(O){const P=new Map;O.forAll(H=>P.set(H.from,
H));let N=!0;for(;N;)N=!1,O.forEach(H=>{const E=P.get(H.to);E&&(H.to=E.to,P.delete(E.from),O.removeUnordered(E),N=!0)})}let x=function(){function O(N,H,E){this._rctx=N;this._materialRepository=H;this._material=E;this.type="MergedRenderer";this._dataByOrigin=new Map;this._renderCommandData=new m;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new d.GLMaterials(this._material,this._materialRepository);this._bufferWriter=E.createBufferWriter();this._bufferPool=new z.MergedGeometryBufferPool(N,
E.vertexAttributeLocations,g.glLayout(this._bufferWriter.vertexBufferLayout))}var P=O.prototype;P.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(N=>N.geometry.dispose());this._dataByOrigin.clear();this._bufferPool.dispose()};P.modify=function(N){this._updateGeometries(N.updates);this._addAndRemoveGeometries(N.adds,N.removes);this._updateDrawCommands()};P._addAndRemoveGeometries=function(N,H){const E=this._bufferWriter,I=E.vertexBufferLayout.stride/4,M=this._dataByOrigin,
Q=B(N,H);Q.forEach((T,S)=>{Q.delete(S);var U=T.add.reduce((W,aa)=>W+E.elementCount(aa.data),0);let Y=M.get(S);if(null==Y)l.assert(0===T.remove.length),Y=new D(T.origin,new u.MergedGeometryBuffer(this._bufferPool,U*I)),M.set(S,Y);else if(0===T.add.length&&Y.instances.size===T.remove.length){Y.geometry.dispose();M.delete(S);return}let V=0;Y.instances.forEach(W=>V+=W.to-W.from);var R=T.remove.reduce((W,aa)=>W+E.elementCount(aa.data),0);S=Y.geometry.size;R=(V+U-R)*I;U=G;R>u.BLOCK_SIZE&&(R<S/2||1048576<
S-R)?this._removeAndRebuild(Y,T.remove,I,R,U):0<T.remove.length&&this._remove(Y,T.remove,I,U);0<T.add.length&&(S=J,l.setMatrixTranslation3(S,-T.origin[0],-T.origin[1],-T.origin[2]),this._add(Y,T.add,I,S,U));const X=Y.geometry.buffer.vao.vertexBuffers.geometry;q(U);U.forAll(({from:W,to:aa})=>{W<aa&&X.setSubData(Y.geometry.buffer.array,W,W,aa)});U.clear();Y.drawCommandsDirty=!0})};P._updateGeometries=function(N){const H=this._bufferWriter,E=H.vertexBufferLayout.stride/4;for(const I of N){N=I.renderGeometry;
const M=this._dataByOrigin.get(N.origin.id),Q=M&&M.instances.get(N.id);if(!Q)break;const T=I.updateType;T&e.DirtyState.VISIBILITIES&&(Q.isVisible=N.instanceParameters.visible);if(T&(e.DirtyState.HIGHLIGHTS|e.DirtyState.VISIBILITIES)){const S=N.instanceParameters.visible;Q.hasHighlights=!!N.instanceParameters.highlights&&S}T&e.DirtyState.OCCLUDEES&&(Q.hasOccludees=!!N.instanceParameters.occludees);if(T&(e.DirtyState.VERTEXATTRS|e.DirtyState.TRANSFORMATION)){const {array:S,vao:U}=M.geometry.buffer;
y.calculateTransformRelativeToOrigin(N,L,K);H.write(L,K,N.data,H.vertexBufferLayout.createView(S.buffer),Q.from);l.assert(Q.from+H.elementCount(N.data)===Q.to,"material VBO layout has changed");U.vertexBuffers.geometry.setSubData(S,Q.from*E,Q.from*E,Q.to*E)}M.drawCommandsDirty=!0}};P._updateDrawCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(H=>{H.hasHiddenInstances=!1;H.hasHighlights=!1;H.hasOccludees=!1;c.someMap(H.instances,E=>{E.isVisible?(E.hasHighlights&&
(this._hasHighlights=!0,H.hasHighlights=!0),E.hasOccludees&&(this._hasOccludees=!0,H.hasOccludees=!0)):H.hasHiddenInstances=!0;return H.hasHiddenInstances&&H.hasHighlights&&H.hasOccludees})});const N=H=>{H.drawCommandsDefault.clear();H.drawCommandsHighlight.clear();H.drawCommandsOccludees.clear();H.drawCommandsShadowHighlightRest.clear();if(0!==H.instances.size)if(H.hasOccludees||H.hasHighlights||H.hasHiddenInstances){var E=w.sortInstancesByRange(H.instances);for(const I of E)I.isVisible&&(I.hasOccludees?
w.addOrMerge(H.drawCommandsOccludees,I):w.addOrMerge(H.drawCommandsDefault,I),I.hasHighlights?w.addOrMerge(H.drawCommandsHighlight,I):w.addOrMerge(H.drawCommandsShadowHighlightRest,I))}else{const I=H.drawCommandsDefault.pushNew();I.first=Infinity;I.count=0;H.instances.forEach(M=>{I.first=Math.min(I.first,M.from);I.count=Math.max(I.count,M.to)});I.count-=I.first}};this._dataByOrigin.forEach(H=>{H.drawCommandsDirty&&(N(H),H.drawCommandsDirty=!1)})};P.updateAnimation=function(N){return this._material.update(N)};
P.requiresSlot=function(N,H){return this._material.requiresSlot(N,H)};P.render=function(N,H){if(!this.requiresSlot(H.slot,N))return!1;const E=N===h.ShaderOutput.Highlight||N===h.ShaderOutput.ShadowHighlight;if(E&&!this._hasHighlights)return!1;const I=N===h.ShaderOutput.ShadowExludeHighlight,M=!(E||I);this._dataByOrigin.forEach(U=>{if(!E||U.hasHighlights){var Y=(E?U.drawCommandsHighlight:I&&(U.hasOccludees||U.hasHighlights||U.hasHiddenInstances)?U.drawCommandsShadowHighlightRest:U.drawCommandsDefault)||
null,V=M&&U.drawCommandsOccludees||null;(Y?.length||V?.length)&&this._renderCommandData.push(new F(U.origin,U.geometry,Y,V))}});if(0===this._renderCommandData.length)return!1;const Q=this._rctx;N=this._glMaterials.load(Q,H.slot,N);if(r.isNone(N))return this._renderCommandData.clear(),!1;const T=N.beginSlot(H),S=Q.bindTechnique(T,this._material.parameters,H);this._renderCommandData.forAll(U=>{S.bindDraw(U,H,this._material.parameters);const {geometry:Y,renderCommands:V,occludeeCommands:R}=U;T.ensureAttributeLocations(Y.buffer.vao);
Q.bindVAO(Y.buffer.vao);const X=T.primitiveType;r.isSome(V)&&0<V.length&&(T.bindPipelineState(Q,H.slot,!1),V.forAll(W=>Q.drawArrays(X,W.first,W.count)));r.isSome(R)&&0<R.length&&(T.bindPipelineState(Q,H.slot,!0),R.forAll(W=>Q.drawArrays(X,W.first,W.count)))});this._renderCommandData.clear();return!0};P._removeAndRebuild=function(N,H,E,I,M){for(var Q of H)N.instances.delete(Q.id);var T=w.sortInstancesByRange(N.instances);N.instances.clear();H=N.geometry.size;I=N.geometry.allocate(I);Q=0;for(const S of T){T=
S.from*E;const U=S.to*E;I.copy(Q,T,U);S.from=Q/E;Q+=U-T;S.to=Q/E;N.instances.set(S.id,S)}M.push(new w.BufferRange(0,I.hasNewBuffer?N.geometry.buffer.array.length:H));I.dispose();N.geometry.erase(Q,M.back().to);N.holes.clear()};P._remove=function(N,H,E,I){for(const M of H){H=M.id;const Q=N.instances.get(H),T=Q.from*E,S=Q.to*E;N.geometry.erase(T,S);N.holes.push(new w.BufferRange(Q.from,Q.to));N.instances.delete(H);I.push(new w.BufferRange(T,S))}q(N.holes)};P._add=function(N,H,E,I,M){if(0!==H.length){var Q=
this._bufferWriter,T=Q.vertexBufferLayout.createView(N.geometry.buffer.array.buffer),S=0<N.holes.length,U=Number.MAX_SAFE_INTEGER,Y=Number.MIN_SAFE_INTEGER;for(const R of H){var V=r.isSome(R.transformation)?n.multiply(L,I,R.transformation):I;n.invert(K,V);const X=n.transpose(K,K);H=Q.elementCount(R.data);const W=H*E;let aa=k(N.holes,H);r.isNone(aa)&&(aa=N.geometry.size/E,N.geometry.grow(W),T=Q.vertexBufferLayout.createView(N.geometry.buffer.array.buffer));Q.write(V,X,R.data,T,aa);V=R.instanceParameters.visible;
H=new w.Instance(R.id,aa,aa+H,V,!!R.instanceParameters.highlights&&V,!!R.instanceParameters.occludees);l.assert(null==N.instances.get(R.id));N.instances.set(R.id,H);S?M.push(new w.BufferRange(H.from*E,H.to*E)):(U=Math.min(H.from,U),Y=Math.max(H.to,Y))}S||M.push(new w.BufferRange(U*E,Y*E))}};b._createClass(O,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},
{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof t.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==f.RenderOccludedFlag.Occlude}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return O}(),v=function(O){this.origin=O;this.add=[];this.remove=[]},D=function(O,P){this.origin=O;this.geometry=P;this.instances=new Map;this.holes=new m({deallocator:null});
this.drawCommandsDirty=this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDefault=new m({allocator:N=>N||new w.DrawCommand,deallocator:N=>N});this.drawCommandsHighlight=new m({allocator:N=>N||new w.DrawCommand,deallocator:N=>N});this.drawCommandsOccludees=new m({allocator:N=>N||new w.DrawCommand,deallocator:N=>N});this.drawCommandsShadowHighlightRest=new m({allocator:N=>N||new w.DrawCommand,deallocator:N=>N})},F=function(O){function P(N,H,E,I){N=O.call(this,N)||this;
N.geometry=H;N.renderCommands=E;N.occludeeCommands=I;return N}b._inheritsLoose(P,O);return P}(A.DrawParameters);const G=new m({deallocator:null}),J=p.create(),L=p.create(),K=p.create();a.MergedRenderer=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../core/maybe","./basicInterfaces"],function(a,b,c){let r=function(){function m(p,g){this._material=p;this._repository=g;
this._map=new Map}var n=m.prototype;n.destroy=function(){this._map.forEach((p,g)=>{b.isSome(p)&&this._repository.release(this._material,g)})};n.load=function(p,g,h){if(!this._material.requiresSlot(g,h))return null;this._map.has(h)||this._map.set(h,this._repository.acquire(this._material,g,h));g=this._map.get(h);if(b.isSome(g)){if(g.ensureResources(p)===c.ResourceState.LOADED)return g;this._repository.requestRender()}return null};return m}();a.GLMaterials=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,r){r=function(m){function n(p=c.create()){var g=m.call(this)||this;g.origin=p;g.slicePlaneLocalOrigin=g.origin;return g}b._inheritsLoose(n,m);return n}(r.VertexNormalDrawParameters);a.DrawParameters=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),function(a,b,c,r,m,n,p,g,h){let d=function(e){function l(){var A=e.apply(this,
arguments)||this;A.transformNormalViewFromGlobal=c.create();return A}b._inheritsLoose(l,e);return l}(n.VertexPositionPassParameters),f=function(e){function l(){var A=e.apply(this,arguments)||this;A.transformNormalGlobalFromModel=c.create();A.toMapSpace=r.create();return A}b._inheritsLoose(l,e);return l}(n.VertexPositionDrawParameters);a.VertexNormal=function(e,l){l.normalType===m.NormalAttributeType.Attribute||l.normalType===m.NormalAttributeType.CompressedAttribute?(e.include(m.NormalAttribute,l),
e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new g.Matrix3DrawUniform("transformNormalGlobalFromModel",A=>A.transformNormalGlobalFromModel),new h.Matrix3PassUniform("transformNormalViewFromGlobal",A=>A.transformNormalViewFromGlobal)]),e.vertex.code.add(p.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):l.normalType===m.NormalAttributeType.Ground?(e.include(n.VertexPosition,l),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(p.glsl`
    void forwardNormal() {
      vNormalWorld = ${l.spherical?p.glsl`normalize(vPositionWorldCameraRelative);`:p.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(p.glsl`void forwardNormal() {}`)};a.VertexNormalDrawParameters=f;a.VertexNormalPassParameters=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,r){a.NormalAttributeType=void 0;(function(m){m[m.Attribute=0]="Attribute";
m[m.CompressedAttribute=1]="CompressedAttribute";m[m.Ground=2]="Ground";m[m.ScreenDerivative=3]="ScreenDerivative";m[m.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(m,n){n.normalType===a.NormalAttributeType.Attribute&&(m.attributes.add(r.VertexAttribute.NORMAL,"vec3"),m.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`));n.normalType===a.NormalAttributeType.CompressedAttribute&&(m.include(b.DecodeNormal),m.attributes.add(r.VertexAttribute.NORMALCOMPRESSED,"vec2"),m.vertex.code.add(c.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));n.normalType===a.NormalAttributeType.ScreenDerivative&&(m.extensions.add("GL_OES_standard_derivatives"),m.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const r=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.vertex.code.add(r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(u){function z(B){B=u.call(this,B,new w)||this;B._configuration=new e.WaterTechniqueConfiguration;B.animation=new p.AnimationTimer;return B}b._inheritsLoose(z,u);var y=z.prototype;y.getConfiguration=function(B,C){this._configuration.output=B;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=C.transparencyPassType;this._configuration.enableOffset=C.camera.relativeElevation<h.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=C.multipassTerrain.enabled;this._configuration.cullAboveGround=C.multipassTerrain.cullAboveGround;
return this._configuration};y.update=function(B){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(B.camera.relativeElevation,B.camera.distance);B=this.animation.advance(B);this.setParameters({timeElapsed:c.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&B};y.intersect=function(B,C,k,q,x,v,D){A.intersectTriangleGeometry(B,C,q,x,v,void 0,D)};y.requiresSlot=function(B,C){switch(C){case n.ShaderOutput.Normal:return B===
d.RenderSlot.DRAPED_WATER;case n.ShaderOutput.Color:if(this.parameters.isDraped)return B===d.RenderSlot.DRAPED_MATERIAL;break;case n.ShaderOutput.Alpha:break;case n.ShaderOutput.Highlight:return B===d.RenderSlot.OPAQUE_MATERIAL||B===d.RenderSlot.DRAPED_MATERIAL;default:return!1}C=d.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(C=this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return B===C};y.createGLMaterial=function(B){return new f.WaterGLMaterial(B)};
y.createBufferWriter=function(){return new l.DefaultBufferWriter(l.PositionUVLayout)};return z}(g.Material),w=function(u){function z(){var y=u.apply(this,arguments)||this;y.waveStrength=.06;y.waveTextureRepeat=32;y.waveDirection=r.fromValues(1,0);y.waveVelocity=.05;y.flowStrength=.015;y.flowOffset=-.5;y.animationSpeed=.35;y.timeElapsed=0;y.color=m.fromValues(0,0,0,0);y.transparent=!0;y.writeDepth=!0;y.hasSlicePlane=!1;y.isDraped=!1;y.receiveShadows=!0;y.hasScreenSpaceReflections=!1;y.hasCloudsReflections=
!1;return y}b._inheritsLoose(z,u);return z}(g.MaterialParameters);a.WaterMaterial=t;a.WaterMaterialParameters=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,r,m,n){m=function(p){function g(){return p.apply(this,
arguments)||this}b._inheritsLoose(g,p);var h=g.prototype;h._updateShadowState=function(d){d.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:d.shadowMap.enabled})};h._updateSSRState=function(d){d.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:d.ssr.enabled})};h._updateCloudsReflectionState=function(d){d=c.isSome(d.cloudsFade.data);d!==this._material.parameters.hasCloudsReflections&&
this._material.setParameters({hasCloudsReflections:d})};h.ensureResources=function(d){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(d)};h.beginSlot=function(d){this._output===r.ShaderOutput.Color&&(this._updateShadowState(d),this._updateSSRState(d),this._updateCloudsReflectionState(d));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(n.WaterTechnique,d)};return g}(m);
a.WaterGLMaterial=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){g=function(C){function k(){return C.apply(this,arguments)||this}c._inheritsLoose(k,C);return k}(g.WaterDistortionPassParameters);f=function(C){function k(){return C.apply(this,arguments)||this}c._inheritsLoose(k,C);var q=k.prototype;q.initializeConfiguration=function(x,v){v.hasWebGL2Context=x.rctx.type===y.ContextType.WEBGL2;v.spherical=x.viewingMode===m.ViewingMode.Global;v.doublePrecisionRequiresObfuscation=h.doublePrecisionRequiresObfuscation(x.rctx)};
q.initializeProgram=function(x){return new t.Program(x.rctx,k.shader.get().build(this.configuration),l.Default3D)};q._setPipelineState=function(x){const v=this.configuration,D=x===w.TransparencyPassType.NONE,F=x===w.TransparencyPassType.FrontFace;return B.makePipelineState({blending:v.output!==n.ShaderOutput.Normal&&v.output!==n.ShaderOutput.Highlight&&v.transparent?D?A.blendingDefault:A.oitBlending(x):null,depthTest:{func:A.oitDepthTest(x)},depthWrite:D?v.writeDepth&&B.defaultDepthWriteParams:A.oitDepthWrite(x),
colorWrite:B.defaultColorWriteParams,polygonOffset:D||F?null:A.getOITPolygonOffset(v.enableOffset)})};q.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return k}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(z.WaterSurface,()=>new Promise((C,k)=>a(["../shaders/WaterSurface.glsl"],C,k)));d=function(C){function k(){var q=C.apply(this,arguments)||this;q.output=n.ShaderOutput.Color;q.transparencyPassType=w.TransparencyPassType.NONE;q.spherical=
!1;q.receiveShadows=!1;q.hasSlicePlane=!1;q.transparent=!1;q.enableOffset=!0;q.writeDepth=!1;q.hasScreenSpaceReflections=!1;q.doublePrecisionRequiresObfuscation=!1;q.hasCloudsReflections=!1;q.isDraped=!1;q.hasMultipassTerrain=!1;q.cullAboveGround=!1;return q}c._inheritsLoose(k,C);return k}(u.DefaultTechniqueConfiguration);r.__decorate([e.parameter({count:n.ShaderOutput.COUNT})],d.prototype,"output",void 0);r.__decorate([e.parameter({count:w.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",
void 0);r.__decorate([e.parameter()],d.prototype,"spherical",void 0);r.__decorate([e.parameter()],d.prototype,"receiveShadows",void 0);r.__decorate([e.parameter()],d.prototype,"hasSlicePlane",void 0);r.__decorate([e.parameter()],d.prototype,"transparent",void 0);r.__decorate([e.parameter()],d.prototype,"enableOffset",void 0);r.__decorate([e.parameter()],d.prototype,"writeDepth",void 0);r.__decorate([e.parameter()],d.prototype,"hasScreenSpaceReflections",void 0);r.__decorate([e.parameter()],d.prototype,
"doublePrecisionRequiresObfuscation",void 0);r.__decorate([e.parameter()],d.prototype,"hasCloudsReflections",void 0);r.__decorate([e.parameter()],d.prototype,"isDraped",void 0);r.__decorate([e.parameter()],d.prototype,"hasMultipassTerrain",void 0);r.__decorate([e.parameter()],d.prototype,"cullAboveGround",void 0);r.__decorate([e.parameter({constValue:p.PBRMode.Water})],d.prototype,"pbrMode",void 0);r.__decorate([e.parameter({constValue:!0})],d.prototype,"useCustomDTRExponentForWater",void 0);r.__decorate([e.parameter({constValue:!0})],
d.prototype,"highStepCount",void 0);r.__decorate([e.parameter({constValue:!1})],d.prototype,"useFillLights",void 0);b.WaterMaterialPassParameters=g;b.WaterTechnique=f;b.WaterTechniqueConfiguration=d;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){let e=function(t){function w(){return t.apply(this,arguments)||this}b._inheritsLoose(w,t);return w}(d.NoParameters);const l=n.create(),A=r.create();a.WaterDistortion=function(t){t.fragment.uniforms.add(new f.Texture2DPassUniform("texWaveNormal",w=>w.waveNormal));t.fragment.uniforms.add(new f.Texture2DPassUniform("texWavePerturbation",w=>w.wavePertubation));t.fragment.uniforms.add([new h.Float4PassUniform("waveParams",w=>m.set(l,w.waveStrength,w.waveTextureRepeat,w.flowStrength,
w.flowOffset)),new g.Float2PassUniform("waveDirection",w=>c.set(A,w.waveDirection[0]*w.waveVelocity,w.waveDirection[1]*w.waveVelocity))]);t.include(p.FoamIntensity);t.fragment.code.add(d.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){function x(D){const F=new C.ShaderBuilder,{vertex:G,fragment:J}=F;u.addProjViewLocalOrigin(G,D);F.include(m.Transform,D);F.attributes.add(q.VertexAttribute.POSITION,"vec3");F.attributes.add(q.VertexAttribute.UV0,"vec2");const L=new z.Float4PassUniform("waterColor",K=>K.color);if(D.output===c.ShaderOutput.Color&&D.isDraped)return F.varyings.add("vpos","vec3"),G.uniforms.add(L),G.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(t.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),J.uniforms.add(L),J.code.add(B.glsl`void main() {
gl_FragColor = waterColor;
}`),F;if(D.output===c.ShaderOutput.Color||D.output===c.ShaderOutput.Alpha)F.include(d.NormalUtils,D),F.include(b.ForwardLinearDepth,D),F.varyings.add("vuv","vec2"),F.varyings.add("vpos","vec3"),F.varyings.add("vnormal","vec3"),F.varyings.add("vtbnMatrix","mat3"),D.hasMultipassTerrain&&F.varyings.add("depth","float"),G.uniforms.add(L),G.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(t.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${D.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${D.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);F.include(h.multipassTerrainTest,D);switch(D.output){case c.ShaderOutput.Alpha:F.include(r.SliceDraw,D);J.uniforms.add(L);J.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${D.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case c.ShaderOutput.Color:F.include(g.MainLighting,D);F.include(p.EvaluateAmbientLighting,{pbrMode:f.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});F.include(A.WaterDistortion);F.include(r.SliceDraw,D);F.include(e.ReadShadowMapDraw,D);F.include(l.Water,D);J.uniforms.add([L,new y.FloatPassUniform("timeElapsed",K=>K.timeElapsed),G.uniforms.get("view"),G.uniforms.get("localOrigin")]);u.addCameraPosition(J,D);J.include(w.ColorConversion);g.addMainLightDirection(J);g.addMainLightIntensity(J);
J.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${D.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${D.receiveShadows?B.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${D.transparencyPassType===k.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case c.ShaderOutput.Normal:F.include(d.NormalUtils,D);F.include(A.WaterDistortion,D);F.include(r.SliceDraw,D);F.varyings.add("vpos","vec3");F.varyings.add("vuv","vec2");G.uniforms.add(L);G.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(t.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);J.uniforms.add(new y.FloatPassUniform("timeElapsed",K=>K.timeElapsed));J.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case c.ShaderOutput.Highlight:F.include(n.OutputHighlight,D),F.varyings.add("vpos","vec3"),G.uniforms.add(L),G.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(t.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),F.include(r.SliceDraw,D),J.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return F}const v=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=v;a.build=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(c,r){r.spherical?c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);r.spherical?c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../util/WebGL2Utils ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(t,w){t=t.fragment;t.include(r.RgbaFloatEncoding);t.uniforms.add([...f.createTexture2DPassSizeUniforms("shadowMapTex",(u,z)=>z.shadowMap.depthTexture,w.hasWebGL2Context?e.TextureSizeUniformType.None:e.TextureSizeUniformType.Size),new p.IntegerPassUniform("numCascades",(u,z)=>z.shadowMap.numCascades),new n.Float4PassUniform("cascadeDistances",(u,z)=>z.shadowMap.cascadeDistances)]);t.code.add(g.glsl`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${m.textureSize(w,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}let A=function(t){function w(){var u=t.apply(this,arguments)||this;u.origin=c.create();return u}b._inheritsLoose(w,t);return w}(g.NoParameters);a.ReadShadowMapBindParameters=A;a.ReadShadowMapDraw=function(t,w){w.receiveShadows&&(t.fragment.uniforms.add(new h.Matrix4sDrawUniform("shadowMapMatrix",(u,z)=>z.shadowMap.getShadowMapMatrices(u.origin),4)),l(t,w))};a.ReadShadowMapPass=function(t,w){w.receiveShadows&&(t.fragment.uniforms.add(new d.Matrix4sPassUniform("shadowMapMatrix",(u,z)=>z.shadowMap.getShadowMapMatrices(u.origin),
4)),l(t,w))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"int",r.BindType.Pass,(h,d,f)=>h.setUniform1i(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.IntegerPassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g,h){return m.call(this,p,"mat4",r.BindType.Draw,(d,f,e)=>d.setUniformMatrix4fv(p,g(f,e)),h)||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix4sDrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g,h){return m.call(this,p,"mat4",r.BindType.Pass,(d,f,e)=>d.setUniformMatrix4fv(p,g(f,e)),h)||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Matrix4sPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,r,m,n,p,g,h,d){a.Water=function(f,e){f.include(r.PhysicallyBasedRendering,e);f.include(c.Gamma);f.include(b.FoamColor);
e.hasCloudsReflections&&f.include(n.CloudsParallaxShading,e);e.hasScreenSpaceReflections&&f.include(m.ScreenSpaceReflections,e);f=f.fragment;f.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor",
"float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);f.code.add(g.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);f.uniforms.add([new p.FloatPassUniform("lightingSpecularStrength",(l,A)=>A.lighting.mainLight.specularStrength),new p.FloatPassUniform("lightingEnvironmentStrength",(l,A)=>A.lighting.mainLight.environmentStrength)]);f.code.add(g.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);e.hasCloudsReflections&&f.code.add(g.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);e.hasScreenSpaceReflections?(f.uniforms.add(new h.Matrix4PassUniform("view",(l,A)=>A.ssr.camera.viewMatrix)),f.uniforms.add(new d.Texture2DPassUniform("lastFrameColorMap",(l,A)=>A.ssr.lastFrameColorTexture)),f.code.add(g.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`)):f.code.add(g.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);e.hasCloudsReflections?e.hasScreenSpaceReflections?f.code.add(g.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):f.code.add(g.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):f.code.add(g.glsl`return waterRenderedColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,r,m){a.PhysicallyBasedRendering=function(n,p){const g=n.fragment.code;n.include(r.PiUtils);if(p.pbrMode===c.PBRMode.Water||p.pbrMode===c.PBRMode.WaterOnIntegratedMesh)g.add(m.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${p.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),g.add(m.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),g.add(m.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),g.add(m.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),g.add(m.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(p.pbrMode===c.PBRMode.Normal||p.pbrMode===c.PBRMode.Schematic)n.include(b.AnalyticalSkyModel),g.add(m.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),g.add(m.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),g.add(m.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),g.add(m.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),g.add(m.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),g.add(m.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/VertexAttribute","./bufferWriterUtils"],function(a,b,c,r){const m=b.newLayout().vec3f(c.VertexAttribute.POSITION),n=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0),p=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR),
g=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR),h=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);let d=function(){function f(l){this.vertexBufferLayout=l}var e=f.prototype;e.allocate=function(l){return this.vertexBufferLayout.createBuffer(l)};
e.elementCount=function(l){return l.indices.get(c.VertexAttribute.POSITION).length};e.write=function(l,A,t,w,u){r.writeDefaultAttributes(t,this.vertexBufferLayout,l,A,w,u)};return f}();a.DefaultBufferWriter=d;a.PositionColorLayout=p;a.PositionColorLayoutObjectAndLayerId=b;a.PositionLayout=m;a.PositionLayoutObjectAndLayerId=g;a.PositionUVLayout=n;a.PositionUVLayoutObjectAndLayerId=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(n,p){return n.from===p.from?n.to-p.to:n.from-p.from}let r=function(n=0,p=0){this.from=n;this.to=p},m=function(n){function p(g,h,d,f,e,l){h=n.call(this,h,d)||this;h.id=g;h.isVisible=f;h.hasHighlights=e;h.hasOccludees=l;return h}b._inheritsLoose(p,n);return p}(r);a.BufferRange=r;a.DrawCommand=function(){this.count=this.first=0};a.Instance=m;a.addOrMerge=function(n,p){const g=n.back();null==g?(n=n.pushNew(),n.first=p.from,n.count=
p.to-p.from):g.first+g.count>=p.from?g.count=p.from-g.first+p.to-p.from:(n=n.pushNew(),n.first=p.from,n.count=p.to-p.from)};a.sortInstancesByRange=function(n){return Array.from(n.values()).sort(c)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(m,n,p){return n<=p?m>=p?m:65536*Math.ceil(Math.max(2*
m,p)/65536):m<=2*p?m:65536*Math.ceil(p/65536)}let r=function(){function m(p,g){this._pool=p;this._size=0;this._buffer=p.newBuffer(65536*Math.ceil(g/65536))}var n=m.prototype;n.dispose=function(){this._buffer=this._pool.deleteBuffer(this._buffer);this._size=0};n.release=function(){this.erase(0,this._size);this.dispose()};n.grow=function(p){this._resize(this._size+p,!0).dispose()};n.allocate=function(p){return this._resize(p,!1)};n._resize=function(p,g){let h;const d=c(this._buffer.length,this._size,
p);if(this._buffer.length!==d){const e=this._pool.newBuffer(d);g&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,d))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.length));h=this._buffer;this._buffer=e}const f=this._size;this._size=p;return h?{dispose:()=>{h.array.fill(0,0,f);this._pool.deleteBuffer(h)},copy:(e,l,A)=>this._buffer.array.set(h.array.subarray(l,A),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,l,A)=>{e!==l&&this._buffer.array.copyWithin(e,l,A)},hasNewBuffer:!1}};
n.erase=function(p,g){this._buffer.array.fill(0,p,g)};b._createClass(m,[{key:"buffer",get:function(){return this._buffer}},{key:"size",get:function(){return this._size}}]);return m}();a.BLOCK_SIZE=65536;a.MergedGeometryBuffer=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBufferPool":function(){define(["exports","../../../../../core/maybe","../../../../../core/MemCache","../../../../../core/uid",
"../../lib/StaticFloat32ArrayObject"],function(a,b,c,r,m){function n(h,d){if(d===c.RemoveMode.ALL)h.forEach(f=>f.dispose());else return d=h.pop(),h=h.length*d.array.byteLength,d.dispose(),h}const p=c.MIN_PRIORITY+1;let g=function(){function h(f,e,l){this._rctx=f;this._locations=e;this._layout=l;this._cache=f.newCache(`MergedRenderer pool ${r.generateUID()}`,n)}var d=h.prototype;d.dispose=function(){this._cache.destroy()};d.newBuffer=function(f){const e=f.toString(),l=this._cache.pop(e);return b.isSome(l)?
(f=l.pop(),0<l.length&&this._cache.put(e,l,f.array.byteLength*l.length,p),f):new m.StaticFloat32ArrayObject(this._rctx,this._locations,this._layout,f)};d.deleteBuffer=function(f){const e=f.array.byteLength,l=f.array.length.toString(),A=this._cache.pop(l);b.isSome(A)?(A.push(f),this._cache.put(l,A,e*A.length,-1)):this._cache.put(l,[f],e,-1);return null};return h}();a.MergedGeometryBufferPool=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StaticFloat32ArrayObject":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./VertexArrayObject","../../../webgl/BufferObject","../../../webgl/enums"],function(a,b,c,r,m){let n=function(){function p(g,h,d,f){this.vao=new c.VertexArrayObject(g,h,{geometry:d},{geometry:r.BufferObject.createVertex(g,m.Usage.STATIC_DRAW)});this.array=new Float32Array(f);this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}p.prototype.dispose=function(){this.vao.dispose(!0)};b._createClass(p,[{key:"length",get:function(){return this.array.length}}]);
return p}();a.StaticFloat32ArrayObject=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../support/requestImageUtils ./glUtil3D ./SSAOBlurTechnique ./SSAOTechnique ../shaders/SSAOParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(){function w(z,y,B){this._techniqueRepository=z;this._rctx=y;this._requestRender=B;this._enabled=!1;this._quadVAO=null;this._passParameters=new d.SSAOPassParameters;this._drawParameters=new d.BlurDrawParameters}var u=w.prototype;u.dispose=function(){this._quadVAO=r.disposeMaybe(this._quadVAO)};u.disposeOffscreenBuffers=function(){r.applySome(this._ssaoFBO,z=>z.resize(0,0));r.applySome(this._blur0FBO,z=>z.resize(0,0));r.applySome(this._blur1FBO,
z=>z.resize(0,0))};u.computeSSAO=function(z,y,B){if(!(!this.enabled||r.isNone(y)||r.isNone(B)||r.isNone(this._passParameters.noiseTexture)||r.isNone(this._ssaoFBO)||r.isNone(this._blur0FBO)||r.isNone(this._blur1FBO))){var C=this._rctx,k=z.camera;this._passParameters.normalTexture=B;this._passParameters.depthTexture=y;this._passParameters.projScale=1/k.computeRenderPixelSizeAtDist(1);y=k.fullViewport;B=y[2];k=y[3];var q=B/2,x=k/2;this._ssaoFBO.resize(B,k);this._blur0FBO.resize(q,x);this._blur1FBO.resize(q,
x);r.isNone(this._quadVAO)&&(this._quadVAO=p.createQuadVAO(this._rctx));C.bindFramebuffer(this._ssaoFBO);C.setViewport(0,0,B,k);C.bindTechnique(this._ssaoTechnique,this._passParameters,z).bindDraw(this._drawParameters,z,this._passParameters);C.bindVAO(this._quadVAO);C.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,A.vertexCount(this._quadVAO,"geometry"));var v=C.bindTechnique(this._blurTechnique,this._passParameters,z);C.setViewport(0,0,q,x);C.bindFramebuffer(this._blur0FBO);this._drawParameters.colorTexture=
this._ssaoFBO.colorTexture;m.set(this._drawParameters.blurSize,0,2/k);v.bindDraw(this._drawParameters,z,this._passParameters);C.setViewport(0,0,q,x);C.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,A.vertexCount(this._quadVAO,"geometry"));C.bindFramebuffer(this._blur1FBO);this._drawParameters.colorTexture=this._blur0FBO.colorTexture;m.set(this._drawParameters.blurSize,2/B,0);v.bindDraw(this._drawParameters,z,this._passParameters);C.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,A.vertexCount(this._quadVAO,
"geometry"));C.setViewport(y[0],y[1],y[2],y[3])}};u._selectPrograms=function(){r.isNone(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(h.SSAOTechnique));r.isNone(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(g.SSAOBlurTechnique))};u._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};u._loadResources=function(z){this._data?z():(new Promise((y,B)=>a(["./SSAOHelperData"],y,B))).then(y=>
{this._data=y;z()})};u._initialize=function(){const z={target:f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,samplingMode:f.TextureSamplingMode.LINEAR,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},y={colorTarget:f.TargetType.TEXTURE,depthStencilTarget:f.DepthStencilTargetType.NONE};n.requestImage(this._data.noiseTexture).then(B=>{this._enabled&&(this._ssaoFBO=new e.FramebufferObject(this._rctx,y,z),this._blur0FBO=new e.FramebufferObject(this._rctx,
y,z),this._blur1FBO=new e.FramebufferObject(this._rctx,y,z),this._passParameters.noiseTexture=new l.Texture(this._rctx,{target:f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:B.width,height:B.height},B),this._requestRender())});this._selectPrograms()};u._disable=function(){this._enabled=!1;this._passParameters.noiseTexture=r.disposeMaybe(this._passParameters.noiseTexture);this._blur1FBO=r.disposeMaybe(this._blur1FBO);this._blur0FBO=r.disposeMaybe(this._blur0FBO);
this._ssaoFBO=r.disposeMaybe(this._ssaoFBO)};c._createClass(w,[{key:"enabled",get:function(){return this._enabled},set:function(z){z?this._enable():this._disable()}},{key:"ready",get:function(){return this.enabled&&r.isSome(this._passParameters.noiseTexture)&&r.isSome(this._ssaoFBO)&&r.isSome(this._blur0FBO)&&r.isSome(this._blur1FBO)}},{key:"loading",get:function(){return this.enabled&&!this.ready}},{key:"colorTexture",get:function(){return r.isSome(this._blur1FBO)?this._blur1FBO.colorTexture:null}},
{key:"width",get:function(){return r.isSome(this._ssaoFBO)?this._ssaoFBO.width:-1}},{key:"height",get:function(){return r.isSome(this._ssaoFBO)?this._ssaoFBO.height:-1}},{key:"gpuMemoryUsage",get:function(){return(r.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(r.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(r.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return w}();b.SSAOHelper=t;b.blurSizePixels=
2;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAOBlur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,
arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.SSAOBlur,()=>new Promise((d,f)=>a(["../shaders/SSAOBlur.glsl"],d,f)));b.SSAOBlurTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(){const A=new h.ShaderBuilder,t=A.fragment;A.include(c.ScreenSpacePass);t.include(r.ReadLinearDepth);t.uniforms.add([new f.Texture2DPassUniform("depthMap",w=>w.depthTexture),new d.Texture2DDrawUniform("tex",w=>w.colorTexture),new m.Float2DrawUniform("blurSize",w=>w.blurSize),new p.FloatPassUniform("projScale",(w,u)=>{u=b.distance(u.camera.eye,u.camera.center);return 5E4<u?Math.max(0,w.projScale-(u-5E4)):w.projScale}),new n.Float2PassUniform("nearFar",(w,
u)=>u.camera.nearFar)]);t.code.add(g.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${g.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);t.code.add(g.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${g.glsl.int(4)}; r <= ${g.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `);return A}const l=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=l;a.build=e})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h){m=
function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.SSAO,()=>new Promise((d,f)=>a(["../shaders/SSAO.glsl"],d,f)));b.SSAOTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/SSAO.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(){const w=new f.ShaderBuilder,u=w.fragment;w.include(m.ScreenSpacePass);u.include(n.ReadLinearDepth);w.include(p.CameraSpace);u.uniforms.add(new h.FloatPassUniform("radius",(z,y)=>A(y)));u.code.add(d.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`);u.code.add(d.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);u.uniforms.add([new g.Float2PassUniform("nearFar",(z,y)=>y.camera.nearFar),new e.Texture2DPassUniform("normalMap",z=>z.normalTexture),new e.Texture2DPassUniform("depthMap",z=>z.depthTexture),new g.Float2PassUniform("zScale",(z,y)=>p.getZScale(y)),new h.FloatPassUniform("projScale",z=>z.projScale),new e.Texture2DPassUniform("rnm",z=>z.noiseTexture),new g.Float2PassUniform("rnmScale",(z,y)=>c.set(t,y.camera.fullWidth/b.unwrap(z.noiseTexture).descriptor.width,y.camera.fullHeight/b.unwrap(z.noiseTexture).descriptor.height)),
new h.FloatPassUniform("intensity",(z,y)=>2/A(y)**6),new g.Float2PassUniform("screenSize",(z,y)=>c.set(t,y.camera.fullWidth,y.camera.fullHeight))]);u.code.add(d.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${d.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${d.glsl.int(16)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `);return w}function A(w){return Math.max(10,20*w.camera.computeRenderPixelSizeAtDist(Math.abs(4*w.camera.relativeElevation)))}const t=r.create();r=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.SSAO=r;a.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,r,m,n,p,g){function h(e){return 0===e.camera.projectionMatrix[11]?b.set(f,0,1):b.set(f,1,0)}const d=m.create(),f=c.create();a.CameraSpace=function(e){e.fragment.uniforms.add(new p.Float4PassUniform("projInfo",(l,A)=>{l=A.camera.projectionMatrix;A=0===l[11]?r.set(d,2/(A.camera.fullWidth*l[0]),2/(A.camera.fullHeight*l[5]),(1+l[12])/l[0],(1+l[13])/l[5]):r.set(d,-2/(A.camera.fullWidth*l[0]),-2/(A.camera.fullHeight*l[5]),(1-l[8])/l[0],(1-l[9])/l[5]);return A}));e.fragment.uniforms.add(new n.Float2PassUniform("zScale",
(l,A)=>h(A)));e.fragment.code.add(g.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/SSAOParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../core/shaderModules/interfaces"],function(a,b,c,r){let m=function(g){function h(){var d=g.apply(this,arguments)||this;d.projScale=1;return d}b._inheritsLoose(h,g);return h}(r.NoParameters),n=function(g){function h(){return g.apply(this,
arguments)||this}b._inheritsLoose(h,g);return h}(m);r=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);return h}(r.NoParameters);let p=function(g){function h(){var d=g.apply(this,arguments)||this;d.blurSize=c.create();return d}b._inheritsLoose(h,g);return h}(r);a.BlurDrawParameters=p;a.BlurPassParameters=m;a.SSAODrawParameters=r;a.SSAOPassParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d){n=function(f){function e(){return f.apply(this,arguments)||this}c._inheritsLoose(e,f);var l=e.prototype;l.initializeProgram=function(A){return new g.Program(A.rctx,e.shader.get().build(),p.Default3D)};l.initializePipeline=function(){return this.configuration.hasAlpha?d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return e}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(r.TextureOnly,()=>new Promise((f,e)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],f,e)));b.TextureTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6",
"../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.hasAlpha=!1;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter()],m.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){function v(E){let I=g.newLayout();I=E.instancedDoublePrecision?I.vec3f(z.VertexAttribute.MODELORIGINHI).vec3f(z.VertexAttribute.MODELORIGINLO).mat3f(z.VertexAttribute.MODEL).mat3f(z.VertexAttribute.MODELNORMAL):I.mat4f(z.VertexAttribute.MODEL).mat4f(z.VertexAttribute.MODELNORMAL);r.isSome(E.instanced)&&E.instanced.includes("color")&&(I=I.vec4f(z.VertexAttribute.INSTANCECOLOR));r.isSome(E.instanced)&&E.instanced.includes("featureAttribute")&&
(I=I.vec4f(z.VertexAttribute.INSTANCEFEATUREATTRIBUTE));r.isSome(E.instanced)&&E.instanced.includes("objectAndLayerIdColor")&&(I=I.vec4u8(z.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED));return I}t=function(E){function I(Q){var T=E.call(this,Q,F)||this;T.supportsEdges=!0;T._configuration=new q.DefaultMaterialTechniqueConfiguration;var S=T.parameters;const U=S.textureId||S.normalTextureId||S.metallicRoughnessTextureId||S.emissiveTextureId||S.occlusionTextureId,Y=g.newLayout().vec3f(z.VertexAttribute.POSITION).vec3f(z.VertexAttribute.NORMAL);
S.hasVertexTangents&&Y.vec4f(z.VertexAttribute.TANGENT);U&&Y.vec2f(z.VertexAttribute.UV0);S.hasVertexColors&&Y.vec4u8(z.VertexAttribute.COLOR);S.hasSymbolColors&&Y.vec4u8(z.VertexAttribute.SYMBOLCOLOR);c("enable-feature:objectAndLayerId-rendering")&&Y.vec4u8(z.VertexAttribute.OBJECTANDLAYERIDCOLOR);T._vertexBufferLayout=Y;T._instanceBufferLayout=Q.instanced?v(T.parameters):null;return T}b._inheritsLoose(I,E);var M=I.prototype;M.isVisibleForOutput=function(Q){return Q===h.ShaderOutput.Shadow||Q===
h.ShaderOutput.ShadowExludeHighlight||Q===h.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};M.isVisible=function(){var Q=this.parameters;if(!E.prototype.isVisible.call(this)||0===Q.layerOpacity)return!1;const {instanced:T,hasVertexColors:S,hasSymbolColors:U,vvColorEnabled:Y}=Q,V=r.isSome(T)&&T.includes("color"),R="replace"===Q.colorMixMode,X=0<Q.opacity;Q=Q.externalColor&&0<Q.externalColor[3];return S&&(V||Y||U)?R?!0:X:S?R?Q:X:V||Y||U?R?!0:X:R?Q:X};M.getConfiguration=function(Q,T){this._configuration.output=
Q;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;this._configuration.instanced=!!this.parameters.instanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.hasVerticalOffset=r.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=
r.isSome(this.parameters.screenSizePerspective);this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType="screenDerivative"===this.parameters.normals?d.NormalAttributeType.ScreenDerivative:d.NormalAttributeType.Attribute;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;
r.isSome(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?l.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=T.multipassTerrain.enabled;this._configuration.cullAboveGround=T.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=r.isSome(this.parameters.modelTransformation);
if(Q===h.ShaderOutput.Color||Q===h.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?f.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.WindingOrder:
f.NormalsDoubleSidedMode.None,this._configuration.instancedColor=r.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=T.ssaoHelper.ready?this.parameters.receiveSSAO:!1,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=
this.parameters.usePBR?this.parameters.isSchematic?e.PBRMode.Schematic:e.PBRMode.Normal:e.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=
T.transparencyPassType,this._configuration.enableOffset=T.camera.relativeElevation<w.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(T),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,
this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};M.hasSnowCover=function(Q){return r.isSome(Q.weather)&&Q.weatherVisible&&"snowy"===Q.weather.type&&"enabled"===Q.weather.snowCover};M.intersect=function(Q,T,S,U,Y,V,R){if(r.isSome(this.parameters.verticalOffset)){const W=U.camera;m.set(N,S[12],S[13],S[14]);S=null;switch(U.viewingMode){case p.ViewingMode.Global:S=m.normalize(O,N);break;case p.ViewingMode.Local:S=
m.copy(O,K)}let aa=0;var X=m.subtract(H,N,W.eye);const ba=m.length(X);X=m.scale(X,X,1/ba);let ia=null;this.parameters.screenSizePerspective&&(ia=m.dot(S,X));aa+=C.verticalOffsetAtDistance(W,ba,this.parameters.verticalOffset,ia,this.parameters.screenSizePerspective);m.scale(S,S,aa);m.transformMat3(P,S,U.transform.inverseRotation);Y=m.subtract(J,Y,P);V=m.subtract(L,V,P)}C.intersectTriangleGeometry(Q,T,U,Y,V,y.getVerticalOffsetObject3D(U.verticalOffset),R)};M.requiresSlot=function(Q,T){return T===h.ShaderOutput.Color||
T===h.ShaderOutput.Alpha||T===h.ShaderOutput.Depth||T===h.ShaderOutput.Normal||T===h.ShaderOutput.Shadow||T===h.ShaderOutput.ShadowHighlight||T===h.ShaderOutput.ShadowExludeHighlight||T===h.ShaderOutput.Highlight||T===h.ShaderOutput.ObjectAndLayerIdColor?Q===(this.parameters.transparent?this.parameters.writeDepth?u.RenderSlot.TRANSPARENT_MATERIAL:u.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:u.RenderSlot.OPAQUE_MATERIAL)||Q===u.RenderSlot.DRAPED_MATERIAL||T===h.ShaderOutput.ObjectAndLayerIdColor:
!1};M.createGLMaterial=function(Q){return new D(Q)};M.createBufferWriter=function(){return new G(this._vertexBufferLayout,this._instanceBufferLayout)};return I}(t.Material);let D=function(E){function I(Q){return E.call(this,{...Q,...Q.material.parameters})||this}b._inheritsLoose(I,E);var M=I.prototype;M._updateParameters=function(Q){const T=this._material.parameters;this.updateTexture(T.textureId);const S=Q.camera.viewInverseTransposeMatrix;m.set(T.origin,S[3],S[7],S[11]);this._material.setParameters(this.textureBindParameters);
return this.ensureTechnique(T.treeRendering?x.RealisticTreeTechnique:k.DefaultMaterialTechnique,Q)};M._updateShadowState=function(Q){Q.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:Q.shadowMap.enabled})};M._updateOccludeeState=function(Q){Q.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Q.hasOccludees})};M.beginSlot=function(Q){if(this._output===h.ShaderOutput.Color||this._output===
h.ShaderOutput.Alpha)this._updateShadowState(Q),this._updateOccludeeState(Q);return this._updateParameters(Q)};return I}(A.GLTextureMaterial);A=function(E){function I(){var M=E.apply(this,arguments)||this;M.initTextureTransparent=!1;M.treeRendering=!1;M.hasVertexTangents=!1;return M}b._inheritsLoose(I,E);return I}(k.DefaultMaterialPassParameters);const F=new A;let G=function(){function E(M,Q){this.vertexBufferLayout=M;this.instanceBufferLayout=Q}var I=E.prototype;I.allocate=function(M){return this.vertexBufferLayout.createBuffer(M)};
I.elementCount=function(M){return M.indices.get(z.VertexAttribute.POSITION).length};I.write=function(M,Q,T,S,U){B.writeDefaultAttributes(T,this.vertexBufferLayout,M,Q,S,U)};return E}();const J=n.create(),L=n.create(),K=n.fromValues(0,0,1),O=n.create(),P=n.create(),N=n.create(),H=n.create();a.DefaultGLMaterial=D;a.DefaultMaterial=t;a.DefaultMaterialParameters=A;a.getInstanceBufferLayout=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports",
"../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(r){r[r.None=0]="None";r[r.View=1]="View";r[r.WindingOrder=2]="WindingOrder";r[r.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(r,m){r=r.fragment;r.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(m.doubleSidedMode){case a.NormalsDoubleSidedMode.None:r.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:r.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:r.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(m.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/DefaultMaterial.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){let D=function(F){function G(){var J=F.apply(this,arguments)||this;J.isSchematic=!1;J.usePBR=!1;J.mrrFactors=m.fromValues(0,1,.5);J.hasVertexColors=!1;J.hasSymbolColors=!1;J.doubleSided=!1;J.doubleSidedType="normal";J.cullFace=t.CullFaceOptions.Back;J.emissiveFactor=m.fromValues(0,0,0);J.instancedDoublePrecision=!1;J.normals="default";J.receiveSSAO=!0;J.receiveShadows=!0;J.castShadows=!0;J.shadowMappingEnabled=!1;J.ambient=m.fromValues(.2,
.2,.2);J.diffuse=m.fromValues(.8,.8,.8);J.externalColor=n.fromValues(1,1,1,1);J.colorMixMode="multiply";J.opacity=1;J.layerOpacity=1;J.origin=m.create();J.hasSlicePlane=!1;J.hasSliceHighlight=!0;J.offsetTransparentBackfaces=!1;J.vvSizeEnabled=!1;J.vvSizeMinSize=[1,1,1];J.vvSizeMaxSize=[100,100,100];J.vvSizeOffset=[0,0,0];J.vvSizeFactor=[1,1,1];J.vvSizeValue=[1,1,1];J.vvColorEnabled=!1;J.vvColorValues=[0,0,0,0,0,0,0,0];J.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,
0];J.vvSymbolAnchor=[0,0,0];J.vvSymbolRotationMatrix=r.create();J.vvOpacityEnabled=!1;J.vvOpacityValues=[];J.vvOpacityOpacities=[];J.transparent=!1;J.writeDepth=!0;J.customDepthTest=t.DepthTestFunction.Less;J.textureAlphaMode=t.AlphaDiscardMode.Blend;J.textureAlphaCutoff=f.defaultMaskAlphaCutoff;J.textureAlphaPremultiplied=!1;J.hasOccludees=!1;J.renderOccluded=u.RenderOccludedFlag.Occlude;return J}c._inheritsLoose(G,F);return G}(d.VertexNormalPassParameters);d=function(F){function G(){var J=F.apply(this,
arguments)||this;J.origin=m.create();J.slicePlaneLocalOrigin=J.origin;return J}c._inheritsLoose(G,F);return G}(d.VertexNormalDrawParameters);A=function(F){function G(){return F.apply(this,arguments)||this}c._inheritsLoose(G,F);var J=G.prototype;J.initializeConfiguration=function(L,K){K.hasWebGL2Context=L.rctx.type===q.ContextType.WEBGL2;K.spherical=L.viewingMode===p.ViewingMode.Global;K.doublePrecisionRequiresObfuscation=e.doublePrecisionRequiresObfuscation(L.rctx);K.textureCoordinateType=K.hasColorTexture||
K.hasMetallicRoughnessTexture||K.hasEmissionTexture||K.hasOcclusionTexture||K.hasNormalTexture?h.TextureCoordinateAttributeType.Default:h.TextureCoordinateAttributeType.None;K.objectAndLayerIdColorInstanced=K.instanced};J.initializeProgram=function(L){return this._initializeProgram(L,G.shader)};J._initializeProgram=function(L,K){return new y.Program(L.rctx,K.get().build(this.configuration),w.Default3D)};J._convertDepthTestFunction=function(L){return L===t.DepthTestFunction.Lequal?x.CompareFunction.LEQUAL:
x.CompareFunction.LESS};J._makePipeline=function(L,K){const O=this.configuration,P=L===C.TransparencyPassType.NONE,N=L===C.TransparencyPassType.FrontFace;var H=v.makePipelineState,E=O.output!==g.ShaderOutput.Color&&O.output!==g.ShaderOutput.Alpha||!O.transparent?null:P?z.blendingDefault:z.oitBlending(L);var I=O.cullFace!==t.CullFaceOptions.None?!0:O.hasSlicePlane?!1:!O.transparent&&!O.doubleSidedMode;return H.call(v,{blending:E,culling:I&&v.cullingParams(O.cullFace),depthTest:{func:z.oitDepthTest(L,
this._convertDepthTestFunction(O.customDepthTest))},depthWrite:P||N?O.writeDepth&&v.defaultDepthWriteParams:null,colorWrite:v.defaultColorWriteParams,stencilWrite:O.hasOccludees?B.stencilWriteMaskOn:null,stencilTest:O.hasOccludees?K?B.stencilToolMaskBaseParams:B.stencilBaseAllZerosParams:null,polygonOffset:P||N?null:z.getOITPolygonOffset(O.enableOffset)})};J.initializePipeline=function(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0);return this._makePipeline(this.configuration.transparencyPassType,
!1)};J.getPipelineState=function(L,K){return K?this._occludeePipelineState:F.prototype.getPipelineState.call(this,L,K)};return G}(A.ShaderTechnique);A.shader=new l.ReloadableShaderModule(k.DefaultMaterial,()=>new Promise((F,G)=>a(["./DefaultMaterial.glsl"],F,G)));b.DefaultMaterialDrawParameters=d;b.DefaultMaterialPassParameters=D;b.DefaultMaterialTechnique=A;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../core/maybe ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S){function U(V){const R=new M.ShaderBuilder,{vertex:X,fragment:W,varyings:aa}=R;O.addProjViewLocalOrigin(X,V);R.include(f.PositionAttribute);aa.add("vpos","vec3");R.include(G.VisualVariables,V);R.include(h.InstancedDoublePrecision,V);R.include(w.VerticalOffset,V);V.hasColorTextureTransform&&R.include(F.colorTextureUV);if(V.output===n.ShaderOutput.Color||V.output===n.ShaderOutput.Alpha)V.hasNormalTextureTransform&&
R.include(F.normalTextureUV),V.hasEmissionTextureTransform&&R.include(F.emissiveTextureUV),V.hasOcclusionTextureTransform&&R.include(F.occlusionTextureUV),V.hasMetallicRoughnessTextureTransform&&R.include(F.metallicRoughnessTextureUV),O.addCameraPosition(X,V),R.include(d.NormalAttribute,V),R.include(g.Transform,V),V.normalType===d.NormalAttributeType.Attribute&&V.offsetBackfaces&&R.include(m.Offset),R.include(z.ComputeNormalTexture,V),R.include(t.VertexNormal,V),V.instancedColor&&R.attributes.add(S.VertexAttribute.INSTANCECOLOR,
"vec4"),aa.add("localvpos","vec3"),R.include(l.TextureCoordinateAttribute,V),R.include(r.ForwardLinearDepth,V),R.include(e.SymbolColor,V),R.include(A.VertexColor,V),X.uniforms.add(new N.Float4PassUniform("externalColor",ba=>ba.externalColor)),aa.add("vcolorExt","vec4"),V.hasMultipassTerrain&&aa.add("depth","float"),V.hasModelTransformation&&X.uniforms.add(new I.Matrix4PassUniform("model",ba=>b.isSome(ba.modelTransformation)?ba.modelTransformation:c.IDENTITY)),X.code.add(E.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${V.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${E.glsl.float(J.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${V.normalType===d.NormalAttributeType.Attribute?E.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${V.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${V.hasModelTransformation?"model,":""} vpos);
          ${V.normalType===d.NormalAttributeType.Attribute&&V.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${V.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${V.hasColorTextureTransform?E.glsl`forwardColorUV();`:""}
        ${V.hasNormalTextureTransform?E.glsl`forwardNormalUV();`:""}
        ${V.hasEmissionTextureTransform?E.glsl`forwardEmissiveUV();`:""}
        ${V.hasOcclusionTextureTransform?E.glsl`forwardOcclusionUV();`:""}
        ${V.hasMetallicRoughnessTextureTransform?E.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `);V.output===n.ShaderOutput.Alpha&&(R.include(p.SliceDraw,V),R.include(L.DiscardOrAdjustAlphaPass,V),R.include(k.multipassTerrainTest,V),W.uniforms.add([new H.FloatPassUniform("opacity",ba=>ba.opacity),new H.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity)]),V.hasColorTexture&&W.uniforms.add(new Q.Texture2DPassUniform("tex",ba=>ba.texture)),W.include(K.MixExternalColor),W.code.add(E.glsl`
      void main() {
        discardBySlice(vpos);
        ${V.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${V.hasColorTexture?E.glsl`
                vec4 texColor = texture2D(tex, ${V.hasColorTextureTransform?E.glsl`colorUV`:E.glsl`vuv0`});
                ${V.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E.glsl`vec4 texColor = vec4(1.0);`}
        ${V.hasVertexColors?E.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `));V.output===n.ShaderOutput.Color&&(R.include(p.SliceDraw,V),R.include(B.EvaluateSceneLighting,V),R.include(y.EvaluateAmbientOcclusion,V),R.include(L.DiscardOrAdjustAlphaPass,V),R.include(V.instancedDoublePrecision?D.ReadShadowMapPass:D.ReadShadowMapDraw,V),R.include(k.multipassTerrainTest,V),O.addCameraPosition(W,V),W.uniforms.add([X.uniforms.get("localOrigin"),new P.Float3PassUniform("ambient",ba=>ba.ambient),new P.Float3PassUniform("diffuse",ba=>ba.diffuse),new H.FloatPassUniform("opacity",
ba=>ba.opacity),new H.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity)]),V.hasColorTexture&&W.uniforms.add(new Q.Texture2DPassUniform("tex",ba=>ba.texture)),R.include(v.PhysicallyBasedRenderingParameters,V),R.include(x.PhysicallyBasedRendering,V),W.include(K.MixExternalColor),R.include(q.Normals,V),B.addAmbientBoostFactor(W),B.addLightingGlobalFactor(W),C.addMainLightIntensity(W),W.code.add(E.glsl`
      void main() {
        discardBySlice(vpos);
        ${V.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${V.hasColorTexture?E.glsl`
                vec4 texColor = texture2D(tex, ${V.hasColorTextureTransform?E.glsl`colorUV`:E.glsl`vuv0`});
                ${V.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${V.normalType===d.NormalAttributeType.ScreenDerivative?E.glsl`
                vec3 normal = screenDerivativeNormal(localvpos);`:E.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${V.pbrMode===v.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${V.receiveShadows?"readShadowMap(vpos, linearDepth)":V.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${V.hasVertexColors?E.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${V.hasNormalTexture?E.glsl`
                mat3 tangentSpace = ${V.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:E.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${V.spherical?E.glsl`normalize(posWorld);`:E.glsl`vec3(0.0, 0.0, 1.0);`}

        ${V.snowCover?E.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${V.pbrMode===v.PBRMode.Normal||V.pbrMode===v.PBRMode.Schematic?E.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${V.snowCover?E.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${V.transparencyPassType===T.TransparencyPassType.Color?E.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `));R.include(u.DefaultMaterialAuxiliaryPasses,V);return R}const Y=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=Y;a.build=U})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(w){function u(){var z=w.apply(this,arguments)||this;z.instancedDoublePrecision=!1;return z}b._inheritsLoose(u,w);return u}(f.ShaderTechniqueConfiguration);c.__decorate([f.parameter()],A.prototype,"instancedDoublePrecision",void 0);const t=m.create();a.InstancedDoubleConfiguration=A;a.InstancedDoublePrecision=function(w,u){u.instanced&&u.instancedDoublePrecision&&(w.attributes.add(e.VertexAttribute.MODELORIGINHI,"vec3"),w.attributes.add(e.VertexAttribute.MODELORIGINLO,
"vec3"),w.attributes.add(e.VertexAttribute.MODEL,"mat3"),w.attributes.add(e.VertexAttribute.MODELNORMAL,"mat3"));w=w.vertex;u.instancedDoublePrecision&&(w.include(p.DoublePrecision,u),w.uniforms.add(new h.Float3DrawUniform("viewOriginHi",(z,y)=>l.encodeDoubleHi(r.set(t,y.camera.viewInverseTransposeMatrix[3],y.camera.viewInverseTransposeMatrix[7],y.camera.viewInverseTransposeMatrix[11]),t))),w.uniforms.add(new h.Float3DrawUniform("viewOriginLo",(z,y)=>l.encodeDoubleLo(r.set(t,y.camera.viewInverseTransposeMatrix[3],
y.camera.viewInverseTransposeMatrix[7],y.camera.viewInverseTransposeMatrix[11]),t))));w.code.add(d.glsl`
    vec3 calculateVPos() {
      ${u.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);w.code.add(d.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${u.instancedDoublePrecision?d.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);w.code.add(d.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${u.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);u.output===n.ShaderOutput.Normal&&(g.addViewNormal(w),w.code.add(d.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${u.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));u.hasVertexTangents&&w.code.add(d.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${u.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,c,r,m,n){a.SymbolColor=function(p,g){g.hasSymbolColors?(p.include(b.DecodeSymbolColor),
p.attributes.add(m.VertexAttribute.SYMBOLCOLOR,"vec4"),p.varyings.add("colorMixMode","mediump float"),p.vertex.code.add(r.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(p.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",h=>n.colorMixModes[h.colorMixMode])),p.vertex.code.add(r.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(r){r.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(r){r[r.Multiply=1]="Multiply";r[r.Ignore=2]="Ignore";r[r.Replace=3]="Replace";r[r.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(r,m,n){if(c.isNone(r)||m===a.ColorMixModeEnum.Ignore)n[0]=
255,n[1]=255,n[2]=255,n[3]=255;else{var p=b.clamp(Math.round(85*r[3]),0,85);m=0===p||m===a.ColorMixModeEnum.Tint?0:m===a.ColorMixModeEnum.Replace?85:170;n[0]=b.clamp(Math.round(255*r[0]),0,255);n[1]=b.clamp(Math.round(255*r[1]),0,255);n[2]=b.clamp(Math.round(255*r[2]),0,255);n[3]=p+m}};a.parseColorMixMode=function(r){switch(r){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;
default:return a.ColorMixModeEnum.Multiply}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(r,m){m.hasVertexColors?(r.attributes.add(c.VertexAttribute.COLOR,"vec4"),r.varyings.add("vColor","vec4"),r.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),
r.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):r.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../../../../../core/maybe ../../../../../../chunks/mat4f64 ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){a.DefaultMaterialAuxiliaryPasses=function(C,k){const {vertex:q,fragment:x}=C,v=k.hasModelTransformation;v&&q.uniforms.add(new z.Matrix4PassUniform("model",F=>b.isSome(F.modelTransformation)?F.modelTransformation:c.IDENTITY));const D=k.hasColorTexture&&k.alphaDiscardMode!==B.AlphaDiscardMode.Opaque;switch(k.output){case m.ShaderOutput.Depth:case m.ShaderOutput.Shadow:case m.ShaderOutput.ShadowHighlight:case m.ShaderOutput.ShadowExludeHighlight:case m.ShaderOutput.ObjectAndLayerIdColor:w.addProjViewLocalOrigin(q,
k);C.include(p.Transform,k);C.include(d.TextureCoordinateAttribute,k);C.include(A.VisualVariables,k);C.include(e.OutputDepth,k);C.include(n.SliceDraw,k);C.include(h.ObjectAndLayerIdColor,k);r.addNearFar(C);C.varyings.add("depth","float");D&&x.uniforms.add(new y.Texture2DPassUniform("tex",F=>F.texture));q.code.add(u.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${v?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `);C.include(t.DiscardOrAdjustAlphaPass,k);x.code.add(u.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${D?u.glsl`
                    vec4 texColor = texture2D(tex, ${k.hasColorTextureTransform?u.glsl`colorUV`:u.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${k.output===m.ShaderOutput.ObjectAndLayerIdColor?u.glsl`outputObjectAndLayerIdColor();`:u.glsl`outputDepth(depth);`}
          }
        `);break;case m.ShaderOutput.Normal:w.addProjViewLocalOrigin(q,k);C.include(p.Transform,k);C.include(g.NormalAttribute,k);C.include(f.VertexNormal,k);C.include(d.TextureCoordinateAttribute,k);C.include(A.VisualVariables,k);D&&x.uniforms.add(new y.Texture2DPassUniform("tex",F=>F.texture));C.varyings.add("vPositionView","vec3");q.code.add(u.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${k.normalType===g.NormalAttributeType.Attribute?u.glsl`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${v?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `);C.include(n.SliceDraw,k);C.include(t.DiscardOrAdjustAlphaPass,k);x.code.add(u.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?u.glsl`
                    vec4 texColor = texture2D(tex, ${k.hasColorTextureTransform?u.glsl`colorUV`:u.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${k.normalType===g.NormalAttributeType.ScreenDerivative?u.glsl`
                vec3 normal = screenDerivativeNormal(vPositionView);`:u.glsl`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case m.ShaderOutput.Highlight:w.addProjViewLocalOrigin(q,k),C.include(p.Transform,k),C.include(d.TextureCoordinateAttribute,k),C.include(A.VisualVariables,k),D&&x.uniforms.add(new y.Texture2DPassUniform("tex",F=>F.texture)),q.code.add(u.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${v?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),C.include(n.SliceDraw,k),C.include(t.DiscardOrAdjustAlphaPass,k),C.include(l.OutputHighlight,k),x.code.add(u.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?u.glsl`
                    vec4 texColor = texture2D(tex, ${k.hasColorTextureTransform?u.glsl`colorUV`:u.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,c,r,m,n){function p(g,h,d){const f=g.fragment;h.alphaDiscardMode!==n.AlphaDiscardMode.Mask&&h.alphaDiscardMode!==
n.AlphaDiscardMode.MaskBlend||f.uniforms.add(d);switch(h.alphaDiscardMode){case n.AlphaDiscardMode.Blend:return g.include(b.DiscardOrAdjustAlphaBlend);case n.AlphaDiscardMode.Opaque:f.code.add(m.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case n.AlphaDiscardMode.Mask:f.code.add(m.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case n.AlphaDiscardMode.MaskBlend:g.fragment.code.add(m.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(g,h){p(g,h,new c.FloatDrawUniform("textureAlphaCutoff",d=>d.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(g,h){p(g,h,new r.FloatPassUniform("textureAlphaCutoff",
d=>d.textureAlphaCutoff))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,c){a.DiscardOrAdjustAlphaBlend=function(r){r.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"float",r.BindType.Draw,(h,d,f)=>h.setUniform1f(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.FloatDrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.ComputeNormalTexture=function(e,l){const A=e.fragment;l.hasVertexTangents?(e.attributes.add(f.VertexAttribute.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),l.doubleSidedMode===r.NormalsDoubleSidedMode.WindingOrder?A.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):A.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),A.code.add(n.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));l.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(e.include(c.VertexTextureCoordinates,l),e=l.supportsTextureAtlas?l.hasWebGL2Context?h.TextureSizeUniformType.None:h.TextureSizeUniformType.Size:h.TextureSizeUniformType.None,A.uniforms.add(l.pbrTextureBindType===d.BindType.Pass?g.createTexture2DPassSizeUniforms("normalTexture",t=>t.textureNormal,e):p.createTexture2DDrawSizeUniforms("normalTexture",t=>t.textureNormal,e)),A.code.add(n.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${l.supportsTextureAtlas?n.glsl`vtc.size = ${m.textureSize(l,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define("exports ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../../lib/SSAOHelper".split(" "),function(a,b,c,r,m,n){a.EvaluateAmbientOcclusion=function(p,g){p=p.fragment;g.receiveAmbientOcclusion?(p.uniforms.add(r.createTexture2DPassSizeUniforms("ssaoTex",
(h,d)=>d.ssaoHelper.colorTexture,g.hasWebGL2Context?m.TextureSizeUniformType.None:m.TextureSizeUniformType.InvSize)),p.constants.add("blurSizePixelsInverse","float",1/n.blurSizePixels),p.code.add(c.glsl`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${b.textureSize(g,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):p.code.add(c.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(t){t.constants.add("ambientBoostFactor","float",e.ambientBoost)}function A(t){t.uniforms.add(new d.FloatPassUniform("lightingGlobalFactor",(w,u)=>u.lighting.globalFactor))}a.EvaluateSceneLighting=function(t,w){const u=t.fragment;t.include(r.EvaluateAmbientOcclusion,w);w.pbrMode!==p.PBRMode.Disabled&&t.include(n.PhysicallyBasedRendering,w);t.include(c.EvaluateAmbientLighting,w);t.include(g.PiUtils);u.code.add(f.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${w.pbrMode===p.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);l(u);A(u);m.addMainLightDirection(u);u.code.add(f.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${w.spherical?f.glsl`normalize(vPosWorld)`:f.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);m.addMainLightIntensity(u);u.code.add(f.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(w.pbrMode){case p.PBRMode.Disabled:case p.PBRMode.WaterOnIntegratedMesh:case p.PBRMode.Water:t.include(m.MainLighting,w);u.code.add(f.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case p.PBRMode.Normal:case p.PBRMode.Schematic:u.code.add(f.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = mainLightDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);u.code.add(f.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);w.useFillLights?u.uniforms.add(new h.BooleanPassUniform("hasFillLights",(z,y)=>y.enableFillLights)):u.constants.add("hasFillLights","bool",!1);u.code.add(f.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);u.uniforms.add([new d.FloatPassUniform("lightingSpecularStrength",(z,y)=>y.lighting.mainLight.specularStrength),new d.FloatPassUniform("lightingEnvironmentStrength",(z,y)=>y.lighting.mainLight.environmentStrength)]);u.code.add(f.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);u.code.add(f.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${w.pbrMode===p.PBRMode.Schematic?f.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:f.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;default:b.neverReached(w.pbrMode);case p.PBRMode.COUNT:}};a.addAmbientBoostFactor=l;a.addLightingGlobalFactor=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/maybe","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,c,r,m){a.colorTextureUV=
function(n){n.vertex.uniforms.add(new m.Matrix3PassUniform("colorTextureTransformMatrix",p=>b.isSome(p.colorTextureTransformMatrix)?p.colorTextureTransformMatrix:c.create()));n.varyings.add("colorUV","vec2");n.vertex.code.add(r.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.emissiveTextureUV=function(n){n.vertex.uniforms.add(new m.Matrix3PassUniform("emissiveTextureTransformMatrix",p=>b.isSome(p.emissiveTextureTransformMatrix)?p.emissiveTextureTransformMatrix:c.create()));n.varyings.add("emissiveUV","vec2");n.vertex.code.add(r.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.metallicRoughnessTextureUV=function(n){n.vertex.uniforms.add(new m.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",p=>b.isSome(p.metallicRoughnessTextureTransformMatrix)?p.metallicRoughnessTextureTransformMatrix:c.create()));n.varyings.add("metallicRoughnessUV","vec2");n.vertex.code.add(r.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.normalTextureUV=function(n){n.vertex.uniforms.add(new m.Matrix3PassUniform("normalTextureTransformMatrix",p=>b.isSome(p.normalTextureTransformMatrix)?p.normalTextureTransformMatrix:c.create()));n.varyings.add("normalUV","vec2");n.vertex.code.add(r.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.occlusionTextureUV=function(n){n.vertex.uniforms.add(new m.Matrix3PassUniform("occlusionTextureTransformMatrix",p=>b.isSome(p.occlusionTextureTransformMatrix)?p.occlusionTextureTransformMatrix:c.create()));n.varyings.add("occlusionUV","vec2");n.vertex.code.add(r.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const p=new Float32Array(9);p[0]=1;p[4]=1;p[8]=1;return p}function c(p){const g=new Float32Array(9);g[0]=p[0];g[1]=p[1];g[2]=p[2];g[3]=p[3];g[4]=p[4];g[5]=p[5];g[6]=p[6];g[7]=p[7];g[8]=p[8];return g}function r(p,g,h,d,f,e,l,A,t){const w=new Float32Array(9);w[0]=p;w[1]=g;w[2]=h;w[3]=d;w[4]=f;w[5]=e;w[6]=l;w[7]=A;w[8]=t;return w}
function m(p,g){return new Float32Array(p,g,9)}const n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.mat3f32=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,r){a.MixExternalColor=
function(m){m.include(c.ColorConversion);m.code.add(r.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${r.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${r.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${r.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${r.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${r.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){e=function(l){function A(){var t=l.apply(this,arguments)||this;t.output=r.ShaderOutput.Color;t.alphaDiscardMode=d.AlphaDiscardMode.Opaque;t.doubleSidedMode=p.NormalsDoubleSidedMode.None;t.pbrMode=g.PBRMode.Disabled;t.cullFace=d.CullFaceOptions.None;t.transparencyPassType=f.TransparencyPassType.NONE;t.normalType=m.NormalAttributeType.Attribute;t.textureCoordinateType=n.TextureCoordinateAttributeType.None;t.customDepthTest=d.DepthTestFunction.Less;t.spherical=!1;t.hasVertexColors=
!1;t.hasSymbolColors=!1;t.hasVerticalOffset=!1;t.hasSlicePlane=!1;t.hasSliceHighlight=!0;t.hasColorTexture=!1;t.hasMetallicRoughnessTexture=!1;t.hasEmissionTexture=!1;t.hasOcclusionTexture=!1;t.hasNormalTexture=!1;t.hasScreenSizePerspective=!1;t.hasVertexTangents=!1;t.hasOccludees=!1;t.hasMultipassTerrain=!1;t.hasModelTransformation=!1;t.offsetBackfaces=!1;t.vvSize=!1;t.vvColor=!1;t.receiveShadows=!1;t.receiveAmbientOcclusion=!1;t.textureAlphaPremultiplied=!1;t.instanced=!1;t.instancedColor=!1;t.objectAndLayerIdColorInstanced=
!1;t.instancedDoublePrecision=!1;t.doublePrecisionRequiresObfuscation=!1;t.writeDepth=!0;t.transparent=!1;t.enableOffset=!0;t.cullAboveGround=!1;t.snowCover=!1;t.hasColorTextureTransform=!1;t.hasEmissionTextureTransform=!1;t.hasNormalTextureTransform=!1;t.hasOcclusionTextureTransform=!1;t.hasMetallicRoughnessTextureTransform=!1;return t}b._inheritsLoose(A,l);return A}(e.DefaultTechniqueConfiguration);c.__decorate([h.parameter({count:r.ShaderOutput.COUNT})],e.prototype,"output",void 0);c.__decorate([h.parameter({count:d.AlphaDiscardMode.COUNT})],
e.prototype,"alphaDiscardMode",void 0);c.__decorate([h.parameter({count:p.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",void 0);c.__decorate([h.parameter({count:g.PBRMode.COUNT})],e.prototype,"pbrMode",void 0);c.__decorate([h.parameter({count:d.CullFaceOptions.COUNT})],e.prototype,"cullFace",void 0);c.__decorate([h.parameter({count:f.TransparencyPassType.COUNT})],e.prototype,"transparencyPassType",void 0);c.__decorate([h.parameter({count:m.NormalAttributeType.COUNT})],e.prototype,
"normalType",void 0);c.__decorate([h.parameter({count:n.TextureCoordinateAttributeType.COUNT})],e.prototype,"textureCoordinateType",void 0);c.__decorate([h.parameter({count:d.DepthTestFunction.COUNT})],e.prototype,"customDepthTest",void 0);c.__decorate([h.parameter()],e.prototype,"spherical",void 0);c.__decorate([h.parameter()],e.prototype,"hasVertexColors",void 0);c.__decorate([h.parameter()],e.prototype,"hasSymbolColors",void 0);c.__decorate([h.parameter()],e.prototype,"hasVerticalOffset",void 0);
c.__decorate([h.parameter()],e.prototype,"hasSlicePlane",void 0);c.__decorate([h.parameter()],e.prototype,"hasSliceHighlight",void 0);c.__decorate([h.parameter()],e.prototype,"hasColorTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasEmissionTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasOcclusionTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasNormalTexture",void 0);c.__decorate([h.parameter()],
e.prototype,"hasScreenSizePerspective",void 0);c.__decorate([h.parameter()],e.prototype,"hasVertexTangents",void 0);c.__decorate([h.parameter()],e.prototype,"hasOccludees",void 0);c.__decorate([h.parameter()],e.prototype,"hasMultipassTerrain",void 0);c.__decorate([h.parameter()],e.prototype,"hasModelTransformation",void 0);c.__decorate([h.parameter()],e.prototype,"offsetBackfaces",void 0);c.__decorate([h.parameter()],e.prototype,"vvSize",void 0);c.__decorate([h.parameter()],e.prototype,"vvColor",
void 0);c.__decorate([h.parameter()],e.prototype,"receiveShadows",void 0);c.__decorate([h.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([h.parameter()],e.prototype,"textureAlphaPremultiplied",void 0);c.__decorate([h.parameter()],e.prototype,"instanced",void 0);c.__decorate([h.parameter()],e.prototype,"instancedColor",void 0);c.__decorate([h.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([h.parameter()],e.prototype,"instancedDoublePrecision",
void 0);c.__decorate([h.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([h.parameter()],e.prototype,"writeDepth",void 0);c.__decorate([h.parameter()],e.prototype,"transparent",void 0);c.__decorate([h.parameter()],e.prototype,"enableOffset",void 0);c.__decorate([h.parameter()],e.prototype,"cullAboveGround",void 0);c.__decorate([h.parameter()],e.prototype,"snowCover",void 0);c.__decorate([h.parameter()],e.prototype,"hasColorTextureTransform",void 0);c.__decorate([h.parameter()],
e.prototype,"hasEmissionTextureTransform",void 0);c.__decorate([h.parameter()],e.prototype,"hasNormalTextureTransform",void 0);c.__decorate([h.parameter()],e.prototype,"hasOcclusionTextureTransform",void 0);c.__decorate([h.parameter()],e.prototype,"hasMetallicRoughnessTextureTransform",void 0);c.__decorate([h.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);c.__decorate([h.parameter({constValue:!1})],e.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([h.parameter({constValue:!1})],
e.prototype,"supportsTextureAtlas",void 0);c.__decorate([h.parameter({constValue:!0})],e.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,c,r,m,n,p,g){p=function(h){function d(){return h.apply(this,arguments)||this}c._inheritsLoose(d,h);var f=d.prototype;f.initializeConfiguration=function(e,l){h.prototype.initializeConfiguration.call(this,e,l);l.hasMetallicRoughnessTexture=!1;l.hasEmissionTexture=!1;l.hasOcclusionTexture=!1;l.hasNormalTexture=!1;l.hasModelTransformation=!1;l.normalType=r.NormalAttributeType.Attribute;l.doubleSidedMode=m.NormalsDoubleSidedMode.WindingOrder;l.hasVertexTangents=!1};f.initializeProgram=function(e){return this._initializeProgram(e,
d.shader)};return d}(p.DefaultMaterialTechnique);p.shader=new n.ReloadableShaderModule(g.RealisticTree,()=>new Promise((h,d)=>a(["./RealisticTree.glsl"],h,d)));b.RealisticTreeTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N){function H(I){const M=new K.ShaderBuilder,{vertex:Q,fragment:T,varyings:S}=M;D.addProjViewLocalOrigin(Q,I);M.include(h.PositionAttribute);S.add("vpos","vec3");M.include(k.VisualVariables,I);M.include(p.InstancedDoublePrecision,I);M.include(l.VerticalOffset,I);if(I.output===r.ShaderOutput.Color||I.output===r.ShaderOutput.Alpha)D.addCameraPosition(M.vertex,I),M.include(g.NormalAttribute,I),M.include(n.Transform,I),I.offsetBackfaces&&
M.include(c.Offset),I.instancedColor&&M.attributes.add(N.VertexAttribute.INSTANCECOLOR,"vec4"),S.add("vNormalWorld","vec3"),S.add("localvpos","vec3"),I.hasMultipassTerrain&&S.add("depth","float"),M.include(f.TextureCoordinateAttribute,I),M.include(b.ForwardLinearDepth,I),M.include(d.SymbolColor,I),M.include(e.VertexColor,I),Q.uniforms.add(new G.Float4PassUniform("externalColor",U=>U.externalColor)),S.add("vcolorExt","vec4"),Q.code.add(L.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${I.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${L.glsl.float(q.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${I.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${I.hasMultipassTerrain?L.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);I.output===r.ShaderOutput.Alpha&&(M.include(m.SliceDraw,I),M.include(x.DiscardOrAdjustAlphaPass,I),M.include(z.multipassTerrainTest,I),T.uniforms.add([new J.FloatPassUniform("opacity",U=>U.opacity),new J.FloatPassUniform("layerOpacity",U=>U.layerOpacity)]),I.hasColorTexture&&T.uniforms.add(new O.Texture2DPassUniform("tex",U=>U.texture)),T.include(v.MixExternalColor),T.code.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.hasMultipassTerrain?L.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${I.hasColorTexture?L.glsl`
                vec4 texColor = texture2D(tex, ${I.hasColorTextureTransform?L.glsl`colorUV`:L.glsl`vuv0`});
                ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        ${I.hasVertexColors?L.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `));I.output===r.ShaderOutput.Color&&(M.include(m.SliceDraw,I),M.include(w.EvaluateSceneLighting,I),M.include(t.EvaluateAmbientOcclusion,I),M.include(x.DiscardOrAdjustAlphaPass,I),M.include(I.instancedDoublePrecision?C.ReadShadowMapPass:C.ReadShadowMapDraw,I),M.include(z.multipassTerrainTest,I),D.addCameraPosition(M.fragment,I),u.addMainLightDirection(T),w.addAmbientBoostFactor(T),w.addLightingGlobalFactor(T),T.uniforms.add([Q.uniforms.get("localOrigin"),Q.uniforms.get("view"),new F.Float3PassUniform("ambient",
U=>U.ambient),new F.Float3PassUniform("diffuse",U=>U.diffuse),new J.FloatPassUniform("opacity",U=>U.opacity),new J.FloatPassUniform("layerOpacity",U=>U.layerOpacity)]),I.hasColorTexture&&T.uniforms.add(new O.Texture2DPassUniform("tex",U=>U.texture)),M.include(B.PhysicallyBasedRenderingParameters,I),M.include(y.PhysicallyBasedRendering,I),T.include(v.MixExternalColor),M.extensions.add("GL_OES_standard_derivatives"),u.addMainLightIntensity(T),T.code.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.hasMultipassTerrain?L.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${I.hasColorTexture?L.glsl`
                vec4 texColor = texture2D(tex, ${I.hasColorTextureTransform?L.glsl`colorUV`:L.glsl`vuv0`});
                ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${I.pbrMode===B.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${I.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":I.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${I.hasVertexColors?L.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${I.snowCover?L.glsl`albedo = mix(albedo, vec3(1), 0.9);`:L.glsl``}
        ${L.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${I.pbrMode===B.PBRMode.Normal||I.pbrMode===B.PBRMode.Schematic?I.spherical?L.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:L.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:L.glsl``}
        ${I.pbrMode===B.PBRMode.Normal||I.pbrMode===B.PBRMode.Schematic?L.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${I.snowCover?L.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:L.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${I.transparencyPassType===P.TransparencyPassType.Color?L.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:L.glsl``}
      }
    `));M.include(A.DefaultMaterialAuxiliaryPasses,I);return M}const E=Object.freeze(Object.defineProperty({__proto__:null,build:H},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=E;a.build=H})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y){function V(ma){return h.isNone(ma)?!1:"cross"===ma||"x"===ma}const R=l.create(),X=t.fromValues(0,0,1);m=E.DEFAULT_TEX_SIZE;const W=E.DEFAULT_SYMBOL_SIZE_RATIO,aa=[W/2,W/2,1-W/2,1-W/2];m=[m*W,m*W];L=function(ma){function ha(Z,ca,fa,ea){Z=ma.call(this,Z,ca,fa,ea)||this;Z._cimLayers=null;Z._cimSymbolMaterials=new Map;Z._cimSymbolTextures=new Map;Z._cimMaterialParametersInfo=null;Z._cimRequiredFields=null;
Z._cimScaleFactorOrFunction=null;Z._size=null;Z._symbolTextureRatio=1;Z._outlineSize=0;Z._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return Z}c._inheritsLoose(ha,ma);var ka=ha.prototype;ka.getCachedSize=function(){return{size:this._getIconSize()}};ka.doLoad=function(){var Z=c._asyncToGenerator(function*(ca){this._validateOrThrow();const fa=this._prepareMaterialParameters();var ea=this._getPrimitive();if(h.isSome(ea))this._prepareResourcesPrimitive(fa,ea);else{ea=k.getIconHref(this.symbol,
this.symbolLayer);const da=e.dataComponents(ea);da&&"application/json"===da.mediaType?yield this._prepareResourcesCIM(fa,JSON.parse(da.data),ca):yield this._prepareResourcesHref(fa,ea,ca)}});return function(ca){return Z.apply(this,arguments)}}();ka._validateOrThrow=function(){if(!this._drivenProperties.size){var Z=K.validateSymbolLayerSize(this._getIconSize());if(Z)throw new p("graphics3diconsymbollayer:invalid-size",Z);}};ka._getIconSize=function(){var Z=this.symbolLayer;Z=Math.round(null!=Z.size?
f.pt2px(Z.size):16);return this._drivenProperties.size?Math.max(Z,64):Z};ka._generateTextureCIM=function(Z){const ca=this._getGraphicHash(Z);let fa=""===ca?null:this._cimSymbolTextures.get(ca);fa||(Z=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,Z,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",Z.anchorPosition),fa=new S.Texture(Z.imageData,{width:Z.imageData.width,
height:Z.imageData.height,powerOfTwoResizeMode:M.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(ca,fa),this._context.stage.add(fa));return fa};ka._computeSize=function(Z,ca){Z=Z.width/Z.height;return 1<Z?[ca,Math.round(ca/Z)]:[Math.round(ca*Z),ca]};ka._prepareMaterialParameters=function(){const Z={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ca=this.symbol;if(ca&&"point-3d"===ca.type&&ca.hasVisibleVerticalOffset()){const {screenLength:fa,minWorldLength:ea,
maxWorldLength:da}=ca.verticalOffset;Z.verticalOffset={screenLength:f.pt2px(fa),minWorldLength:ea||0,maxWorldLength:h.isSome(da)?da:Infinity}}this._context.screenSizePerspectiveEnabled&&(Z.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);Z.occlusionTest=!0;Z.hasSlicePlane=this._context.slicePlaneEnabled;return Z};ka._prepareResourcesPrimitive=function(Z,ca){var fa=this._getOutlineSize();if(V(ca)&&0===fa)throw Error("Nothing to render");this._outlineSize=fa;Z.color=
this._getFillColor();Z.outlineColor=this._getOutlineColor();Z.outlineSize=this._outlineSize;h.isSome(this._context.sharedResources.textures)&&(fa=this._context.sharedResources.textures.fromData(`${ca}-icon`,()=>E.createTexture(ca)),this._texture=fa.texture,this._releaseTexture=fa,Z.textureId=this._texture.id);Z.textureIsSignedDistanceField=!0;Z.distanceFieldBoundingBox=aa;fa=this._getIconSize();this._size=[fa,fa];this._symbolTextureRatio=1/W;this._createMaterialAndAddToStage(Z,this._context.stage)};
ka._prepareResourcesHref=function(){var Z=c._asyncToGenerator(function*(ca,fa,ea){if(!g("esri-canvas-svg-support")&&e.isSVG(fa))throw new p("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();ca.color=this._getFillColor();ca.outlineColor=this._getOutlineColor();ca.outlineSize=this._outlineSize;ca.textureIsSignedDistanceField=!1;const da=this._getIconSize(),la=da*this._context.graphicsCoreOwner.view.state.pixelRatio;
if(h.isSome(this._context.sharedResources.textures)){ea=yield n.result(this._context.sharedResources.textures.fromUrl(fa,la,{signal:ea}));if(!1===ea.ok)throw d.throwIfAbortError(ea.error),new p("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${fa})`);this._releaseTexture=ea.value;fa=ea.value.texture;this._size=this._computeSize(fa.params,da);ca.textureId=fa.id}this._createMaterialAndAddToStage(ca,this._context.stage)});return function(ca,fa,ea){return Z.apply(this,
arguments)}}();ka._prepareResourcesCIM=function(){var Z=c._asyncToGenerator(function*(ca,fa,ea){fa=new Y({data:fa});if(!this._context.sharedResources.cimSymbolRasterizer){var da=(yield new Promise((Aa,ua)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],Aa,ua))).CIMSymbolRasterizer;d.throwIfAborted(ea);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new da(this._context.renderCoordsHelper.spatialReference,!0))}da=this._context.layer.fields?this._context.layer.fields.map(Aa=>
Aa.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(fa,da,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ea});let la;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(fa=this._context.renderer,isNaN(fa.scaleExpression)){const Aa=yield B.createRendererExpression(fa.scaleExpression,this._context.layer.spatialReference,
da);la=(ua,za,va)=>{ua=q(Aa,ua,{$view:va},"esriGeometryPoint",za);return null!==ua?ua:1}}else var oa=Number(fa.scaleExpression);this._cimScaleFactorOrFunction=oa||la||1;oa=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];d.throwIfAborted(ea);const ra=this._context.layer.fieldsIndex;this._cimRequiredFields=oa.map(Aa=>ra.get(Aa).name);this._cimMaterialParametersInfo=ca;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=
[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1});return function(ca,fa,ea){return Z.apply(this,arguments)}}();ka._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||C.defaultPrimitive};ka._getOutlineSize=function(){var Z=0;Z=this.symbolLayer;if(h.isSome(Z.outline)&&null!=Z.outline.size)return Math.max(f.pt2px(Z.outline.size),
0);Z=this._getPrimitive();Z=V(Z)?1.5:0;return Math.max(Z,0)};ka._getOutlineColor=function(){const Z=this._getLayerOpacity(),ca=h.get(this.symbolLayer,"outline","color");if(h.isSome(ca)){const fa=r.toUnitRGB(ca);return[fa[0],fa[1],fa[2],ca.a*Z]}return[0,0,0,0]};ka._getFillColor=function(){if(V(this._getPrimitive()))return x.TRANSPARENT_UNIT;const Z=h.isNone(this._getPrimitive()),ca=h.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ca,{hasIntrinsicColor:Z})};ka._getAnchorPos=
function(Z,ca){return"relative"===Z?A.fromValues((ca.x||0)+.5,-(ca.y||0)+.5):Z in P.namedAnchorToHUDMaterialAnchorPos?P.namedAnchorToHUDMaterialAnchorPos[Z]:P.namedAnchorToHUDMaterialAnchorPos.center};ka._createMaterialAndAddToStage=function(Z,ca){this._fastUpdates=this._cimLayers?{enabled:!1}:H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(Z,this._fastUpdates.materialParameters);if(this._cimLayers){let fa=h.isSome(Z.textureId)?
this._cimSymbolMaterials.get(Z.textureId):null;fa||(fa=new U.HUDMaterial(Z),this._cimSymbolMaterials.set(h.unwrapOr(Z.textureId,0),fa),ca.add(fa));return fa}this._material=new U.HUDMaterial(Z);ca.add(this._material);return this._material};ka._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(Z=>{Z.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};
ka.destroy=function(){ma.prototype.destroy.call(this);this._forEachMaterial(Z=>this._context.stage.remove(Z));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(Z=>this._context.stage.remove(Z));this._cimSymbolTextures.clear();this._releaseTexture=h.releaseMaybe(this._releaseTexture)};ka._getScaleFactor=function(Z,ca){if(this._drivenProperties.size&&Z.size){for(let fa=0;3>fa;fa++){const ea=Z.size[fa];ea&&"symbol-value"!==ea&&"proportional"!==ea&&(Z.size[fa]=f.pt2px(ea))}if("symbol-value"===
Z.size[0])return 1;if(isFinite(+Z.size[0]))return+Z.size[0]/ca;if(isFinite(+Z.size[2]))return+Z.size[2]/ca}return 1};ka.createGraphics3DGraphic=function(Z){const ca=Z.graphic;if(!this._validateGeometry(ca.geometry))return null;let fa;if(this._cimLayers){if(!this._cimLayers.length)return null;var ea=this._generateTextureCIM(ca);fa=this._createMaterialAndAddToStage({textureId:ea.id,...this._cimMaterialParametersInfo},this._context.stage);var da=[ea.params.width,ea.params.height]}else da=this._size,
fa=h.unwrap(this._material);ea=N.placePointOnGeometry(ca.geometry);if(h.isNone(ea))return this.logger.warn(`unsupported geometry type for icon symbol: ${ca.geometry.type}`),null;var la=Z.renderingInfo;const oa=this._getVertexOpacityAndColor(la);let ra=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(ra=this._getScaleFactor(la,da[0]>da[1]?da[0]:da[1]));ra*=this._symbolTextureRatio;da=[da[0]*ra,da[1]*ra];la=this.setGraphicElevationContext(ca,new F.ElevationContext);this.ensureDrapedStatus("on-the-ground"===
la.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ca,ea,fa,oa,da,Z.layer.uid):this._createAs3DShape(ca,ea,fa,oa,da,la,ca.uid)};ka.layerOpacityChanged=function(){const Z=this._getFillColor(),ca=this._getOutlineColor();this._forEachMaterial(fa=>{fa.setParameters({color:Z});fa.setParameters({outlineColor:ca})})};ka.layerElevationInfoChanged=function(Z,ca,fa){const ea=this._elevationContext.mode;fa=D.elevationModeChangeUpdateType(ha.elevationModeChangeTypes,
fa,ea);if(fa!==D.SymbolUpdateType.UPDATE)return fa;const da=D.needsElevationUpdates2D(ea)||"absolute-height"===ea;return this.updateGraphics3DGraphicElevationInfo(Z,ca,()=>da)};ka.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(Z=>{Z.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};ka.physicalBasedRenderingChanged=function(){return!0};ka.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};ka.applyRendererDiff=function(Z,ca){for(const fa in Z.diff)switch(fa){case "visualVariables":if(H.updateFastSymbolUpdatesState(this._fastUpdates,
ca,this._fastVisualVariableConvertOptions()))h.isSome(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters);else return O.ApplyRendererDiffResult.Recreate_Symbol;break;default:return O.ApplyRendererDiffResult.Recreate_Symbol}return O.ApplyRendererDiffResult.Fast_Update};ka._defaultElevationInfoNoZ=function(){return ba};ka._createAs3DShape=function(Z,ca,fa,ea,da,la,oa){const ra=this.getFastUpdateAttrValues(Z);Z=ra?za=>H.evaluateModelTransform(this._fastUpdates.materialParameters,
ra,za):null;const Aa=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:oa,layerUid:this._context.layer.uid});ea=[Q.createPointGeometry(X,null,ea,da,ia,null,ra,Aa)];oa=N.createStageObjectForHUD(this._context,ca,ea,[fa],la,this._context.layer.uid,oa,Z);if(null===oa)return null;const ua=new J.Graphics3DObject3DGraphicLayer(this,oa.object,ea,null,null,v.perObjectElevationAligner,la);ua.alignedSampledElevation=oa.sampledElevation;ua.needsElevationUpdates=D.needsElevationUpdates2D(la.mode)||
"absolute-height"===la.mode;ua.getScreenSize=this._createScreenSizeGetter(da,Z);ua.calculateRelativeScreenBounds=za=>fa.calculateRelativeScreenBounds(ua.getScreenSize(),1,za);N.extendPointGraphicElevationContext(ua,ca,this._context.elevationProvider);return ua};ka._createAsOverlay=function(Z,ca,fa,ea,da,la){fa.renderPriority=this._renderPriority;const oa=u.create();z.projectPointToVector(ca,oa,this._context.overlaySR);oa[2]=I.DRAPED_Z;ca=this._context.clippingExtent;if(h.isSome(ca)&&!y.containsPoint(ca,
oa))return null;const ra=this.getFastUpdateAttrValues(Z);ca=ra?za=>H.evaluateModelTransform(this._fastUpdates.materialParameters,ra,za):null;const Aa=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:Z.uid,layerUid:this._context.layer.uid});ea=Q.createPointGeometry(X,oa,ea,da,null,null,ra,Aa);Z=new T.RenderGeometry(ea,fa,{layerUid:la,graphicUid:Z.uid,calculateShaderTransformation:ca});oa[3]=0;w.copy(Z.boundingSphere,oa);const ua=new G(this,[Z],null,this._context.drapeSourceRenderer);
ua.getScreenSize=this._createScreenSizeGetter(da,ca);ua.calculateRelativeScreenBounds=za=>fa.calculateRelativeScreenBounds(ua.getScreenSize(),1,za);return ua};ka._createScreenSizeGetter=function(Z,ca){const fa=this._outlineSize+2;if(this._fastUpdates.enabled){const la=Z[0]/this._symbolTextureRatio,oa=Z[1]/this._symbolTextureRatio;return(ra=A.create())=>{const Aa=ca(R);ra[0]=Aa[0]*la+fa;ra[1]=Aa[5]*oa+fa;return ra}}const ea=Z[0]/this._symbolTextureRatio+fa,da=Z[1]/this._symbolTextureRatio+fa;return(la=
A.create())=>{la[0]=ea;la[1]=da;return la}};ka._fastVisualVariableConvertOptions=function(){var Z=this._size[0]>this._size[1]?this._size[0]:this._size[1];const ca=t.fromValues(Z,Z,Z),fa=f.px2pt(1);Z*=fa;Z=t.fromValues(Z,Z,Z);return{modelSize:ca,symbolSize:Z,unitInMeters:fa,transformation:{anchor:t.ZEROS,scale:t.ONES,rotation:t.ZEROS}}};ka._getGraphicHash=function(Z){let ca="";for(const fa of this._cimRequiredFields)ca+=fa+Z.attributes[fa];return ca};ka._forEachMaterial=function(Z){h.isSome(this._material)&&
Z(this._material);this._cimSymbolMaterials.forEach(Z)};ka.test=function(){return{...ma.prototype.test.call(this),material:this._material}};return ha}(L.Graphics3DSymbolLayer);L.PRIMITIVE_SIZE=m;L.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,onTheGroundChanged:D.SymbolUpdateType.RECREATE};const ba={mode:"relative-to-ground",offset:0},ia=u.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=L;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../core/maybe","../../../geometry/support/quantizationUtils"],function(a,b,c,r){function m(p){const g={};switch(p){case "esriGeometryPoint":return(h,d,f,e)=>r.unquantizePoint(d,g,h,f,e);case "esriGeometryPolygon":return(h,d,f,e)=>r.unquantizePolygon(d,g,h,f,e);case "esriGeometryPolyline":return(h,d,f,e)=>r.unquantizePolyline(d,g,h,f,e);
case "esriGeometryMultipoint":return(h,d,f,e)=>r.unquantizeMultipoint(d,g,h,f,e);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${p}`)),h=>h}}const n=new Map;return function(p,g,h,d,f){if(c.isNone(p))return null;if(p.referencesGeometry()&&f){const {transform:e,hasZ:l,hasM:A}=f;n.has(d)||n.set(d,m(d));d=n.get(d)(g.geometry,e,l,A);g={...g,geometry:d}}g=p.repurposeFeature(g);try{return p.evaluate({...h,$feature:g})}catch(e){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
e),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){b=b.ZEROS;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,c,r,m,n,p,g,h){let d=function(){function A(w,u,z,y){this.graphics3DSymbolLayer=w;this.renderGeometries=u;this.boundingBox=z;this._drapeSourceRenderer=y;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var t=A.prototype;t.initialize=function(w){this.stage=w};t.setVisibility=function(w){if(null!=this.stage&&this._visible!==w)if((this._visible=w)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,
h.DirtyOperation.ADD);else if(w||this._addedToStage){for(const u of this.renderGeometries)u.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,h.DirtyState.VISIBILITIES)}};t.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,h.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};t.getCenterObjectSpace=function(w=r.create()){return c.set(w,0,0,0)};t.getBoundingBoxObjectSpace=
function(w=m.create()){return m.empty(w)};t.addObjectState=function(w,u){w===g.Object3DState.Highlight&&(this.renderGeometries.forEach(z=>{const y=z.addHighlight();u.addRenderGeometry(z,y,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,h.DirtyState.HIGHLIGHTS))};t.removeObjectState=function(w){this.renderGeometries.forEach(u=>{w.removeRenderGeometry(u)})};t.removeRenderGeometryObjectState=function(w,u){w.removeHighlight(u);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,
h.DirtyState.HIGHLIGHTS)};t.computeAttachmentOrigin=function(w){for(const u of this.renderGeometries)u.computeAttachmentOrigin(l)&&(w.draped.origin[0]+=l[0],w.draped.origin[1]+=l[1],w.draped.num++)};t.getProjectedBoundingBox=function(){var w=a._asyncToGenerator(function*(u,z,y,B,C){m.empty(C);for(let k=0;k<this.renderGeometries.length;k++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[k],u,f,y),m.expandWithRect(C,f);if(z){m.center(C,l);let k;u=p.demResolutionForBoundingBox(C,z.service.spatialReference,
z);try{k=yield z.service.queryElevation(l[0],l[1],B,u,"ground")}catch(q){}b.isSome(k)&&(C[2]=Math.min(C[2],k),C[5]=Math.max(C[5],k))}return C});return function(u,z,y,B,C){return w.apply(this,arguments)}}();t._getRenderGeometryProjectedBoundingRect=function(w,u,z,y){if(this.boundingBox)m.set(e,this.boundingBox);else{w=w.boundingSphere;const B=w[3];e[0]=w[0]-B;e[1]=w[1]-B;e[2]=w[2]-B;e[3]=w[0]+B;e[4]=w[1]+B;e[5]=w[2]+B}u(e,0,2);this.calculateRelativeScreenBounds&&y.push({location:m.center(e),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return m.toRect(e,z)};return A}();const f=n.create(),e=m.create(),l=r.create();return d})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,c){const r=Object.freeze({left:0,center:.5,right:1});b=Object.freeze({"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,
1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)});a.anchorFromPlacements=function(m,n){switch(n){case "bottom":return"left"===m?"bottom-left":"right"===m?"bottom-right":"bottom";case "center":return m;case "top":return"left"===m?"top-left":"right"===m?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(m){switch(m){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};
a.horizontalPlacementToAnchorX=r;a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(m){switch(m){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(m){return"middle"===m?"center":m};a.verticalPlacementFromAnchor=function(m){switch(m){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,r,m){function n(f,e,l){f.canvas||(f.canvas=document.createElement("canvas"));f.canvas.width=e;f.canvas.height=l;return f.canvas}let p=
function(){function f(l,A,t,w=2048){this.text=l;this._alignment=A;this._parameters=t;this._maxSize=w;this._textWidths=[];this._lineWidths=[];this._heightMetricsCached=this._displayWidth=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${l}`;this._lines=l.split(/\r?\n/)}var e=f.prototype;e._getLineXOffset=function(l){switch(this._alignment){case a.TextRenderAlignment.Left:return this._backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-
this._lineWidths[l])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[l]}};e.render=function(l,A=0,t=0){l.save();A/=this.renderPixelRatio;t/=this.renderPixelRatio;const w=A,u=t;var z=this._haloSize,y=this._firstLineYOffset;A+=z;t+=y+this._baselinePosition;const B=0<this._haloSize;B&&this._renderHalo(l,w,u,z,y);this._setFontProperties(l,this._renderedFontSize);for(z=0;z<this._lines.length;++z){const C=this._lines[z],k=this._getLineXOffset(z);
B&&(l.globalCompositeOperation="destination-out",l.fillStyle="rgb(0, 0, 0)",this._fillText(l,C,A+k,t),this._renderLineDecoration(l,A+k,t,this._textWidths[z]));l.globalCompositeOperation="source-over";l.fillStyle=this._parameters.textStyle;this._fillText(l,C,A+this._getLineXOffset(z),t);this._renderLineDecoration(l,A+k,t,this._textWidths[z]);t+=this._lineSpacing}if(m.TEXT_SHOW_BASELINE)for(l.strokeStyle="rgb(255, 0, 255, 0.5)",l.setLineDash([2,2]),l.lineWidth=1,A=u+y,t=0;t<this._lines.length;++t)y=
A+this._baselinePosition,this._drawLine(l,[w,y],[w+this.displayWidth,y]),A+=this._lineSpacing;m.TEXT_SHOW_BORDER&&(l.strokeStyle="rgb(255, 0, 255, 0.5)",l.setLineDash([]),l.lineWidth=1,this._drawBox(l,[w,u],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(l,w,u,this._parameters.definition.background.borderRadius*this.renderPixelRatio),l.globalCompositeOperation="destination-over",l.fillStyle=this._parameters.backgroundStyle,l.fill());l.restore()};e._renderLineDecoration=
function(l,A,t,w,u=!1){if("none"!==this._parameters.definition.font.decoration&&0!==w){var z=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":t+=2*z;break;case "line-through":t-=.33*this._baselinePosition}var y=u?this._haloSize:0;l.strokeStyle=u?this._parameters.haloStyle:this._parameters.textStyle;l.lineWidth=this._toRenderUnit(z+2*y);l.beginPath();l.moveTo(this._toRenderUnit(A-y),this._toRenderUnit(t));l.lineTo(this._toRenderUnit(A+
w+y),this._toRenderUnit(t));l.stroke()}};e._roundedRect=function(l,A,t,w){A=this._toRenderUnit(A);t=this._toRenderUnit(t);const u=this.renderedWidth,z=this.renderedHeight;0===w?l.rect(A,t,u,z):(w=c.clamp(w,0,Math.floor(z/2)),l.beginPath(),l.moveTo(A,t+w),l.arcTo(A,t,A+w,t,w),l.lineTo(A+u-w,t),l.arcTo(A+u,t,A+u,t+w,w),l.lineTo(A+u,t+z-w),l.arcTo(A+u,t+z,A+u-w,t+z,w),l.lineTo(A+w,t+z),l.arcTo(A,t+z,A,t+z-w,w),l.closePath())};e._renderHalo=function(l,A,t,w,u){const z=this.renderedWidth,y=this.renderedHeight,
B=n(h,Math.max(z,512),Math.max(y,512)),C=B.getContext("2d");C.clearRect(0,0,z,y);this._setFontProperties(C,this._renderedFontSize);C.fillStyle=this._parameters.haloStyle;C.strokeStyle=this._parameters.haloStyle;var k=3>this._renderedHaloSize;C.lineJoin=k?"miter":"round";k?this._renderHaloEmulated(C,w,u):this._renderHaloNative(C,w,u);u+=this._baselinePosition;for(k=0;k<this._lines.length;++k){const q=this._getLineXOffset(k);this._renderLineDecoration(C,w+q,u,this._textWidths[k],!0);u+=this._lineSpacing}l.globalAlpha=
this._parameters.definition.halo.color[3];l.drawImage(B,0,0,z,y,this._toRenderUnit(A),this._toRenderUnit(t),z,y);l.globalAlpha=1};e._renderHaloEmulated=function(l,A,t){t+=this._baselinePosition;for(let w=0;w<this._lines.length;++w){const u=this._lines[w],z=this._getLineXOffset(w);for(const [y,B]of g)this._fillText(l,u,A+z+this._haloSize*y,t+this._haloSize*B);t+=this._lineSpacing}};e._renderHaloNative=function(l,A,t){const w=2*this._haloSize;t+=this._baselinePosition;for(let u=0;u<this._lines.length;++u){const z=
this._lines[u],y=this._getLineXOffset(u);for(let B=0;5>B;B++)l.lineWidth=this._toRenderUnit((.6+.1*B)*w),this._strokeText(l,z,A+y,t);t+=this._lineSpacing}};e._setFontProperties=function(l,A){l.font=this._parameters.fontString(A);l.textAlign="left";l.textBaseline="alphabetic"};e._ensureTextWidth=function(){if(r.isSome(this._displayWidth))return this._displayWidth;const l=n(h,512,512).getContext("2d");this._setFontProperties(l,this._fontSize);let A=2*this._haloSize;var t=this._parameters.definition.font;
if("italic"===t.style||"oblique"===t.style||"bold"===t.weight||"bolder"===t.weight)A+=.3*l.measureText("A").width;this._textWidths.length=0;t=this._lineWidths.length=0;for(const w of this._lines){const u=l.measureText(w).width,z=u+A;this._textWidths.push(u);this._lineWidths.push(z);t=Math.max(t,z)}return this._displayWidth=t};e._ensureHeightMetrics=function(){if(r.isNone(this._heightMetricsCached)){var l=n(h,512,512).getContext("2d");this._setFontProperties(l,this._fontSize);const A=l.measureText(this.text+
d),t=this._hasBackground?l.measureText(this._lines[0]):A;l=1===this._lines.length?t:this._hasBackground?l.measureText(this._lines[this._lines.length-1]):A;this._heightMetricsCached={paddingTop:A.actualBoundingBoxAscent-t.actualBoundingBoxAscent,paddingBottom:A.actualBoundingBoxDescent-l.actualBoundingBoxDescent,lineHeight:A.actualBoundingBoxAscent+A.actualBoundingBoxDescent,baselinePosition:A.actualBoundingBoxAscent}}return this._heightMetricsCached};e._toRenderUnit=function(l){return l*this.renderPixelRatio};
e._toRoundedRenderUnit=function(l){return Math.round(l*this.renderPixelRatio)};e._fillText=function(l,A,t,w){l.fillText(A,this._toRenderUnit(t),this._toRenderUnit(w))};e._strokeText=function(l,A,t,w){l.strokeText(A,this._toRenderUnit(t),this._toRenderUnit(w))};e._drawLine=function(l,A,t){l.beginPath();l.moveTo(this._toRoundedRenderUnit(A[0])+.5,this._toRoundedRenderUnit(A[1])+.5);l.lineTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5);l.stroke()};e._drawBox=function(l,A,t){var w=
this._toRenderUnit(A[0]);A=this._toRenderUnit(A[1]);var u=this._toRenderUnit(t[0]);const z=this._toRenderUnit(t[1]);t=Math.floor(w)+.5;w=Math.ceil(w+u)-.5;u=Math.floor(A)+.5;A=Math.ceil(A+z)-.5;l.beginPath();l.moveTo(t,u);l.lineTo(w,u);l.lineTo(w,A);l.lineTo(t,A);l.lineTo(t,u);l.stroke()};b._createClass(f,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this._lineSpacing*(this._lines.length-
1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},
{key:"_heightMetrics",get:function(){return this._ensureHeightMetrics()}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",get:function(){return this._heightMetrics.lineHeight}},{key:"_linePadding",get:function(){return.2*this._lineHeight}},{key:"_baselinePosition",get:function(){return this._heightMetrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},
{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",
get:function(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingBottom)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(r.isNone(this._renderPixelRatio)){const l=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this._maxSize?Math.min(l,Math.min(this._maxSize/
this.displayWidth,this._maxSize/this.displayHeight)):l}return this._renderPixelRatio}}]);return f}();const g=[];for(let f=0;360>f;f+=22.5)g.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);a.TextRenderAlignment=void 0;(function(f){f[f.Left=0]="Left";f[f.Center=1]="Center";f[f.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const h={canvas:null},d=(()=>{let f="";for(let e=32;127>e;e++)f+=String.fromCharCode(e);return f})();a.TextRenderer=p;a.getTextHelperCanvas=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){function e(K){return null!==K&&void 0!==K}function l(K){return"number"===
typeof K}function A(K){return"string"===typeof K}function t(K,O){K&&K.push(O)}function w(K,O,P,N=p.create()){K=K||0;O=O||0;P=P||0;0!==K&&n.rotateZ(N,N,-K/180*Math.PI);0!==O&&n.rotateX(N,N,O/180*Math.PI);0!==P&&n.rotateY(N,N,P/180*Math.PI);return N}function u(K,O,P,N,H){const E=K.minSize,I=K.maxSize;if(K.expression)return t(H,"Could not convert size info: expression not supported"),!1;if(K.useSymbolValue)return K=N.symbolSize[P],O.minSize[P]=K,O.maxSize[P]=K,O.offset[P]=O.minSize[P],O.factor[P]=0,
O.type[P]=a.FastSizeType.DefinedSize,!0;if(e(K.field)){if(e(K.stops)){if(2===K.stops.length&&l(K.stops[0].size)&&l(K.stops[1].size))return z(K.stops[0].size,K.stops[1].size,K.stops[0].value,K.stops[1].value,O,P),O.type[P]=a.FastSizeType.DefinedSize,!0;t(H,"Could not convert size info: stops only supported with 2 elements");return!1}if(l(E)&&l(I)&&e(K.minDataValue)&&e(K.maxDataValue))return z(E,I,K.minDataValue,K.maxDataValue,O,P),O.type[P]=a.FastSizeType.DefinedSize,!0;if(null!=d.meterIn[K.valueUnit])return O.minSize[P]=
-Infinity,O.maxSize[P]=Infinity,O.offset[P]=0,O.factor[P]=1/d.meterIn[K.valueUnit],O.type[P]=a.FastSizeType.DefinedSize,!0;if("unknown"===K.valueUnit)return t(H,"Could not convert size info: proportional size not supported"),!1;t(H,"Could not convert size info: scale-dependent size not supported");return!1}if(!e(K.field)){if(K.stops&&K.stops[0]&&l(K.stops[0].size))return O.minSize[P]=K.stops[0].size,O.maxSize[P]=K.stops[0].size,O.offset[P]=O.minSize[P],O.factor[P]=0,O.type[P]=a.FastSizeType.DefinedSize,
!0;if(l(E))return O.minSize[P]=E,O.maxSize[P]=E,O.offset[P]=E,O.factor[P]=0,O.type[P]=a.FastSizeType.DefinedSize,!0}t(H,"Could not convert size info: unsupported variant of sizeInfo");return!1}function z(K,O,P,N,H,E){N=0<Math.abs(N-P)?(O-K)/(N-P):0;H.minSize[E]=0<N?K:O;H.maxSize[E]=0<N?O:K;H.offset[E]=K-P*N;H.factor[E]=N}function y(K,O,P,N){if(K.normalizationField||K.valueRepresentation)return t(N,"Could not convert size info: unsupported property"),null;var H=K.field;if(null!=H&&!A(H))return t(N,
"Could not convert size info: field is not a string"),null;if(!O.size)O.size={field:K.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(K.field)if(!O.size.field)O.size.field=K.field;else if(K.field!==O.size.field)return t(N,"Could not convert size info: multiple fields in use"),null;switch(K.axis){case "width":return(H=u(K,O.size,0,P,N))?O:null;case "height":return(H=u(K,O.size,2,P,N))?O:null;
case "depth":return(H=u(K,O.size,1,P,N))?O:null;case "width-and-depth":return(H=u(K,O.size,0,P,N))&&u(K,O.size,1,P,N),H?O:null;case null:case void 0:case "all":return(H=(H=(H=u(K,O.size,0,P,N))&&u(K,O.size,1,P,N))&&u(K,O.size,2,P,N))?O:null;default:return t(N,`Could not convert size info: unknown axis "${K.axis}""`),null}}function B(K,O,P){for(let N=0;3>N;++N){let H=O.unitInMeters;K.type[N]===a.FastSizeType.DefinedSize&&(H*=O.modelSize[N],K.type[N]=a.FastSizeType.DefinedScale);K.minSize[N]/=H;K.maxSize[N]/=
H;K.offset[N]/=H;K.factor[N]/=H}if(K.type[0]!==a.FastSizeType.Undefined)O=0;else if(K.type[1]!==a.FastSizeType.Undefined)O=1;else if(K.type[2]!==a.FastSizeType.Undefined)O=2;else return t(P,"No size axis contains a valid size or scale"),!1;for(P=0;3>P;++P)K.type[P]===a.FastSizeType.Undefined&&(K.minSize[P]=K.minSize[O],K.maxSize[P]=K.maxSize[O],K.offset[P]=K.offset[O],K.factor[P]=K.factor[O],K.type[P]=K.type[O]);return!0}function C(K,O,P){K[4*O]=P.r/255;K[4*O+1]=P.g/255;K[4*O+2]=P.b/255;K[4*O+3]=
P.a}function k(K,O,P){if(K.normalizationField)return t(P,"Could not convert color info: unsupported property"),null;if(A(K.field))if(K.stops){if(8<K.stops.length)return t(P,"Could not convert color info: too many color stops"),null;O.color={field:K.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};K=K.stops;for(P=0;8>P;++P){const N=K[Math.min(P,K.length-1)];O.color.values[P]=N.value;C(O.color.colors,P,N.color)}}else return t(P,"Could not convert color info: missing stops or colors"),
null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].color,O.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},P=0;8>P;P++)O.color.values[P]=Infinity,C(O.color.colors,P,K);else return t(P,"Could not convert color info: no field and no colors/stops"),null;return O}function q(K,O,P){if(K.normalizationField)return t(P,"Could not convert opacity info: unsupported property"),null;if(A(K.field))if(K.stops){if(8<
K.stops.length)return t(P,"Could not convert opacity info: too many opacity stops"),null;O.opacity={field:K.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};K=K.stops;for(P=0;8>P;++P){const N=K[Math.min(P,K.length-1)];O.opacity.values[P]=N.value;O.opacity.opacityValues[P]=N.opacity}}else return t(P,"Could not convert opacity info: missing stops or opacities"),null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].opacity,O.opacity={field:null,values:[0,
0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},P=0;8>P;P++)O.opacity.values[P]=Infinity,O.opacity.opacityValues[P]=K;else return t(P,"Could not convert opacity info: no field and no opacities/stops"),null;return O}function x(K,O,P){K=2===P&&"arithmetic"===K.rotationType;O.offset[P]=K?90:0;O.factor[P]=K?-1:1;O.type[P]=1}function v(K,O,P){if(!A(K.field))return t(P,"Could not convert rotation info: field is not a string"),null;if(!O.rotation)O.rotation={field:K.field,offset:[0,0,0],factor:[1,1,1],type:[0,
0,0]};else if(K.field)if(!O.rotation.field)O.rotation.field=K.field;else if(K.field!==O.rotation.field)return t(P,"Could not convert rotation info: multiple fields in use"),null;switch(K.axis){case "tilt":return x(K,O.rotation,0),O;case "roll":return x(K,O.rotation,1),O;case null:case void 0:case "heading":return x(K,O.rotation,2),O;default:return t(P,`Could not convert rotation info: unknown axis "${K.axis}""`),null}}function D(K,O,P){if(!K)return null;const N=!O.supportedTypes||!!O.supportedTypes.size,
H=!O.supportedTypes||!!O.supportedTypes.color,E=!O.supportedTypes||!!O.supportedTypes.rotation,I=!!O.supportedTypes&&!!O.supportedTypes.opacity,M=K.reduce((Q,T)=>{if(!Q)return Q;if(T.valueExpression)return t(P,"Could not convert visual variables: arcade expressions not supported"),null;switch(T.type){case "size":return N?y(T,Q,O,P):Q;case "color":return H?k(T,Q,P):Q;case "opacity":return I?q(T,Q,P):null;case "rotation":return E?v(T,Q,P):Q;default:return null}},{size:null,color:null,opacity:null,rotation:null});
return 0<K.length&&M&&!M.size&&!M.color&&!M.opacity&&!M.rotation||M&&M.size&&!B(M.size,O,P)?null:M}function F(K,O,P){if(!!K!==!!O||K&&K.field!==O.field)return!1;if(K&&"rotation"===P)for(P=0;3>P;P++)if(K.type[P]!==O.type[P]||K.offset[P]!==O.offset[P]||K.factor[P]!==O.factor[P])return!1;return!0}function G(K,O){const P={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,
vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},N=K&&null!=K.size;K&&K.size?(P.vvSizeEnabled=!0,P.vvSizeMinSize=K.size.minSize,P.vvSizeMaxSize=K.size.maxSize,P.vvSizeOffset=K.size.offset,P.vvSizeFactor=K.size.factor):K&&N&&(P.vvSizeValue=O.transformation.scale);K&&N&&(P.vvSymbolAnchor=O.transformation.anchor,P.vvSymbolRotationMatrix=m.create(),n.identity(L),w(O.transformation.rotation[2],O.transformation.rotation[0],O.transformation.rotation[1],L),r.fromMat4(P.vvSymbolRotationMatrix,
L));K&&K.color&&(P.vvColorEnabled=!0,P.vvColorValues=K.color.values,P.vvColorColors=K.color.colors);K&&K.opacity&&(P.vvOpacityEnabled=!0,P.vvOpacityValues=K.opacity.values,P.vvOpacityOpacities=K.opacity.opacityValues);return P}a.FastSizeType=void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedSize=1]="DefinedSize";K[K.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||
(a.FastRotationType={}));var J;(function(K){const O=p.create(),P=h.create();K.evaluateModelTransform=function(N,H,E){if(!N.vvSizeEnabled)return E;n.copy(O,E);E=N.vvSymbolRotationMatrix;n.set(L,E[0],E[1],E[2],0,E[3],E[4],E[5],0,E[6],E[7],E[8],0,0,0,0,1);n.multiply(O,O,L);for(E=0;3>E;++E)P[E]=c.clamp(N.vvSizeOffset[E]+H[0]*N.vvSizeFactor[E],N.vvSizeMinSize[E],N.vvSizeMaxSize[E]);n.scale(O,O,P);n.translate(O,O,N.vvSymbolAnchor);return O};K.evaluateModelTransformScale=function(N,H,E){if(!H.vvSizeEnabled)return g.set(N,
1,1,1);for(let I=0;3>I;++I)N[I]=c.clamp(H.vvSizeOffset[I]+E[0]*H.vvSizeFactor[I],H.vvSizeMinSize[I],H.vvSizeMaxSize[I]);return N}})(J||(J={}));const L=p.create();b=J.evaluateModelTransform;J=J.evaluateModelTransformScale;a.convertVisualVariables=D;a.evaluateModelTransform=b;a.evaluateModelTransformScale=J;a.getMaterialParams=G;a.initFastSymbolUpdatesState=function(K,O){return!K||f.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(K=D(K.visualVariables,O))?{enabled:!0,visualVariables:K,materialParameters:G(K,
O),requiresShaderTransformation:K&&null!=K.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(K,O,P){if(!O||!K.enabled)return!1;const N=K.visualVariables;O=D(O.visualVariables,P);if(!(O&&F(N.size,O.size,"size")&&F(N.color,O.color,"color")&&F(N.rotation,O.rotation,"rotation")&&F(N.opacity,O.opacity,"opacity")))return!1;K.visualVariables=O;K.materialParameters=G(O,P);K.requiresShaderTransformation=O&&null!=O.size;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./basicInterfaces ./geometryDataUtils ./InstanceParameters ./Object3DStateID ./VertexAttribute ../materials/renderers/utils".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){let w=function(){function z(B,C,k={}){this.data=
B;this.material=C;this.boundingSphere=g.create();this.instanceParameters=new e.InstanceParameters;this._transformation=n.create();this._shaderTransformationDirty=!0;this.layerUid=c.unwrapOr(k.layerUid,null);this.graphicUid=c.unwrapOr(k.graphicUid,null);this.id=k.id?k.id:r.generateUID();this.boundingInfo=c.unwrapOr(k.boundingInfo,null);this.calculateShaderTransformation=c.unwrapOr(k.calculateShaderTransformation,null);this.castShadow=k.castShadow?k.castShadow:!1}var y=z.prototype;y.updateTransformation=
function(B){B(this._transformation);this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};y.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};y.computeBoundingSphere=function(B,C,k=h.maxScale(B)){c.isNone(this.boundingInfo)||(p.transformMat4(C,this.boundingInfo.getCenter(),B),C[3]=this.boundingInfo.getBSRadius()*k)};y.getShaderTransformation=function(){if(c.isNone(this.calculateShaderTransformation))return c.unwrapOr(this.transformation,
n.IDENTITY);this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=n.create()),m.copy(this._shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,n.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};y.computeAttachmentOrigin=function(B){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,B)?(c.isSome(this._transformation)&&p.transformMat4(B,B,this._transformation),
!0):!1;const C=this.indices.get(A.VertexAttribute.POSITION),k=this.vertexAttributes.get(A.VertexAttribute.POSITION);return f.computeAttachmentOriginTriangles(k,C,B)?(c.isSome(this._transformation)&&p.transformMat4(B,B,this._transformation),!0):!1};y.addHighlight=function(){const B=new l.Object3DStateID(d.Object3DState.Highlight),C=this.instanceParameters;C.highlights=t.addObject3DStateID(C.highlights,B);return B};y.removeHighlight=function(B){const C=this.instanceParameters;C.highlights=t.removeObject3DStateID(C.highlights,
B)};b._createClass(z,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return c.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return z}(),u=function(z){function y(){return z.apply(this,arguments)||this}b._inheritsLoose(y,z);return y}(w);
a.RenderGeometry=w;a.ValidatedRenderGeometry=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/InstanceParameters":function(){define(["exports"],function(a){a.InstanceParameters=function(){this.visible=!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/engineContent/marker ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K){const O=["polyline","polygon","extent"];c=function(N){function H(I,M,Q,T){return N.call(this,I,M,Q,T)||this}b._inheritsLoose(H,N);var E=H.prototype;E.doLoad=function(){var I=b._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&
this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?B.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:n.px2pt(1)))throw new r("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=m.isSome(this.symbolLayer.marker)&&m.isSome(this._context.sharedResources.textures)?q.prepareMarkerResources(this._context.sharedResources.textures,
y.parseLineMarkerStyle(this.symbolLayer.marker.style)):null});return function(){return I.apply(this,arguments)}}();E._getMaterialParameters=function(I,M=!1){const Q=this._getCombinedOpacityAndColor(M&&this._markerColor||this._materialColor);this._patternHidesLine&&!M&&(Q[3]=0);I={width:this._computeMaterialWidth(this.symbolLayer?.size),color:Q,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:y.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:I,
stipplePattern:G.getStipplePatternForLinePattern(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...I,...this._fastUpdates.materialParameters}:I};E.destroy=function(){N.prototype.destroy.call(this);this._forEachMaterial(I=>this._context.stage.remove(I));this._markerMaterialCached=this._wireframeRingMaterialCached=this._wireframeLineMaterialCached=this._ringMaterialCached=this._lineMaterialCached=null;this._markerTexture=m.releaseMaybe(this._markerTexture)};
E._getDrivenSize=function(I){return this._drivenProperties.size&&I.size?n.pt2px(f.getDriverAxisSizeValueAny(I.size)):1};E._getSizeFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?u.getAttributeValue(this._fastUpdates.visualVariables.size.field,I):null};E._getDrivenColor=function(I){const M=h.fromValues(1,1,1,1);this._drivenProperties.color&&I.color&&(M[0]=I.color[0],M[1]=I.color[1],M[2]=I.color[2],0<I.color.length&&(M[3]=I.color[3]));this._drivenProperties.opacity&&
I.opacity&&(M[3]=I.opacity);return M};E._getColorFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?u.getAttributeValue(this._fastUpdates.visualVariables.color.field,I):null};E._getOpacityFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?u.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,I):null};E.createGraphics3DGraphic=function(I){const M=I.graphic;if(!this._validateGeometry(M.geometry,
O,this.symbolLayer.type))return null;const Q=this.setGraphicElevationContext(M,new A.ElevationContext);this.ensureDrapedStatus("on-the-ground"===Q.mode);return this.draped?this._createAsOverlay(I,this._context.layer.uid):this._createAs3DShape(I,Q,M.uid)};E.applyRendererDiff=function(I,M){for(const Q in I.diff)switch(Q){case "visualVariables":if(B.updateFastSymbolUpdatesState(this._fastUpdates,M,this._vvConvertOptions))this._forEachMaterial(T=>T.setParameters(this._fastUpdates.materialParameters));
else return z.ApplyRendererDiffResult.Recreate_Symbol;break;default:return z.ApplyRendererDiffResult.Recreate_Symbol}return z.ApplyRendererDiffResult.Fast_Update};E.prepareSymbolLayerPatch=function(I){if("partial"===I.diff.type){var M=I.diff.diff,Q={};"complete"===M.size?.type&&(Q.width=this._computeMaterialWidth(M.size.newValue),delete M.size);"complete"===M.cap?.type&&(Q.cap=y.parseCapType(m.unwrapOr(M.cap.newValue,"butt")),delete M.cap);var T=this._prepareMarkerPatch(I,M);this._prepareMaterialPatch(I,
M,T);I.symbolLayerStatePatches.push(()=>this._forEachMaterial(S=>S.setParameters(Q)))}};E.layerOpacityChanged=function(){this._forEachMaterial((I,M)=>this._updateMaterialLayerOpacity(I,M))};E._forEachMaterial=function(I){m.isSome(this._lineMaterialCached)&&I(this._lineMaterialCached);m.isSome(this._ringMaterialCached)&&I(this._ringMaterialCached);m.isSome(this._wireframeLineMaterialCached)&&I(this._wireframeLineMaterialCached);m.isSome(this._wireframeRingMaterialCached)&&I(this._wireframeRingMaterialCached);
m.isSome(this._markerMaterialCached)&&I(this._markerMaterialCached,!0)};E._updateMaterialLayerOpacity=function(I,M=!1){var Q=I.parameters.color;const T=m.get(this.symbolLayer,"material","color");M=this._patternHidesLine&&!M?0:this._getCombinedOpacity(T);Q=h.fromValues(Q[0],Q[1],Q[2],M);I.setParameters({color:Q})};E.layerElevationInfoChanged=function(I,M,Q){const T=this._elevationContext.mode;Q=l.elevationModeChangeUpdateType(H.elevationModeChangeTypes,Q,T);if(Q!==l.SymbolUpdateType.UPDATE)return Q;
const S=l.needsElevationUpdates2D(T);return this.updateGraphics3DGraphicElevationInfo(I,M,()=>S)};E.slicePlaneEnabledChanged=function(){const I={hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(M=>M.setParameters(I));return!0};E.physicalBasedRenderingChanged=function(){return!0};E.pixelRatioChanged=function(){return!0};E._getGeometryAsPolygonOrPolyline=function(I){switch(I.type){case "extent":if(I instanceof L)return K.fromExtent(I);break;case "polygon":case "polyline":return I}return null};
E._createAs3DShape=function(I,M,Q){const T=this._getGeometryAsPolygonOrPolyline(I.graphic.geometry);var S="polygon"===T.type?T.rings:T.paths,U=[];const Y=[],V=[],R=d.create(),X=x.geometryToRenderInfo(T,this._context.elevationProvider,this._context.renderCoordsHelper,M);this._logGeometryCreationWarnings(X,S,"polygon"===T.type?"rings":"paths","LineSymbol3DLayer");for(S=0;S<X.lines.length;S++){const {position:W,mapPosition:aa}=X.lines[S];if(m.isSome(this._context.clippingExtent)&&(d.empty(R),d.expandWithBuffer(R,
aa),!d.intersectsClippingArea(R,this._context.clippingExtent)))continue;const ba=this._createGeometry(I,W,aa,T.type,P.ELEVATED,Q);U.push(ba);Y.push("polygon"===T.type?this._ringMaterial:this._lineMaterial);V.push(p.IDENTITY);C.LINE_WIREFRAMES&&(U.push(ba.cloneShallow()),Y.push("polygon"===T.type?this._wireframeRingMaterial:this._wireframeLineMaterial),V.push(p.IDENTITY));const ia=this._markerMaterial;m.isSome(ia)&&(U.push(ba.cloneShallow()),Y.push(ia),V.push(p.IDENTITY))}if(0===U.length)return null;
I=new v.Object3D({geometries:U,materials:Y,transformations:V,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:Q}});U=new w.Graphics3DObject3DGraphicLayer(this,I,U,null,null,e.sharedGeometryElevationAligner,M);U.alignedSampledElevation=X.sampledElevation;U.needsElevationUpdates=l.needsElevationUpdates2D(M.mode);return U};E._createGeometry=function(I,M,Q,T,S,U){T="polygon"===T;const Y=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,V=this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.size;U=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:U,layerUid:this._context.layer.uid});return k.createGeometry({overlayInfo:S===P.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:T,attributeData:{position:M,mapPosition:Q,size:V?null:this._getDrivenSize(I.renderingInfo),color:Y?null:this._getDrivenColor(I.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(I.graphic),
colorFeature:this._getColorFeatureAttributeData(I.graphic),opacityFeature:this._getOpacityFeatureAttributeData(I.graphic)}},U)};E._createAsOverlay=function(I,M){const Q=I.graphic,T=this._getGeometryAsPolygonOrPolyline(Q.geometry);var S="polygon"===T.type?T.rings:T.paths;const U="polygon"===T.type?this._ringMaterial:this._lineMaterial;U.renderPriority=this._renderPriority;const Y=C.LINE_WIREFRAMES?"polygon"===T.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,V=this._markerMaterial;
m.isSome(Y)&&(Y.renderPriority=this._renderPriority-.001);m.isSome(V)&&(V.renderPriority=this._renderPriority-.002);const R=[],X=d.create(),W=d.empty();var aa=x.geometryToRenderInfoDraped(T,this._context.overlaySR);this._logGeometryCreationWarnings(aa,S,"polygon"===T.type?"rings":"paths","LineSymbol3DLayer");for(const ba of aa.lines){d.empty(X);d.expandWithBuffer(X,ba.position);if(!d.intersectsClippingArea(X,this._context.clippingExtent))continue;d.expandWithAABB(W,X);const ia=this._createGeometry(I,
ba.position,null,T.type,P.DRAPED,Q.uid);S=ma=>{ma=new D.RenderGeometry(ia,ma,{layerUid:M,graphicUid:Q.uid});R.push(ma);return ma};if(m.isSome(V)){aa=S(V);const ma=m.unwrap(this.symbolLayer.marker).placement;"begin"!==ma&&"begin-end"!==ma||d.expandWithBuffer(X,ba.position,0,1);"end"!==ma&&"begin-end"!==ma||d.expandWithBuffer(X,ba.position,ba.position.length-3,1);this._updateBoundingSphere(aa,X)}aa=S(U);this._updateBoundingSphere(aa,X);C.LINE_WIREFRAMES&&(S=S(Y),this._updateBoundingSphere(S,X))}return new t(this,
R,W,this._context.drapeSourceRenderer)};E._updateBoundingSphere=function(I,M){g.set(I.boundingSphere,.5*(M[0]+M[3]),.5*(M[1]+M[4]),0,.5*Math.sqrt((M[3]-M[0])*(M[3]-M[0])+(M[4]-M[1])*(M[4]-M[1])))};E._computeMaterialWidth=function(I){I=m.unwrapOr(I,n.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?n.pt2px(1):1:n.pt2px(I)};E._prepareMaterialPatch=function(I,M,Q){var T=M.material;m.isNone(T)?Q.changed&&Q.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),
this._markerMaterialCached,I):"collection"!==T.type&&(T="complete"===T.type?m.applySome(T.newValue,S=>S.color):"complete"===T.diff.color.type?T.diff.color.newValue:null,T=this._getCombinedOpacityAndColor(T),Q.useMaterialColor&&this._patchMaterialColor(h.clone(T),this._markerMaterialCached,I),this._patternHidesLine&&(T[3]=0),this._patchMaterialColor(T,this._lineMaterialCached,I),delete M.material)};E._prepareMarkerPatch=function(I,M){var Q=M.marker;if(m.isNone(Q)||"partial"!==Q.type||m.isSome(Q.diff.style)||
m.isSome(Q.diff.placement)||m.isSome(Q.diff.color)&&"complete"!==Q.diff.color.type)return{changed:!1,useMaterialColor:m.isNone(this._markerColor)};Q=Q.diff.color;if(m.isNone(Q))return delete M.marker,{changed:!1,useMaterialColor:m.isNone(this._markerColor)};Q=m.unwrap(Q.newValue);if(m.isNone(Q))return delete M.marker,{changed:!0,useMaterialColor:!0};this._patchMaterialColor(this._getCombinedOpacityAndColor(Q),this._markerMaterialCached,I);delete M.marker;return{changed:!0,useMaterialColor:!1}};E._patchMaterialColor=
function(I,M,Q){m.isNone(M)||Q.symbolLayerStatePatches.push(()=>M.setParameters({color:I}))};b._createClass(H,[{key:"_materialColor",get:function(){return m.applySome(this.symbolLayer.material,I=>I.color)}},{key:"_markerColor",get:function(){return m.applySome(this.symbolLayer.marker,I=>I.color)}},{key:"_lineMaterial",get:function(){m.isNone(this._lineMaterialCached)&&(this._lineMaterialCached=new J.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached));
return this._lineMaterialCached}},{key:"_ringMaterial",get:function(){m.isNone(this._ringMaterialCached)&&(this._ringMaterialCached=new J.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached));return this._ringMaterialCached}},{key:"_wireframeLineMaterial",get:function(){m.isNone(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new J.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached));
return this._wireframeLineMaterialCached}},{key:"_wireframeRingMaterial",get:function(){m.isNone(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new J.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached));return this._wireframeRingMaterialCached}},{key:"_markerMaterial",get:function(){m.isNone(this._markerMaterialCached)&&m.isSome(this.symbolLayer.marker)&&m.isSome(this._markerTexture)&&(this._markerMaterialCached=
new F.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached));return this._markerMaterialCached}},{key:"_patternHidesLine",get:function(){const I=this.symbolLayer.pattern;return m.isSome(I)&&"style"===I.type&&"none"===I.style}}]);return H}(u.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:l.SymbolUpdateType.RECREATE,staysOnTheGround:l.SymbolUpdateType.NONE,
onTheGroundChanged:l.SymbolUpdateType.RECREATE};var P;(function(N){N[N.DRAPED=0]="DRAPED";N[N.ELEVATED=1]="ELEVATED"})(P||(P={}));a.Graphics3DLineSymbolLayer=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,c){a.parseCapType=function(r){switch(r){case "butt":return c.CapType.BUTT;case "square":return c.CapType.SQUARE;
case "round":return c.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(r){return"diamond"===r?"kite":r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../ViewingMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.RemoveDuplicateStartEnd=void 0;(function(w){w[w.KEEP=0]="KEEP";w[w.REMOVE=1]="REMOVE"})(a.RemoveDuplicateStartEnd||(a.RemoveDuplicateStartEnd={}));const A=n.create(),t=n.create();a.createGeometry=function(w,u=null){const z=[],y=[],{attributeData:{position:B},removeDuplicateStartEnd:C}=w;var k=B.length;k=B[0]===B[k-3]&&B[1]===B[k-2]&&B[2]===B[k-1]&&C;var q=B.length/3-(k?1:0),x=Array(2*(q-1)),v=k?c.slice(B,0,B.length-3):B,D=0;for(var F=0;F<q-1;F++)x[D++]=F,x[D++]=
F+1;y.push([l.VertexAttribute.POSITION,{size:3,data:v,exclusive:k}]);z.push([l.VertexAttribute.POSITION,x]);q=y[0][1].data;k=Array(z[0][1].length).fill(0);x=w.attributeData.mapPosition;b.isNone(x)||(z.push([l.VertexAttribute.MAPPOS,z[0][1]]),y.push([l.VertexAttribute.MAPPOS,{size:3,data:x}]));b.isSome(w.attributeData.colorFeature)||(y.push([l.VertexAttribute.COLOR,{size:4,data:b.unwrapOr(w.attributeData.color,p.ONES)}]),z.push([l.VertexAttribute.COLOR,k]));b.isSome(w.attributeData.sizeFeature)||(y.push([l.VertexAttribute.SIZE,
{size:1,data:[b.unwrapOr(w.attributeData.size,1)]}]),z.push([l.VertexAttribute.SIZE,k]));b.isSome(w.attributeData.normal)&&(y.push([l.VertexAttribute.NORMAL,{size:3,data:w.attributeData.normal}]),z.push([l.VertexAttribute.NORMAL,k]));x=w.attributeData.colorFeature;b.isNone(x)||(y.push([l.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([x])}]),z.push([l.VertexAttribute.COLOR,k]));x=w.attributeData.sizeFeature;b.isNone(x)||(y.push([l.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,
data:new Float32Array([x])}]),z.push([l.VertexAttribute.SIZEFEATUREATTRIBUTE,k]));x=w.attributeData.opacityFeature;b.isNone(x)||(y.push([l.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([x])}]),z.push([l.VertexAttribute.OPACITYFEATUREATTRIBUTE,k]));if(!b.isNone(w.overlayInfo)&&w.overlayInfo.renderCoordsHelper.viewingMode===d.ViewingMode.Global&&w.overlayInfo.spatialReference.isGeographic){k=new Float64Array(q.length);w=h.getReferenceEllipsoid(w.overlayInfo.spatialReference);
for(x=0;x<k.length;x+=3)g.lonLatToWebMercatorComparable(q,x,k,x,w);w=q.length/3;q=new Float32Array(w+1);x=A;v=t;F=D=0;m.set(x,k[F++],k[F++],k[F++]);q[0]=0;for(let G=1;G<w+1;++G)G===w&&(F=0),m.set(v,k[F++],k[F++],k[F++]),D+=r.dist(x,v),q[G]=D,[x,v]=[v,x];y.push([l.VertexAttribute.DISTANCETOSTART,{size:1,data:q}]);z.push([l.VertexAttribute.DISTANCETOSTART,z[0][1]])}return new e.Geometry(y,z,f.PrimitiveType.Line,u)};a.lineStripsToParameters=function(w,u){if(b.isNone(w)||0===w.length)return[];const z=
[];w.forEach(y=>{const B=new Float64Array(3*y.length);y.forEach((C,k)=>{B[3*k]=C[0];B[3*k+1]=C[1];B[3*k+2]=C[2]});z.push({attributeData:{position:B,normal:u},removeDuplicateStartEnd:!1})});return z};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/renderInfoUtils/line":function(){define(["exports","../../../../geometry/projection","../../../../geometry/support/triangulationUtils","../../layers/graphics/elevationAlignmentUtils","../../terrain/OverlayRenderer"],
function(a,b,c,r,m){function n(p,g,h){const d=[];for(const {index:f,count:e}of p){if(1>=e)continue;p=3*f;const l=p+3*e;d.push({position:g.subarray(p,l),mapPosition:h?h.subarray(p,l):void 0})}return d}a.geometryToRenderInfo=function(p,g,h,d){const {position:f,outlines:e}=c.pathsToTriangulationInfo("polygon"===p.type?p.rings:p.paths,p.hasZ,"polygon"===p.type?c.CounterClockwiseMode.CCW_IS_HOLE:c.CounterClockwiseMode.NONE),l=new Float64Array(f.length);p=r.applyPerVertexElevationAlignment(f,p.spatialReference,
0,l,0,f,0,f.length/3,g,h,d);g=null!=p;return{lines:g?n(e,f,l):[],projectionSuccess:g,sampledElevation:p}};a.geometryToRenderInfoDraped=function(p,g){const {position:h,outlines:d}=c.pathsToTriangulationInfo("polygon"===p.type?p.rings:p.paths,!1,"polygon"===p.type?c.CounterClockwiseMode.CCW_IS_HOLE:c.CounterClockwiseMode.NONE);p=b.projectBuffer(h,p.spatialReference,0,h,g,0,h.length/3);for(g=2;g<h.length;g+=3)h[g]=m.DRAPED_Z;return{lines:p?n(d,h):[],projectionSuccess:p}};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){let w=function(k){function q(v){v=k.call(this,v,new z)||this;v._vertexAttributeLocations=l.vertexAttributeLocations;v._configuration=new A.LineMarkerTechniqueConfiguration;v._layout=v.createLayout();return v}b._inheritsLoose(q,k);var x=q.prototype;x.dispose=function(){};x.getConfiguration=function(v,D){this._configuration.output=v;this._configuration.space=D.slot===d.RenderSlot.DRAPED_MATERIAL?A.LineMarkerSpace.Draped:this.parameters.worldSpace?A.LineMarkerSpace.World:
A.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==t.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvColor=this.parameters.vvColorEnabled;
this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.occluder=this.parameters.renderOccluded===h.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.hasMultipassTerrain=D.multipassTerrain.enabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;return this._configuration};x.intersect=function(){};x.createLayout=
function(){const v=n.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0).vec3f(f.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&v.vec3f(f.VertexAttribute.NORMAL);this.parameters.vvSizeEnabled?v.f32(f.VertexAttribute.SIZEFEATUREATTRIBUTE):v.f32(f.VertexAttribute.SIZE);this.parameters.vvColorEnabled?v.f32(f.VertexAttribute.COLORFEATUREATTRIBUTE):v.vec4f(f.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&v.f32(f.VertexAttribute.OPACITYFEATUREATTRIBUTE);return v};
x.createBufferWriter=function(){return new y(this._layout,this.parameters)};x.requiresSlot=function(v,D){return D===p.ShaderOutput.Color||D===p.ShaderOutput.Alpha||D===p.ShaderOutput.Highlight||D===p.ShaderOutput.Depth?v===d.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===h.RenderOccludedFlag.OccludeAndTransparentStencil?v===d.RenderSlot.OPAQUE_MATERIAL||v===d.RenderSlot.OCCLUDER_MATERIAL||v===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:D===p.ShaderOutput.Color||D===p.ShaderOutput.Alpha?
v===(this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):v===d.RenderSlot.OPAQUE_MATERIAL:!1};x.createGLMaterial=function(v){return new u(v)};return q}(h.Material),u=function(k){function q(){return k.apply(this,arguments)||this}b._inheritsLoose(q,k);var x=q.prototype;x._updateParameters=function(v){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(l.LineMarkerTechnique,
v)};x._updateOccludeeState=function(v){v.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:v.hasOccludees})};x.beginSlot=function(v){this._output!==p.ShaderOutput.Color&&this._output!==p.ShaderOutput.Alpha||this._updateOccludeeState(v);return this._updateParameters(v)};return q}(g.GLTextureMaterial),z=function(k){function q(){var x=k.apply(this,arguments)||this;x.width=0;x.color=[1,1,1,1];x.placement="end";x.cap=t.CapType.BUTT;x.anchor=A.LineMarkerAnchor.Center;
x.hasTip=!1;x.worldSpace=!1;x.hideOnShortSegments=!1;x.writeDepth=!0;x.hasSlicePlane=!1;x.vvFastUpdate=!1;x.hasOccludees=!1;return x}b._inheritsLoose(q,k);return q}(e.VisualVariablePassParameters),y=function(){function k(x,v){this.vertexBufferLayout=x;this._parameters=v}var q=k.prototype;q.allocate=function(x){return this.vertexBufferLayout.createBuffer(x)};q.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};q.write=function(x,v,D,F,G){const J=D.vertexAttributes.get(f.VertexAttribute.POSITION).data,
L=J.length/3;let K=[1,0,0];v=D.vertexAttributes.get(f.VertexAttribute.NORMAL);this._parameters.worldSpace&&c.isSome(v)&&(K=v.data);let O=1,P=0;this._parameters.vvSizeEnabled?P=D.vertexAttributes.get(f.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:D.vertexAttributes.has(f.VertexAttribute.SIZE)&&(O=D.vertexAttributes.get(f.VertexAttribute.SIZE).data[0]);let N=[1,1,1,1],H=0;this._parameters.vvColorEnabled?H=D.vertexAttributes.get(f.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:D.vertexAttributes.has(f.VertexAttribute.COLOR)&&
(N=D.vertexAttributes.get(f.VertexAttribute.COLOR).data);let E=0;this._parameters.vvOpacityEnabled&&(E=D.vertexAttributes.get(f.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const I=new Float32Array(F.buffer);let M=this.vertexBufferLayout.stride/4*G;const Q=(S,U,Y,V)=>{I[M++]=S[0];I[M++]=S[1];I[M++]=S[2];I[M++]=Y[0];I[M++]=Y[1];I[M++]=U[0];I[M++]=U[1];I[M++]=U[2];this._parameters.worldSpace&&(I[M++]=K[0],I[M++]=K[1],I[M++]=K[2]);this._parameters.vvSizeEnabled?I[M++]=P:I[M++]=O;this._parameters.vvColorEnabled?
I[M++]=H:(S=Math.min(4*V,N.length-4),I[M++]=N[S+0],I[M++]=N[S+1],I[M++]=N[S+2],I[M++]=N[S+3]);this._parameters.vvOpacityEnabled&&(I[M++]=E)};let T;(function(S){S[S.ASCENDING=1]="ASCENDING";S[S.DESCENDING=-1]="DESCENDING"})(T||(T={}));D=(S,U)=>{const Y=r.set(B,J[3*S],J[3*S+1],J[3*S+2]),V=C;let R=S+U;do r.set(V,J[3*R],J[3*R+1],J[3*R+2]),R+=U;while(r.equals(Y,V)&&0<=R&&R<L);x&&(r.transformMat4(Y,Y,x),r.transformMat4(V,V,x));Q(Y,V,[-1,-1],S);Q(Y,V,[1,-1],S);Q(Y,V,[1,1],S);Q(Y,V,[-1,-1],S);Q(Y,V,[1,1],
S);Q(Y,V,[-1,1],S)};F=this._parameters.placement;"begin"!==F&&"begin-end"!==F||D(0,T.ASCENDING);"end"!==F&&"begin-end"!==F||D(L-1,T.DESCENDING)};return k}();const B=m.create(),C=m.create();a.LineMarkerMaterial=w;a.Parameters=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){const t=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.NORMAL,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);n=function(w){function u(){return w.apply(this,arguments)||this}c._inheritsLoose(u,w);var z=u.prototype;z.initializeProgram=function(y){return new g.Program(y.rctx,
u.shader.get().build(this.configuration),t)};z._makePipelineState=function(y,B){const C=this.configuration,k=y===f.TransparencyPassType.NONE;return A.makePipelineState({blending:C.output===r.ShaderOutput.Color||C.output===r.ShaderOutput.Alpha?k?p.blendingDefault:p.oitBlending(y):null,depthTest:{func:p.oitDepthTest(y)},depthWrite:k?C.writeDepth&&A.defaultDepthWriteParams:p.oitDepthWrite(y),colorWrite:A.defaultColorWriteParams,stencilWrite:C.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?
B?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};z.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=A.makePipelineState({blending:p.blendingDefault,depthTest:d.depthCompareAlways,depthWrite:null,colorWrite:A.defaultColorWriteParams,stencilWrite:null,stencilTest:d.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=A.makePipelineState({blending:p.blendingDefault,depthTest:d.depthCompareAlways,
depthWrite:null,colorWrite:A.defaultColorWriteParams,stencilWrite:d.stencilWriteMaskOff,stencilTest:d.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=A.makePipelineState({blending:null,depthTest:d.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:d.stencilWriteMaskOn,stencilTest:d.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};z.getPipelineState=function(y,B){return B?this._occludeePipelineState:this.configuration.occluder?y===h.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:y===h.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:w.prototype.getPipelineState.call(this,y,B)};return u}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(l.LineMarker,()=>new Promise((w,u)=>a(["./LineMarker.glsl"],w,u)));b.LineMarkerTechnique=n;b.vertexAttributeLocations=
t;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){function x(D){const F=new y.ShaderBuilder,G=D.hasMultipassTerrain&&(D.output===r.ShaderOutput.Color||D.output===r.ShaderOutput.Alpha),J=D.space===q.LineMarkerSpace.World;D.hasTip&&J&&F.extensions.add("GL_OES_standard_derivatives");F.include(n.RibbonVertexPosition,D);F.include(g.MarkerSizing,D);D.output===r.ShaderOutput.Depth&&F.include(p.OutputDepth,D);const {vertex:L,fragment:K}=F;K.include(e.RgbaFloatEncoding);l.addProjViewLocalOrigin(L,D);
F.attributes.add(k.VertexAttribute.POSITION,"vec3");F.attributes.add(k.VertexAttribute.UV0,"vec2");F.attributes.add(k.VertexAttribute.AUXPOS1,"vec3");F.varyings.add("vColor","vec4");F.varyings.add("vpos","vec3");F.varyings.add("vUV","vec2");F.varyings.add("vSize","float");c.addLinearDepth(F);G&&F.varyings.add("depth","float");D.hasTip&&F.varyings.add("vLineWidth","float");L.uniforms.add([new A.Float2PassUniform("nearFar",(O,P)=>P.camera.nearFar),new t.Float4PassUniform("viewport",(O,P)=>P.camera.fullViewport)]);
L.code.add(u.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);L.code.add(u.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);J?(F.attributes.add(k.VertexAttribute.NORMAL,"vec3"),l.addViewNormal(L),L.constants.add("tiltThreshold","float",.7),L.code.add(u.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):L.code.add(u.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);L.code.add(u.glsl`
      #define vecN ${J?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${J?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${D.anchor===q.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);D.space===q.LineMarkerSpace.Screen&&(L.uniforms.add(new z.Matrix4PassUniform("inverseProjectionMatrix",(O,P)=>P.camera.inverseProjectionMatrix)),L.code.add(u.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),L.code.add(u.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),L.uniforms.add(new w.FloatPassUniform("perScreenPixelRatio",(O,P)=>P.camera.perScreenPixelRatio)),L.code.add(u.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${D.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));L.uniforms.add(new w.FloatPassUniform("pixelRatio",(O,P)=>P.camera.pixelRatio));c.addCalculateLinearDepth(F);L.code.add(u.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);J?(D.hideOnShortSegments&&L.code.add(u.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),L.code.add(u.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(L.code.add(u.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),D.space===q.LineMarkerSpace.Screen&&L.code.add(u.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));L.code.add(u.glsl`
        ${G?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${J?"":"vUV *\x3d displacedPosScreen.w;"}

        ${D.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);G&&F.include(h.multipassTerrainTest,D);F.include(m.SliceDraw,D);K.uniforms.add([new t.Float4PassUniform("intrinsicColor",O=>O.color),new B.Texture2DPassUniform("tex",O=>O.texture)]);K.include(f.ColorConversion);F.constants.add("texelSize","float",1/b.MARKER_TEXTURE_SIZE);K.code.add(u.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);D.hasTip&&(F.constants.add("relativeMarkerSize","float",b.MARKER_SYMBOL_SIZE/b.MARKER_TEXTURE_SIZE),F.constants.add("relativeTipLineWidth","float",b.MARKER_TIP_THICKNESS_FACTOR),K.code.add(u.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${J?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));F.constants.add("symbolAlphaCutoff","float",d.symbolAlphaCutoff);K.code.add(u.glsl`
  void main() {
    discardBySlice(vpos);
    ${G?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${J?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${D.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${D.output===r.ShaderOutput.Alpha?u.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${D.output===r.ShaderOutput.Color?u.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${D.output===r.ShaderOutput.Color&&D.transparencyPassType===C.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${D.output===r.ShaderOutput.Highlight?u.glsl`gl_FragColor = vec4(1.0);`:""}
    ${D.output===r.ShaderOutput.Depth?u.glsl`outputDepth(linearDepth);`:""}
  }
  `);return F}const v=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.LineMarker=v;a.build=x})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(p,g=2){return b.isNone(p)?p:{pattern:p.slice(),pixelRatio:g}}function r(p){return b.isSome(p)?c(n[p],8):null}const m={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:m.dash,"dash-dot":[...m.dash,
...m.dot],dot:m.dot,"long-dash":m["long-dash"],"long-dash-dot":[...m["long-dash"],...m.dot],"long-dash-dot-dot":[...m["long-dash"],...m.dot,...m.dot],none:null,"short-dash":m["short-dash"],"short-dash-dot":[...m["short-dash"],...m["short-dot"]],"short-dash-dot-dot":[...m["short-dash"],...m["short-dot"],...m["short-dot"]],"short-dot":m["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(p,g=2){return{pattern:[p,p],pixelRatio:g}};a.getStipplePatternForLinePattern=
function(p){return b.isSome(p)&&"style"===p.type?r(p.style):null};a.getStipplePatternForPatternStyle=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Indices ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q){const T=["mesh"];r=function(ma){function ha(Z,ca,fa,ea){Z=ma.call(this,Z,ca,fa,ea)||this;Z._materials=new Map;Z._textures=new Map;Z.ensureDrapedStatus(!1);return Z}b._inheritsLoose(ha,ma);var ka=ha.prototype;ka.doLoad=function(){var Z=b._asyncToGenerator(function*(){L.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new M.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new M.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return Z.apply(this,arguments)}}();ka.destroy=function(){ma.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),Z=>Z.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};ka.createGraphics3DGraphic=function(Z){const ca=Z.graphic;if(!this._validateGeometry(ca.geometry,T,"fill on mesh-3d"))return null;const fa=this.setGraphicElevationContext(ca,new v.ElevationContext);
return this._createAs3DShape(ca,Z.renderingInfo,fa,ca.uid)};ka.layerOpacityChanged=function(Z,ca){const fa=this._getLayerOpacity();this._materials.forEach(ea=>{ea.material.setParameters({layerOpacity:fa});const da=ea.material.parameters;this._setMaterialTransparentParameter(da,ea);ea.material.setParameters({transparent:da.transparent})});Z.forEach(ea=>{ea=ca(ea);m.isSome(ea)&&ea.layerOpacityChanged(fa,this._context.isAsync)})};ka.layerElevationInfoChanged=function(Z,ca){return this.updateGraphics3DGraphicElevationInfo(Z,
ca,x.needsElevationUpdates3D)};ka.slicePlaneEnabledChanged=function(Z,ca){this._materials.forEach(fa=>{fa.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});Z.forEach(fa=>{fa=ca(fa);m.isSome(fa)&&fa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ka.physicalBasedRenderingChanged=function(){const Z=this._usePBR();this._materials.forEach(ca=>ca.material.setParameters({usePBR:Z}));return!0};ka.pixelRatioChanged=function(){return!0};ka._requiresSymbolVertexColors=
function(){return this._drivenProperties.color||this._drivenProperties.opacity};ka._colorOrTextureUid=function(Z){return m.isNone(Z)?"-":Z instanceof c?Z.toHex():Z.contentHash};ka._materialPropertiesDefault=function(Z,ca){const fa=this._requiresSymbolVertexColors(),ea=!!Z.vertexAttributes.color;Z=!!Z.vertexAttributes.tangent;return{hasSymbolVertexColors:fa,hasVertexColors:ea,hasVertexTangents:Z,uid:`vc:${ea},vt:${Z},vct${ca},svc:${fa}`}};ka._materialProperties=function(Z,ca,fa){Z=this._materialPropertiesDefault(Z,
fa);if(!ca.material)return Z;const {color:ea,colorTexture:da,normalTexture:la,doubleSided:oa,alphaCutoff:ra,alphaMode:Aa}=ca.material;fa=this._colorOrTextureUid(ea);var ua=this._colorOrTextureUid(da),za=this._colorOrTextureUid(la);Z.color=ea;Z.colorTexture=da;Z.normalTexture=la;Z.uid=`${Z.uid},cmuid:${fa},ctmuid:${ua},ntmuid:${za},ds:${oa},ac:${ra},am:${Aa}`;if(ca.material instanceof w){const {metallic:va,roughness:Ja,metallicRoughnessTexture:pa,emissiveColor:Ba,emissiveTexture:Ha,occlusionTexture:wa}=
ca.material;fa=this._colorOrTextureUid(pa);ua=this._colorOrTextureUid(Ba);za=this._colorOrTextureUid(Ha);const ya=this._colorOrTextureUid(wa);Z.metallic=va;Z.roughness=Ja;Z.metallicRoughnessTexture=pa;Z.emissiveColor=Ba;Z.emissiveTexture=Ha;Z.occlusionTexture=wa;Z.colorTextureTransform=ca.material.colorTextureTransform;Z.normalTextureTransform=ca.material.normalTextureTransform;Z.emissiveTextureTransform=ca.material.emissiveTextureTransform;Z.occlusionTextureTransform=ca.material.occlusionTextureTransform;
Z.metallicRoughnessTextureTransform=ca.material.metallicRoughnessTextureTransform;Z.uid=`${Z.uid},mrm:${va},mrr:${Ja},mrt:${fa},emuid:${ua},etmuid:${za},otmuid:${ya}`}return Z};ka._setInternalColorValueParameters=function(Z,ca){ca.diffuse=c.toUnitRGB(Z);ca.opacity=Z.a};ka._getLoadableTextureResource=function(Z){return Z.data?Z.data:Z.url};ka._getInternalTextureId=function(Z){Z=this._getInternalTexture(Z,K.AlphaDiscardMode.Opaque);return m.isSome(Z)?Z.id:null};ka._getInternalTexture=function(Z,ca){const fa=
this._getLoadableTextureResource(Z);if(!fa)return null;const ea=`${Z.contentHash}/${ca}`;let da=this._textures.get(ea);da||(da=new H.Texture(fa,{mipmap:!0,wrap:this._castTextureWrap(Z.wrap),noUnpackFlip:!0,preMultiplyAlpha:ca!==K.AlphaDiscardMode.Opaque}),this._textures.set(ea,da),this._context.stage.add(da),this._context.stage.loadImmediate(da));return da};ka._castTextureWrap=function(Z="repeat"){return"string"===typeof Z?(Z=this._castTextureWrapIndividual(Z),{s:Z,t:Z}):{s:this._castTextureWrapIndividual(Z.horizontal),
t:this._castTextureWrapIndividual(Z.vertical)}};ka._castTextureWrapIndividual=function(Z){switch(Z){case "clamp":return Q.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return Q.TextureWrapMode.MIRRORED_REPEAT;default:return Q.TextureWrapMode.REPEAT}};ka._setInternalMaterialParameters=function(Z,ca){m.isSome(Z.color)&&this._setInternalColorValueParameters(Z.color,ca);if(m.isSome(Z.colorTexture)){const fa=this._getInternalTexture(Z.colorTexture,ca.textureAlphaMode);m.isSome(fa)?(ca.textureId=fa.id,ca.textureAlphaPremultiplied=
!!fa.params.preMultiplyAlpha):ca.textureId=void 0}m.isSome(Z.normalTexture)&&(ca.normalTextureId=this._getInternalTextureId(Z.normalTexture));m.isSome(Z.emissiveColor)&&(ca.emissiveFactor=c.toUnitRGB(Z.emissiveColor));m.isSome(Z.emissiveTexture)&&(ca.emissiveTextureId=this._getInternalTextureId(Z.emissiveTexture));m.isSome(Z.occlusionTexture)&&(ca.occlusionTextureId=this._getInternalTextureId(Z.occlusionTexture));m.isSome(Z.metallicRoughnessTexture)&&(ca.metallicRoughnessTextureId=this._getInternalTextureId(Z.metallicRoughnessTexture));
ca.colorTextureTransformMatrix=k.getTransformMatrix(Z.colorTextureTransform);ca.normalTextureTransformMatrix=k.getTransformMatrix(Z.normalTextureTransform);ca.occlusionTextureTransformMatrix=k.getTransformMatrix(Z.occlusionTextureTransform);ca.emissiveTextureTransformMatrix=k.getTransformMatrix(Z.emissiveTextureTransform);ca.metallicRoughnessTextureTransformMatrix=k.getTransformMatrix(Z.metallicRoughnessTextureTransform)};ka._setExternalMaterialParameters=function(Z){var ca=this._drivenProperties.color;
let fa=m.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;ca?Z.externalColor=e.ONES:(ca=m.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,m.isSome(ca)?Z.externalColor=c.toUnitRGBA(ca):(fa=null,Z.externalColor=e.ONES));fa&&(Z.colorMixMode=fa);Z.castShadows=!!this.symbolLayer.castShadows};ka._hasTransparentVertexColors=function(Z){Z=Z.vertexAttributes.color;if(m.isNone(Z))return!1;for(let ca=3;ca<Z.length;ca+=4)if(255!==Z[ca])return!0;return!1};ka._getOrCreateMaterial=
function(Z,ca){var fa=ca.material?.color,ea=ca.material?.colorTexture,da=ca.material?.alphaMode;const la="blend"===da;fa="opaque"!==da&&(this._hasTransparentVertexColors(Z)||m.isSome(fa)&&1>fa.a||m.isSome(ea)&&ea.transparent||la);Z=this._materialProperties(Z,ca,fa);if(ea=this._materials.get(Z.uid))return ea.material;fa={material:null,isComponentTransparent:fa,alphaMode:ca.material?ca.material.alphaMode:"opaque"};ea=null==Z.metallicRoughnessTexture&&null==Z.metallic&&null==Z.roughness;da={usePBR:this._usePBR(),
isSchematic:ea,hasVertexColors:Z.hasVertexColors,hasSymbolColors:Z.hasSymbolVertexColors,hasVertexTangents:Z.hasVertexTangents,ambient:f.ZEROS,diffuse:f.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:K.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};ea||(da.mrrFactors=[null!=Z.metallic?Z.metallic:1,null!=Z.roughness?Z.roughness:1,.5]);ca.material&&(da.doubleSided=ca.material.doubleSided,da.cullFace=
ca.material.doubleSided?K.CullFaceOptions.None:K.CullFaceOptions.Back,da.textureAlphaCutoff=ca.material.alphaCutoff);this._setExternalMaterialParameters(da);this._setMaterialTransparentParameter(da,fa);this._setInternalMaterialParameters(Z,da);ca=new I.DefaultMaterial(da);fa.material=ca;this._materials.set(Z.uid,fa);this._context.stage.add(ca);return ca};ka._usePBR=function(){return this._context.physicalBasedRenderingEnabled};ka._setMaterialTransparentParameter=function(Z,ca){Z.transparent=this.needsDrivenTransparentPass||
ca.isComponentTransparent||1>Z.layerOpacity||1>Z.opacity||Z.externalColor&&1>Z.externalColor[3];Z.textureAlphaMode="auto"===ca.alphaMode?Z.transparent?K.AlphaDiscardMode.MaskBlend:K.AlphaDiscardMode.Opaque:"opaque"===ca.alphaMode?K.AlphaDiscardMode.Opaque:"mask"===ca.alphaMode?K.AlphaDiscardMode.Mask:K.AlphaDiscardMode.Blend};ka._addDebugNormals=function(Z,ca,fa,ea){var da=ca.length,la=Z.spatialReference.isGeographic?20015077/180:1;const oa=.1*Math.max(Z.extent.width*la,Z.extent.height*la,Z.extent.zmax-
Z.extent.zmin),ra=[],Aa=[];Z=[];la=[];for(let Ba=0;Ba<da;Ba++){var ua=ca[Ba],za=ua.vertexAttributes.get(E.VertexAttribute.POSITION),va=ua.vertexAttributes.get(E.VertexAttribute.NORMAL);const Ha=ua.indices.get(E.VertexAttribute.POSITION);ua=ua.indices.get(E.VertexAttribute.NORMAL);za=za.data;va=va.data;for(let wa=0;wa<Ha.length;wa++){var Ja=3*Ha[wa];const ya=3*ua[wa];for(var pa=0;3>pa;pa++)ra.push(za[Ja+pa]);for(pa=0;3>pa;pa++)ra.push(za[Ja+pa]+va[ya+pa]*oa);Aa.push(Aa.length);Aa.push(Aa.length);if(0===
wa%3){this._calculateFaceNormal(za,Ha,wa,R);this._getFaceVertices(za,Ha,wa,U,Y,V);d.add(U,U,Y);d.add(U,U,V);d.scale(U,U,1/3);for(Ja=0;3>Ja;Ja++)Z.push(U[Ja]);for(Ja=0;3>Ja;Ja++)Z.push(U[Ja]+R[Ja]*oa);la.push(la.length);la.push(la.length)}}}da=new O.Geometry([[E.VertexAttribute.POSITION,{data:ra,size:3,exclusive:!0}]],[[E.VertexAttribute.POSITION,Aa]],K.PrimitiveType.Line);ca.push(da);fa.push(this._debugVertexNormalMaterial);ea.push(h.clone(ea[0]));da=new O.Geometry([[E.VertexAttribute.POSITION,{data:Z,
size:3,exclusive:!0}]],[[E.VertexAttribute.POSITION,la]],K.PrimitiveType.Line);ca.push(da);fa.push(this._debugFaceNormalMaterial);ea.push(h.clone(ea[0]))};ka._createAs3DShape=function(Z,ca,fa,ea){Z=Z.geometry;if("mesh"!==Z.type)return null;ca=this._createGeometryInfo(Z,ca,ea);if(!ca)return null;const {geometries:da,materials:la,transformations:oa,objectTransformation:ra}=ca;L.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(Z,da,la,oa);ea=new N.Object3D({geometries:da,materials:la,transformations:oa,
metadata:{layerUid:this._context.layer.uid,graphicUid:ea}});ea.transformation=ra;ca=this._createEdgeMaterial();ca=m.isSome(ca)?{baseMaterial:la[0],edgeMaterials:[ca],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null;ca=new D.Graphics3DObject3DGraphicLayer(this,ea,da,null,null,q.perObjectElevationAligner,fa,ca);ca.needsElevationUpdates=x.needsElevationUpdates3D(fa.mode);ca.useObjectOriginAsAttachmentOrigin=!0;ca.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(ea);
ca.alignedSampledElevation=q.perObjectElevationAligner(ca,ca.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return ca};ka._getCenterPointInElevationSR=function(Z){const ca=B.makeDehydratedPoint(0,0,0,m.isSome(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);l.projectVectorToDehydratedPoint([Z.transformation[12],Z.transformation[13],Z.transformation[14]],this._context.renderCoordsHelper.spatialReference,ca);
return ca};ka._createComponentNormals=function(Z,ca,fa,ea){switch(fa.shading||"flat"){case "source":return this._createComponentNormalsSource(Z,ca,fa,ea);case "flat":return this._createComponentNormalsFlat(Z,ea);case "smooth":return this._createComponentNormalsSmooth(Z,ea)}};ka._createComponentNormalsSource=function(Z,ca,fa,ea){if(m.isNone(ca))return this._createComponentNormalsFlat(Z,ea);let da=!1;if(!fa.trustSourceNormals)for(fa=0;fa<ea.length;fa+=3){this._calculateFaceNormal(Z,ea,fa,R);for(let la=
0;3>la;la++){const oa=3*ea[fa+la];U[0]=ca[oa+0];U[1]=ca[oa+1];U[2]=ca[oa+2];0>d.dot(R,U)&&(ca[oa+0]=-ca[oa+0],ca[oa+1]=-ca[oa+1],ca[oa+2]=-ca[oa+2],da=!0)}}return{normals:ca,indices:ea,didFlipNormals:da}};ka._createComponentNormalsFlat=function(Z,ca){const fa=new Float32Array(ca.length),ea=Array(3*ca.length);for(let da=0;da<ca.length;da+=3){const la=this._calculateFaceNormal(Z,ca,da,R);for(let oa=0;3>oa;oa++)fa[da+oa]=la[oa],ea[da+oa]=da/3}return{normals:fa,indices:ea,didFlipNormals:!1}};ka._createComponentNormalsSmooth=
function(Z,ca){const fa={};for(var ea=0;ea<ca.length;ea+=3){var da=this._calculateFaceNormal(Z,ca,ea,R);for(var la=0;3>la;la++){var oa=ca[ea+la];let ra=fa[oa];ra||(ra={normal:f.create(),count:0},fa[oa]=ra);d.add(ra.normal,ra.normal,da);ra.count++}}Z=new Float32Array(3*ca.length);ea=Array(3*ca.length);for(da=0;da<ca.length;da++){la=fa[ca[da]];1!==la.count&&(d.normalize(la.normal,la.normal),la.count=1);for(oa=0;3>oa;oa++)Z[3*da+oa]=la.normal[oa];ea[da]=da}return{normals:Z,indices:ea,didFlipNormals:!1}};
ka._getFaceVertices=function(Z,ca,fa,ea,da,la){const oa=3*ca[fa+0],ra=3*ca[fa+1];ca=3*ca[fa+2];ea[0]=Z[oa+0];ea[1]=Z[oa+1];ea[2]=Z[oa+2];da[0]=Z[ra+0];da[1]=Z[ra+1];da[2]=Z[ra+2];la[0]=Z[ca+0];la[1]=Z[ca+1];la[2]=Z[ca+2]};ka._calculateFaceNormal=function(Z,ca,fa,ea){this._getFaceVertices(Z,ca,fa,U,Y,V);d.subtract(Y,Y,U);d.subtract(V,V,U);d.cross(U,Y,V);d.normalize(ea,U);return ea};ka._getOrCreateComponents=function(Z){return m.unwrapOr(Z.components,ba)};ka._createPositionBuffer=function(Z,ca){let fa=
Z.vertexAttributes.position;const ea=ca.reprojection===ia.ECEF?ca.transformBeforeProject:null;m.isSome(ea)&&(fa=y.transformPosition(fa,new Float64Array(fa.length),ea));if(ca.reprojection===ia.NONE)return ca.needsBufferCopy?new Float64Array(fa):fa;ca=m.isSome(ea)?fa:new Float64Array(fa.length);l.projectBuffer(fa,Z.spatialReference,0,ca,this._context.renderCoordsHelper.spatialReference,0,fa.length/3);return ca};ka._createNormalBuffer=function(Z,ca,fa){let ea=Z.vertexAttributes.normal;if(m.isNone(ea))return null;
var da=fa.reprojection===ia.ECEF?fa.transformBeforeProject:null;m.isSome(da)&&(ea=y.transformNormal(ea,new Float32Array(ea.length),da));if("local"===this._context.graphicsCoreOwner.view.viewingMode||fa.reprojection===ia.NONE)return fa.needsBufferCopy&&Z.vertexAttributes.normal===ea?new Float32Array(ea):ea;fa=Z.vertexAttributes.position;da=m.isSome(da)?ea:new Float32Array(ea.length);return y.projectNormalToPCPF(ea,fa,ca,Z.spatialReference,da)};ka._createTangentBuffer=function(Z,ca,fa){let ea=Z.vertexAttributes.tangent;
if(m.isNone(ea))return null;var da=fa.reprojection===ia.ECEF?fa.transformBeforeProject:null;m.isSome(da)&&(ea=y.transformTangent(ea,new Float32Array(ea.length),da));if("local"===this._context.graphicsCoreOwner.view.viewingMode||fa.reprojection===ia.NONE)return fa.needsBufferCopy&&Z.vertexAttributes.normal===ea?new Float32Array(ea):ea;fa=Z.vertexAttributes.position;da=m.isSome(da)?ea:new Float32Array(ea.length);return y.projectTangentToPCPF(ea,fa,ca,Z.spatialReference,da)};ka._createColorBuffer=function(Z){return Z.vertexAttributes.color};
ka._createSymbolColorBuffer=function(Z){if(this._requiresSymbolVertexColors()){Z=this._getVertexOpacityAndColor(Z);const ca=J.parseColorMixMode(m.get(this.symbolLayer,"material","colorMixMode")),fa=new Uint8Array(4);J.encodeSymbolColor(Z,ca,fa);return fa}return null};ka._createBuffers=function(Z,ca){var fa=Z.vertexAttributes&&Z.vertexAttributes.position;if(!fa)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var ea=Z.vertexAttributes.normal;const da=Z.vertexAttributes.uv;
var la=Z.vertexAttributes.tangent;if(m.isSome(ea)&&ea.length!==fa.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(m.isSome(la)&&la.length/4!==fa.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(m.isSome(da)&&da.length/2!==fa.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;la=this._computeReprojectionInfo(Z);fa=this._createPositionBuffer(Z,la);ea=this._createColorBuffer(Z);ca=this._createSymbolColorBuffer(ca);const oa=this._createNormalBuffer(Z,fa,la),ra=this._createTangentBuffer(Z,fa,la);Z=la.reprojection===ia.NONE&&m.isSome(la.objectTransformation)?la.objectTransformation:this._transformOriginLocal(Z,fa,oa,ra);la=la.reprojection===ia.NONE&&m.isSome(la.geometryTransformation)?la.geometryTransformation:h.create();return{positionBuffer:fa,normalBuffer:oa,tangentBuffer:ra,
uvBuffer:da,colorBuffer:ea,symbolColorBuffer:ca,objectTransformation:Z,geometryTransformation:la}};ka._computeReprojectionInfo=function(Z){var ca=m.isSome(Z.transform);const fa=ca&&Z.transform.geographic?ia.NONE:this._context.renderCoordsHelper.viewingMode===C.ViewingMode.Local?ia.NONE:ia.ECEF;if(ca){if(fa===ia.NONE)return ca=h.create(),l.computeTranslationToOriginAndRotation(Z.spatialReference,Z.transform.origin,ca,this._context.renderCoordsHelper.spatialReference),Z=h.clone(Z.transform.localMatrix),
{reprojection:fa,objectTransformation:ca,geometryTransformation:Z,needsBufferCopy:!1};ca=g.fromTranslation(h.create(),Z.transform.origin);g.multiply(ca,ca,Z.transform.localMatrix);return{reprojection:fa,transformBeforeProject:ca,needsBufferCopy:!0}}return{reprojection:fa,needsBufferCopy:!0}};ka._transformOriginLocal=function(Z,ca,fa,ea){const da=this._context.renderCoordsHelper.spatialReference;var la=Z.anchor;S[0]=la.x;S[1]=la.y;S[2]=la.z;la=h.create();l.computeTranslationToOriginAndRotation(Z.spatialReference,
S,la,da);Z=u.BufferViewVec3f64.fromTypedArray(ca);g.invert(X,la);z.transformMat4(Z,Z,X);if(m.isSome(fa)||m.isSome(ea))n.fromMat4(W,la),n.transpose(W,W),m.isSome(fa)&&(fa=u.BufferViewVec3f.fromTypedArray(fa),z.transformMat3(fa,fa,W)),m.isSome(ea)&&(ea=u.BufferViewVec3f.fromTypedArray(ea,4*ea.BYTES_PER_ELEMENT),z.transformMat3(ea,ea,W));return la};ka._validateFaces=function(Z,ca){Z=Z.vertexAttributes.position.length/3;if(ca=ca.faces){let fa=-1;for(let ea=0;ea<ca.length;ea++){const da=ca[ea];da>fa&&
(fa=da)}if(Z<=fa)return this.logger.warn(`Vertex index ${fa} is out of bounds of the mesh position buffer`),!1}else if(0!==Z%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};ka._getOrCreateFaces=function(Z,ca){return ca.faces?ca.faces:P.generateDefaultIndexArray(Z.vertexAttributes.position.length/3)};ka._isOutsideClippingArea=function(Z){if(!this._context.clippingExtent)return!1;
var ca=Z.vertexAttributes&&Z.vertexAttributes.position;if(!ca)return!1;const fa=this._context.elevationProvider.spatialReference,ea=ca.length/3;m.isSome(fa)&&!Z.spatialReference.equals(fa)&&(ca=new Float64Array(ca.length),l.projectBuffer(Z.vertexAttributes.position,Z.spatialReference,0,ca,fa,0,ea));A.empty(aa);A.expandWithBuffer(aa,ca,0,ea);return!A.intersectsClippingArea(aa,this._context.clippingExtent)};ka._createGeometryInfo=function(Z,ca,fa){if(!l.canProjectWithoutEngine(Z.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(Z))return null;ca=this._createBuffers(Z,ca);if(m.isNone(ca))return null;const {positionBuffer:ea,uvBuffer:da,colorBuffer:la,symbolColorBuffer:oa,normalBuffer:ra,tangentBuffer:Aa,objectTransformation:ua,geometryTransformation:za}=ca;var va=this._getOrCreateComponents(Z);ca=[];const Ja=[],pa=[];let Ba=!1;for(const ya of va){if(!this._validateFaces(Z,ya))return null;var Ha=this._getOrCreateFaces(Z,ya);if(0!==Ha.length){var wa=this._createComponentNormals(ea,ra,ya,
Ha);wa.didFlipNormals&&(Ba=!0);va=[[E.VertexAttribute.POSITION,{size:3,data:ea,exclusive:!0}],[E.VertexAttribute.NORMAL,{size:3,data:wa.normals,exclusive:!0}]];wa=[[E.VertexAttribute.POSITION,Ha],[E.VertexAttribute.NORMAL,wa.indices]];m.isSome(la)&&(va.push([E.VertexAttribute.COLOR,{size:4,data:la,exclusive:!0}]),wa.push([E.VertexAttribute.COLOR,Ha]));m.isSome(oa)&&(va.push([E.VertexAttribute.SYMBOLCOLOR,{size:4,data:oa,exclusive:!0}]),wa.push([E.VertexAttribute.SYMBOLCOLOR,Array(Ha.length).fill(0)]));
m.isSome(da)&&(va.push([E.VertexAttribute.UV0,{size:2,data:da,exclusive:!0}]),wa.push([E.VertexAttribute.UV0,Ha]));m.isSome(Aa)&&(va.push([E.VertexAttribute.TANGENT,{size:4,data:Aa,exclusive:!0}]),wa.push([E.VertexAttribute.TANGENT,Ha]));Ha=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:fa,layerUid:this._context.layer.uid});va=new O.Geometry(va,wa,K.PrimitiveType.Triangle,Ha);ca.push(va);Ja.push(za);pa.push(this._getOrCreateMaterial(Z,ya))}}Ba&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:ca,transformations:Ja,materials:pa,objectTransformation:ua}};ka._createEdgeMaterial=function(){const Z={opacity:this._getLayerOpacity()};return G.createMaterial(this.symbolLayer,Z)};return ha}(F.Graphics3DSymbolLayer);const S=f.create(),U=f.create(),Y=f.create(),V=f.create(),R=f.create(),X=h.create(),W=p.create(),aa=A.create(),ba=[new t];var ia;(function(ma){ma[ma.NONE=0]="NONE";ma[ma.ECEF=1]="ECEF"})(ia||(ia={}));a.Graphics3DMeshFillSymbolLayer=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),function(a,b,c,r,m,n,p,g,
h,d,f,e){var l;const A=m.getLogger("esri.geometry.support.MeshComponent");c=l=function(t){function w(z){z=t.call(this,z)||this;z.faces=null;z.material=null;z.shading="source";z.trustSourceNormals=!1;return z}a._inheritsLoose(w,t);w.from=function(z){return h.ensureClass(l,z)};var u=w.prototype;u.castFaces=function(z){return e.castArray(z,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},A)};u.castMaterial=function(z){return z&&"object"===typeof z&&("metallic"in z||"roughness"in z||"metallicRoughnessTexture"in
z)?h.ensureClass(f,z):h.ensureClass(d,z)};u.clone=function(){return new l({faces:r.clone(this.faces),shading:this.shading,material:r.clone(this.material),trustSourceNormals:this.trustSourceNormals})};u.cloneWithDeduplication=function(z,y){z={faces:r.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(z,y):null,trustSourceNormals:this.trustSourceNormals};return new l(z)};return w}(c.JSONSupport);b.__decorate([n.property({json:{write:!0}})],c.prototype,
"faces",void 0);b.__decorate([p.cast("faces")],c.prototype,"castFaces",null);b.__decorate([n.property({type:d,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([p.cast("material")],c.prototype,"castMaterial",null);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=l=b.__decorate([g.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;r=f=function(e){function l(t){t=e.call(this,t)||this;t.color=null;t.colorTexture=null;t.normalTexture=null;t.alphaMode="auto";t.alphaCutoff=.5;t.doubleSided=!0;return t}a._inheritsLoose(l,e);var A=l.prototype;A.clone=function(){return this.cloneWithDeduplication(null,new Map)};A.cloneWithDeduplication=function(t,w){const u=m.isSome(t)?t.get(this):null;if(u)return u;w=new f(this.clonePropertiesWithDeduplication(w));m.isSome(t)&&t.set(this,w);return w};A.clonePropertiesWithDeduplication=
function(t){return{color:m.isSome(this.color)?this.color.clone():null,colorTexture:m.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:m.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:m.isSome(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:m.isSome(this.normalTextureTransform)?this.normalTextureTransform:
null}};return l}(r.JSONSupport);b.__decorate([n.property({type:c,json:{write:!0}})],r.prototype,"color",void 0);b.__decorate([n.property({type:d,json:{write:!0}})],r.prototype,"colorTexture",void 0);b.__decorate([n.property({type:d,json:{write:!0}})],r.prototype,"normalTexture",void 0);b.__decorate([n.property({nonNullable:!0,json:{write:!0}})],r.prototype,"alphaMode",void 0);b.__decorate([n.property({nonNullable:!0,json:{write:!0}})],r.prototype,"alphaCutoff",void 0);b.__decorate([n.property({nonNullable:!0,
json:{write:!0}})],r.prototype,"doubleSided",void 0);b.__decorate([n.property()],r.prototype,"colorTextureTransform",void 0);b.__decorate([n.property()],r.prototype,"normalTextureTransform",void 0);return r=f=b.__decorate([h.subclass("esri.geometry.support.MeshMaterial")],r)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){var l;const A=new WeakMap;let t=0;c=l=function(w){function u(y){y=w.call(this,y)||this;y.wrap="repeat";return y}a._inheritsLoose(u,w);var z=u.prototype;z.writeData=function(y,B,C,k){y instanceof HTMLImageElement?(y={type:"image-element",src:e.toJSON(y.src,k),crossOrigin:y.crossOrigin},B[C]=y):y instanceof HTMLCanvasElement?(y=y.getContext("2d").getImageData(0,0,y.width,y.height),y={type:"canvas-element",imageData:this._encodeImageData(y)},B[C]=y):y instanceof HTMLVideoElement?
(y={type:"video-element",src:e.toJSON(y.src,k),autoplay:y.autoplay,loop:y.loop,muted:y.muted,crossOrigin:y.crossOrigin,preload:y.preload},B[C]=y):(y={type:"image-data",imageData:this._encodeImageData(y)},B[C]=y)};z.readData=function(y){switch(y.type){case "image-element":var B=new Image;B.src=y.src;B.crossOrigin=y.crossOrigin;return B;case "canvas-element":return y=this._decodeImageData(y.imageData),B=document.createElement("canvas"),B.width=y.width,B.height=y.height,B.getContext("2d").putImageData(y,
0,0),B;case "image-data":return this._decodeImageData(y.imageData);case "video-element":return B=document.createElement("video"),B.src=y.src,B.crossOrigin=y.crossOrigin,B.autoplay=y.autoplay,B.loop=y.loop,B.muted=y.muted,B.preload=y.preload,B}};z.clone=function(){const y={url:this.url,data:this.data,wrap:this._cloneWrap()};return new l(y)};z.cloneWithDeduplication=function(y){var B=y.get(this);if(B)return B;B=this.clone();y.set(this,B);return B};z._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};z._encodeImageData=function(y){let B="";for(let C=0;C<y.data.length;C++)B+=String.fromCharCode(y.data[C]);return{data:btoa(B),width:y.width,height:y.height}};z._decodeImageData=function(y){const B=atob(y.data),C=new Uint8ClampedArray(B.length);for(let k=0;k<B.length;k++)C[k]=B.charCodeAt(k);return r.wrapImageData(C,y.width,y.height)};z._imageDataContainsTransparent=function(y){for(let B=3;B<y.data.length;B+=4)if(255!==y.data[B])return!0;
return!1};u.from=function(y){return"string"===typeof y?new l({url:y}):y instanceof HTMLImageElement||y instanceof HTMLCanvasElement||y instanceof ImageData||y instanceof HTMLVideoElement?new l({data:y}):g.ensureClass(l,y)};a._createClass(u,[{key:"url",get:function(){return this._get("url")||null},set:function(y){this._set("url",y);y&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(y){this._set("data",y);y&&this._set("url",null)}},{key:"transparent",
get:function(){var y=this.data,B=this.url;return y instanceof HTMLCanvasElement?this._imageDataContainsTransparent(y.getContext("2d").getImageData(0,0,y.width,y.height)):y instanceof ImageData?this._imageDataContainsTransparent(y):B&&(y=B.substr(B.length-4,4).toLowerCase(),B=B.substr(0,15).toLocaleLowerCase(),".png"===y||"data:image/png;"===B)?!0:!1},set:function(y){this._overrideIfSome("transparent",y)}},{key:"contentHash",get:function(){const y="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?
`${this.wrap.horizontal}/${this.wrap.vertical}`:"",B=(C="")=>`d:${C},t:${this.transparent},w:${y}`;if(null!=this.url)return B(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return B(this.data.src);A.has(this.data)||A.set(this.data,++t);return B(A.get(this.data))}return B()}}]);return u}(m.JSONSupport);b.__decorate([n.property({type:String,json:{write:e.write}})],c.prototype,"url",null);b.__decorate([n.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
n.property()],c.prototype,"data",null);b.__decorate([f.writer("data")],c.prototype,"writeData",null);b.__decorate([h.reader("data")],c.prototype,"readData",null);b.__decorate([n.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([n.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"contentHash",null);return c=l=b.__decorate([d.subclass("esri.geometry.support.MeshTexture")],
c)})},"esri/core/imageUtils":function(){define(["exports"],function(a){function b(m,n,p){p||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),p=c);return p.getContext("2d").createImageData(m,n)}let c=null,r=!0;a.createEmptyImageData=function(m,n,p){if(!m||!n)throw Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(m,n)}catch(g){r=!1}return b(m,n,p)};a.wrapImageData=function(m,n,p,g){if(!n||!p)throw Error("Cannot construct image data without dimensions");
if(r)try{return new ImageData(m,n,p)}catch(h){r=!1}n=b(n,p,g);n.data.set(m,0);return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;n=f=function(e){function l(t){t=e.call(this,t)||this;t.emissiveColor=null;t.emissiveTexture=null;t.occlusionTexture=null;t.metallic=1;t.roughness=1;t.metallicRoughnessTexture=null;return t}a._inheritsLoose(l,e);var A=l.prototype;A.clone=function(){return this.cloneWithDeduplication(null,new Map)};A.cloneWithDeduplication=function(t,w){const u=r.isSome(t)?t.get(this):null;if(u)return u;w=new f(this.clonePropertiesWithDeduplication(w));r.isSome(t)&&t.set(this,w);
return w};A.clonePropertiesWithDeduplication=function(t){return{...e.prototype.clonePropertiesWithDeduplication.call(this,t),emissiveColor:r.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:r.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:r.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:r.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:r.isSome(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:r.isSome(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:r.isSome(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}};return l}(h);b.__decorate([m.property({type:c,json:{write:!0}})],n.prototype,"emissiveColor",void 0);b.__decorate([m.property({type:d,
json:{write:!0}})],n.prototype,"emissiveTexture",void 0);b.__decorate([m.property({type:d,json:{write:!0}})],n.prototype,"occlusionTexture",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],n.prototype,"metallic",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],n.prototype,"roughness",void 0);b.__decorate([m.property({type:d,json:{write:!0}})],n.prototype,"metallicRoughnessTexture",void 0);b.__decorate([m.property()],
n.prototype,"occlusionTextureTransform",void 0);b.__decorate([m.property()],n.prototype,"emissiveTextureTransform",void 0);b.__decorate([m.property()],n.prototype,"metallicRoughnessTextureTransform",void 0);return n=f=b.__decorate([g.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],n)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(t,w,u,z){const {loggerTag:y,stride:B}=w;return 0!==t.length%B?(z.error(y,`Invalid array length, expected a multiple of ${B}`),new u([])):t}function f(t,w,u,z,y){if(!t)return t;if(t instanceof w)return d(t,z,w,y);for(const B of u)if(t instanceof B)return d(new w(t),z,w,y);if(Array.isArray(t))return d(new w(t),z,w,y);u=u.map(B=>`'${B.name}'`);y.error(`Failed to set property, expected one of ${u}, but got ${t.constructor.name}`);return new w([])}function e(t,w,
u){const z=Array(t.length);for(let y=0;y<t.length;y++)z[y]=t[y];w[u]=z}var l;const A=n.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=l=function(t){function w(z){z=t.call(this,z)||this;z.color=null;z.position=new Float64Array(0);z.uv=null;z.normal=null;z.tangent=null;return z}b._inheritsLoose(w,t);var u=w.prototype;u.castColor=function(z){return f(z,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},A)};u.castPosition=function(z){z&&z instanceof Float32Array&&
A.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return f(z,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},A)};u.castUv=function(z){return f(z,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},A)};u.castNormal=function(z){return f(z,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},A)};u.castTangent=function(z){return f(z,Float32Array,[Float64Array],
{loggerTag:".tangent\x3d",stride:4},A)};u.clone=function(){const z={position:m.clone(this.position),uv:m.clone(this.uv),normal:m.clone(this.normal),tangent:m.clone(this.tangent),color:m.clone(this.color)};return new l(z)};u.clonePositional=function(){const z={position:m.clone(this.position),normal:m.clone(this.normal),tangent:m.clone(this.tangent),uv:this.uv,color:this.color};return new l(z)};return w}(r.JSONSupport);c.__decorate([p.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"color",
void 0);c.__decorate([g.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([p.property({nonNullable:!0,json:{write:e}})],a.MeshVertexAttributes.prototype,"position",void 0);c.__decorate([g.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([p.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([g.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([p.property({json:{write:e}})],a.MeshVertexAttributes.prototype,
"normal",void 0);c.__decorate([g.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([p.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"tangent",void 0);c.__decorate([g.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=l=c.__decorate([h.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(x,v,D,F,G,J){if(v){var L=D.count,K=d.getSphericalPCPF(G);if(u(G))for(D=0;D<L;D++)F.getVec(D,
B),v.getVec(D,C),h.computeTranslationToOriginAndRotation(K,B,k,K),r.fromMat4(q,k),x===y.FROM_PCPF&&r.transpose(q,q),p.transformMat3(C,C,q),J.setVec(D,C);else for(G=0;G<L;G++){F.getVec(G,B);v.getVec(G,C);h.computeTranslationToOriginAndRotation(K,B,k,K);r.fromMat4(q,k);var O=e.y2lat(D.get(G,1));O=Math.cos(O);x===y.TO_PCPF&&(O=1/O);q[0]*=O;q[1]*=O;q[2]*=O;q[3]*=O;q[4]*=O;q[5]*=O;x===y.FROM_PCPF&&r.transpose(q,q);p.transformMat3(C,C,q);p.normalize(C,C);J.setVec(G,C)}return J}}function w(x){return u(x)||
x.isWebMercator}function u(x){return x.isWGS84||f.isCGCS2000(x)||f.isMars(x)||f.isMoon(x)}const z=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var y;(function(x){x[x.TO_PCPF=0]="TO_PCPF";x[x.FROM_PCPF=1]="FROM_PCPF"})(y||(y={}));const B=g.create(),C=g.create(),k=n.create(),q=m.create();a.projectFromPCPF=function(x,v,D){h.projectBuffer(x,d.getSphericalPCPF(D),0,v,D,0,x.length/3);return v};a.projectNormalFromPCPF=function(x,v,D,F,G){if(!w(F))return z.error("Cannot convert to spatial reference from PCPF"),
G;t(y.FROM_PCPF,l.BufferViewVec3f.fromTypedArray(x),l.BufferViewVec3f64.fromTypedArray(v),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(G));return G};a.projectNormalToPCPF=function(x,v,D,F,G){if(!w(F))return z.error("Cannot convert spatial reference to PCPF"),G;t(y.TO_PCPF,l.BufferViewVec3f.fromTypedArray(x),l.BufferViewVec3f64.fromTypedArray(v),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(G));return G};a.projectTangentFromPCPF=function(x,v,D,
F,G){if(!w(F))return z.error("Cannot convert to spatial reference from PCPF"),G;t(y.FROM_PCPF,l.BufferViewVec3f.fromTypedArray(x,16),l.BufferViewVec3f64.fromTypedArray(v),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(G,16));for(v=3;v<x.length;v+=4)G[v]=x[v];return G};a.projectTangentToPCPF=function(x,v,D,F,G){if(!w(F))return z.error("Cannot convert spatial reference to PCPF"),G;t(y.TO_PCPF,l.BufferViewVec3f.fromTypedArray(x,4*Float32Array.BYTES_PER_ELEMENT),l.BufferViewVec3f64.fromTypedArray(v),
l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(G,4*Float32Array.BYTES_PER_ELEMENT));for(v=3;v<x.length;v+=4)G[v]=x[v];return G};a.projectToPCPF=function(x,v,D){h.projectBuffer(x,v,0,D,d.getSphericalPCPF(v),0,x.length/3);return D};a.transformNormal=function(x,v,D){if(c.isNone(x))return v;r.normalFromMat4(q,D);x=l.BufferViewVec3f.fromTypedArray(x);D=l.BufferViewVec3f.fromTypedArray(v);A.transformMat3(D,x,q);r.isOrthoNormal(q)||A.normalize(D,D);return v};a.transformPosition=
function(x,v,D){if(c.isNone(x))return v;x=l.BufferViewVec3f64.fromTypedArray(x);const F=l.BufferViewVec3f64.fromTypedArray(v);A.transformMat4(F,x,D);return v};a.transformTangent=function(x,v,D){if(c.isNone(x))return v;r.normalFromMat4(q,D);D=l.BufferViewVec3f.fromTypedArray(x,4*Float32Array.BYTES_PER_ELEMENT);const F=l.BufferViewVec3f.fromTypedArray(v,4*Float32Array.BYTES_PER_ELEMENT);A.transformMat3(F,D,q);r.isOrthoNormal(q)||A.normalize(F,F);if(x!==v)for(D=3;D<x.length;D+=4)v[D]=x[D];return v};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../core/maybe","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(a,b,c,r,m){a.getTransformMatrix=function(n){if(b.isNone(n))return null;var p=b.isSome(n.offset)?n.offset:r.ZEROS,g=b.isSome(n.rotation)?n.rotation:0;n=b.isSome(n.scale)?n.scale:r.ONES;p=c.fromValues(1,0,0,0,1,
0,p[0],p[1],1);g=c.fromValues(Math.cos(g),-Math.sin(g),0,Math.sin(g),Math.cos(g),0,0,0,1);n=c.fromValues(n[0],0,0,0,n[1],0,0,0,1);const h=c.create();m.multiply(h,g,n);m.multiply(h,p,h);return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutput ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D){var F;(function(ba){ba[ba.START=0]="START";ba[ba.END=1]="END"})(F||(F={}));let G=function(ba){function ia(ha){ha=ba.call(this,ha,new K)||this;ha._configuration=new D.NativeLineTechniqueConfiguration;return ha}b._inheritsLoose(ia,ba);var ma=ia.prototype;ma.getConfiguration=function(ha,ka){this._configuration.output=ha;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.draped=ka.slot===z.RenderSlot.DRAPED_MATERIAL;ha=r.isSome(this.parameters.stipplePattern);this._configuration.stippleEnabled=ha;this._configuration.stippleOffColorEnabled=ha&&r.isSome(this.parameters.stippleOffColor);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous;return this._configuration};ma.intersect=
function(ha,ka,Z,ca,fa,ea,da,la,oa){r.isSome(oa)?q.intersectDrapedRenderLineGeometry(ha,ca,oa,ea,1,da):this._intersectLineGeometry(ha,ka,Z,ca,da)};ma._intersectLineGeometry=function(ha,ka,Z,ca,fa){if(ca.options.selectionMode&&!x.isInstanceHidden(ka))if(y.isTranslationMatrix(Z)){var ea=ha.vertexAttributes.get(B.VertexAttribute.POSITION).data,da=ca.camera,la=U;n.copy(la,ca.point);p.set(Y[0],la[0]-2,la[1]+2,0);p.set(Y[1],la[0]+2,la[1]+2,0);p.set(Y[2],la[0]+2,la[1]-2,0);p.set(Y[3],la[0]-2,la[1]-2,0);
for(ha=0;4>ha;ha++)if(!da.unprojectFromRenderScreen(Y[ha],V[ha]))return;e.fromPoints(da.eye,V[0],V[1],R);e.fromPoints(da.eye,V[1],V[2],X);e.fromPoints(da.eye,V[2],V[3],W);e.fromPoints(da.eye,V[3],V[0],aa);ka=Number.MAX_VALUE;ha=0;for(let ra=0;ra<ea.length-5;ra+=3)if(O[0]=ea[ra]+Z[12],O[1]=ea[ra+1]+Z[13],O[2]=ea[ra+2]+Z[14],P[0]=ea[ra+3]+Z[12],P[1]=ea[ra+4]+Z[13],P[2]=ea[ra+5]+Z[14],!(0>e.signedDistance(R,O)&&0>e.signedDistance(R,P)||0>e.signedDistance(X,O)&&0>e.signedDistance(X,P)||0>e.signedDistance(W,
O)&&0>e.signedDistance(W,P)||0>e.signedDistance(aa,O)&&0>e.signedDistance(aa,P))){da.projectToRenderScreen(O,E);da.projectToRenderScreen(P,I);if(0>E[2]&&0<I[2]){p.subtract(N,O,P);var oa=da.frustum;oa=-e.signedDistance(oa[d.PlaneIndex.NEAR],O)/p.dot(N,e.normal(oa[d.PlaneIndex.NEAR]));p.scale(N,N,oa);p.add(O,O,N);da.projectToRenderScreen(O,E)}else if(0<E[2]&&0>I[2])p.subtract(N,P,O),oa=da.frustum,oa=-e.signedDistance(oa[d.PlaneIndex.NEAR],P)/p.dot(N,e.normal(oa[d.PlaneIndex.NEAR])),p.scale(N,N,oa),
p.add(P,P,N),da.projectToRenderScreen(P,I);else if(0>E[2]&&0>I[2])continue;E[2]=0;I[2]=0;oa=f.distance2(f.fromPoints(E,I,T),la);oa<ka&&(ka=oa,p.copy(M,O),p.copy(Q,P),ha=ra/3)}Z=ca.rayBegin;ca=ca.rayEnd;4>ka&&(ka=Number.MAX_VALUE,f.closestLineSegmentPoint(f.fromPoints(M,Q,T),f.fromPoints(Z,ca,S),H)&&(p.subtract(H,H,Z),ka=p.length(H),p.scale(H,H,1/ka),ka/=p.distance(Z,ca)),fa(ka,H,ha,!1))}else c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")};
ma.computeAttachmentOrigin=function(ha,ka){ha=ha.vertexAttributes;if(!ha)return!1;ha=ha.get(B.VertexAttribute.POSITION);return t.computeAttachmentOriginLines(ha,null,!1,ka)};ma.requiresSlot=function(ha,ka){return(ka===A.ShaderOutput.Color||ka===A.ShaderOutput.Highlight||ka===A.ShaderOutput.ObjectAndLayerIdColor)&&(ha===z.RenderSlot.OPAQUE_MATERIAL||ha===z.RenderSlot.DRAPED_MATERIAL)};ma.createGLMaterial=function(ha){return new J(ha)};ma.createBufferWriter=function(){const ha=this.parameters.hasVertexColors?
k.PositionColorLayout:k.PositionLayout;return r.isNone(this.parameters.stipplePattern)?new k.DefaultBufferWriter(ha):new L(ha.clone().vec3f(B.VertexAttribute.AUXPOS1).vec2f(B.VertexAttribute.UV0))};return ia}(u.Material),J=function(ba){function ia(){var ha=ba.apply(this,arguments)||this;ha._stipplePattern=null;return ha}b._inheritsLoose(ia,ba);var ma=ia.prototype;ma.dispose=function(){ba.prototype.dispose.call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=
null};ma._updateOccludeeState=function(ha){ha.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ha.hasOccludees})};ma.beginSlot=function(ha){this._output===A.ShaderOutput.Color&&this._updateOccludeeState(ha);const ka=this._material.parameters.stipplePattern;this._stipplePattern!==ka&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,ka)),this._stipplePattern=ka);return this.ensureTechnique(v.NativeLineTechnique,ha)};
return ia}(w),L=function(){function ba(ma){this.vertexBufferLayout=ma}var ia=ba.prototype;ia.allocate=function(ma){return this.vertexBufferLayout.createBuffer(ma)};ia.elementCount=function(ma){return ma.indices.get(B.VertexAttribute.POSITION).length};ia.write=function(ma,ha,ka,Z,ca){C.writeDefaultAttributes(ka,this.vertexBufferLayout,ma,ha,Z,ca);this._writeAuxpos1(ma,ka,Z,ca);this._writeUV0(ma,ka,Z,ca)};ia._writeAuxpos1=function(ma,ha,ka,Z){var ca=ka.getField(B.VertexAttribute.AUXPOS1,l.BufferViewVec3f);
ka=ha.indices.get(B.VertexAttribute.POSITION);ha=ha.vertexAttributes.get(B.VertexAttribute.POSITION).data;const fa=ca.typedBufferStride;ca=ca.typedBuffer;Z*=fa;for(let da=0;da<ka.length-1;da+=2)for(const la of[1,0]){var ea=3*ka[da+la];const oa=ha[ea],ra=ha[ea+1];ea=ha[ea+2];const Aa=ma[1]*oa+ma[5]*ra+ma[9]*ea+ma[13],ua=ma[2]*oa+ma[6]*ra+ma[10]*ea+ma[14];ca[Z]=ma[0]*oa+ma[4]*ra+ma[8]*ea+ma[12];ca[Z+1]=Aa;ca[Z+2]=ua;Z+=fa}};ia._writeUV0=function(ma,ha,ka,Z){var ca=ka.getField(B.VertexAttribute.UV0,
l.BufferViewVec2f),fa=ha.indices.get(B.VertexAttribute.POSITION);ka=ha.vertexAttributes.get(B.VertexAttribute.POSITION).data;const ea=ha.vertexAttributes.get(B.VertexAttribute.DISTANCETOSTART)?.data;ha=ca.typedBufferStride;ca=ca.typedBuffer;Z*=ha;let da=0;ca[Z]=F.START;ca[Z+1]=da;Z+=ha;var la=3*fa[0];la=p.set(O,ka[la],ka[la+1],ka[la+2]);ma&&p.transformMat4(la,la,ma);const oa=P,ra=fa.length-1;let Aa=1;const ua=ea?(va,Ja,pa)=>da=ea[pa]:(va,Ja,pa)=>da+=p.distance(va,Ja);for(let va=1;va<ra;va+=2){var za=
3*fa[va];p.set(oa,ka[za],ka[za+1],ka[za+2]);ma&&p.transformMat4(oa,oa,ma);ua(la,oa,Aa++);for(za=0;2>za;++za)ca[Z]=1-za,ca[Z+1]=da,Z+=ha;p.copy(la,oa)}fa=3*fa[ra];p.set(oa,ka[fa],ka[fa+1],ka[fa+2]);ma&&p.transformMat4(oa,oa,ma);ua(la,oa,Aa);ca[Z]=F.END;ca[Z+1]=da};return ba}(),K=function(ba){function ia(){var ma=ba.apply(this,arguments)||this;ma.color=h.ONES;ma.hasVertexColors=!1;ma.hasSlicePlane=!1;ma.width=1;ma.stipplePreferContinuous=!0;ma.hasOccludees=!1;ma.stippleTexture=null;return ma}b._inheritsLoose(ia,
ba);return ia}(u.MaterialParameters);const O=g.create(),P=g.create(),N=g.create(),H=g.create(),E=m.createRenderScreenPointArray3(),I=m.createRenderScreenPointArray3(),M=g.create(),Q=g.create(),T=f.create(),S=f.create(),U=g.create(),Y=[m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3()],V=[g.create(),g.create(),g.create(),g.create()],R=e.create(),X=e.create(),W=e.create(),aa=e.create();a.NativeLineMaterial=G;a.Parameters=
K;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){n=function(A){function t(){return A.apply(this,arguments)||this}c._inheritsLoose(t,A);var w=t.prototype;w.initializeConfiguration=function(u,z){z.hasWebGL2Context=u.rctx.type===f.ContextType.WEBGL2};w.initializeProgram=function(u){return new g.Program(u.rctx,t.shader.get().build(this.configuration),p.Default3D)};w.initializePipeline=function(){const u=this.configuration,z=l.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,
e.BlendFactor.ONE_MINUS_SRC_ALPHA),y=(B,C=null,k=null)=>l.makePipelineState({blending:C,depthTest:h.depthCompareLess,depthWrite:k,colorWrite:l.defaultColorWriteParams,stencilWrite:u.hasOccludees?h.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?B?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null});return u.output===r.ShaderOutput.Color?(this._occludeePipelineState=y(!0,u.transparent||this._stippleEnabled?z:null,l.defaultDepthWriteParams),y(!1,u.transparent||this._stippleEnabled?z:null,
l.defaultDepthWriteParams)):y(!1)};w.getPipelineState=function(u,z){return z?this._occludeePipelineState:A.prototype.getPipelineState.call(this,u,z)};c._createClass(t,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==r.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return e.PrimitiveType.LINES}}]);return t}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(d.NativeLine,()=>new Promise((A,t)=>a(["./NativeLine.glsl"],A,
t)));b.NativeLineTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(u){const z=new l.ShaderBuilder,{vertex:y,fragment:B}=z;z.include(r.Transform,u);z.include(m.VertexColor,u);z.include(p.LineStipple,u);h.addProjViewLocalOrigin(y,u);u.stippleEnabled&&(z.attributes.add(A.VertexAttribute.UV0,"vec2"),z.attributes.add(A.VertexAttribute.AUXPOS1,"vec3"),y.uniforms.add(new d.Float4PassUniform("viewport",(C,k)=>k.camera.fullViewport)));z.attributes.add(A.VertexAttribute.POSITION,"vec3");z.varyings.add("vpos","vec3");y.code.add(e.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);u.stippleEnabled&&(y.code.add(e.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),u.draped?y.uniforms.add(new f.FloatPassUniform("worldToScreenRatio",(C,k)=>1/k.screenToPCSRatio)):y.code.add(e.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),y.code.add(e.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),u.draped?y.code.add(e.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):y.code.add(e.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),y.uniforms.add(new f.FloatPassUniform("stipplePatternPixelSize",C=>p.computePixelSize(C))),y.code.add(e.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));y.code.add(e.glsl`}`);u.output===b.ShaderOutput.Highlight&&z.include(n.OutputHighlight,u);z.include(c.SliceDraw,u);B.uniforms.add(new f.FloatPassUniform("alphaCoverage",(C,k)=>Math.min(1,C.width*k.camera.pixelRatio)));u.hasVertexColors||B.uniforms.add(new d.Float4PassUniform("constantColor",C=>C.color));B.code.add(e.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${u.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${e.glsl.float(g.symbolAlphaCutoff)}) {
      discard;
    }

    ${u.output===b.ShaderOutput.Color?e.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${u.output===b.ShaderOutput.Highlight?e.glsl`outputHighlight();`:""}
  }
  `);return z}const w=Object.freeze(Object.defineProperty({__proto__:null,build:t},Symbol.toStringTag,{value:"Module"}));a.NativeLine=w;a.build=t})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,r,m,n){n=function(p){function g(){var h=
p.apply(this,arguments)||this;h.output=r.ShaderOutput.Color;h.hasSlicePlane=!1;h.hasVertexColors=!1;h.transparent=!1;h.draped=!1;h.stippleEnabled=!1;h.stippleOffColorEnabled=!1;h.stipplePreferContinuous=!0;h.hasOccludees=!1;return h}b._inheritsLoose(g,p);return g}(n.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.ShaderOutput.COUNT})],n.prototype,"output",void 0);c.__decorate([m.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],n.prototype,"hasVertexColors",
void 0);c.__decorate([m.parameter()],n.prototype,"transparent",void 0);c.__decorate([m.parameter()],n.prototype,"draped",void 0);c.__decorate([m.parameter()],n.prototype,"stippleEnabled",void 0);c.__decorate([m.parameter()],n.prototype,"stippleOffColorEnabled",void 0);c.__decorate([m.parameter()],n.prototype,"stipplePreferContinuous",void 0);c.__decorate([m.parameter()],n.prototype,"hasOccludees",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"stippleRequiresClamp",void 0);c.__decorate([m.parameter({constValue:!1})],
n.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([m.parameter({constValue:!1})],n.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N){B=function(T){function S(Y,V,R,X){Y=T.call(this,Y,V,R,X)||this;Y._resources=null;Y._optionalFields=[];Y._instanceIndexToGraphicUid=new Map;Y._hasLoadedPBRTextures=!1;Y._disposeResourceHandles=[];Y.ensureDrapedStatus(!1);Y._hasLoadedPBRTextures=R.physicalBasedRenderingEnabled;return Y}b._inheritsLoose(S,T);var U=S.prototype;U.getCachedSize=function(){const [Y,V,R]=m.isSome(this._resources)?this._resources.symbolSize:[1,1,
1];return{width:Y,depth:V,height:R}};U.doLoad=function(){var Y=b._asyncToGenerator(function*(V){if(!this._drivenProperties.size&&C.validateSymbolLayerSize(this.symbolLayer))throw Error();const R=this.symbolLayer;this._resources=this._isPrimitive?yield this._createResourcesForPrimitive(R.resource?R.resource.primitive:A.defaultPrimitive,V):yield this._createResourcesForUrl(R.resource.href,V);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=
this.computeComplexity()});return function(V){return Y.apply(this,arguments)}}();U._setMaterialTransparencyParams=function(Y,V=m.get(this.symbolLayer,"material","color")){V=this._getCombinedOpacity(V);const R=1>V||this.needsDrivenTransparentPass;Y.transparent=R;Y.opacity=V;Y.cullFace=R?L.CullFaceOptions.None:L.CullFaceOptions.Back;return Y};U._createResourcesForPrimitive=function(){var Y=b._asyncToGenerator(function*(V,R){if(!F.isValidPrimitive(V))throw Error(`Unknown object symbol primitive: ${V}`);
var X=this.symbolLayer;const W=l.create(t.objectSymbolLayerPrimitiveBoundingBox(V)),aa=d.fromArray(l.size(W)),ba=d.fromArray(t.objectSymbolLayerSizeWithResourceSize(aa,X)),ia=h.length(ba);var ma={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:d.ONES,diffuse:d.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ha=ma.usePBR;this._setMaterialTransparencyParams(ma);
const ka=this.symbol;if("point-3d"===ka.type&&ka.verticalOffset){const {screenLength:Z,minWorldLength:ca,maxWorldLength:fa}=ka.verticalOffset;ma.verticalOffset={screenLength:n.pt2px(Z),minWorldLength:ca||0,maxWorldLength:m.isSome(fa)?fa:Infinity};ma.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ma.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ma.externalColor=f.ONES:(X=m.isSome(X.material)&&X.material.color,X=m.isSome(X)?
c.toUnitRGBA(X):f.ONES,ma.externalColor=X);this._fastUpdates=J.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(W,ba,aa,m.none));ma.instanced=["transformation"];this._fastUpdates.enabled?(Object.assign(ma,this._fastUpdates.materialParameters),ma.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ma.instanced.push("color"),this._optionalFields.push("color"));r("enable-feature:objectAndLayerId-rendering")&&
(ma.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));ma=new N.DefaultMaterial(ma);ma=F.primitiveLodResources(V,ma);if(!ma)throw Error(`Unknown object symbol primitive: ${V}`);V=P.materialsFromLodResources(ma).map(Z=>({opacity:1,transparent:Z.parameters.transparent}));X=yield this._createStageResources(ma,ha);R=yield this._createLodRenderer(ma,R);return{lodResources:ma,lodRenderer:R,stageResources:X,symbolSize:ba,extentPadding:ia,isEsriSymbolResource:!1,isWosr:!1,
originalMaterialParameters:V,physicalBasedRenderingEnabled:ha,resourceBoundingBox:W,resourceSize:aa,pivotOffset:m.none}});return function(V,R){return Y.apply(this,arguments)}}();U._createResourcesForUrl=function(){var Y=b._asyncToGenerator(function*(V,R){var X=["transformation"],W={materialParamsMixin:{instanced:X,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};
this._fastUpdates=J.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(m.none,m.none,m.none,m.none));this._fastUpdates.enabled?(Object.assign(W.materialParamsMixin,this._fastUpdates.materialParameters),X.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(X.push("color"),this._optionalFields.push("color"));r("enable-feature:objectAndLayerId-rendering")&&(X.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));
X=this.symbol;if("point-3d"===X.type&&X.verticalOffset){const {screenLength:oa,minWorldLength:ra,maxWorldLength:Aa}=X.verticalOffset;W.materialParamsMixin.verticalOffset={screenLength:n.pt2px(oa),minWorldLength:ra||0,maxWorldLength:m.isSome(Aa)?Aa:Infinity};W.materialParamsMixin.castShadows=!1}W.signal=R;W.usePBR=this._context.physicalBasedRenderingEnabled;W.skipHighLods=this._context.skipHighSymbolLods;X=W.usePBR;var aa=yield v.fetch(V,W);V=aa.isEsriSymbolResource;W=aa.isWosr;const ba=x.makeLodResources(aa.lods);
x.fillEstimatedMinScreenSpaceRadius(ba);ba.levels.sort((oa,ra)=>oa.minScreenSpaceRadius-ra.minScreenSpaceRadius);ba.levels[0].minScreenSpaceRadius=Math.min(2,ba.levels[0].minScreenSpaceRadius);const ia=this._context,ma=this._getExternalColorParameters(this.symbolLayer.material);var ha=m.get(this.symbolLayer,"material","color");const ka=this._getCombinedOpacity(ha,{hasIntrinsicColor:!0}),Z=this.needsDrivenTransparentPass;var ca=P.materialsFromLodResources(ba);ha=P.materialsFromLodResources(ba).map(oa=>
({opacity:oa.parameters.opacity||1,transparent:oa.parameters.transparent}));ca.forEach(oa=>{const ra=oa.parameters;oa.setParameters(ma);const Aa=ra.opacity*ka;oa.setParameters({opacity:Aa,transparent:1>Aa||Z||ra.transparent});ia.screenSizePerspectiveEnabled&&oa.setParameters({screenSizePerspective:ia.sharedResources.screenSizePerspectiveSettings})});aa=aa.referenceBoundingBox;const fa=d.fromArray(l.size(aa)),ea=d.fromArray(ba.levels[0].pivotOffset),da=d.fromArray(t.objectSymbolLayerSizeWithResourceSize(fa,
this.symbolLayer)),la=h.length(da);J.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(aa,da,fa,ea))&&ca.forEach(oa=>oa.setParameters(this._fastUpdates.materialParameters));ca=yield this._createStageResources(ba,X);R=yield this._createLodRenderer(ba,R);return{lodResources:ba,lodRenderer:R,stageResources:ca,symbolSize:da,extentPadding:la,isEsriSymbolResource:V,isWosr:W,originalMaterialParameters:ha,physicalBasedRenderingEnabled:X,resourceBoundingBox:aa,
resourceSize:fa,pivotOffset:ea}});return function(V,R){return Y.apply(this,arguments)}}();U._addDisposeResource=function(Y){this._disposeResourceHandles.push(Y)};U._createStageResources=function(){var Y=b._asyncToGenerator(function*(V,R){const X=this._context.stage,W=P.materialsFromLodResources(V);R!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();X.addMany(W);this._addDisposeResource(()=>X.removeMany(W));const aa=P.texturesFromLodResources(V);X.addMany(aa);this._addDisposeResource(()=>
X.removeMany(aa));yield X.load(aa);const ba=P.geometriesFromLodResources(V);X.addMany(ba);this._addDisposeResource(()=>X.removeMany(ba));return{materials:W,textures:aa,geometries:ba}});return function(V,R){return Y.apply(this,arguments)}}();U._createLodRenderer=function(){var Y=b._asyncToGenerator(function*(V,R){const X=this._context.stage,W=new O.LodRenderer(V,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:aa=>this._instanceIndexToGraphicUid.get(aa),notifyGraphicGeometryChanged:aa=>
this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(aa)),notifyGraphicVisibilityChanged:aa=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(aa))},this._fastUpdates.enabled?{applyTransform:(aa,ba,ia)=>{aa.getFeatureAttribute(ba,M);p.copy(ia,J.evaluateModelTransform(this._fastUpdates.materialParameters,M,ia))},scaleFactor:(aa,ba,ia)=>{ba.getFeatureAttribute(ia,M);return J.evaluateModelTransformScale(aa,this._fastUpdates.materialParameters,
M)}}:null);W.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{X.removeRenderPlugin(W)});yield X.addRenderPlugin(W.slots,W,R);return W});return function(V,R){return Y.apply(this,arguments)}}();U._getExternalColorParameters=function(Y){const V={};this._drivenProperties.color?V.externalColor=f.ONES:m.isSome(Y)&&m.isSome(Y.color)?V.externalColor=c.toUnitRGBA(Y.color):(V.externalColor=f.ONES,V.colorMixMode="ignore");return V};U.destroy=function(){T.prototype.destroy.call(this);
this._cleanupResources()};U._cleanupResources=function(){this._disposeResourceHandles.forEach(Y=>Y());this._disposeResourceHandles.length=0;this._resources=null};U.createGraphics3DGraphic=function(Y){const V=Y.graphic;if(!this._validateGeometry(V.geometry))return null;const R=D.placePointOnGeometry(V.geometry);if(m.isNone(R))return this.logger.warn(`unsupported geometry type for icon symbol: ${V.geometry.type}`),null;const X=this.setGraphicElevationContext(V,new z.ElevationContext);return this._createAs3DShape(V,
R,Y.renderingInfo,X,V.uid,Y.layer.uid)};U.notifyDestroyGraphicLayer=function(Y){this._instanceIndexToGraphicUid.delete(Y.instanceIndex)};U.graphicLayerToGraphicId=function(){return 0};U.layerOpacityChanged=function(){if(!m.isNone(this._resources)){var Y=this._drivenProperties.opacity,V=!this._isPrimitive,R=this._resources.stageResources.materials,X=this._resources.originalMaterialParameters;for(let ba=0;ba<R.length;ba++){const ia=R[ba];var W=m.get(this.symbolLayer,"material","color"),aa=X[ba];W=this._getCombinedOpacity(W,
{hasIntrinsicColor:V})*aa.opacity;aa=1>W||Y||aa.transparent;ia.setParameters({opacity:W,transparent:aa});this._isPrimitive&&ia.setParameters({cullFace:aa?L.CullFaceOptions.None:L.CullFaceOptions.Back})}}};U.layerElevationInfoChanged=function(Y,V){return this.updateGraphics3DGraphicElevationInfo(Y,V,u.needsElevationUpdates3D)};U.slicePlaneEnabledChanged=function(){if(m.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Y of this._resources.stageResources.materials)Y.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0};U.physicalBasedRenderingChanged=function(){if(m.isNone(this._resources))return!0;const {stageResources:Y,isWosr:V}=this._resources;for(const R of Y.materials)this._isPrimitive?R.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):V||R.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0};U.pixelRatioChanged=
function(){return!0};U.applyRendererDiff=function(Y,V){if(m.isNone(this._resources))return k.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:R},lodRenderer:X,resourceBoundingBox:W,symbolSize:aa,resourceSize:ba,pivotOffset:ia}=this._resources;for(const ma in Y.diff)switch(ma){case "visualVariables":if(J.updateFastSymbolUpdatesState(this._fastUpdates,V,this._fastVisualVariableConvertOptions(W,aa,ba,ia))){for(const ha of R)ha.setParameters(this._fastUpdates.materialParameters);
X.notifyShaderTransformationChanged()}else return k.ApplyRendererDiffResult.Recreate_Symbol;break;default:return k.ApplyRendererDiffResult.Recreate_Symbol}return k.ApplyRendererDiffResult.Fast_Update};U.computeComplexity=function(){if(m.isNone(this._resources))return T.prototype.computeComplexity.call(this);var Y=this._resources.lodResources;const V=P.geometriesFromLodLevelResources(Y.levels[0]).reduce((W,aa)=>W+aa.indices.get(K.VertexAttribute.POSITION).length,0)/3,R=W=>Array.from(W.vertexAttributes.values()).reduce((aa,
ba)=>aa+(ba.data.buffer?.byteLength??0),0)+Array.from(W.indices.values()).reduce((aa,ba)=>aa+(Array.isArray(ba)?12*ba.length:ba.buffer.byteLength),0);var X=P.texturesFromLodResources(Y).reduce((W,aa)=>W+aa.estimatedTexMemRequired,0);Y=P.geometriesFromLodResources(Y).reduce((W,aa)=>W+R(aa),0);X=X/4+Y;X={...G.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:X};return{primitivesPerFeature:V,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:X}};U._hasLodRenderer=
function(){return m.isSome(this._resources)};U._createAs3DShape=function(Y,V,R,X,W,aa){if(!this._hasLodRenderer()||m.isNone(this._resources))return null;Y=this.getFastUpdateAttrValues(Y);const ba=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?C.mixinColorAndOpacity(R.color,R.opacity):null;var ia=this._context.clippingExtent;e.projectPointToVector(V,H,this._context.elevationProvider.spatialReference);if(m.isSome(ia)&&!l.containsPoint(ia,H))return null;ia=this._requiresTerrainElevation(X);
const ma=this._computeGlobalTransform(V,X,I,Q);R=this._computeLocalTransform(this._resources,this.symbolLayer,R,E);const ha=this._resources.lodRenderer.instanceData,ka=ha.addInstance();this._instanceIndexToGraphicUid.set(ka,W);ha.setLocalTransform(ka,R,!1);ha.setGlobalTransform(ka,ma);Y&&ha.setFeatureAttribute(ka,Y);ba&&ha.setColor(ka,ba);r("enable-feature:objectAndLayerId-rendering")&&ha.setObjectAndLayerIdColor(ka,this._context.stage.renderView._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:W,
layerUid:aa}));W=new y(this,ka,w.perLodInstanceElevationAligner,X);ia&&(W.alignedSampledElevation=Q.sampledElevation);W.needsElevationUpdates=u.needsElevationUpdates3D(X.mode);D.extendPointGraphicElevationContext(W,V,this._context.elevationProvider);return W};U._computeGlobalTransform=function(Y,V,R,X){u.evaluateElevationInfoAtPoint(Y,this._context.elevationProvider,V,this._context.renderCoordsHelper,X);H[0]=Y.x;H[1]=Y.y;H[2]=X.z;e.computeTranslationToOriginAndRotation(Y.spatialReference,H,R,this._context.renderCoordsHelper.spatialReference);
return R};U._computeLocalTransform=function(Y,V,R,X){p.identity(X);this._applyObjectRotation(R,!1,X);this._applyObjectRotation(V,!0,X);this._applyObjectScale(Y,R,X);this._applyAnchor(Y,V,X);return X};U._applyObjectScale=function(Y,V,R){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(Y=C.computeObjectScale(this._drivenProperties.size&&V.size?V.size:Y.symbolSize,Y.symbolSize,Y.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===Y[0]&&1===Y[1]&&1===Y[2]||p.scale(R,
R,Y))};U.prepareSymbolLayerPatch=function(Y){if("partial"===Y.diff.type){var V=Y.diff.diff;this._preparePatchTransform(Y,V);this._preparePatchColor(Y,V)}};U.updateGeometry=function(Y,V){if(m.isNone(this._resources))return!0;const R=V&&D.placePointOnGeometry(V);if(m.isNone(R))return!1;V=this.getGeometryElevationMode(V);if(Y.elevationContext.mode!==V)return!1;this._computeGlobalTransform(R,Y.elevationContext,I,Q);this._requiresTerrainElevation(Y.elevationContext)&&(Y.alignedSampledElevation=Q.sampledElevation);
this._resources.lodRenderer.instanceData.setGlobalTransform(Y.instanceIndex,I,!0);D.extendPointGraphicElevationContext(Y,R,this._context.elevationProvider);return!0};U._preparePatchTransform=function(Y,V){if((V.heading||V.tilt||V.roll||V.width||V.height||V.depth||V.anchor||V.anchorPosition)&&!m.isNone(this._resources)){var R=(ca,fa,ea)=>m.unwrapOr(null!=ca&&"complete"===ca.type?ca.newValue:fa,ea),X=R(V.heading,this.symbolLayer.heading,0),W=R(V.tilt,this.symbolLayer.tilt,0),aa=R(V.roll,this.symbolLayer.roll,
0),ba=R(V.width,this.symbolLayer.width,void 0),ia=R(V.height,this.symbolLayer.height,void 0),ma=R(V.depth,this.symbolLayer.depth,void 0),ha=R(V.anchor,this.symbolLayer.anchor,void 0);R=R(V.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete V.heading;delete V.tilt;delete V.roll;delete V.width;delete V.height;delete V.depth;delete V.anchor;delete V.anchorPosition;var ka={heading:X,tilt:W,roll:aa,anchor:ha,anchorPosition:R},Z=this._resources;this.loadStatus===q.LoadStatus.LOADED&&Y.symbolLayerStatePatches.push(()=>
{Z.symbolSize=d.fromArray(t.objectSymbolLayerSizeWithResourceSize(Z.resourceSize,{width:ba,height:ia,depth:ma,isPrimitive:this.symbolLayer.isPrimitive}))});Y.graphics3DGraphicPatches.push((ca,fa)=>{fa=this._computeLocalTransform(Z,ka,fa,E);Z.lodRenderer.instanceData.setLocalTransform(ca.instanceIndex,fa,!0)})}};U._preparePatchColor=function(Y,V){if(V.material&&"partial"===V.material.type&&(V=V.material.diff,V.color&&"complete"===V.color.type&&null!=V.color.newValue&&null!=V.color.oldValue)){var R=
V.color.newValue,X=m.isSome(R)?c.toUnitRGBA(R):f.ONES;delete V.color;var W=this._resources;m.isNone(W)||Y.graphics3DGraphicPatches.push(aa=>{this._hasPerInstanceColor()?(W.lodRenderer.instanceData.setColor(aa.instanceIndex,X),aa=this._setMaterialTransparencyParams({},R)):aa=this._setMaterialTransparencyParams({externalColor:X},R);for(const ba of W.stageResources.materials)ba.setParameters(aa)})}};U._requiresTerrainElevation=function(Y){return"absolute-height"!==Y.mode};U._applyObjectRotation=function(Y,
V,R){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&V))return C.computeObjectRotation(Y.heading,Y.tilt,Y.roll,R)};U._computeAnchor=function(Y,V,R){const X=d.create();switch(R.anchor){case "center":h.copy(X,l.center(Y));h.negate(X,X);break;case "top":V=l.center(Y);h.set(X,-V[0],-V[1],-Y[5]);break;case "bottom":V=l.center(Y);h.set(X,-V[0],-V[1],-Y[2]);break;case "relative":V=l.center(Y);Y=l.size(Y);R=(R=R.anchorPosition)?d.fromValues(R.x,R.y,R.z):d.ZEROS;h.multiply(X,
Y,R);h.add(X,X,V);h.negate(X,X);break;default:m.isSome(V)?h.negate(X,V):h.copy(X,d.ZEROS)}return X};U._applyAnchor=function(Y,V,R){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(Y=this._computeAnchor(Y.resourceBoundingBox,Y.pivotOffset,V))&&p.translate(R,R,Y)};U._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};U._fastVisualVariableConvertOptions=function(Y,V,R,X){const W=m.isSome(Y)?d.fromArray(l.size(Y)):d.ONES;Y=m.isSome(Y)?
this._computeAnchor(Y,X,this.symbolLayer):d.ZEROS;X=this._context.renderCoordsHelper.unitInMeters;R=C.computeObjectScale(m.isSome(V)?V:void 0,V,R,X);const aa=d.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:W,symbolSize:m.isSome(V)?V:d.ONES,unitInMeters:X,transformation:{anchor:Y,scale:R,rotation:aa}}};b._createClass(S,[{key:"extentPadding",get:function(){return m.isSome(this._resources)?this._resources.extentPadding:0}},{key:"_isPrimitive",
get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return m.get(this._resources,"lodRenderer")}}]);return S}(B.Graphics3DSymbolLayer);const H=d.create(),E=g.create(),I=g.create(),M=f.create(),Q=new u.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(){function u(y,B,C,k){this.graphics3DSymbolLayer=y;this.instanceIndex=B;this.elevationAligner=C;this.elevationContext=k;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var z=u.prototype;z.initialize=function(){};z.setVisibility=function(y){const B=this._lodRenderer.instanceData;y!==B.getVisible(this.instanceIndex)&&B.setVisible(this.instanceIndex,y)};z.destroy=function(){null!=
this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};z.alignWithElevation=function(y,B,C){this.elevationAligner&&(p.setContextFeature(this.elevationContext.featureExpressionInfoContext,C),y=this.elevationAligner(this,this.elevationContext,y,B),b.isSome(y)&&(this.alignedSampledElevation=y))};z.getCenterObjectSpace=function(y=m.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
w);return r.transformMat4(y,this._lodRenderer.baseBoundingSphere.center,w)};z.getBoundingBoxObjectSpace=function(y=n.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,w);const B=this._lodRenderer.baseBoundingBox;n.empty(y);for(let C=0;8>C;++C)r.set(l,0===(C&1)?B[0]:B[3],0===(C&2)?B[1]:B[4],0===(C&4)?B[2]:B[5]),r.transformMat4(l,l,w),n.expandWithVec3(y,l);return y};z.computeAttachmentOrigin=function(y){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
w);y.render.origin[0]+=w[12];y.render.origin[1]+=w[13];y.render.origin[2]+=w[14];y.render.num++};z.getProjectedBoundingBox=function(){var y=a._asyncToGenerator(function*(B,C,k,q,x){x=this.getBoundingBoxObjectSpace(x);var v=t;const D=n.isPoint(x)?1:v.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,w);for(var F=0;F<D;F++){const G=v[F];l[0]=x[G[0]];l[1]=x[G[1]];l[2]=x[G[2]];r.transformMat4(l,l,w);e[3*F]=l[0];e[3*F+1]=l[1];e[3*F+2]=l[2]}if(!B(e,0,D))return null;n.empty(x);
B=null;this.calculateRelativeScreenBounds&&(B=this.calculateRelativeScreenBounds());for(v=0;v<3*D;v+=3){for(F=0;3>F;F++)x[F]=Math.min(x[F],e[v+F]),x[F+3]=Math.max(x[F+3],e[v+F]);B&&k.push({location:e.slice(v,v+3),screenSpaceBoundingRect:B})}if(C&&(n.center(x,A),"absolute-height"!==this.elevationContext.mode)){let G;k=g.demResolutionForBoundingBox(x,C.service.spatialReference,C);try{G=yield C.service.queryElevation(A[0],A[1],q,k,"ground")}catch(J){}b.isSome(G)&&n.offset(x,0,0,-this.alignedSampledElevation+
G)}return x});return function(B,C,k,q,x){return y.apply(this,arguments)}}();z.addObjectState=function(y,B){y===h.Object3DState.Highlight&&(y=new d.Object3DStateID(y),this._addHighlightId(y),B.addExternal(C=>{this._removeHighlightId(C)},y))};z.removeObjectState=function(y){this._highlights.forEach(B=>y.remove(B))};z._addHighlightId=function(y){this._highlights.add(y);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};z._removeHighlightId=function(y){this._highlights.delete(y);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(u,[{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return u}();const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=m.create(),A=m.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],w=c.create();return f})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../../../core/maybe","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,c){function r(n){const p=
[];n.stageResources.geometries.forEach((g,h)=>{p.push({material:n.stageResources.materials[h],geometry:g,textures:n.stageResources.textures})});return{components:p,minScreenSpaceRadius:b.isSome(n.lodThreshold)?n.lodThreshold:0,pivotOffset:n.pivotOffset}}function m(n,p=.05){n=c.computeFaceCount(n);return Math.sqrt(n/(p*Math.PI))}a.estimateMinScreenSpaceRadius=m;a.fillEstimatedMinScreenSpaceRadius=function(n){n.levels.forEach(p=>{p.minScreenSpaceRadius||(p.minScreenSpaceRadius=m(p))})};a.makeLodLevelResources=
r;a.makeLodResources=function(n){return{levels:n.map(p=>r(p))}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K){function O(){O=b._asyncToGenerator(function*(E,I){E=P(c.adjustStaticAGOUrl(E));if("wosr"===E.fileType){var M=yield I.cache?I.cache.loadWOSR(E.url,I):C.load(E.url,I);const {engineResources:X,referenceBoundingBox:W}=C.processLoadResult(M,I);return{lods:X,referenceBoundingBox:W,isEsriSymbolResource:!1,isWosr:!0}}const Q=yield I.cache?I.cache.loadGLTF(E.url,I,I.usePBR):u.loadGLTF(new w.DefaultLoadingContext(I.streamDataRequester),
E.url,I,I.usePBR),T=r.get(Q.model.meta,"ESRI_proxyEllipsoid"),S=Q.meta.isEsriSymbolResource&&r.isSome(T)&&Q.meta.uri.includes("/RealisticTrees/");if(S&&!Q.customMeta.esriTreeRendering){Q.customMeta.esriTreeRendering=!0;a:for(let X=0;X<Q.model.lods.length;++X){var U=Q.model.lods[X];for(M of U.parts){U=M.attributes.normal;if(r.isNone(U))break a;const W=M.attributes.position,aa=W.count,ba=d.create(),ia=d.create(),ma=d.create(),ha=t.createBuffer(e.BufferViewVec4u8,aa),ka=t.createBuffer(e.BufferViewVec3f,
aa),Z=p.invert(g.create(),M.transform);for(let ca=0;ca<aa;ca++){W.getVec(ca,ia);U.getVec(ca,ba);h.transformMat4(ia,ia,M.transform);h.subtract(ma,ia,T.center);h.divide(ma,ma,T.radius);const fa=ma[2];var Y=h.length(ma);Y=Math.min(.45+.55*Y*Y,1);h.divide(ma,ma,T.radius);null!==Z&&h.transformMat4(ma,ma,Z);h.normalize(ma,ma);X+1!==Q.model.lods.length&&1<Q.model.lods.length&&(-1<fa?h.lerp(ma,ma,ba,.2):h.lerp(ma,ma,ba,Math.min(-4*fa-3.8,1)));ka.setVec(ca,ma);ha.set(ca,0,255*Y);ha.set(ca,1,255*Y);ha.set(ca,
2,255*Y);ha.set(ca,3,255)}M.attributes.normal=ka;M.attributes.color=ha}}}const {engineResources:V,referenceBoundingBox:R}=N(Q,Q.meta.isEsriSymbolResource?{usePBR:I.usePBR,isSchematic:!1,treeRendering:S,mrrFactors:[0,1,.2]}:{usePBR:I.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},{...I.materialParamsMixin,treeRendering:S},I.skipHighLods&&null==E.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:E.specifiedLodIndex});return{lods:V,referenceBoundingBox:R,isEsriSymbolResource:Q.meta.isEsriSymbolResource,
isWosr:!1}});return O.apply(this,arguments)}function P(E){const I=E.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return I?{fileType:"gltf",url:I[1],specifiedLodIndex:null!=I[4]?Number(I[4]):null}:E.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:E,specifiedLodIndex:null}:{fileType:"unknown",url:E,specifiedLodIndex:null}}function N(E,I,M,Q){const T=E.model,S=[],U=new Map,Y=new Map,V=T.lods.length,R=f.empty();T.lods.forEach((X,W)=>{const aa=!0===Q.skipHighLods&&(1<V&&0===W||3<V&&1===W)||!1===Q.skipHighLods&&
null!=Q.singleLodIndex&&W!==Q.singleLodIndex;if(!aa||0===W){var ba=[],ia=0;X.parts.forEach(ha=>{a:{var ka=ha.indices||ha.attributes.position.count;switch(ha.primitiveType){case G.PrimitiveType.TRIANGLES:ka=z.trianglesToTriangles(ka);break a;case G.PrimitiveType.TRIANGLE_STRIP:ka=z.triangleStripToTriangles(ka);break a;case G.PrimitiveType.TRIANGLE_FAN:ka=z.triangleFanToTriangles(ka);break a}ka=void 0}const Z=ha.attributes.position.count;var ca=t.createBuffer(e.BufferViewVec3f,Z);l.transformMat4(ca,
ha.attributes.position,ha.transform);ca=[[v.VertexAttribute.POSITION,{data:ca.typedBuffer,size:ca.elementCount,exclusive:!0}]];const fa=[[v.VertexAttribute.POSITION,ka]];if(r.isSome(ha.attributes.normal)){var ea=t.createBuffer(e.BufferViewVec3f,Z);m.normalFromMat4(H,ha.transform);l.transformMat3(ea,ha.attributes.normal,H);ca.push([v.VertexAttribute.NORMAL,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]);fa.push([v.VertexAttribute.NORMAL,ka])}r.isSome(ha.attributes.tangent)&&(ea=t.createBuffer(e.BufferViewVec4f,
Z),m.normalFromMat4(H,ha.transform),A.transformMat3(ea,ha.attributes.tangent,H),ca.push([v.VertexAttribute.TANGENT,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]),fa.push([v.VertexAttribute.TANGENT,ka]));r.isSome(ha.attributes.texCoord0)&&(ea=t.createBuffer(e.BufferViewVec2f,Z),J.normalizeIntegerBuffer(ea,ha.attributes.texCoord0),ca.push([v.VertexAttribute.UV0,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]),fa.push([v.VertexAttribute.UV0,ka]));if(r.isSome(ha.attributes.color)){ea=
t.createBuffer(e.BufferViewVec4u8,Z);if(4===ha.attributes.color.elementCount)ha.attributes.color instanceof e.BufferViewVec4f?A.scale(ea,ha.attributes.color,255):ha.attributes.color instanceof e.BufferViewVec4u8?L.copy(ea,ha.attributes.color):ha.attributes.color instanceof e.BufferViewVec4u16&&A.scale(ea,ha.attributes.color,1/256);else{L.fill(ea,255,255,255,255);const oa=new e.BufferViewVec3u8(ea.buffer,0,4);ha.attributes.color instanceof e.BufferViewVec3f?l.scale(oa,ha.attributes.color,255):ha.attributes.color instanceof
e.BufferViewVec3u8?K.copy(oa,ha.attributes.color):ha.attributes.color instanceof e.BufferViewVec3u16&&l.scale(oa,ha.attributes.color,1/256)}ca.push([v.VertexAttribute.COLOR,{data:ea.typedBuffer,size:ea.elementCount,exclusive:!0}]);fa.push([v.VertexAttribute.COLOR,ka])}ha={geometry:new q.Geometry(ca,fa),vertexCount:Z};const {geometry:da,vertexCount:la}=ha;ba.push(da);ia+=la;ha=da.boundingInfo;r.isSome(ha)&&0===W&&(f.expandWithVec3(R,ha.getBBMin()),f.expandWithVec3(R,ha.getBBMax()))});if(!aa){var ma=
new B.ProcessedObjectResource(X.name,{textures:[],materials:[],geometries:ba},X.lodThreshold,[0,0,0],ia);S.push(ma);X.parts.forEach(ha=>{const ka=ha.material+(ha.attributes.normal?"_normal":"")+(ha.attributes.color?"_color":"")+(ha.attributes.texCoord0?"_texCoord0":"")+(ha.attributes.tangent?"_tangent":""),Z=T.materials.get(ha.material),ca=r.isSome(ha.attributes.texCoord0),fa=r.isSome(ha.attributes.normal);if(!r.isNone(Z)){a:{switch(Z.alphaMode){case "BLEND":var ea=k.AlphaDiscardMode.Blend;break a;
case "MASK":ea=k.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ea=k.AlphaDiscardMode.Opaque;break a}ea=void 0}if(!U.has(ka)){if(ca){var da=(va,Ja=!1)=>{if(r.isSome(va)&&!Y.has(va)){const pa=T.textures.get(va);r.isSome(pa)&&Y.set(va,new x.Texture(pa.data,Ja?{...pa.parameters,preMultiplyAlpha:Ja}:pa.parameters))}};da(Z.textureColor,ea!==k.AlphaDiscardMode.Opaque);da(Z.textureNormal);da(Z.textureOcclusion);da(Z.textureEmissive);da(Z.textureMetallicRoughness)}da=Z.color[0]**(1/F.COLOR_GAMMA);
const la=Z.color[1]**(1/F.COLOR_GAMMA),oa=Z.color[2]**(1/F.COLOR_GAMMA),ra=Z.emissiveFactor[0]**(1/F.COLOR_GAMMA),Aa=Z.emissiveFactor[1]**(1/F.COLOR_GAMMA),ua=Z.emissiveFactor[2]**(1/F.COLOR_GAMMA),za=r.isSome(Z.textureColor)&&ca?Y.get(Z.textureColor):null;U.set(ka,new D.DefaultMaterial({...I,transparent:ea===k.AlphaDiscardMode.Blend,customDepthTest:k.DepthTestFunction.Lequal,textureAlphaMode:ea,textureAlphaCutoff:Z.alphaCutoff,diffuse:[da,la,oa],ambient:[da,la,oa],opacity:Z.opacity,doubleSided:Z.doubleSided,
doubleSidedType:"winding-order",cullFace:Z.doubleSided?k.CullFaceOptions.None:k.CullFaceOptions.Back,hasVertexColors:!!ha.attributes.color,hasVertexTangents:!!ha.attributes.tangent,normals:fa?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:r.isSome(za)?za.id:void 0,colorMixMode:Z.colorMixMode,normalTextureId:r.isSome(Z.textureNormal)&&ca?Y.get(Z.textureNormal).id:void 0,textureAlphaPremultiplied:r.isSome(za)&&!!za.params.preMultiplyAlpha,occlusionTextureId:r.isSome(Z.textureOcclusion)&&
ca?Y.get(Z.textureOcclusion).id:void 0,emissiveTextureId:r.isSome(Z.textureEmissive)&&ca?Y.get(Z.textureEmissive).id:void 0,metallicRoughnessTextureId:r.isSome(Z.textureMetallicRoughness)&&ca?Y.get(Z.textureMetallicRoughness).id:void 0,emissiveFactor:[ra,Aa,ua],mrrFactors:[Z.metallicFactor,Z.roughnessFactor,I.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:y.getTransformMatrix(Z.colorTextureTransform),normalTextureTransformMatrix:y.getTransformMatrix(Z.normalTextureTransform),occlusionTextureTransformMatrix:y.getTransformMatrix(Z.occlusionTextureTransform),
emissiveTextureTransformMatrix:y.getTransformMatrix(Z.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:y.getTransformMatrix(Z.metallicRoughnessTextureTransform),...M}))}ma.stageResources.materials.push(U.get(ka));ca&&(ha=la=>{r.isSome(la)&&ma.stageResources.textures.push(Y.get(la))},ha(Z.textureColor),ha(Z.textureNormal),ha(Z.textureOcclusion),ha(Z.textureEmissive),ha(Z.textureMetallicRoughness))}})}}});return{engineResources:S,referenceBoundingBox:R}}const H=n.create();a.fetch=function(E,
I){return O.apply(this,arguments)};a.gltfToEngineResources=N;a.parseUrl=P;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,r=/^[\w-]*\.mapsdevext.arcgis.com$/,m=/^[\w-]*\.mapsqa.arcgis.com$/,n=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,r,m];a.adjustStaticAGOUrl=function(p,g){return p?(g=g||globalThis.location.hostname)?
null!=g.match(b)||null!=g.match(r)?p.replace("static.arcgis.com","staticdev.arcgis.com"):null!=g.match(c)||null!=g.match(m)?p.replace("static.arcgis.com","staticqa.arcgis.com"):p:p:p};a.isDevEnvironment=function(p){p=p||globalThis.location.hostname;return n.some(g=>null!=p?.match(g))};a.isTelemetryDevEnvironment=function(p){p=p||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(n).some(g=>null!=p?.match(g))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(h,d,f){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=h.count,l=f[0],A=f[1],t=f[2],w=f[3],u=f[4],z=f[5],y=f[6],B=f[7],C=f[8],k=f[9],q=f[10],x=f[11],v=f[12],D=f[13],F=f[14];f=f[15];var G=h.typedBuffer;h=h.typedBufferStride;var J=d.typedBuffer;d=d.typedBufferStride;for(let K=0;K<e;K++){const O=K*h;var L=K*d;
const P=J[L],N=J[L+1],H=J[L+2];L=J[L+3];G[O]=l*P+u*N+C*H+v*L;G[O+1]=A*P+z*N+k*H+D*L;G[O+2]=t*P+y*N+q*H+F*L;G[O+3]=w*P+B*N+x*H+f*L}}}function r(h,d,f){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=h.count,l=f[0],A=f[1],t=f[2],w=f[3],u=f[4],z=f[5],y=f[6],B=f[7];f=f[8];var C=h.typedBuffer;h=h.typedBufferStride;var k=d.typedBuffer;d=d.typedBufferStride;for(let x=0;x<e;x++){const v=x*h;var q=x*d;const D=k[q],F=k[q+1],G=k[q+
2];q=k[q+3];C[v]=l*D+w*F+y*G;C[v+1]=A*D+u*F+B*G;C[v+2]=t*D+z*F+f*G;C[v+3]=q}}}function m(h,d){const f=Math.min(h.count,d.count),e=h.typedBuffer;h=h.typedBufferStride;const l=d.typedBuffer;d=d.typedBufferStride;for(let w=0;w<f;w++){const u=w*h;var A=w*d;const z=l[A],y=l[A+1];A=l[A+2];var t=z*z+y*y+A*A;0<t&&(t=1/Math.sqrt(t),e[u]=t*z,e[u+1]=t*y,e[u+2]=t*A)}}function n(h,d,f){const e=Math.min(h.count,d.count),l=h.typedBuffer;h=h.typedBufferStride;const A=d.typedBuffer;d=d.typedBufferStride;for(let t=
0;t<e;t++){const w=t*h,u=t*d;l[w]=f*A[u];l[w+1]=f*A[u+1];l[w+2]=f*A[u+2];l[w+3]=f*A[u+3]}}function p(h,d,f){const e=Math.min(h.count,d.count),l=h.typedBuffer;h=h.typedBufferStride;const A=d.typedBuffer;d=d.typedBufferStride;for(let t=0;t<e;t++){const w=t*h,u=t*d;l[w]=A[u]>>f;l[w+1]=A[u+1]>>f;l[w+2]=A[u+2]>>f;l[w+3]=A[u+3]>>f}}const g=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:r,normalize:m,scale:n,shiftRight:p},Symbol.toStringTag,{value:"Module"}));a.normalize=
m;a.scale=n;a.shiftRight=p;a.transformMat3=r;a.transformMat4=c;a.vec4=g})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),function(a,b,c,r,m,n,p,g){a.mat3=c.mat3;a.mat4=r.mat4;a.scalar=m.scalar;a.vec2=n.vec2;a.vec3=p.vec3;a.vec4=g.vec4;a.createBuffer=function(h,d){return new h(new ArrayBuffer(d*h.ElementCount*b.elementTypeSize(h.ElementType)))};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function b(r,m,n){const p=r.typedBuffer;r=r.typedBufferStride;const g=m.typedBuffer,h=m.typedBufferStride;m=n?n.count:m.count;let d=(n&&n.dstIndex?n.dstIndex:0)*r;n=(n&&n.srcIndex?n.srcIndex:0)*h;for(let f=0;f<m;++f){for(let e=0;9>e;++e)p[d+e]=g[n+e];d+=r;n+=h}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,
{value:"Module"}));a.copy=b;a.mat3=c})},"esri/chunks/mat42":function(){define(["exports"],function(a){function b(r,m,n){const p=r.typedBuffer;r=r.typedBufferStride;const g=m.typedBuffer,h=m.typedBufferStride;m=n?n.count:m.count;let d=(n&&n.dstIndex?n.dstIndex:0)*r;n=(n&&n.srcIndex?n.srcIndex:0)*h;for(let f=0;f<m;++f){for(let e=0;16>e;++e)p[d+e]=g[n+e];d+=r;n+=h}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.mat4=c})},"esri/chunks/scalar":function(){define(["exports"],
function(a){function b(m,n,p){const g=m.typedBuffer;m=m.typedBufferStride;const h=n.typedBuffer,d=n.typedBufferStride;n=p?p.count:n.count;let f=(p&&p.dstIndex?p.dstIndex:0)*m;p=(p&&p.srcIndex?p.srcIndex:0)*d;for(let e=0;e<n;++e)g[f]=h[p],f+=m,p+=d}function c(m,n){const p=m.count;n||(n=new m.TypedArrayConstructor(p));for(let g=0;g<p;g++)n[g]=m.get(g);return n}const r=Object.freeze(Object.defineProperty({__proto__:null,copy:b,makeDense:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.makeDense=c;
a.scalar=r})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,b){function c(p,g,h){const d=p.typedBuffer;p=p.typedBufferStride;const f=g.typedBuffer,e=g.typedBufferStride;g=h?h.count:g.count;let l=(h&&h.dstIndex?h.dstIndex:0)*p;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(let A=0;A<g;++A)d[l]=f[h],d[l+1]=f[h+1],l+=p,h+=e}function r(p,g,h){const d=p.typedBuffer,f=p.typedBufferStride,e=g.typedBuffer,l=g.typedBufferStride,A=h?h.count:g.count;let t=(h&&h.dstIndex?
h.dstIndex:0)*f,w=(h&&h.srcIndex?h.srcIndex:0)*l;if(b.isInteger(g.elementType))if(h=b.maximumValue(g.elementType),b.isSigned(g.elementType))for(g=0;g<A;++g)d[t]=Math.max(e[w]/h,-1),d[t+1]=Math.max(e[w+1]/h,-1),t+=f,w+=l;else for(g=0;g<A;++g)d[t]=e[w]/h,d[t+1]=e[w+1]/h,t+=f,w+=l;else c(p,g,h);return p}function m(p,g,h,d){const f=p.typedBuffer,e=p.typedBufferStride;p=d?.count??p.count;d=(d?.dstIndex??0)*e;for(let l=0;l<p;++l)f[d]=g,f[d+1]=h,d+=e}const n=Object.freeze(Object.defineProperty({__proto__:null,
copy:c,normalizeIntegerBuffer:r,fill:m},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.fill=m;a.normalizeIntegerBuffer=r;a.vec2=n})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(m,n,p){const g=m.typedBuffer;m=m.typedBufferStride;const h=n.typedBuffer,d=n.typedBufferStride;n=p?p.count:n.count;let f=(p&&p.dstIndex?p.dstIndex:0)*m;p=(p&&p.srcIndex?p.srcIndex:0)*d;for(let e=0;e<n;++e)g[f]=h[p],g[f+1]=h[p+1],g[f+2]=h[p+2],f+=m,p+=d}function c(m,n,p,g,h){const d=m.typedBuffer,
f=m.typedBufferStride;m=h?.count??m.count;h=(h?.dstIndex??0)*f;for(let e=0;e<m;++e)d[h]=n,d[h+1]=p,d[h+2]=g,h+=f}const r=Object.freeze(Object.defineProperty({__proto__:null,copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec3=r})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(m,n,p){const g=m.typedBuffer;m=m.typedBufferStride;const h=n.typedBuffer,d=n.typedBufferStride;n=p?p.count:n.count;let f=(p&&p.dstIndex?p.dstIndex:0)*m;p=(p&&p.srcIndex?p.srcIndex:
0)*d;for(let e=0;e<n;++e)g[f]=h[p],g[f+1]=h[p+1],g[f+2]=h[p+2],g[f+3]=h[p+3],f+=m,p+=d}function c(m,n,p,g,h,d){const f=m.typedBuffer,e=m.typedBufferStride;m=d?.count??m.count;d=(d?.dstIndex??0)*e;for(let l=0;l<m;++l)f[d]=n,f[d+1]=p,f[d+2]=g,f[d+3]=h,d+=e}const r=Object.freeze(Object.defineProperty({__proto__:null,copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec4=r})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(){function f(l){this._streamDataRequester=l}var e=f.prototype;e.loadJSON=function(){var l=b._asyncToGenerator(function*(A,t){return this._load("json",A,t)});return function(A,t){return l.apply(this,arguments)}}();e.loadBinary=function(){var l=b._asyncToGenerator(function*(A,t){return g.isDataProtocol(A)?(p.throwIfAborted(t),g.dataToArrayBuffer(A)):this._load("binary",A,t)});return function(A,t){return l.apply(this,arguments)}}();e.loadImage=function(){var l=
b._asyncToGenerator(function*(A,t){return this._load("image",A,t)});return function(A,t){return l.apply(this,arguments)}}();e._load=function(){var l=b._asyncToGenerator(function*(A,t,w){if(n.isNone(this._streamDataRequester))return(yield c(t,{responseType:d[A]})).data;A=yield r.result(this._streamDataRequester.request(t,A,w));if(!0===A.ok)return A.value;p.throwIfAbortError(A.error);throw new m("",`Request for resource failed: ${A.error}`);});return function(A,t,w){return l.apply(this,arguments)}}();
return f}();const d={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,r,m,n,p,g){function h(){h=b._asyncToGenerator(function*(u,z,y={},B=!0){const C=
yield p.GLTFResource.load(u,t,z,y),k=`gltf_${A++}`,q={lods:[],materials:new Map,textures:new Map,meta:d(C)};u=!(!C.json.asset.extras||"symbolResource"!==C.json.asset.extras.ESRI_type);const x=new Map;yield f(C,function(){var D=b._asyncToGenerator(function*(F,G,J,L){const K=x.get(J)??0;x.set(J,K+1);var O=void 0!==F.mode?F.mode:g.PrimitiveType.TRIANGLES,P=O===g.PrimitiveType.TRIANGLES||O===g.PrimitiveType.TRIANGLE_STRIP||O===g.PrimitiveType.TRIANGLE_FAN?O:null;if(c.isNone(P))t.warnUnsupported("Unsupported primitive mode ("+
g.PrimitiveType[O]+"). Skipping primitive.");else if(C.hasPositions(F)){O=C.getPositionData(F,y);var N=C.getMaterial(F,y,B),H=C.hasNormals(F)?C.getNormalData(F,y):null,E=C.hasTangents(F)?C.getTangentData(F,y):null,I=C.hasTextureCoordinates(F)?C.getTextureCoordinates(F,y):null,M=C.hasVertexColors(F)?C.getVertexColors(F,y):null;F=C.getIndexData(F,y);G={transform:r.clone(G),attributes:{position:yield O,normal:H?yield H:null,texCoord0:I?yield I:null,color:M?yield M:null,tangent:E?yield E:null},indices:yield F,
primitiveType:P,material:l(q,yield N,k)};P=null;c.isSome(q.meta)&&c.isSome(q.meta.ESRI_lod)&&"screenSpaceRadius"===q.meta.ESRI_lod.metric&&(P=q.meta.ESRI_lod.thresholds[J]);q.lods[J]=q.lods[J]||{parts:[],name:L,lodThreshold:P};q.lods[J].parts[K]=G}else t.warn("Skipping primitive without POSITION vertex attribute.")});return function(F,G,J,L){return D.apply(this,arguments)}}());for(var v of q.lods)v.parts=v.parts.filter(D=>!!D);v=yield C.getLoadedBuffersSize();return{model:q,meta:{isEsriSymbolResource:u,
uri:C.uri},customMeta:{},size:v}});return h.apply(this,arguments)}function d(u){let z=null;u.json.nodes.forEach(y=>{y=y.extras;c.isSome(y)&&(y.ESRI_proxyEllipsoid||y.ESRI_lod)&&(z=y)});return z}function f(u,z){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(u,z){function y(v,D){return B.apply(this,arguments)}function B(){B=b._asyncToGenerator(function*(v,D){const F=C.nodes[v];v=u.getNodeTransform(v);t.warnUnsupportedIf(null!=F.weights,"Morph targets are not supported.");
if(null!=F.mesh){const G=C.meshes[F.mesh];for(const J of G.primitives)x.push(z(J,v,D,G.name))}for(const G of F.children||[])x.push(y(G,D))});return B.apply(this,arguments)}const C=u.json;var k=C.scenes[C.scene||0].nodes;const q=1<k.length,x=[];for(const v of k)k=C.nodes[v],x.push(y(v,0)),k.extensions&&k.extensions.MSFT_lod&&Array.isArray(k.extensions.MSFT_lod.ids)&&!q&&k.extensions.MSFT_lod.ids.forEach((D,F)=>y(D,F+1));yield Promise.all(x)});return e.apply(this,arguments)}function l(u,z,y){const B=
k=>{const q=`${y}_tex_${k&&k.id}${k&&k.name?"_"+k.name:""}`;k&&!u.textures.has(q)&&(k=n.makeTextureSource(k.data,{wrap:{s:k.wrapS,t:k.wrapT},mipmap:w.includes(k.minFilter),noUnpackFlip:!0}),u.textures.set(q,k));return q},C=`${y}_mat_${z.id}_${z.name}`;u.materials.has(C)||(z=n.makeMaterialParameters({color:[z.color[0],z.color[1],z.color[2]],opacity:z.color[3],alphaMode:z.alphaMode,alphaCutoff:z.alphaCutoff,doubleSided:z.doubleSided,colorMixMode:z.ESRI_externalColorMixMode,textureColor:z.colorTexture?
B(z.colorTexture):void 0,textureNormal:z.normalTexture?B(z.normalTexture):void 0,textureOcclusion:z.occlusionTexture?B(z.occlusionTexture):void 0,textureEmissive:z.emissiveTexture?B(z.emissiveTexture):void 0,textureMetallicRoughness:z.metallicRoughnessTexture?B(z.metallicRoughnessTexture):void 0,emissiveFactor:[z.emissiveFactor[0],z.emissiveFactor[1],z.emissiveFactor[2]],colorTextureTransform:z.colorTextureTransform,normalTextureTransform:z.normalTextureTransform,occlusionTextureTransform:z.occlusionTextureTransform,
emissiveTextureTransform:z.emissiveTextureTransform,metallicRoughnessTextureTransform:z.metallicRoughnessTextureTransform,metallicFactor:z.metallicFactor,roughnessFactor:z.roughnessFactor}),u.materials.set(C,z));return C}let A=0;const t=new m.DefaultErrorContext,w=[g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST];a.loadGLTF=function(u,z){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,b,c){let r=function(){function m(){}var n=m.prototype;n.error=function(p){throw new b("gltf-loader-error",p);};n.errorUnsupported=function(p){throw new b("gltf-loader-unsupported-feature",p);};n.errorUnsupportedIf=function(p,g){p&&this.errorUnsupported(g)};n.assert=function(p,g){p||this.error(g)};n.warn=function(p){c.getLogger("esri.views.3d.glTF").warn(p)};n.warnUnsupported=
function(p){this.warn("[Unsupported Feature] "+p)};n.warnUnsupportedIf=function(p,g){p&&this.warnUnsupported(g)};return m}();a.DefaultErrorContext=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,
textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,r={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...r.wrap},noUnpackFlip:!0,
mipmap:!1,...r}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(J){switch(J.componentType){case u.DataType.BYTE:return new f.BufferViewVec2i8(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case u.DataType.UNSIGNED_BYTE:return new f.BufferViewVec2u8(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case u.DataType.SHORT:return new f.BufferViewVec2i16(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case u.DataType.UNSIGNED_SHORT:return new f.BufferViewVec2u16(J.raw,
J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case u.DataType.UNSIGNED_INT:return new f.BufferViewVec2u32(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount);case u.DataType.FLOAT:return new f.BufferViewVec2f(J.raw,J.byteOffset,J.byteStride,J.byteOffset+J.byteStride*J.entryCount)}}function y(J){return B.apply(this,arguments)}function B(){B=b._asyncToGenerator(function*(J){return new Promise((L,K)=>{const O=new Blob([J]),P=new FileReader;P.onload=()=>{L(JSON.parse(P.result))};
P.onerror=N=>{K(N)};P.readAsText(O)})});return B.apply(this,arguments)}function C(J,L){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(J,L){return new Promise((K,O)=>{const P=new Blob([J],{type:L}),N=URL.createObjectURL(P),H=new Image,E=()=>{URL.revokeObjectURL(N);"decode"in H?H.decode().then(()=>K(H),()=>K(H)).then(M):(K(H),M())},I=Q=>{URL.revokeObjectURL(N);O(Q);M()},M=()=>{H.removeEventListener("load",E);H.removeEventListener("error",I)};H.addEventListener("load",E);
H.addEventListener("error",I);H.src=N})});return k.apply(this,arguments)}let q=function(){function J(K,O,P,N,H){this._context=K;this._errorContext=O;this.uri=P;this.json=N;this._glbBuffer=H;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._baseUri=w.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();O.errorUnsupportedIf(null==
N.scenes,"Scenes must be defined.");O.errorUnsupportedIf(null==N.meshes,"Meshes must be defined");O.errorUnsupportedIf(null==N.nodes,"Nodes must be defined.");this._computeNodeParents()}J.load=function(){var K=b._asyncToGenerator(function*(O,P,N,H){if(m.isDataProtocol(N)){var E=m.dataComponents(N);if(E&&"model/gltf-binary"!==E.mediaType)try{const I=JSON.parse(E.isBase64?atob(E.data):E.data);return new J(O,P,N,I)}catch{}E=m.dataToArrayBuffer(N);if(J._isGLBData(E))return this._fromGLBData(O,P,N,E)}if(N.endsWith(".gltf"))return H=
yield O.loadJSON(N,H),new J(O,P,N,H);E=yield O.loadBinary(N,H);if(J._isGLBData(E))return this._fromGLBData(O,P,N,E);H=yield O.loadJSON(N,H);return new J(O,P,N,H)});return function(O,P,N,H){return K.apply(this,arguments)}}();J._isGLBData=function(K){if(null==K)return!1;K=new l.BinaryStreamReader(K);return 4<=K.remainingBytes()&&1179937895===K.readUint32()};J._fromGLBData=function(){var K=b._asyncToGenerator(function*(O,P,N,H){H=yield J._parseGLBData(P,H);return new J(O,P,N,H.json,H.binaryData)});return function(O,
P,N,H){return K.apply(this,arguments)}}();J._parseGLBData=function(){var K=b._asyncToGenerator(function*(O,P){const N=new l.BinaryStreamReader(P);O.assert(12<=N.remainingBytes(),"GLB binary data is insufficiently large.");var H=N.readUint32(),E=N.readUint32();const I=N.readUint32();O.assert(1179937895===H,"Magic first 4 bytes do not fit to expected GLB value.");O.assert(P.byteLength>=I,"GLB binary data is smaller than header specifies.");O.errorUnsupportedIf(2!==E,"An unsupported GLB container version was detected. Only version 2 is supported.");
P=0;let M,Q;for(;8<=N.remainingBytes();)H=N.readUint32(),E=N.readUint32(),0===P?(O.assert(1313821514===E,"First GLB chunk must be JSON."),O.assert(0<=H,"No JSON data found."),M=yield y(N.readUint8Array(H))):1===P?(O.errorUnsupportedIf(5130562!==E,"Second GLB chunk expected to be BIN."),Q=N.readUint8Array(H)):O.warnUnsupported("More than 2 GLB chunks detected. Skipping."),P+=1;M||O.error("No GLB JSON chunk detected.");return{json:M,binaryData:Q}});return function(O,P){return K.apply(this,arguments)}}();
var L=J.prototype;L.getBuffer=function(){var K=b._asyncToGenerator(function*(O,P){const N=this.json.buffers[O],H=this._errorContext;if(null==N.uri)return H.assert(null!=this._glbBuffer,"GLB buffer not present"),this._glbBuffer;O=yield this._getBufferLoader(O,P);H.assert(O.byteLength===N.byteLength,"Buffer byte lengths should match.");return O});return function(O,P){return K.apply(this,arguments)}}();L._getBufferLoader=function(){var K=b._asyncToGenerator(function*(O,P){const N=this._bufferLoaders.get(O);
if(N)return N;P=this._context.loadBinary(this._resolveUri(this.json.buffers[O].uri),P).then(H=>new Uint8Array(H));this._bufferLoaders.set(O,P);return P});return function(O,P){return K.apply(this,arguments)}}();L.getAccessor=function(){var K=b._asyncToGenerator(function*(O,P){var N=this._errorContext;N.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");O=this.json.accessors[O];N.errorUnsupportedIf(null==O?.bufferView,"Some accessor does not specify a bufferView.");N.errorUnsupportedIf(O.type in
[A.AttributeType.MAT2,A.AttributeType.MAT3,A.AttributeType.MAT4],`AttributeType ${O.type} is not supported`);N=this.json.bufferViews[O.bufferView];P=yield this.getBuffer(N.buffer,P);const H=F[O.type],E=G[O.componentType],I=H*E,M=N.byteStride||I;return{raw:P.buffer,byteStride:M,byteOffset:P.byteOffset+(N.byteOffset||0)+(O.byteOffset||0),entryCount:O.count,isDenselyPacked:M===I,componentCount:H,componentByteSize:E,componentType:O.componentType,min:O.min,max:O.max,normalized:!!O.normalized}});return function(O,
P){return K.apply(this,arguments)}}();L.getIndexData=function(){var K=b._asyncToGenerator(function*(O,P){if(null!=O.indices)if(O=yield this.getAccessor(O.indices,P),O.isDenselyPacked)switch(O.componentType){case u.DataType.UNSIGNED_BYTE:return new Uint8Array(O.raw,O.byteOffset,O.entryCount);case u.DataType.UNSIGNED_SHORT:return new Uint16Array(O.raw,O.byteOffset,O.entryCount);case u.DataType.UNSIGNED_INT:return new Uint32Array(O.raw,O.byteOffset,O.entryCount)}else switch(O.componentType){case u.DataType.UNSIGNED_BYTE:return e.makeDense(this._wrapAccessor(f.BufferViewUint8,
O));case u.DataType.UNSIGNED_SHORT:return e.makeDense(this._wrapAccessor(f.BufferViewUint16,O));case u.DataType.UNSIGNED_INT:return e.makeDense(this._wrapAccessor(f.BufferViewUint32,O))}});return function(O,P){return K.apply(this,arguments)}}();L.getPositionData=function(){var K=b._asyncToGenerator(function*(O,P){const N=this._errorContext;N.errorUnsupportedIf(null==O.attributes.POSITION,"No POSITION vertex data found.");O=yield this.getAccessor(O.attributes.POSITION,P);N.errorUnsupportedIf(O.componentType!==
u.DataType.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+u.DataType[O.componentType]);N.errorUnsupportedIf(3!==O.componentCount,"POSITION vertex attribute must have 3 components, but found "+O.componentCount.toFixed());return this._wrapAccessor(f.BufferViewVec3f,O)});return function(O,P){return K.apply(this,arguments)}}();L.getNormalData=function(){var K=b._asyncToGenerator(function*(O,P){const N=this._errorContext;N.assert(null!=O.attributes.NORMAL,"No NORMAL vertex data found.");
O=yield this.getAccessor(O.attributes.NORMAL,P);N.errorUnsupportedIf(O.componentType!==u.DataType.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+u.DataType[O.componentType]);N.errorUnsupportedIf(3!==O.componentCount,"NORMAL vertex attribute must have 3 components, but found "+O.componentCount.toFixed());return this._wrapAccessor(f.BufferViewVec3f,O)});return function(O,P){return K.apply(this,arguments)}}();L.getTangentData=function(){var K=b._asyncToGenerator(function*(O,P){const N=
this._errorContext;N.assert(null!=O.attributes.TANGENT,"No TANGENT vertex data found.");O=yield this.getAccessor(O.attributes.TANGENT,P);N.errorUnsupportedIf(O.componentType!==u.DataType.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+u.DataType[O.componentType]);N.errorUnsupportedIf(4!==O.componentCount,"TANGENT vertex attribute must have 4 components, but found "+O.componentCount.toFixed());return new f.BufferViewVec4f(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*
O.entryCount)});return function(O,P){return K.apply(this,arguments)}}();L.getTextureCoordinates=function(){var K=b._asyncToGenerator(function*(O,P){const N=this._errorContext;N.assert(null!=O.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");O=yield this.getAccessor(O.attributes.TEXCOORD_0,P);N.errorUnsupportedIf(2!==O.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+O.componentCount.toFixed());if(O.componentType===u.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec2f,
O);N.errorUnsupportedIf(!O.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return z(O)});return function(O,P){return K.apply(this,arguments)}}();L.getVertexColors=function(){var K=b._asyncToGenerator(function*(O,P){const N=this._errorContext;N.assert(null!=O.attributes.COLOR_0,"No COLOR_0 vertex data found.");O=yield this.getAccessor(O.attributes.COLOR_0,P);N.errorUnsupportedIf(4!==O.componentCount&&3!==O.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+
O.componentCount.toFixed());if(4===O.componentCount){if(O.componentType===u.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec4f,O);if(O.componentType===u.DataType.UNSIGNED_BYTE)return this._wrapAccessor(f.BufferViewVec4u8,O);if(O.componentType===u.DataType.UNSIGNED_SHORT)return this._wrapAccessor(f.BufferViewVec4u16,O)}else if(3===O.componentCount){if(O.componentType===u.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec3f,O);if(O.componentType===u.DataType.UNSIGNED_BYTE)return this._wrapAccessor(f.BufferViewVec3u8,
O);if(O.componentType===u.DataType.UNSIGNED_SHORT)return this._wrapAccessor(f.BufferViewVec3u16,O)}N.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+u.DataType[O.componentType])});return function(O,P){return K.apply(this,arguments)}}();L.hasPositions=function(K){return void 0!==K.attributes.POSITION};L.hasNormals=function(K){return void 0!==K.attributes.NORMAL};L.hasVertexColors=function(K){return void 0!==K.attributes.COLOR_0};L.hasTextureCoordinates=function(K){return void 0!==
K.attributes.TEXCOORD_0};L.hasTangents=function(K){return void 0!==K.attributes.TANGENT};L.getMaterial=function(){var K=b._asyncToGenerator(function*(O,P,N){var H=O.material?this._materialCache.get(O.material):void 0;if(!H){H=null!=O.material?t.material(this.json.materials[O.material]):t.material();const E=H.pbrMetallicRoughness,I=this.hasVertexColors(O),M=this.getTexture(E.baseColorTexture,P),Q=this.getTexture(H.normalTexture,P),T=N?this.getTexture(H.occlusionTexture,P):void 0,S=N?this.getTexture(H.emissiveTexture,
P):void 0;P=N?this.getTexture(E.metallicRoughnessTexture,P):void 0;O=null!=O.material?O.material:-1;H={alphaMode:H.alphaMode,alphaCutoff:H.alphaCutoff,color:E.baseColorFactor,doubleSided:!!H.doubleSided,colorTexture:yield M,normalTexture:yield Q,name:H.name,id:O,occlusionTexture:yield T,emissiveTexture:yield S,emissiveFactor:H.emissiveFactor,metallicFactor:E.metallicFactor,roughnessFactor:E.roughnessFactor,metallicRoughnessTexture:yield P,hasVertexColors:I,ESRI_externalColorMixMode:H.extras.ESRI_externalColorMixMode,
colorTextureTransform:E?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:H.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:H.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:H.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:E?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return H});return function(O,P,N){return K.apply(this,arguments)}}();L.getTexture=function(){var K=
b._asyncToGenerator(function*(O,P){if(O){this._errorContext.errorUnsupportedIf(0!==(O.texCoord||0),"Only TEXCOORD with index 0 is supported.");var N=O.index,H=this._errorContext;O=this.json.textures[N];var E=t.textureSampler(null!=O.sampler?this.json.samplers[O.sampler]:{});H.errorUnsupportedIf(null==O.source,"Source is expected to be defined for a texture.");var I=this.json.images[O.source],M=yield this._loadTextureImageData(N,O,P);return c.getOrCreateMapValue(this._textureCache,N,()=>{const Q=S=>
33071===S||33648===S||10497===S,T=S=>{H.error(`Unexpected TextureSampler WrapMode: ${S}. Using default REPEAT(10497).`);return 10497};return{data:M,wrapS:Q(E.wrapS)?E.wrapS:T(E.wrapS),wrapT:Q(E.wrapT)?E.wrapT:T(E.wrapT),minFilter:E.minFilter,name:I.name,id:N}})}});return function(O,P){return K.apply(this,arguments)}}();L.getNodeTransform=function(K){if(void 0===K)return v;var O=this._nodeTransformCache.get(K);if(!O){O=this.getNodeTransform(this._getNodeParent(K));const P=this.json.nodes[K];if(P.matrix)O=
p.multiply(g.create(),O,P.matrix);else if(P.translation||P.rotation||P.scale)O=g.clone(O),P.translation&&p.translate(O,O,P.translation),P.rotation&&(D[3]=h.getAxisAngle(D,P.rotation),p.rotate(O,O,D[3],D)),P.scale&&p.scale(O,O,P.scale);this._nodeTransformCache.set(K,O)}return O};L._wrapAccessor=function(K,O){return new K(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*(O.entryCount-1)+O.componentByteSize*O.componentCount)};L._resolveUri=function(K){return m.makeAbsolute(K,this._baseUri)};
L._getNodeParent=function(K){return this._nodeParentMap.get(K)};L._checkVersionSupported=function(){const K=n.Version.parse(this.json.asset.version,"glTF");x.validate(K)};L._checkRequiredExtensionsSupported=function(){const K=this.json,O=this._errorContext;K.extensionsRequired&&0!==K.extensionsRequired.length&&O.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+K.extensionsRequired.join(", "))};L._computeNodeParents=function(){this.json.nodes.forEach((K,
O)=>{K.children&&K.children.forEach(P=>{this._nodeParentMap.set(P,O)})})};L._loadTextureImageData=function(){var K=b._asyncToGenerator(function*(O,P,N){const H=this._textureLoaders.get(O);if(H)return H;P=this._createTextureLoader(P,N);this._textureLoaders.set(O,P);return P});return function(O,P,N){return K.apply(this,arguments)}}();L._createTextureLoader=function(){var K=b._asyncToGenerator(function*(O,P){O=this.json.images[O.source];if(O.uri)return this._context.loadImage(this._resolveUri(O.uri),
P);const N=this._errorContext;N.errorUnsupportedIf(null==O.bufferView,"Image bufferView must be defined.");N.errorUnsupportedIf(null==O.mimeType,"Image mimeType must be defined.");const H=this.json.bufferViews[O.bufferView];P=yield this.getBuffer(H.buffer,P);N.errorUnsupportedIf(null!=H.byteStride,"byteStride not supported for image buffer");return C(new Uint8Array(P.buffer,P.byteOffset+(H.byteOffset||0),H.byteLength),O.mimeType)});return function(O,P){return K.apply(this,arguments)}}();L.getLoadedBuffersSize=
function(){var K=b._asyncToGenerator(function*(){if(this._glbBuffer)return this._glbBuffer.byteLength;const O=yield r.eachAlwaysValues(Array.from(this._bufferLoaders.values())),P=yield r.eachAlwaysValues(Array.from(this._textureLoaders.values()));return O.reduce((N,H)=>N+(H?.byteLength??0),0)+P.reduce((N,H)=>N+(H?H.width*H.height*4:0),0)});return function(){return K.apply(this,arguments)}}();return J}();const x=new n.Version(2,0,"glTF"),v=p.fromXRotation(g.create(),Math.PI/2),D=d.create(),F={SCALAR:1,
VEC2:2,VEC3:3,VEC4:4},G={[u.DataType.BYTE]:1,[u.DataType.UNSIGNED_BYTE]:1,[u.DataType.SHORT]:2,[u.DataType.UNSIGNED_SHORT]:2,[u.DataType.FLOAT]:4,[u.DataType.UNSIGNED_INT]:4};a.GLTFResource=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,b){let c=function(){function r(n,p,g=""){this.major=n;this.minor=p;this._context=g}var m=r.prototype;m.lessThan=function(n,p){return this.major<n||
n===this.major&&this.minor<p};m.since=function(n,p){return!this.lessThan(n,p)};m.validate=function(n){if(this.major!==n.major)throw new b((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:n});};m.clone=function(){return new r(this.major,this.minor,this._context)};r.parse=function(n,p=""){const [g,h]=n.split(".");var d=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(d))throw new b((p&&
p+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:n});if(!h||!h.match||!h.match(d))throw new b((p&&p+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:n});n=parseInt(g,10);d=parseInt(h,10);return new r(n,d,p)};return r}();a.Version=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){let b=
function(){function c(m){this._data=m;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}var r=c.prototype;r.readUint32=function(){const m=this._offset4;this._offset4+=1;return this._dataUint32[m]};r.readUint8Array=function(m){const n=4*this._offset4;this._offset4+=m/4;return new Uint8Array(this._data,n,m)};r.remainingBytes=function(){return this._data.byteLength-4*this._offset4};return c}();a.BinaryStreamReader=b;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const r={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},m={pbrMetallicRoughness:r,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},n={ESRI_externalColorMixMode:"tint"},p={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,
wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(g={})=>{const h={...r,...g.pbrMetallicRoughness};var d={...n,...g.extras};switch(d.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(d.ESRI_externalColorMixMode),d.ESRI_externalColorMixMode="tint"}return{...m,...g,pbrMetallicRoughness:h,extras:d}};a.textureSampler=g=>({...p,...g});Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let c,r;b.replace(/^(.*\/)?([^/]*)$/,(m,n,p)=>{c=n||"";r=p||"";return""});return{dirPart:c,filePart:r}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/Indices"],function(a,b,c){a.triangleFanToTriangles=function(r){var m="number"===
typeof r?r:r.length;if(3>m)return new Uint16Array(0);m-=2;const n=65536>=m?new Uint16Array(3*m):new Uint32Array(3*m);if("number"===typeof r){r=0;for(var p=0;p<m;++p)n[r++]=0,n[r++]=p+1,n[r++]=p+2;return n}p=r[0];let g=r[1],h=0;for(let d=0;d<m;++d){const f=r[d+2];n[h++]=p;n[h++]=g;g=n[h++]=f}return n};a.triangleStripToTriangles=function(r){var m="number"===typeof r?r:r.length;if(3>m)return[];m-=2;const n=c.newIndexArray(m);if("number"===typeof r){r=0;for(var p=0;p<m;p+=1)0===p%2?(n[r++]=p,n[r++]=p+
1):(n[r++]=p+1,n[r++]=p),n[r++]=p+2}else{p=0;for(let f=0;f<m;f+=1)if(0===f%2){var g=r[f],h=r[f+1],d=r[f+2];n[p++]=g;n[p++]=h;n[p++]=d}else g=r[f+1],h=r[f],d=r[f+2],n[p++]=g,n[p++]=h,n[p++]=d}return n};a.trianglesToTriangles=function(r,m=c.generateDefaultIndexArray){return"number"===typeof r?m(r):b.isUint16Array(r)||b.isUint8Array(r)?new Uint32Array(r):r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],
function(a){a.ProcessedObjectResource=function(b,c,r,m,n){this.name=b;this.stageResources=c;this.lodThreshold=r;this.pivotOffset=m;this.numberOfVertices=n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){function y(){y=b._asyncToGenerator(function*(K,O){K=yield B(K,O);O=yield D(K.textureDefinitions,O);let P=0;for(const N in O)if(O.hasOwnProperty(N)){const H=O[N];P+=H?.image?H.image.width*H.image.height*4:0}return{resource:K,textures:O,size:P+m.estimateNestedObjectSize(K)}});return y.apply(this,arguments)}function B(K,O){return C.apply(this,arguments)}function C(){C=b._asyncToGenerator(function*(K,O){const P=g.isSome(O)&&O.streamDataRequester;if(P)return k(K,
P,O);K=yield r.result(c(K,g.unwrap(O)));if(!0===K.ok)return K.value.data;h.throwIfAbortError(K.error);x(K.error)});return C.apply(this,arguments)}function k(K,O,P){return q.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(K,O,P){K=yield r.result(O.request(K,"json",P));if(!0===K.ok)return K.value;h.throwIfAbortError(K.error);x(K.error.details.url)});return q.apply(this,arguments)}function x(K){throw new n("",`Request for object resource failed: ${K}`);}function v(K){const O=e.empty();
K.forEach(P=>{P=P.boundingInfo;g.isSome(P)&&(e.expandWithVec3(O,P.getBBMin()),e.expandWithVec3(O,P.getBBMax()))});return O}function D(K,O){return F.apply(this,arguments)}function F(){F=b._asyncToGenerator(function*(K,O){const P=[];for(const E in K){var N=K[E],H=N.images[0].data;if(!H){J.warn("Externally referenced texture data is not yet supported");continue}H=N.encoding+";base64,"+H;const I="/textureDefinitions/"+E,M="rgba"===N.channels?N.alphaChannelUsage||"transparency":"none",Q={noUnpackFlip:!0,
wrap:{s:z.TextureWrapMode.REPEAT,t:z.TextureWrapMode.REPEAT},preMultiplyAlpha:G(M)!==A.AlphaDiscardMode.Opaque};N=g.isSome(O)&&O.disableTextures?Promise.resolve(null):l.requestImage(H,O);P.push(N.then(T=>({refId:I,image:T,params:Q,alphaChannelUsage:M})))}K=yield Promise.all(P);O={};for(const E of K)O[E.refId]=E;return O});return F.apply(this,arguments)}function G(K){switch(K){case "mask":return A.AlphaDiscardMode.Mask;case "maskAndTransparency":return A.AlphaDiscardMode.MaskBlend;case "none":return A.AlphaDiscardMode.Opaque;
case "transparency":return A.AlphaDiscardMode.Blend;default:return A.AlphaDiscardMode.Blend}}const J=p.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),L=new d.Version(1,2,"wosr");a.createTextureResources=D;a.load=function(K,O){return y.apply(this,arguments)};a.processLoadResult=function(K,O){const P=[],N=[],H=[],E=[],I=K.resource;var M=d.Version.parse(I.version||"1.0","wosr");L.validate(M);M=I.model.name;const Q=I.model.geometries,T=I.materialDefinitions;K=K.textures;let S=0;const U=
new Map;for(let ma=0;ma<Q.length;ma++){var Y=Q[ma],V=Y,R=V.params,X=R.topology,W=!0;R.vertexAttributes||(J.warn("Geometry must specify vertex attributes"),W=!1);switch(R.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:X=R.faces;if(!X)J.warn("Indexed geometries must specify faces"),W=!1;else if(R.vertexAttributes)for(const ha in R.vertexAttributes)(R=X[ha])&&R.values?(null!=R.valueType&&"UInt32"!==R.valueType&&(J.warn(`Unsupported indexed geometry indices type '${R.valueType}', only UInt32 is currently supported`),
W=!1),null!=R.valuesPerElement&&1!==R.valuesPerElement&&(J.warn(`Unsupported indexed geometry values per element '${R.valuesPerElement}', only 1 is currently supported`),W=!1)):(J.warn(`Indexed geometry does not specify face indices for '${ha}' attribute`),W=!1);break;default:J.warn(`Unsupported topology '${X}'`),W=!1}V.params.material||(J.warn("Geometry requires material"),W=!1);V=V.params.vertexAttributes;for(const ha in V)V[ha].values||(J.warn("Geometries with externally defined attributes are not yet supported"),
W=!1);if(W){V=Y.params;W=V.material;V=V.texture;X=Y.params.vertexAttributes;R=[];for(const ha in X){var aa=X[ha];R.push([ha,{data:aa.values,size:aa.valuesPerElement,exclusive:!0}])}X=[];if("PerAttributeArray"!==Y.params.topology){Y=Y.params.faces;for(const ha in Y)X.push([ha,Y[ha].values])}if((Y=K&&K[V])&&!U.has(V)){const {image:ha,params:ka}=Y;aa=new w.Texture(ha,ka);E.push(aa);U.set(V,aa)}aa=(aa=U.get(V))?aa.id:void 0;var ba=H[W]?H[W][V]:null;if(!ba){ba=W.substring(W.lastIndexOf("/")+1);ba=T[ba].params;
1===ba.transparency&&(ba.transparency=0);var ia=Y&&Y.alphaChannelUsage;ia=0<ba.transparency||"transparency"===ia||"maskAndTransparency"===ia;const ha=Y?G(Y.alphaChannelUsage):void 0;Y={ambient:f.fromArray(ba.diffuse),diffuse:f.fromArray(ba.diffuse),opacity:1-(ba.transparency||0),transparent:ia,textureAlphaMode:ha,textureAlphaCutoff:.33,textureId:aa,initTextureTransparent:!0,doubleSided:!0,cullFace:A.CullFaceOptions.None,colorMixMode:ba.externalColorMixMode||"tint",textureAlphaPremultiplied:Y?!!Y.params.preMultiplyAlpha:
!1};g.isSome(O)&&O.materialParamsMixin&&Object.assign(Y,O.materialParamsMixin);ba=new u.DefaultMaterial(Y);H[W]||(H[W]={});H[W][V]=ba}N.push(ba);W=new t.Geometry(R,X);S+=X.position?X.position.length:0;P.push(W)}}return{engineResources:[{name:M,stageResources:{textures:E,materials:N,geometries:P},pivotOffset:I.model.pivotOffset,numberOfVertices:S,lodThreshold:null}],referenceBoundingBox:v(P)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F){function G(M,Q,T){const S=M.allocateHead();M=M.view;v.encodeDoubleVec3(Q.modelOrigin,T,M.modelOriginHi,M.modelOriginLo,S);M.model.copyFrom(S,Q.model,T);M.modelNormal.copyFrom(S,Q.modelNormal,T);Q.color&&M.color&&M.color.copyFrom(S,Q.color,T);Q.objectAndLayerIdColor&&M.objectAndLayerIdColor&&M.objectAndLayerIdColor.copyFrom(S,Q.objectAndLayerIdColor,T);Q.featureAttribute&&M.featureAttribute&&M.featureAttribute.copyFrom(S,Q.featureAttribute,
T)}const J=M=>{const Q=M.baseBoundingSphere.radius;M=M.levels.map(T=>T.minScreenSpaceRadius);return new B.LevelSelector(Q,M)};let L=function(){function M(T,S,U,Y){this.type=A.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._lastCamera=new e.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.slots=[w.RenderSlot.OPAQUE_MATERIAL,w.RenderSlot.TRANSPARENT_MATERIAL];
this.canRender=!0;this._symbol=T;this._optionalFields=S;this._metadata=U;this._instanceBufferLayout=q.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:S});this._glInstanceBufferLayout=d.glLayout(this._instanceBufferLayout,1);this._instanceData=new z.InstanceData(this._optionalFields,Y);this._instanceData.on("instance-added",()=>this._requestUpdateCycle());this._instanceData.on("instance-removed",()=>this._requestUpdateCycle());this._instanceData.on("instance-transform-changed",V=>{this._requestUpdateCycle();
this._metadata.notifyGraphicGeometryChanged(V.index)});this._instanceData.on("instance-visibility-changed",V=>{this._requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(V.index)});this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0));this._enableLevelSelection=1<this._symbol.levels.length}var Q=M.prototype;Q.initializeRenderContext=function(){var T=b._asyncToGenerator(function*(S,U){this._context=S;const Y=S.renderContext.rctx,V=yield Promise.allSettled(this._symbol.levels.map(X=>
{this._defaultRenderInstanceData.push(new k.RenderInstanceData(Y,this._instanceBufferLayout));this._highlightRenderInstanceData.push(new k.RenderInstanceData(Y,this._instanceBufferLayout));return C.LodLevel.create(S,X,U)})),R=V.map(X=>"fulfilled"===X.status?X.value:null).filter(X=>X);if(r.isAborted(U)||R.length!==V.length){R.forEach(X=>X.destroy());r.throwIfAborted(U);for(const X of V)if("rejected"===X.status)throw X.reason;}this._levels=R;this._levelSelector=J(this)});return function(S,U){return T.apply(this,
arguments)}}();Q.uninitializeRenderContext=function(){this._invalidateOctree();this._levels.forEach(T=>T.destroy());this._defaultRenderInstanceData.forEach(T=>T.destroy());this._highlightRenderInstanceData.forEach(T=>T.destroy())};Q.prepareRender=function(T){if(!h.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var S=T.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(T.bindParameters.contentCamera);S||this._requestUpdateCycle()}S=this._needFullCycle?
this._instanceData.size:2E3;this._needFullCycle=!1;this._updateInstances(T.bindParameters.contentCamera,S);this._needsUpdates&&this._context.requestRender()}};Q.render=function(T){this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleForOutput(T.output)&&(T.rctx.bindVAO(),T.output!==f.ShaderOutput.Highlight&&T.output!==f.ShaderOutput.ShadowHighlight&&this._renderComponents(T,this._defaultRenderInstanceData),T.output!==f.ShaderOutput.ShadowExludeHighlight&&this._renderComponents(T,this._highlightRenderInstanceData))};
Q.intersect=function(T,S,U,Y){if(this.baseMaterial.isVisible()){var V=p.create();n.subtract(V,Y,U);var R=X=>{this._instanceData.getCombinedModelTransform(X,P);T.transform.set(P);n.transformMat4(N,U,T.transform.inverse);n.transformMat4(H,Y,T.transform.inverse);const W=this._instanceData.getState(X),aa=this._instanceData.getLodLevel(X),ba=this._levels.length;u.assert(W&z.StateFlags.ACTIVE,"invalid instance state");u.assert(0<=aa&&aa<ba,"invaid lod level");this._levels[aa].intersect(T,S,N,H,X,this._metadata,
ba)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(R):this._octree.forEachAlongRay(U,V,R)}};Q.queryDepthRange=function(T){return this._queryDepthRangeOctree(T)};Q.notifyShaderTransformationChanged=function(){this._invalidateOctree()};Q._requestUpdateCycle=function(T=!1){this._updateCyclesWithStaticCamera=-1;T&&(this._needFullCycle=!0);this._needsUpdates&&this._context.requestRender()};Q._invalidateOctree=function(){this._octreeCached=c.destroyMaybe(this._octreeCached)};Q._buildOctree=
function(){const T=new y.InstanceOctree(this._instanceData,this.baseBoundingSphere);var S=this._instanceData;S=S.view?S.view.state:null;for(let U=0;U<this._instanceData.capacity;++U)S.get(U)&z.StateFlags.ACTIVE&&T.addInstance(U);return T};Q._queryDepthRangeOctree=function(T){var S=T.eye;const U=T.viewForward;var Y=this._octree.findClosest(U,t.DepthOrder.FRONT_TO_BACK,T.frustum);const V=this._octree.findClosest(U,t.DepthOrder.BACK_TO_FRONT,T.frustum);return null!=Y&&null!=V?(this._instanceData.view.boundingSphere.getVec(Y,
O),n.subtract(O,O,S),Y=n.dot(O,U)-O[3],this._instanceData.view.boundingSphere.getVec(V,O),n.subtract(O,O,S),S=n.dot(O,U)+O[3],{near:Math.max(T.near,Y),far:Math.min(T.far,S)}):{near:Infinity,far:-Infinity}};Q._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(T=>{T.startUpdateCylce()});this._highlightRenderInstanceData.forEach(T=>{T.startUpdateCylce()});this._needsUpdates&&this._context.requestRender()};Q._updateInstances=function(T,S){const U=
this._enableLevelSelection,Y=this._levelSelector;Y.updateCamera(T);this._defaultRenderInstanceData.forEach(ba=>ba.beginUpdate());this._highlightRenderInstanceData.forEach(ba=>ba.beginUpdate());T=this._instanceData;const V=this._instanceData.view,R=T.capacity;let X=this._instanceIndex;S=Math.min(T.size,S);for(let ba=0;ba<S;++ba){0===X&&this._startUpdateCycle();const ia=V.state.get(X);var W=0;if(ia&z.StateFlags.ALLOCATED){var aa=V.lodLevel.get(X);ia&z.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[aa].freeTail();
ia&z.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[aa].freeTail();ia&z.StateFlags.REMOVE?T.freeInstance(X):ia&z.StateFlags.VISIBLE?(aa=0,U&&(V.modelOrigin.getVec(X,K),aa=Y.selectLevel(K,T.getCombinedMedianScaleFactor(X))),W=ia&~(z.StateFlags.ACTIVE|z.StateFlags.TRANSFORM_CHANGED),0<=aa&&(ia&z.StateFlags.HIGHLIGHT?(G(this._highlightRenderInstanceData[aa],V,X),W|=z.StateFlags.HIGHLIGHT_ACTIVE):(G(this._defaultRenderInstanceData[aa],V,X),W|=z.StateFlags.DEFAULT_ACTIVE)),V.state.set(X,
W),V.lodLevel.set(X,aa)):(W=ia&~(z.StateFlags.ACTIVE|z.StateFlags.TRANSFORM_CHANGED),V.state.set(X,W));c.isSome(this._octreeCached)&&(aa=!!(ia&z.StateFlags.ACTIVE),W=!!(W&z.StateFlags.ACTIVE),!aa&&W?this._octreeCached.addInstance(X):aa&&!W?this._octreeCached.removeInstance(X):aa&&W&&ia&z.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(X),this._octreeCached.addInstance(X)));X=X+1===R?0:X+1}else X=X+1===R?0:X+1,S++}this._instanceIndex=X;this._defaultRenderInstanceData.forEach(ba=>ba.endUpdate());
this._highlightRenderInstanceData.forEach(ba=>ba.endUpdate())};Q._renderComponents=function(T,S){this.levels.forEach((U,Y)=>{U.components.forEach(V=>{this._renderComponent(T,S[Y],V,Y)})})};Q._renderComponent=function(T,S,U,Y){const {bindParameters:V,rctx:R,output:X}=T;if(0!==S.size&&U.material.requiresSlot(V.slot,T.output)){var W=U.glMaterials.load(R,V.slot,X);if(!c.isNone(W)){var aa=W.beginSlot(V);W=R.bindTechnique(aa,U.material.parameters,V);R.bindVAO(U.vao);aa.ensureAttributeLocations(U.vao);W.bindDraw(I,
V,U.material.parameters);h.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&T.output===f.ShaderOutput.Color&&(W.setUniform4fv("externalColor",E[Math.min(Y,E.length-1)]),W.setUniform1i("colorMixMode",x.colorMixModes.replace));var ba=R.capabilities.instancing;T=S.capacity;Y=S.headIndex;W=S.tailIndex;var ia=S.firstIndex,ma=this._glInstanceBufferLayout,ha=(ka,Z)=>{F.bindVertexBufferLayout(R,l.Default3D,S.buffer,ma,ka);ba.drawArraysInstanced(aa.primitiveType,0,U.vertexCount,Z-ka);F.unbindVertexBufferLayout(R,
l.Default3D,S.buffer,ma)};U.material.parameters.transparent&&null!=ia?Y>W?(u.assert(ia>=W&&ia<=Y,"invalid firstIndex"),ha(ia,Y),ha(W,ia)):Y<W&&(ia<=Y?(u.assert(0<=ia&&ia<=Y,"invalid firstIndex"),ha(ia,Y),ha(W,T),ha(0,ia)):(u.assert(ia>=W&&ia<=T,"invalid firstIndex"),ha(ia,T),ha(0,Y),ha(W,ia))):Y>W?ha(W,Y):Y<W&&(ha(0,Y),ha(W,T));R.bindVAO(null)}}};b._createClass(M,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},
{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(T){this._slicePlane=T}},{key:"layerUid",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const T={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(S=>
{S=S.memoryUsage;T.cpu+=S.cpu;T.gpu+=S.gpu});this._highlightRenderInstanceData.forEach(S=>{S=S.memoryUsage;T.cpu+=S.cpu;T.gpu+=S.gpu});return T}},{key:"renderStats",get:function(){const T=this._instanceData.size,S=[];this._levels.forEach((U,Y)=>{Y=this._defaultRenderInstanceData[Y].size+this._highlightRenderInstanceData[Y].size;U=U.triangleCount;S.push({renderedInstances:Y,renderedTriangles:Y*U,trianglesPerInstance:U})});return{totalInstances:T,renderedInstances:S.reduce((U,Y)=>U+Y.renderedInstances,
0),renderedTriangles:S.reduce((U,Y)=>U+Y.renderedTriangles,0),levels:S}}},{key:"needsTransparentPass",get:function(){return this._levels.some(T=>T.components.some(S=>S.material.requiresSlot(w.RenderSlot.TRANSPARENT_MATERIAL,f.ShaderOutput.Color)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(T=>0<T.size)}},{key:"_needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"_octree",get:function(){c.isNone(this._octreeCached)&&
(this._octreeCached=this._buildOctree());return this._octreeCached}}]);return M}();const K=p.create(),O=g.create(),P=m.create(),N=p.create(),H=p.create(),E=[g.fromValues(1,0,1,1),g.fromValues(0,0,1,1),g.fromValues(0,1,0,1),g.fromValues(1,1,0,1),g.fromValues(1,0,0,1)],I=new D.DefaultMaterialDrawParameters;a.LodRenderer=L;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){a.StateFlags=void 0;(function(B){B[B.ALLOCATED=1]="ALLOCATED";B[B.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";B[B.VISIBLE=4]="VISIBLE";B[B.HIGHLIGHT=8]="HIGHLIGHT";B[B.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";B[B.REMOVE=32]="REMOVE";B[B.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";B[B.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let t=function(B){this.localTransform=B.getField(A.VertexAttribute.LOCALTRANSFORM,d.BufferViewMat4f64);this.globalTransform=B.getField(A.VertexAttribute.GLOBALTRANSFORM,
d.BufferViewMat4f64);this.modelOrigin=B.getField(A.VertexAttribute.MODELORIGIN,d.BufferViewVec3f64);this.model=B.getField(A.VertexAttribute.MODEL,d.BufferViewMat3f);this.modelNormal=B.getField(A.VertexAttribute.MODELNORMAL,d.BufferViewMat3f);this.modelScaleFactors=B.getField(A.VertexAttribute.MODELSCALEFACTORS,d.BufferViewVec2f);this.boundingSphere=B.getField(A.VertexAttribute.BOUNDINGSPHERE,d.BufferViewVec4f64);this.color=B.getField(A.VertexAttribute.COLOR,d.BufferViewVec4f);this.featureAttribute=
B.getField(A.VertexAttribute.FEATUREATTRIBUTE,d.BufferViewVec4f);this.state=B.getField(A.VertexAttribute.STATE,d.BufferViewUint8);this.lodLevel=B.getField(A.VertexAttribute.LODLEVEL,d.BufferViewUint8);this.objectAndLayerIdColor=B.getField(A.VertexAttribute.OBJECTANDLAYERIDCOLOR,d.BufferViewVec4u8)};c=function(B){function C(q,x){var v=B.call(this)||this;v._capacity=0;v._size=0;v._next=0;v._buffer=null;v._view=null;let D=e.newLayout().mat4f64(A.VertexAttribute.LOCALTRANSFORM).mat4f64(A.VertexAttribute.GLOBALTRANSFORM).vec4f64(A.VertexAttribute.BOUNDINGSPHERE).vec3f64(A.VertexAttribute.MODELORIGIN).mat3f(A.VertexAttribute.MODEL).mat3f(A.VertexAttribute.MODELNORMAL).vec2f(A.VertexAttribute.MODELSCALEFACTORS);
q.includes("color")&&(D=D.vec4f(A.VertexAttribute.COLOR));q.includes("featureAttribute")&&(D=D.vec4f(A.VertexAttribute.FEATUREATTRIBUTE));D=D.u8(A.VertexAttribute.STATE).u8(A.VertexAttribute.LODLEVEL);q.includes(A.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(D=D.vec4u8(A.VertexAttribute.OBJECTANDLAYERIDCOLOR));D.alignTo(8);v._layout=D;v._shaderTransformation=x;return v}b._inheritsLoose(C,B);var k=C.prototype;k.addInstance=function(){this._size+1>this._capacity&&this._grow();const q=this._findSlot();this._view.state.set(q,
a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:q});return q};k.removeInstance=function(q){const x=this._view.state;l.assert(0<=q&&q<this._capacity&&x.get(q)&a.StateFlags.ALLOCATED,"invalid instance handle");this._getStateFlag(q,a.StateFlags.ACTIVE)?this._setStateFlags(q,a.StateFlags.REMOVE):this.freeInstance(q);this.emit("instance-removed",{index:q})};k.freeInstance=function(q){const x=this._view.state;l.assert(0<=q&&q<this._capacity&&x.get(q)&a.StateFlags.ALLOCATED,"invalid instance handle");
x.set(q,0);this._size--};k.setLocalTransform=function(q,x,v=!0){this._view.localTransform.setMat(q,x);v&&this.updateModelTransform(q)};k.getLocalTransform=function(q,x){this._view.localTransform.getMat(q,x)};k.setGlobalTransform=function(q,x,v=!0){this._view.globalTransform.setMat(q,x);v&&this.updateModelTransform(q)};k.getGlobalTransform=function(q,x){this._view.globalTransform.getMat(q,x)};k.updateModelTransform=function(q){const x=this._view;var v=w;const D=u;x.localTransform.getMat(q,z);x.globalTransform.getMat(q,
y);const F=n.multiply(y,y,z);g.set(v,F[12],F[13],F[14]);x.modelOrigin.setVec(q,v);r.fromMat4(D,F);x.model.setMat(q,D);v=f.scaleFromMatrix(w,F);v.sort();x.modelScaleFactors.set(q,0,v[1]);x.modelScaleFactors.set(q,1,v[2]);r.invert(D,D);r.transpose(D,D);x.modelNormal.setMat(q,D);this._setStateFlags(q,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:q})};k.getModelTransform=function(q,x){const v=this._view;v.model.getMat(q,u);v.modelOrigin.getVec(q,w);x[0]=u[0];x[1]=u[1];
x[2]=u[2];x[3]=0;x[4]=u[3];x[5]=u[4];x[6]=u[5];x[7]=0;x[8]=u[6];x[9]=u[7];x[10]=u[8];x[11]=0;x[12]=w[0];x[13]=w[1];x[14]=w[2];x[15]=1};k.applyShaderTransformation=function(q,x){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,q,x)};k.getCombinedModelTransform=function(q,x){this.getModelTransform(q,x);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,q,x);return x};k.getCombinedLocalTransform=function(q,x){this._view.localTransform.getMat(q,x);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,q,x);return x};k.getCombinedMaxScaleFactor=function(q){let x=this._view.modelScaleFactors.get(q,1);this._shaderTransformation&&(q=this._shaderTransformation.scaleFactor(w,this,q),x*=Math.max(q[0],q[1],q[2]));return x};k.getCombinedMedianScaleFactor=function(q){let x=this._view.modelScaleFactors.get(q,0);if(this._shaderTransformation){const D=this._shaderTransformation.scaleFactor(w,this,q);q=D[0];var v=D[1];x*=Math.max(Math.min(q,v),Math.min(Math.max(q,
v),D[2]))}return x};k.getModel=function(q,x){this._view.model.getMat(q,x)};k.setFeatureAttribute=function(q,x){this._view.featureAttribute.setVec(q,x)};k.getFeatureAttribute=function(q,x){this._view.featureAttribute.getVec(q,x)};k.setColor=function(q,x){this._view.color.setVec(q,x)};k.setObjectAndLayerIdColor=function(q,x){this._view.objectAndLayerIdColor.setVec(q,x)};k.getColor=function(q,x){this._view.color.getVec(q,x)};k.setVisible=function(q,x){x!==this.getVisible(q)&&(this._setStateFlag(q,a.StateFlags.VISIBLE,
x),this.emit("instance-visibility-changed",{index:q}))};k.getVisible=function(q){return this._getStateFlag(q,a.StateFlags.VISIBLE)};k.setHighlight=function(q,x){x!==this.getHighlight(q)&&(this._setStateFlag(q,a.StateFlags.HIGHLIGHT,x),this.emit("instance-highlight-changed",{index:q}))};k.getHighlight=function(q){return this._getStateFlag(q,a.StateFlags.HIGHLIGHT)};k.getState=function(q){return this._view.state.get(q)};k.getLodLevel=function(q){return this._view.lodLevel.get(q)};k.countFlags=function(q){let x=
0;for(let v=0;v<this._capacity;++v)this.getState(v)&q&&++x;return x};k._setStateFlags=function(q,x){const v=this._view.state;x|=v.get(q);v.set(q,x)};k._clearStateFlags=function(q,x){const v=this._view.state;x=v.get(q)&~x;v.set(q,x)};k._setStateFlag=function(q,x,v){v?this._setStateFlags(q,x):this._clearStateFlags(q,x)};k._getStateFlag=function(q,x){return!!(this._view.state.get(q)&x)};k._grow=function(){const q=Math.max(1024,Math.floor(2*this._capacity)),x=this._layout.createBuffer(q);if(this._buffer){const v=
new Uint8Array(this._buffer.buffer);(new Uint8Array(x.buffer)).set(v)}this._capacity=q;this._buffer=x;this._view=new t(this._buffer)};k._findSlot=function(){const q=this._view.state;let x=this._next;for(;q.get(x)&a.StateFlags.ALLOCATED;)x=x+1===this._capacity?0:x+1;this._next=x+1===this._capacity?0:x+1;return x};b._createClass(C,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",
get:function(){return this._view}}]);return C}(c);const w=h.create(),u=m.create(),z=p.create(),y=p.create();a.InstanceData=c;a.InstanceDataView=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),
function(a,b,c,r,m,n,p){p=function(g){function h(f,e){var l=g.call(this,A=>m.wrap(l._instanceData.view.boundingSphere.getVec(A,l._tmpSphere)),{maximumDepth:25})||this;l._tmpSphere=m.create();l._tmpMat4=c.create();l._instanceData=f;l._boundingSphere=e;return l}b._inheritsLoose(h,g);var d=h.prototype;d.addInstance=function(f){const e=this._instanceData.view.boundingSphere,l=this._instanceData.getCombinedModelTransform(f,this._tmpMat4);r.transformMat4(this._tmpSphere,this._boundingSphere.center,l);this._tmpSphere[3]=
this._boundingSphere.radius*n.maxScale(l);e.setVec(f,this._tmpSphere);this.add([f])};d.removeInstance=function(f){this.remove([f])};return h}(p);a.InstanceOctree=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,b){let c=function(){function r(n,p){this.thresholdScale=1;this._camera=new b.Camera;this._worldSpaceRadius=n;this._thresholds=p.map(g=>
g)}var m=r.prototype;m.updateCamera=function(n){this._camera.copyFrom(n)};m.selectLevel=function(n,p){n=this._camera.computeScreenPixelSizeAt(n);p=this._worldSpaceRadius*p/n;n=this._thresholds;let g=-1;for(let h=0;h<n.length;++h)p>=n[h]*this.thresholdScale&&(g=h);return g};return r}();a.LevelSelector=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,c,r,m,n,p){let g=function(){function h(f,e){this.minScreenSpaceRadius=f;this.components=e}h.create=function(){var f=b._asyncToGenerator(function*(e,l,A){const t=yield Promise.allSettled(l.components.map(u=>e.schedule(()=>new p.LodComponentData(e,u),A))),w=t.map(u=>"fulfilled"===u.status?u.value:null).filter(u=>u);if(r.isAborted(A)||w.length!==t.length){w.forEach(u=>u.destroy());r.throwIfAborted(A);for(const u of t)if("rejected"===u.status)throw u.reason;}return new h(l.minScreenSpaceRadius,
w)});return function(e,l,A){return f.apply(this,arguments)}}();var d=h.prototype;d.destroy=function(){this.components.forEach(f=>f.destroy())};d.intersect=function(f,e,l,A,t,w,u){this.components.forEach(z=>z.intersect(f,e,l,A,t,w,this.boundingSphere,u))};b._createClass(h,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const f=n.empty();this.components.forEach(e=>{c.isSome(e.boundingInfo)&&(n.expandWithVec3(f,e.boundingInfo.bbMin),n.expandWithVec3(f,e.boundingInfo.bbMax))});this._boundingBox=
f}return this._boundingBox}},{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const f=this.boundingBox,e=m.create();n.center(f,e);this._boundingSphere={center:e,radius:.5*n.diameter(f)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((f,e)=>f+e.triangleCount,0)}}]);return h}();a.LodLevel=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(){function e(A,t){const w=A.renderContext.rctx,{geometry:u,material:z}=t;this._materialRepository=A.materialRep;z.setParameters({instancedDoublePrecision:!0});A=z.createBufferWriter();t=A.vertexBufferLayout;const y=A.elementCount(u),B=A.allocate(y);A.write(null,null,u,B,0);this.geometry=u;this.material=z;this.glMaterials=new m.GLMaterials(z,this._materialRepository);this.vertexBufferLayout=t;this.vbo=h.BufferObject.createVertex(w,d.Usage.STATIC_DRAW,B.buffer);
this.vao=new g.VertexArrayObject(w,r.Default3D,{geometry:c.glLayout(t)},{geometry:this.vbo});this.vertexCount=y}var l=e.prototype;l.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};l.intersect=function(A,t,w,u,z,y,B,C){const k=this.geometry.id;this.material.intersect(this.geometry,null,A.transform.transform,A,w,u,(q,x,v,D,F)=>{0<=q&&(null==t||t(A.rayBegin,A.rayEnd,q))&&(v={layerUid:y.layerUid,graphicUid:y.graphicUid(z),geometryId:k,triangleNr:v,baseBoundingSphere:B,
numLodLevels:C},(null==A.results.min.drapedLayerOrder||F>=A.results.min.drapedLayerOrder)&&(null==A.results.min.dist||q<A.results.min.dist)&&A.results.min.set(p.IntersectorType.LOD,v,q,x,A.transform.transform,F),A.options.store!==p.StoreResults.MIN&&(null==A.results.max.drapedLayerOrder||F>=A.results.max.drapedLayerOrder)&&(null==A.results.max.dist||q>A.results.max.dist)&&A.results.max.set(p.IntersectorType.LOD,v,q,x,A.transform.transform,F),A.options.store===p.StoreResults.ALL&&(D=n.newIntersectorResult(A.results.min.ray),
D.set(p.IntersectorType.LOD,v,q,x,A.transform.transform,F),A.results.all.push(D)))})};b._createClass(e,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return e}();a.LodComponentData=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,r,m,n){let p=function(h){this.modelOriginHi=h.getField(m.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=h.getField(m.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=h.getField(m.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=h.getField(m.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=h.getField(m.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=h.getField(m.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f);
this.objectAndLayerIdColor=h.getField(m.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,c.BufferViewVec4u8)},g=function(){function h(f,e){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=f;this._instanceBufferLayout=e;this._elementSize=e.stride;this._capacity=1}var d=h.prototype;d.destroy=function(){this._buffer&&this._buffer.destroy()};d.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=
null};d.startUpdateCylce=function(){this._captureFirstIndex=!0};d.beginUpdate=function(){r.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};d.endUpdate=function(){r.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};d.allocateHead=function(){r.assert(this._updating,"not updating");this.isFull&&
this._grow();const f=this.headIndex;this._captureFirstIndex&&(this._firstIndex=f,this._captureFirstIndex=!1);this._incrementHead();r.assert(this._headIndex!==this._tailIndex,"invalid pointers");return f};d.freeTail=function(){r.assert(this._updating,"not updating");r.assert(0<this.size,"invalid size");const f=this._tailIndex===this._firstIndex;this._incrementTail();f&&(this._firstIndex=this._tailIndex)};d._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};d._shrink=function(){this._resize(Math.max(1024,
Math.floor(.5*this._capacity)))};d._resize=function(f){r.assert(this._updating,"not updating");if(f!==this._capacity){var e=new n(this._rctx,this._elementSize,f);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const l=this.size,A=this._compactInstances(e);r.assert(A===l,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=A;this._prevHeadIndex=0}this._resized=!0;this._capacity=f;this._buffer=e;this._view=
new p(this._instanceBufferLayout.createView(this._buffer.array))}};d._compactInstances=function(f){const e=this._headIndex,l=this._tailIndex;return l<e?(this._buffer.copyRange(l,e,f),e-l):l>e?(this._buffer.copyRange(l,this._capacity,f),0<e&&this._buffer.copyRange(0,e,f,this._capacity-l),e+(this._capacity-l)):0};d._incrementHead=function(f=1){this._headIndex=(this._headIndex+f)%this._capacity};d._incrementTail=function(f=1){this._tailIndex=(this._tailIndex+f)%this._capacity};d._transferRange=function(f,
e){f<e?this._buffer.transferRange(f,e):f>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(f,this._capacity))};b._createClass(h,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const f=this._headIndex,e=this._tailIndex;return f>=e?f-e:f+this._capacity-e}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===
(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return h}();a.RenderInstanceData=g;a.RenderInstanceDataView=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,c){return function(){function r(n,p,g){this._elementSize=p;this._buffer=b.BufferObject.createVertex(n,c.Usage.STATIC_DRAW);this.resize(g)}var m=r.prototype;m.destroy=function(){this._buffer.dispose()};m.copyRange=function(n,p,g,h=0){n=new Uint8Array(this.array,n*this.elementSize,(p-n)*this.elementSize);(new Uint8Array(g.array,h*this.elementSize)).set(n)};m.transferAll=function(){this._buffer.setData(this._array)};m.transferRange=
function(n,p){n*=this._elementSize;p*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),n,n,p)};m.resize=function(n){const p=n*this._elementSize,g=new ArrayBuffer(p);this._array&&(n>=this._capacity?(new Uint8Array(g)).set(new Uint8Array(this._array)):(new Uint8Array(g)).set((new Uint8Array(this._array)).subarray(0,n*this._elementSize)));this._array=g;this._buffer.setSize(p);this._capacity=n};a._createClass(r,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",
get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return r}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F){function G(Q,T,S){switch(T){case "world":for(const U of Q.vertices)h.add(E,U.pos,Q.offset),S.worldUpAtPosition(E,H),U.setFrameFromUpVector(H),U.computeRotationAxisAndAngleFromUpVector();break;case "path":h.add(E,Q.vertices[0].pos,Q.offset);S.worldUpAtPosition(E,H);v.computeMinimumRotationTangentFrame(Q,H);for(const U of Q.vertices)Q=Math.sign(h.dot(U.frame.right,U.vRight)),h.cross(U.rotationFrame.up,U.vRight,U.vLeft),h.scale(U.rotationFrame.up,
U.rotationFrame.up,Q),h.normalize(U.rotationFrame.up,U.rotationFrame.up),T=h.dot(U.rotationFrame.up,U.frame.up),S=h.dot(U.rotationFrame.up,U.frame.right),h.scale(E,U.frame.up,-S),h.scale(I,U.frame.right,T),h.add(E,E,I),h.normalize(U.rotationFrame.right,E),v.vertexSpaceToProfileSpace(U.rotationRight,U.frame,U.rotationFrame.right),h.negate(E,U.vLeft),U.rotationAngle=-Q*(Math.PI-r.acosClamped(h.dot(E,U.vRight))),0<Math.abs(U.rotationAngle)&&(Q=r.reciprocalClamped(Math.cos(.5*U.rotationAngle)),n.set(U.miterStretch,
1+(Q-1)*U.rotationRight[0]*U.rotationRight[0],(Q-1)*U.rotationRight[0]*U.rotationRight[1],(Q-1)*U.rotationRight[0]*U.rotationRight[1],1+(Q-1)*U.rotationRight[1]*U.rotationRight[1])),U.maxStretchDistance=Math.abs(Math.min(U.vLeftLength,U.vRightLength)*r.reciprocalClamped(Math.cos(.5*(Math.PI-U.rotationAngle))))}}function J(Q,T,S){switch(Q){case "symbol-value":return S;case "proportional":return T;default:return Q}}function L(Q,T,S,U){Q=Q.stageObject;const Y=Q.geometryRecords;var V=0;P.spatialReference=
U.spatialReference;for(const ba of Y){const ia=ba.geometry;if(!x.isPathGeometry(ia))continue;const ma=ia.path,ha=ma.builder.path;N.spatialReference=ia.geometrySR;var R=ha,X=T,W=S,aa=U;let ka=0;for(const Z of R.vertices)t.evaluateElevationInfoAtPoint(Z.posES,W,X,aa,M),ka+=M.sampledElevation,h.add(H,Z.pos,R.offset),aa.setAltitude(H,M.z),h.subtract(Z.pos,H,R.offset);R.updatePathVertexInformation();V+=ka/R.vertices.length;"world"!==ia.upVectorAlignment&&G(ha,ia.upVectorAlignment,U);ma.onPathChanged();
ia.invalidateBoundingInfo();Q.geometryVertexAttrsUpdated(ba)}return V/Y.length}const K=["polyline"];let O=function(Q){function T(U,Y,V,R){U=Q.call(this,U,Y,V,R)||this;U._intrinsicSize=g.fromValues(1,1);U._upVectorAlignment="path";U._stencilWidth=.1;U.ensureDrapedStatus(!1);return U}b._inheritsLoose(T,Q);var S=T.prototype;S.doLoad=function(){var U=b._asyncToGenerator(function*(){var Y=m.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height;const V=m.isSome(this.symbolLayer.height)?
this.symbolLayer.height:Y;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[Y,1,V],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?C.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var R=this.symbolLayer.anchor||
"center";this._upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this._upVectorAlignment="world");var X=this.symbolLayer.profile||"circle";switch(X){default:this._profile=v.Profile.circle(10);break;case "quad":this._profile=v.Profile.rect()}var W=[0,0];"center"!==R&&(W={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[R],this._profile.translate(W[0],W[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new v.MiterExtruder(0,3);break;case "bevel":this._extruder=
new v.MiterExtruder(0,1);break;case "miter":this._extruder=new v.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new v.SimpleExtruder}R=this.symbolLayer.cap||"butt";switch(R){case "none":this._startCap=new v.NoCapBuilder;this._endCap=new v.NoCapBuilder;break;default:this._startCap=new v.TriangulationCapBuilder(this._profile,0);this._endCap=new v.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new v.TriangulationCapBuilder(this._profile,-.5);this._endCap=new v.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":X="quad"===X?!0:!1,this._startCap=new v.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:X,subdivisions:3}),this._endCap=new v.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:X,subdivisions:3})}X=m.get(this.symbolLayer,"material","color");W=this._getCombinedOpacityAndColor(X);X=f.fromArray(W);W=W[3];const aa=1>W||this.needsDrivenTransparentPass;R={diffuse:X,ambient:X,opacity:W,transparent:aa,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:aa||"none"===R?k.CullFaceOptions.None:k.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(p.set(this._intrinsicSize,Y,V),!y.isValidSize(this._intrinsicSize[0])||!y.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||p.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(Y={...R,...this._fastUpdates.materialParameters,size:g.fromArray(this._intrinsicSize)},this._material=new F.PathMaterial(Y)):(R.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new D.DefaultMaterial(R));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return U.apply(this,arguments)}}();S.destroy=function(){Q.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};S.createGraphics3DGraphic=function(U){const Y=U.graphic;if(!this._validateGeometry(Y.geometry,K,this.symbolLayer.type))return null;const V=this.setGraphicElevationContext(Y,new w.ElevationContext);return this._createAs3DShape(Y,U.renderingInfo,V,Y.uid)};S.layerOpacityChanged=function(){var U=m.get(this.symbolLayer,"material","color");U=this._getCombinedOpacity(U);this._material.setParameters({opacity:U,transparent:1>U||this.needsDrivenTransparentPass})};
S.layerElevationInfoChanged=function(U,Y){return this.updateGraphics3DGraphicElevationInfo(U,Y,t.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};S.pixelRatioChanged=function(){return!0};S.applyRendererDiff=function(U,Y){for(const V in U.diff)switch(V){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,
Y,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return B.ApplyRendererDiffResult.Recreate_Symbol;break;default:return B.ApplyRendererDiffResult.Recreate_Symbol}return B.ApplyRendererDiffResult.Fast_Update};S.getVertexData=function(U){let Y=0;const V=U.paths,R=[],X=U.spatialReference,W=this._context.elevationProvider.spatialReference,aa=this._context.renderCoordsHelper.spatialReference;for(var ba of V)Y+=ba.length;ba=new Float64Array(3*Y);const ia=
new Float64Array(3*Y),ma=new Float64Array(3*Y);let ha=0;for(const ka of V){R.push({index:ha,numVertices:ka.length});for(const Z of ka)ba[ha++]=Z[0],ba[ha++]=Z[1],ba[ha++]=U.hasZ?Z[2]:0}U=!0;m.isSome(W)&&!X.equals(W)?U=e.projectBuffer(ba,X,0,ia,W,0,Y):this._copyVertices(ba,0,ia,0,Y);m.isSome(W)&&!W.equals(aa)?e.projectBuffer(ia,W,0,ma,aa,0,Y):this._copyVertices(ia,0,ma,0,Y);return{pathVertexDataInfos:R,vertexDataGS:ba,vertexDataES:ia,vertexDataRS:ma,projectionSuccess:U,terrainElevation:0}};S._copyVertices=
function(U,Y,V,R,X){Y*=3;R*=3;for(let W=0;W<X;++W)V[R++]=U[Y++],V[R++]=U[Y++],V[R++]=U[Y++]};S._createAs3DShape=function(U,Y,V,R){var X=U.geometry,W=[];const aa=[],ba=[],ia=X.spatialReference,ma=l.create(),ha=this._context.renderCoordsHelper;N.spatialReference=ia;const ka=this.getVertexData(X);if(!ka.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<ka.pathVertexDataInfos.length){for(X=0;X<
ka.pathVertexDataInfos.length;++X){var Z=ka.pathVertexDataInfos[X],ca=Z.index;Z=Z.numVertices;if(2>Z)continue;if(m.isSome(this._context.clippingExtent)&&(l.empty(ma),l.expandWithBuffer(ma,ka.vertexDataES,3*ca,Z),!l.intersectsClippingArea(ma,this._context.clippingExtent)))continue;var fa=[];for(var ea=ca;ea<ca+3*Z;){const oa=ea++,ra=ea++,Aa=ea++,ua=new v.PathVertex;h.set(ua.posGS,ka.vertexDataGS[oa],ka.vertexDataGS[ra],ka.vertexDataGS[Aa]);h.set(ua.posES,ka.vertexDataES[oa],ka.vertexDataES[ra],ka.vertexDataES[Aa]);
const za=t.evaluateElevationAlignmentAtPoint(ua.posES,this._context.elevationProvider,V,ha);h.set(H,ka.vertexDataRS[oa],ka.vertexDataRS[ra],ka.vertexDataRS[Aa]);ha.setAltitude(H,za);h.set(ua.pos,H[0],H[1],H[2]);fa.push(ua)}ca=new v.Path(fa);G(ca,this._upVectorAlignment,this._context.renderCoordsHelper);ca=new v.Builder(ca,this._profile,this._extruder,this._startCap,this._endCap);Z=null;this._fastUpdates.enabled?(ea=this._fastUpdates.visualVariables,Z=ea.size?z.getAttributeValue(ea.size.field,U):0,
fa=ea.color?z.getAttributeValue(ea.color.field,U):0,ea=ea.opacity?z.getAttributeValue(ea.opacity.field,U):0,Z=new v.FastUpdatePathGeometry(ca,Z,fa,ea)):(Z=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(Z[0]*=J(Y.size[0],"symbol-value"===Y.size[2]?this.symbolLayer.height||0:Y.size[2],this.symbolLayer.width||0),Z[1]*=J(Y.size[2],"symbol-value"===Y.size[0]?this.symbolLayer.width||0:Y.size[0],this.symbolLayer.height||0)),fa=null,this._drivenProperties.color&&(fa=Y.color),
this._drivenProperties.opacity&&null!=Y.opacity&&(fa=fa?[fa[0],fa[1],fa[2],Y.opacity]:[1,1,1,Y.opacity]),ca=new v.StaticPathGeometry(ca),ca.bake(Z),fa&&ca.bakeVertexColors(fa),Z=ca);const {vertexAttributes:da,indices:la}=Z.createGeometryData();ca=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:R,layerUid:this._context.layer.uid});ca=new x.PathGeometry(da,la,Z,ia,this._upVectorAlignment,this._stencilWidth,ca);W.push(ca);aa.push(this._material);ba.push(Z.xform)}if(0<W.length)return U=
new q.Object3D({geometries:W,materials:aa,transformations:ba,metadata:{layerUid:this._context.layer.uid,graphicUid:R}}),W=new u.Graphics3DObject3DGraphicLayer(this,U,W,null,null,L,V),W.alignedSampledElevation=ka.terrainElevation,W.needsElevationUpdates=t.needsElevationUpdates3D(V.mode),W}else 0!==X.paths.length&&X.paths.some(da=>0<da.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return T}(z.Graphics3DSymbolLayer);const P=A.makeDehydratedPoint(0,
0,0,null),N=A.makeDehydratedPoint(0,0,0,null),H=f.create(),E=d.create(),I=d.create(),M=new t.SampleElevationInfo;a.Graphics3DPathSymbolLayer=O;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(v,D){v[0]=D[0];v[1]=D[1];v[2]=D[2];v[3]=D[3];return v}function r(v){v[0]=
1;v[1]=0;v[2]=0;v[3]=1;return v}function m(v,D,F,G,J){v[0]=D;v[1]=F;v[2]=G;v[3]=J;return v}function n(v,D){if(v===D){const F=D[1];v[1]=D[2];v[2]=F}else v[0]=D[0],v[1]=D[2],v[2]=D[1],v[3]=D[3];return v}function p(v,D){const F=D[0],G=D[1],J=D[2];D=D[3];let L=F*D-J*G;if(!L)return null;L=1/L;v[0]=D*L;v[1]=-G*L;v[2]=-J*L;v[3]=F*L;return v}function g(v,D){const F=D[0];v[0]=D[3];v[1]=-D[1];v[2]=-D[2];v[3]=F;return v}function h(v){return v[0]*v[3]-v[2]*v[1]}function d(v,D,F){const G=D[0],J=D[1],L=D[2];D=
D[3];const K=F[0],O=F[1],P=F[2];F=F[3];v[0]=G*K+L*O;v[1]=J*K+D*O;v[2]=G*P+L*F;v[3]=J*P+D*F;return v}function f(v,D,F){const G=D[0],J=D[1],L=D[2];D=D[3];const K=Math.sin(F);F=Math.cos(F);v[0]=G*F+L*K;v[1]=J*F+D*K;v[2]=G*-K+L*F;v[3]=J*-K+D*F;return v}function e(v,D,F){const G=D[1],J=D[2],L=D[3],K=F[0];F=F[1];v[0]=D[0]*K;v[1]=G*K;v[2]=J*F;v[3]=L*F;return v}function l(v,D){const F=Math.sin(D);D=Math.cos(D);v[0]=D;v[1]=F;v[2]=-F;v[3]=D;return v}function A(v,D){v[0]=D[0];v[1]=0;v[2]=0;v[3]=D[1];return v}
function t(v){return"mat2("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+")"}function w(v){return Math.sqrt(v[0]**2+v[1]**2+v[2]**2+v[3]**2)}function u(v,D,F,G){v[2]=G[2]/G[0];F[0]=G[0];F[1]=G[1];F[3]=G[3]-v[2]*F[1];return[v,D,F]}function z(v,D,F){v[0]=D[0]+F[0];v[1]=D[1]+F[1];v[2]=D[2]+F[2];v[3]=D[3]+F[3];return v}function y(v,D,F){v[0]=D[0]-F[0];v[1]=D[1]-F[1];v[2]=D[2]-F[2];v[3]=D[3]-F[3];return v}function B(v,D){return v[0]===D[0]&&v[1]===D[1]&&v[2]===D[2]&&v[3]===D[3]}function C(v,D){const F=v[0],G=v[1],
J=v[2];v=v[3];const L=D[0],K=D[1],O=D[2];D=D[3];const P=b.getEpsilon();return Math.abs(F-L)<=P*Math.max(1,Math.abs(F),Math.abs(L))&&Math.abs(G-K)<=P*Math.max(1,Math.abs(G),Math.abs(K))&&Math.abs(J-O)<=P*Math.max(1,Math.abs(J),Math.abs(O))&&Math.abs(v-D)<=P*Math.max(1,Math.abs(v),Math.abs(D))}function k(v,D,F){v[0]=D[0]*F;v[1]=D[1]*F;v[2]=D[2]*F;v[3]=D[3]*F;return v}function q(v,D,F,G){v[0]=D[0]+F[0]*G;v[1]=D[1]+F[1]*G;v[2]=D[2]+F[2]*G;v[3]=D[3]+F[3]*G;return v}const x=Object.freeze(Object.defineProperty({__proto__:null,
copy:c,identity:r,set:m,transpose:n,invert:p,adjoint:g,determinant:h,multiply:d,rotate:f,scale:e,fromRotation:l,fromScaling:A,str:t,frob:w,LDU:u,add:z,subtract:y,exactEquals:B,equals:C,multiplyScalar:k,multiplyScalarAndAdd:q,mul:d,sub:y},Symbol.toStringTag,{value:"Module"}));a.LDU=u;a.add=z;a.adjoint=g;a.copy=c;a.determinant=h;a.equals=C;a.exactEquals=B;a.frob=w;a.fromRotation=l;a.fromScaling=A;a.identity=r;a.invert=p;a.mat2=x;a.mul=d;a.multiply=d;a.multiplyScalar=k;a.multiplyScalarAndAdd=q;a.rotate=
f;a.scale=e;a.set=m;a.str=t;a.sub=y;a.subtract=y;a.transpose=n})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./Geometry"],function(a,b,c,r){r=function(m){function n(p,g,h,d,f,e,l){p=m.call(this,p,g,c.PrimitiveType.Triangle,l)||this;p.path=h;p.geometrySR=d;p.upVectorAlignment=f;p.stencilWidth=e;return p}b._inheritsLoose(n,m);return n}(r.Geometry);a.PathGeometry=r;a.isPathGeometry=function(m){return"upVectorAlignment"in
m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(){return{up:f.create(),right:f.create()}}let z=function(){function Y(){this.pos=f.create();this.posES=f.create();this.posGS=f.create();this.vRight=f.create();this.vLeft=f.create();this.frame=u();this.rotationFrame=u();this.rotationRight=h.create();this.rotationAngle=0;this.miterStretch=m.create()}var V=Y.prototype;V.setFrameFromUpVector=function(R){d.copy(this.frame.up,R);d.add(I,this.vLeft,this.vRight);d.normalize(I,I);d.scale(E,this.frame.up,
d.dot(I,this.frame.up));d.subtract(T,I,E);d.normalize(T,T);d.cross(this.frame.right,T,this.frame.up)};V.computeRotationAxisAndAngleFromUpVector=function(){d.copy(this.rotationFrame.up,this.frame.up);d.copy(this.rotationFrame.right,this.frame.right);g.set(this.rotationRight,1,0);d.scale(E,this.frame.up,d.dot(this.frame.up,this.vLeft));d.subtract(E,this.vLeft,E);d.negate(E,E);d.normalize(E,E);d.scale(I,this.frame.up,d.dot(this.frame.up,this.vRight));d.subtract(I,this.vRight,I);d.normalize(I,I);d.cross(M,
this.rotationFrame.up,this.vLeft);this.rotationAngle=Math.sign(d.dot(M,this.vRight))*(Math.PI-c.acosClamped(d.dot(E,I)));if(0<Math.abs(this.rotationAngle)){const R=c.reciprocalClamped(Math.cos(.5*this.rotationAngle));r.set(this.miterStretch,1+(R-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return Y}(),y=function(){function Y(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var V=Y.prototype;V.addVertex=function(R,X){this.vertices.push(h.clone(R));this.vertexNormals.push(h.clone(X));return this.vertices.length-1};V.addUV=function(R){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(R);return this.uvs.length-1};V.addPole=function(R,X=null){this.poles.push({position:h.clone(R),normal:X?h.clone(X):null});return this.poles.length-1};V.addSegment=function(R,X=null,W=null){this.vertexIndices.push(R.v0);this.vertexIndices.push(R.v1);X&&
(this.uvIndices.push(X.v0),this.uvIndices.push(X.v1));W&&(this.poleIndices.push(W.v0),this.poleIndices.push(W.v1))};V.hasUV=function(){return null!=this.uvs};V.translate=function(R,X){for(const W of this.vertices)W[0]+=R,W[1]+=X;for(const W of this.poles)W.position[0]+=R,W.position[1]+=X};Y.circle=function(R=20){const X=new Y,W={v0:0,v1:0};X.addPole(h.fromValues(0,0));for(var aa=0;aa<R;++aa){var ba=2*aa*Math.PI/R,ia=Math.cos(ba);const ma=Math.sin(ba);ba=h.fromValues(.5*ia,.5*ma);ia=h.fromValues(ia,
ma);X.addVertex(ba,ia);X.addUV(aa/R)}X.addUV(1);for(aa=0;aa<R-1;++aa)ia={v0:aa,v1:aa+1},X.addSegment(ia,ia,W);X.addSegment({v0:R-1,v1:0},{v0:R-1,v1:R},W);return X};Y.rect=function(){const R=new Y,X=h.fromValues(-.5,-.5),W=h.fromValues(.5,-.5),aa=h.fromValues(.5,.5),ba=h.fromValues(-.5,.5),ia=h.fromValues(0,-1),ma=h.fromValues(1,0),ha=h.fromValues(0,1),ka=h.fromValues(-1,0);R.addUV(0);R.addUV(1);R.addPole(h.fromValues(0,.5),ha);R.addPole(h.fromValues(0,.5));R.addPole(h.fromValues(0,-.5));R.addPole(h.fromValues(0,
-.5),ia);const Z={v0:0,v1:1};R.addVertex(X,ia);R.addVertex(W,ia);R.addSegment({v0:0,v1:1},Z,{v0:3,v1:3});R.addVertex(W,ma);R.addVertex(aa,ma);R.addSegment({v0:2,v1:3},Z,{v0:2,v1:1});R.addVertex(aa,ha);R.addVertex(ba,ha);R.addSegment({v0:4,v1:5},Z,{v0:0,v1:0});R.addVertex(ba,ka);R.addVertex(X,ka);R.addSegment({v0:6,v1:7},Z,{v0:1,v1:2});return R};b._createClass(Y,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return Y}(),B=function(){function Y(V){this.vertices=[];this.offset=
f.create();this.xform=p.create();this.vertices=V;d.copy(this.offset,this.vertices[Math.floor((V.length-1)/2)].pos);for(const R of this.vertices)d.subtract(R.pos,R.pos,this.offset);n.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}Y.prototype.updatePathVertexInformation=function(){const V=this.vertices.length;let R=this.vertices[0];R.index=0;d.set(R.vLeft,0,0,0);R.vLeftLength=0;d.subtract(R.vRight,this.vertices[1].pos,R.pos);R.vRightLength=d.length(R.vRight);d.normalize(R.vRight,
R.vRight);let X=R;for(let W=1;W<V;++W)R=this.vertices[W],R.index=W,d.copy(R.vLeft,X.vRight),R.vLeftLength=X.vRightLength,W<V-1?(d.subtract(R.vRight,this.vertices[W+1].pos,R.pos),R.vRightLength=d.length(R.vRight),d.normalize(R.vRight,R.vRight)):(d.copy(R.vRight,R.vLeft),R.vRightLength=R.vLeftLength),X=R};return Y}(),C=function(){function Y(){}var V=Y.prototype;V.numProfilesPerJoin=function(){return 1};V.extrude=function(R,X,W){for(let aa=0;aa<X.vertices.length;++aa)W(R.index,R.frame,X.vertices[aa],
X.vertexNormals[aa],!1)};return Y}(),k=function(){function Y(R=.8*Math.PI,X=1){this.cutoffAngle=R;this.numBendSubdivisions=X}var V=Y.prototype;V.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};V.extrude=function(R,X,W){var aa=S;if(Math.abs(R.rotationAngle)>=this.cutoffAngle)for(var ba=0;ba<this.numBendSubdivisions+1;++ba){n.fromRotation(U,.5*-R.rotationAngle+ba*R.rotationAngle/this.numBendSubdivisions,R.rotationFrame.up);var ia=aa,ma=R.frame,ha=U;d.transformMat4(ia.up,ma.up,ha);d.transformMat4(ia.right,
ma.right,ha);for(ia=0;ia<X.vertices.length;++ia)0<=g.dot(X.vertices[ia],R.rotationRight)*R.rotationAngle?W(R.index,aa,X.vertices[ia],X.vertexNormals[ia],!1):(g.transformMat2(P,X.vertices[ia],R.miterStretch),W(R.index,R.frame,P,X.vertexNormals[ia],!0))}else for(aa=0;aa<this.numBendSubdivisions+1;++aa)for(ba=0;ba<X.vertices.length;++ba)ia=0<=g.dot(X.vertices[ba],R.rotationRight)*R.rotationAngle,g.transformMat2(P,X.vertices[ba],R.miterStretch),W(R.index,R.frame,P,X.vertexNormals[ba],ia?!1:!0)};return Y}();
const q={generateUV:!1};let x=function(){function Y(){}Y.prototype.rebuildConnectingProfileGeometry=function(V,R,X){for(let W=0;W<R.vertices.length;++W)X(V.index,V.frame,R.vertices[W],R.vertexNormals[W],0,0)};return Y}(),v=function(Y){function V(){return Y.call(this)||this}b._inheritsLoose(V,Y);var R=V.prototype;R.getNumVertices=function(){return 0};R.getNumIndices=function(){return 0};R.rebuildCapGeometry=function(){};R.buildTopology=function(){};return V}(x),D=function(Y){function V(X,W=0,aa=!1){var ba=
Y.call(this)||this;ba.profile=X;ba.profilePlaneOffset=W;ba.flip=aa;return ba}b._inheritsLoose(V,Y);var R=V.prototype;R.getNumVertices=function(){return this.profile.vertices.length};R.getNumIndices=function(){return 3*this.profile.numSegments};R.rebuildConnectingProfileGeometry=function(X,W,aa){for(let ba=0;ba<W.vertices.length;++ba)aa(X.index,X.frame,W.vertices[ba],W.vertexNormals[ba],this.profilePlaneOffset,0)};R.rebuildCapGeometry=function(X,W){const aa=N;g.set(aa,0,0);const ba=this.flip?1:-1;
for(let ia=0;ia<this.profile.vertices.length;++ia)W(X.index,X.frame,this.profile.vertices[ia],aa,this.profilePlaneOffset,ba)};R.buildTopology=function(X,W){X=this.vertexBufferStart+this.profile.vertexIndices[0];for(let aa=1;aa<this.profile.numSegments;++aa){const ba=this.vertexBufferStart+this.profile.vertexIndices[2*aa],ia=this.vertexBufferStart+this.profile.vertexIndices[2*aa+1];this.flip?W(ia,ba,X):W(X,ba,ia)}};return V}(x),F=function(Y){function V(X){var W=Y.call(this)||this;W.flip=!1;W.sign=
0;W.breakNormals=!1;W.numSegments=3;W.profile=X.profile;W.flip=X.flip;W.sign=W.flip?1:-1;W.breakNormals=X.breakNormals;W.numSegments=X.subdivisions;return W}b._inheritsLoose(V,Y);var R=V.prototype;R.getNumVertices=function(){let X=0;X=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(X+=this.profile.vertices.length);return X+=this.profile.poles.length};R.getNumIndices=function(){let X;X=2*this.profile.numSegments*(this.numSegments-1);for(let W=0;W<this.profile.numSegments;++W)X=
this.profile.poleIndices[this.profile.vertexIndices[2*W]]===this.profile.poleIndices[this.profile.vertexIndices[2*W+1]]?X+1:X+2;return 3*X};R.rebuildCapGeometry=function(X,W){const aa=X.frame,ba=.5*this.sign,ia=P,ma=N;g.set(ma,0,0);for(var ha=0;ha<this.profile.poles.length;++ha){var ka=this.profile.poles[ha];ka.normal?W(X.index,aa,ka.position,ka.normal,ba,0):W(X.index,aa,ka.position,ma,ba,this.sign)}if(this.breakNormals)for(ha=0;ha<this.profile.vertices.length;++ha)W(X.index,aa,this.profile.vertices[ha],
this.profile.vertexNormals[ha],0,0);for(ha=0;ha<this.numSegments-1;++ha){var Z=(1-(ha+1)/this.numSegments)*Math.PI*.5;ka=Math.sin(Z);Z=Math.cos(Z);for(let ca=0;ca<this.profile.vertices.length;++ca){const fa=this.profile.poles[this.profile.poleIndices[ca]];g.subtract(ia,this.profile.vertices[ca],fa.position);g.scale(ia,ia,ka);fa.normal?(g.add(ia,ia,fa.position),W(X.index,aa,ia,fa.normal,ba*Z,0)):(g.normalize(ma,ia),g.scale(ma,ma,ka),g.add(ia,ia,fa.position),W(X.index,aa,ia,ma,ba*Z,this.sign*Z))}}};
R.buildTopology=function(X,W){X=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const aa=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ba=0;ba<this.profile.numSegments;++ba){const ia=this.profile.vertexIndices[2*ba],ma=this.profile.vertexIndices[2*ba+1],ha=this.vertexBufferStart+this.profile.poleIndices[ia],ka=this.vertexBufferStart+this.profile.poleIndices[ma];
let Z=X+ia,ca=X+ma;for(let fa=0;fa<this.numSegments-1;++fa){const ea=aa+fa*this.profile.vertices.length+ia,da=aa+fa*this.profile.vertices.length+ma;this.flip?(W(ea,ca,Z),W(ca,ea,da)):(W(Z,ca,ea),W(da,ea,ca));Z=ea;ca=da}this.flip?(W(ha,ca,Z),ha!==ka&&W(ha,ka,ca)):(W(Z,ca,ha),ha!==ka&&W(ca,ka,ha))}};return V}(x),G=function(){function Y(R,X,W,aa,ba,ia=q){this.options=ia;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._extrusionVertexCount=0;this.profile=X;this.path=
R;this.extruder=W;this.startCap=aa;this.endCap=ba;R=this.path.vertices.length-2;this.numExtrusionProfiles=W.numProfilesPerJoin()*R+2;this.numNormalsTotal=this.numVerticesTotal=X.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;X=this.startCap.getNumVertices();this.numVerticesTotal+=X;this.numNormalsTotal+=X;this.endCap.vertexBufferStart=this.numVerticesTotal;X=this.endCap.getNumVertices();this.numVerticesTotal+=X;this.numNormalsTotal+=X;this.pathVertexData=
new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this._rebuildGeometry();this.buildTopology()}var V=Y.prototype;
V.emitVertex=function(R,X,W,aa,ba){this.profileRightAxisData[4*this._extrusionVertexCount]=X.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=X.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=X.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=X.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=X.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=X.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=W[0];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+1]=W[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=aa[1];this.pathVertexData[this._extrusionVertexCount]=R;ba?(R=this.path.vertices[R],this.profileRightAxisData[4*this._extrusionVertexCount+3]=R.rotationRight[0]*R.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=R.rotationRight[1]*R.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+
3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};V.emitCapVertex=function(R,X,W,aa,ba,ia){this.profileRightAxisData[4*this._extrusionVertexCount]=X.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=X.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=X.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=X.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=X.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+
2]=X.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=W[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=W[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=aa[1];this.pathVertexData[this._extrusionVertexCount]=R;this.profileRightAxisData[4*this._extrusionVertexCount+3]=ba;this.profileUpAxisData[4*this._extrusionVertexCount+3]=ia;++this._extrusionVertexCount};V.emitTriangle=
function(R,X,W){this.vertexIndices.push(R);this.vertexIndices.push(X);this.vertexIndices.push(W);this.pathVertexIndices.push(this.pathVertexData[R]);this.pathVertexIndices.push(this.pathVertexData[X]);this.pathVertexIndices.push(this.pathVertexData[W]);this.normalIndices.push(R);this.normalIndices.push(X);this.normalIndices.push(W)};V._rebuildGeometry=function(){var R=(aa,ba,ia,ma,ha)=>this.emitVertex(aa,ba,ia,ma,ha);const X=(aa,ba,ia,ma,ha,ka)=>this.emitCapVertex(aa,ba,ia,ma,ha,ka);this._extrusionVertexCount=
0;for(var W of this.path.vertices)this.originData[3*W.index]=W.pos[0],this.originData[3*W.index+1]=W.pos[1],this.originData[3*W.index+2]=W.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,X);for(W=1;W<this.path.vertices.length-1;++W)this.extruder.extrude(this.path.vertices[W],this.profile,R);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,X);this.startCap.rebuildCapGeometry(this.path.vertices[0],X);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-
1],X);if(this.profile.hasUV()&&this.options.generateUV)for(R=0;R<this.profile.uvs.length;++R)this.uvData[2*R]=this.profile.uvs[R],this.uvData[2*R+1]=0};V.buildTopology=function(){var R=this.profile.vertices.length;const X=this.profile.numSegments,W=this.numExtrusionProfiles-1;var aa=X*W*6;this.startCap.indexBufferStart=aa;this.startCap.firstProfileVertexIndex=0;aa+=this.startCap.getNumIndices();this.endCap.indexBufferStart=aa;this.endCap.firstProfileVertexIndex=R*(this.numExtrusionProfiles-1);this.vertexIndices=
[];this.normalIndices=[];this.pathVertexIndices=[];this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=[]);for(aa=0;aa<X;++aa){const ba=this.profile.vertexIndices[2*aa],ia=this.profile.vertexIndices[2*aa+1];for(let ma=0;ma<W;++ma){const ha=ma*R+ba,ka=(ma+1)*R+ia,Z=ma*R+ia;this.emitTriangle(ha,(ma+1)*R+ba,ka);this.emitTriangle(ha,ka,Z)}}R=(ba,ia,ma)=>this.emitTriangle(ba,ia,ma);this.startCap.buildTopology(this.path.vertices[0],R);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-
1],R)};V.onPathChanged=function(){this._rebuildGeometry()};return Y}(),J=function(){function Y(V){this.builder=V}Y.prototype.onPathChanged=function(){this.builder.onPathChanged()};b._createClass(Y,[{key:"xform",get:function(){return this.builder.path.xform}}]);return Y}(),L=function(Y){function V(X){X=Y.call(this,X)||this;X.vertexAttributePosition=null;X.vertexAttributeNormal=null;X.vertexAttributeColor=null;X.vertexAttributePosition=new Float32Array(3*X.builder.numVerticesTotal);X.vertexAttributeNormal=
new Float32Array(3*X.builder.numNormalsTotal);X.vertexAttributeColor=new Uint8Array(4);X.vertexAttributeColor[0]=255;X.vertexAttributeColor[1]=255;X.vertexAttributeColor[2]=255;X.vertexAttributeColor[3]=255;return X}b._inheritsLoose(V,Y);var R=V.prototype;R.bakeVertexColors=function(X){this.vertexAttributeColor[0]=255*X[0];this.vertexAttributeColor[1]=255*X[1];this.vertexAttributeColor[2]=255*X[2];this.vertexAttributeColor[3]=255*(3<X.length?X[3]:1)};R.bake=function(X){this.size=X;for(let ia=0;ia<
this.builder.numVerticesTotal;++ia){var W=this.builder.pathVertexData[ia],aa=0===W||W===this.builder.path.vertices.length-1;W*=3;var ba=O;d.set(ba,this.builder.originData[W++],this.builder.originData[W++],this.builder.originData[W]);W=4*ia;const ma=E,ha=P,ka=I,Z=M,ca=Q;let fa=0,ea=0;d.set(Z,this.builder.profileRightAxisData[W],this.builder.profileRightAxisData[W+1],this.builder.profileRightAxisData[W+2]);d.set(ca,this.builder.profileUpAxisData[W],this.builder.profileUpAxisData[W+1],this.builder.profileUpAxisData[W+
2]);g.set(ha,this.builder.profileVertexAndNormalData[W]*X[0],this.builder.profileVertexAndNormalData[W+1]*X[1]);if(aa)d.cross(ka,ca,Z),fa=this.builder.profileRightAxisData[W+3]*X[0],ea=this.builder.profileUpAxisData[W+3];else{aa=N;const da=H;g.set(aa,this.builder.profileRightAxisData[W+3],this.builder.profileUpAxisData[W+3]);const la=g.length(aa);g.normalize(aa,aa);const oa=g.dot(ha,aa);if(Math.abs(oa)>la){g.set(da,-aa[1],aa[0]);const ra=g.dot(ha,da);g.scale(aa,aa,la*Math.sign(oa));g.scale(da,da,
ra);g.add(ha,aa,da)}d.set(ka,0,0,0)}d.set(ma,Z[0]*ha[0]+ca[0]*ha[1],Z[1]*ha[0]+ca[1]*ha[1],Z[2]*ha[0]+ca[2]*ha[1]);this.vertexAttributePosition[3*ia]=ba[0]+ma[0]+ka[0]*fa;this.vertexAttributePosition[3*ia+1]=ba[1]+ma[1]+ka[1]*fa;this.vertexAttributePosition[3*ia+2]=ba[2]+ma[2]+ka[2]*fa;ba=P;g.set(ba,this.builder.profileVertexAndNormalData[W+2],this.builder.profileVertexAndNormalData[W+3]);this.vertexAttributeNormal[3*ia]=Z[0]*ba[0]+ca[0]*ba[1]+ka[0]*ea;this.vertexAttributeNormal[3*ia+1]=Z[1]*ba[0]+
ca[1]*ba[1]+ka[1]*ea;this.vertexAttributeNormal[3*ia+2]=Z[2]*ba[0]+ca[2]*ba[1]+ka[2]*ea}};R.createGeometryData=function(){const X=[[t.VertexAttribute.POSITION,this.builder.vertexIndices],[t.VertexAttribute.NORMAL,this.builder.normalIndices]],W=[[t.VertexAttribute.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[t.VertexAttribute.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(X.push([t.VertexAttribute.COLOR,Array(this.builder.vertexIndices.length).fill(0)]),
W.push([t.VertexAttribute.COLOR,{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:W,indices:X}};R.onPathChanged=function(){Y.prototype.onPathChanged.call(this);this.bake(this.size)};R.intersect=function(X,W,aa){const ba=this.builder.vertexIndices;w.intersectTriangles(X,W,0,ba.length/3,ba,{size:3,data:this.vertexAttributePosition},void 0,void 0,aa)};return V}(J),K=function(Y){function V(R,X,W,aa){var ba=Y.call(this,R)||this;ba.sizeAttributeValue=X;ba.colorAttributeValue=W;ba.opacityAttributeValue=
aa;ba.vvData=null;ba.baked=new L(R);ba.vvData=new Float32Array(4*ba.builder.path.vertices.length);for(R=0;R<ba.builder.path.vertices.length;++R)ba.vvData[4*R]=X,ba.vvData[4*R+1]=W,ba.vvData[4*R+2]=aa,ba.vvData[4*R+3]=0===R||R===ba.builder.path.vertices.length-1?1:0;return ba}b._inheritsLoose(V,Y);V.prototype.createGeometryData=function(){return{vertexAttributes:[[t.VertexAttribute.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[t.VertexAttribute.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,
exclusive:!0}],[t.VertexAttribute.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[t.VertexAttribute.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[t.VertexAttribute.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[t.VertexAttribute.POSITION,this.builder.pathVertexIndices],[t.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[t.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[t.VertexAttribute.PROFILEVERTEXANDNORMAL,
this.builder.vertexIndices],[t.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return V}(J);const O=f.create(),P=h.create(),N=h.create(),H=h.create(),E=f.create(),I=f.create(),M=f.create(),Q=f.create(),T=f.create(),S=u(),U=p.create();a.Builder=G;a.CapBuilder=x;a.Extruder=function(){};a.FastUpdatePathGeometry=K;a.MiterExtruder=k;a.NoCapBuilder=v;a.Path=B;a.PathGeometryData=J;a.PathVertex=z;a.Profile=y;a.RoundCapBuilder=F;a.SimpleExtruder=C;a.StaticPathGeometry=L;a.TriangulationCapBuilder=
D;a.computeMinimumRotationTangentFrame=function(Y,V){let R=null;const X=Y.vertices.length,W=f.create(),aa=f.create(),ba=f.create(),ia=f.create(),ma=f.create(),ha=f.create(),ka=e.create();let Z=Y.vertices[0];d.copy(aa,V);d.set(W,0,1,0);A.makeOrthoBasisDirUpFallback(Z.vRight,aa,W,W,ba,aa,.99619469809);d.copy(Z.frame.up,aa);d.copy(Z.frame.right,ba);R=Z;for(V=1;V<X;++V){Z=Y.vertices[V];d.add(ma,Z.vLeft,Z.vRight);let ca=d.length(ma);0<ca?(ca=1/Math.sqrt(ca),ma[0]*=ca,ma[1]*=ca,ma[2]*=ca):(ma[0]=Z.vRight[0],
ma[1]=Z.vRight[1],ma[2]=Z.vRight[2]);d.add(ha,R.pos,R.frame.up);e.fromPositionAndNormal(Z.pos,ma,ka);e.intersectRay(ka,l.wrap(ha,Z.vLeft),ia)?(d.subtract(ia,ia,Z.pos),d.normalize(aa,ia),d.cross(ba,ma,aa),d.normalize(ba,ba)):A.makeOrthoBasisDirUpFallback(ma,R.frame.up,R.frame.right,W,ba,aa,.99619469809);d.copy(Z.frame.up,aa);d.copy(Z.frame.right,ba);R=Z}};a.makeFrame=u;a.profileSpaceToVertexSpace=function(Y,V,R){Y[0]=R[0]*V.right[0]+R[1]*V.up[0];Y[1]=R[0]*V.right[1]+R[1]*V.up[1];Y[2]=R[0]*V.right[2]+
R[1]*V.up[2]};a.vertexSpaceToProfileSpace=function(Y,V,R){g.set(Y,d.dot(R,V.right),d.dot(R,V.up))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function c(p){return[p[0],p[1],p[2],p[3]]}function r(p,g,h,d){return[p,g,h,d]}function m(p,g){return new Float64Array(p,g,4)}const n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m},
Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.mat2f64=n})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){function B(x,v,D,F){if(v.vertexAttributes.has(x)){const G=v.vertexAttributes.get(x);v=v.indices.get(x);t.assert(4===G.size);if(D=D.getField(x,n.BufferViewVec4f))z.writeBufferVec4(v,G.data,D,F);else throw Error("unable to acquire view for "+x);}}e=function(x){function v(F){F=x.call(this,F,new k)||this;F.supportsEdges=!0;F._vertexAttributeLocations=u.vertexAttributeLocations;F._configuration=new u.PathTechniqueConfiguration;F._vertexBufferLayout=v.getVertexBufferLayout(F.parameters);
return F}b._inheritsLoose(v,x);var D=v.prototype;D.getConfiguration=function(F,G){this._configuration.output=F;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(F===g.ShaderOutput.Color||
F===g.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?h.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?h.NormalsDoubleSidedMode.WindingOrder:h.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=G.ssaoHelper.ready?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=
G.transparencyPassType;this._configuration.hasMultipassTerrain=G.multipassTerrain.enabled;this._configuration.cullAboveGround=G.multipassTerrain.cullAboveGround;return this._configuration};D.isVisibleForOutput=function(F){return F===g.ShaderOutput.Shadow||F===g.ShaderOutput.ShadowExludeHighlight||F===g.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};D.isVisible=function(){return x.prototype.isVisible.call(this)&&0<this.parameters.opacity};D.intersect=function(F,G,J,L,K,O,P){if(l.isPathGeometry(F)){G=
F.path;J=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var N=this.parameters.vvSizeOffset,H=this.parameters.vvSizeFactor;const E=this.parameters.vvSizeMinSize,I=this.parameters.vvSizeMaxSize,M=G.sizeAttributeValue;J[0]*=c.clamp(N[0]+M*H[0],E[0],I[0]);J[1]*=c.clamp(N[2]+M*H[2],E[2],I[2])}N=Math.max(J[0],J[1]);F=F.boundingInfo;r.isNone(F)?this._intersectTriangles(G,J,K,O,P):(F=m.fromValues(F.bbMin[0]-N,F.bbMin[1]-N,F.bbMin[2]-N,F.bbMax[0]+N,F.bbMax[1]+N,F.bbMax[2]+
N),N=[O[0]-K[0],O[1]-K[1],O[2]-K[2]],H=Math.sqrt(N[0]*N[0]+N[1]*N[1]+N[2]*N[2]),y.intersectAabbInvDir(F,K,[H/N[0],H/N[1],H/N[2]],L.tolerance)&&this._intersectTriangles(G,J,K,O,P))}};D._intersectTriangles=function(F,G,J,L,K){F.baked.size&&F.baked.size[0]===G[0]&&F.baked.size[1]===G[1]||F.baked.bake(G);F.baked.intersect(J,L,K)};D.computeAttachmentOrigin=function(F,G){F=F.vertexAttributes;if(!F)return null;F=F.get(w.VertexAttribute.POSITION);return d.computeAttachmentOriginLines(F,null,!1,G)};D.createBufferWriter=
function(){return new q(this._vertexBufferLayout)};D.requiresSlot=function(F,G){switch(G){case g.ShaderOutput.Shadow:case g.ShaderOutput.ShadowHighlight:case g.ShaderOutput.ShadowExludeHighlight:if(!this.parameters.castShadows)return!1;case g.ShaderOutput.Color:case g.ShaderOutput.Alpha:case g.ShaderOutput.Depth:case g.ShaderOutput.Normal:case g.ShaderOutput.Highlight:case g.ShaderOutput.ObjectAndLayerIdColor:return F===(this.parameters.transparent?A.RenderSlot.TRANSPARENT_MATERIAL:A.RenderSlot.OPAQUE_MATERIAL)||
F===A.RenderSlot.DRAPED_MATERIAL;default:return!1}};D.createGLMaterial=function(F){return new C(F)};v.getVertexBufferLayout=function(F){const G=p.newLayout().vec3f(w.VertexAttribute.POSITION).vec4f(w.VertexAttribute.PROFILERIGHT).vec4f(w.VertexAttribute.PROFILEUP).vec4f(w.VertexAttribute.PROFILEVERTEXANDNORMAL);(F.vvColorEnabled||F.vvSizeEnabled||F.vvOpacityEnabled)&&G.vec4f(w.VertexAttribute.FEATUREVALUE);return G};return v}(e.Material);let C=function(x){function v(){return x.apply(this,arguments)||
this}b._inheritsLoose(v,x);var D=v.prototype;D._updateOccludeeState=function(F){F.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:F.hasOccludees})};D._updateShadowState=function(F){(r.isNone(this.technique)||F.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:F.shadowMap.enabled})};D.beginSlot=function(F){if(this._output===g.ShaderOutput.Color||this._output===g.ShaderOutput.Alpha)this._updateShadowState(F),
this._updateOccludeeState(F);return this.ensureTechnique(u.PathTechnique,F)};return v}(f),k=function(x){function v(){var D=x.apply(this,arguments)||this;D.doubleSided=!1;D.doubleSidedType="normal";D.receiveSSAO=!0;D.receiveShadows=!1;D.castShadows=!0;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;return D}b._inheritsLoose(v,x);return v}(u.PathPassParameters),q=function(){function x(D){this.vertexBufferLayout=D}var v=x.prototype;v.allocate=function(D){return this.vertexBufferLayout.createBuffer(D)};
v.elementCount=function(D){return D.indices.get(w.VertexAttribute.POSITION).length};v.write=function(D,F,G,J,L){B(w.VertexAttribute.PROFILERIGHT,G,J,L);B(w.VertexAttribute.PROFILEUP,G,J,L);B(w.VertexAttribute.PROFILEVERTEXANDNORMAL,G,J,L);this.vertexBufferLayout.hasField(w.VertexAttribute.FEATUREVALUE)&&B(w.VertexAttribute.FEATUREVALUE,G,J,L);z.writeDefaultAttributes(G,this.vertexBufferLayout,D,F,J,L)};return x}();a.PathMaterial=e;a.PathMaterialParameters=k;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){const x=new Map([[y.VertexAttribute.POSITION,0],[y.VertexAttribute.PROFILERIGHT,1],[y.VertexAttribute.PROFILEUP,2],[y.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[y.VertexAttribute.FEATUREVALUE,4]]);g=function(v){function D(){var F=v.apply(this,arguments)||this;F.ambient=m.fromValues(.2,.2,.2);F.diffuse=m.fromValues(.8,.8,.8);F.specular=m.fromValues(0,0,0);F.opacity=1;return F}c._inheritsLoose(D,v);return D}(g.PathVertexPositionPassParameters);
l=function(v){function D(){return v.apply(this,arguments)||this}c._inheritsLoose(D,v);var F=D.prototype;F.initializeConfiguration=function(G,J){J.hasWebGL2Context=G.rctx.type===k.ContextType.WEBGL2;J.spherical=G.viewingMode===n.ViewingMode.Global;J.doublePrecisionRequiresObfuscation=f.doublePrecisionRequiresObfuscation(G.rctx)};F.initializeProgram=function(G){return new w.Program(G.rctx,D.shader.get().build(this.configuration),x)};F.initializePipeline=function(){const G=this.configuration.transparencyPassType,
J=this.configuration,L=G===z.TransparencyPassType.NONE,K=G===z.TransparencyPassType.FrontFace;return q.makePipelineState({blending:J.output!==p.ShaderOutput.Color&&J.output!==p.ShaderOutput.Alpha||!J.transparent?null:L?t.blendingDefault:t.oitBlending(G),culling:J.hasSlicePlane&&!J.transparent&&J.doubleSidedMode!==h.NormalsDoubleSidedMode.None&&q.frontFaceCullingParams,depthTest:{func:t.oitDepthTest(G)},depthWrite:L||K?q.defaultDepthWriteParams:null,colorWrite:q.defaultColorWriteParams,stencilWrite:J.hasOccludees?
u.stencilWriteMaskOn:null,stencilTest:J.hasOccludees?u.stencilBaseAllZerosParams:null,polygonOffset:L||K?null:t.OITPolygonOffset})};return D}(l.ShaderTechnique);l.shader=new e.ReloadableShaderModule(C.Path,()=>new Promise((v,D)=>a(["../shaders/Path.glsl"],v,D)));e=function(v){function D(){var F=v.apply(this,arguments)||this;F.output=p.ShaderOutput.Color;F.doubleSidedMode=h.NormalsDoubleSidedMode.None;F.transparencyPassType=z.TransparencyPassType.NONE;F.spherical=!1;F.receiveShadows=!1;F.receiveAmbientOcclusion=
!1;F.vvSize=!1;F.vvColor=!1;F.vvOpacity=!1;F.hasSlicePlane=!1;F.transparent=!1;F.hasOccludees=!1;F.hasMultipassTerrain=!1;F.cullAboveGround=!1;F.doublePrecisionRequiresObfuscation=!1;return F}c._inheritsLoose(D,v);return D}(B.DefaultTechniqueConfiguration);r.__decorate([A.parameter({count:p.ShaderOutput.COUNT})],e.prototype,"output",void 0);r.__decorate([A.parameter({count:h.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",void 0);r.__decorate([A.parameter({count:z.TransparencyPassType.COUNT})],
e.prototype,"transparencyPassType",void 0);r.__decorate([A.parameter()],e.prototype,"spherical",void 0);r.__decorate([A.parameter()],e.prototype,"receiveShadows",void 0);r.__decorate([A.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);r.__decorate([A.parameter()],e.prototype,"vvSize",void 0);r.__decorate([A.parameter()],e.prototype,"vvColor",void 0);r.__decorate([A.parameter()],e.prototype,"vvOpacity",void 0);r.__decorate([A.parameter()],e.prototype,"hasSlicePlane",void 0);r.__decorate([A.parameter()],
e.prototype,"transparent",void 0);r.__decorate([A.parameter()],e.prototype,"hasOccludees",void 0);r.__decorate([A.parameter()],e.prototype,"hasMultipassTerrain",void 0);r.__decorate([A.parameter()],e.prototype,"cullAboveGround",void 0);r.__decorate([A.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);r.__decorate([A.parameter({constValue:d.PBRMode.Disabled})],e.prototype,"pbrMode",void 0);r.__decorate([A.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);r.__decorate([A.parameter({constValue:!1})],
e.prototype,"useCustomDTRExponentForWater",void 0);r.__decorate([A.parameter({constValue:!1})],e.prototype,"useFillLights",void 0);b.PathPassParameters=g;b.PathTechnique=l;b.PathTechniqueConfiguration=e;b.vertexAttributeLocations=x;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){let e=function(l){function A(){var t=l.apply(this,arguments)||this;t.size=c.fromValues(1,1);return t}b._inheritsLoose(A,l);return A}(f.VisualVariablePassParameters);a.PathVertexPosition=function(l,A){l.attributes.add(d.VertexAttribute.FEATUREVALUE,"vec4");const t=l.vertex;t.code.add(h.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);t.uniforms.add(new m.Float2PassUniform("size",w=>w.size));A.vvSize?(t.uniforms.add(new n.Float3PassUniform("vvSizeMinSize",w=>w.vvSizeMinSize)),t.uniforms.add(new n.Float3PassUniform("vvSizeMaxSize",w=>w.vvSizeMaxSize)),t.uniforms.add(new n.Float3PassUniform("vvSizeOffset",w=>w.vvSizeOffset)),t.uniforms.add(new n.Float3PassUniform("vvSizeFactor",w=>w.vvSizeFactor)),t.code.add(h.glsl`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):t.code.add(h.glsl`vec2 getSize(){
return size;
}`);A.vvOpacity?(t.constants.add("vvOpacityNumber","int",8),t.uniforms.add([new g.FloatsPassUniform("vvOpacityValues",w=>w.vvOpacityValues,8),new g.FloatsPassUniform("vvOpacityOpacities",w=>w.vvOpacityOpacities,8)]),t.code.add(h.glsl`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):t.code.add(h.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);A.vvColor?(t.constants.add("vvColorNumber","int",f.vvColorNumber),t.uniforms.add([new g.FloatsPassUniform("vvColorValues",w=>w.vvColorValues,f.vvColorNumber),new p.Float4sPassUniform("vvColorColors",w=>w.vvColorColors,f.vvColorNumber)]),t.code.add(h.glsl`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):t.code.add(h.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);l.include(r.PositionAttribute);l.attributes.add(d.VertexAttribute.PROFILERIGHT,"vec4");l.attributes.add(d.VertexAttribute.PROFILEUP,"vec4");l.attributes.add(d.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");t.code.add(h.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);t.code.add(h.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);t.code.add(h.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);t.code.add(h.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k){function q(v){const D=new C.ShaderBuilder,{vertex:F,fragment:G}=D;u.addProjViewLocalOrigin(F,v);D.varyings.add("vpos","vec3");D.include(n.PathVertexPosition,v);if(v.output===c.ShaderOutput.Color||v.output===c.ShaderOutput.Alpha)D.include(m.Transform,v),D.include(t.ReadShadowMapDraw,v),D.include(b.ForwardLinearDepth,v),D.varyings.add("vnormal","vec3"),D.varyings.add("vcolor","vec4"),v.hasMultipassTerrain&&D.varyings.add("depth","float"),F.code.add(B.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${v.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${v.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);D.include(e.multipassTerrainTest,v);switch(v.output){case c.ShaderOutput.Alpha:D.include(r.SliceDraw,v);G.uniforms.add(new y.FloatPassUniform("opacity",J=>J.opacity));G.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case c.ShaderOutput.Color:D.include(r.SliceDraw,v);D.include(d.EvaluateSceneLighting,v);D.include(h.EvaluateAmbientOcclusion,v);D.include(t.ReadShadowMapDraw,v);D.include(l.Normals,v);u.addCameraPosition(G,v);d.addAmbientBoostFactor(G);d.addLightingGlobalFactor(G);G.uniforms.add([F.uniforms.get("localOrigin"),new z.Float3PassUniform("ambient",J=>J.ambient),new z.Float3PassUniform("diffuse",J=>J.diffuse),new z.Float3PassUniform("specular",J=>J.specular),new y.FloatPassUniform("opacity",
J=>J.opacity)]);G.include(w.ColorConversion);f.addMainLightIntensity(G);G.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${v.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":v.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${v.transparencyPassType===k.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExludeHighlight:D.include(m.Transform,v);b.addNearFar(D);D.varyings.add("depth","float");F.code.add(B.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);D.include(r.SliceDraw,v);D.include(p.OutputDepth,v);G.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case c.ShaderOutput.Normal:D.include(m.Transform,v);D.include(A.NormalUtils,v);u.addViewNormal(F);D.varyings.add("vnormal","vec3");F.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);D.include(r.SliceDraw,v);G.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case c.ShaderOutput.Highlight:D.include(m.Transform,v),D.include(A.NormalUtils,v),D.varyings.add("vnormal","vec3"),F.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),D.include(r.SliceDraw,v),D.include(g.OutputHighlight,v),G.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return D}const x=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.Path=x;a.build=q})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G){const J=["polyline","polygon","extent"];t=function(P){function N(E,I,M,Q){E=P.call(this,E,I,M,Q)||this;E._needsUV=!1;E._hasOutline=!1;return E}b._inheritsLoose(N,P);var H=N.prototype;H.doLoad=function(){var E=b._asyncToGenerator(function*(){});return function(){return E.apply(this,arguments)}}();H._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};H._ensureFillMaterial=function(){if(!r.isSome(this._material)){var E=
r.get(this.symbolLayer,"material","color");E=this._getCombinedOpacityAndColor(E);this._material=y.createMaterial(this.symbolLayer,{color:E,transparent:1>E[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof F.PatternMaterial;this._context.stage.add(this._material)}};H._ensureOutlineMaterial=function(){const E=this.symbolLayer.outline;!r.isSome(this._outlineMaterial)&&
this._isValidOutline(E)&&(this._hasOutline=!0,this._outlineMaterial=(I=>{const M=D.getStipplePatternForLinePattern(E.pattern);return new G.RibbonLineMaterial({width:I,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:M,stippleScaleWithLineWidth:!0,cap:u.parseCapType(E.patternCap||"butt")})})(m.pt2px(E.size)),this._context.stage.add(this._outlineMaterial))};H._isValidOutline=function(E){return r.isSome(E)&&E.size&&0<E.size&&r.isSome(E.color)&&
(r.isNone(E.pattern)||"style"!==E.pattern.type||"none"!==E.pattern.style)};H.destroy=function(){P.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};H.createGraphics3DGraphic=function(E){const I=E.graphic;if(!this._validateGeometry(I.geometry,J,this.symbolLayer.type))return null;E=this._getVertexOpacityAndColor(E.renderingInfo,255);const M=this.setGraphicElevationContext(I,new e.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===M.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(I,E):this._createAs3DShape(I,E,M)};H.layerOpacityChanged=function(){if(r.isSome(this._material)){var E=this._material.parameters.color,I=r.get(this.symbolLayer,"material","color");I=this._getCombinedOpacity(I);this._material.setParameters({color:[E[0],E[1],E[2],I],transparent:1>I||this.needsDrivenTransparentPass})}r.isSome(this._outlineMaterial)&&(E=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[E[0],E[1],E[2],this._getOutlineOpacity()]}))};H.layerElevationInfoChanged=function(E,I,M){const Q=this._elevationContext.mode;M=f.elevationModeChangeUpdateType(N.elevationModeChangeTypes,M,Q);if(M!==f.SymbolUpdateType.UPDATE)return M;const T=f.needsElevationUpdates2D(Q);return this.updateGraphics3DGraphicElevationInfo(E,I,()=>T)};H.slicePlaneEnabledChanged=function(){r.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
r.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.pixelRatioChanged=function(){return!0};H._createAs3DShape=function(E,I,M){const Q=z.geometryAsPolygon(E.geometry);if(r.isNone(Q))return null;var T=k.geometryToRenderInfo(Q,this._context.elevationProvider,this._context.renderCoordsHelper,M);I=new K(T,I,this._context.layer.uid,E.uid);T=I.renderData.position.length/3;this._needsUV&&
(I.uvMapSpace=new Float32Array(4*T),I.boundingRect=new Float64Array(9*T));I.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:I.graphicsUid,layerUid:I.layerUid});this._createAs3DShapeFill(I);this._hasOutline&&this._createAs3DShapeOutline(I);this._logGeometryCreationWarnings(I.renderData,Q.rings,"rings","FillSymbol3DLayer");if(0===I.outGeometries.length)return null;this._needsUV&&B.createMapSpaceUVCoords(d.BufferViewVec4f.fromTypedArray(I.uvMapSpace),d.BufferViewVec3f64.fromTypedArray(I.renderData.position),
this._context.renderCoordsHelper,d.BufferViewMat3f64.fromTypedArray(I.boundingRect));E=new q.Object3D({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:E.uid}});E=new A.Graphics3DObject3DGraphicLayer(this,E,I.outGeometries,null,null,y.uvElevationAligner,M);E.alignedSampledElevation=I.renderData.sampledElevation;E.needsElevationUpdates=f.needsElevationUpdates2D(M.mode);return E};H._createAs3DShapeFill=
function(E){var I=E.renderData.polygons;for(const {position:M,mapPosition:Q,holeIndices:T,index:S,count:U}of I){if(r.isSome(this._context.clippingExtent)&&(h.empty(L),h.expandWithBuffer(L,Q),!h.intersectsClippingArea(L,this._context.clippingExtent)))continue;I=n.earcut(Q,T,3);0!==I.length&&(I=z.createColorGeometry({indices:I,attributeData:{position:M,color:E.color,mapPosition:Q,uvMapSpace:this._needsUV?new Float32Array(E.uvMapSpace.buffer,4*S*E.uvMapSpace.BYTES_PER_ELEMENT,4*U):null,boundingRect:this._needsUV?
new Float64Array(E.boundingRect.buffer,9*S*E.boundingRect.BYTES_PER_ELEMENT,9*U):null,objectAndLayerIdColor:E.objectAndLayerIdColor}}),E.outGeometries.push(I),E.outMaterials.push(r.unwrap(this._material)),E.outTransforms.push(p.IDENTITY))}};H._createAs3DShapeOutline=function(E){if(this._hasOutline){var I=E.renderData.outlines;for(let M=0;M<I.length;++M){const {mapPosition:Q,position:T}=I[M];if(r.isSome(this._context.clippingExtent)&&(h.empty(L),h.expandWithBuffer(L,Q),!h.intersectsClippingArea(L,
this._context.clippingExtent)))continue;const S=C.createGeometry({overlayInfo:null,removeDuplicateStartEnd:!0,attributeData:{position:T,mapPosition:Q}},E.objectAndLayerIdColor),U=S.vertexAttributes.get(v.VertexAttribute.POSITION);U.data===T&&(U.data=new Float64Array(T));E.outGeometries.push(S);E.outMaterials.push(r.unwrap(this._outlineMaterial));E.outTransforms.push(p.IDENTITY)}}};H._createAsOverlay=function(E,I){const M=z.geometryAsPolygon(E.geometry);if(r.isNone(M))return null;r.unwrap(this._material).renderPriority=
this._renderPriority+this._renderPriorityStep/2;r.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const Q=k.geometryToRenderInfoDraped(M,this._context.overlaySR);E=new O(Q,I,this._context.layer.uid,E.uid);I=E.renderData.position.length/3;this._needsUV&&(E.uvMapSpace=new Float32Array(4*I));E.outBoundingBox=h.empty();E.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:E.graphicsUid,layerUid:E.layerUid});this._createAsOverlayFill(E);
this._hasOutline&&this._createAsOverlayOutline(E);this._logGeometryCreationWarnings(E.renderData,M.rings,"rings","FillSymbol3DLayer");if(0===E.outGeometries.length)return null;this._needsUV&&B.createMapSpaceUVCoordsDraped(d.BufferViewVec4f.fromTypedArray(E.uvMapSpace),d.BufferViewVec3f64.fromTypedArray(E.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return new l(this,E.outGeometries,E.outBoundingBox,this._context.drapeSourceRenderer)};H._createAsOverlayFill=
function(E){var I=E.renderData.polygons;for(const {position:M,holeIndices:Q,index:T,count:S}of I){h.empty(L);h.expandWithBuffer(L,M);if(!h.intersectsClippingArea(L,this._context.clippingExtent))continue;I=n.earcut(M,Q,3);if(0===I.length)continue;h.expandWithAABB(E.outBoundingBox,L);I=z.createColorGeometry({indices:I,attributeData:{position:M,color:E.color,uvMapSpace:this._needsUV?new Float32Array(E.uvMapSpace.buffer,4*T*E.uvMapSpace.BYTES_PER_ELEMENT,4*S):null,objectAndLayerIdColor:E.objectAndLayerIdColor}});
I=new x.RenderGeometry(I,r.unwrap(this._material),{layerUid:E.layerUid,graphicUid:E.graphicsUid});const U=L;g.set(I.boundingSphere,.5*(U[0]+U[3]),.5*(U[1]+U[4]),0,.5*Math.sqrt((U[3]-U[0])*(U[3]-U[0])+(U[4]-U[1])*(U[4]-U[1])));E.outGeometries.push(I)}};H._createAsOverlayOutline=function(E){if(this._hasOutline){var I=E.renderData.outlines;for(let Q=0;Q<I.length;++Q){var {position:M}=I[Q];h.empty(L);h.expandWithBuffer(L,M);if(!h.intersectsClippingArea(L,this._context.clippingExtent))continue;h.expandWithAABB(E.outBoundingBox,
L);M=C.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:M}},E.objectAndLayerIdColor);M=new x.RenderGeometry(M,r.unwrap(this._outlineMaterial),{layerUid:E.layerUid,graphicUid:E.graphicsUid});const T=L;g.set(M.boundingSphere,.5*(T[0]+T[3]),.5*(T[1]+T[4]),0,.5*Math.sqrt((T[3]-T[0])*(T[3]-T[0])+(T[4]-T[1])*(T[4]-T[1])));E.outGeometries.push(M)}}};H._getOutlineOpacity=function(){const E=
r.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(r.isSome(E)?E.a:0)};H._getOutlineColor=function(){const E=r.get(this.symbolLayer,"outline","color"),I=this._getOutlineOpacity();return w.mixinColorAndOpacity(r.isSome(E)?c.toUnitRGB(E):null,I)};H.test=function(){return{...P.prototype.test.call(this),createAsOverlay:(E,I)=>this._createAsOverlay(E,I),createAs3DShape:(E,I,M)=>this._createAs3DShape(E,I,M)}};return N}(t.Graphics3DSymbolLayer);t.elevationModeChangeTypes=
{definedChanged:f.SymbolUpdateType.RECREATE,staysOnTheGround:f.SymbolUpdateType.NONE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const L=h.create();let K=function(P){function N(H,E,I,M){H=P.call(this,H,I,M)||this;H.color=E;return H}b._inheritsLoose(N,P);return N}(z.PolygonCreationDataBase),O=function(P){function N(H,E,I,M){H=P.call(this,H,I,M)||this;H.color=E;return H}b._inheritsLoose(N,P);return N}(z.PolygonCreationDataBase);a.Graphics3DPolygonFillSymbolLayer=t;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){function e(w,u,z){if(c.isSome(w)){if("none"===
w.style||"solid"===w.style)return"none"===w.style&&(u.color=r.fromValues(0,0,0,0),u.transparent=!0),new h.ColorMaterial(u);u.style=l(w.style);u.draped=z.isDraped;return new d.PatternMaterial(u)}return new h.ColorMaterial(u)}function l(w){switch(w){case "horizontal":return f.Style.Horizontal;case "vertical":return f.Style.Vertical;case "cross":return f.Style.Cross;case "forward-diagonal":return f.Style.ForwardDiagonal;case "backward-diagonal":return f.Style.BackwardDiagonal;case "diagonal-cross":return f.Style.DiagonalCross}}
function A(w){return w.material instanceof d.PatternMaterial&&!w.material.parameters.draped}function t(w,u){if(A(w)){var z=w.geometry.vertexAttributes;w=z.get(g.VertexAttribute.POSITION).data;const y=z.get(g.VertexAttribute.UVMAPSPACE).data;z=z.get(g.VertexAttribute.BOUNDINGRECT).data;p.createMapSpaceUVCoords(m.BufferViewVec4f.fromTypedArray(y),m.BufferViewVec3f64.fromTypedArray(w),u,m.BufferViewMat3f64.fromTypedArray(z))}}a.createMaterial=function(w,u,z){return e(w&&w.pattern||null,u,z)};a.createMaterialFromPattern=
e;a.parsePatternStyle=l;a.requiresUVUpdates=A;a.updateMapSpaceUVCoords=t;a.uvElevationAligner=function(w,u,z,y){u=n.perVertexElevationAligner(w,u,z,y);w=w.stageObject.geometryRecords;for(z=0;z<w.length;z++)t(w[z],y);return u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../../../ViewingMode".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(K,O,P,N,H,E,I){n.set(K,O*H[0]+P*E[0]+N*I[0],O*H[1]+P*E[1]+N*I[1],O*H[2]+P*E[2]+N*I[2])}const A=p.create(),t=p.create(),w=d.create(),u=p.create(),z=p.create(),y=p.create(),B=m.create(),C=m.create(),k=m.create(),q=p.create(),x=p.create(),v=p.create(),D=c.create(),F=p.create(),G=p.create(),J=p.create(),L=p.create();a.createMapSpaceUVCoords=function(K,O,P,N,H=1){n.set(u,1,0,0);n.set(z,0,1,0);n.set(y,0,0,1);n.set(L,0,0,0);for(var E=0;E<O.count-1;E++)O.getVec(E,
t),n.add(L,L,t);n.scale(A,L,1/(O.count-1));E=O.count-1;if(d.fromManyPointsSampleAt(O,w,0,Math.floor(E/3),Math.floor(2/3*E))){b.isSome(P)?(P.basisMatrixAtPosition(A,D),n.set(F,D[0],D[1],D[2]),n.set(G,D[4],D[5],D[6]),n.set(J,D[8],D[9],D[10])):(n.set(F,1,0,0),n.set(G,0,1,0),n.set(J,0,0,1));P=d.normal(w);0>n.dot(P,J)&&n.scale(P,P,-1);n.copy(y,P);E=n.dot(P,G);var I=n.dot(P,F);Math.abs(E)<Math.abs(I)?(n.scaleAndAdd(u,F,P,-I),n.normalize(u,u),n.cross(z,u,P),n.normalize(z,z),n.scale(z,z,-1)):(n.scaleAndAdd(z,
G,P,-E),n.normalize(z,z),n.cross(u,z,P),n.normalize(u,u))}r.set(B,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);r.set(C,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(P=0;P<O.count;P++)O.getVec(P,t),E=n.dot(u,t),I=n.dot(z,t),B[0]=Math.min(B[0],E),B[1]=Math.min(B[1],I),C[0]=Math.max(C[0],E),C[1]=Math.max(C[1],I);P=n.dot(y,A);l(q,B[0],B[1],P,u,z,y);l(x,C[0],B[1],P,u,z,y);l(v,B[0],C[1],P,u,z,y);n.subtract(x,x,q);n.scale(x,x,.5);n.subtract(v,v,q);n.scale(v,v,.5);n.add(q,q,x);n.add(q,q,v);
P=B[1]%H;k[0]=B[0]-B[0]%H;k[1]=B[1]-P;for(P=0;P<O.count;P++)for(O.getVec(P,t),K.setValues(P,(n.dot(u,t)-k[0])/H,(n.dot(z,t)-k[1])/H,k[0]/H,k[1]/H),E=0;3>E;E++)N.set(P,E,q[E]),N.set(P,E+3,x[E]),N.set(P,E+6,v[E])};a.createMapSpaceUVCoordsDraped=function(K,O,P,N,H=1){if(P.isGeographic&&N===e.ViewingMode.Global){N=new Float64Array(O.typedBuffer.length);const E=3*O.count;P=h.getReferenceEllipsoid(P);for(let I=0;I<E;I+=3)g.lonLatToWebMercatorComparable(O.typedBuffer,I,N,I,P);O=f.BufferViewVec3f64.fromTypedArray(N)}r.set(B,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(N=0;N<O.count;N++)O.getVec(N,t),B[0]=Math.min(B[0],t[0]),B[1]=Math.min(B[1],t[1]);N=B[1]%H;k[0]=B[0]-B[0]%H;k[1]=B[1]-N;for(N=0;N<O.count;N++)O.getVec(N,t),K.setValues(N,(t[0]-k[0])/H,(t[1]-k[1])/H,k[0]/H,k[1]/H)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(z){function y(C){C=z.call(this,C,new u)||this;C.supportsEdges=!0;C._configuration=new A.ColorMaterialTechniqueConfiguration;return C}b._inheritsLoose(y,z);var B=y.prototype;B.getConfiguration=function(C,k){this._configuration.output=C;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=k.transparencyPassType;this._configuration.enableOffset=k.camera.relativeElevation<h.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=k.multipassTerrain.enabled;this._configuration.cullAboveGround=k.multipassTerrain.cullAboveGround;return this._configuration};
B.intersect=function(C,k,q,x,v,D,F){e.intersectTriangleGeometry(C,k,x,v,D,void 0,F)};B.requiresSlot=function(C,k){return k===m.ShaderOutput.Color||k===m.ShaderOutput.Alpha||k===m.ShaderOutput.Highlight||k===m.ShaderOutput.Depth&&this.parameters.writeLinearDepth||k===m.ShaderOutput.ObjectAndLayerIdColor?C===d.RenderSlot.DRAPED_MATERIAL?!0:k===m.ShaderOutput.Highlight?C===d.RenderSlot.OPAQUE_MATERIAL:C===(this.parameters.transparent?this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:
d.RenderSlot.OPAQUE_MATERIAL):!1};B.createGLMaterial=function(C){return new w(C)};B.createBufferWriter=function(){return new f.DefaultBufferWriter(c("enable-feature:objectAndLayerId-rendering")?f.PositionColorLayoutObjectAndLayerId:f.PositionColorLayout)};return y}(g.Material),w=function(z){function y(){return z.apply(this,arguments)||this}b._inheritsLoose(y,z);var B=y.prototype;B._updateOccludeeState=function(C){C.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:C.hasOccludees})};
B.beginSlot=function(C){this._output!==m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(C);return this.ensureTechnique(l.ColorMaterialTechnique,C)};return y}(p),u=function(z){function y(){var B=z.apply(this,arguments)||this;B.color=r.ZEROS;B.transparent=!1;B.writeDepth=!0;B.writeLinearDepth=!1;B.hasVertexColors=!1;B.polygonOffset=!1;B.hasSlicePlane=!1;B.cullFace=n.CullFaceOptions.None;B.hasOccludees=!1;return B}b._inheritsLoose(y,z);return y}(g.MaterialParameters);
a.ColorMaterial=t;a.Parameters=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/ColorMaterial.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){n=function(w){function u(){return w.apply(this,arguments)||this}c._inheritsLoose(u,w);var z=u.prototype;z.initializeConfiguration=function(y,B){B.hasWebGL2Context=y.rctx.type===l.ContextType.WEBGL2};z.initializeProgram=function(y){return new h.Program(y.rctx,u.shader.get().build(this.configuration),p.Default3D)};z._createPipeline=function(y,B){const C=this.configuration,k=y===f.TransparencyPassType.NONE,q=y===f.TransparencyPassType.FrontFace;return A.makePipelineState({blending:C.output!==
r.ShaderOutput.Color&&C.output!==r.ShaderOutput.Alpha||!C.transparent?null:k?g.blendingDefault:g.oitBlending(y),culling:A.cullingParams(C.cullFace),depthTest:{func:g.oitDepthTest(y)},depthWrite:k||q?C.writeDepth&&A.defaultDepthWriteParams:null,colorWrite:A.defaultColorWriteParams,stencilWrite:C.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?B?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:k||q?C.polygonOffset&&t:g.getOITPolygonOffset(C.enableOffset)})};
z.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};z.getPipelineState=function(y,B){return B?this._occludeePipelineState:w.prototype.getPipelineState.call(this,y,B)};return u}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(e.ColorMaterial,()=>new Promise((w,u)=>a(["./ColorMaterial.glsl"],w,u)));const t={factor:1,units:1};b.ColorMaterialTechnique=
n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){function y(C){const k=new w.ShaderBuilder,{vertex:q,fragment:x}=k,v=C.output===c.ShaderOutput.Depth,D=C.hasMultipassTerrain&&(C.output===c.ShaderOutput.Color||C.output===c.ShaderOutput.Alpha);l.addProjViewLocalOrigin(q,C);k.include(m.Transform,C);k.include(p.VertexColor,C);k.include(n.ObjectAndLayerIdColor,C);k.attributes.add(z.VertexAttribute.POSITION,"vec3");k.varyings.add("vpos","vec3");D&&k.varyings.add("depth","float");v&&(k.include(g.OutputDepth,
C),b.addNearFar(k),b.addLinearDepth(k));q.code.add(t.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${D?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${v?t.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:t.glsl`transformPosition(proj, view, vpos);`}
    }
  `);k.include(r.SliceDraw,C);D&&k.include(d.multipassTerrainTest,C);x.include(e.ColorConversion);x.uniforms.add(new A.Float4PassUniform("eColor",F=>F.color));C.output===c.ShaderOutput.Highlight&&k.include(h.OutputHighlight,C);x.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${D?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${C.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${t.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${C.output===c.ShaderOutput.Alpha?t.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${C.output===c.ShaderOutput.Color?t.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${C.transparencyPassType===u.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${C.output===c.ShaderOutput.Highlight?t.glsl`outputHighlight();`:""};
    ${C.output===c.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""};
    ${C.output===c.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return k}const B=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=B;a.build=y})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g){g=function(h){function d(){var f=h.apply(this,arguments)||this;f.output=r.ShaderOutput.Color;f.cullFace=n.CullFaceOptions.None;f.hasSlicePlane=!1;f.hasVertexColors=!1;f.transparent=!1;f.polygonOffset=!1;f.enableOffset=!0;f.writeDepth=!0;f.hasOccludees=!1;f.transparencyPassType=p.TransparencyPassType.NONE;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;f.objectAndLayerIdColorInstanced=!1;return f}b._inheritsLoose(d,h);return d}(g.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.ShaderOutput.COUNT})],
g.prototype,"output",void 0);c.__decorate([m.parameter({count:n.CullFaceOptions.COUNT})],g.prototype,"cullFace",void 0);c.__decorate([m.parameter()],g.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],g.prototype,"hasVertexColors",void 0);c.__decorate([m.parameter()],g.prototype,"transparent",void 0);c.__decorate([m.parameter()],g.prototype,"polygonOffset",void 0);c.__decorate([m.parameter()],g.prototype,"enableOffset",void 0);c.__decorate([m.parameter()],g.prototype,"writeDepth",void 0);
c.__decorate([m.parameter()],g.prototype,"hasOccludees",void 0);c.__decorate([m.parameter({count:p.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",void 0);c.__decorate([m.parameter()],g.prototype,"hasMultipassTerrain",void 0);c.__decorate([m.parameter()],g.prototype,"cullAboveGround",void 0);c.__decorate([m.parameter()],g.prototype,"objectAndLayerIdColorInstanced",void 0);a.ColorMaterialTechniqueConfiguration=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PatternStyle ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){let y=function(q){function x(D){D=q.call(this,D,new k)||this;D.supportsEdges=!0;D._vertexAttributeLocations=z.vertexAttributeLocations;D._configuration=new z.PatternTechniqueConfiguration;return D}b._inheritsLoose(x,q);var v=x.prototype;v.getConfiguration=function(D,F){this._configuration.output=D;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=F.transparencyPassType;this._configuration.enableOffset=F.camera.relativeElevation<d.OITPolygonOffsetLimit;
this._configuration.hasMultipassTerrain=F.multipassTerrain.enabled;this._configuration.cullAboveGround=F.multipassTerrain.cullAboveGround;return this._configuration};v.intersect=function(D,F,G,J,L,K,O){u.intersectTriangleGeometry(D,F,J,L,K,void 0,O)};v.requiresSlot=function(D,F){return F===n.ShaderOutput.Color||F===n.ShaderOutput.Alpha||F===n.ShaderOutput.Highlight||F===n.ShaderOutput.Depth&&this.parameters.writeLinearDepth?D===f.RenderSlot.DRAPED_MATERIAL?!0:F===n.ShaderOutput.Highlight?D===f.RenderSlot.OPAQUE_MATERIAL:
D===(this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1};v.createGLMaterial=function(D){return new B(D)};v.createBufferWriter=function(){const D=m.newLayout().vec3f(l.VertexAttribute.POSITION).vec4u8(l.VertexAttribute.COLOR).vec4f(l.VertexAttribute.UVMAPSPACE);this.parameters.draped||D.mat3f(l.VertexAttribute.BOUNDINGRECT);return new C(D)};return x}(h.Material),B=function(q){function x(){return q.apply(this,arguments)||this}b._inheritsLoose(x,
q);var v=x.prototype;v._updateParameters=function(D){return this.ensureTechnique(z.PatternTechnique,D)};v._updateOccludeeState=function(D){D.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:D.hasOccludees})};v.beginSlot=function(D){this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(D);return this._updateParameters(D)};return x}(g),C=function(q){function x(){return q.apply(this,arguments)||this}b._inheritsLoose(x,
q);var v=x.prototype;v.write=function(D,F,G,J,L){for(const O of this.vertexBufferLayout.fieldNames){F=G.vertexAttributes.get(O);const P=G.indices.get(O);if(F&&P)switch(O){case l.VertexAttribute.POSITION:e.assert(3===F.size);var K=J.getField(O,r.BufferViewVec3f);K&&t.writePosition(P,F.data,D,K,L);break;case l.VertexAttribute.COLOR:e.assert(3===F.size||4===F.size);(K=J.getField(O,r.BufferViewVec4u8))&&t.writeColor(P,F.data,F.size,K,L);break;case l.VertexAttribute.UVMAPSPACE:e.assert(4===F.size);(K=
J.getField(O,r.BufferViewVec4f))&&t.writeBufferVec4(P,F.data,K,L);break;case l.VertexAttribute.BOUNDINGRECT:e.assert(9===F.size),(K=J.getField(O,r.BufferViewMat3f))&&this.writeBoundingRect(P,F.data,D,K,L)}}};v.writeBoundingRect=function(D,F,G,J,L){const K=J.typedBuffer;J=J.typedBufferStride;const O=D.length;L*=J;for(let N=0;N<O;++N){const H=9*D[N];var P=F[H];const E=F[H+1],I=F[H+2];K[L]=G[0]*P+G[4]*E+G[8]*I+G[12];K[L+1]=G[1]*P+G[5]*E+G[9]*I+G[13];K[L+2]=G[2]*P+G[6]*E+G[10]*I+G[14];for(P=3;9>P;++P)K[L+
P]=F[H+P];L+=J}};return x}(w.DefaultBufferWriter),k=function(q){function x(){var v=q.apply(this,arguments)||this;v.color=c.fromValues(1,1,1,1);v.writeDepth=!0;v.writeLinearDepth=!1;v.hasVertexColors=!1;v.polygonOffset=!1;v.hasSlicePlane=!1;v.cullFace=p.CullFaceOptions.None;v.hasOccludees=!1;v.style=A.Style.Cross;v.patternSpacing=10;v.lineWidth=1;v.draped=!0;return v}b._inheritsLoose(x,q);return x}(h.MaterialParameters);a.Parameters=k;a.PatternMaterial=y;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){p=function(k){function q(){return k.apply(this,arguments)||this}c._inheritsLoose(q,k);var x=q.prototype;x.initializeConfiguration=function(v,D){D.hasWebGL2Context=v.rctx.type===z.ContextType.WEBGL2};x.initializeProgram=function(v){return new f.Program(v.rctx,q.shader.get().build(this.configuration),C)};x._setPipelineState=function(v,D){const F=this.configuration,G=v===l.TransparencyPassType.NONE,J=v===l.TransparencyPassType.FrontFace;return y.makePipelineState({blending:F.output===
m.ShaderOutput.Color||F.output===m.ShaderOutput.Alpha?G?d.blendingDefault:d.oitBlending(v):null,culling:y.cullingParams(F.cullFace),depthTest:{func:d.oitDepthTest(v)},depthWrite:G?F.writeDepth&&y.defaultDepthWriteParams:d.oitDepthWrite(v),colorWrite:y.defaultColorWriteParams,stencilWrite:F.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:F.hasOccludees?D?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:G||J?F.polygonOffset&&B:d.getOITPolygonOffset(F.enableOffset)})};x.initializePipeline=
function(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};x.getPipelineState=function(v,D){return D?this._occludeePipelineState:k.prototype.getPipelineState.call(this,v,D)};return q}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(u.Pattern,()=>new Promise((k,q)=>a(["./Pattern.glsl"],k,q)));const B={factor:1,units:1};n=function(k){function q(){var x=k.apply(this,arguments)||
this;x.output=m.ShaderOutput.Color;x.cullFace=h.CullFaceOptions.None;x.transparencyPassType=l.TransparencyPassType.NONE;x.hasSlicePlane=!1;x.hasVertexColors=!1;x.polygonOffset=!1;x.writeDepth=!0;x.hasOccludees=!1;x.enableOffset=!0;x.hasMultipassTerrain=!1;x.cullAboveGround=!1;return x}c._inheritsLoose(q,k);return q}(t.DefaultTechniqueConfiguration);r.__decorate([g.parameter({count:m.ShaderOutput.COUNT})],n.prototype,"output",void 0);r.__decorate([g.parameter({count:h.CullFaceOptions.COUNT})],n.prototype,
"cullFace",void 0);r.__decorate([g.parameter({count:w.Style.COUNT})],n.prototype,"style",void 0);r.__decorate([g.parameter({count:l.TransparencyPassType.COUNT})],n.prototype,"transparencyPassType",void 0);r.__decorate([g.parameter()],n.prototype,"hasSlicePlane",void 0);r.__decorate([g.parameter()],n.prototype,"hasVertexColors",void 0);r.__decorate([g.parameter()],n.prototype,"polygonOffset",void 0);r.__decorate([g.parameter()],n.prototype,"writeDepth",void 0);r.__decorate([g.parameter()],n.prototype,
"hasOccludees",void 0);r.__decorate([g.parameter()],n.prototype,"patternSpacing",void 0);r.__decorate([g.parameter()],n.prototype,"lineWidth",void 0);r.__decorate([g.parameter()],n.prototype,"enableOffset",void 0);r.__decorate([g.parameter()],n.prototype,"draped",void 0);r.__decorate([g.parameter()],n.prototype,"hasMultipassTerrain",void 0);r.__decorate([g.parameter()],n.prototype,"cullAboveGround",void 0);const C=new Map([[A.VertexAttribute.POSITION,0],[A.VertexAttribute.COLOR,3],[A.VertexAttribute.UVMAPSPACE,
4],[A.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=p;b.PatternTechniqueConfiguration=n;b.vertexAttributeLocations=C;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){function B(q){const x=new w.ShaderBuilder,v=q.hasMultipassTerrain&&(q.output===c.ShaderOutput.Color||q.output===c.ShaderOutput.Alpha);q.draped||x.extensions.add("GL_OES_standard_derivatives");const {vertex:D,fragment:F}=x;e.addProjViewLocalOrigin(D,q);x.include(m.Transform,q);x.include(n.VertexColor,q);q.draped?D.uniforms.add(new A.FloatPassUniform("worldToScreenRatio",(J,L)=>1/L.screenToPCSRatio)):x.attributes.add(z.VertexAttribute.BOUNDINGRECT,"mat3");
x.attributes.add(z.VertexAttribute.POSITION,"vec3");x.attributes.add(z.VertexAttribute.UVMAPSPACE,"vec4");x.varyings.add("vpos","vec3");x.varyings.add("vuv","vec2");v&&x.varyings.add("depth","float");var G=q.style===y.Style.ForwardDiagonal||q.style===y.Style.BackwardDiagonal||q.style===y.Style.DiagonalCross;G&&D.code.add(t.glsl`
      const mat2 rotate45 = mat2(${t.glsl.float(.70710678118)}, ${t.glsl.float(-.70710678118)},
                                 ${t.glsl.float(.70710678118)}, ${t.glsl.float(.70710678118)});
    `);q.draped||(e.addCameraPosition(D,q),D.uniforms.add(new A.FloatPassUniform("worldToScreenPerDistanceRatio",(J,L)=>1/L.camera.perScreenPixelRatio)),D.code.add(t.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),D.code.add(t.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),D.code.add(t.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${t.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));D.code.add(t.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${G?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${G?" * rotate45":""};

      ${q.draped?"":t.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${t.glsl.float(q.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(G=q.output===c.ShaderOutput.Depth)x.include(p.OutputDepth,q),b.addNearFar(x),b.addLinearDepth(x);D.code.add(t.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${v?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${G?t.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:t.glsl`transformPosition(proj, view, vpos);`}
    }
  `);x.include(r.SliceDraw,q);F.include(f.ColorConversion);q.draped&&F.uniforms.add(new A.FloatPassUniform("texelSize",(J,L)=>1/L.camera.pixelRatio));q.output===c.ShaderOutput.Highlight&&x.include(g.OutputHighlight,q);v&&x.include(h.multipassTerrainTest,q);q.output!==c.ShaderOutput.Highlight&&(F.code.add(t.glsl`
      const float lineWidth = ${t.glsl.float(q.lineWidth)};
      const float spacing = ${t.glsl.float(q.patternSpacing)};
      const float spacingINV = ${t.glsl.float(1/q.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),q.draped||F.code.add(t.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.uniforms.add(new l.Float4PassUniform("uColor",J=>J.color));F.code.add(t.glsl`
    void main() {
      discardBySlice(vpos);
      ${v?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${q.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${q.output!==c.ShaderOutput.Highlight?t.glsl`color.a *= ${C(q)};`:""}

      if (color.a < ${t.glsl.float(d.symbolAlphaCutoff)}) {
        discard;
      }

      ${q.output===c.ShaderOutput.Alpha?t.glsl`gl_FragColor = vec4(color.a);`:""}

      ${q.output===c.ShaderOutput.Color?t.glsl`gl_FragColor = color; ${q.transparencyPassType===u.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${q.output===c.ShaderOutput.Highlight?t.glsl`outputHighlight();`:""}
      ${q.output===c.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""};
    }
  `);return x}function C(q){function x(v){return q.draped?t.glsl`coverage(vuv.${v}, texelSize)`:t.glsl`sample(vuv.${v})`}switch(q.style){case y.Style.ForwardDiagonal:case y.Style.Horizontal:return x("y");case y.Style.BackwardDiagonal:case y.Style.Vertical:return x("x");case y.Style.DiagonalCross:case y.Style.Cross:return t.glsl`
        1.0 - (1.0 - ${x("x")}) * (1.0 - ${x("y")})
      `;default:return"0.0"}}const k=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.Pattern=k;a.build=B})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){function C(D,F,G){D&&D.forEach(J=>{const L=F(J);r.isSome(L)&&G(L,J.graphic)})}function k(D,F){if("baseline"===F.verticalPlacement)return F=t.horizontalPlacementToAnchorX[F.horizontalPlacement],D=r.isSome(D)?D.baselineAnchorY:0,p.fromValues(F,D);D=t.anchorFromPlacements(F.horizontalPlacement,F.verticalPlacement);return t.namedAnchorToHUDMaterialAnchorPos[D]}const q=[0,0,1];l=function(D){function F(J,L,K,O){J=D.call(this,J,L,K,O)||this;J._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};J.ensureDrapedStatus(!1);return J}b._inheritsLoose(F,D);var G=F.prototype;G.doLoad=function(){var J=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){const L=A.validateSymbolLayerSize(this.symbolLayer.size);if(L)throw new c("graphics3dtextsymbollayer:invalid-size",L);}yield this._createTextRenderParameters()});return function(){return J.apply(this,arguments)}}();G._createTextRenderParameters=function(){var J=b._asyncToGenerator(function*(){this._textRenderParameters=
yield z.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.pixelRatio)});return function(){return J.apply(this,arguments)}}();G.destroy=function(){D.prototype.destroy.call(this)};G.createGraphics3DGraphic=function(J){J=J.graphic;const L=w.placePointOnGeometry(J.geometry);if(r.isNone(L))return this.logger.warn(`unsupported geometry type for text symbol: ${J.geometry.type}`),null;const K=this.symbolLayer.text;if(r.isNone(K)||""===K)return null;var O=g.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(r.isSome(O)&&!g.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;O={...v,verticalOffset:O,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:t.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment)};
return this._createAs3DShape(J,L,K,O)};G.createLabel=function(J,L,K,O){J=J.graphic;const P=w.placePointOnGeometry(J.geometry);if(r.isNone(P))return this.logger.warn(`unsupported geometry type for label: ${J.geometry.type}`),null;const N=L.text;return!N||/^\s+$/.test(N)?null:this._createAs3DShape(J,P,N,L,K,O)};G.setGraphicElevationContext=function(J,L,K=0){J=D.prototype.setGraphicElevationContext.call(this,J,L);J.addOffsetRenderUnits(K);return J};G.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};G.layerElevationInfoChanged=function(J,L){C(J,L,(K,O)=>{this.updateGraphicElevationContext(O,K)});return d.SymbolUpdateType.UPDATE};G.slicePlaneEnabledChanged=function(J,L){C(J,L,K=>{for(const O of K.stageObject.geometryRecords)O.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};G.physicalBasedRenderingChanged=function(){return!0};G.pixelRatioChanged=function(){return!1};G.updateGraphicElevationContext=function(J,L){this.setGraphicElevationContext(J,L.elevationContext,
L.metadata.elevationOffset);L.needsElevationUpdates=d.needsElevationUpdates2D(L.elevationContext.mode)||"absolute-height"===L.elevationContext.mode};G._defaultElevationInfoNoZ=function(){return x};G._createAs3DShape=function(J,L,K,O,P,N){const H=this.setGraphicElevationContext(J,new f.ElevationContext,O.elevationOffset);var E="polyline"===r.get(J.geometry,"type"),I=J.uid;let M=null;J=null;if(r.isNone(N)){var Q=t.textRenderAlignmentFromHorizontalPlacement(O.horizontalPlacement);M=new y(K,Q,this._textRenderParameters);
let U=null;if(r.isSome(this._context.sharedResources.textures)){J=this._context.sharedResources.textures.fromData(M.key,()=>r.unwrap(M).create(),()=>{r.isSome(U)&&U.release()});Q=this._context.stage.renderView.textureRepository.acquire(J.texture.id);if(r.isNone(Q)||m.isPromiseLike(Q))return J.release(),null;U=Q}}Q=k(M,O);Q={occlusionTest:!0,screenOffset:O.screenOffset,anchorPosition:Q,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:O.centerOffsetUnits,debugDrawLabelBorder:O.debugDrawLabelBorder,
drawInSecondSlot:!0};r.isSome(J)&&(Q.textureId=J.texture.id);r.isSome(N)&&(Q.textureId=N.id);if(r.isSome(O.verticalOffset)){const {screenLength:U,minWorldLength:Y,maxWorldLength:V}=O.verticalOffset;Q.verticalOffset={screenLength:n.pt2px(U),minWorldLength:Y||0,maxWorldLength:r.isSome(V)?V:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:U,screenSizePerspectiveSettingsLabels:Y}=this._context.sharedResources;Q.screenSizePerspective=Y.overridePadding(this._textRenderParameters.haloSize+
this._textRenderParameters.definition.background.padding[0]);Q.screenSizePerspectiveAlignment=U}E&&(Q.shaderPolygonOffset=1E-4);Q.hasSlicePlane=this._context.slicePlaneEnabled;r.isSome(P)?(E=JSON.stringify(Q),N=P.get(E),r.isNone(N)&&(N=new B.HUDMaterial(Q),P.add(E,N))):N=new B.HUDMaterial(Q);N=[N];E=O.translation;Q=r.isSome(M)?[M.displayWidth,M.displayHeight]:[0,0];E=[u.createPointGeometry(q,E,null,Q,O.centerOffset,[0,0],null)];I=w.createStageObjectForHUD(this._context,L,E,N,H,this._context.layer.uid,
I);if(null===I)return null;P=new e.Graphics3DObject3DGraphicLayer(this,I.object,E,r.isNone(P)?N:null,J,h.perObjectElevationAligner,H);P.alignedSampledElevation=I.sampledElevation;P.needsElevationUpdates=d.needsElevationUpdates2D(H.mode)||"absolute-height"===H.mode;const {displayWidth:T,displayHeight:S}=r.isSome(M)?M:O;P.getScreenSize=(U=p.create())=>{U[0]=T;U[1]=S;return U};P.metadata={labelText:K,elevationOffset:O.elevationOffset};w.extendPointGraphicElevationContext(P,L,this._context.elevationProvider);
return P};return F}(l.Graphics3DSymbolLayer);const x={mode:"relative-to-ground",offset:0},v={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,r,m,n,p){let g=function(){function h(f){this.definition=f;this.key=JSON.stringify(f);this.haloSize=Math.round(f.halo.size);this.textStyle=this._colorToRGBA(f.color);this.haloStyle=this._colorToRGB(f.halo.color);this.backgroundStyle=0!==f.background.color[3]?this._colorToRGBA(f.background.color):null}var d=h.prototype;d.fontString=function(f){const e=this.definition.font;return`${e.style} ${e.weight} ${f}px ${e.family}, sans-serif`};d._colorToRGB=function(f){return`rgb(${f.slice(0,3).map(e=>
Math.floor(255*e)).toString()})`};d._colorToRGBA=function(f){return`rgba(${f.slice(0,3).map(e=>Math.floor(255*e)).toString()},${f[3]})`};h.fromSymbol=function(){var f=b._asyncToGenerator(function*(e,l=1){var A=m.get(e,"material","color");const t=m.mapOr(A,p.ZEROS,c.toUnitRGBA);A=m.mapOr(e.size,12,n.pt2px);const w=e.lineHeight,u=m.isSome(e.background)?c.toUnitRGBA(e.background.color):p.ZEROS,z={family:m.mapOr(e.font,"sans-serif",B=>B.family),decoration:m.mapOr(e.font,"none",B=>B.decoration),weight:m.mapOr(e.font,
"normal",B=>B.weight),style:m.mapOr(e.font,"normal",B=>B.style)};var y=e.halo;y=m.isSome(y)&&m.isSome(y.color)&&0<y.size?{size:n.pt2px(y.size),color:c.toUnitRGBA(y.color)}:{size:0,color:p.ZEROS};e=new h({color:t,size:A,background:{color:u,padding:m.isSome(e.background)?[.65*A,.5*A]:[0,0],borderRadius:m.isSome(e.background)?.375*A:0},lineSpacingFactor:w,font:z,halo:y,pixelRatio:l});l=e.fontString(A);try{yield document.fonts.load(l)}catch(B){r.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${l}'. Some text symbology may be rendered using the default browser font.`)}return e});
return function(e){return f.apply(this,arguments)}}();return h}();a.TextRenderParameters=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,r,m){const n={canvas:null};return function(){function p(g,h,d){this._renderer=new c.TextRenderer(g,h,d)}p.prototype.create=
function(){const g=c.getTextHelperCanvas(n,this._renderer.renderedWidth,this._renderer.renderedHeight),h=g.getContext("2d");h.save();this._renderer.render(h,0,0);h.restore();return new r.Texture(g,{wrap:{s:m.TextureWrapMode.CLAMP_TO_EDGE,t:m.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(p,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return p}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){const D=["polyline","polygon","extent"];y=function(P){function N(E,I,M,Q){return P.call(this,E,I,M,Q)||this}b._inheritsLoose(N,P);var H=N.prototype;H.doLoad=function(){var E=b._asyncToGenerator(function*(){});return function(){return E.apply(this,arguments)}}();H.destroy=function(){P.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};H.createGraphics3DGraphic=function(E){E=E.graphic;if(!this._validateGeometry(E.geometry,
D,this.symbolLayer.type))return null;const I=this.setGraphicElevationContext(E,new w.ElevationContext);this.ensureDrapedStatus("on-the-ground"===I.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(E):this._createAs3DShape(E,I,E.uid)};H.ensureMaterial=function(){if(!r.isSome(this._material)){var E=new x.WaterMaterialParameters,I=this.symbolLayer.color;r.isSome(I)&&(E.color=c.toUnitRGBA(I));I=this._getCombinedOpacity(I,{hasIntrinsicColor:!0});E.color=[E.color[0],E.color[1],E.color[2],
I];E.transparent=1>I||this.needsDrivenTransparentPass;E.waveDirection=r.isSome(this.symbolLayer.waveDirection)?N.headingVectorFromAngle(this.symbolLayer.waveDirection):h.fromValues(0,0);I=v.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];E.waveStrength=I.waveStrength;E.waveTextureRepeat=I.textureRepeat;E.waveVelocity=I.waveVelocity;E.flowStrength=I.perturbationStrength;E.hasSlicePlane=this._context.slicePlaneEnabled;E.isDraped=this.draped;this._material=new x.WaterMaterial(E);
this._context.stage.add(this._material)}};H.layerOpacityChanged=function(){if(!r.isNone(this._material)){var E=this._material.parameters.color,I=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[E[0],E[1],E[2],I],transparent:1>I||this.needsDrivenTransparentPass})}};H.layerElevationInfoChanged=function(E,I,M){const Q=this._elevationContext.mode;M=t.elevationModeChangeUpdateType(N.elevationModeChangeTypes,M,Q);if(M!==t.SymbolUpdateType.UPDATE)return M;
const T=t.needsElevationUpdates2D(Q);return this.updateGraphics3DGraphicElevationInfo(E,I,()=>T)};H.slicePlaneEnabledChanged=function(){r.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.pixelRatioChanged=function(){return!0};H._createAs3DShape=function(E,I,M){E=B.geometryAsPolygon(E.geometry);if(r.isNone(E))return null;var Q=C.geometryToRenderInfo(E,this._context.elevationProvider,
this._context.renderCoordsHelper,I);const T=Q.position.length/3,S=new Float64Array(2*T);Q=new K(Q,S);this._create3DShapeGeometries(Q);this._logGeometryCreationWarnings(Q.renderData,E.rings,"rings","WaterSymbol3DLayer");if(0===Q.outGeometries.length)return null;this._createUVCoordsFromVertices(Q.uvCoords,Q.renderData.mapPosition,T,this._context.elevationProvider.spatialReference);M=new k.Object3D({geometries:Q.outGeometries,materials:Q.outMaterials,transformations:Q.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,
graphicUid:M}});M=new z.Graphics3DObject3DGraphicLayer(this,M,Q.outGeometries,null,null,A.perVertexElevationAligner,I);M.alignedSampledElevation=Q.renderData.sampledElevation;M.needsElevationUpdates=t.needsElevationUpdates2D(I.mode);return M};H._createUVCoordsFromVertices=function(E,I,M,Q){Q=m.getMetersPerUnitForSR(Q);l.empty(G);for(var T=0;T<M;T++)g.set(J,I[3*T],I[3*T+1]),l.expandPointInPlace(G,J);d.scale(G,G,Q);T=G[1]%N.unitSizeOfTexture;F[0]=G[0]-G[0]%N.unitSizeOfTexture;F[1]=G[1]-T;for(T=0;T<
M;T++)E[2*T]=(I[3*T]*Q-F[0])/N.unitSizeOfTexture,E[2*T+1]=(I[3*T+1]*Q-F[1])/N.unitSizeOfTexture};H._create3DShapeGeometries=function(E){var I=E.renderData.polygons;const M=E.uvCoords;for(const {count:Q,index:T,position:S,mapPosition:U,holeIndices:Y}of I){if(r.isSome(this._context.clippingExtent)&&(e.empty(L),e.expandWithBuffer(L,U),!e.intersectsClippingArea(L,this._context.clippingExtent)))continue;I=n.earcut(U,Y,3);if(0===I.length)continue;const V=new Float64Array(M.buffer,2*T*M.BYTES_PER_ELEMENT,
2*Q);I=B.createWaterGeometry({indices:I,attributeData:{position:S,uv0:V,mapPosition:U}});E.outGeometries.push(I);E.outMaterials.push(r.unwrap(this._material));E.outTransforms.push(p.IDENTITY)}};H._createAsOverlay=function(E){const I=B.geometryAsPolygon(E.geometry);if(r.isNone(I))return null;r.unwrap(this._material).renderPriority=this._renderPriority;const M=C.geometryToRenderInfoDraped(I,this._context.overlaySR),Q=M.position.length/3,T=new Float64Array(2*Q);E=new O(M,T,this._context.layer.uid,E.uid);
E.outBoundingBox=e.empty();this._createAsOverlayWater(E);this._logGeometryCreationWarnings(E.renderData,I.rings,"rings","WaterSymbol3DLayer");if(0===E.outGeometries.length)return null;this._createUVCoordsFromVertices(E.uvCoords,E.renderData.position,Q,this._context.overlaySR);return new u(this,E.outGeometries,E.outBoundingBox,this._context.drapeSourceRenderer)};H._createAsOverlayWater=function(E){const I=E.uvCoords;var M=E.renderData.polygons;for(const {position:T,holeIndices:S,index:U,count:Y}of M)if(e.empty(L),
e.expandWithBuffer(L,T),e.intersectsClippingArea(L,this._context.clippingExtent)&&(e.expandWithAABB(E.outBoundingBox,L),M=n.earcut(T,S,3),0!==M.length)){var Q=new Float64Array(I.buffer,2*U*I.BYTES_PER_ELEMENT,2*Y);M=B.createWaterGeometry({indices:M,attributeData:{position:T,uv0:Q}});M=new q.RenderGeometry(M,r.unwrap(this._material),{layerUid:E.layerUid,graphicUid:E.graphicsUid});Q=L;d.set(M.boundingSphere,.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0,.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1])));
E.outGeometries.push(M)}};N.headingVectorFromAngle=function(E){const I=h.create();E=f.toRadian(E);I[0]=Math.sin(E);I[1]=Math.cos(E);return I};H.test=function(){return{...P.prototype.test.call(this),create3DShape:E=>this._createAs3DShape(E.graphic,E.elevationContext,E.graphicUid),ensureMaterial:()=>this.ensureMaterial()}};return N}(y.Graphics3DSymbolLayer);y.unitSizeOfTexture=100;y.elevationModeChangeTypes={definedChanged:t.SymbolUpdateType.RECREATE,staysOnTheGround:t.SymbolUpdateType.NONE,onTheGroundChanged:t.SymbolUpdateType.RECREATE};
const F=h.create(),G=l.create(),J=h.create(),L=e.create();let K=function(P){function N(H,E){H=P.call(this,H,null,null)||this;H.uvCoords=E;return H}b._inheritsLoose(N,P);return N}(B.PolygonCreationDataBase),O=function(P){function N(H,E,I,M){H=P.call(this,H,I,M)||this;H.uvCoords=E;return H}b._inheritsLoose(N,P);return N}(B.PolygonCreationDataBase);a.Graphics3DWaterSymbolLayer=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],
function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,
perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,
waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,r,m){return function(n){function p(h,d,f){d=n.call(this,d)||this;d.symbol=h;d._convert=
f;d.symbologySnappingSupported=!1;d.graphics3DSymbol=null;d.referenced=0;return d}a._inheritsLoose(p,n);var g=p.prototype;g.getSymbolLayerSize=function(h){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(h):null};g.doLoad=function(){var h=a._asyncToGenerator(function*(d){d=yield this.symbol.fetchSymbol({signal:d});d.id=this.symbol.id;this.graphics3DSymbol=this._convert(d);b.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(d){return h.apply(this,
arguments)}}();g.createGraphics3DGraphic=function(h){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(h,this):null};g.globalPropertyChanged=function(h,d){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(h,d):!1};g.applyRendererDiff=function(h,d){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(h,d):c.ApplyRendererDiffResult.Recreate_Symbol};g.prepareSymbolPatch=function(h){b.isSome(this.graphics3DSymbol)&&
this.graphics3DSymbol.prepareSymbolPatch(h)};g.updateGeometry=function(h,d){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(h,d):!1};g.onRemoveGraphic=function(){};g.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};g.destroy=function(){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;n.prototype.destroy.call(this)};a._createClass(p,[{key:"symbolLayers",
get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:m.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return p}(r.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(v){v=d.getGraphics3DSymbol(v.graphics3DGraphic.graphics3DSymbol);return r.isSome(v)?v.symbol.symbolLayers.getItemAt(0):null}function l(v,D){var F=D.graphics3DGraphic.graphic.geometry;if(r.isNone(F))return null;if(r.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(B.warnOncePerTick(A(v.placement,D.disablePlacement.logEntityDescription)),t(D)):v;F=F.type;switch(F){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return B.warnOncePerTick(A(v.placement,
`'${F}' geometries`)),t(D)}return v}function A(v,D){return`the requested label placement '${v}' is currently unsupported for ${D} in SceneView.`}function t(v){const D=v.graphics3DGraphic.graphic.geometry;if(r.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return v=e(v),r.isSome(v)&&"extrude"===v.type?C["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return C["above-center"];case "mesh":return C["above-center"]}}function w(v,D=q){({graphics3DGraphic:v}=v);v=v.graphics[0];(v=r.isSome(v)?v.stageObject.geometryRecords[0].material:null)&&v instanceof f.HUDMaterial?(v=v.parameters.anchorPosition,D[0]=2*(v[0]-.5),D[1]=2*(v[1]-.5)):(D[0]=0,D[1]=0);return D}function u(v,D,F){F=r.isSome(F)?F.getBoundingBoxObjectSpace(x):x;F=p.fromValues(F[3]-F[0],F[4]-F[1],F[5]-F[2]);v.centerOffset[0]=Math.sqrt(F[0]*F[0]+F[1]*F[1])/2*D.normalizedOffset[0];
const G=v.translation[2],J=F[2]/2*D.normalizedOffset[1];v.translation[2]=0;v.elevationOffset=G+J;F=n.length(F);v.centerOffset[2]=F/2*D.normalizedOffset[2]}function z(v){const D=v.labelClass.labelPlacement,{labelSymbol:F,graphics3DGraphic:G}=v;var J=d.getGraphics3DSymbol(G.graphics3DSymbol);J=r.applySome(J,L=>"point-3d"===L.symbol.type?L.symbol:null);v=C[D]||t(v);if(r.isSome(J)&&J.supportsCallout()&&J.hasVisibleVerticalOffset()&&!G.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(J.verticalOffset),
anchor:null,normalizedOffset:null};if(F&&F.hasVisibleVerticalOffset()&&(r.isNone(J)||!J.supportsCallout()||!J.verticalOffset||G.isDraped)){a:switch(v.placement){case "above-center":J=!0;break a;default:J=!1}return J?{placement:"above-center",verticalOffset:y(F.verticalOffset),anchor:"bottom",normalizedOffset:[0,v.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(B.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(v){const {screenLength:D,minWorldLength:F,maxWorldLength:G}=v;return{screenLength:D,minWorldLength:F,maxWorldLength:G}}const B=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),C={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const v in b){const D=C[v];b[v].forEach(F=>{C[F]=D})}Object.freeze&&(Object.freeze(C),Object.keys(C).forEach(v=>{Object.freeze(C[v]);Object.freeze(C[v].normalizedOffset)}));const k=[0,0],q=[0,0],x=h.create();a.get=function(v){var D=z(v);if(r.isNone(D))return null;if(D.anchor)var F=D;else{F=v.labelClass.labelPlacement;var G=C[F],J=G||t(v);F&&!G&&B.warnOncePerTick(`the requested label placement '${F}' is currently unsupported in SceneView.`);
F=l(J,v)}if(r.isNone(F))return null;G=!!D.hasLabelVerticalOffset;D={anchor:F.anchor,verticalOffset:D.verticalOffset,screenOffset:m.create(),centerOffset:g.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:p.create(),elevationOffset:0,hasLabelVerticalOffset:G};G=v.graphics3DGraphic.graphic.geometry;if(r.isNone(G))v=null;else{switch(G.type){case "point":J=e(v);if(!r.isNone(J))switch(G=v.graphics3DGraphic.graphics[0],r.isSome(G)?G.getCenterObjectSpace(D.translation):n.set(D.translation,0,0,
0),J.type){case "icon":case "text":({graphics3DGraphic:J}=v);G=r.isSome(G)?G.getScreenSize():null;!J.isDraped&&r.isSome(G)?(v=w(v),k[0]=G[0]/2*(F.normalizedOffset[0]-v[0]),k[1]=G[1]/2*(F.normalizedOffset[1]-v[1]),D.screenOffset[0]=k[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=k[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=k[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(C[v.labelClass.labelPlacement]&&B.warnOncePerTick(`the requested placement '${F.placement}' is currently unsupported for draped graphics`),
D.anchor="center");break;case "object":u(D,F,G)}break;case "polygon":G=e(v);if(!r.isNone(G))switch(G.type){case "extrude":v=v.graphics3DGraphic.graphics[0],r.isSome(v)?(v.getBoundingBoxObjectSpace(x),h.center(x,D.translation),D.translation[2]=h.height(x)/2):n.set(D.translation,0,0,0),u(D,F,v)}break;case "mesh":u(D,F,v.graphics3DGraphic.graphics[0])}v=D}return v};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],
function(a){let b=function(){function c(m){this._stage=m;this._materials=new Map}var r=c.prototype;r.get=function(m){return this._materials.get(m)};r.add=function(m,n){this._materials.set(m,n);this._stage.add(n)};r.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return c}();a.MaterialCollection=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ContentObjectType ./testUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){a.TextTextureAtlas=function(C){function k(x){x=C.call(this,x)||this;x.type=A.ContentObjectType.Texture;x.id=h.generateUID();x.events=new m;x._glTexture=null;x._needsClear=!1;x._elementsToAddOrUpdate=new Map;x._elementsToRemove=new Map;x._elementsToRender=new Map;x._elements=new Map;x._stageObjects=new Map;x.updating=!1;return x}b._inheritsLoose(k,C);var q=k.prototype;q.initialize=function(){this._stage=this.view._stage;this._canvas=this._create2DCanvas();
this._ctx=this._canvas.getContext("2d");this._stage.add(this);const x=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(x);this._update2DCanvasSize();this._resetAtlasCursor()};q.unload=function(){this._glTexture=g.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};q._createDescriptor=function(x){return{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,samplingMode:z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:x.parameters.maxMaxAnisotropy}};q.load=function(x){if(g.isSome(this._glTexture))return this._glTexture;this._glTexture=new y.Texture(x,this._createDescriptor(x),this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(u.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};q.dispose=function(){this._elementsToRender=this._elementsToRemove=
this._elementsToAddOrUpdate=this._elements=null;this._frameWorker=g.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=g.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null};q._create2DCanvas=function(){const x=document.createElement("canvas");x.setAttribute("id","canvas2d");x.setAttribute("style","display:none");x.setAttribute("width",(512).toString());x.setAttribute("height",(512).toString());return x};q._update2DCanvasSize=
function(){this._canvas.setAttribute("width",this._atlas.size.width.toString());this._canvas.setAttribute("height",this._atlas.size.height.toString())};q._createAtlasRegion=function(x=512){this._atlas={size:{width:x,height:x},cursor:{x:0,y:0},lineHeight:0}};q._computeAtlasResolution=function(x,v){x=Math.max(x,v);x=p.nextHighestPowerOfTwo(x+256);return x=Math.min(x,4096)};q._resizeAtlas=function(x,v){v=v||x;const D=this._atlas;D.size.width=x;D.size.height=v;g.isSome(this._glTexture)&&this._glTexture.resize(x,
v);this._update2DCanvasSize()};q._resetAtlasCursor=function(){const x=this._atlas;x.cursor.x=2;x.cursor.y=4;x.lineHeight=0;this._needsClear=!0};q._getAtlasUsage=function(){const x=this._atlas;return(x.cursor.x+x.cursor.y*x.size.width)/(x.size.width*x.size.height)};q._getExpectedAtlasUsage=function(){const x=this._elementsToRemove.size,v=this._elementsToAddOrUpdate.size,D=this._elements.size;return this._getAtlasUsage()/D*(D+v-x)};q._addAtlasElement=function(x,v,D,F){const G=this._atlas,{renderedWidth:J,
renderedHeight:L,displayWidth:K,displayHeight:O}=x.textRenderer;x.placement.offset.x=G.cursor.x;x.placement.offset.y=G.cursor.y;x.placement.size.width=J;x.placement.size.height=L;x.placement.size.displayWidth=K;x.placement.size.displayHeight=O;x.placement.uvMinMax=[x.placement.offset.x/G.size.width,1-(x.placement.offset.y+L)/G.size.height,(x.placement.offset.x+J)/G.size.width,1-x.placement.offset.y/G.size.height];G.cursor.x+=D;G.lineHeight=Math.max(G.lineHeight,F);this._elements.set(v,x)};q._removeAtlasElement=
function(x){if(x&&this._elements.has(x.textId)){const v=x.placement.offset,D=x.placement.size;this._ctx.clearRect(v.x,v.y,D.width,D.height);this._elements.delete(x.textId)}};q._ensureStageObjects=function(x){var v=this._stageObjects.get(x);if(v)return v;v=new Set;this._stageObjects.set(x,v);return v};q._addStageObject=function(x,v){this._ensureStageObjects(x).add(v)};q._removeStageObject=function(x,v){(x=this._stageObjects.get(x))&&x.delete(v)&&(v.geometries[0].vertexAttributes.get(w.VertexAttribute.SIZE).data=
[0,0],v.geometryVertexAttrsUpdated(v.geometryRecords[0]))};q._processAddition=function(x,v){const D=this._atlas;var F=x.textId;const G=x.textRenderer.renderedWidth+2,J=x.textRenderer.renderedHeight+2+2;if(D.cursor.x+G<D.size.width&&D.cursor.y+J<D.size.height)this._addAtlasElement(x,F,G,J),this._elementsToRender.set(F,x),this._elementsToAddOrUpdate.delete(F);else if(D.cursor.y+J+D.lineHeight<D.size.height)D.cursor.x=2,D.cursor.y+=D.lineHeight,D.lineHeight=0,this._addAtlasElement(x,F,G,J),this._elementsToRender.set(F,
x),this._elementsToAddOrUpdate.delete(F);else{x=this._getExpectedAtlasUsage();(F=.85<x&&4096>D.size.width)&&this._resizeAtlas(2*D.size.width,2*D.size.height);if(!v||!F&&.95<x&&4096===D.size.width)return this._processRemovals(),B.OK;this._repack();return B.REPACK}return B.OK};q._processRemovals=function(){this._elementsToRemove.forEach((x,v)=>{const D=this._stageObjects.get(v);D&&0!==D.size||this._removeAtlasElement(x);D&&0===D.size&&this._stageObjects.delete(v)});this._elementsToRemove.clear()};q._repack=
function(){this._processRemovals();this._elements.forEach((x,v)=>{x.rendered=!1;this._elementsToAddOrUpdate.set(v,x)});this._elements.clear();this._resetAtlasCursor();this._elementsToRender.clear()};q._processRenderingRequest=function(x){this._ctx.clearRect(x.placement.offset.x,x.placement.offset.y,x.placement.size.width,x.placement.size.height);x.textRenderer.render(this._ctx,x.placement.offset.x,x.placement.offset.y);const v=this._stageObjects.get(x.textId);v&&v.forEach(D=>{D.geometries[0].vertexAttributes.get(w.VertexAttribute.UV0).data=
new Float32Array(x.placement.uvMinMax);D.geometries[0].vertexAttributes.get(w.VertexAttribute.SIZE).data=[x.placement.size.displayWidth,x.placement.size.displayHeight];D.geometryVertexAttrsUpdated(D.geometryRecords[0])});x.rendered=!0};q.runTask=function(x,v=!0){if(this._glTexture){var D=!1;n.someMap(this._elementsToAddOrUpdate,(G,J)=>(G=this._elements.get(J))&&G.rendered?((G=this._stageObjects.get(J))&&G.forEach(L=>{const K=L.geometries[0].vertexAttributes,O=this._elements.get(J);K.get(w.VertexAttribute.UV0).data=
new Float32Array(O.placement.uvMinMax);K.get(w.VertexAttribute.SIZE).data=new Float32Array([O.placement.size.displayWidth,O.placement.size.displayHeight]);L.geometryVertexAttrsUpdated(L.geometryRecords[0])}),this._elementsToAddOrUpdate.delete(J),!1):this._processAddition(this._elementsToAddOrUpdate.get(J),v)===B.REPACK?D=!0:!1);if(D)this.runTask(u.noBudget,!1);else{var F=!1;0<this._elementsToRender.size&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=
!1);n.someMap(this._elementsToRender,(G,J)=>{this._processRenderingRequest(G);this._elementsToRender.delete(J);F=!0;x.madeProgress();return x.done});F&&g.isSome(this._glTexture)&&this._glTexture.setData(this._canvas);this.updating=0<this._elementsToRender.size;!this.updating&&t.textTextureAtlas.orderedRepackingEnabled&&this.repackOrdered()}}};q.addTextTexture=function(x,v){const D=x.key;this._elementsToAddOrUpdate.has(D)||this._elementsToAddOrUpdate.set(D,{textId:D,placement:{offset:{x:0,y:0},size:{width:0,
height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:x,rendered:!1});this._addStageObject(D,v);this._elementsToRemove.delete(D);this.setDirty()};q.removeTextTexture=function(x,v){x=x.key;this._elementsToRemove.set(x,this._elements.get(x));this._removeStageObject(x,v)};q.setDirty=function(){this._glTexture&&(this.updating=!0)};q.repackOrdered=function(){if(0!==this._elements.size){var x=[];this._elements.forEach((D,F)=>x.push({element:D,key:F}));var v=!0;for(let D=0;D<x.length-1;D++)if(0<
x[D].key.localeCompare(x[D+1].key)){v=!1;break}if(!v||this._elementsToRemove.size){x.sort((D,F)=>D.key.localeCompare(F.key));this._elements.clear();for(const {element:D,key:F}of x)this._elements.set(F,D);this._repack();this.setDirty()}}};b._createClass(k,[{key:"width",get:function(){return this._atlas.size.width}},{key:"height",get:function(){return this._atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",
get:function(){return this.updating}},{key:"test",get:function(){const {_elements:x,_stageObjects:v,_elementsToRemove:D,_atlas:F}=this,G=this;return{elements:x,stageObjects:v,elementsToRemove:D,atlas:F,_resizeAtlas:(J,L)=>G._resizeAtlas(J,L),run:(J,L)=>G.runTask(J,L)}}}]);return k}(r);c.__decorate([d.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([d.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=c.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var B;(function(C){C[C.OK=0]="OK";C[C.REPACK=1]="REPACK"})(B||(B={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){a.FeatureTileTree3D=function(k){function q(v){v=k.call(this,v)||this;v.tiles=new m;v.tileSize=512;v._idToTile=new Map;v._handles=new n;v._clients=new Set;v._dirty=!1;v._newTiles=new h;return v}b._inheritsLoose(q,k);var x=q.prototype;x.initialize=function(){this._handles.add([d.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),d.sync),d.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,
this.focus?.location],()=>this._setDirty(),d.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(y.TaskPriority.FEATURE_TILE_TREE,this))};x.destroy=function(){this._frameWorker=g.removeMaybe(this._frameWorker);this._handles=g.destroyMaybe(this._handles)};x.addClient=function(){const v=B++;this._clients.add(v);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(v)}};x._removeClient=function(v){this._clients.delete(v);this._hasClients||this._clear()};
x._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(y.noBudget))};x._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};x.runTask=function(v){this._dirty=!1;this._pendingTiles||(this._startUpdate(),g.isSome(this._frameWorker)&&(this._frameWorker.priority=y.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(v);!this._pendingTiles&&
g.isSome(this._frameWorker)&&(this._frameWorker.priority=y.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};x._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new u.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):
this._clear())};x._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};x._getRootTiles=function(){return this._rootTileIds.map(v=>new w.FeatureTileDescriptor3D(v[0],v[1],v[2],this.tilingScheme))};x._purgeHorizonTiles=function(v){v.sort((D,F)=>{D=D.measures.screenRect;F=F.measures.screenRect;return D[1]+D[3]-(F[1]+F[3])});t.empty(C);for(let D=0;D<v.length;D++)if(t.expand(C,v.data[D].measures.screenRect,C),10<t.height(C))return v.data.slice(D,v.length);
return[]};x._subdivideTilesForView=function(v){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!v.done;){const D=this._pendingTiles.pop();v.madeProgress();if(!this._filterExtentRect||t.intersects(this._filterExtentRect,D.extent))this._tileMeasurements.updateTile(D),D.measures.visibility!==w.Visibility.INVISIBLE&&(D.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(D.lij[0]+1),this._pendingTiles.push(...D.getChildren())):this._newTiles.push(D))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),
this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};x._updateTiles=function(v){for(var D of this.tiles.items)D.used=!1;v=v.filter(F=>{const G=this._idToTile.get(F.id);G?(G.copyMeasurementsFrom(F),G.used=!0):this._idToTile.set(F.id,F);return!G});D=this.tiles.items.filter(F=>F.used?!1:(this._idToTile.delete(F.id),!0));this.tiles.removeMany(D);this.tiles.addMany(v);this._sortTiles()};x._sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((v,D)=>v.measures.visibility!==
D.measures.visibility?v.measures.visibility===w.Visibility.VISIBLE_ON_SURFACE?-1:1:v.measures.distance-D.measures.distance);this.tiles.forEach((v,D)=>v.loadPriority=D)};b._createClass(q,[{key:"tilingScheme",get:function(){const v=this.tilingSchemeOwner.tilingScheme;return v?v.clone():null}},{key:"filterExtent",set:function(v){if(g.isSome(v)&&!v.spatialReference.equals(this.viewState.spatialReference))p.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var D=this._get("filterExtent");D===v||g.isSome(D)&&v&&D.equals(v)||(v=g.isSome(v)?v.clone():null,this._set("filterExtent",v),this._setDirty())}}},{key:"_filterExtentRect",get:function(){if(g.isNone(this.filterExtent)||!this.tilingScheme)return null;const v=t.create();z.toBoundingRect(this.filterExtent,v,this.tilingScheme.spatialReference);return v}},{key:"_rootTileIds",get:function(){return this._filterExtentRect?this.tilingScheme.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}},{key:"suspended",
set:function(v){v!==this._get("suspended")&&(this._set("suspended",v),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return q}(r);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([f.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([f.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);c.__decorate([f.property()],a.FeatureTileTree3D.prototype,"tiles",
void 0);c.__decorate([f.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([f.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([f.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([f.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);c.__decorate([f.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",null);c.__decorate([f.property({value:!1})],a.FeatureTileTree3D.prototype,
"suspended",null);c.__decorate([f.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([A.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let B=0;const C=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,b){let c=function(){function r(n,
p,g,h=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;h&&this.acquire(n,p,g,h)}var m=r.prototype;m.acquire=function(n,p,g,h){this.tilingScheme=h;this.id=r.id(n,p,g);this.lij[0]=n;this.lij[1]=p;this.lij[2]=g;h.getExtent(n,p,g,this.extent);this.resolution=h.resolutionAtLevel(n)};m.release=function(){this.tilingScheme=null};m.getChildren=function(n){const p=
this.lij[0]+1,g=2*this.lij[1],h=2*this.lij[2];if(!n)return[new r(p,g,h,this.tilingScheme),new r(p,g+1,h,this.tilingScheme),new r(p,g,h+1,this.tilingScheme),new r(p,g+1,h+1,this.tilingScheme)];n[0].acquire(p,g,h,this.tilingScheme);n[1].acquire(p,g+1,h,this.tilingScheme);n[2].acquire(p,g,h+1,this.tilingScheme);n[3].acquire(p,g+1,h+1,this.tilingScheme);return n};m.copyMeasurementsFrom=function(n){this.measures.visibility=n.measures.visibility;this.measures.shouldSplit=n.measures.shouldSplit;this.measures.distance=
n.measures.distance;b.copy(n.measures.screenRect,this.measures.screenRect)};r.id=function(n,p,g){return`${n}/${p}/${g}`};return r}();a.Visibility=void 0;(function(r){r[r.INVISIBLE=0]="INVISIBLE";r[r.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";r[r.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){let e=function(){function B(k){this._camera=new f.Camera;this._focusOnMap=[0,0];this._screenRect=m.create();this._tileSize=k.tileSize;this._renderCoordsHelper=k.renderCoordsHelper;this._tilingScheme=k.tilingScheme;this._visibility=new d.FeatureTileVisibility3D(k.renderCoordsHelper)}var C=B.prototype;C.begin=function(k,q,x){this._camera.copyFrom(k);this._surfaceElevation=x;this._focusOnMap[0]=q.x;this._focusOnMap[1]=q.y;m.fromValues(0,0,k.fullWidth,k.fullHeight,this._screenRect);
this._visibility.begin(this._camera,x)};C.end=function(){this._visibility.end()};C.updateTile=function(k){k.measures.visibility=this._visibility.calculate(k);k.measures.distance=m.distance(k.extent,this._focusOnMap);k.measures.visibility!==h.Visibility.INVISIBLE&&this._updateScreenMeasure(k)};C._updateScreenMeasure=function(k){const q=k.measures.screenRect;m.empty(q);let x=0;const v=k.lij[0]+2,D=k.lij[1]<<2,F=k.lij[2]<<2;var G=this._tileSizeWithBias(k);G*=G;for(let J=0;4>J;J++)for(let L=0;4>L;L++)if(x+=
this._computeScreenArea(k,v,D+J,F+L,q),x>G){k.measures.shouldSplit=!0;return}k.measures.shouldSplit=!1};C._tileSizeWithBias=function(k){return k.measures.visibility===h.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize};C._computeScreenArea=function(k,q,x,v,D){this._projectToScreen(q,x,v,k.measures.visibility===h.Visibility.VISIBLE_WHEN_EXTENDED,A);m.empty(l);for(k=0;4>k;k++)m.expandPointInPlace(l,A[k]);m.expand(D,l,D);return g.areaPoints2d(A[0],A[1],A[2])+g.areaPoints2d(A[0],A[2],
A[3])};C._projectToScreen=function(k,q,x,v,D){this._tilingScheme.ensureMaxLod(k);this._tilingScheme.getExtent(k,q,x,t);this._toRenderCoords(t,0,3,u[0]);this._toRenderCoords(t,2,3,u[1]);this._toRenderCoords(t,2,1,u[2]);this._toRenderCoords(t,0,1,u[3]);v&&(this._projectToPlane(u,this._camera.frustum[n.PlaneIndex.NEAR]),this._projectToPlane(u,this._camera.frustum[n.PlaneIndex.TOP]),this._projectToPlane(u,this._camera.frustum[n.PlaneIndex.BOTTOM]));for(k=0;4>k;k++)this._camera.projectToRenderScreen(u[k],
y),this._camera.renderToScreen(y,D[k])};C._projectToPlane=function(k,q){for(var x=0;4>x;x++)z[x]=p.signedDistance(q,k[x]);x=Math.max(z[0],z[1],z[2],z[3]);if(0<x)for(q=c.scale(w,p.normal(q),-x),x=0;4>x;x++)c.add(k[x],k[x],q)};C._toRenderCoords=function(k,q,x,v){w[0]=k[q];w[1]=k[x];w[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(w,this._tilingScheme.spatialReference,v);return v};return B}();const l=m.create(),A=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),
b.createScreenPointArray()],t=m.create(),w=r.create(),u=[r.create(),r.create(),r.create(),r.create()],z=[0,0,0,0],y=b.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(){function y(C){this._renderCoordsHelper=C;this._surfaceElevation=0;this._cache=new Map;this._frustum=new e.Frustum(C);this._extendedFrustum=new e.Frustum(C);this._intersector=new l.FrustumExtentIntersection({renderCoordsHelper:C});this._renderCoordsHelper=C}var B=y.prototype;B.begin=function(C,k){this._surfaceElevation=k;this._aboveGround=this._renderCoordsHelper.getAltitude(C.eye)>k;this._frustum.update(C);this._shortenFrustumFarPlane(this._frustum);
this._updateExtendedFrustum(C)};B.end=function(){this._cache.clear()};B.calculate=function(C){if(this._allTilesInvisible)return f.Visibility.INVISIBLE;const k=this._renderCoordsHelper.viewingMode===d.ViewingMode.Global&&2<=C.lij[0]&&6>C.lij[0],q=this._getOrCalculateSingleTileVisibility(C,!k);return q!==f.Visibility.INVISIBLE&&k?this._calculateAggregatedChildrenVisibility(C):q};B._shortenFrustumFarPlane=function(C){var k=e.Frustum.nearFarLineIndices;const q=C.mutablePoints;for(const x of k){const [v,
D]=x;k=q[v];r.subtract(t,q[D],k);r.scale(t,t,.95);r.add(q[D],k,t)}C.updatePoints(q)};B._calculateAggregatedChildrenVisibility=function(C){let k=f.Visibility.INVISIBLE;var q=this._cache.get(C.id);if(null!=q)return q;q=z.acquire();C.getChildren(q);for(const x of q){const v=this.calculate(x);if(v!==f.Visibility.INVISIBLE&&(k=v,v===f.Visibility.VISIBLE_ON_SURFACE))break}z.release(q);this._cache.set(C.id,k);return k};B._getOrCalculateSingleTileVisibility=function(C,k){var q=this._cache.get(C.id);if(null!=
q)return q;q=this._calculateSingleTileVisibility(C);k&&this._cache.set(C.id,q);return q};B._calculateSingleTileVisibility=function(C){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===d.ViewingMode.Global&&12>C.lij[0]){if(this._calculateSingleTileVisibilitySided(C,!1)===f.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(C,!0)}else return this._calculateSingleTileVisibilitySided(C,this._aboveGround)};B._calculateSingleTileVisibilitySided=function(C,k){this._intersector.update(C.extent,
C.tilingScheme.spatialReference,this._surfaceElevation,k);C=n.getReferenceEllipsoid(C.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,C)?this._intersector.isVisibleInFrustum(this._frustum,C,!0)?f.Visibility.VISIBLE_ON_SURFACE:f.Visibility.VISIBLE_WHEN_EXTENDED:f.Visibility.INVISIBLE};B._updateExtendedFrustum=function(C){this._extendedFrustum.update(C);this._shortenFrustumFarPlane(this._extendedFrustum);var k=this._renderCoordsHelper.worldUpAtPosition(C.eye,
t);this._aboveGround||r.negate(k,k);k=b.acosClamped(-r.dot(k,C.viewForward));this._allTilesInvisible=k>(Math.PI+C.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=k>C.fovY/2)){C=this._extendedFrustumParameters();k=this._extendedFrustum.mutablePoints;for(let q=0;4>q;q++){const x=C.pointIndices[q],v=k[x],D=this._renderCoordsHelper.getAltitude(v);if(C.needsAltitudeAdjustment(D)){this._renderCoordsHelper.worldUpAtPosition(v,t);switch(x){case p.PointIndex.FAR_BOTTOM_LEFT:case p.PointIndex.FAR_TOP_LEFT:case p.PointIndex.NEAR_BOTTOM_LEFT:case p.PointIndex.NEAR_TOP_LEFT:g.projectVector(this._extendedFrustum.planes[p.PlaneIndex.LEFT],
t,t);break;case p.PointIndex.FAR_BOTTOM_RIGHT:case p.PointIndex.FAR_TOP_RIGHT:case p.PointIndex.NEAR_BOTTOM_RIGHT:case p.PointIndex.NEAR_TOP_RIGHT:g.projectVector(this._extendedFrustum.planes[p.PlaneIndex.RIGHT],t,t)}r.scale(t,t,C.direction);this._renderCoordsHelper.intersectInfiniteManifold(h.wrap(v,t),C.zWithMargin,v)}}this._extendedFrustum.updatePoints(k);g.fromPoints(k[p.PointIndex.NEAR_BOTTOM_LEFT],k[p.PointIndex.NEAR_BOTTOM_RIGHT],k[p.PointIndex.NEAR_TOP_RIGHT],w);g.fromPoints(k[p.PointIndex.NEAR_BOTTOM_RIGHT],
k[p.PointIndex.NEAR_TOP_RIGHT],k[p.PointIndex.NEAR_TOP_LEFT],u);0>r.dot(g.normal(w),g.normal(u))&&(C=this._extendedFrustum.mutablePoints,this._aboveGround?[C[p.PointIndex.NEAR_BOTTOM_LEFT],C[p.PointIndex.NEAR_BOTTOM_RIGHT]]=[C[p.PointIndex.NEAR_BOTTOM_RIGHT],C[p.PointIndex.NEAR_BOTTOM_LEFT]]:[C[p.PointIndex.NEAR_TOP_LEFT],C[p.PointIndex.NEAR_TOP_RIGHT]]=[C[p.PointIndex.NEAR_TOP_RIGHT],C[p.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(C))}};B._extendedFrustumParameters=function(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};B._extendedFrustumParametersAboveSurface=function(){const C=this._surfaceElevation-1;return{zWithMargin:C,pointIndices:e.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(k){return k>C}}};B._extendedFrustumParametersBelowSurface=function(){const C=this._surfaceElevation+1;return{zWithMargin:C,pointIndices:e.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(k){return k<C}}};
return y}();const t=m.create(),w=g.create(),u=g.create(),z=new c(Array,y=>{4!==y.length&&(y[0]=new f.FeatureTileDescriptor3D,y[1]=new f.FeatureTileDescriptor3D,y[2]=new f.FeatureTileDescriptor3D,y[3]=new f.FeatureTileDescriptor3D)},y=>{y[0].release();y[1].release();y[2].release();y[3].release()});a.FeatureTileVisibility3D=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){const z=.5*Math.PI,y=z/Math.PI*180;let B=function(){function G(L){this._renderCoordsHelper=L.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:p.create(),direction:p.create()};for(L=0;4>L;L++)this._extent[L]={origin:p.create(),direction:p.create(),cap:{next:null,direction:p.create()}},this._planes[L]=A.create();this._planes[e.PlaneIndex.NEAR]=A.create();this._planes[e.PlaneIndex.FAR]=A.create();this._planesWithoutFar=
this._planes.slice(0,5)}var J=G.prototype;J.update=function(L,K,O,P=!0){const N=this._extent;this._toRenderBoundingExtent(L,K,O);n.add(this._center.origin,N[0].origin,N[2].origin);n.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);P||n.scale(this._center.direction,this._center.direction,-1);for(O=0;4>O;O++){const H=N[O];this._renderCoordsHelper.worldUpAtPosition(H.origin,H.direction);const E=N[3===O?0:O+1];H.cap.next=
E.origin;n.direction(H.cap.direction,H.origin,E.origin);A.fromVectorsAndPoint(H.direction,H.cap.direction,H.origin,this._planes[O]);P||n.scale(H.direction,H.direction,-1)}A.fromVectorsAndPoint(N[0].cap.direction,N[1].cap.direction,N[0].origin,this._planes[e.PlaneIndex.NEAR]);P?A.negate(this._planes[e.PlaneIndex.NEAR],this._planes[e.PlaneIndex.FAR]):(A.copy(this._planes[e.PlaneIndex.FAR],this._planes[e.PlaneIndex.NEAR]),A.negate(this._planes[e.PlaneIndex.NEAR],this._planes[e.PlaneIndex.NEAR]));this._maxSpan=
Math.max(Math.abs(L[0]-L[2]),Math.abs(L[1]-L[3]));this._maxSpanSpatialReference=K;this._minGlobalAltitude=.9*h.getReferenceEllipsoid(this._maxSpanSpatialReference).radius};J.isVisibleInFrustum=function(L,K,O=!1){if(null==L)return!1;if(this._renderCoordsHelper.viewingMode===w.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:z*K))return!0;if(null!=L.altitude&&L.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(L)}if(0===this._maxSpan)return K=
this._extent[0],!O&&L.intersectsRay(t.wrap(K.origin,K.direction))?!0:!1;for(K=0;K<this._extent.length;K++){var P=this._extent[K];if(!O&&L.intersectsRay(t.wrap(P.origin,P.direction))||L.intersectsLineSegment(l.fromPoints(P.origin,P.cap.next,F),P.cap.direction))return!0}O=O?this._planes:this._planesWithoutFar;for(K=0;K<L.lines.length;K++)if(P=L.lines[K],u.frustumLineSegment(O,P.origin,P.endpoint,P.direction))return!0;return!1};J._toRenderBoundingExtentGlobal=function(L,K,O){f.center(L,k);k[2]=O;g.computeTranslationToOriginAndRotation(K,
k,q,this._renderCoordsHelper.spatialReference);r.invert(x,q);d.empty(v);for(const {x0:P,x1:N,y0:H,y1:E}of C)for(let I=0;5>I;I++){const M=I/4;k[0]=c.lerp(L[P],L[N],M);k[1]=c.lerp(L[H],L[E],M);k[2]=O;g.projectVectorToVector(k,K,k,this._renderCoordsHelper.spatialReference);n.transformMat4(k,k,x);d.expandWithVec3(v,k)}n.set(this._extent[0].origin,v[0],v[1],v[2]);n.set(this._extent[1].origin,v[3],v[1],v[2]);n.set(this._extent[2].origin,v[3],v[4],v[2]);n.set(this._extent[3].origin,v[0],v[4],v[2]);for(L=
0;4>L;++L)n.transformMat4(this._extent[L].origin,this._extent[L].origin,q)};J._toRenderBoundingExtentLocal=function(L,K,O){g.projectBoundingRect(L,K,D,this._renderCoordsHelper.spatialReference);n.set(this._extent[0].origin,D[0],D[1],O);n.set(this._extent[1].origin,D[2],D[1],O);n.set(this._extent[2].origin,D[2],D[3],O);n.set(this._extent[3].origin,D[0],D[3],O)};J._toRenderBoundingExtent=function(L,K,O){switch(this._renderCoordsHelper.viewingMode){case w.ViewingMode.Global:this._toRenderBoundingExtentGlobal(L,
K,O);break;case w.ViewingMode.Local:this._toRenderBoundingExtentLocal(L,K,O);break;default:b.neverReached(this._renderCoordsHelper.viewingMode)}};J._isVisibleInFrustumGlobal=function(L){if(0>A.signedDistance(L.planes[e.PlaneIndex.NEAR],this._center.origin)&&0>n.dot(this._center.direction,L.direction))return!0;for(let K=0;4>K;K++){const O=this._extent[K];if(0>A.signedDistance(L.planes[e.PlaneIndex.NEAR],O.origin)&&0>n.dot(O.direction,L.direction))return!0}return!1};return G}();const C=[{x0:0,y0:1,
x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],k=p.create(),q=m.create(),x=m.create(),v=d.create(),D=f.create(),F=l.create();a.FrustumExtentIntersection=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,r){const m=c.create();a.projectToBoundingBox=function(n,p,g){if(b.isNone(n)||
b.isNone(g))return!1;let h;m[0]=null!=n.xmin?n.xmin:0;m[1]=null!=n.ymin?n.ymin:0;m[2]=null!=n.zmin?n.zmin:0;h=r.projectBuffer(m,n.spatialReference,0,p,g,0,1);m[0]=null!=n.xmax?n.xmax:0;m[1]=null!=n.ymax?n.ymax:0;m[2]=null!=n.zmax?n.zmax:0;h=h&&r.projectBuffer(m,n.spatialReference,0,p,g,3,1);null==n.xmin&&(p[0]=-Infinity);null==n.ymin&&(p[1]=-Infinity);null==n.zmin&&(p[2]=-Infinity);null==n.xmax&&(p[3]=Infinity);null==n.ymax&&(p[4]=Infinity);null==n.zmax&&(p[5]=Infinity);return h};a.toBoundingRect=
function(n,p,g){if(b.isNone(n)||b.isNone(g))return!1;let h;m[0]=null!=n.xmin?n.xmin:0;m[1]=null!=n.ymin?n.ymin:0;m[2]=null!=n.zmin?n.zmin:0;h=r.projectBuffer(m,n.spatialReference,0,m,g,0,1);p[0]=m[0];p[1]=m[1];m[0]=null!=n.xmax?n.xmax:0;m[1]=null!=n.ymax?n.ymax:0;m[2]=null!=n.zmax?n.zmax:0;h=h&&r.projectBuffer(m,n.spatialReference,0,m,g,0,1);p[2]=m[0];p[3]=m[1];null==n.xmin&&(p[0]=-Infinity);null==n.ymin&&(p[1]=-Infinity);null==n.xmax&&(p[2]=Infinity);null==n.ymax&&(p[3]=Infinity);return h};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){c=function(x){function v(){var F=x.apply(this,arguments)||this;F._propertiesPool=new y.PropertiesPool({camera:B.Camera},a._assertThisInitialized(F));F._lastSeenCameraProjectionValues=new B.Camera;F.events=new r;F.viewingMode=t.ViewingMode.Global;F._cameraChanged=!1;F._updateQueue=[];F._processingUpdates=!1;return F}a._inheritsLoose(v,x);var D=v.prototype;D.init=function(F,G){this._set("viewingMode",F);this._set("spatialReference",G);this._set("constraints",
new w.Constraints({mode:this.viewingMode}))};D.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new y.PropertiesPool({camera:B.Camera},this)};D.createInitialCamera=function(){if(this.viewingMode===t.ViewingMode.Global){const F=l.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new B.Camera(e.fromValues(4*F,0,0),e.fromValues(F,0,0),e.fromValues(0,0,1))}else this.camera=new B.Camera(e.fromValues(0,0,100),e.fromValues(0,0,0),e.fromValues(0,
1,0))};D.switchCameraController=function(F){this.cameraController=F;return F.state!==z.State.Rejected};D.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};D.updateCamera=function(F){this._updateQueue.push(F);this._processUpdateQueue()};D._processUpdateQueue=function(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var F=this._updateQueue.shift();C.copyFrom(this._get("camera"));F(C);this.camera=
C;this._processingUpdates=!1;this._processUpdateQueue()}};D._cameraProjectionChanged=function(F,G){return F.fov!==G.fov||F.fullViewport[0]!==G.fullViewport[0]||F.fullViewport[1]!==G.fullViewport[1]||F.fullViewport[2]!==G.fullViewport[2]||F.fullViewport[3]!==G.fullViewport[3]||F.padding[B.PaddingSide.TOP]!==G.padding[B.PaddingSide.TOP]||F.padding[B.PaddingSide.RIGHT]!==G.padding[B.PaddingSide.RIGHT]||F.padding[B.PaddingSide.BOTTOM]!==G.padding[B.PaddingSide.BOTTOM]||F.padding[B.PaddingSide.LEFT]!==
G.padding[B.PaddingSide.LEFT]?!0:!1};a._createClass(v,[{key:"animation",get:function(){return this.cameraController instanceof u.AnimationController&&m.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(F){F!==C&&C.copyFrom(F);C.computeUp(this.viewingMode);k.camera=C;this.events.emit("before-camera-change",k);F=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,
C)&&(this._lastSeenCameraProjectionValues.copyFrom(C),q.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",q));if(!F||!F.equals(C))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(C)),this._cameraChanged=!F||!F.almostEquals(C)){const G=f.afterDispatch(()=>{this._cameraChanged=!1;G.remove()})}}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"contentCamera",get:function(){return m.isSome(this._contentCamera)?this._contentCamera:
this.camera},set:function(F){this._contentCamera=m.isSome(F)?F.clone():null}},{key:"fixedContentCamera",get:function(){return m.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return this.viewingMode===t.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===t.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},
{key:"cameraController",get:function(){return this._get("cameraController")},set:function(F){this.stopActiveCameraController()?(F&&(this.addHandles(n.when(()=>F.state===z.State.Finished||F.state===z.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(G=>F.onControllerEnd(G))},{sync:!0,once:!0})),F.onControllerStart(this.camera)),this._set("cameraController",F)):F&&(F.state=z.State.Rejected)}}]);return v}(c);b.__decorate([p.property()],c.prototype,"mode",void 0);b.__decorate([p.property({readOnly:!0,
type:A})],c.prototype,"animation",null);b.__decorate([p.property({type:B.Camera})],c.prototype,"camera",null);b.__decorate([p.property()],c.prototype,"pixelRatio",null);b.__decorate([p.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([p.property({type:B.Camera})],c.prototype,"contentCamera",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"fixedContentCamera",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([p.property({readOnly:!0})],
c.prototype,"events",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"isLocal",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"spatialReference",void 0);b.__decorate([p.property()],c.prototype,"navigating",null);b.__decorate([p.property()],c.prototype,"stationary",null);b.__decorate([p.property()],c.prototype,"_cameraChanged",void 0);
b.__decorate([p.property()],c.prototype,"cameraController",null);b=c=b.__decorate([d.subclass("esri.views.3d.state.ViewState")],c);const C=new B.Camera,k={camera:null},q={camera:null};return b})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(q){y&&y.viewingMode===q||(y=e.newIntersector(q));return y}let w=function(){function q(v,D,F){this.viewingMode=v;this._forEachLayer=D;this._view=F;this._externalIntersectionHandlers=new c;this._tolerance=e.DEFAULT_TOLERANCE;this._tmpRay=g.create();this._tmpRegion=p.create();this._validateHUDIntersector=e.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}var x=q.prototype;x.intersectScreen=function(v,D,F){return this.intersectRay(this._getPickRay(v,
this._tmpRay),t(this.viewingMode),D,F)};x.intersectScreenFreePointFallback=function(v,D,F){return this.intersectRayFreePointFallback(this._getPickRay(v,this._tmpRay),D,F)};x.intersectRayFreePointFallback=function(v,D,F){return this.intersectRay(v,t(this.viewingMode),D,F)||this._intersectRayFreePointLocal(v,D)};x.intersectRay=function(v,D,F,G){D.options.selectionMode=!1;D.options.store=l.StoreResults.MIN;this.computeIntersection(v,D,G);return D.results.min?D.results.min.getIntersectionPoint(F):!1};
x.getCenterRayWithSubpixelOffset=function(v,D,F=.5,G=.5){v.getRenderCenter(k,F,G);k[0]+=.0466;k[1]-=.0123;return f.fromRenderAtEye(v,k,D)};x.intersectIntersectorScreen=function(v,D,F){this.computeIntersection(this._getPickRay(v,this._tmpRay),D,F)};x.intersectToolIntersectorScreen=function(v,D,F){v=this._getPickRay(v,this._tmpRay);this.intersectToolIntersectorRay(v,D,F)};x.intersectToolIntersectorRay=function(v,D,F){D.options.selectionMode=!0;this.computeIntersection(v,D,F);const G=D.results.min;this._view.basemapTerrain&&
this._view.basemapTerrain.opaque||A.isValidIntersectorResult(G)&&G.intersector!==l.IntersectorType.TERRAIN||(D.options.selectionMode=!1,this.computeIntersection(v,D,F))};x.setTolerance=function(v=e.DEFAULT_TOLERANCE){this._tolerance=v};x.addIntersectionHandler=function(v){this._externalIntersectionHandlers.push(v);this._externalIntersectionHandlers.sort((D,F)=>D.type===l.IntersectorType.TERRAIN?1:F.type===l.IntersectorType.TERRAIN?-1:0)};x.removeIntersectionHandler=function(v){null!=this._externalIntersectionHandlers.removeUnordered(v)&&
this._externalIntersectionHandlers.sort((D,F)=>D.type===l.IntersectorType.TERRAIN?1:F.type===l.IntersectorType.TERRAIN?-1:0)};x._getPickRay=function(v,D){return f.fromScreen(this._view.state.camera,v,D)};x._intersectRayFreePointLocal=function(v,D){if(this.viewingMode!==d.ViewingMode.Local||b.isNone(v))return!1;var F=this._view.renderDataExtent;if(b.isNone(F))return m.add(D,v.origin,m.normalize(h.sv3d.get(),v.direction)),!0;var G=Math.max(F.xmax-F.xmin,F.ymax-F.ymin,8*Math.max(F.xmax-F.xmin,F.ymax-
F.ymin));if(0===G)return m.add(D,v.origin,m.normalize(h.sv3d.get(),v.direction)),!0;var J=this._view.state.camera;const L=Math.max(0,F.xmin-J.eye[0],J.eye[0]-F.xmax);F=Math.max(0,F.ymin-J.eye[1],J.eye[1]-F.ymax);J=G/Math.max(1,Math.max(0,Math.log(G/(Math.abs(J.relativeElevation)+Number.MIN_VALUE)))**2);J=Math.max(J,Math.min(Math.sqrt(L*L+F*F),G));G=m.length(v.direction);G=m.scale(h.sv3d.get(),v.direction,0===G?J:J/G);m.add(D,v.origin,G);return!0};x.intersectElevationFromScreen=function(v,D,F=0,G=
null){return this._intersectElevation(this._getPickRay(v,this._tmpRay),D,F,G)};x._intersectElevation=function(v,D,F=0,G=null){if(b.isNone(v))return null;var J=b.isSome(D)?D.mode:"absolute-height",L=b.isSome(D)?b.unwrapOr(D.offset,0):0,K="on-the-ground"!==J?L+F:0;D=K/this._view.renderCoordsHelper.unitInMeters;if("absolute-height"===J)return this._view.renderCoordsHelper.intersectInfiniteManifold(v,K,C)?(F=this._view.computeMapPointFromVec3d(C),F.z-=L,F):null;L=this._view.state.camera;const O=r.castRenderScreenPointArray3(h.sv3d.get());
L.projectToRenderScreen(v.origin,O);K=new B(null,this._forEachLayer);const P=this._view.slicePlane,N=b.isSome(P)?A.sliceFilterPredicate(P):null,H=e.newIntersector(this.viewingMode);H.options.store=l.StoreResults.MIN;H.options.verticalOffset=D;D=v.origin;v=m.add(h.sv3d.get(),D,v.direction);H.reset(D,v,L);H.point=O;const E=b.isSome(G)?"type"in G&&"graphics"===G.type?I=>I.metadata.layerUid!==G.uid:I=>I.metadata.graphicUid!==G.uid:null;switch(J){case "relative-to-scene":H.intersect(K.layers,O,this._tolerance,
null,I=>(b.isNone(E)||E(I))&&I.metadata&&I.metadata.isElevationSource);this._externalIntersectionHandlers.forAll(I=>{I.type!==l.IntersectorType.I3S&&I.type!==l.IntersectorType.TERRAIN||I.intersect(H,I.slicePlaneEnabled?N:null,H.rayBegin,H.rayEnd,O)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(I=>{I.isGround&&I.intersect(H,I.slicePlaneEnabled?N:null,H.rayBegin,H.rayEnd,O)})}return H.results.min.getIntersectionPoint(C)?(J=this._view.computeMapPointFromVec3d(C),
J.z=F,J):null};x.computeIntersection=function(v,D,F){if(!b.isNone(v)){var G=this._view.state.camera,J=r.castRenderScreenPointArray3(h.sv3d.get());G.projectToRenderScreen(v.origin,J);var L=new B(F,this._forEachLayer);D.options.selectOpaqueTerrainOnly=!F||!("include"in F||"exclude"in F);var K=v.origin,O=m.add(h.sv3d.get(),v.origin,v.direction);D.reset(K,O,G);D.intersect(L.layers,J,this._tolerance);v=this._view.slicePlane;var P=b.isSome(v)?A.sliceFilterPredicate(v):null;D.intersect(L.sliceableLayers,
J,this._tolerance,P);var N=F&&(F.requiresGroundFeedback||F.enableDraped);this._externalIntersectionHandlers.forAll(H=>{D.options.isFiltered=!L.filterLayerUid(H.layerUid);(H.isGround&&N||!D.options.isFiltered)&&H.intersect(D,H.slicePlaneEnabled?P:null,K,O,J)});v=h.sv3d.get();G=this._view.basemapTerrain;if(F&&F.enableDraped&&b.isSome(G.spatialReference)&&D.results.ground.getIntersectionPoint(v)){F=G.overlayManager.renderer;const H=this._view.renderCoordsHelper.spatialReference,E=h.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(v,
E,G.spatialReference);E[2]=b.unwrapOr(this._view.elevationProvider.getElevation(v[0],v[1],v[2],H,"ground"),0);F.intersect(D,E,D.results.ground,I=>L.filterRenderGeometry(I))}D.sortResults();this._processHUDResults(D)}};x._processHUDResults=function(v){var D=v.results.hud;p.copy(this._tmpRegion,p.NEGATIVE_INFINITY);const F=this._view.state.camera,G=[],J=this._tmpRegion;var L=E=>{const I=new z(E);F.projectToRenderScreen(E.target.center,I.screenPoint);I.screenPoint[0]=Math.floor(I.screenPoint[0]);I.screenPoint[1]=
Math.floor(I.screenPoint[1]);G.push(I);p.expandPointInPlace(J,I.screenPoint)};v.sortResults(D.all);b.isSome(D.min.dist)&&L(D.min);for(var K of D.all)D.min.target.object!==K.target.object&&D.max.target.object!==K.target.object&&L(K);b.isSome(D.max.dist)&&D.max.target.object!==D.min.target.object&&L(D.max);if(G.length){J[0]===J[2]&&(J[2]+=1);J[1]===J[3]&&(J[3]+=1);D=F.fullWidth;L=F.fullHeight;var O=Math.max(0,J[0]-1),P=Math.max(0,J[1]-1);K=Math.min(p.width(J)+2,D-O);var N=Math.min(p.height(J)+2,L-P),
H=new Uint8Array(K*N*4);this._view._stage.renderView.readHUDVisibility(O,P,K,N,H);O=!0;P=b.isNone(v.results.max.dist);N=0;for(const E of G)for(const I of u)if(H[4*(Math.min(E.screenPoint[0]+I[0],D)-J[0]+(Math.min(E.screenPoint[1]+I[1],L)-J[1])*K)]){O&&(v.results.min.copy(E.result),O=!1);P&&v.results.max.copy(E.result);v.options.store===l.StoreResults.ALL&&v.results.all.splice(N++,0,E.result);break}}};return q}();const u=(()=>{const q=[];for(let x=-1;1>=x;x++)for(let v=-1;1>=v;v++)q.push([v+1,x+1]);
return q})();let z=function(q){this.result=q;this.screenPoint=r.createRenderScreenPointArray3()},y,B=function(){function q(v,D){this.layers=[];this.sliceableLayers=[];this.include=v?.include;this.exclude=v?.exclude;D(F=>{F.isPickable&&this.filterLayerUid(F.apiLayerUid)&&(F.isSliceable?this.sliceableLayers:this.layers).push(F)})}var x=q.prototype;x.filterLayerUid=function(v){const {include:D,exclude:F}=this;return b.isNone(v)?null==D&&null==F:(null==D||D.has(v))&&(null==F||!F.has(v))};x.filterRenderGeometry=
function(v){return this.filterLayerUid(v.layerUid)};return q}();const C=n.create(),k=r.createRenderScreenPointArray3();a.SceneIntersectionHelper=w;a.isIntersectionHandler=function(q){return"object"===typeof q&&"intersect"in q};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(t,w,u,z,y,B,C){for(const k of w)w=k.getElevation(u,z,y,B,C),n.isSome(w)&&(t=n.isSome(t)?Math.max(w,t):w);return t}a.CombinedElevationProvider=function(t){function w(z){z=t.call(this,z)||this;z._im=[];z._ground=[];z._scene=[];z._handles=new Map;z.lastElevationQuery=null;z.elevationCacheEnabled=!1;return z}b._inheritsLoose(w,t);var u=w.prototype;u.destroy=function(){this._elevationQueryCached=n.destroyMaybe(this._elevationQueryCached)};u.enableElevationCache=
function(z){z||(this.lastElevationQuery=null);this.elevationCacheEnabled=z};u.getElevation=function(z,y,B,C,k){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var q=this.lastElevationQuery;if(z===q.x&&y===q.y&&B===q.z&&e.equals(C,q.spatialReference)&&k===q.queryContext)return q.result}q=A(null,this._im,z,y,B,C,k);n.isNone(q)&&(q=A(q,this._ground,z,y,B,C,k));"scene"===k&&(q=A(q,this._scene,z,y,B,C,k));this.elevationCacheEnabled&&(this.lastElevationQuery={x:z,y,z:B,spatialReference:C,
queryContext:k,result:q});return q};u.queryElevation=function(z,y,B,C,k,q=null,x=0){const v=p.createResolver();this._elevationQuery.queryElevation(z,y,q,x).then(D=>{"scene"===k&&(D=A(D,this._scene,z,y,B,C,k));v.resolve(D)}).catch(D=>{p.isAbortError(D)?v.reject(D):v.resolve(this.getElevation(z,y,B,C,k))});return v.promise};u.register=function(z,y){this._handles.set(y,y.on("elevation-change",B=>this.emit("elevation-change",B)));this._providersFromContext(z).push(y)};u.unregister=function(z){this._handles.has(z)&&
(this._handles.get(z).remove(),this._handles.delete(z));for(const y of[this._im,this._ground,this._scene]){const B=y.indexOf(z);-1<B&&y.splice(B,1)}};u._providersFromContext=function(z){switch(z){case "ground":return this._ground;case "im":return this._im;case "scene":return this._scene}};b._createClass(w,[{key:"spatialReference",get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){n.isNone(this._elevationQueryCached)&&(this._elevationQueryCached=
new l.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return w}(m.EventedMixin(r));c.__decorate([g.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,"view",void 0);c.__decorate([g.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=c.__decorate([f.subclass("esri.views.3d.support.CombinedElevationProvider")],
a.CombinedElevationProvider);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),function(a,b,c,r,m,n,p,g){c=function(){function d(e,l){this.spatialReference=e;this._view=
l}var f=d.prototype;f.getElevation=function(e,l,A){return this._view.elevationProvider.getElevation(e,l,0,this.spatialReference,A)};f.queryElevation=function(){var e=b._asyncToGenerator(function*(l,A,t,w,u){return this._view.elevationProvider.queryElevation(l,A,0,this.spatialReference,u,t,w)});return function(l,A,t,w,u){return e.apply(this,arguments)}}();return d}();let h=function(){function d(e,l,A,t){this.spatialReference=l;this._getElevationQueryProvider=A;this._queries=[];this._queryOptions={...t,
ignoreInvisibleLayers:!0};this._frameTask=e.registerTask(p.TaskPriority.ELEVATION_QUERY,this)}var f=d.prototype;f.destroy=function(){this._frameTask.remove()};f.queryElevation=function(e,l,A,t=0){return new Promise((w,u)=>{const z={x:e,y:l,minDemResolution:t,result:{resolve:w,reject:u},signal:A};this._queries.push(z);n.onAbort(A,()=>{r.remove(this._queries,z);u(n.createAbortError())})})};f.runTask=function(){const e=this._queries;this._queries=[];const l=this._getElevationQueryProvider();if(l){var A=
e.map(z=>[z.x,z.y]),t=e.reduce((z,y)=>Math.min(z,y.minDemResolution),Infinity);A=new g({points:A,spatialReference:this.spatialReference});var w=1<e.length&&e.some(z=>!!z.signal)?new AbortController:null,u=m.isSome(w)?w.signal:e[0].signal;if(m.isSome(w)){let z=0;e.forEach(y=>n.onAbort(y.signal,()=>{z++;y.result.reject(n.createAbortError());z===e.length&&w.abort()}))}l.queryElevation(A,{...this._queryOptions,minDemResolution:t,signal:u}).then(z=>{e.forEach((y,B)=>{m.isSome(y.signal)&&y.signal.aborted?
y.result.reject(n.createAbortError()):y.result.resolve(z.geometry.points[B][2])})}).catch(z=>{e.forEach(y=>y.result.reject(z))})}else e.forEach(z=>z.result.reject())};b._createClass(d,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const e=this;return{update:()=>0<e._queries.length&&e.runTask()}}}]);return d}();a.ElevationQuery=h;a.ViewElevationProvider=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has",
"../../../core/time"],function(a,b){function c(){const m=!!a("esri-mobile"),n=!!a("ios"),p=b.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),lodCrossfadeUncoveredDuration:b.Milliseconds(0)},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:b.Milliseconds(0)},weatherFadeDuration:b.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:m?.8:1,polylineLodFactor:m?1.2:1.5,snapshotAvailable:!n,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),lodCrossfadeUncoveredDuration:p},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:m},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),
textureFadeDuration:p},weatherFadeDuration:p,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:m?600:750,additionalCacheMemory:m?0:150,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:m?1.2:2,polylineLodFactor:m?1.2:2,snapshotAvailable:!n,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,
lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),lodCrossfadeUncoveredDuration:p},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:p},weatherFadeDuration:p,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:m?900:1500,additionalCacheMemory:0,
frameRate:0,maximumRenderResolution:m?void 0:4096,maximumPixelRatio:m?1:void 0}}}let r=function(){function m(){}m.isValidProfile=function(n){return n in m.profiles};m.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};m.apply=function(n,p){n=m.profiles[n];p.graphics3D.maxTotalNumberOfFeatures=n.graphics3D.maxTotalNumberOfFeatures;p.graphics3D.maxTotalNumberOfPrimitives=n.graphics3D.maxTotalNumberOfPrimitives;p.graphics3D.polygonLodFactor=n.graphics3D.polygonLodFactor;
p.graphics3D.polylineLodFactor=n.graphics3D.polylineLodFactor;p.graphics3D.snapshotAvailable=n.graphics3D.snapshotAvailable;p.graphics3D.skipHighSymbolLods=n.graphics3D.skipHighSymbolLods;const g=p.sceneService.object,h=n.sceneService.object;g.lodFactor=h.lodFactor;g.lodCrossfadeinDuration=h.lodCrossfadeinDuration;g.lodCrossfadeoutDuration=h.lodCrossfadeoutDuration;g.lodCrossfadeUncoveredDuration=h.lodCrossfadeUncoveredDuration;p.sceneService.point.lodFactor=n.sceneService.point.lodFactor;p.sceneService.integratedMesh.lodFactor=
n.sceneService.integratedMesh.lodFactor;p.sceneService.pointCloud.lodFactor=n.sceneService.pointCloud.lodFactor;p.sceneService.uncompressedTextureDownsamplingEnabled=n.sceneService.uncompressedTextureDownsamplingEnabled;p.tiledSurface.lodBias=n.tiledSurface.lodBias;p.tiledSurface.angledSplitBias=n.tiledSurface.angledSplitBias;p.tiledSurface.reduceTileLevelDifferences=n.tiledSurface.reduceTileLevelDifferences;p.tiledSurface.textureFadeDuration=n.tiledSurface.textureFadeDuration;p.heatmap.pixelRatio=
n.heatmap.pixelRatio;p.heatmap.maxTotalNumberOfFeatures=n.heatmap.maxTotalNumberOfFeatures;p.weatherFadeDuration=n.weatherFadeDuration;p.antialiasingEnabled=n.antialiasingEnabled;p.physicallyBasedRenderingEnabled=n.physicalBasedRenderingEnabled;p.highQualityTransparency=n.highQualityTransparency;p.memoryLimit=n.memoryLimit;p.additionalCacheMemory=n.additionalCacheMemory;p.frameRate=n.frameRate;p.maximumRenderResolution=n.maximumRenderResolution;p.maximumPixelRatio=n.maximumPixelRatio};return m}();
r.debug={reset(){const m=c();for(const n in m)r.profiles[n]=m[n]}};(r||(r={})).profiles=c();return r})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){r=function(e){function l(){var A=e.apply(this,arguments)||this;A.color=new c([0,255,255]);A.haloColor=null;A.haloOpacity=1;A.fillOpacity=.25;A.shadowOpacity=.4;A.shadowColor=new c([0,0,0]);A.shadowDifference=.2;return A}a._inheritsLoose(l,e);l.toEngineOptions=function(A){const t=c.toUnitRGBA(A.color),w=m.isSome(A.haloColor)?c.toUnitRGBA(A.haloColor):t,u=c.toUnitRGBA(A.shadowColor);return{color:d.fromValues(t[0],t[1],t[2],t[3]),haloColor:d.fromValues(w[0],w[1],w[2],
w[3]),haloOpacity:A.haloOpacity,haloOpacityOccluded:.25*A.haloOpacity,fillOpacity:A.fillOpacity,fillOpacityOccluded:.25*A.fillOpacity,shadowOpacity:A.shadowOpacity,shadowColor:f.fromValues(u[0],u[1],u[2],u[3]),occludedShadowOpacity:A.shadowOpacity*(1-A.shadowDifference)}};return l}(r);b.__decorate([n.property({type:c})],r.prototype,"color",void 0);b.__decorate([n.property({type:c})],r.prototype,"haloColor",void 0);b.__decorate([n.property()],r.prototype,"haloOpacity",void 0);b.__decorate([n.property()],
r.prototype,"fillOpacity",void 0);b.__decorate([n.property()],r.prototype,"shadowOpacity",void 0);b.__decorate([n.property({type:c})],r.prototype,"shadowColor",void 0);b.__decorate([n.property()],r.prototype,"shadowDifference",void 0);return r=b.__decorate([h.subclass("esri.views.3d.support.HighlightOptions")],r)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(y){const B=new Float32Array(4);B[0]=y[0];B[1]=y[1];B[2]=y[2];B[3]=y[3];
return B}function r(y,B,C,k){const q=new Float32Array(4);q[0]=y;q[1]=B;q[2]=C;q[3]=k;return q}function m(y,B){return new Float32Array(y,B,4)}function n(){return b()}function p(){return r(1,1,1,1)}function g(){return r(1,0,0,0)}function h(){return r(0,1,0,0)}function d(){return r(0,0,1,0)}function f(){return r(0,0,0,1)}const e=b(),l=p(),A=g(),t=h(),w=d(),u=f(),z=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m,zeros:n,ones:p,unitX:g,unitY:h,unitZ:d,unitW:f,
ZEROS:e,ONES:l,UNIT_X:A,UNIT_Y:t,UNIT_Z:w,UNIT_W:u},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_W=u;a.UNIT_X=A;a.UNIT_Y=t;a.UNIT_Z=w;a.ZEROS=e;a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.ones=p;a.unitW=f;a.unitX=g;a.unitY=h;a.unitZ=d;a.vec4f32=z;a.zeros=n})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){c=function(){function e(l,A){this.spatialReference=A;this.unitInMeters=m.getMetersPerUnitForSR(this.spatialReference,n.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=p.getGeometryServiceURL(l&&l.get("portalItem")).catch(()=>{throw new r("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}e.prototype.toGeographic=function(){var l=b._asyncToGenerator(function*(A){var t=yield this._geometryServiceURLPromise;
let w=!0;Array.isArray(A[0])&&"number"!==typeof A[0]||(A=[A],w=!1);A=A.map(u=>u instanceof d?u:new d(u,this.spatialReference));A=new h({geometries:A,outSpatialReference:f.WGS84});t=(yield g.project(t,A)).map(u=>"point"===u.type?[u.x,u.y]:void 0);return w?t:t[0]});return function(A){return l.apply(this,arguments)}}();return e}();a.MapCoordsHelper=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,r,m,n,p){function g(){return h.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(f=null,e){if(c.geometryServiceUrl)return c.geometryServiceUrl;if(!f)throw new r("internal:geometry-service-url-not-configured");f="portal"in f?f.portal||m.getDefault():f;yield f.load({signal:e});e=f.helperServices?.geometry?.url;if(!e)throw new r("internal:geometry-service-url-not-configured");return e});return h.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(f,e,l=
null,A){l=yield g(l,A);const t=new p;t.geometries=[f];t.outSpatialReference=e;if((f=yield n.project(l,t,{signal:A}))&&Array.isArray(f)&&1===f.length)return f[0];throw new r("internal:geometry-service-projection-failed");});return d.apply(this,arguments)}a.getGeometryServiceURL=g;a.projectGeometry=function(f,e){return d.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,b,c,r,m,n,p,g){function h(){h=b._asyncToGenerator(function*(f,e,l){e=d(e);f=n.parseUrl(f);const A={...f.query,f:"json",...e.toJSON()},t=e.outSpatialReference,w=m.getJsonType(e.geometries[0]);e=n.asValidOptions(A,l);return c(f.path+"/project",e).then(({data:{geometries:u}})=>p.decodeGeometries(u,w,t))});return h.apply(this,arguments)}const d=r.ensureType(g);a.project=function(f,e,l){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(a,b,c,r,m,n,p,g){c=function(h){function d(f){f=h.call(this,f)||this;f.geometries=null;f.outSpatialReference=null;f.transformation=null;f.transformForward=
null;return f}a._inheritsLoose(d,h);d.prototype.toJSON=function(){const f=this.geometries.map(A=>A.toJSON()),e=this.geometries[0],l={};l.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());l.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference.toJSON());l.geometries=JSON.stringify({geometryType:g.getJsonType(e),geometries:f});this.transformation&&(l.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&
(l.transformForward=this.transformForward);return l};return d}(c.JSONSupport);b.__decorate([r.property()],c.prototype,"geometries",void 0);b.__decorate([r.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([r.property()],c.prototype,"transformation",void 0);b.__decorate([r.property()],c.prototype,"transformForward",void 0);return c=b.__decorate([p.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(t){function w(){var u=t.apply(this,arguments)||this;u.minTotalNumberOfFeatures=2E3;u.maxTotalNumberOfFeatures=5E4;u.maxTotalNumberOfPrimitives=17E5;u.snapshotAvailable=!0;u.polygonLodFactor=1;u.polylineLodFactor=1;u.skipHighSymbolLods=!1;return u}a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property()],h.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([m.property()],h.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([m.property()],
h.prototype,"maxTotalNumberOfPrimitives",void 0);b.__decorate([m.property()],h.prototype,"snapshotAvailable",void 0);b.__decorate([m.property()],h.prototype,"polygonLodFactor",void 0);b.__decorate([m.property()],h.prototype,"polylineLodFactor",void 0);b.__decorate([m.property()],h.prototype,"skipHighSymbolLods",void 0);h=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],h);let d=function(t){function w(){var u=t.apply(this,arguments)||this;u.lodFactor=1;return u}
a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property()],d.prototype,"lodFactor",void 0);d=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],d);let f=function(t){function w(){var u=t.apply(this,arguments)||this;u.lodCrossfadeinDuration=r.Milliseconds(0);u.lodCrossfadeoutDuration=r.Milliseconds(0);u.lodCrossfadeUncoveredDuration=r.Milliseconds(0);return u}a._inheritsLoose(w,t);return w}(d);f=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],
f);let e=function(t){function w(){var u=t.apply(this,arguments)||this;u.object=new f;u.point=new d;u.integratedMesh=new d;u.pointCloud=new d;u.uncompressedTextureDownsamplingEnabled=!1;return u}a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property({type:f})],e.prototype,"object",void 0);b.__decorate([m.property({type:d})],e.prototype,"point",void 0);b.__decorate([m.property({type:d})],e.prototype,"integratedMesh",void 0);b.__decorate([m.property({type:d})],e.prototype,"pointCloud",void 0);b.__decorate([m.property()],
e.prototype,"uncompressedTextureDownsamplingEnabled",void 0);e=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],e);let l=function(t){function w(){var u=t.apply(this,arguments)||this;u.lodBias=0;u.angledSplitBias=1;u.reduceTileLevelDifferences=!0;u.textureFadeDuration=r.Milliseconds(400);return u}a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property()],l.prototype,"lodBias",void 0);b.__decorate([m.property()],l.prototype,"angledSplitBias",void 0);b.__decorate([m.property()],
l.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([m.property()],l.prototype,"textureFadeDuration",void 0);l=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],l);let A=function(t){function w(){var u=t.apply(this,arguments)||this;u.pixelRatio=1;u.maxTotalNumberOfFeatures=5E4;return u}a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property()],A.prototype,"pixelRatio",void 0);b.__decorate([m.property()],A.prototype,"maxTotalNumberOfFeatures",void 0);
A=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],A);c=function(t){function w(){var u=t.apply(this,arguments)||this;u.graphics3D=new h;u.sceneService=new e;u.tiledSurface=new l;u.heatmap=new A;u.weatherFadeDuration=r.Milliseconds(400);u.antialiasingEnabled=!0;u.physicallyBasedRenderingEnabled=!1;u.highQualityTransparency=!0;u.memoryLimit=void 0;u.additionalCacheMemory=void 0;u.frameRate=void 0;u.maximumRenderResolution=void 0;u.maximumPixelRatio=void 0;return u}
a._inheritsLoose(w,t);return w}(c);b.__decorate([m.property({type:h})],c.prototype,"graphics3D",void 0);b.__decorate([m.property({type:e})],c.prototype,"sceneService",void 0);b.__decorate([m.property({type:l})],c.prototype,"tiledSurface",void 0);b.__decorate([m.property({type:A})],c.prototype,"heatmap",void 0);b.__decorate([m.property()],c.prototype,"weatherFadeDuration",void 0);b.__decorate([m.property()],c.prototype,"antialiasingEnabled",void 0);b.__decorate([m.property()],c.prototype,"physicallyBasedRenderingEnabled",
void 0);b.__decorate([m.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([m.property()],c.prototype,"memoryLimit",void 0);b.__decorate([m.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([m.property()],c.prototype,"frameRate",void 0);b.__decorate([m.property()],c.prototype,"maximumRenderResolution",void 0);b.__decorate([m.property()],c.prototype,"maximumPixelRatio",void 0);return c=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],
c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(B){if(u.isSpatialReferenceSupported(B,w.ViewingMode.Global))return 1;B=f.renderSRFromViewSR(!1,B);return m.getMetersPerUnitForSR(B)}let y=function(){function B(k,q,x,v){this.viewingMode=k;this.spatialReference=q;this.unitInMeters=x;this._coordinateSystem=v;this._tmpCoordinateSystem=f.create(v)}var C=B.prototype;C.getAltitude=function(k){return f.altitudeAt(this._coordinateSystem,k)};C.setAltitude=function(k,q,x=k){return f.setAltitudeAt(this._coordinateSystem,
x,q,k)};C.setAltitudeOfTransformation=function(k,q){f.setAltitudeOfTransformation(this._coordinateSystem,q,k,q)};C.worldUpAtPosition=function(k,q){return f.normalAt(this._coordinateSystem,k,q)};C.worldBasisAtPosition=function(k,q,x){return f.axisAt(this._coordinateSystem,k,q,x)};C.basisMatrixAtPosition=function(k,q){const x=this.worldBasisAtPosition(k,d.Axis.X,A.sv3d.get()),v=this.worldBasisAtPosition(k,d.Axis.Y,A.sv3d.get());k=this.worldBasisAtPosition(k,d.Axis.Z,A.sv3d.get());n.set(q,x[0],x[1],
x[2],0,v[0],v[1],v[2],0,k[0],k[1],k[2],0,0,0,0,1);return q};C.headingAtPosition=function(k,q){const x=this.worldUpAtPosition(k,A.sv3d.get());k=this.worldBasisAtPosition(k,d.Axis.Y,A.sv3d.get());q=l.angleAroundAxis(q,k,x);return c.rad2deg(q)};C.intersectManifoldClosestSilhouette=function(k,q,x){f.elevate(this._coordinateSystem,q,this._tmpCoordinateSystem);f.intersectRayClosestSilhouette(this._tmpCoordinateSystem,k,x);return x};C.intersectManifold=function(k,q,x){f.elevate(this._coordinateSystem,q,
this._tmpCoordinateSystem);q=A.sv3d.get();return f.intersectRay(this._tmpCoordinateSystem,k,q)?p.copy(x,q):null};C.intersectInfiniteManifold=function(k,q,x){if(this.viewingMode===w.ViewingMode.Global)return this.intersectManifold(k,q,x);f.elevate(this._coordinateSystem,q,this._tmpCoordinateSystem);q=this._tmpCoordinateSystem.value;const v=A.sv3d.get();return e.intersectRay(q.plane,k,v)?p.copy(x,v):null};C.toRenderCoords=function(k,q,x){return t.isDehydratedPoint(k)?h.projectPointToVector(k,q,this.spatialReference):
h.projectVectorToVector(k,q,x,this.spatialReference)};C.fromRenderCoords=function(k,q,x=null){return t.isDehydratedPoint(q)?(r.isSome(x)&&(q.spatialReference=x),h.projectVectorToDehydratedPoint(k,this.spatialReference,q)):g.isVec3(q)?h.projectVectorToVector(k,this.spatialReference,q,x)?q:null:h.projectVectorToPoint(k,this.spatialReference,q)};B.create=function(k,q){switch(k){case w.ViewingMode.Local:return new B(w.ViewingMode.Local,q,m.getMetersPerUnitForSR(q),f.createLocal());case w.ViewingMode.Global:return new B(w.ViewingMode.Global,
q,1,f.createGlobal(q))}};B.renderUnitScaleFactor=function(k,q){return z(k)/z(q)};b._createClass(B,[{key:"extent",set:function(k){k&&f.setExtent(this._coordinateSystem,k,this._coordinateSystem)}}]);return B}();a.RenderCoordsHelper=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(a,b){function c(m){return b.isFloat32Array(m)&&3<=m.length}function r(m){return(b.isFloat64Array(m)||
Array.isArray(m))&&3<=m.length}a.isVec3=function(m){return c(m)||r(m)};a.isVec3f32=c;a.isVec3f64=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){r=function(y){function B(){var C=y.apply(this,arguments)||this;C.updating=!1;return C}b._inheritsLoose(B,y);return B}(r);c.__decorate([d.property({readOnly:!0})],r.prototype,"updating",void 0);r=c.__decorate([l.subclass("esri.views.3d.support.ResourceControllerMain")],r);let z=function(y){function B(){var k=y.apply(this,arguments)||this;k._scheduler=null;k._memoryController=null;k._streamDataLoader=null;k._scheduleTask=u.ImmediateTask;k._handles=new m;k._frameTask=
null;return k}b._inheritsLoose(B,y);var C=B.prototype;C.initialize=function(){this._scheduler=u.newScheduler();this._memoryController=t.newMemoryController(this.view);this._streamDataLoader=new w.StreamDataLoader;this._streamDataLoader.setup(A.maxDownloadSlots,A.downloadSlotsPerClient,this._scheduler);this._handles.add([p.watch(()=>this.view.state?.mode,k=>this._scheduler.state=k,p.sync),p.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=g.addFrameTask({update:k=>
this._frame(k)});this._scheduleTask=this._scheduler.registerTask(u.TaskPriority.RESOURCE_CONTROLLER)};C.destroy=function(){this._handles=n.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=n.removeMaybe(this._frameTask);this._streamDataLoader=n.destroyMaybe(this._streamDataLoader);this._memoryController=n.destroyMaybe(this._memoryController);this._scheduler=n.destroyMaybe(this._scheduler)};C.schedule=function(k,q,x){return this._scheduleTask.schedule(k,q,x)};C.createStreamDataRequester=
function(k){const q=this._streamDataLoader;return{request(x,v,D){return q.request(x,v,k,D)},get busy(){return!q.hasDownloadSlots(k)}}};C._frame=function(k){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(h.secondsFromMilliseconds(k.deltaTime)),!this._scheduler))return;this._scheduler.updateBudget(k)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};C._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};
b._createClass(B,[{key:"updating",get:function(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._scheduleTask?.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:k=>this._streamDataLoader.test.loadQueue.getStatsForType(k)}}}]);return B}(r);c.__decorate([d.property({constructOnly:!0})],z.prototype,"view",void 0);c.__decorate([d.property()],
z.prototype,"_scheduler",void 0);c.__decorate([d.property()],z.prototype,"_memoryController",void 0);c.__decorate([d.property()],z.prototype,"_streamDataLoader",void 0);c.__decorate([d.property()],z.prototype,"_scheduleTask",void 0);c.__decorate([d.property({readOnly:!0})],z.prototype,"updating",null);z=c.__decorate([l.subclass("esri.views.3d.support.ResourceControllerImpl")],z);a.INTERACTING_TIMEOUT=100;a.newResourceController=function(y){return new z({view:y})};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();
a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/support/MemoryManagedLayerView".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){let l=function(A){function t(u){u=A.call(this,u)||this;u._quality=1;u._memoryUsed=0;u._updating=!1;u.minQuality=.1;u._stableQuality=0;u._downscaleMemoryUsed=0;u._canFastRecover=!1;u._memoryPredicted=0;u._cacheStorage=new p.MemCacheStorage;u._warnMemoryUsage=null;u._numQualityChanges=0;u._maxMemory=500;u._additionalCacheMemory=100;return u}b._inheritsLoose(t,A);var w=t.prototype;w.destroy=function(){this._cacheStorage.destroy()};w.newCache=function(u,z){return new p.MemCache(u,
this._cacheStorage,z)};w.resetStableQuality=function(){this._stableQuality=0};w.disableMemCache=function(){this.additionalCacheMemory=-4096};w.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var u=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(u){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=
0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,u=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=
this._quality,u=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=u}};w._updateQuality=function(u){u=Math.min(Math.max(u,this.minQuality),1);if(u===this._quality)return!1;this._quality=u;++this._numQualityChanges;return!0};w._layersUpdating=function(){return this.view.allLayerViews.some(u=>!!u.updating)};w._updateMemory=function(){let u=0,z=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(u+=this.view.basemapTerrain.getUsedMemory());
var y=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;n.isSome(y)&&(u+=y.usedMemory);this.view.allLayerViews&&this.view.allLayerViews.forEach(C=>{if(e.isMemoryManagedLayerView(C)){const k=C.ignoresMemoryFactor()?this._quality:1;u+=C.getUsedMemory()*k;z+=C.getUnloadedMemory()*k}});var B=n.isNone(this._warnMemoryUsage)||Math.round(10*u)!==Math.round(10*this._warnMemoryUsage);y=1048576*this.maxMemory;if(u>y&&B){this._warnMemoryUsage=u;B=k=>(k/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB";const C=Math.round(100*this._quality);m.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${B(y)} Current: ${B(u)} Projected: ${B(u+z)} Quality: ${C}%`)}this._memoryUsed=u/y;this._memoryPredicted=(u+z)/y;this._cacheStorage.maxSize=Math.max(0,y-u+1048576*this.additionalCacheMemory)};b._createClass(t,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(u){null==u||0>=u||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<u&&
this._updateQuality(1),this._maxMemory=u)}},{key:"additionalCacheMemory",get:function(){return this._additionalCacheMemory},set:function(u){null!=u&&0<=u&&(this._additionalCacheMemory=u)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){const u=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const z=u._numQualityChanges;u._numQualityChanges=
0;return z}}}}]);return t}(r);c.__decorate([g.property({constructOnly:!0})],l.prototype,"view",void 0);c.__decorate([g.property()],l.prototype,"maxMemory",null);c.__decorate([g.property()],l.prototype,"additionalCacheMemory",null);c.__decorate([g.property()],l.prototype,"memoryFactor",null);c.__decorate([g.property()],l.prototype,"updating",null);c.__decorate([g.property()],l.prototype,"usedMemory",null);c.__decorate([g.property()],l.prototype,"_quality",void 0);c.__decorate([g.property()],l.prototype,
"_memoryUsed",void 0);c.__decorate([g.property()],l.prototype,"_updating",void 0);c.__decorate([g.property()],l.prototype,"_stableQuality",void 0);c.__decorate([g.property()],l.prototype,"_maxMemory",void 0);c.__decorate([g.property()],l.prototype,"_additionalCacheMemory",void 0);l=c.__decorate([f.subclass("esri.views.3d.support.MemoryControllerImpl")],l);a.newMemoryController=function(A){return new l({view:A})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(C){if(2>C.byteLength)return"unknown";C=new Uint8Array(C,0,C.byteLength);return 137===C[0]&&80===C[1]?"image/png":71===C[0]&&73===C[1]?"image/gif":66===C[0]&&77===C[1]?"image/bmp":255===C[0]&&216===C[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(C){function k(){var x=C.apply(this,arguments)||this;x._tasks=new Map;x._onLoadQueue=[];x._doneQueue=[];x.updating=!1;return x}b._inheritsLoose(k,C);var q=k.prototype;q.setup=function(x,v,D){this._loadQueue=
new A.AsyncWorkerQueue((F,G)=>this._startLoading(F,G),(F,G)=>this._doneLoadingCB(F,G),x,v);D&&(this._frameTask=D.registerTask(w.TaskPriority.STREAM_DATA_LOADER,this))};q.destroy=function(){this._frameTask=h.removeMaybe(this._frameTask);this._tasks.forEach(x=>h.abortMaybe(x.abortController));this._loadQueue=h.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};q.hasDownloadSlots=function(x){return this._loadQueue.hasQuota(x)};q.request=function(x,v,D,F={}){const G=d.createResolver();
G.__signal=h.isSome(F)?F.signal:null;const J=this._createOrUpdateTask(x,v,D,F,G);d.onAbort(F,()=>this._cancelRequest(J,G));return G.promise};q._createTask=function(x,v,D,F,G,J){x=new B(x,v,D,F,G);this._updateTask(x,J);this._tasks.set(G,x);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(x);return x};q._cancelRequest=function(x,v){n.removeUnordered(x.resolvers,v);v.reject(d.createAbortError());0===x.resolvers.length&&(x.status===a.TaskStatus.DOWNLOADING&&(x.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(x),x.abortController?.abort(),x.request=null,x.abortController=null),x.status=a.TaskStatus.CANCELLED,this._tasks.delete(x.key),0===this._tasks.size&&this._set("updating",!1))};q._updateTask=function(x,v){x.resolvers.push(v)};q._createOrUpdateTask=function(x,v,D,F,G){const J=`${h.isSome(F)&&F.uid||x}:${v}:${D}`,L=this._tasks.get(J);return L?(this._updateTask(L,G),L):this._createTask(x,F,v,D,J,G)};q._doneLoadingCB=function(x,v){this._loadQueue&&(t.assert(x.status===a.TaskStatus.DOWNLOADING),
x.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:x,err:v}):this._doneLoading(x,v))};q.runTask=function(x){for(;!x.done&&0<this._onLoadQueue.length;){var v=this._onLoadQueue.shift();d.throwIfAborted(v.task.abortController);v.task.abortController=null;v.callback(v.task);x.madeProgress()}for(;!x.done&&0<this._doneQueue.length;)v=this._doneQueue.shift(),v.task.status!==a.TaskStatus.DOWNLOADED&&(v.err=v.err||d.createAbortError()),this._doneLoading(v.task,v.err),x.madeProgress()};
q._doneLoading=function(x,v){if(v&&!d.isAbortError(v)&&0<x.numRetries)--x.numRetries,this._loadQueue.push(x);else{var D=x.result instanceof HTMLImageElement?0:x.resolvers.length;for(const F of x.resolvers)if(v)d.isAbortError(v)?F.reject(v):F.reject(new p("stream-data-loader:request-error",`Failed to request resource at '${x.url}'. ${v}`,{url:x.url,error:v}));else{--D;const G=0>=D?x.result:g.clone(x.result);F.resolve(G)}this._tasks.delete(x.key);0===this._tasks.size&&this._set("updating",!1)}};q._startLoading=
function(x,v){if(x.status===a.TaskStatus.CANCELLED)return!1;x.startTime=performance.now();x.status=a.TaskStatus.DOWNLOADING;let D,F;switch(x.docType){case "binary":F="array-buffer";D=0;break;case "image":F="image";break;case "image+type":F="array-buffer";break;default:F="json"}x.abortController=new AbortController;const G=x.abortController.signal;x.request=r(x.url,{...x.options,responseType:F,timeout:D,signal:G});let J=()=>{};const L=O=>{x.duration=performance.now()-x.startTime;x.size=O instanceof
ArrayBuffer?O.byteLength:x.size||0;x.result=O;this._frameTask?this._onLoadQueue.push({callback:v,task:x}):(x.abortController=null,v(x))},K=O=>{x.status===a.TaskStatus.DOWNLOADING&&v(x,O);J()};if("image+type"!==x.docType)return x.request.then(O=>L(O.data),K),!0;x.request.then(O=>{O=O.data;const P=u(O);F="image";x.size=O.byteLength;if("unknown"===P)x.request=r(x.url,{responseType:F,timeout:D,signal:G}),x.request.then(H=>L(H.data),K);else{O=new Blob([O],{type:P});var N=window.URL.createObjectURL(O);
J=()=>window.URL.revokeObjectURL(N);x.request=r(N,{responseType:F,timeout:D,signal:G});x.request.then(H=>L(new y(H.data,P,J)),K)}},K);return!0};b._createClass(k,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return k}(m);c.__decorate([f.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([l.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const z={numRetries:0};let y=function(){function C(k,q,x){this.image=k;this.type=q;this.release=x}b._createClass(C,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return C}(),B=function(C){function k(q,x,v,D,F){D=C.call(this,D)||this;D.url=q;D.options=x;D.docType=v;D.key=F;D.result=null;D.status=a.TaskStatus.QUEUED;D.request=null;D.abortController=null;D.resolvers=[];D.startTime=0;D.numRetries=z.numRetries;return D}b._inheritsLoose(k,C);return k}(A.BaseTask);
a.TaskStatus=void 0;(function(C){C[C.QUEUED=1]="QUEUED";C[C.DOWNLOADING=2]="DOWNLOADING";C[C.DOWNLOADED=3]="DOWNLOADED";C[C.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=y;a.test=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let r=function(p){this.typeWorkerQuota=p;
this.tasks=[];this.numWorkers=0;this.statistics=new m},m=function(){this.speed=this.duration=this.size=this.requests=0},n=function(){function p(h,d,f,e){this._workerFunc=h;this._callbackFunc=d;this._maxTotalNumWorkers=f;this._totalNumWorkers=0;this._clients=e.map(l=>new r(l))}var g=p.prototype;g.destroy=function(){this._clients.length=0};g.hasQuota=function(h){return(h=this._clients[h])?this._totalNumWorkers<this._maxTotalNumWorkers||h.numWorkers+h.tasks.length<h.typeWorkerQuota:!1};g.push=function(h){const d=
this._clients[h.client];d&&(this._totalNumWorkers<this._maxTotalNumWorkers?(d.numWorkers++,this._totalNumWorkers++,this._workerFunc(h,(f,e)=>this._taskCallback(f,e))):d.tasks.push(h))};g.cancel=function(h){this._taskFinished(h);h._cancelled=!0};g._taskFinished=function(h){const d=this._clients[h.client];this._totalNumWorkers--;d.numWorkers--;d.statistics.requests++;d.statistics.size+=h.size||0;d.statistics.duration+=h.duration||0;d.statistics.speed=0<d.statistics.duration?d.statistics.size/d.statistics.duration:
0;c.assert(0<=d.numWorkers);this._next()};g._next=function(){for(const h of this._clients)if(h&&h.numWorkers<h.typeWorkerQuota&&this._processQueue(h))return;for(const h of this._clients)if(h&&this._processQueue(h))break};g._processQueue=function(h){for(;0<h.tasks.length;)if(this._workerFunc(h.tasks.shift(),(d,f)=>this._taskCallback(d,f)))return h.numWorkers++,this._totalNumWorkers++,!0;return!1};g._taskCallback=function(h,d){h._cancelled||(this._callbackFunc(h,d),this._taskFinished(h))};g.getStatsForType=
function(h){return(h=this._clients[h])?{quota:h.typeWorkerQuota,workers:h.numWorkers,queueSize:h.tasks.length,requestStats:h.statistics}:null};b._createClass(p,[{key:"test",get:function(){const h=this;return{set workerFunc(d){h._workerFunc=d}}}}]);return p}();a.AsyncWorkerQueue=n;a.BaseTask=function(p){this.client=p;this._cancelled=!1;this.duration=this.size=0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations",
"../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,r,m){return function(n){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];if(b.isSome(n.resourceController)){var p=n.resourceController.memoryController;this.totalMemory=p.maxMemory*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(p.usedMemory*this.totalMemory);this.quality=p.memoryFactor;
this.load=n.resourceController.scheduler.load}this.terrainMemory=n.basemapTerrain?n.basemapTerrain.getUsedMemory():0;p=n._stage&&n._stage.renderView&&n._stage.renderView.edgeView;this.edgesMemory=b.isSome(p)?p.usedMemory:0;n.allLayerViews.items.forEach(g=>{(c.isMemoryManagedLayerView(g)||m.isSurfaceLayerView(g))&&this.layerPerformanceInfos.push(new r(g,n))});this.layerPerformanceInfos.sort((g,h)=>h.memory-g.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView",
"../terrain/terrainUtils"],function(a,b){return function(c,r){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=c.layer;this.memory=b.isSurfaceLayerView(c)?r.basemapTerrain.getUsedMemoryForLayerView(c):c.getUsedMemory();a.isPerformanceInfoLayerView(c)&&(c=c.performanceInfo,this.displayedNumberOfFeatures=c.displayedNumberOfFeatures,this.maximumNumberOfFeatures=c.maximumNumberOfFeatures,this.totalNumberOfFeatures=c.totalNumberOfFeatures)}})},
"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./interfaces ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(q){return"imagery-tile"===q?.type||"wcs"===q?.type}function e(q){return"imagery-tile-3d"===q?.type}function l(q){return"tile-3d"===q?.type}function A(q){return"vector-tile-3d"===q?.type}function t(q){return"wmts-3d"===q?.type}function w(q){return"elevation-3d"===q?.type}function u(q){return q&&(l(q)||e(q)||A(q)||t(q))}function z(q,x,v,D){return C[D].checkIfTileInfoSupportedForViewSR(q,v,x)}function y(q,x,v){q=m.getTileMaxtrixSetFromActiveLayer(q);if(c.isSome(q))if(b.isCollection(q)){if(q=
q.find(D=>null==z(D.tileInfo,D.fullExtent,x,v)))return{tileInfo:q.tileInfo,fullExtent:q.fullExtent}}else return{tileInfo:q.tileInfo,fullExtent:q.fullExtent};return{tileInfo:null,fullExtent:null}}function B(q){return q.isWGS84||q.isWebMercator||r.isCGCS2000(q)||!r.isEarth(q)}const C={[n.ViewingMode.Global]:d.terrainUtilsSpherical,[n.ViewingMode.Local]:h.terrainUtilsPlanar};a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.ENABLE_WATERPROOFNESS_TESTS=!1;const k={force512VTL:!1};h=[g.NeighborIndex.NORTH,g.NeighborIndex.EAST,
g.NeighborIndex.SOUTH,g.NeighborIndex.WEST];d=[g.NeighborIndex.NORTH_EAST,g.NeighborIndex.SOUTH_EAST,g.NeighborIndex.SOUTH_WEST,g.NeighborIndex.NORTH_WEST];a.almostEquals=function(q,x,v=1E-5){return Math.abs(q-x)<v};a.checkIfTileInfoSupportedForView=z;a.enableTerrainInternalChecks=function(q){a.ENABLE_TERRAIN_INTERNAL_CHECKS=q};a.enableTerrainWaterproofnessChecks=function(q){a.ENABLE_WATERPROOFNESS_TESTS=q;a.ENABLE_TERRAIN_INTERNAL_CHECKS=a.ENABLE_TERRAIN_INTERNAL_CHECKS||q};a.eps=1E-5;a.getLayerWithExtentRange=
function(q){return e(q)?{fullExtent:q.fullExtent,minScale:q.layer.minScale,maxScale:q.layer.maxScale,tilemapCache:null}:q.layer};a.getTileInfoAndExtentFromWMTSLayer=y;a.getTiledLayerInfo=function(q,x,v){var D=null;let F=null;if("wmts"===q?.type)q=y(q,x,v),D=q.tileInfo,F=q.fullExtent;else if(F=f(q)?q.getCompatibleFullExtent(x):q.fullExtent,D=v===n.ViewingMode.Local,f(q))D=q.getCompatibleTileInfo(x,F,D);else if("vector-tile"===q?.type){D=D&&!B(x)||k.force512VTL;const G=q.tileInfo.spatialReference.isGeographic;
D=D?q.tileInfo:q.tileInfo.getOrCreateCompatible(256,G?1:2)}else D=q.tileInfo;return c.isSome(D)&&c.isSome(F)&&null==z(D,F,x,v)?{tileInfo:D,fullExtent:F}:null};a.internalAssert=function(q,x){if(a.ENABLE_TERRAIN_INTERNAL_CHECKS&&!q)throw q=Error().stack.slice(5),console.warn("Terrain internal: "+(x?x:"")+" at "+q),Error("Assertion failed"+(x?": "+x:""));};a.isBlendableLayerView=function(q){return q&&(l(q)||t(q)||e(q)||A(q))};a.isEast=function(q){return q===g.NeighborIndex.NORTH_EAST||q===g.NeighborIndex.EAST||
q===g.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=w;a.isGroupLayer=function(q){return"group"===q?.type};a.isGroupLayerView=function(q){return"group"===q?.type};a.isImageryTileLayerView=e;a.isImageryTileRenderInfo=function(q){q=q?.sourceLayerInfo?.data;return c.isSome(q)&&"type"in q&&"raster-tile"===q.type};a.isMapTileLayerView=u;a.isNorth=function(q){return q===g.NeighborIndex.NORTH_EAST||q===g.NeighborIndex.NORTH||q===g.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(q){return q===g.NeighborIndex.NORTH_WEST||
q===g.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=f;a.isRasterTileRenderInfo=function(q){q=q?.sourceLayerInfo?.data;return q instanceof HTMLImageElement||q instanceof p.ImageWithType||q instanceof HTMLCanvasElement||q instanceof ImageData};a.isSouth=function(q){return q===g.NeighborIndex.SOUTH_EAST||q===g.NeighborIndex.SOUTH||q===g.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(q){return u(q)||w(q)};a.isTextureTileRenderInfo=function(q){q=q?.sourceLayerInfo?.data;return c.isSome(q)&&
"type"in q&&"tile-texture"===q.type};a.isTileLayerView=l;a.isVectorTileLayerView=A;a.isVectorTileRenderInfo=function(q){q=q?.sourceLayerInfo?.data;return c.isSome(q)&&"type"in q&&"vector-tile"===q.type};a.isWMTSLayerView=t;a.isWest=function(q){return q===g.NeighborIndex.NORTH_WEST||q===g.NeighborIndex.WEST||q===g.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(q){return q===g.NeighborIndex.NORTH_WEST||q===g.NeighborIndex.SOUTH_WEST};a.lij2s=function(q){return"["+q[0]+","+q[1]+","+q[2]+"]"};a.neighborCornerIndices=
d;a.neighborEdgeIndices=h;a.oppositeCorner=function(q){return q===g.NeighborIndex.NORTH_EAST?g.NeighborIndex.SOUTH_WEST:q===g.NeighborIndex.NORTH_WEST?g.NeighborIndex.SOUTH_EAST:q===g.NeighborIndex.SOUTH_WEST?g.NeighborIndex.NORTH_EAST:g.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(q){return q===g.NeighborIndex.NORTH?g.NeighborIndex.SOUTH:q===g.NeighborIndex.EAST?g.NeighborIndex.WEST:q===g.NeighborIndex.SOUTH?g.NeighborIndex.NORTH:g.NeighborIndex.EAST};a.releaseTileData=function(q){c.isSome(q)&&
"release"in q&&q.release();return null};a.test=k;a.useFetchTileForLayer=function(q){return q.fetchTile&&!1!==q.hasOverriddenFetchTile};a.v32s=function(q){return"("+q[0]+","+q[1]+","+q[2]+")"};a.vtlAssumes256PixelSizeAsDefault=B;a.weakAssert=function(q,x){q||console.warn("Terrain: "+x)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(z,y,B=0){z=z.extent;return c.isNone(z)?!1:0===B?p.containsPoint(z,y):p.containsPointWithMargin(z,y,B*Math.min(z[2]-z[0],z[3]-z[1]))}function f(z,y,B,C){r.copy(A,B);A[C]=y[C];C=r.subtract(A,A,y);var k=r.subtract(t,z,y);k=r.dot(k,C);const q=r.dot(C,C);y=0>=k?y:q<=k?B:r.add(A,y,r.scale(C,C,k/q));z=r.subtract(A,z,y);return Math.PI/2-Math.atan(z[2]/Math.sqrt(z[0]*z[0]+z[1]*z[1]))}function e(z,y,B){z=z.extent;if(c.isNone(z))return 0;w[0]=z[0];w[1]=z[1];w[2]=B;u[0]=
z[2];u[1]=z[3];u[2]=B;z=B=Infinity;y[0]<w[0]?B=f(y,w,u,0):y[0]>u[0]&&(B=f(y,u,w,0));y[1]<w[1]?z=f(y,w,u,1):y[1]>u[1]&&(z=f(y,u,w,1));return Math.min(B,z)}function l(z,y,B){if(c.isNone(z))return h.getMissingTileInfoError();if(z.spatialReference.isGeographic&&!n.canProjectToWGS84ComparableLonLat(z.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var C=h.TilingScheme.checkUnsupported(z);if(c.isSome(C))return C;
if(c.isNone(B))return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var k=z.lods;C=k[0].resolution*2**k[0].level;var q=[C*z.size[0],C*z.size[1]];const x=[z.origin.x,z.origin.y];B=p.fromExtent(B);const v=p.create();h.TilingScheme.computeRowColExtent(B,q,x,v);q=(v[2]-v[0])*(v[3]-v[1]);q>g.MAX_ROOT_TILES?(k=k[0].scale*2**k[0].level,C=Math.max((B[3]-B[1])/z.size[1],(B[2]-B[0])/z.size[0])*k/C,B=Math.floor(Math.log(C)/Math.log(10)),C=Math.ceil(C/10**B)*10**B,C=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(k).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+C.toLocaleString()+".",{level0Scale:k,suggestedLevel0Scale:C,requiredNumRootTiles:q,allowedNumRootTiles:g.MAX_ROOT_TILES})):C=null}if(C)return C;z=z.spatialReference;return!c.isSome(y)||z.equals(y)||y.isWGS84&&z.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const A=m.create(),
t=m.create(),w=m.create(),u=m.create();m=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:d,tiltToExtentEdge:e,checkIfTileInfoSupportedForViewSR:l},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=l;a.isInsideExtent=d;a.terrainUtilsPlanar=m;a.tiltToExtentEdge=e})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,r,m,n){function p(){return!0}function g(){return 0}function h(f,e){if(c.isNone(f))return n.getMissingTileInfoError();const l=f.lods.length-1,A=f.spatialReference,t=r.canProjectToWGS84ComparableLonLat(A)||m.isMars(A)||m.isMoon(A);if(A.isWebMercator){if(!n.TilingScheme.makeWebMercatorAuxiliarySphere(l).compatibleWith(f))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(t){if(!n.TilingScheme.makeGCSWithTileSize(f.spatialReference,
f.size[0],l).compatibleWith(f))return f.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c.isSome(e)&&!f.spatialReference.equals(e))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const d=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:p,tiltToExtentEdge:g,checkIfTileInfoSupportedForViewSR:h},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=h;a.isInsideExtent=p;a.terrainUtilsSpherical=d;a.tiltToExtentEdge=g})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/projectionEllipsoid ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(){function w(z){this.streamDataRequester=this.textures=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=z.viewState;this._view=z.view;this._pointsOfInterest=z.pointsOfInterest;this.streamDataRequester=z.resourceController.createStreamDataRequester(d.ClientType.SYMBOLOGY);this.objectResourceCache=new h.ObjectResourceCache((B,C)=>z.resourceController.memoryController.newCache(B,C));this.textures=
new f.StreamTextureCollection(this.streamDataRequester,z.view._stage,{preMultiplyAlpha:!0,wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE}},z.resourceController.scheduler);const y=g.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=e.getSettings(z.viewingMode,y);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(z.viewingMode,y)}var u=w.prototype;u.destroy=function(){n.destroyMaybe(this.textures);this.streamDataRequester=
this.textures=null};u.addGraphicsOwner=function(z){if(!z)return m.makeHandle();this._graphicsOwners.push(z);const y=p.watch(()=>z.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return m.makeHandle(()=>{y.remove();c.removeUnordered(this._graphicsOwners,z);this._updateScreenSizePerspectiveEnabled()})};u._updateScreenSizePerspectiveEnabled=function(){var z=this._graphicsOwners.some(y=>!0===y.layer?.screenSizePerspectiveEnabled);
z&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new r,z=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([p.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,z,p.sync),this._viewState.events.on("camera-projection-changed",z)]),this._updateScreenSizePerspectiveSettings()):!z&&this._screenSizePerspectiveHandles&&(this._screenSizePerspectiveHandles.destroy(),this._screenSizePerspectiveHandles=null)};u._updateScreenSizePerspectiveSettings=
function(){t.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance;t.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(t);this.screenSizePerspectiveSettingsLabels.update(t);this._view._stage.renderView.requestRender()};b._createClass(w,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}]);return w}();const t={distance:0,fovY:0};a.SharedSymbolResources=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,c,r,m,n,p){let g=function(){function h(f){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=f("gltf-resources",()=>{});this._wosrMemCache=f("wosr-resources",()=>{})}var d=h.prototype;d.destroy=function(){this._gltfLoading.forEach(f=>
f.abortController.abort());this._wosrLoading.forEach(f=>f.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()};d.loadGLTF=function(f,e,l){const A=l?`gltfPBR:${f}`:`gltf:${f}`,t=this._gltfMemCache.get(A);return c.isSome(t)?Promise.resolve(t):this._loadOnce(this._gltfLoading,this._gltfMemCache,A,w=>n.loadGLTF(new m.DefaultLoadingContext(w.streamDataRequester),f,w,l),e)};d.loadWOSR=function(f,e){const l=`wosr:${f}:${e.disableTextures}`,A=this._wosrMemCache.get(l);return c.isSome(A)?
Promise.resolve(A):this._loadOnce(this._wosrLoading,this._wosrMemCache,l,t=>p.load(f,t),e)};d._loadOnce=function(){var f=b._asyncToGenerator(function*(e,l,A,t,w){r.throwIfAborted(w);const u=r.onAbort(w,()=>this._abortLoad(e,A));var z=e.get(A);z?z.refCount++:(z=new AbortController,t=t({...w,signal:z.signal}),z={refCount:1,abortController:z,promise:t},e.set(A,z));try{const y=yield z.promise;l.put(A,y,y.size);e.delete(A);r.throwIfAborted(w);return y}finally{c.removeMaybe(u)}});return function(e,l,A,
t,w){return f.apply(this,arguments)}}();d._abortLoad=function(f,e){const l=f.get(e);c.isSome(l)&&0<--l.refCount||(f.delete(e),c.isSome(l)&&l.abortController.abort())};return h}();a.ObjectResourceCache=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,r,m,n,p,g){n=function(h){function d(e,l,A,t){l=h.call(this,l,t)||this;l._streamDataRequester=e;l._parameters=A;return l}b._inheritsLoose(d,h);var f=d.prototype;f.fromUrl=function(){var e=b._asyncToGenerator(function*(l,A,t){var w=this;r.throwIfAborted(t);const u=c.isSome(t)&&t.signal,z=this.makeUid(l,A);let y=this._textureRequests.get(z);if(!y){t=new AbortController;const B=this._streamDataRequester.request(l,"image",{uid:z,signal:t.signal});y={referenceCount:0,texture:null,textureAsync:null,
abortController:t};this._textureRequests.set(z,y);y.textureAsync=B.then(function(){var C=b._asyncToGenerator(function*(k){k=w._createTexture(l,k,A);y.texture=k;y.abortController=null;w._stage.add(k);yield w._stage.load(k);return{uid:z,texture:k,release:()=>w._release(z)}});return function(k){return C.apply(this,arguments)}}(),C=>{y.abortController=null;throw C;})}y.referenceCount++;return(new Promise((B,C)=>{r.onAbort(u,()=>{C(r.createAbortError())});y.textureAsync.then(B,C)})).catch(B=>{this._release(z);
throw B;})});return function(l,A,t){return e.apply(this,arguments)}}();f._createTexture=function(e,l,A){const t={...this._parameters,powerOfTwoResizeMode:p.PowerOfTwoResizeMode.PAD};if(m.isSVG(e)){if(A||0===l.width&&0===l.height)e=l.width?l.height/l.width:1,A=A||64,1<e?(l.width=Math.round(A/e),l.height=A):(l.width=A,l.height=Math.round(A*e));this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(t.preMultiplyAlpha=!1)}t.width=l.width;t.height=l.height;
return new g.Texture(l,t)};return d}(n.TextureCollection);a.StreamTextureCollection=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G){a.PointsOfInterest=function(P){function N(E){E=P.call(this,E)||this;E._handles=new m;E._tmpRay=A.create();E._centerRayDirty=!0;E._surfaceAltitudeAtCenter=0;E._surfaceAltitudeAtCenterDirty=!0;E._contentAltitudeAtCenter=0;E._contentAltitudeAtCenterDirty=!0;E._propertiesPool=new u.PropertiesPool({renderPointOfView:J},b._assertThisInitialized(E));E.renderPointOfView=l.create();E._pois=[];E._debugCenters=new Map;return E}b._inheritsLoose(N,
P);var H=N.prototype;H.initialize=function(){const {state:E,basemapTerrain:I,renderCoordsHelper:M,map:Q}=this.view;this._surfaceIntersector=v.newIntersector(E.viewingMode);this._surfaceIntersector.options.backfacesTerrain=E.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=D.StoreResults.MIN;this._contentIntersector=v.newIntersector(E.viewingMode);var T=()=>this._estimateSurfaceAltitudeAtCenter();const S=this.view.resourceController.scheduler,
U=n.unwrap(this.view.basemapTerrain?.elevationQueryCache),Y={state:E,scheduler:S,surface:I,renderCoordsHelper:M};this._set("centerOnSurfaceInfrequent",new B.CenterOnSurface({...Y,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnSurfaceFrequent",new B.CenterOnSurface({...Y,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("contentCenterOnSurface",new B.CenterOnSurface({...Y,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:T,cameraName:"contentCamera"}));this._set("centerOnContent",new B.CenterOnSurface({...Y,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new y.CameraOnSurface({...Y,cache:U,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:Q}));this._set("contentCameraOnSurface",new y.CameraOnSurface({...Y,cache:U,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:Q,cameraName:"contentCamera"}));
this._set("surfaceGeometryUpdates",new x.SurfaceGeometryUpdates({...Y,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new C.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:M}));this._set("surfaceOrigin",new q.StableSurfaceCenter({cache:U,view:this.view}));this._set("focus",new k.Focus({state:E,scheduler:S,surface:I,renderCoordsHelper:M,centerOnSurface:this.contentCenterOnSurface,
estimateSurfaceIntersectionAtRenderPoint:(V,R)=>this._estimateSurfaceIntersectionAtRenderPoint(V,this.view.state.contentCamera,R)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);T=this.view.graphics;this._debugCenters.set(this.centerOnContent,new w.PointGraphics(T,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new w.PointGraphics(T,
"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new w.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new w.PointGraphics(T,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new w.PointGraphics(T,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new w.PointGraphics(T,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new w.PointGraphics(T,"green","Focus"));
this._handles.add([p.watch(()=>E.camera,V=>this._cameraChanged(V),p.sync),p.watch(()=>I.extent,()=>this._updateCenterPointsOfInterest()),p.when(()=>!I.updating,()=>this._updateCenterPointsOfInterest(),p.sync),p.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),p.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),p.when(()=>t.SHOW_POI,V=>this._setDebug(V),p.initial)]);this._cameraChanged(this.view.state.camera);
for(const V of this._pois)V.runTask()};H.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const E of this._pois)E.destroy();this.surfaceOrigin.destroy()};H._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const E=this._centerRay;if(n.isNone(E))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(E,this._contentIntersector,
L,O)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(L):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};H._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const E=this._centerRay;if(n.isNone(E))return this._surfaceAltitudeAtCenter;const I=E.origin,M=e.add(L,E.origin,E.direction);
this._surfaceIntersector.resetWithRay(E,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,I,M);this._surfaceIntersector.results.min.getIntersectionPoint(L)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(L));return this._surfaceAltitudeAtCenter};H._estimateSurfaceIntersectionAtRenderPoint=function(E,I,M){E=z.fromRenderAtEye(I,E,K);if(n.isNone(E))return null;const Q=E.origin,T=e.add(L,E.origin,E.direction);this._surfaceIntersector.resetWithRay(E,
I);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,Q,T);return this._surfaceIntersector.results.min.getIntersectionPoint(M)?M:null};H._cameraChanged=function(E){this._updateCenterPointsOfInterest();E=E.eye;e.exactEquals(this.renderPointOfView,E)||this._set("renderPointOfView",e.copy(this._propertiesPool.get("renderPointOfView"),E))};H._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const E of this._pois)E.updateRenderLocation()};
H._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};H._setDebug=function(E){if(E)for(const I of this._pois)this._handles.add(p.watch(()=>I.renderLocation,M=>this._debugCenters.get(I).show(M,I.renderCoordsHelper.spatialReference),p.initial),"debug");else this._debugCenters.forEach(I=>I.hide()),this._handles.remove("debug")};b._createClass(N,[{key:"updating",get:function(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(E=>
E.updating))}},{key:"_centerRay",get:function(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const E of this._pois)E.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return N}(r);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,
"centerOnContent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,
"contentCameraOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",
void 0);c.__decorate([g.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([f.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const J=Array,L=l.create(),K=A.create(),O={exclude:new Set([F.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){b=function(){function l(t,w,u=""){this.graphics=t;this._symbol=new d({symbolLayers:[new f({material:{color:w},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new e({text:u,halo:{color:"white",size:1/.75},material:{color:w},size:12})]})}var A=l.prototype;A.show=function(t,w){m.isNone(w)||(this.hide(),t=new h({x:t[0],y:t[1],z:t[2],spatialReference:w}),this._graphic=new c({geometry:t,symbol:this._symbol}),this.graphics.add(this._graphic))};A.hide=
function(){m.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return l}();r=function(){function l(t,w,u=""){this.graphics=t;this._graphics=[];this._outline=new g({symbolLayers:[new p({material:{color:[0,0,0,0]},outline:{color:w,size:2}})]});this._text=new d({symbolLayers:[new e({text:u,halo:{color:"white",size:1/.75},material:{color:w},size:12})]})}var A=l.prototype;A.show=function(t){this.hide();const w=new h({x:t.xmin,y:t.ymin,z:t.zmax,spatialReference:t.spatialReference});
this._graphics.push(new c({geometry:n.fromExtent(t),symbol:this._outline}));this._graphics.push(new c({geometry:w,symbol:this._text}));this.graphics.addMany(this._graphics)};A.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return l}();a.ExtentGraphics=r;a.PointGraphics=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){const u=Array;a.CameraOnSurface=function(y){function B(k){k=y.call(this,k)||this;k._dirty=!1;k._propertiesPool=new t.PropertiesPool({location:e,renderLocation:u},b._assertThisInitialized(k));k._estimatedSurfaceAltitude=0;k._pendingElevationQueryController=null;k.cameraName="camera";k.renderLocation=f.create();k._tmpPoint=new e;return k}b._inheritsLoose(B,y);var C=B.prototype;C.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const k=()=>this._setDirty();this.handles.add(m.on(()=>this.map?.ground?.layers,"change",k,{onListenerAdd:k,onListenerRemove:k}))}this._updateRenderLocation()};C.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};C.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};C._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};C._cancelPendingRequest=function(){const k=
this._pendingElevationQueryController;k&&(this._pendingElevationQueryController=null,k.abort(),this.notifyChange("updating"))};C.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){var k=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,k);k=1E5<this._tmpPoint.z&&this.renderCoordsHelper.viewingMode===l.ViewingMode.Global&&(k.isWGS84||k.isWebMercator);var q=new AbortController;
this.map.ground.queryElevation(this._tmpPoint,{signal:q.signal,cache:this.cache,minDemResolution:k?1E6:0}).then(x=>this._updateSurfaceAltitude(x.geometry.z)).catch(x=>{r.isAbortError(x)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===q&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));q=null});this._pendingElevationQueryController=q}else this._updateSurfaceAltitude(0)};C._updateSurfaceAltitude=function(k){this._estimatedSurfaceAltitude!==
k&&(this._estimatedSurfaceAltitude=k,this._updateRenderLocation())};C._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(z,this._estimatedSurfaceAltitude,this._camera.eye);d.exactEquals(this._get("renderLocation"),z)||(this._set("renderLocation",d.copy(this._propertiesPool.get("renderLocation"),z)),this.notifyChange("renderLocation"))};b._createClass(B,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const k=this._propertiesPool.get("location");
this.renderCoordsHelper.fromRenderCoords(this.renderLocation,k,this.state.spatialReference);return k}},{key:"scale",get:function(){const k=this._camera,q=d.distance(k.eye,this.renderLocation);return A.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:k}},q,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return B}(w.PointOfInterest);
c.__decorate([n.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([n.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);c.__decorate([n.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);c.__decorate([n.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([n.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([n.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"map",void 0);c.__decorate([n.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([n.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);c.__decorate([n.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([h.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const z=f.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h){a.PointOfInterest=function(d){function f(e){e=d.call(this,e)||this;e.handles=new m;return e}b._inheritsLoose(f,d);f.prototype.destroy=function(){this.handles.destroy()};return f}(r);c.__decorate([n.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([n.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([n.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
c.__decorate([h.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){const y=Array;a.CenterOnSurface=function(q){function x(D){D=q.call(this,D)||this;D._propertiesPool=new u.PropertiesPool({location:e,renderLocation:y},b._assertThisInitialized(D));D._currentSurfaceAltitude=0;D._latestSurfaceAltitude=0;D.cameraName="camera";D.distance=0;D.renderLocation=f.create();D.updating=!1;return D}b._inheritsLoose(x,q);var v=x.prototype;v.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
v.destroy=function(){this._frameWorker=m.removeMaybe(this._frameWorker);this._propertiesPool=m.destroyMaybe(this._propertiesPool)};v.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};v.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};v._updateRenderLocation=function(){const D=B;let F=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,D);var G=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!F&&G&&(F=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,D))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=C;F&&this._latestSurfaceAltitudeChangesDistanceSignificantly(D,G)&&(d.copy(D,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?this.distance=d.distance(this._camera.eye,D):(d.scale(D,this._camera.viewForward,this._get("distance")),d.add(D,D,this._camera.eye));d.exactEquals(this._get("renderLocation"),D)||this._set("renderLocation",
d.copy(this._propertiesPool.get("renderLocation"),D))};v._calculateSurfaceIntersection=function(D,F){var G=this._camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,D,F))return!1;if(this.state.isGlobal){const J=A.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;D=J+D;const L=d.squaredLength(G.eye),K=L<D*D,O=d.distance(G.eye,F);K&&O>J/4&&(d.scale(F,G.viewForward,D-Math.sqrt(L)),d.add(F,F,G.eye))}else G=this.surface.ready?this.surface.extent:null,m.isSome(G)&&l.projectBoundingRect(G,
this.surface.spatialReference,k,this.renderCoordsHelper.spatialReference)&&(F[0]=r.clamp(F[0],k[0],k[2]),F[1]=r.clamp(F[1],k[1],k[3]));return!0};v._latestSurfaceAltitudeChangesDistanceSignificantly=function(D,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==D)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){if(w.TESTS_DISABLE_OPTIMIZATIONS)return!0;const G=this._camera.eye;D=d.distance(G,D);F=d.distance(G,F);if(.05<Math.abs(F-D)/D)return!0}return!1};
b._createClass(x,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return x}(z.PointOfInterest);c.__decorate([n.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([n.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([n.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);c.__decorate([n.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([n.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([n.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([n.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([n.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([h.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const B=f.create(),C=f.create(),k=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,b,c){let r=function(){function n(g){this._handles=new c;this.events=new b;this._contentLayerViews=g.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",h=>this._layerViewsChanged(h)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}var p=n.prototype;p.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};p._layerViewsChanged=function(g){g.added.forEach(h=>{"esri.views.3d.layers.SceneLayerView3D"===
h.declaredClass&&this._handles.add(h.on("visible-geometry-changed",()=>this._contentChanged()),h.uid)});g.removed.forEach(h=>this._handles.remove(h.uid))};p._contentChanged=function(){this.events.emit("request-update",m)};return n}();const m={};a.ContentGeometryUpdates=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){const y=Array;a.Focus=function(q){function x(D){D=q.call(this,D)||this;D._propertiesPool=new t.PropertiesPool({location:l,renderLocation:y},b._assertThisInitialized(D));D._dirty=!0;D.renderLocation=D._propertiesPool.get("renderLocation");return D}b._inheritsLoose(x,q);var v=x.prototype;v.initialize=function(){this.handles.add([m.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),m.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(z.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};v.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};v.runTask=function(){var D=this._get("renderLocation");const F=this.centerOnSurface.renderLocation;var G=this.renderCoordsHelper,J=this.state.contentCamera;this._dirty=!1;G.worldUpAtPosition(F,B);G=Math.max(0,(Math.acos(f.dot(B,J.viewForward))-.5*Math.PI)*(J.aboveGround?1:-1));Number.isNaN(G)?D&&f.equals(D,F)||
(D=this._propertiesPool.get("renderLocation"),f.copy(D,F),this._set("renderLocation",D)):(G=1-r.clamp(G/(.5*Math.PI),0,1),G*=G*G,this._calculateScreenHorizontalEdgeOnSurface(k),J=this._propertiesPool.get("renderLocation"),f.lerp(J,F,k,G),D&&f.equals(D,J)||this._set("renderLocation",J))};v._calculateScreenHorizontalEdgeOnSurface=function(D){const F=this.state.contentCamera;var G=F.getRenderCenter(n.createRenderScreenPointArray3());G[1]=F.aboveGround?F.padding[u.PaddingSide.BOTTOM]:F.fullHeight-F.padding[u.PaddingSide.TOP];
if(this.estimateSurfaceIntersectionAtRenderPoint(G,D))return D;const J=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return F.unprojectFromRenderScreen(G,C)&&(f.subtract(C,C,F.eye),G=f.normalize(C,C),this.renderCoordsHelper.intersectManifold(A.wrap(F.eye,G),J,D))?D:this.renderCoordsHelper.setAltitude(D,J,F.eye)};v.updateRenderLocation=function(){this._dirty=!0};b._createClass(x,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",
get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"running",get:function(){return this._dirty}}]);return x}(w.PointOfInterest);c.__decorate([p.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([p.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([p.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([p.property({constructOnly:!0})],
a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([p.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([p.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([p.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([d.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const B=e.create(),C=e.create(),k=e.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.StableSurfaceCenter=function(w){function u(y){y=w.call(this,y)||this;y.location=null;y._updateController=null;y._handles=new m;return y}b._inheritsLoose(u,w);var z=u.prototype;z.initialize=function(){this.view.state.isLocal&&(this._handles.add([g.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),g.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())};z.destroy=function(){this._handles.destroy()};
z._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(!this.surfaceView||n.isNone(this.surfaceView.extent)||n.isNone(this.surfaceView.spatialReference))this._set("location",null);else{var y=t.center(this.surfaceView.extent);y=new A({x:y[0],y:y[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(y,
{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(B=>{this._updateController=null;this._set("location",B.geometry)}).catch(B=>{p.isAbortError(B)||B&&"elevation-query:invalid-layer"===B.name||console.error("StableSurfaceCenter failed to update: ",B)})):this._set("location",y)}};b._createClass(u,[{key:"surface",get:function(){return this.view.map?.ground}},{key:"surfaceView",get:function(){return this.view.basemapTerrain}},{key:"renderLocation",get:function(){if(!this.location)return null;
const y=l.create();this.view.renderCoordsHelper.toRenderCoords(this.location,y);return y}}]);return u}(r);c.__decorate([h.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([h.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([h.property()],a.StableSurfaceCenter.prototype,"surface",null);c.__decorate([h.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);c.__decorate([h.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);c.__decorate([h.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){a.SurfaceGeometryUpdates=function(y){function B(k){k=y.call(this,k)||this;k._handles=new n;k._tileGeometryUpdateExtent=l.empty();k._tileGeometryUpdateSpatialReference=null;k.events=new m;k.updating=!1;return k}b._inheritsLoose(B,y);var C=B.prototype;C.initialize=function(){this._handles.add([this.surface.on("elevation-change",k=>this._tileGeometryChanged(k)),this.scheduler.registerTask(A.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};C.destroy=function(){this._handles=
p.destroyMaybe(this._handles)};C.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",t),l.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};C._tileGeometryChanged=function(k){this._tileGeometryUpdateSpatialReference=p.unwrap(k.spatialReference);l.expand(this._tileGeometryUpdateExtent,k.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};C._furthestCenterOnSurface=
function(){let k=this.centerOnSurfaces[0];for(let q=1;q<this.centerOnSurfaces.length;q++){const x=this.centerOnSurfaces[q];x.distance>k.distance&&(k=x)}return k};C._centerIntersectsExtent=function(k,q){const x=this.state.camera.eye,v=z,D=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(x,w,q);this.renderCoordsHelper.fromRenderCoords(D.renderLocation,u,q);w[0]<u[0]?(v[0]=w[0],v[2]=u[0]):(v[0]=u[0],v[2]=w[0]);w[1]<u[1]?(v[1]=w[1],v[3]=u[1]):(v[1]=u[1],v[3]=w[1]);return l.intersects(v,
k)};b._createClass(B,[{key:"running",get:function(){return this.updating}}]);return B}(r);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([g.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([f.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const t={},w=e.create(),u=e.create(),z=l.empty();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba,ia,ma,ha,ka,Z,ca,fa,ea,da,la,oa,ra,Aa,ua,za){function va(Sa,ja){return Sa[0]===ja[0]&&Sa[1]===ja[1]&&Sa[2]===ja[2]}function Ja(Sa){return Sa.isLeaf?!1:Sa.children.some(ja=>ja.shouldLoad)||Sa.children.some(ja=>Ja(ja))}function pa(Sa,ja,Ta){for(const qa of Sa)if(qa.containsPointXY(ja,Ta)){for(Sa=qa;Sa&&!Sa.renderData;)Sa=Sa.children[(ja>Sa.extentMidX?1:0)+(Ta<Sa.extentMidY?2:0)];return Y.sampleElevation(ja,
Ta,Sa?.renderData?.geometryState.samplerData??null)}return null}m=function(Sa){function ja(qa){var Ea=Sa.call(this,qa)||this;Ea._iteratorPool=new l(da.IteratorPreorder,Oa=>Oa.remove=()=>Ea._iteratorPool.release(Oa));Ea._postorderIterator=new da.IteratorPostorder;Ea._hasPendingUpdates=!1;Ea._pendingUpdates=0;Ea._asyncWorkItems=0;Ea._allTilesDirty=!0;Ea._allTilesSorted=!0;Ea._visibleCached=!1;Ea._usedMemory=null;Ea._performanceInfo=new ka;Ea._viewChanged=!1;Ea._inFrameTask=!1;Ea._viewChangeUpdateDirty=
!1;Ea._eyePosRenderSR=q.create();Ea._eyePosSurfaceSR=q.create();Ea._splitLimits=new ca.SplitLimits;Ea._frustum=L.create();Ea._viewProjectionMatrix=C.create();Ea._layerViews=[[],[]];Ea._layerIndexByUid=[new Map,new Map];Ea._basemapLayerViewHandles=new Map;Ea._handles=new h;Ea._watchUpdatingTracking=new v.WatchUpdatingTracking;Ea._frameTask=za.ImmediateTask;Ea._allTiles=new A;Ea._upsampleInfoPool=new l(oa.UpsampleInfo);Ea._rootTilesExtent=J.create();Ea._maxNumUpdating=1;Ea.maxTextureScale=1.2;Ea._spatialReference=
G.WebMercator;Ea.visibleElevationBounds=new U.ElevationBounds(Infinity,-Infinity);Ea.rootTileElevationBounds=new U.ElevationBounds(Infinity,-Infinity);Ea._updatingRootTiles=!1;Ea._pendingTilesForElevationUpdateEvent=new Set;Ea._pendingTilesToUpdate=new Set;Ea.totalGeometryUpdates=0;Ea.totalTileUpdates=0;Ea.oneBatchPerFrameTask=!0;Ea._layerViewsDirty=!1;Ea._shading=!0;Ea._isWebMercator=!1;Ea._isWebMercatorOnPlateeCarree=!1;Ea._isGlobal=!qa.view?.state?.isLocal;return Ea}b._inheritsLoose(ja,Sa);var Ta=
ja.prototype;Ta.initialize=function(){this._lercDecoder=H.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new l(aa.PlanarPatch):new l(ia.SphericalPatch);var qa=this.view.resourceController.memoryController;this._upsampleMapCache=qa.newCache("esri.views.3d.terrain.upsample",Ea=>Ea.unloadMapData());this._elevationQueryCache=new P.ElevationQueryTileCache(qa.newCache("elevation-query"));this._set("overlayManager",new W.OverlayManager({surface:this}));this._handles.add([w.watch(()=>
this.overlayManager.hasHighlights,Ea=>this._renderer.setNeedsHighlight(Ea)),w.watch(()=>this.overlayManager.rendersOccluded,Ea=>this._renderer.setRenderOccludedOverlay(Ea))],"overlayManager");this._renderer=new ha.TerrainRenderer({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:F.getReferenceEllipsoid(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles});this._handles.add([w.watch(()=>this.baseOpacity,Ea=>{this._handleLayerViewChanges();this._updateBaseOpacity(Ea)},
w.syncAndInitial),w.watch(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},w.syncAndInitial),w.watch(()=>this.renderingDisabled,()=>this.view?._stage?.renderView.setRenderParameters({terrainRenderingEnabled:!this.renderingDisabled}),w.sync),w.watch(()=>this.backgroundColor,Ea=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(Ea)},w.syncAndInitial),w.watch(()=>this.snapLevel,()=>this._viewChanged=!0,w.sync),w.watch(()=>this.view.pointsOfInterest,Ea=>
{this._renderer.pointsOfInterest=Ea;this._watchUpdatingTracking.removeAll();Ea&&this._watchUpdatingTracking.add(()=>Ea.focus.renderLocation,()=>this._allTilesSorted=!1)}),w.watch(()=>M.TERRAIN_TILE_TREE_SHOW_TILES,Ea=>{Ea&&!this._treeDebugger?(new Promise((Oa,Va)=>a(["../layers/support/TerrainTileTree3DDebugger"],Oa,Va))).then(({TerrainTileTree3DDebugger:Oa})=>{!this._treeDebugger&&M.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Oa({view:this.view}))}):Ea||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},
w.initial)]);this._extentHelper=V.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});qa=new p({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:Ea})=>Ea),getChildrenFunction:Ea=>Ea&&"layers"in Ea?Ea.layers:null});qa=new la.TilingSchemeLogic({layers:qa,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",
qa);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.ELEVATION);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(za.TaskPriority.TERRAIN_SURFACE,this);this._handles.add([w.watch(()=>this._extentHelper.stencilEnabledExtents,Ea=>this._renderer.setStencilEnabledLayerExtents(Ea),w.initial),w.watch(()=>this.tilingSchemeLogic.tilingScheme,
()=>this._updateTilingScheme(),w.sync),w.watch(()=>this.extent,()=>this._updateRootTiles(),w.initial),this.view.on("resize",()=>this._viewChangeUpdate()),w.watch(()=>{const Ea=this.view,Oa=Ea.state;return[this._lodBias,this.lodSnapping,Ea.resourceController?.memoryController?.memoryFactor,Oa.camera,Oa.contentCamera,Oa.fixedContentCamera]},()=>this._viewChangeUpdate(),w.syncAndInitial),w.watch(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,Ea=>this._renderer.textureFadingEnabled=
0<Ea,w.initial),w.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),w.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._handles.add([w.watch(()=>this.view?.map.ground.shading,()=>{this._updateShadingIfChanged()})]);this._updateShading();this._layerViewsDirty=!0;this._handleLayerViewChanges()};Ta.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=e.releaseMaybe(this._lercDecoder);
this._removeAllTiles();this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);const qa=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));qa.destroy();this._basemapLayerViewHandles.forEach((Ea,Oa)=>this._unregisterTiledLayerView(Oa));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tilePool=e.destroyMaybe(this._tilePool);
ca.Tile.prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer=e.destroyMaybe(this._renderer);this._iteratorPool=e.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);E.printAllocations();fa.printAllocations()};Ta.intersect=function(qa,Ea,Oa,Va){this._renderer.intersect(qa,Ea,Oa,Va)};Ta.getElevation=function(qa,Ea,Oa,Va){const Ua=this.rootTiles;if(e.isNone(Ua)||!Ua.length||0===Ua[0].layerInfo[X.LayerClass.ELEVATION].length)return null;
const La=Ba;La[0]=qa;La[1]=Ea;La[2]=Oa;return D.projectVectorToVector(La,Va,La,this._spatialReference)?pa(Ua,La[0],La[1]):(d.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)};Ta.getElevations=function(qa,Ea,Oa){const Va=this.rootTiles;var Ua=Va?Va[0].layerInfo[X.LayerClass.ELEVATION].length:0;if(e.isNone(Va)||!Va.length||0===Ua)for(qa=0;qa<Ea;++qa)Oa(qa,null);else for(Ua=0;Ua<Ea;++Ua){var La=3*Ua;La=pa(Va,
qa[La+0],qa[La+1]);Oa(Ua,La)}};Ta.getScale=function(qa){if(this.tilingScheme){if(!D.projectPointToVector(qa,Ba,this.spatialReference))return d.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;qa=this.rootTiles;if(e.isSome(qa))for(let Ea of qa)if(Ea?.containsPoint(Ba)){for(;!Ea.isLeaf&&!Ea.rendered;)qa=0,Ba[0]>Ea.children[0].extent[2]&&(qa+=1),Ba[1]<Ea.children[0].extent[1]&&(qa+=2),Ea=Ea.children[qa];return this._getLodBiasCorrectedScale(Ea.level)}}return 1E100};
Ta.getSphereElevationBounds=function(qa,Ea,Oa,Va,Ua){Ba[0]=qa;Ba[1]=Ea;Ba[2]=Oa;Ba[3]=Va;if(!D.projectVectorToVector(Ba,Ua,Ba,this.tilingScheme?.spatialReference))return d.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let La=Infinity,ta=-Infinity;const xa=Ia=>{if(Ia&&J.intersectsSphere(Ia.extent,Ba))if(Ia.isLeaf||Ia.rendered)La=Math.min(La,Ia.elevationBounds[0]),ta=Math.max(ta,Ia.elevationBounds[1]);
else for(const Qa of Ia.children)xa(Qa)};qa=this.rootTiles;if(e.isSome(qa))for(const Ia of qa)xa(Ia);return{min:La,max:ta}};Ta.getSphereScale=function(qa,Ea){if(!this.tilingScheme)return null;if(!D.projectPointToVector(qa,Ba,this.spatialReference))return d.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ba[3]=Ea;let Oa=null;const Va=Ua=>{if(Ua&&J.intersectsSphere(Ua.extent,Ba))if(Ua.isLeaf||Ua.rendered)Ua=
this._getLodBiasCorrectedScale(Ua.level),Oa=null==Oa?Ua:Math.min(Oa,Ua);else for(const La of Ua.children)Va(La)};qa=this.rootTiles;if(e.isSome(qa))for(const Ua of qa)Va(Ua);return Oa};Ta.queryVisibleScaleRange=function(qa,Ea,Oa,Va){Ea=Ea?this.tilingScheme.levelAtScale(Ea):0;Oa=Oa?this.tilingScheme.levelAtScale(Oa):Infinity;const Ua=this._lodBias;this._renderer.queryVisibleLevelRange(qa,Ea+Ua,Oa+Ua,Va)};Ta._evaluateTransparency=function(qa){var Ea=this._renderer.transparency;qa=this._allSurfaceLayersTransparent()?
ha.TransparencyMode.Invisible:1<=qa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ha.TransparencyMode.Opaque:ha.TransparencyMode.Semitransparent;if(Ea=Ea!==qa)this._renderer.transparency=qa,this.view?._stage?.renderView.setRenderParameters({terrainTransparency:this._renderer.transparency});return Ea};Ta._updateBaseOpacity=function(qa){qa=this._evaluateTransparency(qa);this._updateTileTextures(qa?R.TextureUpdate.UNFADED:R.TextureUpdate.IMMEDIATE)};Ta._updateTilingScheme=function(){const qa=
this.tilingSchemeLogic.tilingScheme;qa!==this.tilingScheme&&(Z.weakAssert(!!qa,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles(),this._spatialReference=qa?.spatialReference??G.WebMercator,this._set("tilingScheme",qa),this._updateClippingExtent(),qa&&(this._updateTiledLayers(),this._renderer.setTileSize(qa.pixelSize),this.overlayManager.setSpatialReference(qa.spatialReference),this._updateRootTiles()),this._isWebMercatorOnPlateeCarree=
(this._isWebMercator=!!this.tilingScheme?.spatialReference.isWebMercator)&&K.isPlateCarree(this.view?.renderSpatialReference))};Ta._acquireTile=function(qa,Ea,Oa,Va){const Ua=this._tilePool.acquire();wa[0]=qa;wa[1]=Ea;wa[2]=Oa;Ua.init(wa,Va,this);return Ua};Ta._updateRootTiles=function(){const {extent:qa,tilingScheme:Ea}=this;if(Ea){var Oa=Ha,Va=Ea.rootTilesInExtent(qa,Oa,5*ma.MAX_ROOT_TILES);if(e.isSome(this.rootTiles)){if(Va.length>ma.MAX_ROOT_TILES){d.getLogger(this.declaredClass).warn(ma.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);
return}const Ua=this.rootTiles.map(ta=>ta.lij),La=n.difference(Ua,Va,va);this._updatingRootTiles=!0;if(0<La.removed.length||0<La.added.length){const ta=this.rootTiles.filter(xa=>-1<La.removed.findIndex(Ia=>va(Ia,xa.lij))?(this._purgeTile(xa),!1):!0);La.added.forEach(xa=>ta.push(this._newRootTile(xa)));this._setRootTiles(ta)}}else this._updatingRootTiles=!0,Va.length>ma.MAX_ROOT_TILES&&(d.getLogger(this.declaredClass).warn(ma.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Va=Ea.rootTilesInExtent(qa,Oa,ma.MAX_ROOT_TILES)),
this._setRootTiles(Va.map(Ua=>this._newRootTile(Ua)));J.equals(Oa,this._rootTilesExtent)||(this._rootTilesExtent=J.create(Oa));this._visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}};Ta._updateAllTileGeometries=function(){const qa=this._allTiles.filter(Ea=>Ea.isLoaded&&Ea.intersectsClippingArea);qa.forEach(Ea=>this._renderer.updateTileGeometryState(Ea));
qa.forEach(Ea=>Ea.renderData.updateNeighborData());this._updateTilesGeometries(qa);this._pendingTilesToUpdate.clear()};Ta._updateTilesGeometries=function(qa){if(0!==qa.length){qa.sort(da.compareTilesByLij);var Ea=this.renderer;qa.forEach(Oa=>Ea.updateGeometryIfNeeded(Oa));qa.forEach(Oa=>this._pendingTilesForElevationUpdateEvent.add(Oa))}};Ta._shouldSplit=function(qa){return qa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ea.TileUpdate.SPLIT};Ta._newRootTile=function(qa){qa=
this._acquireTile(0,qa[1],qa[2],null);this._shouldSplit(qa)&&qa.setPendingUpdate(ea.TileUpdate.SPLIT);this._loadTile(qa);this._markTileToUpdate(qa);this._updateRootTileElevationBounds();return qa};Ta._setRootTiles=function(qa){this._set("rootTiles",qa);this._allTiles.clear();if(e.isSome(qa)){const Ea=this._iteratorPool.acquire();for(Ea.reset(qa);!Ea.done;)this._allTiles.push(Ea.next());Ea.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTilesVisibility(qa)};Ta._runViewChangeUpdateIfDirty=
function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Ta._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))};Ta._updateClippingStatus=function(qa){qa.updateClippingStatus(this.extent)&&qa.resetPendingUpdate(ea.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(qa)};
Ta._updateTilesVisibility=function(qa){if(!e.isNone(qa)){var Ea=da.hasLoadableSiblings(qa),Oa=this.visibleElevationBounds,Va=Ea?Oa.min:Infinity;Ea=Ea?Oa.max:-Infinity;var Ua=this.extent,La=this._viewProjectionMatrix;this.setTileTreeDirty();var ta=this._iteratorPool.acquire();for(ta.reset(qa);!ta.done;)qa=ta.next(),qa.updateClippingStatus(Ua)&&qa.resetPendingUpdate(ea.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(qa),qa.setPendingUpdate(ea.TileUpdate.RENDERDATA),qa.computeVisibility(),qa.updateScreenDepth(La),
qa.renderData&&(Va=Math.min(qa.elevationBounds[0],Va),Ea=Math.max(qa.elevationBounds[1],Ea));ta.remove();this._allTilesDirty=this._viewChanged=!0;this._batchUpdatePendingTileGeometries();isFinite(Va)&&isFinite(Ea)&&(Oa.min!==Va||Oa.max!==Ea)&&(this.visibleElevationBounds=new U.ElevationBounds(Va,Ea))}};Ta._updateRootTileElevationBounds=function(){let qa=Infinity,Ea=-Infinity;var Oa=this.rootTiles;e.isSome(Oa)&&Oa.forEach(({elevationBounds:Va})=>{qa=Math.min(qa,Va[0]);Ea=Math.max(Ea,Va[1])});Oa=this.rootTileElevationBounds;
if(Oa.min!==qa||Oa.max!==Ea)this.rootTileElevationBounds=new U.ElevationBounds(qa,Ea)};Ta._updateViewDependentParameters=function(){const qa=this.view.state.camera,Ea=this.view.state.contentCamera,Oa=Math.tan(.5*Ea.fovX),Va=Math.tan(.5*Ea.fovY),Ua=this.tilingScheme.pixelSize,La=2**-this._lodBias*qa.pixelRatio;this._splitLimits.aboveGround=qa.aboveGround;this._splitLimits.fovX=Oa;this._splitLimits.fovY=Va;this._splitLimits.relativeWidthLimit=Ua/qa.width*this.maxTextureScale*La;this._splitLimits.relativeHeightLimit=
Ua/qa.height*this.maxTextureScale*La;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(e.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=L.create()),L.copy(this._splitLimits.frustum,Ea.frustum)):this._splitLimits.frustum=null;L.copy(this._frustum,qa.frustum);B.multiply(this._viewProjectionMatrix,Ea.projectionMatrix,Ea.viewMatrix);k.copy(this._eyePosRenderSR,
Ea.eye);D.projectVectorToVector(qa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Ta._updateRenderData=function(qa){qa.rendered&&!qa.shouldLoad&&(Ja(qa)?this._loadChildren(qa):qa.isLeaf&&qa.parent&&qa.parent.shouldLoad&&this._loadParent(qa))};Ta._updateTileGeometryState=function(qa){qa.updateVisibility();this._renderer.updateTileGeometryState(qa)&&this._markTileToUpdate(qa);this._usedMemory=null};Ta._markAllTileNeighborsForGeometryUpdate=function(qa){const Ea=this._pendingTilesToUpdate;
qa.forEachLoadedNeighbor(Oa=>{Ea.add(Oa)})};Ta._updateTileTexture=function(qa,Ea){const Oa=qa.resetPendingUpdate(ea.TileUpdate.TEXTURE_FADING)?ea.TileUpdate.TEXTURE_FADING:qa.resetPendingUpdate(ea.TileUpdate.TEXTURE_NOFADING)?ea.TileUpdate.TEXTURE_NOFADING:!1;Oa&&(this._renderer.updateTileTexture(qa,Oa),this._usedMemory=null,Ea.madeProgress())};Ta._emitElevationUpdateEventForTiles=function(){const qa=Na.extent;J.empty(qa);this._pendingTilesForElevationUpdateEvent.forEach(Ea=>J.expand(qa,Ea.extent,
qa));this._pendingTilesForElevationUpdateEvent.clear();Na.spatialReference=this.spatialReference;this.emit("elevation-change",Na)};Ta.runTask=function(qa){this._handleLayerViewChanges(qa);this._frameTask.processQueue(qa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(qa);this._sortTiles(qa);const Ea=!this.view.state.fixedContentCamera;this._mergeAndSplit(qa,Ea);this._updateElevation(qa);this._updateTextures(qa);Ea||this._mergeAndSplit(qa,!0);this._inFrameTask=
!1;this._runViewChangeUpdateIfDirty();this._batchUpdatePendingTileGeometries();this._emitElevationUpdateEventForTiles();qa.done?this.requestUpdate():this.getUsedMemory();this.notifyChange("updatingProgressValue")};Ta._updateAllTilesStatus=function(qa){if(this._viewChanged&&this.rootTiles&&!qa.done){this._viewChanged=!1;var Ea=this._iteratorPool.acquire();Ea.reset(this.rootTiles);for(var Oa=this.snapLevel,Va=this._splitLimits,Ua=this._eyePosRenderSR;!Ea.done;){var La=Ea.next(),ta=La.shouldSplit(Va,
Ua,Oa);if(ta===ea.TileUpdate.SPLIT)La.resetPendingUpdate(ea.TileUpdate.MERGE),La.isLeaf&&(La.setPendingUpdate(ea.TileUpdate.SPLIT),Ea.skipSubtree()),La.rendered&&La.setPendingUpdate(ea.TileUpdate.RENDERDATA);else if(La.resetPendingUpdate(ea.TileUpdate.SPLIT)&&La.updateAgentSuspension(),ta===ea.TileUpdate.VSPLITMERGE&&La.updateAgents(X.LayerClass.ELEVATION),Ea.skipSubtree(),!La.isLeaf){La.setPendingUpdate(ea.TileUpdate.MERGE);La.resetPendingUpdate(ea.TileUpdate.SPLIT);ta=this._iteratorPool.acquire();
ta.resetOne(La);La=this._viewProjectionMatrix;for(let xa=ta.next();!ta.done;xa=ta.next())this._updateClippingStatus(xa),xa.updateVisibility(),xa.updateScreenDepth(La);ta.remove()}}Ea.remove();this.requestUpdate();!this.shortBatches&&this.oneBatchPerFrameTask||this._batchUpdatePendingTileGeometries();qa.madeProgress()}};Ta._sortTiles=function(qa){qa.done||this._allTilesSorted||(da.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&
this._treeDebugger.update(),qa.madeProgress())};Ta._markTileToUpdate=function(qa){Z.internalAssert(qa.isLoaded);qa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(qa),this._markAllTileNeighborsForGeometryUpdate(qa))};Ta._batchUpdatePendingTileGeometries=function(){const qa=this._pendingTilesToUpdate;if(0!==qa.size){var Ea=Array.from(this._pendingTilesToUpdate.keys()).filter(La=>La.isLoaded&&La.intersectsClippingArea),Oa=(La,ta)=>{!ta?.isLoaded||!ta.intersectsClippingArea||ta.level<La.level||
qa.has(ta)||(qa.add(ta),Ea.push(ta),ta.renderData.updateNeighborData())};Ea.sort(da.compareTilesByLij);var Va=Ea.length;for(let La=0;La<Va;++La){const ta=Ea[La];Z.internalAssert(ta.isLoaded);Z.internalAssert(ta.intersectsClippingArea);var Ua=ta.renderData;Ua.updateNeighborData();const xa=Ua._dirtyEdgeResolutions;Ua=Ua.geometryState.neighborData;for(let Ia=0;4>Ia;++Ia)if(xa&1<<Ia){const Qa=ta.renderData.geometryState.neighborData.edgePeerNeighbors[Ia];Qa&&Qa?.level>=ta.level&&Qa.forAllSubtreeOnSide(Z.oppositeEdge(Z.neighborEdgeIndices[Ia]),
Xa=>Xa.isLoaded&&Xa.intersectsClippingArea?(Z.internalAssert(qa.has(Xa)||0>da.compareTilesByLij(ta,Xa)),Oa(ta,Xa),!0):!1);Oa(ta,Ua.cornerPeerNeighbors[Ia]);Oa(ta,Ua.cornerPeerNeighbors[(Ia+1)%4])}}qa.clear();this._updateTilesGeometries(Ea);Z.ENABLE_TERRAIN_INTERNAL_CHECKS&&Z.ENABLE_WATERPROOFNESS_TESTS&&this.checkAllTilesWaterproofness()}};Ta._mergeAndSplit=function(qa,Ea){if(!this.suspended&&!qa.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Oa=!1,Va=!1;!qa.done;){Va=
!0;let Ua=!1;const La=!this._allTiles.some(ta=>{if(!Oa&&!ta.loadable)return qa.done;let xa=ta;if(ta.resetPendingUpdate(ea.TileUpdate.MERGE)){if(!Ea)return ta.setPendingUpdate(ea.TileUpdate.MERGE),qa.done;for(;xa.parent?.resetPendingUpdate(ea.TileUpdate.MERGE);)xa=xa.parent;this._mergeTile(xa);Ua=!0;qa.madeProgress()}else ta.resetPendingUpdate(ea.TileUpdate.SPLIT)&&(this._splitTile(ta),Ua=!0,qa.madeProgress());!qa.done&&xa===ta&&ta.resetPendingUpdate(ea.TileUpdate.RENDERDATA)&&(this._updateRenderData(ta),
qa.madeProgress());return qa.done});Ua&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(La)if(!Oa)Oa=!0;else{if(!Ua)break}else this._allTilesDirty=!0}Va||(this._allTilesDirty=!0);!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries();this._sortTiles(qa)}};Ta._updateElevation=function(qa){qa.done||(this._allTiles.some(Ea=>{Ea.resetPendingUpdate(ea.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Ea),this._updateTileTexture(Ea,qa),this.shortBatches&&this._batchUpdatePendingTileGeometries(),
qa.madeProgress());return qa.done}),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())};Ta._updateTextures=function(qa){qa.done||this._allTiles.some(Ea=>{this._updateTileTexture(Ea,qa);return qa.done})};Ta._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(Aa.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Ta._getLodBiasCorrectedScale=function(qa){const Ea=this.tilingScheme.levels;qa=f.clamp(qa-this._lodBias,
0,Ea.length-1);const Oa=qa-Math.floor(qa);return Ea[Math.floor(qa)].scale*(1-Oa)+Ea[Math.ceil(qa)].scale*Oa};Ta._removeAllTiles=function(){e.isSome(this.rootTiles)&&(this.rootTiles.forEach(qa=>this._purgeTile(qa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this._visible=!1};Ta._purgeDescendantTiles=function(qa){if(qa.isLeaf)return!1;let Ea=!1;for(let Oa=0;4>Oa;++Oa)Ea=this._purgeTile(qa.children[Oa])||Ea;qa.unsetChildren();return Ea};Ta._purgeTile=function(qa){const Ea=
this._purgeDescendantTiles(qa)||qa.rendered;this._allTiles.removeUnordered(qa);this._unloadTile(qa);this._tilePool.release(qa);return Ea};Ta._unloadTile=function(qa){this._pendingTilesToUpdate.delete(qa);this._pendingTilesForElevationUpdateEvent.delete(qa);qa.unload(this._renderer)};Ta._splitTile=function(qa){Z.weakAssert(qa.isLeaf,"tile that is already split should not be split again!");const Ea=qa.level+1,Oa=2*qa.lij[1],Va=2*qa.lij[2];qa.setChildren(this._createTile(Ea,Oa,Va,qa),this._createTile(Ea,
Oa,Va+1,qa),this._createTile(Ea,Oa+1,Va,qa),this._createTile(Ea,Oa+1,Va+1,qa));qa.setPendingUpdate(ea.TileUpdate.RENDERDATA);qa.updateAgentSuspension();this._allTiles.pushArray(qa.children);this._allTilesDirty=!0;++this._performanceInfo.numSplit};Ta._emitTileScaleChange=function(qa,Ea=qa.level){Ra.spatialReference=this.spatialReference;Ra.extent=qa.extent;Ra.scale=this._getLodBiasCorrectedScale(Ea);this.emit("scale-change",Ra)};Ta._createTile=function(qa,Ea,Oa,Va){Z.weakAssert(!!Va,"_createTile sanity check");
qa=this._acquireTile(qa,Ea,Oa,Va);qa.updateClippingStatus(this.extent);qa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(qa)&&qa.setPendingUpdate(ea.TileUpdate.SPLIT);return qa};Ta._mergeTile=function(qa){Z.weakAssert(!qa.hasPendingUpdate(ea.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(qa)&&(Z.weakAssert(!qa.renderData,"_mergeTile sanity check"),this._loadTile(qa),this._markTileToUpdate(qa),this._emitTileScaleChange(qa),this.shortBatches&&this._batchUpdatePendingTileGeometries());
this._allTilesDirty=!0;++this._performanceInfo.numMerged};Ta._loadChildren=function(qa){Z.weakAssert(qa.rendered,"parent should be rendered");this._unloadTile(qa);const Ea=qa.children;Ea.forEach(Oa=>this._loadTile(Oa));Ea.forEach(Oa=>this._pendingTilesToUpdate.add(Oa));this._markAllTileNeighborsForGeometryUpdate(qa);this._emitTileScaleChange(qa,qa.level+1);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Ta._loadParent=function(qa){qa=qa.parent;this._unloadChildren(qa);this._loadTile(qa);
this._markTileToUpdate(qa);this._emitTileScaleChange(qa,qa.level);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Ta._unloadChildren=function(qa){if(!qa.isLeaf)for(let Ea=0;4>Ea;++Ea){const Oa=qa.children[Ea];this._unloadChildren(Oa);this._unloadTile(Oa)}};Ta._loadTile=function(qa){qa.load();qa.setPendingUpdate(ea.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(qa)};Ta._elevationDataArrived=
function(qa,Ea,Oa){Oa=new Y.ElevationData(qa.lij,qa.extent,Oa);qa.dataArrived(Ea,X.LayerClass.ELEVATION,Oa);Oa=[qa];qa=qa.level;const Va=this._iteratorPool.acquire();for(Va.reset(Oa);!Va.done;){const Ua=Va.next();Ua.findElevationBoundsForLayer(Ea,qa);Ua.computeElevationBounds()}0===qa&&this._updateRootTileElevationBounds();Va.remove();this._updateTilesVisibility(Oa)};Ta._handleLayerViewChanges=function(qa=za.noBudget){if(this._layerViewsDirty){var Ea=this._layerViewsDirty=!1,Oa=new Set,Va=-1;for(const La of this.view.allLayerViews.items)if(Oa.add(La.uid),
Z.isSurfaceLayerView(La)||Z.isGroupLayerView(La))if(this._basemapLayerViewHandles.has(La.uid)&&!Z.isGroupLayerView(La)){var Ua=this._layerClassFromLayerView(La);Ua=this._getLayerIdxByUID(Ua,La.uid);if(e.isSome(Ua)){if(Ua<Va||e.isNone(Va))Ea=!0;Va=Ua}}else this._registerTiledLayerView(La),La.layer.loaded&&(Ea=!0);this._basemapLayerViewHandles.forEach((La,ta)=>{Oa.has(ta)||(this._unregisterTiledLayerView(ta),Ea=!0)});Ea&&this._updateTiledLayers();this._renderer.transparency=this._allSurfaceLayersTransparent()?
ha.TransparencyMode.Invisible:this._renderer.transparency;this.hasCompositeBlendMode=this._hasCompositeBlendMode();qa.madeProgress()}};Ta._allSurfaceLayersTransparent=function(){let qa=0===this.view.map?.ground?.opacity;for(const Ea of this.view.allLayerViews.items)if(Z.isMapTileLayerView(Ea)&&!N.isBaseLayer(Ea.layer)&&0!==Ea.fullOpacity){qa=!1;break}return qa};Ta._hasCompositeBlendMode=function(){for(const qa of this.view.allLayerViews.items)if((Z.isBlendableLayerView(qa)||Z.isGroupLayerView(qa))&&
ra.isCompositeBlendMode(ra.blendModeFromString[qa.layer.blendMode]))return!0;return!1};Ta._layerClassFromLayerView=function(qa){return Z.isElevationLayerView(qa)?X.LayerClass.ELEVATION:X.LayerClass.MAP};Ta._registerTiledLayerView=function(qa){const Ea=[];(Z.isBlendableLayerView(qa)||Z.isGroupLayerView(qa))&&Ea.push(w.watch(()=>qa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(R.TextureUpdate.UNFADED)}));if(!Z.isGroupLayerView(qa)){var Oa=this._layerClassFromLayerView(qa);
Ea.push(w.watch(()=>qa.suspended,()=>this._updateTiledLayers()));Ea.push(w.watch(()=>qa.fullOpacity,()=>this._updateTileTextures(R.TextureUpdate.UNFADED)));Ea.push(w.watch(()=>"effectiveScaleRange"in qa.layer?qa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Oa)));qa.on("data-changed",()=>{const Va=this._getLayerIdxByUID(Oa,qa.uid);e.isSome(Va)&&this._invalidateLayerData(Va,Oa)});this._basemapLayerViewHandles.set(qa.uid,Ea)}};Ta._unregisterTiledLayerView=function(qa){const Ea=this._basemapLayerViewHandles.get(qa);
if(Ea){for(let Oa=0;Oa<Ea.length;Oa++)Ea[Oa].remove();this._basemapLayerViewHandles.delete(qa)}};Ta._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var qa=[[],[]],Ea=null;this.view.allLayerViews.forEach(Va=>{if(Va.layer&&!Va.suspended&&Z.isSurfaceLayerView(Va)&&Va.fullExtent){var Ua=this._layerClassFromLayerView(Va);if(Ua===X.LayerClass.MAP){const La=Va.displayLevelRange.maxLevel;Infinity!==La&&(null===Ea||La>Ea)&&(Ea=La)}qa[Ua].push(Va)}});for(const Va of X.LayerClasses){var Oa=
this._layerViews[Va];const Ua=qa[Va];Ua.reverse();const La=Ua.length;let ta=Oa.length!==La;const xa=Array(La),Ia=Array(Oa.length);this._layerIndexByUid[Va].clear();for(let Qa=0;Qa<La;Qa++){this._layerIndexByUid[Va].set(Ua[Qa].uid,Qa);const Xa=Oa.indexOf(Ua[Qa]);xa[Qa]=Xa;Qa!==Xa&&(ta=!0);-1<Xa&&(Ia[Xa]=Qa)}if(ta){Oa=this._postorderIterator;for(Oa.reset(this.rootTiles);!Oa.done;)Oa.next().modifyLayers(Ia,xa,Va);this._layerViews[Va]=Ua;this._restartAllAgents(Va);this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ea)&&
this._viewChangeUpdate()}};Ta._restartAllAgents=function(qa){const Ea=this._postorderIterator;for(Ea.reset(this.rootTiles);!Ea.done;){const Oa=Ea.next();Oa.restartAgents(qa);qa===X.LayerClass.ELEVATION&&Oa.computeElevationBounds()}this._updateRootTileElevationBounds()};Ta.layerViewByIndex=function(qa,Ea){return this._layerViews[Ea][qa]};Ta.numLayers=function(qa){return this._layerViews[qa].length};Ta._updateTileTextures=function(qa){this._allTiles.forAll(Ea=>{Ea.updateAgents(X.LayerClass.MAP);qa===
R.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ea,ea.TileUpdate.TEXTURE_NOFADING):Ea.updateRenderData(X.LayerClass.MAP,qa)});this._renderer.transparency=this._allSurfaceLayersTransparent()?ha.TransparencyMode.Invisible:this._renderer.transparency};Ta._invalidateLayerData=function(qa,Ea){this._allTiles.forAll(Oa=>Oa.removeLayerAgent(qa,Ea));this._allTiles.forAll(Oa=>Oa.invalidateLayerData(qa,Ea))};Ta.setTileTreeDirty=function(){this._allTilesDirty=!0};Ta.requestRender=function(qa=Aa.RenderRequestType.UPDATE){this.renderer.setNeedsRender(qa)};
Ta.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Ta.requestTileData=function(qa,Ea,Oa,Va){const Ua=this.layerViewByIndex(Ea,Oa);Ea=Ua.layer;if(!Ea.tilemapCache||Z.isVectorTileLayerView(Ua))return this._requestTileData(qa,Oa,Ua,Va);++this._asyncWorkItems;return Ea.tilemapCache.fetchAvailability(qa.lij[0],qa.lij[1],qa.lij[2],{...Va,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(La=>{--this._asyncWorkItems;t.throwIfAborted(Va);t.isAbortError(La)||this._dataMissing(qa,
Oa,Ua,{notInTilemap:!0});throw La;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(qa,Oa,Ua,Va),Va.signal))};Ta._requestTileData=function(qa,Ea,Oa,Va){return Ea===X.LayerClass.ELEVATION?Z.isElevationLayerView(Oa)?this._requestElevationTileData(qa,Oa,Va):Promise.reject():Z.isMapTileLayerView(Oa)?this._requestMapTileData(qa,Oa,Va):Promise.reject()};Ta._requestElevationTileData=function(qa,Ea,Oa){++this._asyncWorkItems;const Va=ta=>{if(!t.isAborted(Oa)){var xa=this._layerIndexByUid[X.LayerClass.ELEVATION].get(Ea.uid);
null==xa?d.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",X.LayerClass.ELEVATION,qa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(qa,xa,ta))}},Ua=ta=>{t.isAbortError(ta)||(this._dataMissing(qa,X.LayerClass.ELEVATION,Ea,ta),this.requestUpdate())};if(Z.useFetchTileForLayer(Ea.layer))return Ea.layer.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],{noDataValue:ma.ELEVATION_NODATA_VALUE,signal:Oa.signal}).then(ta=>{if(t.isAborted(Oa))d.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");
else return this._frameTask.schedule(()=>Va(ta),Oa.signal,Ua)},Ua).finally(()=>{--this._asyncWorkItems});const La=Ea.getTileUrl(qa.lij[0],qa.lij[1],qa.lij[2]);return this._elevationDataRequester.request(La,"binary",Oa).then(ta=>this._lercDecoder.decode(ta,{noDataValue:ma.ELEVATION_NODATA_VALUE},Oa.signal)).then(ta=>{ta?Va({values:ta.pixelData,width:ta.width,height:ta.height,noDataValue:ta.noDataValue,minValue:ta.minValue,maxValue:ta.maxValue}):Ua(Error("LERC decoding failed"))},Ua).finally(()=>{--this._asyncWorkItems})};
Ta._requestMapTileData=function(qa,Ea,Oa){++this._asyncWorkItems;const Va=(Ia,Qa)=>{--this._asyncWorkItems;Z.releaseTileData(Qa);t.isAborted(Oa)||(this._dataMissing(qa,X.LayerClass.MAP,Ea,Ia),this.requestUpdate())},Ua=Ia=>Qa=>Va(Qa,Ia),La=Ia=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();t.isAborted(Oa)?Z.releaseTileData(Ia):this._mapTileDataArrived(qa,Ea,Ia)},Oa.signal,Ua(Ia)).catch(Ua(Ia)),ta=(Ia,Qa=null)=>this._frameTask.schedule(()=>Va(Ia,Qa));if(Z.isVectorTileLayerView(Ea)){var xa=
Ea.schemaHelper.getLevelRowColumn(qa.lij);return Ea.fetchTile(xa[0],xa[1],xa[2],Oa).then(La,ta)}if(Z.isImageryTileLayerView(Ea))return Ea.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],Oa).then(La,ta);if(Z.isTileLayerView(Ea)&&Z.useFetchTileForLayer(Ea.layer))return Ea.layer.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],Oa).then(Ia=>{t.isAborted(Oa)?(d.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
ta(t.createAbortError())):La(Ia)},ta);xa=Ea.getTileUrl(qa.lij[0],qa.lij[1],qa.lij[2]);O.isRefreshableLayer(Ea.layer)&&Ea.layer.refreshTimestamp&&(xa+=`${xa.includes("?")?"\x26":"?"}_ts=${Ea.layer.refreshTimestamp}`);return this._mapDataRequester.request(xa,Ea.hasMixedImageFormats?"image+type":"image",Oa).then(La,ta)};Ta._mapTileDataArrived=function(qa,Ea,Oa){Ea=this._getLayerIdxByUID(X.LayerClass.MAP,Ea.uid);e.isSome(Ea)?qa.dataArrived(Ea,X.LayerClass.MAP,Oa):(Z.releaseTileData(Oa),d.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))};
Ta._getLayerIdxByUID=function(qa,Ea){return this._layerIndexByUid[qa].get(Ea)};Ta._dataMissing=function(qa,Ea,Oa,Va){Oa=this._getLayerIdxByUID(Ea,Oa.uid);e.isSome(Oa)?qa.dataMissing(Oa,Ea,Va):d.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")};Ta.updateTileOverlayParams=function(qa){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ea=>{Ea.renderData&&this.overlayManager.setTileParameters(Ea)}),this._renderer.setNeedsRender(qa))};Ta.getUsedMemory=function(){if(!this.tilingScheme)return 0;
e.isNone(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory());return e.isSome(this._usedMemory)?this._usedMemory:0};Ta._recalculateUsedMemory=function(){return this.tilingScheme?this._allTiles.reduce((qa,Ea)=>qa+Ea.usedMemory,0):null};Ta.getUsedMemoryForLayerView=function(qa){let Ea=0;const Oa=this._layerClassFromLayerView(qa),Va=this._getLayerIdxByUID(Oa,qa.uid);e.isSome(Va)&&this._allTiles.forAll(Ua=>Ea+=Ua.getUsedMemoryForLayer(Oa,Va));return Ea};Ta.getTile=function(qa){if(e.isNone(qa)||
e.isNone(this.rootTiles))return null;const Ea=qa.split("/").map(La=>+La);if(0===Ea[0])return this.rootTiles.find(La=>La.lij[1]===Ea[1]&&La.lij[2]===Ea[2]);qa=2**Ea[0];const Oa=Math.floor(Ea[1]/qa),Va=Math.floor(Ea[2]/qa);let Ua;this.rootTiles.some(La=>La.lij[1]===Oa&&La.lij[2]===Va?(Ua=La,!0):!1);if(Ua){for(qa=1<<Ea[0]-1;Ua.lij[0]<Ea[0];){let La=Ea[1]&qa?2:0;0<(Ea[2]&qa)&&La++;if(!Ua.children[La])return null;Ua=Ua.children[La];qa>>=1}Z.weakAssert(Ua.lij[0]===Ea[0]&&Ua.lij[1]===Ea[1]&&Ua.lij[2]===
Ea[2],"not the right tile?");return Ua}return null};Ta.checkAllTilesWaterproofness=function(){if(Z.ENABLE_WATERPROOFNESS_TESTS){var qa=this.rootTiles;if(!e.isNone(qa)){var Ea=Ua=>0<Ua?.renderData?.geometryInfo?.indices?.length,Oa=Ua=>{if(Ua.intersectsClippingArea)if(Ua.renderData&&!Ua.renderData.geometryState&&console.error("Tile[",Ua.lij,"] has renderData but not geometryState"),Ua.renderData&&!Ua.renderData.geometryInfo&&console.error("Tile[",Ua.lij,"] has renderData but not geometryInfo"),!Ua.renderData?.geometryInfo||
0<(Ua.renderData.geometryInfo.indices?.length??0)||console.error("Tile[",Ua.lij,"] has renderData but no indices - geometryInfo: ",Ua.renderData.geometryInfo),Ea(Ua)){Ua.checkGeometryWaterproofness();for(const xa of Ua.children){var La=xa,ta=Ua;Ea(La)&&console.error("Tile[",La.lij,"] has geometry although parent[",ta.lij,"] has geom")}}else if(Ua.isLeaf)console.error("Tile[",Ua.lij,"] has no geometry and no children, from root to leaf");else for(La of Ua.children)Oa(La)},Va=Ua=>{const La=Ua.parent?.visible??
!0,ta=Ua.visible;Ua.computeVisibility();const xa=Ua.visible;ta!==xa&&La&&console.error(" Tile[",Ua.lij,"] has out of date visibility: ",ta," instead of ",xa);if(!Ua.isLeaf)for(const Ia of Ua.children)Va(Ia)};for(const Ua of qa)Oa(Ua),Va(Ua)}}};Ta._updateShadingIfChanged=function(){this.view?.map?.ground?.shading!==this._shading&&this._updateShading()};Ta._updateShading=function(){const qa=this.view?.map?.ground?.shading;this._shading=qa;this.renderer&&(this.renderer.shading=qa,this.renderer.setNeedsRender());
this._updateAllTileGeometries()};Ta.isEastEndWrap=function(qa){return this.isGlobal&&qa[2]===this.lijEastEnd(qa[0])-1};Ta.isWestEndWrap=function(qa){return this.isGlobal&&0===qa[2]};Ta.lijEastEnd=function(qa){const Ea=e.isSome(this.spatialReference)&&this.spatialReference.isGeographic;return 2**(qa+(Ea?1:0))};Ta.wrapEastWest=function(qa){const Ea=this.lijEastEnd(qa[0]),Oa=qa[2];return 0<=Oa&&Oa<Ea?qa:this.isGlobal?[qa[0],qa[1],(Oa+(0>Oa?Ea:0))%Ea]:null};Ta.enableInternalChecks=function(qa){Z.enableTerrainInternalChecks(qa)};
Ta.enableWaterproofnessChecks=function(qa){Z.enableTerrainWaterproofnessChecks(qa)};b._createClass(ja,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){if(this.lodSnapping===R.LODSnapping.ON){var qa=this.view,Ea=this.tilingScheme;const Oa=qa.pointsOfInterest?.contentCameraOnSurface?.scale;if(Oa&&Ea){const Va=qa.state.contentCamera;qa=I.directionToHeadingTilt(qa,Va.eye,Va.viewForward,Va.up).tilt;90<qa&&(qa=180-
qa);qa=2*(qa/90)**2;Ea=Ea.levelAtScale(Oa);return Math.round(Ea-qa)}}return null}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?R.LODSnapping.ON:R.LODSnapping.OFF}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},
{key:"_userClippingExtent",get:function(){var {spatialReference:qa}=this,{clippingArea:Ea}=this.view;if(e.isNone(Ea)||e.isNone(qa))return null;const Oa=J.create();qa=Q.toBoundingRect(Ea,Oa,qa)?Oa:null;Ea=this._get("extent");return J.equals(qa,Ea)?Ea:qa}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},{key:"extent",get:function(){const qa=J.intersection(this.groundExtent,this._userClippingExtent,J.create()),Ea=this._get("extent");return J.equals(qa,Ea)?Ea:qa}},{key:"groundExtent",
get:function(){return e.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){return this.tilingSchemeLogic?.extent}},{key:"updating",get:function(){this._hasPendingUpdates||(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager.updating)}},{key:"running",get:function(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||
!this._allTilesSorted||this._layerViewsDirty||this._frameTask.updating)&&this.ready&&!this.suspended}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"baseOpacity",get:function(){return this.view.map.ground.opacity},set:function(qa){this.view.map.ground.opacity=qa}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return e.isSome(this.rootTiles)}},
{key:"renderOrder",set:function(qa){this._renderer.renderOrder=qa;this._set("renderOrder",qa)}},{key:"spatialReference",get:function(){return this.tilingScheme?.spatialReference??null}},{key:"backgroundColor",get:function(){return this.view.map.ground.surfaceColor},set:function(qa){this.view.map.ground.surfaceColor=qa}},{key:"slicePlaneEnabled",set:function(qa){this._renderer.slicePlaneEnabled=qa;this._set("slicePlaneEnabled",qa);this._evaluateTransparency(this.baseOpacity)}},{key:"tilingSchemeLocked",
get:function(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}},{key:"velvetOverground",set:function(qa){qa!==this.velvetOverground&&(this._renderer.velvetOverground=qa);this._set("velvetOverground",qa)}},{key:"wireframe",get:function(){return this._renderer.wireframe},set:function(qa){qa!==this._renderer.wireframe&&(this._renderer.wireframe=qa,this._updateAllTileGeometries())}},{key:"_visible",set:function(qa){qa!==this._visibleCached&&(this._visibleCached=qa,this._renderer.setVisibility(qa),
this.suspended=!qa)}},{key:"opaque",get:function(){return this._renderer.transparency===ha.TransparencyMode.Opaque}},{key:"suspended",set:function(qa){this._set("suspended",qa);this._viewChangeUpdate()}},{key:"textureFadeDuration",get:function(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"_lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*
ma.MAX_MEMORY_LOD_BIAS}},{key:"shortBatches",get:function(){return this.view.state.mode!==ua.RenderState.IDLE}},{key:"performanceInfo",get:function(){const qa=this._performanceInfo;qa.numNodes=this._allTiles.length;qa.numLeaves=qa.numVisible=qa.numRendered=qa.numLoadedPerLevel.length=qa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ea=>{Ea.isLeaf&&qa.numLeaves++;const Oa=Ea.level;Ea.renderData&&(qa.numLoadedPerLevel[Oa]=(qa.numLoadedPerLevel[Oa]||0)+1);Ea.visible&&(qa.numVisible++,Ea.rendered&&
(qa.numRenderedPerLevel[Oa]=(qa.numRenderedPerLevel[Oa]||0)+1,qa.numRendered++))});return qa}},{key:"renderPatchBorders",get:function(){return this._renderer.renderPatchBorders},set:function(qa){this._renderer.renderPatchBorders=qa}},{key:"visualizeNormals",get:function(){return this._renderer.visualizeNormals},set:function(qa){this._renderer.visualizeNormals=qa}},{key:"renderingDisabled",get:function(){return this._renderer.renderingDisabled},set:function(qa){this._renderer.renderingDisabled=qa}},
{key:"test",get:function(){const qa=this;return{renderer:qa._renderer,lercDecoder:qa._lercDecoder,forceReload:()=>{e.isSome(qa.rootTiles)&&(qa._mergeTile(qa.rootTiles[0]),qa._viewChangeUpdate())},getTiles:()=>qa._allTiles.toArray(),getRenderedTiles(){ya.clear();qa._allTiles.forAll(Oa=>{Oa.visible&&Oa.rendered&&ya.push(Oa)});const Ea=ya.toArray();da.sortTiles(qa.renderOrder,Ea);return Ea},lockTilingScheme(Ea,Oa){qa._extentHelper.defaultTiledLayersExtent=Oa;qa.tilingSchemeLogic.test.lockTilingScheme(Ea)}}}},
{key:"isGlobal",get:function(){return this._isGlobal}},{key:"shading",get:function(){return this._shading}},{key:"isWebMercator",get:function(){return this._isWebMercator}},{key:"isWebMercatorOnPlateeCarree",get:function(){return this._isWebMercatorOnPlateeCarree}}]);return ja}(g.EventedMixin(m));c.__decorate([u.property()],m.prototype,"_renderer",void 0);c.__decorate([u.property()],m.prototype,"_hasPendingUpdates",void 0);c.__decorate([u.property()],m.prototype,"_asyncWorkItems",void 0);c.__decorate([u.property()],
m.prototype,"_allTilesDirty",void 0);c.__decorate([u.property()],m.prototype,"_allTilesSorted",void 0);c.__decorate([u.property()],m.prototype,"_viewChanged",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"_watchUpdatingTracking",void 0);c.__decorate([u.property()],m.prototype,"_frameTask",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"snapLevel",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"lodSnapping",null);c.__decorate([u.property({constructOnly:!0})],
m.prototype,"view",void 0);c.__decorate([u.property()],m.prototype,"_userClippingExtent",null);c.__decorate([u.property()],m.prototype,"_rootTilesExtent",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"extent",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"groundExtent",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"_tilingSchemeExtent",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"updating",null);c.__decorate([u.property({readOnly:!0})],m.prototype,
"running",null);c.__decorate([u.property(S.updatingProgress)],m.prototype,"updatingProgress",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);c.__decorate([u.property()],m.prototype,"_maxNumUpdating",void 0);c.__decorate([u.property()],m.prototype,"baseOpacity",null);c.__decorate([u.property()],m.prototype,"hasCompositeBlendMode",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"overlayManager",void 0);c.__decorate([u.property({readOnly:!0})],
m.prototype,"viewingMode",null);c.__decorate([u.property()],m.prototype,"maxTextureScale",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"ready",null);c.__decorate([u.property({value:ba.RenderOrder.FRONT_TO_BACK})],m.prototype,"renderOrder",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"rootTiles",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"spatialReference",null);c.__decorate([u.property({type:r})],m.prototype,"backgroundColor",null);c.__decorate([u.property({value:!1})],
m.prototype,"slicePlaneEnabled",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"tilingScheme",void 0);c.__decorate([u.property({readOnly:!0})],m.prototype,"tilingSchemeLocked",null);c.__decorate([u.property({readOnly:!0})],m.prototype,"tilingSchemeLogic",void 0);c.__decorate([u.property({value:!0})],m.prototype,"velvetOverground",null);c.__decorate([u.property()],m.prototype,"wireframe",null);c.__decorate([u.property({value:!1})],m.prototype,"suspended",null);c.__decorate([u.property()],
m.prototype,"textureFadeDuration",null);c.__decorate([u.property()],m.prototype,"visibleElevationBounds",void 0);c.__decorate([u.property()],m.prototype,"rootTileElevationBounds",void 0);c.__decorate([u.property()],m.prototype,"_layerViewsDirty",void 0);c.__decorate([u.property()],m.prototype,"renderPatchBorders",null);c.__decorate([u.property()],m.prototype,"visualizeNormals",null);c.__decorate([u.property()],m.prototype,"renderingDisabled",null);c=m=c.__decorate([y.subclass("esri.views.3d.terrain.TerrainSurface")],
m);const Ba=x.create(),Ha=J.create(),wa=[0,0,0],ya=new A,Na={spatialReference:null,extent:J.create(),context:"ground"},Ra={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){let b=function(){function c(m){this._store=m}var r=c.prototype;r.destroy=function(){this._store.destroy()};r.get=function(m){return this._store.get(m)};r.put=function(m,n){this._store.put(m,n,n.values.byteLength+256)};return c}();a.ElevationQueryTileCache=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],function(a,b,c,r){let m=function(p){function g(d=null){var f=p.call(this,"LercWorker","_decode",{_decode:e=>[e.buffer]},d,{strategy:"dedicated"})||this;f.schedule=d;f.ref=0;return f}b._inheritsLoose(g,p);var h=g.prototype;h.decode=function(d,f,e){return d&&
0!==d.byteLength?this.invoke({buffer:d,options:f},e):Promise.resolve(null)};h.release=function(){0>=--this.ref&&(n.forEach((d,f)=>{d===this&&n.delete(f)}),this.destroy())};return g}(r.WorkerHandle);const n=new Map;a.acquireDecoder=function(p=null){let g=n.get(c.unwrap(p));g||(c.isSome(p)?(g=new m(h=>p.schedule(h)),n.set(p,g)):(g=new m,n.set(null,g)));++g.ref;return g};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(){function d(e,l,A,t,w={}){this._mainMethod=l;this._transferLists=A;this._listeners=[];this._promise=g.open(e,{...w,schedule:t}).then(u=>{if(void 0===this._thread){this._thread=u;this._promise=null;w.hasInitialize&&this.broadcast({},"initialize");for(const z of this._listeners)this._connectListener(z)}else u.close()});this._promise.catch(u=>m.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${u}`))}var f=d.prototype;f.on=
function(e,l){const A={removed:!1,eventName:e,callback:l,threadHandle:null};this._listeners.push(A);this._connectListener(A);return r.makeHandle(()=>{A.removed=!0;c.remove(this._listeners,A);this._thread&&n.isSome(A.threadHandle)&&A.threadHandle.remove()})};f.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};f.invoke=function(e,l){return this.invokeMethod(this._mainMethod,e,l)};f.invokeMethod=function(e,l,A){if(this._thread){var t=this._transferLists[e];
t=t?t(l):[];return this._thread.invoke(e,l,{transferList:t,signal:A})}return this._promise?this._promise.then(()=>{p.throwIfAborted(A);return this.invokeMethod(e,l,A)}):Promise.reject(null)};f.broadcast=function(e,l){return this._thread?Promise.all(this._thread.broadcast(l,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,l)):Promise.reject()};f._connectListener=function(e){this._thread&&this._thread.on(e.eventName,e.callback).then(l=>{e.removed||(e.threadHandle=l)})};b._createClass(d,
[{key:"promise",get:function(){return this._promise}}]);return d}();a.WorkerHandle=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,c,r,m,n,p,g,h){h=function(f){function e(A,
t,w,u,z,y,B,C=null){t=f.call(this,A,t,w,u,z,y,4096,4096)||this;t._memCache=C;t.type="vector-tile";t._referenced=0;t._hasSymbolBuckets=!1;t._memoryUsedByLayerData=0;t.layerData=new Map;t.layerCount=0;t.status="loading";t.allSymbolsFadingOut=!1;t.lastOpacityUpdate=0;t.symbols=new Map;t.isCoverage=!1;t.neededForCoverage=!1;t.decluttered=!1;t.invalidating=!1;t.parentTile=null;t.childrenTiles=new Set;t._processed=!1;t._referenced=1;t.styleRepository=B;t.id=A.id;return t}b._inheritsLoose(e,f);var l=e.prototype;
l.setData=function(A){this.changeDataImpl(A);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};l.deleteLayerData=function(A){let t=!1;for(const w of A)this.layerData.has(w)&&(A=this.layerData.get(w),this._memoryUsedByLayerData-=A.memoryUsed,A.type===n.BucketType.SYMBOL&&this.symbols.has(w)&&(this.symbols.delete(w),t=!0),A.destroy(),this.layerData.delete(w),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);
t&&this.emit("symbols-changed");this.requestRender()};l.processed=function(){return this._processed};l.hasData=function(){return 0<this.layerCount};l.dispose=function(){"unloaded"!==this.status&&(d.delete(this),e._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};l.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};l.retain=function(){++this._referenced};l.changeDataImpl=
function(A){let t=!1;if(A){const {bucketsWithData:w,emptyBuckets:u}=A;A=this._createRenderBuckets(w);if(u&&0<u.byteLength){const z=new Uint32Array(u);for(const y of z)this._deleteLayerData(y)}for(const [z,y]of A)this._deleteLayerData(z),y.type===n.BucketType.SYMBOL&&(this.symbols.set(z,y.symbols),t=!0),this._memoryUsedByLayerData+=y.memoryUsed,this.layerData.set(z,y),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=
!1;for(const [,w]of this.layerData)w.type===n.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")};l.attachWithContext=function(A){this.stage={context:A,trashDisplayObject(t){t.processDetach()},untrashDisplayObject(){return!1}}};l.setTransform=function(A){f.prototype.setTransform.call(this,A);var t=this.resolution/(A.resolution*A.pixelRatio);const w=this.width/this.rangeX*t;t*=this.height/this.rangeY;const u=[0,0];A.toScreen(u,[this.x,this.y]);const z=this.transforms.tileUnitsToPixels;
r.identity(z);r.translate(z,z,u);r.rotate(z,z,Math.PI*A.rotation/180);r.scale(z,z,[w,t,1])};l._createTransforms=function(){return{dvs:m.create(),tileMat3:m.create(),tileUnitsToPixels:m.create()}};e._destroyRenderBuckets=function(A){if(A){var t=new Set;A.forEach(w=>{t.has(w)||(w.destroy(),t.add(w))});A.clear()}};l._createRenderBuckets=function(A){const t=new Map,w=new Map;for(const u of A){A=this._deserializeBucket(u,w);for(const z of A.layerUIDs)t.set(z,A)}return t};l._deserializeBucket=function(A,
t){let w=t.get(A);if(w)return w;switch((new Uint32Array(A))[0]){case n.BucketType.FILL:w=new p.FillRenderBucket(A,this.styleRepository);break;case n.BucketType.LINE:w=new p.LineRenderBucket(A,this.styleRepository);break;case n.BucketType.SYMBOL:w=new p.SymbolRenderBucket(A,this.styleRepository,this);break;case n.BucketType.CIRCLE:w=new p.CircleRenderBucket(A,this.styleRepository)}t.set(A,w);return w};l._deleteLayerData=function(A){if(this.layerData.has(A)){var t=this.layerData.get(A);this._memoryUsedByLayerData-=
t.memoryUsed;t.destroy();this.layerData.delete(A);this.layerCount--}};b._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<g.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<g.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||
"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return e}(h.TiledDisplayObject);const d=new Map;a.VectorTile=h;a.printAllocations=function(){d.forEach((f,e)=>{console.log(`\n${e.key}:`);f[0].forEach(l=>console.log(l));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");f[1].forEach(l=>console.log(l))})};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.MemoryBufferType=void 0;(function(b){b[b.UNKNOWN=0]="UNKNOWN";b[b.FILL_VERTEX=1]="FILL_VERTEX";b[b.FILL_DD_VERTEX=2]="FILL_DD_VERTEX";b[b.FILL_INDEX=3]="FILL_INDEX";b[b.OUTLINE_VERTEX=4]="OUTLINE_VERTEX";b[b.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX";b[b.OUTLINE_INDEX=6]="OUTLINE_INDEX";b[b.LINE_VERTEX=7]="LINE_VERTEX";b[b.LINE_DD_VERTEX=8]="LINE_DD_VERTEX";b[b.LINE_INDEX=
9]="LINE_INDEX";b[b.ICON_VERTEX=10]="ICON_VERTEX";b[b.ICON_DD_VERTEX=11]="ICON_DD_VERTEX";b[b.ICON_INDEX=12]="ICON_INDEX";b[b.TEXT_VERTEX=13]="TEXT_VERTEX";b[b.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX";b[b.TEXT_INDEX=15]="TEXT_INDEX";b[b.CIRCLE_VERTEX=16]="CIRCLE_VERTEX";b[b.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(a.MemoryBufferType||(a.MemoryBufferType={}));a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));
a.DrawPhase=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.OPAQUE=1]="OPAQUE";b[b.TRANSLUCENT=2]="TRANSLUCENT";b[b.SYMBOLS=3]="SYMBOLS";b[b.HITTEST=4]="HITTEST"})(a.DrawPhase||(a.DrawPhase={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=
0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(){function A(w,u){this.layerUIDs=[];this.isDestroyed=!1;this._data=w;this.memoryUsed=w.byteLength;let z=1;w=new Uint32Array(w);this.layerUIDs=[];const y=w[z++];for(let B=0;B<y;B++)this.layerUIDs[B]=w[z++];this.bufferDataOffset=z;u&&(this.layer=u.getStyleLayerByUID(this.layerUIDs[0]))}var t=A.prototype;t.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};t.prepareForRendering=function(w){c.isNone(this._data)||(this.doPrepareForRendering(w,
this._data,this.bufferDataOffset),this._data=null)};b._createClass(A,[{key:"isPreparedForRendering",get:function(){return c.isNone(this._data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return A}(),d=function(A){function t(u,z){z=A.call(this,u,z)||this;z.type=r.BucketType.LINE;z.lineIndexStart=0;z.lineIndexCount=0;u=new Uint32Array(u);let y=z.bufferDataOffset;z.lineIndexStart=u[y++];z.lineIndexCount=u[y++];const B=u[y++];if(0<B){const C=new Map;for(let k=0;k<B;k++){const q=u[y++],
x=u[y++],v=u[y++];C.set(q,[x,v])}z.patternMap=C}z.bufferDataOffset=y;return z}b._inheritsLoose(t,A);var w=t.prototype;w.hasData=function(){return 0<this.lineIndexCount};w.triangleCount=function(){return this.lineIndexCount/3};w.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};w.doPrepareForRendering=function(u,z,y){z=new Uint32Array(z);var B=new Int32Array(z.buffer);const C=z[y++];this.lineVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;B=z[y++];this.lineIndexBuffer=n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,B));y+=B;y=this.layer.lineMaterial;this.lineVertexArrayObject=new g.VertexArrayObject(u,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return t}(h),f=function(A){function t(u,z){z=A.call(this,u,z)||this;z.type=r.BucketType.FILL;z.fillIndexStart=0;z.fillIndexCount=0;z.outlineIndexStart=0;z.outlineIndexCount=0;u=new Uint32Array(u);let y=z.bufferDataOffset;z.fillIndexStart=u[y++];z.fillIndexCount=u[y++];z.outlineIndexStart=u[y++];z.outlineIndexCount=u[y++];const B=u[y++];if(0<B){const C=new Map;for(let k=0;k<B;k++){const q=u[y++],x=u[y++],v=u[y++];C.set(q,[x,v])}z.patternMap=C}z.bufferDataOffset=y;return z}b._inheritsLoose(t,
A);var w=t.prototype;w.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};w.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};w.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};w.doPrepareForRendering=function(u,z,y){z=new Uint32Array(z);var B=new Int32Array(z.buffer),C=z[y++];this.fillVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;C=z[y++];
this.fillIndexBuffer=n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,C));y+=C;C=z[y++];this.outlineVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;B=z[y++];this.outlineIndexBuffer=n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,B));y+=B;z=this.layer;y=z.fillMaterial;z=z.outlineMaterial;this.fillVertexArrayObject=new g.VertexArrayObject(u,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new g.VertexArrayObject(u,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return t}(h),e=function(A){function t(u,z,y){z=A.call(this,u,z)||this;z.type=r.BucketType.SYMBOL;z.iconPerPageElementsMap=new Map;z.glyphPerPageElementsMap=new Map;z.symbolInstances=[];z.isIconSDF=!1;z.opacityChanged=!1;z.lastOpacityUpdate=0;z.symbols=[];const B=new Uint32Array(u),C=new Int32Array(u);u=new Float32Array(u);
let k=z.bufferDataOffset;z.isIconSDF=!!B[k++];var q=B[k++];for(var x=0;x<q;x++){var v=B[k++],D=B[k++],F=B[k++];z.iconPerPageElementsMap.set(v,[D,F])}q=B[k++];for(x=0;x<q;x++)v=B[k++],D=B[k++],F=B[k++],z.glyphPerPageElementsMap.set(v,[D,F]);q=B[k++];x=B[k++];z.iconOpacity=new Int32Array(q);z.textOpacity=new Int32Array(x);k=m.deserializeSymbols(B,C,u,k,z.symbols,y);z.bufferDataOffset=k;return z}b._inheritsLoose(t,A);var w=t.prototype;w.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};w.triangleCount=function(){let u=0;for(const [,z]of this.iconPerPageElementsMap)u+=z[1];for(const [,z]of this.glyphPerPageElementsMap)u+=z[1];return u/3};w.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};w.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var u=c.unwrap(this.iconOpacity),z=c.unwrap(this.iconOpacityBuffer);0<u.length&&u.byteLength===z.size&&z.setSubData(u,0,0,u.length);u=c.unwrap(this.textOpacity);z=c.unwrap(this.textOpacityBuffer);0<u.length&&u.byteLength===z.size&&z.setSubData(u,0,0,u.length)}};w.doPrepareForRendering=function(u,z,y){z=new Uint32Array(z);var B=new Int32Array(z.buffer),C=z[y++];this.iconVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;C=z[y++];this.iconIndexBuffer=
n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,C));y+=C;C=z[y++];this.textVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;B=z[y++];this.textIndexBuffer=n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,B));y+=B;this.iconOpacityBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,
c.unwrap(this.textOpacity).buffer);z=this.layer;y=z.iconMaterial;z=z.textMaterial;this.iconVertexArrayObject=new g.VertexArrayObject(u,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new g.VertexArrayObject(u,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return t}(h),l=function(A){function t(u,z){z=A.call(this,
u,z)||this;z.type=r.BucketType.CIRCLE;z.circleIndexStart=0;z.circleIndexCount=0;u=new Uint32Array(u);let y=z.bufferDataOffset;z.circleIndexStart=u[y++];z.circleIndexCount=u[y++];z.bufferDataOffset=y;return z}b._inheritsLoose(t,A);var w=t.prototype;w.hasData=function(){return 0<this.circleIndexCount};w.triangleCount=function(){return this.circleIndexCount/3};w.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();
c.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};w.doPrepareForRendering=function(u,z,y){z=new Uint32Array(z);var B=new Int32Array(z.buffer);const C=z[y++];this.circleVertexBuffer=n.BufferObject.createVertex(u,p.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*y,C));y+=C;B=z[y++];this.circleIndexBuffer=n.BufferObject.createIndex(u,p.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*y,B));y+=
B;y=this.layer.circleMaterial;this.circleVertexArrayObject=new g.VertexArrayObject(u,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return t}(h);a.CircleRenderBucket=l;a.FillRenderBucket=f;a.LineRenderBucket=d;a.RenderBucketBase=h;a.SymbolRenderBucket=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../enums","./core"],function(a,b,c,r,m){let n=function(h){this.tile=h;this.parent=null;this.children=new Set},p=function(){function h(){this.nodes=new Map;this.roots=new Set}var d=h.prototype;d.create=function(f){const e=new n(f);let l;const A=[];this.nodes.forEach(t=>{this._canConnectDirectly(e,t)&&A.push(t);!l&&this._canConnectDirectly(t,e)&&(l=t)});if(l){for(const t of A)l.children.delete(t),e.children.add(t),t.parent=e;l.children.add(e);e.parent=l}else{this.roots.add(e);
for(const t of A)e.children.add(t),t.parent=e,this.roots.delete(t)}this.nodes.set(f.key.id,e);return e};d.destroy=function(f){c.isSome(f.parent)?(f.parent.children.delete(f),f.children.forEach(e=>{c.isSome(f.parent)&&f.parent.children.add(e)})):this.roots.delete(f);f.children.forEach(e=>{(e.parent=f.parent)||this.roots.add(e)});this.nodes.delete(f.tile.key.id)};d.clear=function(){this.roots.clear();this.nodes.clear()};d._canConnectDirectly=function(f,e){let {level:l,row:A,col:t}=e.tile.key;for({world:e}=
e.tile.key;0<l;){l--;A>>=1;t>>=1;if(f.tile.key.level===l&&f.tile.key.row===A&&f.tile.key.col===t&&f.tile.key.world===e)return!0;if(this.nodes.has(`${l}/${A}/${t}/${e}`))break}return!1};return h}(),g=function(){function h(f,e,l){this._rows=Math.ceil(e/l);this._columns=Math.ceil(f/l);this._cellSize=l;this.cells=Array(this._rows);for(f=0;f<this._rows;f++)for(this.cells[f]=Array(this._columns),e=0;e<this._columns;e++)this.cells[f][e]=[]}var d=h.prototype;d.getCell=function(f,e){e=Math.min(Math.max(Math.floor(e/
this._cellSize),0),this._rows-1);f=Math.min(Math.max(Math.floor(f/this._cellSize),0),this._columns-1);return this.cells[e]&&this.cells[e][f]||null};d.getCellSpan=function(f,e,l,A){return[Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(A/this._cellSize),0),this.rows-1)]};b._createClass(h,[{key:"cellSize",get:function(){return this._cellSize}},
{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return h}();a.GridIndex=g;a.TileGraph=p;a.TileNode=n;a.deserializeSymbols=function(h,d,f,e,l,A){const t=d[e++];for(let z=0;z<t;z++){const y=new m.VTLSymbol(A);y.xTile=d[e++];y.yTile=d[e++];y.hash=d[e++];y.priority=d[e++];var w=d[e++];for(var u=0;u<w;u++){const B=d[e++],C=d[e++],k=d[e++],q=d[e++],x=!!d[e++],v=d[e++],D=f[e++],F=f[e++],G=d[e++],J=d[e++];y.colliders.push({xTile:B,yTile:C,dxPixels:k,dyPixels:q,
hard:x,partIndex:v,width:G,height:J,minLod:D,maxLod:F})}w=h[e++];for(u=0;u<w;u++)y.textVertexRanges.push([h[e++],h[e++]]);w=h[e++];for(u=0;u<w;u++)y.iconVertexRanges.push([h[e++],h[e++]]);l.push(y)}return e};a.tileCoordChange=function(h,d,f,e,l,A){f-=l;if(0<=f)return(d>>f)+(e-(A<<f))*(h>>f);f=-f;return d-(A-(e<<f))*(h>>f)<<f};a.writeOpacityToBuffers=function(h,d,f){for(const [z,y]of h.symbols){{var e=h,l=d,A=f,t=y;const B=e.layerData.get(z);if(B.type===r.BucketType.SYMBOL){for(const C of t){t=C.unique;
var w=void 0;if(C.selectedForRendering){var u=t.parts[0];w=u.startOpacity;u=u.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===u;w=A?Math.floor(127*w)|u<<7:u?255:0;w|=w<<24|w<<16|w<<8}else w=0;for(const [k,q]of C.iconVertexRanges)for(u=k;u<k+q;u+=4)B.iconOpacity[u/4]=w;C.selectedForRendering?(w=t.parts[1],t=w.startOpacity,w=w.targetOpacity,e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===w,t=A?Math.floor(127*t)|w<<7:w?255:0,w=t<<24|t<<16|t<<8|t):w=0;for(const [k,q]of C.textVertexRanges)for(t=
k;t<k+q;t+=4)B.textOpacity[t/4]=w}B.lastOpacityUpdate=l;B.opacityChanged=!0}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(b){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=b};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,
targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,r,m){r=function(n){function p(h,d,f,e,l,A,t=l,w=A){var u=n.call(this)||this;u.triangleCountReportedInDebug=0;u.triangleCount=0;u.texture=null;u.key=new m(h);u.resolution=d;u.x=f;u.y=e;u.width=l;u.height=A;u.rangeX=t;u.rangeY=w;return u}b._inheritsLoose(p,n);var g=p.prototype;g.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};g.setTransform=
function(h){const d=this.resolution/(h.resolution*h.pixelRatio),f=this.transforms.tileMat3,[e,l]=h.toScreenNoRotation([0,0],[this.x,this.y]);c.set(f,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,e,l,1);c.multiply(this.transforms.dvs,h.displayViewMat3,f)};return p}(r.DisplayObject);a.TiledDisplayObject=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),
function(a,b,c,r,m,n){const p=1/r("mapview-transitions-duration");c=function(g){function h(){var f=g.apply(this,arguments)||this;f._fadeOutResolver=null;f._fadeInResolver=null;f._clips=null;f.computedVisible=!0;f.computedOpacity=1;f.fadeTransitionEnabled=!1;f.inFadeTransition=!1;f._isReady=!1;f._opacity=1;f._stage=null;f._visible=!0;return f}b._inheritsLoose(h,g);var d=h.prototype;d._getTransforms=function(){m.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};
d.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=n.createResolver();this.requestRender();return this._fadeInResolver.promise};d.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=
!0;this._fadeOutResolver=n.createResolver();this.requestRender();return this._fadeOutResolver.promise};d.endTransitions=function(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()};d.beforeRender=function(f){this.updateTransitionProperties(f.deltaTime,f.state.scale)};d.afterRender=function(f){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),
this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};d.remove=function(){this.parent?.removeChild(this)};d.setTransform=function(f){};d.processRender=function(f){this.stage&&this.computedVisible&&this.doRender(f)};d.requestRender=function(){this.stage&&this.stage.requestRender()};d.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")};d.updateTransitionProperties=function(f,e){if(this.fadeTransitionEnabled){e=this._fadeOutResolver||!this.visible?0:this.opacity;const l=this.computedOpacity;l===e?this.computedVisible=this.visible:(f*=p,this.computedOpacity=l>e?Math.max(e,l-f):Math.min(e,l+f),this.computedVisible=0<this.computedOpacity,f=e===this.computedOpacity,this.inFadeTransition=!f,f||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=
this.visible};d.onAttach=function(){};d.onDetach=function(){};d.doRender=function(f){};d.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(h,[{key:"clips",get:function(){return this._clips},set:function(f){this._clips=f;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(f){this._opacity!==f&&(this._opacity=Math.min(1,Math.max(f,0)),this.requestRender())}},
{key:"stage",get:function(){return this._stage},set:function(f){if(this._stage!==f){var e=this._stage;(this._stage=f)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(f){this._visible!==f&&(this._visible=f,this.requestRender())}}]);return h}(c);a.DisplayObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function r(n,p,g,h){this.set(n,p,g,h)}r.getId=function(n,p,g,h){return"object"===typeof n?`${n.level}/${n.row}/${n.col}/${n.world}`:`${n}/${p}/${g}/${h}`};var m=r.prototype;m.acquire=function(n,p,g,h){this.set(n,p,g,h)};m.contains=function(n){const p=n.level-this.level;return 0<=p&&this.row===n.row>>p&&this.col===n.col>>p&&this.world===n.world};m.equals=
function(n){return this.level===n.level&&this.row===n.row&&this.col===n.col&&this.world===n.world};m.clone=function(){return new r(this)};m.release=function(){this.world=this.col=this.row=this.level=0};m.set=function(n,p,g,h){if(null==n)this.world=this.col=this.row=this.level=0;else if("object"===typeof n)this.level=n.level||0,this.row=n.row||0,this.col=n.col||0,this.world=n.world||0;else if("string"===typeof n){const [d,f,e,l]=n.split("/");this.level=parseFloat(d);this.row=parseFloat(f);this.col=
parseFloat(e);this.world=parseFloat(l)}else this.level=+n,this.row=+p,this.col=+g,this.world=+h||0;return this};m.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};m.getParentKey=function(){return 0>=this.level?null:new r(this.level-1,this.row>>1,this.col>>1,this.world)};m.getChildKeys=function(){const n=this.level+1,p=this.row<<1,g=this.col<<1,h=this.world;return[new r(n,p,g,h),new r(n,p,g+1,h),new r(n,p+1,g,h),new r(n,p+1,g+1,h)]};m.compareRowMajor=function(n){return this.row<
n.row?-1:this.row>n.row?1:this.col<n.col?-1:this.col>n.col?1:0};a._createClass(r,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(n){this.set(n)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return r}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?
this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let b=function(){function c(r=0,m=0){this.min=r;this.max=m;this.level=0;this.hasNoDataValues=!1}c.prototype.copyFrom=function(r){this.min=r.min;this.max=r.max;this.level=r.level;this.hasNoDataValues=r.hasNoDataValues};return c}();a.ElevationBounds=b;
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationData":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../layers/support/ElevationSamplerData ../support/mathUtils ./TerrainConst".split(" "),function(a,b,c,r,m,n){let p=function(){function h(f,e,l){this.type="elevation";this.level=f[0];this.i=f[1];this.j=f[2];this.extent=e;f=l.noDataValue;const A=l.values;let t=Infinity,w=-Infinity,u=!0,z=!1;for(let y=
0;y<A.length;y++){const B=A[y];B!==f?(t=B<t?B:t,w=B>w?B:w,u=!1):z=!0}u&&(w=t=0);w=-3E38<w?w:0;this.samplerData=new r.ElevationSamplerData(l,e);this.bounds=[t,w];this.hasNoDataValues=z}var d=h.prototype;d.release=function(){this.bounds=this.samplerData=null};d.computeMinMaxValue=function(f,e,l,A){A.min=Infinity;A.max=-Infinity;A.hasNoDataValues=!1;f-=this.level;if(0>=f)return A;var t=2**f;if(Math.floor(e/t)!==this.i||Math.floor(l/t)!==this.j)return A;var w=Infinity,u=-Infinity,z=this.samplerData.width,
y=this.samplerData.pixelData,B=.5*n.ELEVATION_NODATA_VALUE;f=(z-1)/t;l=(l-this.j*t)*f;let C=(e-this.i*t)*f;if(1>f){const x=Math.floor(l),v=Math.floor(C);var k=x+v*z;e=y[k];t=y[k+1];var q=y[k+z];k=y[k+z+1];if(e+t+q+k<B)return w=l-x,B=C-v,u=m.bilerp(e,t,q,k,w,B),z=m.bilerp(e,t,q,k,w+f,B),y=m.bilerp(e,t,q,k,w,B+f),f=m.bilerp(e,t,q,k,w+f,B+f),A.min=Math.min(u,z,y,f),A.max=Math.max(u,z,y,f),A;l=x;C=v;f=1}else l=Math.floor(l),C=Math.floor(C),f=Math.ceil(f);for(e=l;e<=l+f;e++)for(t=C;t<=C+f;t++)q=y[e+t*
z],q<B?(w=Math.min(w,q),u=Math.max(u,q)):A.hasNoDataValues=!0;A.min=w;A.max=u;return A};return h}();const g=.5*n.ELEVATION_NODATA_VALUE;a.ElevationData=p;a.sampleElevation=function(h,d,f){if(c.isNone(f))return null;for(const w of f){if(!w)continue;var e=w.safeWidth;f=b.clamp(w.dy*(w.y1-d),0,e);e=b.clamp(w.dx*(h-w.x0),0,e);const u=Math.floor(f),z=Math.floor(e);var l=w.width,A=u*l+z,t=w.pixelData;const y=t[A],B=t[A+1];A+=l;l=t[A];t=t[A+1];if(y+l+B+t<g)return f-=u,e-=z,h=y+(B-y)*e,h+(l+(t-l)*e-h)*f}return null};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){a.ElevationSamplerData=function({values:b,width:c,height:r,noDataValue:m},n){this.pixelData=b;this.width=c;this.height=r;this.safeWidth=.99999999*(c-1);this.noDataValue=m;this.dx=(c-1)/(n[2]-n[0]);this.dy=(c-1)/(n[3]-n[1]);this.x0=n[0];this.y1=n[3]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(B,C){return n.isSome(B)&&!B.spatialReference.equals(C)?f.projectWithoutEngine(B,B.spatialReference,C):B}a.ExtentHelper=function(B){function C(q){q=B.call(this,q)||this;q._handles=new m;return q}b._inheritsLoose(C,B);var k=C.prototype;k.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};k.destroy=function(){this._handles.destroy();this._handles=null};k._computeStencilEnabledExtents=
function(){const q=[];this.layerViews.forEach(x=>{x=x.layer;"IntegratedMeshLayer"===x.operationalLayerType&&null!=this.viewSpatialReference&&(x=u(x.fullExtent,this.viewSpatialReference),n.isSome(x)&&q.push(e.fromExtent(x)))});return q};b._createClass(C,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return C}(r);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([p.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([p.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([p.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);c.__decorate([p.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);c.__decorate([p.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let z=function(B){function C(){return B.apply(this,arguments)||this}b._inheritsLoose(C,B);var k=C.prototype;k._computeLayerViewsExtent=function(){return this._globalExtent};k._computeTiledLayersExtent=
function(){return this._globalExtent};b._createClass(C,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?t.WEBMERCATOR_WORLD_EXTENT:t.GEOGRAPHIC_WORLD_EXTENT}}]);return C}(a.ExtentHelper);z=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],z);let y=function(B){function C(){return B.apply(this,arguments)||this}b._inheritsLoose(C,B);var k=C.prototype;k._computeLayerViewsExtent=function(){const q=e.empty(),x=this.viewSpatialReference;this.layerViews.forEach(F=>
{const G=F.layer;!F.isResolved()||"graphics"===G.type&&G.internal||(F=u("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,x),e.expand(q,F,q))});const v=e.allFinite(q)?q:null,D=this._get("layerViewsExtent");return e.equals(v,D)?D:v};k._computeTiledLayersExtent=function(){const q=this.tilingScheme;if(!q)return null;const x=this.viewSpatialReference,v=e.empty();this.layers.forEach(G=>{if(G.loaded&&l.isTiledLayer(G)){const K=w.getTiledLayerInfo(G,
x,A.ViewingMode.Local);if(!n.isNone(K)){var {tileInfo:J,fullExtent:L}=K;n.isSome(J)&&n.isSome(L)&&(w.isProjectableRasterLayer(G)||q.compatibleWith(J)&&L.spatialReference.equals(q.spatialReference))&&e.expand(v,L,v)}}});e.expand(v,this.defaultTiledLayersExtent,v);const D=e.allFinite(v)?v:null,F=this._get("tiledLayersExtent");return e.equals(D,F)?F:D};return C}(a.ExtentHelper);y=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperLocal")],y);a.create=function(B,C){return B===A.ViewingMode.Global?
new z(C):new y(C)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q){const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(ba){function ia(ha){ha=ba.call(this,ha)||this;ha._handles=new n;ha._spatialReference=null;ha._renderSR=null;ha._overlaySREqualsRenderSR=!0;ha._drapeSources=new Set;ha._drapeTargets=new Set;ha._placementDirty=!1;ha._contentUpdated=!1;ha._drawTexturesDirty=
!1;ha._drawTexturesAnimateDirty=!1;ha._hasUnusedRenderTargets=!1;ha._longitudeCyclical=null;ha._latestOriginId=0;ha._maxResolution=p("esri-mobile")?2048:4096;ha._animationTimeLast=0;return ha}b._inheritsLoose(ia,ba);var ma=ia.prototype;ma.initialize=function(){const ha=this._view;this.renderer=new P.OverlayRenderer({view:ha,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=H.newIntersector(this._view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ka=>ha._stage?.renderView.setRenderParameters({hasOverlayWater:ka})),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),
this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),d.watch(()=>[ha.pointsOfInterest?.renderPointOfView,ha.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),d.watch(()=>ha.state?.pixelRatio,()=>this.setPlacementDirty(),d.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ha.on("resize",()=>this.setPlacementDirty()),ha.resourceController.scheduler.registerTask(Q.TaskPriority.OVERLAY,this),ha._stage.renderView.events.on("force-camera-for-screenshot",
ka=>{this._updateOverlays(ka,N.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,N.RenderRequestType.BACKGROUND,ka)})]);ha._stage?.renderView.setRenderParameters({renderOverlay:ka=>{this._contentUpdated=!1;this.renderer.processSyncDrapeSources();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ka),this._drawOverlayTextures(this.renderer.overlays,N.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})};
ma.destroy=function(){this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);h.isSome(S)&&(S.hide(),S=null)};ma.setSpatialReference=function(ha){this._spatialReference=ha;this.renderer.spatialReference=ha;this._longitudeCyclical=null;const ka=this._view.renderSpatialReference;h.isSome(ha)&&h.isSome(ka)?(this._renderSR=ka,this._overlaySREqualsRenderSR=ha.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ha.isWebMercator?new m.Cyclical(-2.0037508342787E7,
2.0037508342787E7):new m.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};ma.registerDrapeSource=function(ha,ka,Z){this._drapeSources.add(ha);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ka=this.renderer.createDrapeSourceRenderer(ha,ka,Z);this._updateDrapeSourceExtent(ha);this._setContentDirty();this.notifyChange("running");return ka};ma.registerGeometryDrapeSource=
function(ha){return this.registerDrapeSource(ha,I.SortedRenderGeometryRenderer)};ma._updateDrapeSourceExtent=function(ha){2===this.renderer.overlays.length&&h.isSome(ha.setDrapingExtent)&&h.isSome(this._spatialReference)&&ha.setDrapingExtent(this.renderer.overlays,this._spatialReference)};ma.unregisterDrapeSource=function(ha){this._drapeSources.has(ha)&&(this._drapeSources.delete(ha),this.renderer.removeDrapeSourceRenderer(ha),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),
this.notifyChange("running"))};ma.registerDrapeTarget=function(ha){this._drapeTargets.add(ha);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};ma.updateOverlayResult=function(){this._view._stage?.renderView.setRenderParameters({overlays:this.renderer.overlays})};ma.unregisterDrapeTarget=function(ha){this._drapeTargets.delete(ha);this.renderer.ensureDrapeTargets(this._drapeTargets)};ma._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};ma.setPlacementDirty=
function(){this._placementDirty=!0};ma.runTask=function(){this._updateOverlays(this._view.state.camera,N.RenderRequestType.UPDATE)};ma._updateOverlays=function(ha,ka){if(this._spatialReference){var Z=O.computeOverlayResolution(ha.fullWidth,ha.fullHeight,this._maxResolution);this._computeOverlayExtents(ha,Z,V);var ca=q.width(V.inner)/q.width(V.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ha=this._updateOverlay(K.OverlayIndex.INNER,V.inner,Z,1*V.pixelRatioAdjustment,V.mapUnitsPerPixel);
Z=this._updateOverlay(K.OverlayIndex.OUTER,V.outer,Z,ca*V.pixelRatioAdjustment,V.mapUnitsPerPixel);if(ha===aa.EXTENT||Z===aa.EXTENT)this._drapeSources.forEach(fa=>this._updateDrapeSourceExtent(fa)),this.surface.updateTileOverlayParams(ka);ha===aa.NONE&&Z===aa.NONE||this.setDrawTexturesDirty();this._placementDirty=!1}};ma._updateOverlay=function(ha,ka,Z,ca,fa){if(0===this.renderer.overlays.length)return aa.NONE;ha=this.renderer.overlays[ha];const ea=ha.mapUnitsPerPixel;ha.mapUnitsPerPixel=fa;ha.pixelRatio=
ca;ca=ha.extent;const da=J.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ka[2]-ka[0],ka[3]-ka[1],ca[2]-ca[0],ca[3]-ca[1]);if(Math.abs(ca[0]-ka[0])<=da&&Math.abs(ca[1]-ka[1])<=da&&Math.abs(ca[2]-ka[2])<=da&&Math.abs(ca[3]-ka[3])<=da&&Z===ha.resolution)return ea===fa?aa.NONE:aa.RERENDER_ONLY;q.copy(ha.extent,ka);ha.resolution=Z;ka=q.center(ha.extent);ha.renderLocalOrigin=E.fromValues(ka[0],ka[1],0,`OV_${this._latestOriginId++}`);return aa.EXTENT};ma.setTileParameters=function(ha){const ka=ha.renderData.overlay;
if(0<this.renderer.overlays.length){const Z=this.renderer.overlays[K.OverlayIndex.INNER],ca=this.renderer.overlays[K.OverlayIndex.OUTER];ha=ha.extent;this._rectInsideRect(Z.extent,ha)||this._rectanglesOverlap(ha,Z.extent)||this._rectanglesOverlap(ha,ca.extent)?(this._setTileOverlayData(ha,K.OverlayIndex.INNER,ka),this._setTileOverlayData(ha,K.OverlayIndex.OUTER,ka)):(this._clearTileOverlayData(K.OverlayIndex.INNER,ka),this._clearTileOverlayData(K.OverlayIndex.OUTER,ka))}else this._clearTileOverlayData(K.OverlayIndex.INNER,
ka),this._clearTileOverlayData(K.OverlayIndex.OUTER,ka)};ma.overlayPixelSizeInMapUnits=function(ha){if(0===this.renderer.overlays.length)return 0;const ka=this.renderer.overlays[K.OverlayIndex.INNER],Z=this.renderer.overlays[K.OverlayIndex.OUTER];ha=this._pointIsInExtent(ha,ka.extent)?ka:Z;return(ha.extent[2]-ha.extent[0])/ha.resolution};ma._setTileOverlayData=function(ha,ka,Z){if(0!==this.renderer.overlays.length){var ca=this.renderer.overlays[ka].extent,fa=q.width(ca),ea=q.height(ca),da=ha[0];if(this._longitudeCyclical){da=
this._longitudeCyclical.minimalMonotonic(ca[0],da);const la=this._longitudeCyclical.minimalMonotonic(ca[0],ha[2]);da>la&&(da=la-(ha[2]-ha[0]))}Z.setScale(ka,q.width(ha)/fa,q.height(ha)/ea);Z.setOffset(ka,(da-ca[0])/fa,(ha[1]-ca[1])/ea)}};ma._clearTileOverlayData=function(ha,ka){ka.setScale(ha,-1,-1);ka.setOffset(ha,-1,-1)};ma.reloadShaders=function(){var ha=b._asyncToGenerator(function*(){M.removeLoadedShaderModules();yield this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask()});
return function(){return ha.apply(this,arguments)}}();ma._dispatchAnimationUpdate=function(ha){const ka=f.Milliseconds(ha-this._animationTimeLast);ha=h.unwrapOr(this._view.state.forcedAnimationTime,ha);if(ka>=this.surface.view._stage.renderView.animationTimestep||h.isSome(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)this.renderer.updateAnimation({time:ha,camera:this._view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=
ha};ma.setDrawTexturesDirty=function(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()};ma._intersectGroundFromView=function(ha,ka,Z,ca){Z=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ha,W,ka,Z);if(h.isNone(Z))return!1;ka=Z.origin;Z=u.add(Y,Z.origin,Z.direction);this._groundIntersector.reset(ka,Z,ha);this._groundIntersector.intersect([],null);this._view.basemapTerrain.intersect(this._groundIntersector,
null,ka,Z);return this._groundIntersector.results.min.getIntersectionPoint(ca)};ma._findHorizonBasedPointOfInterest=function(ha,ka){var Z=.5;Z=this._view.renderCoordsHelper.getAltitude(ha.eye);const ca=this._view.pointsOfInterest.centerOnSurfaceFrequent;var fa=g.clamp(ca.estimatedSurfaceAltitude,ha.aboveGround?-Infinity:Z+1E-5,ha.aboveGround?Z-1E-5:Infinity);Z=ha.aboveGround;if("global"===this._view.viewingMode){var ea=Y;v.closestPointOnSilhouette(v.fromRadius(v.tmpSphere,k.getReferenceEllipsoid(this._view.spatialReference).radius+
fa),x.wrap(ha.eye,ha.viewForward),ea);u.subtract(ea,ea,ha.eye);fa=m.cyclicalPI.normalize(D.angleAroundAxis(ha.viewForward,ea,ha.viewRight))/ha.fovY+.5;ea=0>=fa||1<=fa?.5:.55;Z=Z?ea*fa:fa+ea*(1-fa)}else fa=B.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ha.viewForward[2])),1,0),fa=y.transformMat4(fa,fa,ha.projectionMatrix)[1],fa=g.clamp(.5+.5*fa,0,1),Z=1===fa||0===fa?.5:Z?.55*fa:1-.55*(1-fa);return this._intersectGroundFromView(ha,.5,Z,ka)?u.sqrDist(ka,ha.eye)<ca.distance*ca.distance:!1};ma._computeOverlayExtents=
function(ha,ka,Z){var ca=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,fa=z.create();this._findHorizonBasedPointOfInterest(ha,fa)||u.copy(fa,ca);var ea=Math.max(.1,u.distance(ha.eye,fa));ca=G.viewAngle(this._view.renderCoordsHelper,ca,ha.eye);const da=Math.PI/2-Math.abs(ca-Math.PI/2);J.OVERLAY_SHOW_CENTER?(h.isNone(S)&&(S=new L.PointGraphics(this._view.graphics,"red")),S.show(fa,this._renderSR)):h.isSome(S)&&S.hide();this._overlaySREqualsRenderSR||C.projectVectorToVector(fa,this._renderSR,
fa,this._spatialReference);ca=this.surface.extent;var la=!this._isSpherical&&h.isSome(this._spatialReference)&&this._spatialReference.isGeographic,oa=la&&h.isSome(this._spatialReference)?1/k.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ea=ha.perRenderPixelRatio*ea*oa;Z.mapUnitsPerPixel=ea/this._worldToPCSRatio;ea=ka*ea/2;var ra=!1;la=la?90:Infinity;this._isSpherical&&h.isSome(ca)&&h.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ea/=Math.cos(F.y2lat(fa[1])),
la=ca[3]):(ra=!0,ea/=k.getReferenceEllipsoid(this._spatialReference).metersPerDegree,la=90),ea>=la&&(ea=la,fa[1]=0,this._spatialReference.isWebMercator&&(fa[0]=0)));oa=1;ra&&(oa=1/Math.max(.2,Math.cos(Math.abs(g.deg2rad(fa[1])))),180<ea*oa&&(oa=180/ea),Z.mapUnitsPerPixel*=oa);ra=Math.log(2)/12;ea=Math.exp(Math.round(Math.log(ea)/ra)*ra);const Aa=ea*oa;ra=.5*ka/(32*Aa);var ua=.5*ka/(32*ea);fa[0]=Math.round(fa[0]*ra)/ra;fa[1]=Math.round(fa[1]*ua)/ua;ra=Z.inner;ra[0]=fa[0]-Aa;ra[1]=fa[1]-ea;ra[2]=fa[0]+
Aa;ra[3]=fa[1]+ea;this._isSpherical&&this._shiftExtentToFitBounds(ra,Infinity,la);ua=Z.outer;6*Aa>q.width(ca)?q.copy(ua,h.unwrap(ca)):da<=.25*Math.PI?(ua[0]=ra[0]-Aa,ua[1]=ra[1]-ea,ua[2]=ra[2]+Aa,ua[3]=ra[3]+ea):(C.projectVectorToVector(ha.eye,this._renderSR,Y,this._spatialReference),w.subtract(U,fa,Y),ha=-Math.atan2(U[1],U[0])+.125*Math.PI,0>ha&&(ha+=2*Math.PI),y.scale(U,T[Math.floor(ha/(.25*Math.PI))],2*ea),U[0]*=oa,U[2]*=oa,y.add(ua,ra,U));this._isSpherical?(ua[0]=this._longitudeCyclical.clamp(ua[0]),
ua[2]=this._longitudeCyclical.clamp(ua[2]),ua[1]=Math.max(ua[1],-la),ua[3]=Math.min(ua[3],la)):(ha=q.intersection(ra,ca,R),fa=q.intersection(ua,ca,X),q.contains(ha,fa)&&(ua[2]=ua[0],ua[3]=ua[1]));ka=Math.abs(ra[2]-ra[0])/ka;Z.mapUnitsPerPixel=Math.max(Z.mapUnitsPerPixel,ka);Z.pixelRatioAdjustment=Z.mapUnitsPerPixel/ka};ma._drawOverlayTextures=function(ha,ka,Z=this._view.state.camera){if(0!==ha.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var ca=this._drawTexturesDirty;this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1;var fa=this._drawOverlay(ha[K.OverlayIndex.INNER],Z);ha=this._drawOverlay(ha[K.OverlayIndex.OUTER],Z);fa!==N.ValidationState.CHANGED&&ha!==N.ValidationState.CHANGED||this.surface.updateTileOverlayParams(N.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateOverlayResult();ca?(this.surface.requestRender(ka),ka===N.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(N.RenderRequestType.BACKGROUND)}};ma._drawOverlay=function(ha,
ka){this._longitudeCyclical?ha.setupGeometryViewsCyclical(this._longitudeCyclical):ha.setupGeometryViewsDirect();return ha.draw(this.renderer,ka.pixelRatio)};ma._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ha=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(ha)}};ma._rectanglesOverlap=function(ha,ka){return h.isNone(ha)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ka[0],ka[2],
ha[0])||this._longitudeCyclical.contains(ka[0],ka[2],ha[2])||this._longitudeCyclical.contains(ha[0],ha[2],ka[0]))&&!(ha[1]>ka[3]||ha[3]<ka[1]):q.intersects(ha,ka)};ma._rectInsideRect=function(ha,ka){return h.isNone(ka)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ha[0],ha[2],ka[0])&&this._longitudeCyclical.contains(ha[0],ha[2],ka[2])&&ka[1]>ha[1]&&ka[3]<ha[3]:q.contains(ha,ka)};ma._pointIsInExtent=function(ha,ka){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ka[0],
ka[2],ha.x)&&ha.y>=ka[1]&&ha.y<=ka[3];const Z=ha.x;ha=ha.y;return Z>ka[0]&&Z<ka[2]&&ha>ka[1]&&ha<ka[3]};ma._shiftExtentToFitBounds=function(ha,ka,Z){let ca=0,fa=0;ha[0]<-ka?ca=ha[0]+ka:ha[2]>ka&&(ca=ka-ha[2]);ha[1]<-Z?fa=ha[1]+Z:ha[3]>Z&&(fa=Z-ha[3]);q.offset(ha,ca,fa)};b._createClass(ia,[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this._view.graphics.length||J.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},
{key:"_isSpherical",get:function(){return this._view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return h.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?k.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"_view",get:function(){return this.surface.view}},{key:"suspended",get:function(){return this.surface.suspended}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",
get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return ia}(r);c.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,
"running",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([e.property()],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);c.__decorate([e.property()],
a.OverlayManager.prototype,"suspended",null);c.__decorate([e.property()],a.OverlayManager.prototype,"updating",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([t.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const U=B.create(),Y=z.create(),V={inner:q.create(),outer:q.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},
R=q.create(),X=q.create(),W=x.create();var aa;(function(ba){ba[ba.NONE=0]="NONE";ba[ba.EXTENT=1]="EXTENT";ba[ba.RERENDER_ONLY=2]="RERENDER_ONLY"})(aa||(aa={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const c=Object.keys(b);for(const r of c)-1!==r.search(".glsl")&&delete b[r]}};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./interfaces ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(w){function u(y,B,C){var k=w.call(this)||this;k._horizontalScaleFactor=1;k._extentInRenderSR=g.create();void 0!==y&&k.init(y,B,C);return k}b._inheritsLoose(u,w);var z=u.prototype;z.init=function(y,B,C){w.prototype.init.call(this,y,B,C);y=C.view.renderSpatialReference;C=C.spatialReference;this._horizontalScaleFactor=B=c.isSome(y)&&h.isPlateCarree(y)&&c.isSome(C)&&C.isGeographic?this.ellipsoid.radius*Math.PI/180:1;C=this._extentInRenderSR;y=this.extent;
if(this.surface.isWebMercatorOnPlateeCarree)B=r.fromValues(y[0],y[1],0),m.projectVectorToVector(B,n.WebMercator,B,n.PlateCarree),y=r.fromValues(y[2],y[3],0),m.projectVectorToVector(y,n.WebMercator,y,n.PlateCarree),C[0]=B[0],C[1]=B[1],C[2]=y[0],C[3]=y[1];else for(let k=0;4>k;++k)C[k]=y[k]*B;this.centerAtSeaLevel[0]=.5*(C[0]+C[2]);this.centerAtSeaLevel[1]=.5*(C[1]+C[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(C[2]-C[0],C[3]-C[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};
z.updateRadiusAndCenter=function(){this._updateCenter();var y=this._extentInRenderSR;const B=.5*(y[2]-y[0]);y=.5*(y[3]-y[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(B*B+y*y),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};z._calculateFrustumVisibilityStatus=function(y){var B=this._aabb();const C=B[0],k=B[1],q=B[2],x=B[3],v=B[4];B=B[5];let D=!0;for(let G=0;6>G;G++){var F=y[G];const J=F[0],L=F[1],K=F[2];F=F[3];if(0<=J*(0<J?C:x)+L*(0<L?k:v)+K*(0<K?q:B)+F)return d.TileFrustumVisibility.OUTSIDE;
D=D&&0>=J*(0>J?C:x)+L*(0>L?k:v)+K*(0>K?q:B)+F}return D?d.TileFrustumVisibility.INSIDE:d.TileFrustumVisibility.INTERSECTS};z._aabb=function(){const y=this._extentInRenderSR;return p.wrap(y[0],y[1],this.elevationBounds[0],y[2],y[3],this.elevationBounds[1])};z.intersectsRay=function(y,B,C,k){t[0]=1/B[0];t[1]=1/B[1];t[2]=1/B[2];return l.intersectAabbInvDirBefore(this._aabb(),y,t,C,k)};z.createGeometry=function(){f.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()};
z.getDefaultVerticesPerRowOnLevel=function(){return 9>this.level?3:2};z.updateCornerElevations=function(){f.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)};z.updateEdgeElevations=function(){f.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)};b._createClass(u,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]);return u}(e.Tile);const t=r.create();a.PlanarPatch=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(N){if(N.tile.intersectsClippingArea){const H=N.geometryState,E=H.numVerticesPerSide,I=E-2,M=E-1,Q=N.geometryInfo,
T=Q.vertexAttributes,S=T.position,U=T.uv0,Y=T.normalCompressed,V=N.tile,R=V.extent,X=R[0],W=R[2],aa=R[1],ba=R[3],ia=V.ellipsoid.radius,ma=H.samplerData,ha=N.localOrigin,ka=ha[0],Z=ha[1],ca=ha[2],fa=S.typedBuffer,ea=S.typedBufferStride,da=1/M,la=Q.boundingBox;let oa=0;if(1<=I){const ra=aa*(1-da)+ba*da,Aa=K.sinLatLUT[1],ua=K.cosLatLUT[1];for(let za=1;za<=I;za++){const va=za*da,Ja=K.sinLonLUT[za],pa=K.cosLonLUT[za],Ba=ia+p.sampleElevation(X*(1-va)+W*va,ra,ma),Ha=-ka+Ba*pa*ua,wa=-Z+Ba*Ja*ua,ya=-ca+Ba*
Aa;h.minMaxBoundingBox(Ha,wa,ya,la);const Na=(za-1)*ea;fa[Na+0]=Ha;fa[Na+1]=wa;fa[Na+2]=ya;h.encodeUVInBuffer(U,za-1,va,da)}}for(let ra=1;ra<=I;ra++){const Aa=ra*da,ua=aa*(1-Aa)+ba*Aa,za=K.sinLatLUT[ra],va=K.cosLatLUT[ra],Ja=ra+1,pa=Ja*da,Ba=aa*(1-pa)+ba*pa,Ha=K.sinLatLUT[Ja],wa=K.cosLatLUT[Ja],ya=K.sinLonLUT[0],Na=K.cosLonLUT[0],Ra=ia+p.sampleElevation(X,ua,ma);let Sa=Na*va*Ra-ka,ja=ya*va*Ra-Z,Ta=za*Ra-ca;const qa=oa*ea;let Ea=fa[qa+0],Oa=fa[qa+1],Va=fa[qa+2];for(let Ua=1;Ua<=I;Ua++){const La=Ua*
da,ta=X*(1-La)+W*La,xa=K.sinLonLUT[Ua],Ia=K.cosLonLUT[Ua],Qa=Ia*va,Xa=xa*va,cb=za;let db=0,fb=0,jb=0,qb=0,nb=0,sb=0;if(Ua<I){const ub=(oa+1)*ea;qb=fa[ub+0];nb=fa[ub+1];sb=fa[ub+2]}else{const ub=K.sinLonLUT[M],Db=K.cosLonLUT[M],Ab=ia+p.sampleElevation(W,ua,ma);qb=Db*va*Ab-ka;nb=ub*va*Ab-Z;sb=za*Ab-ca}const vb=Sa,Bb=ja,ab=Ta;Sa=Ea;ja=Oa;Ta=Va;Ea=qb;Oa=nb;Va=sb;const ib=qb-vb,bb=nb-Bb,Fa=sb-ab,na=bb*cb-Fa*Xa,Da=Fa*Qa-ib*cb,Ma=ib*Xa-bb*Qa;db=Da*Fa-Ma*bb;fb=Ma*ib-na*Fa;jb=na*bb-Da*ib;let Pa=0,Wa=0,$a=
0;if(1<ra){const ub=(oa-I)*ea;Pa=fa[ub+0];Wa=fa[ub+1];$a=fa[ub+2]}else{const ub=K.sinLatLUT[0],Db=K.cosLatLUT[0],Ab=ia+p.sampleElevation(ta,aa,ma);Pa=Ia*Db*Ab-ka;Wa=xa*Db*Ab-Z;$a=ub*Ab-ca}const eb=ia+p.sampleElevation(ta,Ba,ma),kb=Ia*wa*eb-ka,gb=xa*wa*eb-Z,lb=Ha*eb-ca;if(ra<I){const ub=oa+I,Db=ub*ea;fa[Db+0]=kb;fa[Db+1]=gb;fa[Db+2]=lb;h.minMaxBoundingBox(kb,gb,lb,la);h.encodeUVInBuffer(U,ub,La,pa)}const ob=Pa-kb,Eb=Wa-gb,Gb=$a-lb,pb=Eb*cb-Gb*Xa,mb=Gb*Qa-ob*cb,zb=ob*Xa-Eb*Qa;db+=mb*Gb-zb*Eb;fb+=zb*
ob-pb*Gb;jb+=pb*Eb-mb*ob;const Fb=1/Math.sqrt(db*db+fb*fb+jb*jb);h.encodeNormalToBufferFromValues(Y,oa,db*Fb,fb*Fb,jb*Fb);++oa}}}}function w(N){N.tile.intersectsClippingArea&&(D(N),u(N))}function u(N,H=!1){var E=N.geometryState;const I=N.geometryInfo,M=E.neighborData,Q=N.tile,T=Q.level,S=Q.extent,U=Q.ellipsoid.radius;var Y=Q.extentInRadians;const V=Y[0],R=Y[2],X=Y[1];Y=Y[3];const W=E.samplerData,aa=S[0],ba=S[2],ia=S[1],ma=S[3],ha=z(N),ka=I.boundingBox;E=N.localOrigin;const Z=E[0],ca=E[1],fa=E[2];
E=Q.surface.shading||!0;var ea=I.vertexAttributes,da=ea.position;const la=da.typedBuffer,oa=da.typedBufferStride,ra=ea.uv0;for(let za=0;4>za;++za){const va=1===za||3===za;ea=M.edgeResolutions[za];e.internalAssert(b.isPowerOfTwo(ea));const Ja=ea+1;var Aa=f.neighborTileIfLoadedOrSelf(Q,M.edgePeerNeighbors[za]);if(J(Q,Aa,za)){v(N,za);continue}const pa=c.isSome(Aa);e.internalAssert(!pa||Aa.level===Q.level);e.internalAssert(!pa||0>=A.compareTilesByLij(Q,Aa));da=Aa?.renderData?.geometryState;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS){var ua=
Q.surface;if(!Aa&&ua&&!ua.updatingRootTiles){const Qa=e.neighborEdgeIndices[za],Xa=Q.findNeighborTile(Qa,cb=>cb.isLoaded||cb.isLeaf||cb.level===Q.level);Xa?Xa.intersectsClippingArea&&(e.internalAssert(!Xa.isLoaded),e.internalAssert(!Xa.isLeaf),e.internalAssert(Xa.level===T)):e.internalAssert(c.isNone(ua?.rootTiles)||!Q.shouldHaveNeighbor(Qa))}}const Ba=1===za?S[2]:S[0];Aa=Aa?.extent;const Ha=pa&&va?1===za?Aa[0]:Aa[2]:Ba,wa=0===za?S[3]:S[1],ya=1===za?1:0,Na=0===za?1:0,Ra=1===za?R:V,Sa=0===za?Y:X,ja=
Math.sin(Ra),Ta=Math.cos(Ra),qa=Math.sin(Sa),Ea=Math.cos(Sa),Oa=da?.samplerData;da=(Qa,Xa,cb)=>p.sampleElevation(Qa,Xa,W);ua=(Qa,Xa,cb)=>.5*(p.sampleElevation(Qa,Xa,W)+p.sampleElevation(cb,Xa,Oa));const Va=pa?ua:da,Ua=I.outerEdges[za],La=H&&3<Ja?Ja-3:1;da=c.isSome(W)&&W.some(Qa=>null!=Qa);ua=c.isSome(Oa)&&Oa.some(Qa=>null!=Qa);const ta=da||ua,xa=1/ea,Ia=Ua.index0;E?(e.internalAssert(!pa||e.almostEquals(Aa[2]-Aa[0],S[2]-S[0])),(()=>{const Qa=1===za?-1:3===za?1:0,Xa=0===za?-1:2===za?1:0,cb=(S[2]-S[0])*
xa,db=Qa*cb,fb=Xa*cb,jb=R-V,qb=va?Qa*jb*xa:0,nb=va?0:Xa*xa,sb=Na,vb=va?Ra+qb:Ra,Bb=va?Math.sin(vb):ja,ab=va?Math.cos(vb):Ta,ib=va?Ra-qb:Ra,bb=va?Math.sin(ib):ja,Fa=va?Math.cos(ib):Ta,na=va?Sa:ha(sb+nb),Da=va?qa:Math.sin(na),Ma=va?Ea:Math.cos(na),Pa=va?Sa:ha(sb-nb),Wa=va?qa:Math.sin(Pa),$a=va?Ea:Math.cos(Pa),eb=(Ia+0)*oa;let kb=la[eb+0]+Z,gb=la[eb+1]+ca,lb=la[eb+2]+fa,ob=0,Eb=0,Gb=0;const pb=1*xa,mb=va?Ba:aa*(1-pb)+ba*pb,zb=va?Ha:mb,Fb=va?ia*(1-pb)+ma*pb:wa,ub=va?Ra:V*(1-pb)+R*pb,Db=va?ja:Math.sin(ub),
Ab=va?Ta:Math.cos(ub),Rb=va?ha(pb):Sa,Ob=va?Math.sin(Rb):qa,Sb=va?Math.cos(Rb):Ea,Hb=U+Va(mb,Fb,zb);ob=Ab*Sb*Hb;Eb=Db*Sb*Hb;Gb=Ob*Hb;for(let Cb=1;Cb<Ja-1;Cb+=La){let Ib=0,xb=0,wb=0;const Lb=(Ia+Cb+1)*oa;if(Cb<Ja-2){const Tb=(Cb+1)*xa,cc=va?Ba:aa*(1-Tb)+ba*Tb,qc=va?Ha:cc,rc=va?ia*(1-Tb)+ma*Tb:wa,kc=va?Ra:V*(1-Tb)+R*Tb,sc=va?ja:Math.sin(kc),tc=va?Ta:Math.cos(kc),Ac=va?ha(Tb):Sa,Bc=va?Math.sin(Ac):qa,Cc=va?Math.cos(Ac):Ea,Vb=U+Va(cc,rc,qc);Ib=tc*Cc*Vb;xb=sc*Cc*Vb;wb=Bc*Vb}else Ib=la[Lb+0]+Z,xb=la[Lb+
1]+ca,wb=la[Lb+2]+fa;const yb=Ib,Wb=xb,Jb=wb,Nb=ob,Xb=Eb,ac=Gb;ob=yb;Eb=Wb;Gb=Jb;const gc=Ia+Cb,dc=gc*oa,bc=Nb-Z,id=Xb-ca,jd=ac-fa;la[dc+0]=bc;la[dc+1]=id;la[dc+2]=jd;h.minMaxBoundingBox(bc,id,jd,ka);const kd=Cb*xa;h.encodeUVInBuffer(ra,gc,va?ya:kd,va?kd:Na);const Ud=kb,ld=gb,Vd=lb;kb=Nb;gb=Xb;lb=ac;const lc=Nb,uc=Xb,vc=ac;let wc=0,xc=0,yc=0;if(ta){const Tb=1/Math.sqrt(lc*lc+uc*uc+vc*vc),cc=lc*Tb,qc=uc*Tb,rc=vc*Tb,kc=yb-Ud,sc=Wb-ld,tc=Jb-Vd,Ac=sc*rc-tc*qc,Bc=tc*cc-kc*rc,Cc=kc*qc-sc*cc;wc+=Bc*tc-Cc*
sc;xc+=Cc*kc-Ac*tc;yc+=Ac*sc-Bc*kc;const Vb=Cb*xa,Sc=va?Ba:aa*(1-Vb)+ba*Vb,Wd=va?Ha:Sc,md=va?ia*(1-Vb)+ma*Vb:wa,nd=va?Ra:V*(1-Vb)+R*Vb,od=va?ja:Math.sin(nd),pd=va?Ta:Math.cos(nd),qd=va?ha(Vb):Sa,rd=va?Math.sin(qd):qa,sd=va?Math.cos(qd):Ea;let Tc=lc,Uc=uc,Vc=vc;if(pa){const Wc=U+p.sampleElevation(Wd-db,md-fb,Oa),Xd=va?bb:od,Yd=va?rd:Wa,td=va?sd:$a;Tc=(va?Fa:pd)*td*Wc;Uc=Xd*td*Wc;Vc=Yd*Wc}const Xc=U+p.sampleElevation(Sc+db,md+fb,W),ud=va?sd:Ma,vd=(va?ab:pd)*ud*Xc,wd=(va?Bb:od)*ud*Xc,xd=(va?rd:Da)*Xc;
pa||(Tc=2*lc-vd,Uc=2*uc-wd,Vc=2*vc-xd);const Ec=Tc-vd,Fc=Uc-wd,Gc=Vc-xd,yd=Fc*rc-Gc*qc,zd=Gc*cc-Ec*rc,Ad=Ec*qc-Fc*cc;wc+=zd*Gc-Ad*Fc;xc+=Ad*Ec-yd*Gc;yc+=yd*Fc-zd*Ec}else wc=lc,xc=uc,yc=vc;const Yc=1/Math.sqrt(wc*wc+xc*xc+yc*yc);Ua.setNormalFromValues(Cb,wc*Yc,xc*Yc,yc*Yc)}})()):(()=>{for(let qb=1;qb<Ja-1;qb+=La){var Qa=qb*xa;const nb=va?ya:Qa,sb=va?Qa:Na;var Xa=va?Ba:aa*(1-Qa)+ba*Qa,cb=va?ia*(1-Qa)+ma*Qa:wa;const vb=va?Ha:Xa;var db=va?Ra:V*(1-Qa)+R*Qa,fb=va?ja:Math.sin(db);db=va?Ta:Math.cos(db);var jb=
va?ha(Qa):Sa;Qa=va?Math.sin(jb):qa;jb=va?Math.cos(jb):Ea;Xa=Va(Xa,cb,vb);Xa=U+Xa;db=db*jb*Xa-Z;fb=fb*jb*Xa-ca;Qa=Qa*Xa-fa;h.minMaxBoundingBox(db,fb,Qa,ka);Xa=Ia+qb;cb=Xa*oa;la[cb+0]=db;la[cb+1]=fb;la[cb+2]=Qa;h.encodeUVInBuffer(ra,Xa,nb,sb)}})()}}function z(N){N=N.tile;if(N.surface.isWebMercator){const E=N.extent,I=N.ellipsoid.radius;return M=>Math.PI/2-2*Math.atan(Math.exp(-(E[1]*(1-M)+E[3]*M)/I))}const H=N.extentInRadians;return E=>H[1]*(1-E)+H[3]*E}function y(N){const H=N.tile;if(H.intersectsClippingArea)if(H.surface.shading){{const E=
N.tile,I=N.geometryState,M=I.samplerData,Q=N.localOrigin,T=E.surface.isWebMercatorOnPlateeCarree,S=I.clippingArea,U=c.isSome(S)?S:O,Y=E.extent,V=Y[0],R=Y[1],X=Y[2],W=Y[3],aa=Math.max(V,U[0]),ba=Math.min(X,U[2]),ia=Math.max(R,U[1]),ma=Math.min(W,U[3]),ha=E.ellipsoid.radius,ka=E.horizontalScale,Z=I.numVerticesPerSide,ca=Z-1,fa=Z-2,ea=N.geometryInfo,da=ea.vertexAttributes,la=da.position,oa=da.uv0,ra=da.normalCompressed,Aa=ea.uvRange,ua=Aa[0],za=Aa[1],va=Aa[2],Ja=Aa[3],pa=ea.boundingBox,Ba=Q[0],Ha=Q[1],
wa=Q[2],ya=la.typedBuffer,Na=la.typedBufferStride;let Ra=0;const Sa=b.clamp(R,ia,ma),ja=T?(Math.PI/2-2*Math.atan(Math.exp(-Sa/ha)))*ha:Sa*ka,Ta=1/ca,qa=b.clamp(R*(1-Ta)+W*Ta,ia,ma);let Ea=ja,Oa=T?(Math.PI/2-2*Math.atan(Math.exp(-qa/ha)))*ha:qa*ka;for(let Va=1;Va<=fa;Va++){const Ua=Va/ca,La=b.clamp(R*(1-Ua)+W*Ua,ia,ma),ta=b.clamp(Ua,za,Ja),xa=Oa,Ia=(Va-1)/ca,Qa=b.clamp(R*(1-Ia)+W*Ia,ia,ma),Xa=Ea,cb=(Va+1)/ca,db=b.clamp(R*(1-cb)+W*cb,ia,ma),fb=T?(Math.PI/2-2*Math.atan(Math.exp(-db/ha)))*ha:db*ka,jb=
b.clamp(cb,za,Ja);Ea=Oa;Oa=fb;const qb=b.clamp(V,aa,ba);let nb=qb*ka,sb=p.sampleElevation(qb,La,M);const vb=1/ca,Bb=b.clamp(vb,ua,va),ab=b.clamp(V*(1-Bb)+X*Bb,aa,ba);let ib=Bb,bb=ab,Fa=ab*ka,na=p.sampleElevation(ab,La,M);if(1===Va){const Da=Fa-Ba,Ma=Ea-Ha,Pa=na-wa,Wa=0*Na;ya[Wa+0]=Da;ya[Wa+1]=Ma;ya[Wa+2]=Pa;h.minMaxBoundingBox(Da,Ma,Pa,pa);const $a=b.clamp(vb,ua,va);h.encodeUVInBuffer(oa,Ra,$a,ta)}for(let Da=1;Da<=fa;Da++){const Ma=Fa,Pa=na,Wa=(Da+1)/ca,$a=b.clamp(Wa,ua,va),eb=b.clamp(V*(1-Wa)+X*
Wa,aa,ba),kb=bb;bb=eb;const gb=Ra+1,lb=gb*Na;if(1===Va||Da===fa){const Hb=p.sampleElevation(eb,La,M),Cb=eb*ka,Ib=xa,xb=Hb;if(1===Va&&Da<fa){const wb=Cb-Ba,Lb=Ib-Ha,yb=xb-wa;ya[lb+0]=wb;ya[lb+1]=Lb;ya[lb+2]=yb;h.minMaxBoundingBox(wb,Lb,yb,pa);h.encodeUVInBuffer(oa,gb,$a,ta)}Fa=Cb;na=xb}else Fa=ya[lb+0]+Ba,na=ya[lb+2]+wa;const ob=Fa,Eb=na,Gb=nb,pb=sb;nb=Ma;sb=Pa;const mb=(Ra-fa)*Na,zb=1===Va?p.sampleElevation(kb,Qa,M):ya[mb+2]+wa,Fb=p.sampleElevation(kb,db,M);if(Va<fa){const Hb=Ra+fa,Cb=Hb*Na,Ib=Ma-
Ba,xb=fb-Ha,wb=Fb-wa;ya[Cb+0]=Ib;ya[Cb+1]=xb;ya[Cb+2]=wb;h.minMaxBoundingBox(Ib,xb,wb,pa);const Lb=ib;ib=$a;h.encodeUVInBuffer(oa,Hb,Lb,jb)}const ub=ob-Gb,Db=-ub*(Eb-pb),Ab=Xa-fb,Rb=-Ab*(zb-Fb),Ob=ub*ub+Ab*Ab,Sb=Db*Db+Rb*Rb+Ob*Ob;if(0===Sb)h.encodeNormalToBufferFromValues(ra,Ra,0,0,1);else{const Hb=1/Math.sqrt(Sb);h.encodeNormalToBufferFromValues(ra,Ra,Db*Hb,Rb*Hb,Ob*Hb)}++Ra}}}}else{const E=N.geometryState,I=E.samplerData,M=N.tile,Q=N.localOrigin,T=M.surface.isWebMercatorOnPlateeCarree,S=E.clippingArea,
U=c.isSome(S)?S:O,Y=M.extent,V=Y[0],R=Y[1],X=Y[2],W=Y[3],aa=Math.max(V,U[0]),ba=Math.min(X,U[2]),ia=Math.max(R,U[1]),ma=Math.min(W,U[3]),ha=Q[0],ka=Q[1],Z=Q[2],ca=M.horizontalScale,fa=k(T,M.ellipsoid.radius,ca),ea=E.numVerticesPerSide,da=ea-1,la=ea-2,oa=N.geometryInfo,ra=oa.uvRange,Aa=ra[0],ua=ra[1],za=ra[2],va=ra[3],Ja=oa.boundingBox,pa=oa.vertexAttributes,Ba=pa.position,Ha=pa.uv0;let wa=0;for(let ya=1;ya<=la;ya++){const Na=ya/da,Ra=b.clamp(R*(1-Na)+W*Na,ia,ma),Sa=b.clamp(Na,ua,va),ja=fa(Ra)-ka;
for(let Ta=1;Ta<=la;Ta++){const qa=Ta/da,Ea=b.clamp(V*(1-qa)+X*qa,aa,ba),Oa=b.clamp(qa,Aa,za),Va=p.sampleElevation(Ea,Ra,I),Ua=Ea*ca-ha,La=Va-Z;h.minMaxBoundingBox(Ua,ja,La,Ja);Ba.setValues(wa,Ua,ja,La);h.encodeUVInBuffer(Ha,wa,Oa,Sa);++wa}}}}function B(N,H){N.tile.intersectsClippingArea&&(D(N),C(N,!1))}function C(N,H){const E=N.geometryState,I=E.neighborData,M=N.tile,Q=M.surface,T=Q.shading||!0,S=M.extent,U=E.clippingArea,Y=c.isSome(U)?U:O,V=S[0],R=S[2],X=S[1],W=S[3],aa=[W>Y[3],R>Y[2],X<Y[1],V<Y[0]],
ba=N.geometryInfo,ia=M.horizontalScale,ma=k(Q.isWebMercatorOnPlateeCarree,M.ellipsoid.radius,ia),ha=ba.boundingBox,ka=ba.uvRange[0],Z=ba.uvRange[1],ca=ba.uvRange[2],fa=ba.uvRange[3],ea=Math.max(V,Y[0]),da=Math.min(R,Y[2]),la=Math.max(X,Y[1]),oa=Math.min(W,Y[3]),ra=N.localOrigin,Aa=ra[0],ua=ra[1],za=ra[2],va=E.samplerData;for(let Ja=0;4>Ja;++Ja){const pa=1===Ja||3===Ja,Ba=I.edgeResolutions[Ja];e.internalAssert(b.isPowerOfTwo(Ba));const Ha=Ba+1,wa=aa[Ja],ya=f.neighborTileIfLoadedOrSelf(M,I.edgePeerNeighbors[Ja]);
if(!wa&&J(M,ya,Ja)){v(N,Ja);continue}const Na=c.isSome(ya)&&!wa,Ra=ya?.renderData?.geometryState;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!Na||ya.level===M.level),e.internalAssert(!Na||0>=A.compareTilesByLij(M,ya)),M&&!ya&&!Q.updatingRootTiles)){const xa=e.neighborEdgeIndices[Ja],Ia=M.findNeighborTile(xa,Qa=>Qa.isLoaded||Qa.isLeaf||Qa.level===M.level);Q.updatingRootTiles||(Ia?Ia.intersectsClippingArea&&(e.internalAssert(!Ia.isLoaded),e.internalAssert(!Ia.isLeaf),e.internalAssert(Ia.level===
M.level)):e.internalAssert(c.isNone(Q?.rootTiles)||!M.shouldHaveNeighbor(xa)))}const Sa=b.clamp(1===Ja?R:V,ea,da),ja=b.clamp(0===Ja?W:X,la,oa),Ta=Ra?.samplerData,qa=ba.outerEdges[Ja],Ea=H&&3<Ha?Ha-3:1,Oa=b.clamp(1===Ja?1:0,ka,ca),Va=b.clamp(0===Ja?1:0,Z,fa),Ua=(xa,Ia)=>p.sampleElevation(xa,Ia,va),La=(xa,Ia)=>.5*(p.sampleElevation(xa,Ia,Ta)+p.sampleElevation(xa,Ia,va)),ta=Na?La:Ua;if(T){const xa=(R-V)/Ba,Ia=pa?1===Ja?xa:-xa:0,Qa=pa?0:0===Ja?xa:-xa,Xa=-Ia,cb=-Qa,db=qa.attributes.position.typedBuffer,
fb=qa.attributes.position.typedBufferStride,jb=qa.index0,qb=qa.stride,nb=jb*fb;let sb=db[nb+0]+Aa,vb=db[nb+1]+ua,Bb=db[nb+2]+za,ab=0,ib=0,bb=0;const Fa=1/Ba,na=pa?Sa:b.clamp(V*(1-Fa)+R*Fa,ea,da),Da=pa?b.clamp(X*(1-Fa)+W*Fa,la,oa):ja,Ma=ta(na,Da),Pa=na*ia,Wa=ma(Da),$a=Ma;ab=Pa;ib=Wa;bb=$a;for(let eb=1;eb<Ha-1;eb+=Ea){const kb=eb/Ba,gb=ab,lb=ib,ob=bb,Eb=pa?Oa:b.clamp(kb,ka,ca),Gb=pa?b.clamp(kb,Z,fa):Va,pb=gb-Aa,mb=lb-ua,zb=ob-za;h.minMaxBoundingBox(gb,mb,zb,ha);qa.setVertexFromValuesRawPositionUV(eb,
pb,mb,zb,Eb,Gb);const Fb=eb+1;if(eb===Ha-1){const wb=(jb+Fb*qb)*fb;ab=db[wb+0]+Aa;ib=db[wb+1]+ua;bb=db[wb+2]+za}else{const wb=Fb/Ba,Lb=pa?Sa:b.clamp(V*(1-wb)+R*wb,ea,da),yb=pa?b.clamp(X*(1-wb)+W*wb,la,oa):ja,Wb=ta(Lb,yb);ab=Lb*ia;ib=ma(yb);bb=Wb}const ub=ab,Db=ib,Ab=bb,Rb=sb,Ob=vb,Sb=Bb;sb=gb;vb=lb;Bb=ob;let Hb=0,Cb=0,Ib=0;if(pa){const wb=Db-lb,Lb=Ob-lb;Cb-=Lb*(Sb-ob)+wb*(Ab-ob);Ib+=Lb*Lb+wb*wb;const yb=b.clamp(X*(1-kb)+W*kb,la,oa),Wb=Sa+Xa,Jb=Wb*ia,Nb=p.sampleElevation(Wb,yb,va),Xb=Jb-gb;Hb-=Xb*
(Nb-ob);Ib+=Xb*Xb;if(Na){const ac=Sa+Ia,gc=ac*ia,dc=p.sampleElevation(ac,yb,Ta),bc=gc-gb;Hb-=bc*(dc-ob);Ib+=bc*bc}}else{const wb=ub-gb,Lb=Rb-gb;Hb-=wb*(Ab-ob)+Lb*(Sb-ob);Ib+=wb*wb+Lb*Lb;const yb=b.clamp(V*(1-kb)+R*kb,ea,da),Wb=ja+cb,Jb=p.sampleElevation(yb,Wb,va)-ob,Nb=ma(Wb)-lb;Cb-=Nb*Jb;Ib+=Nb*Nb;if(Na){const Xb=yb,ac=ja+Qa,gc=ma(ac),dc=p.sampleElevation(Xb,ac,Ta)-ob,bc=gc-lb;Cb-=bc*dc;Ib+=bc*bc}}const xb=1/Math.sqrt(Hb*Hb+Cb*Cb+Ib*Ib);qa.setNormalFromValues(eb,Hb*xb,Cb*xb,Ib*xb)}}else for(let xa=
1;xa<Ha-1;xa+=Ea){const Ia=xa/Ba,Qa=pa?Sa:b.clamp(V*(1-Ia)+R*Ia,ea,da),Xa=pa?b.clamp(X*(1-Ia)+W*Ia,la,oa):ja,cb=pa?Oa:b.clamp(Ia,ka,ca),db=pa?b.clamp(Ia,Z,fa):Va,fb=ta(Qa,Xa),jb=Qa*ia-Aa,qb=ma(Xa)-ua,nb=fb-za;h.minMaxBoundingBox(jb,qb,nb,ha);qa.setVertexFromValuesRawPositionUV(xa,jb,qb,nb,cb,db)}}}function k(N,H,E){return N?I=>(Math.PI/2-2*Math.atan(Math.exp(-I/H)))*H:I=>I*E}function q(N,H,E,I,M,Q){const T=H-1,S=N.vertexAttributes.count,U=2*(Math.min(H-2,I[1])-Math.max(1,I[0]))*(Math.min(H-2,M[1])-
Math.max(1,M[0])),Y=e.neighborEdgeIndices.map((ha,ka)=>0===ka&&M[1]<H-2||1===ka&&I[1]<H-2||2===ka&&1<M[0]||3===ka&&1<I[0]),V=N.outerEdges.reduce((ha,ka,Z)=>ha+(Y[Z]?0:T-2+ka.count-1),0),R=E.reduce((ha,ka)=>ha+T*(2*(ka.latitudeResolution-1)+1),0),X=Q?2:1,W=3*(U+V+R)*X,aa=65536<=S?new Uint32Array(W):new Uint16Array(W);let ba=0;const ia=H-2,ma=T-2;e.internalAssert(0<=ma);if(Q){const ha=(ka,Z,ca)=>{aa[ba++]=ka;aa[ba++]=Z;aa[ba++]=Z;aa[ba++]=ca;aa[ba++]=ca;aa[ba++]=ka;e.ENABLE_TERRAIN_INTERNAL_CHECKS&&
(e.internalAssert(ka<S),e.internalAssert(Z<S),e.internalAssert(ca<S),e.internalAssert(ba<=W))};(()=>{for(let ka=Math.max(M[0],1)-1;ka<Math.min(M[1],H-2)-1;++ka)for(let Z=Math.max(I[0],1)-1;Z<Math.min(I[1],H-2)-1;++Z){const ca=ka*ia+Z,fa=ca+1,ea=fa+ia,da=ea-1;ha(ca,fa,ea);ha(ea,da,ca)}})();e.internalAssert(ba===3*U*X);(()=>{for(let Z=0;4>Z;++Z){const ca=ba;if(Y[Z])continue;const fa=N.outerEdges[Z],ea=N.innerEdges[Z];let da=0,la=0;const oa=fa.count,ra=ea.count;e.internalAssert(ra===T-1);let Aa=0;const ua=
1===Z||2===Z?(za,va,Ja)=>ha(za,va,Ja):(za,va,Ja)=>ha(za,Ja,va);for(;da<oa-1||la<ra-1;){const za=ea.getVertexIndex(la),va=fa.getVertexIndex(da);var ka=da<oa-1;const Ja=la<ra-1,pa=ka?T*(da+.5)/(oa-1):0,Ba=Ja?1+ma*(la+.5)/(ra-1):0;ka&&(!Ja||pa<=Ba)?(++da,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(da<oa),ka=fa.getVertexIndex(da),ua(za,va,ka)):(++la,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(la<ra),ka=ea.getVertexIndex(la),ua(za,va,ka));Aa++}e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(da===
oa-1),e.internalAssert(la===ra-1),e.internalAssert(Aa===oa+ra-2),e.internalAssert(Aa===T-2+fa.count-1),e.internalAssert(ba===ca+3*Aa*X))}})();e.internalAssert(ba===3*(U+V)*X);E.forEach(ka=>{var Z=N.outerEdges[ka.connectedOuterEdgeOffset];let ca=Z.getVertexIndex(0);Z=Z.stride;for(let fa=0;fa<ka.latitudeResolution;++fa){const ea=0===fa?ka.rowOffset:ca+H;for(let da=0;da<T;da++)ha(ca,ca+1,ea+da),fa<ka.latitudeResolution-1&&ha(ca+1,ea+da+1,ea+da),ca+=Z;ca=ea;Z=1}})}else(()=>{var ha=Math.max(M[0],1)-1;
const ka=Math.min(M[1],H-2)-1,Z=Math.max(I[0],1)-1,ca=Math.min(I[1],H-2)-1;for(;ha<ka;++ha){const fa=ha*ia;for(let ea=Z;ea<ca;++ea){const da=fa+ea,la=da+1,oa=la+ia,ra=oa-1;aa[ba+0]=da;aa[ba+1]=la;aa[ba+2]=oa;aa[ba+3]=oa;aa[ba+4]=ra;aa[ba+5]=da;ba+=6}}})(),e.internalAssert(ba===3*U*X),(()=>{for(let fa=0;4>fa;++fa){if(Y[fa])continue;var ha=N.outerEdges[fa],ka=N.innerEdges[fa];let ea=0,da=0;const la=ha.count,oa=ka.count;e.internalAssert(oa===T-1);var Z=1===fa||2===fa;const ra=Z?1:2;Z=Z?2:1;const Aa=
ha.index0;ha=ha.stride;const ua=ka.index0;for(ka=ka.stride;ea<la-1||da<oa-1;){const za=ua+da*ka,va=Aa+ea*ha;var ca=ea<la-1;const Ja=da<oa-1,pa=ca?T*(ea+.5)/(la-1):0,Ba=Ja?1+ma*(da+.5)/(oa-1):0;(ca=ca&&(!Ja||pa<=Ba))?++ea:++da;ca=ca?va+ha:za+ka;aa[ba+0]=za;aa[ba+ra]=va;aa[ba+Z]=ca;ba+=3}}})(),e.internalAssert(ba===3*(U+V)*X),E.forEach(ha=>{var ka=N.outerEdges[ha.connectedOuterEdgeOffset];let Z=ka.getVertexIndex(0);ka=ka.stride;for(let ca=0;ca<ha.latitudeResolution;++ca){const fa=0===ca?ha.rowOffset:
Z+H;for(let ea=0;ea<T;ea++){const da=fa+ea;aa[ba+0]=Z;aa[ba+1]=Z+1;aa[ba+2]=da;ca<ha.latitudeResolution-1?(aa[ba+3]=Z+1,aa[ba+4]=da+1,aa[ba+5]=da,ba+=6):ba+=3;Z+=ka}Z=fa;ka=1}});e.internalAssert(ba===W);N.indices=aa;N.indexCount=W}function x(N,H){const E=N.localOrigin,I=N.geometryInfo;N=N.geometryState.neighborData.edgeResolutions;const M=I.numVerticesPerSide-2,Q=I.vertexAttributes;for(let S=0;4>S;++S){var T=0===S||2===S;I.innerEdges[S]=new h.EdgeDescriptor(Q,E,(0===S?M-1:0)*M+(1===S?M-1:0),(T?0:
1)*M+(T?1:0),M);T=N[S]+1;I.outerEdges[S]=new h.EdgeDescriptor(Q,E,H,1,T);H+=T}}function v(N,H){var E=(H+2)%4,I=N.tile,M=N.geometryState.neighborData,Q=f.neighborTileIfLoadedOrSelf(I,M.edgePeerNeighbors[H]),T=I.level-Q.level;const S=1===H||3===H;M=M.edgeResolutions[H];e.internalAssert(b.isPowerOfTwo(M));const U=M+1;var Y=N.geometryInfo;const V=Y.boundingBox;var R=Y.outerEdges[H];const X=Y.uvRange[0],W=Y.uvRange[1],aa=Y.uvRange[2];Y=Y.uvRange[3];const ba=b.clamp(1===H?1:0,X,aa),ia=b.clamp(0===H?1:0,
W,Y);var ma=Q.renderData,ha=ma.geometryState,ka=ma.geometryInfo.outerEdges[E];H=I.getNeighborEdgeStartVertexIndex(H,Q)*M;T=M*2**T;e.internalAssert(ha.neighborData.edgeResolutions[E]===T);e.internalAssert(ka.count-1===T);E=ma.localOrigin[0]-N.localOrigin[0];T=ma.localOrigin[1]-N.localOrigin[1];N=ma.localOrigin[2]-N.localOrigin[2];var Z=R.attributes;ma=R.index0;R=R.stride;I=Z.position.typedBuffer;Q=Z.position.typedBufferStride;ha=Z.normalCompressed.typedBuffer;const ca=Z.normalCompressed.typedBufferStride;
Z=Z.uv0;var fa=ka.attributes;const ea=ka.index0;ka=ka.stride;const da=fa.position.typedBuffer,la=fa.position.typedBufferStride,oa=fa.normalCompressed.typedBuffer;fa=fa.normalCompressed.typedBufferStride;for(let za=1;za<U-1;++za){const va=ma+R*za;var ra=ea+ka*(H+za),Aa=va*Q,ua=ra*la;const Ja=da[ua+0]+E,pa=da[ua+1]+T;ua=da[ua+2]+N;I[Aa+0]=Ja;I[Aa+1]=pa;I[Aa+2]=ua;h.minMaxBoundingBox(Ja,pa,ua,V);Aa=va*ca;ra*=fa;ha[Aa+0]=oa[ra+0];ha[Aa+1]=oa[ra+1];Aa=za/M;ra=S?ba:b.clamp(Aa,X,aa);Aa=S?b.clamp(Aa,W,Y):
ia;h.encodeUVInBuffer(Z,va,ra,Aa)}}function D(N){const H=N.geometryState,E=N.localOrigin,I=H.neighborData.cornerNeighborData,M=N.geometryInfo,Q=M.outerEdges,T=M.boundingBox,S=N.tile,U="local"===N.tile.surface.view?.viewingMode,Y=S.ellipsoid.radius,V=S.extentInRadians,R=S.horizontalScale;let X=0,W=0,aa=0,ba=0,ia=0,ma=0;const ha=()=>{const qa=N.geometryState.clippingArea,Ea=S.extent,Oa=c.isSome(qa)&&(Ea[3]>qa[3]||Ea[2]>qa[2]||Ea[1]<qa[1]||Ea[0]<qa[0]),Va=k(S.surface.isWebMercatorOnPlateeCarree,S.ellipsoid.radius,
R);return(Ua,La,ta)=>{Ua=0===Ua?oa[0]:oa[2];La=0===La?oa[1]:oa[3];Ua=Oa?b.clamp(Ua,qa[0],qa[2]):Ua;La=Oa?b.clamp(La,qa[1],qa[3]):La;X=Ua*R;W=Va(La);aa=ta}},ka=(qa,Ea,Oa)=>{var Va=V[0===Ea?1:3];qa=V[0===qa?0:2];Ea=Math.cos(Va);Va=Math.sin(Va);const Ua=Math.sin(qa);Oa=Y+Oa;X=Math.cos(qa)*Ea*Oa;W=Ua*Ea*Oa;aa=Va*Oa},Z=U?ha():ka;let ca=0,fa=0,ea=0;const da=U&&N.tile.surface.isWebMercatorOnPlateeCarree,la=(qa,Ea,Oa,Va)=>{if(U){var Ua=Ea*R-X;Oa=(da?(Math.PI/2-2*Math.atan(Math.exp(-Oa/Y)))*Y:Oa*R)-W;Va-=
aa;ca+=-Ua*Va;fa+=-Oa*Va;ea+=Ua*Ua+Oa*Oa}else{Ua=z(qa);var La=qa.tile;qa=La.extent;La=La.extentInRadians;Ea=(Ea-qa[0])/(qa[2]-qa[0]);Ea=La[0]*(1-Ea)+La[2]*Ea;Ua=Ua((Oa-qa[1])/(qa[3]-qa[1]));Oa=Math.cos(Ua);qa=Y+Va;Va=Math.cos(Ea)*Oa*qa-X;Oa=Math.sin(Ea)*Oa*qa-W;Ua=Math.sin(Ua)*qa-aa;qa=Oa*ma-Ua*ia;Ea=Ua*ba-Va*ma;La=Va*ia-Oa*ba;ca+=Ea*Ua-La*Oa;fa+=La*Va-qa*Ua;ea+=qa*Oa-Ea*Va}},oa=S.extent,ra=H.clippingArea,Aa=c.isSome(ra)?ra:O,ua=oa[0],za=oa[2],va=oa[1],Ja=oa[3],pa=[Ja>Aa[3],za>Aa[2],va<Aa[1],ua<Aa[0]],
Ba=Math.max(ua,Aa[0]),Ha=Math.min(za,Aa[2]),wa=Math.max(va,Aa[1]),ya=Math.min(Ja,Aa[3]),Na=M.uvRange[0],Ra=M.uvRange[1],Sa=M.uvRange[2],ja=M.uvRange[3],Ta=qa=>{if(!U){var Ea=1/Math.sqrt(X*X+W*W+aa*aa);ba=X*Ea;ia=W*Ea;ma=aa*Ea}qa=I[qa].cornerTiles;ea=fa=ca=0;Ea=Infinity;for(var Oa=0;4>Oa;++Oa)Ea=Math.min(Ea,qa[Oa]?.level??Infinity);for(Oa=0;4>Oa;++Oa){var Va=qa[Oa];P[Oa]=Va?.level===Ea?Va:null}qa=1;Ea=0;for(Oa=0;4>Oa;++Oa)if(Va=P[Oa])qa=Math.max(qa,Va?.renderData.geometryState.numVerticesPerSide),
Ea=Va.extent[2]-Va.extent[0];e.internalAssert(1<qa);qa=Ea/qa;for(Ea=0;4>Ea;++Ea){var Ua=P[(Ea+3)%4],La=P[(Ea+0)%4];if(Ua||La){Va=0===Ea?1:1===Ea?2:2===Ea?3:0;var ta=0===Ea?2:1===Ea?3:2===Ea?0:1;if(Ua&&La){var xa=L[Ea][0]*qa,Ia=L[Ea][1]*qa,Qa=Ua.extent;Oa=Qa[0===Va||1===Va?2:0]+xa;Va=Qa[0===Va||3===Va?3:1]+Ia;Qa=La.extent;xa=Qa[0===ta||1===ta?2:0]+xa;ta=Qa[0===ta||3===ta?3:1]+Ia;Ua=Ua.renderData;Ia=La.renderData;La=p.sampleElevation(Oa,Va,Ua.geometryState.samplerData);ta=p.sampleElevation(xa,ta,Ia.geometryState.samplerData);
la(Ua,Oa,Va,.5*(La+ta))}else Oa=Ua??La,Ua=Ua?Va:ta,La=Oa.extent,ta=L[Ea],Va=La[0===Ua||1===Ua?2:0]+ta[0]*qa,Ua=La[0===Ua||3===Ua?3:1]+ta[1]*qa,Oa=Oa.renderData,La=p.sampleElevation(Va,Ua,Oa.geometryState.samplerData),la(Oa,Va,Ua,La)}}qa=1/Math.sqrt(ca*ca+fa*fa+ea*ea);ca*=qa;fa*=qa;ea*=qa};for(let qa=0;4>qa;++qa){const Ea=qa,Oa=(qa+1)%4,Va=0===qa||1===qa?1:0,Ua=0===qa||3===qa?1:0,La=b.clamp(Va,Na,Sa),ta=b.clamp(Ua,Ra,ja),xa=Q[Ea],Ia=0===qa||3===qa?xa.count-1:0,Qa=Q[Oa],Xa=0===qa||1===qa?Qa.count-1:
0,cb=I[qa].cornerTiles;let db=-1;for(let nb=0;4>nb;++nb){const sb=cb[nb];sb&&(-1===db||0<A.compareTilesByLij(cb[db],sb))&&(db=nb)}const fb=db,jb=cb[fb],qb=jb!==S;fa=ca=0;ea=1;if(qb){const nb=S.level-jb.level,sb=2**nb,vb=[jb.lij[0]+nb,jb.lij[1]*sb,jb.lij[2]*sb],Bb=[vb[1]+sb===S.lij[1],0===qa&&(1===fb||0===fb&&jb!==cb[3])||1===qa&&(0===fb||1===fb&&jb!==cb[2]),vb[1]===S.lij[1]+1,2===qa&&(3===fb||2===fb&&jb!==cb[1])||3===qa&&(2===fb||3===fb&&jb!==cb[0])],ab=Bb.reduce((xb,wb)=>xb+(wb?1:0),0);e.internalAssert(1===
ab||2===ab);let ib=-1,bb=-1;const Fa=jb.renderData;if(1===ab){const xb=Bb.findIndex(Lb=>Lb);e.internalAssert(0<=xb&&3>=xb);ib=(xb+2)%4;const wb=N.geometryState.neighborData.edgeResolutions[xb];bb=S.getNeighborEdgeStartVertexIndex(xb,jb)*wb+wb*(0===xb&&0===qa||1===xb&&0===qa||2===xb&&1===qa||3===xb&&3===qa?1:0)}else{e.internalAssert(Bb[1]||Bb[3]);ib=Bb[1]?3:1;const xb=Fa.geometryState.neighborData.edgeResolutions[ib];bb=0===qa||3===qa?0:xb}const na=Fa.geometryInfo.outerEdges[ib],Da=xa.index0+Ia*xa.stride,
Ma=Qa.index0+Xa*Qa.stride,Pa=na.index0+bb*na.stride,Wa=na.attributes.position,$a=Wa.typedBuffer,eb=Pa*Wa.typedBufferStride,kb=N.localOrigin,gb=na.localOrigin,lb=$a[eb+0]+gb[0]-kb[0],ob=$a[eb+1]+gb[1]-kb[1],Eb=$a[eb+2]+gb[2]-kb[2];h.minMaxBoundingBox(lb,ob,Eb,T);const Gb=xa.attributes.position,pb=Gb.typedBuffer,mb=Da*Gb.typedBufferStride;pb[mb+0]=lb;pb[mb+1]=ob;pb[mb+2]=Eb;const zb=Qa.attributes.position,Fb=zb.typedBuffer,ub=Ma*zb.typedBufferStride;Fb[ub+0]=lb;Fb[ub+1]=ob;Fb[ub+2]=Eb;h.encodeUVInBuffer(xa.attributes.uv0,
Da,La,ta);h.encodeUVInBuffer(Qa.attributes.uv0,Ma,La,ta);const Db=na.attributes.normalCompressed.typedBuffer,Ab=Pa*na.attributes.normalCompressed.typedBufferStride,Rb=xa.attributes.normalCompressed,Ob=Rb.typedBuffer,Sb=Da*Rb.typedBufferStride;Ob[Sb+0]=Db[Ab+0];Ob[Sb+1]=Db[Ab+1];const Hb=Qa.attributes.normalCompressed,Cb=Hb.typedBuffer,Ib=Ma*Hb.typedBufferStride;Cb[Ib+0]=Db[Ab+0];Cb[Ib+1]=Db[Ab+1]}else{const nb=pa[Oa];let sb=void 0;if(pa[Ea]||nb){const ib=b.clamp(ua*(1-Va)+za*Va,Ba,Ha),bb=b.clamp(va*
(1-Ua)+Ja*Ua,wa,ya);sb=p.sampleElevation(ib,bb,H.samplerData)}else sb=F(cb);Z(Va,Ua,sb);Ta(qa);const vb=X-E[0],Bb=W-E[1],ab=aa-E[2];h.minMaxBoundingBox(vb,Bb,ab,T);xa.setVertexFromValuesRawPositionUVNormal(Ia,vb,Bb,ab,La,ta,ca,fa,ea);Qa.setVertexFromValuesRawPositionUVNormal(Xa,vb,Bb,ab,La,ta,ca,fa,ea)}}for(let qa=0;4>qa;++qa)P[qa]=null}function F(N){const H=N.reduce((Q,T)=>Math.min(Q,T?.level??Infinity),Infinity);e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!N[0]||!N[2]||l.isCornerNeighbor(N[0],
N[2],g.NeighborIndex.SOUTH_WEST)),e.internalAssert(!N[1]||!N[3]||l.isCornerNeighbor(N[1],N[3],g.NeighborIndex.NORTH_WEST)));let E=0,I=0;for(let Q=0;4>Q;++Q){var M=N[Q];if(M&&M.level===H){const T=M.extent;M=p.sampleElevation(T[0===Q||1===Q?0:2],T[0===Q||3===Q?1:3],M.renderData?.geometryState?.samplerData);I+=M;E++}}N=E?I/E:0;e.internalAssert(null!=N);return N}function G(N){const H=N.geometryInfo.vertexAttributes.position.typedBuffer;N.vao.vertexBuffers.geometry.setSubData(H,0,0,H.length)}function J(N,
H,E){if(!H)return!1;N=A.compareTilesByLij(N,H);return 0<N||0===N&&2>E}const L=[[0,1],[1,0],[0,-1],[-1,0]],K=new d.PatchGeometryLUT,O=n.fromValues(-Infinity,-Infinity,Infinity,Infinity),P=[null,null,null,null];a.createInternalVerticesPositionsSpherical=function(N){var H=N.geometryState,E=H.numVerticesPerSide;const I=E-2;--E;var M=N.geometryInfo,Q=M.vertexAttributes,T=Q.position;Q=Q.uv0;var S=N.tile,U=S.extent;const Y=U[0],V=U[2],R=U[1];U=U[3];S=S.ellipsoid.radius;H=H.samplerData;var X=N.localOrigin;
N=X[0];const W=X[1];X=X[2];M=M.boundingBox;const aa=T.typedBuffer;T=T.typedBufferStride;let ba=0;for(let ka=1;ka<=I;ka++){const Z=ka/E,ca=R*(1-Z)+U*Z,fa=K.sinLatLUT[ka],ea=K.cosLatLUT[ka];for(let da=1;da<=I;da++){const la=da/E;var ia=K.sinLonLUT[da],ma=K.cosLonLUT[da],ha=S+p.sampleElevation(Y*(1-la)+V*la,ca,H);ma=ma*ea*ha-N;ia=ia*ea*ha-W;ha=fa*ha-X;h.minMaxBoundingBox(ma,ia,ha,M);const oa=ba*T;aa[oa+0]=ma;aa[oa+1]=ia;aa[oa+2]=ha;h.encodeUVInBuffer(Q,ba,la,Z);++ba}}};a.createPlanarGlobePatch=function(N,
H){var E=N.tile.extent;H=N.geometryState;var I=E[0],M=E[1],Q=E[2]-I,T=E[3]-M,S=H.clippingArea;E=c.isSome(S)?Math.max(0,(S[0]-I)/Q):0;const U=c.isSome(S)?Math.max(0,(S[1]-M)/T):0;I=c.isSome(S)?Math.min(1,(S[2]-I)/Q):1;M=c.isSome(S)?Math.min(1,(S[3]-M)/T):1;Q=H.numVerticesPerSide;T=(Q-2)**2;S=H.neighborData.edgeResolutions.reduce((V,R)=>V+R+1,0);S=h.acquireTerrainAttributes(T+S);const Y=N.geometryInfo;m.empty(Y.boundingBox);Y.numVerticesPerSide=H.numVerticesPerSide;Y.vertexAttributes=S;r.set(Y.uvRange,
E,U,I,M);y(N);x(N,T);B(N);q(Y,H.numVerticesPerSide,[],[0,Q-1],[0,Q-1],H.wireframe);N.intersectionData=null};a.createSphericalGlobePatch=function(N,H){const E=N.tile,{extent:I,extentInRadians:M,surface:Q}=E,T=N.localOrigin,S=N.geometryState;var U=Q.isWebMercator;const Y=Q.shading||!0,V=S.numVerticesPerSide,R=V-1,X=(V-2)**2,W=U&&(H===g.PatchType.HAS_SOUTH_POLE||H===g.PatchType.HAS_BOTH_POLES),aa=U&&(H===g.PatchType.HAS_NORTH_POLE||H===g.PatchType.HAS_BOTH_POLES);U=6*((W?1:0)+(aa?1:0))*(R+1);H=S.neighborData;
const ba=H.edgeResolutions.reduce((Z,ca)=>Z+ca+1,0),ia=h.acquireTerrainAttributes(X+U+ba);U=N.geometryInfo;U.numVerticesPerSide=S.numVerticesPerSide;U.vertexAttributes=ia;const ma=U.boundingBox;m.empty(ma);const ha=z(N);K.update(R,M,ha);t(N);x(N,X);w(N);const ka=[];(()=>{let Z=X+ba;const ca=T[0],fa=T[1],ea=T[2],da=E.ellipsoid.radius,la=I[1],oa=I[3],ra=(Aa,ua)=>{ua*=V;h.minMaxBoundingBox(-ca,-fa,-ea+Aa*da,ma);ka.push({connectedRowOffset:ua,connectedOuterEdgeOffset:1===Aa?0:2,rowOffset:Z,latitudeResolution:6});
ua=Math.PI/2-2*Math.atan(Math.exp(-(-1===Aa?la:oa)/da));const za=Aa*Math.PI/2-ua;Aa=.99*(1===Aa?1:-1);const va=da+0,Ja=ia.position,pa=ia.uv0,Ba=ia.normalCompressed;for(let wa=1;6>=wa;++wa){var Ha=ua+wa/6*za;const ya=Math.cos(Ha);Ha=Math.sin(Ha);for(let Na=0;Na<=R;Na++){const Ra=Na/R,Sa=K.cosLonLUT[Na]*ya,ja=K.sinLonLUT[Na]*ya,Ta=Ha,qa=Sa*va-ca,Ea=ja*va-fa,Oa=Ta*va-ea;h.minMaxBoundingBox(qa,Ea,Oa,ma);Ja.setValues(Z,qa,Ea,Oa);h.encodeUVInBuffer(pa,Z,Ra,Aa);Y&&h.encodeNormalToBufferFromValues(Ba,Z,Sa,
ja,Ta);++Z}}};W&&ra(-1,0);aa&&ra(1,R)})();q(U,S.numVerticesPerSide,ka,[0,V-1],[0,V-1],S.wireframe);N.intersectionData=null;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS)for(N=0;4>N;++N)e.internalAssert(U.outerEdges[N].count===H.edgeResolutions[N]+1)};a.updateCornerSpherical=function(N){N.tile.intersectsClippingArea&&(D(N),u(N,!0),G(N))};a.updateCornersPlanar=function(N,H){N.tile.intersectsClippingArea&&(D(N),C(N,!0),G(N))};a.updateEdgesAndCornersPlanar=function(N,H){N.tile.intersectsClippingArea&&(B(N),G(N))};
a.updateEdgesAndCornersSpherical=function(N){N.tile.intersectsClippingArea&&(w(N),G(N))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/mathUtils ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./terrainUtils ../webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,r,m,n,p,g,h){function d(z,y,B,C,k){var q=1/(Math.abs(B)+Math.abs(C)+Math.abs(k));B*=q;C*=q;q=0>=k?(0<=C?1:-1)*(1-Math.abs(B)):C;z.setValues(y,l(0>=k?(0<=B?1:-1)*(1-Math.abs(C)):B),l(q))}function f(z,y){const B=A(y[0]);y=A(y[1]);const C=1-Math.abs(B)-Math.abs(y);z[2]=C;0>C?(z[0]=(0<=B?1:-1)*(1-Math.abs(y)),z[1]=(0<=y?1:-1)*(1-Math.abs(B))):(z[0]=B,z[1]=y);r.normalize(z,z)}function e(z,y,B,C){z.setValues(y,16384*B,16384*C)}function l(z){return b.clamp(Math.round(32767*z),-32767,32767)}function A(z){return b.clamp(z/
32767,-1,1)}let t=function(){function z(B,C,k,q,x){this.attributes=B;this.localOrigin=C;this.index0=k;this.stride=q;this.count=x}var y=z.prototype;y.getVertexIndex=function(B){return this.getAttributeIndex(B)};y.getAttributeIndex=function(B){g.internalAssert(0<=B&&B<this.count);return this.index0+this.stride*B};y._getVertexRaw=function(B,C){this.attributes.position.getVec(B,C)};y._getNormalRaw=function(B,C){this.attributes.normalCompressed.getVec(B,C)};y.getVertexPos=function(B,C){this._getVertexRaw(this.getAttributeIndex(C),
B);r.add(B,B,this.localOrigin)};y.getNormal=function(B,C){const k=c.create();this._getNormalRaw(this.getAttributeIndex(C),k);f(B,k)};y._setNormal=function(B,C,k,q){d(this.attributes.normalCompressed,B,C,k,q)};y._setUV=function(B,C,k){e(this.attributes.uv0,B,C,k)};y.setNormalFromValues=function(B,C,k,q){this._setNormal(this.getAttributeIndex(B),C,k,q)};y.setVertexFromValuesRawPositionUV=function(B,C,k,q,x,v){B=this.getAttributeIndex(B);this.attributes.position.setValues(B,C,k,q);this._setUV(B,x,v)};
y.setVertexFromValuesRawPositionUVNormal=function(B,C,k,q,x,v,D,F,G){B=this.getAttributeIndex(B);this.attributes.position.setValues(B,C,k,q);this._setUV(B,x,v);this._setNormal(B,D,F,G)};return z}();const w=p.newLayout().vec3f(h.VertexAttribute.POSITION).vec2i16(h.VertexAttribute.UV0).vec2i16(h.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}),u=new n.BufferPool(z=>w.createBuffer(z),z=>z.count);a.EdgeDescriptor=t;a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=
m.empty();this.numVerticesPerSide=this.indexCount=0;this.uvRange=[0,0,1,1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]};a.acquireTerrainAttributes=function(z){return u.acquire(z)};a.clearCaches=function(){u.clear()};a.decodeInt16=A;a.decodeNormal=f;a.encodeInt16=l;a.encodeNormalToBufferFromValues=d;a.encodeUVInBuffer=e;a.minMaxBoundingBox=function(z,y,B,C){z<C[0]?C[0]=z:z>C[3]&&(C[3]=z);y<C[1]?C[1]=y:y>C[4]&&(C[4]=y);B<C[2]?C[2]=B:B>C[5]&&(C[5]=B)};a.releaseGeometry=
function(z){u.release(z.vertexAttributes);z.vertexAttributes=null;z.indices=null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let r=function(){function m(p,g){this._factoryCallback=p;this._lengthCallback=g;this._pool=new Map}var n=m.prototype;n.acquire=function(p){if(!m.test.disabled){var g=this._pool.get(p);
if(g&&0!==g.length)return g.pop()}try{return this._factoryCallback(p)}catch(h){g=window.performance&&window.performance.memory;let d="";g&&(d=`\n  totalJSHeapSize: ${g.totalJSHeapSize}, usedJSHeapSize: ${g.usedJSHeapSize}, jsHeapSizeLimit: ${g.jsHeapSizeLimit}`);console.log("Array allocation of size "+p+" failed: "+h+d);throw h;}};n.release=function(p){if(!m.test.disabled){var g=this._lengthCallback(p),h=this._pool.get(g);h||(h=new c({shrink:!0}),this._pool.set(g,h));h.push(p)}};n.clear=function(){this._pool.clear()};
b._createClass(m,[{key:"test",get:function(){return{size:this._pool.size}}}]);return m}();r.test={disabled:!1};a.BufferPool=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,b){let c=function(){function r(){this.sinLonLUT=Array(b.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(b.MAX_PATCH_TESSELATION+1);this.sinLatLUT=Array(b.MAX_PATCH_TESSELATION+1);this.cosLatLUT=
Array(b.MAX_PATCH_TESSELATION+1)}r.prototype.update=function(m,n,p){const g=n[0];n=n[2];for(let d=0;d<=m;d++){var h=d/m;const f=g*(1-h)+n*h;this.sinLonLUT[d]=Math.sin(f);this.cosLonLUT[d]=Math.cos(f);h=p(h);this.sinLatLUT[d]=Math.sin(h);this.cosLatLUT[d]=Math.cos(h)}};return r}();a.PatchGeometryLUT=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./interfaces ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){function x(P,N){return N?.isLoaded||N===P?N:null}let v=function(){function P(){this.geometryInfo=new t.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new u.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new y;this._geometryStateChangedSinceLastUpdate=!0;this._shadingChanged=this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=
!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=15}var N=P.prototype;N.init=function(H){this.clear();this._tile=H;H=this.geometryInfo;H.indices=null;H.vertexAttributes=null;g.empty(H.boundingBox);H.indexCount=0;H.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new e.GeometryState;this.localOrigin=null;this.overlay.clear()};N.clear=function(){this._releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=
null};N.updateGeometryIfNeeded=function(H){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(H),this._geometryStateChangedSinceLastUpdate=!1;if(w.ENABLE_TERRAIN_INTERNAL_CHECKS&&this.tile.intersectsClippingArea)for(H=0;4>H;++H)w.internalAssert(this.geometryInfo.outerEdges[H].count===
this.geometryState.neighborData.edgeResolutions[H]+1)};N._calculateEdgeResolution=function(H,E){const I=this.tile,M=this.geometryState.numVerticesPerSide-1;if(!I.surface.isGlobal){var Q=I.surface.extent;if(m.isSome(Q)&&(0===H&&I.extent[3]>Q[3]||1===H&&I.extent[2]>Q[2]||2===H&&I.extent[1]<Q[1]||3===H&&I.extent[0]<Q[0]))return M}const T=I.level;Q=w.neighborEdgeIndices[H];if(!E)return w.internalAssert(m.isNone(I.surface?.rootTiles)||I.surface.updatingRootTiles||!I.shouldHaveNeighbor(Q)),M;if(E.isLoaded)return Q=
E.renderData.geometryState,E=T-E.level,w.internalAssert(0<=E),0===E?Math.max(Q.numVerticesPerSide-1,M):Math.max(1,Q.neighborData.edgeResolutions[(H+2)%4]/2**E);w.internalAssert(!E.isLeaf);let S=M;E.forAllSubtreeOnSide(w.oppositeEdge(Q),U=>{if(U===I)return!0;if(U.isLoaded)return S=Math.max(S,2**(U.level-T)),!0;w.internalAssert(!U.isLeaf);return!1});return S};N.updateNeighborData=function(){const H=this.tile;if(H.intersectsClippingArea){var E=H.renderData.geometryState.neighborData,I=R=>(R.isLoaded||
R.level===H.level)&&R?.intersectsClippingArea,M=E.edgePeerNeighbors,Q=E.edgePeerNeighborSamplerVersions;for(var T=0;4>T;++T){var S=H.findNeighborTile(w.neighborEdgeIndices[T],I),U=x(H,S),Y=U?.renderData?.geometryState.samplerDataVersion??-1,V=x(H,M[T]);U=U!==V;V=Q[T]!==Y;M[T]=S;if(U||V)Q[T]=Y,this._markEdgeDirty(T);Y=E.edgeResolutions[T];S=this._calculateEdgeResolution(T,S);w.internalAssert(r.isPowerOfTwo(S));w.internalAssert(1<=S);E.edgeResolutions[T]=S;Y!==S&&this._markEdgeResolutionDirty(T)}Q=
E.cornerPeerNeighbors;for(T=0;4>T;++T){U=H.findNeighborTile(w.neighborCornerIndices[T],I);Q[T]=U;S=x(H,M[T]);Y=x(H,M[(T+1)%4]);U=x(H,U);O[T]=U;O[(T+1)%4]=Y;O[(T+2)%4]=H;O[(T+3)%4]=S;w.internalAssert(O.some(X=>X?.isLoaded||X===H));const R=O.reduce((X,W)=>Math.min(X,W?.level??Infinity),Infinity);O.forEach((X,W)=>{X?.level>R&&(O[W]=null)});w.internalAssert(O.some(X=>X?.isLoaded||X===H));S=E.cornerNeighborData[T].cornerTiles;Y=E.cornerNeighborData[T].cornerTileSamplerVersions;for(U=0;4>U;++U){V=O[U];
const X=V?.renderData.geometryState.samplerDataVersion??-1,W=S[U]!==V,aa=!W&&Y[U]!==X;if(W||aa)S[U]=V,Y[U]=X,this._markCornerDirty(T)}w.internalAssert(S.some(X=>X?.isLoaded||X===H))}w.ENABLE_TERRAIN_INTERNAL_CHECKS&&w.internalAssert(this.geometryState.neighborData.edgeResolutions.every(R=>0<R));for(E=0;4>E;++E)O[E]=null}};N._updateGeometry=function(H){if(this.tile.intersectsClippingArea){w.ENABLE_TERRAIN_INTERNAL_CHECKS&&w.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(T=>
0<T));this.intersectionData=null;var E=this.tile,I=this.geometryInfo.vertexAttributes;I=!this._vao||!I||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions;var M=!I&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),Q=!M&&0!==this._dirtyCorners;I?(this._releaseGeometry(),this._createGeometry(H)):M||Q?E.updateEdgeElevations():Q?E.updateCornerElevations():console.warn("Update for no reason?");
this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=0;this._wireframeChanged=this._clippingAreaChanged=!1}};N.releaseGeometry=function(){return this._releaseGeometry()};N.ensureTexture=function(H,E){m.isSome(this._texture)&&this._texture.descriptor.width!==H&&this.releaseTexture();m.isNone(this._texture)&&(this._texture=E(),this.tile.setMemoryDirty());return this._texture};N.releaseTexture=function(){m.isSome(this._texture)&&(this._texture.release(),
this._texture=null,this.tile.setMemoryDirty())};N._markCornerDirty=function(H){this._dirtyCorners|=1<<H};N._markEdgeDirty=function(H){this._dirtyEdges|=1<<H};N._markEdgeResolutionDirty=function(H){H=1<<H;this._dirtyEdgeResolutions|=H;this._dirtyEdges|=H};N._markAllEdgesAndCornersDirty=function(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=15};N.updateGeometryState=function(){var H=this._getElevationInfo(),E=this.tile,I=H.samplerData?E.getElevationBasedVerticesPerSide(H.maxTileLevel):
E.getDefaultVerticesPerRowOnLevel();const M=Math.max(I,5);let Q=E.clippingArea;if(!E.intersectsClippingArea||E.isWithinClippingArea)Q=null;I=this.geometryState;let T=!1;I.numVerticesPerSide!==M&&(this._numVerticesPerSideChanged=!0,I.numVerticesPerSide=M,I.samplerDataVersion++,T=!0);H.changed&&(this._samplerDataChanged=!0,I.samplerData=H.samplerData,I.samplerDataVersion++,T=!0);c.equals(I.clippingArea,Q)||(this._clippingAreaChanged=!0,I.clippingArea=Q,T=!0);H=E.surface;E=H.wireframe;I.wireframe!==
E&&(this._wireframeChanged=!0,I.wireframe=E,T=!0);H=H.shading;I.shading!==H&&(this._shadingChanged=H,T=I.shading=H);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=T);T&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate};N._createGeometry=function(H){this.tile.createGeometry();const E=this.geometryInfo.vertexAttributes,I=this.geometryInfo.indices,M=H.gl;this._vao=new C.VertexArrayObject(H,k.terrainVertexAttributeLocations,
{geometry:f.glLayout(E.layout)},{geometry:q.BufferObject.createVertex(H,M.STATIC_DRAW,E.buffer)},q.BufferObject.createIndex(H,M.STATIC_DRAW,I));this._hasGeometry=!0};N._releaseGeometry=function(){this._hasGeometry=!1;this.intersectionData=null;if(!this._vao)return!1;this._vao.dispose();this._vao=null;t.releaseGeometry(this.geometryInfo);return!0};N.setTextureReference=function(H,E=u.ActivationTime.Immediate){m.isSome(H)&&H.texture!==this._texture&&this.releaseTexture();this._textureRef.push(H,E)};
N._getElevationInfo=function(){const H=this.geometryState.samplerData,E=this.tile.layerInfo[A.LayerClass.ELEVATION],I=E.length;let M=Array(I),Q=0;var T=0;let S=!1;for(let V=0;V<I;V++){var U=E[V];if(m.isSome(U.upsampleInfo)){U=U.upsampleInfo.tile;var Y=U.layerInfo[A.LayerClass.ELEVATION][V].data;Y=Y&&Y.samplerData;H&&H[Q]===Y||(S=!0);M[Q++]=Y;T=Math.max(T,U.lij[0])}else U.data&&(Y=this.tile.surface.layerViewByIndex(V,A.LayerClass.ELEVATION),B.fallsWithinLayer(this.tile,Y.layer,!1)&&(T=U.data,H&&H[Q]===
T.samplerData||(S=!0),M[Q++]=T.samplerData,T=this.tile.level))}m.isSome(H)&&H.length!==Q&&(S=!0);0<Q?M.length=Q:M=null;return{changed:S,samplerData:M,maxTileLevel:T}};N.checkGeometryWaterproofness=function(){if(w.ENABLE_TERRAIN_INTERNAL_CHECKS){var H=this.tile;w.internalAssert(H?.isLoaded);if(H.isLoaded&&H.intersectsClippingArea&&0!==H.level){var E=H.surface.extent;if(!m.isSome(E)||H.intersectsExtent(E)){var I=w.neighborEdgeIndices.map((S,U)=>m.isSome(E)?0>(2>U?-1:1)*(H.extent[3-U]-E[3-U]):!1),M=
H.level;w.internalAssert(0===this._dirtyCorners);w.internalAssert(0===this._dirtyEdges);w.internalAssert(0===this._dirtyEdgeResolutions);w.internalAssert(!this._numVerticesPerSideChanged);w.internalAssert(!this._samplerDataChanged);w.internalAssert(!this._clippingAreaChanged);w.internalAssert(!this._wireframeChanged);var Q=w.neighborCornerIndices.map(S=>H.findNeighborCornerTileExact(S,U=>!U.intersectsClippingArea||U.isLoaded||U.level===H.level)??null).map(S=>S?.intersectsClippingArea?S:null),T=this.geometryState.neighborData;
for(let S=0;4>S;++S){const U=T.cornerPeerNeighbors[S],Y=Q[S];w.internalAssert(Y===U,`Tile[${H.lij}].corner[${S}] out of date: cur=[${U?.lij}] exp=[${Y?.lij}]`)}w.neighborEdgeIndices.forEach((S,U)=>{if(!I[U]){var Y=H.findNeighborTile(S,da=>(da.level===M||da?.isLoaded)&&da?.intersectsClippingArea);if(Y){w.internalAssert(Y.isLoaded||Y.level===H.level);w.internalAssert(Y===this.geometryState.neighborData.edgePeerNeighbors[U]);var V=M-Y.level;if(Y.isLoaded){w.internalAssert(z.isEdgeNeighbor(H,Y,S));w.internalAssert(0<=
V);var R=2**V;if(0>V)w.internalAssert(!1);else{var X=H.renderData.geometryInfo,W=X.outerEdges[U],aa=X.numVerticesPerSide-1,ba=Y.renderData.geometryInfo;if(ba){X=this.geometryState.neighborData.edgePeerNeighbors[U];if(X?.isLoaded||X.isLoaded)w.internalAssert(X===X),w.internalAssert(H.renderData.geometryState.neighborData.edgePeerNeighborSamplerVersions[U]===X.renderData.geometryState.samplerDataVersion),w.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[U]===X.renderData.geometryState.samplerDataVersion);
var ia=(U+2)%4,ma=ba.outerEdges[ia];X=W.count-1;var ha=ma.count-1;w.internalAssert(X*R===ha,`Tile[${H.lij}]:e${U},res=${X} edgeRes mismatch with`+` Neighbor[${Y.lij}]:e${ia},res=${ha} (expected:${X*R})`);X=H.extent;ha=S===l.NeighborIndex.NORTH||S===l.NeighborIndex.SOUTH;var ka=ma.count-1,Z=ka/2**V,ca=W.count-1;if(1>Z)w.internalAssert(1===ca);else{w.internalAssert(Z===ca);w.internalAssert(r.isPowerOfTwo(Z));ba=ba.numVerticesPerSide-1;w.internalAssert(0<V||Z===Math.max(ba,aa));V=H.getNeighborEdgeStartVertexIndex(U,
Y);w.internalAssert(0<=V&&V<R);R=V*Z;w.internalAssert(0<=R&&R<=ka-Z);var fa=0,ea=R;W.getVertexPos(D,0);W.getVertexPos(F,W.count-1);R=n.distance(D,F);R=Math.max(1,1E-4*R);for(V=0;V<=Z;++V){W.getVertexPos(D,fa);ma.getVertexPos(F,ea);ba=V/Z;aa=ha?X[0]+ba*(X[2]-X[0]):S===l.NeighborIndex.WEST?X[0]:X[2];const da=ha?S===l.NeighborIndex.SOUTH?X[1]:X[3]:X[1]+ba*(X[3]-X[1]),la=H.surface.extent;if(m.isNone(la)||h.containsXY(la,aa,da)){ba=n.dist(D,F);ka=n.len(D)-d.earth.radius;ca=n.len(F)-d.earth.radius;const oa=
ba<R;oa||(console.warn("Tile edge vertex position mismatch: between"+` [${H.lij}].edge${U}[${fa}/${W.count}] and`+` [${Y.lij}].edge${ia}[${ea}/${ma.count}]`),m.isSome(la)&&console.warn("  surface extent\x3d ",la," x,y\x3d",aa,",",da),aa=p.create(),n.subtract(aa,H.renderData.localOrigin,Y.renderData.localOrigin),0<n.len(aa)&&console.warn(`   localOrigins: ${H.renderData.localOrigin} vs ${Y.renderData.localOrigin}`+` d=${n.len(aa)} [${aa}]`),(()=>{const ra=p.clone(D),Aa=p.clone(F);H.updateEdgeElevations();
Y.updateEdgeElevations();W.getVertexPos(D,fa);ma.getVertexPos(F,ea);const ua=p.create();n.sub(ua,D,ra);0<n.len(ua)&&console.warn(`  XXX Tile[${H.lij}] edge out of date: ${ra} vs ${D} d=${n.len(ua)} [${ua}]`);n.sub(ua,F,Aa);0<n.len(ua)&&console.warn(`  XXX Neighbor[${Y.lij}] edge out of date: ${Aa} vs ${F} d=${n.len(ua)} [${ua}]`)})(),w.internalAssert(oa,"Mismatch in tile"+` [${H.lij}].edge[${U}][${fa}/${W.count}] vs neighbor`+` [${Y.lij}].edge[${ia}][${ea}/${ma.count}]`+` ${w.v32s(D)} vs ${w.v32s(F)}  dist=${ba} h(t|n|d)=${ka}|${ca}|${ca-
ka}`));if(H.surface.shading){W.getNormal(G,fa);ma.getNormal(J,ea);n.normalize(L,G);n.normalize(K,J);const ra=n.dot(L,K);aa=.01>1-ra||H===Y;if(!aa){const Aa=p.create();n.sub(Aa,G,J);ba=()=>`Mismatch in tile edge normal ${w.lij2s(H.lij)} (${fa}/${W.count-1}) edge ${U} vs neighbor ${w.lij2s(Y.lij)}  (${ea}/${ma.count-1}) nedge ${ia} :`+`${w.v32s(G)} vs ${w.v32s(J)}  dot = ${ra} : ${w.v32s(Aa)}`;console.warn("Mismatch in tile edge normal: ",ba());H.updateEdgeElevations();Y.updateEdgeElevations();ka=p.create();
ca=p.create();W.getNormal(ka,fa);ma.getNormal(ca,ea);n.equals(G,ka)||console.warn("Missing update in tile normal: ",w.v32s(G)," \x3d\x3e ",w.v32s(ka));n.equals(J,ca)||console.warn("Missing update in neighbor normal: ",w.v32s(J)," \x3d\x3e ",w.v32s(ca));w.internalAssert(aa,ba())}}}fa+=1;ea+=1}}}else w.internalAssert(!1)}}else w.internalAssert(!Y.isLeaf),w.internalAssert(0===V)}else S=!H.surface.updatingRootTiles&&m.isSome(H.surface.rootTiles)&&0<H.surface.rootTiles.length&&H.shouldHaveNeighbor(S),
w.internalAssert(!S)}})}}}};b._createClass(P,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const H=m.mapOr(this.intersectionData,0,E=>E.estimatedMemoryUsage);return(this.geometryInfo.indices?.byteLength??0)+(this.geometryInfo.vertexAttributes?.byteLength??0)+H}},{key:"textureDescriptor",get:function(){return m.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return P}();const D=p.create(),F=p.create(),G=p.create(),J=p.create(),L=p.create(),K=p.create(),O=[null,null,null,null];Object.defineProperty(a,
"ActivationTime",{enumerable:!0,get:()=>u.ActivationTime});a.PatchRenderData=v;a.neighborTileIfLoadedOrSelf=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){let b=function(){this.cornerTiles=[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]},c=function(){this.cornerNeighborData=[new b,new b,new b,new b];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=
[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]};a.CornerNeighborData=b;a.GeometryState=function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.shading=this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new c};a.NeighborhoodData=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/maybe","./interfaces"],function(a,b,c,r){let m=function(){function n(g){this._getFadeDuration=g;this._delayedTime=this._fadeStart=0}var p=n.prototype;p.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};p.push=function(g,h=a.ActivationTime.Immediate){this._delayed=c.destroyMaybe(this._delayed);this._push(g,h)};p._push=function(g,h){this._isFadingEnabled||
this.clear();if(c.isNone(this._current))this._current=g;else{var d=n.test.fadeMoment||performance.now();h!==a.ActivationTime.Immediate?(this._delayed=g,this._delayedTime=d+h):c.isNone(this._next)?(this._next=g,this._fadeStart=this._alignFadeStart(d)):c.isNone(g)||(c.destroyMaybe(this._waiting),this._waiting=g)}};p._alignFadeStart=function(g){const h=this._getFadeDuration();return g+h-g%h};b._createClass(n,[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var g=
this._delayed||this._waiting||this._next||this._current;g!==this._current&&(this._current=null,this.clear(),this._current=g)}g=n.test.fadeMoment;c.isSome(this._delayed)&&(g=g||performance.now(),g>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(c.isSome(this._next)){g=g||performance.now();var h=this._fadeDuration;const d=c.isSome(this._current)&&this._next.texture===this._current.texture,f=this._next.type!==r.TextureUpdate.FADING;h=g-this._fadeStart>=
h;if(d||f||h)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(g)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;var g=n.test.fadeMoment||performance.now();g=Math.max(0,g-this._fadeStart);const h=this._fadeDuration;return g>h?0:1-g/h}},{key:"isFading",get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",
get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return n}();m.test={fadeMoment:0};a.ActivationTime=void 0;(function(n){n[n.Immediate=0]="Immediate";n[n.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J){function L(U){U.dispose();U instanceof u.ElevationTileAgent?T.release(U):U instanceof B.MapTileAgent&&Q.release(U)}function K(U,Y,V){return Math.abs(U-Y)<=V}function O(U,Y,V){return r.isNone(U)||r.isNone(Y)||Y===U?!1:U.level>=Y.level?P(U,Y,V):P(Y,U,q.oppositeCorner(V))}function P(U,Y,V){q.internalAssert(U.level>=Y.level);var R=q.isWestCorner(V),X=q.isNorthCorner(V);V=U.extent;const W=Y.extent;var aa=[R?V[0]:V[2],X?V[3]:V[1]];const ba=
[R?W[2]:W[0],X?W[1]:W[3]];R=1E-5*(V[2]-V[0]);X=K(aa[0],ba[0],R)||U.surface.isGlobal&&K(aa[0],-ba[0],R);aa=K(aa[1],ba[1],R);if(X&&aa)return!0;if(U.level===Y.level||!X&&!aa)return q.internalAssert(!1),!1;U=X?N(W[1],W[3],V[1],V[3],R):N(W[0],W[2],V[0],V[2],R);q.internalAssert(U);return U}function N(U,Y,V,R,X=d.getEpsilon()){return U-X<=V&&V<=R&&R<=Y+X}const H=h.create(),E=h.create(),I=h.create();let M=function(){function U(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;
this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();this._elevationBounds=p.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=h.create();this._center=[h.create(),l.create(),h.create()];this.up=h.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=
0}U.prune=function(){Q.prune(0);T.prune(0);v.TilePerLayerInfo.prune()};var Y=U.prototype;Y.computeVisibility=function(){this._dirty=!1;var V=this.parent?.frustumVisibility??z.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=V===z.TileFrustumVisibility.INSIDE?z.TileFrustumVisibility.INSIDE:V===z.TileFrustumVisibility.OUTSIDE?z.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);V=this._frustumVisibility!==z.TileFrustumVisibility.OUTSIDE&&this._intersectsClippingArea;
V!==this._visible&&(this._visible=V,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())};Y.init=function(V,R,X){this.lij[0]=V[0];this.lij[1]=V[1];this.lij[2]=V[2];this.ellipsoid=f.getReferenceEllipsoid(X.tilingScheme.spatialReference);X.tilingScheme.getExtent(V[0],V[1],V[2],this.extent);X.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+
this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;X.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=V?V[0]:0;R&&R.elevationBounds?n.copy(this._elevationBounds,R.elevationBounds):n.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=R;this.unsetChildren();this._surface=
X;this.updateVisibility();for(const W of y.LayerClasses){V=X.numLayers(W);R=this.layerInfo[W];for(const aa of R)aa.release();R.length=V;for(let aa=0;aa<V;aa++)R[aa]=v.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),W===y.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(aa,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(X.tilingScheme.pixelSize,k.MAX_PATCH_TESSELATION)};Y.release=function(){q.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);
for(var V of y.LayerClasses){for(const R of this.layerInfo[V])R.release();this.layerInfo[V].length=0}this._parent=null;for(V=0;4>V;++V)this._children[V]=null;this._surface=null;this.setMemoryDirty()};Y.refMapData=function(){++this._mapDataRefCount;this._isCached||this._surface.upsampleMapCache.pop(this.key)};Y.unrefMapData=function(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const V=this._cachedMemory;0<V&&this._surface.upsampleMapCache.put(this.key,this,V)}};Y.setMemoryDirty=
function(){this._usedMemory=null};Y._ensureUsedMemory=function(){if(r.isSome(this._usedMemory))return this._usedMemory;let V=this._mapTileMemoryInternal=this._usedMemory=0;for(var {data:R}of this.layerInfo[y.LayerClass.MAP])R instanceof A.VectorTile?V+=this._getTerrainDataMemory(R):this._mapTileMemoryInternal+=this._getTerrainDataMemory(R);R=this._cpuImageMemorySize;for(const X of this.layerInfo[y.LayerClass.ELEVATION])this._usedMemory+=X.data?R:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
this._mapTileMemoryInternal+=J.getGpuMemoryUsage(this.renderData.textureDescriptor));this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+V);return this._usedMemory};Y.getUsedMemoryForLayer=function(V,R){R=this.layerInfo[V][R];return R?.data?V===y.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(R.data):V===y.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0};Y._getTerrainDataMemory=function(V){return V instanceof D?J.getGpuMemoryUsage(V.texture):
V instanceof HTMLImageElement||V instanceof t.ImageWithType?this._cpuImageMemorySize:V instanceof A.VectorTile||V instanceof C.RasterTile?V.memoryUsage:0};Y.updateScreenDepth=function(V){var R=this._center[a.CenterPosition.MIDDLE];const X=R[0],W=R[1];R=R[2];const aa=V[2]*X+V[6]*W+V[10]*R+V[14];this._screenDepth=0>aa?0:aa/(V[3]*X+V[7]*W+V[11]*R+V[15])};Y.shouldSplit=function(V,R,X){if(!this.visible||r.isSome(V.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(V.frustum)===
z.TileFrustumVisibility.OUTSIDE))return F.TileUpdate.NONE;const W=this.level;g.subtract(H,this._center[a.CenterPosition.MIDDLE],R);var aa=g.squaredLength(H);let ba=a.CenterPosition.MIDDLE;g.subtract(E,this._center[a.CenterPosition.TOP],R);var ia=g.squaredLength(E);ia<aa&&(aa=ia,ba=a.CenterPosition.TOP);g.subtract(E,this._center[a.CenterPosition.BOTTOM],R);ia=g.squaredLength(E);ia<aa&&(aa=ia,ba=a.CenterPosition.BOTTOM);if(this._edgeLen2>aa&&W<V.maxLod)return F.TileUpdate.SPLIT;aa=Math.sqrt(aa);const ma=
this._edgeLen/(V.fovX*aa*2);ia=()=>{const Z=W+Math.ceil(-Math.log2(V.relativeWidthLimit/ma));return Z!==this.vlevel?(this.vlevel=Z,F.TileUpdate.VSPLITMERGE):F.TileUpdate.NONE_HIT_MAXLOD};if(r.isSome(X)&&1===X-W)return W>=V.maxLod?ia():F.TileUpdate.SPLIT;const ha=g.dot(this.up,H);X=this._elevationBounds[1]-this._elevationBounds[0];const ka=X/this.edgeLen;return V.aboveGround&&0<ha&&.001>ka&&0<ha/aa-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-ka?F.TileUpdate.NONE:ma<V.relativeWidthLimit?
this.vlevel!==this.level?(this.vlevel=this.level,F.TileUpdate.VSPLITMERGE):F.TileUpdate.NONE:W>=V.maxLod?ia():6<W&&(g.subtract(E,this._center[ba],R),g.scale(I,this.up,ha),g.subtract(I,I,E),ia=g.squaredLength(I),ia>this.radius*this.radius&&(g.scale(I,I,this.radius/Math.sqrt(ia)),g.add(I,I,this._center[ba]),g.subtract(I,R,I),Math.min(1,(Math.abs(g.dot(I,this.up))+.5*X+this._curvatureHeight)/g.length(I))*(this._edgeLen/(V.fovY*aa*2))<.1/V.angledSplitBias*V.relativeHeightLimit))?F.TileUpdate.NONE:F.TileUpdate.SPLIT};
Y.setChildren=function(V,R,X,W){q.weakAssert(!!(V&&R&&X&&W),"Null child passed");this._children[0]=V;this._children[1]=R;this._children[2]=X;this._children[3]=W};Y.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};Y.load=function(){this.refMapData();for(const V of y.LayerClasses)this._createOrUpdateAgents(0,V);this.surface.renderer.loadTile(this)};Y.unload=function(V){V.unloadTile(this);for(const R of y.LayerClasses){V=this.layerInfo[R];
for(const X of V)X.loadingAgent&&X.loadingAgent!==x.TILE_AGENT_DONE&&(L(X.loadingAgent),X.loadingAgent=null),X.pendingUpdates=0}this.resetPendingUpdate(F.TileUpdate.GEOMETRY);this.resetPendingUpdate(F.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(F.TileUpdate.TEXTURE_FADING);this.unrefMapData()};Y.unloadMapData=function(){const V=this.layerInfo[y.LayerClass.MAP];for(const R of V)R.loadingAgent&&R.loadingAgent!==x.TILE_AGENT_DONE&&(L(R.loadingAgent),R.loadingAgent=null),R.pendingUpdates=0;this.renderData&&
this.renderData.releaseTexture();this.setMemoryDirty()};Y.updateClippingStatus=function(V){if(e.equals(V,this._clippingArea))return!1;var R=this._intersectsClippingArea;const X=this._isWithinClippingArea;r.isSome(V)?(this._intersectsClippingArea=this.intersectsExtent(V),this._isWithinClippingArea=this._isWithinExtent(V)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=V;this.updateVisibility();V=X&&this._isWithinClippingArea;R=!X&&!R&&!this._isWithinClippingArea&&!this._intersectsClippingArea;
!this.renderData||V||R||this.setPendingUpdate(F.TileUpdate.GEOMETRY);return!0};Y.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};Y.getLayerInfo=function(V,R){return this.layerInfo[R][V]};Y.hasLayerData=function(V,R){V=this.layerInfo[R][V];return!(!V||!V.data||V.dataInvalidated)};Y._isSuspended=function(V){return this.hasPendingUpdate(F.TileUpdate.SPLIT)?!0:V===y.LayerClass.ELEVATION?!1:!this.loadable};Y.hasPendingUpdate=function(V){return(this._pendingUpdates&V)===V};
Y.setPendingUpdate=function(V){this._pendingUpdates|=V;V===F.TileUpdate.SPLIT||V===F.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};Y.resetPendingUpdate=function(V){return this.hasPendingUpdate(V)?(this._pendingUpdates&=~V,!0):!1};Y.requestLayerData=function(V,R,X){const W=this.layerInfo[R][V];if(W.waitingAgents.has(X))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),X.tile.lij.toString(),
R,V),!0;W.waitingAgents.push(X);if(W.data&&!W.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),X.tile.lij.toString(),R,V),X.dataArrived(this),!0;if(W.requestPromise)return!0;r.abortMaybe(W.requestAbort);W.requestAbort=new AbortController;const aa=this._surface.requestTileData(this,V,R,W.requestAbort);if(!aa)return W.requestAbort=null,!1;V=()=>{W.requestPromise===aa&&(W.requestPromise=null,W.requestAbort=null)};W.requestPromise=
aa;aa.then(V,V);return!0};Y.hasLij=function(V){return this.lij[0]===V[0]&&this.lij[1]===V[1]&&this.lij[2]===V[2]};Y.findByLij=function(V){return this.hasLij(V)?this:this.isLeaf?null:(V=this._children[0].findByLij(V)||this._children[1].findByLij(V)||this._children[2].findByLij(V)||this._children[3].findByLij(V))?V:null};Y.distanceToSquared=function(V){return g.squaredLength(g.subtract(I,this._center[a.CenterPosition.MIDDLE],V))};Y.containsPoint=function(V){const R=this.extent;return V[0]>=R[0]&&V[1]>=
R[1]&&V[0]<=R[2]&&V[1]<=R[3]};Y.containsPointXY=function(V,R){const X=this.extent;return V>=X[0]&&R>=X[1]&&V<=X[2]&&R<=X[3]};Y.unrequestLayerData=function(V,R,X){V=this.layerInfo[R][V];R=V.waitingAgents;X=null!=R.removeUnordered(X);q.weakAssert(X,"agent has not requested this piece of map data");1>R.length&&(V.abortRequest(),this.setMemoryDirty())};Y.dataArrived=function(V,R,X){V=this.layerInfo[R][V];V.data=X;V.dataInvalidated=!1;V.waitingAgents.forAll(W=>W.dataArrived(this));V.waitingAgents.clear();
this.setMemoryDirty()};Y.dataMissing=function(V,R,X){X.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${R}/${V} error ${X}`);V=this.layerInfo[R][V];V.dataMissing=!0;V.waitingAgents.forAll(W=>W.dataMissing());V.waitingAgents.clear();this.setMemoryDirty()};Y.updateRenderData=function(V,R){switch(V){case y.LayerClass.MAP:return this._updateTexture(R);case y.LayerClass.ELEVATION:return this._updateGeometry()}};Y._updateTexture=function(V){this.renderData&&(this.resetPendingUpdate(V===
z.TextureUpdate.FADING?F.TileUpdate.TEXTURE_NOFADING:F.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(V===z.TextureUpdate.FADING?F.TileUpdate.TEXTURE_FADING:F.TileUpdate.TEXTURE_NOFADING))};Y._updateGeometry=function(){this.setPendingUpdate(F.TileUpdate.GEOMETRY);for(const V of this.layerInfo[y.LayerClass.ELEVATION])V.pendingUpdates|=F.TileUpdate.GEOMETRY};Y.invalidateLayerData=function(V,R){this.layerInfo[R][V].invalidateSourceData();this.restartAgents(R)};Y.computeElevationBounds=function(){const V=
this._elevationBounds;n.set(V,Infinity,-Infinity);const R=this.layerInfo[y.LayerClass.ELEVATION];let X=!0;for(const W of R)r.isSome(W.elevationBounds)&&(V[0]=Math.min(V[0],W.elevationBounds.min),V[1]=Math.max(V[1],W.elevationBounds.max),W.elevationBounds.hasNoDataValues||(X=!1));X&&(V[0]=Math.min(V[0],0),V[1]=Math.max(V[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};Y._updateCenter=function(){const V=this._elevationBounds;g.scale(I,this.up,.5*(V[0]+V[1]));g.add(this._center[a.CenterPosition.MIDDLE],
this.centerAtSeaLevel,I);g.scale(I,this.up,V[0]);g.add(this._center[a.CenterPosition.TOP],this.centerAtSeaLevel,I);g.scale(I,this.up,V[1]);g.add(this._center[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,I)};Y.findElevationBoundsForLayer=function(V,R){const X=this.layerInfo[y.LayerClass.ELEVATION][V];if(!(r.isSome(X.elevationBounds)&&X.elevationBounds.level>=R)&&(R=this._surface.layerViewByIndex(V,y.LayerClass.ELEVATION),R=q.getLayerWithExtentRange(R),G.fallsWithinLayer(this,R,!1))){R=S;var W=!1;
if(X.data)V=X.data,R.min=V.bounds[0],R.max=V.bounds[1],R.hasNoDataValues=V.hasNoDataValues,R.level=this.level,W=!0;else{let aa=0,ba,ia;for(let ma=this._parent;ma&&(!ia||aa<k.getElevationDesiredResolutionLevel(this.level))&&!(aa=this.vlevel-ma.level,ba=ia||ba,ia=ma.layerInfo[y.LayerClass.ELEVATION][V].data,!ia&&ba&&aa>=k.getElevationDesiredResolutionLevel(this.level));ma=ma.parent);if(ia=ia||ba)ia.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],R),Infinity!==R.min&&(R.level=ia.level,W=!0)}W&&
(r.isNone(X.elevationBounds)&&(X.elevationBounds=new w.ElevationBounds),X.elevationBounds.copyFrom(R))}};Y.modifyLayers=function(V,R,X){X=this.layerInfo[X];for(var W of X)W.loadingAgent&&W.loadingAgent!==x.TILE_AGENT_DONE&&(L(W.loadingAgent),W.loadingAgent=null),W.waitingAgents.clear();for(W=0;W<X.length;++W)void 0===V[W]&&X[W].release();V=Array(...X);W=R.length;X.length=W;for(let aa=0;aa<W;aa++){const ba=R[aa];X[aa]=-1<ba?V[ba]:v.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};
Y.restartAgents=function(V){this.renderData&&(this._createOrUpdateAgents(0,V),this.updateRenderData(V,z.TextureUpdate.FADING))};Y.updateAgents=function(V){if(this.renderData){const R=this.layerInfo[V];for(const X of R)X.loadingAgent===x.TILE_AGENT_DONE&&(X.loadingAgent=null);this._createOrUpdateAgents(0,V)}};Y.updateAgentSuspension=function(){for(const V of y.LayerClasses){const R=this._isSuspended(V);for(const X of this.layerInfo[V])X.loadingAgent&&X.loadingAgent!==x.TILE_AGENT_DONE&&(X.loadingAgent.setSuspension(R),
X.loadingAgent===x.TILE_AGENT_DONE&&this.updateRenderData(V,z.TextureUpdate.FADING))}};Y.removeLayerAgent=function(V,R){V=this.layerInfo[R][V];V.loadingAgent&&V.loadingAgent!==x.TILE_AGENT_DONE&&V.loadingAgent.dispose();V.loadingAgent=null};Y.agentDone=function(V,R){const X=this.layerInfo[R][V];X.loadingAgent=x.TILE_AGENT_DONE;!X.data&&r.isNone(X.upsampleInfo)&&this._createOrUpdateAgents(V+1,R)};Y._hasBlendableAncestor=function(V){return"normal"!==V.blendMode||q.isGroupLayer(V.parent)&&this._hasBlendableAncestor(V.parent)};
Y._hasBlendModes=function(V,R,X){for(;V<R;++V){const W=this._surface.layerViewByIndex(V,X);if(q.isBlendableLayerView(W)&&"normal"!==W?.layer?.blendMode||q.isGroupLayer(W?.layer?.parent)&&this._hasBlendableAncestor(W?.layer?.parent))return!0}return!1};Y._createOrUpdateAgents=function(V,R){const X=this.layerInfo[R];if(0!==X.length){var W=this._isSuspended(R);for(let ma=V;ma<X.length;++ma){const ha=X[ma];var aa=!1;const ka=this._surface.layerViewByIndex(ma,R);var ba=q.getLayerWithExtentRange(ka);if(ha.loadingAgent)G.fallsWithinLayer(this,
ba,!1)?(ha.loadingAgent!==x.TILE_AGENT_DONE&&ha.loadingAgent.setSuspension(W),ha.loadingAgent!==x.TILE_AGENT_DONE&&(aa=ha.loadingAgent.update())):ha.dispose();else if(G.fallsWithinLayer(this,ba,!1)){aa=ma;ba=R;var ia=W;const Z=ba===y.LayerClass.ELEVATION?T.acquire():Q.acquire();Z.init(this,aa,ba,ia);ha.loadingAgent=Z;(aa=ha.loadingAgent.startLoading())?ha.loadingAgent===x.TILE_AGENT_DONE&&this.setPendingUpdate(F.TileUpdate.GEOMETRY):(L(ha.loadingAgent),ha.loadingAgent=x.TILE_AGENT_DONE)}ha.loadingAgent===
x.TILE_AGENT_DONE&&this.updateRenderData(R,z.TextureUpdate.FADING);if(!this._hasBlendModes(V,X.length,R)&&aa&&ka.isOpaque)break}}};Y._isWithinExtent=function(V){const R=this.extent;return R[0]>=V[0]&&V[2]>=R[2]&&R[1]>=V[1]&&V[3]>=R[3]};Y.intersectsExtent=function(V){const R=this.extent;return R[2]>=V[0]&&V[2]>=R[0]&&R[3]>=V[1]&&V[3]>=R[1]};Y.getElevationBasedVerticesPerSide=function(V){const R=this.vlevel-this.level;V=Math.max(this.level-V,k.getElevationDesiredResolutionLevel(this.level)-R);return c.clamp((this.maxTesselation>>
V)+1,2,this.maxTesselation+1)};Y._findLIJ=function(V,R){if(!V)return null;var X=this.surface.rootTiles;if(r.isSome(X))for(var W of X){X=W.level;var aa=V[0];X>aa?X=!1:(X=aa-X,aa=Math.floor(V[2]/2**X),X=Math.floor(V[1]/2**X)===W.lij[1]&&aa===W.lij[2]);if(X){for(X=V[0]-W.level-1;0<=X&&!W.isLeaf&&!R(W);)W=W.children[2*(V[1]>>X&1)+(V[2]>>X&1)],X--;return R(W)?W:null}}return null};Y.findNeighborTile=function(V,R){const X=this.lij;return(V=this.getNeighborLIJ(X,V))?X[0]===V[0]&&X[1]===V[1]&&X[2]===V[2]?
R(this)?this:null:this._findLIJ(V,R):null};Y.findCorner=function(V,R){V=V===z.NeighborIndex.NORTH_EAST?1:V===z.NeighborIndex.NORTH_WEST?0:V===z.NeighborIndex.SOUTH_WEST?2:3;let X=this;for(;!(X.isLeaf||R&&R(X));)X=X.children[V];return X};Y.findNeighborCornerTileExact=function(V,R){return this.findNeighborTile(V,X=>R(X)||X.level===this.level)?.findCorner(q.oppositeCorner(V),R)};Y.forAllSubtreeOnSide=function(V,R){const X=V===z.NeighborIndex.NORTH?[0,1]:V===z.NeighborIndex.NORTH_EAST?[1]:V===z.NeighborIndex.EAST?
[1,3]:V===z.NeighborIndex.SOUTH_EAST?[3]:V===z.NeighborIndex.SOUTH?[2,3]:V===z.NeighborIndex.SOUTH_WEST?[2]:V===z.NeighborIndex.WEST?[0,2]:[0],W=aa=>{R(aa)||aa.isLeaf||X.forEach(ba=>W(aa.children[ba]))};W(this)};Y.forallNeighbors=function(V){q.neighborCornerIndices.forEach(R=>this.findNeighborCornerTileExact(R,V));q.neighborEdgeIndices.forEach(R=>this.findNeighborTile(R,X=>X.level===this.level||V(X))?.forAllSubtreeOnSide(q.oppositeEdge(R),V))};Y.getNeighborEdgeStartVertexIndex=function(V,R){if(!R)return 0;
var X=this.level-R.level;q.internalAssert(!q.ENABLE_TERRAIN_INTERNAL_CHECKS||0<=X);if(0===X)return 0;X=2**X;var W=(V=1===(V&1))?0:1;R=R.lij[W+1]*X;W=this.lij[W+1];const aa=W-R;V=V?X-1-aa:aa;q.ENABLE_TERRAIN_INTERNAL_CHECKS&&(q.internalAssert(R<=W&&W<R+X),q.internalAssert(0<=V&&V<X));return V};Y.forEachLoadedNeighbor=function(V){const R=this.level,X=W=>W.level===R||W.isLoaded;q.neighborEdgeIndices.forEach(W=>{const aa=this.findNeighborTile(W,X);null!=aa&&aa!==this&&aa.forAllSubtreeOnSide(q.oppositeEdge(W),
ba=>ba.isLoaded?(V(ba,W),!0):!1)});q.neighborCornerIndices.forEach(W=>{const aa=this.findNeighborTile(W,X)?.findCorner(q.oppositeCorner(W),ba=>ba.isLoaded);q.internalAssert(!aa||O(this,aa,W));aa?.isLoaded&&V(aa,W)})};Y.getNeighborLIJ=function(V,R){const X=q.isNorth(R)?-1:q.isSouth(R)?1:0;R=q.isWest(R)?-1:q.isEast(R)?1:0;V=[V[0],V[1]+X,V[2]+R];return 0>V[1]?null:this.surface.isGlobal?this.wrapLIJ(V):0>V[2]?null:V};Y.wrapLIJ=function(V){return!V||0>V[1]||V[1]>=2**V[0]?null:this.surface.wrapEastWest(V)};
Y.compareLIJs=function(V){const R=this.lij;var X=R[0],W=V[0];if(X===W)return[R,V];const aa=X-W;if(0>aa)return X=2**-aa,[[W,R[1]*X,R[2]*X],V];W=2**aa;return[R,[X,V[1]*W,V[2]*W]]};Y.checkGeometryWaterproofness=function(){q.ENABLE_WATERPROOFNESS_TESTS&&(q.internalAssert(this.isLoaded),this.renderData.checkGeometryWaterproofness())};Y.shouldHaveNeighbor=function(V){const R=this.extent,X=this.surface.rootTilesExtent,W=.25*(R[2]-R[0]);if(q.isNorth(V)&&R[3]+W>=X[3]||q.isSouth(V)&&R[1]-W<=X[1])return!1;const aa=
this.surface.isGlobal;return!aa&&q.isWest(V)&&R[0]-W<=X[0]||!aa&&q.isEast(V)&&R[2]+W>=X[2]?!1:!0};b._createClass(U,[{key:"_isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",
get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},
{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"frustumVisibility",get:function(){this._dirty&&this.computeVisibility();return this._frustumVisibility}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const V=!!this.renderData;V!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=V,this._surface.renderer.setDirty());return V}},
{key:"shouldLoad",get:function(){var V=this._surface.snapLevel;if(r.isSome(V)){V=this.level-V;if(0===V)return!0;if(1===V)return!1}return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}},{key:"_cachedMemory",get:function(){return this._isCached?this._mapTileMemory:0}},{key:"_mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[y.LayerClass.MAP].reduce((V,R)=>V+(R instanceof A.VectorTile?R.memoryUsage:
0),this._mapTileMemoryInternal)}},{key:"_cpuImageMemorySize",get:function(){const V=this._surface.tilingScheme.pixelSize;return V*V*4}},{key:"isLoaded",get:function(){return this.renderData?.hasGeometry??!1}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const V of y.LayerClasses){const R=this.layerInfo[V];for(const X of R)if(X.loadingAgent&&X.loadingAgent!==x.TILE_AGENT_DONE&&X.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},
{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this._cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*(this.isWestEnd?-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?-1:1)}},{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===
this.lij[1]}},{key:"isSouthEnd",get:function(){return this.extent[1]+d.getEpsilon()>=this.surface.extent[1]}}]);return U}();const Q=new m(B.MapTileAgent),T=new m(u.ElevationTileAgent),S=new w.ElevationBounds;a.CenterPosition=void 0;(function(U){U[U.TOP=0]="TOP";U[U.MIDDLE=1]="MIDDLE";U[U.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};
a.Tile=M;a.almostEquals=K;a.isCornerNeighbor=O;a.isEdgeNeighbor=function(U,Y,V){if(r.isNone(U)||r.isNone(Y))return!1;if(0===U.level&&0===Y.level&&(U.isEastEnd&&Y.isWestEnd&&V===z.NeighborIndex.EAST||U.isWestEnd&&Y.isEastEnd&&V===z.NeighborIndex.WEST))return!0;const R=Math.max(1E-6*(U.extent[2]-U.extent[0]),1);switch(V){case z.NeighborIndex.NORTH:return K(U.extent[3],Y.extent[1],R);case z.NeighborIndex.SOUTH:return K(U.extent[1],Y.extent[3],R);case z.NeighborIndex.EAST:return K(U.extent[2],Y.extent[0],
R)||K(U.extent[2],-Y.extent[0],R);case z.NeighborIndex.WEST:return K(U.extent[0],Y.extent[2],R)||K(U.extent[0],-Y.extent[2],R)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,r){r=function(m){function n(){var p=m.apply(this,arguments)||this;p._scaleRangeEnabled=!1;return p}b._inheritsLoose(n,
m);b._createClass(n,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return n}(r.TileAgent);a.ElevationTileAgent=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,r,m,n,p){let g=function(){function f(){}var e=f.prototype;e.init=function(l,A,t,w){this.tile=l;this._layerIdx=A;this._layerClass=t;this._suspended=w;this._tileLayerInfo=l.getLayerInfo(A,t);this._tileRequested=null;l=this._findAncestorWithData();this._setUpsampleTile(l)};e.startLoading=function(){return this._requestNext()};e.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};e.setSuspension=function(l){l!==this._suspended&&((this._suspended=l)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};e.update=function(){const l=this._findAncestorWithData();this._setUpsampleTile(l);return this._requestNext()};e.dataArrived=function(l){this._setUpsampleTile(l);this._tileRequested=null;l===this.tile?this.tile.updateRenderData(this._layerClass,r.TextureUpdate.FADING):
this._requestNext()};e.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};e._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};e._requestNext=function(){if(this._suspended)return!0;const l=this._findNextDownload();if(this._tileRequested){if(l===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(l)?l.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=l):this._agentDone();return!!this._tileRequested};e._findNextDownload=function(){const l=this._layerIdx,A=this._layerClass;var t=this.tile.surface.layerViewByIndex(l,A);const w=n.getLayerWithExtentRange(t),{minLevel:u,maxLevel:z}=t.dataLevelRange;t=this._desiredMinLevelDelta;const y=this._progressiveLevelModulo+t,B=this._scaleRangeEnabled?p.fallsWithinLayer:()=>!0;let C=this.tile;const k=C.level;let q;var x=this._tileLayerInfo.upsampleInfo;const v=c.isSome(x)?
x.tile.level:-1;x=c.isSome(x)?v-k>=t:!1;const D=c.get(w,"tilemapCache");for(;C&&B(C,w,!1)&&C.level>=u;){const F=C.level,G=k-F,J=C.layerInfo[A][l];if(J.data&&G>=t){(!x||F>v)&&this._setUpsampleTile(C);J.dataInvalidated&&(q=C);break}if((c.isNone(D)||"unavailable"!==D.getAvailability(C.lij[0],C.lij[1],C.lij[2]))&&F<=z&&!J.data&&!J.dataMissing){if(c.isNone(q)||C.level===u||0===F%m.PROGRESSIVE_LOADING_MODULO||k-q.level<t)q=C;if(G>=y)break}C=C.parent}c.isSome(q)&&k-q.level<t&&this._tileLayerInfo.upsampleInfo&&
(q=null);return q};e._findAncestorWithData=function(){const l=this.tile.vlevel,A=this._desiredMinLevelDelta;let t;for(let w=this.tile;w;w=w.parent)if(w.hasLayerData(this._layerIdx,this._layerClass)){if(l-w.level>=A)return w;t=w}return t};e._setUpsampleTile=function(l){this._tileLayerInfo.setUpsampleInfo(this.tile,l);this.tile.updateRenderData(this._layerClass,r.TextureUpdate.FADING)};b._createClass(f,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>
this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return f}();var h=function(f){function e(){return f.apply(this,arguments)||this}b._inheritsLoose(e,f);e.prototype.dispose=function(){};b._createClass(e,[{key:"_desiredMinLevelDelta",get:function(){throw d;}},{key:"_progressiveLevelModulo",get:function(){throw d;}}]);return e}(g);const d=Error("Abstract method called on TileAgent");h=new h;a.TILE_AGENT_DONE=h;a.TileAgent=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,b,c,r){function m(e,l){l(e);if(!e.isLeaf)for(const A of e.children)m(A,l)}function n(e,l){return e.lij[0]-l.lij[0]||e.lij[1]-l.lij[1]||e.lij[2]-l.lij[2]}function p(e,l,A){const t=e.screenDepth,w=l.screenDepth;return t<w?-A:t>w?A:n(e,l)}function g(e,l,A,t){const w=h(e,t);t=h(l,t);return w===t?p(e,l,A):e?A:-A}function h(e,l){for(const A of l)if(e.intersectsExtent(A))return!0;
return!1}let d=function(){function e(){this._queue=new r;this._last=null;this.remove=()=>{}}var l=e.prototype;l.resetOne=function(A){this._queue.clear();this._queue.push(A);this._last=null};l.reset=function(A=null){this._queue.clear();c.isSome(A)&&this._queue.pushArray(A);this._last=null};l.skipSubtree=function(){this._last=null};l.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};b._createClass(e,[{key:"done",get:function(){return 0===
this._queue.length&&(!this._last||this._last.isLeaf)}}]);return e}(),f=function(){function e(){this._q=new r}var l=e.prototype;l.reset=function(A){this._q.clear();if(!c.isNone(A))for(this._q.pushArray(A),A=0;A<this._q.length;++A){const t=this._q.data[A];t.isLeaf||this._q.pushArray(t.children)}};l.next=function(){return this._q.pop()};b._createClass(e,[{key:"done",get:function(){return 0===this._q.length}}]);return e}();a.IteratorPostorder=f;a.IteratorPreorder=d;a.compareTiles=p;a.compareTilesByLij=
n;a.compareTilesWithStencil=g;a.computeUpsampleInfo=function(e,l,A){let t=1,w=0,u=0;for(;e!==l;)if(t*=.5,w*=.5,u*=.5,e.lij[2]&1&&(w+=.5),0===(e.lij[1]&1)&&(u+=.5),e=e.parent,null==e)throw Error("tile was not a descendant of upsampleTile");A.init(l,w,u,t)};a.fallsWithinLayer=function(e,l,A){if(c.isNone(l)||c.isNone(l.fullExtent))return!1;const t=l.fullExtent,w=e.extent;if(A){if(w[0]<t.xmin||w[1]<t.ymin||w[2]>t.xmax||w[3]>t.ymax)return!1}else if(t.xmin>w[2]||t.ymin>w[3]||t.xmax<w[0]||t.ymax<w[1])return!1;
e=e.surface.tilingScheme.levels[e.level].scale;return 0<l.minScale&&e>1.00000001*l.minScale||0<l.maxScale&&e<.99999999*l.maxScale?!1:!0};a.hasLoadableSiblings=function(e){for(let l=0;l<e.length;l++){const A=e[l],t=A.parent;if(t)for(let w=0;4>w;w++){const u=t.children[w];if(u&&u!==A)return!0}}return!1};a.sortTiles=function(e,l,A=null){c.isNone(A)||0===A.length?l.sort((t,w)=>p(t,w,e)):l.sort((t,w)=>g(t,w,e,A))};a.sortTilesByPOI=function(e,l){const A=new Map;e.forAll(t=>A.set(t.lij,t.distanceToSquared(l)));
e.sort((t,w)=>A.get(t.lij)-A.get(w.lij)||n(t,w))};a.tilesAreRelated=function(e,l){if(!e||!l||e[0]===l[0])return!1;const A=e[0]<l[0],t=A?e:l;e=A?l:e;l=1<<e[0]-t[0];return Math.floor(e[1]/l)===t[1]&&Math.floor(e[2]/l)===t[2]};a.traverseTilesPreorder=function(e,l){if(Array.isArray(e))for(let A=0;A<e.length;A++)m(e[A],l);else m(e,l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"./TerrainConst","./TileAgent"],function(a,b,c,r){r=function(m){function n(){var p=m.call(this)||this;p._scaleRangeEnabled=!0;return p}b._inheritsLoose(n,m);b._createClass(n,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return n}(r.TileAgent);a.MapTileAgent=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),
function(a,b,c,r,m,n){const p={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let g=function(){function h(f,e,l=null,A=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=
this.symbolizerRenderer=null;this.opacity=1;this.lij=f;this.source=e;this.width=l||e.width;this.height=A||e.height}var d=h.prototype;d.bind=function(f){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(c.isNone(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(f,this.bandIds);c.isSome(this._rasterTexture)&&(this._updateColormapTexture(f),this.transformGrid&&c.isNone(this._transformGridTexture)&&(this._transformGridTexture=n.createTransformTexture(f,this.transformGrid)));
return!0};d.getUniforms=function(){const {symbolizerParameters:f,transformGrid:e,width:l,height:A,opacity:t}=this,w=n.getCommonUniforms(e,[l,A],[this.source.width,this.source.height],t),u=n.getColormapUniforms(f.colormap,f.colormapOffset),z="stretch"===this.symbolizerParameters.type?n.getStretchUniforms(this.symbolizerParameters):null,y="hillshade"===this.symbolizerParameters.type?n.getShadedReliefUniforms(this.symbolizerParameters):null;return new r.ColorizerUniforms(w,u,z||y,this._rasterTexture,
this._transformGridTexture,this._colormapTexture)};d.release=function(){this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};d._updateRasterTexture=function(f,e){const l=this.source?this.source.extractBands(e):null;l&&l.pixels&&0<l.pixels.length?(e=c.isNone(e)&&c.isNone(this.bandIds)||c.isSome(e)&&c.isSome(this.bandIds)&&
e.join("")===this.bandIds.join(""),c.isSome(this._rasterTexture)&&e||(this._rasterTexture=c.disposeMaybe(this._rasterTexture),e=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=n.createRasterTexture(f,l,e,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=c.disposeMaybe(this._rasterTexture)};d.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&
"u8"===this.source.pixelType};d._getRasterTextureInterpolation=function(f){return"lut"===this.symbolizerParameters.type||"nearest"===f||"majority"===f?"nearest":"bilinear"};d._updateColormapTexture=function(f){const e=this._colormap,l=this.symbolizerParameters.colormap;if(!l)this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!e)this._colormapTexture=n.createColormapTexture(f,l),this._colormap=l;else if(l.length!==e.length||l.some((A,t)=>A!==e[t]))this._colormapTexture=
c.disposeMaybe(this._colormapTexture),this._colormapTexture=n.createColormapTexture(f,l),this._colormap=l};b._createClass(h,[{key:"source",get:function(){return this._source},set:function(f){this._source=f;this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...p,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||p},set:function(f){this._symbolizerParameters=f}},{key:"bandIds",get:function(){return this._bandIds},
set:function(f){c.isSome(f)&&0<f.length?this._bandIds&&f.every((e,l)=>this._bandIds[l]?e===this._bandIds[l]:!1)||(this._bandIds=f,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(f){this._interpolation=f;c.isSome(this._rasterTexture)&&(f=this._getRasterTextureInterpolation(f),this._rasterTexture.setSamplingMode("bilinear"===f?m.TextureSamplingMode.LINEAR:m.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},
set:function(f){this._transformGrid=f;this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"memoryUsage",get:function(){c.isNone(this._memoryUsed)&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(f=>c.isSome(f)?f.descriptor.width*f.descriptor.height*4:0).reduce((f,e)=>f+e,0));return this._memoryUsed}}]);return h}();a.RasterTile=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(v){const D=new w.ShaderBuilder;D.include(g.TileComposite);D.include(n.Common,v);D.include(m.Colormap,v);D.include(p.TileBackground,v);D.fragment.code.add(t.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);v.colorizerType===r.RasterColorizerType.Stretch?y(D,v):v.colorizerType===r.RasterColorizerType.Lut?D.fragment.code.add(t.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):v.colorizerType===r.RasterColorizerType.Hillshade&&B(D,v);return D}function y(v,D){v.fragment.uniforms.add([new A.IntegerPassUniform("u_bandCount",G=>G.symbolizer.u_bandCount),new l.FloatsPassUniform("u_minCutOff",G=>G.symbolizer.u_minCutOff,3),new l.FloatsPassUniform("u_maxCutOff",G=>G.symbolizer.u_maxCutOff,3),new l.FloatsPassUniform("u_factor",G=>G.symbolizer.u_factor,3),new e.FloatPassUniform("u_minOutput",G=>G.symbolizer.u_minOutput),new e.FloatPassUniform("u_maxOutput",G=>G.symbolizer.u_maxOutput),
new d.BooleanPassUniform("u_useGamma",G=>G.symbolizer.u_useGamma),new l.FloatsPassUniform("u_gamma",G=>G.symbolizer.u_gamma,3),new l.FloatsPassUniform("u_gammaCorrection",G=>G.symbolizer.u_gammaCorrection,3),new e.FloatPassUniform("u_opacity",G=>G.common.u_opacity)]);v.fragment.code.add(t.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const F=D.applyColormap?t.glsl`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:t.glsl`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;v.fragment.code.add(t.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${D.stretchType===r.RasterColorizerStretchType.Noop?t.glsl`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:t.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${F}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function B(v,D){v=v.fragment;v.uniforms.add([new u.Texture2DPassUniform("u_image",F=>F.u_image),new A.IntegerPassUniform("u_hillshadeType",F=>F.symbolizer.u_hillshadeType),new l.FloatsPassUniform("u_sinZcosAs",F=>F.symbolizer.u_sinZcosAs,6),new l.FloatsPassUniform("u_sinZsinAs",F=>F.symbolizer.u_sinZsinAs,6),new l.FloatsPassUniform("u_cosZs",F=>F.symbolizer.u_cosZs,6),new l.FloatsPassUniform("u_weights",F=>F.symbolizer.u_weights,6),new f.Float2PassUniform("u_factor",F=>F.symbolizer.u_factor),
new e.FloatPassUniform("u_minValue",F=>F.symbolizer.u_minValue),new e.FloatPassUniform("u_maxValue",F=>F.symbolizer.u_maxValue),new f.Float2PassUniform("u_srcImageSize",F=>F.common.u_srcImageSize)]);v.include(h.ColorConversion);v.code.add(t.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`);v.code.add(t.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);D=D.applyColormap?t.glsl`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:t.glsl`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;v.code.add(t.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${D}
    }
  `)}let C=function(v){function D(F,G,J,L,K,O){F=v.call(this,F,L,K)||this;F.colormap=G;F.symbolizer=J;F.u_colormap=O;F.backgroundColor=c.ZEROS;F.fboTexture=null;F.baseOpacity=1;return F}b._inheritsLoose(D,v);return D}(n.CommonPassParameters),k=function(v){function D(){return v.apply(this,arguments)||this}b._inheritsLoose(D,v);return D}(C),q=function(v){function D(){return v.apply(this,arguments)||this}b._inheritsLoose(D,v);return D}(C);const x=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:C,
ColorizerStretchUniforms:k,ColorizerHillshadeUniforms:q,build:z},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=q;a.ColorizerStretchUniforms=k;a.ColorizerUniforms=C;a.RasterColorizer=x;a.build=z})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=
void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../util/WebGL2Utils","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,r,m){a.Colormap=
function(n,p){n.fragment.uniforms.add([new m.Texture2DPassUniform("u_colormap",g=>g.u_colormap),new c.FloatPassUniform("u_colormapOffset",g=>g.colormap.u_colormapOffset),new c.FloatPassUniform("u_colormapMaxIndex",g=>g.colormap.u_colormapMaxIndex),new c.FloatPassUniform("u_opacity",g=>g.common.u_opacity)]);n.fragment.code.add(r.glsl`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${b.texelFetch(p,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,r,m,n,p){r=function(g){function h(d,f,e){var l=g.call(this)||this;l.common=
d;l.u_image=f;l.u_transformGrid=e;return l}b._inheritsLoose(h,g);return h}(r.TileCompositePassParameters);a.Common=function(g,h){g.include(c.Projection,h);g.fragment.uniforms.add([new p.Texture2DPassUniform("u_image",d=>d.u_image),new m.BooleanPassUniform("u_flipY",d=>d.common.u_flipY),new m.BooleanPassUniform("u_applyTransform",d=>d.common.u_applyTransform)]);g.fragment.code.add(n.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};a.CommonPassParameters=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define("exports ../util/WebGL2Utils ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),function(a,b,c,r,m,n){a.Projection=function(p,g){p.fragment.uniforms.add(m.createTexture2DPassSizeUniforms("u_transformGrid",
h=>h.u_transformGrid,g.hasWebGL2Context?n.TextureSizeUniformType.None:n.TextureSizeUniformType.InvSize));p.fragment.uniforms.add(new c.Float2PassUniform("u_transformSpacing",h=>h.common.u_transformSpacing));p.fragment.uniforms.add(new c.Float2PassUniform("u_targetImageSize",h=>h.common.u_targetImageSize));p.fragment.code.add(r.glsl`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${b.texelFetch(g,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${b.texelFetch(g,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${b.texelFetch(g,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${b.texelFetch(g,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,r,m,n,p){let g=function(h){function d(){var f=h.apply(this,
arguments)||this;f.scale=1;f.offset=c.ZEROS;return f}b._inheritsLoose(d,h);return d}(n.NoParameters);a.TileComposite=function(h){h.attributes.add(p.VertexAttribute.POSITION,"vec2");h.attributes.add(p.VertexAttribute.UV0,"vec2");h.vertex.uniforms.add(new m.FloatPassUniform("scale",d=>d.scale));h.vertex.uniforms.add(new r.Float2PassUniform("offset",d=>d.offset));h.varyings.add("uv","vec2");h.varyings.add("vuv","vec2");h.vertex.code.add(n.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../util/WebGL2Utils ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.BlendLayersOutput=void 0;(function(A){A[A.Composite=0]="Composite";A[A.ColorComposite=1]="ColorComposite";A[A.GridComposite=2]="GridComposite";A[A.GroupBackgroundComposite=3]="GroupBackgroundComposite";A[A.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(A){A[A.NotRequired=0]="NotRequired";A[A.Required=1]="Required";A[A.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;
(function(A){A[A.Off=0]="Off";A[A.On=1]="On";A[A.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));let l=function(A){function t(){var w=A.apply(this,arguments)||this;w.baseOpacity=1;w.backgroundColor=c.ZEROS;w.fboTexture=null;return w}b._inheritsLoose(t,A);return t}(d.NoParameters);a.TileBackground=function(A,t){const w=t.output===a.BlendLayersOutput.GridComposite,u=t.output===a.BlendLayersOutput.ColorComposite,z=t.output===a.BlendLayersOutput.GroupBackgroundComposite,
y=t.output===a.BlendLayersOutput.Composite;w&&(A.extensions.add("GL_OES_standard_derivatives"),A.fragment.include(m.BackgroundGrid));u&&A.fragment.uniforms.add(new g.Float3PassUniform("backgroundColor",q=>q.backgroundColor));const B=t.baseOpacityMode===a.BaseOpacityMode.Required;B&&A.fragment.uniforms.add(new h.FloatPassUniform("baseOpacity",q=>q.baseOpacity));y&&A.fragment.uniforms.add(f.createTexture2DPassSizeUniforms("fboColor",q=>q.fboTexture,t.hasWebGL2Context?e.TextureSizeUniformType.None:e.TextureSizeUniformType.InvSize));
const C=t.blendMode!==r.LayerBlendMode.Normal,k=t.premultipliedSource===a.PremultipliedAlphaSource.On;A.fragment.include(n.BlendModes,t);A.fragment.code.add(d.glsl`
    vec4 getBackground(vec2 uv) {
      return ${B?d.glsl`baseOpacity *`:""} ${z?d.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:u?d.glsl`vec4(backgroundColor, 1.0)`:w?d.glsl`gridColor(uv)`:d.glsl`${p.texelFetch(t,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${C?d.glsl`
          vec3 Cb = bgColor.a == 0.0 ? bgColor.rgb : vec3(bgColor.rgb * bgColor.a);
          return applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, bgColor.a);`:d.glsl`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          return ${k?d.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:y&&!B||z?d.glsl`pmColorLayer * composeAlpha;`:d.glsl`mix(bgColor, pmColorLayer, composeAlpha);`}`}
    }`)};a.TileBackgroundPassParameters=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";
b[b.ColorBurn=9]="ColorBurn";b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";
b[b.Xor=25]="Xor";b[b.Difference=26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,
multiply:a.LayerBlendMode.Multiply,"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,
"destination-over":a.LayerBlendMode.DestinationOver,"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||
b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(c){c.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,c){a.BlendModes=function(r,m){m=m.blendMode;if(m!==b.LayerBlendMode.Normal){m===b.LayerBlendMode.Reflect&&r.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);m!==b.LayerBlendMode.ColorDodge&&m!==b.LayerBlendMode.VividLight||r.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);m!==b.LayerBlendMode.ColorBurn&&m!==b.LayerBlendMode.VividLight||r.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);m===b.LayerBlendMode.Overlay&&r.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);m===b.LayerBlendMode.HardLight&&r.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);m===b.LayerBlendMode.SoftLight&&r.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);m===b.LayerBlendMode.VividLight&&r.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(m===b.LayerBlendMode.Hue||m===b.LayerBlendMode.Saturation||m===b.LayerBlendMode.Color||m===b.LayerBlendMode.Luminosity)r.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),m!==b.LayerBlendMode.Hue&&m!==b.LayerBlendMode.Saturation||r.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);r.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${m===b.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
m===b.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:m===b.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:m===b.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:m===b.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
m===b.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:m===b.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:m===b.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:m===b.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:m===b.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:m===b.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:m===b.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:m===b.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:m===b.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:m===b.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:m===b.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/rasterUtils":function(){define(["exports","../../chunks/vec2f64","./context-util","./enums","./Texture"],function(a,b,c,r,m){a.createColormapTexture=function(n,p){return new m.Texture(n,{width:p.length/4,height:1,target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,internalFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,
wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},p)};a.createRasterTexture=function(n,p,g="nearest",h=!1){const d=(h=!(h&&"u8"===p.pixelType))?r.PixelType.FLOAT:r.PixelType.UNSIGNED_BYTE,f=null==p.pixels||0===p.pixels.length?null:h?p.getAsRGBAFloat():p.getAsRGBA();return new m.Texture(n,{width:p.width,height:p.height,target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,internalFormat:n.type===c.ContextType.WEBGL2&&h?r.SizedPixelFormat.RGBA32F:r.PixelFormat.RGBA,samplingMode:!n.capabilities.textureFloat?.textureFloatLinear||
"bilinear"!==g&&"cubic"!==g?r.TextureSamplingMode.NEAREST:r.TextureSamplingMode.LINEAR,dataType:d,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},f)};a.createTransformTexture=function(n,p){const {spacing:g,offsets:h,coefficients:d,size:[f,e]}=p;var l=1<g[0];p={width:l?4*f:f,height:e,target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,internalFormat:n.type===c.ContextType.WEBGL2?r.SizedPixelFormat.RGBA32F:r.PixelFormat.RGBA,dataType:r.PixelType.FLOAT,samplingMode:r.TextureSamplingMode.NEAREST,
wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const A=new Float32Array(l?f*e*16:2*h.length);if(l)for(let t=0,w=0;t<d.length;t++)A[w++]=d[t],2===t%3&&(A[w++]=1);else for(l=0;l<e;l++)for(let t=0;t<f;t++){const w=4*(l*f+t),u=2*(t*e+l);A[w]=h[u];A[w+1]=h[u+1];A[w+3]=-1===h[u]?0:1}return new m.Texture(n,p,A)};a.getBasicGridUniforms=function(n,p){return{u_scale:n,u_offset:p}};a.getColormapUniforms=function(n,p){return{u_colormapOffset:p||0,u_colormapMaxIndex:n?n.length/4-1:0}};a.getCommonUniforms=
function(n,p,g,h=1,d=!0){return{u_flipY:d,u_applyTransform:n?!0:!1,u_opacity:h,u_transformSpacing:n?n.spacing:b.ZEROS,u_transformGridSize:n?n.size:b.ZEROS,u_targetImageSize:p,u_srcImageSize:g}};a.getShadedReliefUniforms=function(n){return{u_hillshadeType:n.hillshadeType,u_sinZcosAs:n.sinZcosAs,u_sinZsinAs:n.sinZsinAs,u_cosZs:n.cosZs,u_weights:n.weights,u_factor:n.factor,u_minValue:n.minValue,u_maxValue:n.maxValue}};a.getStretchUniforms=function(n){return{u_bandCount:n.bandCount,u_minOutput:n.outMin,
u_maxOutput:n.outMax,u_minCutOff:n.minCutOff,u_maxCutOff:n.maxCutOff,u_factor:n.factor,u_useGamma:n.useGamma,u_gamma:n.gamma,u_gammaCorrection:n.gammaCorrection}};a.getUniformLocationInfos=function(n,p){n=n.gl;p=p.glName;const g=n.getProgramParameter(p,n.ACTIVE_UNIFORMS),h=new Map;let d;for(let f=0;f<g;f++)(d=n.getActiveUniform(p,f))&&h.set(d.name,{location:n.getUniformLocation(p,d.name),info:d});return h};a.setTextures=function(n,p,g,h){g.length===h.length&&(h.some(d=>null==d)||g.some(d=>null==d)||
g.forEach((d,f)=>{p.setUniform1i(d,f);n.bindTexture(h[f],f)}))};a.setUniforms=function(n,p,g){Object.keys(g).forEach(h=>{var d=p.get(h)||p.get(h+"[0]");if(d){var f=g[h];if(null!==d&&null!=f)switch({info:d}=d,d.type){case r.UniformType.FLOAT:1<d.size?n.setUniform1fv(h,f):n.setUniform1f(h,f);break;case r.UniformType.FLOAT_VEC2:n.setUniform2fv(h,f);break;case r.UniformType.FLOAT_VEC3:n.setUniform3fv(h,f);break;case r.UniformType.FLOAT_VEC4:n.setUniform4fv(h,f);break;case r.UniformType.FLOAT_MAT3:n.setUniformMatrix3fv(h,
f);break;case r.UniformType.FLOAT_MAT4:n.setUniformMatrix4fv(h,f);break;case r.UniformType.INT:1<d.size?n.setUniform1iv(h,f):n.setUniform1i(h,f);break;case r.UniformType.BOOL:n.setUniform1i(h,f?1:0);break;case r.UniformType.INT_VEC2:case r.UniformType.BOOL_VEC2:n.setUniform2iv(h,f);break;case r.UniformType.INT_VEC3:case r.UniformType.BOOL_VEC3:n.setUniform3iv(h,f);break;case r.UniformType.INT_VEC4:case r.UniformType.BOOL_VEC4:n.setUniform4iv(h,f)}}})};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,b,c,r,m,n,p){let g=function(){function f(){this.waitingAgents=new m;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}f.acquire=function(l){const A=h.acquire();A._init(l);return A};
var e=f.prototype;e.release=function(){this.dispose();d.delete(this);h.release(this)};e.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=n.releaseTileData(this._data)};f.prune=function(){h.prune(0)};e._init=function(l){this.waitingAgents.clear();this._data=n.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=
0;this._pool=l;this.elevationBounds=null};e.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};e.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};e._unsetUpsampleInfo=function(){c.isSome(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};e.setUpsampleInfo=function(l,A){if(l===A||c.isNone(A))this._unsetUpsampleInfo();else{if(c.isNone(this._upsampleInfo))this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===A)return;this._upsampleInfo.tile.unrefMapData()}A.refMapData();p.computeUpsampleInfo(l,A,this._upsampleInfo)}};b._createClass(f,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(l){n.releaseTileData(this._data);this._data=l}}]);return f}();const h=new r(g,null,()=>{}),d=new Map;a.TilePerLayerInfo=g;a.printAllocations=function(){0<d.size&&(console.log(`${d.size} live TilePerLayerInfo allocations:`),
d.forEach(f=>console.log(f,"\n")))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(r){this._texture=r;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};
a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";b[b.SPLIT=2]="SPLIT";b[b.VSPLITMERGE=4]="VSPLITMERGE";b[b.MERGE=8]="MERGE";b[b.RENDERDATA=16]="RENDERDATA";b[b.GEOMETRY=32]="GEOMETRY";b[b.TEXTURE_NOFADING=
64]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec4f64"],function(a,b){return function(){function c(){this._scales=b.fromValues(-1,-1,-1,-1);this._offsets=b.fromValues(-1,-1,-1,-1)}var r=c.prototype;r.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=
-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};r.setScale=function(m,n,p){this._scales[2*m]=n;this._scales[2*m+1]=p};r.setOffset=function(m,n,p){this._offsets[2*m]=n;this._offsets[2*m+1]=p};a._createClass(c,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return c}()})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){p=function(w){function u(){var y=w.apply(this,arguments)||this;y.useStencil=!1;return y}c._inheritsLoose(u,w);var z=u.prototype;z.initializeConfiguration=function(y,B){B.hasWebGL2Context=y.rctx.type===e.ContextType.WEBGL2;B.spherical=y.viewingMode===r.ViewingMode.Global};z.initializeProgram=function(y){return new h.Program(y.rctx,u.shader.get().build(this.configuration),t)};z.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};
z._createPipeline=function(y){const B=this.configuration,C=B.backfaceCullingEnabled&&!B.renderOccluded;return A.makePipelineState({blending:B.renderOccluded?A.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:C&&A.backFaceCullingParams,depthTest:!B.renderOccluded&&{func:l.CompareFunction.LESS},depthWrite:!B.renderOccluded&&A.defaultDepthWriteParams,colorWrite:A.defaultColorWriteParams,stencilTest:y?d.renderWhenBitIsNotSet(g.StencilBits.IntegratedMeshMaskExcluded):
null})};z.getPipelineState=function(y,B){return this.useStencil?this._stencilPipelineState:w.prototype.getPipelineState.call(this,y,B)};return u}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(m.Terrain,()=>new Promise((w,u)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],w,u)));const t=new Map([[f.VertexAttribute.POSITION,0],[f.VertexAttribute.UV0,1],[f.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=p;b.terrainVertexAttributeLocations=t;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/WebGL2Utils ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O){function P(I){const M=new K.ShaderBuilder,{vertex:Q,fragment:T,varyings:S}=M;M.include(l.PositionAttribute);M.include(e.NormalAttribute,I);M.include(A.TextureCoordinateAttribute,I);var U=()=>{M.include(C.NormalUtils,I);Q.code.add(J.glsl`
  vec3 decodeNormalTerrain(vec2 e) {
    float z = 1.0 - abs(e.x) - abs(e.y);
    vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
    return normalize(n);
  }

  vec3 getNormal() {
    return  ${I.shading?J.glsl`normalize(decodeNormalTerrain(normalCompressed))`:J.glsl`getLocalUp(position, localOrigin)`};
  }
  `)};D.addProjViewLocalOrigin(Q,I);M.include(f.Transform,I);const Y=I.overlayMode!==x.OverlayMode.Disabled;switch(I.output){case h.ShaderOutput.Color:M.include(v.TerrainTexture,I);M.include(y.EvaluateSceneLighting,I);const V=I.overlayMode===x.OverlayMode.EnabledWithWater;Y&&M.include(v.OverlayTerrain,{...I,pbrMode:k.PBRMode.Water});V&&M.include(t.VertexTangent,I);S.add("vnormal","vec3");S.add("vpos","vec3");U();(I.atmosphere||I.screenSizePerspective)&&D.addViewNormal(Q);(U=I.receiveShadows&&!I.renderOccluded)&&
M.include(g.ForwardLinearDepth,I);I.atmosphere&&S.add("wnormal","vec3");I.screenSizePerspective&&(S.add("screenSizeDistanceToCamera","float"),S.add("screenSizeCosAngle","float"));Q.code.add(J.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          ${V?J.glsl`forwardVertexTangent(vnormal);`:J.glsl``}

          ${I.atmosphere?J.glsl`
          wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Y?J.glsl`setOverlayVTC(uv);`:""}
          ${I.tileBorders?J.glsl`forwardTextureCoordinates();`:""}

          ${I.screenSizePerspective?J.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${U?J.glsl`forwardLinearDepth();`:""}

        }
      `);M.extensions.add("GL_OES_standard_derivatives");M.extensions.add("GL_EXT_shader_texture_lod");M.include(d.SliceDraw,I);M.include(y.EvaluateSceneLighting,I);M.include(z.EvaluateAmbientOcclusion,I);M.include(q.ReadShadowMapDraw,I);V&&D.addCameraPosition(T,I);y.addAmbientBoostFactor(T);y.addLightingGlobalFactor(T);T.uniforms.add([Q.uniforms.get("localOrigin"),new G.Float3PassUniform("viewDirection",(R,X)=>m.normalize(E,m.set(E,X.camera.viewMatrix[12],X.camera.viewMatrix[13],X.camera.viewMatrix[14])))]);
V&&T.uniforms.add([new O.Texture2DPassUniform("ovWaterTex",(R,X)=>0===X.overlays.length?null:X.overlays[p.OverlayIndex.INNER].getNormalTexture(R.overlaySource)),new L.Matrix4DrawUniform("view",(R,X)=>c.translate(H,X.camera.viewMatrix,R.origin))]);T.code.add(J.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);B.addMainLightDirection(T);B.addMainLightIntensity(T);T.code.add(J.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${I.receiveShadows&&!I.renderOccluded?"readShadowMap(vpos, linearDepth)":I.spherical&&I.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Y?J.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${I.transparent?J.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
          if (rejectBySlice(vpos)) {
            tileColor *= sliceOpacity;
          }
          ${I.atmosphere?J.glsl`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${I.atmosphere?J.glsl`atm + tileColor.rgb;`:J.glsl`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
          ${V?J.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
          ${I.screenSizePerspective?J.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${I.visualizeNormals?I.spherical?J.glsl`
              vec3 localUp = normalize(vpos + localOrigin);
              vec3 right = normalize(cross(vec3(0.0,0.0,1.0),localUp));
              vec3 forward = normalize(cross(localUp,right));
              mat3 tbn = mat3(right, forward, localUp);
              vec3 tNormal = normalize(normal* tbn);
              gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
          `:J.glsl`
          vec3 tNormal = normalize(normal);
          gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
      `:""}
          ${I.tileBorders?J.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `);break;case h.ShaderOutput.Depth:M.include(v.OverlayTerrain,I);M.include(w.OutputDepth,I);g.addLinearDepth(M);g.addNearFar(M);Q.code.add(J.glsl`
              void main(void) {
                ${Y?J.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);T.code.add(J.glsl`
              void main() {
                ${Y?J.glsl`
                  vec4 overlayColor = getCombinedOverlayColor();
                  ${I.transparent?J.glsl`if (overlayColor.a == 0.0) { discard; }`:""}`:""}
                outputDepth(linearDepth);
              }
          `);break;case h.ShaderOutput.Shadow:case h.ShaderOutput.ShadowHighlight:case h.ShaderOutput.ShadowExludeHighlight:M.include(w.OutputDepth,I);g.addLinearDepth(M);g.addNearFar(M);Q.code.add(J.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);T.code.add(J.glsl`void main() {
outputDepth(linearDepth);
}`);break;case h.ShaderOutput.Normal:S.add("vnormal","vec3");D.addViewNormal(Q);U();Q.code.add(J.glsl`void main(void) {
vec3 normal = getNormal();
gl_Position = transformPosition(proj, view, position);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`);T.code.add(J.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`);break;case h.ShaderOutput.Highlight:M.include(v.OverlayTerrain,I),Q.code.add(J.glsl`void main() {
setOverlayVTC(getUV0());
gl_Position = transformPosition(proj, view, position);
}`),M.include(u.OutputHighlight,I),T.code.add(J.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
discard;
}
outputHighlight();
}`)}I.output===h.ShaderOutput.ObjectAndLayerIdColor&&(M.include(v.OverlayTerrain,{...I,pbrMode:k.PBRMode.Disabled}),Q.code.add(J.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),T.code.add(J.glsl`
        void main() {
          vec2 texDim =  ${F.textureSize(I,"ovColorTex")};
          gl_FragColor =  ${F.texelFetch(I,"ovColorTex","vec2(vtcOverlay.x * 0.5, vtcOverlay.y)*texDim")};
        }
    `));return M}let N=function(I){function M(){return I.apply(this,arguments)||this}b._inheritsLoose(M,I);return M}(v.OverlayTerrainPassParameters);const H=r.create(),E=n.create();r=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:N,build:P},Symbol.toStringTag,{value:"Module"}));a.Terrain=r;a.TerrainPassParameters=N;a.build=P})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,
b){a.VertexTangent=function(c,r){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent","vec3");r.spherical?c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../renderPasses/AllRenderPasses ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){function e(t,w){t.extensions.add("GL_OES_standard_derivatives");w.pbrMode!==p.PBRMode.Water&&w.pbrMode!==p.PBRMode.WaterOnIntegratedMesh||t.include(g.Water,w);const {vertex:u,fragment:z}=t;t.varyings.add("vtcOverlay","vec4");u.code.add(d.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);z.code.add(d.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);z.code.add(d.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(w.pbrMode===p.PBRMode.Water||w.pbrMode===p.PBRMode.WaterOnIntegratedMesh)n.addMainLightDirection(z),n.addMainLightIntensity(z),z.code.add(d.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function l(t,w){return 0===w.overlays.length?null:t.identifier===m.RenderPassIdentifier.Material&&t.subPass===m.MaterialSubPass.Color?w.overlays[r.OverlayIndex.INNER].getColorTextureNoRasterImage():t.identifier===m.RenderPassIdentifier.Highlight?w.overlays[r.OverlayIndex.INNER].getValidTexture(r.RenderTargetType.Highlight):null}a.OverlayMode=void 0;(function(t){t[t.Disabled=0]="Disabled";t[t.Enabled=1]="Enabled";t[t.EnabledWithWater=2]="EnabledWithWater";t[t.COUNT=3]="COUNT"})(a.OverlayMode||
(a.OverlayMode={}));const A=b.create();a.OverlayIM=function(t,w){const {vertex:u,fragment:z}=t;u.uniforms.add([new h.Float4DrawUniform("overlayTexOffset",(y,B)=>{for(const C of B.overlays){const {index:k,extent:q}=C;0<c.area(q)&&(A[2*k]=y.toMapSpace[0]/c.width(q)-q[0]/c.width(q),A[2*k+1]=y.toMapSpace[1]/c.height(q)-q[1]/c.height(q))}return A}),new h.Float4DrawUniform("overlayTexScale",(y,B)=>{for(const C of B.overlays){const {index:k,extent:q}=C;0<c.area(q)&&(A[2*k]=y.toMapSpace[2]/c.width(q),A[2*
k+1]=y.toMapSpace[3]/c.height(q))}return A})]);z.constants.add("overlayOpacity","float",1);z.uniforms.add(new f.Texture2DPassUniform("ovColorTex",(y,B)=>l(y,B)));e(t,w)};a.getColorTexture=l;a.overlay=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/attributes/VertexNormal.glsl"],
function(a,b,c,r){let m=function(h){function d(){var f=h.apply(this,arguments)||this;f.slicePlaneLocalOrigin=c.create();f.origin=f.slicePlaneLocalOrigin;return f}b._inheritsLoose(d,h);return d}(r.VertexNormalPassParameters);r=function(h){function d(){return h.apply(this,arguments)||this}b._inheritsLoose(d,h);return d}(r.VertexNormalDrawParameters);a.RenderPassIdentifier=void 0;(function(h){h[h.Material=0]="Material";h[h.ShadowMap=1]="ShadowMap";h[h.Highlight=2]="Highlight"})(a.RenderPassIdentifier||
(a.RenderPassIdentifier={}));a.MaterialSubPass=void 0;(function(h){h[h.Color=0]="Color";h[h.Alpha=1]="Alpha";h[h.Depth=2]="Depth";h[h.Normal=3]="Normal";h[h.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(a.MaterialSubPass||(a.MaterialSubPass={}));let n=function(h){function d(){var f=h.apply(this,arguments)||this;f.identifier=a.RenderPassIdentifier.Material;f.transparent=!1;f.integratedMesh=!1;return f}b._inheritsLoose(d,h);return d}(m),p=function(h){function d(){var f=h.apply(this,arguments)||
this;f.identifier=a.RenderPassIdentifier.ShadowMap;return f}b._inheritsLoose(d,h);return d}(m),g=function(h){function d(){var f=h.apply(this,arguments)||this;f.identifier=a.RenderPassIdentifier.Highlight;return f}b._inheritsLoose(d,h);return d}(m);a.DrawParameters=r;a.HighlightPassParameters=g;a.MaterialPassParameters=n;a.PassParameters=m;a.ShadowMapPassParameters=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"vec4",r.BindType.Draw,(h,d,f)=>h.setUniform4fv(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.Float4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../terrain/interfaces ./BackgroundGrid.glsl ./Overlay.glsl ./TileBlendInput ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(w){function u(){var z=w.apply(this,arguments)||this;z.overlayOpacity=1;return z}b._inheritsLoose(u,w);return u}(g.NoParameters),e=function(w){function u(z){return w.call(this,z,"float")||this}b._inheritsLoose(u,w);return u}(d.Uniform),l=function(w){function u(z){return w.call(this,z,"vec3")||this}b._inheritsLoose(u,w);return u}(d.Uniform),A=function(w){function u(z){return w.call(this,z,"vec4")||this}b._inheritsLoose(u,w);return u}(d.Uniform),t=function(w){function u(z){return w.call(this,
z,"sampler2D")||this}b._inheritsLoose(u,w);return u}(d.Uniform);a.Float3Uniform=l;a.OverlayTerrain=function(w,u){w.vertex.uniforms.add([new A("overlayTexOffset"),new A("overlayTexScale")]);w.fragment.uniforms.add([new p.FloatPassUniform("overlayOpacity",z=>z.overlayOpacity),new h.Texture2DPassUniform("ovColorTex",(z,y)=>0===y.overlays.length?null:y.overlays[c.OverlayIndex.INNER].getColorTexture(z.overlaySource))]);m.overlay(w,u)};a.OverlayTerrainPassParameters=f;a.TerrainTexture=function(w,u){const {vertex:z,
fragment:y,varyings:B}=w;B.add("vtc","vec2");z.uniforms.add(new A("texOffsetAndScale"));y.uniforms.add(new t("tex"));y.uniforms.add(new l("textureOpacities"));if(w=u.textureFadingEnabled&&!u.renderOccluded)z.uniforms.add(new A("nextTexOffsetAndScale")),B.add("nvtc","vec2"),y.uniforms.add(new t("texNext")),y.uniforms.add(new l("nextTexOpacities")),y.uniforms.add(new e("fadeFactor"));const C=u.tileBlendInput===n.TileBlendInput.ColorComposite;(u=u.tileBlendInput===n.TileBlendInput.GridComposite)&&y.include(r.BackgroundGrid);
C&&y.uniforms.add(new l("backgroundColor"));z.code.add(g.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${w?g.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:g.glsl``}
  }`);y.code.add(g.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${u||C?g.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${C?g.glsl`vec4(backgroundColor, 1.0)`:g.glsl`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:g.glsl`return color;`}
    }`);w?y.code.add(g.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):y.code.add(g.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ./interfaces ./PatchGeometryFactory ./Tile".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){f=function(l){function A(w,u,z){var y=l.call(this)||this;y._obb=Array(8);for(let B=0;8>B;B++)y._obb[B]=m.create();void 0!==w&&y.init(w,u,z);return y}b._inheritsLoose(A,l);var t=A.prototype;t.init=function(w,u,z){l.prototype.init.call(this,w,u,z);u=this.ellipsoid.radius;z=this.extentInRadians[0];const y=this.extentInRadians[1],B=this.extentInRadians[2],C=this.extentInRadians[3];w=w[0];const k=c.lerp(y,C,.5),q=c.lerp(z,B,.5);this._edgeLen=(B-z)*Math.cos(0===w?0:Math.min(Math.abs(y),
Math.abs(C)))*u;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=u-Math.sqrt(u*u-this._edgeLen2/4);n.lonLatToSphericalPCPF(this.centerAtSeaLevel,q,k,this.ellipsoid.radius);u=m.fromArray(this.centerAtSeaLevel);r.normalize(u,u);this.up=u;this._updateOBB();this.updateRadiusAndCenter()};t.updateRadiusAndCenter=function(){if(0===this.lij[0])r.set(this._center[a.CenterPosition.MIDDLE],0,0,0),r.set(this._center[a.CenterPosition.TOP],0,0,0),r.set(this._center[a.CenterPosition.BOTTOM],0,0,
0),this.ellipsoid||(this.ellipsoid=p.getReferenceEllipsoid(this.surface.spatialReference)),this._center[a.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const w=Math.max(r.squaredDistance(this._center[a.CenterPosition.MIDDLE],this._obb[0]),r.squaredDistance(this._center[a.CenterPosition.MIDDLE],this._obb[1]));this._center[a.CenterPosition.MIDDLE][3]=Math.sqrt(w)}};t._calculateFrustumVisibilityStatus=function(w){if(!g.intersectsSphere(w,this._center[a.CenterPosition.MIDDLE]))return h.TileFrustumVisibility.OUTSIDE;
if(10>this.lij[0])return h.TileFrustumVisibility.INTERSECTS;const u=this._obb,z=this.surface.view.state.camera.near;let y=!0;for(let C=0;C<g.NumPlanes.NUM;C++){var B=w[C];const k=B[0],q=B[1],x=B[2];B=B[3]-(C===g.PlaneIndex.NEAR?z:0);let v=!1;for(let D=0;8>D;++D){const F=u[D];if(0>k*F[0]+q*F[1]+x*F[2]+B){if(v=!0,!y)break}else y=!1}if(!v)return h.TileFrustumVisibility.OUTSIDE}return y?h.TileFrustumVisibility.INSIDE:h.TileFrustumVisibility.INTERSECTS};t.computeElevationBounds=function(){l.prototype.computeElevationBounds.call(this);
this._updateOBB()};t.createGeometry=function(){const w=this._getPatchType(this.lij[1],this.lij[0]);d.createSphericalGlobePatch(this.renderData,w);this.setMemoryDirty()};t._updateOBB=function(){const w=this.extentInRadians,u=this._obb;for(let z=0;2>z;z++){const y=this.elevationBounds[z];let B=4*z;n.lonLatToSphericalPCPF(u[B++],w[0],w[1],this.ellipsoid.radius+y);n.lonLatToSphericalPCPF(u[B++],w[0],w[3],this.ellipsoid.radius+y);n.lonLatToSphericalPCPF(u[B++],w[2],w[3],this.ellipsoid.radius+y);n.lonLatToSphericalPCPF(u[B++],
w[2],w[1],this.ellipsoid.radius+y)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case h.PatchType.HAS_NORTH_POLE:r.set(u[1],0,0,this.ellipsoid.radius);r.set(u[2],0,0,this.ellipsoid.radius);r.set(u[5],0,0,this.ellipsoid.radius);r.set(u[6],0,0,this.ellipsoid.radius);break;case h.PatchType.HAS_SOUTH_POLE:r.set(u[0],0,0,-this.ellipsoid.radius),r.set(u[3],0,0,-this.ellipsoid.radius),r.set(u[4],0,0,-this.ellipsoid.radius),r.set(u[7],0,0,-this.ellipsoid.radius)}};t._getPatchType=
function(w,u){return w===(1<<u)-1?0===w?h.PatchType.HAS_BOTH_POLES:h.PatchType.HAS_SOUTH_POLE:0===w?h.PatchType.HAS_NORTH_POLE:h.PatchType.REGULAR};t.intersectsRay=function(w,u,z,y){var B=this._center[a.CenterPosition.MIDDLE];z=B[3]+z;var C=B[0]-w[0];y=B[1]-w[1];w=B[2]-w[2];B=(C*u[0]+y*u[1]+w*u[2])/(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]);C=u[0]*B-C;y=u[1]*B-y;u=u[2]*B-w;return C*C+y*y+u*u<z*z};t.getDefaultVerticesPerRowOnLevel=function(){return this.level<e.length?e[this.level]+1:2};t.updateCornerElevations=
function(){d.updateCornerSpherical(this.renderData)};t.updateEdgeElevations=function(){d.updateEdgesAndCornersSpherical(this.renderData)};return A}(f.Tile);const e=[128,64,32,16,16,8,8,4];a.CenterPosition=void 0;(function(l){l[l.TOP=0]="TOP";l[l.MIDDLE=1]="MIDDLE";l[l.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SphericalPatch=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./ScaleRangeQueries ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba){const ia=w.create();a.TransparencyMode=void 0;(function(ca){ca[ca.Opaque=0]="Opaque";ca[ca.Semitransparent=1]="Semitransparent";ca[ca.Invisible=2]="Invisible"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=function(ca){function fa(da){da=ca.call(this,da)||this;da.type=Q.IntersectorType.TERRAIN;da.isGround=!0;da._tileSize=256;da._techniqueConfiguration=new aa.TerrainTechniqueConfiguration;
da._passParameters=new N.TerrainPassParameters;da._rctx=null;da._scaleRangeQueries=new D.ScaleRangeQueries;da._renderDataPool=new p(x.PatchRenderData);da._patchGroups=new Map;da._patchGroupsDirty=!0;da._patchSortingDirty=!0;da._tileIterator=new L.IteratorPreorder;da._highestVisibleLODTile=null;da._visible=!0;da._transparencyState=a.TransparencyMode.Opaque;da._velvetOverground=!0;da._castShadows=!0;da._emptyTex=null;da._tileRenderer=null;da._stencilEnabledLayerExtents=[];da._numTilesRendered=0;da._numTilesCulled=
0;da._numOriginsRendered=0;da.needsHighlight=!1;da.renderOccludedFlags=T.RenderOccludedFlag.Occlude;return da}b._inheritsLoose(fa,ca);var ea=fa.prototype;ea.initialize=function(){this._stage.addRenderPlugin([S.RenderSlot.OPAQUE_TERRAIN,S.RenderSlot.TRANSPARENT_TERRAIN,S.RenderSlot.OCCLUDED_TERRAIN],this)};ea.destroy=function(){this._stage.removeRenderPlugin(this);q.clearCaches()};ea.setDebugScreenSizePerspective=function(da){this._techniqueConfiguration.screenSizePerspective!==da&&(this._techniqueConfiguration.screenSizePerspective=
da,this.setNeedsRender())};ea.setRootTiles=function(da){this._rootTiles=da;this.setDirty()};ea.setNeedsHighlight=function(da){this.needsHighlight=da;this.setNeedsRender()};ea.setRenderOccludedOverlay=function(da){this.renderOccludedFlags=da?k.overlayRenderOccludedFlag:T.RenderOccludedFlag.Occlude;this.setNeedsRender()};ea.setStencilEnabledLayerExtents=function(da){this._stencilEnabledLayerExtents=da;this._setSortingDirty()};ea.setTileSize=function(da){this._tileSize=da;n.isSome(this._tileRenderer)&&
(this._tileRenderer.tileSize=da);this.setDirty()};ea._prepareTileForLoading=function(da){da.renderData||(da.renderData=this._renderDataPool.acquire(),da.renderData.init(da),da.renderData.localOrigin=this._getLocalOriginOfTile(da))};ea.loadTile=function(da){this._prepareTileForLoading(da);this.updateTileGeometryState(da);this.updateTileTexture(da,J.TileUpdate.TEXTURE_FADING)};ea.queryVisibleLevelRange=function(da,la,oa,ra){this._scaleRangeQueries.queryVisibleLevelRange(da,la,oa,ra);this.setNeedsRender()};
ea.updateTileTexture=function(da,la){n.isSome(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(da,la===J.TileUpdate.TEXTURE_FADING?y.TextureUpdate.FADING:y.TextureUpdate.UNFADED),this.setNeedsRender(),da.resetPendingUpdate(la))};ea.updateTileGeometryState=function(da){for(const la of da.layerInfo[B.LayerClass.ELEVATION])la.pendingUpdates&=~J.TileUpdate.GEOMETRY;da.resetPendingUpdate(J.TileUpdate.GEOMETRY);(da=da.renderData.updateGeometryState())&&this.setDirty();return da};ea.updateGeometryIfNeeded=
function(da){da.isLoaded&&da.renderData.updateGeometryIfNeeded(this._rctx)};ea.unloadTile=function(da){const la=da.renderData;la&&(la.releaseGeometry(),this._renderDataPool.release(la),la.clear(),da.renderData=null,da.setMemoryDirty(),this.setDirty())};ea._getLocalOriginOfTile=function(da){const la=Math.max(0,7*Math.floor((da.level-3)/7));if(this._isGlobal&&0===la)return A.ZEROS;for(;da.parent&&da.level>la;)da=da.parent;return da.centerAtSeaLevel};ea.setVisibility=function(da){this._visible=da;this.setDirty()};
ea.getStats=function(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}};ea.setDirty=function(da=E.RenderRequestType.UPDATE){this._patchGroupsDirty=!0;this._context.requestRender(da)};ea._setSortingDirty=function(da=E.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(da)};ea.setNeedsRender=function(da=E.RenderRequestType.UPDATE){this._context.requestRender(da)};ea.initializeRenderContext=
function(da){this._context=da;this._rctx=da.renderContext.rctx;this._techniqueRepository=da.shaderTechniqueRepository;this._tileRenderer=new G.TileRenderer(this._rctx,this._tileSize,this._techniqueRepository);this.updateTileBackground();this._emptyTex=I.createEmptyTexture(this._rctx)};ea.uninitializeRenderContext=function(){this._emptyTex=n.disposeMaybe(this._emptyTex);this._tileRenderer=n.disposeMaybe(this._tileRenderer)};ea.intersect=function(da,la,oa,ra){if(!(!this._rootTiles||da.options.selectOpaqueTerrainOnly&&
da.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var Aa=ma,ua=ha;l.subtract(Aa,ra,oa);l.set(ua,1/Aa[0],1/Aa[1],1/Aa[2]);var za=da.results.min,va=da.results.max,Ja=da.results.ground,pa=da.options.store===Q.StoreResults.MIN,Ba=!!da.results.ground.target,Ha=V.getVerticalOffsetTerrain(da.verticalOffset),wa=da.tolerance,ya,Na=pa&&n.isSome(za.dist)?za.dist:Infinity,Ra=ja=>{var Ta=ja.renderData;if(Ta?.vao){var qa=Ta.geometryInfo;w.set(ia,qa.boundingBox);var Ea=Ta.localOrigin;n.isSome(Ha)&&
(Ha.localOrigin=Ea,Ha.applyToAabb(ia));ka[0]=oa[0]-Ea[0];ka[1]=oa[1]-Ea[1];ka[2]=oa[2]-Ea[2];if(X.intersectAabbInvDirBefore(ia,ka,ua,wa,Na)){var Oa=(La,ta,xa)=>{La.set(this.type,ja,ta,xa,e.IDENTITY);Na=pa&&n.isSome(za.dist)?za.dist:Infinity};Ta=(La,ta)=>{n.isSome(ta)&&0<=La&&(da.options.backfacesTerrain||0>l.dot(ta,Aa))&&(da.options.invisibleTerrain||!da.options.selectionMode||null==la||la(oa,ra,La))&&((null==Ja.dist||La<Ja.dist)&&Oa(Ja,La,ta),da.options.isFiltered||(da.options.store===Q.StoreResults.ALL&&
(n.isNone(ya)?(ya=M.newIntersectorResult(da.ray),Oa(ya,La,ta),da.results.all.push(ya)):La<ya.dist&&Oa(ya,La,ta)),(null==za.dist||La<za.dist)&&Oa(za,La,ta),da.options.store!==Q.StoreResults.MIN&&(null==va.dist||La>va.dist)&&Oa(va,La,ta)))};var Va=Z;l.subtract(Va,ra,Ea);Ea=qa.indices;var Ua=qa.vertexAttributes;Ua={data:Ua.getField(Y.VertexAttribute.POSITION,u.BufferViewVec3f).typedBuffer,size:3,stride:Ua.stride/4};qa=qa.indexCount/3;if(n.isNone(Ha)&&qa>K.componentMinimalSizeForIntersectionData){const La=
ja.renderData;n.isNone(La.intersectionData)&&(La.intersectionData=new K.ComponentIntersectionData(Ea,0,qa,Ua));La.intersectionData.intersectRay({r0:ka,r1:Va},Ta)}else X.intersectTriangles(ka,Va,0,qa,Ea,Ua,null,Ha,Ta)}}},Sa=this._rootTiles;n.isSome(Sa)&&(()=>{const ja=this._tileIterator;ja.reset(Sa);const Ta=da.options.invisibleTerrain;for(;!ja.done;){const qa=ja.next();!(qa.visible||Ta&&qa.intersectsClippingArea)||!n.isSome(Ha)&&!qa.intersectsRay(oa,Aa,wa,Na)||Ba&&this._useStencilForTile(qa)?ja.skipSubtree():
Ra(qa)}})()}};ea.prepareTechnique=function(da){if(da.bindParameters.slot===S.RenderSlot.OCCLUDED_TERRAIN){if(0===(da.renderOccludedMask&k.overlayRenderOccludedFlag))return null}else if(da.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?S.RenderSlot.OPAQUE_TERRAIN:S.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(da.output){case O.ShaderOutput.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=da.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=
n.isSome(da.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=da.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=da.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty()?P.OverlayMode.Disabled:this._overlayRenderer.hasWater?P.OverlayMode.EnabledWithWater:P.OverlayMode.Enabled,this._updateTechnique(O.ShaderOutput.Color,(da.bindParameters.slot===S.RenderSlot.OCCLUDED_TERRAIN?C.OverlaySource.Occluded:
C.OverlaySource.ColorAndWater)===C.OverlaySource.Occluded);case O.ShaderOutput.Shadow:case O.ShaderOutput.ShadowExludeHighlight:if(this._castShadows&&1===da.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(O.ShaderOutput.Shadow,!1);break;case O.ShaderOutput.Depth:if(this.transparency!==a.TransparencyMode.Invisible||!this._overlayRenderer.isEmpty())return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(O.ShaderOutput.Depth,!1);break;case O.ShaderOutput.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(O.ShaderOutput.Normal,!1);case O.ShaderOutput.ObjectAndLayerIdColor:return this._updateTechnique(O.ShaderOutput.ObjectAndLayerIdColor,!1);case O.ShaderOutput.Highlight:if(this.needsHighlight)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(O.ShaderOutput.Highlight,!1)}return null};ea.render=function(da,la){const oa=1===da.bindParameters.lighting.globalFactor;this._updatePatchGroups();la.useStencil=!1;switch(da.output){case O.ShaderOutput.Color:const ra=da.bindParameters.slot===S.RenderSlot.OCCLUDED_TERRAIN?C.OverlaySource.Occluded:C.OverlaySource.ColorAndWater;this.transparency===a.TransparencyMode.Opaque?this._renderMaterialPass(da,la,ra):da.offscreenRenderingHelper.renderToTargets(()=>
this._renderMaterialPass(da,la,ra),da.offscreenRenderingHelper.tmpColor,da.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break;case O.ShaderOutput.Shadow:case O.ShaderOutput.ShadowExludeHighlight:this._castShadows&&oa&&this._renderAuxiliaryPass(da,la,C.OverlaySource.None);break;case O.ShaderOutput.Depth:this.transparency===a.TransparencyMode.Invisible&&this._overlayRenderer.isEmpty()||this._renderAuxiliaryPass(da,la,C.OverlaySource.None);break;case O.ShaderOutput.Normal:this._renderAuxiliaryPass(da,
la,C.OverlaySource.None);break;case O.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(da,la,C.OverlaySource.ObjectAndLayerIdColor);break;case O.ShaderOutput.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(da,la,C.OverlaySource.Highlight)}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()};ea._renderMaterialPass=function(da,la,oa){const {rctx:ra}=da;this._passParameters.overlaySource=oa;ra.bindTechnique(la,this._passParameters,da.bindParameters);this._numOriginsRendered=
this._numTilesCulled=this._numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this._renderPatchGroups(da,la,oa);this._scaleRangeQueries.processQueries()};ea._renderAuxiliaryPass=function(da,la,oa){const ra=da.rctx;this._passParameters.overlaySource=oa;ra.bindTechnique(la,this._passParameters,da.bindParameters);this._renderPatchGroupsAuxiliary(da,la,oa)};ea.updateTileBackground=function(da=null){if(!n.isNone(this._tileRenderer)){var la=this._tileRenderer,oa=null;n.isSome(da)&&(da=r.toUnitRGBA(da),
oa=A.fromValues(da[0]||0,da[1]||0,da[2]||0));la.setBackground(oa);this._allTiles.forAll(ra=>la.updateTileTexture(ra,y.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=la.backgroundIsGrid?H.TileBlendInput.GridComposite:n.isSome(la.backgroundColor)?H.TileBlendInput.ColorComposite:H.TileBlendInput.LayerOnly;this.setNeedsRender()}};ea._updatePatchGroups=function(){this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=
!0);if(this._patchSortingDirty&&this.renderOrder!==v.RenderOrder.NONE){const da=Array.from(this._patchGroups.values());da.forEach(la=>L.sortTiles(this.renderOrder,la,this._stencilEnabledLayerExtents));da.sort((la,oa)=>L.compareTiles(la[0],oa[0],this.renderOrder));this._patchGroups=new Map(da.map(la=>[la[0].renderData.localOrigin,la]));this._patchSortingDirty=!1}};ea._rebuildPatchGroups=function(){const da=this._rootTiles;if(!n.isNone(da)){da[0]?.surface.checkAllTilesWaterproofness();this._patchGroups.clear();
for(const la of da)this._rebuildPatchGroupsForRootTile(la)}};ea._rebuildPatchGroupsForRootTile=function(da){const la=this._tileIterator;for(la.resetOne(da);!la.done;){da=la.next();const oa=da.renderData;if(oa&&!da.visible)this._numTilesCulled++,la.skipSubtree();else if(!da.rendered)this._numTilesCulled++;else if(oa){const ra=this._patchGroups.get(oa.localOrigin)||[];this._patchGroups.set(oa.localOrigin,ra);ra.push(da);if(!this._highestVisibleLODTile||da.vlevel>this._highestVisibleLODTile.vlevel)this._highestVisibleLODTile=
da;la.skipSubtree()}}};ea._useStencilForTile=function(da){for(const la of this._stencilEnabledLayerExtents)if(da.intersectsExtent(la))return!0;return!1};ea._renderPatchGroupsAuxiliary=function(da,la,oa){const ra=0<this._stencilEnabledLayerExtents.length;this._patchGroups.forEach(Aa=>{la.program.bindDraw(new R.DrawParameters(Aa[0].renderData.localOrigin),da.bindParameters,this._passParameters);for(let ua=0;ua<Aa.length;ua++)this._renderPatch(da,la,Aa[ua],ba.PrimitiveType.TRIANGLES,ra,oa)});da.rctx.bindVAO(null)};
ea._renderPatchGroups=function(da,la,oa){var ra=da.bindParameters.camera;const Aa=la.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&U.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ra.fovY});const ua=0<this._stencilEnabledLayerExtents.length,za=oa===C.OverlaySource.Occluded;za&&(Aa.bindTexture("tex",this._emptyTex),Aa.setUniform1f("blend",1),Aa.setUniform4fv("texOffsetAndScale",
t.ZEROS));ra=n.isSome(this._tileRenderer)&&n.isSome(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:A.ZEROS;this._techniqueConfiguration.tileBlendInput===H.TileBlendInput.ColorComposite&&Aa.setUniform3fv("backgroundColor",ra);const va=this.wireframe?ba.PrimitiveType.LINES:ba.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&Aa.bindTexture("texNext",this._emptyTex);this._patchGroups.forEach(Ja=>{la.program.bindDraw(new R.DrawParameters(Ja[0].renderData.localOrigin),
da.bindParameters,this._passParameters);this._numOriginsRendered++;for(let pa=0;pa<Ja.length;pa++){const Ba=Ja[pa],Ha=Ba.renderData.textureReference;if(!n.isNone(Ha)){if(!za){this._scaleRangeQueries.scaleQueriesForTile(Ba);Aa.setUniform4fv("texOffsetAndScale",Ha.offsetAndScale);Aa.bindTexture("tex",Ha.texture.texture);const wa=Ba.renderData.textureFadeFactor,ya=1>wa?Ba.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&n.isSome(ya)&&1>wa?(Aa.setUniform1f("fadeFactor",
wa),Aa.setUniform4fv("nextTexOffsetAndScale",ya.offsetAndScale),Aa.setUniform3fv("nextTexOpacities",ya.opacities),Aa.bindTexture("texNext",ya.texture.texture)):Aa.setUniform1f("fadeFactor",1);Ba.renderData.textureIsFading&&this.setNeedsRender();Aa.setUniform3fv("textureOpacities",Ha.opacities)}this._renderPatch(da,la,Ba,va,ua,oa);Ba.renderOrder=this._numTilesRendered;this._numTilesRendered++}}});da.rctx.bindVAO(null)};ea._renderPatch=function(da,la,oa,ra,Aa,ua){const za=oa.renderData,va=za.vao,Ja=
va.indexBuffer;if(n.isNone(Ja))F.ENABLE_TERRAIN_INTERNAL_CHECKS&&console.error("Rendered tile with no indices: ",oa.lij," : ",za);else{var pa=la.program;ua!==C.OverlaySource.None&&this._bindOverlayPatchData(pa,za.overlay);Aa&&(la.useStencil=this._useStencilForTile(oa),la.bindPipelineState(da.rctx,da.bindParameters.slot));la=za.geometryInfo.indexCount;da.rctx.bindVAO(va);pa.assertCompatibleVertexAttributeLocations(va);da.rctx.drawElements(ra,la,Ja.indexType,0)}};ea._bindOverlayPatchData=function(da,
la){da.setUniform4fv("overlayTexOffset",la.offsets);da.setUniform4fv("overlayTexScale",la.scales)};ea._updateTechnique=function(da,la){this._techniqueConfiguration.output=da;da===O.ShaderOutput.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground);this._techniqueConfiguration.renderOccluded=la;this._techniqueConfiguration.stencilEnabled=!1;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(W.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};
b._createClass(fa,[{key:"_isGlobal",get:function(){return this._stage.viewingMode===z.ViewingMode.Global}},{key:"shading",get:function(){return this._techniqueConfiguration.shading},set:function(da){this._techniqueConfiguration.shading=da}},{key:"canRender",get:function(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(da){this._set("renderingDisabled",!!da);this.setDirty()}},{key:"transparency",get:function(){return this._transparencyState},
set:function(da){this._transparencyState!==da&&(this._techniqueConfiguration.transparent=da===a.TransparencyMode.Invisible,this._transparencyState=da,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this._overlayRenderer.hasWater}},{key:"renderPatchBorders",get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(da){this._techniqueConfiguration.tileBorders!==da&&(this._techniqueConfiguration.tileBorders=da,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},
{key:"visualizeNormals",get:function(){return!!this._techniqueConfiguration.visualizeNormals},set:function(da){this._techniqueConfiguration.visualizeNormals!==da&&(this._techniqueConfiguration.visualizeNormals=da,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}},{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(da){this._techniqueConfiguration.backfaceCullingEnabled!==da&&(this._techniqueConfiguration.backfaceCullingEnabled=da,
this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(da){this._set("renderOrder",da);this._setSortingDirty()}},{key:"velvetOverground",set:function(da){this._velvetOverground!==da&&(this._velvetOverground=da,this.setNeedsRender())}},{key:"layerUid",get:function(){return V.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(da){this._techniqueConfiguration.hasSlicePlane!==da&&(this._techniqueConfiguration.hasSlicePlane=
da,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(da){this._techniqueConfiguration.textureFadingEnabled!==da&&(this._techniqueConfiguration.textureFadingEnabled=da,this.setNeedsRender())}},{key:"wireframe",set:function(da){this._get("wireframe")!==da&&(this._set("wireframe",da),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this._tileRenderer}}}]);return fa}(m);c.__decorate([g.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_overlayRenderer",
void 0);c.__decorate([g.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_stage",void 0);c.__decorate([g.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);c.__decorate([g.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_allTiles",void 0);c.__decorate([g.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_ellipsoidRadius",void 0);c.__decorate([g.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);c.__decorate([g.property()],
a.TerrainRenderer.prototype,"renderPatchBorders",null);c.__decorate([g.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);c.__decorate([g.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);c.__decorate([g.property({value:v.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);c.__decorate([g.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=c.__decorate([f.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);
const ma=A.create(),ha=A.create(),ka=A.create(),Z=A.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports","../../../core/ObjectPool","../../../core/PooledArray","../../../chunks/vec4","../../../chunks/vec4f64"],function(a,b,c,r,m){let n=function(){this.extent=m.create();this.maxLevel=this.minLevel=0;this.callback=null},p=function(){function g(){this._queries=new c({initialSize:10});
this._queriesInvPtr=0;this._queryQueue=new c({initialSize:30});this._queryPool=new b(n)}var h=g.prototype;h.queryVisibleLevelRange=function(d,f,e,l){const A=this._queryPool.acquire();r.copy(A.extent,d);A.minLevel=f?f:-Number.MAX_VALUE;A.maxLevel=null!=e?e:Number.MAX_VALUE;A.callback=l;this._queryQueue.push(A)};h.hasPendingQueries=function(){return 0!==this._queryQueue.length};h.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const d=this._queryQueue.pop();
this._queries.push(d)}this._queriesInvPtr=this._queries.length};h.processQueries=function(){for(let d=0;d<this._queries.length;d++){const f=this._queries.data[d];this._queryPool.release(f);f.callback(d>=this._queriesInvPtr);f.callback=null}this._queries.clear()};h.scaleQueriesForTile=function(d){const f=d.level;let e=0;for(;e<this._queriesInvPtr;){const l=this._queries.data[e],A=l.extent;f>=l.minLevel&&f<=l.maxLevel&&A[0]<=d.extent[2]&&A[2]>=d.extent[0]&&A[1]<=d.extent[3]&&A[3]>=d.extent[1]?(this._queries.swapElements(e,
this._queriesInvPtr-1),this._queriesInvPtr--):e++}};return g}();a.ScaleRangeQueries=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k){function q(H,E){P.layerIndex=E;const I=H.layerInfo[f.LayerClass.MAP][E];if(r.isSome(I.data))return m.set(P.offset,0,0),P.tile=H,P.scale=1,P.sourceLod=H.lij,P.sourceLayerInfo=I,P;H=I.upsampleInfo;return r.isSome(H)?(E=H.tile.layerInfo[f.LayerClass.MAP][E],P.tile=H.tile,m.copy(P.offset,H.offset),P.scale=H.scale,P.sourceLod=H.tile.lij,P.sourceLayerInfo=E,P):null}function x(H){let E="normal"!==H.blendMode;e.isGroupLayer(H.parent)&&(E=x(H.parent)||
E);return E}function v(H,E){e.isGroupLayer(H.parent)&&v(H.parent,E);const I=H.get("uid");r.isSome(I)&&""!==I&&(K.has(I)?K.get(I).start=E:K.set(I,new D(E,E,H.blendMode,H.opacity)))}let D=function(H,E,I,M){this.start=H;this.end=E;this.blendMode=I;this.opacity=M},F=function(){function H(I,M,Q){this._rctx=I;this.tileSize=M;this._techniqueRepository=Q;this._passParameters=new h.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=null;this._maxAnisotropy=
this._rctx.parameters.maxMaxAnisotropy;this._composition=new t.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new w(B.createColorTexture(this._rctx,[0,0,0,1]));this._ensureBackgroundTexture(this.tileSize)}var E=H.prototype;E.dispose=function(){this._composition=r.disposeMaybe(this._composition);this._backgroundTexture=r.releaseMaybe(this._backgroundTexture);this._blackTex=r.releaseMaybe(this._blackTex)};E.updateTileTexture=function(I,M){if(I.renderData){var Q=I.surface,T=Q.baseOpacity,
S=0,U=0,Y=this.tileSize,V=!1,R=Q.view.state.pixelRatio,X=!1;K.clear();O.length=0;for(var W=I.layerInfo[f.LayerClass.MAP],aa=W.length,ba=0;ba<W.length;ba++){const ha=Q.layerViewByIndex(ba,f.LayerClass.MAP);var ia=ha.layer.opacity;G[ba]=ia;const ka=ha.fullOpacity;J[ba]=ka;p.isBaseLayer(ha.layer)&&aa>=W.length&&(aa=ba);if(e.isBlendableLayerView(ha)){L[ba]=ha.layer.blendMode;var ma="normal"!==ha.layer.blendMode;if(e.isGroupLayer(ha.layer.parent)){const Z=ha.layer.parent.get("uid");r.isSome(Z)&&""!==Z&&
(ma=x(ha.layer.parent)||ma)}ma&&(X=ma,V=!1)}if(0!==ia||X){if(++U,ia=q(I,ba))W[ba].pendingUpdates&=~(u.TileUpdate.TEXTURE_NOFADING&u.TileUpdate.TEXTURE_FADING),e.isGroupLayer(ha.layer.parent)&&(ma=ha.layer.parent.get("uid"),r.isSome(ma)&&""!==ma&&v(ha.layer.parent,ba)),e.isVectorTileLayerView(ha)?Y=Math.max(Y,this.tileSize*R):1===T&&1===ka&&(ha.isOpaque||this._dataToTexture(ia)&&ia.sourceLayerInfo.data.descriptor.isOpaque)&&(V=!0),++S}else W[ba].pendingUpdates&=~(u.TileUpdate.TEXTURE_NOFADING&u.TileUpdate.TEXTURE_FADING)}R=
Y;Y=c.nextHighestPowerOfTwo(R);Q=Y*Y;T=R*R;Q===T?Y=R:(R=Y/2,Y=Q-T<T-R*R?Y:R);Q=Y/this.tileSize;--ba;this._ensureBackgroundTexture(this.tileSize);0===S?this._useBackgroundTexture(I,U):(1!==S||X||!this._useLayerTexture(I,ba,aa,J[ba]))&&this._composeMapLayers(I,M,ba,aa,G,L,Y,Q,!V||X,K,X)}};E._ensureBackgroundTexture=function(I){r.isNone(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(I),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bind(I),this._passParameters.offset=
n.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,r.isSome(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,r.isSome(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)};E._useBackgroundTexture=function(I,M){let Q=l.ActivationTime.Immediate;if(I.surface.view.layerViewManager.updating||0<M)Q=l.ActivationTime.Delayed;
this._backgroundTexture&&r.isNone(I.renderData.textureReference)&&(Q=l.ActivationTime.Immediate);I.renderData.setTextureReference(r.isSome(this._backgroundTexture)?new A.TextureReference(this._backgroundTexture,d.TextureUpdate.FADING,N,I.surface.baseOpacity,0,1):null,Q)};E._useLayerTexture=function(I,M,Q,T){var S=M<Q;Q=S?1:I.surface.baseOpacity;S=S?I.surface.baseOpacity:1;M=q(I,M);return this._dataToTexture(M)?(I.renderData.setTextureReference(new A.TextureReference(M.sourceLayerInfo.data,d.TextureUpdate.FADING,
M,Q,S,T)),!0):!1};E._composeMapLayers=function(I,M,Q,T,S,U,Y,V,R,X,W){this._composition.ensureBuffer(Y);const aa=I.surface.baseOpacity;let ba=!1,ia=C.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ma=!1,ha=0;for(let ca=Q;0<=ca;ca--){var ka=q(I,ca);if(!ka)continue;if(0===S[ca]&&!W)continue;var Z=ca<T&&1>aa&&!ba;this._passParameters.baseOpacity=Z?aa:1;Q=1>this._passParameters.baseOpacity?y.BaseOpacityMode.Required:y.BaseOpacityMode.NotRequired;Z&&(ba=!0);let fa=!1;X.forEach(la=>{la.start===ca&&(O.push(la),
this._composition.openGroup(Y),fa=!0)});Z=0===ha;const ea=fa?y.BlendLayersOutput.GroupBackgroundComposite:R&&Z?this.backgroundIsGrid?y.BlendLayersOutput.GridComposite:y.BlendLayersOutput.ColorComposite:y.BlendLayersOutput.Composite,da=z.blendModeFromString[U[ca]];e.isVectorTileRenderInfo(ka)?(this._passParameters.opacity=S[ca],ma=this._composition.drawVectorData(this._passParameters,ea,Y,da,Q,ka,V,this.tileSize,ma)):e.isImageryTileRenderInfo(ka)?(this._passParameters.opacity=S[ca],this._composition.drawImageryTileData(this._passParameters,
ea,Y,da,Q,ka),this._hasNearestInterpolation(ka)&&(ia=C.TextureSamplingMode.NEAREST)):this._dataToTexture(ka)&&(this._passParameters.texture=ka.sourceLayerInfo.data.texture,this._passParameters.offset=ka.offset,this._passParameters.scale=ka.scale,this._passParameters.opacity=S[ca],this._composition.drawRasterData(this._passParameters,ea,Y,da,Q));for(;0<O.length&&O[O.length-1].end===ca;)ka=O.pop(),this._passParameters.opacity=ka.opacity,this._passParameters.offset=n.ZEROS,this._passParameters.scale=
1,this._composition.drawGroup(this._passParameters,R&&Z?this.backgroundIsGrid?y.BlendLayersOutput.GridComposite:y.BlendLayersOutput.ColorComposite:y.BlendLayersOutput.Composite,Y,z.blendModeFromString[ka.blendMode],Q);ha++}T=I.renderData.ensureTexture(Y,()=>this._buildTexture(Y,ia));this._composition.copyFBOToTexture(T);this._composition.unbind();I.renderData.setTextureReference(new A.TextureReference(T,M,N,ba?1:aa,0,1))};E._hasNearestInterpolation=function(I){I=I.sourceLayerInfo.data;return I.source?
"nearest"===I.interpolation:!1};E._dataToTexture=function(I){if(e.isRasterTileRenderInfo(I)){const M=I.sourceLayerInfo;M.data=this._buildTexture(M.data);I.tile.setMemoryDirty()}return e.isTextureTileRenderInfo(I)};E.setBackground=function(I){this._backgroundColor!==I&&(this._backgroundColor=I,this._backgroundDirty=!0)};E._buildTexture=function(I,M=C.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(r.isNone(I))return null;const Q={target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,dataType:C.PixelType.UNSIGNED_BYTE,
wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:M,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};M=this._rctx;let T;if("number"===typeof I)Q.width=Q.height=I,T=new w(new k.Texture(M,Q));else if(I instanceof g.ImageWithType)Q.isOpaque=I.isOpaque,T=new w(new k.Texture(M,Q,I.image)),I.release();else try{Q.width=I.width,Q.height=I.height,T=new w(new k.Texture(M,Q,I))}catch(S){T=new w(B.createEmptyTexture(M)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}I=
M.bindTexture(T.texture,k.Texture.TEXTURE_UNIT_FOR_UPDATES);T.generateMipmap();M.bindTexture(I,k.Texture.TEXTURE_UNIT_FOR_UPDATES);return T};b._createClass(H,[{key:"backgroundIsGrid",get:function(){return r.isNone(this._backgroundColor)}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return H}();const G=[],J=[],L=[],K=new Map,O=[],P={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,
layerIndex:0},N={offset:[0,0],scale:1};a.GroupInfo=D;a.TileRenderer=F;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/context-util ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){p=function(u){function z(){var y=u.apply(this,arguments)||this;y.opacity=1;y.baseOpacity=1;y.texture=null;y.fboTexture=null;y.backgroundColor=m.ZEROS;return y}c._inheritsLoose(z,u);return z}(p.TileCompositePassParameters);d=function(u){function z(){return u.apply(this,arguments)||this}c._inheritsLoose(z,u);var y=z.prototype;y.initializeConfiguration=function(B,C){C.hasWebGL2Context=B.rctx.type===A.ContextType.WEBGL2};y.initializeProgram=function(B){return new l.Program(B.rctx,
z.shader.get().build(this.configuration),e.Default3D)};y.initializePipeline=function(){return w.makePipelineState({blending:w.simpleBlendingParams(t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:w.defaultColorWriteParams})};return z}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(g.BlendLayers,()=>new Promise((u,z)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],u,z)));n=function(u){function z(){var y=u.apply(this,arguments)||this;y.background=g.BackgroundMode.BelowLayer;
return y}c._inheritsLoose(z,u);return z}(n.TileBlendTechniqueConfiguration);r.__decorate([f.parameter()],n.prototype,"background",void 0);b.BlendLayersPassParameters=p;b.BlendLayersTechnique=d;b.BlendLayersTechniqueConfiguration=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n){r=function(p){function g(){var h=p.apply(this,arguments)||this;h.output=m.BlendLayersOutput.Composite;h.baseOpacityMode=m.BaseOpacityMode.NotRequired;h.premultipliedSource=m.PremultipliedAlphaSource.Off;h.hasWebGL2Context=!1;return h}b._inheritsLoose(g,p);return g}(r.BlendModeTechniqueConfiguration);c.__decorate([n.parameter({count:m.BlendLayersOutput.COUNT})],r.prototype,"output",void 0);c.__decorate([n.parameter({count:m.BaseOpacityMode.COUNT})],r.prototype,"baseOpacityMode",
void 0);c.__decorate([n.parameter()],r.prototype,"premultipliedSource",void 0);c.__decorate([n.parameter()],r.prototype,"hasWebGL2Context",void 0);a.TileBlendTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,c,r,m){let n=function(p){function g(){var h=p.apply(this,arguments)||this;h.blendMode=r.LayerBlendMode.Normal;return h}b._inheritsLoose(g,p);return g}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:r.LayerBlendMode.COUNT})],n.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(e){const l=new g.ShaderBuilder;l.include(r.TileComposite);if(e.background===a.BackgroundMode.Only)return(e=e.output===c.BlendLayersOutput.ColorComposite)?l.fragment.uniforms.add(new m.Float3PassUniform("backgroundColor",A=>A.backgroundColor)):(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.include(b.BackgroundGrid)),l.fragment.code.add(p.glsl`
    void main() {
      gl_FragColor = ${e?p.glsl`vec4(backgroundColor, 1.0)`:p.glsl`gridColor(uv)`};
    }
  `),l;l.include(c.TileBackground,e);l.fragment.uniforms.add(new h.Texture2DPassUniform("tex",A=>A.texture));l.fragment.uniforms.add(new n.FloatPassUniform("opacity",A=>A.opacity));l.fragment.code.add(p.glsl`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`);return l}a.BackgroundMode=void 0;(function(e){e[e.BelowLayer=0]="BelowLayer";e[e.Only=1]="Only";e[e.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const f=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:d},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=f;a.build=d})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,c){let r=function(){function m(n,
p,g,h,d,f){this.texture=n;this.type=p;n.retain();this.offsetAndScale=c.fromValues(g.offset[0],g.offset[1],g.scale,g.scale);this.opacities=b.fromValues(h,d,f)}m.prototype.destroy=function(){this.texture.release()};return m}();a.TextureReference=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){const B=b.getLogger("esri.views.3d.terrain");b=function(){function C(q,x){this._rctx=q;this._techniqueRepository=x;this._fbos=[];this._vectorTileHelper=new n.VectorTileRendererHelper3D;this._bindParameters=new A.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new p.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=w.createQuadVAO(this._rctx,t.Pos2Tex)}var k=
C.prototype;k.dispose=function(){this._fbos.forEach(q=>{q.dispose();q=null});this._fbos=null;this._vtFBO=c.disposeMaybe(this._vtFBO);this._vaoQuad=c.disposeMaybe(this._vaoQuad);this._vectorTileHelper=c.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=c.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=c.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=c.releaseMaybe(this._blendLayersTechnique)};k._getBlendLayersTechnique=function(q,x,v,D=e.PremultipliedAlphaSource.Off,
F=l.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=x;this._blendLayersTechniqueConfig.blendMode=q;this._blendLayersTechniqueConfig.baseOpacityMode=v;this._blendLayersTechniqueConfig.premultipliedSource=D;this._blendLayersTechniqueConfig.background=F;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(p.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};k.drawBackground=function(q,x){x=this._getBlendLayersTechnique(f.LayerBlendMode.Normal,
x?e.BlendLayersOutput.ColorComposite:e.BlendLayersOutput.GridComposite,e.BaseOpacityMode.NotRequired,e.PremultipliedAlphaSource.Off,l.BackgroundMode.Only);q=this._rctx.bindTechnique(x,q,this._bindParameters);this._render(q)};k._render=function(q){this._rctx.bindVAO(this._vaoQuad);q.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,y.vertexCount(this._vaoQuad,"geometry"))};k.drawGroup=function(q,x,v,D,F,G=e.PremultipliedAlphaSource.On){x===
e.BlendLayersOutput.Composite&&(q.fboTexture=this._fbos[this.getLastOnHoldId()].get(v).colorTexture);q.texture=this.currentFBO(v).colorTexture;this.closeGroup(v);x=this._getBlendLayersTechnique(D,x,F,G);q=this._rctx.bindTechnique(x,q,this._bindParameters);this._render(q)};k.drawRasterData=function(q,x,v,D,F,G=e.PremultipliedAlphaSource.Off){c.isNone(q.texture)||(q.fboTexture=x===e.BlendLayersOutput.GroupBackgroundComposite||D===f.LayerBlendMode.Normal&&F===e.BaseOpacityMode.NotRequired&&G===e.PremultipliedAlphaSource.Off?
null:this.switch(v).colorTexture,x=this._getBlendLayersTechnique(D,x,F,G),q=this._rctx.bindTechnique(x,q,this._bindParameters),this._render(q))};k.drawImageryTileData=function(q,x,v,D,F,G){var J=G.sourceLayerInfo.data;J.source&&(G.tile.surface.layerViewByIndex(G.layerIndex,g.LayerClass.MAP).ensureSymbolizerParameters(J),J.bind(this._rctx)&&(q.fboTexture=D===f.LayerBlendMode.Normal&&F===e.BaseOpacityMode.NotRequired?null:this.switch(v).colorTexture,x=this._getRasterColorizerTechnique(J,x,D,F),J.opacity=
q.opacity,J=J.getUniforms(),J.scale=G.scale,J.offset=G.offset,J.backgroundColor=q.backgroundColor,J.fboTexture=q.fboTexture,J.baseOpacity=q.baseOpacity,q=this._rctx.bindTechnique(x,J,null),this._render(q)))};k._getRasterColorizerTechnique=function(q,x,v,D){const F=q.symbolizerParameters,G=["stretch","lut","hillshade"].indexOf(F.type);c.isNone(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new h.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=x;this._rasterColorizerConfig.blendMode=v;this._rasterColorizerConfig.baseOpacityMode=D;this._rasterColorizerConfig.colorizerType=G;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.stretchType=q.hasStretchTypeNone()?m.RasterColorizerStretchType.Noop:m.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(h.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};k.drawVectorData=function(q,x,v,D,F,G,J,L,K){const O=this._rctx,P=G.sourceLayerInfo.data,N=G.tile.surface.layerViewByIndex(G.layerIndex,g.LayerClass.MAP),H=F===e.BaseOpacityMode.Required||1>q.opacity||D!==f.LayerBlendMode.Normal||x!==e.BlendLayersOutput.Composite,E=H?e.PremultipliedAlphaSource.On:e.PremultipliedAlphaSource.Off;this._getBlendLayersTechnique(D,x,F,E).bindPipelineState(O);let I=null,M=null;H?(M=this.currentFBO(v),c.isNone(this._vtFBO)&&
(this._vtFBO=new d.MultiSizeFramebuffer(this._rctx)),I=this._vtFBO.get(v),O.bindFramebuffer(I),this._clearCurrentFBO()):K&&O.clearSafe(u.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(O,G.sourceLod,P,N.painter,N.layer.styleRepository,N.schemaHelper,Math.round(1/G.scale),G.offset,L,J)}catch(Q){B.warnOnce("A render call containing vector tiles did not resolve correctly.",Q)}return c.isSome(I)?(O.bindFramebuffer(M),q.texture=I.colorTexture,q.offset=r.ZEROS,q.scale=1,this.drawRasterData(q,
x,v,D,F,E),K):!0};k.copyFBOToTexture=function(q){const x=this._rctx,v=x.bindTexture(q.texture,z.Texture.TEXTURE_UNIT_FOR_UPDATES),D=q.descriptor;x.gl.copyTexImage2D(u.TextureType.TEXTURE_2D,0,D.pixelFormat,0,0,D.width,D.height,0);q.generateMipmap();x.bindTexture(v,z.Texture.TEXTURE_UNIT_FOR_UPDATES)};k._clearCurrentFBO=function(){this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.clearSafe(u.ClearBufferBit.COLOR_BUFFER_BIT|u.ClearBufferBit.DEPTH_BUFFER_BIT)};k._initFBO=function(q,
x,v){this._rctx.bindFramebuffer(q);v&&(this._rctx.setViewport(0,0,x,x),this._clearCurrentFBO())};k.ensureBuffer=function(q){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(q)};k.bind=function(q,x=0,v=!0){this._current=x;if(x>=this._fbos.length)for(let D=this._fbos.length;D<=x;D++)this._fbos.push(new d.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[x].get(q),q,v)};k._bindNextFreeBuffer=function(q){0<this._lastUsedIds.length?
this.bind(q,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(q,this._lastCreatedBufferId))};k.openGroup=function(q){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(q)};k.switch=function(q){const x=this.currentFBO(q),v=this._current;this._bindNextFreeBuffer(q);this._lastUsedIds.push(v);return x};k.getLastOnHoldId=function(){return this._onHoldIds[this._onHoldIds.length-1]};k.closeGroup=function(q){const x=this._current;this._bindNextFreeBuffer(q);this._lastUsedIds.push(x);
this._lastUsedIds.push(this._onHoldIds.pop())};k.unbind=function(){this._rctx.bindFramebuffer(null)};k.currentFBO=function(q){return this._fbos[this._current].get(q)};return C}();a.TileCompositor=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry","../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,b,c,r,m){b=function(){function n(){this._renderParams=
{context:null,drawPhase:1,state:new r({viewpoint:new c({targetGeometry:new m(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}
var p=n.prototype;p.dispose=function(){this._renderParams=null};p.render=function(g,h,d,f,e,l,A,t,w,u){const z=l.adjustLevel(h[0]),y=this._renderParams;y.context=g;y.painter=f;y.glyphMosaic=f.glyphMosaic;y.spriteMosaic=f.spriteMosaic;y.pixelRatio=u;y.displayLevel=z;y.requiredLevel=z;u=l.getScale(h[0]);const [B,C]=l.getShift(h,A*u);h=.125*A*u/w;l=d.transforms.dvs;l[0]=h;l[4]=-h;l[6]=-1-B-t[0]*A*2;l[7]=1+C+(1-t[1])*A*2-2;y.state.size[0]=w;y.state.size[1]=w;d.stage||d.attachWithContext(g);d.triangleCount=
0;f.drawTile(y,d,e)};return n}();a.VectorTileRendererHelper3D=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k){var q;const x=[0,0];c=q=function(v){function D(G){G=v.call(this,G)||this;G._viewpoint2D={center:z.create(),rotation:0,scale:0,spatialReference:null};G.center=[0,0];G.extent=new C;G.id=0;G.inverseTransform=l.create();G.resolution=0;G.rotation=0;G.scale=0;G.transform=l.create();G.transformNoRotation=l.create();G.displayMat3=t.create();G.displayViewMat3=t.create();G.viewMat3=t.create();G.viewMat2d=e.create();G.worldScreenWidth=0;G.size=[0,0];return G}
a._inheritsLoose(D,v);var F=D.prototype;F.copy=function(G){const J=this.size,L=this.viewpoint;L&&J?(this.viewpoint=B.copy(L,G.viewpoint),this._set("size",w.copy(J,G.size))):(this.viewpoint=G.viewpoint.clone(),this._set("size",[G.size[0],G.size[1]]));this._set("pixelRatio",G.pixelRatio);return this};F.clone=function(){return new q({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(G,J,L){if(y.isVec2(J))return w.transformMat2d(G,J,this.inverseTransform);
x[0]=J;x[1]=L;return w.transformMat2d(G,x,this.inverseTransform)};F.toScreen=function(G,J,L){if(y.isVec2(J))return w.transformMat2d(G,J,this.transform);x[0]=J;x[1]=L;return w.transformMat2d(G,x,this.transform)};F.toScreenNoRotation=function(G,J,L){if(y.isVec2(J))return w.transformMat2d(G,J,this.transformNoRotation);x[0]=J;x[1]=L;return w.transformMat2d(G,x,this.transformNoRotation)};F.getScreenTransform=function(G,J){const {center:L}=this._viewpoint2D,K=this._get("pixelRatio")||1,O=this._get("size");
B.getMatrix(G,L,O,J,0,K);return G};F._update=function(){const {center:G,spatialReference:J,scale:L,rotation:K}=this._viewpoint2D,O=this._get("pixelRatio")||1,P=this._get("size"),N=new r({targetGeometry:new k(G[0],G[1],J),scale:L,rotation:K});this._set("viewpoint",N);if(P&&J&&L){this.resolution=B.getResolution(N);this.rotation=K;this.scale=L;this.spatialReference=J;w.copy(this.center,G);A.set(this.displayMat3,0!==P[0]?2/P[0]:0,0,0,0,0!==P[1]?-2/P[1]:0,0,-1,1,1);var H=A.identity(this.viewMat3),E=u.fromValues(P[0]/
2,P[1]/2),I=u.fromValues(-P[0]/2,-P[1]/2),M=d.toRadian(K);A.translate(H,H,E);A.rotate(H,H,M);A.translate(H,H,I);A.multiply(this.displayViewMat3,this.displayMat3,H);H=f.fromTranslation(this.viewMat2d,E);f.rotate(H,H,M);f.translate(H,H,I);B.getExtent(this.extent,N,P);B.getTransform(this.transform,N,P,O);f.invert(this.inverseTransform,this.transform);B.getTransformNoRotation(this.transformNoRotation,N,P,O);this.worldScreenWidth=B.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(D,[{key:"pixelRatio",set:function(G){this._set("pixelRatio",G);this._update()}},{key:"size",set:function(G){this._set("size",G);this._update()}},{key:"viewpoint",set:function(G){if(G){const J=this._viewpoint2D,L=G.targetGeometry;J.center[0]=L.x;J.center[1]=L.y;J.rotation=G.rotation;J.scale=G.scale;J.spatialReference=L.spatialReference}this._update()}}]);return D}(m.JSONSupport);b.__decorate([n.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([n.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([n.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([n.property()],c.prototype,"spatialReference",void 0);b.__decorate([n.property({type:r,json:{write:!0}})],c.prototype,"viewpoint",null);return c=q=b.__decorate([h.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(p){return[p[0],p[1],p[2],p[3],p[4],p[5]]}function r(p,
g,h,d,f,e){return[p,g,h,d,f,e]}function m(p,g){return new Float64Array(p,g,6)}const n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:r,createView:m},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.mat2df64=n})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(r){return r instanceof Float32Array&&2<=r.length}function c(r){return Array.isArray(r)&&2<=r.length}a.isVec2=function(r){return b(r)||
c(r)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(W,aa){return aa.type?d.set(W,aa.x,aa.y):d.copy(W,aa)}function y(W,aa){return Math.max(W.width/Math.max(1,aa[0]),W.height/Math.max(1,aa[1]))*G(W.spatialReference)}function B(W,aa,ba,ia){return C.apply(this,arguments)}function C(){C=b._asyncToGenerator(function*(W,aa,ba,ia){if(!W||Array.isArray(W)&&!W.length)return null;r.isCollection(W)&&(W=W.toArray());if(Array.isArray(W)&&W.length&&"object"===typeof W[0]){var ma=W.every(ea=>"attributes"in ea);
var ha=W.some(ea=>!ea.geometry),ka=W;if(ma&&ha&&aa&&aa.allLayerViews){ma=new Map;for(var Z of W)W=Z.layer,ha=ma.get(W)||[],ka=Z.attributes[W.objectIdField],null!=ka&&ha.push(ka),ma.set(W,ha);const ea=[];ma.forEach((da,la)=>{const oa=aa.allLayerViews.find(ra=>ra.layer.id===la.id);if("queryFeatures"in oa){const ra=la.createQuery();ra.objectIds=da;ra.returnGeometry=!0;ea.push(oa.queryFeatures(ra))}});Z=yield Promise.all(ea);W=[];for(var ca of Z)if(ca&&ca.features&&ca.features.length)for(var fa of ca.features)m.isSome(fa.geometry)&&
W.push(fa.geometry);ka=W}for(const ea of ka)ia=yield B(ea,aa,ba,ia);return ia}if(Array.isArray(W)&&2===W.length&&"number"===typeof W[0]&&"number"===typeof W[1])ma=new A(W);else if(W instanceof l)ma=W;else if("geometry"in W)if(W.geometry)ma=W.geometry;else if(W.layer){const ea=W.layer;ca=aa.allLayerViews.find(da=>da.layer.id===ea.id);"queryFeatures"in ca&&(fa=ea.createQuery(),fa.objectIds=[W.attributes[ea.objectIdField]],fa.returnGeometry=!0,ca=yield ca.queryFeatures(fa),ma=m.get(ca,"features",0,"geometry"))}if(m.isNone(ma))return null;
ca="point"===ma.type?new e({xmin:ma.x,ymin:ma.y,xmax:ma.x,ymax:ma.y,spatialReference:ma.spatialReference}):ma.extent;if(!ca)return null;t.isLoaded()||t.canProjectWithoutEngine(ca.spatialReference,ba)||(yield t.load());ba=t.project(ca,ba);return ba?ia=ia?ia.union(ba):ba:null});return C.apply(this,arguments)}function k(W){if(W&&(!Array.isArray(W)||"number"!==typeof W[0])&&("object"===typeof W||Array.isArray(W)&&"object"===typeof W[0])){if("layer"in W&&W.layer&&W.layer.minScale&&W.layer.maxScale){var aa=
W.layer;return{min:aa.minScale,max:aa.maxScale}}if(Array.isArray(W)&&W.length&&W.every(ba=>"layer"in ba)){let ba=aa=0;for(const ia of W)(W=ia.layer)&&W.minScale&&W.maxScale&&(aa=W.minScale<aa?W.minScale:aa,ba=W.maxScale>ba?W.maxScale:ba);return aa&&ba?{min:aa,max:ba}:null}}}function q(W,aa){return u.equals(W.wkid?W:W.spatialReference||w.WGS84,aa)?W:t.project(W,aa)}function x(){x=b._asyncToGenerator(function*(W,aa){if(!W||!aa)return new c({targetGeometry:new A,scale:0,rotation:0});let ba=aa.spatialReference;
const {constraints:ia,padding:ma,viewpoint:ha,size:ka}=aa,Z=[ma?ka[0]-ma.left-ma.right:ka[0],ma?ka[1]-ma.top-ma.bottom:ka[1]];let ca=null;W instanceof c?ca=W:W.viewpoint?ca=W.viewpoint:W.target&&"esri.Viewpoint"===W.target.declaredClass&&(ca=W.target);let fa=null;if(ca&&ca.targetGeometry)fa=ca.targetGeometry;else if(W instanceof e)fa=W;else if(W||W&&("center"in W||"extent"in W||"target"in W))fa=(yield B(W.center,aa,ba))||(yield B(W.extent,aa,ba))||(yield B(W.target,aa,ba))||(yield B(W,aa,ba));!fa&&
ha&&ha.targetGeometry?fa=ha.targetGeometry:!fa&&aa.extent&&(fa=aa.extent);if(!ba){var ea=aa.spatialReference||aa.extent||fa;ba=ea.wkid?ea:ea.spatialReference||w.WGS84}t.isLoaded()||u.equals(fa.spatialReference,ba)||t.canProjectWithoutEngine(fa,ba)||(yield t.load());ea=q(fa.center?fa.center:fa,ba);var da=null;ca&&m.isSome(ca.targetGeometry)&&"point"===ca.targetGeometry.type?da=ca.scale:"scale"in W&&W.scale?da=W.scale:"zoom"in W&&-1!==W.zoom&&ia&&ia.effectiveLODs?da=ia.zoomToScale(W.zoom):Array.isArray(fa)||
"point"===fa.type||"extent"===fa.type&&0===fa.width&&0===fa.height?(da=q(aa.extent,ba),da=m.isSome(da)?y(da,Z):aa.extent?y(aa.extent,Z):ha.scale):da=y(q(fa.extent,ba),Z);if(aa=k(W))aa.min&&aa.min>da?da=aa.min:aa.max&&aa.max<da&&(da=aa.max);aa=0;ca?aa=ca.rotation:W.hasOwnProperty("rotation")?aa=W.rotation:ha&&(aa=ha.rotation);W=new c({targetGeometry:ea,scale:da,rotation:aa});ia&&(W=ia.fit(W),ia.constrainByGeometry(W),ia.rotationEnabled||(W.rotation=aa));return W});return x.apply(this,arguments)}function v(W,
aa){const ba=W.targetGeometry,ia=aa.targetGeometry;ba.x=ia.x;ba.y=ia.y;ba.spatialReference=ia.spatialReference;W.scale=aa.scale;W.rotation=aa.rotation;return W}function D(W,aa,ba){return ba?d.set(W,.5*(aa[0]-ba.right+ba.left),.5*(aa[1]-ba.bottom+ba.top)):d.scale(W,aa,.5)}function F(W){var aa=W.scale;W=W.targetGeometry;W=m.isSome(W)&&u.isValid(W.spatialReference)?1/(39.37*n.getMetersPerUnitForSR(W.spatialReference)*96):1;return aa*W}function G(W){return u.isValid(W)?39.37*n.getMetersPerUnitForSR(W)*
96:1}function J(W){return(W=u.getInfo(W))?W.valid[1]-W.valid[0]:0}const L=180/Math.PI,K=function(){const W=f.create();return function(aa,ba,ia){const ma=ba.targetGeometry;z(W,ma);ba=.5*F(ba);aa.xmin=W[0]-ba*ia[0];aa.ymin=W[1]-ba*ia[1];aa.xmax=W[0]+ba*ia[0];aa.ymax=W[1]+ba*ia[1];aa.spatialReference=ma.spatialReference;return aa}}(),O=function(){const W=f.create();return function(aa,ba,ia){return d.sub(aa,d.scale(aa,ba,.5),D(W,ba,ia))}}(),P=function(){const W=h.create(),aa=f.create();return function(ba,
ia,ma,ha){const ka=F(ia);ia=p.toRadian(ia.rotation)||0;d.set(aa,ka,ka);g.fromScaling(W,aa);g.rotate(W,W,ia);g.translate(W,W,O(aa,ma,ha));g.translate(W,W,[0,ha.top-ha.bottom]);return d.set(ba,W[4],W[5])}}(),N=function(){const W=f.create(),aa=f.create(),ba=f.create();return function(ia,ma,ha,ka,Z,ca){d.negate(W,ma);d.scale(aa,ha,.5*ca);d.set(ba,1/ka*ca,-1/ka*ca);g.fromTranslation(ia,aa);Z&&g.rotate(ia,ia,Z);g.scale(ia,ia,ba);g.translate(ia,ia,W);return ia}}(),H=function(){const W=f.create();return function(aa,
ba,ia,ma){const ha=F(ba),ka=p.toRadian(ba.rotation)||0;z(W,ba.targetGeometry);return N(aa,W,ia,ha,ka,ma)}}(),E=function(){const W=f.create();return function(aa,ba,ia,ma){const ha=F(ba);z(W,ba.targetGeometry);return N(aa,W,ia,ha,0,ma)}}(),I=function(){const W=f.create(),aa=f.create(),ba=[0,0,0];return function(ia,ma,ha){d.subtract(W,ia,ma);d.normalize(W,W);d.subtract(aa,ia,ha);d.normalize(aa,aa);d.cross(ba,W,aa);ia=Math.acos(d.dot(W,aa)/(d.length(W)*d.length(aa)))*L;0>ba[2]&&(ia=-ia);isNaN(ia)&&(ia=
0);return ia}}(),M=function(){const W=f.create();return function(aa,ba,ia,ma){const ha=aa.targetGeometry;v(aa,ba);P(W,ba,ia,ma);ha.x+=W[0];ha.y+=W[1];return aa}}(),Q=function(){return function(W,aa,ba){v(W,aa);aa=W.targetGeometry;aa.x=ba.x;aa.y=ba.y;aa.spatialReference=ba.spatialReference;return W}}(),T=function(){const W=f.create();return function(aa,ba,ia,ma,ha){ha||(ha="center");d.sub(W,ia,ma);d.scale(W,W,.5);ia=W[0];ma=W[1];switch(ha){case "center":d.set(W,0,0);break;case "left":d.set(W,-ia,0);
break;case "top":d.set(W,0,ma);break;case "right":d.set(W,ia,0);break;case "bottom":d.set(W,0,-ma);break;case "top-left":d.set(W,-ia,ma);break;case "bottom-left":d.set(W,-ia,-ma);break;case "top-right":d.set(W,ia,ma);break;case "bottom-right":d.set(W,ia,-ma)}X(aa,ba,W);return aa}}(),S=function(){const W=f.create();return function(aa,ba,ia,ma,ha){v(aa,ba);isNaN(ia)||0===ia||(V(W,ma,ba,ha),aa.scale=ba.scale*ia,R(W,W,aa,ha),X(aa,aa,d.set(W,W[0]-ma[0],ma[1]-W[1])));return aa}}(),U=function(){const W=
f.create();return function(aa,ba,ia,ma,ha,ka){v(aa,ba);isNaN(ia)||0===ia||(V(W,ha,ba,ka),aa.scale=ba.scale*ia,aa.rotation+=ma,R(W,W,aa,ka),X(aa,aa,d.set(W,W[0]-ha[0],ha[1]-W[1])));return aa}}(),Y=function(){const W=f.create(),aa=f.create();return function(ba,ia,ma,ha,ka,Z,ca){O(aa,Z,ca);d.add(W,ka,aa);return ha?U(ba,ia,ma,ha,W,Z):S(ba,ia,ma,W,Z)}}(),V=function(){const W=h.create();return function(aa,ba,ia,ma){var ha=d.transformMat2d;H(W,ia,ma,1);ia=g.invert(W,W);return ha.call(d,aa,ba,ia)}}(),R=function(){const W=
h.create();return function(aa,ba,ia,ma){return d.transformMat2d(aa,ba,H(W,ia,ma,1))}}(),X=function(){const W=f.create(),aa=h.create();return function(ba,ia,ma){v(ba,ia);const ha=F(ia),ka=ba.targetGeometry;g.fromRotation(aa,p.toRadian(ia.rotation)||0);g.scale(aa,aa,f.fromValues(ha,ha));d.transformMat2d(W,ma,aa);ka.x+=W[0];ka.y+=W[1];return ba}}();a.addPadding=M;a.angleBetween=I;a.centerAt=Q;a.copy=v;a.create=function(W,aa){return x.apply(this,arguments)};a.extentToScale=y;a.getAnchor=D;a.getExtent=
K;a.getMatrix=N;a.getPaddingMapTranslation=P;a.getPaddingScreenTranslation=O;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=H;a.getTransformNoRotation=E;a.getWorldScreenWidth=function(W,aa){return Math.round(J(W)/aa)};a.getWorldWidth=J;a.padAndScaleAndRotateBy=Y;a.resize=T;a.rotateBy=function(W,aa,ba){v(W,aa);W.rotation+=ba;return W};a.rotateTo=function(W,aa,ba){v(W,aa);W.rotation=ba;return W};a.scaleAndRotateBy=U;a.scaleTo=function(W,aa,ba){v(W,aa);W.scale=ba;return W};a.setExtent=
function(W,aa,ba,ia,ma){Q(W,aa,ba.center);W.scale=y(ba,ia);ma&&ma.constraints&&ma.constraints.constrain(W);return W};a.toMap=V;a.toScreen=R;a.translateBy=X;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/context-util ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){h=function(w){function u(){return w.apply(this,arguments)||this}c._inheritsLoose(u,w);var z=u.prototype;z.initializeConfiguration=function(y,B){B.hasWebGL2Context=y.rctx.type===l.ContextType.WEBGL2};z.initializeProgram=function(y){return new e.Program(y.rctx,u.shader.get().build(this.configuration),f.Default3D)};z.initializePipeline=function(){return t.makePipelineState({blending:t.simpleBlendingParams(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:t.defaultColorWriteParams})};
return u}(h.ShaderTechnique);h.shader=new g.ReloadableShaderModule(p.RasterColorizer,()=>new Promise((w,u)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],w,u)));n=function(w){function u(){var z=w.apply(this,arguments)||this;z.colorizerType=m.RasterColorizerType.Stretch;z.stretchType=m.RasterColorizerStretchType.Noop;z.applyColormap=!0;return z}c._inheritsLoose(u,w);return u}(n.TileBlendTechniqueConfiguration);r.__decorate([d.parameter({count:m.RasterColorizerType.COUNT})],n.prototype,
"colorizerType",void 0);r.__decorate([d.parameter({count:m.RasterColorizerStretchType.COUNT})],n.prototype,"stretchType",void 0);r.__decorate([d.parameter()],n.prototype,"applyColormap",void 0);b.RasterColorizerTechnique=h;b.RasterColorizerTechniqueConfiguration=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,
b,c){let r=function(){function m(p){this._rctx=p;this._fbos=new Map}var n=m.prototype;n.get=function(p){return this._getPool(p)};n.dispose=function(){this._fbos.forEach(p=>p.dispose());this._fbos.clear()};n._getPool=function(p){var g=this._fbos.get(p);if(g)return g;g=new c.FramebufferObject(this._rctx,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:p,height:p});this._fbos.set(p,g);return g};return m}();a.MultiSizeFramebuffer=r;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,b,c,r,m,n){function p(z,y,B){let C=0,k=Infinity;for(let x=0;3>x;++x){var q=z[x];if(y[x]<q){if(1E-6>=B[x])return!1;C=
Math.max(C,(q-y[x])/B[x])}else-1E-6>=B[x]&&(k=Math.min(k,(q-y[x])/B[x]));if(C>k)return!1;q=z[x+3];if(y[x]>q){if(-1E-6<=B[x])return!1;C=Math.max(C,(q-y[x])/B[x])}else 1E-6<=B[x]&&(k=Math.min(k,(q-y[x])/B[x]));if(C>k)return!1}return!0}function g(z,y,B,C,k,q){let x=C;for(;B<x;){var v=z[B];y[6*v+k+3]<=q?++B:(--x,z[B]=z[x],z[x]=v)}v=B;for(x=C;v<x;)C=z[x-1],y[6*C+k]>=q?--x:(z[x-1]=z[v],z[v]=C,++v);return{next:B,mid:v}}function h(z,y,B,C){if(C<=B)return m.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var k=6*z[B];
for(var q=0;3>q;++q)w[q]=y[k+0+q],u[q]=y[k+3+q];for(B+=1;B<C;++B)for(k=6*z[B],q=0;3>q;++q)w[q]=Math.min(w[q],y[k+0+q]),u[q]=Math.max(u[q],y[k+3+q]);return m.fromValues(w[0],w[1],w[2],u[0],u[1],u[2])}function d(z){var y=z[3]-z[0];const B=z[4]-z[1],C=z[5]-z[2];y=y>B?y>C?0:B>C?1:2:B>C?1:C>y?2:0;return{axis:y,midValue:(z[y]+z[y+3])/2}}function f(z,y,B,C,k){B-=y;const q=new Float32Array(6*B);for(let v=0;v<B;++v){var x=3*(v+y);const D=z[x+0]*k,F=z[x+1]*k;x=z[x+2]*k;for(let G=0;3>G;++G){const J=C[D+G],L=
C[F+G],K=C[x+G];q[6*v+G]=Math.min(J,L,K);q[6*v+3+G]=Math.max(J,L,K)}}return q}function e(z,y,B,C){const k=C-B;var q=0;for(var x=B;x<C;++x)for(var v=0;3>v;++v)q=Math.max(y[3*x+v],q);C=65535>=q?new Uint16Array(3*k):new Uint32Array(3*k);for(q=0;q<k;++q)for(x=3*(z[q]+B),v=0;3>v;++v)C[3*q+v]=y[x+v];return C}let l=function(z,y,B,C,k){this.aabb=z;this.axis=y;this.d=B;this.midStartIndex=C;this.rightStartIndex=k},A=function(){function z(B,C,k,q){this.globalTriangleVertexIndices=B;this.firstTriangleIndex=C;
this.positionAttribute=q;this._rayDirection=r.create();this.bspNodeTree=[];this.vertexPositionBuffer=q.data;this.vertexPositionStride=q.stride;const x=k-C,v=65535>=x?new Uint16Array(x):new Uint32Array(x);this.indices=v;for(let J=0;J<x;++J)v[J]=J;const D=f(B,C,k,q.data,q.stride),F=c.clamp(Math.log2(x/40),2,10),G=(J,L,K)=>{var O=h(v,D,J,L);const P=L-J;if(40>=P)return J=new l(O,void 0,0,J,L),this.bspNodeTree.push(J),J;const {axis:N,midValue:H}=d(O),E=g(v,D,J,L,N,H),I=(M,Q)=>{if(!(K>F)){var T=Q-M;if(!(40>
T||T>=.8*P))return G(M,Q,K+1)}};O=new l(O,N,H,E.next,E.mid);this.bspNodeTree.push(O);O.leftNode=I(J,E.next);O.rightNode=I(E.mid,L);return O};G(0,x,0);this.triangleVertexIndices=e(v,B,C,k)}var y=z.prototype;y.intersectRayTriangleRange=function(B,C){if(!(B>=C)){var k=this.triangleVertexIndices,q=this.positionAttribute.data,x=this.positionAttribute.stride,v=this._rayOrigin,D=v[0],F=v[1];v=v[2];var G=this._rayDirection,J=G[0],L=G[1];G=G[2];for(let Y=B,V=3*B;Y<C;++Y){var K=k[V++]*x,O=q[K++],P=q[K++],N=
q[K];K=k[V++]*x;var H=q[K++],E=q[K++],I=q[K];K=k[V++]*x;var M=q[K++],Q=q[K++];H-=O;E-=P;I-=N;M-=O;Q-=P;K=q[K]-N;var T=L*K-Q*G,S=G*M-K*J;const R=J*Q-M*L;var U=H*T+E*S+I*R;if(!(Math.abs(U)<=Number.EPSILON)){O=D-O;P=F-P;N=v-N;T=O*T+P*S+N*R;if(0<U){if(0>T||T>U)continue}else if(0<T||T<U)continue;S=P*I-E*N;N=N*H-I*O;P=O*E-H*P;O=J*S+L*N+G*P;if(0<U){if(0>O||T+O>U)continue}else if(0<O||T+O<U)continue;N=(M*S+Q*N+K*P)/U;0<=N&&(U=this.indices[Y]+this.firstTriangleIndex,H=n.computeNormal(H,E,I,M,Q,K,t),this._callback(N,
H,U,!1))}}z.numFacesTested+=C-B}};y.intersectRay=function(B,C){z.numFacesTested=0;var k=r.fromValues(B.r0[0],B.r0[1],B.r0[2]),q=r.fromValues(B.r1[0],B.r1[1],B.r1[2]);B=q[0]-k[0];const x=q[1]-k[1];q=q[2]-k[2];1E-6>B*B+x*x+q*q||(this._rayOrigin=k,k=this._rayDirection,k[0]=B,k[1]=x,k[2]=q,k=this.triangleVertexIndices.length/3,this._callback=C,this.intersectRayBSP(this.bspNodeTree[0],0,k))};y.intersectRayBSP=function(B,C,k){const q=this._rayOrigin,x=this._rayDirection;if(p(B.aabb,q,x)){var v=B.axis,D=
B.d;if(q[v]<D||0>x[v]){const F=B.midStartIndex;if(C<F){const G=B.leftNode;void 0!==G?this.intersectRayBSP(G,C,F):this.intersectRayTriangleRange(C,F)}}this.intersectRayTriangleRange(B.midStartIndex,B.rightStartIndex);if(q[v]>D||0<x[v])C=B.rightStartIndex,C<k&&(B=B.rightNode,void 0!==B?this.intersectRayBSP(B,C,k):this.intersectRayTriangleRange(C,k))}};b._createClass(z,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return z}();A.numFacesTested=
0;const t=r.create(),w=[Infinity,Infinity,Infinity],u=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=A;a.componentMinimalSizeForIntersectionData=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../support/debugFlags ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){e=function(l){function A(){var t=l.apply(this,arguments)||this;t.output=m.ShaderOutput.Color;t.overlayMode=h.OverlayMode.Disabled;t.tileBlendInput=d.TileBlendInput.LayerOnly;t.spherical=!1;t.doublePrecisionRequiresObfuscation=!1;t.atmosphere=!1;t.receiveShadows=!1;t.hasSlicePlane=!1;t.backfaceCullingEnabled=!1;t.stencilEnabled=!1;t.textureFadingEnabled=!1;t.renderOccluded=!1;t.hasScreenSpaceReflections=!1;t.hasCloudsReflections=!1;t.shading=!r.TERRAIN_USE_LEGACY_SHADING;
t.useLegacyTerrainShading=r.TERRAIN_USE_LEGACY_SHADING;t.transparent=!1;t.tileBorders=!1;t.visualizeNormals=!1;t.screenSizePerspective=!1;t.receiveAmbientOcclusion=!1;return t}b._inheritsLoose(A,l);return A}(e.DefaultTechniqueConfiguration);c.__decorate([f.parameter({count:m.ShaderOutput.COUNT})],e.prototype,"output",void 0);c.__decorate([f.parameter({count:h.OverlayMode.COUNT})],e.prototype,"overlayMode",void 0);c.__decorate([f.parameter({count:d.TileBlendInput.COUNT})],e.prototype,"tileBlendInput",
void 0);c.__decorate([f.parameter()],e.prototype,"spherical",void 0);c.__decorate([f.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([f.parameter()],e.prototype,"atmosphere",void 0);c.__decorate([f.parameter()],e.prototype,"receiveShadows",void 0);c.__decorate([f.parameter()],e.prototype,"hasSlicePlane",void 0);c.__decorate([f.parameter()],e.prototype,"backfaceCullingEnabled",void 0);c.__decorate([f.parameter()],e.prototype,"stencilEnabled",void 0);c.__decorate([f.parameter()],
e.prototype,"textureFadingEnabled",void 0);c.__decorate([f.parameter()],e.prototype,"renderOccluded",void 0);c.__decorate([f.parameter()],e.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([f.parameter()],e.prototype,"hasCloudsReflections",void 0);c.__decorate([f.parameter()],e.prototype,"shading",void 0);c.__decorate([f.parameter()],e.prototype,"useLegacyTerrainShading",void 0);c.__decorate([f.parameter()],e.prototype,"transparent",void 0);c.__decorate([f.parameter()],e.prototype,"tileBorders",
void 0);c.__decorate([f.parameter()],e.prototype,"visualizeNormals",void 0);c.__decorate([f.parameter()],e.prototype,"screenSizePerspective",void 0);c.__decorate([f.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([f.parameter({constValue:g.PBRMode.Disabled})],e.prototype,"pbrMode",void 0);c.__decorate([f.parameter({constValue:n.NormalAttributeType.CompressedAttribute})],e.prototype,"normalType",void 0);c.__decorate([f.parameter({constValue:p.TextureCoordinateAttributeType.Compressed})],
e.prototype,"textureCoordinateType",void 0);c.__decorate([f.parameter({constValue:!1})],e.prototype,"highStepCount",void 0);c.__decorate([f.parameter({constValue:!1})],e.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([f.parameter({constValue:!1})],e.prototype,"useFillLights",void 0);a.TerrainTechniqueConfiguration=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){a.TilingSchemeLogic=function(y){function B(k){k=y.call(this,k)||this;k._handles=new m;return k}b._inheritsLoose(B,y);var C=B.prototype;C.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(p.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};C.destroy=function(){this._handles=n.destroyMaybe(this._handles);
this._waitTask=null};C._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var k;this.layers.some(x=>!t.isTiledLayer(x)||x.isRejected()?!1:!x.isFulfilled()||n.isSome(u.getTiledLayerInfo(x,this.viewSpatialReference,this.viewingMode))?(k=x,"vector-tile"!==x?.type&&!u.isProjectableRasterLayer(x)):!1);if(k)if(k.isResolved()){var q=u.getTiledLayerInfo(k,this.viewSpatialReference,this.viewingMode);n.isSome(q)&&(q=new z.TilingScheme(q.tileInfo),this._lockTilingScheme(q))}else this._updateWhen(k)}};
C._updateWhen=function(k){const q=k.when().catch(()=>{}).then(()=>{q!==this._waitTask||this.destroyed||this._update()});this._waitTask=q};C._lockTilingScheme=function(k){if(this.viewingMode===w.ViewingMode.Global){const q=k.levels.length-1;k.spatialReference.isWebMercator?k=z.TilingScheme.makeWebMercatorAuxiliarySphere(q):e.canProjectToWGS84ComparableLonLat(k.spatialReference)&&(k=z.TilingScheme.makeGCSWithTileSize(k.spatialReference,k.pixelSize,q))}this.tilingSchemeLocked=!0;this.tilingScheme=k;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(p.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};C._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};C._setAdHocTilingScheme=function(){if(this.viewingMode===w.ViewingMode.Global){var k=this.extentHelper.viewSpatialReference;const q=e.canProjectToWGS84ComparableLonLat(k)||A.isMars(k)||A.isMoon(k);
k.isWebMercator?this.tilingScheme=z.TilingScheme.WebMercatorAuxiliarySphere:q&&(this.tilingScheme=z.TilingScheme.makeGCSWithTileSize(k,256));this._set("extent",this.extentHelper.layerViewsExtent)}else k=this.extentHelper.layerViewsExtent,n.isSome(k)&&!l.equals(k,this.extent)&&(this.tilingScheme=z.TilingScheme.fromExtent(k,this.extentHelper.viewSpatialReference),this._set("extent",k))};b._createClass(B,[{key:"test",get:function(){return{lockTilingScheme:k=>this._lockTilingScheme(k),done:!this._waitTask}}}]);
return B}(r);c.__decorate([g.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);c.__decorate([g.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([g.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([g.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([f.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,b){let c=function(){function r(){this.offset=
b.create();this.scale=0;this.tile=null}var m=r.prototype;m.init=function(n,p,g,h){this.tile=n;this.offset[0]=p;this.offset[1]=g;this.scale=h};m.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return r}();a.UpsampleInfo=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/basicInterfaces ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){var k;a.Stage=k=function(q){function x(D){D=q.call(this,D)||this;D._handles=new m;D._model=new y.Model;D._layers=new p;D._changeSet=new w.ChangeSet;D._layerSyncSet=new Set;return D}b._inheritsLoose(x,q);var v=x.prototype;v.initialize=function(){this._set("renderView",new B.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(C.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};v.destroy=function(){u.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};v.add=function(D){this._model.add(D);z.isWebGLLayer(D)&&(D.attachStage(this),this._addLayer(D));this.renderView.requestRender()};v.remove=function(D){n.isNone(D)||(this.renderView.requestRender(),this._model.remove(D),z.isWebGLLayer(D)&&(this._removeLayer(D),D.detachStage()))};v.addMany=function(D){n.isSome(D)&&(this._model.addMany(D),this.renderView.requestRender())};v.removeMany=function(D){n.isSome(D)&&(this._model.removeMany(D),this.renderView.requestRender())};
v.load=function(){var D=b._asyncToGenerator(function*(F){n.isNone(F)||(Array.isArray(F)||(F=[F]),yield Promise.all(F.filter(G=>n.isNone(G.glTexture)).map(G=>this.schedule(()=>this._model.has(G)?G.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))});return function(F){return D.apply(this,arguments)}}();v.loadImmediate=function(D){return D.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};v.forEachOfType=
function(D,F){this._model.forEachOfType(D,F)};v.handleEvent=function(D,F){this.destroyed||(this._model.dirtySet[D](F),this.renderView.requestRender())};v.runTask=function(D){this._frameTask.processQueue(D);D.done||this._commit()};v._commit=function(){const D=this._model.dirtySet;k.DebugSettings.logDirtySet&&console.log("Dirty set: "+D.formatDebugInfo());D.commit(this._changeSet);k.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+this._changeSet.removes.map(F=>
F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.requestRender()};v.schedule=function(D,F){return this._frameTask.schedule(D,F)};v.syncLayer=function(D){this._layerSyncSet.add(D);this.renderView.requestRender()};v.processSyncLayers=function(){const D=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||F.updatePolicy===t.UpdatePolicy.SYNC)D.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)D.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};v.getObject=function(D){return this._model.getObject(D)};v._addLayer=function(D){this._layers.includes(D)||this._layers.push(D)};v._removeLayer=function(D){this._commit();null!=this._layers.removeUnordered(D)&&(this._model.dirtySet.getResidentRenderGeometries(D.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};v.addRenderPlugin=function(D,F,G){D=this.renderView.renderPlugins.add(D,F,G);G=()=>{l.isIntersectionHandler(F)&&
this.sceneIntersectionHelper.addIntersectionHandler(F)};if(g.isPromiseLike(D))return D.then(G);G()};v.removeRenderPlugin=function(D){l.isIntersectionHandler(D)&&this.sceneIntersectionHelper.removeIntersectionHandler(D);this.renderView.renderPlugins.remove(D)};b._createClass(x,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}},{key:"running",get:function(){return this._model.dirtySet.dirty}},
{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const D=this;return{getCount(F){return D._model.test.content.filter(G=>G.type===F).length},model:D._model}}}]);return x}(A.AutoDisposableMixin(r));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"resourceController",void 0);
c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);c.__decorate([h.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"renderSR",void 0);
c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([h.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([A.autoDispose(),h.property()],a.Stage.prototype,"renderView",void 0);a.Stage=k=c.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.Model=function(w){function u(){var y=w.apply(this,arguments)||this;y.dirtySet=new e({model:b._assertThisInitialized(y)});y._content=new Map;y._originFactory=new f.GridLocalOriginFactory(null);return y}b._inheritsLoose(u,w);var z=u.prototype;z.getObject=function(y){return this._content.get(y)};z.add=function(y){const B=y.id;A.assert(!this._content.has(B),"Model/Stage already contains object to be added");this._content.set(B,y);t.isWebGLLayer(y)&&this.dirtySet.layerAdded(y)};
z.remove=function(y){A.assert(this._content.has(y.id),"Model/Stage doesn't contain object to be removed");this._content.delete(y.id);y.unload();t.isWebGLLayer(y)&&this.dirtySet.layerRemoved(y)};z.addMany=function(y){for(const B of y)m.isSome(B)&&(A.assert(!this._content.has(B.id),"Model/Stage already contains object to be added"),this._content.set(B.id,B))};z.removeMany=function(y){for(const B of y)A.assert(this._content.has(B.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(B.id),
B.unload()};z.has=function(y){return this._content.has(y.id)};z.forEachOfType=function(y,B){this._content.forEach(C=>{C.type===y&&B(C)})};z.getRenderGeometry=function(y,B){const {geometry:C,material:k,id:q,shaderTransformation:x,origin:v,instanceParameters:D}=B,F=new l.RenderGeometry(C,k,{id:q,boundingInfo:C.boundingInfo,calculateShaderTransformation:x,castShadow:y.castShadow});F.updateTransformation(G=>y.getCombinedStaticTransformation(B,G));F.origin=m.isSome(v)?v:this._originFactory.getOrigin(F.boundingSphere);
F.instanceParameters=D;return F};z.updateRenderGeometryTransformation=function(y,B,C){if(m.isNone(y))return!1;C.updateTransformation(q=>y.getCombinedStaticTransformation(B,q));const k=this._originFactory.getOrigin(C.boundingSphere);return C.origin!==k};z.getStats=function(){const y={},B=Array.from(this._content.values());for(let C=0;C<d.ContentObjectType.COUNT;++C)y[C]=B.filter(k=>k.type===C).length;return{contentTypes:y,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(u,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return u}(r);c.__decorate([n.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([h.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(w,u){this.geometryRecord=w;this.renderGeometry=u},t=function(w,u,z){this.operation=w;this.geometryRecord=u;this.states=z};c=function(w){function u(y){y=w.call(this,y)||this;y._residentGeomRecords=new Map;y._dirtyGeomRecords=new Map;y.dirty=!1;return y}a._inheritsLoose(u,w);var z=u.prototype;z.commit=function(y){this.dirty=!1;this._dirtyGeomRecords.forEach((B,C)=>this.commitLayer(C,y))};z.commitLayer=function(y,B){const C=this._dirtyGeomRecords.get(y);
C&&(C.forEach((k,q)=>{const x=this._ensureGeomRecord(y,q);k.forEach(({geometryRecord:v,operation:D,states:F},G)=>{let J=!1;if(D===e.DirtyOperation.UPDATE){var L=x.get(G);if(L){L=L.renderGeometry;if(F&e.DirtyState.TRANSFORMATION){const K=this.model.getObject(q);this.model.updateRenderGeometryTransformation(K,v,L)&&(J=!0)}J||B.updates.push({renderGeometry:L,updateType:F})}else l.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(D===e.DirtyOperation.REMOVE||J)(F=x.get(G))?
(B.removes.push(F.renderGeometry),x.delete(G),F.geometryRecord.disposed&&f.GeometryRecord.pool.release(F.geometryRecord)):D===e.DirtyOperation.REMOVE&&l.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(D===e.DirtyOperation.ADD||J)D=this.model.getObject(q),m.isSome(D)&&(D=this.model.getRenderGeometry(D,v),v=new A(v,D),B.adds.push(D),x.set(G,v))});0===x.size&&this._residentGeomRecords.get(y).delete(q)}),0===this._residentGeomRecords.get(y).size&&this._residentGeomRecords.delete(y),
this._dirtyGeomRecords.delete(y))};z.getResidentRenderGeometries=function(y,B){(y=this._residentGeomRecords.get(y))&&y.forEach(C=>C.forEach(k=>B.push(k.renderGeometry)))};z._objectStateChanged=function(y,B){for(const C of B.geometryRecords)this._updateOrCreateDirtyRecord(B,C,null,e.DirtyOperation.UPDATE,y)};z.visibilityChanged=function(y){this._objectStateChanged(e.DirtyState.VISIBILITIES,y)};z.highlightChanged=function(y){this._objectStateChanged(e.DirtyState.HIGHLIGHTS,y)};z.occlusionChanged=function(y){this._objectStateChanged(e.DirtyState.OCCLUDEES,
y)};z.vertexAttrsUpdated=function(y){this._updateOrCreateDirtyRecord(y.object,y.record,null,e.DirtyOperation.UPDATE,e.DirtyState.VERTEXATTRS)};z.layerAdded=function(y){y.objects.forAll(B=>this._layerObjectAdded(y,B))};z.layerRemoved=function(y){y.objects.forAll(B=>this._layerObjectRemoved(y,B))};z.layerObjectAdded=function(y){this._layerObjectAdded(y.layer,y.object)};z._layerObjectAdded=function(y,B){y=y.id;for(const C of B.geometryRecords)this._objectGeometryAdded(B,C,y)};z.layerObjectRemoved=function(y){this._layerObjectRemoved(y.layer,
y.object)};z.layerObjectsAdded=function(y){for(const B of y.objects)this._layerObjectAdded(y.layer,B)};z.layerObjectsRemoved=function(y){for(const B of y.objects)this._layerObjectRemoved(y.layer,B)};z._layerObjectRemoved=function(y,B){y=y.id;for(const C of B.geometryRecords)this._objectGeometryRemoved(B,C,y)};z.shaderTransformationChanged=function(y){(y=this._residentGeomRecords.get(y.id))&&y.forEach((B,C)=>{(C=this.model.getObject(C))&&C.hasVolativeTransformation()&&B.forEach(k=>{k.renderGeometry.shaderTransformationChanged()})})};
z.objectTransformation=function(y){const B=this._getParentLayerId(y);this._ensureGeomRecord(B,y.id).forEach(C=>{this._updateOrCreateDirtyRecord(y,C.geometryRecord,B,e.DirtyOperation.UPDATE,e.DirtyState.TRANSFORMATION)})};z.objectGeometryAdded=function(y){this._objectGeometryAdded(y.object,y.record)};z._objectGeometryAdded=function(y,B,C=null){this._updateOrCreateDirtyRecord(y,B,C,e.DirtyOperation.ADD)};z.objectGeometryRemoved=function(y){this._objectGeometryRemoved(y.object,y.record)};z._objectGeometryRemoved=
function(y,B,C=null){this._updateOrCreateDirtyRecord(y,B,C,e.DirtyOperation.REMOVE)};z._updateOrCreateDirtyRecord=function(y,B,C,k,q=e.DirtyState.NONE){C=m.unwrapOr(C,this._getParentLayerId(y));const x=B.id;y=this._ensureDirtyRecord(C,y.id);(C=y.get(x))?(B=C.operation,B===e.DirtyOperation.REMOVE&&k===e.DirtyOperation.ADD&&C.states!==e.DirtyState.NONE?C.operation=e.DirtyOperation.UPDATE:B===e.DirtyOperation.REMOVE&&k===e.DirtyOperation.ADD||B===e.DirtyOperation.ADD&&k===e.DirtyOperation.REMOVE?(y.delete(x),
C.geometryRecord.disposed&&f.GeometryRecord.pool.release(C.geometryRecord)):(B!==e.DirtyOperation.UPDATE||k!==e.DirtyOperation.REMOVE&&k!==e.DirtyOperation.UPDATE?l.assert((B===e.DirtyOperation.REMOVE||B===e.DirtyOperation.ADD)&&k===e.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):C.operation=k,C.states|=q)):y.set(x,new t(k,B,q));this.dirty=this._hasDirtyGeometryRecords};z._ensureGeomRecord=function(y,B){let C=this._residentGeomRecords.get(y);C||(C=new Map,this._residentGeomRecords.set(y,
C));y=C.get(B);y||(y=new Map,C.set(B,y));return y};z._ensureDirtyRecord=function(y,B){let C=this._dirtyGeomRecords.get(y);C||(C=new Map,this._dirtyGeomRecords.set(y,C));y=C.get(B);y||(y=new Map,C.set(B,y));return y};z._getParentLayerId=function(y){return m.isSome(y.parentLayer)?y.parentLayer.id:n.NullUID};z.formatDebugInfo=function(){const y=["ADD","UPD",void 0,"REM"];let B="";this._dirtyGeomRecords.forEach((C,k)=>{C.forEach((q,x)=>{0<B.length&&(B+="\n");B+=k+"."+x;const v=[];q.forEach(D=>{const F=
D.operation;v[F]||(v[F]=[]);v[F].push(D.geometryRecord.geometry.id)});for(q=0;q<v.length;q++)if(v[q])for(B+=" "+y[q-1]+": ",x=0;x<v[q].length;x++)B+=v[q][x]+", "})});return B};a._createClass(u,[{key:"_hasDirtyGeometryRecords",get:function(){return r.someMap(this._dirtyGeomRecords,y=>r.someMap(y,B=>B&&0<B.size))}},{key:"test",get:function(){const y=this;return{get residentLayerCount(){return y._residentGeomRecords.size},get residentObjectCount(){return Array.from(y._residentGeomRecords.values()).reduce((B,
C)=>B+C.size,0)}}}}]);return u}(c);b.__decorate([p.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([p.property()],c.prototype,"dirty",void 0);return c=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/context-util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N){a.RenderView=function(E){function I(Q){var T=E.call(this,{})||this;T.events=new m;T.waterTextureRepository=new G.WaterTextureRepository;T._magnifierHelper=new k.MagnifierHelper;T._objectAndLayerIdRenderHelper=n("enable-feature:objectAndLayerId-rendering")?new q.ObjectAndLayerIdRenderHelper:null;T._needsUpdate=!0;T._needsRender=!0;T._idleSuspend=!0;T._needsWaterReflectionUpdate=!1;T._lastAnimationUpdate=0;T._container=Q.container;
T._viewingMode=Q.viewingMode;T._initializeContext(Q);h.watch(()=>T.waterTextureRepository?.updating,()=>T.requestRender(),h.initial);T._magnifierHelper.events.on("request-render",()=>T.requestRender());T._stippleTextureRepository=new F.StippleTextureRepository(T._rctx);T._shaderTechniqueRepository=new w.ShaderTechniqueRepository({rctx:T._rctx,viewingMode:Q.viewingMode,stippleTextureRepository:T._stippleTextureRepository,waterTextureRepository:T.waterTextureRepository});T._textureRepository=new D.TextureRepository(Q,
T._shaderTechniqueRepository,T._rctx);T._textureRepository.events.on("changed",S=>T.requestRender(S));T._materialRepository=new C.GLMaterialRepository(T._textureRepository,T._shaderTechniqueRepository,()=>T.requestRender(),()=>T.requestRender());T._compositingHelper=new y(T._rctx,T._shaderTechniqueRepository);T._renderer=new x.Renderer(T._materialRepository,T._textureRepository,T._shaderTechniqueRepository,T._rctx,T._compositingHelper,T._magnifierHelper,S=>T.requestRender(S),(S,U)=>Q.schedule(S,U),
Q);T._screenshotManager=new K.ScreenshotManager(T._rctx,{renderScene:(S,U,Y,V,R)=>T._renderer.render(S,U,{camera:Y,contentCamera:Y,mode:P.RenderState.IDLE},V,R),requestRenderScene:S=>T.requestRender(S),prepareOverlay:()=>Q.options.screenshot.prepareOverlay(),renderOverlay:(S,U)=>Q.options.screenshot.renderOverlay(S,U)},S=>T.events.emit("force-camera-for-screenshot",S),()=>T._renderer.disposeOffscreenBuffers());T._registerFrameTask(Q);return T}b._inheritsLoose(I,E);var M=I.prototype;M.normalizeCtorArgs=
function(){return{}};M.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=g.removeMaybe(this._frameTask);this._shaderTechniqueRepository=g.disposeMaybe(this._shaderTechniqueRepository);E.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=null};M.requestRender=function(Q=z.RenderRequestType.UPDATE){this._needsRender=!0;Q===z.RenderRequestType.UPDATE&&(this._needsUpdate=!0)};M.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};
M.setRenderParameters=function(Q){void 0!==Q.idleSuspend&&this._idleSuspend!==!!Q.idleSuspend&&(this._idleSuspend=!!Q.idleSuspend,this.requestRender());this._renderer.setRenderParameters(Q)};M.modify=function(Q){this._renderer.modify(Q);Q.clear()};M.takeScreenshot=function(Q){return this._screenshotManager.takeScreenshot(Q).then(T=>T[0])};M.takeScreenshotWithOID=function(Q){Q.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(Q)};M.getAlpha=function(){return this._rctx.contextAttributes.alpha};
M.readAccumulatedShadow=function(Q){return this._renderer.readAccumulatedShadow(Q[0],Q[1])};M.readHUDVisibility=function(Q,T,S,U,Y){this._renderer.readHUDVisibility(Q,T,S,U,Y)};M.getMinimalDepthForArea=function(Q,T,S,U,Y,V=Y){V=U.constrainWindowSize(T,S,Y*U.pixelRatio,V*U.pixelRatio);const R=this._ensureDepthBuffer(V);this._renderer.readDepthPixels(U,V,R);Y=Number.MAX_VALUE;for(let X=0;X<V[2]*V[3];X++){const W=B.textureToDepth(4*X,R,U.nearFar);Y>W&&W!==U.nearFar[0]&&W!==U.nearFar[1]&&(Y=W)}g.isSome(Q)&&
(Q=Q.pickDepth(T*U.pixelRatio,S*U.pixelRatio,U),g.isSome(Q)&&Y>Q&&Q!==U.nearFar[0]&&Q!==U.nearFar[1]&&(Y=Q));return Y===Number.MAX_VALUE?void 0:Y};M._ensureDepthBuffer=function(Q){Q=4*Q[2]*Q[3];if(g.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<Q)this._tmpDepthBuffer=new Uint8Array(Q);return this._tmpDepthBuffer};M.reloadShaders=function(){var Q=b._asyncToGenerator(function*(){L.removeLoadedShaderModules();yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});return function(){return Q.apply(this,
arguments)}}();M._registerFrameTask=function(Q){const T=Q.state;let S=!1,U=z.RenderRequestType.BACKGROUND,Y=!1;this._frameTask=d.addFrameTask({preRender:({time:V})=>{S=this.updating;U=this._needsUpdate?z.RenderRequestType.UPDATE:z.RenderRequestType.BACKGROUND;Q.processSyncLayers();if(V-this._lastAnimationUpdate>this.animationTimestep||g.isSome(T.forcedAnimationTime)||S||this._needsRender)V=g.unwrapOr(T.forcedAnimationTime,V),this._renderer.updateAnimation({camera:T.camera,time:V})&&this.requestRender(z.RenderRequestType.BACKGROUND),
this._lastAnimationUpdate=V},render:({time:V})=>{if((this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<T.camera.fullWidth&&0<T.camera.fullHeight){const R=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this._renderer.render(null,null,T,z.Decorations.ON,V);Y=!0;R&&this._renderer.hasWaterReflection&&(this.requestRender(z.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=
!0)}},update:({time:V})=>{const R=new K.ScreenshotContext(T.camera,this._renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update();this._screenshotManager.update(R,V)},finish:()=>{Y&&(this._renderer.finish(T.mode===P.RenderState.IDLE?U:z.RenderRequestType.UPDATE),Y=!1)}})};M._initializeContext=function(Q){const T=Q.options;this._canvas=T.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");
const S=N.createContextOrErrorHTML("3d",this._canvas,{alpha:T.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==T.stencil?!0:T.stencil,powerPreference:"high-performance",preserveDrawingBuffer:T.preserveDrawingBuffer??!1});g.isNone(S)?(Q=n("esri-force-webgl"),p.getLogger(this.declaredClass).error("A WebGL context with the requested version ("+Q?Q:"automatic) could not be created.")):(this._rctx=this._newRenderingContext(S,Q),this._loadShaderOnlyExtensions(),!T.alpha&&this._rctx.contextAttributes.alpha&&
p.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=n("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};M._newRenderingContext=function(Q,T){const S={disabledExtensions:T.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:T.options.debugWebGLExtensions||{},maxAnisotropy:8},U=(Y,V)=>T.resourceController.memoryController.newCache(Y,V);
if(O.contextCache.enabled){let Y=H.get(Q);if(Y)return Y.configure(S),Y.newCache=U,Y.ref(),Y;Y=new v.RenderingContext(Q,S,U);H.set(Q,Y);Y.ref();return Y}return new v.RenderingContext(Q,S,U)};M._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};M._getObjectAndLayerIdColor=function(Q){return this._objectAndLayerIdRenderHelper?this._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(Q):
null};b._createClass(I,[{key:"performanceInfo",get:function(){const Q=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==Q.getUsedTextureMemory?Q.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==Q.getUsedRenderbufferMemory?Q.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==Q.getUsedVBOMemory?Q.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||
this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(Q){this._magnifierHelper.magnifier=Q}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},
{key:"shadowsEnabled",get:function(){return this._renderer.shadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"gpuMemoryUsage",get:function(){return this._renderer.gpuMemoryUsage}},{key:"animationTimestep",get:function(){return this._renderer.animationTimestep}},{key:"componentObjectCollection",get:function(){g.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new t.ComponentObjectCollection(this._renderer.renderPassManager,
this._viewingMode));return this._componentObjectCollection},set:function(Q){this._componentObjectCollection=Q}}]);return I}(u.AutoDisposableMixin(r));c.__decorate([f.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_rctx",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_container",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_canvas",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,
"_stippleTextureRepository",void 0);c.__decorate([u.autoDispose(),f.property()],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([u.autoDispose(),f.property()],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([f.property()],a.RenderView.prototype,"_objectAndLayerIdRenderHelper",void 0);c.__decorate([u.autoDispose(),f.property()],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([u.autoDispose()],
a.RenderView.prototype,"_renderer",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_screenshotManager",void 0);c.__decorate([u.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([u.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);c.__decorate([f.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([f.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([A.subclass("esri.views.3d.webgl-engine.parts.RenderView")],
a.RenderView);const H=J.getContextCache();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f32 ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/i3s/I3SUtil ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q){function T(X,W){return X===W?F.ComponentParameterSummary.All:0===X?F.ComponentParameterSummary.None:F.ComponentParameterSummary.Some}const S=r.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");r=function(){function X(aa,ba){this._renderManager=aa;this._viewingMode=ba;this._objects=[new n,new n];this._renderSubmit=new v.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=c("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new E.BufferManager(aa.rctx,2+(this._hasObjectAndLayerId?1:0))}var W=X.prototype;W.dispose=function(){K.assert(0===this._objects[C.State.Hidden].length&&0===this._objects[C.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};W.createObject=function(aa){const ba=new C.ComponentObject;ba.toMapSpace=aa.toMapSpace;ba.transform=aa.transform;ba.obb=
u.clone(aa.obb);ba.components=new B(this._componentBufferManager,aa.geometry.componentOffsets);ba.renderable=this._createRenderable(aa,ba.components);ba.intersectionGeometry=new k(aa.geometry.positionData,ba.components);this._objects[ba.visible].push(ba);return ba};W.destroyObject=function(aa){this._objects[aa.visible].removeUnordered(aa);aa.dispose();this._notifyDirty()};W.setObjectVisibility=function(aa,ba){ba!==aa.visible&&(this._objects[aa.visible].removeUnordered(aa),this._objects[ba].push(aa),
aa.visible=ba,this._notifyDirty())};W.preSubmit=function(aa){const ba=aa.camera.eye;this.visibleObjects.forAll(ia=>ia.renderable.meta.cameraDepthSquared=h.squaredDistance(ba,ia.obb.center))};W.getMaterial=function(aa){return aa.renderable.material};W.updateMaterial=function(aa,ba){aa=aa.renderable.material;ba(aa);aa.dirty&&this._notifyDirty()};W.setAllComponentVisibilities=function(aa,ba){aa.components.visibility.reset(ba);aa.components.visibilityDirty();this._notifyDirty()};W.forEachVisibleComponent=
function(aa,ba){return aa.components.visibility.forEachComponent(ba)};W.getComponentCount=function(aa){const ba=aa.components.visibility.componentCount();return{visible:ba,invisible:aa.components.count-ba}};W.setComponentData=function(aa,ba){const ia=aa.renderable.material,ma=aa.components;var ha=ma.materialDataBuffer;const ka=ma.materialDataIndices,Z={castShadows:!0,pickable:!0,externalColor:f.create(),externalColorMixMode:w.ColorMixModeEnum.Multiply,elevationOffset:0,objectAndLayerIdColor:this._hasObjectAndLayerId?
f.create():null};ha=ha.textureBuffer;const ca=new Uint8Array(4),fa=new Uint32Array(ca.buffer);let ea=0,da=0,la=0,oa=ma.verticalOffsets,ra=Infinity,Aa=-Infinity,ua=!1,za=!1,va=0;for(let Ja=0;Ja<ma.count;Ja++){ba(Ja,Z);ea+=+(1>Z.externalColor[3]);da+=+(Z.externalColorMixMode===w.ColorMixModeEnum.Replace&&1===Z.externalColor[3]);la+=+Z.castShadows;w.encodeSymbolColor(Z.externalColor,Z.externalColorMixMode,ca);ca[2]=ca[2]&254|+Z.castShadows;ha.setData(ka[Ja],0,ca[0],ca[1],ca[2],ca[3]);ua||(ua=0<Ja&&va!==
fa[0]);va=fa[0];za||(za=0!==Z.elevationOffset);za&&m.isNone(oa)&&(oa=Array(Ja).fill(0));m.isSome(oa)&&(oa[Ja]=Z.elevationOffset);ra=Math.min(ra,Z.elevationOffset);Aa=Math.max(Aa,Z.elevationOffset);J.encodeElevationOffset(Z.elevationOffset,ca);ha.setData(ka[Ja],1,ca[0],ca[1],ca[2],ca[3]);if(this._hasObjectAndLayerId){const pa=Z.objectAndLayerIdColor;ha.setData(ka[Ja],2,pa[0],pa[1],pa[2],pa[3])}Z.pickable!==L.getVisibility(ma.pickability,Ja)&&(ma.pickability=L.updateVisibilityWithCount(ma.pickability,
ma.count,Ja,Z.pickable))}ma.verticalOffsets=za?oa:null;aa.offsetObb=za?t.computeOffsetObb(aa.obb,ra,Aa,this._viewingMode,m.isSome(aa.offsetObb)?aa.offsetObb:u.clone(aa.obb)):null;ua||za||this._hasObjectAndLayerId?(ia.componentParameters=new F.ComponentParametersVarying,ia.componentParameters.castShadows=T(la,ma.count),ia.componentParameters.transparent=T(ea,ma.count),ia.componentParameters.opaqueOverride=T(da,ma.count),ia.componentParameters.texture=ha,ha.updateTexture()):(ia.componentParameters=
new F.ComponentParametersUniform,ia.componentParameters.castShadows=Z.castShadows?F.ComponentParameterSummary.All:F.ComponentParameterSummary.None,ia.componentParameters.externalColor=Z.externalColor,ia.componentParameters.externalColorMixMode=Z.externalColorMixMode);this._notifyDirty()};W.getComponentAabb=function(aa,ba,ia,ma=!1){aa.intersectionGeometry.getComponentAabb(ba,ia);const ha=aa.components.verticalOffsets;if(ma||m.isNone(ha))return ia;ba=ha[ba];if(this._viewingMode===A.ViewingMode.Local||
0===ba)return ia[2]+=ba,ia[5]+=ba,ia;ba=m.unwrap(P.getVerticalOffsetI3S(ba));ba.localOrigin=aa.transform.position;return ba.applyToAabb(ia)};W.getComponentObb=function(aa){return aa.obb};W.getObjectTransform=function(aa){return aa.transform};W.getComponentPositions=function(aa,ba,ia){return aa.intersectionGeometry.getComponentPositions(ba,ia)};W.intersect=function(aa,ba,ia,ma,ha,ka){m.isSome(ha)&&(ha.localOrigin=aa.transform.position);const Z=p.invert(Y,aa.transform.rotationScale);h.sub(V,ba,aa.transform.position);
h.sub(R,ia,aa.transform.position);h.transformMat3(V,V,Z);h.transformMat3(R,R,Z);ba=p.transpose(Y,Z);return aa.intersectionGeometry.intersect(V,R,ma,ba,ha,aa.components.verticalOffsets,ka)};W.addEdges=function(aa,ba,ia,ma){const {indices:ha,positions:ka}=aa.intersectionGeometry,Z=aa.components.offsets;return ba.addComponentObject(aa,aa.transform,{center:aa.obb.center,radius:u.radius(aa.obb)},ka,ha,Z,ia,ma)};W.extractEdgeInformation=function(){var aa=b._asyncToGenerator(function*(ba,ia,ma){var ha=ba.components.visibility;
if(ha.allInvisible())return{buffer:H.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ka,positions:Z}=ba.intersectionGeometry,ca=ba.components.offsets,fa=N.EdgeInputBufferLayout.createBuffer(Z.count);l.copy(fa.position,Z);e.transformMat3(fa.position,fa.position,ba.transform.rotationScale);this._setComponentIndices(fa.componentIndex,ka,ca);ha=this._computeVisibilityIndices(ka,ha,ca,fa.count);ba=d.clone(ba.transform.position);ia=yield ia.extractComponentsEdgeLocations({indices:ha,
indicesLength:ha.length,skipDeduplicate:!0,data:fa,writerSettings:{reducedPrecision:!1,variants:0}},ma);return{origin:ba,buffer:ia}});return function(ba,ia,ma){return aa.apply(this,arguments)}}();W._setComponentIndices=function(aa,ba,ia){let ma=0;for(let ka=0;ka<ia.length-1;ka++){var ha=ia[ka];const Z=ia[ka+1];for(;ha<Z;ha++)aa.set(ba?ba[ha]:ha,ma);ma++}};W._computeVisibilityIndices=function(aa,ba,ia,ma){if(aa&&ba.allVisible())return aa;let ha=0;ba.forEachComponentRange((ca,fa)=>{ha+=ia[fa]-ia[ca];
return!0});const ka=Array.isArray(aa)?Array(ha):2===aa?.BYTES_PER_ELEMENT||65536>=ma?new Uint16Array(ha):new Uint32Array(ha);let Z=0;ba.forEachComponentRange((ca,fa)=>{ca=ia[ca];for(fa=ia[fa];ca<fa;ca++)ka[Z++]=aa?aa[ca]:ca;return!0});return ka};W.addComponentHighlight=function(aa,ba){aa=aa.components;m.isNone(aa.highlightCounts)&&(aa.highlightCounts=new Uint32Array(aa.count+1));0===aa.highlightCounts[ba]++&&(aa.highlightsDirty(),this._notifyDirty());aa.highlightCounts[aa.count]++};W.removeComponentHighlight=
function(aa,ba){aa=aa.components;if(m.isNone(aa.highlightCounts))S.warn("Removing non-existing highlight.");else{var ia=aa.highlightCounts[ba],ma=aa.highlightCounts[aa.count];0===ia?S.warn("Removing non-existing highlight."):1<ia?(aa.highlightCounts[ba]=ia-1,aa.highlightCounts[aa.count]=ma-1):(aa.highlightCounts[ba]=0,aa.highlightsDirty(),this._notifyDirty(),1===ma?aa.highlightCounts=null:aa.highlightCounts[aa.count]=ma-1)}};W.clearHighlights=function(aa){aa=aa.components;m.isSome(aa.highlightCounts)&&
(aa.highlightCounts=null,aa.highlightsDirty(),this._notifyDirty())};W.getObjectGPUMemoryUsage=function(aa){return aa.renderable.meta.gpuMemoryEstimate};W._createRenderable=function(aa,ba){const ia=this._renderManager.rctx,ma=aa.geometry;var ha=ma.vertices.layoutParameters,ka=I.BufferObject.createVertex(ia,M.Usage.STATIC_DRAW,ma.vertices.data);const Z=m.applySome(ma.indices,da=>I.BufferObject.createIndex(ia,M.Usage.STATIC_DRAW,da));var ca=z.glLayout(D.createVertexBufferLayout(ha));const fa=new Uint16Array(ma.vertices.count);
for(let da=0;da<ba.count;da++){var ea=ba.offsets[da];const la=ba.offsets[da+1],oa=ba.materialDataIndices[da];if(m.isSome(ma.indices))for(;ea<la;ea++)fa[ma.indices[ea]]=oa;else for(;ea<la;ea++)fa[ea]=oa}ba=I.BufferObject.createVertex(ia,M.Usage.STATIC_DRAW,fa.buffer);aa=new F.ComponentMaterial(aa.transform,aa.toMapSpace);ca=new Q.VertexArrayObject(ia,G.attributeLocations,{data:ca,componentIndices:U},{data:ka,componentIndices:ba},m.unwrap(Z));ha=new x.RenderGeometry(ca,M.PrimitiveType.TRIANGLES,ha,
m.isSome(Z));ka={cameraDepthSquared:.5,gpuMemoryEstimate:ka.byteSize+ba.byteSize+(m.isSome(Z)?Z.byteSize:0)};return new q.Renderable(aa,ha,ka)};W._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(X,[{key:"visibleObjects",get:function(){return this._objects[C.State.Visible]}}]);return X}();const U=z.glLayout(y.newLayout().u16(O.VertexAttribute.COMPONENTINDEX)),Y=g.create(),V=d.create(),R=d.create();a.ComponentObjectCollection=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ../../../ViewingMode ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L){function K(wa){return wa&&parseInt(wa.substring(wa.lastIndexOf("/")+1,wa.length),10)}function O(wa,ya){var Na=ya[0],Ra=ya[1];ya=ya[3];const Sa=wa[0]-Na;Na-=wa[2];const ja=wa[1]-Ra;wa=Ra-wa[3];Ra=Math.max(Sa,Na,0);const Ta=Math.max(ja,wa,0);Ra=Ra*Ra+Ta*Ta;return Ra>ya*ya?a.MbsIntersectResult.OUTSIDE:0<Ra?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Sa,Na,ja,wa)>ya?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function P(wa,ya,Na){const Ra=[],Sa=Na&&Na.missingFields;Na=Na&&Na.originalFields;for(const ja of wa){wa=ja.toLowerCase();let Ta=!1;for(const qa of ya)if(wa===qa.name.toLowerCase()){Ra.push(qa.name);Ta=!0;Na&&Na.push(ja);break}!Ta&&Sa&&Sa.push(ja)}return Ra}function N(){N=b._asyncToGenerator(function*(wa,ya,Na,Ra,Sa){if(0===ya.length)return[];const ja=wa.attributeStorageInfo;if(p.isSome(wa.associatedLayer))try{return yield E(wa.associatedLayer,ya,Na,Ra)}catch(Ta){if(wa.associatedLayer.loaded)throw Ta;
}if(ja){ya=H(ya,Na,Sa);if(p.isNone(ya))throw new m("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ta=wa.parsedUrl.path;return(yield Promise.all(ya.map(qa=>Q(Ta,ja,qa.node.resources.attributes,qa.indices,Ra).then(Ea=>{for(let Oa=0;Oa<qa.graphics.length;Oa++){const Va=qa.graphics[Oa],Ua=Ea[Oa];if(Va.attributes)for(const La in Va.attributes)La in Ua||(Ua[La]=Va.attributes[La]);Va.attributes=Ua}return qa.graphics})))).flat()}throw new m("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");});return N.apply(this,arguments)}function H(wa,ya,Na){const Ra=new Map,Sa=[];Na=Na();for(const qa of wa){var ja=qa.attributes[ya];for(var Ta=0;Ta<Na.length;Ta++){wa=Na[Ta];const Ea=wa.featureIds.indexOf(ja);if(0<=Ea){ja=Ra.get(wa.node);ja||(ja={node:wa.node,indices:[],graphics:[]},Sa.push(ja),Ra.set(wa.node,ja));ja.indices.push(Ea);for(ja.graphics.push(qa);0<Ta;Ta--)Na[Ta]=Na[Ta-1];Na[0]=wa;break}}}return Sa}function E(wa,ya,Na,
Ra){return I.apply(this,arguments)}function I(){I=b._asyncToGenerator(function*(wa,ya,Na,Ra){ya.sort((Ta,qa)=>Ta.attributes[Na]-qa.attributes[Na]);var Sa=ya.map(Ta=>Ta.attributes[Na]);const ja=[];Ra=P(Ra,wa.fields,{originalFields:ja});wa=yield M(wa,Sa,Ra);for(Sa=0;Sa<ya.length;Sa++){const Ta=ya[Sa],qa=wa[Sa],Ea={};if(Ta.attributes)for(const Oa in Ta.attributes)Ea[Oa]=Ta.attributes[Oa];for(let Oa=0;Oa<ja.length;Oa++)Ea[ja[Oa]]=qa[Ra[Oa]];Ta.attributes=Ea}return ya});return I.apply(this,arguments)}
function M(wa,ya,Na){var Ra=wa.capabilities.query.maxRecordCount;if(null!=Ra&&ya.length>Ra)return Ra=r.splitIntoChunks(ya,Ra),Promise.all(Ra.map(Sa=>M(wa,Sa,Na))).then(Sa=>Sa.flat());Ra=new x({objectIds:ya,outFields:Na,orderByFields:[wa.objectIdField]});return wa.queryFeatures(Ra).then(Sa=>{if(Sa&&Sa.features&&Sa.features.length===ya.length)return Sa.features.map(ja=>ja.attributes);throw new m("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function Q(wa,
ya,Na,Ra,Sa){const ja=[];for(const Ta of ya)Ta&&Sa.includes(Ta.name)&&ja.push({url:`${wa}/nodes/${Na}/attributes/${Ta.key}/0`,storageInfo:Ta});return g.eachAlways(ja.map(Ta=>c(Ta.url,{responseType:"array-buffer"}).then(qa=>D.readBinaryAttribute(Ta.storageInfo,qa.data)))).then(Ta=>{const qa=[];for(const Ea of Ra){const Oa={};for(let Va=0;Va<Ta.length;Va++)null!=Ta[Va].value&&(Oa[ja[Va].storageInfo.name]=T(Ta[Va].value,Ea));qa.push(Oa)}return qa})}function T(wa,ya){if(!wa)return null;ya=wa[ya];return h.isInt16Array(wa)?
-32768===ya?null:ya:h.isInt32Array(wa)?ya===ba?null:ya:ya!==ya?null:ya}function S(wa){var ya=wa.store.indexCRS||wa.store.geographicCRS;const Na=void 0===ya?wa.store.indexWKT:void 0;if(Na)if(wa.spatialReference){if(Na!==wa.spatialReference.wkt)throw new m("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new m("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});ya=ya?new C(K(ya)):wa.spatialReference;return ya.equals(wa.spatialReference)?wa.spatialReference:ya}function U(wa){var ya=wa.store.vertexCRS||wa.store.projectedCRS;const Na=void 0===ya?wa.store.vertexWKT:void 0;if(Na)if(wa.spatialReference){if(Na!==wa.spatialReference.wkt)throw new m("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new m("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});ya=ya?new C(K(ya)):wa.spatialReference;return ya.equals(wa.spatialReference)?wa.spatialReference:ya}function Y(wa,ya,Na){if(!y.canProjectWithoutEngine(wa,ya))throw new m("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
Na&&!V(wa,ya))throw new m("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function V(wa,ya){return wa.equals(ya)||wa.isWGS84&&ya.isWebMercator||wa.isWebMercator&&ya.isWGS84}function R(wa,ya,Na){const Ra=S(wa);wa=U(wa);Y(Ra,ya,Na);Y(wa,ya,Na)}function X(wa,ya,Na,Ra,Sa=0){if(Ra===B.getSphericalPCPF(Ra))if(ya.isGeographic){var ja=B.getReferenceEllipsoid(ya);Ra=1+Math.max(0,Sa)/(ja.radius+wa.center[2]);
u.set(Na.center,wa.center[0],wa.center[1],wa.center[2]+Sa);y.projectBuffer(Na.center,ya,0,Na.center,B.getSphericalPCPF(ya),0,1);A.copy(Na.quaternion,wa.quaternion);A.conjugate(Aa,wa.quaternion);u.set(pa,0,0,1);u.transformQuat(pa,pa,Aa);u.set(pa,wa.halfSize[0]*Math.abs(pa[0]),wa.halfSize[1]*Math.abs(pa[1]),wa.halfSize[2]*Math.abs(pa[2]));u.scale(pa,pa,ja.inverseFlattening);u.add(Na.halfSize,wa.halfSize,pa);u.scale(Na.halfSize,Na.halfSize,Ra)}else{L.corners(wa,ua);u.set(Na.center,wa.center[0],wa.center[1],
wa.center[2]+Sa);y.computeTranslationToOriginAndRotation(ya,Na.center,ra,B.getSphericalPCPF(ya));u.set(Na.center,ra[12],ra[13],ra[14]);Ra=2*Math.sqrt(1+ra[0]+ra[5]+ra[10]);Aa[0]=(ra[6]-ra[9])/Ra;Aa[1]=(ra[8]-ra[2])/Ra;Aa[2]=(ra[1]-ra[4])/Ra;Aa[3]=.25*Ra;A.multiply(Na.quaternion,Aa,wa.quaternion);A.conjugate(Aa,Na.quaternion);let Ta=Ra=wa=0;for(ja of ua)ja[2]+=Sa,y.projectBuffer(ja,ya,0,ja,B.getSphericalPCPF(ya),0,1),u.sub(pa,ja,Na.center),u.transformQuat(pa,pa,Aa),wa=Math.max(wa,Math.abs(pa[0])),
Ra=Math.max(Ra,Math.abs(pa[1])),Ta=Math.max(Ta,Math.abs(pa[2]));u.set(Na.halfSize,wa,Ra,Ta)}else ya.isWGS84&&(Ra.isWebMercator||q.isPlateCarree(Ra))?(u.copy(la,wa.center),la[2]+=Sa,Sa=B.getSphericalPCPF(Ra),y.projectBuffer(la,ya,0,la,Sa,0,1),W(Sa,wa,la,Ra,Na)):ya.isWebMercator&&q.isPlateCarree(Ra)?(u.copy(la,wa.center),la[2]+=Sa,W(ya,wa,la,Ra,Na)):wa===Na?(Na.center[2]+=Sa,y.projectBuffer(Na.center,ya,0,Na.center,Ra,0,1)):(u.set(Na.center,wa.center[0],wa.center[1],wa.center[2]+Sa),y.projectBuffer(Na.center,
ya,0,Na.center,Ra,0,1),A.copy(Na.quaternion,wa.quaternion),u.copy(Na.halfSize,wa.halfSize))}function W(wa,ya,Na,Ra,Sa){const ja=d.fromQuat(oa,ya.quaternion);for(let qa=0;8>qa;++qa){for(var Ta=0;3>Ta;++Ta)da[Ta]=ya.halfSize[Ta]*(0!==(qa&1<<Ta)?-1:1);for(Ta=0;3>Ta;++Ta){let Ea=Na[Ta];for(let Oa=0;3>Oa;++Oa)Ea+=da[Oa]*ja[3*Oa+Ta];fa[3*qa+Ta]=Ea}}y.projectBuffer(fa,wa,0,fa,Ra,0,8);L.compute(ea,Sa)}const aa=k.create();a.MbsIntersectResult=void 0;(function(wa){wa[wa.OUTSIDE=0]="OUTSIDE";wa[wa.INTERSECTS_CENTER_OUTSIDE=
1]="INTERSECTS_CENTER_OUTSIDE";wa[wa.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";wa[wa.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const ba=-(2**31),ia=G.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let ma=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const ha=z.create(),ka=z.create(),Z=z.create(),ca=w.create(),fa=new Float64Array(24),ea={data:fa,size:3},da=z.create(),la=z.create(),oa=f.create(),ra=l.create(),Aa=t.create(),ua=[[0,
0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],za=k.create(),va=k.create(),Ja=L.create(),pa=[0,0,0],Ba={data:Array(72),size:3},Ha=l.create();a.SymbolInfo=ma;a.addWraparound=function(wa,ya){return(wa|0)+(ya|0)|0};a.checkPointCloudLayerCompatibleWithView=function(wa,ya){Y(wa.spatialReference,ya.spatialReference,ya.viewingMode)};a.checkPointCloudLayerValid=function(wa){var ya;(ya=null==wa.store||null==wa.store.defaultGeometrySchema)||(wa=wa.store.defaultGeometrySchema,ya=!!(null==wa.geometryType||
"points"!==wa.geometryType||null!=wa.topology&&"PerAttributeArray"!==wa.topology||null!=wa.encoding&&""!==wa.encoding&&"lepcc-xyz"!==wa.encoding||null==wa.vertexAttributes||null==wa.vertexAttributes.position));if(ya)throw new m("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(wa,ya){R(wa,ya.spatialReference,ya.viewingMode)};a.checkSceneLayerValid=function(wa){var ya;(ya=null==wa.store||
null==wa.store.defaultGeometrySchema)||(ya=wa.store.defaultGeometrySchema,ya=!!(null!=ya.geometryType&&"triangles"!==ya.geometryType||null!=ya.topology&&"PerAttributeArray"!==ya.topology||null==ya.vertexAttributes||null==ya.vertexAttributes.position));if(ya)throw new m("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:wa.parsedUrl.path});};a.checkSpatialReference=Y;a.checkSpatialReferences=R;a.computeOffsetObb=function(wa,ya,Na,Ra,Sa){A.copy(Sa.quaternion,
wa.quaternion);if(Ra===v.ViewingMode.Global){A.conjugate(ca,wa.quaternion);u.transformQuat(ha,wa.center,ca);u.abs(ka,ha);u.min(Z,ka,wa.halfSize);u.sub(Z,ka,Z);Ra=u.length(Z);u.add(Z,ka,wa.halfSize);const ja=u.length(Z);Ra<Na?(u.copy(Sa.center,wa.center),u.set(ha,Na,Na,Na),u.add(Sa.halfSize,wa.halfSize,ha)):(ya=0<ja?1+ya/ja:1,Ra=0<Ra?1+Na/Ra:1,Na=(Ra+ya)/2,ya=(Ra-ya)/2,u.scale(Sa.halfSize,ka,ya),u.scaleAndAdd(Sa.halfSize,Sa.halfSize,wa.halfSize,Na),u.scale(Sa.center,ka,Na),u.scaleAndAdd(Sa.center,
Sa.center,wa.halfSize,ya),u.sign(ha,ha),u.multiply(Sa.center,Sa.center,ha),u.transformQuat(Sa.center,Sa.center,Sa.quaternion))}else Ra=u.set(ha,0,0,1),u.scaleAndAdd(Sa.center,wa.center,Ra,(Na+ya)/2),A.conjugate(ca,wa.quaternion),u.transformQuat(Ra,Ra,ca),u.abs(Ra,Ra),u.scaleAndAdd(Sa.halfSize,wa.halfSize,Ra,(Na-ya)/2);return Sa};a.computeVisibilityObb=function(wa,ya,Na,Ra,Sa,ja){if(!ja||0===ja.length||p.isNone(ya))return null;const Ta=F.computeGlobalTransformation(wa.mbs,Sa,Na,ya);e.invert(Ha,Ta);
let qa;const Ea=()=>{if(!qa)if(qa=ua,k.empty(va),p.isSome(wa.serviceObb)){X(wa.serviceObb,Na,Ja,ya,Sa);L.corners(Ja,qa);for(var La of qa)u.transformMat4(La,La,Ha),k.expandPointInPlace(va,La)}else{var ta=wa.mbs;La=ta[3];y.projectVectorToVector(ta,Na,pa,ya);u.transformMat4(pa,pa,Ha);pa[2]+=Sa;for(ta=0;8>ta;++ta){const xa=qa[ta];u.copy(xa,[pa[0]+(ta&1?La:-La),pa[1]+(ta&2?La:-La),pa[2]+(ta&4?La:-La)]);k.expandPointInPlace(va,xa)}}};let Oa=Infinity,Va=-Infinity;const Ua=La=>{if("replace"===La.type&&(La=
La.geometry,La.hasZ)){k.empty(za);var ta=La.spatialReference||Ra;La=La.rings.reduce((xa,Ia)=>Ia.reduce((Qa,Xa)=>{y.projectVectorToVector(Xa,ta,pa,ya);u.transformMat4(pa,pa,Ha);k.expandPointInPlace(za,pa);return Math.min(pa[2],Qa)},xa),Infinity);Ea();k.intersects(va,za)&&(Oa=Math.min(Oa,La),Va=Math.max(Va,La))}};ja.forEach(La=>Ua(La));if(Infinity===Oa)return null;ja=(La,ta,xa)=>{u.transformMat4(pa,xa,Ta);La[ta+0]=pa[0];La[ta+1]=pa[1];La[ta+2]=pa[2];ta+=24;xa[2]=Oa;u.transformMat4(pa,xa,Ta);La[ta+0]=
pa[0];La[ta+1]=pa[1];La[ta+2]=pa[2];ta+=24;xa[2]=Va;u.transformMat4(pa,xa,Ta);La[ta+0]=pa[0];La[ta+1]=pa[1];La[ta+2]=pa[2]};for(let La=0;8>La;++La)ja(Ba.data,3*La,qa[La]);return L.compute(Ba)};a.containsDraco=function(wa){if(n("disable-feature:i3s-draco")||!wa)return!1;for(const ya of wa)for(const Na of ya.geometryBuffers)if("draco"===Na.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=K;a.filterInPlace=function(wa,ya,Na){let Ra=0,Sa=0;for(let ja=0;ja<ya.length&&Ra<wa.length;ja++)wa[Ra]===
ya[ja]&&(Na(ja)&&(wa[Sa]=wa[Ra],Sa++),Ra++);wa.length=Sa};a.findFieldsCaseInsensitive=P;a.findIntersectingNodes=function(wa,ya,Na,Ra){Na.traverse(ya,Sa=>{if(O(wa,Sa.mbs)===a.MbsIntersectResult.OUTSIDE)return!1;Ra(Sa);return!0})};a.getCacheKeySuffix=function(wa,ya){return p.isNone(ya)?"@null":ya===B.getSphericalPCPF(ya)?"@ECEF":wa.equals(ya)?"":null!=ya.wkid?"@"+ya.wkid:null};a.getCachedAttributeValue=T;a.getClipRect=function(wa,ya){if(0===ya.rotationScale[1]&&0===ya.rotationScale[2]&&0===ya.rotationScale[3]&&
0===ya.rotationScale[5]&&0===ya.rotationScale[6]&&0===ya.rotationScale[7])return aa[0]=(wa[0]-ya.position[0])/ya.rotationScale[0],aa[1]=(wa[1]-ya.position[1])/ya.rotationScale[4],aa[2]=(wa[2]-ya.position[0])/ya.rotationScale[0],aa[3]=(wa[3]-ya.position[1])/ya.rotationScale[4],aa};a.getIndexCrs=S;a.getSymbolInfo=function(wa){const ya=new ma;var Na=!1;let Ra=!1;for(const ja of wa.symbolLayers.items)if("fill"===ja.type&&ja.enabled){var Sa=ja.material;wa=ja.edges;p.isSome(Sa)&&!Na&&(Na=Sa.color,Sa=J.parseColorMixMode(Sa.colorMixMode),
p.isSome(Na)?ya.material={color:[Na.r/255,Na.g/255,Na.b/255],alpha:Na.a,colorMixMode:Sa}:ya.material={color:[1,1,1],alpha:1,colorMixMode:J.ColorMixModeEnum.Multiply},ya.castShadows=ja.castShadows,Na=!0);p.isSome(wa)&&!Ra&&(ya.edgeMaterial=G.createMaterialFromEdges(wa,{}),Ra=!0)}ya.material||(ya.material={color:[1,1,1],alpha:1,colorMixMode:J.ColorMixModeEnum.Multiply});return ya};a.getVertexCrs=U;a.intersectBoundingRectWithMbs=O;a.invalidateMbs=function(wa){p.isSome(wa)&&(wa[3]=-1)};a.invalidateObb=
function(wa){p.isSome(wa)&&(wa.halfSize[0]=-1)};a.isSupportedLocalModeProjection=V;a.isValidMbs=function(wa){return 0<=wa[3]};a.isValidObb=function(wa){return p.isSome(wa)&&0<=wa.halfSize[0]};a.objectIdFilter=function(wa,ya,Na){let Ra=0,Sa=0;for(;Ra<Na.length;)0<=r.binaryIndexOf(wa,Na[Ra])===ya&&(Na[Sa]=Na[Ra],Sa++),Ra++;Na.length=Sa};a.queryAttributesFromCachedAttributesId=Q;a.rendererNeedsTextures=function(wa){if(null==wa||"simple"!==wa.type&&"class-breaks"!==wa.type&&"unique-value"!==wa.type||
("unique-value"===wa.type||"class-breaks"===wa.type)&&null==wa.defaultSymbol)return!0;wa=wa.getSymbols();if(0===wa.length)return!0;for(const ya of wa){if("mesh-3d"!==ya.type||0===ya.symbolLayers.length)return!0;for(const Na of ya.symbolLayers.items)if("fill"!==Na.type||p.isNone(Na.material)||p.isNone(Na.material.color)||"replace"!==Na.material.colorMixMode)return!0}return!1};a.transformObb=X;a.transparentEdgeMaterial=ia;a.whenGraphicAttributes=function(wa,ya,Na,Ra,Sa){return N.apply(this,arguments)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const p=new Float32Array(4);p[3]=1;return p}function c(p){const g=new Float32Array(4);g[0]=p[0];g[1]=p[1];g[2]=p[2];g[3]=p[3];return g}function r(p,g,h,d){const f=new Float32Array(4);f[0]=p;f[1]=g;f[2]=h;f[3]=d;return f}function m(p,g){return new Float32Array(p,g,4)}const n=Object.freeze(Object.defineProperty({__proto__:null,create:b,
clone:c,fromValues:r,createView:m},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=m;a.fromValues=r;a.quatf32=n})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,r,m,n){function p(k,q){const x={byteOffset:0,byteCount:0,fields:Object.create(null)};let v=0;for(let D=0;D<q.length;D++){const F=q[D],G=F.valueType||
F.type;x.fields[F.property]=(0,C[G])(k,v);v+=B[G].BYTES_PER_ELEMENT}x.byteCount=v;return x}function g(k,q,x){const v=[];let D,F=0,G;for(G=0;G<k;G+=1){D=q[G];if(0<D){var J=v,L=J.push,K=x,O=F,P=D-1;let H="",E=0;for(;E<P;){var N=K[O+E];if(128>N)H+=String.fromCharCode(N),E++;else if(192<=N&&224>N){if(E+1>=P)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");H+=String.fromCharCode((N&31)<<6|K[O+E+1]&63);E+=2}else if(224<=N&&240>N){if(E+2>=P)throw new b("utf8-decode-error",
"UTF-8 Decode failed. Multi byte character was truncated.");H+=String.fromCharCode((N&15)<<12|(K[O+E+1]&63)<<6|K[O+E+2]&63);E+=3}else if(240<=N&&248>N){if(E+3>=P)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");N=(N&7)<<18|(K[O+E+1]&63)<<12|(K[O+E+2]&63)<<6|K[O+E+3]&63;H=65536<=N?H+String.fromCharCode((N-65536>>10)+55296,(N&1023)+56320):H+String.fromCharCode(N);E+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");
}L.call(J,H);if(0!==x[F+D-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else v.push(null);F+=D}return v}function h(k,q){return new B[q.valueType](k,q.byteOffset,q.count*q.valuesPerElement)}function d(k,q){return new Uint8Array(k,q.byteOffset,q.byteCount)}function f(k,q,x){k=null!=q.header?p(k,q.header):{byteOffset:0,byteCount:0,fields:{count:x}};x={header:k,byteOffset:k.byteCount,byteCount:0,entries:Object.create(null)};let v=k.byteCount;for(let D=0;D<q.ordering.length;D++){const F=
q.ordering[D],G=c.clone(q[F]);G.count=k.fields.count;if("String"===G.valueType){if(G.byteOffset=v,G.byteCount=k.fields[F+"ByteCount"],"UTF-8"!==G.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(w(G.valueType)){const J=u(G.valueType);v+=0!==v%J?J-v%J:0;G.byteOffset=v;G.byteCount=J*G.valuesPerElement*G.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:G.valueType});v+=G.byteCount;x.entries[F]=G}x.byteCount=
v-x.byteOffset;return x}function e(k,q,x){q!==k&&z.error(`Invalid ${x} buffer size\n expected: ${k}, actual: ${q})`);if(q<k)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:k,actualSize:q});}function l(k){return{isDraco:!1,isLegacy:!1,color:null!=k.color,normal:null!=k.normal,uv0:null!=k.uv0,uvRegion:null!=k.uvRegion,featureIndex:null!=k.faceRange&&null!=k.featureId}}function A(k){const q={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const x of k.ordering)if(k.vertexAttributes[x])switch(x){case "normal":q.normal=
!0;break;case "color":q.color=!0;break;case "uv0":q.uv0=!0;break;case "region":q.uvRegion=!0}k.featureAttributes&&k.featureAttributeOrder&&(q.featureIndex=!0);return q}function t(k){const q={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const x of k)switch(x){case "normal":q.normal=!0;break;case "uv0":q.uv0=!0;break;case "color":q.color=!0;break;case "uv-region":q.uvRegion=!0;break;case "feature-index":q.featureIndex=!0}return q}function w(k){return B.hasOwnProperty(k)}
function u(k){return w(k)?B[k].BYTES_PER_ELEMENT:0}const z=r.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),y={position:n.VertexAttribute.POSITION,normal:n.VertexAttribute.NORMAL,color:n.VertexAttribute.COLOR,uv0:n.VertexAttribute.UV0,region:n.VertexAttribute.UVREGION},B={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},C={Float32:(k,q)=>(new DataView(k,0)).getFloat32(q,!0),Float64:(k,q)=>(new DataView(k,
0)).getFloat64(q,!0),UInt8:(k,q)=>(new DataView(k,0)).getUint8(q),Int8:(k,q)=>(new DataView(k,0)).getInt8(q),UInt16:(k,q)=>(new DataView(k,0)).getUint16(q,!0),Int16:(k,q)=>(new DataView(k,0)).getInt16(q,!0),UInt32:(k,q)=>(new DataView(k,0)).getUint32(q,!0),Int32:(k,q)=>(new DataView(k,0)).getInt32(q,!0)};a.createAttributeDataIndex=f;a.createGeometryDescriptor=function(k,q){return k&&k.compressedAttributes&&"draco"===k.compressedAttributes.encoding?t(k.compressedAttributes.attributes):k?l(k):A(q)};
a.createGeometryDescriptorForDraco=t;a.createGeometryDescriptorFromDefinition=l;a.createGeometryDescriptorFromSchema=A;a.createGeometryIndexFromSchema=function(k,q){var x=p(k,q&&q.header);let v=x.byteCount;const D={isDraco:!1,header:x,byteOffset:x.byteCount,byteCount:0,vertexAttributes:{}};x=x.fields;var F=null!=x.vertexCount?x.vertexCount:x.count;for(var G of q.ordering){if(!q.vertexAttributes[G])continue;const L={...q.vertexAttributes[G],byteOffset:v,count:F};D.vertexAttributes[y[G]?y[G]:"_"+G]=
L;v+=u(L.valueType)*L.valuesPerElement*F}G=x.faceCount;if(q.faces&&G){D.faces={};for(var J of q.ordering)q.faces[J]&&(F={...q.faces[J],byteOffset:v,count:G},D.faces[J]=F,v+=u(F.valueType)*F.valuesPerElement*G)}J=x.featureCount;if(q.featureAttributes&&q.featureAttributeOrder&&J){D.featureAttributes={};for(const L of q.featureAttributeOrder)q.featureAttributes[L]&&(x={...q.featureAttributes[L],byteOffset:v,count:J},D.featureAttributes[L]=x,G="UInt64"===x.valueType?8:u(x.valueType),v+=G*x.valuesPerElement*
J)}e(v,k.byteLength,"geometry");D.byteCount=v-D.byteOffset;return D};a.createRawView=d;a.createTypedView=h;a.getBytesPerValue=u;a.isValueType=w;a.readBinaryAttribute=function(k,q,x){if("lepcc-rgb"===k.encoding)return m.decodeRGB(q);if("lepcc-intensity"===k.encoding)return m.decodeIntensity(q);if(null!=k.encoding&&""!==k.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");k["attributeByteCounts "]&&!k.attributeByteCounts&&(z.warn("Warning: Trailing space in 'attributeByteCounts '."),
k.attributeByteCounts=k["attributeByteCounts "]);"ObjectIds"===k.ordering[0]&&k.hasOwnProperty("objectIds")&&(z.warn("Warning: Case error in objectIds"),k.ordering[0]="objectIds");x=f(q,k,x);e(x.byteOffset+x.byteCount,q.byteLength,"attribute");if(k=x.entries.attributeValues||x.entries.objectIds){if("String"===k.valueType){x=x.entries.attributeByteCounts;const v=h(q,x);q=d(q,k);return g(x.count,v,q)}return h(q,k)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};
a.readHeader=p;a.readStringArray=g;a.valueType2ArrayBufferReader=C;a.valueType2TypedArrayClassMap=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function c(p,g,h){return{identifier:String.fromCharCode.apply(null,new Uint8Array(p,h+n.identifierOffset,n.identifierLength)),version:g.getUint16(h+n.versionOffset,!0),checksum:g.getUint32(h+n.checksumOffset,
!0)}}function r(p,g,h){const d=[];g=m(p,g,d);const f=[];for(let e=0;e<d.length;e++){f.length=0;g=m(p,g,f);for(let l=0;l<f.length;l++)h.push(f[l]+d[e])}return g}function m(p,g,h){var d=new DataView(p,g),f=d.getUint8(0);const e=f&31;var l=!!(f&32),A=(f&192)>>6;f=0;if(0===A)f=d.getUint32(1,!0),g+=5;else if(1===A)f=d.getUint16(1,!0),g+=3;else if(2===A)f=d.getUint8(1),g+=2;else throw new b("lepcc-decode-error","Bad count type");if(l)throw new b("lepcc-decode-error","LUT not implemented");p=new Uint8Array(p,
g,Math.ceil(f*e/8));A=l=d=0;const t=-1>>>32-e;for(let w=0;w<f;w++){for(;l<e;)d|=p[A]<<l,l+=8,A+=1;h[w]=d&t;d>>>=e;l-=e;32<l+e&&(d|=p[A-1]>>8-l)}return g+A}const n={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(p){const g=new DataView(p,0);var h=0;const {identifier:d,version:f}=c(p,g,h);h+=n.byteCount;if("Intensity "!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<f)throw new b("lepcc-decode-error","Unknown version");
var e=h;var l=g.getUint32(e+0,!0);var A=g.getUint32(e+4,!0);var t=g.getUint32(e+8,!0);var w=g.getUint16(e+12,!0);var u=g.getUint8(e+14);g.getUint8(e+15);h+=16;if(A*2**32+l!==p.byteLength)throw new b("lepcc-decode-error","Bad size");l=new Uint16Array(t);if(8===u){if(t+h!==p.byteLength)throw new b("lepcc-decode-error","Bad size");p=new Uint8Array(p,h,t);for(h=0;h<t;h++)l[h]=p[h]*w}else if(16===u){if(2*t+h!==p.byteLength)throw new b("lepcc-decode-error","Bad size");p=new Uint16Array(p,h,t);for(h=0;h<
t;h++)l[h]=p[h]*w}else{u=[];if(m(p,h,u)!==p.byteLength)throw new b("lepcc-decode-error","Bad size");for(p=0;p<t;p++)l[p]=u[p]*w}return l};a.decodeRGB=function(p){var g=new DataView(p,0),h=0;const {identifier:d,version:f}=c(p,g,h);h+=n.byteCount;if("ClusterRGB"!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<f)throw new b("lepcc-decode-error","Unknown version");var e=h;var l=g.getUint32(e+0,!0);var A=g.getUint32(e+4,!0);var t=g.getUint32(e+8,!0);var w=g.getUint16(e+12,!0);var u=g.getUint8(e+
14);e=g.getUint8(e+15);h+=16;if(A*2**32+l!==p.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===u||1===u)&&0===e){if(3*w+t+h!==p.byteLength||256<w)throw new b("lepcc-decode-error","Bad count");g=new Uint8Array(p,h,3*w);h=new Uint8Array(p,h+3*w,t);p=new Uint8Array(3*t);for(w=0;w<t;w++)l=h[w],p[3*w]=g[3*l],p[3*w+1]=g[3*l+1],p[3*w+2]=g[3*l+2];return p}if(0===u&&0===e){if(3*t+h!==p.byteLength||0!==w)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(p,h)).slice()}if(2>=
u&&1===e){if(h+3!==p.byteLength||1!==w)throw new b("lepcc-decode-error","Bad count");p=g.getUint8(h);w=g.getUint8(h+1);h=g.getUint8(h+2);g=new Uint8Array(3*t);for(l=0;l<t;l++)g[3*l]=p,g[3*l+1]=w,g[3*l+2]=h;return g}throw new b("lepcc-decode-error","Bad method "+u+","+e);};a.decodeXYZ=function(p){var g=new DataView(p,0),h=0;const {identifier:d,version:f}=c(p,g,h);h+=n.byteCount;if("LEPCC     "!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<f)throw new b("lepcc-decode-error","Unknown version");
var e=h;var l=g.getUint32(e+0,!0);var A=g.getUint32(e+4,!0);var t=g.getFloat64(e+8,!0);var w=g.getFloat64(e+16,!0);var u=g.getFloat64(e+24,!0);var z=g.getFloat64(e+32,!0);var y=g.getFloat64(e+40,!0);var B=g.getFloat64(e+48,!0);var C=g.getFloat64(e+56,!0);var k=g.getFloat64(e+64,!0);var q=g.getFloat64(e+72,!0);var x=g.getUint32(e+80,!0);g.getUint32(e+84,!0);h+=88;if(A*2**32+l!==p.byteLength)throw new b("lepcc-decode-error","Bad size");l=new Float64Array(3*x);A=[];x=[];g=[];e=[];h=r(p,h,A);h=r(p,h,
x);h=r(p,h,g);h=r(p,h,e);if(h!==p.byteLength)throw new b("lepcc-decode-error","Bad length");h=p=0;for(let v=0;v<A.length;v++){h+=A[v];let D=0;for(let F=0;F<x[v];F++){D+=g[p];const G=e[p];l[3*p]=Math.min(z,t+2*C*D);l[3*p+1]=Math.min(y,w+2*k*h);l[3*p+2]=Math.min(B,u+2*q*G);p++}}return{errorX:C,errorY:k,errorZ:q,result:l}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64",
"../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,b,c,r,m){function n(p,g,h){const d=c.create(),f=2**(4*Math.ceil(Math.log(p[3])*Math.LOG2E/4)+1);if(h.isGeographic){var e=f/m.getReferenceEllipsoid(h).radius*180/Math.PI;h=Math.max(-90,Math.min(90,Math.round(p[1]/e)*e));e/=Math.cos((Math.abs(h)-e/2)/180*Math.PI);d[0]=Math.round(p[0]/e)*e;d[1]=h}else h=Math.round(p[1]/f),d[0]=Math.round(p[0]/f)*f,d[1]=h*f;d[2]=Math.round((p[2]+g)/f)*
f;return d}a.computeGlobalTransformation=function(p,g,h,d){p=n(p,g,h);g=b.create();r.computeTranslationToOriginAndRotation(h,p,g,d);return g};a.getLocalOrigin=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(v=[0,0,0],D=[-1,-1,-1],F=[0,0,0,1]){return{center:h.clone(v),halfSize:g.clone(D),quaternion:m.clone(F)}}function w(v,D){const F=l.signedDistance(D,v.center);v=u(v,l.normal(D));return F>v?1:F<-v?-1:0}function u(v,D){r.conjugate(z,v.quaternion);p.transformQuat(y,D,z);v=v.halfSize;return Math.abs(y[0]*v[0])+Math.abs(y[1]*v[1])+Math.abs(y[2]*v[2])}const z=n.create(),y=h.create(),B=h.create(),C=f.create(),k=c.create(),q=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],x=(()=>{const v=new Int8Array(162);let D=0;const F=G=>{for(let J=0;J<G.length;J++)v[D+J]=G[J];D+=6};F([6,2,3,1,5,4]);F([0,2,3,1,5,4]);F([0,2,3,7,5,4]);F([0,1,3,2,6,4]);F([0,1,3,2,0,0]);F([0,1,5,7,3,2]);F([0,1,3,7,6,4]);F([0,1,3,7,6,2]);F([0,1,5,7,6,2]);F([0,1,5,4,6,2]);F([0,1,5,4,0,0]);F([0,1,3,7,5,4]);F([0,2,6,4,0,0]);F([0,0,0,0,0,0]);F([1,3,7,5,0,0]);F([2,3,7,6,4,0]);F([2,3,7,6,0,0]);F([2,3,1,5,7,6]);F([0,1,5,7,6,2]);F([0,1,5,7,6,4]);F([0,1,3,7,6,4]);F([4,5,7,6,2,0]);F([4,5,7,6,0,0]);F([4,
5,1,3,7,6]);F([0,2,3,7,5,4]);F([6,2,3,7,5,4]);F([6,2,3,1,5,4]);return v})();a.ObbArray=function(v){this.buffer=new ArrayBuffer(56*v);this.obbs=Array(v);for(let D=0;D<v;D++)this.obbs[D]={center:h.createView(this.buffer,56*D),halfSize:g.createView(this.buffer,56*D+24),quaternion:m.createView(this.buffer,56*D+36)}};a.clone=function(v){return t(v.center,v.halfSize,v.quaternion)};a.compute=function(v,D){D=D||t();A.computeOBB(v,D);return D};a.corners=function(v,D){for(let F=0;8>F;++F){const G=D[F];G[0]=
F&1?-v.halfSize[0]:v.halfSize[0];G[1]=F&2?-v.halfSize[1]:v.halfSize[1];G[2]=F&4?-v.halfSize[2]:v.halfSize[2];p.transformQuat(G,G,v.quaternion);p.add(G,G,v.center)}};a.create=t;a.intersectLine=function(v,D,F,G=0){r.conjugate(z,v.quaternion);p.subtract(y,D,v.center);D=p.transformQuat(y,y,z);F=p.transformQuat(B,F,z);let J=-Infinity,L=Infinity;for(let K=0;3>K;K++)if(1E-6<Math.abs(F[K])){const O=(G+v.halfSize[K]-D[K])/F[K],P=(-G-v.halfSize[K]-D[K])/F[K];J=Math.max(J,Math.min(O,P));L=Math.min(L,Math.max(O,
P))}else if(D[K]>v.halfSize[K]+G||D[K]<-v.halfSize[K]-G)return!1;return J<=L};a.intersectPlane=w;a.isVisible=function(v,D){return 0>=w(v,D[0])&&0>=w(v,D[1])&&0>=w(v,D[2])&&0>=w(v,D[3])&&0>=w(v,D[4])&&0>=w(v,D[5])};a.maximumDistancePlane=function(v,D){const F=l.signedDistance(D,v.center);v=u(v,l.normal(D));return F+v};a.minimumDistancePlane=function(v,D){const F=l.signedDistance(D,v.center);v=u(v,l.normal(D));return F-v};a.projectedArea=function(v,D,F,G,J){r.conjugate(z,v.quaternion);p.sub(y,D,v.center);
p.transformQuat(y,y,z);var L=y[0]<-v.halfSize[0]?-1:y[0]>v.halfSize[0]?1:0,K=y[1]<-v.halfSize[1]?-1:y[1]>v.halfSize[1]?1:0,O=y[2]<-v.halfSize[2]?-1:y[2]>v.halfSize[2]?1:0;D=Math.abs(L)+Math.abs(K)+Math.abs(O);if(0===D)return Infinity;D=1===D?4:6;L=6*(L+3*K+9*O+13);b.fromQuat(k,v.quaternion);b.scale(k,k,v.halfSize);for(K=0;K<D;K++)O=x[L+K],p.set(y,((O&1)<<1)-1,(O&2)-1,((O&4)>>1)-1),p.transformMat3(y,y,k),p.add(C,v.center,y),C[3]=1,d.transformMat4(C,C,F),O=1/Math.max(1E-6,C[3]),q[2*K]=C[0]*O,q[2*K+
1]=C[1]*O;v=2*D-2;F=q[0]*(q[3]-q[v+1])+q[v]*(q[1]-q[v-1]);for(D=2;D<v;D+=2)F+=q[D]*(q[D+3]-q[D-1]);return Math.abs(F)*G*J*.125};a.projectedRadius=u;a.radius=function(v){return p.len(v.halfSize)};a.set=function(v,D){p.copy(D.center,v.center);p.copy(D.halfSize,v.halfSize);r.copy(D.quaternion,v.quaternion)};a.toAaBoundingBox=function(v,D){D||(D=e.create());var F=b.fromQuat(k,v.quaternion);const G=v.halfSize[0]*Math.abs(F[0])+v.halfSize[1]*Math.abs(F[3])+v.halfSize[2]*Math.abs(F[6]),J=v.halfSize[0]*Math.abs(F[1])+
v.halfSize[1]*Math.abs(F[4])+v.halfSize[2]*Math.abs(F[7]);F=v.halfSize[0]*Math.abs(F[2])+v.halfSize[1]*Math.abs(F[5])+v.halfSize[2]*Math.abs(F[8]);D[0]=v.center[0]-G;D[1]=v.center[1]-J;D[2]=v.center[2]-F;D[3]=v.center[0]+G;D[4]=v.center[1]+J;D[5]=v.center[2]+F;return D};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function b(R,X,W,aa,ba,ia){if(!(1E-6>X[0]*X[0]+X[1]*X[1]+X[2]*X[2]))for(e(F,
W,X),e(G,aa,X),e(J,ba,X),c(R,X,D),K[1]=D[0],L[1]=D[1],O[1]=L[1]-K[1],W=[W,aa,ba],aa=[F,G,J],ba=0;3>ba;++ba){c(R,W[ba],D);K[0]=D[0];L[0]=D[1];c(R,aa[ba],D);K[2]=D[0];L[2]=D[1];O[0]=L[0]-K[0];O[2]=L[2]-K[2];const ma=p(O);ma<ia.quality&&(f(ia.b0,W[ba]),f(ia.b1,X),f(ia.b2,aa[ba]),ia.quality=ma)}}function c(R,X,W){const {data:aa,size:ba}=R;W[0]=Number.POSITIVE_INFINITY;W[1]=Number.NEGATIVE_INFINITY;for(R=0;R<aa.length;R+=ba){const ia=aa[R]*X[0]+aa[R+1]*X[1]+aa[R+2]*X[2];W[0]=Math.min(W[0],ia);W[1]=Math.max(W[1],
ia)}}function r(R,X,W){f(W.center,R);d(W.halfSize,X,.5);W.quaternion[0]=0;W.quaternion[1]=0;W.quaternion[2]=0;W.quaternion[3]=1}function m(R,X,W,aa,ba,ia){c(R,X,D);ba[0]=D[0];ia[0]=D[1];c(R,W,D);ba[1]=D[0];ia[1]=D[1];c(R,aa,D);ba[2]=D[0];ia[2]=D[1]}function n(R,X,W,aa,ba,ia,ma){S[0]=R[0];S[1]=R[1];S[2]=R[2];S[3]=X[0];S[4]=X[1];S[5]=X[2];S[6]=W[0];S[7]=W[1];S[8]=W[2];var ha=ma.quaternion,ka=S,Z=ka[0]+ka[4]+ka[8];if(0<Z)Z=Math.sqrt(Z+1),ha[3]=.5*Z,Z=.5/Z,ha[0]=(ka[5]-ka[7])*Z,ha[1]=(ka[6]-ka[2])*Z,
ha[2]=(ka[1]-ka[3])*Z;else{Z=0;ka[4]>ka[0]&&(Z=1);ka[8]>ka[3*Z+Z]&&(Z=2);const ca=(Z+1)%3,fa=(Z+2)%3;let ea=Math.sqrt(ka[3*Z+Z]-ka[3*ca+ca]-ka[3*fa+fa]+1);ha[Z]=.5*ea;ea=.5/ea;ha[3]=(ka[3*ca+fa]-ka[3*fa+ca])*ea;ha[ca]=(ka[3*ca+Z]+ka[3*Z+ca])*ea;ha[fa]=(ka[3*fa+Z]+ka[3*Z+fa])*ea}g(U,aa,ba);d(U,U,.5);d(ma.center,R,U[0]);d(T,X,U[1]);g(ma.center,ma.center,T);d(T,W,U[2]);g(ma.center,ma.center,T);d(ma.halfSize,ia,.5)}function p(R){return R[0]*R[1]+R[0]*R[2]+R[1]*R[2]}function g(R,X,W){R[0]=X[0]+W[0];R[1]=
X[1]+W[1];R[2]=X[2]+W[2]}function h(R,X,W){R[0]=X[0]-W[0];R[1]=X[1]-W[1];R[2]=X[2]-W[2]}function d(R,X,W){R[0]=X[0]*W;R[1]=X[1]*W;R[2]=X[2]*W}function f(R,X,W=0){R[0]=X[W+0];R[1]=X[W+1];R[2]=X[W+2]}function e(R,X,W){const aa=X[0],ba=X[1];X=X[2];const ia=W[0],ma=W[1];W=W[2];R[0]=ba*W-X*ma;R[1]=X*ia-aa*W;R[2]=aa*ma-ba*ia}function l(R,X){var W=X[0]*X[0]+X[1]*X[1]+X[2]*X[2];0<W&&(W=1/Math.sqrt(W),R[0]=X[0]*W,R[1]=X[1]*W,R[2]=X[2]*W)}function A(R,X){const W=X[0]-R[0],aa=X[1]-R[1];R=X[2]-R[2];return W*
W+aa*aa+R*R}const t=[0,0,0],w=[0,0,0],u=[0,0,0],z=[0,0,0],y=[0,0,0],B=[0,0,0],C=[0,0,0],k=[0,0,0],q=[0,0,0],x=[0,0,0],v=[0,0,0],D=[0,0],F=[0,0,0],G=[0,0,0],J=[0,0,0],L=[0,0,0],K=[0,0,0],O=[0,0,0],P=[0,0,0],N=[0,0,0],H=[0,0,0],E=[0,0,0],I=[0,0,0],M=[0,0,0],Q=[0,0,0],T=[0,0,0],S=[1,0,0,0,1,0,0,0,1],U=[0,0,0];let Y=function(R){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var X=0;this.minProj=new Float64Array(this.buffer,X,7);X+=56;this.maxProj=new Float64Array(this.buffer,
X,7);X+=56;for(var W=0;7>W;++W)this.minVert[W]=new Float64Array(this.buffer,X,3),X+=24;for(W=0;7>W;++W)this.maxVert[W]=new Float64Array(this.buffer,X,3),X+=24;for(X=0;7>X;++X)this.minProj[X]=Number.POSITIVE_INFINITY,this.maxProj[X]=Number.NEGATIVE_INFINITY;X=Array(7);W=Array(7);const {data:aa,size:ba}=R;for(R=0;R<aa.length;R+=ba){var ia=aa[R];ia<this.minProj[0]&&(this.minProj[0]=ia,X[0]=R);ia>this.maxProj[0]&&(this.maxProj[0]=ia,W[0]=R);ia=aa[R+1];ia<this.minProj[1]&&(this.minProj[1]=ia,X[1]=R);ia>
this.maxProj[1]&&(this.maxProj[1]=ia,W[1]=R);ia=aa[R+2];ia<this.minProj[2]&&(this.minProj[2]=ia,X[2]=R);ia>this.maxProj[2]&&(this.maxProj[2]=ia,W[2]=R);ia=aa[R]+aa[R+1]+aa[R+2];ia<this.minProj[3]&&(this.minProj[3]=ia,X[3]=R);ia>this.maxProj[3]&&(this.maxProj[3]=ia,W[3]=R);ia=aa[R]+aa[R+1]-aa[R+2];ia<this.minProj[4]&&(this.minProj[4]=ia,X[4]=R);ia>this.maxProj[4]&&(this.maxProj[4]=ia,W[4]=R);ia=aa[R]-aa[R+1]+aa[R+2];ia<this.minProj[5]&&(this.minProj[5]=ia,X[5]=R);ia>this.maxProj[5]&&(this.maxProj[5]=
ia,W[5]=R);ia=aa[R]-aa[R+1]-aa[R+2];ia<this.minProj[6]&&(this.minProj[6]=ia,X[6]=R);ia>this.maxProj[6]&&(this.maxProj[6]=ia,W[6]=R)}for(R=0;7>R;++R)ia=X[R],f(this.minVert[R],aa,ia),ia=W[R],f(this.maxVert[R],aa,ia)},V=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(R,X){const {data:W,size:aa}=R;var ba=W.length/aa;if(!(0>=ba)){var ia=new Y(R);g(t,ia.minProj,ia.maxProj);d(t,t,.5);h(w,ia.maxProj,ia.minProj);var ma=p(w),ha=new V;ha.quality=ma;14>ba&&(R=
{data:new Float64Array(ia.buffer,112,42),size:3});var ka=[0,0,0],Z=[0,0,0],ca=[0,0,0];ba=[0,0,0];var fa=[0,0,0],ea=[0,0,0],da=[0,0,0];var la=R;var oa=A(ia.maxVert[0],ia.minVert[0]),ra=0;for(var Aa=1;7>Aa;++Aa){const va=A(ia.maxVert[Aa],ia.minVert[Aa]);va>oa&&(oa=va,ra=Aa)}f(ka,ia.minVert[ra]);f(Z,ia.maxVert[ra]);if(1E-6>A(ka,Z))la=1;else{h(ba,ka,Z);l(ba,ba);const {data:va,size:Ja}=la;ia=Number.NEGATIVE_INFINITY;oa=0;for(ra=0;ra<va.length;ra+=Ja)v[0]=va[ra]-ka[0],v[1]=va[ra+1]-ka[1],v[2]=va[ra+2]-
ka[2],Aa=ba[0]*v[0]+ba[1]*v[1]+ba[2]*v[2],Aa=v[0]*v[0]+v[1]*v[1]+v[2]*v[2]-Aa*Aa/(ba[0]*ba[0]+ba[1]*ba[1]+ba[2]*ba[2]),Aa>ia&&(ia=Aa,oa=ra);f(ca,va,oa);1E-6>ia?la=2:(h(fa,Z,ca),l(fa,fa),h(ea,ca,ka),l(ea,ea),e(da,fa,ba),l(da,da),b(la,da,ba,fa,ea,ha),la=0)}switch(la){case 1:r(t,w,X);return;case 2:ma=R;f(N,ba);Math.abs(ba[0])>Math.abs(ba[1])&&Math.abs(ba[0])>Math.abs(ba[2])?N[0]=0:Math.abs(ba[1])>Math.abs(ba[2])?N[1]=0:N[2]=0;1E-6>N[0]*N[0]+N[1]*N[1]+N[2]*N[2]&&(N[0]=N[1]=N[2]=1);e(H,ba,N);l(H,H);e(E,
ba,H);l(E,E);m(ma,ba,H,E,I,M);h(Q,M,I);n(ba,H,E,I,M,Q,X);return}la=R;ia=D;const {data:ua,size:za}=la;f(z,ua);f(u,z);ia[0]=P[0]*da[0]+P[1]*da[1]+P[2]*da[2];ia[1]=ia[0];for(oa=za;oa<ua.length;oa+=za)ra=ua[oa]*da[0]+ua[oa+1]*da[1]+ua[oa+2]*da[2],ra<ia[0]&&(ia[0]=ra,f(z,ua,oa)),ra>ia[1]&&(ia[1]=ra,f(u,ua,oa));da=ka[0]*da[0]+ka[1]*da[1]+ka[2]*da[2];D[1]-1E-6<=da&&(u[0]=void 0);D[0]+1E-6>=da&&(z[0]=void 0);void 0!==u[0]&&(h(y,u,ka),l(y,y),h(B,u,Z),l(B,B),h(C,u,ca),l(C,C),e(k,B,ba),l(k,k),e(q,C,fa),l(q,
q),e(x,y,ea),l(x,x),b(la,k,ba,B,y,ha),b(la,q,fa,C,B,ha),b(la,x,ea,y,C,ha));void 0!==z[0]&&(h(y,z,ka),l(y,y),h(B,z,Z),l(B,B),h(C,z,ca),l(C,C),e(k,B,ba),l(k,k),e(q,C,fa),l(q,q),e(x,y,ea),l(x,x),b(la,k,ba,B,y,ha),b(la,q,fa,C,B,ha),b(la,x,ea,y,C,ha));m(R,ha.b0,ha.b1,ha.b2,I,M);R=[0,0,0];h(R,M,I);ha.quality=p(R);ha.quality<ma?n(ha.b0,ha.b1,ha.b2,I,M,R,X):r(t,w,X)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../../../../../core/typedArrayUtil","./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,b,c,r,m){function n(p,g,h){const d=[],f=[];let e=h.length,l=h.length;g.forEachComponent(A=>{0<p[A]?(e!==A-1&&(d.length&&d.push(h[e+1]-d[d.length-1]),d.push(h[A])),e=A):(l!==A-1&&(f.length&&f.push(h[l+1]-f[f.length-1]),f.push(h[A])),l=A);return!0});d.length&&d.push(h[e+1]-d[d.length-1]);f.length&&f.push(h[l+1]-f[f.length-1]);return{highlightRanges:d,
defaultRanges:f}}return function(p){function g(d,f){var e=p.call(this)||this;e.pickability=null;e.highlightCounts=null;e.verticalOffsets=null;e.cachedGeometryRanges=null;e.cachedHighlightRanges=null;e.cachedDefaultRanges=null;e.offsets=c.slice(f);f=e.count;e.visibility=new r.ComponentRangeRunLengthEncoded(f);e.materialDataBuffer=d.getBuffer(f);e.materialDataIndices=new Uint16Array(f);for(d=0;d<f;d++)e.materialDataIndices[d]=e.materialDataBuffer.acquireIndex();return e}a._inheritsLoose(g,p);var h=
g.prototype;h.dispose=function(){p.prototype.dispose.call(this);for(let d=0;d<this.count;d++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[d])};h.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};h.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};h._updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:d,
defaultRanges:f}=n(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=d;this.cachedDefaultRanges=f}};a._createClass(g,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();
return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return g}(m.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let b=function(){function c(m){this._totalCount=m;this._indexRanges=[0,m]}var r=c.prototype;r.allVisible=function(){return this.componentCount()===
this._totalCount};r.allInvisible=function(){return 0===this._indexRanges.length};r.componentCount=function(){const m=this._indexRanges;let n=0;for(let p=0;p<m.length;p+=2)n+=m[p+1];return n};r.reset=function(m){if("all"===m||m.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const g=[];if(0!==m.length){var n=m[0],p=1;for(let h=1;h<m.length;h++){const d=m[h];n+p===d?p+=1:(g.push(n),g.push(p),n=d,p=1)}g.push(n);g.push(p)}m=g}this._indexRanges=m}};r.forEachComponent=function(m){const n=
this._indexRanges;for(let g=0;g<n.length;g+=2){var p=n[g];const h=p+n[g+1];for(;p<h;p++)if(!m(p))return!1}return!0};r.forEachComponentRange=function(m){const n=this._indexRanges;for(let p=0;p<n.length;p+=2){const g=n[p];if(!m(g,g+n[p+1]))return!1}return!0};r.computeOffsetRanges=function(m){const n=Array(this._indexRanges.length),p=this._indexRanges;for(let h=0;h<p.length;h+=2){var g=p[h];const d=m[g];g=m[g+p[h+1]];n[h]=d;n[h+1]=g-d}return n};return c}();a.ComponentRangeRunLengthEncoded=b;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,r){let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.visible=a.State.Hidden;return g}b._inheritsLoose(p,n);return p}(r.AutoDisposable);c.__decorate([r.autoDispose()],m.prototype,"renderable",void 0);
c.__decorate([r.autoDispose()],m.prototype,"components",void 0);a.State=void 0;(function(n){n[n.Hidden=0]="Hidden";n[n.Visible=1]="Visible"})(a.State||(a.State={}));a.ComponentObject=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/Indices ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(){function A(w,u){this._indices=b.isSome(w.indices)?w.indices:h.generateDefaultIndexArray(w.positions.length/3);this._positions=new n.BufferViewVec3f(w.positions);this._components=u;this._componentIntersectionData=Array(u.count)}var t=A.prototype;t.getComponentAabb=function(w,u){if(b.isSome(this._perComponentAabbs)){for(let z=0;6>z;z++)u[z]=this._perComponentAabbs[6*w+z];return u}this._computePerComponentAabbs();return this.getComponentAabb(w,u)};t.getComponentPositions=
function(w,u){u.indices=this._indices;u.data=this._positions.typedBuffer;u.stride=this._positions.typedBufferStride;u.startIndex=this._components.offsets[w];u.endIndex=this._components.offsets[w+1]};t.intersect=function(w,u,z,y,B,C,k){const q={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},x=this._indices,v=this._components.offsets,D=d.computeInvDir(w,u,e),F=w[2],G=u[2];this._components.visibility.forEachComponent(J=>{if(!g.getVisibility(this._components.pickability,
J))return!0;var L=this.getComponentAabb(J,l);if(b.isSome(C)){var K=C[J];b.isSome(B)?B.componentOffset=K:(w[2]=F-K,u[2]=G-K)}b.isSome(B)&&B.applyToAabb(L);if(!d.intersectAabbInvDir(L,w,D,z))return!0;L=v[J]/3;K=v[J+1]/3;const O=(N,H,E)=>{k(J,N,c.transformMat3(H,H,y),E)},P=K-L;b.isNone(B)&&P>p.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[J]&&(this._componentIntersectionData[J]=new p.ComponentIntersectionData(this._indices,L,K,q)),this._componentIntersectionData[J].intersectRay({r0:w,
r1:u},O)):d.intersectTriangles(w,u,L,K,x,q,void 0,B,O);return!0})};t._computePerComponentAabbs=function(){const w=this._components.count;this._perComponentAabbs=new Float32Array(6*w);const u=this._indices,z=this._positions.typedBuffer,y=this._positions.typedBufferStride,B=this._components.offsets;let C=0;for(let x=0;x<w;x++){var k=B[x];const v=B[x+1];let D=Infinity,F=Infinity,G=Infinity,J=-Infinity,L=-Infinity,K=-Infinity;for(;k<v;k++){var q=u[k]*y;const O=z[q],P=z[q+1];q=z[q+2];D=Math.min(D,O);F=
Math.min(F,P);G=Math.min(G,q);J=Math.max(J,O);L=Math.max(L,P);K=Math.max(K,q)}this._perComponentAabbs[C++]=D;this._perComponentAabbs[C++]=F;this._perComponentAabbs[C++]=G;this._perComponentAabbs[C++]=J;this._perComponentAabbs[C++]=L;this._perComponentAabbs[C++]=K}};a._createClass(A,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return A}();const e=r.create(),l=m.create();return f})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],
function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,r){if(null==c)return!0;const {isVisibleBit:m,data:n}=c,p=8*n.BYTES_PER_ELEMENT;return r<n.length*p?(c=r/p|0,0!==(n[c]&1<<r-c*p)===m):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,r,m,n){if(m>=r)return c;null==c&&(c=b());let p=c.data;const g=8*p.BYTES_PER_ELEMENT,h=m/g|0,d=m-g*h,f=p;n=n===c.isVisibleBit;m<f.length*g||!n||(m=Math.max(h+1,Math.ceil(1.5*f.length)),
m=Math.min(m,((r-1)/g|0)+1),p=new Uint32Array(m),p.set(f));h<p.length&&(p[h]=p[h]&~(1<<d)|(n?1:0)<<d);c.data=p;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let b=function(){function c(r,m,n){this.material=r;this.geometry=m;this.meta=n}c.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return c}();a.Renderable=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,r){let m=function(n){function p(g,h,d,f){var e=n.call(this)||this;e.primitiveType=h;e.parameters=d;e.indexed=f;e.vao=g;return e}b._inheritsLoose(p,n);return p}(r.AutoDisposable);c.__decorate([r.autoDispose()],
m.prototype,"vao",void 0);a.RenderGeometry=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){let c=function(){function r(n){this._objects=n}var m=r.prototype;m.submit=function(n,p){this._objects.preSubmit(p);this._objects.visibleObjects.forAll(g=>g.renderable.material.submit(n,p,g))};m.queryShadowCasterDepthRange=function(n){return this._objects.visibleObjects.length?
b.computeDepthRange(n,this._objects.visibleObjects):null};return r}();a.RenderSubmitSystem=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(L,K,O){return g.set(L,K.data[O+0],K.data[O+1],K.data[O+2])}function A(L,K){L.push(K[0]);L.push(K[1]);L.push(K[2])}function t(L,K,O,P){n.conjugate(x,L.quaternion);g.sub(v,K,L.center);g.transformQuat(v,v,x);const N=8*((v[0]<-L.halfSize[0]?-1:v[0]>L.halfSize[0]?1:0)+3*(v[1]<-L.halfSize[1]?-1:v[1]>L.halfSize[1]?1:0)+9*(v[2]<-L.halfSize[2]?-1:v[2]>L.halfSize[2]?1:0)+13);K=k[N];if(0===K)return K;r.fromQuat(q,L.quaternion);r.scale(q,q,L.halfSize);const H=(E,I)=>
{I=k[N+I+1];g.set(E,((I&1)<<1)-1,(I&2)-1,((I&4)>>1)-1);g.transformMat3(E,E,q);return g.add(E,L.center,E)};O.length=0;A(O,H(D,0));A(O,H(F,1));A(O,H(v,2));A(O,H(G,3));P(O);if(1===K)return K;O.length=0;A(O,D);A(O,G);A(O,H(v,4));A(O,H(J,5));P(O);if(2===K)return K;O.length=0;A(O,D);A(O,J);A(O,H(v,6));A(O,F);P(O);return K}const w=new c({allocator:L=>L||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:L=>{L.object=b.nullifyNonNullableForDispose(L.object);return L}}),u=e.empty(),z=h.create(),
y=h.create(),B=new c({deallocator:null}),C=new c({deallocator:null}),k=(()=>{const L=new Int8Array(216);let K=0;const O=P=>{for(let N=0;N<P.length;N++)L[K+N]=P[N];K+=8};O([3,0,6,2,3,1,5,4]);O([2,0,2,3,1,5,4,0]);O([3,1,0,2,3,7,5,4]);O([2,0,1,3,2,6,4,0]);O([1,0,1,3,2,0,0,0]);O([2,1,5,7,3,2,0,0]);O([3,2,0,1,3,7,6,4]);O([2,2,0,1,3,7,6,0]);O([3,3,0,1,5,7,6,2]);O([2,0,1,5,4,6,2,0]);O([1,0,1,5,4,0,0,0]);O([2,1,3,7,5,4,0,0]);O([1,0,2,6,4,0,0,0]);O([0,0,0,0,0,0,0,0]);O([1,1,3,7,5,0,0,0]);O([2,2,3,7,6,4,0,
0]);O([1,2,3,7,6,0,0,0]);O([2,3,1,5,7,6,2,0]);O([3,4,0,1,5,7,6,2]);O([2,5,7,6,4,0,1,0]);O([3,5,0,1,3,7,6,4]);O([2,4,5,7,6,2,0,0]);O([1,4,5,7,6,0,0,0]);O([2,5,1,3,7,6,4,0]);O([3,6,0,2,3,7,5,4]);O([2,6,2,3,7,5,4,0]);O([3,7,6,2,3,1,5,4]);return L})(),q=m.create(),x=p.create(),v=h.create(),D=h.create(),F=h.create(),G=h.create(),J=h.create();a.computeDepthRange=function(L,K){const O=e.empty(),{eye:P,frustum:N,viewForward:H}=L;K.forAll(E=>{var I=b.isSome(E.offsetObb)?E.offsetObb:E.obb;const M=g.dot(g.sub(v,
I.center,P),H),Q=f.projectedRadius(I,H);if(!e.within(O,M-Q)||!e.within(O,M+Q)){a:{var T=0;for(let S=0;4>S;S++){const U=f.intersectPlane(I,N[S]);if(0<U){I=-1;break a}0===U&&(T|=1<<S)}I=T}-1!==I&&(0===I?(u.far=M+Q,u.near=M-Q,e.union(O,u)):(T=w.pushNew(),T.near=M-Q,T.far=M+Q,T.mask=I,T.object=E))}});for(L=0;L<w.length;L++){const E=w.data[L];e.within(O,E.near)&&e.within(O,E.far)||(u.far=E.far,u.near=Infinity,K=b.isSome(E.object.offsetObb)?E.object.offsetObb:E.object.obb,0===t(K,P,B,I=>{var M=C;for(var Q=
0;4>Q&&0<I.length;Q++){if(0===(E.mask&1<<Q))continue;var T=N[Q],S=I,U=M;U.length=0;const Y=S.length-3;l(z,S,Y);const V=d.signedDistance(T,z);0>=V&&(U.push(z[0]),U.push(z[1]),U.push(z[2]));let R=0,X=V;for(R;R<Y;R+=3){l(y,S,R);const W=d.signedDistance(T,y);0>X*W&&(g.lerp(z,y,z,W/(W-X)),A(U,z));0>=W&&A(U,y);X=W;g.copy(z,y)}0>X*V&&(l(y,S,Y),g.lerp(z,y,z,V/(V-X)),A(U,z));T=I;I=M;M=T}for(M=0;M<I.length;M+=3)g.set(z,I.data[M+0],I.data[M+1],I.data[M+2]),Q=g.dot(g.sub(z,z,P),H),u.near=Math.min(u.near,Q)})&&
(u.near=0),e.union(O,u))}w.length=0;return O};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(r,m){return{near:r,far:m}}function c(r,m,n){r.near=m;r.far=n;return r}a.ZERO={near:0,far:0};a.create=b;a.empty=function(r){return r?c(r,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=c;a.union=function(r,m,n=r){n.near=Math.min(r.near,m.near);n.far=Math.max(r.far,m.far);
return n};a.within=function(r,m){return r.near<=m&&m<=r.far};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,r){a.createVertexBufferLayout=function(m){const n=b.newLayout().vec3f(r.VertexAttribute.POSITION);
m.normals&&n.vec2i16(r.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});m.textureCoordinates===c.TextureCoordinateAttributeType.Default?n.vec2f(r.VertexAttribute.UV0):m.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(n.vec2f(r.VertexAttribute.UV0),n.vec4u16(r.VertexAttribute.UVREGION,{glNormalized:!0}));m.colors&&n.vec4u8(r.VertexAttribute.COLOR,{glNormalized:!0});return n.alignTo(4)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../layers/support/symbolColorUtils ../../../../support/debugFlags ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J){function L(H){switch(H){case B.MaterialSubPass.Color:return C.ShaderOutput.Color;case B.MaterialSubPass.Alpha:return C.ShaderOutput.Alpha;case B.MaterialSubPass.Depth:return C.ShaderOutput.Depth;case B.MaterialSubPass.Normal:return C.ShaderOutput.Normal;case B.MaterialSubPass.ObjectAndLayerIdColor:return C.ShaderOutput.ObjectAndLayerIdColor}}let K=function(H){function E(M,Q){var T=H.call(this)||this;T.toMapSpace=Q;T.baseColor=d.fromValues(1,
1,1,1);T.usePBR=!1;T.hasParametersFromSource=!1;T.mrrFactors=g.fromValues(1,1,.5);T.emissiveFactor=g.fromValues(0,0,0);T.baseColorTexture=null;T.metallicRoughnessTexture=null;T.emissionTexture=null;T.occlusionTexture=null;T.normalTexture=null;T.objectOpacity=1;T.commonMaterialParameters=new P;T.componentParameters=new N;T.textureAlphaCutoff=v.defaultMaskAlphaCutoff;T.alphaDiscardMode=G.AlphaDiscardMode.Opaque;T.isIntegratedMesh=!1;T.polygonOffsetEnabled=!1;T.ellipsoidMode=D.EllipsoidMode.Earth;T.hasOccludees=
!1;T._techniqueConfiguration=new t.ComponentTechniqueConfiguration;Q=new F.TwoVectorPosition(M.position);const S=n.clone(M.rotationScale);m.invert(S,S);T.transformNormalGlobalFromModel=m.transpose(S,S);T.transformWorldFromModelTL=Q.low;T.transformWorldFromModelTH=Q.high;T.transformWorldFromModelRS=M.rotationScale;return T}b._inheritsLoose(E,H);var I=E.prototype;I.dispose=function(){this._technique=r.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=
this.baseColorTexture=null};I.prepareTechnique=function(M,Q,T,S){const U=this._techniqueConfiguration;U.hasVertexColors=S.colors;U.hasNormals=S.normals;U.textureCoordinateType=S.textureCoordinates;U.hasMetallicRoughnessTexture=r.isSome(this.metallicRoughnessTexture);U.hasEmissionTexture=r.isSome(this.emissionTexture);U.hasOcclusionTexture=r.isSome(this.occlusionTexture);U.hasNormalTexture=r.isSome(this.normalTexture);U.transparencyPassType=Q.identifier===B.RenderPassIdentifier.Material&&null!=T.transparencyPassType?
T.transparencyPassType:J.TransparencyPassType.NONE;U.hasMultipassTerrain=Q.identifier===B.RenderPassIdentifier.Material&&null!=T.multipassTerrain?T.multipassTerrain.enabled:!1;U.cullAboveGround=Q.identifier===B.RenderPassIdentifier.Material&&null!=T.multipassTerrain?T.multipassTerrain.cullAboveGround:!1;U.ellipsoidMode=this.ellipsoidMode;U.componentData=this.componentParameters.type;U.cullFace=this.commonMaterialParameters.cullFace;U.doubleSidedMode=this.commonMaterialParameters.doubleSided?q.NormalsDoubleSidedMode.View:
q.NormalsDoubleSidedMode.None;U.hasBaseColorTexture=r.isSome(this.baseColorTexture);S=this._computeWhichMaterialPass();U.blendingEnabled=S===O.Transparent||S===O.OpaqueAndTransparent;U.alphaDiscardMode=this.alphaDiscardMode;U.integratedMeshMode=this.isIntegratedMesh?(0===T.overlays.length?0:r.isSome(T.overlays[l.OverlayIndex.INNER].getColorTextureNoRasterImage()))?u.getOverlayNormalTexture(T)?t.IntegratedMeshMode.ColorOverlayWithWater:t.IntegratedMeshMode.ColorOverlay:t.IntegratedMeshMode.NoOverlay:
t.IntegratedMeshMode.None;U.useLegacyTerrainShading=this.isIntegratedMesh&&e.TERRAIN_USE_LEGACY_SHADING;U.hasPolygonOffset=this.polygonOffsetEnabled;S=this.hasParametersFromSource&&r.isNone(this.baseColorTexture);U.pbrMode=U.integratedMeshMode===t.IntegratedMeshMode.ColorOverlayWithWater?x.PBRMode.WaterOnIntegratedMesh:this.usePBR?S?x.PBRMode.Schematic:x.PBRMode.Normal:x.PBRMode.Disabled;U.normalType=U.integratedMeshMode===t.IntegratedMeshMode.None?U.hasNormals?k.NormalAttributeType.CompressedAttribute:
k.NormalAttributeType.ScreenDerivative:k.NormalAttributeType.Ground;U.hasSlicePlane=r.isSome(T.slicePlane)&&this.commonMaterialParameters.hasSlicePlane;Q.identifier===B.RenderPassIdentifier.ShadowMap?(U.output=C.ShaderOutput.Shadow,U.vertexDiscardMode=z.VertexDiscardMode.None):Q.identifier===B.RenderPassIdentifier.Highlight?(U.output=C.ShaderOutput.Highlight,U.vertexDiscardMode=z.VertexDiscardMode.None):(this._computeWhichMaterialPass()===O.OpaqueAndTransparent?U.vertexDiscardMode=Q.transparent?z.VertexDiscardMode.Opaque:
z.VertexDiscardMode.Transparent:U.vertexDiscardMode=z.VertexDiscardMode.None,U.output=L(Q.subPass),Q.subPass===B.MaterialSubPass.Alpha&&(U.hasOccludees=T.hasOccludees),Q.subPass===B.MaterialSubPass.Color?(U.receiveAmbientOcclusion=T.ssaoHelper.ready,U.hasOccludees=T.hasOccludees,U.receiveShadows=T.shadowMap.ready,U.hasScreenSpaceReflections=T.ssr.enabled,U.hasCloudsReflections=r.isSome(T.cloudsFade.data)):(U.receiveAmbientOcclusion=!1,U.receiveShadows=!1),U.snowCover=this.hasSnowCover(T),Q.subPass===
B.MaterialSubPass.ObjectAndLayerIdColor&&(U.objectAndLayerIdColor=!0));this._technique=M.releaseAndAcquire(A.ComponentTechnique,U,this._technique);this._setClean();return this._technique};I.hasSnowCover=function(M){return r.isSome(M.weather)&&M.weatherVisible&&"snowy"===M.weather.type&&"enabled"===M.weather.snowCover};I.submit=function(M,Q,T){if(0!==this.objectOpacity){var S=T.renderable.geometry,U=T.components;T=T.renderable.meta.cameraDepthSquared;var Y=U.geometryRanges,V=U.highlightRanges;U=U.defaultShadowMapRanges;
switch(this._computeWhichMaterialPass()){case O.Opaque:M.materialOpaque.submitDraw(this,S,Y,T);break;case O.Transparent:M.materialTransparent.submitDraw(this,S,Y,T);break;case O.OpaqueAndTransparent:M.materialOpaque.submitDraw(this,S,Y,T);M.materialTransparent.submitDraw(this,S,Y,T);break;case O.IntegratedMesh:M.materialIntegratedMesh.submitDraw(this,S,Y,T),(0===Q.overlays.length?0:r.isSome(Q.overlays[l.OverlayIndex.INNER].getValidTexture(l.RenderTargetType.Highlight)))&&M.highlightIntegratedMesh.submitDraw(this,
S,Y,T)}(Q=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&M.shadowMap.submitDraw(this,S,Y,T);r.isSome(V)&&(M.highlight.submitDraw(this,S,V,T),Q&&M.highlightShadowMap.submitDraw(this,S,V,T));Q&&r.isSome(U)&&M.defaultShadowMap.submitDraw(this,S,U,T)}};I._computeWhichMaterialPass=function(){return this.isIntegratedMesh?O.IntegratedMesh:1>this.objectOpacity?O.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?O.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===
G.AlphaDiscardMode.Blend||this.alphaDiscardMode===G.AlphaDiscardMode.MaskBlend?O.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?O.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?O.Transparent:O.OpaqueAndTransparent};b._createClass(E,[{key:"texture",get:function(){return r.isSome(this.baseColorTexture)?this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return r.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return r.isSome(this.emissionTexture)?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",get:function(){return r.isSome(this.occlusionTexture)?this.occlusionTexture.glTexture:null}},{key:"textureNormal",get:function(){return r.isSome(this.normalTexture)?this.normalTexture.glTexture:null}}]);return E}(y.MaterialBase);c.__decorate([y.parameter({vectorOps:h.vec4})],K.prototype,"baseColor",void 0);c.__decorate([y.parameter()],
K.prototype,"usePBR",void 0);c.__decorate([y.parameter()],K.prototype,"hasParametersFromSource",void 0);c.__decorate([y.parameter({vectorOps:p.vec3})],K.prototype,"mrrFactors",void 0);c.__decorate([y.parameter({vectorOps:p.vec3})],K.prototype,"emissiveFactor",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"baseColorTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"metallicRoughnessTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"emissionTexture",
void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"occlusionTexture",void 0);c.__decorate([y.parameter({dispose:!0})],K.prototype,"normalTexture",void 0);c.__decorate([y.parameter()],K.prototype,"objectOpacity",void 0);c.__decorate([y.parameterBlock()],K.prototype,"commonMaterialParameters",void 0);c.__decorate([y.parameterBlock()],K.prototype,"componentParameters",void 0);c.__decorate([y.parameter()],K.prototype,"textureAlphaCutoff",void 0);c.__decorate([y.parameter()],K.prototype,"alphaDiscardMode",
void 0);c.__decorate([y.parameter()],K.prototype,"isIntegratedMesh",void 0);c.__decorate([y.parameter()],K.prototype,"polygonOffsetEnabled",void 0);c.__decorate([y.parameter()],K.prototype,"ellipsoidMode",void 0);c.__decorate([y.parameter()],K.prototype,"hasOccludees",void 0);var O;(function(H){H[H.Opaque=0]="Opaque";H[H.Transparent=1]="Transparent";H[H.OpaqueAndTransparent=2]="OpaqueAndTransparent";H[H.IntegratedMesh=3]="IntegratedMesh"})(O||(O={}));let P=function(H){function E(){var I=H.apply(this,
arguments)||this;I.doubleSided=!1;I.cullFace=G.CullFaceOptions.Back;I.hasSlicePlane=!0;return I}b._inheritsLoose(E,H);return E}(y.MaterialParameterBlock);c.__decorate([y.parameter()],P.prototype,"doubleSided",void 0);c.__decorate([y.parameter()],P.prototype,"cullFace",void 0);c.__decorate([y.parameter()],P.prototype,"hasSlicePlane",void 0);let N=function(H){function E(){var I=H.apply(this,arguments)||this;I.externalColor=d.fromValues(1,1,1,1);I.externalColorMixMode=f.ColorMixModeEnum.Multiply;I.castShadows=
a.ComponentParameterSummary.All;return I}b._inheritsLoose(E,H);b._createClass(E,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===f.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},
{key:"type",get:function(){return w.ComponentDataType.Uniform}}]);return E}(y.MaterialParameterBlock);c.__decorate([y.parameter({vectorOps:h.vec4})],N.prototype,"externalColor",void 0);c.__decorate([y.parameter()],N.prototype,"externalColorMixMode",void 0);c.__decorate([y.parameter()],N.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(H){H[H.All=0]="All";H[H.Some=1]="Some";H[H.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));p=function(H){function E(){var I=
H.apply(this,arguments)||this;I.texture=null;I.transparent=a.ComponentParameterSummary.None;I.opaqueOverride=a.ComponentParameterSummary.None;I.castShadows=a.ComponentParameterSummary.None;return I}b._inheritsLoose(E,H);b._createClass(E,[{key:"type",get:function(){return w.ComponentDataType.Varying}}]);return E}(y.MaterialParameterBlock);c.__decorate([y.parameter()],p.prototype,"texture",void 0);c.__decorate([y.parameter()],p.prototype,"transparent",void 0);c.__decorate([y.parameter()],p.prototype,
"opaqueOverride",void 0);c.__decorate([y.parameter()],p.prototype,"castShadows",void 0);a.CommonMaterialParameters=P;a.ComponentMaterial=K;a.ComponentParametersUniform=N;a.ComponentParametersVarying=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/context-util ../../../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){d=function(B){function C(){return B.apply(this,arguments)||this}c._inheritsLoose(C,B);var k=C.prototype;k.initializeConfiguration=function(q,x){x.hasWebGL2Context=q.rctx.type===u.ContextType.WEBGL2;x.spherical=q.viewingMode===r.ViewingMode.Global;x.doublePrecisionRequiresObfuscation=g.doublePrecisionRequiresObfuscation(q.rctx)};k.initializeProgram=function(q){return new l.Program(q.rctx,C.shader.get().build(this.configuration),y)};k._setPipelineState=
function(q){const x=this.configuration,v=x.integratedMeshMode!==m.IntegratedMeshMode.None,D=q===t.TransparencyPassType.NONE,F=q===t.TransparencyPassType.FrontFace;return z.makePipelineState({blending:x.output!==p.ShaderOutput.Color&&x.output!==p.ShaderOutput.Alpha||!x.blendingEnabled?null:D?e.blendingDefault:e.oitBlending(q),culling:z.cullingParams(x.cullFace),depthTest:{func:e.oitDepthTest(q)},depthWrite:D||F?z.defaultDepthWriteParams:null,colorWrite:z.defaultColorWriteParams,stencilWrite:v||x.hasOccludees?
A.stencilWriteMaskOn:null,stencilTest:v?A.replaceBitWhenDepthTestPasses(f.StencilBits.IntegratedMeshMaskExcluded):x.hasOccludees?A.stencilBaseAllZerosParams:null,polygonOffset:D||F?x.hasPolygonOffset?{factor:2,units:2}:null:e.OITPolygonOffset})};k.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return C}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(n.ComponentShader,()=>new Promise((B,C)=>a(["./shader/ComponentShader.glsl"],B,C)));
const y=new Map([[w.VertexAttribute.POSITION,0],[w.VertexAttribute.NORMAL,1],[w.VertexAttribute.NORMALCOMPRESSED,1],[w.VertexAttribute.COLOR,2],[w.VertexAttribute.UV0,3],[w.VertexAttribute.UVREGION,4],[w.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=d;b.attributeLocations=y;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.IntegratedMeshMode=void 0;(function(u){u[u.None=0]="None";u[u.NoOverlay=1]="NoOverlay";u[u.ColorOverlay=2]="ColorOverlay";u[u.ColorOverlayWithWater=3]="ColorOverlayWithWater";u[u.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let w=function(u){function z(){var y=u.apply(this,arguments)||this;y.output=n.ShaderOutput.Color;y.textureCoordinateType=g.TextureCoordinateAttributeType.None;y.componentData=r.ComponentDataType.Uniform;y.cullFace=
A.CullFaceOptions.Back;y.vertexDiscardMode=m.VertexDiscardMode.None;y.doubleSidedMode=h.NormalsDoubleSidedMode.WindingOrder;y.alphaDiscardMode=A.AlphaDiscardMode.Opaque;y.integratedMeshMode=a.IntegratedMeshMode.None;y.transparencyPassType=t.TransparencyPassType.NONE;y.ellipsoidMode=f.EllipsoidMode.Earth;y.pbrMode=d.PBRMode.Disabled;y.normalType=p.NormalAttributeType.Attribute;y.spherical=!1;y.doublePrecisionRequiresObfuscation=!1;y.hasVertexColors=!1;y.hasNormals=!1;y.hasSlicePlane=!1;y.hasBaseColorTexture=
!1;y.receiveAmbientOcclusion=!0;y.receiveShadows=!0;y.blendingEnabled=!0;y.hasScreenSpaceReflections=!1;y.hasPolygonOffset=!1;y.hasMetallicRoughnessTexture=!1;y.hasEmissionTexture=!1;y.hasOcclusionTexture=!1;y.hasNormalTexture=!1;y.hasOccludees=!1;y.hasMultipassTerrain=!1;y.cullAboveGround=!1;y.useLegacyTerrainShading=!1;y.hasCloudsReflections=!0;y.snowCover=!1;y.objectAndLayerIdColor=!1;y.hasWebGL2Context=!1;return y}b._inheritsLoose(z,u);return z}(l.ShaderTechniqueConfiguration);c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],
w.prototype,"output",void 0);c.__decorate([l.parameter({count:g.TextureCoordinateAttributeType.COUNT})],w.prototype,"textureCoordinateType",void 0);c.__decorate([l.parameter({count:r.ComponentDataType.COUNT})],w.prototype,"componentData",void 0);c.__decorate([l.parameter({count:A.CullFaceOptions.COUNT})],w.prototype,"cullFace",void 0);c.__decorate([l.parameter({count:m.VertexDiscardMode.COUNT})],w.prototype,"vertexDiscardMode",void 0);c.__decorate([l.parameter({count:h.NormalsDoubleSidedMode.COUNT})],
w.prototype,"doubleSidedMode",void 0);c.__decorate([l.parameter({count:A.AlphaDiscardMode.COUNT})],w.prototype,"alphaDiscardMode",void 0);c.__decorate([l.parameter({count:a.IntegratedMeshMode.COUNT})],w.prototype,"integratedMeshMode",void 0);c.__decorate([l.parameter({count:t.TransparencyPassType.COUNT})],w.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter({count:f.EllipsoidMode.COUNT})],w.prototype,"ellipsoidMode",void 0);c.__decorate([l.parameter({count:d.PBRMode.COUNT})],w.prototype,
"pbrMode",void 0);c.__decorate([l.parameter({count:p.NormalAttributeType.COUNT})],w.prototype,"normalType",void 0);c.__decorate([l.parameter()],w.prototype,"spherical",void 0);c.__decorate([l.parameter()],w.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([l.parameter()],w.prototype,"hasVertexColors",void 0);c.__decorate([l.parameter()],w.prototype,"hasNormals",void 0);c.__decorate([l.parameter()],w.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],w.prototype,"hasBaseColorTexture",
void 0);c.__decorate([l.parameter()],w.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([l.parameter()],w.prototype,"receiveShadows",void 0);c.__decorate([l.parameter()],w.prototype,"blendingEnabled",void 0);c.__decorate([l.parameter()],w.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([l.parameter()],w.prototype,"hasPolygonOffset",void 0);c.__decorate([l.parameter()],w.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([l.parameter()],w.prototype,"hasEmissionTexture",
void 0);c.__decorate([l.parameter()],w.prototype,"hasOcclusionTexture",void 0);c.__decorate([l.parameter()],w.prototype,"hasNormalTexture",void 0);c.__decorate([l.parameter()],w.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],w.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],w.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter()],w.prototype,"useLegacyTerrainShading",void 0);c.__decorate([l.parameter()],w.prototype,"hasCloudsReflections",void 0);c.__decorate([l.parameter()],
w.prototype,"snowCover",void 0);c.__decorate([l.parameter()],w.prototype,"objectAndLayerIdColor",void 0);c.__decorate([l.parameter()],w.prototype,"hasWebGL2Context",void 0);c.__decorate([l.parameter({constValue:e.BindType.Draw})],w.prototype,"pbrTextureBindType",void 0);c.__decorate([l.parameter({constValue:!0})],w.prototype,"hasSliceHighlight",void 0);c.__decorate([l.parameter({constValue:!1})],w.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([l.parameter({constValue:!1})],w.prototype,
"useCustomDTRExponentForWater",void 0);c.__decorate([l.parameter({constValue:!1})],w.prototype,"hasVertexTangents",void 0);c.__decorate([l.parameter({constValue:!0})],w.prototype,"supportsTextureAtlas",void 0);c.__decorate([l.parameter({constValue:!1})],w.prototype,"highStepCount",void 0);c.__decorate([l.parameter({constValue:!1})],w.prototype,"instancedDoublePrecision",void 0);c.__decorate([l.parameter({constValue:!0})],w.prototype,"useFillLights",void 0);c.__decorate([l.parameter({constValue:!1})],
w.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderLibrary/util/WebGL2Utils ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../core/shaderModules/TextureSizeUniformType ../../../../lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(z,y){const {vertex:B,fragment:C}=z;B.include(p.RgbaFloatEncoding);B.uniforms.add(e.createTexture2DDrawSizeUniforms("componentColorTex",q=>q.componentParameters.texture.texture,y.hasWebGL2Context?l.TextureSizeUniformType.None:l.TextureSizeUniformType.Size));z.attributes.add(A.VertexAttribute.COMPONENTINDEX,"float");z.varyings.add("vExternalColorMixMode","mediump float");z.varyings.add("vExternalColor","vec4");const k=y.output===n.ShaderOutput.ObjectAndLayerIdColor;
k&&z.varyings.add("vObjectAndLayerIdColor","vec4");z.include(m.DecodeSymbolColor);B.constants.add("elevationScale","float",2*u);B.constants.add("stride","float",r("enable-feature:objectAndLayerId-rendering")?3:2);B.code.add(f.glsl`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${g.textureSize(y,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `);B.code.add(f.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${g.texelFetch(y,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${g.texelFetch(y,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${k?f.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${g.texelFetch(y,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:f.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);C.code.add(f.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${k?f.glsl`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function w(z){const {vertex:y,fragment:B}=z;y.uniforms.add(new h.Float4DrawUniform("externalColor",C=>C.componentParameters.externalColor));B.uniforms.add(new d.IntegerDrawUniform("externalColorMixMode",C=>C.componentParameters.externalColorMixMode));z.varyings.add("vExternalColor","vec4");y.code.add(f.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);B.code.add(f.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}a.ComponentDataType=void 0;(function(z){z[z.Uniform=0]="Uniform";z[z.Varying=1]="Varying";z[z.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const u=2**32/1E4;a.ComponentData=function(z,y){switch(y.componentData){case a.ComponentDataType.Varying:return t(z,y);case a.ComponentDataType.Uniform:return w(z);case a.ComponentDataType.COUNT:break;default:b.neverReached(y.componentData)}};a.MAX_ELEVATION_OFFSET=u;a.encodeElevationOffset=function(z,y){c.packFloatRGBA(z/u*.5+.5,y)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,r){c=function(m){function n(p,g){return m.call(this,p,"int",r.BindType.Draw,(h,d,f)=>h.setUniform1i(p,g(d,f)))||this}b._inheritsLoose(n,m);return n}(c.Uniform);a.IntegerDrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,r){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);
switch(r.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?a.EllipsoidMode.Mars:c&&b.isMoon(c)?
a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N){function H(M){const Q=new O.ShaderBuilder;Q.include(A.VertexPosition,M);Q.include(l.VertexNormal,M);Q.include(e.VertexColor,M);Q.include(f.TextureCoordinateAttribute,M);Q.include(p.ForwardLinearDepth,M);Q.include(m.ComponentData,M);Q.include(J.DiscardOrAdjustAlphaDraw,M);Q.include(h.SlicePass,M);Q.include(v.ReadBaseColorTexture,M);Q.include(n.VertexDiscardByOpacity,M);const {vertex:T,fragment:S}=Q;if(M.pbrMode===x.PBRMode.Normal||
M.pbrMode===x.PBRMode.Schematic)Q.include(x.PhysicallyBasedRenderingParameters,M),M.hasNormalTexture&&Q.include(y.ComputeNormalTexture,M);const U=M.output===g.ShaderOutput.Shadow||M.output===g.ShaderOutput.ShadowHighlight||M.output===g.ShaderOutput.ShadowExludeHighlight;U&&M.componentData===m.ComponentDataType.Varying?T.code.add(K.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):T.code.add(K.glsl`#define discardShadows(castShadows) {}`);
const Y=M.integratedMeshMode===r.IntegratedMeshMode.ColorOverlay||M.integratedMeshMode===r.IntegratedMeshMode.ColorOverlayWithWater,V=Y&&M.output===g.ShaderOutput.Color&&M.pbrMode===x.PBRMode.WaterOnIntegratedMesh;Y&&(Q.include(C.EvaluateSceneLighting,M),Q.include(F.OverlayIM,M),M.spherical?T.code.add(K.glsl`
      const float invEllipsoidRadius = ${K.glsl.float(1/(M.ellipsoidMode===L.EllipsoidMode.Earth?b.earth.radius:M.ellipsoidMode===L.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):T.code.add(K.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));V&&(Q.varyings.add("tbnTangent","vec3"),Q.varyings.add("tbnBiTangent","vec3"),Q.varyings.add("groundNormal","vec3"));T.code.add(K.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${K.glsl.float(G.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${M.output===g.ShaderOutput.ObjectAndLayerIdColor?K.glsl`forwardObjectAndLayerIdColor();`:""}
      ${V?M.spherical?K.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:K.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${Y?K.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);M.output===g.ShaderOutput.Alpha&&(S.include(u.ReadLinearDepth),Q.include(q.multipassTerrainTest,M),Q.include(z.ComputeMaterialColor,M),Y&&S.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(R,X)=>F.getColorTexture(R,X))),S.code.add(K.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${M.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Y?K.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));M.output===g.ShaderOutput.Color&&(S.include(u.ReadLinearDepth),Q.include(q.multipassTerrainTest,M),Q.include(z.ComputeMaterialColor,M),Q.include(B.ComputeShadingNormal,M),Q.include(C.EvaluateSceneLighting,M),M.receiveShadows?(Q.include(D.ReadShadowMapPass,M),S.code.add(K.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):S.code.add(K.glsl`float evaluateShadow() { return 0.0; }`),Y&&S.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(R,X)=>F.getColorTexture(R,X))),S.code.add(K.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${M.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Y?K.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),M.pbrMode===x.PBRMode.Normal||M.pbrMode===x.PBRMode.Schematic?(k.addMainLightIntensity(S),S.code.add(K.glsl`
        ${M.pbrMode===x.PBRMode.Normal?K.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),M.hasNormalTexture?S.code.add(K.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):S.code.add(K.glsl`vec3 shadingNormal = normalVertex;`),S.code.add(K.glsl`${M.spherical?K.glsl`vec3 normalGround = normalize(positionWorld());`:K.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),S.code.add(K.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${M.snowCover?K.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${Y?K.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(M.receiveShadows?S.code.add(K.glsl`float shadow = evaluateShadow();`):M.spherical?(C.addLightingGlobalFactor(S),S.code.add(K.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):S.code.add(K.glsl`float shadow = 0.0;`),V&&S.uniforms.add(new P.Texture2DPassUniform("ovNormalTex",(R,X)=>E(X))),M.snowCover&&(Q.extensions.add("GL_OES_standard_derivatives"),S.code.add(K.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),S.code.add(K.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${Y?K.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${V?K.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),S.code.add(K.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${M.transparencyPassType===N.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(M.output===g.ShaderOutput.Depth||U)Q.include(t.OutputDepth,M),S.code.add(K.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);M.output===g.ShaderOutput.Normal&&(Q.include(B.ComputeShadingNormal,M),S.code.add(K.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${M.normalType===d.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));M.output===g.ShaderOutput.ObjectAndLayerIdColor&&Q.fragment.code.add(K.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputObjectAndLayerIdColor();
}`);M.output===g.ShaderOutput.Highlight&&(Q.include(w.OutputHighlight,M),S.code.add(K.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Y?K.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return Q}function E(M){return 0===M.overlays.length?null:M.overlays[c.OverlayIndex.INNER].getValidTexture(c.RenderTargetType.Water)}const I=Object.freeze(Object.defineProperty({__proto__:null,build:H,getOverlayNormalTexture:E},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=I;a.build=H;a.getOverlayNormalTexture=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,r,m,n){a.ComputeMaterialColor=function(p,g){p.include(b.VertexColor,g);p.fragment.include(c.MixExternalColor);p=p.fragment;p.uniforms.add(new r.Float4DrawUniform("baseColor",h=>h.baseColor));p.uniforms.add(new m.FloatDrawUniform("objectOpacity",h=>h.objectOpacity));g.hasVertexColors?p.code.add(n.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):p.code.add(n.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);p.code.add(n.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,r,m,n,p){a.ComputeShadingNormal=function(g,h){const d=g.fragment;switch(h.doubleSidedMode){case n.NormalsDoubleSidedMode.None:d.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case n.NormalsDoubleSidedMode.View:g.include(m.VertexPosition,h);d.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case n.NormalsDoubleSidedMode.WindingOrder:d.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(h.doubleSidedMode);case n.NormalsDoubleSidedMode.COUNT:}switch(h.normalType){case c.NormalAttributeType.Attribute:case c.NormalAttributeType.CompressedAttribute:g.include(r.VertexNormal,h);d.code.add(p.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalAttributeType.ScreenDerivative:g.extensions.add("GL_OES_standard_derivatives");g.include(m.VertexPosition,h);d.code.add(p.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalAttributeType.Ground:h.spherical?(g.include(m.VertexPosition,h),d.code.add(p.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):d.code.add(p.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);g.extensions.add("GL_OES_standard_derivatives");d.code.add(p.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(h.normalType);case c.NormalAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/TextureSizeUniformType ../../../lib/basicInterfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d){a.ReadBaseColorTexture=function(f,e){const l=f.fragment;if(!e.hasBaseColorTexture||e.output!==b.ShaderOutput.Color&&e.alphaDiscardMode===d.AlphaDiscardMode.Opaque)l.code.add(p.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`);else{f.include(r.VertexTextureCoordinates,e);const A=e.textureCoordinateType===c.TextureCoordinateAttributeType.Atlas;l.uniforms.add(g.createTexture2DDrawSizeUniforms("baseColorTexture",t=>t.texture,A?e.hasWebGL2Context?h.TextureSizeUniformType.None:
h.TextureSizeUniformType.Size:h.TextureSizeUniformType.None));A?(f.include(m.TextureAtlasLookup),l.code.add(p.glsl`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${n.textureSize(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):l.code.add(p.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(m){function n(){var g=m.apply(this,arguments)||this;g._dirty=!0;return g}b._inheritsLoose(n,m);var p=n.prototype;p._setDirty=function(){this._dirty=!0};p._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const g of this._parameterBlocks)this[g]._setClean()};
p._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const g of this._parameterBlocks)if(this[g].dirty)return!0;return!1};b._createClass(n,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return n}(c.NoParameters);let r=function(){function m(){this._dirty=!0}var n=m.prototype;n._setDirty=function(){this._dirty=!0};n._setClean=function(){this._dirty=!1};b._createClass(m,[{key:"dirty",get:function(){return this._dirty}}]);return m}();
a.MaterialBase=c;a.MaterialParameterBlock=r;a.parameter=function(m={}){return(n,p)=>{const g=n._parameterCount??0;n._parameterCount=g+1;if(m.vectorOps){const h=m.vectorOps;Object.defineProperty(n,p,{get(){return this[g]},set(d){const f=this[g];if(null==f)this[g]=d;else{if(h.equals(f,d))return;h.copy(f,d)}this._setDirty()}})}else Object.defineProperty(n,p,{get(){return this[g]},set(h){this[g]!==h&&(m.dispose&&this[g]&&this[g].dispose(),this[g]=h,this._setDirty())}})}};a.parameterBlock=function(){return(m,
n)=>{const p=m._parameterCount??0;m._parameterCount=p+1;m._parameterBlocks=m._parameterBlocks||[];m._parameterBlocks.push(p);Object.defineProperty(m,n,{get(){return this[p]},set(g){this[p]!==g&&(this[p]=g,this._setDirty())}})}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32",
"../../../../../chunks/vec3f64"],function(a,b,c,r,m){let n=function(){function g(d){this._low=r.create();this._high=r.create();d&&this.set(d)}var h=g.prototype;h.set=function(d){const f=this._low,e=this._high;c.copy(f,d);c.sub(e,d,f)};h.setElements=function(d,f,e){c.set(p,d,f,e);this.set(p)};h.get=function(d){return c.add(d,this._low,this._high)};h.getLowScaled=function(d){return c.scale(d,this._low,1)};b._createClass(g,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);
return g}();const p=m.create();a.TwoVectorPosition=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,r){const m=c.newLayout().vec3f(r.VertexAttribute.POSITION).u16(r.VertexAttribute.COMPONENTINDEX).u16(r.VertexAttribute.U16PADDING),n=c.newLayout().vec2u8(r.VertexAttribute.SIDENESS);
b=b.glLayout(n);c=c.newLayout().vec3f(r.VertexAttribute.POSITION0).vec3f(r.VertexAttribute.POSITION1).u16(r.VertexAttribute.COMPONENTINDEX).u8(r.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(r.VertexAttribute.VARIANTSTROKE).u8(r.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(r.VertexAttribute.U8PADDING,{glPadding:!0}).u16(r.VertexAttribute.U16PADDING,{glPadding:!0});const p=c.clone().vec3f(r.VertexAttribute.NORMAL),g=c.clone().vec3f(r.VertexAttribute.NORMALA).vec3f(r.VertexAttribute.NORMALB);
r=new Map([[r.VertexAttribute.POSITION0,0],[r.VertexAttribute.POSITION1,1],[r.VertexAttribute.COMPONENTINDEX,2],[r.VertexAttribute.VARIANTOFFSET,3],[r.VertexAttribute.VARIANTSTROKE,4],[r.VertexAttribute.VARIANTEXTENSION,5],[r.VertexAttribute.NORMAL,6],[r.VertexAttribute.NORMALA,6],[r.VertexAttribute.NORMALB,7],[r.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=m;a.EdgeShaderAttributeLocations=r;a.RegularEdgeInstancesLayout=p;a.SilhouetteEdgeInstancesLayout=g;a.VertexLayout=
n;a.glVertexLayout=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(a,b,c,r,m,n,p,g){function h(l,A,t,w){if(A)return A=c.computeNeighbors(t,w,l.count),
new d(t,w,A,l);l=b.deduplicate(l.buffer,l.stride/4,{originalIndices:t,originalIndicesLength:w});w=c.computeNeighbors(l.indices,w,l.uniqueCount);return{faces:l.indices,facesLength:l.indices.length,neighbors:w,vertices:n.EdgeInputBufferLayout.createView(l.buffer)}}let d=function(l,A,t,w){this.faces=l;this.facesLength=A;this.neighbors=t;this.vertices=w};const f=new p.RegularEdgeBufferWriter,e=new p.SilhouetteEdgeBufferWriter;p=r.newLayout().vec3f(m.VertexAttribute.POSITION0).vec3f(m.VertexAttribute.POSITION1);
r=r.newLayout().vec3f(m.VertexAttribute.POSITION0).vec3f(m.VertexAttribute.POSITION1).u16(m.VertexAttribute.COMPONENTINDEX).u16(m.VertexAttribute.U16PADDING,{glPadding:!0});a.extract=function(l){const A=h(l.data,l.skipDeduplicate,l.indices,l.indicesLength);f.updateSettings(l.writerSettings);e.updateSettings(l.writerSettings);return g.extractEdges(A,f,e)};a.extractComponentsEdgeLocationsLayout=r;a.extractEdgeInformation=h;a.extractEdgeLocationsLayout=p;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,c,r){c/=3;const m=new Uint32Array(r+1),n=new Uint32Array(r+1);var p=(w,u)=>{w<u?m[w+1]++:n[u+1]++};for(var g=0;g<c;g++){var h=b[3*g],d=b[3*g+1],f=b[3*g+2];p(h,d);p(d,f);p(f,h)}g=p=0;for(h=0;h<r;h++)d=m[h+1],f=n[h+1],m[h+1]=p,n[h+1]=g,p+=d,g+=f;const e=new Uint32Array(6*c),l=m[r];p=(w,u,z)=>{w<u?(w=m[w+1]++,e[2*w]=u,e[2*w+1]=z):(u=n[u+1]++,e[2*l+
2*u]=w,e[2*l+2*u+1]=z)};for(g=0;g<c;g++)h=b[3*g],d=b[3*g+1],f=b[3*g+2],p(h,d,g),p(d,f,g),p(f,h,g);p=(w,u)=>{const z=2*w;w=u-w;for(u=1;u<w;u++){const y=e[z+2*u],B=e[z+2*u+1];let C=u-1;for(C;0<=C&&e[z+2*C]>y;C--)e[z+2*C+2]=e[z+2*C],e[z+2*C+3]=e[z+2*C+1];e[z+2*C+2]=y;e[z+2*C+3]=B}};for(g=0;g<r;g++)p(m[g],m[g+1]),p(l+n[g],l+n[g+1]);const A=new Int32Array(3*c),t=(w,u)=>w===b[3*u]?0:w===b[3*u+1]?1:w===b[3*u+2]?2:-1;c=(w,u)=>{w=t(w,u);A[3*u+w]=-1};p=(w,u,z,y)=>{w=t(w,u);A[3*u+w]=y;z=t(z,y);A[3*y+z]=u};for(g=
0;g<r;g++){h=m[g];d=m[g+1];f=n[g];const w=n[g+1];for(;h<d&&f<w;){const u=e[2*h],z=e[2*l+2*f];u===z?(p(g,e[2*h+1],z,e[2*l+2*f+1]),h++,f++):u<z?(c(g,e[2*h+1]),h++):(c(z,e[2*l+2*f+1]),f++)}for(;h<d;)c(g,e[2*h+1]),h++;for(;f<w;)c(e[2*l+2*f],e[2*l+2*f+1]),f++}return A};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(a,b,c,r,m,n){function p(z){const y=f;y[0]=z.position0[0];y[1]=z.position0[1];y[2]=z.position0[2];y[3]=z.position1[0];y[4]=z.position1[1];y[5]=z.position1[2];l[0]=5381;for(z=0;z<e.length;z++)l[0]=31*l[0]+e[z];return l[0]}function g(z){const y=f;y[0]=h(z.position0[0]);y[1]=h(z.position0[1]);y[2]=h(z.position0[2]);y[3]=h(z.position1[0]);y[4]=h(z.position1[1]);y[5]=h(z.position1[2]);l[0]=5381;for(z=0;z<e.length;z++)l[0]=31*l[0]+e[z];return l[0]}function h(z){return Math.round(1E4*z)/1E4}let d=
function(){function z(){}var y=z.prototype;y.updateSettings=function(B){this.settings=B;this._edgeHashFunction=B.reducedPrecision?g:p};y.write=function(B,C,k){var q=this._edgeHashFunction(k);u.seed=q;q=u.getIntRange(0,255);const x=u.getIntRange(0,this.settings.variants-1);var v=u.getFloat();v=-(1-Math.min(v/.7,1))+Math.max(0,v-.7)/(1-.7);v=255*(Math.abs(v)**1.2*(0>v?-1:1)*.5+.5);B.position0.setVec(C,k.position0);B.position1.setVec(C,k.position1);B.componentIndex.set(C,k.componentIndex);B.variantOffset.set(C,
q);B.variantStroke.set(C,x);B.variantExtension.set(C,v)};y.trim=function(B,C){return B.slice(0,C)};return z}();const f=new Float32Array(6),e=new Uint32Array(f.buffer),l=new Uint32Array(1);let A=function(){function z(){this._commonWriter=new d}var y=z.prototype;y.updateSettings=function(B){this._commonWriter.updateSettings(B)};y.allocate=function(B){return n.RegularEdgeInstancesLayout.createBuffer(B)};y.write=function(B,C,k){this._commonWriter.write(B,C,k);c.add(w,k.faceNormal0,k.faceNormal1);c.normalize(w,
w);B.normal.setVec(C,w)};y.trim=function(B,C){return this._commonWriter.trim(B,C)};return z}();A.Layout=n.RegularEdgeInstancesLayout;A.glLayout=m.glLayout(n.RegularEdgeInstancesLayout,1);let t=function(){function z(){this._commonWriter=new d}var y=z.prototype;y.updateSettings=function(B){this._commonWriter.updateSettings(B)};y.allocate=function(B){return n.SilhouetteEdgeInstancesLayout.createBuffer(B)};y.write=function(B,C,k){this._commonWriter.write(B,C,k);B.normalA.setVec(C,k.faceNormal0);B.normalB.setVec(C,
k.faceNormal1)};y.trim=function(B,C){return this._commonWriter.trim(B,C)};return z}();t.Layout=n.SilhouetteEdgeInstancesLayout;t.glLayout=m.glLayout(n.SilhouetteEdgeInstancesLayout,1);const w=r.create(),u=new b;a.CommonBufferWriter=d;a.RegularEdgeBufferWriter=A;a.SilhouetteEdgeBufferWriter=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),
function(a,b,c,r,m,n){function p(l,A){const t=c.acosClamped(l.cosAngle),w=d.fwd,u=d.ortho;m.direction(w,l.position1,l.position0);l=0<m.dot(m.cross(u,l.faceNormal0,l.faceNormal1),w)?-1:1;return t*l>A}function g(l){const A=l.faces.length/3,t=l.faces;l=l.neighbors;var w=0;for(var u=0;u<A;u++){var z=l[3*u+1],y=l[3*u+2],B=t[3*u],C=t[3*u+1],k=t[3*u+2];w+=-1===l[3*u]||B<C?1:0;w+=-1===z||C<k?1:0;w+=-1===y||k<B?1:0}w=new Int32Array(4*w);u=0;for(z=0;z<A;z++){y=l[3*z];B=l[3*z+1];C=l[3*z+2];k=t[3*z];const q=
t[3*z+1],x=t[3*z+2];if(-1===y||k<q)w[u++]=k,w[u++]=q,w[u++]=z,w[u++]=y;if(-1===B||q<x)w[u++]=q,w[u++]=x,w[u++]=z,w[u++]=B;if(-1===C||x<k)w[u++]=x,w[u++]=k,w[u++]=z,w[u++]=C}return w}function h(l){const A=l.faces.length/3,t=l.vertices.position;l=l.faces;const w=f.v0,u=f.v1,z=f.v2,y=new Float32Array(3*A);for(let B=0;B<A;B++){const C=l[3*B+1],k=l[3*B+2];t.getVec(l[3*B],w);t.getVec(C,u);t.getVec(k,z);m.subtract(u,u,w);m.subtract(z,z,w);m.cross(w,u,z);m.normalize(w,w);y[3*B]=w[0];y[3*B+1]=w[1];y[3*B+2]=
w[2]}return y}a.EdgeType=void 0;(function(l){l[l.SOLID=0]="SOLID";l[l.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const d={edge:{position0:n.create(),position1:n.create(),faceNormal0:n.create(),faceNormal1:n.create(),componentIndex:0,cosAngle:0},ortho:n.create(),fwd:n.create()},f={v0:n.create(),v1:n.create(),v2:n.create()},e={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(l,A,t,w=e){const u=l.vertices.position;var z=l.vertices.componentIndex,y=c.deg2rad(w.anglePlanar);w=c.deg2rad(w.angleSignificantEdge);
const B=Math.cos(w),C=Math.cos(y),k=d.edge,q=k.position0,x=k.position1,v=k.faceNormal0,D=k.faceNormal1,F=h(l),G=g(l),J=G.length/4;l=A.allocate(J);w=0;const L=t.allocate(J);let K=0,O=0,P=0;const N=b.range(0,J),H=new Float32Array(J);r.forEach(H,(Q,T,S)=>{u.getVec(G[4*T],q);u.getVec(G[4*T+1],x);S[T]=m.distance(q,x)});N.sort((Q,T)=>H[T]-H[Q]);const E=[],I=[];for(let Q=0;Q<J;Q++){var M=N[Q];const T=H[M],S=G[4*M],U=G[4*M+1],Y=G[4*M+2];M=G[4*M+3];const V=-1===M;u.getVec(S,q);u.getVec(U,x);if(V)m.set(v,F[3*
Y],F[3*Y+1],F[3*Y+2]),m.copy(D,v),k.componentIndex=z.get(S),k.cosAngle=m.dot(v,D);else{m.set(v,F[3*Y],F[3*Y+1],F[3*Y+2]);m.set(D,F[3*M],F[3*M+1],F[3*M+2]);k.componentIndex=z.get(S);k.cosAngle=m.dot(v,D);if(k.cosAngle>C)continue;-.9999>k.cosAngle&&m.copy(D,v)}O+=T;P++;V||k.cosAngle<B?(A.write(l,w++,k),E.push(T)):p(k,y)&&(t.write(L,K++,k),I.push(T))}z=new Float32Array(E.reverse());y=new Float32Array(I.reverse());return{regular:{instancesData:A.trim(l,w),lodInfo:{lengths:z}},silhouette:{instancesData:t.trim(L,
K),lodInfo:{lengths:y}},averageEdgeLength:O/P}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){let c=function(){function r(n,p=1){this._rctx=n;this._fieldCount=p;this._buffers=[]}var m=r.prototype;m.garbageCollect=function(){this._buffers=this._buffers.filter(n=>0===n.activeCount?(n.dispose(),!1):!0)};m.destroy=function(){this._buffers.forEach(n=>
n.dispose());this._buffers=[]};m.getBuffer=function(n){for(const p of this._buffers)if(p.availableCount>=n)return p;if(n>b.MAX_INDEX_COUNT)return null;n=new b.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(n);return n};m.updateTextures=function(){for(const n of this._buffers)n.textureBuffer.updateTexture()};return r}();a.BufferManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,r){let m=function(){function n(g,h=1){this.textureBuffer=new r.TextureBackedBuffer(g,h);this._indexManager=new c.SimpleIndexManager(65536)}var p=n.prototype;p.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};p.acquireIndex=function(){const g=this._indexManager.acquire();this.textureBuffer.resizeToFit(g);return g};p.releaseIndex=function(g){this._indexManager.release(g)};
b._createClass(n,[{key:"availableCount",get:function(){return this._indexManager.availableCount}},{key:"activeCount",get:function(){return this._indexManager.activeCount}}]);return n}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=
function(){function r(n){this._maxCount=n;this._nextIndex=0;this._recycledIndices=[]}var m=r.prototype;m.acquire=function(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++};m.release=function(n){this._recycledIndices.push(n)};b._createClass(r,[{key:"activeCount",get:function(){return this._nextIndex-this._recycledIndices.length}},{key:"availableCount",get:function(){return this._recycledIndices.length+this._maxCount-this._nextIndex}}]);
return r}();a.SimpleIndexManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,b,c,r,m){let n=function(){function p(h,d=1){this._rctx=h;this._fieldCount=d;this.textureWidth=4096;this._dirty=
!0;this._texture=new m.Texture(this._rctx,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this._data=new c.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var g=p.prototype;g.dispose=function(){this._texture.dispose();this._data=this._texture=void 0};g.setData=function(h,d,f,e,l,A){h=h*this._fieldCount+d;this._dirty=
!0;this._data.set(h,0,f);this._data.set(h,1,e);this._data.set(h,2,l);this._data.set(h,3,A)};g.setDataElement=function(h,d,f,e){h=h*this._fieldCount+d;this._dirty=!0;this._data.set(h,f,e)};g.resizeToFit=function(h){h*=this._fieldCount;h>=this._data.count&&(h=new c.BufferViewVec4u8(new ArrayBuffer(Math.ceil((h+1)/this.textureWidth)*this.textureWidth*4)),h.typedBuffer.set(this._data.typedBuffer),this._data=h)};g.updateTexture=function(){if(this._dirty){var h=this._texture.descriptor.width;this._data.count>
h*this._texture.descriptor.height&&this._texture.resize(h,this._data.count/h);this._texture.setData(this._data.typedBuffer);this._dirty=!1}};b._createClass(p,[{key:"texture",get:function(){return this._texture}}]);return p}();a.TextureBackedBuffer=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique ../../../../chunks/OverlayCompositing.glsl ../shaders/OverlayCompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){return function(){function A(w,u){this._rctx=w;this._techniqueRepository=u;this._configuration=new m.CompositingTechniqueConfiguration;this._passParameters=new c.CompositingPassParameters;this._oitParameters=new g.OITCompositingPassParameters;this._hudParameters=new n.HUDCompositingPassParameters;this._overlayParameters=new d.OverlayCompositingPassParameters}var t=A.prototype;t.dispose=function(){this._vao=a.disposeMaybe(this._vao)};t.compositeOIT=function(w,u,
z,y){this._oitParameters.colorTexture=u;this._oitParameters.alphaTexture=z;this._oitParameters.frontFaceTexture=y;u=this._rctx;z=this._techniqueRepository.acquire(h.OITCompositingTechnique);u.bindTechnique(z,this._oitParameters,w);w=this._ensureVAO();u.bindVAO(w);u.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(w,"geometry"));z.release()};t.compositeHUD=function(w,u){this._hudParameters.texture=u;u=this._rctx;const z=this._techniqueRepository.acquire(p.HUDCompositingTechnique);u.bindTechnique(z,
this._hudParameters,w);w=this._ensureVAO();u.bindVAO(w);u.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(w,"geometry"));z.release()};t.compositeOverlay=function(w,u,z,y){this._overlayParameters.texture=u;this._overlayParameters.opacity=z;this._overlayParameters.overlayIndex=y;u=this._rctx;z=this._techniqueRepository.acquire(f.OverlayCompositingTechnique);u.bindTechnique(z,this._overlayParameters,w);w=this._ensureVAO();u.bindVAO(w);u.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(w,
"geometry"));z.release()};t.composite=function(w,u,z=m.AlphaMode.None,y=1){const B=this._rctx;this._configuration.alphaMode=z;this._configuration.hasOpacityFactor=1!==y;this._passParameters.texture=u;this._passParameters.opacity=y;u=this._techniqueRepository.acquire(r.CompositingTechnique,this._configuration);B.bindTechnique(u,this._passParameters,w);w=this._ensureVAO();B.bindVAO(w);B.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(w,"geometry"));u.release()};t._ensureVAO=function(){a.isNone(this._vao)&&
(this._vao=b.createQuadVAO(this._rctx));return this._vao};return A}()})},"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,r,m,n,p){function g(f){const e=
new n.ShaderBuilder;e.include(c.ScreenSpacePass);e.fragment.uniforms.add(new p.Texture2DPassUniform("tex",l=>l.texture));f.hasOpacityFactor&&e.fragment.uniforms.add(new r.FloatPassUniform("opacity",l=>l.opacity));e.fragment.code.add(m.glsl`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${f.hasOpacityFactor?"* opacity":""};
    }`);return e}let h=function(f){function e(){var l=f.apply(this,arguments)||this;l.opacity=1;return l}b._inheritsLoose(e,f);return e}(m.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:g},Symbol.toStringTag,{value:"Module"}));a.Compositing=d;a.CompositingPassParameters=h;a.build=g})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){m=function(e){function l(){return e.apply(this,arguments)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new p.Program(t.rctx,l.shader.get().build(this.configuration),n.Default3D)};A.initializePipeline=function(){switch(this.configuration.alphaMode){case h.AlphaMode.None:return f.makePipelineState({colorWrite:f.defaultColorWriteParams});case h.AlphaMode.Alpha:return f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,
d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams});case h.AlphaMode.PremultipliedAlpha:case h.AlphaMode.COUNT:return f.makePipelineState({blending:f.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})}};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.Compositing,()=>new Promise((e,l)=>a(["./Compositing.glsl"],e,l)));b.CompositingTechnique=m;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){a.AlphaMode=void 0;(function(n){n[n.None=0]="None";n[n.Alpha=1]="Alpha";n[n.PremultipliedAlpha=2]="PremultipliedAlpha";n[n.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let m=function(n){function p(){var g=
n.apply(this,arguments)||this;g.alphaMode=a.AlphaMode.None;g.hasOpacityFactor=!1;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter({count:a.AlphaMode.COUNT})],m.prototype,"alphaMode",void 0);c.__decorate([r.parameter()],m.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HUDCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n){function p(){const d=new m.ShaderBuilder;d.include(c.ScreenSpacePass);d.fragment.uniforms.add(new n.Texture2DPassUniform("tex",f=>f.texture));d.fragment.code.add(r.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);return d}let g=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:g,build:p},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=h;a.HUDCompositingPassParameters=g;a.build=p})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.HUDCompositing,()=>new Promise((d,f)=>a(["./HUDCompositing.glsl"],d,f)));b.HUDCompositingTechnique=m;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/OITCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,r,m,n){function p(){const d=new m.ShaderBuilder;d.include(c.ScreenSpacePass);d.fragment.uniforms.add([new n.Texture2DPassUniform("colorTexture",
f=>f.colorTexture),new n.Texture2DPassUniform("alphaTexture",f=>f.alphaTexture),new n.Texture2DPassUniform("frontFaceTexture",f=>f.frontFaceTexture)]);d.fragment.code.add(r.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return d}let g=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:g,build:p},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=h;a.OITCompositingPassParameters=g;a.build=p})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d){m=function(f){function e(){return f.apply(this,arguments)||this}c._inheritsLoose(e,f);var l=e.prototype;l.initializeProgram=function(A){return new p.Program(A.rctx,e.shader.get().build(),n.Default3D)};l.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})};return e}(m.ShaderTechnique);
m.shader=new r.ReloadableShaderModule(g.OITCompositing,()=>new Promise((f,e)=>a(["./OITCompositing.glsl"],f,e)));b.OITCompositingTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(){const l=new g.ShaderBuilder;l.include(r.ScreenSpacePass);l.fragment.uniforms.add(new h.Texture2DPassUniform("tex",A=>A.texture));l.fragment.uniforms.add(new n.IntegerPassUniform("overlayIdx",A=>A.overlayIndex));l.fragment.uniforms.add(new m.FloatPassUniform("opacity",A=>A.opacity));l.fragment.code.add(p.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`);return l}let f=function(l){function A(){var t=l.apply(this,arguments)||this;t.overlayIndex=c.OverlayIndex.INNER;t.opacity=1;return t}b._inheritsLoose(A,l);return A}(p.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=e;a.OverlayCompositingPassParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d){m=function(f){function e(){return f.apply(this,arguments)||this}c._inheritsLoose(e,f);var l=e.prototype;l.initializeProgram=function(A){return new p.Program(A.rctx,e.shader.get().build(),n.Default3D)};l.initializePipeline=function(){return d.makePipelineState({blending:d.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})};return e}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.OverlayCompositing,
()=>new Promise((f,e)=>a(["./OverlayCompositing.glsl"],f,e)));b.OverlayCompositingTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){function u(P,N){if(N.isVisible){var H=A.empty(),E=N.getSpatialQueryAccelerator();r.isSome(E)?z(H,P,E):y(H,P,N.objects);return H}}function z(P,N,H){var E=N.eye;const I=N.viewForward,M=N.frustum,Q=S=>S.isVisible;var T=H.objectCount;500>T?(A.set(J,N.near,Math.min(P.near,N.far)),H.forEachInDepthRange(E,I,t.DepthOrder.FRONT_TO_BACK,J,(S,U)=>{B(P,N,S);J.far=P.near;U.setRange(J)},M,Q),A.set(J,Math.max(P.far,N.near),N.far),H.forEachInDepthRange(E,I,t.DepthOrder.BACK_TO_FRONT,
J,(S,U)=>{B(P,N,S);J.near=P.far;U.setRange(J)},M,Q)):(T=Math.max(Math.min(T,500),Math.ceil(.1*T)),E=H.findClosest(I,t.DepthOrder.FRONT_TO_BACK,M,Q,T),H=H.findClosest(I,t.DepthOrder.BACK_TO_FRONT,M,Q,T),E&&H&&(k(P,N,E.boundingVolumeWorldSpace.bounds),k(P,N,H.boundingVolumeWorldSpace.bounds)))}function y(P,N,H){L.clear();H.forAll(E=>{E.isVisible&&0!==E.geometryRecords.length&&L.add(E)});L.empty||(L.sort(N),A.set(J,N.near,Math.min(P.near,N.far)),L.forEachInDepthRange(J,t.DepthOrder.FRONT_TO_BACK,(E,
I)=>{I<P.near&&B(P,N,E)}),A.set(J,Math.max(P.far,N.near),N.far),L.forEachInDepthRange(J,t.DepthOrder.BACK_TO_FRONT,(E,I,M)=>{P.far=Math.max(P.far,M)}))}function B(P,N,H){if(H.isVisible&&f.intersectsSphere(N.frustum,H.boundingVolumeWorldSpace.bounds)){var E=H.transformation,I=G;H.geometryRecords.forEach(M=>{n.multiply(I,E,M.getShaderTransformation());const Q=l.maxScale(I);C(P,N,M.geometry.boundingInfo,I,Q)})}}function C(P,N,H,E,I){if(!r.isNone(H)){g.transformMat4(F,H.center,E);var {eye:M,viewForward:Q}=
N,T=Q[0]*(F[0]-M[0])+Q[1]*(F[1]-M[1])+Q[2]*(F[2]-M[2]);F[3]=H.radius*I;if(!(T-F[3]>P.near&&T+F[3]<P.far)&&f.intersectsSphere(N.frustum,F))if(100<H.radius&&H.getChildren())for(H=H.getChildren(),T=0;8>T;++T)H[T]&&C(P,N,H[T],E,I);else O.unionDepthRangeWithAABB(P,N.viewProjectionMatrix,E,H.bbMin,H.bbMax)}}function k(P,N,H){var E=N.eye;N=N.viewForward;E=(H[0]-E[0])*N[0]+(H[1]-E[1])*N[1]+(H[2]-E[2])*N[2];P.near=Math.min(P.near,E-H[3]);P.far=Math.max(P.far,E+H[3])}let q=function(){function P(){this._items=
new m({allocator:H=>H||{obj:null,distance:0,near:0,far:0},deallocator:H=>{H.obj=null;H.distance=0;H.near=0;H.far=0;return H}})}var N=P.prototype;N.clear=function(){this._items.clear()};N.add=function(H){this._items.pushNew().obj=H};N.sort=function(H){const E=H.eye,I=H.viewForward;this._items.forAll(M=>{const Q=M.obj.boundingVolumeWorldSpace.bounds,T=(Q[0]-E[0])*I[0]+(Q[1]-E[1])*I[1]+(Q[2]-E[2])*I[2];M.distance=T;M.near=T-Q[3];M.far=T+Q[3]});this._items.sort((M,Q)=>M.distance-Q.distance)};N.forEachInDepthRange=
function(H,E,I){if(E===t.DepthOrder.FRONT_TO_BACK)for(E=0;E<this._items.length;++E){var M=this._items.data[E];M.far<H.near||M.near>H.far||I(M.obj,M.near,M.far)}else for(E=this._items.length-1;0<=E;--E)M=this._items.data[E],M.far<H.near||M.near>H.far||I(M.obj,M.near,M.far)};b._createClass(P,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return P}(),x=function(){function P(){this._view=p.create();this._viewProj=p.create();this._frustum=
f.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._range={near:0,far:0};this._looseRange={near:0,far:0}}var N=P.prototype;N.compute=function(H,E){this._reset();n.copy(this._view,H.viewMatrix);n.multiply(this._viewProj,H.projectionMatrix,this._view);f.copy(this._frustum,H.frustum);H=this._view;const I=H[2],M=H[6],Q=H[10],T=H[14];H=this._range;let S=0;E.forEach(V=>{if(V.instanceParameters.visible&&V.castShadow){if(V.hasShaderTransformation){V.computeBoundingSphere(V.getShaderTransformation(),
F,1);var R=F}else R=V.boundingSphere;var X=I*R[0]+M*R[1]+Q*R[2]+T,W=X-R[3];R=X+R[3];this._geometries[S]=V;this._near[S]=-R;this._far[S]=-W;++S}});if(0===this._geometries.length)return H;for(E=0;E<this._geometries.length;++E)this._near[E]>H.far&&(H.far=this._near[E]),2<this._near[E]&&this._far[E]<H.near&&(H.near=this._far[E]);E=this._looseRange;E.near=Math.max(.5*H.near,2);E.far=2*H.far;var U=0;let Y=0;for(let V=0;V<this._geometries.length;++V)this._near[V]<H.near&&(this._near[V]>=E.near?H.near=this._near[V]:
this._nearCandidates[U++]=V),this._far[V]>H.far&&(this._far[V]<=E.far?H.far=this._far[V]:this._farCandidates[Y++]=V);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return H;this._nearCandidates.sort((V,R)=>this._near[V]<this._near[R]?-1:this._near[V]>this._near[R]?1:0);this._farCandidates.sort((V,R)=>this._far[V]<this._far[R]?1:this._far[V]>this._far[R]?-1:0);for(E=0;E<this._nearCandidates.length;++E)U=this._nearCandidates[E],this._near[U]<H.near&&(U=this._geometries[U],this._includeNearBoundingInfoRec(U.boundingInfo,
U.getShaderTransformation()));for(E=0;E<this._farCandidates.length;++E)U=this._farCandidates[E],this._far[U]>H.far&&(U=this._geometries[U],this._includeFarBoundingInfoRec(U.boundingInfo,U.getShaderTransformation()));return H};N._reset=function(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0;this._range.near=Number.MAX_VALUE;this._range.far=-Number.MAX_VALUE};N._includeNearBoundingInfoRec=function(H,E){if(!r.isNone(H)){var I=
H.getCenter();g.transformMat4(F,I,E);I=l.maxScale(E);var M=F[0],Q=F[1],T=F[2];I*=H.getBSRadius();var S=this._frustum;if(!(S[0][0]*M+S[0][1]*Q+S[0][2]*T+S[0][3]>I||S[1][0]*M+S[1][1]*Q+S[1][2]*T+S[1][3]>I||S[2][0]*M+S[2][1]*Q+S[2][2]*T+S[2][3]>I||S[3][0]*M+S[3][1]*Q+S[3][2]*T+S[3][3]>I||(M=this._view[2]*M+this._view[6]*Q+this._view[10]*T+this._view[14],Q=M+I,2>-(M-I)||-Q>=this._range.near)))if(-Q>this._looseRange.near)this._range.near=-Q;else{if(100<I&&(I=H.getChildren(),void 0!==I)){for(H=0;8>H;++H)void 0!==
I[H]&&this._includeNearBoundingInfoRec(I[H],E);return}O.unionDepthRangeWithAABB(this._range,this._viewProj,E,H.getBBMin(),H.getBBMax())}}};N._includeFarBoundingInfoRec=function(H,E){if(!r.isNone(H)){var I=H.getBSRadius(),M=H.getCenter();g.transformMat4(F,M,E);var Q=l.maxScale(E);M=F[0];var T=F[1],S=F[2];I*=Q;Q=this._frustum;if(!(Q[0][0]*M+Q[0][1]*T+Q[0][2]*S+Q[0][3]>I||Q[1][0]*M+Q[1][1]*T+Q[1][2]*S+Q[1][3]>I||Q[2][0]*M+Q[2][1]*T+Q[2][2]*S+Q[2][3]>I||Q[3][0]*M+Q[3][1]*T+Q[3][2]*S+Q[3][3]>I||(M=this._view[2]*
M+this._view[6]*T+this._view[10]*S+this._view[14]-I,-M<=this._range.far)))if(-M<this._looseRange.far)this._range.far=-M;else{if(100<I&&(I=H.getChildren(),void 0!==I)){for(H=0;8>H;++H)void 0!==I[H]&&this._includeFarBoundingInfoRec(I[H],E);return}O.unionDepthRangeWithAABB(this._range,this._viewProj,E,H.getBBMin(),H.getBBMax())}}};return P}(),v=function(){function P(){this._modelViewProj=p.create();this._clipPosition=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]}
var N=P.prototype;N.unionDepthRangeWithAABB=function(H,E,I,M,Q){var T=this._modelViewProj;n.multiply(T,E,I);E=!1;for(I=0;8>I;++I){const S=this._clipPosition[I],U=0===I||3===I||4===I||7===I?M[0]:Q[0],Y=0===I||1===I||4===I||5===I?M[1]:Q[1],V=4>I?M[2]:Q[2];S[0]=T[0]*U+T[4]*Y+T[8]*V+T[12];S[1]=T[1]*U+T[5]*Y+T[9]*V+T[13];S[2]=T[2]*U+T[6]*Y+T[10]*V+T[14];S[3]=T[3]*U+T[7]*Y+T[11]*V+T[15]}for(M=0;12>M;++M){Q=this._clipTriangle(this._clipPosition[D[M][0]],this._clipPosition[D[M][1]],this._clipPosition[D[M][2]]);
T=!0;for(I=0;I<Q.length;++I)if(2<=Q[I][3]){T=!1;break}if(!T)for(E=!0,T=0;T<Q.length;++T)I=Q[T][3],Number.isFinite(I)&&(H.near=Math.min(I,H.near),H.far=Math.max(I,H.far))}return E};N._inside=function(H,E){if(0===E)return H[0]>=-H[3];if(1===E)return H[1]>=-H[3];if(2===E)return H[0]<=H[3];if(3===E)return H[1]<=H[3];w.assert(!1)};N._intersect=function(H,E,I){let M=0;0===I?M=(-H[3]-H[0])/(E[0]-H[0]+E[3]-H[3]):1===I?M=(-H[3]-H[1])/(E[1]-H[1]+E[3]-H[3]):2===I?M=(H[3]-H[0])/(E[0]-H[0]-E[3]+H[3]):3===I&&(M=
(H[3]-H[1])/(E[1]-H[1]-E[3]+H[3]));return h.lerp(d.create(),H,E,M)};N._clipTriangle=function(H,E,I){H=[H,E,I];for(E=0;4>E;++E){I=H;H=[];for(let M=0;M<I.length;++M){const Q=I[M],T=I[(M+1)%I.length];this._inside(T,E)?(this._inside(Q,E)||H.push(this._intersect(Q,T,E)),H.push(T)):this._inside(Q,E)&&H.push(this._intersect(Q,T,E))}}return H};return P}();const D=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],F=e.create(),G=p.create(),J=A.empty(),L=new q,
K=new x,O=new v;a.DepthRangeFromRenderGeometries=x;a.depthRangeFromLayer=u;a.depthRangeFromScene=function(P,N,H){if(1E4>N.size)return K.compute(P,N);const E=A.empty();H.forAll(I=>{I.isVisible&&A.union(E,u(P,I))});return E};a.textureToDepth=function(P,N,H){return c.unpackFloatRGBA(N,P)*(H[1]-H[0])+H[0]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D){a.MagnifierHelper=function(F){function G(){var L=F.apply(this,arguments)||this;L._handles=new p;L._magnifier=null;L._imageSources=null;L._imageLoadTask=null;L._resources=null;L._passParameters=new k.MagnifierPassParameters;L.events=new n;L.attributeLocations=new Map([[C.VertexAttribute.POSITION,0]]);L._tmpScreenPoint=f.createScreenPointArray();L._tmpRenderPoint=f.createRenderScreenPointArray();return L}b._inheritsLoose(G,F);var J=G.prototype;
J.dispose=function(){this._magnifier=null;this._handles.destroy();h.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};J.render=function(L,K){const O=this._validMagnifier;if(!h.isNone(O)){var P=Math.ceil(K.camera.pixelRatio*O.size);this._updateResources(L,P);if(!h.isNone(this._resources)){var N=this._passParameters.textures;P=Math.ceil(1/this._factor*P);N.input.resize(P,P);f.screenPointObjectToArray(O.position,this._tmpScreenPoint);var H=
K.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),E=K.camera.fullHeight,I=.5*P,M=.5*P;H[0]=g.clamp(H[0],I,K.camera.fullWidth-I-1);H[1]=g.clamp(H[1],M,E-M-1);E=Math.floor(H[0]-I);H=Math.floor(H[1]-M);M=this._resources.program;M.bindTexture("textureInput",N.input);L.gl.copyTexImage2D(N.input.descriptor.target,0,N.input.descriptor.pixelFormat,E,H,P,P,0);this._passParameters.magnifier=O;L.useProgram(M);M.bindPass(this._passParameters,K);L.bindVAO(this._resources.vao);L.setPipelineState(this._resources.pipelineState);
L.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,4)}}};J._updateResourceLoading=function(){var L=this;const K=this._validMagnifier;if(!h.isNone(K)){var O=K.maskUrl,P=K.overlayUrl;!h.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===O&&this._imageLoadTask.overlayUrl===P||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);h.isSome(this._imageSources)||h.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:O,overlayUrl:P,task:m.createTask(function(){var N=b._asyncToGenerator(function*(H){const E=
h.isNone(O)||h.isNone(P)?q.loadMagnifierResources(H):null,I=h.isSome(O)?u.requestImage(O,{signal:H}):E.then(M=>M.mask);H=h.isSome(P)?u.requestImage(P,{signal:H}):E.then(M=>M.overlay);L._imageSources={mask:yield I,overlay:yield H};L._disposeResources();L.events.emit("request-render")});return function(H){return N.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};J._updateResources=function(L,K){this.enabled?h.isSome(this._resources)?
this._passParameters.textures.size!==K&&(L=this._createTextureResources(L,K),h.isNone(L)?this._disposeResources():(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=L)):(K=this._createTextureResources(L,K),h.isNone(K)||(this._resources={program:this._createProgram(L),vao:y.createQuadVAO(L,z.Pos2,this.attributeLocations,0,1),pipelineState:v.makePipelineState({blending:v.simpleBlendingParams(x.BlendFactor.ONE,x.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,
depthWrite:null,colorWrite:v.defaultColorWriteParams})},this._passParameters.textures=K)):this._disposeResources()};J._disposeResources=function(){h.isNone(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};J._disposeTextureResources=function(L){L.mask.dispose();L.overlay.dispose();L.input.dispose()};J._createTextureResources=function(L,K){if(h.isNone(this._imageSources))return null;
this._imageSources.overlay.width=K;this._imageSources.overlay.height=K;this._imageSources.mask.width=K;this._imageSources.mask.height=K;const O=new D.Texture(L,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,internalFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.LINEAR,flipped:!0,preMultiplyAlpha:e.isSVG(this._imageSources.overlay.src)&&L.driverTest.svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),
P=new D.Texture(L,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.ALPHA,internalFormat:x.PixelFormat.ALPHA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.LINEAR,flipped:!0},this._imageSources.mask);return{input:new D.Texture(L,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,internalFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.LINEAR,
flipped:!1}),mask:P,overlay:O,size:K}};J._createProgram=function(L){return new B.Program(L,k.build(),this.attributeLocations)};b._createClass(G,[{key:"updating",get:function(){return h.isNone(this._imageSources)&&h.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(L){L!==this._magnifier&&(this._handles.removeAll(),this._magnifier=L,L=()=>{this._updateResourceLoading();this.events.emit("request-render")},h.isSome(this._magnifier)&&
this._handles.add(d.watch(()=>h.applySome(this._magnifier,K=>K.version),L)),L())}},{key:"enabled",get:function(){return h.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return h.isSome(this._magnifier)&&this._magnifier.visible&&h.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"_factor",get:function(){return h.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return G}(r);c.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageSources",
void 0);c.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([l.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([w.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){let e=function(){},l=function(u){function z(){var y=u.apply(this,arguments)||this;y.textures=new e;return y}b._inheritsLoose(z,u);return z}(g.NoParameters);const A=c.createScreenPointArray(),t=c.createRenderScreenPointArray(),w=m.create();a.MagnifierPassParameters=l;a.TextureResources=e;a.build=function(){const u=new h.ShaderBuilder;u.attributes.add(f.VertexAttribute.POSITION,"vec2");u.vertex.uniforms.add(new p.Float4PassUniform("drawPosition",(z,y)=>{var B=y.camera.pixelRatio;
const C=z.magnifier.offset.x*B,k=z.magnifier.offset.y*B;c.screenPointObjectToArray(z.magnifier.position,A);const q=y.camera.screenToRender(A,t);z=Math.ceil(B*z.magnifier.size);B=y.camera.fullWidth;y=y.camera.fullHeight;return r.set(w,-1+(q[0]+C)/B*2,-1+(q[1]-k)/y*2,z/B*2,z/y*2)}));u.varyings.add("vUV","vec2");u.vertex.code.add(g.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);u.fragment.uniforms.add(new d.Texture2DPassUniform("textureInput",z=>z.textures.input));u.fragment.uniforms.add(new d.Texture2DPassUniform("textureMask",z=>z.textures.mask));u.fragment.uniforms.add(new d.Texture2DPassUniform("textureOverlay",z=>z.textures.overlay));u.fragment.uniforms.add(new n.BooleanPassUniform("maskEnabled",z=>z.magnifier.maskEnabled));u.fragment.uniforms.add(new n.BooleanPassUniform("overlayEnabled",z=>z.magnifier.overlayEnabled));u.fragment.code.add(g.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,r,m){function n(){n=c._asyncToGenerator(function*(g){var h=new Promise((f,e)=>a(["./mask-svg"],l=>f(p(l)),e)),d=new Promise((f,e)=>a(["./overlay-svg"],l=>f(p(l)),e));h=m.requestImage((yield h).default,{signal:g});
d=m.requestImage((yield d).default,{signal:g});d={mask:yield h,overlay:yield d};r.throwIfAborted(g);return d});return n.apply(this,arguments)}const p=g=>Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=function(g){return n.apply(this,arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports",
"../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,c,r){let m=function(){function n(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";this.colorZero=new r.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}var p=n.prototype;p.setUidToObjectAndLayerId=
function(g,h,d,f,e,l=null,A=null,t=null){g&&h&&d&&f&&(this._layerUidToId.set(f,d),this._layerUidToPopupEnabled.set(f,e),e&&(d=this._layerUidToGraphicsUidToObjectId.get(f),d||(d=new Map,this._layerUidToGraphicsUidToObjectId.set(f,d)),d.set(h,{objectId:g,attributeNodeId:l,attributeIndex:A,subLayerId:t})))};p.getObjectAndLayerIdColor=function(g){g=this.getObjectAndLayerIdColorArray(g);return c.fromValues(g.get(0,1),g.get(0,2),g.get(0,3),255)};p.getObjectAndLayerIdColorArray=function(g){if(!g.layerUid||
!g.graphicUid)return this.colorZero;var h=this._layerUidToPopupEnabled.get(g.layerUid);if(void 0===h)return b.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+g.layerUid),this.colorZero;if(!1===h)return this.colorZero;let d=this._uidToRenderColor.get(g.layerUid);d||(d=new Map,this._uidToRenderColor.set(g.layerUid,d));h=d.get(g.graphicUid);if(!h){for(;!h;){const f=Math.floor(16777214*Math.random())+1;this._colorToUID.has(f)||(h=f)}if(16777215<h)throw Error("Object ID Overflow");
d.set(g.graphicUid,h);this._colorToUID.set(h,g)}g=new ArrayBuffer(4);(new DataView(g)).setUint32(0,h,!1);return new r.BufferViewVec4u8(g)};p.getColorToObjectAndLayerIdMapping=function(){const g=new Map;for(const [d,f]of this._colorToUID.entries()){var h=this._layerUidToGraphicsUidToObjectId.get(f.layerUid);let e=null;h?(e=h.get(f.graphicUid))||b.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+f.graphicUid):b.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+
f.layerUid);(h=this._layerUidToId.get(f.layerUid))||b.getLogger(this.declaredClass).warn("no layerId found for uid "+f.layerUid);e&&h&&g.set(d,e.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:e.objectId,lid:h,attrId:e.attributeNodeId,attrIdx:e.attributeIndex,subLayerId:e.subLayerId}:{type:"object-and-layer-id",oid:e.objectId,lid:h})}return g};return n}();a.ObjectAndLayerIdRenderHelper=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/has ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/animationUtils ../../support/debugFlags ../../terrain/TerrainRenderer ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDUniforms ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba){a.Renderer=function(ca){function fa(da,la,oa,ra,Aa,ua,za,va,Ja){var pa=ca.call(this,{})||this;pa._materialRepository=da;pa._shaderTechniqueRepository=oa;pa._rctx=ra;pa._compositingHelper=Aa;pa._magnifierHelper=ua;pa._requestRender=za;pa._stage=Ja;pa._materialRenderers=new Map;pa._needsTransparentPass=!1;pa._hasHUDElements=!1;pa._hasHighlights=!1;pa._hasWater=!1;pa._hasOverlayWater=!1;pa._renderOverlay=
Ba=>{};pa._content=new Map;pa._isRendering=!1;pa._fallbackDepthStencilTexture=null;pa._sliceHelper=new T;pa._antialiasing=!0;pa._oitEnabled=!1;pa._multipassTerrain=!0;pa._terrainRenderingEnabled=!0;pa._terrainTransparency=C.TransparencyMode.Opaque;pa._waterReflectionEnabled=!1;pa._hasAnimations=!1;pa._animationTimestep=y.MINIMUM_IDLE_ANIMATION_FPS_TIME;pa._handles=new n;pa._renderHiddenTransparentEdges=()=>{};pa._oitUsed=!1;pa._smaaPass=new S.SmaaRenderPass(pa._rctx,oa);pa._oitEnabled=pa._hasOITSupport;
pa._requestRender();pa._offscreenRendering=new O.OffscreenRendering(pa._rctx,pa._compositingHelper);pa.performanceInfo=new aa.RendererPerformanceInfo(pa._rctx);pa._shadowMap=new Q.ShadowMap(pa._rctx,Ja.viewingMode);pa._ssaoHelper=new U.SSAOHelper(oa,pa._rctx,()=>pa._requestRender());pa._highlight=new L.Highlight(oa,pa._rctx);pa._shadowHighlight=new M.ShadowHighlight(pa._rctx,Ja.viewingMode);pa._shadowAccumulator=new I.ShadowAccumulator(pa._rctx,oa,Ja,Ba=>{const Ha=pa.shadowsEnabled;pa._shadowMap.enabled=
!0;pa._prepare(Ba.camera,Ba.contentCamera);pa._renderPlugins.prepareRender();pa._shadowMap.enabled=Ha},(Ba,Ha,wa)=>{Ba.shadowMap.start(Ba.camera,Ha,wa);pa._renderShadowCascades(q.ShaderOutput.Shadow,Ba.shadowMap);Ba.camera.setGLViewport(pa._rctx);pa._prepare(Ba.camera,Ba.contentCamera)},()=>pa._requestRender());pa._renderContext=new P.RenderContext(pa._rctx,pa._offscreenRendering,pa._shadowMap,pa._ssaoHelper,pa._sliceHelper);pa._renderPlugins=new H.RenderPluginManager({renderContext:pa._renderContext,
shaderTechniqueRepository:oa,textureRep:la,materialRep:pa._materialRepository,requestRender:pa._requestRender,schedule:va});pa.renderPassManager=new k.RenderPassManager(pa._rctx,pa._shaderTechniqueRepository);pa._renderPlugins.add(pa.renderPassManager.slots(),pa.renderPassManager);pa._handles.add([f.watch(()=>pa._stage.state.camera,()=>pa._requestRender(),f.syncAndInitial),f.watch(()=>B.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Ba=>{pa._renderHiddenTransparentEdges=Ba?()=>pa._renderEdges(R.Transparency.TRANSPARENT):
()=>{};pa._requestRender()},f.initial)]);return pa}b._inheritsLoose(fa,ca);var ea=fa.prototype;ea.normalizeCtorArgs=function(){return{}};ea.dispose=function(){this._handles.destroy();this._smaaPass.dispose();this._materialRenderers.forEach(da=>da.dispose());this._materialRenderers.clear();this._edgeView=d.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=d.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();
this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlight.dispose();this._shadowHighlight.dispose();this._shadowAccumulator.dispose();D.BoundingInfo.prune();this._content.clear()};ea.disposeOffscreenBuffers=function(){this._offscreenRendering.dispose();this._shadowMap.dispose();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};ea.ensureEdgeView=function(){d.isNone(this._edgeView)&&(this._edgeView=new V.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,
techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:da=>this._stage.resourceController.schedule(da)}),this._handles.add(f.watch(()=>d.applySome(this._edgeView,da=>da.updating),()=>this._requestRender(),f.sync)),this._requestRender());return this._edgeView};ea.setRenderParameters=function(da){const {_shadowMap:la,_ssaoHelper:oa,_bindParameters:ra}=this;void 0!==da.screenSpaceReflectionsEnabled&&ra.ssr.enabled!==da.screenSpaceReflectionsEnabled&&(ra.ssr.enabled=
da.screenSpaceReflectionsEnabled,this._requestRender());void 0!==da.shadowMap&&la.enabled!==da.shadowMap&&(la.enabled=da.shadowMap,this._requestRender());void 0!==da.shadowMapMaxCascades&&la.maxCascades!==da.shadowMapMaxCascades&&(la.maxCascades=da.shadowMapMaxCascades,this._requestRender());if(d.isSome(da.environment)){d.isSome(da.environment.weather)&&(this._bindParameters.weather=da.environment.weather,this._bindParameters.weatherVisible=da.weatherVisible);void 0!==da.environment.lighting.ambientOcclusionEnabled&&
oa.enabled!==da.environment.lighting.ambientOcclusionEnabled&&(oa.enabled=da.environment.lighting.ambientOcclusionEnabled,this._requestRender());void 0!==da.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==da.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=da.environment.lighting.waterReflectionEnabled,this._requestRender());const Aa="virtual"!==da.environment.lighting.type;ra.enableFillLights!==Aa&&(ra.enableFillLights=Aa,this._requestRender())}da.background&&
this._offscreenRendering.background!==da.background&&(this._offscreenRendering.background=da.background,this._requestRender());void 0!==da.antialiasingEnabled&&this._antialiasing!==da.antialiasingEnabled&&(this._antialiasing=da.antialiasingEnabled,this._requestRender());void 0!==da.highQualityTransparency&&this._multipassTerrain!==da.highQualityTransparency&&(this._oitEnabled=(this._multipassTerrain=da.highQualityTransparency)&&this._hasOITSupport,this._requestRender());void 0!==da.defaultHighlightOptions&&
(this._highlight.setDefaultOptions(da.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(da.defaultHighlightOptions),this._requestRender());void 0!==da.overlays&&this._bindParameters.overlays!==da.overlays&&(this._bindParameters.overlays=da.overlays,this._requestRender());void 0!==da.hasOverlayWater&&this._hasOverlayWater!==da.hasOverlayWater&&(this._hasOverlayWater=da.hasOverlayWater,this._requestRender());void 0!==da.renderOverlay&&this._renderOverlay!==da.renderOverlay&&(this._renderOverlay=
da.renderOverlay,this._requestRender());void 0!==da.slicePlane&&this._sliceHelper.plane!==da.slicePlane&&(this._sliceHelper.plane=d.unwrap(da.slicePlane),this._requestRender());void 0!==da.terrainRenderingEnabled&&this._terrainRenderingEnabled!==da.terrainRenderingEnabled&&(this._terrainRenderingEnabled=da.terrainRenderingEnabled,this._requestRender());void 0!==da.terrainTransparency&&this._terrainTransparency!==da.terrainTransparency&&(this._terrainTransparency=da.terrainTransparency,this._requestRender());
void 0!==da.shadowCastOptions&&this._shadowAccumulator.setOptions(da.shadowCastOptions)};ea.modify=function(da){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:la,removes:oa,updates:ra}=da;if(0!==la.length||0!==oa.length||0!==ra.length){oa.forAll(({id:ua})=>this._content.delete(ua));la.forAll(ua=>this._content.set(ua.id,ua));var Aa=!1;N.splitRenderGeometryChangeSetByMaterial(da).forEach((ua,za)=>{let va=this._materialRenderers.get(za);if(!va)if(0<ua.adds.length)va=
new X.MergedRenderer(this._rctx,this._materialRepository,za),this._materialRenderers.set(za,va);else return;va.modify(ua);va.isEmpty&&(Aa=!0)});Aa&&this._materialRenderers.forEach((ua,za)=>{ua.isEmpty&&(this._materialRenderers.delete(za),ua.dispose())});this._hasHighlights=g.someMap(this._materialRenderers,ua=>ua.hasHighlights);this._bindParameters.hasOccludees=g.someMap(this._materialRenderers,ua=>ua.hasOccludees);this._hasWater=g.someMap(this._materialRenderers,ua=>ua.hasWater);this._hasHUDElements=
g.someMap(this._materialRenderers,ua=>ua.requiresSlot(E.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,q.ShaderOutput.Color)||ua.requiresSlot(E.RenderSlot.HUD_MATERIAL,q.ShaderOutput.Color)||ua.requiresSlot(E.RenderSlot.LABEL_MATERIAL,q.ShaderOutput.Color));this._requestRender()}};ea.updateAnimation=function(da){this._hasAnimations=!1;this._materialRenderers.forEach(la=>this._hasAnimations=la.updateAnimation(da)||this._hasAnimations);return this._hasAnimations=this._renderPlugins.updateAnimation(da)||this._hasAnimations};
ea.render=function(da,la,oa,ra,Aa){this._isRendering=!0;const {camera:ua,contentCamera:za}=oa;this._renderContext.time=Aa;this.performanceInfo.startFrame();this._renderOverlay(Aa);this.performanceInfo.advance(aa.PerformanceCategory.OVERLAY);this._bindParameters.transparencyPassType=Y.TransparencyPassType.NONE;Aa=this._offscreenRendering;Aa.setupRenderTarget(this.hasWaterReflection);oa=z.create(this._sliceHelper.plane);ra===v.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(da);
ua.setGLViewport(this._rctx);this._prepare(ua,za);this._renderPlugins.prepareRender();this.performanceInfo.advance(aa.PerformanceCategory.PREPARE);var va=this._computeDepthRange(ua);this._renderShadowMap(da,ua,this._bindParameters.lighting.mainLight.direction,va);this.performanceInfo.advance(aa.PerformanceCategory.SHADOW_MAP);Aa.initializeFrame(ua);this._ensureBindParameters(ua,za);this._renderLinearDepth();this.performanceInfo.advance(aa.PerformanceCategory.LINEAR_DEPTH);this._accumulateShadows(va,
ua,za);this.performanceInfo.advance(aa.PerformanceCategory.ACCUMULATED_SHADOWS);this._renderNormal();this.performanceInfo.advance(aa.PerformanceCategory.NORMALS);this._ensureBindParametersSSR();this._renderSSAO();this.performanceInfo.advance(aa.PerformanceCategory.SSAO);this._renderContext.output=q.ShaderOutput.Color;Aa.bindFramebuffer();this._renderOpaqueGeometry();this.performanceInfo.advance(aa.PerformanceCategory.OPAQUE);va=this._terrainRenderingEnabled&&this._terrainTransparency!==C.TransparencyMode.Opaque;
const Ja=this._multipassTerrain&&va;this._renderTerrainLinearDepth(Ja);this._setMultipassEnabled(Ja);this._setTerrainCulling(Ja);this._renderEdges(R.Transparency.OPAQUE);this.performanceInfo.advance(aa.PerformanceCategory.OPAQUE_EDGES);this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth);this._renderSlot(E.RenderSlot.VOXEL);this.performanceInfo.advance(aa.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();const pa=this._needsTransparentPass||
this._renderPlugins.needsTransparentPass;pa&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry());this.performanceInfo.advance(aa.PerformanceCategory.TRANSPARENT);this._renderGeometryLinearDepth(Ja);const Ba=this._renderHUDVisibility(this._multipassTerrain&&va);Ja||this._renderInternalSlot(E.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(aa.PerformanceCategory.HUD_VISIBILITY);this._renderObjectAndLayerIdColor(la);
this.performanceInfo.advance(aa.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(R.Transparency.TRANSPARENT,Ja);this.performanceInfo.advance(aa.PerformanceCategory.TRANSPARENT_EDGES);this._renderTransparentTerrain();va&&Ba&&(Ja?this._renderLineCallouts(x.HUDTransparentRenderStyle.Occluded):Aa.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(x.HUDTransparentRenderStyle.Occluded,Aa.framebuffer),this.performanceInfo.advance(aa.PerformanceCategory.HUD_OCCLUDED));
this.performanceInfo.advance(aa.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);va&&(Aa.compositeTransparentTerrainOntoMain(this._bindParameters),Ja&&(this._renderEdges(R.Transparency.OPAQUE),this.performanceInfo.advance(aa.PerformanceCategory.OPAQUE_EDGES),pa&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(aa.PerformanceCategory.TRANSPARENT),this._renderEdges(R.Transparency.TRANSPARENT),
this.performanceInfo.advance(aa.PerformanceCategory.TRANSPARENT_EDGES)));Ja&&this._renderLineCallouts(x.HUDTransparentRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);Aa.renderToTargets(()=>{this._renderInternalSlot(E.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(E.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(E.RenderSlot.LASERLINES)},Aa.currentColorTarget,Aa.mainDepth);this.performanceInfo.advance(aa.PerformanceCategory.ENVIRONMENT);
this._renderPlugins.needsLaserlineWithContrastControl&&Aa.renderTmpAndCompositeToMain(()=>this._renderSlot(E.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,W.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(aa.PerformanceCategory.LASER_LINE);this._renderOccluded();this.performanceInfo.advance(aa.PerformanceCategory.OCCLUDED);ra=(la=ra===v.Decorations.ON&&this._magnifierHelper.enabled)&&d.isNone(da)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):
da;this._rctx.bindFramebuffer(ra);Aa=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(Aa)&&d.isSome(Aa)&&this._compositingHelper.composite(this._bindParameters,Aa,W.AlphaMode.None);this.performanceInfo.advance(aa.PerformanceCategory.ANTIALIASING);this._renderHUD(x.HUDTransparentRenderStyle.NotOccluded,ra);this.performanceInfo.advance(aa.PerformanceCategory.HUD_NOT_OCCLUDED);this._renderHighlights(ra,this._bindParameters);this.performanceInfo.advance(aa.PerformanceCategory.HIGHLIGHTS);
la&&this._magnifierHelper.render(this._rctx,this._bindParameters);ra!==da&&(this._rctx.bindFramebuffer(da),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,W.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=oa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.finishFrame()};ea._renderObjectAndLayerIdColor=function(da){d.isSome(da)&&
p("enable-feature:objectAndLayerId-rendering")&&(this._rctx.bindFramebuffer(da),this._offscreenRendering.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(da),this._offscreenRendering.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=x.HUDTransparentRenderStyle.NotOccluded;this._renderInternalSlot(E.RenderSlot.HUD_MATERIAL)},null,!0,!0))};ea.finish=function(da){this._hasAnimations||(this._animationTimestep=
e.Milliseconds(0));da===v.RenderRequestType.BACKGROUND&&(da=0,this.performanceInfo.gpuSamplingEnabled?da=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),da=h.clamp(Math.max(this.performanceInfo.elapsedTime,da)/y.MAXIMUM_ANIMATION_LOAD,y.MAXIMUM_IDLE_ANIMATION_FPS_TIME,y.MINIMUM_IDLE_ANIMATION_FPS_TIME),this._animationTimestep=e.Milliseconds(.9*this._animationTimestep+da*(1-.9)))};ea.readDepthPixels=function(da,la,oa){const ra=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,
this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(da,da),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ba.ClearBufferBit.COLOR_BUFFER_BIT|ba.ClearBufferBit.DEPTH_BUFFER_BIT|ba.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.Depth));ra.readPixels(la[0],la[1],la[2],la[3],ba.PixelFormat.RGBA,ba.PixelType.UNSIGNED_BYTE,oa)};ea.readHUDVisibility=function(da,
la,oa,ra,Aa){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(da,la,oa,ra,ba.PixelFormat.RGBA,ba.PixelType.UNSIGNED_BYTE,Aa)};ea.readAccumulatedShadow=function(da,la){return this._shadowAccumulator.readAccumulatedShadow(da,la)};ea._setMultipassEnabled=function(da){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=da};ea._setTerrainCulling=function(da){this._bindParameters.multipassTerrain.cullAboveGround=da};ea._renderSlot=
function(da){this._bindParameters.slot=da;this._renderPlugins.render()};ea._renderEdges=function(da,la=!1){const oa=this._edgeView;d.isSome(oa)&&oa.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>oa.render(this._bindParameters,da),this._bindParameters,W.AlphaMode.Alpha,la)};ea._renderShadowMap=function(da,la,oa,ra){const Aa=this._shadowMap;Aa.enabled&&(Aa.start(la,oa,ra),this._shadowHighlight.updateParameters(la,oa),this._needsShadowHighlight?(this._renderShadowCascades(q.ShaderOutput.ShadowHighlight,
this._shadowMap,ua=>Aa.takeCascadeSnapshotTo(ua,Q.SnapshotSlot.Highlight)),Aa.clear(),this._renderShadowCascades(q.ShaderOutput.ShadowExludeHighlight,this._shadowMap,ua=>{Aa.takeCascadeSnapshotTo(ua,Q.SnapshotSlot.Default);this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.ShadowHighlight)})):this._renderShadowCascades(q.ShaderOutput.Shadow),Aa.finish(da),la.setGLViewport(this._rctx))};ea._renderShadowCascades=function(da,la=this._shadowMap,oa=ra=>{}){for(const ra of la.getCascades())ra.camera.setGLViewport(this._rctx),
this._prepare(ra.camera,ra.camera),this._renderGeometryAndTransparentTerrainPass(da),oa(ra)};ea._renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.Depth),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};
ea._renderTerrainLinearDepth=function(da){da?(da=this._renderContext.output,this._renderContext.output=q.ShaderOutput.Depth,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.output=da):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};
ea._renderGeometryLinearDepth=function(da){da?(da=this._renderContext.output,this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(q.ShaderOutput.Depth),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=da):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};ea._renderNormal=
function(){this._needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.Normal)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};ea._computeDepthRange=function(da){if(!this._needsDepthRange)return F.ZERO;const la=G.depthRangeFromScene(da,this._content,this._stage.layers);F.union(la,this.renderPlugins.queryDepthRange(da));la.near=
Math.max(da.near,la.near);la.far=Math.min(da.far,la.far);return la};ea._renderGeometryAndTransparentTerrainPass=function(da){this._renderContext.output=da;this._renderGeometryPass(da);this._renderTransparentTerrain()};ea._renderGeometryPass=function(da){this._renderContext.output=da;this._renderOpaqueGeometry();this._renderTransparentGeometry()};ea._renderSSAO=function(){this._ssaoHelper.loading?this._requestRender():this._ssaoHelper.computeSSAO(this._bindParameters,this._offscreenRendering.linearDepthTexture,
this._offscreenRendering.normalTexture)};ea._renderOpaqueGeometry=function(){this._renderSlot(E.RenderSlot.INTEGRATED_MESH);this._renderSlot(E.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(E.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(E.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(E.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};ea._renderTransparentGeometry=function(){this._renderInternalSlot(E.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(E.RenderSlot.TRANSPARENT_MATERIAL)};ea._renderTransparentTerrain=
function(){this._renderSlot(E.RenderSlot.TRANSPARENT_TERRAIN)};ea._renderHUDVisibility=function(da){let la=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;la=this._renderInternalSlot(E.RenderSlot.OCCLUSION_PIXELS)},da);return la};ea._renderLineCallouts=function(da){this._bindParameters.renderTransparentlyOccludedHUD=da;da===
x.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(E.RenderSlot.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(E.RenderSlot.LINE_CALLOUTS)};ea._renderHUD=function(da,la){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(da),!0),this._rctx.bindFramebuffer(la),this._compositingHelper.composite(this._bindParameters,
this._offscreenRendering.hudColorTexture,W.AlphaMode.PremultipliedAlpha)):da===x.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(x.HUDTransparentRenderStyle.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(da))};ea._renderHUDElements=function(da){this._bindParameters.renderTransparentlyOccludedHUD=da;this._renderInternalSlot(E.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(E.RenderSlot.HUD_MATERIAL);
this._renderInternalSlot(E.RenderSlot.LABEL_MATERIAL)};ea._renderHighlights=function(da,la){if(this._needsHighlight){var oa=this._highlight,ra=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(q.ShaderOutput.Highlight);this._rctx.clearSafe(ba.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(x.HUDTransparentRenderStyle.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=
ra.colorTexture;this._needsShadowHighlight&&this._shadowHighlight.render(la,da);oa.render(this._bindParameters,ra,da)}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};ea._accumulateShadows=function(da,la,oa){this._needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,da,la,oa)};ea._renderOrderIndependentTransparency=function(da,la){const oa=Aa=>{this._bindParameters.transparencyPassType=Aa;this._offscreenRendering.renderOITPass(()=>
da(),Aa,la)},ra=this._renderContext.output;this._renderContext.output=q.ShaderOutput.Alpha;oa(Y.TransparencyPassType.Alpha);this._renderContext.output=q.ShaderOutput.Color;oa(Y.TransparencyPassType.Color);oa(Y.TransparencyPassType.FrontFace);this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,la);this._bindParameters.transparencyPassType=Y.TransparencyPassType.NONE;this._renderContext.output=ra;this._oitUsed=!0};ea._disposeOITBuffers=function(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),
this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget));this._oitUsed=!1};ea._renderOccluded=function(){let da=0;this._materialRenderers.forEach((ua,za)=>{za&&za.isVisible()&&za.renderOccluded===K.RenderOccludedFlag.OccludeAndTransparentStencil&&(da|=za.renderOccluded,ma.push(za))});const la=this._offscreenRendering,oa=(ua,za,va,Ja,pa)=>{0!==(da&za)&&(la.renderToTargets(va,la.tmpColor,la.mainDepth,
[0,0,0,0],Ja,pa),la.compositeOccludedOntoMain(this._bindParameters,ua))};0!==ma.length&&(this._renderInternalSlot(E.RenderSlot.OCCLUDER_MATERIAL,ma),oa(.5,K.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(E.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ma),!1,!1),ma.length=0);this._materialRenderers.forEach((ua,za)=>{za&&za.isVisible()&&(za.renderOccluded===K.RenderOccludedFlag.OccludeAndTransparent||za.renderOccluded===K.RenderOccludedFlag.Transparent||za.renderOccluded===
K.RenderOccludedFlag.Opaque)&&(da|=za.renderOccluded,ia.push(za))});const ra=this._renderPlugins.renderOccludedFlags;if(da|=ra){var Aa=ua=>{this._renderContext.renderOccludedMask=ua;ra>K.RenderOccludedFlag.Occlude&&this._renderSlot(E.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(E.RenderSlot.OPAQUE_MATERIAL,ia);this._renderInternalSlot(E.RenderSlot.TRANSPARENT_MATERIAL,ia);this._renderInternalSlot(E.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ia);this._renderContext.resetRenderOccludedMask()};
this._renderContext.output=q.ShaderOutput.Color;oa(.5,K.RenderOccludedFlag.OccludeAndTransparent,()=>Aa(K.RenderOccludedFlag.OccludeAndTransparent),!0,v.StencilBits.OutlineVisualElementMask);oa(.5,K.RenderOccludedFlag.Transparent,()=>Aa(K.RenderOccludedFlag.Transparent),!0,v.StencilBits.OutlineVisualElementMask);oa(1,K.RenderOccludedFlag.Opaque,()=>Aa(K.RenderOccludedFlag.Opaque),!0,v.StencilBits.OutlineVisualElementMask);ia.length=0}};ea._renderAntiAliasing=function(da){if(this._antialiasing){if(this._smaaPass.enable(()=>
this._requestRender())&&d.isSome(da))return this._smaaPass.render(da),!0}else this._smaaPass.disable();return!1};ea._prepare=function(da,la){this._needsTransparentPass=g.someMap(this._materialRenderers,oa=>oa.requiresSlot(E.RenderSlot.TRANSPARENT_MATERIAL,q.ShaderOutput.Color));this._bindParameters.camera=da;this._bindParameters.contentCamera=la};ea._ensureBindParameters=function(da,la){this._bindParameters.camera=da;this._bindParameters.contentCamera=la;da=this._renderContext.offscreenRenderingHelper;
this._bindParameters.hudVisibilityTexture=da.hudVisibilityTexture;this._bindParameters.mainColorTexture=da.mainColorTexture;this._bindParameters.highlightDepthTexture=da.depthTexture??this._getFallbackDepthTexture()};ea._ensureBindParametersSSR=function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=u.IDENTITY:(w.invert(ka,this._bindParameters.camera.viewMatrix),w.invert(ha,this._bindParameters.camera.projectionMatrix),w.multiply(Z,
ka,ha),w.multiply(Z,this._renderContext.lastFrameCamera.viewMatrix,Z),w.multiply(Z,this._renderContext.lastFrameCamera.projectionMatrix,Z),this._reprojectionMatrix=Z),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null;this._bindParameters.ssr.enabled=this.hasWaterReflection};ea._renderInternalSlot=function(da,la){let oa=!1;this._bindParameters.slot=da;d.isSome(la)?la.forEach(ra=>{ra.shouldRender(this._renderContext)&&
(ra=this._materialRenderers.get(ra),d.isSome(ra)&&(oa=ra.render(this._renderContext.output,this._bindParameters)||oa))}):this._materialRenderers.forEach((ra,Aa)=>{Aa.shouldRender(this._renderContext)&&ra.render(this._renderContext.output,this._bindParameters)&&(oa=!0)});return oa};ea._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=J.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(fa,[{key:"_bindParameters",
get:function(){return this._renderContext.bindParameters}},{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},{key:"updating",get:function(){return this._antialiasing&&this._smaaPass.updating||d.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return w.equals(this._bindParameters.ssr.reprojectionMatrix,
u.IDENTITY)}},{key:"_reprojectionMatrix",set:function(da){m.update(this._bindParameters.ssr.reprojectionMatrix,da)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){return!!this._shadowMap?.enabled}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlendWorking}},{key:"animationTimestep",get:function(){return this._animationTimestep}},
{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.ready||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this._needsShadowHighlight||this._needsShadowCast}},{key:"_needsNormal",get:function(){return this._ssaoHelper.ready}},{key:"_needsDepthRange",get:function(){return this._shadowMap.enabled||this._needsShadowCast}},{key:"_needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"_needsShadowHighlight",
get:function(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}},{key:"_needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){return{offscreen:this._offscreenRendering?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}},{key:"test",get:function(){const da=
this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,getFramebufferTexture:la=>{switch(la){case a.FramebufferId.Color:return da._offscreenRendering.colorTexture;case a.FramebufferId.LinearDepth:return da._offscreenRendering.linearDepthTexture;case a.FramebufferId.Normals:return da._offscreenRendering.normalTexture;
case a.FramebufferId.ShadowMap:return da._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return da._offscreenRendering.hudVisibilityTexture;case a.FramebufferId.Highlight:return da._offscreenRendering.highlightTexture}}}}}]);return fa}(r);c.__decorate([l.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);c.__decorate([l.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([l.property()],a.Renderer.prototype,"_antialiasing",void 0);c.__decorate([l.property()],a.Renderer.prototype,
"_edgeView",void 0);c.__decorate([l.property()],a.Renderer.prototype,"updating",null);c.__decorate([l.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([t.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);a.FramebufferId=void 0;(function(ca){ca[ca.Color=0]="Color";ca[ca.LinearDepth=1]="LinearDepth";ca[ca.Normals=2]="Normals";ca[ca.ShadowMap=3]="ShadowMap";ca[ca.HudVisibility=4]="HudVisibility";ca[ca.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId=
{}));const ia=[],ma=[],ha=u.create(),ka=u.create(),Z=u.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,b){const c=b.Milliseconds(1E3);b=b.Milliseconds(1E3/30);a.MAXIMUM_ANIMATION_LOAD=.5;a.MAXIMUM_IDLE_ANIMATION_FPS_TIME=b;a.MINIMUM_IDLE_ANIMATION_FPS_TIME=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderSlot".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(){function y(C,
k){this.rctx=C;this.shaderTechniqueRepository=k;this.canRender=!0;this._materialPassParameters=new h.MaterialPassParameters;this._shadowPassParameters=new h.ShadowMapPassParameters;this._highlightPassParameters=new h.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new d.RenderPass(C,k),materialTransparent:new d.RenderPass(C,k,d.RenderPassSorting.BackToFront),materialIntegratedMesh:new d.RenderPass(C,k),shadowMap:new d.RenderPass(C,k),highlight:new d.RenderPass(C,k),highlightIntegratedMesh:new d.RenderPass(C,
k),highlightShadowMap:new d.RenderPass(C,k),defaultShadowMap:new d.RenderPass(C,k)}}var B=y.prototype;B.register=function(C){this._systems.add(C)};B.prepareRender=function(C){if(0!==this._systems.size){for(const k of Object.values(this._passes))k.prepareSubmit();this._systems.forEach(k=>k.submit(this._passes,C.bindParameters));for(const k of Object.values(this._passes))k.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};B.render=function(C){if(0!==this._systems.size)switch(this._configure(C),
C.bindParameters.slot){case A.RenderSlot.OPAQUE_MATERIAL:switch(C.output){case f.ShaderOutput.Color:return this._materialPassParameters.subPass=h.MaterialSubPass.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Depth:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Normal:return this._materialPassParameters.subPass=
h.MaterialSubPass.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,C.bindParameters);case f.ShaderOutput.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,C.bindParameters);case f.ShaderOutput.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,C.bindParameters);case f.ShaderOutput.ShadowExludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,
C.bindParameters);case f.ShaderOutput.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=h.MaterialSubPass.ObjectAndLayerIdColor,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters)}break;case A.RenderSlot.TRANSPARENT_MATERIAL:switch(C.output){case f.ShaderOutput.Color:return this._materialPassParameters.subPass=h.MaterialSubPass.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Alpha:return this._materialPassParameters.subPass=
h.MaterialSubPass.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Depth:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Normal:return this._materialPassParameters.subPass=h.MaterialSubPass.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=
h.MaterialSubPass.ObjectAndLayerIdColor,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters)}break;case A.RenderSlot.INTEGRATED_MESH:switch(C.output){case f.ShaderOutput.Color:return this._materialPassParameters.subPass=h.MaterialSubPass.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Depth:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,
C.bindParameters);case f.ShaderOutput.Normal:return this._materialPassParameters.subPass=h.MaterialSubPass.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,C.bindParameters);case f.ShaderOutput.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,C.bindParameters);case f.ShaderOutput.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=h.MaterialSubPass.ObjectAndLayerIdColor,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,
C.bindParameters)}}};B.notifyDirty=function(){this._context.requestRender()};B.slots=function(){return[A.RenderSlot.OPAQUE_MATERIAL,A.RenderSlot.TRANSPARENT_MATERIAL,A.RenderSlot.INTEGRATED_MESH]};B.initializeRenderContext=function(C){this._context=C};B.uninitializeRenderContext=function(){};B.queryDepthRange=function(C){const k={near:Infinity,far:-Infinity};this._systems.forEach(q=>{q=q.queryShadowCasterDepthRange(C);c.isSome(q)&&l.union(k,q,k)});return k};B._configure=function(C){this._updateParameters(C,
C.output===f.ShaderOutput.Shadow||C.output===f.ShaderOutput.ShadowHighlight||C.output===f.ShaderOutput.ShadowExludeHighlight?this._shadowPassParameters:C.output===f.ShaderOutput.Highlight?this._highlightPassParameters:this._materialPassParameters)};B._updateParameters=function(C,k){const q=C.bindParameters.camera,x=q.viewInverseTransposeMatrix;p.set(w,x[3],x[7],x[11]);z.set(w);p.copy(k.transformWorldFromViewTH,z.high);p.copy(k.transformWorldFromViewTL,z.low);p.copy(k.slicePlaneLocalOrigin,w);r.fromMat4(k.transformViewFromCameraRelativeRS,
q.viewMatrix);n.copy(k.transformProjFromView,q.projectionMatrix);k.identifier===h.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=C.bindParameters.slot===A.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=C.bindParameters.slot===A.RenderSlot.INTEGRATED_MESH,r.transpose(u,k.transformViewFromCameraRelativeRS),r.invert(k.transformNormalViewFromGlobal,u))};b._createClass(y,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||
0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);return y}();const w=g.create(),u=m.create(),z=new e.TwoVectorPosition;a.RenderPassManager=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/TransparencyPassType ../../../../webgl/enums".split(" "),
function(a,b,c,r,m,n){a.RenderPassSorting=void 0;(function(h){h[h.FrontToBack=0]="FrontToBack";h[h.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));let p=function(){function h(f,e,l=a.RenderPassSorting.FrontToBack){this._rctx=f;this._techniqueRepository=e;this._sorting=l;this._draws=new r({initialSize:32,allocator:A=>A||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var d=h.prototype;
d.submitDraw=function(f,e,l,A){const t=this._draws.pushNew();t.geometry=e;t.geometryRanges=l;t.material=f;t.depthSquaredHint=A;t.indexType=e.indexed?c.unwrap(e.vao.indexBuffer).indexType:0};d.dispatch=function(f,e){const l=this._rctx;this._previouslyBoundDraw.clear();let A=null;const t=this._draws.map(y=>y.material.prepareTechnique(this._techniqueRepository,f,e,y.geometry.parameters)),w=this._draws.length;for(let y=0;y<w;y++){var u=t[y];if(u!==A||u.configuration.transparencyPassType!==m.TransparencyPassType.NONE)l.bindTechnique(u,
f,e),A=u;var z=this._draws.data[y];const B=z.geometry;l.bindVAO(B.vao);this._previouslyBoundDraw.get(u)!==z.material&&(u.program.bindDraw(z.material,e,f),this._previouslyBoundDraw.set(u,z.material));u=z.geometryRanges;const C=u.length;if(0!==z.indexType){const k=g.get(z.indexType);for(let q=0;q<C;q+=2)l.drawElements(B.primitiveType,u[q+1],z.indexType,u[q]*k)}else for(z=0;z<C;z+=2)l.drawArrays(B.primitiveType,u[z],u[z+1])}};d.prepareSubmit=function(){this._draws.clear()};d.finishSubmit=function(){const f=
this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((e,l)=>{const A=f*(e.depthSquaredHint-l.depthSquaredHint);return 0!==A?A:e.geometry.vao.size-l.geometry.vao.size})};b._createClass(h,[{key:"count",get:function(){return this._draws.length}}]);return h}();const g=new Map;g.set(n.DataType.UNSIGNED_BYTE,1);g.set(n.DataType.UNSIGNED_SHORT,2);g.set(n.DataType.UNSIGNED_INT,4);a.RenderPass=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./VertexArrayObject ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){let C=function(){function k(x,v){this._techniqueRep=x;this._rctx=v;this._viewportToRestore=n.create();this._passParameters=new w.HighlightPassParameters;this._downsampleDrawParameters=new A.HighlightDownsampleDrawParameters;this._blurDrawParameters=new e.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var q=k.prototype;q._assertResources=
function(){if(!this._quadVAO){this._quadVAO=h.createQuadVAO(this._rctx);var x={colorTarget:z.TargetType.TEXTURE,depthStencilTarget:z.DepthStencilTargetType.NONE,width:0,height:0},v={target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,samplingMode:z.TextureSamplingMode.LINEAR,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new y.FramebufferObject(this._rctx,x,v);this._blur1Fbo=new y.FramebufferObject(this._rctx,x,v);this._blurTechnique=
this._techniqueRep.acquire(l.HighlightBlurTechnique);this._downsampleTechnique=this._techniqueRep.acquire(t.HighlightDownsampleTechnique);this._applyTechnique=this._techniqueRep.acquire(f.HighlightApplyTechnique)}};q.dispose=function(){this._blurTechnique=c.releaseMaybe(this._blurTechnique);this._downsampleTechnique=c.releaseMaybe(this._downsampleTechnique);this._applyTechnique=c.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let x=1;x<this._grid.coverageMipmap.length;x++)this._grid.coverageMipmap[x].dispose();
this._grid.vao&&this._grid.vao.dispose(!0);this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null);this._blur0Fbo=c.disposeMaybe(this._blur0Fbo);this._blur1Fbo=c.disposeMaybe(this._blur1Fbo)};q.setDefaultOptions=function(x){this._passParameters={...(new w.HighlightPassParameters),...x}};q.render=function(x,v,D){this._passParameters.highlightColorTexture=v.colorTexture;this._assertResources();var F=x.camera;m.copy(this._viewportToRestore,F.fullViewport);var G=F.pixelRatio;const J=Math.ceil(F.fullWidth/
G);F=Math.ceil(F.fullHeight/G);this._blur0Fbo.resize(J,F);this._blur1Fbo.resize(J,F);G=this._rctx;G.bindVAO(this._quadVAO);let L=null;this._gridUpdateResources(v,32);this._gridComputeMipmap(x);this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;L=this._grid.vao;const K=G.bindTechnique(this._blurTechnique,this._passParameters,x);G.bindVAO(L);G.bindFramebuffer(this._blur0Fbo);G.setViewport(0,0,J,F);G.setClearColor(0,0,0,0);G.clear(z.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=v.colorTexture;r.set(this._blurDrawParameters.blurSize,1/J,0);K.bindDraw(this._blurDrawParameters,x,this._passParameters);G.drawArrays(this._blurTechnique.primitiveType,0,B.vertexCount(L,"geometry"));G.bindFramebuffer(this._blur1Fbo);G.clear(z.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture;r.set(this._blurDrawParameters.blurSize,0,1/F);K.bindDraw(this._blurDrawParameters,x,this._passParameters);G.drawArrays(this._blurTechnique.primitiveType,
0,B.vertexCount(L,"geometry"));G.bindFramebuffer(D);G.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]);this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture;G.bindTechnique(this._applyTechnique,this._passParameters,x);G.drawArrays(this._applyTechnique.primitiveType,0,B.vertexCount(L,"geometry"));G.bindVAO(null)};q._gridUpdateResources=function(x,v){const D=this._rctx,F=this._grid;var G=!1;null===F.coverageMipmap&&
(F.coverageMipmap=[x],G=!0);if(F.viewportWidth!==x.width||F.viewportHeight!==x.height)G=!0,F.viewportWidth=x.width,F.viewportHeight=x.height;F.coverageMipmap[0]=x;F.cellPixelSize!==v&&(F.cellPixelSize=v,G=!0);if(G){for(v=1;v<F.coverageMipmap.length;v++)F.coverageMipmap[v].dispose();F.mipmapLevels=Math.ceil(Math.log(F.cellPixelSize)*Math.LOG2E);F.coverageMipmap.length=F.mipmapLevels+1;for(v=0;v<F.mipmapLevels;v++)G=F.coverageMipmap[v],F.coverageMipmap[v+1]=new y.FramebufferObject(D,{colorTarget:z.TargetType.TEXTURE,
depthStencilTarget:z.DepthStencilTargetType.NONE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)},{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGB,dataType:z.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:z.TextureSamplingMode.LINEAR,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)})}G=Math.ceil(x.height/F.cellPixelSize);var J=Math.ceil(x.width/F.cellPixelSize);if(!F.vao||F.verticalCellCount!==G||F.horizontalCellCount!==J){F.verticalCellCount=
G;F.horizontalCellCount=J;x=G+1;v=J+1;G=1/G;J=1/J;const L=new Float32Array(24*x*v);let K=0;for(let O=0;O<x;O++)for(let P=0;P<v;P++)L[K+0]=(P-.5)*J*2-1,L[K+1]=(O-.5)*G*2-1,L[K+2]=P*J,L[K+3]=O*G,L[K+4]=(P+.5)*J*2-1,L[K+5]=(O-.5)*G*2-1,L[K+6]=P*J,L[K+7]=O*G,L[K+8]=(P-.5)*J*2-1,L[K+9]=(O+.5)*G*2-1,L[K+10]=P*J,L[K+11]=O*G,L[K+12]=(P-.5)*J*2-1,L[K+13]=(O+.5)*G*2-1,L[K+14]=P*J,L[K+15]=O*G,L[K+16]=(P+.5)*J*2-1,L[K+17]=(O-.5)*G*2-1,L[K+18]=P*J,L[K+19]=O*G,L[K+20]=(P+.5)*J*2-1,L[K+21]=(O+.5)*G*2-1,L[K+22]=
P*J,L[K+23]=O*G,K+=24;F.vao&&F.vao.dispose(!0);F.vao=new d.VertexArrayObject(D,p.Default3D,{geometry:g.Pos2Tex},{geometry:u.BufferObject.createVertex(D,z.Usage.STATIC_DRAW,L)})}};q._gridComputeMipmap=function(x){const v=this._rctx,D=this._grid,F=v.bindTechnique(this._downsampleTechnique,this._passParameters,x);v.bindVAO(this._quadVAO);for(let G=0;G<D.mipmapLevels;G++){v.bindFramebuffer(D.coverageMipmap[G+1]);const J=D.coverageMipmap[G+1].width,L=D.coverageMipmap[G+1].height;this._downsampleDrawParameters.inputTexture=
D.coverageMipmap[G].colorTexture;r.set(this._downsampleDrawParameters.invFramebufferDim,1/J,1/L);F.bindDraw(this._downsampleDrawParameters,x,this._passParameters);v.setViewport(0,0,J,L);v.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(this._quadVAO,"geometry"))}};b._createClass(k,[{key:"gpuMemoryUsage",get:function(){let x=(c.isSome(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(c.isSome(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const v of this._grid.coverageMipmap)x+=
v.gpuMemoryUsage;return x}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}]);return k}();a.Highlight=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d){m=function(f){function e(){return f.apply(this,arguments)||this}c._inheritsLoose(e,f);var l=e.prototype;l.initializeProgram=function(A){return new p.Program(A.rctx,e.shader.get().build(),n.Default3D)};l.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})};return e}(m.ShaderTechnique);
m.shader=new r.ReloadableShaderModule(g.HighlightApply,()=>new Promise((f,e)=>a(["./HighlightApply.glsl"],f,e)));b.HighlightApplyTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g){function h(){const f=new n.ShaderBuilder,{vertex:e,fragment:l}=f,A=e.code,t=l.code;f.attributes.add(g.VertexAttribute.POSITION,"vec2");f.varyings.add("uv","vec2");f.attributes.add(g.VertexAttribute.UV0,"vec2");e.uniforms.add(new p.Texture2DPassUniform("coverageTex",w=>w.coverageTexture));A.add(m.glsl`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);l.uniforms.add(new p.Texture2DPassUniform("tex",w=>w.blurColorTexture));l.uniforms.add(new p.Texture2DPassUniform("origin",w=>w.highlightColorTexture));l.uniforms.add(new r.Float4PassUniform("uColor",w=>w.color));l.uniforms.add(new r.Float4PassUniform("haloColor",w=>w.haloColor));l.uniforms.add(new r.Float4PassUniform("opacities",w=>b.set(d,w.haloOpacity,w.haloOpacityOccluded,w.fillOpacity,w.fillOpacityOccluded)));l.constants.add("outlineSize","float",8.6);l.constants.add("blurSize","float",.4);
t.add(m.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return f}const d=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=c;a.build=h})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(){const l=new n.ShaderBuilder,{vertex:A,fragment:t}=l,w=A.code,u=t.code;l.attributes.add(h.VertexAttribute.POSITION,"vec2");l.attributes.add(h.VertexAttribute.UV0,"vec2");l.varyings.add("blurCoordinate","vec3");A.uniforms.add(new g.Texture2DPassUniform("coverageTex",z=>z.coverageTexture));t.uniforms.add(new r.Float2DrawUniform("blurSize",z=>z.blurSize));w.add(m.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);t.uniforms.add(new p.Texture2DDrawUniform("tex",z=>z.blurInputTexture));u.add(m.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`);return l}let f=function(l){function A(){var t=l.apply(this,arguments)||this;t.blurSize=c.create();return t}b._inheritsLoose(A,l);return A}(m.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=e;a.HighlightBlurDrawParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.HighlightBlur,()=>new Promise((d,f)=>a(["./HighlightBlur.glsl"],d,f)));b.HighlightBlurTechnique=m;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,r,m,n,p,g){function h(){const e=
new n.ShaderBuilder,{vertex:l,fragment:A}=e,t=l.code,w=A.code;e.attributes.add(g.VertexAttribute.POSITION,"vec2");t.add(m.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);A.uniforms.add(new p.Texture2DDrawUniform("tex",u=>u.inputTexture));A.uniforms.add(new r.Float2DrawUniform("invFramebufferDim",u=>u.invFramebufferDim));w.add(m.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return e}let d=function(e){function l(){var A=e.apply(this,arguments)||this;A.invFramebufferDim=c.create();return A}b._inheritsLoose(l,e);return l}(m.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:d,build:h},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=f;a.HighlightDownsampleDrawParameters=d;a.build=h})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.HighlightDownsample,()=>new Promise((d,f)=>a(["./HighlightDownsample.glsl"],d,f)));b.HighlightDownsampleTechnique=
m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,b,c,r,m){m=function(n){function p(){var g=n.apply(this,arguments)||this;g.color=c.fromValues(1,0,1,1);g.haloColor=c.fromValues(1,0,1,1);g.haloOpacity=1;g.haloOpacityOccluded=
.25;g.fillOpacity=.2;g.fillOpacityOccluded=.05;g.shadowColor=r.fromValues(1,0,1,1);g.shadowOpacity=.15;g.occludedShadowOpacity=.075;return g}b._inheritsLoose(p,n);return p}(m.NoParameters);a.HighlightPassParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./RenderTargetHelper ./TransparencyPassType ../shaders/CompositingTechniqueConfiguration ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(){function e(A,t){this._rctx=A;this._compositingHelper=t;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._background={type:"color",color:[0,0,0,1]};const w=A.type===p.ContextType.WEBGL2,u=this._renderTargetHelper=new r.RenderTargetHelper(A);this._mainColorTargets=[u.registerColorTarget({name:"mainColorTarget0"}),u.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=u.registerColorTarget({name:"frontFaceTarget"});A=z=>u.registerColorTarget({name:z,
dataType:g.PixelType.FLOAT,internalFormat:w?g.SizedPixelFormat.RGBA32F:g.PixelFormat.RGBA,samplingMode:g.TextureSamplingMode.NEAREST});this.colorFloatTarget=A("colorFloatTarget");this.alphaFloatTarget=A("alphaFloatTarget");this.mainDepth=u.registerDepthTarget({name:"mainDepth"});this.linearDepth=u.registerColorTarget({name:"linearDepth",samplingMode:g.TextureSamplingMode.NEAREST});this.terrainLinearDepth=u.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=u.registerColorTarget({name:"geometryLinearDepth"});
this.normal=u.registerColorTarget({name:"normal"});this.highlight=u.registerColorTarget({name:"highlight",internalFormat:w?g.SizedPixelFormat.RGBA4:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=u.registerColorTarget({name:"hudVisibility",internalFormat:w?g.SizedPixelFormat.RGBA4:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=u.registerColorTarget({name:"tmpColor"});this.tmpDepth=u.registerDepthTarget({name:"tmpDepth"});this.hudColor=
u.registerColorTarget({name:"hudColor"})}var l=e.prototype;l.dispose=function(){this._renderTargetHelper.dispose()};l.getFramebuffer=function(A,t){return this._renderTargetHelper.getFramebuffer(this._dimensions,A,t)};l.setupRenderTarget=function(A){A||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]));this._mainColorTarget=0===this._mainColorTarget&&A?1:0};l.initializeFrame=function(A){const t=this._rctx;this._dimensions.width=A.fullWidth;this._dimensions.height=A.fullHeight;
this.bindTarget(this.currentColorTarget,this.mainDepth);t.setClearStencil(0);A=this._background.color;t.setClearColor(A[0]*A[3],A[1]*A[3],A[2]*A[3],A[3]);t.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT|g.ClearBufferBit.DEPTH_BUFFER_BIT|g.ClearBufferBit.STENCIL_BUFFER_BIT)};l.composite=function(A){c.isSome(this.colorTexture)&&this._compositingHelper.composite(A,this.colorTexture,n.AlphaMode.None)};l.renderTmpAndCompositeToMain=function(A,t,w,u=!1){this.renderToTargets(A,this.tmpColor,u?this.tmpDepth:
this.mainDepth,d);this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),w)};l.renderHUDVisibility=function(A,t=!1){this.renderToTargets(A,this.hudVisibility,t?this.tmpDepth:this.mainDepth,f)};l.compositeTransparentTerrainOntoHUDVisibility=function(A){this.renderToTargets(()=>this._compositingHelper.compositeHUD(A,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)};l.renderOITPass=function(A,t,w){let u,z;switch(t){case m.TransparencyPassType.Color:u=this.colorFloatTarget;
z=[0,0,0,0];break;case m.TransparencyPassType.Alpha:u=this.alphaFloatTarget;z=[1,1,1,1];break;case m.TransparencyPassType.FrontFace:u=this.frontFaceTarget,z=[0,0,0,0]}w?this.renderToTargets(A,u,this.tmpDepth,z,!0,!0):this.renderToTargets(A,u,this.mainDepth,z,!1)};l.compositeTransparentTerrainOntoMain=function(A){this.bindFramebuffer();this._compositingHelper.composite(A,this._getColorTexture(this.tmpColor),n.AlphaMode.PremultipliedAlpha)};l.compositeOccludedOntoMain=function(A,t){this.bindFramebuffer();
this._compositingHelper.composite(A,this._getColorTexture(this.tmpColor),n.AlphaMode.PremultipliedAlpha,t)};l.compositeTransparentOntoOpaque=function(A,t){t?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeOIT(A,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};l.bindFramebuffer=
function(){this._rctx.bindFramebuffer(this.framebuffer)};l.renderDepthDetached=function(A){this.bindTarget(this.currentColorTarget);A();this.bindTarget(this.currentColorTarget,this.mainDepth)};l.disposeTarget=function(A){this._renderTargetHelper.disposeTargetResource(A)};l.renderToFBO=function(A,t,w=!1,u=!1){const z=this._rctx;let y=0;t&&(z.setClearColor(t[0],t[1],t[2],Math.max(1E-13,t[3])),y|=g.ClearBufferBit.COLOR_BUFFER_BIT);w&&(y|=g.ClearBufferBit.DEPTH_BUFFER_BIT);!1===u?u=0:(!0===u&&(u=255),
y|=g.ClearBufferBit.STENCIL_BUFFER_BIT);y&&z.clearSafe(y,u);A();z.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth)};l.renderToTargets=function(A,t,w,u,z=!1,y=!1){t=this.bindTarget(t,w);this.renderToFBO(A,u,z,y);return t};l.bindTarget=function(A,t){A=this._renderTargetHelper.getFramebuffer(this._dimensions,A,t);this._rctx.bindFramebuffer(A);return A};l._getColorTexture=function(A){return this._renderTargetHelper.getColorTexture(A,this._dimensions)};b._createClass(e,[{key:"width",
get:function(){return this._dimensions.width}},{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(A){this._background=A}},{key:"currentColorTarget",get:function(){return this._mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this._mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},
{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},
{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"gpuMemoryUsage",get:function(){let A=0;this._renderTargetHelper&&(A+=this._renderTargetHelper.gpuMemoryUsage);return A}}]);return e}();const d=[0,0,0,0],f=[0,1,0,1];a.OffscreenRendering=h;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,r,m,n,p,g,h){const d={dataType:m.PixelType.UNSIGNED_BYTE,internalFormat:m.PixelFormat.RGBA},f={};let e=function(){function l(t){this._rctx=
t;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=t.capabilities.depthTexture}var A=l.prototype;A.dispose=function(){this._depthBuffers.forEach(t=>t.dispose());this._depthBuffers.clear();this._depthTextures.forEach(t=>t.dispose());this._depthTextures.clear();this._colorTextures.forEach(t=>t.dispose());this._colorTextures.clear();this._framebuffers.forEach(t=>t.dispose());this._framebuffers.clear();
this._activeTargets.clear()};A.disposeTargetResource=function(t){t=t.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this._disposeWithFramebuffers(this._depthTextures,t),this._disposeWithFramebuffers(this._depthBuffers,t),this._disposeWithFramebuffers(this._colorTextures,t))};A._disposeWithFramebuffers=function(t,w){const u=t.get(w);u&&(this._framebuffers.forEach((z,y)=>{if(z.colorAttachment===u||z.depthStencilAttachment===u)z.detachAll(),z.dispose(),this._framebuffers.delete(y)}),u.dispose(),
t.delete(w))};A.getDepthTexture=function(t,w){if(!this.depthTextureSupported)return null;let u=this._depthTextures.get(t.id);!u||u.descriptor.width===w.width&&u.descriptor.height===w.height||(u.dispose(),u=c.nullifyNonNullableForDispose());u||(u=new g.Texture(this._rctx,{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.DEPTH_STENCIL,dataType:m.PixelType.UNSIGNED_INT_24_8,samplingMode:m.TextureSamplingMode.NEAREST,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:w.width,height:w.height}),this._depthTextures.set(t.id,
u),this._activeTargets.add(t.id));return u};A.getAllocatedDepthTexture=function(t){return this._depthTextures.get(t.id)};A.getDepthBuffer=function(t,w){if(this.depthTextureSupported)return null;let u=this._depthBuffers.get(t.id);u?u.descriptor.width===w.width&&u.descriptor.height===w.height||u.resize(w.width,w.height):(u=new p.Renderbuffer(this._rctx,{internalFormat:m.RenderbufferFormat.DEPTH_STENCIL,...w}),this._depthBuffers.set(t.id,u),this._activeTargets.add(t.id));return u};A.getColorTexture=
function(t,w){let u=this._colorTextures.get(t.id);!u||u.descriptor.width===w.width&&u.descriptor.height===w.height||(u.dispose(),u=c.nullifyNonNullableForDispose());u||(u=new g.Texture(this._rctx,{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:null!=t.samplingMode?t.samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:w.width,height:w.height}),this._colorTextures.set(t.id,u),this._activeTargets.add(t.id));
return u};A.getAllocatedColorTexture=function(t){return this._colorTextures.get(t.id)};A.registerDepthTarget=function(t={}){return{id:r.generateUID(),...f,...t}};A.registerColorTarget=function(t={}){return{id:r.generateUID(),...d,...t}};A.getFramebuffer=function(t,w,u){const z=this._getKey(w,u);let y=this._framebuffers.get(z);w=this.getColorTexture(w,t);if(this.depthTextureSupported){var B=u?this.getDepthTexture(u,t):void 0;if(!y)return y=c.isSome(u)?new n.FramebufferObject(this._rctx,{colorTarget:m.TargetType.TEXTURE,
depthStencilTarget:m.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},w,B):new n.FramebufferObject(this._rctx,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},w),this._framebuffers.set(z,y),y;if(y.width!==t.width||y.height!==t.height||y.colorTexture!==w||y.depthStencilTexture!==B)y.detachAll(),y.resize(t.width,t.height),y.attachColorTexture(w),y.attachDepthStencilTexture(B);return y}B=u?this.getDepthBuffer(u,t):void 0;if(!y)return y=new n.FramebufferObject(this._rctx,
{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:u?m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:m.DepthStencilTargetType.NONE},w,B),this._framebuffers.set(z,y),y;if(y.width!==t.width||y.height!==t.height||y.colorTexture!==w)y.detachAll(),y.resize(t.width,t.height),y.attachColorTexture(w),y.attachDepthStencilBuffer(B);return y};A._getKey=function(t,w){return`${t.id}_${w?w.id:"X"}_${t.name}${w?"_"+w.name:""}`};b._createClass(l,[{key:"gpuMemoryUsage",get:function(){let t=0;const w=new Set,
u=z=>{w.has(z)||(w.add(z),t+=h.getGpuMemoryUsage(z))};this._depthTextures.forEach(u);this._colorTextures.forEach(u);this._depthBuffers.forEach(u);return t}}]);return l}();a.RenderTargetHelper=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/promiseUtils ./depthRange ./RenderSlot".split(" "),
function(a,b,c,r,m,n){let p=function(){function h(f){this._context=f;this._renderPlugins=new c;this._slots=[];for(f=0;f<n.RenderSlot.MAX_SLOTS;++f)this._slots[f]=[]}var d=h.prototype;d.add=function(f,e,l){const A=()=>{if(l?.aborted)throw e.uninitializeRenderContext(),r.createAbortError();this._renderPlugins.push(e);for(const w of f)this._slots[w].push(e);this._context.requestRender()},t=e.initializeRenderContext(this._context,l);if(r.isPromiseLike(t))return t.then(A);A()};d.remove=function(f){if(null!=
this._renderPlugins.removeUnordered(f)){for(let e=0;e<this._slots.length;++e)this._slots[e]=this._slots[e].filter(l=>l!==f);f.uninitializeRenderContext();this._context.requestRender()}};d.prepareRender=function(){this._renderPlugins.forAll(f=>{f.prepareRender&&f.prepareRender(this._context.renderContext)})};d.updateAnimation=function(f){let e=!1;this._renderPlugins.forAll(l=>{l.updateAnimation&&(e=l.updateAnimation(f)||e)});return e};d.render=function(){const f=[];this._slots[this._context.renderContext.bindParameters.slot].filter(e=>
{if(!e.canRender)return!1;if("prepareTechnique"in e)return(e=e.prepareTechnique(this._context.renderContext))?(f.push(e),!0):!1;f.push(null);return!0}).forEach((e,l)=>e.render(this._context.renderContext,f[l]))};d.queryDepthRange=function(f){const e=g;e.near=Infinity;e.far=-Infinity;this._renderPlugins.forAll(l=>{l.queryDepthRange&&(l=l.queryDepthRange(f))&&m.union(e,l,e)});return e};b._createClass(h,[{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(f=>f.needsTransparentPass)}},
{key:"needsHighlight",get:function(){return this._renderPlugins.some(f=>f.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(f=>f.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const f=this._slots[n.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!f&&0<f.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((f,e)=>f|e.renderOccludedFlags,0)}}]);return h}();const g={near:0,far:0};a.RenderPluginManager=
p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./BindParameters ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D){var F;a.ShadowAccumulator=F=function(J){function L(O,P,N,H,E,I){var M=J.call(this,{})||this;M._rctx=O;M._stage=N;M._prepareForShadowMapPass=H;M._renderToShadowMap=E;M._requestRender=I;M._progress=0;M._sampleCount=0;M._passParameters=new C.ShadowCastAccumulatePassParameters;M._enabledInternal=!1;M._cachedLightDirections=[];M._depthRange=u.ZERO;M._previewingCached=!1;M._handles=new n;M._cameraForcedForScreenshot=!1;M._bindParameters=new t.BindParameters(new B.ShadowMap(O,
N.viewingMode),null,null);M._bindParameters.shadowMap.enabled=!0;M._bindParameters.camera=new w.Camera;M._vao=z.createQuadVAO(O);M._fbo=new v.FramebufferObject(O,{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.NONE,width:0,height:0},{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.LINEAR,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});M._accumulationRenderer=new y.ShadowCastRenderer(P,
O,b._assertThisInitialized(M),I);M._handles.add(M._stage.resourceController.scheduler.registerTask(q.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(M)));M._handles.add(h.watch(()=>N.renderView,Q=>{M._handles.remove(F.renderViewHandleKey);g.isNone(Q)||M._handles.add(Q.events.on("force-camera-for-screenshot",()=>M._cameraForcedForScreenshot=!0),F.renderViewHandleKey)},h.syncAndInitial));return M}b._inheritsLoose(L,J);var K=L.prototype;K.normalizeCtorArgs=function(){return{}};K.runTask=function(O){for(this._prepareForShadowMapPass(this._bindParameters);!O.done&&
!this._isDoneAccumulating;)this._accumulateShadow(),O.madeProgress();this._requestRender()};K.renderAccumulation=function(O,P,N,H){this._passParameters.linearDepthTexture=O;this._depthRange=P;this._updateCamera(N);this._bindParameters.contentCamera=H;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewingCached||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();O=this._cameraForcedForScreenshot?this._sampleCount:Math.min(F.previewSamples,
this._sampleCount-this._progress);for(P=0;P<O;++P)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};K.render=function(O){this._accumulationRenderer.render(O)};K.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=g.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=g.disposeMaybe(this._fbo);this._vao=g.disposeMaybe(this._vao);this._accumulationTechniqueCached=g.releaseMaybe(this._accumulationTechniqueCached);this._sampleCount=
this._cachedLightDirections.length=0};K.setOptions=function(O){void 0!==O.enabled&&(this._enabled=O.enabled);void 0!==O.previewing&&(this._previewing=O.previewing);void 0!==O.lightDirections&&(this._lightDirections=O.lightDirections);this._accumulationRenderer.setOptions(O)};K.readAccumulatedShadow=function(O,P){if(!this._isActive||1>this._progress||0>O||O>this._fbo.width||0>P||P>this._fbo.height)return 0;const N=G;this._fbo.readPixels(O,P,1,1,x.PixelFormat.RGBA,x.PixelType.UNSIGNED_BYTE,N);return N[0]/
this._progress};K._start=function(){this._progress=0;this._enabledInternal=!0};K._stop=function(){this._enabledInternal=!1};K._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};K._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(x.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};K._accumulateShadow=function(){this._renderToShadowMap(this._bindParameters,this._lightDirectionsInternal[this._progress],this._depthRange);
this._passParameters.origin=this._bindParameters.camera.center;this._rctx.bindFramebuffer(this._fbo);const O=this._accumulationTechnique;this._rctx.bindTechnique(O,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(O.primitiveType,0,D.vertexCount(this._vao,"geometry"));this._progress++};K._updateCamera=function(O){O.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(O),this._fbo.resize(O.fullWidth,O.fullHeight),this._opacityFromElevation=
1-p.smoothstep(y.shadowCastDisableElevationMin,y.shadowCastDisableElevationMax,O.relativeElevation))};K._requestRenderIfEnabled=function(){this._enabledInternal&&this._requestRender()};b._createClass(L,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"_accumulationTechnique",get:function(){g.isNone(this._accumulationTechniqueCached)&&
(this._accumulationTechniqueCached=new k.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewingCached}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewingCached}},{key:"_isActive",get:function(){return this._enabledInternal&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&
this._depthRange!==u.ZERO&&this._opacityFromElevation>y.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirectionsInternal",get:function(){return this._cachedLightDirections},set:function(O){const P=this._cachedLightDirections;if(!m.equals(P,O,l.equals)){var N=O.length;P.length=N;this._sampleCount=Math.min(C.shadowCastMaxSamples,N);for(let H=0;H<N;++H){const E=O[H],I=P[H]||A.create();l.copy(I,E);P[H]=I}this._invalidate()}}},
{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(O){this._accumulationRenderer.opacityFromElevation=O}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"_previewing",set:function(O){this._previewingCached!==O&&(this._previewingCached=O,this._requestRenderIfEnabled())}},{key:"_lightDirections",set:function(O){this._lightDirectionsInternal=O}},{key:"_enabled",set:function(O){O!==this._enabledInternal&&
(O?this._start():this._stop())}},{key:"test",get:function(){const O=this;return{lightDirections:this._lightDirectionsInternal,get isDone(){return O._isDoneAccumulating},get isActive(){return O._isActive}}}}]);return L}(r);a.ShadowAccumulator.previewSamples=6;a.ShadowAccumulator.renderViewHandleKey="renderView";c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,
"_enabledInternal",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_previewingCached",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"canAccumulate",
null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=F=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const G=new Uint8Array(4);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){const w=f.fromValues(.01,0,.25,1),u=1/512;a.ShadowCastRenderer=function(z){function y(C,k,q,x){var v=z.call(this,{})||this;v._techniqueRepository=C;v._rctx=k;v._shadowAccumulator=q;v._requestRender=x;v._passParameters={shadowCastMap:v._shadowCastTexture,sampleScale:0,color:w,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"};v._techniqueConfig=new A.ShadowCastVisualizeTechniqueConfiguration;v._enabled=!1;v._vao=e.createQuadVAO(k);v._techniqueConfig.visualization=
A.ShadowCastVisualization.Gradient;return v}b._inheritsLoose(y,z);var B=y.prototype;B.normalizeCtorArgs=function(){return{}};B.dispose=function(){this._stop();this._vao=m.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};B.render=function(C){if(this._isRenderingVisualization){this._passParameters.sampleScale=1/this._computedSamples;var k=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(k,
this._passParameters,C);this._rctx.drawArrays(k.primitiveType,0,t.vertexCount(this._vao,"geometry"))}};B.setOptions=function(C){void 0!==C.enabled&&this._setEnabled(C.enabled);void 0!==C.color&&this._setColor(C.color);void 0!==C.threshold&&(this._threshold=C.threshold);void 0!==C.visualization&&(this._visualization=C.visualization);void 0!==C.bandSize&&(this._bandSize=C.bandSize);void 0!==C.bandsEnabled&&(this._bandsEnabled=C.bandsEnabled)};B._setColor=function(C){d.exactEquals(C,this._passParameters.color)||
(d.copy(this._passParameters.color,C),this._requestRenderIfRunning())};B._setEnabled=function(C){C!==this._enabled&&(C?this._start():this._stop())};B._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};B._start=function(){this._enabled=!0;this._requestRender()};B._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(y,[{key:"_visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(l.ShadowCastVisualizeTechnique,
this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},set:function(C){this._passParameters.opacityFromElevation!==C&&(this._passParameters.opacityFromElevation=C,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>u}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",
get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(C){this._threshold!==C&&(this._passParameters.threshold=C,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(C){C!==this._visualization&&(this._techniqueConfig.visualization=C,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},
{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(C){C!==this._bandSize&&(this._passParameters.bandSize=C,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(C){C!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=C,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return y}(r);c.__decorate([n.property()],a.ShadowCastRenderer.prototype,
"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){m=function(e){function l(t,w){var u;return u=e.call(this,t,w,()=>u.destroy())||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new g.Program(t.rctx,l.shader.get().build(this.configuration),n.Default3D)};A.initializePipeline=function(){return f.makePipelineState({blending:p.blendingDefault,colorWrite:f.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(l,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);
return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(h.ShadowCastVisualize,()=>new Promise((e,l)=>a(["./ShadowCastVisualize.glsl"],e,l)));b.ShadowCastVisualizeTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(t){const w=new h.ShaderBuilder,u=w.fragment;u.include(m.RgbaFloatEncoding);u.include(c.ReadLinearDepth);w.include(r.CameraSpace);w.include(b.ScreenSpacePass);const {visualization:z,bandsEnabled:y}=t;u.constants.add("inverseSampleValue","float",f.shadowCastMaxSamples);u.uniforms.add([new d.Texture2DPassUniform("shadowCastMap",C=>C.shadowCastMap),new p.FloatPassUniform("sampleScale",C=>C.sampleScale),new p.FloatPassUniform("opacityFromElevation",C=>C.opacityFromElevation),
new n.Float4PassUniform("uColor",C=>C.color)]);t=z===e.ShadowCastVisualization.Gradient;const B=z===e.ShadowCastVisualization.Threshold;t&&y?u.uniforms.add(new p.FloatPassUniform("bandSize",C=>C.bandSize)):B&&u.uniforms.add(new p.FloatPassUniform("threshold",C=>C.threshold));u.code.add(g.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${B?g.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${t&&y?g.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${t?g.glsl`* strength`:""});
      }
    `);return w}const A=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=A;a.build=l})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(y){const B=new l.ShaderBuilder,C=B.fragment;C.include(h.RgbaFloatEncoding);C.include(n.ReadLinearDepth);B.include(g.CameraSpace);B.include(m.ScreenSpacePass);B.include(p.ReadShadowMapPass,y);C.uniforms.add([new A.Texture2DPassUniform("depthMap",k=>k.linearDepthTexture),new e.Matrix4PassUniform("inverseViewMatrix",(k,q)=>c.invert(z,c.translate(z,q.camera.viewMatrix,q.camera.center))),new d.Float2PassUniform("nearFar",(k,q)=>q.camera.nearFar)]);C.constants.add("sampleValue",
"float",u);C.code.add(f.glsl`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`);return B}let w=function(y){function B(){return y.apply(this,arguments)||this}b._inheritsLoose(B,y);return B}(p.ReadShadowMapBindParameters);const u=1/255,z=r.create();r=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:w,shadowCastMaxSamples:255,build:t},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=r;a.ShadowCastAccumulatePassParameters=w;a.build=t;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){a.ShadowCastVisualization=void 0;(function(n){n[n.Gradient=0]="Gradient";n[n.Threshold=1]="Threshold";n[n.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.visualization=a.ShadowCastVisualization.Gradient;g.bandsEnabled=!1;return g}b._inheritsLoose(p,n);
return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter({count:a.ShadowCastVisualization.COUNT})],m.prototype,"visualization",void 0);c.__decorate([r.parameter()],m.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){m=function(l){function A(w){var u;return u=l.call(this,w,new h.ShadowConfiguration,()=>u.destroy())||this}c._inheritsLoose(A,l);var t=A.prototype;t.initializeConfiguration=function(w,u){u.hasWebGL2Context=w.rctx.type===d.ContextType.WEBGL2};t.initializeProgram=function(w){return new p.Program(w.rctx,A.shader.get().build(this.configuration),n.Default3D)};t.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(A,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);return A}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.ShadowCastAccumulate,()=>new Promise((l,A)=>a(["./ShadowCastAccumulate.glsl"],l,A)));b.ShadowCastAccumulateTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,r){let m=function(n){function p(){var g=n.apply(this,arguments)||this;g.receiveShadows=!0;g.hasWebGL2Context=!1;return g}b._inheritsLoose(p,n);return p}(r.ShaderTechniqueConfiguration);c.__decorate([r.parameter()],m.prototype,"receiveShadows",void 0);c.__decorate([r.parameter()],
m.prototype,"hasWebGL2Context",void 0);a.ShadowConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){let e=function(){function A(w,u){this._rctx=w;this._viewingMode=u;this._maxOpacity=1;this._passParameters=new d.ShadowHighlightPassParameters;this._drawParameters=new g.ReadShadowMapBindParameters;this._vao=h.createQuadVAO(this._rctx)}var t=A.prototype;t.render=function(w,u){if(w.shadowMap.enabled&&w.linearDepthTexture&&this.isVisible){var z=this._technique;this._drawParameters.origin=w.camera.center;this._rctx.bindFramebuffer(u);this._rctx.bindTechnique(z,this._passParameters,
w).bindDraw(this._drawParameters,w,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(z.primitiveType,0,f.vertexCount(this._vao,"geometry"))}};t.setDefaultOptions=function(w){this._passParameters={...this._passParameters,...w};this._updateMaxOpacity()};t.updateParameters=function(w,u){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,w.relativeElevation);w=this._viewingMode===p.ViewingMode.Global?m.normalize(l,w.center):m.set(l,0,0,1);u=m.dot(w,u);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*u,0,1))};t.dispose=function(){this._vao=r.disposeMaybe(this._vao);this._techniqueCached=r.releaseMaybe(this._techniqueCached)};t._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};b._createClass(A,[{key:"_technique",get:function(){r.isNone(this._techniqueCached)&&(this._techniqueCached=new d.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));
return this._techniqueCached}},{key:"gpuMemoryUsage",get:function(){return this._vao?.size??0}},{key:"isVisible",get:function(){const {opacityElevation:w,dayNightTerminator:u}=this._passParameters;return.001953125<=this._maxOpacity*w*u}}]);return A}();const l=n.create();a.ShadowHighlight=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ./ShadowConfiguration ../../../../chunks/ShadowHighlight.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){m=function(t){function w(){var u=t.apply(this,arguments)||this;u.shadowColor=r.fromValues(1,0,1,1);u.shadowOpacity=.2;u.occludedShadowOpacity=.1;u.opacityElevation=1;u.dayNightTerminator=1;return u}c._inheritsLoose(w,t);return w}(m.NoParameters);p=function(t){function w(z){var y;return y=t.call(this,z,new d.ShadowConfiguration,()=>y.destroy())||this}c._inheritsLoose(w,t);var u=w.prototype;u.initializeConfiguration=function(z,y){y.hasWebGL2Context=z.rctx.type===
e.ContextType.WEBGL2};u.initializeProgram=function(z){return new h.Program(z.rctx,w.shader.get().build(this.configuration),g.Default3D)};u.initializePipeline=function(){return A.makePipelineState({blending:A.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:A.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(w,[{key:"primitiveType",get:function(){return l.PrimitiveType.TRIANGLE_STRIP}}]);
return w}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(f.ShadowHighlight,()=>new Promise((t,w)=>a(["./ShadowHighlight.glsl"],t,w)));b.ShadowHighlightPassParameters=m;b.ShadowHighlightTechnique=p;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/maybe ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){function x(J){const L=new C.ShaderBuilder;L.include(e.ReadShadowMapDraw,J);J=L.fragment;J.include(A.RgbaFloatEncoding);J.include(f.ReadLinearDepth);L.include(l.CameraSpace);L.include(h.ScreenSpacePass);J.uniforms.add([new k.Texture2DPassUniform("defaultDepthTex",(K,O)=>O.shadowMap.getSnapshot(q.SnapshotSlot.Default)),new k.Texture2DPassUniform("highlightDepthTex",(K,O)=>O.shadowMap.getSnapshot(q.SnapshotSlot.Highlight)),new k.Texture2DPassUniform("depthMap",
(K,O)=>O.linearDepthTexture),new k.Texture2DPassUniform("highlightMap",(K,O)=>O.highlightColorTexture),new u.Float4PassUniform("uColor",K=>K.shadowColor),new t.Float2PassUniform("nearFar",(K,O)=>O.camera.nearFar),new z.FloatPassUniform("opacity",K=>K.shadowOpacity),new z.FloatPassUniform("occludedOpacity",K=>K.occludedShadowOpacity),new z.FloatPassUniform("terminationFactor",K=>K.opacityElevation*K.dayNightTerminator),new w.Float3PassUniform("lightingMainDirectionView",(K,O)=>p.normalize(F,p.transformMat4(F,
O.lighting.mainLight.direction,O.camera.viewInverseTransposeMatrix))),new t.Float2PassUniform("texelSize",(K,O)=>b.isSome(O.linearDepthTexture)?m.set(G,1/O.linearDepthTexture.descriptor.width,1/O.linearDepthTexture.descriptor.height):n.ZEROS),new B.Matrix4PassUniform("inverseViewMatrix",(K,O)=>c.invert(D,c.translate(D,O.camera.viewMatrix,O.camera.center)))]);J.constants.add("unoccludedHighlightFlag","vec4",d.unoccludedHighlightFlag).add("highlightedThreshold","float",v.highlightedThreshold).add("selfShadowThreshold",
"float",v.selfShadowThreshold);J.code.add(y.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);J.code.add(y.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return L}const v={highlightedThreshold:.99999,selfShadowThreshold:.025},D=r.create(),F=g.create(),G=n.create();r=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=r;a.build=x})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function r(){this._plane=b.create()}a._createClass(r,[{key:"isEnabled",
get:function(){return!b.equals(this.plane,c)}},{key:"plane",get:function(){return this._plane},set:function(m){b.copy(m||c,this._plane)}}]);return r}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../core/shaderTechnique/ShaderTechniqueConfiguration ./BlendWeightsTechnique ./BlurTechnique ./EdgeDetectTechnique ./glUtil3D ../shaders/SMAAPassParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){b.SmaaRenderPass=function(k){function q(v,D){var F=k.call(this,{})||this;F._rctx=v;F._techniqueRep=D;F._passParameters=new z.SMAAPassParameters;F._isEnabled=!1;return F}c._inheritsLoose(q,k);var x=q.prototype;x.normalizeCtorArgs=function(){return{}};x.dispose=function(){this._abortController=n.abortMaybe(this._abortController);this.disable()};x._loadResources=function(v){if(n.isSome(this._abortController))return!1;if(n.isSome(this._passParameters.searchTexture))return!0;
this._abortController=new AbortController;const D=this._abortController.signal;(new Promise((F,G)=>a(["./SmaaRenderPassData"],F,G))).then(F=>this._loadTextures(F,D)).then(()=>v()).finally(()=>this._abortController=null);return!1};x._loadTextures=function(v,D){p.throwIfAborted(D);return Promise.all([this._loadTextureFromBase64(v.areaTexture,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB),this._loadTextureFromBase64(v.searchTexure,y.TextureSamplingMode.NEAREST,y.PixelFormat.LUMINANCE)]).then(([F,G])=>
{p.isAborted(D)?(F.dispose(),G.dispose(),p.throwIfAborted(D)):(this._passParameters.areaTexture=F,this._passParameters.searchTexture=G)})};x.enable=function(v){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const D=new l.ShaderTechniqueConfiguration;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(w.EdgeDetectTechnique,D,this._edgeDetectTechnique);this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(A.BlendWeightsTechnique,
D,this._blendWeightsTechnique);this._blurTechnique=this._techniqueRep.releaseAndAcquire(t.BlurTechnique,D,this._blurTechnique)}if(!this._loadResources(v))return!1;this._vao=u.createScreenSizeTriangleVAO(this._rctx);this._passParameters.edges=new B.FramebufferObject(this._rctx,{colorTarget:y.TargetType.TEXTURE,depthStencilTarget:y.DepthStencilTargetType.NONE},{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGB,dataType:y.PixelType.UNSIGNED_BYTE,samplingMode:y.TextureSamplingMode.LINEAR,
wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._passParameters.blend=new B.FramebufferObject(this._rctx,{colorTarget:y.TargetType.TEXTURE,depthStencilTarget:y.DepthStencilTargetType.NONE},{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,samplingMode:y.TextureSamplingMode.LINEAR,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};x.disable=function(){this._isEnabled&&(this._vao=n.disposeMaybe(this._vao),
this._passParameters.areaTexture=n.disposeMaybe(this._passParameters.areaTexture),this._passParameters.searchTexture=n.disposeMaybe(this._passParameters.searchTexture),this._passParameters.blend=n.disposeMaybe(this._passParameters.blend),this._passParameters.edges=n.disposeMaybe(this._passParameters.edges),this._isEnabled=!1)};x.render=function(v){const D=this._validPassParameters;if(!n.isNone(D)){D.colorTexture=v;var F=this._rctx,G=F.getBoundFramebufferObject(),J=v.descriptor.width;v=v.descriptor.height;
F.bindVAO(this._vao);F.setViewport(0,0,J,v);D.edges.resize(J,v);F.bindFramebuffer(D.edges);F.setClearColor(0,0,0,1);F.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._edgeDetectTechnique,D,null);F.drawArrays(y.PrimitiveType.TRIANGLES,0,3);D.blend.resize(J,v);F.bindFramebuffer(D.blend);F.setClearColor(0,0,1,1);F.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blendWeightsTechnique,D,null);F.drawArrays(y.PrimitiveType.TRIANGLES,0,3);F.bindFramebuffer(G);F.setClearColor(0,
1,0,1);F.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blurTechnique,D,null);F.drawArrays(y.PrimitiveType.TRIANGLES,0,3)}};x._loadTextureFromBase64=function(v,D,F){return e.requestImage(v).then(G=>new C.Texture(this._rctx,{pixelFormat:F,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:G.width,height:G.height,samplingMode:D},G))};c._createClass(q,[{key:"updating",get:function(){return n.isSome(this._abortController)}},{key:"_validPassParameters",get:function(){return this._isEnabled?
this._passParameters:null}}]);return q}(m);r.__decorate([g.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);r.__decorate([g.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=r.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BlendWeightsTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/BlendWeights.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.BlendWeights,()=>new Promise((d,f)=>a(["../shaders/BlendWeights.glsl"],d,f)));b.BlendWeightsTechnique=m;
Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/BlendWeights.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,b,c,r,m,n){function p(){const d=new c.ShaderBuilder,
{attributes:f,varyings:e,vertex:l,fragment:A}=d;f.add(m.VertexAttribute.POSITION,"vec2");e.add("fTexCoord","vec2");e.add("fOffset[3]","vec4");e.add("fPixCoord","vec2");n.addResolutionUniform(l);l.code.add(b.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.glsl.int(g.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `);A.uniforms.add(new r.Texture2DPassUniform("tEdges",t=>t.edges.colorTexture));A.uniforms.add(new r.Texture2DPassUniform("tArea",t=>t.areaTexture));A.uniforms.add(new r.Texture2DPassUniform("tSearch",t=>t.searchTexture));A.uniforms.add(new r.Texture2DPassUniform("tColor",t=>t.colorTexture));n.addResolutionUniform(A);A.code.add(b.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(g.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(g.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(g.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(g.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.glsl.int(g.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `);return d}const g={maxSearchSteps:8,maxDistanceAreaTex:16},h=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=h;a.build=p})},"esri/views/3d/webgl-engine/shaders/SMAAPassParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces".split(" "),function(a,b,c,r,m,n){n=function(h){function d(){return h.apply(this,
arguments)||this}b._inheritsLoose(d,h);return d}(n.NoParameters);let p=function(h){function d(){return h.apply(this,arguments)||this}b._inheritsLoose(d,h);return d}(n);const g=r.create();a.SMAAPassParameters=n;a.ValidSMAAPassParameters=p;a.addResolutionUniform=function(h){h.uniforms.add(new m.Float4PassUniform("resolution",d=>c.set(g,1/d.colorTexture.descriptor.width,1/d.colorTexture.descriptor.height,d.colorTexture.descriptor.width,d.colorTexture.descriptor.height)))};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/Blur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;
e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.Blur,()=>new Promise((d,f)=>a(["../shaders/Blur.glsl"],d,f)));b.BlurTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Blur.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),
function(a,b,c,r,m,n){function p(){const h=new c.ShaderBuilder,{attributes:d,varyings:f,vertex:e,fragment:l}=h;d.add(m.VertexAttribute.POSITION,"vec2");f.add("fTexCoord","vec2");f.add("fOffset[2]","vec4");n.addResolutionUniform(e);e.code.add(b.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`);l.uniforms.add(new r.Texture2DPassUniform("tBlendWeights",A=>A.blend.colorTexture));l.uniforms.add(new r.Texture2DPassUniform("tColor",A=>A.colorTexture));n.addResolutionUniform(l);l.code.add(b.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`);return h}const g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.Blur=g;a.build=p})},"esri/views/3d/webgl-engine/lib/EdgeDetectTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/EdgeDetect.glsl ../../../webgl/renderState".split(" "),function(a,b,c,r,m,n,
p,g,h){m=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);var e=f.prototype;e.initializeProgram=function(l){return new p.Program(l.rctx,f.shader.get().build(),n.Default3D)};e.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return f}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.EdgeDetect,()=>new Promise((d,f)=>a(["../shaders/EdgeDetect.glsl"],d,f)));b.EdgeDetectTechnique=m;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/EdgeDetect.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,b,c,r,m,n){function p(){const d=new c.ShaderBuilder,{attributes:f,varyings:e,vertex:l,
fragment:A}=d;f.add(m.VertexAttribute.POSITION,"vec2");n.addResolutionUniform(l);e.add("fTexCoord","vec2");e.add("fOffset[3]","vec4");l.code.add(b.glsl`void EdgeDetectEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0) * 0.5;
gl_Position = vec4(position, 0, 1);
EdgeDetectEdgeDetectionVS(fTexCoord);
}`);A.uniforms.add(new r.Texture2DPassUniform("tColor",t=>t.colorTexture));A.code.add(b.glsl`
    vec4 EdgeDetectColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
      vec2 threshold = vec2( ${b.glsl.float(g.threshold)} );

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D( colorTex, texcoord ).rgb;

      vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
      vec3 t = abs( C - Cleft );
      delta.x = max( max( t.r, t.g ), t.b );

      vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
      t = abs( C - Ctop );
      delta.y = max( max( t.r, t.g ), t.b );

      // We do the usual threshold:
      vec2 edges = step( threshold, delta.xy );

      // Then discard if there is no edge:
      if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
          discard;

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
      t = abs( C - Cright );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
      t = abs( C - Cbottom );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
      t = abs( C - Cleftleft );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
      t = abs( C - Ctoptop );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the final maximum delta:
      maxDelta = max( max( maxDelta, delta.z ), delta.w );

      // Local contrast adaptation in action:
      edges.xy *= step( maxDelta, float(${b.glsl.float(g.localConstrastAdaption)}) * delta.xy );

      return vec4( edges, 0.0, 0.0 );
    }

    void main() {
      gl_FragColor = EdgeDetectColorEdgeDetectionPS(fTexCoord, fOffset, tColor);
    }
  `);return d}const g={threshold:.05,localConstrastAdaption:2},h=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=h;a.build=p})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T){function S(ia){let ma=null,ha=null;for(let ka=0;ka<ia.geometries.length;ka++){const Z=ia.geometryRecords[ka];if(Z.material.supportsEdges){if(!ma)ma=Z.transformation;else if(!m.equals(ma,Z.transformation))return!1;if(!ha&&g.isSome(Z.origin))ha=Z;else if(g.isSome(ha?.origin)&&g.isSome(Z.origin)&&ha.origin.id!==Z.origin.id)return!1}}return!0}function U(ia,ma,ha){ma*=ha;ha=m.binaryIndexOf(ia,ma,!0);return-1===ha?
ma<ia[0]?ia.length:0:ia.length-ha}a.EdgeView=function(ia){function ma(ka){var Z=ia.call(this,ka)||this;Z._updatingHandles=new u.WatchUpdatingTracking;Z._perObjectData=new Map;Z._perObjectDataEvictionCache=new Set;Z._renderers=new Map;Z._gpuMemoryUsage=0;Z._workerAbort=new AbortController;Z._tmpModelPosition=w.create();Z._localOrigins=new v.LocalOriginManager(new q.GridLocalOriginFactory(ka.renderSR));return Z}b._inheritsLoose(ma,ia);var ha=ma.prototype;ha.initialize=function(){this._worker=new N.EdgeWorkerHandle(this.schedule);
this._componentColorManager=new M.BufferManager(this.rctx,3);const ka=J.VertexLayout.createBuffer(4);for(let Z=0;4>Z;Z++)ka.sideness.set(Z,0,0===Z||3===Z?0:1),ka.sideness.set(Z,1,0===Z||1===Z?0:1);this._verticesBufferObject=Q.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ka.buffer)};ha.destroy=function(){this.destroyed||(this._perObjectData.forEach(ka=>this._discardObjectEntry(ka)),this._perObjectData.clear(),this._strokesTexture=g.disposeMaybe(this._strokesTexture),this._componentColorManager=
g.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=g.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())};ha.shouldRender=function(){return 0<this._renderers.size};ha.addComponentObject=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea,da,la,oa,ra){if(this.hasObject(Z))return this.getObjectMemoryUsage(Z);let Aa;fa=new Y(new Promise(ua=>Aa=ua),fa.center,fa.radius);this._perObjectData.set(Z,
fa);Z=yield this._updatingHandles.addPromise(this._addComponentGeometry(ca,fa,ea,da,la,oa,ra));this.setNeedsRender();Aa();return Z});return function(Z,ca,fa,ea,da,la,oa,ra){return ka.apply(this,arguments)}}();ha.addOrUpdateObject3D=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea){if(this.destroyed)n.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");else{var da=this._perObjectData.get(Z);0<da?.renderables.length&&this._perObjectDataEvictionCache.add(da);
var la,oa=Z.boundingVolumeWorldSpace.bounds;oa=new Y(new Promise(Aa=>la=Aa),z.getCenter(oa),z.getRadius(oa));this._perObjectData.set(Z,oa);var ra=[];if(fa.mergeGeometries&&1<Z.geometries.length&&S(Z))ra.push(this._addObjectMergedGeometries(Z,oa,ca,fa,ea));else for(let Aa=0;Aa<Z.geometries.length;Aa++){const ua=Z.geometryRecords[Aa];ua.material.supportsEdges&&ra.push(this._addGeometry(Z,oa,Z.geometries[Aa],ua,ca[0],fa,ea))}yield this._updatingHandles.addPromise(Promise.all(ra));this._perObjectDataEvictionCache.delete(oa);
this._discardObjectEntry(da);this.setNeedsRender();la()}});return function(Z,ca,fa,ea){return ka.apply(this,arguments)}}();ha._discardObjectEntry=function(ka){ka&&(ka.renderables.length&&(ka.renderables.forEach(Z=>this._removeRenderable(Z)),this.setNeedsRender()),ka.loaded=null)};ha.hasObject=function(ka){return this._perObjectData.has(ka)};ha.updateAllComponentOpacities=function(){var ka=b._asyncToGenerator(function*(Z,ca){Z=yield this._updatingHandles.addPromise(this._getObjectEntry(Z));if(!g.isNone(Z)){var fa=
ca instanceof Array?ea=>ca[ea]:()=>ca;Z.renderables.forEach(ea=>{const da=ea.components.meta.length;for(let la=0;la<da;la++){const oa=fa(la),ra=ea.components.meta[la],Aa=ra.index;ra.material.opacity=oa;ea.components.buffer.textureBuffer.setDataElement(Aa,1,3,255*oa)}this._updateTransparency(ea)});this.setNeedsRender()}});return function(Z,ca){return ka.apply(this,arguments)}}();ha.getObjectMemoryUsage=function(){var ka=b._asyncToGenerator(function*(Z){Z=yield this._getObjectEntry(Z);return g.isSome(Z)?
Z.renderables.reduce((ca,fa)=>ca+fa.statistics.gpuMemoryUsage,0):0});return function(Z){return ka.apply(this,arguments)}}();ha.updateAllComponentMaterials=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea){const da=Z instanceof D.Object3D,la=!!fa.hasSlicePlane,oa=I.determineRendererType(ca),ra=O.EdgeRenderer.getKey(oa,la,da);Z=yield this._updatingHandles.addPromise(this._getObjectEntry(Z));g.isNone(Z)||(Z.renderables.forEach(Aa=>{if(ra!==Aa.rendererKey){var ua=this._renderers.get(Aa.rendererKey);
const za=this._acquireRenderer(oa,la,da);ua.removeRenderable(Aa);--ua.refCount;Aa.rendererKey=ra;za.addRenderable(Aa)}for(ua=0;ua<ca.length;ua++)Aa.components.meta[ua].material=ca[ua];ea&&this._updateComponentBuffer(Aa.components);this._updateTransparency(Aa)}),this.setNeedsRender())});return function(Z,ca,fa,ea){return ka.apply(this,arguments)}}();ha.updateAllVerticalOffsets=function(){var ka=b._asyncToGenerator(function*(Z,ca){Z=yield this._updatingHandles.addPromise(this._getObjectEntry(Z));g.isNone(Z)||
(Z.renderables.forEach(fa=>{const ea=fa.components.meta;for(let da=0;da<ea.length;da++)fa.components.meta[da].verticalOffset=ca?.[da]??0;this._updateComponentBuffer(fa.components)}),this.setNeedsRender())});return function(Z,ca){return ka.apply(this,arguments)}}();ha.updateObjectVisibility=function(){var ka=b._asyncToGenerator(function*(Z,ca){Z=yield this._updatingHandles.addPromise(this._getObjectEntry(Z));g.isSome(Z)&&(Z.renderables.forEach(fa=>fa.visible=ca),this.setNeedsRender())});return function(Z,
ca){return ka.apply(this,arguments)}}();ha.removeObject=function(ka){const Z=this._perObjectData.get(ka);Z&&(this._perObjectData.delete(ka),this._discardObjectEntry(Z))};ha._getObjectEntry=function(){var ka=b._asyncToGenerator(function*(Z){Z=this._perObjectData.get(Z);if(!Z)throw"no object";yield Z.loaded;return null==Z.loaded?null:Z});return function(Z){return ka.apply(this,arguments)}}();ha.render=function(ka,Z){if(!g.isNone(this._componentColorManager)){this._localOrigins.updateViewMatrices(ka.camera.viewMatrix);
var ca=ka.camera.viewInverseTransposeMatrix,fa=w.create(),ea=new k.TwoVectorPosition,da=0,la=0;this._renderers.forEach(ra=>{if(0===ra.refCount)this._renderers.delete(ra.key),ra.dispose();else{let Aa=!0,ua=!0;ra.forEachRenderable(za=>{za.visible&&(da+=za.statistics.averageEdgeLength,la++,Aa&&za.regular&&(ra.updateTechnique(ka,!1),Aa=!1),ua&&za.silhouette&&(ra.updateTechnique(ka,!0),ua=!1))},Z)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==la){var oa=
new P.EdgePassParameters(40*da/la,Z);t.set(fa,ca[3],ca[7],ca[11]);ea.set(fa);t.copy(oa.transformWorldFromViewTH,ea.high);t.copy(oa.transformWorldFromViewTL,ea.low);e.fromMat4(oa.transformViewFromCameraRelativeRS,ka.camera.viewMatrix);e.transpose(ba,oa.transformViewFromCameraRelativeRS);e.invert(oa.transformNormalViewFromGlobal,ba);oa.transformProjFromView=ka.camera.projectionMatrix;this._updateObjectCameraDistances(ka);this._renderers.forEach(ra=>{this._renderRegularEdges(ra,ka,oa);this._renderSilhouetteEdges(ra,
ka,oa)})}}};ha._updateTransparency=function(ka){const Z=I.determineEdgeTransparency(ka.components.meta),ca=I.determineObjectTransparency(ka.components.meta);if(Z!==ka.edgeTransparency||ca!==ka.objectTransparency)ka.edgeTransparency=Z,ka.objectTransparency=ca,this._renderers.get(ka.rendererKey).setRenderablesDirty()};ha._computeModelTransformWithLocalOrigin=function(ka,Z,ca){ka.getCombinedStaticTransformation(Z,ca);ka=g.isSome(Z.origin)?this._localOrigins.register(Z.origin):this._localOrigins.acquire(t.set(this._tmpModelPosition,
ca[12],ca[13],ca[14]));Z.origin=ka.origin;x.applyToModelMatrix(ka.origin.vec3,ca);return ka};ha._updateComponentBuffer=function(ka){const {meta:Z,buffer:ca}=ka;ka=new Uint8Array(4);for(let ea=0;ea<Z.length;ea++){var fa=Z[ea].material;const da=Z[ea].index,la=p.clamp(Math.round(fa.size*O.LINE_WIDTH_FRACTION_FACTOR),0,255),oa=p.clamp(fa.extensionLength,-O.EXTENSION_LENGTH_OFFSET,255-O.EXTENSION_LENGTH_OFFSET)+O.EXTENSION_LENGTH_OFFSET,ra="solid"===fa.type?K.EdgeType.SOLID:K.EdgeType.SKETCH,Aa=255*fa.opacity;
fa=fa.color;ca.textureBuffer.setData(da,0,255*fa[0],255*fa[1],255*fa[2],255*fa[3]);ca.textureBuffer.setData(da,1,la,oa,ra,Aa);C.encodeElevationOffset(Z[ea].verticalOffset,ka);ca.textureBuffer.setData(da,2,ka[0],ka[1],ka[2],ka[3])}};ha._createComponentBuffers=function(ka){if(g.isNone(this._componentColorManager))return null;const Z=[],ca=this._componentColorManager.getBuffer(ka.length);for(let fa=0;fa<ka.length;fa++){const ea=ka[fa],da=ca.acquireIndex();Z.push({index:da,verticalOffset:0,material:ea})}ka=
new V(ca,Z);this._updateComponentBuffer(ka);return ka};ha._extractEdges=function(ka,Z,ca,fa,ea,da=ea.length){return this._worker.process({data:Z,indices:ea,indicesLength:da,writerSettings:ka,skipDeduplicate:ca},this._workerAbort.signal,fa)};ha._createRenderable=function(ka,Z,ca,fa,ea){const da=g.isSome(this._verticesBufferObject)&&0<ka.regular.lodInfo.lengths.length?new R(new F.VertexArrayObject(this.rctx,J.EdgeShaderAttributeLocations,{vertices:J.glVertexLayout,instances:L.RegularEdgeBufferWriter.glLayout},
{vertices:this._verticesBufferObject,instances:Q.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ka.regular.instancesData.buffer)}),ka.regular.lodInfo):null,la=g.isSome(this._verticesBufferObject)&&0<ka.silhouette.lodInfo.lengths.length?new R(new F.VertexArrayObject(this.rctx,J.EdgeShaderAttributeLocations,{vertices:J.glVertexLayout,instances:L.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:Q.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ka.silhouette.instancesData.buffer)}),
ka.silhouette.lodInfo):null,oa=(g.isSome(da)?da.vao.size:0)+(g.isSome(la)?la.vao.size:0);return new W(da,la,{gpuMemoryUsage:oa,externalMemoryUsage:ea,averageEdgeLength:ka.averageEdgeLength},ca,I.determineEdgeTransparency(Z.meta),I.determineObjectTransparency(Z.meta),Z,fa)};ha._addGeometry=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea,da,la,oa){var ra=fa.vertexAttributes.get(G.VertexAttribute.POSITION);const Aa=fa.indices.get(G.VertexAttribute.POSITION),ua=A.create();Z=this._computeModelTransformWithLocalOrigin(Z,
ea,ua);ra=new aa(ra,Aa,ua,Z);return this._addPositionData(ca,ra,fa.edgeIndicesLength,da,la,oa)});return function(Z,ca,fa,ea,da,la,oa){return ka.apply(this,arguments)}}();ha._addPositionData=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea,da,la=!1){if(null!=Z.loaded){var oa=this._createComponentBuffers([ea]);if(!(g.isNone(oa)||0>=fa)){ea=this._acquireRenderer(ea.type,!!da.hasSlicePlane,!0);var {modelTransform:ra,origin:Aa}=ca;da=ca.indices;ca=ca.position;var ua=ca.data.length/ca.size,za=
J.EdgeInputBufferLayout.createBuffer(ua);for(let va=0;va<ua;va++)za.position.set(va,0,ca.data[va*ca.size]),za.position.set(va,1,ca.data[va*ca.size+1]),za.position.set(va,2,ca.data[va*ca.size+2]);I.fillComponenBufferIndices(oa.meta,[0,za.componentIndex.count],za.componentIndex);fa=yield this._updatingHandles.addPromise(this._extractEdges(ea.writerSettings,za,!1,la,da,fa));null!=Z.loaded&&(oa=this._createRenderable(fa,oa,new X(ra,Aa),ea.key,!1),Z.renderables.push(oa),ea.addRenderable(oa),this._gpuMemoryUsage+=
oa.statistics.gpuMemoryUsage)}}});return function(Z,ca,fa,ea,da){return ka.apply(this,arguments)}}();ha._addComponentGeometry=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea,da,la,oa){if(null==ca.loaded)return 0;const ra=this._createComponentBuffers(la);if(g.isNone(ra))return 0;la=I.determineRendererType(la);oa=this._acquireRenderer(la,oa.hasSlicePlane||!1,!1);la=J.EdgeInputBufferLayout.createBuffer(fa.count);y.copy(la.position,fa);I.fillComponenBufferIndices(ra.meta,da,la.componentIndex,
ea);fa=yield this._updatingHandles.addPromise(this._extractEdges(oa.writerSettings,la,!0,!1,ea));if(null==ca.loaded)return 0;Z=this._createRenderable(fa,ra,Z,oa.key,!0);ca.renderables.push(Z);oa.addRenderable(Z);return Z.statistics.gpuMemoryUsage});return function(Z,ca,fa,ea,da,la,oa){return ka.apply(this,arguments)}}();ha._addObjectMergedGeometries=function(){var ka=b._asyncToGenerator(function*(Z,ca,fa,ea,da){var la=new Map,oa=0,ra=null,Aa=0;for(var ua=0;ua<Z.geometries.length;ua++){var za=Z.geometries[ua],
va=Z.geometryRecords[ua];va.material.supportsEdges&&(!ra&&va.origin&&(ra=va),va=za.vertexAttributes.get(G.VertexAttribute.POSITION),Aa+=va.data.length/va.size,oa+=za.edgeIndicesLength)}Aa=65536<=Aa?Uint32Array:Uint16Array;oa=oa?new Aa(oa):null;Aa=[];ua=0;for(za=0;za<Z.geometries.length;za++){va=Z.geometries[za];if(!Z.geometryRecords[za].material.supportsEdges)continue;var Ja=va.vertexAttributes.get(G.VertexAttribute.POSITION);const pa=va.indices.get(G.VertexAttribute.POSITION);let Ba=la.get(Ja.data);
if(null==Ba){Ba=Aa.length/3;for(let Ha=0;Ha<Ja.data.length;Ha+=Ja.size)Aa.push(Ja.data[Ha+0]),Aa.push(Ja.data[Ha+1]),Aa.push(Ja.data[Ha+2]);la.set(Ja.data,Ba)}if(pa)for(Ja=0;Ja<va.edgeIndicesLength;Ja++)oa[ua++]=Ba+pa[Ja]}ra=ra||Z.geometryRecords[0];la=A.create();ra=this._computeModelTransformWithLocalOrigin(Z,ra,la);for(ua=0;ua<Z.geometryRecords.length;ua++)Z.geometryRecords[ua].origin=ra.origin;Z=new aa({data:Aa,size:3},oa,la,ra);yield this._updatingHandles.addPromise(this._addPositionData(ca,Z,
oa.length,fa[0],ea,da))});return function(Z,ca,fa,ea,da){return ka.apply(this,arguments)}}();ha._acquireRenderer=function(ka,Z,ca){const fa=O.EdgeRenderer.getKey(ka,Z,ca);let ea=this._renderers.get(fa);g.isNone(this._strokesTexture)&&(this._strokesTexture=E.generateStrokesTexture(this.rctx));ea||(ea=new O.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ka,hasSlicePlane:Z,strokesTexture:this._strokesTexture,legacy:ca,spherical:this.viewingMode===B.ViewingMode.Global}),this._renderers.set(fa,
ea));++ea.refCount;return ea};ha._removeRenderable=function(ka){g.isSome(ka.regular)&&(ka.regular.vao.vertexBuffers.instances.dispose(),ka.regular.vao.dispose(!1),ka.regular.vao=null);g.isSome(ka.silhouette)&&(ka.silhouette.vao.vertexBuffers.instances.dispose(),ka.silhouette.vao.dispose(!1),ka.silhouette.vao=null);const Z=this._renderers.get(ka.rendererKey);if(Z){Z.removeRenderable(ka);--Z.refCount;"origin"in ka.transform&&this._localOrigins.release(ka.transform.origin);this._gpuMemoryUsage-=ka.statistics.externalMemoryUsage?
0:ka.statistics.gpuMemoryUsage;for(const ca of ka.components.meta)ka.components.buffer.releaseIndex(ca.index)}};ha._updateObjectCameraDistances=function(ka){const Z=ka.camera.eye,ca=ka.camera.viewForward,fa=w.create();ka=ea=>{t.sub(fa,ea.center,Z);const da=t.dot(fa,ca),la=ea.radius,oa=da<-la?Infinity:da<la?0:da-la;ea.renderables.forEach(ra=>ra.distanceToCamera=oa)};this._perObjectData.forEach(ka);this._perObjectDataEvictionCache.forEach(ka)};ha._renderRegularEdges=function(ka,Z,ca){const fa=ka.bindRegularEdges(ca,
Z),ea=Z.camera.perScreenPixelRatio;ka.forEachRenderable(da=>{if(g.isSome(da.regular)&&da.visible){var la=U(da.regular.lod.lengths,da.distanceToCamera,ea);ka.renderRegularEdges(fa,da,ca,Z,la)}},ca.transparency)};ha._renderSilhouetteEdges=function(ka,Z,ca){const fa=ka.bindSilhouetteEdges(ca,Z),ea=Z.camera.perScreenPixelRatio;ka.forEachRenderable(da=>{if(g.isSome(da.silhouette)&&da.visible){var la=U(da.silhouette.lod.lengths,da.distanceToCamera,ea);ka.renderSilhouetteEdges(fa,da,ca,Z,la)}},ca.transparency)};
b._createClass(ma,[{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"usedMemory",get:function(){return this._gpuMemoryUsage}},{key:"test",get:function(){return{hasRenderedPrimitives:ka=>{let Z=!1;const ca=ka.perScreenPixelRatio,fa=(ea,da)=>ea.forEachRenderable(la=>{la.visible&&!Z&&(g.isSome(la.regular)&&(Z=0<U(la.regular.lod.lengths,la.distanceToCamera,ca)),!Z&&g.isSome(la.silhouette)&&(Z=0<U(la.silhouette.lod.lengths,la.distanceToCamera,ca)))},da);this._renderers.forEach(ea=>
{Z||(fa(ea,H.Transparency.OPAQUE),fa(ea,H.Transparency.TRANSPARENT))});return Z}}}}]);return ma}(r);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,
"setNeedsRender",void 0);c.__decorate([h.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([h.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);c.__decorate([h.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);let Y=function(ia,ma,ha){this.center=ma;this.radius=ha;this.renderables=[];this.loaded=ia;this.loaded.then(()=>{null!=
this.loaded&&(this.loaded=!0)})},V=function(ia,ma){this.buffer=ia;this.meta=ma},R=function(ia,ma){this.vao=ia;this.lod=ma},X=function(ia,ma){this.modelMatrix=ia;this.origin=ma},W=function(ia,ma,ha,ka,Z,ca,fa,ea){this.regular=ia;this.silhouette=ma;this.statistics=ha;this.transform=ka;this.edgeTransparency=Z;this.objectTransparency=ca;this.components=fa;this.rendererKey=ea;this.distanceToCamera=0;this.visible=!0};c=function(ia){function ma(){return ia.apply(this,arguments)||this}b._inheritsLoose(ma,
ia);return ma}(W);r=function(ia){function ma(){return ia.apply(this,arguments)||this}b._inheritsLoose(ma,ia);return ma}(W);let aa=function(ia,ma,ha,ka){this.position=ia;this.indices=ma;this.modelTransform=ha;this.origin=ka};const ba=l.create();a.LegacyTransform=X;a.RegularRenderable=c;a.Renderable=W;a.SilhouetteRenderable=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=
function(b,c){const r=-b[0],m=-b[1];b=-b[2];const n=c[3],p=c[7],g=c[11],h=c[15];c[0]+=n*r;c[1]+=n*m;c[2]+=n*b;c[4]+=p*r;c[5]+=p*m;c[6]+=p*b;c[8]+=g*r;c[9]+=g*m;c[10]+=g*b;c[12]+=h*r;c[13]+=h*m;c[14]+=h*b};a.applyToViewMatrix=function(b,c){const r=b[0],m=b[1];b=b[2];c[12]+=r*c[0]+m*c[4]+b*c[8];c[13]+=r*c[1]+m*c[5]+b*c[9];c[14]+=r*c[2]+m*c[6]+b*c[10];c[14]+=r*c[3]+m*c[7]+b*c[11]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports",
"../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,r){let m=function(){function p(h){this._factory=h;this._originData=new Map}var g=p.prototype;g.acquire=function(h){return this.register(this._factory.getOrigin(h))};g.register=function(h){h=this._originData.get(h.id)||new n(h);h.refCount++;this._originData.has(h.origin.id)||this._originData.set(h.origin.id,h);return h};g.release=function(h){h.refCount--;0===h.refCount&&this._originData.delete(h.origin.id)};
g.updateViewMatrices=function(h){this._originData.forEach(d=>{b.copy(d.viewMatrix,h);r.applyToViewMatrix(d.origin.vec3,d.viewMatrix)})};return p}(),n=function(p){this.origin=p;this.refCount=0;this.viewMatrix=c.create()};a.LocalOriginManager=m;a.OriginData=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){const w={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},u={solid:A.EdgeUtilMode.SOLID,sketch:A.EdgeUtilMode.SKETCH,uber:A.EdgeUtilMode.MIXED};A=function(){function y(C,k,q){this._rctx=C;this._shaderTechniqueRepository=k;this._configuration=new e.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[l.Transparency.TRANSPARENT]:{[l.Transparency.TRANSPARENT]:new c,[l.Transparency.OPAQUE]:new c},
[l.Transparency.OPAQUE]:{[l.Transparency.TRANSPARENT]:new c,[l.Transparency.OPAQUE]:new c}};this._renderablesDirty=!1;this._drawParameters=new d.EdgeDrawParameters;this._settings={...w,...q};this.key=y.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:p.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=u[this._settings.type];this._configuration.silhouette=
!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=g.doublePrecisionRequiresObfuscation(C);this._configuration.spherical=q.spherical}var B=y.prototype;B.dispose=function(){this._technique=b.releaseMaybe(this._technique)};B.addRenderable=function(C){this._renderables.add(C);this._renderablesDirty=!0};B.removeRenderable=function(C){this._renderables.delete(C);
this._renderablesDirty=!0};B.setRenderablesDirty=function(){this._renderablesDirty=!0};B.forEachRenderable=function(C,k){this._renderablesDirty&&this._sortRenderables();this._sortedRenderables[k][l.Transparency.TRANSPARENT].forAll(C);this._sortedRenderables[k][l.Transparency.OPAQUE].forAll(C)};B.updateTechnique=function(C,k){this._configuration.hasMultipassTerrain=!!C.multipassTerrain.enabled;this._configuration.cullAboveGround=!!C.multipassTerrain.cullAboveGround;this._configuration.silhouette=k;
return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(f.EdgeShaderTechnique,this._configuration,this._technique)};B.bindRegularEdges=function(C,k){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(k,!1),C,k)};B.bindSilhouetteEdges=function(C,k){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(k,!0),C,k)};B.renderRegularEdges=function(C,k,q,x,v){this._render(C,k,k.regular.vao,q,x,v)};B.renderSilhouetteEdges=function(C,k,q,x,
v){this._render(C,k,k.silhouette.vao,q,x,v)};B._render=function(C,k,q,x,v,D){0<D&&(this._bindDraw(C,k,x,v),this._rctx.bindVAO(q),this._rctx.capabilities.instancing.drawArraysInstanced(t.PrimitiveType.TRIANGLE_FAN,0,4,D))};B._bindDraw=function(C,k,q,x){this._drawParameters.componentDataTexture=k.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in k.transform)this._lastOriginId!==k.transform.origin.origin.id&&(C.setUniformMatrix4fv("localView",
k.transform.origin.viewMatrix),this._lastOriginId=k.transform.origin.origin.id),C.setUniformMatrix4fv("model",k.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=k.transform.origin.origin.vec3;else{const v=new h.TwoVectorPosition(k.transform.position),D=r.transpose(z,r.invert(z,k.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=v.low;this._drawParameters.transformWorldFromModelTH=v.high;this._drawParameters.transformWorldFromModelRS=k.transform.rotationScale;
this._drawParameters.transformNormalGlobalFromModel=D;k=x.camera.viewInverseTransposeMatrix;n.set(this._drawParameters.slicePlaneLocalOrigin,k[3],k[7],k[11])}C.bindDraw(this._drawParameters,x,q)};B._sortRenderables=function(){this._renderablesDirty=!1;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].clear();this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].clear();this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].clear();
this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].clear();this._renderables.forEach(k=>{k.objectTransparency!==l.Transparency.INVISIBLE&&k.edgeTransparency!==l.Transparency.INVISIBLE&&this._sortedRenderables[k.objectTransparency][k.edgeTransparency].push(k)});const C=(k,q)=>"origin"in k.transform?"origin"in q.transform?k.transform.origin.origin.id<q.transform.origin.origin.id?-1:k.transform.origin.origin.id>q.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].sort(C);
this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].sort(C);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].sort(C);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].sort(C)};y.getKey=function(C,k,q){return`edges-t:${C}:${k}:${q}`};return y}();const z=m.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=A;a.LINE_WIDTH_FRACTION_FACTOR=8;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,c,r,m){let n=function(p){function g(h,d){var f=p.call(this)||this;f.distanceFalloffFactor=h;f.transparency=d;f.transformNormalViewFromGlobal=c.create();return f}b._inheritsLoose(g,p);return g}(m.VertexPositionPassParameters);
m=function(p){function g(){var h=p.apply(this,arguments)||this;h.transformNormalViewFromGlobal=c.create();h.slicePlaneLocalOrigin=r.create();h.transformNormalGlobalFromModel=c.create();return h}b._inheritsLoose(g,p);return g}(m.VertexPositionDrawParameters);a.EdgeDrawParameters=m;a.EdgePassParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/context-util ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){m=function(e){function l(){return e.apply(this,arguments)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeConfiguration=function(t,w){w.hasWebGL2Context=t.rctx.type===h.ContextType.WEBGL2};A.initializeProgram=function(t){return new n.Program(t.rctx,l.shader.get().build(this.configuration),p.EdgeShaderAttributeLocations)};A.initializePipeline=function(t){return t.blendMinMax?f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE,
d.BlendFactor.ZERO,d.BlendFactor.ONE,d.BlendOperation.ADD,t.blendMinMax.MAX),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams}):f.makePipelineState({depthTest:{func:d.CompareFunction.LEQUAL},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.EdgeShader,()=>new Promise((e,l)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],e,l)));b.EdgeShaderTechnique=m;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){function k(v){const D=new f.ShaderBuilder,{vertex:F,fragment:G}=D;v.antialiasing&&(F.code.add(d.glsl`#define ANTIALIASING 1`),G.code.add(d.glsl`#define ANTIALIASING 1`));v.legacy&&F.uniforms.add([new x("model"),new x("localView")]);D.include(A.AdjustProjectedPosition,v);D.include(z.EdgeUtil,v);D.include(y.LineAmplitude,v);D.include(C.UnpackAttributes,v);D.include(B.LineOffset,v);D.include(m.SliceDraw,v);D.include(w.DiscardNonSilhouetteEdges,v);D.include(t.DiscardByCoverage,
v);D.include(u.DiscardShortEdges,v);D.include(n.multipassTerrainTest,v);D.varyings.add("vColor","vec4");D.varyings.add("vRadius","float");D.varyings.add("vPosition","vec3");D.varyings.add("vWorldPosition","vec3");D.varyings.add("vViewPos","vec3");D.varyings.add("vLineLengthPixels","float");D.varyings.add("vSizeFalloffFactor","float");F.uniforms.add([new p.Float2PassUniform("pixelToNDC",(J,L)=>c.set(q,2/L.camera.fullViewport[2],2/L.camera.fullViewport[3])),new g.Float4PassUniform("viewport",(J,L)=>
L.camera.fullViewport),new h.FloatPassUniform("pixelRatio",(J,L)=>L.camera.pixelRatio)]);D.attributes.add(l.VertexAttribute.POSITION0,"vec3");D.attributes.add(l.VertexAttribute.POSITION1,"vec3");D.attributes.add(l.VertexAttribute.VARIANTOFFSET,"float");D.attributes.add(l.VertexAttribute.VARIANTSTROKE,"float");D.attributes.add(l.VertexAttribute.VARIANTEXTENSION,"float");F.code.add(d.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);D.fragment.code.add(d.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return D}const q=r.create();let x=function(v){function D(F){return v.call(this,F,"mat4")||this}b._inheritsLoose(D,v);return D}(e.Uniform);r=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=r;a.build=k})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,r,m,n,p){const g=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(h,d){h=h.vertex;h.include(c.IsNaN);h.constants.add("depthBias","vec2",g);h.uniforms.add(new r.Float2PassUniform("inverseViewport",(f,e)=>e.inverseViewport));d.legacy?(h.uniforms.add(new p.Matrix4PassUniform("proj",(f,e)=>e.camera.projectionMatrix)),h.code.add(m.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(h.uniforms.add(new n.Matrix3PassUniform("transformNormalViewFromGlobal",f=>f.transformNormalViewFromGlobal)),h.uniforms.add(new p.Matrix4PassUniform("transformProjFromView",f=>f.transformProjFromView)),h.code.add(m.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));h.code.add(m.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const r=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,r){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);r.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):
c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,r){c=c.vertex;r.silhouette?
(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),r.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,b,c){a.DiscardShortEdges=function(r,m){r=r.vertex;switch(m.mode){case c.EdgeUtilMode.SKETCH:r.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case c.EdgeUtilMode.MIXED:r.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case c.EdgeUtilMode.SOLID:r.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderLibrary/util/WebGL2Utils ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../core/shaderModules/TextureSizeUniformType ../../../lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.EdgeUtilMode=void 0;(function(w){w[w.SOLID=0]="SOLID";w[w.SKETCH=1]="SKETCH";w[w.MIXED=2]="MIXED";w[w.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeUtil=function(w,u){const z=w.vertex;z.include(r.RgbaFloatEncoding);z.uniforms.add(new g.FloatPassUniform("distanceFalloffFactor",y=>y.distanceFalloffFactor));z.code.add(h.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);z.uniforms.add(l.createTexture2DDrawSizeUniforms("componentDataTex",y=>y.componentDataTexture,u.hasWebGL2Context?A.TextureSizeUniformType.None:A.TextureSizeUniformType.InvSize));w.attributes.add(t.VertexAttribute.COMPONENTINDEX,"float");z.constants.add("componentColorFieldOffset","float",0);z.constants.add("componentOtherFieldOffset","float",1);z.constants.add("componentVerticalOffsetFieldOffset","float",2);z.constants.add("componentFieldCount","float",3);z.constants.add("lineWidthFractionFactor",
"float",8);z.constants.add("extensionLengthOffset","float",128);z.constants.add("verticalOffsetScale","float",2*b.MAX_ELEVATION_OFFSET);z.code.add(h.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${m.textureSize(u,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      vec2 textureCoordinates = vec2(colIndex, rowIndex) + 0.5;

      return textureCoordinates;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${m.texelFetch(u,"componentDataTex","colorIndex")};
      vec4 otherValue = ${m.texelFetch(u,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${m.texelFetch(u,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `);u.legacy?z.code.add(h.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(z.uniforms.add(new d.Matrix3DrawUniform("transformNormalGlobalFromModel",y=>y.transformNormalGlobalFromModel)),z.code.add(h.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));u.silhouette?(w.attributes.add(t.VertexAttribute.NORMALA,"vec3"),w.attributes.add(t.VertexAttribute.NORMALB,"vec3"),z.code.add(h.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(w.attributes.add(t.VertexAttribute.NORMAL,"vec3"),z.code.add(h.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));u.legacy?z.code.add(h.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(z.include(c.DoublePrecision,u),z.include(c.DoublePrecision,u),z.uniforms.add([new f.Matrix3PassUniform("transformViewFromCameraRelativeRS",y=>y.transformViewFromCameraRelativeRS),new d.Matrix3DrawUniform("transformWorldFromModelRS",y=>y.transformWorldFromModelRS),new n.Float3DrawUniform("transformWorldFromModelTL",y=>y.transformWorldFromModelTL),new n.Float3DrawUniform("transformWorldFromModelTH",y=>y.transformWorldFromModelTH),new p.Float3PassUniform("transformWorldFromViewTL",y=>y.transformWorldFromViewTL),
new p.Float3PassUniform("transformWorldFromViewTH",y=>y.transformWorldFromViewTH)]),z.code.add(h.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${u.spherical?h.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:h.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));z.uniforms.add(new e.Matrix4PassUniform("transformProjFromView",(y,B)=>B.camera.projectionMatrix));z.code.add(h.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);z.code.add(h.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(w){return w.mode===a.EdgeUtilMode.SKETCH||w.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(w){return w.mode===a.EdgeUtilMode.SOLID||w.mode===a.EdgeUtilMode.MIXED};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl",
"./UnpackAttributes.glsl"],function(a,b,c,r,m){a.LineAmplitude=function(n,p){const g=n.vertex;n.include(m.UnpackAttributes,p);switch(p.mode){case r.EdgeUtilMode.SOLID:g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case r.EdgeUtilMode.SKETCH:g.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",h=>h.strokesTexture.amplitude));g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case r.EdgeUtilMode.MIXED:g.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",h=>h.strokesTexture.amplitude)),g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,r,m){a.UnpackAttributes=function(n,p){const g=n.vertex;n.attributes.add(r.VertexAttribute.SIDENESS,"vec2");p.mode===m.EdgeUtilMode.MIXED?g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(p.mode){case m.EdgeUtilMode.MIXED:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case m.EdgeUtilMode.SKETCH:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case m.EdgeUtilMode.SOLID:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case m.EdgeUtilMode.COUNT:break;default:b.neverReached(p.mode)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderLibrary/util/WebGL2Utils ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ../../../core/shaderModules/TextureSizeUniformType ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,b,c,r,m,n,p,g,h,d){let f=function(e){function l(){return e.apply(this,arguments)||this}b._inheritsLoose(l,e);return l}(n.NoParameters);a.LineOffset=function(e,l){e.include(d.UnpackAttributes,l);const {vertex:A,fragment:t}=e;h.usesSketchLogic(l)&&(A.uniforms.add(p.createTexture2DDrawSizeUniforms("strokesTexture",w=>w.strokesTexture.texture,l.hasWebGL2Context?g.TextureSizeUniformType.None:g.TextureSizeUniformType.InvSize)),A.uniforms.add([new m.FloatDrawUniform("strokesLog2Resolution",w=>
Math.log2(w.strokesTexture.resolution)),new m.FloatDrawUniform("strokeVariants",w=>w.strokesTexture.variants)]),e.varyings.add("vStrokeUV","vec2"),t.uniforms.add([new p.Texture2DDrawUniform("strokesTexture",w=>w.strokesTexture.texture),new m.FloatDrawUniform("strokesNormalizationScale",w=>w.strokesTexture.normalizationScale)]),A.code.add(n.glsl`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${r.textureSize(l,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),e.fragment.include(c.RgbaFloatEncoding),t.code.add(n.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(l.mode){case h.EdgeUtilMode.SOLID:A.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);t.code.add(n.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case h.EdgeUtilMode.SKETCH:A.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);t.code.add(n.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case h.EdgeUtilMode.MIXED:e.varyings.add("vType","float"),A.code.add(n.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),t.code.add(n.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,c,r,m,n){m=
function(p){function g(){var h=p.apply(this,arguments)||this;h.mode=n.EdgeUtilMode.SOLID;h.hasSlicePlane=!1;h.silhouette=!1;h.legacy=!1;h.antialiasing=!1;h.doublePrecisionRequiresObfuscation=!1;h.hasMultipassTerrain=!1;h.cullAboveGround=!1;h.spherical=!1;return h}b._inheritsLoose(g,p);return g}(m.DefaultTechniqueConfiguration);c.__decorate([r.parameter({count:n.EdgeUtilMode.COUNT})],m.prototype,"mode",void 0);c.__decorate([r.parameter()],m.prototype,"hasSlicePlane",void 0);c.__decorate([r.parameter()],
m.prototype,"silhouette",void 0);c.__decorate([r.parameter()],m.prototype,"legacy",void 0);c.__decorate([r.parameter()],m.prototype,"antialiasing",void 0);c.__decorate([r.parameter()],m.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([r.parameter()],m.prototype,"hasMultipassTerrain",void 0);c.__decorate([r.parameter()],m.prototype,"cullAboveGround",void 0);c.__decorate([r.parameter()],m.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=m;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/typedArrayUtil ../../../../../core/workers/WorkerHandle ../../../support/buffer/workerHelper ./edgeProcessing".split(" "),function(a,b,c,r,m,n){r=function(g){function h(f){return g.call(this,"EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>
[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},f)||this}b._inheritsLoose(h,g);var d=h.prototype;d.process=function(){var f=b._asyncToGenerator(function*(e,l,A){if(A)return n.extract(e);e=yield this.invoke(new p(e),l);return this._unpackOutput(e)});return function(e,l,A){return f.apply(this,arguments)}}();d.extractEdgeLocations=function(){var f=b._asyncToGenerator(function*(e,l){e=yield this.invokeMethod("extractEdgeLocations",new p(e),l);return m.unpackInterleavedBuffer(e)});return function(e,
l){return f.apply(this,arguments)}}();d.extractComponentsEdgeLocations=function(){var f=b._asyncToGenerator(function*(e,l){e=yield this.invokeMethod("extractComponentsEdgeLocations",new p(e),l);return m.unpackInterleavedBuffer(e)});return function(e,l){return f.apply(this,arguments)}}();d._unpackOutput=function(f){return{regular:{instancesData:m.unpackInterleavedBuffer(f.regular.instancesData),lodInfo:{lengths:new Float32Array(f.regular.lodInfo.lengths)}},silhouette:{instancesData:m.unpackInterleavedBuffer(f.silhouette.instancesData),
lodInfo:{lengths:new Float32Array(f.silhouette.lodInfo.lengths)}},averageEdgeLength:f.averageEdgeLength}};return h}(r.WorkerHandle);let p=function(g){this.dataBuffer=g.data.buffer;this.writerSettings=g.writerSettings;this.skipDeduplicate=g.skipDeduplicate;this.indices=Array.isArray(g.indices)?g.indices:g.indices.buffer;this.indicesType=Array.isArray(g.indices)?"Array":c.isUint32Array(g.indices)?"Uint32Array":"Uint16Array";this.indicesLength=g.indicesLength};a.EdgeWorkerHandle=r;a.PackedInput=p;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView","./InterleavedLayout"],function(a,b,c){function r(p){const g=[];p.fields.forEach((h,d)=>{var f=h.constructor;g.push([d,{...h,constructor:`${f.ElementType}_${f.ElementCount}`}])});return{stride:p.stride,fields:g,fieldNames:p.fieldNames}}function m(p){const g=c.newLayout();g.stride=p.stride;g.fieldNames=p.fieldNames;
p.fields.forEach(h=>g.fields.set(h[0],{...h[1],constructor:n.get(h[1].constructor)}));return g}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,
b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32];const n=new Map;b.forEach(p=>n.set(`${p.ElementType}_${p.ElementCount}`,p));a.packInterleavedBuffer=function(p,g){g.push(p.buffer);return{buffer:p.buffer,layout:r(p.layout)}};a.packLayout=r;a.unpackInterleavedBuffer=function(p){return m(p.layout).createView(p.buffer)};
a.unpackLayout=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../core/floatRGBA ../../../../../core/mathUtils ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),function(a,b,c,r,m,n){function p(f,e){if(!f)return null;var l=f.length/2;const A=.1*l;l=Array(l);let t=0;e=e===g.PRESSURE;for(let w=0;w<f.length;w+=2){const u=(f[w]+
f[w+1])/2;e?l[t++]=Math.min(A,1-.5*(1-u)):l[t++]=Math.min(A,.5*u)}return l}var g;(function(f){f[f.DISTANCE=0]="DISTANCE";f[f.PRESSURE=1]="PRESSURE"})(g||(g={}));let h=function(){function f(e,l,A,t,w){this.resolution=e;this.normalizationScale=l;this.amplitude=A;this.variants=t;this.texture=w}f.prototype.dispose=function(){this.texture=r.disposeMaybe(this.texture)};return f}();const d={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=h;a.generateStrokesTexture=function(f){const e=d.resolution;var l=e/2;const A=new Uint8Array(4*e*e),t=4*e*l;l=d.amplitude;const w=2*l,u=4*e,z=Math.log2(e)+1,y=d.strokes.length;let B=(z-1)*y*u;for(const {distance:C,
pressure:k}of d.strokes){let q=C,x=k,v=B;for(let D=0;D<z;D++){0!==D&&(q=p(q,g.DISTANCE),x=p(x,g.PRESSURE));for(let F=0;F<d.resolution;F++){const G=x?x[F%x.length]:1;b.packFloatRGBA((q?q[F%q.length]/w:0)+.5,A,v);b.packFloatRGBA(G,A,v+t);v+=4}v-=u*(y+1)}B+=u}f=new n.Texture(f,{pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:m.TextureSamplingMode.LINEAR,width:e,height:e,wrapMode:m.TextureWrapMode.REPEAT},A);return new h(e,w,l,y,f)};a.rasterizeStrokes=function(){var f=
d.resolution;const e=Math.log2(f)+1;var l=d.strokes.length;const A=d.amplitude,t=Math.ceil(2*A+.5);for(var w=0;1<=f;)w+=f,f/=2;w+=6*(e+1);l*=t;f=new Uint8ClampedArray(4*w*l);const u=4*w;f.fill(255);let z=24;for(const {distance:y,pressure:B}of d.strokes){let C=y,k=B,q=z;for(let x=0;x<e;x++){0!==x&&(C=p(C,g.DISTANCE),k=p(k,g.PRESSURE));for(let v=0;v<C.length;v++){const D=C?C[v]:0,F=k?c.clamp(k[v],0,1):1;let G=q;for(let J=-A;J<t-A;J++){const L=255-255*c.clamp(1-(Math.abs(J-D+.5)-.5*F),0,1);f[G+0]=L;
f[G+1]=L;f[G+2]=L;f[G+3]=255;G+=u}q+=4}q+=24}z+=t*u}return new ImageData(f,w,l)};a.strokesDefinition=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/maybe","./interfaces"],function(a,b,c){a.determineEdgeTransparency=function(r){let m=c.Transparency.INVISIBLE;for(const {material:n}of r)if(0<n.size*n.color[3]*n.opacity){if(1>n.color[3]*n.opacity)return c.Transparency.TRANSPARENT;
m=c.Transparency.OPAQUE}return m};a.determineObjectTransparency=function(r){let m=c.Transparency.INVISIBLE;for(const {material:n}of r)if(0<n.size*n.color[3]*n.opacity){switch(n.objectTransparency){case c.Transparency.TRANSPARENT:case c.Transparency.INVISIBLE:return c.Transparency.TRANSPARENT;case c.Transparency.OPAQUE:if(1>n.opacity)return c.Transparency.TRANSPARENT}m=c.Transparency.OPAQUE}return m};a.determineRendererType=function(r){let m=null;for(const n of r)if(r=n.type,0<n.size*n.color[3])if(b.isNone(m))m=
r;else if(m!==r)return"uber";return b.isSome(m)?m:"uber"};a.fillComponenBufferIndices=function(r,m,n,p){for(let h=0;h<r.length;h++){const d=r[h].index;var g=m[h];const f=m[h+1];if(p)for(;g<f;g++)n.set(p[g],d);else for(;g<f;g++)n.set(g,d)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/TimerPool".split(" "),
function(a,b,c,r,m,n,p){a.PerformanceCategory=void 0;(function(h){h.OVERLAY="overlay";h.PREPARE="prepare";h.SHADOW_MAP="shadow map";h.LINEAR_DEPTH="linear depth";h.ACCUMULATED_SHADOWS="accumulated shadows";h.NORMALS="normals";h.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";h.SSAO="SSAO";h.OPAQUE="opaque";h.OPAQUE_EDGES="opaque edges";h.VOXEL="voxel";h.TRANSPARENT="transparent";h.TRANSPARENT_EDGES="transparent edges";h.HUD_VISIBILITY="HUD visibility";h.TRANSPARENT_TERRAIN="transparent terrain";
h.ENVIRONMENT="environment";h.LASER_LINE="laser line";h.OCCLUDED="occluded";h.ANTIALIASING="antialiasing";h.HIGHLIGHTS="highlights";h.HUD_OCCLUDED="HUD occluded";h.HUD_NOT_OCCLUDED="HUD not occluded";h.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));let g=function(){function h(f){this._rctx=f;this._startTimeStampCPU=m.Milliseconds(0);this._lastTimeStampCPU=m.Milliseconds(0);this._totalCPUTime=new r("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>
[e,new r(e)]));this._enableGPUTimer=0;this._totalGPUTime=new r("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new r(e)]));this._totalTime=m.Milliseconds(0);this._totalFrameCount=0}var d=h.prototype;d.enableGPUPerformanceInfo=function(){if(c.isNone(this._gpuTimerPool)){const f=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=p.createElapsedTimerPool(this._rctx,f)}if(c.isNone(this._gpuTimerPool))return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;
return{hasGPUTimerSupport:!0,remove:n.once(()=>{--this._enableGPUTimer;0===this._enableGPUTimer&&(this._gpuTimerPool=c.disposeMaybe(this._gpuTimerPool))})}};d.startFrame=function(){this._startTimeStampCPU=this._lastTimeStampCPU=m.Milliseconds(performance.now());c.isSome(this._gpuTimerPool)&&this._gpuTimerPool.start()};d.advance=function(f){var e=m.Milliseconds(performance.now());this._cpuTimeSamplers.get(f).record(e-this._lastTimeStampCPU);this._lastTimeStampCPU=e;c.isSome(this._gpuTimerPool)&&(e=
this._gpuTimerPool.stop(f),this._gpuTimeSamplers.get(f).record(e),this._gpuTimerPool.start())};d.finishFrame=function(){if(c.isSome(this._gpuTimerPool)){var f=this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(f)}f=m.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=m.Milliseconds(this._totalTime+f);this._totalCPUTime.record(f);c.isSome(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((e,
l)=>e+(l.last||0),0));++this._totalFrameCount};b._createClass(h,[{key:"totalCPUTimeSampler",get:function(){return this._totalCPUTime}},{key:"cpuTimeSamplers",get:function(){return Array.from(this._cpuTimeSamplers.values())}},{key:"totalGPUTimeSampler",get:function(){return this._totalGPUTime}},{key:"gpuTimeSamplers",get:function(){return Array.from(this._gpuTimeSamplers.values())}},{key:"gpuSamplingEnabled",get:function(){return c.isSome(this._gpuTimerPool)}},{key:"totalTime",get:function(){return this._totalTime}},
{key:"totalFrameCount",get:function(){return this._totalFrameCount}},{key:"elapsedTime",get:function(){return m.Milliseconds(performance.now()-this._startTimeStampCPU)}}]);return h}();a.RendererPerformanceInfo=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/TimerPool":function(){define(["exports","../../core/maybe","./capabilities/DisjointTimerQuery"],function(a,b,c){let r=function(){function m(p,g){this._timer=p;this._queryPool=[];this._queryResults=
new Map;this._currentQuery=null;g.forEach(h=>{const d=this._timer.createQuery(),f=this._timer.createQuery();this._queryPool.push(d,f);this._queryResults.set(h,null)})}var n=m.prototype;n.start=function(){c.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),b.isNone(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))};n.stop=function(p){if(this._timer.disjoint()||b.isNone(this._currentQuery)||!this._queryResults.has(p))return this.abort(),
null;this._timer.endTimeElapsed();const g=this._queryResults.get(p);if(b.isNone(g))return this._queryResults.set(p,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(g))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const h=this._timer.getResult(g)/1E6;this._queryPool.unshift(g);this._queryResults.set(p,this._currentQuery);this._currentQuery=null;return h};n.abort=function(){b.isSome(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),
this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)};n.dispose=function(){b.isSome(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(p=>{this._timer.deleteQuery(p)});this._queryResults.forEach(p=>{b.isNone(p)||this._timer.deleteQuery(p)})};return m}();a.createElapsedTimerPool=function(m,n){m=m.capabilities.disjointTimerQuery;return b.isNone(m)?null:new r(m,n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,b){let c=function(r,m,n,p,g,h,d,f,e){this.createQuery=r;this.deleteQuery=m;this.resultAvailable=n;this.getResult=p;this.disjoint=g;this.beginTimeElapsed=h;this.endTimeElapsed=d;this.createTimestamp=f;this.timestampBits=e};a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=c;a.createDisjointTimerQuery=function(r,m){if(m.disjointTimerQuery)return null;let n=r.getExtension("EXT_disjoint_timer_query_webgl2");
return n&&b(r)?new c(()=>r.createQuery(),p=>{r.deleteQuery(p);a.hasRunningElapsedTimer=!1},p=>r.getQueryParameter(p,r.QUERY_RESULT_AVAILABLE),p=>r.getQueryParameter(p,r.QUERY_RESULT),()=>r.getParameter(n.GPU_DISJOINT_EXT),p=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,r.beginQuery(n.TIME_ELAPSED_EXT,p))},()=>{r.endQuery(n.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},p=>n.queryCounterEXT(p,n.TIMESTAMP_EXT),()=>r.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):(n=r.getExtension("EXT_disjoint_timer_query"))?
new c(()=>n.createQueryEXT(),p=>{n.deleteQueryEXT(p);a.hasRunningElapsedTimer=!1},p=>n.getQueryObjectEXT(p,n.QUERY_RESULT_AVAILABLE_EXT),p=>n.getQueryObjectEXT(p,n.QUERY_RESULT_EXT),()=>r.getParameter(n.GPU_DISJOINT_EXT),p=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,n.beginQueryEXT(n.TIME_ELAPSED_EXT,p))},()=>{n.endQueryEXT(n.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},p=>n.queryCounterEXT(p,n.TIMESTAMP_EXT),()=>n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/RenderingContext"],function(a,b,c){c=function(r){function m(p,g,h){p=r.call(this,p,g)||this;p.newCache=h;p._refCount=1;return p}b._inheritsLoose(m,r);var n=m.prototype;n.dispose=function(){0<--this._refCount||r.prototype.dispose.call(this)};n.ref=function(){++this._refCount};n.bindTechnique=function(p,
g,h,d){this.useProgram(p.program);p.bindPipelineState(this,h?.slot,d);p.program.bindPass(g,h);return p.program};b._createClass(m,[{key:"test",get:function(){return this.programCache.test}}]);return m}(c.RenderingContext);a.RenderingContext=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./context-util ./ContextState ./enums ./InstanceCounter ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){function z(C,k,q,x){k?x!==k&&C.bindBuffer(q,k.glName):C.bindBuffer(q,null);return k}function y(C,k){switch(C){case h.PrimitiveType.POINTS:return 2*k;case h.PrimitiveType.TRIANGLES:return k/3;case h.PrimitiveType.TRIANGLE_STRIP:return k-2;case h.PrimitiveType.TRIANGLE_FAN:return k-2;default:return 0}}let B=function(){function C(q,x){this.gl=q;this.instanceCounter=new d.InstanceCounter;this.programCache=new f.ProgramCache(this);this._state=new g.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=u(q)?p.ContextType.WEBGL2:p.ContextType.WEBGL1;this._loadExtensions();this.configure(x)}var k=C.prototype;k.configure=function(q){this._capabilities=new w.Capabilities(this.gl,q);this._parameters=this._loadParameters(q);q=this.gl.getParameter(this.gl.VIEWPORT);this._state=new g.ContextState;this._state.viewport={x:q[0],y:q[1],width:q[2],height:q[3]};this._stateTracker=new e.StateTracker({setBlending:x=>{x?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(x.opRgb,
x.opAlpha),this.setBlendFunctionSeparate(x.srcRgb,x.dstRgb,x.srcAlpha,x.dstAlpha),x=x.color,this.setBlendColor(x.r,x.g,x.b,x.a)):this.setBlendingEnabled(!1)},setCulling:x=>{x?(this.setFaceCullingEnabled(!0),this.setCullFace(x.face),this.setFrontFace(x.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:x=>{x?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(x.factor,x.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:x=>{x?(this.setDepthTestEnabled(!0),this.setDepthFunction(x.func)):
this.setDepthTestEnabled(!1)},setStencilTest:x=>{if(x){this.setStencilTestEnabled(!0);const v=x.function;this.setStencilFunction(v.func,v.ref,v.mask);x=x.operation;this.setStencilOp(x.fail,x.zFail,x.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:x=>{x?(this.setDepthWriteEnabled(!0),this.setDepthRange(x.zNear,x.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:x=>{x?this.setColorMask(x.r,x.g,x.b,x.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:x=>{x?this.setStencilWriteMask(x.mask):
this.setStencilWriteMask(0)}});this.enforceState();this._driverTest=new t.WebGLDriverTest(this)};k.dispose=function(){this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(h.BufferType.ARRAY_BUFFER);this.unbindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER);u(this.gl)&&(this.unbindBuffer(h.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(h.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(h.BufferType.COPY_READ_BUFFER),
this.unbindBuffer(h.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;n.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};k.setPipelineState=function(q){this._stateTracker.setPipeline(q)};k.setBlendingEnabled=function(q){this._state.blend!==q&&(!0===q?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=q,this._stateTracker.invalidateBlending())};k.externalProgramUpdate=function(){this._state.program?.stop();this._state.program=null};k.externalTextureUnitUpdate=
function(q,x){for(let v=0;v<q.length;++v)this._state.textureUnitMap[q[v]]=null;0<=x&&(this._state.activeTexture=x)};k.externalVertexArrayObjectUpdate=function(){const q=this.capabilities.vao;q&&(q.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};k.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};k.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};k.setBlendColor=function(q,x,v,D){if(q!==this._state.blendColor.r||
x!==this._state.blendColor.g||v!==this._state.blendColor.b||D!==this._state.blendColor.a)this.gl.blendColor(q,x,v,D),this._state.blendColor.r=q,this._state.blendColor.g=x,this._state.blendColor.b=v,this._state.blendColor.a=D,this._stateTracker.invalidateBlending()};k.setBlendFunction=function(q,x){if(q!==this._state.blendFunction.srcRGB||x!==this._state.blendFunction.dstRGB)this.gl.blendFunc(q,x),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=q,this._state.blendFunction.dstRGB=
x,this._state.blendFunction.dstAlpha=x,this._stateTracker.invalidateBlending()};k.setBlendFunctionSeparate=function(q,x,v,D){if(this._state.blendFunction.srcRGB!==q||this._state.blendFunction.srcAlpha!==v||this._state.blendFunction.dstRGB!==x||this._state.blendFunction.dstAlpha!==D)this.gl.blendFuncSeparate(q,x,v,D),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=v,this._state.blendFunction.dstRGB=x,this._state.blendFunction.dstAlpha=D,this._stateTracker.invalidateBlending()};
k.setBlendEquation=function(q){this._state.blendEquation.mode!==q&&(this.gl.blendEquation(q),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=q,this._stateTracker.invalidateBlending())};k.setBlendEquationSeparate=function(q,x){if(this._state.blendEquation.mode!==q||this._state.blendEquation.modeAlpha!==x)this.gl.blendEquationSeparate(q,x),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=x,this._stateTracker.invalidateBlending()};k.setColorMask=function(q,x,
v,D){if(this._state.colorMask.r!==q||this._state.colorMask.g!==x||this._state.colorMask.b!==v||this._state.colorMask.a!==D)this.gl.colorMask(q,x,v,D),this._state.colorMask.r=q,this._state.colorMask.g=x,this._state.colorMask.b=v,this._state.colorMask.a=D,this._stateTracker.invalidateColorWrite()};k.setClearColor=function(q,x,v,D){if(this._state.clearColor.r!==q||this._state.clearColor.g!==x||this._state.clearColor.b!==v||this._state.clearColor.a!==D)this.gl.clearColor(q,x,v,D),this._state.clearColor.r=
q,this._state.clearColor.g=x,this._state.clearColor.b=v,this._state.clearColor.a=D};k.setFaceCullingEnabled=function(q){this._state.faceCulling!==q&&(!0===q?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=q,this._stateTracker.invalidateCulling())};k.setPolygonOffsetFillEnabled=function(q){this._state.polygonOffsetFill!==q&&(!0===q?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=q,this._stateTracker.invalidatePolygonOffset())};
k.setPolygonOffset=function(q,x){if(this._state.polygonOffset[0]!==q||this._state.polygonOffset[1]!==x)this._state.polygonOffset[0]=q,this._state.polygonOffset[1]=x,this.gl.polygonOffset(q,x),this._stateTracker.invalidatePolygonOffset()};k.setCullFace=function(q){this._state.cullFace!==q&&(this.gl.cullFace(q),this._state.cullFace=q,this._stateTracker.invalidateCulling())};k.setFrontFace=function(q){this._state.frontFace!==q&&(this.gl.frontFace(q),this._state.frontFace=q,this._stateTracker.invalidateCulling())};
k.setScissorTestEnabled=function(q){this._state.scissorTest!==q&&(!0===q?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=q)};k.setScissorRect=function(q,x,v,D){if(this._state.scissorRect.x!==q||this._state.scissorRect.y!==x||this._state.scissorRect.width!==v||this._state.scissorRect.height!==D)this.gl.scissor(q,x,v,D),this._state.scissorRect.x=q,this._state.scissorRect.y=x,this._state.scissorRect.width=v,this._state.scissorRect.height=D};k.setDepthTestEnabled=
function(q){this._state.depthTest!==q&&(!0===q?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=q,this._stateTracker.invalidateDepthTest())};k.setClearDepth=function(q){this._state.clearDepth!==q&&(this.gl.clearDepth(q),this._state.clearDepth=q)};k.setDepthFunction=function(q){this._state.depthFunction!==q&&(this.gl.depthFunc(q),this._state.depthFunction=q,this._stateTracker.invalidateDepthTest())};k.setDepthWriteEnabled=function(q){this._state.depthWrite!==
q&&(this.gl.depthMask(q),this._state.depthWrite=q,this._stateTracker.invalidateDepthWrite())};k.setDepthRange=function(q,x){if(this._state.depthRange.zNear!==q||this._state.depthRange.zFar!==x)this.gl.depthRange(q,x),this._state.depthRange.zNear=q,this._state.depthRange.zFar=x,this._stateTracker.invalidateDepthWrite()};k.setStencilTestEnabled=function(q){this._state.stencilTest!==q&&(!0===q?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=q,this._stateTracker.invalidateStencilTest())};
k.setClearStencil=function(q){q!==this._state.clearStencil&&(this.gl.clearStencil(q),this._state.clearStencil=q)};k.setStencilFunction=function(q,x,v){if(this._state.stencilFunction.func!==q||this._state.stencilFunction.ref!==x||this._state.stencilFunction.mask!==v)this.gl.stencilFunc(q,x,v),this._state.stencilFunction.face=h.Face.FRONT_AND_BACK,this._state.stencilFunction.func=q,this._state.stencilFunction.ref=x,this._state.stencilFunction.mask=v,this._stateTracker.invalidateStencilTest()};k.setStencilFunctionSeparate=
function(q,x,v,D){if(this._state.stencilFunction.face!==q||this._state.stencilFunction.func!==x||this._state.stencilFunction.ref!==v||this._state.stencilFunction.mask!==D)this.gl.stencilFuncSeparate(q,x,v,D),this._state.stencilFunction.face=q,this._state.stencilFunction.func=x,this._state.stencilFunction.ref=v,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest()};k.setStencilWriteMask=function(q){this._state.stencilWriteMask!==q&&(this.gl.stencilMask(q),this._state.stencilWriteMask=
q,this._stateTracker.invalidateStencilWrite())};k.setStencilOp=function(q,x,v){if(this._state.stencilOperation.face!==h.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==q||this._state.stencilOperation.zFail!==x||this._state.stencilOperation.zPass!==v)this.gl.stencilOp(q,x,v),this._state.stencilOperation.face=h.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=q,this._state.stencilOperation.zFail=x,this._state.stencilOperation.zPass=v,this._stateTracker.invalidateStencilTest()};k.setStencilOpSeparate=
function(q,x,v,D){if(this._state.stencilOperation.face!==q||this._state.stencilOperation.fail!==x||this._state.stencilOperation.zFail!==v||this._state.stencilOperation.zPass!==D)this.gl.stencilOpSeparate(q,x,v,D),this._state.stencilOperation.face=q,this._state.stencilOperation.fail=x,this._state.stencilOperation.zFail=v,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest()};k.setActiveTexture=function(q,x=!1){const v=this._state.activeTexture;0<=q&&(x||q!==this._state.activeTexture)&&
(this.gl.activeTexture(h.BASE_TEXTURE_UNIT+q),this._state.activeTexture=q);return v};k.clear=function(q){q&&this.gl.clear(q)};k.clearSafe=function(q,x=255){q&&(q&h.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),q&h.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),q&h.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(x),this.gl.clear(q))};k.drawArrays=function(q,x,v){n.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=y(q,v));this.gl.drawArrays(q,
x,v);n.webglDebugEnabled()&&(q=A.getErrorString(this))&&console.error("drawArrays:",q)};k.drawElements=function(q,x,v,D){n.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=y(q,x));this.gl.drawElements(q,x,v,D);if(n.webglDebugEnabled()){const J=A.getErrorString(this);if(J){var F=this.getBoundVAO(),G=F?.indexBuffer;F={indexBuffer:G,vertexBuffers:F?.vertexBuffers};q={mode:q,count:x,type:v,offset:D};G=c.applySome(G,L=>L.size)??0;x=D+x;console.error(`drawElements: ${J}${G<x?`. Buffer is too small. Attempted to draw index ${x} of ${G}`:
""}`,{args:q,vao:F})}}};k.logInfo=function(){n.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};k.resetInfo=function(){n.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};k.setViewport=function(q,x,v,D){v=Math.max(Math.round(v),1);D=Math.max(Math.round(D),1);const F=this._state.viewport;if(F.x!==q||F.y!==x||F.width!==v||F.height!==D)F.x=q,F.y=x,F.width=v,F.height=D,this.gl.viewport(q,x,v,D)};k.getViewport=function(){const q=
this._state.viewport;return{x:q.x,y:q.y,width:q.width,height:q.height}};k.useProgram=function(q){this._state.program!==q&&(this._state.program?.stop(),this._state.program=q,this.gl.useProgram(q?.glName??null))};k.bindTexture=function(q,x,v=!1){(x>=this.parameters.maxTextureImageUnits||0>x)&&console.error("Input texture unit is out of range of available units!");const D=this._state.textureUnitMap[x];if(c.isNone(q)||null==q.glName)return c.isSome(D)&&(this.setActiveTexture(x,v),this.gl.bindTexture(D.descriptor.target,
null)),this._state.textureUnitMap[x]=null,D;if(!v&&D===q)return q.isDirty&&(this.setActiveTexture(x,v),q.applyChanges()),D;this.setActiveTexture(x,v);this.gl.bindTexture(q.descriptor.target,q.glName);q.applyChanges();this._state.textureUnitMap[x]=q;return D};k.unbindTexture=function(q){if(!c.isNone(q))for(let x=0;x<this.parameters.maxTextureImageUnits;x++)this._state.textureUnitMap[x]===q&&(this.bindTexture(null,x),this._state.textureUnitMap[x]=null)};k.bindFramebuffer=function(q,x=!1){if(x||this._state.readFramebuffer!==
q||this._state.drawFramebuffer!==q)c.isNone(q)?(this.gl.bindFramebuffer(h.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(q.initializeAndBind(h.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=q,this._state.drawFramebuffer=q)};k.bindFramebufferSeparate=function(q,x,v=!1){const D=x===h.FramebufferTarget.READ_FRAMEBUFFER,F=D?this._state.readFramebuffer:this._state.drawFramebuffer;if(v||F!==q)c.isNone(q)?this.gl.bindFramebuffer(x,null):
q.initializeAndBind(x),D?this._state.readFramebuffer=c.unwrapOr(q,null):this._state.drawFramebuffer=c.unwrapOr(q,null)};k.blitFramebuffer=function(q,x,v=0,D=0,F=q.width,G=q.height,J=0,L=0,K=x.width,O=x.height,P=h.ClearBufferBit.COLOR_BUFFER_BIT,N=h.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(q,h.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(x,h.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(v,D,F,G,J,L,K,O,P,N)};k.bindBuffer=function(q,x){if(q)switch(x??
(x=q.bufferType),x){case h.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=z(this.gl,q,x,this._state.vertexBuffer);break;case h.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=z(this.gl,q,x,this._state.indexBuffer);break;case h.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=z(this.gl,q,x,this._state.uniformBuffer);break;case h.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=z(this.gl,q,x,this._state.pixelPackBuffer);break;case h.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=
z(this.gl,q,x,this._state.pixelUnpackBuffer);break;case h.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=z(this.gl,q,x,this._state.copyReadBuffer);break;case h.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=z(this.gl,q,x,this._state.copyWriteBuffer)}};k.bindRenderbuffer=function(q){const x=this.gl;q||(x.bindRenderbuffer(x.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==q&&(x.bindRenderbuffer(x.RENDERBUFFER,q.glName),this._state.renderbuffer=q)};k._getBufferBinding=
function(q,x){if(x>=this.parameters.maxUniformBufferBindings||0>x)return console.error("Uniform buffer binding point is out of range!"),null;q=this._state.uniformBufferBindingPoints;let v=q[x];c.isNone(v)&&(v={buffer:null,offset:0,size:0},q[x]=v);return v};k.bindBufferBase=function(q,x,v){const D=this._getBufferBinding(q,x);c.isNone(D)||D.buffer===v&&0===D.offset&&0===D.size||(this.gl.bindBufferBase(q,x,v?v.glName:null),D.buffer=v,D.offset=0,D.size=0)};k.bindBufferRange=function(q,x,v,D,F){const G=
this._getBufferBinding(q,x);c.isNone(G)||G.buffer===v&&G.offset===D&&G.size===F||(0!==D%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(q,x,v.glName,D,F),G.buffer=v,G.offset=D,G.size=F))};k.bindUBO=function(q,x,v,D){c.isNone(x)?this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,q,null):(n.webglDebugEnabled()&&(D??x.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),
x.initialize(),void 0!==v&&void 0!==D?this.bindBufferRange(h.BufferType.UNIFORM_BUFFER,q,x.buffer,v,D):this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,q,x.buffer))};k.unbindUBO=function(q){for(let x=0,v=this._state.uniformBufferBindingPoints.length;x<v;x++){const D=this._state.uniformBufferBindingPoints[x];c.isSome(D)&&D.buffer===q.buffer&&this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,x,null)}};k.unbindBuffer=function(q){switch(q){case h.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=z(this.gl,
null,q,this._state.vertexBuffer);break;case h.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=z(this.gl,null,q,this._state.indexBuffer);break;case h.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=z(this.gl,null,q,this._state.uniformBuffer);break;case h.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=z(this.gl,null,q,this._state.pixelPackBuffer);break;case h.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=z(this.gl,null,q,this._state.pixelUnpackBuffer);break;case h.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=
z(this.gl,null,q,this._state.copyReadBuffer);break;case h.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=z(this.gl,null,q,this._state.copyWriteBuffer)}};k.bindVAO=function(q=null){c.isNone(q)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==q&&(q.bind(),this._state.vertexArrayObject=q)};k.clientWaitAsync=function(){var q=b._asyncToGenerator(function*(x=m.Milliseconds(10)){const v=this.gl,D=v.fenceSync(h.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,
0);if(!D)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(h.ResourceType.Sync,D);v.flush();let F;do yield r.after(x),F=v.clientWaitSync(D,0,0);while(F===h.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(h.ResourceType.Sync,D);v.deleteSync(D);if(F===h.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");});return function(){return q.apply(this,arguments)}}();k.getBoundFramebufferObject=function(q=h.FramebufferTarget.FRAMEBUFFER){return q===
h.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};k.getBoundVAO=function(){return this._state.vertexArrayObject};k.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(h.BufferType.ARRAY_BUFFER);this.unbindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER);u(this.gl)&&(this.unbindBuffer(h.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(h.BufferType.PIXEL_PACK_BUFFER),
this.unbindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(h.BufferType.COPY_READ_BUFFER),this.unbindBuffer(h.BufferType.COPY_WRITE_BUFFER));for(let q=0;q<this.parameters.maxTextureImageUnits;++q)this.bindTexture(null,q);this.setBlendingEnabled(!1);this.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ZERO);this.setBlendEquation(h.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(h.Face.BACK);this.setFrontFace(h.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(h.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(h.CompareFunction.ALWAYS,0,0);this.setStencilOp(h.StencilOperation.KEEP,h.StencilOperation.KEEP,h.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,
!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};k.enforceState=function(){const q=this.gl;var x=this.capabilities.vao;x&&x.bindVertexArray(null);for(var v=0;v<this.parameters.maxVertexAttributes;v++)q.disableVertexAttribArray(v);this._state.vertexBuffer?q.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):q.bindBuffer(h.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?q.bindBuffer(this._state.indexBuffer.bufferType,
this._state.indexBuffer.glName):q.bindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER,null);if(u(q)){this._state.uniformBuffer?q.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):q.bindBuffer(h.BufferType.UNIFORM_BUFFER,null);for(v=0;v<this._parameters.maxUniformBufferBindings;v++){const D=this._state.uniformBufferBindingPoints[v];if(c.isSome(D)){const {buffer:F,offset:G,size:J}=D;null!==F?0===G&&0===J?q.bindBufferBase(h.BufferType.UNIFORM_BUFFER,v,F.glName):q.bindBufferRange(h.BufferType.UNIFORM_BUFFER,
v,F.glName,G,J):q.bindBufferBase(h.BufferType.UNIFORM_BUFFER,v,null)}}this._state.pixelPackBuffer?q.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):q.bindBuffer(h.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?q.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):q.bindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?q.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):
q.bindBuffer(h.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?q.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):q.bindBuffer(h.BufferType.COPY_WRITE_BUFFER,null);q.bindFramebuffer(h.FramebufferTarget.READ_FRAMEBUFFER,null);q.readBuffer(q.BACK);this._state.readFramebuffer&&(q.bindFramebuffer(h.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),q.readBuffer(h.ColorAttachment.COLOR_ATTACHMENT0));q.bindFramebuffer(h.FramebufferTarget.DRAW_FRAMEBUFFER,
this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,q.bindFramebuffer(h.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(x&&this._state.vertexArrayObject){if(x=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(x)}q.useProgram(this._state.program?.glName??null);q.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);
q.bindRenderbuffer(q.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?q.enable(this.gl.BLEND):q.disable(this.gl.BLEND);q.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);q.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);q.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,
this._state.clearColor.a);q.clearDepth(this._state.clearDepth);q.clearStencil(this._state.clearStencil);q.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);q.cullFace(this._state.cullFace);q.depthFunc(this._state.depthFunction);q.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST);q.depthMask(this._state.depthWrite);q.frontFace(this._state.frontFace);
q.lineWidth(1);!0===this._state.faceCulling?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE);q.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?q.enable(q.POLYGON_OFFSET_FILL):q.disable(q.POLYGON_OFFSET_FILL);q.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?q.enable(q.SCISSOR_TEST):q.disable(q.SCISSOR_TEST);q.stencilFunc(this._state.stencilFunction.func,
this._state.stencilFunction.ref,this._state.stencilFunction.mask);q.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST);q.stencilMask(this._state.stencilWriteMask);for(x=0;x<this.parameters.maxTextureImageUnits;x++)q.activeTexture(h.BASE_TEXTURE_UNIT+x),q.bindTexture(h.TextureType.TEXTURE_2D,null),q.bindTexture(h.TextureType.TEXTURE_CUBE_MAP,
null),u(q)&&(q.bindTexture(h.TextureType.TEXTURE_3D,null),q.bindTexture(h.TextureType.TEXTURE_2D_ARRAY,null)),v=this._state.textureUnitMap[x],c.isSome(v)&&q.bindTexture(v.descriptor.target,v.glName);q.activeTexture(h.BASE_TEXTURE_UNIT+this._state.activeTexture);x=this._state.viewport;q.viewport(x.x,x.y,x.width,x.height);this.resetInfo()};k._loadExtensions=function(){this.type===p.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};
k._loadParameters=function(q){var x=this.capabilities.textureFilterAnisotropic;q=q.maxAnisotropy??Infinity;const v=u(this.gl),D=this.gl;x={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:x?Math.min(this.gl.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY),q):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),
maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:v?D.getParameter(D.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:v?D.getParameter(D.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:v?D.getParameter(D.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:v?D.getParameter(D.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:v?D.getParameter(D.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:v?D.getParameter(D.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:v?
D.getParameter(D.MAX_SAMPLES):1};l.Texture.TEXTURE_UNIT_FOR_UPDATES=x.maxTextureImageUnits-1;return x};b._createClass(C,[{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return C}();a.RenderingContext=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect=
{x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};
this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,r){const m={RECORD_ALLOCATIONS:!1};let n=function(){function p(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(m.RECORD_ALLOCATIONS);this._current.length<r.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var g=p.prototype;g.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};g.increment=function(h,d){const f=++this._current[h];
this._max[h]=Math.max(f,this._max[h]);this._allocations.add(d)};g.decrement=function(h,d){--this._current[h];this._allocations.remove(d)};g.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let h=0;h<r.ResourceType.COUNT;++h){const d=this._current[h];0<d&&console.log(`${r.ResourceType[h]}: ${d}`)}}this._allocations.print()};b._createClass(p,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((h,
d)=>h+d,0)}}]);return p}();a.InstanceCounter=n;a.test=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){let b=function(){function c(m){this._allocations=new Map;m?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var r=c.prototype;r.add=function(m){this._allocations.set(m,Error().stack)};r.remove=function(m){this._allocations.delete(m)};r.print=function(){if(0<
this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const m=new Map;this._allocations.forEach(n=>{m.set(n,(m.get(n)??0)+1)});m.forEach((n,p)=>{p=p.split("\n");p.shift();p.shift();console.log(`${n}: ${p.shift()}`);p.forEach(g=>console.log("   ",g))})}};return c}();a.AllocationTracer=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,r,m){let n=function(){function p(h){this._rctx=h;this._store=new r.NestedMap}var g=p.prototype;g.dispose=function(){this._store.forEach(h=>h.forEach(d=>d.dispose()));this._store.clear()};g.acquire=function(h,d,f,e){const l=this._store.get(h,d);if(c.isSome(l))return l.ref(),l;f=new m.Program(this._rctx,h,d,f,e);f.ref();this._store.set(h,d,f);return f};b._createClass(p,[{key:"test",get:function(){let h=0;this._store.forEach(d=>d.forEach(f=>
h+=f.hasGLName?2:1));return{cachedWebGLObjects:h}}}]);return p}();a.ProgramCache=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),function(a,b,c,r,m,n,p,g,h){function d(A,t,w){A=A.gl;const u=A.createShader(t);A.shaderSource(u,w);A.compileShader(u);
n.webglValidateShadersEnabled()&&!A.getShaderParameter(u,A.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===g.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(A.getShaderInfoLog(u)),console.error(f(w)));l.enabled&&(l.compiledLOC+=w.match(/\n/g).length+1);return u}function f(A){let t=2;return A.replace(/\n/g,()=>{var w=t++;w=1E3<=w?w.toString():("  "+w).slice(-3);return"\n"+w+":"})}function e(A,t,w){const u=A.get(t);return u?c.update(u,w):(A.set(t,Array.from(w)),
!0)}r=function(){function A(w,u,z,y,B=new Map){this._context=w;this._locations=y;this._uniformBlockBindings=B;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;w||console.error("RenderingContext isn't initialized!");0===u.length&&console.error("Shaders source should not be empty!");
this._context.type===p.ContextType.WEBGL2&&(u=h.transpileShader(u,g.ShaderType.VERTEX_SHADER),z=h.transpileShader(z,g.ShaderType.FRAGMENT_SHADER));this._vShader=d(this._context,g.ShaderType.VERTEX_SHADER,u);this._fShader=d(this._context,g.ShaderType.FRAGMENT_SHADER,z);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(g.ResourceType.Shader,this);n.webglValidateShadersEnabled()&&(this.vertexShader=u,this.fragmentShader=z)}var t=A.prototype;
t.dispose=function(){if(!(0<--this._refCount)){var w=this._context.gl;this._vShader&&(w.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(g.ResourceType.Shader,this));this._fShader&&(w.deleteShader(this._fShader),this._fShader=null);this._glName&&(w.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.ResourceType.Program,this))}};t.ref=function(){++this._refCount};t._getUniformLocation=function(w){void 0===this._nameToUniformLocation[w]&&
(++l.numUniforms,this._nameToUniformLocation[w]=this._context.gl.getUniformLocation(this.glName,w));return this._nameToUniformLocation[w]};t.hasUniform=function(w){return null!==this._getUniformLocation(w)};t.setUniform1i=function(w,u){const z=this._nameToUniform1[w];if(void 0===z||u!==z)this._context.gl.uniform1i(this._getUniformLocation(w),u),this._nameToUniform1[w]=u};t.setUniform1iv=function(w,u){e(this._nameToUniform1v,w,u)&&this._context.gl.uniform1iv(this._getUniformLocation(w),u)};t.setUniform2iv=
function(w,u){e(this._nameToUniform2,w,u)&&this._context.gl.uniform2iv(this._getUniformLocation(w),u)};t.setUniform3iv=function(w,u){e(this._nameToUniform3,w,u)&&this._context.gl.uniform3iv(this._getUniformLocation(w),u)};t.setUniform4iv=function(w,u){e(this._nameToUniform4,w,u)&&this._context.gl.uniform4iv(this._getUniformLocation(w),u)};t.setUniform1f=function(w,u){const z=this._nameToUniform1[w];if(void 0===z||u!==z)this._context.gl.uniform1f(this._getUniformLocation(w),u),this._nameToUniform1[w]=
u};t.setUniform1fv=function(w,u){e(this._nameToUniform1v,w,u)&&this._context.gl.uniform1fv(this._getUniformLocation(w),u)};t.setUniform2f=function(w,u,z){const y=this._nameToUniform2.get(w);if(void 0===y)this._context.gl.uniform2f(this._getUniformLocation(w),u,z),this._nameToUniform2.set(w,[u,z]);else if(u!==y[0]||z!==y[1])this._context.gl.uniform2f(this._getUniformLocation(w),u,z),y[0]=u,y[1]=z};t.setUniform2fv=function(w,u){e(this._nameToUniform2,w,u)&&this._context.gl.uniform2fv(this._getUniformLocation(w),
u)};t.setUniform3f=function(w,u,z,y){const B=this._nameToUniform3.get(w);if(void 0===B)this._context.gl.uniform3f(this._getUniformLocation(w),u,z,y),this._nameToUniform3[w]=[u,z,y];else if(u!==B[0]||z!==B[1]||y!==B[2])this._context.gl.uniform3f(this._getUniformLocation(w),u,z,y),B[0]=u,B[1]=z,B[2]=y};t.setUniform3fv=function(w,u){e(this._nameToUniform3,w,u)&&this._context.gl.uniform3fv(this._getUniformLocation(w),u)};t.setUniform4f=function(w,u,z,y,B){const C=this._nameToUniform4.get(w);if(void 0===
C)this._context.gl.uniform4f(this._getUniformLocation(w),u,z,y,B),this._nameToUniform4.set(w,[u,z,y,B]);else if(void 0===C||u!==C[0]||z!==C[1]||y!==C[2]||B!==C[3])this._context.gl.uniform4f(this._getUniformLocation(w),u,z,y,B),C[0]=u,C[1]=z,C[2]=y,C[3]=B};t.setUniform4fv=function(w,u){e(this._nameToUniform4,w,u)&&this._context.gl.uniform4fv(this._getUniformLocation(w),u)};t.setUniformMatrix3fv=function(w,u,z=!1){e(this._nameToUniformMatrix3,w,u)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(w),
z,u)};t.setUniformMatrix4fv=function(w,u,z=!1){e(this._nameToUniformMatrix4,w,u)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(w),z,u)};t.stop=function(){};b._createClass(A,[{key:"glName",get:function(){if(m.isSome(this._glName))return this._glName;if(m.isNone(this._vShader))return null;const w=this._context.gl,u=w.createProgram();w.attachShader(u,this._vShader);w.attachShader(u,this._fShader);this._locations.forEach((z,y)=>w.bindAttribLocation(u,z,y));w.linkProgram(u);n.webglValidateShadersEnabled()&&
!w.getProgramParameter(u,w.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${w.getProgramParameter(u,w.VALIDATE_STATUS)}`+`, gl error ${w.getError()}`+`, vertex: ${w.getShaderParameter(this._vShader,w.COMPILE_STATUS)}`+`, fragment: ${w.getShaderParameter(this._fShader,w.COMPILE_STATUS)}`+`, info log: ${w.getProgramInfoLog(u)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===p.ContextType.WEBGL2)for(const [z,y]of this._uniformBlockBindings){const B=
w.getUniformBlockIndex(u,z);4294967295>B&&w.uniformBlockBinding(u,B,y)}this._glName=u;this._context.instanceCounter.increment(g.ResourceType.Program,this);return u}},{key:"hasGLName",get:function(){return m.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;const w=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==w?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,w.COMPLETION_STATUS_KHR)}}]);return A}();const l=
{compiledLOC:0,numUniforms:0,enabled:!1};a.Program=r;a.test=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ../../core/maybe ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,c,r,m,n,p){function g(){function z(Q){Q.length&&K.push({type:t[F],data:Q,position:N,line:O,column:P})}function y(){L=L.length?[]:L;if("/"===J&&"*"===G)return N=D+v-
1,F=0,J=G,v+1;if("/"===J&&"/"===G)return N=D+v-1,F=1,J=G,v+1;if("#"===G)return F=2,N=D+v,v;if(/\s/.test(G))return F=9,N=D+v,v;H=/\d/.test(G);E=/[^\w_]/.test(G);N=D+v;F=H?4:E?3:9999;return v}function B(){if(("\r"===G||"\n"===G)&&"\\"!==J)return z(L.join("")),F=999,v;L.push(G);J=G;return v+1}function C(){if("."===J&&/\d/.test(G))return F=5,v;if("/"===J&&"*"===G)return F=0,v;if("/"===J&&"/"===G)return F=1,v;if("."===G&&L.length){for(;k(L););F=5;return v}if(";"===G||")"===G||"("===G){if(L.length)for(;k(L););
z(G);F=999;return v+1}var Q=2===L.length&&"\x3d"!==G;if(/[\w_\d\s]/.test(G)||Q){for(;k(L););F=999;return v}L.push(G);J=G;return v+1}function k(Q){var T=0;do{var S=p.operators.indexOf(Q.slice(0,Q.length+T).join(""));var U=p.operators[S];if(-1===S){if(0<T--+Q.length)continue;U=Q.slice(0,1).join("")}z(U);N+=U.length;L=L.slice(U.length);return L.length}while(1)}function q(){if("."===G||/[eE]/.test(G))return L.push(G),F=5,J=G,v+1;if("x"===G&&1===L.length&&"0"===L[0])return F=11,L.push(G),J=G,v+1;if(/[^\d]/.test(G))return z(L.join("")),
F=999,v;L.push(G);J=G;return v+1}function x(){"f"===G&&(L.push(G),J=G,v+=1);if(/[eE]/.test(G)||"-"===G&&/[eE]/.test(J))return L.push(G),J=G,v+1;if(/[^\d]/.test(G))return z(L.join("")),F=999,v;L.push(G);J=G;return v+1}var v=0,D=0,F=999,G,J,L=[],K=[],O=1,P=0,N=0,H=!1,E=!1,I="",M;return function(Q){K=[];if(null!==Q){Q=Q.replace?Q.replace(/\r\n/g,"\n"):Q;v=0;I+=Q;for(M=I.length;G=I[v],v<M;){Q=v;switch(F){case 0:"/"===G&&"*"===J?(L.push(G),z(L.join("")),F=999):(L.push(G),J=G);v+=1;break;case 1:v=B();break;
case 2:v=B();break;case 3:v=C();break;case 4:v=q();break;case 11:/[^a-fA-F0-9]/.test(G)?(z(L.join("")),F=999):(L.push(G),J=G,v+=1);break;case 5:v=x();break;case 9999:if(/[^\d\w_]/.test(G)){var T=L.join("");F=-1<p.literals.indexOf(T)?8:-1<p.builtins.indexOf(T)?7:6;z(L.join(""));F=999}else L.push(G),J=G,v+=1;break;case 9:/[^\s]/g.test(G)?(z(L.join("")),F=999):(L.push(G),J=G,v+=1);break;case 999:v=y()}if(Q!==v)switch(I[Q]){case "\n":P=0;++O;break;default:++P}}D+=v;I=I.slice(v);return K}L.length&&z(L.join(""));
F=10;z("(eof)");return K}}function h(z){return z.map(y=>"eof"!==y.type?y.data:"").join("")}function d(z,y="100",B="300 es"){const C=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const k of z)if("preprocessor"===k.type){const q=C.exec(k.data);if(q){z=q[1].replace(/\s\s+/g," ");if(z===B)return z;if(z===y)return k.data="#version "+B,y;throw Error("unknown glsl version: "+z);}}z.splice(0,0,{type:"preprocessor",data:"#version "+B},{type:"whitespace",data:"\n"});return null}function f(z,y,B,C){C=C||B;
for(const k of z)if("ident"===k.type&&k.data===B)return C in y?y[C]++:y[C]=0,f(z,y,C+"_"+y[C],C);return B}function e(z,y,B="afterVersion"){const C={data:"\n",type:"whitespace"},k=x=>x<z.length?/[^\r\n]$/.test(z[x].data):!1;let q=function(x){let v=-1,D=0,F=-1;for(let J=0;J<x.length;J++){var G=x[J];"preprocessor"===G.type&&(G.data.match(/#(if|ifdef|ifndef)\s+.+/)?++D:G.data.match(/#endif\s*.*/)&&--D);("afterVersion"===B||"afterPrecision"===B)&&"preprocessor"===G.type&&/^#version/.test(G.data)&&(F=Math.max(F,
J));if("afterPrecision"===B&&"keyword"===G.type&&"precision"===G.data){a:{for(G=J;G<x.length;G++){const L=x[G];if("operator"===L.type&&";"===L.data)break a}G=null}if(null===G)throw Error("precision statement not followed by any semicolons!");F=Math.max(F,G)}v<F&&0===D&&(v=J)}return v+1}(z);k(q-1)&&z.splice(q++,0,C);for(const x of y)z.splice(q++,0,x);k(q-1)&&k(q)&&z.splice(q,0,C)}function l(z,y,B,C="lowp"){e(z,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:C},{type:"whitespace",
data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:y},{type:"operator",data:";"}],"afterPrecision")}function A(z,y,B,C,k="lowp"){e(z,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:C.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",
data:k},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:y},{type:"operator",data:";"}],"afterPrecision")}var t="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const w=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],u=new Map;a.transpileShader=function(z,y){var B=n.shaderTranspiler.enableCache?u.get(z):null;if(c.isSome(B))return B;
B=g();var C=[];C=C.concat(B(z));B=C=C.concat(B(null));if("300 es"===d(B,"100","300 es"))return z;var k=C=null;const q={},x={};for(let G=0;G<B.length;++G){const J=B[G];switch(J.type){case "keyword":y===r.ShaderType.VERTEX_SHADER&&"attribute"===J.data?J.data="in":"varying"===J.data&&(J.data=y===r.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(J.data.trim())&&(J.data=J.data.replace(/(2D|Cube|EXT)/g,""));y===r.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===
J.data&&(C||(C=f(B,q,"fragColor"),l(B,C,"vec4")),J.data=C);if(y===r.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===J.data){var v=void 0;let L=void 0;var D=B,F=G+1;let K=-1;for(;F<D.length;F++){const O=D[F];if("operator"===O.type&&("["===O.data&&(L=F),"]"===O.data)){v=F;break}"integer"===O.type&&(K=parseInt(O.data,10))}L&&v&&D.splice(L,v-L+1);D=K;v=f(B,q,"fragData");A(B,v,"vec4",D,"mediump");J.data=v}else y===r.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===J.data&&(k||(k=f(B,q,"gl_FragDepth")),J.data=
k);break;case "ident":if(m.includes(J.data)){if(D=y===r.ShaderType.VERTEX_SHADER)a:{for(D=G-1;0<=D;D--)if(v=B[D],"whitespace"!==v.type&&"block-comment"!==v.type)if("keyword"===v.type){if("attribute"===v.data||"in"===v.data){D=!0;break a}}else break;D=!1}if(D)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");J.data in x||(x[J.data]=f(B,q,J.data));J.data=x[J.data]}}}for(y=B.length-1;0<=y;--y)C=B[y],"preprocessor"===C.type&&((k=C.data.match(/#extension\s+(.*):/))&&
k[1]&&w.includes(k[1].trim())&&(k=B[y+1],B.splice(y,k&&"whitespace"===k.type?2:1)),(k=C.data.match(/#ifdef\s+(.*)/))&&k[1]&&w.includes(k[1].trim())&&(C.data="#if 1"),(k=C.data.match(/#ifndef\s+(.*)/))&&k[1]&&w.includes(k[1].trim())&&(C.data="#if 0"));B=h(B);n.shaderTranspiler.enableCache&&u.set(z,B);return B};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/builtins":function(){define(["exports"],function(a){var b={exports:{}};(function(m){(function(n){n=n();void 0!==n&&(m.exports=n)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(b);
b=b.exports;var c={exports:{}};(function(m){(function(n){n=n();void 0!==n&&(m.exports=n)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(c);c=c.exports;var r={exports:{}};(function(m){(function(n){n=n();void 0!==n&&(m.exports=n)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(r);
a.builtins=r.exports;a.literals=b;a.operators=c})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,c,r,m,n,p){let g=function(){function h(d){this.context=d;this._floatBufferBlendWorking=m.testFloatBufferBlend(d);p.testSVGPremultipliedAlpha(d).then(f=>this._svgAlwaysPremultipliesAlpha=!f)}b._createClass(h,
[{key:"floatBufferBlendWorking",get:function(){if(c.isNone(this._floatBufferBlendWorking))throw Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if(c.isNone(this._svgAlwaysPremultipliesAlpha))throw Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if(c.isNone(this._doublePrecisionRequiresObfuscation)){const d=
r.testDoublePrecisionArithmetic(this.context,!1),f=r.testDoublePrecisionArithmetic(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==d&&(0===f||5<d/f)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){c.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=n.testSamplerPrecision(this.context));return this._ignoresSamplerPrecision}}]);return h}();a.WebGLDriverTest=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,r,m,n,p,g,h){a.testDoublePrecisionArithmetic=function(d,f){d.resetState();var e=new p.FramebufferObject(d,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,
pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1}),l=r.BufferObject.createVertex(d,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));const A=new g.VertexArrayObject(d,new Map([["position",0]]),{geometry:[new h.VertexElementDescriptor("position",2,n.DataType.UNSIGNED_SHORT,0,4)]},{geometry:l}),t=c.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),w=c.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);
f=d.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${f?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));const u=new Float32Array(6);m.encodeDoubleArray(t,u,3);const z=new Float32Array(6);m.encodeDoubleArray(w,z,3);d.useProgram(f);f.setUniform3f("u_highA",u[0],u[2],u[4]);f.setUniform3f("u_lowA",u[1],u[3],u[5]);f.setUniform3f("u_highB",z[0],z[2],z[4]);f.setUniform3f("u_lowB",z[1],z[3],z[5]);d.bindFramebuffer(e);d.setViewport(0,0,1,1);d.bindVAO(A);d.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,
0,4);d=new Uint8Array(4);e.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,d);f.dispose();A.dispose(!1);l.dispose();e.dispose();e=(t[2]-w[2])/25;l=b.unpackFloatRGBA(d);return Math.abs(e-l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,r,m,n,p,g,h){var d={exports:{}};(function(f){(function(e){e=e();void 0!==e&&(f.exports=e)})(function(){function e(k){if(null==B){B={};C={};for(var q in k)"number"==typeof k[q]&&(B[k[q]]=q,C[q]=k[q])}}function l(){if(null==B)throw"WebGLDebugUtils.init(ctx) not called";}function A(k){l();var q=B[k];return void 0!==q?"gl."+q:"/*UNKNOWN WebGL ENUM*/ 0x"+k.toString(16)}function t(k,q,x,v){k=y[k];if(void 0!==k&&(k=k[q],void 0!==k&&k[x])){if("object"===typeof k[x]&&void 0!==k[x].enumBitwiseOr){q=
k[x].enumBitwiseOr;x=0;k=[];for(var D=0;D<q.length;++D){var F=C[q[D]];0!==(v&F)&&(x|=F,k.push(A(F)))}return x===v?k.join(" | "):A(v)}return A(v)}return null===v?"null":void 0===v?"undefined":v.toString()}function w(k,q,x){k.__defineGetter__(x,function(){return q[x]});k.__defineSetter__(x,function(v){q[x]=v})}function u(k,q,x,v){function D(K,O){return function(){x&&x(O,arguments);var P=K[O].apply(K,arguments),N=v.getError();0!=N&&(F[N]=!0,q(N,O,arguments));return P}}v=v||k;e(k);q=q||function(K,O,P){for(var N=
"",H=P.length,E=0;E<H;++E)N+=(0==E?"":", ")+t(O,H,E,P[E]);K="WebGL error "+A(K)+" in "+O+"("+N+")";window.console&&window.console.error?window.console.error(K):window.console&&window.console.log&&window.console.log(K)};var F={},G={},J;for(J in k)if("function"==typeof k[J])if("getExtension"!=J)G[J]=D(k,J);else{var L=D(k,J);G[J]=function(){var K=L.apply(k,arguments);return u(K,q,x,v)}}else w(G,k,J);G.getError=function(){for(var K in F)if(F.hasOwnProperty(K)&&F[K])return F[K]=!1,K;return k.NO_ERROR};
return G}function z(k){var q=k.getParameter(k.MAX_VERTEX_ATTRIBS),x=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,x);for(var v=0;v<q;++v)k.disableVertexAttribArray(v),k.vertexAttribPointer(v,4,k.FLOAT,!1,0,0),k.vertexAttrib1f(v,0);k.deleteBuffer(x);q=k.getParameter(k.MAX_TEXTURE_IMAGE_UNITS);for(v=0;v<q;++v)k.activeTexture(k.TEXTURE0+v),k.bindTexture(k.TEXTURE_CUBE_MAP,null),k.bindTexture(k.TEXTURE_2D,null);k.activeTexture(k.TEXTURE0);k.useProgram(null);k.bindBuffer(k.ARRAY_BUFFER,null);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,
null);k.bindFramebuffer(k.FRAMEBUFFER,null);k.bindRenderbuffer(k.RENDERBUFFER,null);k.disable(k.BLEND);k.disable(k.CULL_FACE);k.disable(k.DEPTH_TEST);k.disable(k.DITHER);k.disable(k.SCISSOR_TEST);k.blendColor(0,0,0,0);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.ONE,k.ZERO);k.clearColor(0,0,0,0);k.clearDepth(1);k.clearStencil(-1);k.colorMask(!0,!0,!0,!0);k.cullFace(k.BACK);k.depthFunc(k.LESS);k.depthMask(!0);k.depthRange(0,1);k.frontFace(k.CCW);k.hint(k.GENERATE_MIPMAP_HINT,k.DONT_CARE);k.lineWidth(1);
k.pixelStorei(k.PACK_ALIGNMENT,4);k.pixelStorei(k.UNPACK_ALIGNMENT,4);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!1);k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);k.UNPACK_COLORSPACE_CONVERSION_WEBGL&&k.pixelStorei(k.UNPACK_COLORSPACE_CONVERSION_WEBGL,k.BROWSER_DEFAULT_WEBGL);k.polygonOffset(0,0);k.sampleCoverage(1,!1);k.scissor(0,0,k.canvas.width,k.canvas.height);k.stencilFunc(k.ALWAYS,0,4294967295);k.stencilMask(4294967295);k.stencilOp(k.KEEP,k.KEEP,k.KEEP);k.viewport(0,0,k.canvas.width,k.canvas.height);
for(k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT|k.STENCIL_BUFFER_BIT);k.getError(););}var y={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},
texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},
bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,
1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},B=null,C=null;return{init:e,mightBeEnum:function(k){l();return void 0!==B[k]},glEnumToString:A,glFunctionArgToString:t,glFunctionArgsToString:function(k,q){for(var x="",v=q.length,
D=0;D<v;++D)x+=(0==D?"":", ")+t(k,v,D,q[D]);return x},makeDebugContext:u,makeLostContextSimulatingCanvas:function(k){function q(S){return"function"==typeof S?S:function(U){S.handleEvent(U)}}function x(){for(var S=Object.keys(T),U=0;U<S.length;++U)delete T[S]}function v(){++I;N||E==I&&k.loseContext()}function D(S,U){var Y=S[U];return function(){v();if(!N)return Y.apply(S,arguments)}}function F(S){return{statusMessage:S,preventDefault:function(){M=!0}}}function G(S){for(var U in S)"function"==typeof S[U]?
O[U]=D(S,U):w(O,S,U);O.getError=function(){v();if(!N)for(var R;R=J.getError();)T[R]=!0;for(R in T)if(T[R])return delete T[R],R;return O.NO_ERROR};var Y="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(U=0;U<Y.length;++U){var V=Y[U];O[V]=function(R){return function(){v();if(N)return null;var X=R.apply(S,arguments);X.__webglDebugContextLostId__=P;H.push(X);return X}}(S[V])}Y="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(U=0;U<Y.length;++U)V=Y[U],O[V]=function(R){return function(){v();return N?null:R.apply(S,arguments)}}(O[V]);Y="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(U=0;U<Y.length;++U)V=Y[U],O[V]=function(R){return function(){v();return N?!1:R.apply(S,arguments)}}(O[V]);O.checkFramebufferStatus=function(R){return function(){v();return N?O.FRAMEBUFFER_UNSUPPORTED:R.apply(S,arguments)}}(O.checkFramebufferStatus);O.getAttribLocation=function(R){return function(){v();
return N?-1:R.apply(S,arguments)}}(O.getAttribLocation);O.getVertexAttribOffset=function(R){return function(){v();return N?0:R.apply(S,arguments)}}(O.getVertexAttribOffset);O.isContextLost=function(){return N};return O}var J,L=[],K=[];var O={};var P=1,N=!1,H=[],E=0,I=0,M=!1,Q=0,T={};k.getContext=function(S){return function(){var U=S.apply(k,arguments);if(U instanceof WebGLRenderingContext){if(U!=J){if(J)throw"got different context";J=U;O=G(J)}return O}return U}}(k.getContext);(function(S){var U=S.addEventListener;
S.addEventListener=function(Y,V,R){switch(Y){case "webglcontextlost":L.push(q(V));break;case "webglcontextrestored":K.push(q(V));break;default:U.apply(S,arguments)}}})(k);k.loseContext=function(){if(!N){N=!0;E=0;for(++P;J.getError(););x();T[J.CONTEXT_LOST_WEBGL]=!0;var S=F("context lost"),U=L.slice();setTimeout(function(){for(var Y=0;Y<U.length;++Y)U[Y](S);0<=Q&&setTimeout(function(){k.restoreContext()},Q)},0)}};k.restoreContext=function(){N&&K.length&&setTimeout(function(){if(!M)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var S=0;S<H.length;++S){var U=H[S];U instanceof WebGLBuffer?J.deleteBuffer(U):U instanceof WebGLFramebuffer?J.deleteFramebuffer(U):U instanceof WebGLProgram?J.deleteProgram(U):U instanceof WebGLRenderbuffer?J.deleteRenderbuffer(U):U instanceof WebGLShader?J.deleteShader(U):U instanceof WebGLTexture&&J.deleteTexture(U)}z(J);N=!1;I=0;M=!1;S=K.slice();U=F("context restored");for(var Y=0;Y<S.length;++Y)S[Y](U)},0)};k.loseContextInNCalls=function(S){if(N)throw"You can not ask a lost contet to be lost";
E=I+S};k.getNumCalls=function(){return I};k.setRestoreTimeout=function(S){Q=S};return k},resetToInitialState:z}})})(d);a.testFloatBufferBlend=function(f){if(!f.gl)return!1;if(f.type===r.ContextType.WEBGL1)return!(!f.capabilities.textureFloat?.textureFloat||!f.capabilities.colorBufferFloat?.textureFloat);if(!(f.capabilities.textureFloat?.textureFloat&&f.capabilities.colorBufferFloat?.textureFloat&&f.capabilities.colorBufferFloat?.floatBlend))return!1;const e=new n.FramebufferObject(f,{colorTarget:m.TargetType.TEXTURE,
depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.FLOAT,internalFormat:m.SizedPixelFormat.RGBA32F,samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1}),l=c.BufferObject.createVertex(f,m.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),A=new g.VertexArrayObject(f,new Map([["a_pos",0]]),{geometry:[new h.VertexElementDescriptor("a_pos",2,m.DataType.UNSIGNED_SHORT,
0,4)]},{geometry:l}),t=f.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));f.useProgram(t);const w=f.getBoundFramebufferObject(),{x:u,y:z,width:y,height:B}=f.getViewport();f.bindFramebuffer(e);f.setViewport(0,0,1,1);f.bindVAO(A);f.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,
0,4);var C=p.makePipelineState({blending:b.blendingAlpha});f.setPipelineState(C);f.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);d.exports.init(f);C=f.gl.getError();f.setViewport(u,z,y,B);f.bindFramebuffer(w);t.dispose();A.dispose(!1);l.dispose();e.dispose();return 1282===C?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,r,m,n,p,g){a.testSamplerPrecision=function(h){var d=new m.FramebufferObject(h,{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE},{target:r.TextureType.TEXTURE_2D,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,width:1,height:1});const f=new Uint8Array(4),e=c.BufferObject.createVertex(h,r.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),l=new p.VertexArrayObject(h,
new Map([["a_position",0]]),{geometry:[new g.VertexElementDescriptor("a_position",2,r.DataType.SHORT,0,4)]},{geometry:e}),A=h.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",new Map([["a_pos",0]]));h.useProgram(A);var t=new n.Texture(h,{target:r.TextureType.TEXTURE_2D,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));A.setUniform1i("u_texture",0);h.bindTexture(t,0);t=h.getBoundFramebufferObject();h.bindFramebuffer(d);h.useProgram(A);
const {x:w,y:u,width:z,height:y}=h.getViewport();h.setViewport(0,0,1,1);h.bindVAO(l);h.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4);h.setViewport(w,u,z,y);d.readPixels(0,0,1,1,r.PixelFormat.RGBA,r.PixelType.UNSIGNED_BYTE,f);A.dispose();l.dispose(!1);e.dispose();d.dispose();(d=255!==f[0]||255!==f[1]||255!==f[2]||255!==f[3])&&b.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${f[0]}.${f[1]}.${f[2]}.${f[3]}]`);
h.bindFramebuffer(t);return d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject".split(" "),function(a,b,c,r,m,n,p,g){function h(){h=b._asyncToGenerator(function*(d){const f=new Image;f.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
f.width=5;f.height=5;yield f.decode();if(!d.gl)return!0;const e=new n.FramebufferObject(d,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1}),l=r.BufferObject.createVertex(d,m.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),A=new g.VertexArrayObject(d,new Map([["a_pos",
0]]),c.Pos2us,{geometry:l}),t=d.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));d.useProgram(t);const w=new p.Texture(d,{dataType:m.PixelType.UNSIGNED_BYTE,
pixelFormat:m.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:m.TextureSamplingMode.LINEAR},f);d.bindTexture(w,0);t.setUniform1i("u_texture",0);const u=d.getBoundFramebufferObject(),{x:z,y,width:B,height:C}=d.getViewport();d.bindFramebuffer(e);d.setViewport(0,0,1,1);d.setClearColor(0,0,0,0);d.setBlendingEnabled(!1);d.clearSafe(m.ClearBufferBit.COLOR_BUFFER_BIT);d.bindVAO(A);d.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);const k=new Uint8Array(4);e.readPixels(0,
0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,k);t.dispose();A.dispose(!1);l.dispose();e.dispose();w.dispose();d.setViewport(z,y,B,C);d.bindFramebuffer(u);f.src="";return 255===k[0]});return h.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(d){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],
function(a,b,c){const r={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},m={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=r;a.Pos2us=b;a.PosTex2b=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,r,m,n,p,g){let h=function(){function d(f,e){this._gl=f;this._textureFloatLinear=this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=this._instancing=null;this._disabledExtensions=e.disabledExtensions||{};this._debugWebGLExtensions=
e.debugWebGLExtensions||{}}d.prototype.enable=function(f){return this[f]};b._createClass(d,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=r.load(this._gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||(this._instancing=m.load(this._gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=g.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",
get:function(){this._compressedTextureETC||(this._compressedTextureETC=n.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=n.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=n.loadTextureFilterAnisotropicCapability(this._gl,
this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=n.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=
n.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=n.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=n.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},
{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=n.loadBooleanExtension(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));return this._standardDerivatives}},{key:"shaderTextureLOD",get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=n.loadBooleanExtension(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",
get:function(){null===this._fragDepth&&(this._fragDepth=n.loadBooleanExtension(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=p.load(this._gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=n.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",
get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=n.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return d}();a.Capabilities=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,r){return r.disjointTimerQuery?null:
b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:r.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],
function(a,b){a.load=function(c){return b(c)?c:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,r,m,n,
p){if(n&&b(c))return!0;if(r[m])return!1;for(const g of p)if(c.getExtension(g))return!0;return!1};a.loadColorBufferFloat=function(c,r){if(b(c)){var m=!r.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!r.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),n=!r.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");r=!r.floatBlend&&!r.colorBufferFloat&&c.getExtension("EXT_float_blend");return m||n||r?{textureFloat:!!n,textureHalfFloat:!!m,floatBlend:!!r,R16F:c.R16F,RG16F:c.RG16F,
RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(m=!r.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),n=!r.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!r.floatBlend&&!r.colorBufferFloat&&c.getExtension("EXT_float_blend"),m||n||c?{textureFloat:!!n,textureHalfFloat:!!m,floatBlend:!!c,RGBA16F:m?m.RGBA16F_EXT:void 0,RGB16F:m?m.RGB16F_EXT:void 0,RGBA32F:n?
n.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,r){return r.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,r){return r.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,r){return b(c)?{MIN:c.MIN,MAX:c.MAX}:r.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,r){return r.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,
TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,r){if(b(c))return{textureFloat:!0,textureFloatLinear:!r.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const m=!r.textureHalfFloat&&c.getExtension("OES_texture_half_float");
return{textureFloat:!r.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!r.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!m,textureHalfFloatLinear:!r.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:m?m.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(c,r){return!b(c)||r.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,
R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const r=c.loseContext&&b.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,r){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:r.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),
bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z){a.TextureRepository=function(B){function C(q,x,v){var D=B.call(this,{})||this;D._stage=q;D._techniqueRepository=x;D._rctx=v;D._textures=new Map;D._loadingCount=0;D._frameUpdates=new Map;D.events=new m;D._frameTask=q.resourceController.scheduler.registerTask(z.TaskPriority.TEXTURE_UNLOAD);return D}b._inheritsLoose(C,B);var k=C.prototype;k.normalizeCtorArgs=function(){return{}};k.dispose=function(){this._frameTask.remove();this._stage.forEachOfType(A.ContentObjectType.Texture,
q=>q.unload())};k.acquire=function(q){const x=this._textures.get(q);return x?(x.ref(),p.unwrapOr(x.loadingPromise,x)):this._createNewRef(q)};k.update=function(){let q=!1;this._frameUpdates.forEach(x=>{const v=x.texture.frameUpdate(this._rctx,this.textureTechnique,x.previousToken);0<=v&&v!==x.previousToken&&(x.previousToken=v,q=!0)});q&&this.events.emit("changed",l.RenderRequestType.BACKGROUND)};k._createNewRef=function(q){const x=this._stage.getObject(q);if(p.isNone(x))return u.assert(void 0!==x),
null;const v=x.events.on("unloaded",()=>{v.remove();this._onTextureUnloaded(q)}),D=new y(q,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&x.unload()})});this._textures.set(q,D);D.ref();if(p.isSome(x.glTexture))return this._updateGLTexture(D,x.glTexture),x.requiresFrameUpdates&&this._frameUpdates.set(q,{texture:x,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>{const F=x.load(this._rctx,()=>this.textureTechnique),G=L=>{this._loadingCount--;D.loadingPromise=
null;this._updateGLTexture(D,L);x.requiresFrameUpdates&&this._frameUpdates.set(q,{texture:x,previousToken:-1});return D},J=L=>{this._loadingCount--;D.loadingPromise=null;g.isAbortError(L)||n.getLogger(this.declaredClass).error(L);return null};return g.isPromiseLike(F)?F.then(G,J):G(F)});return D.loadingPromise};k._updateGLTexture=function(q,x){q.glTexture=x;this.events.emit("changed",l.RenderRequestType.UPDATE)};k._onTextureUnloaded=function(q){this._textures.delete(q);this._frameUpdates.delete(q)};
b._createClass(C,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){p.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(t.TextureTechnique,new w.TextureTechniqueConfiguration));return this._textureTechnique}}]);return C}(r);c.__decorate([h.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([h.property()],a.TextureRepository.prototype,"_frameTask",void 0);
c.__decorate([h.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let y=function(){function B(k,q){this.id=k;this._release=q;this._refCount=0}var C=B.prototype;C.ref=function(){++this._refCount};C.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(n.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),
this._refCount=0))};b._createClass(B,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return B}();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){a.WaterTextureRepository=function(z){function y(){var C=z.apply(this,arguments)||this;C._passParameters=new u;C._loading=0;return C}b._inheritsLoose(y,z);var B=y.prototype;B.dispose=function(){this._passParameters.waveNormal=p.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePertubation=p.disposeMaybe(this._passParameters.wavePertubation)};B.ensureResources=function(C){if(0<this._loading)return A.ResourceState.LOADING;if(p.isSome(this._passParameters.waveNormal)&&
p.isSome(this._passParameters.wavePertubation))return A.ResourceState.LOADED;const k={target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.REPEAT,samplingMode:t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};++this._loading;e.requestImage(r.getAssetUrl("esri/images/materials/water/normals.jpg")).then(q=>this._passParameters.waveNormal=new w.Texture(C,{...k,width:q.width,height:q.height},q)).catch(q=>n.getLogger(this.declaredClass).error("Failed to load water material normal texture.",
q)).finally(()=>--this._loading);++this._loading;e.requestImage(r.getAssetUrl("esri/images/materials/water/perturbation.jpg")).then(q=>this._passParameters.wavePertubation=new w.Texture(C,{...k,width:q.width,height:q.height},q)).catch(q=>n.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",q)).finally(()=>--this._loading);return A.ResourceState.LOADING};b._createClass(y,[{key:"passParameters",get:function(){return this._passParameters}},{key:"updating",get:function(){return 0<
this._loading}}]);return y}(m);c.__decorate([g.property()],a.WaterTextureRepository.prototype,"_loading",void 0);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([f.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);let u=function(z){function y(){return z.apply(this,arguments)||this}b._inheritsLoose(y,z);return y}(l.NoParameters);a.WaterTexturePassParameters=
u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){n=function(e){function l(t,w,u,z){var y=e.call(this)||this;y._rctx=t;y._renderFunctions=w;y._forceCameraHook=u;y._disposeOffscreenBuffers=z;y.supersample=!0;y._screenshotQueue=[];return y}b._inheritsLoose(l,e);var A=l.prototype;A.dispose=function(){this._rctx=null};A.takeScreenshot=function(){var t=b._asyncToGenerator(function*(w){yield this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(p.RenderRequestType.BACKGROUND);const u=r.createResolver();
this._screenshotQueue.push({settings:w,resolver:u});return u.promise});return function(w){return t.apply(this,arguments)}}();A.update=function(t,w){for(const u of this._screenshotQueue){if(this.isDisposed){u.resolver.reject();continue}const z=this._renderScreenshot(t,{...u.settings,pixelRatio:u.settings.pixelRatio*t.viewCamera.pixelRatio},w);u.resolver(z)}this._screenshotQueue.length=0};A._renderScreenshotOverlay=function(t,w,u){t.width=w.width;t.height=w.height;const z=t.getContext("2d"),y=u.pixelRatio;
z.save();z.translate(0,w.height);z.scale(1,-1);u.region&&z.translate(-u.region.x,-u.region.y);z.scale(y,y);w=this._renderFunctions.renderOverlay(t,w);z.restore();return w};A._readbackScreenshot=function(t,w){return t.resample?this._readbackScreenshotResampled(t,w):this._readbackScreenshotImmediate(t,w)};A._readbackScreenshotResampled=function(t,w){const {framebufferWidth:u,framebufferHeight:z,region:y,resample:B}=t,C=this._ensureScreenshotEncodeCanvas();let k=f.createEmptyImageData(u,z,C);this._rctx.gl.readPixels(0,
0,u,z,h.PixelFormat.RGBA,h.DataType.UNSIGNED_BYTE,new Uint8Array(k.data.buffer));w();k=this._renderScreenshotOverlay(C,k,{...t,region:null});t=f.createEmptyImageData(y.width,y.height,C);return g.resampleHermite(k,t,!0,B.region.x,z-(B.region.y+B.region.height),B.region.width,B.region.height)};A._readbackScreenshotImmediate=function(t,w){const {framebufferHeight:u,region:z}=t,y=this._ensureScreenshotEncodeCanvas(),B=f.createEmptyImageData(z.width,z.height,y);this._rctx.gl.readPixels(z.x,u-(z.y+z.height),
z.width,z.height,h.PixelFormat.RGBA,h.DataType.UNSIGNED_BYTE,new Uint8Array(B.data.buffer));w();return this._renderScreenshotOverlay(y,B,t)};A._renderScreenshot=function(t,w,u){let z=null,y=null;const B=t.viewCamera,{framebufferWidth:C,framebufferHeight:k}=w;var q=!1;t=w.disableDecorations&&t.frameHasDecorations;var x=w.ignorePadding&&B.pixelRatio!==w.pixelRatio;t=C!==B.fullWidth||k!==B.fullHeight||t||x||w.objectAndLayerIdColor;w.objectAndLayerIdColor&&(y=new d.FramebufferObject(this._rctx,{width:C,
height:k,colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER}));if(t){x=B.clone();if(w.ignorePadding){q=m.clone(x.padding);for(var v=0;4>v;v++)q[v]=Math.round(q[v]/x.pixelRatio*w.pixelRatio);x.padding=q}x.fullWidth=C;x.fullHeight=k;x.pixelRatio=w.pixelRatio;q=B.fovX-x.fovX;v=B.fovY-x.fovY;0>q&&q<v?x.fovX=B.fovX:0>v&&v<q&&(x.fovY=B.fovY);this._forceCameraHook(x);q=!0;z=new d.FramebufferObject(this._rctx,{width:x.fullWidth,height:x.fullHeight,colorTarget:h.TargetType.TEXTURE,
depthStencilTarget:h.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderFunctions.renderScene(z,y,x,w.disableDecorations?p.Decorations.OFF:p.Decorations.ON,u);this._disposeOffscreenBuffers()}x=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(z)};u=this._readbackScreenshot(w,x);x();x=null;w.objectAndLayerIdColor&&(v=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(y)},this._rctx.bindFramebuffer(y),x=this._readbackScreenshot(w,v),this._rctx.bindFramebuffer(null),v());if(t&&!this._rctx.contextAttributes.alpha)for(w=
3;w<u.data.length;w+=4)u.data[w]=255;if(x&&!this._rctx.contextAttributes.alpha)for(w=3;w<x.data.length;w+=4)x.data[w]=255;q&&this._forceCameraHook(B);return[u,x]};A._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return l}(n.AutoDisposable);a.ScreenshotContext=function(e,l){this.viewCamera=e;this.frameHasDecorations=l};a.ScreenshotManager=n;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/maybe","../../core/imageUtils"],function(a,b,c,r,m){function n(u,z){const {format:y,quality:B,rotation:C,disableDecorations:k}=u||{};var q=f(u,z.padding);var x=z.width-q.left-q.right;z=z.height-q.top-q.bottom;q={x:0,y:0,width:x,height:z};if(u&&u.area){null!=u.area.x&&(q.x=Math.floor(u.area.x));null!=u.area.y&&(q.y=Math.floor(u.area.y));var v=
null!=u.area.width?Math.floor(u.area.width):null,D=null!=u.area.height?Math.floor(u.area.height):null;q.width=x-q.x;q.height=z-q.y;null!=v&&null!=D?(q.width=Math.min(q.width,v),q.height=Math.min(q.height,D)):null==v&&null!=D?(v=Math.min(q.width,v),q.height*=v/q.width,q.width=v):null!=v&&null==D&&(v=Math.min(q.height,D),q.width*=v/q.height,q.height=v)}q=d(q,u);v=Math.floor(Math.max(q.x,0));D=Math.floor(Math.max(q.y,0));x={x:v,y:D,width:Math.floor(Math.min(q.width,x-v)),height:Math.floor(Math.min(q.height,
z-D))};z=x.width/x.height;q=q.width/q.height;q!==z&&(q>z?(z=Math.floor(x.width/q),x={x:x.x,y:Math.floor(x.y+(x.height-z)/2),width:x.width,height:z}):(z=Math.floor(x.height*q),x={x:Math.floor(x.x+(x.width-z)/2),y:x.y,width:z,height:x.height}));const {width:F,height:G}=h(u,x);z=e(y);q=t[z];q=c.clamp(null!=B?B:q,0,100);return{format:z,quality:q,area:x,width:F,height:G,rotation:C,disableDecorations:!!k,ignoreBackground:!(!u||!u.ignoreBackground),ignorePadding:!(!u||!u.ignorePadding)}}function p(u,z){r.isNone(l)&&
(l=document.createElement("canvas"));var y=l;if(z.premultipliedAlpha){var B=u.data;const k=B.length;for(let q=0;q<k;q+=4){var C=B[q+3];255!==C&&0<C&&(C=255/C,B[q+0]*=C,B[q+1]*=C,B[q+2]*=C)}}y.width=u.width;y.height=u.height;B=y.getContext("2d");B.putImageData(u,0,0);z.flipY&&(B.save(),B.globalCompositeOperation="copy",B.scale(1,-1),B.translate(0,-B.canvas.height),B.drawImage(B.canvas,0,0),B.restore());return{ctx:B,canvas:y}}function g(u,z){return u.toDataURL(A[z.format],z.quality/100)}function h(u,
z){if(!u)return z;const y=u.width;u=u.height;if(null!=y&&null!=u)return{width:Math.floor(y),height:Math.floor(u)};if(null==y&&null==u)return z;z=z.width/z.height;return null==u?{width:Math.floor(y),height:Math.floor(y/z)}:{width:Math.floor(u*z),height:Math.floor(u)}}function d(u,z){if(!z||null==z.width||null==z.height)return u;z=z.width/z.height;const y=u.width/u.height;if(y===z)return u;if(y<z)return z=Math.floor(u.height*z),u.x-=(z-u.width)/2,u.width=z,u;z=Math.floor(u.width/z);u.y-=(z-u.height)/
2;u.height=z;return u}function f(u,z){return!z||u&&u.ignorePadding?w:z}function e(u){switch(u){case "png":case "jpg":case "jpeg":return u;case null:case void 0:return"png";default:return"png"}}let l=null;const A={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},t={png:100,jpg:98,jpeg:98},w={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=m.createEmptyImageData;a.completeUserSettings=n;a.encode=function(u,z,y){const {ctx:B,canvas:C}=p(u,y);u=B.getImageData(0,0,u.width,u.height);z=g(C,z);C.width=
0;C.height=0;return{dataUrl:z,data:u}};a.encodeData=function(u,z){const {ctx:y,canvas:B}=p(u,z);u=y.getImageData(0,0,u.width,u.height);B.width=0;B.height=0;return u};a.getFormatAndQuality=function(u,z){u=e(u);const y=t[u];z=c.clamp(null!=z?z:y,0,100);return{format:u,quality:z}};a.getMaximumResolutionScale=function(u,z){return z/Math.max(u[0],u[1])};a.resampleHermite=function(u,z,y,B=0,C=0,k=u.width-B,q=u.height-C,x=!1){const {data:v}=u,{width:D,height:F,data:G}=z;k/=D;q/=F;const J=Math.ceil(k/2),
L=Math.ceil(q/2);u=u.width;for(let P=0;P<F;P++)for(let N=0;N<D;N++){const H=4*(N+(x?F-P-1:P)*D);let E=0,I=0,M=0,Q=0,T=0,S=0;const U=(P+.5)*q;for(let Y=Math.floor(P*q);Y<(P+1)*q;Y++){var K=Math.abs(U-(Y+.5))/L;const V=(N+.5)*k;K*=K;for(let R=Math.floor(N*k);R<(N+1)*k;R++){var O=Math.abs(V-(R+.5))/J;O=Math.sqrt(K+O*O);if(1<=O)continue;O=2*O*O*O-3*O*O+1;const X=4*(B+R+(C+Y)*u);S+=O*v[X+3];I+=O;!y&&255>v[X+3]&&(O=O*v[X+3]/255);M+=O*v[X];Q+=O*v[X+1];T+=O*v[X+2];E+=O}}G[H]=M/E;G[H+1]=Q/E;G[H+2]=T/E;G[H+
3]=S/I}return z};a.screenshotSuperSampleSettings=function(u,z,y){if(!z)return u;const {framebufferWidth:B,framebufferHeight:C,pixelRatio:k,region:q}=u;z=f(u,y);y=z.left+z.right;const x=z.top+z.bottom,v=B-y,D=C-x,F=Math.min(8,Math.min((2048-y)/v,(2048-x)/D));return 1.5>F?u:{...u,framebufferWidth:Math.round(v*F)+y,framebufferHeight:Math.round(D*F)+x,pixelRatio:k*F,resample:{region:{x:Math.round((q.x-z.left)*F)+z.left,y:Math.round((q.y-z.top)*F)+z.top,width:Math.round(q.width*F),height:Math.round(q.height*
F)},width:B,height:C}}};a.toDataUrl=g;a.toRenderSettings=function(u,z){const y=n(u,z),B=y.area,C=y.width/B.width,k=f(y,z.padding),q=k.left+k.right,x=k.top+k.bottom;return{framebufferWidth:Math.floor((z.width-q)*C+q),framebufferHeight:Math.floor((z.height-x)*C+x),region:{x:Math.floor(B.x*C)+k.left,y:Math.floor(B.y*C)+k.top,width:y.width,height:y.height},format:y.format,quality:y.quality,rotation:y.rotation,pixelRatio:C,layers:u&&u.layers?u.layers:[],disableDecorations:y.disableDecorations,ignoreBackground:y.ignoreBackground,
ignorePadding:y.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const c=b.getContextCache();c.forEach(r=>r.dispose());c.clear()}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(z,y){return b.isNone(z)?null:h.isObjectIntersectorResult(z)||h.isHudIntersectorResult(z)?e(z.target.object.metadata,y):p.isPclIntersectorResult(z)?(z=z.target.createGraphic(),{type:"graphic",graphic:z,layer:z.layer}):g.isOverlayIntersectorResult(z)||d.isLodIntersectorResult(z)?e(z.target,y):p.isI3sIntersectorResult(z)?l(z.target,y):null}function e(z,y){if(b.isNone(z)||b.isNone(z.graphicUid))return null;const B=w(z,y);if(b.isNone(B))return null;if(B===y.graphics)return b.isNone(y.graphicsView)||
"number"!==typeof z.graphicUid?null:y.graphicsView.getHit(z.graphicUid);y=y.allLayerViews.find(C=>C.layer===B);return!y||y.suspended||b.isNone(z.graphicUid)?null:"getHit"in y?y.getHit(z.graphicUid):null}function l(z,y){const B=w(z,y);return b.isNone(B)?null:(y=y.allLayerViews.find(C=>C.layer===B))&&!y.suspended&&"getGraphicFromIntersectorTarget"in y?t(y.getGraphicFromIntersectorTarget(z)):null}function A(z,y){const B=w(z,y);return b.isNone(B)?null:(y=y.allLayerViews.find(C=>C.layer===B))&&!y.suspended&&
"getAABBFromIntersectorTarget"in y?y.getAABBFromIntersectorTarget(z):null}function t(z){return b.isSome(z)?{type:"graphic",graphic:z,layer:z.layer}:null}function w(z,y){return b.isNone(z.layerUid)?null:b.isSome(y.graphicsView)&&z.layerUid===y.graphicsView.processor.layer.id?y.graphics:y.map.findLayerByUid(z.layerUid)}const u=r.create();a.getIntersectedFeatureBSRadius=function(z,y){return h.isObjectIntersectorResult(z)||h.isHudIntersectorResult(z)?n.getRadius(z.target.object.boundingVolumeWorldSpace.bounds):
d.isLodIntersectorResult(z)?(c.getScaling(u,z.transformation),z.target.baseBoundingSphere.radius*Math.max(u[0],u[1],u[2])):p.isI3sIntersectorResult(z)?b.applySome(A(z.target,y),B=>.5*m.diameter(B)):null};a.hasLod=function(z){return h.isObjectIntersectorResult(z)||h.isHudIntersectorResult(z)?!1:d.isLodIntersectorResult(z)?1<z.target.numLodLevels:p.isI3sIntersectorResult(z)?!0:!1};a.toGraphic=function(z,y){z=f(z,y);return b.isSome(z)&&"graphic"===z.type?z.graphic:null};a.toHit=f;a.toOwner=function(z,
y){return h.isObjectIntersectorResult(z)||h.isHudIntersectorResult(z)?w(z.target.object.metadata,y):g.isTerrainIntersectorResult(z)?y.map?.ground:p.isPclIntersectorResult(z)||p.isI3sIntersectorResult(z)||g.isOverlayIntersectorResult(z)?w(z.target,y):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/intersectorUtils"],
function(a,b,c){a.isI3sIntersectorResult=function(r){return c.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.I3S&&!!r.target};a.isPclIntersectorResult=function(r){return c.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.PCL&&!!r.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/intersectorUtils"],
function(a,b,c){a.isOverlayIntersectorResult=function(r){return c.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.OVERLAY&&!!r.target};a.isTerrainIntersectorResult=function(r){return c.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.TERRAIN&&!!r.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../intersectorUtils"],
function(a,b,c){a.isLodIntersectorResult=function(r){return c.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.LOD&&!!r.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){function r(){r=b._asyncToGenerator(function*(n,p){if("2d"===n.type)return n.hitTest(p);n=yield n.hitTest(p);if(0===n.results.length)return n;
p=n.results[0];const g=c.isSome(p.distance)?1.05*p.distance:p.distance;p=n.results.findIndex(h=>h.distance>g);-1!==p&&(n.results=n.results.slice(0,p));return n});return r.apply(this,arguments)}function m(n){return c.isSome(n)&&"graphic"===n.type}a.filterGraphicHits=function(n){return n.filter(m)};a.findFirstGraphicHit=function(n){return n.find(m)??null};a.hitTestSelectSimilarDistance=function(n,p){return r.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,b,c,r){a.check=function(m){const n=c.getWebGLCapabilities(m);if(!n.available)return new b("webgl:required","WebGL is required but not supported.");if("3d"===m&&n.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");
if(!n.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!n.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(n.type===r.ContextType.WEBGL1){if(!n.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");
if(!n.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!n.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/maybe","./context-util"],function(a,b,c,r){function m(A){switch(A){case r.ContextType.WEBGL1:return n();case r.ContextType.WEBGL2:return p()}}function n(){if(!h){{const A=new e,t=g(r.ContextType.WEBGL1,A);c.isNone(t)||(A.supportsElementIndexUint=null!==t.getExtension("OES_element_index_uint"),A.supportsStandardDerivatives=null!==t.getExtension("OES_standard_derivatives"),A.supportsInstancedArrays=null!==t.getExtension("ANGLE_instanced_arrays"),A.supportsTextureFloat=null!==t.getExtension("OES_texture_float"),
A.supportsTextureHalfFloat=null!==t.getExtension("OES_texture_half_float"),A.supportsColorBufferFloat=null!==t.getExtension("WEBGL_color_buffer_float"),A.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),A.supportsColorBufferHalfFloat=null!==t.getExtension("EXT_color_buffer_half_float"));h=A}}return h}function p(){if(!d){{const A=new l,t=g(r.ContextType.WEBGL2,A);c.isNone(t)||(A.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),A.supportsColorBufferFloatBlend=
null!==t.getExtension("EXT_float_blend"),A.supportsColorBufferHalfFloat=A.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float"));d=A}}return d}function g(A,t){if(A===r.ContextType.WEBGL1&&"undefined"===typeof WebGLRenderingContext||A===r.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const w=document.createElement("canvas");if(!w)return null;let u=r.createContext(w,A,{failIfMajorPerformanceCaveat:!0});c.isNone(u)&&(u=r.createContext(w,A),c.isSome(u)&&
(t.majorPerformanceCaveat=!0));if(c.isNone(u))return u;if(A===r.ContextType.WEBGL1){if(A=u.getParameter(u.VERSION)?.match(/^WebGL\s+([\d.]*)/))A=parseFloat(A[1]),t.available=.94<=A}else t.available=!0;t.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE);t.supportsVertexShaderSamplers=0<u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(A=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT))t.supportsHighPrecisionFragment=0<A.precision;return u}let h,d,f=function(){this.majorPerformanceCaveat=
this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},e=function(A){function t(){var w=A.apply(this,arguments)||this;w.type=r.ContextType.WEBGL1;return w}b._inheritsLoose(t,A);return t}(f),l=function(A){function t(){var w=
A.apply(this,arguments)||this;w.type=r.ContextType.WEBGL2;w.supportsElementIndexUint=!0;w.supportsStandardDerivatives=!0;w.supportsInstancedArrays=!0;w.supportsTextureFloat=!0;w.supportsTextureHalfFloat=!0;return w}b._inheritsLoose(t,A);return t}(f);a.getWebGL1Capabilities=n;a.getWebGL2Capabilities=p;a.getWebGLCapabilities=function(A){for(A=r.getContextTypes(A);1<A.length;){const t=m(A.shift());if(t.available)return t}return m(A.shift())};a.getWebGLVersionCapabilities=m;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,b,c,r,m,n,p){r=function(g){function h(d){d=g.call(this,d)||this;d.components=["attribution","zoom","navigation-toggle",
"compass"];return d}a._inheritsLoose(h,g);return h}(p);b.__decorate([c.property()],r.prototype,"components",void 0);return r=b.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],r)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){c=function(w){function u(y){y=w.call(this,y)||this;y._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};y.components=[];return y}a._inheritsLoose(u,w);var z=u.prototype;z.initialize=function(){this._handles.add([m.watch(()=>this.components,this._componentsWatcher.bind(this),m.initial),m.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),m.initial)])};z._add=function(y,B,C,k){if("string"===
typeof y&&this._defaultPositionLookup[y]){if(this._find(y))return;y=this._createComponent(y)}w.prototype._add.call(this,y,B,C,k)};z._removeComponents=function(y){y.forEach(B=>{if(B=this._find(B))this.remove(B),B.destroy()})};z._updateViewAwareWidgets=function(y){this.components.forEach(B=>{(B=(B=this._find(B))&&B.widget)&&void 0!==B.view&&(B.view=y)})};z._componentsWatcher=function(y,B){this._removeComponents(B);this._addComponents(y);this._adjustPadding(y)};z._adjustPadding=function(y){y.includes("attribution")||
this._isOverridden("padding")||({top:y}=this.padding,this.padding=y)};z._addComponents=function(y){this.constructed&&y.forEach(B=>this.add(this._createComponent(B),this._defaultPositionLookup[B]))};z._createComponent=function(y){const B=this._createWidget(y);if(B)return new d({id:y,node:B})};z._createWidget=function(y){if("attribution"===y)return this._createAttribution();if("compass"===y)return this._createCompass();if("navigation-toggle"===y)return this._createNavigationToggle();if("zoom"===y)return this._createZoom()};
z._createAttribution=function(){return new e({view:this.view})};z._createCompass=function(){return new l({view:this.view})};z._createNavigationToggle=function(){return new A({view:this.view})};z._createZoom=function(){return new t({view:this.view})};return u}(f);b.__decorate([n.property()],c.prototype,"components",void 0);return c=b.__decorate([h.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){c=function(h){function d(){var e=h.apply(this,arguments)||this;e.widget=null;return e}a._inheritsLoose(d,h);var f=d.prototype;f.destroy=function(){this.widget&&this.widget.destroy();this.node=null};f.castNode=function(e){if(!e)return this._set("widget",null),null;if("string"===typeof e||e&&"nodeType"in e)return this._set("widget",null),r.byId(e);e&&"function"===typeof e.render&&!e.domNode&&(e.domNode=document.createElement("div"));this._set("widget",e);return e.domNode};
a._createClass(d,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(e){const l=this._get("node");e!==l&&(e&&e.classList.add("esri-component"),l&&l.classList.remove("esri-component"),this._set("node",e))}}]);return d}(c);b.__decorate([m.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([m.property()],c.prototype,"node",null);b.__decorate([p.cast("node")],c.prototype,"castNode",null);b.__decorate([m.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([g.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(z){const y="object"===typeof z&&null!==z&&Object.getPrototypeOf(z);return null!==y&&y!==Object.prototype||!("component"in z||"index"in z||"position"in z)?null:z}function t(z,{top:y,bottom:B,left:C,right:k}){z.style.top=y;z.style.bottom=B;z.style.left=C;z.style.right=k}const w={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};r=function(z){function y(C){var k=z.call(this,C)||this;k._cornerNameToContainerLookup={};k._positionNameToContainerLookup=
{};k._components=[];k._componentToKey=new Map;k._handles=new m;k.view=null;k._applyViewPadding=()=>{const q=k.container;q&&t(q,k._toPxPosition(k._getViewPadding()))};k._applyUIPadding=()=>{const q=k._innerContainer;q&&t(q,k._toPxPosition(k.padding))};k._initContainers();return k}a._inheritsLoose(y,z);var B=y.prototype;B.initialize=function(){this._handles.add([n.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,n.initial),n.watch(()=>this.padding,this._applyUIPadding,n.initial)])};
B.destroy=function(){this.container=null;for(const C of this._components)C.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};B.castPadding=function(C){return"number"===typeof C?{bottom:C,top:C,right:C,left:C}:{...u,...C}};B.add=function(C,k){let q,x;if(Array.isArray(C))C.forEach(D=>this.add(D,k));else{var v=A(C);v&&({index:q,position:k,component:C,key:x}=v);k&&"object"===typeof k&&({index:q,key:x,position:k}=k);!C||k&&!this._isValidPosition(k)||this._add(C,
k,q,x)}};B.remove=function(C,k){if(C){if(Array.isArray(C))return C.map(v=>this.remove(v,k));var q=this._find(C);if(q){var x=this._componentToKey;if(!x.has(C)||x.get(C)===k)return x=this._components.indexOf(q),q.node.parentNode&&q.node.parentNode.removeChild(q.node),this._componentToKey.delete(C),this._components.splice(x,1)[0]}}};B.empty=function(C){if(Array.isArray(C))return C.map(k=>this.empty(k)).reduce((k,q)=>k.concat(q));C=C||"manual";return"manual"===C?Array.prototype.slice.call(this._manualContainer.children).filter(k=>
!k.classList.contains("esri-ui-corner")).map(k=>this.remove(k)):this._isValidPosition(C)?Array.prototype.slice.call(this._cornerNameToContainerLookup[C].children).map(this.remove,this):null};B.move=function(C,k){Array.isArray(C)&&C.forEach(v=>this.move(v,k));if(C){var q=A(C)||A(k);if(q){var x=q.index;k=q.position;C=q.component||C}(!k||this._isValidPosition(k))&&(C=this.remove(C))&&this.add(C,{position:k,index:x})}};B.find=function(C){return C?(C=this._findById(C))&&(C.widget||C.node):null};B.getPosition=
function(C){for(const k in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[k].contains(C))return k;return null};B._add=function(C,k,q,x){C instanceof e||(C=new e({node:C}));this._place({component:C,position:k,index:q});this._components.push(C);x&&this._componentToKey.set(C,x)};B._find=function(C){return C?C instanceof e?this._findByComponent(C):"string"===typeof C?this._findById(C):this._findByNode(C.domNode||C):null};B._getViewPadding=function(){return this.get("view.padding")||
w};B._attachContainers=function(C){C.appendChild(this._innerContainer);C.appendChild(this._manualContainer)};B._initContainers=function(){var C=document.createElement("div");C.classList.add("esri-ui-inner-container");C.classList.add("esri-ui-corner-container");const k=document.createElement("div");k.classList.add("esri-ui-inner-container");k.classList.add("esri-ui-manual-container");const q=document.createElement("div");q.classList.add("esri-ui-top-left");q.classList.add("esri-ui-corner");C.appendChild(q);
const x=document.createElement("div");x.classList.add("esri-ui-top-right");x.classList.add("esri-ui-corner");C.appendChild(x);const v=document.createElement("div");v.classList.add("esri-ui-bottom-left");v.classList.add("esri-ui-corner");C.appendChild(v);const D=document.createElement("div");D.classList.add("esri-ui-bottom-right");D.classList.add("esri-ui-corner");C.appendChild(D);this._innerContainer=C;this._manualContainer=k;C=l.isRTL();this._cornerNameToContainerLookup={"top-left":q,"top-right":x,
"bottom-left":v,"bottom-right":D,"top-leading":C?x:q,"top-trailing":C?q:x,"bottom-leading":C?D:v,"bottom-trailing":C?v:D};this._positionNameToContainerLookup={manual:k,...this._cornerNameToContainerLookup}};B._isValidPosition=function(C){return!!this._positionNameToContainerLookup[C]};B._place=function(C){const k=C.component,q=C.index;C=this._positionNameToContainerLookup[C.position||"manual"];var x=-1<q,v=k.widget;v&&!v._started&&"function"===typeof v.postMixInProperties&&"function"===typeof v.buildRendering&&
"function"===typeof v.postCreate&&"function"===typeof v.startup&&k.widget.startup();x?(x=Array.prototype.slice.call(C.children),0===q?C.firstChild?c.insertBefore(k.node,C.firstChild):C.appendChild(k.node):q>=x.length?C.appendChild(k.node):c.insertBefore(k.node,x[q])):C.appendChild(k.node)};B._toPxPosition=function(C){return{top:this._toPxUnit(C.top),left:this._toPxUnit(C.left),right:this._toPxUnit(C.right),bottom:this._toPxUnit(C.bottom)}};B._toPxUnit=function(C){return 0===C?"0":C+"px"};B._findByComponent=
function(C){let k=null,q;this._components.some(x=>{(q=x===C)&&(k=x);return q});return k};B._findById=function(C){let k=null,q;this._components.some(x=>{(q=x.id===C)&&(k=x);return q});return k};B._findByNode=function(C){let k=null,q;this._components.some(x=>{(q=x.node===C)&&(k=x);return q});return k};a._createClass(y,[{key:"container",set:function(C){const k=this._get("container");C!==k&&(C&&(C.classList.add("esri-ui"),f.setCalciteThemeClass(C),this._attachContainers(C)),k&&(k.classList.remove("esri-ui"),
t(k,{top:"",bottom:"",left:"",right:""}),c.empty(k)),this._set("container",C))}},{key:"height",get:function(){const C=this.get("view.height")||0;if(0===C)return C;const k=this._getViewPadding();return Math.max(C-(k.top+k.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(C){this._overrideIfSome("padding",C)}},{key:"width",get:function(){const C=this.get("view.width")||0;if(0===C)return C;const k=this._getViewPadding();return Math.max(C-(k.left+k.right),0)}}]);return y}(r.EventedAccessor);
b.__decorate([p.property()],r.prototype,"container",null);b.__decorate([p.property()],r.prototype,"height",null);b.__decorate([p.property({value:u})],r.prototype,"padding",null);b.__decorate([h.cast("padding")],r.prototype,"castPadding",null);b.__decorate([p.property()],r.prototype,"view",void 0);b.__decorate([p.property()],r.prototype,"width",null);return r=b.__decorate([d.subclass("esri.views.ui.UI")],r)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){m=function(A){function t(u,z){var y=A.call(this,u,z)||this;y._isOpen=!1;y._attributionTextOverflowed=!1;y._prevSourceNodeHeight=0;y._resizeObserver=new ResizeObserver(B=>B.forEach(({target:C})=>y._checkSourceTextOverflow(C)));y.iconClass="esri-icon-description";y.itemDelimiter=" | ";y.messages=null;y.viewModel=new h;return y}a._inheritsLoose(t,A);var w=t.prototype;w.initialize=function(){this.addHandles(c.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))};
w.destroy=function(){this._resizeObserver?.disconnect()};w.render=function(){return e.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};w.renderPoweredBy=function(){return e.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",e.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",
rel:"noreferrer"},"Esri"))};w.renderSourcesNode=function(){const u=this._isOpen,z=this._isInteractive,y=z?"0":"",{attributionText:B}=this;return e.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:u,["esri-interactive"]:z}),innerHTML:B,tabindex:y})};w._afterSourcesNodeCreate=function(u){this._prevSourceNodeHeight=u.clientWidth;this._resizeObserver.observe(u)};w._checkSourceTextOverflow=function(u){let z=
!1;const {clientHeight:y,clientWidth:B,scrollWidth:C}=u;u=C>B;const k=this._attributionTextOverflowed!==u;this._attributionTextOverflowed=u;k&&(z=!0);this._isOpen&&(u=y<this._prevSourceNodeHeight,this._prevSourceNodeHeight=y,u&&(this._isOpen=!1,z=!0));z&&this.scheduleRender()};w._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(t,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((u,
z)=>{u.includes(z.text)||u.push(z.text);return u},[]).join(this.itemDelimiter)}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(u){this._overrideIfSome("label",u)}},{key:"view",get:function(){return this.viewModel.view},set:function(u){this.viewModel.view=u}}]);return t}(g);b.__decorate([r.property()],m.prototype,"_isOpen",void 0);b.__decorate([r.property()],m.prototype,"_isInteractive",null);b.__decorate([r.property()],m.prototype,"_attributionTextOverflowed",void 0);
b.__decorate([r.property()],m.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([r.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],m.prototype,"attributionText",null);b.__decorate([r.property()],m.prototype,"iconClass",void 0);b.__decorate([r.property()],m.prototype,"itemDelimiter",void 0);b.__decorate([r.property()],m.prototype,"label",null);b.__decorate([r.property(),f.messageBundle("esri/widgets/Attribution/t9n/Attribution")],m.prototype,"messages",void 0);b.__decorate([r.property()],
m.prototype,"view",null);b.__decorate([r.property({type:h})],m.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],m.prototype,"_toggleState",null);return m=b.__decorate([p.subclass("esri.widgets.Attribution")],m)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(y,B){return y&&"copyright"in y&&(!B||"function"===typeof y.originOf&&"user"===y.originOf("copyright"))}function w(y,B){return y.length!==B.length||y.some((C,k)=>C.text!==B[k].text)}function u(y,B,C){C&&B&&(y.find(k=>k.layerView===B&&k.text===C)||y.push({text:C,layerView:B}))}const z=[];c=function(y){function B(k){var q=y.call(this,k)||this;q._clear=()=>{q._fetchedAttributionData.clear();q._pendingAttributions.clear();q.handles.remove("suspension");
q.notifyChange("state")};q._pendingAttributions=new Set;q._fetchedAttributionData=new Map;q.items=new m;q.view=null;q._allLayerViewsChange=x=>{q.handles.remove("suspension");const v=q.get("view.allLayerViews");v&&q.handles.add(v.map(D=>p.watch(()=>[D.suspended,D.layer?.attributionVisible],()=>q._updateAttributionItems())),"suspension");x&&x.removed&&x.removed.forEach(D=>{q._pendingAttributions.delete(D);q._fetchedAttributionData.delete(D)});q._updateAttributionItems()};q.handles.add([p.on(()=>q.view?.allLayerViews,
"change",x=>q._allLayerViewsChange(x),{onListenerAdd:()=>q._allLayerViewsChange(),onListenerRemove:q._clear}),p.when(()=>!0===q.view?.stationary,()=>q._updateAttributionItems())]);return q}a._inheritsLoose(B,y);var C=B.prototype;C.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};C._updateAttributionItems=function(){const k=this.get("view.allLayerViews");z.length=0;k?(k.forEach(q=>{if(!q.suspended&&q.layer?.attributionVisible){var x=
q.layer;if(t(x,"user"))u(z,q,x.copyright);else if(x.hasAttributionData)if(this._fetchedAttributionData.has(q)){var v=this._fetchedAttributionData.get(q);v?u(z,q,this._getDynamicAttribution(v,this.view,x)):t(x)&&u(z,q,x.copyright)}else this._fetchAttributionData(q);else(v=x.get("portalItem.accessInformation"))?u(z,q,v):u(z,q,x.copyright)}}),w(this.items,z)&&(this.items.removeAll(),this.items.addMany(z)),z.length=0,this.notifyChange("state")):this._clear()};C._fetchAttributionData=function(){var k=
a._asyncToGenerator(function*(q){if(!this._pendingAttributions.has(q)){this._pendingAttributions.add(q);var x=yield r.result(q.layer.fetchAttributionData());this._pendingAttributions.has(q)&&(x=x.ok?this._createContributionIndex(x.value,"bing-maps"===q.layer.type):null,this._pendingAttributions.delete(q),this._fetchedAttributionData.set(q,x));this._updateAttributionItems()}});return function(q){return k.apply(this,arguments)}}();C._createContributionIndex=function(k,q){k=k.contributors;const x={};
if(!k)return x;for(let G=0;G<k.length;G++){const J=k[G];var v=J.coverageAreas;if(!v)return;for(const L of v){var D=L.bbox,F=L.zoomMin-(q&&L.zoomMin?1:0);v=L.zoomMax-(q&&L.zoomMax?1:0);for(D={extent:l.geographicToWebMercator({xmin:D[1],ymin:D[0],xmax:D[3],ymax:D[2],spatialReference:A.WGS84}),attribution:J.attribution||"",score:null!=L.score?L.score:100,id:G};F<=v;F++)x[F]=x[F]||[],x[F].push(D)}}x.maxKey=Math.max.apply(null,Object.keys(x));return x};C._getDynamicAttribution=function(k,q,x){const {extent:v,
scale:D}=q;x=x.tileInfo.scaleToZoom(D);x=Math.min(k.maxKey,Math.round(x));if(!v||null==x||-1>=x)return"";k=k[x];const F=l.project(v.center.clone().normalize(),q.spatialReference),G={};return k?k.filter(J=>{const L=!G[J.id]&&F&&e.extentContainsPoint(J.extent,F);L&&(G[J.id]=!0);return L}).sort((J,L)=>L.score-J.score||J.objectId-L.objectId).map(J=>J.attribution).join(", "):""};a._createClass(B,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":
"disabled"}}]);return B}(n.HandleOwner);b.__decorate([g.property({readOnly:!0,type:m})],c.prototype,"items",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([g.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){r=function(l){function A(w,u){w=l.call(this,w,u)||this;w.iconClass="esri-icon-locate-circled";w.messages=null;w.viewModel=new g;return w}a._inheritsLoose(A,l);var t=A.prototype;t.reset=function(){return this.viewModel.reset()};t.render=function(){const {orientation:w,state:u}=this.viewModel;var z="disabled"===u,y="compass"===("rotation"===u?"rotation":"compass");const B=z?-1:0;z={["esri-disabled"]:z,["esri-interactive"]:!z};y={["esri-icon-compass"]:y,["esri-icon-dial"]:!y};
const {messages:C}=this;return f.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",z),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:B,"aria-label":C.reset,title:C.reset},f.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",y),styles:this._toRotationTransform(w)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},C.reset))};t._reset=function(){this.viewModel.reset()};t._toRotationTransform=function(w){return{transform:`rotateZ(${w.z}deg)`}};
a._createClass(A,[{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(w){this.viewModel.goToOverride=w}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(w){this._overrideIfSome("label",w)}},{key:"view",get:function(){return this.viewModel.view},set:function(w){this.viewModel.view=w}}]);return A}(p);b.__decorate([c.property()],r.prototype,"goToOverride",null);b.__decorate([c.property()],r.prototype,"iconClass",void 0);b.__decorate([c.property()],
r.prototype,"label",null);b.__decorate([c.property(),d.messageBundle("esri/widgets/Compass/t9n/Compass")],r.prototype,"messages",void 0);b.__decorate([c.property()],r.prototype,"view",null);b.__decorate([c.property({type:g})],r.prototype,"viewModel",void 0);b.__decorate([h.accessibleHandler()],r.prototype,"_reset",null);return r=b.__decorate([n.subclass("esri.widgets.Compass")],r)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){c=function(e){function l(t){t=e.call(this,t)||this;t._handles=new r;t.orientation={x:0,y:0,z:0};t.view=null;t._updateForCamera=t._updateForCamera.bind(a._assertThisInitialized(t));t._updateForRotation=t._updateForRotation.bind(a._assertThisInitialized(t));t._updateRotationWatcher=t._updateRotationWatcher.bind(a._assertThisInitialized(t));return t}a._inheritsLoose(l,e);var A=l.prototype;A.initialize=function(){this._handles.add(n.watch(()=>this.view,this._updateRotationWatcher,
n.initial))};A.destroy=function(){this._handles=m.removeMaybe(this._handles);this.view=null};A.reset=function(){if(this.get("view.ready")){var t={};"2d"===this.view.type?t.rotation=0:t.heading=0;this.callGoTo({target:t})}};A._updateForRotation=function(t){void 0!==t&&null!==t&&(this.orientation={z:t})};A._updateForCamera=function(t){t&&(this.orientation={x:0,y:0,z:-t.heading})};A._updateRotationWatcher=function(t){this._handles.removeAll();t&&this._handles.add("2d"===t.type?n.watch(()=>t?.rotation,
this._updateForRotation,n.initial):n.watch(()=>t?.camera,this._updateForCamera,n.initial))};a._createClass(l,[{key:"canShowNorth",get:function(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return l}(f.GoToMixin(c));b.__decorate([p.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([p.property()],c.prototype,"orientation",
void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([p.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){r=function(l){function A(w,u){w=l.call(this,w,u)||this;w.iconClass="esri-icon-pan2";w.messages=null;w.viewModel=new g;return w}a._inheritsLoose(A,l);var t=A.prototype;t.toggle=function(){return this.viewModel.toggle()};t.render=function(){const w="disabled"===this.get("viewModel.state");var u="pan"===this.get("viewModel.navigationMode");const z={["esri-navigation-toggle__button--active"]:u};u={["esri-navigation-toggle__button--active"]:!u};const y=w?-1:0,B=this.messages.toggle;
return f.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:w,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:y,"aria-label":B,title:B},f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",z)},f.tsx("span",{class:"esri-icon-pan"})),f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",u)},f.tsx("span",{class:"esri-icon-rotate"})))};t._toggle=function(){this.toggle()};a._createClass(A,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(w){this._overrideIfSome("label",w)}},{key:"layout",set:function(w){"horizontal"!==w&&(w="vertical");this._set("layout",w)}},{key:"view",get:function(){return this.viewModel.view},set:function(w){this.viewModel.view=w}}]);return A}(p);b.__decorate([c.property()],r.prototype,"iconClass",
void 0);b.__decorate([c.property()],r.prototype,"label",null);b.__decorate([c.property({value:"vertical"})],r.prototype,"layout",null);b.__decorate([c.property(),d.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],r.prototype,"messages",void 0);b.__decorate([c.property()],r.prototype,"view",null);b.__decorate([c.property({type:g})],r.prototype,"viewModel",void 0);b.__decorate([h.accessibleHandler()],r.prototype,"_toggle",null);return r=b.__decorate([n.subclass("esri.widgets.NavigationToggle")],
r)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){c=function(h){function d(e){e=h.call(this,e)||this;e.navigationMode="pan";e.view=null;return e}a._inheritsLoose(d,h);var f=
d.prototype;f.initialize=function(){this.own(r.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))};f.destroy=function(){this.view=null};f.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};f._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(d,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?
"ready":"disabled"}}]);return d}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([m.property()],c.prototype,"navigationMode",void 0);b.__decorate([m.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.NavigationToggleViewModel")],c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){m=function(A){function t(u,z){u=A.call(this,u,z)||this;u.iconClass="esri-icon-zoom-in-magnifying-glass";u.messages=null;u.viewModel=new l;return u}a._inheritsLoose(t,A);var w=t.prototype;w.initialize=function(){this._zoomInButton=new e({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new e({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};w.destroy=function(){this._zoomInButton=c.destroyMaybe(this._zoomInButton);this._zoomOutButton=
c.destroyMaybe(this._zoomOutButton)};w.render=function(){const u={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:z,canZoomOut:y}=this.viewModel;this._zoomInButton.enabled=z;this._zoomOutButton.enabled=y;const {zoomIn:B,zoomOut:C}=this.messages;this._zoomInButton.title=B;this._zoomOutButton.title=C;return f.tsx("div",{class:this.classes("esri-zoom esri-widget",u)},this._zoomInButton.render(),this._zoomOutButton.render())};w.zoomIn=function(){return this.viewModel.zoomIn()};w.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(t,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(u){this._overrideIfSome("label",u)}},{key:"layout",set:function(u){"horizontal"!==u&&(u="vertical");this._set("layout",u)}},{key:"view",get:function(){return this.viewModel.view},set:function(u){this.viewModel.view=u}}]);return t}(g);b.__decorate([r.property()],m.prototype,"iconClass",void 0);b.__decorate([r.property()],m.prototype,"label",null);b.__decorate([r.property({value:"vertical"})],
m.prototype,"layout",null);b.__decorate([r.property(),d.messageBundle("esri/widgets/Zoom/t9n/Zoom")],m.prototype,"messages",void 0);b.__decorate([r.property()],m.prototype,"view",null);b.__decorate([r.property({type:l})],m.prototype,"viewModel",void 0);return m=b.__decorate([p.subclass("esri.widgets.Zoom")],m)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){r=function(f){function e(){var A=f.apply(this,arguments)||this;A.enabled=!0;A.iconClass="";A.title="";return A}a._inheritsLoose(e,f);var l=e.prototype;l.render=function(){const A=this.enabled?0:-1,t={[this.iconClass]:!!this.iconClass};return h.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:A,title:this.title},
h.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",t)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};l._triggerAction=function(){this.action.call(this)};return e}(p);b.__decorate([c.property()],r.prototype,"action",void 0);b.__decorate([c.property()],r.prototype,"enabled",void 0);b.__decorate([c.property()],r.prototype,"iconClass",void 0);b.__decorate([c.property()],r.prototype,"title",void 0);b.__decorate([g.accessibleHandler()],r.prototype,
"_triggerAction",null);return r=b.__decorate([n.subclass("esri.widgets.IconButton")],r)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){c=
function(e){function l(t){return e.call(this,t)||this}a._inheritsLoose(l,e);var A=l.prototype;A.destroy=function(){this.view=null};A.zoomIn=function(){if(this.canZoomIn){var t=this.view;"2d"===t.type?t.mapViewNavigation.zoomIn():m.ignoreAbortErrors(t.goTo({zoomFactor:2}))}};A.zoomOut=function(){if(this.canZoomOut){var t=this.view;"2d"===t.type?t.mapViewNavigation.zoomOut():m.ignoreAbortErrors(t.goTo({zoomFactor:.5}))}};a._createClass(l,[{key:"canZoomIn",get:function(){return r.isSome(this._zoomConditions)&&
this._zoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){return r.isSome(this._zoomConditions)&&this._zoomConditions?.canZoomOut}},{key:"state",get:function(){return this.view?.ready?"ready":"disabled"}},{key:"view",set:function(t){t?"2d"===t.type?this._zoomConditions=new d({view:t}):"3d"===t.type&&(this._zoomConditions=new f({view:t})):this._zoomConditions=null;this._set("view",t)}}]);return l}(c);b.__decorate([n.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([n.property()],
c.prototype,"canZoomIn",null);b.__decorate([n.property()],c.prototype,"canZoomOut",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([n.property()],c.prototype,"view",null);return c=b.__decorate([h.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p){c=function(g){function h(){return g.apply(this,arguments)||this}a._inheritsLoose(h,g);a._createClass(h,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),f=this.get("view.constraints.effectiveMaxScale");return 0===f||d>f}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),f=this.get("view.constraints.effectiveMinScale");
return 0===f||d<f}}]);return h}(c);b.__decorate([r.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([r.property()],c.prototype,"view",void 0);return c=b.__decorate([p.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p){c=function(g){function h(){return g.apply(this,arguments)||this}a._inheritsLoose(h,g);a._createClass(h,[{key:"canZoomIn",get:function(){return!!this.view.ready}},{key:"canZoomOut",get:function(){return!!this.view.ready}}]);return h}(c);b.__decorate([r.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([r.property()],c.prototype,"view",void 0);return c=b.__decorate([p.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/featureFlags ../support/popupUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba,ia,ma,ha,ka,Z,ca,fa,ea,da,la,oa){const ra=["3DObject","Point"];n=R.defineFieldProperties();C=function(za){function va(...pa){pa=za.call(this,...pa)||this;pa.featureReduction=null;pa.rangeInfos=null;pa.operationalLayerType="ArcGISSceneServiceLayer";pa.type="scene";pa.fields=null;pa.floorInfo=null;pa.outFields=null;pa.nodePages=null;pa.materialDefinitions=null;pa.textureSetDefinitions=null;pa.geometryDefinitions=
null;pa.serviceUpdateTimeStamp=null;pa.excludeObjectIds=new u;pa.definitionExpression=null;pa.filter=null;pa.path=null;pa.labelsVisible=!0;pa.labelingInfo=null;pa.legendEnabled=!0;pa.priority=null;pa.semantic=null;pa.cachedDrawingInfo={color:!1};pa.popupEnabled=!0;pa.popupTemplate=null;pa.objectIdField=null;pa.globalIdField=null;pa._fieldUsageInfo={};pa.screenSizePerspectiveEnabled=!0;return pa}b._inheritsLoose(va,za);var Ja=va.prototype;Ja.normalizeCtorArgs=function(pa,Ba){return"string"===typeof pa?
{url:pa,...Ba}:pa};Ja.getField=function(pa){return this.fieldsIndex.get(pa)};Ja.getFieldDomain=function(pa,Ba){return(Ba=this.getFeatureType(Ba?.feature)?.domains?.[pa])&&"inherited"!==Ba.type?Ba:this.getField(pa)?.domain??null};Ja.getFeatureType=function(pa){return null!=pa&&B.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(pa):null};Ja.readNodePages=function(pa,Ba,Ha){"Point"===Ba.layerType&&(pa=Ba.pointNodePages);return null==pa||"object"!==typeof pa?null:aa.I3SNodePageDefinition.fromJSON(pa,
Ha)};Ja.readCachedDrawingInfo=function(pa){if(null==pa||"object"!==typeof pa)pa={};null==pa.color&&(pa.color=!1);return pa};Ja.readObjectIdField=function(pa,Ba){!pa&&Ba.fields&&Ba.fields.some(Ha=>{"esriFieldTypeOID"===Ha.type&&(pa=Ha.name);return!!pa});return pa||void 0};Ja.readGlobalIdField=function(pa,Ba){!pa&&Ba.fields&&Ba.fields.some(Ha=>{"esriFieldTypeGlobalID"===Ha.type&&(pa=Ha.name);return!!pa});return pa||void 0};Ja.readProfile=function(pa,Ba){pa=Ba.store.profile;if(null!=pa&&Aa[pa])return Aa[pa];
y.getLogger(this.declaredClass).error("Unknown or missing profile",{profile:pa,layer:this});return"mesh-pyramids"};Ja.load=function(pa){const Ba=B.isSome(pa)?pa.signal:null,Ha=this.loadFromPortal({supportedTypes:["Scene Service"]},pa).catch(k.throwIfAbortError).then(()=>this._fetchService(Ba)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Ba),this._setAssociatedFeatureLayer(Ba),B.isSome(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>
this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>Z.loadStyleRenderer(this,{origin:"service"},Ba)).then(()=>W.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(pa));this.addResolvingPromise(Ha);return Promise.resolve(this)};Ja.beforeSave=function(){var pa=b._asyncToGenerator(function*(){B.isSome(this.filter)&&(yield this.load())});return function(){return pa.apply(this,arguments)}}();Ja.createQuery=function(){const pa=
new ca;"mesh"!==this.geometryType&&(pa.returnGeometry=!0,pa.returnZ=!0);pa.where=this.definitionExpression||"1\x3d1";pa.sqlFormat="standard";return pa};Ja.queryExtent=function(pa,Ba){return this._getAssociatedLayerForQuery().then(Ha=>Ha.queryExtent(pa||this.createQuery(),Ba))};Ja.queryFeatureCount=function(pa,Ba){return this._getAssociatedLayerForQuery().then(Ha=>Ha.queryFeatureCount(pa||this.createQuery(),Ba))};Ja.queryFeatures=function(pa,Ba){return this._getAssociatedLayerForQuery().then(Ha=>Ha.queryFeatures(pa||
this.createQuery(),Ba)).then(Ha=>{if(Ha?.features)for(const wa of Ha.features)wa.layer=this,wa.sourceLayer=this;return Ha})};Ja.queryCachedAttributes=function(){var pa=b._asyncToGenerator(function*(Ba,Ha){const wa=W.unpackFieldNames(this.fieldsIndex,yield la.getRequiredFields(this,la.getFetchPopupTemplate(this)));return da.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo,Ba,Ha,wa)});return function(Ba,Ha){return pa.apply(this,arguments)}}();Ja.queryCachedFeature=
function(){var pa=b._asyncToGenerator(function*(Ba,Ha){Ba=yield this.queryCachedAttributes(Ba,[Ha]);if(!Ba||0===Ba.length)throw new z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Ha=new r;Ha.attributes=Ba[0];Ha.layer=this;Ha.sourceLayer=this;return Ha});return function(Ba,Ha){return pa.apply(this,arguments)}}();Ja.queryObjectIds=function(pa,Ba){return this._getAssociatedLayerForQuery().then(Ha=>Ha.queryObjectIds(pa||this.createQuery(),Ba))};Ja.queryAttachments=function(pa,
Ba){return this._getAssociatedLayerForQuery().then(Ha=>Ha.queryAttachments(pa,Ba))};Ja.getFieldUsageInfo=function(pa){const Ba={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[pa]||Ba:(y.getLogger(this.declaredClass).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Ba)};Ja.createPopupTemplate=function(pa){return ea.createPopupTemplate(this,pa)};Ja._getAssociatedLayerForQuery=function(){const pa=this.associatedLayer;
return B.isSome(pa)&&pa.loaded?Promise.resolve(pa):this._loadAssociatedLayerForQuery()};Ja._loadAssociatedLayerForQuery=function(){var pa=b._asyncToGenerator(function*(){yield this.load();if(B.isNone(this.associatedLayer))throw new z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(Ba){throw new z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",
{layer:this,error:Ba});}return this.associatedLayer});return function(){return pa.apply(this,arguments)}}();Ja.hasCachedStatistics=function(pa){return null!=this.statisticsInfo&&this.statisticsInfo.some(Ba=>Ba.name===pa)};Ja.queryCachedStatistics=function(){var pa=b._asyncToGenerator(function*(Ba,Ha){yield this.load(Ha);if(!this.statisticsInfo)throw new z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const wa=this.fieldsIndex.get(Ba);if(!wa)throw new z("scenelayer:field-unexisting",
`Field '${Ba}' does not exist on the layer`);for(const ya of this.statisticsInfo)if(ya.name===wa.name)return Ba=x.join(this.parsedUrl.path,ya.href),w(Ba,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Ha?Ha.signal:null}).then(Na=>Na.data);throw new z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(Ba,Ha){return pa.apply(this,arguments)}}();Ja.saveAs=function(){var pa=b._asyncToGenerator(function*(Ba,Ha){return this._debouncedSaveOperations(Q.SaveOperationType.SAVE_AS,
{...Ha,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Ba)});return function(Ba,Ha){return pa.apply(this,arguments)}}();Ja.save=function(){var pa=b._asyncToGenerator(function*(){return this._debouncedSaveOperations(Q.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return pa.apply(this,arguments)}}();Ja.applyEdits=function(){var pa=b._asyncToGenerator(function*(Ba,Ha){const wa=yield new Promise((ya,Na)=>
a(["./graphics/editingSupport"],ya,Na));yield this.load();if(B.isNone(this.associatedLayer))throw new z(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return wa.applyEdits(this,this.associatedLayer.source,Ba,Ha)});return function(Ba,Ha){return pa.apply(this,arguments)}}();Ja.on=function(pa,Ba){return za.prototype.on.call(this,pa,Ba)};Ja.validateLayer=function(pa){if(pa.layerType&&!ra.includes(pa.layerType))throw new z("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:pa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});pa=this.normalReferenceFrame;var Ba=this.spatialReference;
let Ha=!1,wa=!1;if(null==pa)wa=Ha=!0;else switch(Ba=Ba&&Ba.isGeographic,pa){case "east-north-up":case "earth-centered":Ha=!0;wa=Ba;break;case "vertex-reference-frame":Ha=!0;wa=!Ba;break;default:Ha=!1}if(!Ha)throw new z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!wa)throw new z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};Ja._getTypeKeywords=function(){const pa=[];if("points"===
this.profile)pa.push("Point");else if("mesh-pyramids"===this.profile)pa.push("3DObject");else throw new z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return pa};Ja._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const pa of this.fields){const Ba=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(wa=>wa.name===pa.name)),Ha=!!(B.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(wa=>
wa&&pa.name===wa.name));this._fieldUsageInfo[pa.name]={supportsLabelingInfo:Ba,supportsRenderer:Ba,supportsPopupTemplate:Ba||Ha,supportsLayerQuery:Ha}}};Ja._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};Ja._applyAssociatedLayerFieldsOverrides=function(){if(!B.isNone(this.associatedLayer)&&this.associatedLayer.fields){var pa=null;for(const Ba of this.associatedLayer.fields){const Ha=this.getField(Ba.name);Ha?(!Ha.domain&&
Ba.domain&&(Ha.domain=Ba.domain.clone()),Ha.editable=Ba.editable,Ha.nullable=Ba.nullable,Ha.length=Ba.length):(pa||(pa=this.fields?this.fields.slice():[]),pa.push(Ba.clone()))}pa&&this._set("fields",pa)}};Ja._applyAssociatedLayerPopupOverrides=function(){if(!B.isNone(this.associatedLayer)){var pa=["popupTemplate","popupEnabled"],Ba=F.getProperties(this);for(let Ha=0;Ha<pa.length;Ha++){const wa=pa[Ha],ya=this.originIdOf(wa),Na=this.associatedLayer.originIdOf(wa);ya<Na&&(Na===K.OriginId.SERVICE||Na===
K.OriginId.PORTAL_ITEM)&&Ba.setAtOrigin(wa,this.associatedLayer[wa],Na)}}};Ja._setAssociatedFeatureLayer=function(){var pa=b._asyncToGenerator(function*(Ba){if(["mesh-pyramids","points"].includes(this.profile)){Ba=new V.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Ba);try{this.associatedLayer=yield Ba.fetch()}catch(Ha){k.isAbortError(Ha)||this._logWarningOnPopupEnabled()}}});return function(Ba){return pa.apply(this,arguments)}}();Ja._logWarningOnPopupEnabled=function(){var pa=
b._asyncToGenerator(function*(){yield q.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const Ba=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?y.getLogger(this.declaredClass).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Ba}`):y.getLogger(this.declaredClass).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Ba}`)});return function(){return pa.apply(this,arguments)}}();
Ja._validateElevationInfo=function(){const pa=this.elevationInfo;pa&&("mesh-pyramids"===this.profile&&"relative-to-scene"===pa.mode&&y.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Mesh scene layers don't support relative-to-scene elevation mode"),pa.featureExpressionInfo&&"0"!==pa.featureExpressionInfo.expression&&y.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};b._createClass(va,[{key:"types",get:function(){return B.isSome(this.associatedLayer)?
this.associatedLayer.types??[]:[]}},{key:"typeIdField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",get:function(){return new X(this.fields)}},{key:"elevationInfo",set:function(pa){this._set("elevationInfo",pa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return ua[this.profile]||"mesh"}},
{key:"renderer",set:function(pa){W.fixRendererFields(pa,this.fieldsIndex);this._set("renderer",pa)}},{key:"capabilities",get:function(){var pa=B.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:T.zeroCapabilities;const {query:Ba,editing:{supportsGlobalId:Ha,supportsRollbackOnFailure:wa,supportsUploadWithItemId:ya,supportsReturnServiceEditsInSourceSpatialReference:Na},data:{supportsZ:Ra,supportsM:Sa,isVersioned:ja,supportsAttachment:Ta},operations:{supportsEditing:qa,
supportsAdd:Ea,supportsUpdate:Oa,supportsDelete:Va,supportsQuery:Ua,supportsQueryAttachments:La}}=pa;pa=pa.operations.supportsChangeTracking;const ta=fa.sceneLayerEditingEnabled();return{query:Ba,editing:{supportsGlobalId:Ha,supportsReturnServiceEditsInSourceSpatialReference:Na,supportsRollbackOnFailure:wa,supportsGeometryUpdate:!1,supportsUploadWithItemId:ya},data:{supportsAttachment:Ta,supportsZ:Ra,supportsM:Sa,isVersioned:ja},operations:{supportsQuery:Ua,supportsQueryAttachments:La,supportsEditing:qa&&
pa,supportsAdd:ta&&Ea&&pa,supportsDelete:ta&&Va&&pa,supportsUpdate:Oa&&pa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(pa){this._overrideIfSome("editingEnabled",pa)}},{key:"infoFor3D",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.infoFor3D:null}},{key:"defaultPopupTemplate",get:function(){return B.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():
null}},{key:"displayField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return va}(H.EditBusLayer(Q.SceneService(N.ArcGISService(E.OperationalLayer(I.PortalLayer(M.ScaleRangeLayer(C.MultiOriginJSONMixin(P.APIKeyMixin(O)))))))));c.__decorate([v.property({types:{key:"type",base:U.FeatureReduction,typeMap:{selection:Y}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",
write:!0}}}})],C.prototype,"featureReduction",void 0);c.__decorate([v.property({type:[ha.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],C.prototype,"rangeInfos",void 0);c.__decorate([v.property({json:{read:!1}})],C.prototype,"associatedLayer",void 0);c.__decorate([v.property({type:["show","hide"]})],C.prototype,"listMode",void 0);c.__decorate([v.property({type:["ArcGISSceneServiceLayer"]})],
C.prototype,"operationalLayerType",void 0);c.__decorate([v.property({json:{read:!1},readOnly:!0})],C.prototype,"type",void 0);c.__decorate([v.property({...n.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],C.prototype,"fields",void 0);c.__decorate([v.property()],C.prototype,"types",null);c.__decorate([v.property()],C.prototype,"typeIdField",null);c.__decorate([v.property()],C.prototype,"formTemplate",null);c.__decorate([v.property({readOnly:!0})],C.prototype,"fieldsIndex",null);c.__decorate([v.property({type:ma,
json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],C.prototype,"floorInfo",void 0);c.__decorate([v.property(n.outFields)],C.prototype,"outFields",void 0);c.__decorate([v.property({type:aa.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],C.prototype,"nodePages",void 0);c.__decorate([J.reader("service","nodePages",["nodePages","pointNodePages"])],C.prototype,"readNodePages",null);c.__decorate([v.property({type:[aa.I3SMaterialDefinition],readOnly:!0})],
C.prototype,"materialDefinitions",void 0);c.__decorate([v.property({type:[aa.I3STextureSetDefinition],readOnly:!0})],C.prototype,"textureSetDefinitions",void 0);c.__decorate([v.property({type:[aa.I3SGeometryDefinition],readOnly:!0})],C.prototype,"geometryDefinitions",void 0);c.__decorate([v.property({readOnly:!0})],C.prototype,"serviceUpdateTimeStamp",void 0);c.__decorate([v.property({readOnly:!0})],C.prototype,"attributeStorageInfo",void 0);c.__decorate([v.property({readOnly:!0})],C.prototype,"statisticsInfo",
void 0);c.__decorate([v.property({type:u.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],C.prototype,"excludeObjectIds",void 0);c.__decorate([v.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],C.prototype,"definitionExpression",void 0);c.__decorate([v.property({type:ka,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,
allowNull:!0},origins:{service:{read:!1,write:!1}}}})],C.prototype,"filter",void 0);c.__decorate([v.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],C.prototype,"path",void 0);c.__decorate([v.property(S.elevationInfo)],C.prototype,"elevationInfo",null);c.__decorate([v.property({type:String})],C.prototype,"geometryType",null);c.__decorate([v.property(S.labelsVisible)],C.prototype,"labelsVisible",void 0);c.__decorate([v.property({type:[ba],json:{origins:{service:{name:"drawingInfo.labelingInfo",
read:{reader:ia.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ia.reader},write:!0}})],C.prototype,"labelingInfo",void 0);c.__decorate([v.property(S.legendEnabled)],C.prototype,"legendEnabled",void 0);c.__decorate([v.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(za,va){if("number"===
typeof za&&0<=za&&1>=za)return za;za=va.layerDefinition?.drawingInfo?.transparency;return void 0!==za?oa.transparencyToOpacity(za):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],C.prototype,"opacity",void 0);c.__decorate([v.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],C.prototype,"priority",void 0);c.__decorate([v.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],C.prototype,"semantic",void 0);c.__decorate([v.property({types:t.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],C.prototype,"renderer",null);c.__decorate([v.property({json:{read:!1}})],C.prototype,"cachedDrawingInfo",void 0);c.__decorate([J.reader("service","cachedDrawingInfo")],C.prototype,"readCachedDrawingInfo",null);c.__decorate([v.property({readOnly:!0,json:{read:!1}})],C.prototype,"capabilities",null);c.__decorate([v.property({type:Boolean,json:{read:!1}})],C.prototype,"editingEnabled",
null);c.__decorate([v.property({readOnly:!0,json:{write:!1,read:!1}})],C.prototype,"infoFor3D",null);c.__decorate([v.property(S.popupEnabled)],C.prototype,"popupEnabled",void 0);c.__decorate([v.property({type:m,json:{name:"popupInfo",write:!0}})],C.prototype,"popupTemplate",void 0);c.__decorate([v.property({readOnly:!0,json:{read:!1}})],C.prototype,"defaultPopupTemplate",null);c.__decorate([v.property({type:String,json:{read:!1}})],C.prototype,"objectIdField",void 0);c.__decorate([J.reader("service",
"objectIdField",["objectIdField","fields"])],C.prototype,"readObjectIdField",null);c.__decorate([v.property({type:String,json:{read:!1}})],C.prototype,"globalIdField",void 0);c.__decorate([J.reader("service","globalIdField",["globalIdField","fields"])],C.prototype,"readGlobalIdField",null);c.__decorate([v.property({readOnly:!0,type:String,json:{read:!1}})],C.prototype,"displayField",null);c.__decorate([v.property({type:String,json:{read:!1}})],C.prototype,"profile",void 0);c.__decorate([J.reader("service",
"profile",["store.profile"])],C.prototype,"readProfile",null);c.__decorate([v.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],C.prototype,"normalReferenceFrame",void 0);c.__decorate([v.property(S.screenSizePerspectiveEnabled)],C.prototype,"screenSizePerspectiveEnabled",void 0);C=c.__decorate([L.subclass("esri.layers.SceneLayer")],C);const Aa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",
points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ua={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return C})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F){const G=g.getLogger("esri.layers.mixins.SceneService");var J;(function(K){K[K.existingItem=0]="existingItem";K[K.newItem=1]="newItem"})(J||(J={}));const L={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};b.SaveOperationType=void 0;(function(K){K[K.SAVE=0]="SAVE";K[K.SAVE_AS=1]="SAVE_AS"})(b.SaveOperationType||(b.SaveOperationType={}));b.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";b.SceneService=K=>{K=function(O){function P(){var H=O.apply(this,arguments)||this;H.spatialReference=null;H.fullExtent=null;H.heightModelInfo=null;H.minScale=0;H.maxScale=0;H.version={major:Number.NaN,minor:Number.NaN,versionString:""};H.copyright=null;H.sublayerTitleMode="item-title";H.title=null;H.layerId=null;H.indexInfo=null;H._debouncedSaveOperations=d.debounce(function(){var E=c._asyncToGenerator(function*(I,M,Q){switch(I){case b.SaveOperationType.SAVE:return H._save(M);case b.SaveOperationType.SAVE_AS:return H._saveAs(Q,
M)}});return function(I,M,Q){return E.apply(this,arguments)}}());return H}c._inheritsLoose(P,O);var N=P.prototype;N.readSpatialReference=function(H,E){return this._readSpatialReference(E)};N._readSpatialReference=function(H){if(null!=H.spatialReference)return C.fromJSON(H.spatialReference);H=H.store;H=(H=H.indexCRS||H.geographicCRS)&&parseInt(H.substring(H.lastIndexOf("/")+1,H.length),10);return null!=H?new C(H):null};N.readFullExtent=function(H,E,I){if(null!=H&&"object"===typeof H)return E=null==
H.spatialReference?{...H,spatialReference:this._readSpatialReference(E)}:H,y.fromJSON(E,I);I=E.store;E=this._readSpatialReference(E);return null==E||null==I||null==I.extent||!Array.isArray(I.extent)||I.extent.some(M=>-1E38>M)?null:new y({xmin:I.extent[0],ymin:I.extent[1],xmax:I.extent[2],ymax:I.extent[3],spatialReference:E})};N.parseVersionString=function(H){const E={major:Number.NaN,minor:Number.NaN,versionString:H};H=H.split(".");2<=H.length&&(E.major=parseInt(H[0],10),E.minor=parseInt(H[1],10));
return E};N.readVersion=function(H,E){H=E.store;return this.parseVersionString(null!=H.version?H.version.toString():"")};N.readTitlePortalItem=function(H){return"item-title"!==this.sublayerTitleMode?void 0:H};N.readTitleService=function(H,E){H=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return k.titleFromUrlAndName(this.url,E.name);E=E.name;if(!E&&this.url){const I=k.parse(this.url);h.isSome(I)&&(E=I.title)}"item-title-and-service-name"===this.sublayerTitleMode&&
H&&(E=H+" - "+E);return k.cleanTitle(E)};N.writeUrl=function(H,E,I,M){k.writeUrlWithLayerId(this,H,"layers",E,M)};N._fetchIndexAndUpdateExtent=function(){var H=c._asyncToGenerator(function*(E,I){this.indexInfo=x.fetchIndexInfo(this.parsedUrl.path,this.rootNode,E,this.apiKey,G,I);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(E,I){return H.apply(this,arguments)}}();N._updateExtent=function(H){if("page"===H?.type){var E=H.rootIndex%H.pageSize;
E=H.rootPage?.nodes?.[E];if(null==E||null==E.obb||null==E.obb.center||null==E.obb.halfSize)throw new n("sceneservice:invalid-node-page","Invalid node page.");-1E38>E.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(H=E.obb.halfSize,E=E.obb.center[2],H=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]),this.fullExtent.zmin=E-H,this.fullExtent.zmax=E+H)}else if("node"===H?.type&&(E=H.rootNode?.mbs,Array.isArray(E)&&4===E.length&&!(-1E38>E[0]))){H=E[2];E=E[3];var {fullExtent:I}=this;I&&(I.zmin=H-E,
I.zmax=H+E)}};N._fetchService=function(){var H=c._asyncToGenerator(function*(E){if(null==this.url)throw new n("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const I=yield this._fetchFirstLayerId(E);null!=I&&(this.layerId=I)}return this._fetchServiceLayer(E)});return function(E){return H.apply(this,arguments)}}();N._fetchFirstLayerId=function(){var H=c._asyncToGenerator(function*(E){E=yield m(this.url,
{query:{f:"json",token:this.apiKey},responseType:"json",signal:E});if(E.data&&Array.isArray(E.data.layers)&&0<E.data.layers.length)return E.data.layers[0].id});return function(E){return H.apply(this,arguments)}}();N._fetchServiceLayer=function(){var H=c._asyncToGenerator(function*(E){E=yield m(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:E});E.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let I=!1;E.data.layerType&&"Voxel"===E.data.layerType&&(I=!0);
if(I)return this._fetchVoxelServiceLayer();E=E.data;this.read(E,{origin:"service",url:this.parsedUrl});this.validateLayer(E)});return function(E){return H.apply(this,arguments)}}();N._fetchVoxelServiceLayer=function(){var H=c._asyncToGenerator(function*(E){E=(yield m(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:E})).data;this.read(E,{origin:"service",url:this.parsedUrl});this.validateLayer(E)});return function(E){return H.apply(this,arguments)}}();N._ensureLoadBeforeSave=
function(){var H=c._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return H.apply(this,arguments)}}();N.validateLayer=function(H){};N._updateTypeKeywords=function(H,E,I){H.typeKeywords||(H.typeKeywords=[]);E=E.getTypeKeywords();for(const M of E)H.typeKeywords.push(M);H.typeKeywords&&(H.typeKeywords=H.typeKeywords.filter((M,Q,T)=>T.indexOf(M)===Q),I===J.newItem&&(H.typeKeywords=H.typeKeywords.filter(M=>
"Hosted Service"!==M)))};N._saveAs=function(){var H=c._asyncToGenerator(function*(E,I){I={...L,...I};E=D.from(E);E||(G.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new n("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));E.id&&(E=E.clone(),E.id=null);const M=E.portal||v.getDefault();yield this._ensureLoadBeforeSave();E.type="Scene Service";E.portal=M;const Q={origin:"portal-item",url:null,messages:[],portal:M,portalItem:E,writtenProperties:[],
blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},T={layers:[this.write({},Q)]};yield Promise.all(Q.resources?.pendingOperations??[]);yield this._validateAgainstJSONSchema(T,Q,I);E.url=this.url;E.title||(E.title=this.title);this._updateTypeKeywords(E,I,J.newItem);yield M._signIn();yield M.user?.addItem({item:E,folder:I&&I.folder,data:T});yield F.saveResources(this.resourceReferences,Q,null);this.portalItem=E;z.updateOrigins(Q);return Q.portalItem=E});return function(E,
I){return H.apply(this,arguments)}}();N._save=function(){var H=c._asyncToGenerator(function*(E){E={...L,...E};if(!this.portalItem)throw G.error("_save(): requires the .portalItem property to be set"),new n("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if("Scene Service"!==this.portalItem.type)throw G.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),new n("sceneservice:portal-item-wrong-type",
'Portal item needs to have type "Scene Service"');yield this._ensureLoadBeforeSave();const I={origin:"portal-item",url:this.portalItem.itemUrl&&f.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||v.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},M={layers:[this.write({},I)]};yield Promise.all(I.resources?.pendingOperations??[]);yield this._validateAgainstJSONSchema(M,
I,E);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,E,J.existingItem);yield this.portalItem.update({data:M});yield F.saveResources(this.resourceReferences,I,null);z.updateOrigins(I);return this.portalItem});return function(E){return H.apply(this,arguments)}}();N._validateAgainstJSONSchema=function(){var H=c._asyncToGenerator(function*(E,I,M){I=I.messages?.filter(Q=>"error"===Q.type).map(Q=>new n(Q.name,Q.message,Q.details))??
[];M&&M.validationOptions?.ignoreUnsupported&&(I=I.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));if(M.validationOptions?.enabled&&(E=(yield new Promise((Q,T)=>a(["../support/schemaValidator"],Q,T))).validate(E,M.portalItemLayerType),0<E.length)){const Q=`Layer item did not validate:\n${E.join("\n")}`;G.error(`_validateAgainstJSONSchema(): ${Q}`);
if("throw"===M.validationOptions?.failPolicy)throw M=E.map(T=>new n("sceneservice:schema-validation",T)).concat(I),new n("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:M});}if(0<I.length)throw new n("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:I});});return function(E,I,M){return H.apply(this,arguments)}}();c._createClass(P,[{key:"url",
set:function(H){H=k.sanitizeUrlWithLayerId({layer:this,url:H,nonStandardUrlAllowed:!1,logger:G});this._set("url",H.url);null!=H.layerId&&this._set("layerId",H.layerId)}},{key:"parsedUrl",get:function(){var H=this._get("url");H=f.urlToObject(H);null!=this.layerId&&(H.path=`${H.path}/layers/${this.layerId}`);return H}}]);return P}(K);r.__decorate([e.property(q.id)],K.prototype,"id",void 0);r.__decorate([e.property({type:C})],K.prototype,"spatialReference",void 0);r.__decorate([t.reader("spatialReference",
["spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readSpatialReference",null);r.__decorate([e.property({type:y})],K.prototype,"fullExtent",void 0);r.__decorate([t.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readFullExtent",null);r.__decorate([e.property({readOnly:!0,type:B})],K.prototype,"heightModelInfo",void 0);r.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,
origins:{service:{read:{source:"minScale"},write:!1}}}})],K.prototype,"minScale",void 0);r.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],K.prototype,"maxScale",void 0);r.__decorate([e.property({readOnly:!0})],K.prototype,"version",void 0);r.__decorate([t.reader("version",["store.version"])],K.prototype,"readVersion",null);r.__decorate([e.property({type:String,json:{read:{source:"copyrightText"}}})],K.prototype,
"copyright",void 0);r.__decorate([e.property({type:String,json:{read:!1}})],K.prototype,"sublayerTitleMode",void 0);r.__decorate([e.property({type:String})],K.prototype,"title",void 0);r.__decorate([t.reader("portal-item","title")],K.prototype,"readTitlePortalItem",null);r.__decorate([t.reader("service","title",["name"])],K.prototype,"readTitleService",null);r.__decorate([e.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},
read:!1}}}})],K.prototype,"layerId",void 0);r.__decorate([e.property(q.url)],K.prototype,"url",null);r.__decorate([u.writer("url")],K.prototype,"writeUrl",null);r.__decorate([e.property()],K.prototype,"parsedUrl",null);r.__decorate([e.property({readOnly:!0})],K.prototype,"store",void 0);r.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],K.prototype,"rootNode",void 0);return K=r.__decorate([w.subclass("esri.layers.mixins.SceneService")],K)};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(({target:r,propName:m,newOrigin:n})=>{b.isMultiOriginJSONMixin(r)&&n&&r.originOf(m)!==n&&r.updateOrigin(m,n)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],
function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe"],function(a,b,c,r,m){function n(){n=b._asyncToGenerator(function*(p,g,h,d,f,e){var l=null;if(m.isSome(h)){l=`${p}/nodepages/`;const A=l+Math.floor(h.rootIndex/
h.nodesPerPage);try{return{type:"page",rootPage:(yield c(A,{query:{f:"json",token:d},responseType:"json",signal:e})).data,rootIndex:h.rootIndex,pageSize:h.nodesPerPage,lodMetric:h.lodSelectionMetricType,urlPrefix:l}}catch(t){m.isSome(f)&&f.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",A,t),l=t}}if(!g)return null;g=g&&g.split("/").pop();p=`${p}/nodes/`;g=p+g;try{return{type:"node",rootNode:(yield c(g,{query:{f:"json",token:d},responseType:"json",signal:e})).data,
urlPrefix:p}}catch(A){throw new r("sceneservice:root-node-missing","Root node missing.",{pageError:l,nodeError:A,url:g});}});return n.apply(this,arguments)}a.fetchIndexInfo=function(p,g,h,d,f,e){return n.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,r,m,n,p,g){function h(){h=b._asyncToGenerator(function*(A,t,w){if(t&&t.resources){var u=t.portalItem===A.portalItem?new Set(A.paths):new Set;A.paths.length=0;A.portalItem=t.portalItem;var z=new Set(t.resources.toKeep.map(C=>C.resource.path)),y=new Set,B=[];z.forEach(C=>{u.delete(C);A.paths.push(C)});for(const C of t.resources.toUpdate)if(u.delete(C.resource.path),z.has(C.resource.path)||y.has(C.resource.path)){const {resource:k,content:q,finish:x,error:v}=C,D=g.getSiblingOfSameTypeI(k,
p.generateUUID());A.paths.push(D.path);B.push(d({resource:D,content:q,compress:C.compress,finish:x,error:v},w))}else A.paths.push(C.resource.path),B.push(e(C,w)),y.add(C.resource.path);for(const C of t.resources.toAdd)B.push(d(C,w)),A.paths.push(C.resource.path);u.forEach(C=>{C=t.portalItem.resourceFromPath(C);B.push(C.portalItem.removeResource(C).catch(()=>{}))});if(0!==B.length&&(z=yield n.eachAlways(B),n.throwIfAborted(w),w=z.filter(C=>"error"in C).map(C=>C.error),0<w.length))throw new r("save:resources",
"Failed to save one or more resources",{errors:w});}});return h.apply(this,arguments)}function d(A,t){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(A,t){t={...(m.isSome(t)?t:{}),compress:A.compress};t=yield c.result(A.resource.portalItem.addResource(A.resource,A.content,t));if(!0===t.ok)A.finish&&A.finish(A.resource);else throw A.error&&A.error(t.error),t.error;});return f.apply(this,arguments)}function e(A,t){return l.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(A,
t){t=yield c.result(A.resource.update(A.content,t));if(!0===t.ok)A.finish(A.resource);else throw A.error(t.error),t.error;});return l.apply(this,arguments)}a.saveResources=function(A,t,w){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,
b,c,r,m,n){function p(){p=b._asyncToGenerator(function*(t,w={},u){yield t.load(u);var z=n.join(t.itemUrl,"resources");const {start:y=1,num:B=10,sortOrder:C="asc",sortField:k="created"}=w;w={query:{start:y,num:B,sortOrder:C,sortField:k,token:t.apiKey},signal:m.get(u,"signal")};z=yield t.portal._request(z,w);return{total:z.total,nextStart:z.nextStart,resources:z.resources.map(({created:q,size:x,resource:v})=>({created:new Date(q),size:x,resource:t.resourceFromPath(v)}))}});return p.apply(this,arguments)}
function g(){g=b._asyncToGenerator(function*(t,w,u,z){if(!t.hasPath())throw new r(`portal-item-resource-${w}:invalid-path`,"Resource does not have a valid path");const y=t.portalItem;yield y.load(z);w=n.join(y.userItemUrl,"add"===w?"addResources":"updateResources");const [B,C]=f(t.path);u=yield l(u);const k=new FormData;B&&"."!==B&&k.append("resourcesPrefix",B);m.isSome(z)&&z.compress&&k.append("compress","true");k.append("fileName",C);k.append("file",u,C);k.append("f","json");m.isSome(z)&&z.access&&
k.append("access",z.access);yield y.portal._request(w,{method:"post",body:k,signal:m.get(z,"signal")});return t});return g.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(t,w,u){if(!w.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield t.load(u);const z=n.join(t.userItemUrl,"removeResources");yield t.portal._request(z,{method:"post",query:{resource:w.path},signal:m.get(u,"signal")});w.portalItem=null});return h.apply(this,
arguments)}function d(){d=b._asyncToGenerator(function*(t,w){yield t.load(w);const u=n.join(t.userItemUrl,"removeResources");return t.portal._request(u,{method:"post",query:{deleteAll:!0},signal:m.get(w,"signal")})});return d.apply(this,arguments)}function f(t){const w=t.lastIndexOf("/");return-1===w?[".",t]:[t.slice(0,w),t.slice(w+1)]}function e(t){{const B=n.getPathExtension(t);t=m.isNone(B)?[t,""]:[t.slice(0,t.length-B.length-1),`.${B}`]}const [w,u]=t,[z,y]=f(w);return[z,y,u]}function l(t){return A.apply(this,
arguments)}function A(){A=b._asyncToGenerator(function*(t){return t instanceof Blob?t:(yield c(t.url,{responseType:"blob"})).data});return A.apply(this,arguments)}a.addOrUpdateResource=function(t,w,u,z){return g.apply(this,arguments)};a.contentToBlob=l;a.fetchResources=function(t){return p.apply(this,arguments)};a.getSiblingOfSameType=function(t,w){if(!t.hasPath())return null;const [u,,z]=e(t.path);return t.portalItem.resourceFromPath(n.join(u,w+z))};a.getSiblingOfSameTypeI=function(t,w){if(!t.hasPath())return null;
const [u,,z]=e(t.path);return t.portalItem.resourceFromPath(n.join(u,w+z))};a.removeAllResources=function(t,w){return d.apply(this,arguments)};a.removeResource=function(t,w,u){return h.apply(this,arguments)};a.splitPrefixFileNameAndExtension=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,
supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},
operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,
maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,
supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(a,b,c,r,m,n,p,g,h){let d=function(){function f(l,A,t,w){this._parsedUrl=l;this._portalItem=A;this._apiKey=t;this.signal=w;this._rootDocument=null;if(l=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this._urlParts={root:l[1],layerId:parseInt(l[2],10)}}var e=f.prototype;e.fetch=function(){var l=b._asyncToGenerator(function*(){if(!this._urlParts)return null;var A=this._portalItem??(yield this._portalItemFromServiceItemId());if(m.isNone(A))return this._loadFromUrl();
A=yield this._findAndLoadRelatedPortalItem(A);return m.isNone(A)?null:this._loadFeatureLayerFromPortalItem(A)});return function(){return l.apply(this,arguments)}}();e.fetchPortalItem=function(){var l=b._asyncToGenerator(function*(){if(!this._urlParts)return null;const A=this._portalItem??(yield this._portalItemFromServiceItemId());return m.isNone(A)?null:this._findAndLoadRelatedPortalItem(A)});return function(){return l.apply(this,arguments)}}();e._fetchRootDocument=function(){var l=b._asyncToGenerator(function*(){if(m.isSome(this._rootDocument))return this._rootDocument;
if(m.isNone(this._urlParts))return this._rootDocument={},{};const A={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},t=`${this._urlParts.root}/SceneServer`;try{this._rootDocument=(yield r(t,A)).data}catch{this._rootDocument={}}return this._rootDocument});return function(){return l.apply(this,arguments)}}();e._fetchServiceOwningPortalUrl=function(){var l=b._asyncToGenerator(function*(){var A=this._parsedUrl?.path;const t=A?c.id?.findServerInfo(A):null;if(t?.owningSystemUrl)return t.owningSystemUrl;
A=A?A.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const w=(yield r(A,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(w)return w}catch(w){n.throwIfAbortError(w)}return null});return function(){return l.apply(this,arguments)}}();e._findAndLoadRelatedPortalItem=function(){var l=b._asyncToGenerator(function*(A){try{return(yield A.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(t=>"Feature Service"===t.type)||
null}catch(t){return n.throwIfAbortError(t),null}});return function(A){return l.apply(this,arguments)}}();e._loadFeatureLayerFromPortalItem=function(){var l=b._asyncToGenerator(function*(A){yield A.load({signal:this.signal});const t=yield this._findMatchingAssociatedSublayerUrl(A.url??"");return(new p({url:t,portalItem:A})).load({signal:this.signal})});return function(A){return l.apply(this,arguments)}}();e._loadFromUrl=function(){var l=b._asyncToGenerator(function*(){const A=yield this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);
return(new p({url:A})).load({signal:this.signal})});return function(){return l.apply(this,arguments)}}();e._findMatchingAssociatedSublayerUrl=function(){var l=b._asyncToGenerator(function*(A){A=A.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var t={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const w=this._urlParts?.layerId;var u=this._fetchRootDocument();t=r(A,t);const [z,y]=yield Promise.all([t,u]);u=y&&y.layers;t=z.data&&z.data.layers;if(!Array.isArray(t))throw Error("expected layers array");
if(!Array.isArray(u)){if(null!=w&&w<t.length)return`${A}/${t[w].id}`}else for(let B=0;B<Math.min(u.length,t.length);B++)if(u[B].id===w)return`${A}/${t[B].id}`;throw Error("could not find matching associated sublayer");});return function(A){return l.apply(this,arguments)}}();e._portalItemFromServiceItemId=function(){var l=b._asyncToGenerator(function*(){var A=(yield this._fetchRootDocument()).serviceItemId;if(!A)return null;A=new h({id:A,apiKey:this._apiKey});const t=yield this._fetchServiceOwningPortalUrl();
m.isSome(t)&&(A.portal=new g({url:t}));try{return A.load({signal:this.signal})}catch(w){return n.throwIfAbortError(w),null}});return function(){return l.apply(this,arguments)}}();return f}();a.FetchAssociatedFeatureLayer=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h){a.I3SNodePageDefinition=function(d){function f(){var e=d.apply(this,arguments)||this;e.nodesPerPage=null;e.rootIndex=0;e.lodSelectionMetricType=null;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);c.__decorate([m.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);c.__decorate([m.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=c.__decorate([h.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(d){function f(){var e=d.apply(this,arguments)||this;e.factor=1;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);c.__decorate([m.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=c.__decorate([h.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(d){function f(){var e=d.apply(this,arguments)||this;e.baseColorFactor=[1,1,1,1];e.baseColorTexture=null;e.metallicRoughnessTexture=null;e.metallicFactor=1;e.roughnessFactor=1;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);c.__decorate([m.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);c.__decorate([m.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);c.__decorate([m.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);c.__decorate([m.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
c.__decorate([h.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(d){function f(){var e=d.apply(this,arguments)||this;e.alphaMode="opaque";e.alphaCutoff=.25;e.doubleSided=!1;e.cullFace="none";e.normalTexture=null;e.occlusionTexture=null;e.emissiveTexture=null;e.emissiveFactor=null;e.pbrMetallicRoughness=null;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([g.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);c.__decorate([m.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);c.__decorate([m.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);c.__decorate([g.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);c.__decorate([m.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
c.__decorate([m.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);c.__decorate([m.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);c.__decorate([m.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);c.__decorate([m.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=c.__decorate([h.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:String,json:{read:{source:["name","index"],reader:(d,f)=>null!=d?d:`${f.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);c.__decorate([g.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=c.__decorate([h.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(d){function f(){var e=d.apply(this,arguments)||this;e.atlas=!1;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);c.__decorate([m.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=c.__decorate([h.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([g.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);c.__decorate([m.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=c.__decorate([h.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([g.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);c.__decorate([m.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=c.__decorate([h.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(d){function f(){var e=d.apply(this,arguments)||this;e.offset=0;return e}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([m.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);c.__decorate([m.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);c.__decorate([m.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=c.__decorate([h.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(d){function f(){return d.apply(this,arguments)||this}b._inheritsLoose(f,d);return f}(r.JSONSupport);c.__decorate([g.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);c.__decorate([m.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
c.__decorate([h.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,c,r,m,n,p,g){a.RangeInfo=function(h){function d(){var f=h.apply(this,arguments)||this;f.name=null;f.field=null;f.currentRangeExtent=null;f.fullRangeExtent=null;f.type="rangeInfo";return f}b._inheritsLoose(d,h);return d}(r.JSONSupport);c.__decorate([m.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);c.__decorate([m.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);c.__decorate([m.property({type:[Number],json:{read:!0,write:!0}})],
a.RangeInfo.prototype,"currentRangeExtent",void 0);c.__decorate([m.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);c.__decorate([m.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=c.__decorate([g.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Handles ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){var w;m=w=function(u){function z(B){B=u.call(this,B)||this;B.spatialRelationship="disjoint";B.geometries=new A;B._geometriesSource=null;B._handles=new r;return B}a._inheritsLoose(z,u);var y=z.prototype;y.initialize=function(){this._handles.add(g.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,g.sync))};y.destroy=function(){this._handles.destroy()};y.readGeometries=function(B,C,k){this._geometriesSource={url:t.fromJSON(B,k),context:k}};
y.loadGeometries=function(){var B=a._asyncToGenerator(function*(C,k){if(!p.isNone(this._geometriesSource)){var {url:q,context:x}=this._geometriesSource;k=yield c(q,{responseType:"json",signal:p.get(k,"signal")});var v=C.toJSON();C=k.data.map(D=>({...D,spatialReference:v}));this.geometries=A.fromJSON(C,x);this._geometriesSource=null}});return function(C,k){return B.apply(this,arguments)}}();y.clone=function(){return new w({geometries:n.clone(this.geometries),spatialRelationship:this.spatialRelationship})};
return z}(m.JSONSupport);b.__decorate([h.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],m.prototype,"spatialRelationship",void 0);b.__decorate([h.property({type:A,nonNullable:!0,json:{write:!0}}),l.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],m.prototype,"geometries",void 0);b.__decorate([f.reader(["web-scene","portal-item"],"geometries")],m.prototype,"readGeometries",null);return m=w=b.__decorate([e.subclass("esri.layers.support.SceneFilter")],
m)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){function e(y,B,C){const k=p.getOwnPropertyMetadata(B,C);return{type:String,read:(q,x,v)=>{q=f.read(q,x,v);if(k.type===String)return q;if("function"===
typeof k.type)return new k.type({url:q})},write:{writer(q,x,v,D){if(D&&D.resources){var F=null==q?null:"string"===typeof q?q:q.url;F=f.toJSON(F,{...D,verifyItemRelativeUrls:D&&D.verifyItemRelativeUrls?{writtenUrls:D.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},f.MarkKeep.NO);var G=k.type!==String&&(!r.isMultiOriginJSONMixin(this)||D&&D.origin&&this.originIdOf(C)>g.nameToId(D.origin));q={object:this,propertyName:C,value:q,targetUrl:F,dest:x,targetPropertyName:v,context:D,params:y};if(D&&
D.portalItem&&F&&!m.isAbsolute(F))if(G){{const {context:J,targetUrl:L,params:K,value:O,dest:P,targetPropertyName:N}=q;J.portalItem&&(x=J.portalItem.resourceFromPath(L),v=w(O,L,J),D=d.getResourceContentExtension(v),F=m.getPathExtension(x.path),G=K?.compress??!1,D!==F?l(q):(J.resources&&t({...q,resource:x,content:v,compress:G,updates:J.resources.toUpdate}),P[N]=L))}}else A(q);else D&&D.portalItem&&(null==F||null!=f.itemIdFromResourceUrl(F)||m.isBlobProtocol(F)||G)?l(q):x[v]=F}else x[v]="string"===typeof q?
f.toJSON(q,D):q.write({},D)}}}}function l(y){const {targetUrl:B,params:C,value:k,context:q,dest:x,targetPropertyName:v}=y;if(q.portalItem){var D=f.prefixAndFilenameFromResourceUrl(B),F=D?.filename??n.generateUUID(),G=C?.prefix??D?.prefix;D=w(k,B,q);var J=m.join(G,F);F=`${J}.${d.getResourceContentExtension(D)}`;var L=q.portalItem.resourceFromPath(F);m.isBlobProtocol(B)&&q.resources&&q.resources.pendingOperations.push(u(B).then(K=>{L.path=`${J}.${d.getResourceContentExtension(K)}`;x[v]=L.itemRelativeUrl}).catch(()=>
{}));q.resources&&t({...y,resource:L,content:D,compress:C?.compress??!1,updates:q.resources.toAdd});x[v]=L.itemRelativeUrl}}function A({context:y,targetUrl:B,dest:C,targetPropertyName:k}){y.portalItem&&y.resources&&(y.resources.toKeep.push({resource:y.portalItem.resourceFromPath(B),compress:!1}),C[k]=B)}function t({object:y,propertyName:B,updates:C,resource:k,content:q,compress:x}){C.push({resource:k,content:q,compress:x,finish:v=>{"string"===typeof y[B]?y[B]=v.url:y[B].url=v.url}})}function w(y,
B,C){return"string"===typeof y?{url:B}:new Blob([JSON.stringify(y.toJSON(C))],{type:"application/json"})}function u(y){return z.apply(this,arguments)}function z(){z=c._asyncToGenerator(function*(y){const B=(yield new Promise((C,k)=>a(["../../../request"],q=>C(Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}))),k))).default;({data:y}=yield B(y,{responseType:"blob"}));return y});return z.apply(this,arguments)}b.persistable=function(y){const B=y?.origins??
[void 0];return(C,k)=>{a:if("resource"===y?.type)var q=e(y,C,k);else{switch(y?.type??"other"){case "other":q={read:!0,write:!0};break a;case "url":const {read:x,write:v}=f.persistableUrlUtils;q={read:x,write:v};break a}q=void 0}for(const x of B){const v=h.propertyJSONMeta(C,x,k);for(const D in q)v[D]=q[D]}}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,
b){const c={},r=c["text/plain"],m={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const n in m)c[m[n]]=n;a.getResourceContentExtension=function(n){n instanceof Blob?n=n.type:(n=b.getPathExtension(n.url),n=m[n]||"text/plain");return c[n]||r};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/Error ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e,
l){var A;c=A=function(t){function w(z){return t.call(this,z)||this}a._inheritsLoose(w,t);var u=w.prototype;u.clone=function(){return new A(this.items.map(z=>z.clone()))};u.write=function(z,y){return this.toJSON(y)};u.toJSON=function(z){const y=z?.layer?.spatialReference;return y?this.toArray().map(B=>{if(!y.equals(B.spatialReference)){if(!l.canProjectWithoutEngine(B.spatialReference,y))return z&&z.messages&&z.messages.push(new m("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",
{modification:this,spatialReference:z.layer.spatialReference,context:z})),null;const C=new e;l.projectPolygon(B,C,y);B=C}B=B.toJSON(z);delete B.spatialReference;return B}).filter(B=>null!=B):(z?.messages&&z.messages.push(new m("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:z.layer.spatialReference,context:z})),this.toArray().map(B=>B.toJSON(z)))};w.fromJSON=function(z,y){const B=new A;z.forEach(C=>B.add(e.fromJSON(C,y)));
return B};return w}(r.JSONSupportMixin(c.ofType(e)));return c=A=b.__decorate([f.subclass("esri.layers.support.PolygonCollection")],c)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(a,b,c,r){function m(){m=b._asyncToGenerator(function*(n,p=n.popupTemplate){if(c.isNone(p))return[];const g=yield p.getRequiredFields(n.fieldsIndex);({lastEditInfoEnabled:p}=p);const {objectIdField:h,
typeIdField:d,globalIdField:f,relationships:e}=n;if(g.includes("*"))return["*"];p=p?yield r.getFeatureEditFields(n):[];const l=r.fixFields(n.fieldsIndex,[...g,...p]);d&&l.push(d);l&&h&&n.fieldsIndex.has(h)&&!l.includes(h)&&l.push(h);l&&f&&n.fieldsIndex.has(f)&&!l.includes(f)&&l.push(f);e&&e.forEach(A=>{({keyField:A}=A);l&&A&&n.fieldsIndex.has(A)&&!l.includes(A)&&l.push(A)});return l});return m.apply(this,arguments)}a.getFetchPopupTemplate=function(n,p){return n.popupTemplate?n.popupTemplate:c.isSome(p)&&
p.defaultPopupTemplateEnabled&&c.isSome(n.defaultPopupTemplate)?n.defaultPopupTemplate:null};a.getRequiredFields=function(n){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,r,m,n,p,g,h,d){m=function(f){function e(){var l=f.apply(this,arguments)||this;l.type="elevation-3d";return l}a._inheritsLoose(e,f);e.prototype.initialize=function(){var l=this.view?.map?.allLayers;l=l&&l.includes(this.layer);var A=this.view?.map?.ground?.layers;A=A&&A.includes(this.layer);l&&!A&&(l=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(l)));this._addTilingSchemeMatchPromise()};
a._createClass(e,[{key:"tileInfo",get:function(){return this.layer.tileInfo}}]);return e}(h.TiledLayerView3D(g.LayerView3D(d)));b.__decorate([r.property()],m.prototype,"layer",void 0);b.__decorate([r.property()],m.prototype,"tileInfo",null);return m=b.__decorate([p.subclass("esri.views.3d.layers.ElevationLayerView3D")],m)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.LayerView3D=e=>{e=function(l){function A(){var w=l.apply(this,arguments)||this;w.slicePlaneEnabled=!1;w.supportsHeightUnitConversion=!1;return w}b._inheritsLoose(A,l);var t=A.prototype;t.postscript=function(w){l.prototype.postscript.call(this,w);f.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};t._validateHeightModelInfo=function(){var w=b._asyncToGenerator(function*(){const u=new AbortController;var z=u.signal;this.handles.add(r.makeHandle(()=>
u.abort()));yield n.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,z);m.throwIfAborted(z);if(z=f.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw z;});return function(){return w.apply(this,arguments)}}();t.canResume=function(){const w=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return l.prototype.canResume.call(this)&&(!w||!w.minScale||!w.maxScale||w.minScale>=w.maxScale)};t.getSuspendInfo=function(){const w=
l.prototype.getSuspendInfo.call(this),u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;u&&u.minScale&&u.maxScale&&u.minScale<u.maxScale&&(w.outsideScaleRange=!0);return w};return A}(e);c.__decorate([p.property()],e.prototype,"view",void 0);c.__decorate([p.property()],e.prototype,"slicePlaneEnabled",void 0);return e=c.__decorate([d.subclass("esri.views.3d.layers.LayerView3D")],e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(a,b,c,r,m,n,p,g,h,d,f,e){a.TiledLayerView3D=l=>{l=function(A){function t(){return A.apply(this,
arguments)||this}b._inheritsLoose(t,A);var w=t.prototype;w.getTileUrl=function(u,z,y){return this.layer.getTileUrl(u,z,y)};w._addTilingSchemeMatchPromise=function(){if(m.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new r("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var u=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(m.isSome(u))return this.addResolvingPromise(Promise.reject(u));u=n.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>
{const z=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(z)throw z;});this.addResolvingPromise(u)};w._getTileInfoSupportError=function(u,z){if(u=e.checkIfTileInfoSupportedForView(u,z,this.view.spatialReference,this.view.state.viewingMode)){z={layer:this.layer,error:u};switch(u.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":u=new r("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",z);break;default:u=new r("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",z)}return u}return null};w._getTileInfoCompatibilityError=function(u,z){return z.compatibleWith(u)?null:new r("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};w.levelRangeFromScaleRange=function(u,z){const y={minLevel:0,
maxLevel:Infinity};var B=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!B)return y;const C=B.levels[0];B=k=>{k=Math.log(C.scale/k)/Math.LN2;return 1E-9>.5-Math.abs(.5-k%1)?Math.round(k):Math.ceil(k)};null!=u&&0<u&&(y.minLevel=Math.max(0,B(u)));null!=z&&0<z&&(y.maxLevel=Math.max(0,B(z)));return y};w.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};b._createClass(t,[{key:"imageFormatIsOpaque",get:function(){return!1}},
{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const u=this.tileInfo.lods;return this.levelRangeFromScaleRange(u[0].scale,u[u.length-1].scale)}},{key:"displayLevelRange",get:function(){var u=this.tileInfo.lods;u=this.levelRangeFromScaleRange(this.layer.minScale||u[0].scale,this.layer.maxScale||u[u.length-1].scale);this.layer.maxScale&&u.maxLevel++;return u}}]);
return t}(l);c.__decorate([p.property({readOnly:!0})],l.prototype,"imageFormatIsOpaque",null);c.__decorate([p.property({readOnly:!0})],l.prototype,"updating",void 0);c.__decorate([p.property(f.updatingProgress)],l.prototype,"updatingProgress",void 0);c.__decorate([p.property(f.updatingProgressValue)],l.prototype,"updatingProgressValue",void 0);c.__decorate([p.property()],l.prototype,"fullExtent",null);c.__decorate([p.property({readOnly:!0})],l.prototype,"isOpaque",null);c.__decorate([p.property({readOnly:!0})],
l.prototype,"dataLevelRange",null);c.__decorate([p.property({readOnly:!0})],l.prototype,"displayLevelRange",null);c.__decorate([p.property()],l.prototype,"layer",void 0);c.__decorate([p.property()],l.prototype,"tileInfo",void 0);return l=c.__decorate([d.subclass("esri.views.3d.layers.TiledLayerView3D")],l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){n=function(e){function l(){var A=e.apply(this,arguments)||this;A.type="feature-3d";A.direct3DObjectFeatureLayerDisplayEnabled=d.enableDirect3DObjectFeatureLayerDisplay();return A}a._inheritsLoose(l,e);l.prototype.initialize=function(){"capabilities"in this.layer&&this.layer.capabilities.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new c("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:this.layer})));
r.isSome(this.layer.infoFor3D)&&(this.direct3DObjectFeatureLayerDisplayEnabled?this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new c("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${this.layer.geometryType}`))));"mesh"!==this.layer.geometryType||h.canProjectWithoutEngine(this.layer.spatialReference,this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))};
a._createClass(l,[{key:"featureSpatialReference",get:function(){return this.view.featureTiles?.tilingScheme?.spatialReference}}]);return l}(f);b.__decorate([m.property({constructOnly:!0})],n.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);b.__decorate([m.property()],n.prototype,"layer",void 0);return n=b.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],n)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){p=function(k){function q(v){v=k.call(this,v)||this;v._controllerTotal=0;v._processorTotal=0;v.suspendResumeExtentMode="data";return v}a._inheritsLoose(q,k);var x=q.prototype;x.initialize=function(){this.handles.add(m.watch(()=>this._updatingRequiredFieldsPromise,v=>this.updatingHandles.addPromise(v),m.syncAndInitial))};x.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._fetcherContext=r.destroyMaybe(this._fetcherContext)};
x.setVisibility=function(v,D){this.processor?.setObjectIdVisibility(v,D)};x.createQuery=function(){return k.prototype.createQuery.call(this)};x.queryFeatures=function(v,D){const F=()=>k.prototype.queryFeatures.call(this,v,D);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(v),F):F()};x.beforeSetController=function(v){v.maximumNumberOfFeatures=this.maximumNumberOfFeatures};x.createController=function(){this._fetcherContext=new A.FeatureTileFetcher3DLayerViewContext({layerView:this,
returnZ:this.hasZ,returnM:this.hasM});const v=new f.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new t.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>v.serviceDataExtent,D=>{this.processor&&(this.processor.dataExtent=D)},m.initial);this.handles.add(m.watch(()=>this.suspended,D=>{D?v.suspend():v.resume()},m.syncAndInitial));this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,D=>v.displayFeatureLimit=D,m.initial);this.handles.add(m.when(()=>
!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return v};x.doRefresh=function(){var v=a._asyncToGenerator(function*(D){D&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()});return function(D){return v.apply(this,arguments)}}();x.getUsedMemory=function(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)};x.getUnloadedMemory=function(){const v=this.controller?.expectedFeatureDiff??0,D=this.processor?.loadedFeatures??
0;return(this.processor?.unprocessedMemoryEstimate??0)+(0===D||20<v/D?0:v*(this.processor?.usedMemoryPerFeature??0))};x.ignoresMemoryFactor=function(){return this.controller?.hasMaximumNumberOfFeaturesOverride};x._queryFeaturesMesh=function(){var v=a._asyncToGenerator(function*(D,F){yield this._validateQueryFeaturesMesh(D);F=yield F();if(D&&D.outStatistics||r.isNone(this.graphics3DProcessor))return F;D=this.layer.objectIdField;const G=this.graphics3DProcessor.graphics3DGraphicsByObjectID,J=[];for(const L of F.features)if(L.geometry){const K=
G.get(L.attributes[D]);K&&(L.geometry=d.hydrateGeometry(K.graphic.geometry),J.push(L))}else J.push(L);F.features=J;return F});return function(D,F){return v.apply(this,arguments)}}();x._validateQueryFeaturesMesh=function(){var v=a._asyncToGenerator(function*(D){if(D){var F=J=>{throw new c("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${J}'`);},G=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const J of G)null!=D[J]&&F(J);
"returnM"in D&&D.returnM&&F("returnM");"returnCentroid"in D&&D.returnCentroid&&F("returnCentroid");r.isSome(D.outSpatialReference)&&!D.outSpatialReference.equals(this.view.spatialReference)&&F("outSpatialReference")}});return function(D){return v.apply(this,arguments)}}();a._createClass(q,[{key:"maximumNumberOfFeatures",get:function(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")},set:function(v){this._set("maximumNumberOfFeatures",v);this.controller&&(this.controller.maximumNumberOfFeatures=
v)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"updatingProgressValue",get:function(){let v=0;if(this.controller?.updating){var D=this.controller.updatingRemaining,F=Math.max(this.controller.updatingTotal,this._controllerTotal);0<F&&(v=(F-D)/F,this._controllerTotal=F)}D=0;if(this.processor?.updating){F=this.processor.updatingRemaining;const G=Math.max(F,this._processorTotal);0<G&&(D=(G-
F)/G,this._processorTotal=G)}return.5*(v+D)}},{key:"updatePolicy",get:function(){if(!this.controller)return u.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const v=C[this.layer.geometryType];return null==v||this.controller.serviceDataCount>v?u.UpdatePolicy.ASYNC:u.UpdatePolicy.SYNC;case "tiles":return u.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const v=this.layer,D=v.capabilities&&v.capabilities.data;return D&&D.supportsZ?"returnZ"in v&&null!=v.returnZ?v.returnZ:D.supportsZ:
!1}},{key:"hasM",get:function(){const v=this.layer,D=v.capabilities&&v.capabilities.data;return D&&D.supportsM?"returnM"in v&&null!=v.returnM?v.returnM:!1:!1}},{key:"performanceInfo",get:function(){var v=this.controller?.displayFeatureLimit;v=r.isSome(v)&&v.averageSymbolComplexity;v=r.isSome(v)?`f:${v.primitivesPerFeature},v:${v.primitivesPerCoordinate}`:"n/a";v={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?.mode??"n/a",
symbolComplexity:v,nodes:this.controller?.tileDescriptors.length??0};if(this.controller&&v.displayedNumberOfFeatures){const D=this.controller.debug;v.storedFeatures=D.storedFeatures;v.totalVertices=D.totalVertices}return v}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:this.controller?.graphics}}}]);return q}(B(e.FeatureLikeLayerView3D(z(l.LayerView3D(y)))));b.__decorate([n.property()],p.prototype,"layer",void 0);b.__decorate([n.property()],
p.prototype,"controller",void 0);b.__decorate([n.property()],p.prototype,"_controllerTotal",void 0);b.__decorate([n.property()],p.prototype,"_processorTotal",void 0);b.__decorate([n.property()],p.prototype,"maximumNumberOfFeatures",null);b.__decorate([n.property()],p.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([n.property(w.updatingProgress)],p.prototype,"updatingProgress",void 0);b.__decorate([n.property({readOnly:!0})],p.prototype,"updatingProgressValue",null);b.__decorate([n.property({readOnly:!0})],
p.prototype,"updatePolicy",null);b.__decorate([n.property({readOnly:!0})],p.prototype,"hasZ",null);b.__decorate([n.property({readOnly:!0})],p.prototype,"hasM",null);b.__decorate([n.property()],p.prototype,"suspendResumeExtentMode",void 0);p=b.__decorate([h.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],p);const C={point:5E3,polygon:500,polyline:1E3};return p})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){function D(F,G){if(!G)return!1;for(const J of G)if(!F.has(J))return!0;return!1}a.FeatureTileController3D=function(F){function G(L){L=F.call(this,L)||this;L.type="feature-tile-3d";L._watchUpdatingTracking=new y.WatchUpdatingTracking;L.serviceDataExtent=null;L.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;L.vertexLimitExceeded=!1;L.displayFeatureLimit=null;L._suspended=!1;L._tileFetcher=null;L._handles=new h;L._fetchDataInfoPromise=
null;L._fetchDataInfoAbortController=null;L._lifeCycleAbortController=new AbortController;return L}b._inheritsLoose(G,F);var J=G.prototype;J._approximateExtentSizeAtScale=function(L,K){const O=this.layerView.view,P=K.levels[0];return(P.tileSize[0]/(P.scale/L)+P.tileSize[1]/(P.scale/L))/2*Math.ceil((O.width/K.pixelSize+O.height/K.pixelSize)/2)};J.initialize=function(){this._watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,
this._lifeCycleAbortController.signal)));this._watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),t.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};J._verifyCapabilities=function(){const L=this.layerView.layer;if(!L.get("capabilities.operations.supportsQuery")&&"ogc-feature"!==L.type)throw new g("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:L});};J.destroy=function(){this._cancelFetchServiceDataInfo();this._tileFetcher=e.destroyMaybe(this._tileFetcher);this._handles=e.destroyMaybe(this._handles);this._tilesHandle=e.removeMaybe(this._tilesHandle);this._lifeCycleAbortController&&(this._lifeCycleAbortController.abort(),this._lifeCycleAbortController=null);this._watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};J.suspend=function(){this._suspended||
(this._suspended=!0,e.isSome(this._tileFetcher)&&this._tileFetcher.suspend())};J.resume=function(){this._suspended&&(this._suspended=!1,e.isSome(this._tileFetcher)&&this._tileFetcher.resume())};J.restart=function(){const L=()=>{e.isSome(this._tileFetcher)&&this._tileFetcher.restart()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(L,L))};J.refetch=function(){const L=()=>{e.isSome(this._tileFetcher)&&this._tileFetcher.refetch()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(L,
L))};J._initializeTileFetcher=function(){const L=this.layerView.view;if(L){var K=t.whenOnce(()=>L.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._watchUpdatingTracking.addPromise(K);K.then(()=>{const {layerView:O,tileDescriptors:P}=this,N=O.layer,H=new q.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:P,features:this.graphics});this._tileFetcher=H;this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const E=this.layerView.view.resourceController;
E&&this._handles.add(t.watch(()=>E.memoryController.memoryFactor,M=>H.memoryFactor=M,t.syncAndInitial));const I="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;I&&this._handles.add(t.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[I],M=>H.lodFactor=M||1,t.initial));"ogc-feature"!==N.type&&this._watchUpdatingTracking.add(()=>N.createQueryVersion,()=>this._dataFilterChanged());this._watchUpdatingTracking.add(()=>O.availableFields,
(M,Q)=>this._availableFieldsChanged(Q,M));this._watchUpdatingTracking.add(()=>O.requiredFields,(M,Q)=>this._requiredFieldsChanged(Q,M));this._handles.add([N.on("apply-edits",M=>this._applyEdits(M)),t.watch(()=>this.extent,M=>H.filterExtent=M,t.sync),t.watch(()=>this.tileDescriptors,M=>H.tileDescriptors=M,t.sync),t.watch(()=>this.maximumNumberOfFeatures,M=>{H.maximumNumberOfFeatures=M;H.useTileCount=this.serviceDataCount>M},t.syncAndInitial),t.watch(()=>this.serviceDataCount,M=>H.useTileCount=M>this.maximumNumberOfFeatures,
t.syncAndInitial),t.watch(()=>v.FEATURE_TILE_FETCH_SHOW_TILES,M=>{M&&H&&!H.debugger?(H.debugger=new x.FeatureTileFetcher3DDebugger(H,L.featureTiles.tilingScheme.toTileInfo(),L),H.debugger.update()):!M&&this._tileFetcher&&H.debugger&&(H.debugger.destroy(),H.debugger=null)},t.syncAndInitial)]);this._supportsExceedsLimitQuery||this._watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal)))}).catch(()=>
{})}};J._modeChanged=function(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:f.getLogger(this.declaredClass).warn("Unhandled feature layer mode "+this.mode);case "snapshot":e.isSome(this._tilesHandle)&&(this._tilesHandle.remove(),this._tilesHandle=null)}};J._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};J._applyEdits=function(L){e.isNone(this._tileFetcher)||
this._tileFetcher.applyEdits(L).then(K=>{K&&(K.deletedFeatures.length||K.updatedFeatures.length||K.addedFeatures.length)&&this._watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}).catch(K=>{if(!A.isAbortError(K))throw K;})};J._availableFieldsChanged=function(L,K){e.isSome(this._tileFetcher)&&D(this._tileFetcher.availableFields,K)&&this.refetch()};J._requiredFieldsChanged=function(L,K){e.isSome(this._tileFetcher)&&D(this._tileFetcher.availableFields,
K)&&this.restart()};J._createVertexLimitExceededQuery=function(L){const K=this.layerView.layer,O=K.createQuery();O.outStatistics=[new k({statisticType:"exceedslimit",maxVertexCount:L,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];K.capabilities.query.supportsCacheHint&&(O.cacheHint=!0);return O};J._createDataInfoQuery=function(){const L=this.layerView.layer,K=L.createQuery();K.outSpatialReference=this.layerView.view.spatialReference;L.capabilities.query.supportsCacheHint&&
(K.cacheHint=!0);return K};J._fullExtentIsAccurate=function(){const L=this.layerView.layer;if(L.definitionExpression)return!1;switch(L.type){case "feature":case "oriented-imagery":return B.isHostedAgolService(L.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};J._updateServiceDataExtent=function(){var L=b._asyncToGenerator(function*(K){try{yield this._tryUpdateServiceDataExtent(K)}catch(O){A.isAbortError(O)||this._set("serviceDataExtent",d.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});
return function(K){return L.apply(this,arguments)}}();J._tryUpdateServiceDataExtent=function(){var L=b._asyncToGenerator(function*(K){var O=this.layerView;const P=O.layer,N=P.capabilities.query.supportsExtent,H=d.clone(O.fullExtentInLocalViewSpatialReference),E=P.fullExtent,I=this._fullExtentIsAccurate(),M=this.serviceDataCount;N&&M<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!H||!I)&&"queryExtent"in P?(O=this._createDataInfoQuery(),K=yield P.queryExtent(O,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,
signal:K}),this._set("serviceDataExtent",K.extent)):H?this._set("serviceDataExtent",H):e.isSome(E)?(K=yield C.projectGeometry(E,O.view.spatialReference,"portalItem"in P?P.portalItem:null,K),this._set("serviceDataExtent",K)):this._set("serviceDataExtent",null)});return function(K){return L.apply(this,arguments)}}();J._updateServiceDataCount=function(){var L=b._asyncToGenerator(function*(K){const O=this.layerView.layer;if("queryFeatureCount"in O)if(K=yield m.result(O.queryFeatureCount(this._createDataInfoQuery(),
{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:K})),!0===K.ok)this._set("serviceDataCount",K.value);else{if(A.isAbortError(K.error))throw K.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});return function(K){return L.apply(this,arguments)}}();J._updateVertexLimitExceeded=function(){var L=b._asyncToGenerator(function*(K,O){var P=this.vertexLimitInfo;
if(e.isNone(P))this._set("vertexLimitExceeded",!1);else{var N=1<this._minimumNumberOfVerticesForGeometry;if(0>=P.primitivesPerFeature||N){var {primitivesPerFeature:H,primitivesPerCoordinate:E,maximumTotalNumberOfPrimitives:I}=P;0!==H&&e.isSome(K)&&(yield K);P=this.serviceDataCount;var M=P!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;K=M?Math.ceil((I-P*H)/(E||1)):Math.ceil(I/(E||1));N&&(K=Math.min(K,5E6));if(M&&this._minimumNumberOfVerticesForGeometry*P>K)this._set("vertexLimitExceeded",
!0);else if(this._supportsExceedsLimitQuery)if(O=yield m.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(K),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:O})),!1===O.ok){if(A.isAbortError(O.error))throw O.error;this._set("vertexLimitExceeded",!1)}else(O=O.value.features[0])&&O.attributes?this._set("vertexLimitExceeded",!!O.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>
K)}else this._set("vertexLimitExceeded",!1)}});return function(K,O){return L.apply(this,arguments)}}();J._fetchServiceDataInfo=function(){var L=b._asyncToGenerator(function*(){this._cancelFetchServiceDataInfo();let K=new AbortController;const O=K.signal;var P=this._updateServiceDataCount(O);P=A.eachAlways([P,this._updateVertexLimitExceeded(P,O)]);const N=P.then(()=>this._updateServiceDataExtent(O)).catch(H=>{A.isAbortError(H)||f.getLogger(this.declaredClass).error("#fetchServiceDataInfo()",H)}).then(()=>
{N===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);K=null});K&&(this._fetchDataInfoPromise=N);this._fetchDataInfoAbortController=K;return P.then(()=>{},()=>{})});return function(){return L.apply(this,arguments)}}();J._cancelFetchServiceDataInfo=function(){const L=this._fetchDataInfoAbortController;L&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,L.abort())};b._createClass(G,[{key:"extent",set:function(L){if(L&&!L.spatialReference.equals(this.layerView.view.spatialReference))f.getLogger(this.declaredClass).error("#extent\x3d",
"extent needs to be in the same spatial reference as the view");else{var K=this._get("extent");K===L||K&&L&&K.equals(L)||(L=L?L.clone():null,this._set("extent",L))}}},{key:"updating",get:function(){return!!(e.isSome(this._tileFetcher)&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._watchUpdatingTracking&&this._watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&
e.isSome(this._tileFetcher)?this._tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&e.isSome(this._tileFetcher)?this._tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&e.isSome(this._tileFetcher)?this._tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return e.isSome(this._tileFetcher)?this._tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!e.isSome(this._tileFetcher)||
!this._tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return e.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(L){L!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",L)}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var L=this.layerView.layer;if("feature"===L.type&&e.isSome(L.infoFor3D))return"snapshot";
if(!1===this.layerView.view.qualitySettings?.graphics3D?.snapshotAvailable||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var K=this.layerView.view;K=(K=K&&K.featureTiles)&&K.tilingScheme;return L&&L.minScale&&this.serviceDataExtent&&K&&(L=this._approximateExtentSizeAtScale(L.minScale,K),(this.serviceDataExtent.width/L+this.serviceDataExtent.height/L)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":
!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const L=this._get("maxTotalSnapshotVertices")||0,K="snapshot"===this.mode&&e.isSome(this._tileFetcher)&&this._tileFetcher.totalVertices||0;return Math.max(L,K)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new n([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:
new n}},{key:"test",get:function(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(e.isNone(this.displayFeatureLimit)||e.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:L,maximumTotalNumberOfPrimitives:K}=this.displayFeatureLimit,{primitivesPerCoordinate:O,primitivesPerFeature:P}=L,N=this._get("vertexLimitInfo");return e.isNone(N)||N.maximumTotalNumberOfPrimitives!==
K||N.primitivesPerCoordinate!==O||N.primitivesPerFeature!==P?{primitivesPerCoordinate:O,primitivesPerFeature:P,maximumTotalNumberOfPrimitives:K}:N}},{key:"_supportsExceedsLimitQuery",get:function(){const L=this.layerView.layer;return L.capabilities&&L.capabilities.operations&&L.capabilities.operations.supportsExceedsLimitStatistics}},{key:"_minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;
case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:e.isSome(this._tileFetcher)?this._tileFetcher.storedFeatures:0,totalFeatures:e.isSome(this._tileFetcher)?this._tileFetcher.totalFeatures:0,totalVertices:e.isSome(this._tileFetcher)?this._tileFetcher.totalVertices:0}}}]);return G}(l.EsriPromiseMixin(r));c.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);c.__decorate([w.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"graphics",void 0);c.__decorate([w.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);c.__decorate([w.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"extent",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"updating",null);c.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_watchUpdatingTracking",
void 0);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([w.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);c.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);c.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitExceeded",void 0);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);c.__decorate([w.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([w.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"mode",null);c.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);c.__decorate([w.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,"tileDescriptors",null);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);c.__decorate([w.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);c.__decorate([w.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=c.__decorate([z.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(F){F.NO_SERVICE_DATA_COUNT=Infinity;F.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;F.reset=function(){F.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;F.QUERY_STATISTICS_TIMEOUT=12E3;F.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants=
{}));a.FeatureTileController3DConstants.reset();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){function v(P){return"dummy-tile-full-extent"===P.id}function D(P){let N=0;for(const H of P)H.features&&0<H.features.length&&H.alive&&(N=Math.max(N,H.descriptor.lij[0]));return N}function F(P){P.setFeatures([],0,null);P.featuresMissing=!1;return k.FetchStatus.DONE}function G(P){return g.isNone(P)?new Set:new Set(P.map(N=>N.name))}function J(P,N){if(g.isNone(P)||g.isNone(N))return G(N);const H=new Set;for(const {name:E}of N)P.has(E)&&H.add(E);
return H}const L=n.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(P){function N(E){E=P.call(this,E)||this;E._useTileCount=!1;E.updating=!1;E.updatingTotal=0;E.updatingRemaining=0;E.expectedFeatureDiff=0;E.maximumNumberOfFeaturesExceeded=!1;E.maximumNumberOfFeaturesExceededThrottle=1E3;E._fullRatio=1;E._farRatio=1;E._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};E._handles=new m;E._frameTask=x.ImmediateTask;E._dirty=!1;E._featureTiles=new Map;
E._displayingFeatureReferences=new Map;E._numDisplayingFeatureReferences=0;E._suspended=!0;E._pendingEdits=null;return E}b._inheritsLoose(N,P);var H=N.prototype;H.initialize=function(){this._handles.add(d.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?C.MultiFeatureReference:C.SingleFeatureReference;const E=this.context.scheduler;
g.isSome(E)&&(this._frameTask=E.registerTask(x.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};H.destroy=function(){this._frameTask.remove();this._handles=g.destroyMaybe(this._handles);this._featureTiles.forEach(E=>{this._cancelFetchTile(E);this._removeTile(E)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits&&(this._pendingEdits.controller.abort(),this._pendingEdits=null)};H.restart=function(){this._featureTiles.forEach(E=>{this._cancelFetchTile(E);
this._clearTile(E);this._resetFetchTile(E)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};H.refetch=function(){this._featureTiles.forEach(E=>{this._cancelFetchTile(E);this._resetFetchTile(E)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};H.suspend=function(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())};H.resume=function(){this._suspended&&(this._suspended=!1,this._unpause())};H._pause=function(){this._paused&&
(this._featureTiles.forEach(E=>this._cancelFetchTile(E)),this._updated())};H._unpause=function(){this._paused||(this._setDirty(),this._updated())};H.applyEdits=function(E){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const I=this._pendingEdits;I.count++;const M=I.edits.then(()=>E.result.catch(Q=>{if(h.isAbortError(Q))throw Q;return null}).then(Q=>{if(!Q)return Q;this._applyEditsDeleteFeatures(Q.deletedFeatures);return this._applyEditsAddUpdateFeatures(Q.addedFeatures,
Q.updatedFeatures,I.controller.signal).then(()=>Q)}).then(Q=>{0===--I.count&&(this._pendingEdits===I&&(this._pendingEdits=null),g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated());return Q}));I.edits=M;this._updated();return M};H._applyEditsDeleteFeatures=function(E){if(0!==E.length){var I=this.context.globalIdField,M=I&&this.availableFields.has(I),Q=new Set,T=this._objectIdField;E.forEach(({objectId:S,globalId:U})=>{(!S||0>S)&&I?(M||L.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${I} to be included the layer's outFields for updates to be reflected in the view`),
(S=this.features.find(Y=>Y.attributes&&Y.attributes[I]===U))&&Q.add(u.getObjectId(S,T))):Q.add(S)});this._featureTiles.forEach(S=>{if(S.features){var U=S.features.filter(Y=>!Q.has(u.getObjectId(Y,this._objectIdField)));U.length!==S.features.length&&(S.setFeatures(U,0,S.availableFields),this._invalidateCounts())}})}};H._applyEditsAddUpdateFeatures=function(){var E=b._asyncToGenerator(function*(I,M,Q){const T=[],S=new Set;I.forEach(Y=>T.push(Y.objectId));M.forEach(Y=>{T.push(Y.objectId);S.add(Y.objectId)});
if(0!==T.length){var U=[];this._featureTiles.forEach(Y=>{(Y=this._applyEditsAddUpdateTile(Y,T,S,Q))&&U.push(Y)});yield h.eachAlways(U)}});return function(I,M,Q){return E.apply(this,arguments)}}();H._applyEditsAddUpdateTile=function(){var E=b._asyncToGenerator(function*(I,M,Q,T){if(I.features){var S=this._createQuery(I);S.resultType=void 0;S.cacheHint=!1;S.objectIds=M;M=yield this._queryFeatures(S,T);T=null;0<Q.size&&(S=I.features.filter(U=>!Q.has(u.getObjectId(U,this._objectIdField))),S.length!==
I.features.length&&(T=S));if(0<M.features.length){T||(T=I.features.slice());for(const U of M.features)T.push(U)}T&&(I.hasPreciseFeatureCount&&(I.numFeatures=Math.max(I.numFeatures,T.length)),I.setFeatures(T,0,J(I.availableFields,M.fields)),this._invalidateCounts())}});return function(I,M,Q,T){return E.apply(this,arguments)}}();H._queryFeatures=function(E,I){return this.context.query.queryFeaturesDehydrated(E,{signal:I,timeout:6E5})};H._setDirty=function(){this._dirty=!0;this._updated()};H.runTask=
function(E){this._frameTask.processQueue(E);if(this._dirty&&this.initialized){this._dirty=!1;var I=this._getListOfTiles();this._markTilesNotAlive(I);if(E.run(()=>this._addTiles(I,E))&&E.run(()=>this._filterExtentTiles(I,E))&&E.run(()=>this._removeTiles(I,E))&&!E.done){var M=this._sortTiles(I);E.run(()=>this._displayTiles(M,E))&&E.run(()=>this._fetchTiles(M,E))&&E.run(()=>this._updateMemoryEstimates(M,E))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};
H._markTilesNotAlive=function(E){for(const I of E)I.alive=!1};H._addTiles=function(E,I){if(this._suspended)return!1;this.tileDescriptors.forEach(M=>{const Q=this._featureTiles.get(M.id);Q?Q.alive=!0:I.done||(E.push(this._addTile(M)),I.madeProgress())});return I.hasProgressed};H._filterExtentTiles=function(E,I){for(const M of E){if(I.done)break;M.alive&&(M.filtered=!M.intersects(this.filterExtent),M.filtered&&(this._clearTile(M),I.madeProgress()))}return I.hasProgressed};H._removeTiles=function(E,
I){for(let M=E.length-1;0<=M&&!I.done;M--){const Q=E[M];Q.alive||(this._removeTile(Q),M!==E.length-1&&(E[M]=E[E.length-1]),E.pop(),I.madeProgress())}return I.hasProgressed};H._sortTiles=function(E){E.sort((I,M)=>I.descriptor.loadPriority-M.descriptor.loadPriority);return E};H._displayTiles=function(E,I){const M=this._updateRatio(E),Q=T=>{const S=1>this._fullRatio?M(T)*this._farRatio:1;T.reduceFeatures(S,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(T)};for(const T of E)if(!I.run(()=>
Q(T))){this._setDirty();break}return I.hasProgressed};H._fetchTiles=function(E,I){if(this._paused)return!1;var M=!1;for(const T of E)if(T.needsFetching){var Q=g.isSome(this.context.memoryCache)?this.context.memoryCache.pop(T.id):null;if(g.isSome(Q))T.cache=Q,this._setDirty(),this._scheduleUpdated(),I.madeProgress();else if(this._needsNumFeatures(T)&&(M=new AbortController,Q=this._fetchTileCount(T,M.signal),this._handleRequest(T,Q,M,()=>T.numFeatures=k.FAILED_FEATURE_COUNT),M=!0,I.madeProgress()),
I.done)return!0}if(M)return I.hasProgressed;for(const T of E)if(T.needsFetching&&(E=new AbortController,M=this._fetchTile(T,E.signal),this._handleRequest(T,M,E,S=>{T.setFeatures([],0,null);this._invalidateCounts();T.featuresMissing=!1;this.context.logFetchError(L,S)}),I.madeProgress(),I.done))return!0;return I.hasProgressed};H._updateMemoryEstimates=function(E,I){E.some(M=>I.run(()=>M.updateMemoryEstimates())?!1:(this._setDirty(),!0));return I.hasProgressed};H._reclip=function(E,I){if(this.initialized){var M=
[];this._featureTiles.forEach(Q=>{g.isNone(Q.displayingFeatures)||0===Q.displayingFeatures.length||(Q.intersectionIncludingBorrowed(I,K),Q.intersectionIncludingBorrowed(E,O),w.equals(K,O)||M.push(Q))});this._refreshDisplayingFeatures(M);this._updated()}};H._refreshDisplayingFeatures=function(E){const I=new Set,M=this._changes.updates;for(const Q of E)if(!g.isNone(Q.displayingFeatures))for(const T of Q.displayingFeatures)E=u.getObjectId(T,this._objectIdField),I.has(E)||(I.add(E),{feature:E}=this._displayingFeatureReferences.get(E),
M.removes.push(E),M.adds.push(E));this._applyChanges()};H._updated=function(){let E=0;this._paused||this._featureTiles.forEach(M=>M.isFetching?++E:0);var I=this._dirty||0<E||!!this._pendingEdits;this._set("updating",I);if(I){let M=0,Q=0,T=0,S=0,U=0;const Y=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(R=>{++Q;if(R.isFetching&&R.hasPreciseFeatureCount){const X=this._maximumFeaturesForTile(R)*(1-R.emptyFeatureRatio),W=g.isSome(R.displayingFeatures)?
R.displayingFeatures.length*Y:0;U+=X-W}R.needsFetching?++S:0<R.numFeatures&&(++T,M+=R.numFeatures)});S+=E;let V=I=0;M?(V=M,I=Math.min(S*M/T,M)):(V=Q,I=S);U=Math.min(this.maximumNumberOfFeatures-this.features.length,U);this._set("updatingTotal",V);this._set("updatingRemaining",I);this._set("expectedFeatureDiff",U)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};H._updateMaximumNumberOfFeaturesExceeded=function(){const E=
p.someMap(this._featureTiles,I=>I.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",E)};H._updateRatio=function(E){const I=D(E),M=S=>1/(1<<Math.max(0,I-S.descriptor.lij[0]));let Q=0,T=0;for(const S of E)E=S.numFeatures,Q+=E,T+=E*M(S);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/Q);this._farRatio=this.maximumNumberOfFeatures/T;this._scheduleUpdated();return M};H._maximumFeaturesUpdated=function(E,I){E!==I&&(I>E&&this._featureTiles.forEach(M=>{if(M.featuresMissing){var Q=
this._maximumFeaturesForTile(M);M.features&&(M.features.length>=Q||M.fetchStatus===k.FetchStatus.FULL)||(this._cancelFetchTile(M),this._resetFetchTile(M))}}),this._setDirty())};H._addTile=function(E){E=new k.FeatureTile(E);this._featureTiles.set(E.id,E);this._resetFetchTile(E);this._referenceDisplayingFeaturesFromRelatedTiles(E);return E};H._referenceDisplayingFeaturesFromRelatedTiles=function(E){const I=E.descriptor.resolution;this._featureTiles.forEach(M=>{if(!(g.isNone(M.displayingFeatures)||E===
M||E.descriptor.lij&&M.descriptor.lij&&!q.tilesAreRelated(E.descriptor.lij,M.descriptor.lij))){g.isNone(E.displayingFeatures)&&(E.displayingFeatures=[]);E.descriptor.extent&&M.descriptor.extent&&(g.isNone(E.extentIncludingBorrowedFeatures)&&(E.extentIncludingBorrowedFeatures=w.clone(E.descriptor.extent)),w.expand(E.extentIncludingBorrowedFeatures,M.descriptor.extent,E.extentIncludingBorrowedFeatures));for(const Q of M.displayingFeatures)E.displayingFeatures.push(Q),M=this._displayingFeatureReferences.get(u.getObjectId(Q,
this._objectIdField)),M.ref(M.feature,I),this._numDisplayingFeatureReferences++}});E.featureLimit=g.isSome(E.displayingFeatures)?E.displayingFeatures.length:0};H._removeTile=function(E){this._clearTile(E);this._featureTiles.delete(E.id)};H._resetFetchTile=function(E){E.filtered=!E.intersects(this.filterExtent);E.filtered?E.needsFetching&&(E.fetchStatus=k.FetchStatus.DONE):E.fetchStatus=k.FetchStatus.FETCH_NEEDED};H._cancelFetchTile=function(E){const I=E.requestController;g.isSome(I)&&(E.requestController=
null,E.resetFetching(),I.abort())};H._fetchTileCount=function(){var E=b._asyncToGenerator(function*(I,M){I.numFeatures=yield this._fetchCount(I,M);this._updateRatio(this._getListOfTiles());return I.fetchStatus===k.FetchStatus.REFETCHING?k.FetchStatus.REFETCH_NEEDED:k.FetchStatus.FETCH_NEEDED});return function(I,M){return E.apply(this,arguments)}}();H._fetchTile=function(){var E=b._asyncToGenerator(function*(I,M){var Q=this._maximumFeaturesForTile(I);if(0>=Q)return F(I);const T=this._getMaxRecordCount(I);
var S=Math.ceil(Q/T);if(v(I)||!this.context.capabilities.supportsMaxRecordCountFactor||I.numFeatures<=Q&&S>y.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(I,M);S=this._createQuery(I);S.maxRecordCountFactor=Math.ceil(Q/T);I.isRefetching&&I.features&&0<I.features.length&&(S.maxRecordCountFactor=Math.max(Math.ceil(I.features.length/(1-I.emptyFeatureRatio)/T)+1,S.maxRecordCountFactor));const {features:U,exceededTransferLimit:Y,fields:V}=yield this._queryFeatures(S,M);Q=Y?S.maxRecordCountFactor>=
y.MAX_MAX_RECORD_COUNT_FACTOR?k.FetchStatus.FULL:k.FetchStatus.DONE:k.FetchStatus.FULL;yield this._frameTask.schedule(()=>{I.featuresMissing=U.length<I.numFeatures||Y;const R=this._removeEmptyFeatures(U);I.setFeatures(U,R,G(V))},M);h.throwIfAborted(M);this._invalidateCounts();return Q});return function(I,M){return E.apply(this,arguments)}}();H._fetchCount=function(){var E=b._asyncToGenerator(function*(I,M){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(I),{signal:M})});
return function(I,M){return E.apply(this,arguments)}}();H._fetchPagedTile=function(){var E=b._asyncToGenerator(function*(I,M){let Q=0,T=0,S,U=0,Y=this._maximumFeaturesForTile(I)-U;const V=this._getMaxRecordCount(I);let R=null;for(;;){const X=this._createQuery(I),W=this._setPagingParameters(X,Q,Y,V),{features:aa,exceededTransferLimit:ba,fields:ia}=yield this._queryFeatures(X,M);yield this._frameTask.schedule(()=>{W&&(Q+=g.unwrap(X.num));U+=aa.length;T+=this._removeEmptyFeatures(aa);I.featuresMissing=
Q<I.numFeatures||ba;S=S?S.concat(aa):aa;R=J(R,ia);I.setFeatures(S,T,R)},M);h.throwIfAborted(M);this._invalidateCounts();this._setDirty();Y=this._maximumFeaturesForTile(I)-U;if(!W||!ba||0>=Y)return ba?k.FetchStatus.DONE:k.FetchStatus.FULL}});return function(I,M){return E.apply(this,arguments)}}();H._createFeatureCountQuery=function(E){E=this._createQuery(E);this.context.capabilities.supportsCacheHint&&(E.resultType=void 0,E.cacheHint=!0);return E};H._createQuery=function(E){const I=this.context.createQuery(),
M=E.descriptor.extent;M&&(I.geometry=w.toExtent(M,this.context.tilingScheme.spatialReference));this._setResolutionParams(I,E);this._useTileQuery(E)?I.resultType="tile":this.context.capabilities.supportsCacheHint&&(I.cacheHint=!0);return I};H._setPagingParameters=function(E,I,M,Q){if(!this.context.capabilities.supportsPagination)return!1;E.start=I;0<M&&this.context.capabilities.supportsMaxRecordCountFactor?(E.maxRecordCountFactor=Math.ceil(M/Q),E.num=Math.min(E.maxRecordCountFactor*Q,M)):E.num=Math.min(Q);
return!0};H._getEffectiveTileResolution=function(E){if(null==E.descriptor.resolution)return null;const I=this.context.viewingMode===B.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(E.descriptor.resolution,I)/this.lodFactor};H._setResolutionParams=function(E,I){this._supportsResolution&&(I=this._getEffectiveTileResolution(I),null!=I&&(this.context.capabilities.supportsQuantization?E.quantizationParameters=new z({mode:"view",originPosition:"upper-left",tolerance:I,
extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(E.maxAllowableOffset=I)))};H._removeEmptyFeatures=function(E){const I=E.length;for(let M=0;M<E.length;)u.hasVertices(E[M].geometry)?++M:(E[M]=E[E.length-1],--E.length);return I-E.length};H._needsNumFeatures=function(E){return this.useTileCount&&E.needsFeatureCount&&!v(E)};H._getMaxRecordCount=function(E){const {tileMaxRecordCount:I,maxRecordCount:M}=this.context;return this._useTileQuery(E)&&g.isSome(I)&&0<I&&this.context.capabilities.supportsResultType?
I:g.isSome(M)&&0<M?M:2E3};H._useTileQuery=function(E){return v(E)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};H._handleRequest=function(E,I,M,Q){E.fetchStatus=E.needsRefetching?k.FetchStatus.REFETCHING:k.FetchStatus.FETCHING;E.requestController=M;let T=!1;I.then(S=>{E.requestController=null;E.fetchStatus=S}).catch(S=>{E.requestController===M&&(E.requestController=null,E.fetchStatus=k.FetchStatus.DONE);h.isAbortError(S)?T=!0:Q(S)}).then(()=>{T||this._setDirty();
this._scheduleUpdated()})};H._scheduleUpdated=function(){this._handles&&!this._handles.has("scheduleUpdated")&&this._handles.add(f.schedule(()=>{this._handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};H._showTile=function(E){if(g.isSome(E.displayingFeatures)&&!E.needsDisplayUpdate)return!1;var I=E.features;if(0===E.featureLimit||!I)return I=g.isSome(E.displayingFeatures)&&0<E.displayingFeatures.length,this._hideTileFeatures(E),E.displayingFeatures=[],I;const M=E.descriptor.resolution,
Q=this._changes.updates,T=this._changes.adds,S=Math.min(E.featureLimit,I.length);E.featureLimit=S;for(let Y=0;Y<S;++Y){var U=I[Y];const V=u.getObjectId(U,this._objectIdField),R=this._displayingFeatureReferences.get(V);R?(U=R.ref(U,M),U.oldVersion!==U.newVersion&&(Q.removes.push(U.oldVersion),Q.adds.push(U.newVersion))):(this._displayingFeatureReferences.set(V,new this.FeatureReferenceClass(U,M)),T.push(U));this._numDisplayingFeatureReferences++}this._hideTileFeatures(E);this._applyChanges();E.displayingFeatures=
I.slice(0,S);return!0};H._hideTile=function(E){this._cancelFetchTile(E);this._hideTileFeatures(E)};H._hideTileFeatures=function(E){if(!g.isNone(E.displayingFeatures)){var I=this._changes.updates,M=this._changes.removes;for(const T of E.displayingFeatures){const S=u.getObjectId(T,this._objectIdField);var Q=this._displayingFeatureReferences.get(S);Q&&((Q=Q.unref(E.descriptor.resolution),this._numDisplayingFeatureReferences--,Q)?Q.oldVersion!==Q.newVersion&&(null==Q.newVersion?(this._displayingFeatureReferences.delete(S),
M.push(Q.oldVersion)):(I.adds.push(Q.newVersion),I.removes.push(Q.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();E.displayingFeatures=null}};H._applyChanges=function(){var E=this._changes.updates;0<E.removes.length&&(this.features.removeMany(E.removes),E.removes.length=0);0<E.adds.length&&(this.features.addMany(E.adds),E.adds.length=0);E=this._changes.adds;const I=this._changes.removes,M=Math.min(E.length,I.length);let Q=0;for(;Q<M;){const T=Math.min(Q+200,M);this.features.addMany(E.slice(Q,
T));this.features.removeMany(I.slice(Q,T));Q=T}E.length>M&&this.features.addMany(0===Q?E:E.slice(Q));I.length>M&&this.features.removeMany(0===Q?I:I.slice(Q));E.length=0;I.length=0};H._clearTile=function(E){this._hideTile(E);E.features&&g.isSome(this.context.memoryCache)&&this.context.memoryCache.put(E.id,E.cache,16+E.estimatedSize);E.setFeatures(null,0,null);this._invalidateCounts()};H._invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};
H._getListOfTiles=function(){return Array.from(this._featureTiles.values())};H._maximumFeaturesForTile=function(E){const I=E.hasPreciseFeatureCount?E.numFeatures:Infinity;return Math.min(Math.ceil((E.hasPreciseFeatureCount?I:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-E.emptyFeatureRatio)),I)};b._createClass(N,[{key:"maximumNumberOfFeatures",set:function(E){E=E||Infinity;const I=this._get("maximumNumberOfFeatures");E===I||1>E||(this._set("maximumNumberOfFeatures",E),this._maximumFeaturesUpdated(I,
E))}},{key:"memoryFactor",set:function(E){this.memoryFactor!==E&&(this._set("memoryFactor",E),this._setDirty())}},{key:"lodFactor",set:function(E){this.lodFactor!==E&&(this._set("lodFactor",E),this._supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&g.isSome(this.context.query.queryFeatureCount)},set:function(E){this._useTileCount=E;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let E=0;this._featureTiles.forEach(I=>
E+=I.estimatedUnusedSize);return E}},{key:"totalVertices",get:function(){let E=0;this._featureTiles.forEach(I=>E+=I.numVertices);return E}},{key:"totalFeatures",get:function(){let E=0;this._featureTiles.forEach(I=>E+=I.numFeatures);return E}},{key:"filterExtent",set:function(E){if(E&&this.context.tilingScheme&&!E.spatialReference.equals(this.context.tilingScheme.spatialReference))L.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var I=this._get("filterExtent");
I===E||I&&E&&I.equals(E)||(E=E?E.clone():null,this._set("filterExtent",E),this._reclip(E,I))}}},{key:"_paused",get:function(){return this._suspended||!!this._pendingEdits}},{key:"availableFields",get:function(){let E=null;this._featureTiles.forEach(I=>{g.isNone(I.displayingFeatures)||0===I.displayingFeatures.length||(g.isNone(E)?E=new Set(I.availableFields):E.forEach(M=>{I.availableFields.has(M)||g.unwrap(E).delete(M)}))});return g.isSome(E)?E:new Set}},{key:"running",get:function(){return this.updating}},
{key:"_supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((E,I)=>E+(I.features?I.features.length:0),0)}},{key:"test",get:function(){return{process:E=>this.runTask(E),getFeatureTileById:E=>this._featureTiles.get(E),forEachFeatureTile:E=>this._featureTiles.forEach(E)}}}]);return N}(r);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,
"features",void 0);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);c.__decorate([e.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"updating",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);c.__decorate([e.property({constructOnly:!0})],
a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=c.__decorate([t.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const K=w.create(),O=w.create();a.contextCapabilitiesFromLayer=function(P){const N=P.capabilities.query;a:switch(P.geometryType){case "polyline":P=!0;break a;case "polygon":P=P.capabilities&&P.capabilities.query&&P.capabilities.query.supportsQuantization;break a;default:P=!1}return{supportsMultipleResolutions:P,supportsPagination:!(!N||
!N.supportsPagination),supportsResultType:!(!N||!N.supportsResultType),supportsCacheHint:!(!N||!N.supportsCacheHint),supportsQuantization:!(!N||!N.supportsQuantization),supportsQuantizationEditMode:!(!N||!N.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!N||!N.supportsMaxRecordCountFactor),supportsFormatPBF:!(!N||!N.supportsFormatPBF)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/dehydratedFeatureComparison"],function(a,b,c,r){c=function(){function p(h,d){this._highestResolutionVersion=null;this.versions=[];this.ref(h,d)}var g=p.prototype;g.ref=function(h,d){const f=this.feature;n.oldVersion=f;this.feature&&Object.defineProperty(h,"uid",{value:this.feature.uid,configurable:!0});for(var e of this.versions)if(e.resolution===d){e.refCount++;if((d=this._highestResolutionVersion===
e&&!r.equals(h,e.feature))||this._highestResolutionVersion!==e)e.feature=h;n.newVersion=d?h:f;return n}e={feature:h,resolution:d,refCount:1};this.versions.push(e);!this._highestResolutionVersion||d<this._highestResolutionVersion.resolution?(n.newVersion=h,this._highestResolutionVersion=e):n.newVersion=f;return n};g.unref=function(h){for(let d=0;d<this.versions.length;d++){const f=this.versions[d];if(f.resolution===h)return f.refCount--,n.oldVersion=this.feature,0===f.refCount&&(this.versions[d]=this.versions[this.versions.length-
1],this.versions.length--,this._highestResolutionVersion===f&&(this._recalculateHighestResolutionVersion(),n.oldVersion=f.feature)),n.newVersion=this.feature,n}return null};g._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var h=this.versions[0];for(let d=1;d<this.versions.length;d++){const f=this.versions[d];f.resolution<h.resolution&&(h=f)}this._highestResolutionVersion=h}};b._createClass(p,[{key:"isReferenced",get:function(){return 0!==
this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}}]);return p}();let m=function(){function p(h){this._feature=h;this._refCount=1}var g=p.prototype;g.ref=function(h){++this._refCount;n.oldVersion=this._feature;this.feature&&Object.defineProperty(h,"uid",{value:this.feature.uid,configurable:!0});r.equals(this._feature,h)||
(this._feature=h);n.newVersion=this._feature;return n};g.unref=function(){n.oldVersion=this._feature;if(0<this._refCount&&(this._refCount--,!this.isReferenced))return n.newVersion=null,n;n.newVersion=this._feature;return n};b._createClass(p,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"feature",get:function(){return this._feature}}]);return p}();const n={oldVersion:null,newVersion:null};a.MultiFeatureReference=c;a.SingleFeatureReference=
m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),function(a,b,c,r,m,n){const p=new Set;let g=function(){function d(e){this.descriptor=e;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=
null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=p;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var f=d.prototype;f.setFeatures=function(e,l,A){this._availableFields=r.unwrapOr(A,p);this._features=e;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;e&&0<e.length?(this._emptyFeatureRatio=
l/(e.length+l),this._numVertices=e.reduce((t,w)=>t+n.numVertices(w.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};f.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var e=0;e<this._features.length;++e){const l=n.estimateSize(this._features[e]);this._estimatedSize+=l;e>=this.featureLimit&&(this._estimatedUnusedSize+=l)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=
!1;if(this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=n.estimateSize(this._features[e]);return!0}return!1};f.resetFetching=function(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};f.intersects=function(e){if(!e||!this.descriptor.extent)return!0;m.fromExtent(e,h);return m.intersects(this.descriptor.extent,h)};f.intersectionIncludingBorrowed=function(e,l){const A=r.isSome(this.extentIncludingBorrowedFeatures)?
this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!e&&!A)return m.copy(l,m.POSITIVE_INFINITY),l;e?(m.fromExtent(e,l),m.intersection(l,A,l)):m.copy(l,A);return l};f._shuffle=function(e){this._features.sort((l,A)=>n.getObjectId(l,e)-n.getObjectId(A,e));c.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};f.reduceFeatures=function(e,l,A){if(0>=e)return!1;if(!this._features)return this.featureLimit=0,!1;let t=!1;this.featureLimit=Math.ceil(this.numFeatures*e);
this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,t=!0));!this._shuffled&&1>e&&this._shuffle(A);e=Math.max(this.featureLimit,Math.ceil(l*this.numFeatures));this._features.length>e&&(this._features.length=e,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return t};b._createClass(d,[{key:"displayingFeatures",
get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=
!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},
{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===
a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var e;if(e=!!this._features){a:{e=this._features;var l=this.displayingFeatures,A=this.featureLimit;if(r.isNone(l)||r.isNone(e)||A!==l.length||A>e.length)e=!1;else{for(let t=
0;t<A;++t)if(e[t]!==l[t]){e=!1;break a}e=!0}}e=!e}return e}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null;this._availableFields=e.availableFields;this._features=e.features;this._numFeatures=e.numFeatures;this._emptyFeatureRatio=e.emptyFeatureRatio;this.fetchStatus=e.fetchStatus;
this.featuresMissing=e.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return d}();a.FetchStatus=void 0;(function(d){d[d.FETCH_NEEDED=0]="FETCH_NEEDED";d[d.REFETCH_NEEDED=1]="REFETCH_NEEDED";d[d.FETCHING=2]="FETCHING";d[d.REFETCHING=3]="REFETCHING";d[d.DONE=4]="DONE";d[d.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const h=m.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),function(a,b,c,r,m,n,p,g,h){const d=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],
[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let f=function(){function e(A,t,w){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._enabled=!0;this._tileFetcher=A;this._view=w;this._tilingScheme=new h.TilingScheme(t);this._loadedSymbols=d.map(u=>new p(new m({material:{color:[u[0],u[1],u[2],.6]},outline:{color:"black",size:1}})));this._loadingSymbols=[new p(new m({material:{color:[200,
200,200,.4]},outline:{color:[30,30,30],size:1}}))];this._pendingSymbols=[new p(new m({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this._dataExtentSymbol=new p(new m({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var l=e.prototype;l.destroy=function(){this.enabled=!1};l.update=function(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:A=>A.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:A=>!A.isFetching,
symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:A=>!A.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(A=>{this._view.graphics.removeMany(A)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(A=>{this._view.graphics.removeMany(A)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(A=>{this._view.graphics.removeMany(A)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&
(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))};l.showDataExtent=function(A){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);A&&(A=r.fromExtent(A),this._dataExtentGraphic=new c({geometry:A,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))};l._synchronizeMaps=function(A,t){const w=[];A.forEach((u,z)=>{const y=this._tileFetcher.test.getFeatureTileById(z);y&&t.filter(y)||(this._view.graphics.removeMany(u),
w.push(z))});w.forEach(u=>A.delete(u));this._tileFetcher.test.forEachFeatureTile(u=>{if(t.filter(u)&&!A.has(u.id)){const [B,C,k]=u.descriptor.lij;this._tilingScheme.ensureMaxLod(B);var z=this._tilingScheme.getExtentGeometry(B,C,k),y=new c({geometry:z,symbol:t.symbols[B%t.symbols.length]});z=new c({geometry:z.center,symbol:new n({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new g({text:`${B}/${C}/${k}`,halo:{color:"white",size:1/.75},
material:{color:"black"},size:16})]})});y=[y,z];A.set(u.id,y);this._view.graphics.addMany(y)}})};b._createClass(e,[{key:"enabled",get:function(){return this._enabled},set:function(A){this._enabled=A;this.update()}}]);return e}();a.FeatureTileFetcher3DDebugger=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/basicInterfaces ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k){a.FeatureLikeLayerView3D=q=>{q=function(x){function v(){var F=x.apply(this,arguments)||this;F.controller=null;F.updatePolicy=C.UpdatePolicy.SYNC;F.suspendResumeExtentMode="computed";F.slicePlaneEnabled=!1;F.fullExtentInLocalViewSpatialReference=null;F.suspendResumeExtent=null;F._controllerCreated=!1;F.clippingExtent=null;F.supportsHeightUnitConversion=!0;F._pendingController=null;F.queryEngine=null;return F}b._inheritsLoose(v,x);var D=v.prototype;
D.initialize=function(){var F=this;const G=this.layer;if("isTable"in G&&G.isTable)this.addResolvingPromise(Promise.reject(new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:G})));else{this.addResolvingPromise(this._validateGeometryType());this.updatingHandles.add(()=>this.layer.renderer,L=>this._recreateProcessor(L),n.initial);this.addResolvingPromise(b._asyncToGenerator(function*(){const L=yield B.toViewIfLocal(F);F.fullExtentInLocalViewSpatialReference=
L;yield F._initializeController()})());this.updatingHandles.add(()=>this.updatePolicy,L=>this.processor.preferredUpdatePolicy=L);var J=()=>this.processor.featureStore;this.queryEngine=new u.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return J()},hasZ:this.hasZ,hasM:this.hasM},priority:k.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}};D.destroy=function(){this._destroyPendingController();
this.controller=m.destroyMaybe(this.controller);this._set("processor",m.destroyMaybe(this.processor));this.queryEngine=m.destroyMaybe(this.queryEngine);this.loadedGraphics=null};D._destroyPendingController=function(){this._pendingController=m.destroyMaybe(this._pendingController)};D.getHit=function(F){let G=null;this.loadedGraphics?.forEach(J=>{J.uid===F&&(G=f.hydrateGraphic(J,this.layer))});return G?{type:"graphic",graphic:G,layer:G.layer}:null};D.whenGraphicBounds=function(F,G){return this.processor?.whenGraphicBounds(F,
G)};D.computeAttachmentOrigin=function(F,G){return this.processor?.computeAttachmentOrigin(F,G)};D.elevationAlignPointsInFeatures=function(){var F=b._asyncToGenerator(function*(G,J){const L=this.graphics3DProcessor;if(m.isNone(L))throw new r("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return t.elevationAlignPointsInFeatures(this.view,this.layer,K=>L.getGraphics3DGraphicByObjectId(K),G,J)});return function(G,J){return F.apply(this,arguments)}}();
D.queryForSymbologySnapping=function(){var F=b._asyncToGenerator(function*(G,J){return this.symbologySnappingSupported?z.queryForSymbologySnapping(this.graphics3DProcessor,G,J):{candidates:[],sourceCandidateIndices:[]}});return function(G,J){return F.apply(this,arguments)}}();D.queryFeatures=function(F,G){return this.queryEngine.executeQuery(this._ensureQuery(F),m.get(G,"signal"))};D.queryObjectIds=function(F,G){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),m.get(G,"signal"))};D.queryFeatureCount=
function(F,G){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),m.get(G,"signal"))};D.queryExtent=function(F,G){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),m.get(G,"signal"))};D._ensureQuery=function(F){return m.isNone(F)?this.createQuery():l.from(F)};D.highlight=function(F){return this.processor.highlight(F,this.layer.objectIdField)};D.maskOccludee=function(F){return this.processor.maskOccludee(F)};D.canResume=function(){return x.prototype.canResume.call(this)&&
!this.processor?.scaleVisibilitySuspended};D.getSuspendInfo=function(){const F=x.prototype.getSuspendInfo.call(this);return this.processor?{...F,...this.processor.suspendInfo}:F};D.isUpdating=function(){return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)};D._initializeController=function(){var F=b._asyncToGenerator(function*(){const G=this.createController();this._pendingController=G;
yield G.when();this._setControllerWhenInitialized(G)});return function(){return F.apply(this,arguments)}}();D._setControllerWhenInitialized=function(){var F=b._asyncToGenerator(function*(G){try{yield this.when()}catch(J){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(yield n.whenOnce(()=>this.view?.basemapTerrain?.ready),this.beforeSetController(G),this._pendingController=null,this.controller=G,this.loadedGraphics=G.graphics,
this.notifyChange("updating"))});return function(G){return F.apply(this,arguments)}}();D._updateClippingExtent=function(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}};D._validateGeometryType=function(){var F=b._asyncToGenerator(function*(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new r("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",
{geometryType:this.layer.geometryType});}});return function(){return F.apply(this,arguments)}}();D._recreateProcessor=function(F){var G="heatmap"===F?.type;const J="heatmap"===this.processor?.type;F=this.processor;F&&G===J||(G=G?new y.HeatmapFeatureProcessor({owner:this}):new w({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:L=>
this._updateClippingExtent(L)}),this._set("processor",G),F?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(G.initializePromise))};D._getResourceInfo=function(){const F=this.controller instanceof e.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:F?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:F?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}};b._createClass(v,[{key:"legendEnabled",get:function(){return this.canResume()&&
this.processor?.legendEnabled}},{key:"graphics3DProcessor",get:function(){return"graphics-3d"===this.processor?.type?this.processor:null}},{key:"heatmapProcessor",get:function(){return"heatmap"===this.processor?.type?this.processor:null}},{key:"symbologySnappingSupported",get:function(){return this.layer?.renderer?.getSymbols()?.some(A.symbolHasExtrudeSymbolLayer)??!1}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return v}(q);c.__decorate([p.property()],q.prototype,"loadedGraphics",
void 0);c.__decorate([p.property()],q.prototype,"suspended",void 0);c.__decorate([p.property({readOnly:!0})],q.prototype,"legendEnabled",null);c.__decorate([p.property()],q.prototype,"updating",void 0);c.__decorate([p.property()],q.prototype,"controller",void 0);c.__decorate([p.property()],q.prototype,"processor",void 0);c.__decorate([p.property({readOnly:!0})],q.prototype,"updatePolicy",void 0);c.__decorate([p.property({readOnly:!0})],q.prototype,"suspendResumeExtentMode",void 0);c.__decorate([p.property({type:Boolean})],
q.prototype,"slicePlaneEnabled",void 0);c.__decorate([p.property({readOnly:!0})],q.prototype,"suspendInfo",void 0);c.__decorate([p.property()],q.prototype,"graphics3DProcessor",null);c.__decorate([p.property()],q.prototype,"heatmapProcessor",null);c.__decorate([p.property()],q.prototype,"symbologySnappingSupported",null);return q=c.__decorate([d.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],q)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/maybe ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){function e(){e=b._asyncToGenerator(function*(w,u,z,
y,B){const {elevationProvider:C,renderCoordsHelper:k,spatialReference:q}=w,{elevationInfo:x}=u;var v=d.extractExpressionInfo(x,!0);v=yield d.createContext(v,q,B);m.throwIfAborted(B);B=[];const D=new Set,F=new Set;for(const {objectId:G,points:J}of y)if(y=z(G),r.isNone(y)){for(const L of J)B.push(L[2]);D.add(G)}else{y.isDraped&&F.add(G);l.setFromElevationInfo(p.getGeometryEffectiveElevationInfo(y.graphic.geometry,x));l.updateFeatureExpressionInfoContext(v,y.graphic,u);A.spatialReference=w.spatialReference;
for(const {x:L,y:K,z:O}of J)A.x=L,A.y=K,A.z=O??0,g.evaluateElevationInfoAtPoint(A,C,l,k,t),B.push(t.z)}return{elevations:B,drapedObjectIds:F,failedObjectIds:D}});return e.apply(this,arguments)}const l=new h.ElevationContext,A=n.makeDehydratedPoint(0,0,0,f.WGS84),t=new g.SampleElevationInfo;a.elevationAlignPointsInFeatures=function(w,u,z,y,B){return e.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/support/elevationInfoUtils":function(){define(["exports",
"../core/maybe","../symbols/support/unitConversionUtils"],function(a,b,c){function r(l,A){return b.isNone(A)||!A.mode?(l?f:e).mode:A.mode}function m(l,A){return b.isSome(A)?A:l?f:e}function n(l,A){return r(b.isSome(l)?l.hasZ:!1,A)}function p(l){const A=g(l);return n(l.geometry,A)}function g(l){return l.layer&&"elevationInfo"in l.layer?l.layer.elevationInfo:null}function h(l,A,t,w,u,z,y=null){if(!b.isNone(z)){var B=b.isSome(y)?y.mode:"absolute-height";if("on-the-ground"===B)return 0;({absoluteZ:z}=
d(A,t,w,u,l,z));a:{y=b.isSome(y)&&b.isSome(y.offset)?y.offset:0;switch(B){case "absolute-height":l=z-y;break a;case "relative-to-ground":l=z-(b.unwrapOr(l.elevationProvider.getElevation(A,t,w,u,"ground"),0)+y);break a;case "relative-to-scene":l=z-(b.unwrapOr(l.elevationProvider.getElevation(A,t,w,u,"scene"),0)+y);break a}l=void 0}return l}}function d(l,A,t,w,u,z){const y=b.isSome(z.offset)?z.offset:0;switch(z.mode){case "absolute-height":return{absoluteZ:t+y,elevation:0};case "on-the-ground":return t=
b.unwrapOr(u.elevationProvider.getElevation(l,A,0,w,"ground"),0),{absoluteZ:t,elevation:t};case "relative-to-ground":return l=b.unwrapOr(u.elevationProvider.getElevation(l,A,t,w,"ground"),0),{absoluteZ:t+l+y,elevation:l};case "relative-to-scene":return l=b.unwrapOr(u.elevationProvider.getElevation(l,A,t,w,"scene"),0),{absoluteZ:t+l+y,elevation:l}}}const f={mode:"absolute-height",offset:0},e={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=f;a.elevationContextAffectsAlignment=function(l,
A){if(b.isNone(A))return!1;({mode:A}=A);return b.isSome(A)&&("scene"===l&&"relative-to-scene"===A||"ground"===l&&"absolute-height"!==A)};a.elevationInfoLikeEquals=function(l,A){return l===A||b.isSome(l)&&b.isSome(A)&&l.mode===A.mode&&l.offset===A.offset};a.getConvertedElevation=function(l,A,t,w=null){return h(l,A.x,A.y,A.hasZ?A.z:0,A.spatialReference,t,w)};a.getConvertedElevationFromVector=function(l,A,t,w,u=null){return h(l,A[0],A[1],2<A.length?A[2]:0,t,w,u)};a.getEffectiveElevationInfo=m;a.getEffectiveElevationMode=
r;a.getGeometryEffectiveElevationInfo=function(l,A){return m(b.isSome(l)?l.hasZ:!1,A)};a.getGeometryEffectiveElevationMode=n;a.getGraphicEffectiveElevationInfo=function(l){var A=g(l);l=n(l.geometry,A);A=b.isSome(A)&&"on-the-ground"!==l?b.unwrapOr(A.offset,0)*c.getMetersPerUnit(b.unwrapOr(A.unit,"meters")):0;return{mode:l,offset:A}};a.getGraphicEffectiveElevationMode=p;a.getZForElevationMode=function(l,A,t){if(!b.isNone(t)&&t.mode){var w=l.hasZ?l.z:0,u=b.isSome(t.offset)?t.offset:0;switch(t.mode){case "absolute-height":return w-
u;case "on-the-ground":return 0;case "relative-to-ground":return l=b.unwrapOr(A.elevationProvider.getElevation(l.x,l.y,l.z,l.spatialReference,"ground"),0)+u,w-l;case "relative-to-scene":return l=b.unwrapOr(A.elevationProvider.getElevation(l.x,l.y,l.z,l.spatialReference,"scene"),0)+u,w-l}}};a.hasGraphicFeatureExpressionInfo=function(l){if("on-the-ground"===p(l))return!1;l=g(l);l=b.isSome(l)&&l.featureExpressionInfo?l.featureExpressionInfo.expression:null;return!(!l||"0"===l)};a.onTheGroundElevationInfo=
e;a.zValueInAbsoluteHeightMode=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J){n=function(K){function O(N){N=K.call(this,N)||this;N.type="graphics-3d";N._randomRotationRenderers=null;N.elevationFeatureExpressionEnabled=!1;N.scaleVisibilityEnabled=!1;N.filterVisibilityEnabled=!1;N.frustumVisibilityEnabled=!1;N.elevationAlignmentEnabled=!1;N.timeExtentEnabled=!1;N.setUidToIdOnAdd=!0;N.dataExtent=null;N.drapeSourceType=y.DrapeSourceType.Features;N.preferredUpdatePolicy=J.UpdatePolicy.ASYNC;N._suspendResumeExtent=
null;return N}a._inheritsLoose(O,K);var P=O.prototype;P.initialize=function(){const N=this.owner,H=new C.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:N.hasZ,hasM:N.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:E=>N.view.deconflictor.addGraphicsOwner(E),labeler:(E,I)=>N.view.labeler.addGraphicsOwner(E,I),elevationAlignment:this.elevationAlignmentEnabled?
(E,I)=>new k({graphicsCoreOwner:this,graphicsCore:E,queryGraphicUIDsInExtent:I,elevationProvider:N.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(E,I)=>new v({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:I,graphicsCore:E,basemapTerrain:N.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==N.layer.geometryType?E=>new G.FeatureVisibilityFilter({context:{layerView:N,...E}}):null,objectStates:E=>
new x.Graphics3DObjectStates(E)}});this._set("graphicsCore",H);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new q({graphicsCoreOwner:this}));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(E,I)=>{A.diff(E,I)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>this.layer.labelingInfo,(E,I)=>{A.diff(E,
I)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,E=>this.graphicsCore.preferredUpdatePolicy=E);this._set("initializePromise",this._initializeAsync());this.updatingHandles.addPromise(this.initializePromise)};P._initializeAsync=function(){var N=a._asyncToGenerator(function*(){yield g.logOnError(this.graphicsCore.initializePromise);const H=this.owner;this.updatingHandles.add(()=>this.renderer,E=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(E)));
this.updatingHandles.add(()=>H.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this.updatingHandles.add(()=>H.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield g.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return N.apply(this,arguments)}}();P.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();
this._set("frustumVisibility",p.destroyMaybe(this.frustumVisibility));this._set("graphicsCore",p.destroyMaybe(this.graphicsCore));this._set("owner",null)};P.maskOccludee=function(N){const {set:H,handle:E}=this.objectStates.acquireSet(J.Object3DState.MaskOccludee,null);this.objectStates.setUid(H,N.uid);return E};P.highlight=function(N,H){if(N instanceof z){const {set:E,handle:I}=this.objectStates.acquireSet(J.Object3DState.Highlight,H);this.owner.queryObjectIds(N).then(M=>this.objectStates.setObjectIds(E,
M));return I}if("number"===typeof N||"string"===typeof N||N instanceof c)return this.highlight([N],H);"toArray"in N&&(N=N.toArray());if(Array.isArray(N)&&0<N.length){if(N[0]instanceof c)if(null!=F.attributeLookup(this.layer.fieldsIndex,N[0].attributes,H))N=N.map(E=>F.attributeLookup(this.layer.fieldsIndex,E.attributes,H));else{N=N.map(M=>M.uid);const {set:E,handle:I}=this.objectStates.acquireSet(J.Object3DState.Highlight,null);this.objectStates.setUids(E,N);return I}if("number"===typeof N[0]||"string"===
typeof N[0]){const {set:E,handle:I}=this.objectStates.acquireSet(J.Object3DState.Highlight,H);this.objectStates.setObjectIds(E,N);return I}}return L};P.whenGraphicBounds=function(N,H){return this.graphicsCore?.whenGraphicBounds(N,H)};P.computeAttachmentOrigin=function(N,H){return this.graphicsCore?.computeAttachmentOrigin(N,H)};P.notifyGraphicGeometryChanged=function(N){this.graphicsCore.notifyGraphicGeometryChanged(N)};P.notifyGraphicVisibilityChanged=function(N){this.graphicsCore.notifyGraphicVisibilityChanged(N)};
P.getRenderingInfo=function(N,H,E){E=u.getRenderingInfo(N,{renderer:H,arcade:E});if(p.isSome(E)&&E.color){const I=E.color;I[0]/=255;I[1]/=255;I[2]/=255}p.isSome(E)&&p.isSome(H)&&this._randomRotationRenderers?.has(H)&&(H=this._randomRotationRenderers.get(H),N=N.attributes[H],H=new r.XXH(0),H.updateFloatArray([N]),H.updateUint8Array([173]),E.heading=8.381E-8*H.digest());return E};P.getRenderingInfoAsync=function(N,H,E,I){return u.getRenderingInfoAsync(N,{renderer:H,arcade:E,...I})};P.getSymbolLayerSize=
function(N,H){return this.graphicsCore?.getSymbolLayerSize(N,H)};P.setObjectIdVisibility=function(N,H){this.graphicsCore?.setObjectIdVisibility(N,H)};P.refreshFilter=function(){p.isSome(this.filterVisibility)&&this.filterVisibility.reapply()};P.getGraphics3DGraphicByObjectId=function(N){return this.graphicsCore?.getGraphics3DGraphicByObjectId(N)};P._updateClippingExtent=function(){const N=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(N,this.owner.view.spatialReference)&&(this.updateClippingExtent(N)||
this.graphicsCore.recreateAllGraphics())};P._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add(h.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([h.watch(()=>this.graphicsCore.computedExtent,N=>this._updateSuspendResumeExtent(N),h.initial),h.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],
"suspendResumeExtentMode");break;case "data":this.handles.add([h.when(()=>this.dataExtent,N=>this._updateSuspendResumeExtent(N),h.initial),h.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(p.unwrap(this.dataExtent)))],"suspendResumeExtentMode");break;default:m.neverReached(this.suspendResumeExtentMode)}},h.initial))};P._updateSuspendResumeExtent=function(N){N?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(N,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)};
P._extentToSuspendResumeRect=function(N,H){const E=this.owner.view.spatialReference;if(!N.spatialReference.equals(E)){if(!t.canProject(N,E))return;N=t.project(N,E)}return D.enlargeExtent(N,H,B.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};P._suspendResumeExtentChanged=function(N){p.isSome(this.frustumVisibility)&&this.frustumVisibility.setExtent(N);p.isSome(this.scaleVisibility)&&this.scaleVisibility.setExtent(N)};a._createClass(O,[{key:"layer",get:function(){return this.owner.layer}},
{key:"renderer",get:function(){const {renderer:N,objectIdField:H}=this.layer;if(!N||!H||"heatmap"===N.type||!N.visualVariables)return N;const E=N.visualVariables.findIndex(M=>"rotation"===M.type&&null!=M.valueExpression&&w.matchRandomRotationExpression(M.valueExpression)===H&&(null==M.axis||"heading"===M.axis)&&"geographic"===M.rotationType);if(0>E)return N;const I=N.clone();I.visualVariables.splice(E,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(I,
H);return I}},{key:"scaleVisibility",get:function(){return this.graphicsCore?.scaleVisibility}},{key:"filterVisibility",get:function(){return this.graphicsCore?.filterVisibility}},{key:"elevationAlignment",get:function(){return this.graphicsCore?.elevationAlignment}},{key:"objectStates",get:function(){return this.graphicsCore?.objectStates}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}},{key:"scaleVisibilitySuspended",
get:function(){return p.isSome(this.scaleVisibility)&&this.scaleVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return p.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){const N={};this.scaleVisibilitySuspended&&(N.outsideScaleRange=!0);p.isSome(this.frustumVisibility)&&this.frustumVisibility.suspended&&(N.outsideOfView=!0);return N}},{key:"updating",get:function(){return!!(this.graphicsCore?.updating||
p.isSome(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles?.updating)}},{key:"updatingRemaining",get:function(){return this.graphicsCore?.updatingRemaining??0}},{key:"featureStore",get:function(){return this.graphicsCore?.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){return this.owner?.fullOpacity}},{key:"filter",get:function(){return"filter"in
this.owner?this.owner.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},{key:"graphics3DGraphics",get:function(){return this.graphicsCore?.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphicsCore?.graphics3DGraphicsByObjectID}},
{key:"symbolUpdateType",get:function(){return this.graphicsCore?.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){const N=this.view.resourceController.memoryController.memoryFactor,H=this.graphicsCore?.displayFeatureLimit;return 1===N?H:{...H,maximumNumberOfFeatures:Math.ceil(H.maximumNumberOfFeatures*N),maximumTotalNumberOfFeatures:Math.ceil(H.maximumTotalNumberOfFeatures*N),minimumTotalNumberOfFeatures:Math.ceil(H.minimumTotalNumberOfFeatures*N)}}},{key:"usedMemory",get:function(){return this.graphicsCore?.usedMemory??
0}},{key:"loadedFeatures",get:function(){return this.graphicsCore?.numberOfGraphics??0}},{key:"usedMemoryPerFeature",get:function(){return this.graphicsCore?.usedMemoryPerGraphic??0}},{key:"unprocessedMemoryEstimate",get:function(){return this.graphicsCore?.unprocessedMemoryEstimate??0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:p.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended,
visibilityScale:!this.scaleVisibilitySuspended}}}]);return O}(n.HandleOwner);b.__decorate([d.property()],n.prototype,"type",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"owner",void 0);b.__decorate([d.property()],n.prototype,"layer",null);b.__decorate([d.property()],n.prototype,"renderer",null);b.__decorate([d.property({constructOnly:!0})],n.prototype,"updateClippingExtent",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"elevationFeatureExpressionEnabled",void 0);
b.__decorate([d.property({constructOnly:!0})],n.prototype,"graphicsCore",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"filterVisibilityEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"frustumVisibilityEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,
"timeExtentEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],n.prototype,"setUidToIdOnAdd",void 0);b.__decorate([d.property()],n.prototype,"scaleVisibility",null);b.__decorate([d.property()],n.prototype,"filterVisibility",null);b.__decorate([d.property()],n.prototype,"elevationAlignment",null);b.__decorate([d.property({constructOnly:!0})],n.prototype,"frustumVisibility",void 0);b.__decorate([d.property()],n.prototype,"objectStates",null);b.__decorate([d.property()],n.prototype,"initializePromise",
void 0);b.__decorate([d.property()],n.prototype,"suspendResumeExtentMode",null);b.__decorate([d.property()],n.prototype,"dataExtent",void 0);b.__decorate([d.property()],n.prototype,"scaleVisibilitySuspended",null);b.__decorate([d.property()],n.prototype,"suspended",null);b.__decorate([d.property()],n.prototype,"legendEnabled",null);b.__decorate([d.property()],n.prototype,"suspendInfo",null);b.__decorate([d.property()],n.prototype,"updating",null);b.__decorate([d.property()],n.prototype,"updatingRemaining",
null);b.__decorate([d.property()],n.prototype,"featureStore",null);b.__decorate([d.property()],n.prototype,"view",null);b.__decorate([d.property()],n.prototype,"loadedGraphics",null);b.__decorate([d.property()],n.prototype,"fullOpacity",null);b.__decorate([d.property()],n.prototype,"filter",null);b.__decorate([d.property()],n.prototype,"slicePlaneEnabled",null);b.__decorate([d.property()],n.prototype,"drapeSourceType",void 0);b.__decorate([d.property()],n.prototype,"updatePolicy",null);b.__decorate([d.property()],
n.prototype,"preferredUpdatePolicy",void 0);b.__decorate([d.property()],n.prototype,"displayFeatureLimit",null);n=b.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],n);const L={remove(){},pause(){},resume(){}};return n})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function b(r){const m=[];for(let n=0,p=r.length;n<p;n++){let g=r.charCodeAt(n);128>g?m.push(g):2048>g?m.push(192|g>>6,128|g&63):55296>g||57344<=g?m.push(224|g>>12,128|g>>6&63,
128|g&63):(n++,g=65536+((g&1023)<<10|r.charCodeAt(n)&1023),m.push(240|g>>18,128|g>>12&63,128|g>>6&63,128|g&63))}return new Uint8Array(m)}let c=function(){function r(n){this._seed=n;this._totallen=0;this._bufs=[];this.init()}var m=r.prototype;m.init=function(){this._bufs=[];this._totallen=0;return this};m.updateFloatArray=function(n){const p=[];for(const g of n)isNaN(g)?p.push("NaN"):Infinity===g?p.push("Infinity"):-Infinity===g?p.push("-Infinity"):0===g?p.push("0"):p.push(g.toString(16));this.update(b(p.join("")))};
m.updateIntArray=function(n){n=Int32Array.from(n);this.update(new Uint8Array(n.buffer))};m.updateUint8Array=function(n){this.update(Uint8Array.from(n))};m.updateWithString=function(n){return this.update(b(n))};m.update=function(n){this._bufs.push(n);this._totallen+=n.length;return this};m.digest=function(){const n=new Uint8Array(this._totallen);let p=0;for(const g of this._bufs)n.set(g,p),p+=g.length;this.init();return this._xxHash32(n,this._seed)};m._xxHash32=function(n,p=0){var g=p+374761393&4294967295;
let h=0;if(16<=n.length){g=[p+2654435761+2246822519&4294967295,p+2246822519&4294967295,p+0&4294967295,p-2654435761&4294967295];p=n.length-16;var d=0;for(h=0;(h&4294967280)<=p;h+=4){var f=h;f=g[d]+(2246822519*(n[f+0]+(n[f+1]<<8))+(2246822519*(n[f+2]+(n[f+3]<<8))<<16))&4294967295;f=f<<13|f>>>19;g[d]=2654435761*(f&65535)+(2654435761*(f>>>16)<<16)&4294967295;d=d+1&3}g=(g[0]<<1|g[0]>>>31)+(g[1]<<7|g[1]>>>25)+(g[2]<<12|g[2]>>>20)+(g[3]<<18|g[3]>>>14)&4294967295}g=g+n.length&4294967295;for(p=n.length-4;h<=
p;h+=4)d=h,g=g+(3266489917*(n[d+0]+(n[d+1]<<8))+(3266489917*(n[d+2]+(n[d+3]<<8))<<16))&4294967295,g=g<<17|g>>>15,g=668265263*(g&65535)+(668265263*(g>>>16)<<16)&4294967295;for(;h<n.length;++h)g+=374761393*n[h],g=g<<11|g>>>21,g=2654435761*(g&65535)+(2654435761*(g>>>16)<<16)&4294967295;g^=g>>>15;g=(2246822519*(g&65535)&4294967295)+(2246822519*(g>>>16)<<16);g^=g>>>13;g=(3266489917*(g&65535)&4294967295)+(3266489917*(g>>>16)<<16);g^=g>>>16;return 0>g?g+4294967296:g};return r}();a.XXH=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba,ia,ma,ha,ka,Z,ca,fa,ea,da,la,oa,ra,Aa,ua,za,va,Ja,pa,Ba,Ha,wa){var ya;const Na=P.create(),Ra=H.create(),Sa=B.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=ya=function(Va){function Ua(ta){var xa=Va.call(this,ta)||this;xa._propertiesPool=new ra.PropertiesPool({computedExtent:Ja},b._assertThisInitialized(xa));xa.computedExtent=null;xa.currentRenderer=null;xa.rendererHasGeometryOperations=
!1;xa._graphicStateTracking=null;xa.symbolCreationContext=new ia.Graphics3DSymbolCreationContext((Ia,Qa)=>xa._frameTask.schedule(Ia,Qa));xa.graphics3DGraphics=new Map;xa.stageLayer=null;xa.stage=null;xa._graphicsDrapedUids=new Set;xa._graphicsBySymbol=new Map;xa._symbolConversionCache=new Map;xa._symbols=new Map;xa._graphicsWithoutSymbol=new Map;xa._graphicsWaitingForSymbol=new Map;xa._graphicsUpdateId=0;xa._handles=new z;xa._frameTask=va.ImmediateTask;xa._suspendSymbolCleanup=!1;xa._viewSpatialReference=
null;xa._arcadeOnDemand=null;xa._rendererChangeAbortController=null;xa._elevationInfoChangeAbortController=null;xa._initializeAbortController=null;xa._scaleVisibility=null;xa._filterVisibility=null;xa._spatialIndex=null;xa.extentPadding=0;xa._updatingPendingLoadedGraphicsChange=null;xa._featureStore=null;xa._deconflictor=null;xa._labeler=null;xa._objectStates=null;xa._viewElevationProvider=null;xa._stageLayerElevationProvider=null;xa._sharedSymbolResourcesOwnerHandle=null;xa._whenGraphics3DGraphicRequests=
{};xa._pendingUpdates=new Map;xa._numberOfGraphics=0;xa._numberOfGraphicsProvidingElevation=0;xa._pendingAdds=0;xa._pendingRemoves=0;xa._loadingSymbols=0;xa._pendingUpdatesPool=new q({allocator:Ia=>Ia||new Ta,deallocator:Ia=>{Ia.clear();return Ia}});xa._symbolWarningLogged=!1;xa._geometryWarningLogged=!1;xa._objectIdInvisibleSet=new Set;xa._whenSymbolRemoved=new q;xa.preferredUpdatePolicy=Aa.UpdatePolicy.SYNC;xa.forcedUpdatePolicy=null;xa.elevationFeatureExpressionEnabled=!0;xa.owner=null;xa.layer=
null;xa.graphicSymbolSupported=!0;xa.getRenderingInfoWithoutRenderer=!1;xa.setUidToIdOnAdd=!0;xa.hasZ=null;xa.hasM=null;xa._usedMemory=0;xa._visible=void 0;xa._startCreateGraphics=!1;return xa}b._inheritsLoose(Ua,Va);var La=Ua.prototype;La._getConvertedSymbol=function(ta){if("web-style"===ta.type)return ta.clone();var xa=this._symbolConversionCache.get(ta.id);if(k.isSome(xa))return xa;xa=V.to3D(ta,{geometryType:this.layer?.geometryType,retainId:!0,hasLabelingContext:this._hasLabelingContext(ta)});
const Ia=xa.symbol||null;k.isNone(Ia)&&xa.error&&Sa.error(xa.error.message);this._symbolConversionCache.set(ta.id,Ia);return Ia};La._getSymbolComplexitiesUsedOrRenderer=function(ta){if(k.isNone(ta))return[];var xa=ta.getSymbols(),Ia="backgroundFillSymbol"in ta&&ta.backgroundFillSymbol;if(!(Ia||xa&&xa.length))return[];ta=[];Ia=this._getSymbolComplexityUsedOrRenderer(Ia);k.isSome(Ia)&&ta.push(Ia);for(const Qa of xa)xa=this._getSymbolComplexityUsedOrRenderer(Qa),k.isSome(xa)&&ta.push(xa);return ta};
La._getSymbolComplexityUsedOrRenderer=function(ta){if(k.isNone(ta))return null;const xa=this._symbols.get(ta.id);if(k.isSome(xa))return xa.complexity;ta=this._getConvertedSymbol(ta);return k.isSome(ta)?da.defaultSymbolComplexity(ta):null};La._getSymbolComplexitiesUsed=function(){const ta=[];this._symbols.forEach(xa=>{k.isSome(xa)&&ta.push(xa.complexity)});return ta};La.initialize=function(){this._viewSpatialReference=this.owner.view.spatialReference;this._featureStore=new aa.Graphics3DFeatureStore({objectIdField:this.owner.layer&&
this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Ia=>this.graphics3DGraphics.forEach(Ia),toArray:()=>Array.from(this.graphics3DGraphics.values())});const ta=(Ia,Qa,Xa)=>this.spatialIndex.queryGraphicUIDsInExtent(Ia,Qa,Xa),{componentFactories:xa}=this;k.isSome(xa.elevationAlignment)&&(this._elevationAlignment=xa.elevationAlignment(this,
ta));k.isSome(xa.scaleVisibility)&&(this._scaleVisibility=xa.scaleVisibility(this,ta));k.isSome(xa.filterVisibility)&&(this._filterVisibility=xa.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Ia=>this.modifyGraphics3DGraphicVisibilities(Qa=>Qa.setVisibilityFlag(X.VisibilityFlag.FILTER,Ia(Q.getObjectId(Qa.graphic,this._objectIdField)),X.VisibilityGroup.GRAPHIC)),setAllFeaturesVisibility:Ia=>this.modifyGraphics3DGraphicVisibilities(Qa=>
Qa.setVisibilityFlag(X.VisibilityFlag.FILTER,Ia,X.VisibilityGroup.GRAPHIC)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Ia=>Ia.clearVisibilityFlag(X.VisibilityFlag.FILTER))}));k.isSome(xa.deconflictor)&&(this._deconflictor=xa.deconflictor(this));k.isSome(xa.labeler)&&k.isSome(this._scaleVisibility)&&(this._labeler=xa.labeler(this,this._scaleVisibility));k.isSome(xa.objectStates)&&(this._objectStates=xa.objectStates(this));this._initializeAbortController=new AbortController;
this._initializePromise=this._initializeAsync()};La._initializeAsync=function(){var ta=b._asyncToGenerator(function*(){const xa=this._initializeAbortController.signal,Ia=this.owner.view;this._viewElevationProvider=new R.ViewElevationProvider(this._viewSpatialReference,Ia);this._initializeStage(Ia,this.layer.uid);this.symbolCreationContext.sharedResources=Ia.sharedSymbolResources;this._sharedSymbolResourcesOwnerHandle=Ia.sharedSymbolResources.addGraphicsOwner(this.owner);k.isSome(this.currentRenderer)&&
(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Ia.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Ia.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new ua.GridLocalOriginFactory(Ia.renderSpatialReference);this.symbolCreationContext.elevationProvider=
Ia.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Xa=>this.notifyGraphicGeometryChanged(Xa);this.symbolCreationContext.notifyGraphicVisibilityChanged=Xa=>this.notifyGraphicVisibilityChanged(Xa);const Qa=W.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield W.createContext(Qa,this._viewSpatialReference,xa,Sa);x.throwIfAborted(xa);this.symbolCreationContext.screenSizePerspectiveEnabled=
Ia.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Xa}=this;this.symbolCreationContext.drapeSourceRenderer=Ia.basemapTerrain.overlayManager.registerGeometryDrapeSource(Xa);
this._handles.add(y.makeHandle(()=>Ia.basemapTerrain.overlayManager.unregisterDrapeSource(Xa)))}this._handles.add([v.watch(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),v.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view.screenSizePerspectiveEnabled],()=>{const Xa=Ia.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;Xa!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=
Xa,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),v.watch(()=>this.owner.slicePlaneEnabled,Xa=>this._slicePlaneEnabledChange(!!Xa)),v.watch(()=>this.owner.view.state?.pixelRatio,()=>this._pixelRatioChange()),v.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Xa=>this._physicalBasedRenderingChange(Xa)),v.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Xa=>this._skipHighSymbolLoDsChange(Xa)),v.when(()=>Ia.basemapTerrain?.tilingScheme,
Xa=>{!Xa.spatialReference.equals(this.symbolCreationContext.overlaySR)&&k.isSome(Ia.basemapTerrain.spatialReference)&&(this.symbolCreationContext.overlaySR=Ia.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([v.on(()=>this.owner?.loadedGraphics,"change",cb=>{this._graphicsCollectionChanged(cb);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],
"loaded-graphics")},{initial:!0}),v.watch(()=>this.effectiveUpdatePolicy,Xa=>{k.isSome(this.stageLayer)&&(this.stageLayer.updatePolicy=Xa);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===Aa.UpdatePolicy.ASYNC;Xa===Aa.UpdatePolicy.SYNC&&this.runTask(va.noBudget)},v.syncAndInitial)]);this._frameTask=Ia.resourceController.scheduler.registerTask(va.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this._handles.add(v.watch(()=>this.layer.featureReduction,()=>
this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null});return function(){return ta.apply(this,arguments)}}();La._abortInitialize=function(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)};La.destroy=function(){this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);
this.owner.view.labeler.removeGraphicsOwner(this);this._elevationAlignment=k.destroyMaybe(this._elevationAlignment);this._scaleVisibility=k.destroyMaybe(this._scaleVisibility);this._filterVisibility=k.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=null;this._objectStates=k.destroyMaybe(this._objectStates);this.clear();this._featureStore=k.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=k.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=
k.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=k.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=va.ImmediateTask;this._viewSpatialReference=null;this._set("owner",null);for(const ta in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[ta].reject(new u("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=
k.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=k.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=k.destroyMaybe(this._spatialIndex)};La.clear=function(){this._objectStates?.allGraphicsDeleted();k.isSome(this._graphicStateTracking)&&this._graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(ta=>ta.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();
this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(k.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this.notifyChange("updating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")};La._initializeStage=
function(ta,xa){this.stage=ta._stage;this.stageLayer=new za.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},xa);this.stage.add(this.stageLayer);ta=this.stageLayer.events;ta.on("objectTransformation",Ia=>this.notifyGraphicGeometryChanged(Ia.metadata.graphicUid));ta.on("visibilityChanged",Ia=>this.notifyGraphicVisibilityChanged(Ia.metadata.graphicUid));ta.on("objectGeometryAdded",Ia=>this.notifyGraphicGeometryChanged(Ia.object.metadata.graphicUid));ta.on("objectGeometryRemoved",
Ia=>this.notifyGraphicGeometryChanged(Ia.object.metadata.graphicUid));ta.on("vertexAttrsUpdated",Ia=>this.notifyGraphicGeometryChanged(Ia.object.metadata.graphicUid))};La.notifyGraphicGeometryChanged=function(ta){k.isNone(this._graphicStateTracking)||k.isNone(ta)||(ta=this.graphics3DGraphics.get(ta))&&this._graphicStateTracking.updateGraphicGeometry(ta)};La.notifyGraphicVisibilityChanged=function(ta){k.isNone(this._graphicStateTracking)||k.isNone(ta)||(ta=this.graphics3DGraphics.get(ta))&&this._graphicStateTracking.updateGraphicVisibility(ta)};
La._updateLayerVisibility=function(){var ta=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;ta=!this.suspendedOrOutsideOfView&&!ta;ta!==this._visible&&((this._visible=ta)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())};La._updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};La.getGraphics3DGraphicById=
function(ta){return this.graphics3DGraphics.get(ta)};La.getGraphics3DGraphicByObjectId=function(ta){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(ta):null};La._getGraphicObjectID=function(ta,xa=this.owner.layer&&this.owner.layer.objectIdField){return Q.getObjectId(ta,xa)};La.updateLabelingInfo=function(){var ta=b._asyncToGenerator(function*(xa){const Ia=this._deconflictor&&this._deconflictor.labelingInfoChange(xa);xa=this._labeler&&this._labeler.labelingInfoChange(xa);
yield x.eachAlways([Ia,xa])});return function(xa){return ta.apply(this,arguments)}}();La.updateVisibilityInfo=function(){this._deconflictor&&this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()};La.runTask=function(ta){this._frameTask.processQueue(ta);this._applyPendingUpdates(ta);this.notifyChange("running");this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining")};La.setObjectIdVisibility=function(ta,xa){xa?this._objectIdInvisibleSet.delete(ta):
this._objectIdInvisibleSet.add(ta);ta=this._findGraphics3DGraphicByObjectId(ta);k.isSome(ta)&&this._updateUserVisibility(ta)};La._findGraphics3DGraphicByObjectId=function(ta){return C.findInMap(this.graphics3DGraphics,xa=>this._getGraphicObjectID(xa.graphic)===ta)};La._updateUserVisibility=function(ta){if(k.isNone(ta))return!1;var xa=ta.graphic;const Ia=this._getGraphicObjectID(xa);xa=xa.visible&&!this.owner.suspended&&(k.isNone(Ia)||!this._objectIdInvisibleSet.has(Ia));return ta.setVisibilityFlag(X.VisibilityFlag.USER_SETTING,
xa,X.VisibilityGroup.GRAPHIC)};La._whenGraphics3DGraphic=function(ta){var xa=this.graphics3DGraphics.get(ta.uid);if(xa)return Promise.resolve(xa);if(xa=this._whenGraphics3DGraphicRequests[ta.uid])return xa.promise;xa=x.createDeferred();this._whenGraphics3DGraphicRequests[ta.uid]=xa;return xa.promise};La._boundsForGraphics3DGraphic=function(){var ta=b._asyncToGenerator(function*(xa,Ia){const Qa=this._viewSpatialReference,Xa=this.owner.view.renderSpatialReference,cb=this.owner.view.basemapTerrain.spatialReference;
var db=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:k.isSome(Ia)&&Ia.useViewElevation,minDemResolution:k.isSome(Ia)&&Ia.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;xa=yield xa.getProjectedBoundingBox((fb,jb,qb)=>N.projectBuffer(fb,Xa,jb,fb,Qa,jb,qb),(fb,jb,qb)=>N.projectBuffer(fb,cb,jb,fb,Qa,jb,qb),db,k.get(Ia,"signal"));if(!xa)return null;Ia=xa.boundingBox;xa.requiresDrapedElevation&&(db=this.symbolCreationContext.elevationProvider)&&
(H.center(Ia,Na),db=k.unwrapOr(db.getElevation(Na[0],Na[1],0,Qa,"ground"),0),Ia[2]=Math.min(Ia[2],db),Ia[5]=Math.max(Ia[5],db));return{boundingBox:Ia,screenSpaceObjects:xa.screenSpaceObjects}});return function(xa,Ia){return ta.apply(this,arguments)}}();La.whenGraphicBounds=function(){var ta=b._asyncToGenerator(function*(xa,Ia){yield v.whenOnce(()=>this.owner?.loadedGraphics);const Qa=this.owner.layer&&this.owner.layer.objectIdField;var Xa=this.owner.loadedGraphics.find(cb=>cb===xa?!0:Qa&&cb.attributes&&
xa.attributes&&cb.attributes[Qa]===xa.attributes[Qa]);if(!Xa)throw new u("internal:graphic-not-part-of-view","Graphic is not part of this view");Xa=yield this._whenGraphics3DGraphic(Xa);return this._boundsForGraphics3DGraphic(Xa,Ia)});return function(xa,Ia){return ta.apply(this,arguments)}}();La.computeAttachmentOrigin=function(ta,xa){ta=this.graphics3DGraphics.get(ta.uid);if(!ta)return null;var Ia=ta.computeAttachmentOrigin();if(0===Ia.render.num&&0===Ia.draped.num)return null;O.set(qa,0,0,0);ta=
0;if(0<Ia.render.num){if(!N.projectVectorToVector(Ia.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,Ea,xa))return null;O.add(qa,qa,Ea);ta++}if(0<Ia.draped.num){const [Qa,Xa]=Ia.draped.origin;Ia=k.unwrapOr(this._viewElevationProvider.getElevation(Qa,Xa,"ground"),0);O.set(Ea,Qa,Xa,Ia);if(!N.projectVectorToVector(Ea,this._viewElevationProvider.spatialReference,Ea,xa))return null;O.add(qa,qa,Ea);ta++}1<ta&&O.scale(qa,qa,1/ta);return new pa({x:qa[0],y:qa[1],z:qa[2],spatialReference:xa})};
La.getSymbolLayerSize=function(ta,xa){var Ia=this._symbols.get(ta.id);if(k.isNone(Ia))throw new u("internal:symbol-not-part-of-view","Symbol is not part of this view");ta=ta.symbolLayers.indexOf(xa);if(-1===ta)throw new u("internal:missing-symbol-layer","Symbol layer is not in symbol");Ia=Ia.getSymbolLayerSize(ta);if(null==Ia)throw new u("internal:missing-size","Symbol layer has no valid size");return Ia};La._graphicsCollectionChanged=function(ta){this._startCreateGraphics&&(this.add(ta.added),this.remove(ta.removed))};
La.graphicUpdateHandler=function(ta){const xa=ta.graphic.uid,Ia=this.graphics3DGraphics.get(xa);if(!k.isNone(Ia)||!k.isNone(this._graphicsWithoutSymbol.get(xa)))switch(ta.property){case "visible":this._graphicUpdateVisibleHandler(Ia);break;case "geometry":this._graphicUpdateGeometryHandler(Ia,ta);break;case "symbol":this._graphicUpdateSymbolHandler(Ia,ta);break;case "transform":this._graphicUpdateTransformHandler(Ia,ta)}};La._graphicUpdateGeometryHandler=function(ta,xa){const Ia=xa.graphic.geometry;
if(k.isNone(Ia))this._recreateGraphic(xa.graphic);else if(k.isNone(ta)){if(ta=xa.graphic.symbol&&xa.graphic.symbol.id)if(ta=this._symbols.get(ta),k.isSome(ta)&&ta.loadStatus===fa.LoadStatus.LOADING)return;this._recreateGraphic(xa.graphic)}else{var Qa=ta.graphics3DSymbol;!k.isNone(xa.newValue)&&Qa.updateGeometry(ta,xa.newValue)||this._recreateGraphic(ta.graphic);this._expandComputedExtent(Ia)}};La._graphicUpdateSymbolHandler=function(ta,xa){var Ia=xa.graphic;const Qa=k.isSome(ta)?ta.graphics3DSymbol:
k.isSome(xa.oldValue)?this._symbols.get(xa.oldValue.id):null;if(k.isNone(Qa)||k.isNone(xa.newValue))this._recreateGraphic(Ia);else{var Xa=Qa.symbol;xa=this._getConvertedSymbol(xa.newValue);if(k.isSome(xa)&&(xa.type!==Xa.type||"web-style"===xa.type)||"web-style"===Xa.type)this._recreateGraphic(Ia);else{var cb=this._graphicsBySymbol.get(Xa.id);if(cb&&1!==cb.size)this._recreateGraphic(Ia);else if(cb=K.diff(Xa,xa),k.isNone(cb))this._updateSymbolMapping(Xa.id,xa);else if(cb={diff:cb,graphics3DGraphicPatches:[],
symbolStatePatches:[]},Qa.prepareSymbolPatch(cb),K.isEmpty(cb.diff)){var db=this._getRenderingInfo(Ia);if(k.isNone(db))this._recreateGraphic(Ia);else{Ia=Qa.extentPadding;for(const fb of cb.symbolStatePatches)fb();Ia!==Qa.extentPadding&&this._recomputeExtentPadding();if(k.isSome(ta))for(const fb of cb.graphics3DGraphicPatches)fb(ta,db);this._updateSymbolMapping(Xa.id,xa)}}else this._recreateGraphic(Ia)}}};La._graphicUpdateVisibleHandler=function(ta){this._updateUserVisibility(ta)&&(this._labeler&&
this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};La._graphicUpdateTransformHandler=function(ta,xa){};La.recreateGraphics=function(ta){this._suspendSymbolCleanup=!0;this.remove(ta);this.add(ta);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===Aa.UpdatePolicy.SYNC&&this._cleanupSymbols()};La._recreateGraphic=function(ta){this.recreateGraphics([ta])};La._beginGraphicUpdate=function(ta){const xa=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(ta.uid,
xa);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("updating");return xa};La._endGraphicUpdate=function(ta){ta&&(this._graphicsWaitingForSymbol.delete(ta.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};La._recomputeExtentPadding=function(){let ta=0;this._symbols.forEach(xa=>{k.isSome(xa)&&(ta=Math.max(ta,xa.extentPadding))});this._set("extentPadding",ta)};La._expandComputedExtent=function(ta){var xa=ta.spatialReference;Q.computeAABB(ta,
Ra);ta=this._viewSpatialReference;var Ia=ya.tmpVec;!I.equals(xa,ta)&&N.projectXYZToVector(Ra[0],Ra[1],0,xa,Ia,ta)&&(Ra[0]=Ia[0],Ra[1]=Ia[1],N.projectXYZToVector(Ra[3],Ra[4],0,xa,Ia,ta),Ra[3]=Ia[0],Ra[4]=Ia[1]);if(isFinite(Ra[0])&&isFinite(Ra[3])&&isFinite(Ra[1])&&isFinite(Ra[4])){xa=this.computedExtent;Ia=null;var Qa=isFinite(Ra[2])&&isFinite(Ra[5]),Xa=Qa&&(!xa||null==xa.zmin||Ra[2]<xa.zmin);Qa=Qa&&(!xa||null==xa.zmax||Ra[5]>xa.zmax);if(xa){if(Ra[0]<xa.xmin||Ra[1]<xa.ymin||Ra[3]>xa.xmax||Ra[4]>xa.ymax||
Xa||Qa)Ia=this._propertiesPool.get("computedExtent"),Ia.xmin=Math.min(Ra[0],xa.xmin),Ia.ymin=Math.min(Ra[1],xa.ymin),Ia.xmax=Math.max(Ra[3],xa.xmax),Ia.ymax=Math.max(Ra[4],xa.ymax),Ia.spatialReference=ta}else Ia=this._propertiesPool.get("computedExtent"),Ia.xmin=Ra[0],Ia.ymin=Ra[1],Ia.xmax=Ra[3],Ia.ymax=Ra[4],Ia.spatialReference=ta;Ia&&(Xa&&(Ia.zmin=Ra[2]),Qa&&(Ia.zmax=Ra[5]),this._set("computedExtent",Ia))}};La._abortElevationInfoChange=function(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),
this._elevationInfoChangeAbortController=null)};La.elevationInfoChange=function(){var ta=b._asyncToGenerator(function*(){this._abortElevationInfoChange();const xa=new AbortController;this._elevationInfoChangeAbortController=xa;const Ia=W.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield W.createContext(Ia,this._viewSpatialReference,xa.signal,Sa);x.throwIfAborted(xa.signal);this._elevationInfoChangeAbortController=
null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Qa,Xa,cb)=>{Qa.globalPropertyChanged("elevationInfo",Xa)?Xa.forEach(db=>{const fb=db.graphic;db=db.labelGraphics;for(const jb of db)jb.graphics3DSymbolLayer.updateGraphicElevationContext(fb,jb)}):this._recreateSymbol(cb)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()});return function(){return ta.apply(this,arguments)}}();La.updateStageLayerElevationProvider=function(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&
"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider.dispose(),this._stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new la.StageLayerElevationProvider({layer:this.layer,
stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))};La._clearSymbolsAndGraphics=function(){this.clear();k.isSome(this._filterVisibility)&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),
this._stageLayerElevationProvider.dispose(),this._stageLayerElevationProvider=null)};La.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};La.recreateAllGraphics=function(){this._recreateAllGraphics(!1)};La.recreateAllGraphicsAndSymbols=function(){this._recreateAllGraphics(!0)};La._recreateAllGraphics=function(ta=!1){if(this._startCreateGraphics){var {loadedGraphics:xa,view:Ia}=this.owner,Qa=Ia.basemapTerrain.tilingScheme&&xa&&xa.length?xa.toArray():null;!ta&&
Qa||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Qa&&(ta?this.add(Qa):this.recreateGraphics(Qa))}};La._recreateSymbol=function(ta){var xa=this._graphicsBySymbol.get(ta);const Ia=[];xa&&(xa.forEach((Qa,Xa)=>{const cb=Qa.usedMemory;this._conditionalRemove(Qa,Xa);this._spatialIndex?.remove(Qa);
Ia.push(Qa.graphic);Qa.destroy();this._removeGraphics3DGraphic(Xa,cb);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(ta,new Map));xa=this._symbols.get(ta);k.destroyMaybe(xa);this._symbols.delete(ta);this.add(Ia)};La._recreateGraphicsForSymbol=function(ta){if(ta=this._graphicsBySymbol.get(ta)){const xa=[];ta.forEach(Ia=>xa.push(Ia.graphic));this.recreateGraphics(xa)}};La._conditionalRemove=function(ta,xa){this._graphicsDrapedUids.delete(xa);this._objectStates?.removeGraphic(ta);
this._labeler?.removeGraphic(ta);this._deconflictor?.removeGraphic(ta);k.isSome(this._graphicStateTracking)&&this._graphicStateTracking.removeGraphic(ta)};La.add=function(ta){ta&&0!==ta.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(ta)===Aa.UpdatePolicy.ASYNC?this._addDelayed(ta):this._addImmediate(ta),this.notifyChange("updating")):Sa.error("#add()","Cannot add graphics before terrain surface has been initialized"))};La._updatePolicyForGraphics=
function(ta){if(this.effectiveUpdatePolicy===Aa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const xa of ta)if(k.isSome(xa.geometry)&&"mesh"===xa.geometry.type&&!xa.geometry.loaded)return Aa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};La._addImmediate=function(ta){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const xa of ta)this._addGraphic(xa,this._getRenderingInfo(xa,Sa),Aa.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&
(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};La._addDelayed=function(ta){for(const xa of ta){ta=xa.uid;let Ia=this._pendingUpdates.get(ta);Ia?Ia.add?Ia.state!==ja.NEW&&Ia.abortController.abort():this._pendingAdds++:(Ia=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(ta,Ia));Ia.add=xa}this.notifyChange("running");this.notifyChange("updatingRemaining")};La.remove=function(ta){this.effectiveUpdatePolicy===Aa.UpdatePolicy.ASYNC?
this._removeDelayed(ta):this._removeImmediate(ta);this.notifyChange("updating")};La._removeImmediate=function(ta){for(const xa of ta)this._removeGraphic(xa);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};La._removeDelayed=function(ta){for(const Ia of ta){ta=Ia.uid;var xa=this._pendingUpdates.get(ta);xa?xa.add&&(xa.remove?xa.add=null:this._pendingUpdates.delete(ta),xa.state===ja.LOADING&&xa.abortController.abort(),this._pendingAdds--):
(xa=this._pendingUpdatesPool.pushNew(),xa.remove=Ia,this._pendingUpdates.set(ta,xa),this._pendingRemoves++)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};La._finishPendingUpdates=function(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&Sa.warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=this._pendingAdds=0};La._applyPendingUpdates=function(ta){this._symbolWarningLogged=
this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update();else{for(const [xa,Ia]of this._pendingUpdates){if(ta.done)break;Ia.add&&Ia.state===ja.NEW&&this._processPendingUpdateNew(Ia);let Qa=this.effectiveUpdatePolicy;!Ia.remove||Ia.add&&Ia.state!==ja.READY||(this._pendingRemoves--,ta.madeProgress(),this._removeGraphic(Ia.remove),Ia.remove=null,Qa=Aa.UpdatePolicy.SYNC);if(Ia.add)switch(Ia.state){case ja.READY:this._addGraphic(Ia.add,Ia.renderingInfo,
Qa);Ia.add=null;this._pendingAdds--;ta.madeProgress();break;case ja.REJECTED:Ia.add=null,this._pendingAdds--}null==Ia.remove&&null==Ia.add&&this._pendingUpdates.delete(xa)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};La._processPendingUpdateNew=function(ta){if(ta.add){var xa=ta.add.geometry;k.isSome(xa)&&"mesh"===xa.type&&!xa.loaded?this._processPendingUpdateNewMesh(ta,xa):this._processPendingUpdateNewRenderingInfo(ta)}else ta.state=ja.READY};La._processPendingUpdateNewMesh=
function(){var ta=b._asyncToGenerator(function*(xa,Ia){xa.state=ja.LOADING;xa.abortController=new AbortController;const Qa=xa.abortController.signal;try{yield Ia.load({signal:Qa})}catch(Xa){return this._processPendingUpdateNewError(xa,Xa)}xa.abortController=null;this._processPendingUpdateNewRenderingInfo(xa)});return function(xa,Ia){return ta.apply(this,arguments)}}();La._processPendingUpdateNewError=function(ta,xa){ta.abortController=null;x.isAbortError(xa)?ta.state=ja.NEW:ta.state=ja.REJECTED};
La._processPendingUpdateNewRenderingInfo=function(){var ta=b._asyncToGenerator(function*(xa){if(k.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)xa.renderingInfo=this._getRenderingInfo(xa.add,Sa);else{xa.state=ja.LOADING;xa.abortController=new AbortController;var Ia=null;try{Ia=yield this._getRenderingInfoAsync(xa.add,{signal:xa.abortController.signal})}catch(Qa){xa.abortController=null;x.isAbortError(Qa)?xa.state=ja.NEW:xa.state=ja.REJECTED;return}k.isNone(Ia)||k.isNone(Ia.symbol)?
(Sa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),xa.renderingInfo=null):xa.renderingInfo=Ia}xa.state=ja.READY});return function(xa){return ta.apply(this,arguments)}}();La._addGraphic=function(ta,xa,Ia){this._graphicsWithoutSymbol.set(ta.uid,ta);if(!k.isNone(xa)&&!k.isNone(xa.symbol)&&Q.hasGeometry(ta)){w("enable-feature:objectAndLayerId-rendering")&&this.setUidToIdOnAdd&&this.stage.renderView._objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(ta.objectId,
ta.uid,this.layer.id,this.layer.uid,this.layer.popupEnabled);var Qa=this.getOrCreateGraphics3DSymbol(xa.symbol,xa.renderer);if(!k.isNone(Qa)){this._expandComputedExtent(ta.geometry);var Xa=this._beginGraphicUpdate(ta),cb=new ba(ta,xa,this.layer),db=!1,fb=nb=>{nb===Qa.symbol.id&&(db=!0)};this._whenSymbolRemoved.push(fb);var jb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(fb);if(this._graphicsWaitingForSymbol.get(ta.uid)!==Xa||db||Qa.destroyed||this.graphicSymbolSupported&&
ta.symbol&&ta.symbol.id!==Qa.symbol.id)--Qa.referenced,this._cleanupSymbols();else{const nb=this._createGraphics3DGraphic(Qa,cb);this._spatialIndex&&k.isSome(nb)&&this._spatialIndex.add(nb);--Qa.referenced;this._endGraphicUpdate(ta)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},qb=nb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(fb),db||(x.isAbortError(nb)?this.add([ta]):Qa.destroyed||this._endGraphicUpdate(ta)))};
++this._loadingSymbols;Ia===Aa.UpdatePolicy.ASYNC?Qa.load(()=>this._frameTask.schedule(jb),nb=>this._frameTask.schedule(()=>qb(nb))):Qa.load(jb,qb)}}};La._removeGraphic=function(ta){ta=ta.uid;const xa=this.graphics3DGraphics.get(ta);if(xa){xa.graphics3DSymbol.onRemoveGraphic(xa);const Ia=xa.usedMemory,Qa=xa.isElevationSource;this._conditionalRemove(xa,ta);this._spatialIndex?.remove(xa);this._graphicsBySymbol.get(xa.graphics3DSymbol.symbol.id).delete(ta);this._graphicsWithoutSymbol.delete(ta);this._removeGraphics3DGraphic(ta,
Ia,Qa);xa.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(ta),this._graphicsWaitingForSymbol.delete(ta),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};La._hasLabelingContext=function(ta){if(ta instanceof Ba||ta instanceof Ha){const xa=this.symbolCreationContext.layer;return xa.labelingInfo?xa.labelingInfo.some(Ia=>Ia.symbol===ta):!1}return!1};La._hasValidSymbolCreationContext=function(ta){return ta instanceof
Ba&&!this._hasLabelingContext(ta)?(Sa.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};La._getRenderingInfo=function(ta,xa){const Ia=ta.geometry;if(k.isNone(Ia))return xa&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!N.canProjectWithoutEngine(Ia.spatialReference,this._viewSpatialReference))return xa&&!this._geometryWarningLogged&&
(this._geometryWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&k.isSome(ta.symbol))return xa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ta=this.rendererHasGeometryOperations?T.hydrateGraphic(ta,this.layer):ta;ta=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
k.isSome(this.currentRenderer))?this.owner.getRenderingInfo(ta,this.currentRenderer,this._arcadeOnDemand):{symbol:ta.symbol||Y.getDefaultSymbol3D(ta.geometry)};return k.isNone(ta)||k.isNone(ta.symbol)?(xa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):ta};La._getRenderingInfoAsync=function(ta,xa){if(k.isNone(ta.geometry))return Sa&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),
null;if(!this.graphicSymbolSupported&&k.isSome(ta.symbol))return Sa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ta=this.rendererHasGeometryOperations?T.hydrateGraphic(ta,this.layer):ta;return this.owner.getRenderingInfoAsync(ta,this.currentRenderer,this._arcadeOnDemand,xa)};La._createGraphics3DSymbol=function(ta,xa){if(!this._hasValidSymbolCreationContext(ta))return null;ta=this._getConvertedSymbol(ta);
if(!ta)return null;let Ia;k.isSome(xa)&&"backgroundFillSymbol"in xa&&xa.backgroundFillSymbol&&(xa=V.to3D(xa.backgroundFillSymbol,{ignoreDrivers:!0}),k.isSome(xa.symbol)&&"web-style"!==xa.symbol.type&&"cim"!==xa.symbol.type&&(Ia=xa.symbol.symbolLayers));const Qa=ma.make(ta,this.symbolCreationContext,Ia);Qa.load(()=>{const Xa=Qa.extentPadding;Xa>this.extentPadding&&this._set("extentPadding",Xa);this.notifyChange("averageSymbolComplexity")},()=>{});return Qa};La.getOrCreateGraphics3DSymbol=function(ta,
xa){let Ia=this._symbols.get(ta.id);void 0===Ia&&(Ia=ta instanceof wa?new ha(ta,Qa=>this._frameTask.schedule(Qa),Qa=>this._createGraphics3DSymbol(Qa,xa)):this._createGraphics3DSymbol(ta,xa),this._symbols.set(ta.id,Ia));k.isSome(Ia)&&++Ia.referenced;return Ia};La.trackGraphicState=function(ta){k.isNone(this._graphicStateTracking)&&(this._graphicStateTracking=new ka.GraphicStateTracking(this));return this._graphicStateTracking.add(ta)};La._addGraphics3DGraphic=function(ta){this._usedMemory+=ta.usedMemory;
this.graphics3DGraphics.set(ta.graphic.uid,ta);this._numberOfGraphics++;ta.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};La._removeGraphics3DGraphic=function(ta,xa,Ia=!1){this._usedMemory-=xa;this.graphics3DGraphics.delete(ta);this._numberOfGraphics--;Ia&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};La._createGraphics3DGraphic=function(ta,
xa){const Ia=xa.graphic;this._graphicsWithoutSymbol.delete(Ia.uid);if(!this._symbols.has(ta.symbol.id))return this.add([Ia]),null;if(this.graphics3DGraphics.has(Ia.uid))return null;xa=ta.createGraphics3DGraphic(xa);if(k.isNone(xa))return null;this._addGraphics3DGraphic(xa);ta=ta.symbol.id;this._graphicsBySymbol.has(ta)||this._graphicsBySymbol.set(ta,new Map);this._graphicsBySymbol.get(ta).set(Ia.uid,xa);xa.isDraped&&this._graphicsDrapedUids.add(Ia.uid);xa.centroid=null;k.isSome(Ia.geometry)&&"point"!==
Ia.geometry.type&&(xa.centroid=Z.computeCentroid(Ia.geometry,this._viewSpatialReference));this._updateUserVisibility(xa);k.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(xa);k.isSome(this._filterVisibility)&&({defaultVisibility:ta}=this._filterVisibility,xa.setVisibilityFlag(X.VisibilityFlag.FILTER,ta,X.VisibilityGroup.GRAPHIC),ta||this._filterVisibility.reapply());this._deconflictor?.addGraphic(xa);this._labeler?.addGraphic(xa);this._objectStates?.addGraphic(xa);this._deconflictor&&
this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,xa);xa.initialize(this.stage,this.stageLayer,this.owner);k.isSome(this._graphicStateTracking)&&this._graphicStateTracking.addGraphic(xa);if(ta=this._whenGraphics3DGraphicRequests[Ia.uid])delete this._whenGraphics3DGraphicRequests[Ia.uid],ta.resolve(xa);return xa};La._abortRendererChange=function(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)};La.rendererChange=
function(){var ta=b._asyncToGenerator(function*(xa){this._abortRendererChange();if(xa!==this.currentRenderer)if(this._validateRenderer(xa),k.isNone(xa)&&this._currentRendererChange(null,!1),S.isSupportedRenderer3D(xa))if(k.isSome(xa)&&xa.arcadeRequired){var Ia=new AbortController;this._rendererChangeAbortController=Ia;const {arcadeUtils:Qa}=yield this._ensureArcade();x.throwIfAborted(Ia);const Xa=Qa.hasGeometryOperations(xa);Xa&&(yield Qa.enableGeometryOperations(),x.throwIfAborted(Ia));this.effectiveUpdatePolicy===
Aa.UpdatePolicy.ASYNC?yield this._frameTask.schedule(()=>this._currentRendererChange(xa,Xa),Ia.signal):this._currentRendererChange(xa,Xa);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===Aa.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=Ia=new AbortController,yield this._frameTask.schedule(()=>this._currentRendererChange(xa,!1),Ia.signal),this._rendererChangeAbortController=null):this._currentRendererChange(xa,!1);else this._currentRendererChange(xa,!1)});return function(xa){return ta.apply(this,
arguments)}}();La._ensureArcade=function(){var ta=b._asyncToGenerator(function*(){k.isNone(this._arcadeOnDemand)&&(this._arcadeOnDemand=yield U.loadArcade());return this._arcadeOnDemand});return function(){return ta.apply(this,arguments)}}();La._currentRendererChange=function(ta,xa){this.currentRenderer=ta;this.rendererHasGeometryOperations=xa;this.symbolCreationContext.arcade=k.unwrap(this._arcadeOnDemand);xa=this.symbolCreationContext.renderer;if(ta!==xa)if(this._symbolConversionCache.clear(),k.isNone(ta))this.symbolCreationContext.renderer=
null,this.recreateAllGraphicsAndSymbols();else{var Ia=K.diff(xa,ta);this._updateUnchangedSymbolMappings(Ia,ta,xa);this.symbolCreationContext.renderer=ta;k.isNone(Ia)||("complete"===Ia.type?this.recreateAllGraphicsAndSymbols():"partial"===Ia.type&&(this._applyRendererDiff(Ia,ta,xa)?this._volatileGraphicsUpdated():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};La._diffHasSymbolChange=function(ta){for(const xa in ta.diff)switch(xa){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete ta.diff[xa];break;default:return!0}return!1};La._applySymbolSetDiff=function(ta,xa,Ia){ta=ta||[];xa=xa||[];const Qa=[];for(const Xa of xa){const cb=this._graphicsBySymbol.get(Xa.id);cb&&cb.forEach((db,fb)=>{var jb=db.graphic,qb=this.layer instanceof M?this.layer:null;const nb=k.unwrap(this._arcadeOnDemand);if(Xa!==Ia.defaultSymbol||Ia.getSymbol(T.hydrateGraphic(jb,qb),{arcade:nb})!==Ia.defaultSymbol)qb=db.usedMemory,ta.length||
Ia.defaultSymbol?Qa.push(jb):this._graphicsWithoutSymbol.set(fb,jb),jb=this.graphics3DGraphics.get(fb),this._conditionalRemove(jb,fb),db.destroy(),cb.delete(fb),this._removeGraphics3DGraphic(fb,qb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(db=>db(Xa.id))}if(ta.length||Qa.length)this._graphicsWithoutSymbol.forEach(Xa=>Qa.push(Xa)),this._graphicsWithoutSymbol.clear(),this.add(Qa);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};
La._applyUniqueValueRendererDiff=function(ta,xa,Ia){const Qa=ta.diff.defaultSymbol,Xa=ta.diff.uniqueValueInfos;if(Qa||Xa){const cb=Xa?Xa.added.map(fb=>fb.symbol):[],db=Xa?Xa.removed.map(fb=>fb.symbol):[];if(Xa)for(let fb=0;fb<Xa.changed.length;fb++)cb.push(Xa.changed[fb].newValue.symbol),db.push(Xa.changed[fb].oldValue.symbol);Qa?(Ia.defaultSymbol&&db.push(Ia.defaultSymbol),xa.defaultSymbol&&cb.push(xa.defaultSymbol)):Ia.defaultSymbol&&cb.length&&db.push(xa.defaultSymbol);this._applySymbolSetDiff(cb,
db,xa);delete ta.diff.defaultSymbol;delete ta.diff.uniqueValueInfos;return!0}return!1};La._calculateUnchangedSymbolMapping=function(ta,xa,Ia){if("unique-value"!==xa?.type||"unique-value"!==Ia?.type||k.isSome(ta)&&"partial"!==ta.type)return[];const Qa=cb=>k.isSome(cb)?cb.id:null;var Xa=ta&&ta.diff;ta=Xa&&Xa.defaultSymbol;if(Xa=Xa&&Xa.uniqueValueInfos)Xa=Xa.unchanged.map(cb=>({oldId:Qa(cb.oldValue.symbol),newId:Qa(cb.newValue.symbol)}));else{Xa=[];for(const cb of Ia.uniqueValueInfos){const db=Qa(cb.symbol),
fb=xa.uniqueValueInfos.find(jb=>jb.value===cb.value);fb&&db!==Qa(fb.symbol)&&Xa.push({oldId:db,newId:Qa(fb.symbol)})}}!ta&&Ia.defaultSymbol&&Xa.push({oldId:Qa(Ia.defaultSymbol),newId:Qa(xa.defaultSymbol)});return Xa};La._updateSymbolMapping=function(ta,xa){const Ia=k.isSome(xa)&&xa?"string"===typeof xa?xa:xa.id:null;if(ta&&ta!==Ia){var Qa=this._graphicsBySymbol.get(ta);this._graphicsBySymbol.delete(ta);void 0!==Qa&&this._graphicsBySymbol.set(Ia,Qa);Qa=this._symbols.get(ta);void 0!==Qa&&(this._symbols.delete(ta),
this._symbols.set(Ia,Qa),k.isSome(Qa)&&(ta="string"===typeof xa?null:xa,k.isSome(ta)?Qa.symbol=ta:Qa.symbol.id=Ia))}};La._updateUnchangedSymbolMappings=function(ta,xa,Ia){ta=this._calculateUnchangedSymbolMapping(ta,xa,Ia);for(const {oldId:Qa,newId:Xa}of ta)this._updateSymbolMapping(Qa,Xa)};La._applyRendererDiff=function(ta,xa,Ia){if(this._diffHasSymbolChange(ta))return!1;if(xa instanceof e&&Ia instanceof e&&this._applyUniqueValueRendererDiff(ta,xa,Ia)&&0===Object.keys(ta.diff).length)return!0;for(const [Qa]of this._graphicsBySymbol)if(Ia=
this._symbols.get(Qa),k.isSome(Ia))switch(Ia.applyRendererDiff(ta,xa)){case ca.ApplyRendererDiffResult.Recreate_Symbol:this._recreateSymbol(Qa);break;case ca.ApplyRendererDiffResult.Recreate_Graphics:this._recreateGraphicsForSymbol(Qa)}return!0};La.opacityChange=function(){this.forEachGraphics3DSymbol((ta,xa)=>ta.globalPropertyChanged("opacity",xa));this._updateStageLayerVisibility()};La._slicePlaneEnabledChange=function(ta){ta!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=
ta,this.stageLayer.isSliceable=ta,this.forEachGraphics3DSymbol((xa,Ia)=>xa.globalPropertyChanged("slicePlaneEnabled",Ia)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),this._labeler&&this._labeler.slicePlaneEnabledChange())};La._physicalBasedRenderingChange=function(ta){this.symbolCreationContext.physicalBasedRenderingEnabled=ta;this.forEachGraphics3DSymbol((xa,Ia,Qa)=>{xa.globalPropertyChanged("physicalBasedRenderingEnabled",Ia)||this._recreateSymbol(Qa)})};La._skipHighSymbolLoDsChange=
function(ta){this.symbolCreationContext.skipHighSymbolLods=ta;this.forEachGraphics3DSymbol((xa,Ia,Qa)=>this._recreateSymbol(Qa))};La._pixelRatioChange=function(){this.forEachGraphics3DSymbol((ta,xa,Ia)=>{ta.globalPropertyChanged("pixelRatio",xa)||this._recreateSymbol(Ia)})};La._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=D.schedule(()=>{this._updatingPendingLoadedGraphicsChange=
null})};La.setClippingExtent=function(ta,xa){const Ia=this.symbolCreationContext.clippingExtent,Qa=E.create();oa.toBoundingRect(ta,Qa,xa)?this.symbolCreationContext.clippingExtent=H.fromRect(H.create(),Qa):this.symbolCreationContext.clippingExtent=null;return!H.equals(this.symbolCreationContext.clippingExtent,Ia)};La.modifyGraphics3DGraphicVisibilities=function(ta){let xa=!1;this.graphics3DGraphics.forEach(Ia=>{ta(Ia)&&(xa=!0)});xa&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor.setDirty())};
La.forEachGraphics3DSymbol=function(ta){for(const [xa,Ia]of this._symbols){if(k.isNone(Ia))break;const Qa=this._graphicsBySymbol.get(xa);ta(Ia,Qa||Oa,xa)}};La.updateAllGraphicsVisibility=function(){k.isSome(this._filterVisibility)&&this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(ta=>{const xa=this._updateUserVisibility(ta);ta=k.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(ta);return xa||ta})};La._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(ta=>
ta.setVisibilityFlag(X.VisibilityFlag.USER_SETTING,!1,X.VisibilityGroup.GRAPHIC))};La._validateRenderer=function(ta){(ta=S.validateTo3D(ta,{geometryType:this.layer?.geometryType}))&&Sa.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,ta.message)};La._volatileGraphicsUpdated=function(){this._labeler?.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};La._cleanupSymbols=function(){if(!(0<
this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var ta=!1;this._symbols.forEach((xa,Ia)=>{if(!(k.isNone(xa)||0<xa.referenced)){var Qa=this._graphicsBySymbol.get(Ia);Qa&&0!==Qa.size||(this._graphicsBySymbol.delete(Ia),this._symbols.delete(Ia),k.destroyMaybe(xa),ta=!0)}});ta&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};b._createClass(Ua,[{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new ea.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,
spatialReference:this._viewSpatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}},{key:"numberOfGraphics",get:function(){return this._numberOfGraphics}},{key:"effectiveUpdatePolicy",get:function(){return k.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?Aa.UpdatePolicy.ASYNC:k.unwrapOr(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"featureStore",
get:function(){return this._featureStore}},{key:"initializePromise",get:function(){return this._initializePromise}},{key:"scaleVisibility",get:function(){return this._scaleVisibility}},{key:"elevationAlignment",get:function(){return this._elevationAlignment}},{key:"objectStates",get:function(){return this._objectStates}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"updating",get:function(){return!!(0<this._graphicsWaitingForSymbol.size||this.running||this._elevationAlignment?.updating||
k.isSome(this._scaleVisibility)&&this._scaleVisibility.updating||k.isSome(this._filterVisibility)&&this._filterVisibility.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||0<this._loadingSymbols)}},{key:"running",get:function(){return 0<this._pendingUpdates.size||!!this._spatialIndex?.updating}},{key:"suspendedOrOutsideOfView",get:function(){return this.owner.suspended||this.owner.suspendInfo?.outsideOfView}},
{key:"updatingRemaining",get:function(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}},{key:"displayFeatureLimit",get:function(){var ta=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const xa=ta?ta.graphics3D.minTotalNumberOfFeatures:0,Ia=ta?ta.graphics3D.maxTotalNumberOfFeatures:0;ta=ta?ta.graphics3D.maxTotalNumberOfPrimitives:0;const Qa=this.averageSymbolComplexity;var Xa=Math.max(1,
k.isSome(Qa)?Qa.primitivesPerFeature:1),cb=k.isSome(Qa)&&0<Qa.drawCallsPerFeature?Ia/Qa.drawCallsPerFeature*.3:Ia;Xa=Math.max(xa,Math.min(Ia,Math.ceil(ta/Xa),cb));return(cb=this._get("displayFeatureLimit"))&&cb.minimumTotalNumberOfFeatures===xa&&cb.maximumTotalNumberOfFeatures===Ia&&cb.maximumTotalNumberOfPrimitives===ta&&cb.averageSymbolComplexity===Qa&&cb.maximumNumberOfFeatures===Xa?cb:{minimumTotalNumberOfFeatures:xa,maximumTotalNumberOfFeatures:Ia,maximumTotalNumberOfPrimitives:ta,averageSymbolComplexity:Qa,
maximumNumberOfFeatures:Xa}}},{key:"averageSymbolComplexity",get:function(){const ta=da.averageSymbolComplexities(this._symbolComplexities),xa=this._get("averageSymbolComplexity");return 0===ta.numComplexities||k.isSome(xa)&&(ta.estimated&&(xa.primitivesPerFeature>=ta.primitivesPerFeature||xa.primitivesPerCoordinate>=ta.primitivesPerCoordinate||xa.drawCallsPerFeature>=ta.drawCallsPerFeature)||xa.primitivesPerFeature===ta.primitivesPerFeature&&xa.primitivesPerCoordinate===ta.primitivesPerCoordinate&&
xa.drawCallsPerFeature===ta.drawCallsPerFeature)?xa:ta}},{key:"usedMemory",get:function(){const ta=k.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,xa=this._getSymbolComplexitiesUsed().reduce((Ia,Qa)=>Ia+Qa.memory.resourceBytes,0);return this._usedMemory+ta+xa}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this._numberOfGraphics?20<(this._pendingAdds+this._pendingRemoves)/this._numberOfGraphics?
0:this._usedMemory/this._numberOfGraphics:k.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"_symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},
{key:"_objectIdField",get:function(){return this.layer.objectIdField}},{key:"graphics3DGraphicsByObjectID",get:function(){const ta=this.owner.layer&&this.owner.layer.objectIdField;if(!ta)return null;const xa=new Map;this.graphics3DGraphics.forEach(Ia=>{if(Ia){var Qa=this._getGraphicObjectID(Ia.graphic,ta);k.isSome(Qa)&&xa.set(Qa,Ia)}});return xa}},{key:"labelsEnabled",get:function(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this._pendingUpdates.size)return"unknown";
let ta=0,xa=0;return C.someMap(this._symbols,(Ia,Qa)=>{if(k.isSome(Ia)){Ia=Ia.getFastUpdateStatus();if(0<Ia.loading)return!0;this._graphicsBySymbol.has(Qa)&&(xa+=Ia.fast,ta+=Ia.slow)}return!1})?"unknown":0<=xa&&0===ta?"fast":0<=ta&&0===xa?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(ta=>({symbolId:ta,graphics:[...this._graphicsBySymbol.get(ta).keys()].sort()})),
graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:ta=>{this.forcedUpdatePolicy=ta}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this._graphicsWithoutSymbol.size,pending:this._pendingUpdates.size}}}]);return Ua}(t);a.Graphics3DCore.tmpVec=
P.create();c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_elevationInfoChangeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_initializePromise",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_spatialIndex",void 0);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_labeler",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_objectStates",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"forcedUpdatePolicy",void 0);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([F.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"owner",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"componentFactories",void 0);c.__decorate([F.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"featureStore",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"initializePromise",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"objectStates",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"filterVisibility",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);c.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);c.__decorate([F.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives",
"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);c.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_objectIdField",
null);a.Graphics3DCore=ya=c.__decorate([L.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var ja;(function(Va){Va[Va.NEW=0]="NEW";Va[Va.LOADING=1]="LOADING";Va[Va.READY=2]="READY";Va[Va.REJECTED=3]="REJECTED"})(ja||(ja={}));let Ta=function(){function Va(){this.renderingInfo=this.add=null;this.state=ja.NEW;this.remove=null}Va.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=ja.NEW;this.remove=this.abortController=null};return Va}();const qa=P.create(),
Ea=P.create(),Oa=new Map;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,b,c,r,m){function n(d){return r.isNone(d)||"simple"===d.type||"unique-value"===d.type||"class-breaks"===d.type||"dictionary"===d.type||"heatmap"===d.type}function p(d,f){if(!f)return null;f=Array.isArray(f)?
f:[f];if(0<f.length){const e=f.map(A=>A.details.symbol.type||A.details.symbol.declaredClass).filter(A=>!!A);e.sort();const l=[];e.forEach((A,t)=>{0!==t&&A===e[t-1]||l.push(A)});return new c("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${l.join(", ")}) which are not supported in 3D`,{renderer:d,symbolErrors:f})}return null}function g(d,f){const e={...m.defaultTo3DOptions,...f};f=d.uniqueValueInfos?.map(A=>m.to3D(A.symbol,e).error).filter(r.isSome);const l=m.to3D(d.defaultSymbol,
e);l.error&&f?.unshift(l.error);return p(d,f)}function h(d){const f=d.classBreakInfos.map(l=>m.to3D(l.symbol).error).filter(r.isSome),e=m.to3D(d.defaultSymbol);e.error&&f.unshift(e.error);return p(d,f)}a.isSupportedRenderer3D=n;a.validateTo3D=function(d,f){if(r.isNone(d))return null;if(!n(d))return new c("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${d.type||d.declaredClass}'`,{renderer:d});switch(d.type){case "simple":return p(d,m.to3D(d.symbol).error);case "unique-value":return g(d,
f);case "class-breaks":return h(d)}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){const e=p.fromSimpleMarkerSymbol(d.defaultPointSymbol2D),l=m.fromSimpleLineSymbol(d.defaultPolylineSymbol2D),
A=g.fromSimpleFillSymbol(d.defaultPolygonSymbol2D),t=new n({symbolLayers:[new r({material:{color:f.defaultColor},edges:new h({size:"1px",color:f.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(w){if(c.isNone(w))return null;switch(w.type){case "mesh":return t;case "point":case "multipoint":return e;case "polyline":return l;case "polygon":case "extent":return A}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){a.Graphics3DFeatureStore=function(u){function z(B){var C=u.call(this,B)||this;C.events=new m;C.hasZ=null;C.hasM=null;C.objectIdField=null;C.viewSpatialReference=null;C.featureAdapter={getAttribute(k,q){return"graphic"in k?k.graphic.attributes[q]:t.optimizedFeatureQueryEngineAdapter.getAttribute(k,q)},getAttributes(k){return"graphic"in k?k.graphic.attributes:t.optimizedFeatureQueryEngineAdapter.getAttributes(k)},getObjectId:k=>"graphic"in k?e.getObjectId(k.graphic,
C.objectIdField):t.optimizedFeatureQueryEngineAdapter.getObjectId(k),getGeometry:k=>"graphic"in k?k.getAsOptimizedGeometry(C.hasZ,C.hasM):t.optimizedFeatureQueryEngineAdapter.getGeometry(k),getCentroid:(k,q)=>{if("graphic"in k){let x=null;n.isSome(k.centroid)?x=k.centroid:"point"===k.graphic.geometry.type&&f.projectPoint(k.graphic.geometry,w,C.viewSpatialReference)&&(x=w);k=Array(2+(q.hasZ?1:0)+(q.hasM?1:0));n.isNone(x)?(k[0]=0,k[1]=0,k[2]=0,k[3]=0):(k[0]=x.x,k[1]=x.y,q.hasZ&&(k[2]=x.hasZ?x.z:0),
q.hasM&&(k[q.hasZ?3:2]=x.hasM?x.m:0));return new A([],k)}return t.optimizedFeatureQueryEngineAdapter.getCentroid(k,q)},cloneWithGeometry:(k,q)=>"graphic"in k?new l.OptimizedFeature(q,C.featureAdapter.getAttributes(k),null,C.featureAdapter.getObjectId(k)):t.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(k,q)};return C}b._inheritsLoose(z,u);var y=z.prototype;y.forEachInBounds=function(B,C){this.getSpatialIndex().forEachInBounds(B,C)};y.forEachBounds=function(B,C,k){const q=this.getSpatialIndex();
for(const x of B)B=this.featureAdapter.getObjectId(x),n.isSome(q.getBounds(B,k))&&C(k)};return z}(r);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"toArray",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);
c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);c.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=c.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],
a.Graphics3DFeatureStore);const w={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../../../core/maybe","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,c,r,m){a.optimizedFeatureQueryEngineAdapter={getObjectId(n){return n.objectId},getAttributes(n){return n.attributes},getAttribute(n,
p){return n.attributes[p]},cloneWithGeometry(n,p){return new r.OptimizedFeature(p,n.attributes,null,n.objectId)},getGeometry(n){return n.geometry},getCentroid(n,p){b.isNone(n.centroid)&&(n.centroid=c.getCentroidOptimizedGeometry(new m,n.geometry,p.hasZ,p.hasM));return n.centroid}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,b){function c(m,n,p,g,h,d,f=1){d=h?
d?4:3:d?3:2;let e=p,l=p+d,A=0,t=0,w=p=0,u=0;for(let z=0,y=g-1;z<y;z++,e+=d,l+=d){g=n[e];const B=n[e+1],C=n[e+2],k=n[l],q=n[l+1],x=n[l+2];let v=g*q-k*B;w+=v;A+=(g+k)*v;t+=(B+q)*v;h&&(v=g*x-k*C,p+=(C+x)*v,u+=v);g<m[0]&&(m[0]=g);g>m[1]&&(m[1]=g);B<m[2]&&(m[2]=B);B>m[3]&&(m[3]=B);h&&(C<m[4]&&(m[4]=C),C>m[5]&&(m[5]=C))}0<w*f&&(w*=-1);0<u*f&&(u*=-1);if(!w)return null;m=[A,t,.5*w];h&&(m[3]=p,m[4]=.5*u);return m}function r(m,n,p,g,h){h=g?h?4:3:h?3:2;let d=n,f=n+h,e=0,l=0,A=0,t=0;for(let y=0,B=p-1;y<B;y++,
d+=h,f+=h){var w=m[d];const C=m[d+1],k=m[d+2],q=m[f],x=m[f+1],v=m[f+2];if(g){var u=q-w;var z=x-C;const D=v-k;u=Math.sqrt(u*u+z*z+D*D)}else u=q-w,z=x-C,u=Math.sqrt(u*u+z*z);u&&(e+=u,g?(w=[w+.5*(q-w),C+.5*(x-C),k+.5*(v-k)],l+=u*w[0],A+=u*w[1],t+=u*w[2]):(w=[w+.5*(q-w),C+.5*(x-C)],l+=u*w[0],A+=u*w[1]))}return 0<e?g?[l/e,A/e,t/e]:[l/e,A/e]:0<p?g?[m[n],m[n+1],m[n+2]]:[m[n],m[n+1]]:null}a.getCentroidOptimizedGeometry=function(m,n,p,g,h){if(b.isNone(n)||!n.lengths.length)return null;const d="upperLeft"===
h?.originPosition?-1:1;m.lengths.length&&(m.lengths.length=0);m.coords.length&&(m.coords.length=0);h=m.coords;const f=[],e=p?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:A}=n,t=p?g?4:3:g?3:2;let w=0;for(var u of l){const z=c(e,A,w,u,p,g,d);z&&f.push(z);w+=u*t}f.sort((z,y)=>
{let B=d*z[2]-d*y[2];0===B&&p&&(B=z[4]-y[4]);return B});f.length&&(u=6*f[0][2],h[0]=f[0][0]/u,h[1]=f[0][1]/u,p&&(u=6*f[0][4],h[2]=0!==u?f[0][3]/u:0),h[0]<e[0]||h[0]>e[1]||h[1]<e[2]||h[1]>e[3]||p&&(h[2]<e[4]||h[2]>e[5]))&&(h.length=0);if(!h.length)if(n=n.lengths[0]?r(A,0,l[0],p,g):null)h[0]=n[0],h[1]=n[1],p&&2<n.length&&(h[2]=n[2]);else return null;return m};a.lineCentroid=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],
function(a){a.Graphics3DSymbolCreationContext=function(b){this.schedule=b;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=
function(){};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,c){a.make=function(r,m,n){let p;switch(r.type){case "point-3d":p=b;break;default:p=c}return new p(r,m,n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),
function(a,b,c,r,m,n){return function(p){function g(d,f,e){d=p.call(this,d,f,e)||this;d._calloutSymbolLayer=null;d.symbol.hasVisibleCallout()&&(d._calloutSymbolLayer=m.make(d.symbol,f));return d}a._inheritsLoose(g,p);var h=g.prototype;h.doLoad=function(){var d=a._asyncToGenerator(function*(f){const e=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{yield p.prototype.doLoad.call(this,f),r.throwIfAborted(f)}catch(l){throw this._calloutSymbolLayer?.abortLoad(),l;}e&&(yield e)});
return function(f){return d.apply(this,arguments)}}();h.destroy=function(){p.prototype.destroy.call(this);this._calloutSymbolLayer=c.destroyMaybe(this._calloutSymbolLayer)};h.createGraphics3DGraphic=function(d,f){f=p.prototype.createGraphics3DGraphic.call(this,d,f);c.isSome(this._calloutSymbolLayer)&&c.isSome(f)&&(d=this._createCalloutGraphic(d),c.isSome(d)&&f.addAuxiliaryGraphic(d));return f};h.globalPropertyChanged=function(d,f){return p.prototype.globalPropertyChanged.call(this,d,f)?this._calloutSymbolLayer?
this._calloutSymbolLayer.globalPropertyChanged(d,f,e=>this._getCalloutGraphicLayer(e)):!0:!1};h.updateGeometry=function(d,f){const e=p.prototype.updateGeometry.call(this,d,f);return e&&this._calloutSymbolLayer&&(d=this._getCalloutGraphicLayer(d))?this._calloutSymbolLayer.updateGeometry(d,f):e};h._createCalloutGraphic=function(d){const f=d.renderingInfo;d.renderingInfo={renderer:f.renderer,symbol:f.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,
materialCollection:null};return this._calloutSymbolLayer.createGraphics3DGraphic(d)};h._getCalloutGraphicLayer=function(d){for(const f of d._auxiliaryGraphics)if(f.graphics3DSymbolLayer===this._calloutSymbolLayer)return f};return g}(n)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,r){let m=function(){function n(g){this._graphicsCore=g;this._idToState=
new Map;this._states=new Set;const h=g.owner.layer&&g.owner.layer.objectIdField;h?(this._getGraphicId=d=>r.getObjectId(d,h),this._getGraphics3DGraphicById=d=>this._graphicsCore.getGraphics3DGraphicByObjectId(d)):(this._getGraphicId=d=>d.uid,this._getGraphics3DGraphicById=d=>this._graphicsCore.getGraphics3DGraphicById(d))}var p=n.prototype;p.destroy=function(){this._idToState.clear();this._states.forEach((g,h)=>this.remove(h))};p.add=function(g){const h={remove:()=>this.remove(g)};if(this._states.has(g))return h;
const d=this._getGraphicId(g.graphic),f=this._getGraphics3DGraphicById(d);this._states.has(g)||this._states.add(g);this._ensureStateList(d).push(g);g.displaying=c.isSome(f)?f.isVisible():!1;g.isDraped=c.isSome(f)?f.isDraped:!1;g.tracking=!0;c.isSome(f)&&g.emit("changed",{});return h};p.remove=function(g){if(this._states.has(g)){if(this._idToState.size){const h=this._getGraphicId(g.graphic),d=this._idToState.get(h);d&&(b.remove(d,g),0===d.length&&this._idToState.delete(h))}this._states.delete(g);g.tracking=
!1;g.displaying=!1}};p.addGraphic=function(g){this._forEachState(g,h=>{h.displaying=g.isVisible();h.isDraped=g.isDraped;h.emit("changed",{})})};p.removeGraphic=function(g){this._forEachState(g,h=>{h.displaying=!1;h.isDraped=!1})};p.updateGraphicGeometry=function(g){this._forEachState(g,h=>{h.emit("changed",{})})};p.updateGraphicVisibility=function(g){this._forEachState(g,h=>{h.displaying=g.isVisible()})};p.allGraphicsDeleted=function(){this._states.forEach(g=>{g.displaying=!1})};p._ensureStateList=
function(g){var h=this._idToState.get(g);if(h)return h;h=[];this._idToState.set(g,h);return h};p._forEachState=function(g,h){0!==this._states.size&&0!==this._idToState.size&&(g=this._getGraphicId(g.graphic),g=this._idToState.get(g),null!=g&&g.forEach(h))};return n}();a.GraphicStateTracking=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){a.SpatialIndex2D=function(t){function w(z){z=t.call(this,z)||this;z._index=new f.PooledRBush(9,m("esri-csp-restrictions")?y=>({minX:y.extent[0],minY:y.extent[1],maxX:y.extent[2],maxY:y.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);z._missing=new Set;z._boundsByFeature=new Map;z.spatialReference=null;z.hasZ=null;z.hasM=null;z.objectIdField=null;z.updating=!1;return z}b._inheritsLoose(w,t);var u=w.prototype;u.setup=function(z){this._addMany(z)};
u.destroy=function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};u.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};u.queryGraphicUIDsInExtent=function(z,y,B){!n.isNone(y)&&y.equals(this.spatialReference)&&(A.minX=z[0],A.minY=z[1],A.maxX=z[2],A.maxY=z[3],this.update(),this._index.search(A,C=>B(C.graphic.uid)))};u.add=function(z){this._missing.add(z);
this.updating=!0};u.remove=function(z){this._missing.delete(z)?this.updating=0<this._missing.size:(this._index.remove(z),z=l.getObjectId(z.graphic,this._get("objectIdField")),null!=z&&this._boundsByFeature.delete(z))};u._addMany=function(z){if(0!==z.length){var y=this._get("objectIdField");for(const B of z){B.computeExtent(this.spatialReference);const C=l.getObjectId(B.graphic,y);null!=C&&this._boundsByFeature.set(C,B.extent)}this._index.load(z)}};u.clear=function(){this._index.clear();this._missing.clear();
this._boundsByFeature.clear();this.updating=!1};u.forEachInBounds=function(z,y){A.minX=z[0];A.minY=z[1];A.maxX=z[2];A.maxY=z[3];this.update();this._index.search(A,B=>{y(B)})};u.getBounds=function(z,y){this.update();return(z=this._boundsByFeature.get(z))?e.fromRect(y,z):null};b._createClass(w,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return w}(r);c.__decorate([p.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);c.__decorate([p.property({constructOnly:!0})],
a.SpatialIndex2D.prototype,"hasZ",void 0);c.__decorate([p.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);c.__decorate([p.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);c.__decorate([p.property()],a.SpatialIndex2D.prototype,"updating",void 0);c.__decorate([p.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=c.__decorate([d.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);
const A={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,b,c,r,m,n){function p(v,D){g(v,0,v.children.length,D,v)}function g(v,D,F,G,J){J||(J=new q([]));J.minX=Infinity;J.minY=Infinity;J.maxX=-Infinity;J.maxY=-Infinity;for(let L=
D,K;L<F;L++)K=v.children[L],h(J,v.leaf?G(K):K);return J}function h(v,D){v.minX=Math.min(v.minX,D.minX);v.minY=Math.min(v.minY,D.minY);v.maxX=Math.max(v.maxX,D.maxX);v.maxY=Math.max(v.maxY,D.maxY)}function d(v,D){return v.minX-D.minX}function f(v,D){return v.minY-D.minY}function e(v){return(v.maxX-v.minX)*(v.maxY-v.minY)}function l(v){return v.maxX-v.minX+(v.maxY-v.minY)}function A(v,D){return v.minX<=D.minX&&v.minY<=D.minY&&D.maxX<=v.maxX&&D.maxY<=v.maxY}function t(v,D){return D.minX<=v.maxX&&D.minY<=
v.maxY&&D.maxX>=v.minX&&D.maxY>=v.minY}function w(v,D,F,G,J){for(D=[D,F];D.length;){F=r.assumeNonNull(D.pop());const L=r.assumeNonNull(D.pop());if(F-L<=G)continue;const K=L+Math.ceil((F-L)/G/2)*G;n.quickselect(v,K,L,F,J);D.push(L,K,K,F)}}let u=function(){function v(F=9,G){this._compareMinX=d;this._compareMinY=f;this._toBBox=J=>J;this._maxEntries=Math.max(4,F||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));G&&("function"===typeof G?this._toBBox=G:this._initFormat(G));this.clear()}var D=
v.prototype;D.destroy=function(){this.clear();z.prune();y.prune();B.prune();C.prune()};D.all=function(F){this._all(this._data,F)};D.search=function(F,G){let J=this._data;const L=this._toBBox;if(t(F,J))for(z.clear();J;){for(let K=0,O=J.children.length;K<O;K++){const P=J.children[K],N=J.leaf?L(P):P;t(F,N)&&(J.leaf?G(P):A(F,N)?this._all(P,G):z.push(P))}J=z.pop()}};D.collides=function(F){let G=this._data;const J=this._toBBox;if(!t(F,G))return!1;for(z.clear();G;){for(let L=0,K=G.children.length;L<K;L++){const O=
G.children[L],P=G.leaf?J(O):O;if(t(F,P)){if(G.leaf||A(F,P))return!0;z.push(O)}}G=z.pop()}return!1};D.load=function(F){if(!F.length)return this;if(F.length<this._minEntries){for(let G=0,J=F.length;G<J;G++)this.insert(F[G]);return this}F=this._build(F.slice(0,F.length),0,F.length-1,0);if(this._data.children.length)if(this._data.height===F.height)this._splitRoot(this._data,F);else{if(this._data.height<F.height){const G=this._data;this._data=F;F=G}this._insert(F,this._data.height-F.height-1,!0)}else this._data=
F;return this};D.insert=function(F){F&&this._insert(F,this._data.height-1);return this};D.clear=function(){this._data=new q([]);return this};D.remove=function(F){if(!F)return this;let G=this._data,J=null,L=0,K=!1,O;const P=this._toBBox(F);B.clear();for(C.clear();G||0<B.length;){G||(G=r.assumeNonNull(B.pop()),J=B.data[B.length-1],L=C.pop()??0,K=!0);if(G.leaf&&(O=c.indexOf(G.children,F,G.children.length,G.indexHint),-1!==O)){G.children.splice(O,1);B.push(G);this._condense(B);break}K||G.leaf||!A(G,P)?
J?(L++,G=J.children[L],K=!1):G=null:(B.push(G),C.push(L),L=0,J=G,G=G.children[0])}return this};D.toJSON=function(){return this._data};D.fromJSON=function(F){this._data=F;return this};D._all=function(F,G){for(y.clear();F;){if(!0===F.leaf)for(const J of F.children)G(J);else y.pushArray(F.children);F=y.pop()??null}};D._build=function(F,G,J,L){var K=J-G+1,O=this._maxEntries;if(K<=O)return F=new q(F.slice(G,J+1)),p(F,this._toBBox),F;L||(L=Math.ceil(Math.log(K)/Math.log(O)),O=Math.ceil(K/O**(L-1)));const P=
new x([]);P.height=L;K=Math.ceil(K/O);O=K*Math.ceil(Math.sqrt(O));for(w(F,G,J,O,this._compareMinX);G<=J;G+=O){const N=Math.min(G+O-1,J);w(F,G,N,K,this._compareMinY);for(let H=G;H<=N;H+=K)P.children.push(this._build(F,H,Math.min(H+K-1,N),L-1))}p(P,this._toBBox);return P};D._chooseSubtree=function(F,G,J,L){for(;;){L.push(G);if(!0===G.leaf||L.length-1===J)break;let K=Infinity,O=Infinity,P=void 0;for(let N=0,H=G.children.length;N<H;N++){const E=G.children[N],I=e(E),M=(Math.max(E.maxX,F.maxX)-Math.min(E.minX,
F.minX))*(Math.max(E.maxY,F.maxY)-Math.min(E.minY,F.minY))-I;M<O?(O=M,K=I<K?I:K,P=E):M===O&&I<K&&(K=I,P=E)}G=P||G.children[0]}return G};D._insert=function(F,G,J){var L=this._toBBox;J=J?F:L(F);B.clear();L=this._chooseSubtree(J,this._data,G,B);L.children.push(F);for(h(L,J);0<=G;)if(B.data[G].children.length>this._maxEntries)this._split(B,G),G--;else break;this._adjustParentBBoxes(J,B,G)};D._split=function(F,G){const J=F.data[G];var L=J.children.length;const K=this._minEntries;this._chooseSplitAxis(J,
K,L);(L=this._chooseSplitIndex(J,K,L))?(L=J.children.splice(L,J.children.length-L),L=J.leaf?new q(L):new x(L),L.height=J.height,p(J,this._toBBox),p(L,this._toBBox),G?F.data[G-1].children.push(L):this._splitRoot(J,L)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(F,G){this._data=new x([F,G]);this._data.height=F.height+1;p(this._data,this._toBBox)};D._chooseSplitIndex=function(F,G,J){let L,K,O=void 0;L=K=Infinity;for(let N=G;N<=J-G;N++){var P=
g(F,0,N,this._toBBox);const H=g(F,N,J,this._toBBox),E=Math.max(0,Math.min(P.maxX,H.maxX)-Math.max(P.minX,H.minX))*Math.max(0,Math.min(P.maxY,H.maxY)-Math.max(P.minY,H.minY));P=e(P)+e(H);E<L?(L=E,O=N,K=P<K?P:K):E===L&&P<K&&(K=P,O=N)}return O};D._chooseSplitAxis=function(F,G,J){const L=F.leaf?this._compareMinX:d,K=F.leaf?this._compareMinY:f,O=this._allDistMargin(F,G,J,L);G=this._allDistMargin(F,G,J,K);O<G&&F.children.sort(L)};D._allDistMargin=function(F,G,J,L){F.children.sort(L);L=this._toBBox;var K=
g(F,0,G,L);const O=g(F,J-G,J,L);let P=l(K)+l(O);for(let N=G;N<J-G;N++){const H=F.children[N];h(K,F.leaf?L(H):H);P+=l(K)}for(J=J-G-1;J>=G;J--)K=F.children[J],h(O,F.leaf?L(K):K),P+=l(O);return P};D._adjustParentBBoxes=function(F,G,J){for(;0<=J;J--)h(G.data[J],F)};D._condense=function(F){for(let G=F.length-1;0<=G;G--){const J=F.data[G];if(0===J.children.length)if(0<G){const L=F.data[G-1],K=L.children;K.splice(c.indexOf(K,J,K.length,L.indexHint),1)}else this.clear();else p(J,this._toBBox)}};D._initFormat=
function(F){const G=["return a"," - b",";"];this._compareMinX=new Function("a","b",G.join(F[0]));this._compareMinY=new Function("a","b",G.join(F[1]));this._toBBox=new Function("a","return {minX: a"+F[0]+", minY: a"+F[1]+", maxX: a"+F[2]+", maxY: a"+F[3]+"};")};return v}();const z=new m,y=new m,B=new m,C=new m({deallocator:void 0});m=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let k=function(v){function D(){var F=v.apply(this,arguments)||this;F.height=1;F.indexHint=new c.PositionHint;
return F}b._inheritsLoose(D,v);return D}(m),q=function(v){function D(F){var G=v.call(this)||this;G.children=F;G.leaf=!0;return G}b._inheritsLoose(D,v);return D}(k),x=function(v){function D(F){var G=v.call(this)||this;G.children=F;G.leaf=!1;return G}b._inheritsLoose(D,v);return D}(k);a.BBox=m;a.PooledRBush=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(r){r=
r();void 0!==r&&(c.exports=r)})(function(){function r(p,g,h,d,f){for(;d>h;){if(600<d-h){var e=d-h+1,l=g-h+1,A=Math.log(e),t=.5*Math.exp(2*A/3);A=.5*Math.sqrt(A*t*(e-t)/e)*(0>l-e/2?-1:1);r(p,g,Math.max(h,Math.floor(g-l*t/e+A)),Math.min(d,Math.floor(g+(e-l)*t/e+A)),f)}e=p[g];l=h;t=d;m(p,h,g);for(0<f(p[d],e)&&m(p,h,d);l<t;){m(p,l,t);l++;for(t--;0>f(p[l],e);)l++;for(;0<f(p[t],e);)t--}0===f(p[h],e)?m(p,h,t):(t++,m(p,t,d));t<=g&&(h=t+1);g<=t&&(d=t-1)}}function m(p,g,h){var d=p[g];p[g]=p[h];p[h]=d}function n(p,
g){return p<g?-1:p>g?1:0}return function(p,g,h,d,f){r(p,g,h||0,d||p.length-1,f||n)}})})(b);a.quickselect=b.exports})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B){a.StageLayerElevationProvider=function(F){function G(L){L=F.call(this,L)||this;L._elevationOffset=0;L._layerHandes=new n;return L}b._inheritsLoose(G,F);var J=G.prototype;J.initialize=function(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=y.newIntersector(this.view.state.viewingMode);this._intersector.options.store=B.StoreResults.MIN;var L=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=L[2];this._zmax=L[5];L=this.stageLayer.events;this._layerHandes.add([L.on("layerObjectAdded",K=>this._objectChanged(K.object)),L.on("layerObjectRemoved",K=>this._objectChanged(K.object)),L.on("objectGeometryAdded",K=>this._objectChanged(K.object)),L.on("objectGeometryRemoved",K=>this._objectChanged(K.object)),L.on("vertexAttrsUpdated",K=>this._objectChanged(K.object)),L.on("objectTransformation",K=>this._objectChanged(K))])};J.dispose=function(){this._layerHandes.destroy()};
J.elevationInfoChanged=function(){const L=null!=this.layer?this.layer.elevationInfo:null;if(null!=L&&"on-the-ground"!==L.mode){const K=h.getMetersPerVerticalUnitForSR(this.layer.spatialReference),O=z.getMetersPerUnit(L.unit);this._elevationOffset=g.unwrapOr(L.offset,0)*O/K}else this._elevationOffset=0};J.getElevation=function(L,K,O,P){x[0]=L;x[1]=K;x[2]=O;if(!this._renderCoordsHelper.toRenderCoords(x,P,x))return p.getLogger(this.declaredClass).error("could not project point for elevation alignment"),
null;L=this._elevationOffset;K=this._zmin+L;this._renderCoordsHelper.setAltitude(v,this._zmax+L,x);this._renderCoordsHelper.setAltitude(D,K,x);this._intersector.reset(v,D,null);this._intersector.intersect(this._intersectLayers,null,1,null,N=>N.metadata&&N.metadata.isElevationSource);return this._intersector.results.min.getIntersectionPoint(x)?this._renderCoordsHelper.getAltitude(x):null};J._objectChanged=function(L){const K=this.spatialReference;if(L.metadata?.isElevationSource&&!g.isNone(K)){w.empty(C);
var {lastValidElevationBB:O}=L.metadata;O.isEmpty()||this._expandExtent(K,O.min,O.max,C);var {min:P,max:N}=L.boundingVolumeWorldSpace;this._expandExtent(K,P,N,C);w.toRect(C,k);this._zmin=Math.min(this._zmin,C[2]);this._zmax=Math.max(this._zmax,C[5]);q.extent=k;q.spatialReference=K;this.emit("elevation-change",q);A.copy(O.min,P);A.copy(O.max,N)}};J._computeLayerExtent=function(L,K){w.empty(C);g.isSome(L)&&K.objects.forAll(O=>this._expandExtent(L,O.boundingVolumeWorldSpace.min,O.boundingVolumeWorldSpace.max,
C));return C};J._expandExtent=function(L,K,O,P){for(let N=0;8>N;++N)x[0]=N&1?K[0]:O[0],x[1]=N&2?K[1]:O[1],x[2]=N&4?K[2]:O[2],this._renderCoordsHelper.fromRenderCoords(x,x,L),w.expandWithVec3(P,x);return P};b._createClass(G,[{key:"spatialReference",get:function(){return this.view?.spatialReference}}]);return G}(m.EventedMixin(r));c.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);c.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);c.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);c.__decorate([d.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=c.__decorate([l.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const C=w.empty(),k=u.empty(),q={spatialReference:null,extent:k,context:"scene"},x=t.create(),v=t.create(),D=t.create();Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/basicInterfaces ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){c=function(t){function w(z){z=t.call(this,z)||this;z._dirtyExtents=new e.ExtentSet;z._globalDirty=!1;z._averageExtentUpdateSize=0;z._dirtyGraphicsSet=new Set;z._handles=new m;z._updateElevation=!1;z.graphicsCoreOwner=null;z.graphicsCore=null;z.events=new r;return z}a._inheritsLoose(w,t);var u=w.prototype;u.initialize=function(){const z=this.graphicsCoreOwner.view.resourceController.scheduler;this._handles.add([this.elevationProvider.on("elevation-change",y=>this._elevationChanged(y)),
p.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),z.registerTask(A.TaskPriority.ELEVATION_ALIGNMENT,this)])};u.destroy=function(){this._dirtyGraphicsSet.clear();this._handles.destroy();this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=this._handles=null};u.clear=function(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")};u._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===
this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))};u.elevationInfoChange=function(){this._globalDirty=!0;this.notifyChange("updating")};u.runTask=function(z){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,z.madeProgress());for(z.run(()=>this._dirtyExtents.merge(z));this.running&&!z.done;)this._updateDirtyGraphics(z),this._updateDirtyExtents(z);this.graphicsCoreOwner.view.deconflictor.setDirty();this.notifyChange("updating")};
u._updateDirtyGraphics=function(z){const y=this.graphicsCoreOwner.view.renderCoordsHelper,B=this.graphicsCore.effectiveUpdatePolicy===l.UpdatePolicy.ASYNC;for(const C of this._dirtyGraphicsSet.keys()){const k=this.graphicsCore.getGraphics3DGraphicById(C);this._dirtyGraphicsSet.delete(C);n.isSome(k)&&(k.alignWithElevation(this.elevationProvider,y,B),z.madeProgress());if(z.done)break}};u._updateDirtyExtents=function(z){for(;!this._dirtyExtents.empty&&!z.done;){const y=this._dirtyExtents.pop(),B=this.elevationProvider.spatialReference;
this.events.emit("invalidate-elevation",{extent:y,spatialReference:B});const C=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(y,B,k=>{const q=this.graphicsCore.getGraphics3DGraphicById(k);n.isSome(q)&&q.needsElevationUpdates()&&this._dirtyGraphicsSet.add(k)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-C)+.9*this._averageExtentUpdateSize;z.madeProgress()}};u._markAllGraphicsElevationDirty=function(){this._dirtyExtents.clear();this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((z,
y)=>this._dirtyGraphicsSet.add(y))};u._elevationChanged=function(z){if("scene"!==z.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:y,spatialReference:B}=z;this.graphicsCoreOwner.suspended?(this._updateElevation||(z=this.graphicsCore.computedExtent)&&y[2]>z.xmin&&y[0]<z.xmax&&y[3]>z.ymin&&y[1]<z.ymax&&(this._updateElevation=!0),this.events.emit("invalidate-elevation",{extent:y,spatialReference:B})):(-Infinity===y[0]?this._globalDirty=
!0:this._dirtyExtents.add(y),this.notifyChange("updating"))}};a._createClass(w,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}},{key:"updatingRemaining",get:function(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}}]);return w}(c);b.__decorate([g.property()],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([g.property()],
c.prototype,"graphicsCore",void 0);b.__decorate([g.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([g.property()],c.prototype,"elevationProvider",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"updatingRemaining",null);return c=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,c,r,m){let n=function(){function p(){this._extents=new c({allocator:h=>h||r.create()});this._tmpExtent=r.create();this._dirty=!1}var g=p.prototype;g.clear=function(){this._extents.clear()};g.add=function(h){this._contains(h)||(this._removeContained(h),r.copy(this._extents.pushNew(),h),this._dirty=!0)};g.pop=function(){this._dirty&&this._mergeTight();
return this._extents.pop()};g.merge=function(h){this._mergeTight(h);return h.hasProgressed};g._mergeTight=function(h=m.noBudget){const d=this._extents,f=new Set;let e=0;for(;e!==d.length;){d.sort((l,A)=>l[0]-A[0]);e=d.length;f.clear();for(let l=0;l<d.length;++l){if(h.done)return;const A=d.getItemAt(l);if(A){for(let t=l+1;t<d.length;++t){const w=d.getItemAt(t);if(null==w||w[0]>=A[2])break;f.add(w)}f.forEach(t=>{if(A!==t)if(t[2]<=A[0])f.delete(t);else{var w=r.area(A),u=r.area(t),z=this._tmpExtent;r.expand(A,
t,z);w+=u;.05>(r.area(z)-w)/w&&(r.copy(A,z),f.delete(t),d.remove(t),h.madeProgress())}});f.add(A)}}}this._dirty=!1};g._contains=function(h){return this._extents.some(d=>r.contains(d,h))};g._removeContained=function(h){this._extents.filterInPlace(d=>!r.contains(h,d))};b._createClass(p,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const h=this;return{containsPoint:d=>h._extents.some(f=>r.containsPoint(f,
d))}}}]);return p}();a.ExtentSet=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){c=function(A){function t(u){u=A.call(this,u)||this;u.suspended=!1;u._extent=null;u._extentIntersectionDirty=!0;u._isVisibleBelowSurfaceInternal=!1;u._handles=new r;u.graphicsCoreOwner=null;u.updating=!0;return u}a._inheritsLoose(t,A);var w=t.prototype;w.initialize=function(){var {graphicsCoreOwner:u}=this;this._extentIntersection=new e.FrustumExtentIntersection({renderCoordsHelper:u.view.renderCoordsHelper});const z=u.view,y=z.basemapTerrain;u=z.resourceController.scheduler;
this._handles.add([z.on("resize",()=>this._viewChange()),n.watch(()=>z.state.camera,()=>this._viewChange(),n.sync),u.registerTask(l.TaskPriority.FRUSTUM_VISIBILITY,this),n.watch(()=>y.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===z.viewingMode?this._isVisibleBelowSurface=!0:this._handles.add([n.watch(()=>[y.baseOpacity,y.wireframe,z.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),n.initial)])};w.destroy=function(){this._set("graphicsCoreOwner",
null);this._extentIntersection=this._extent=null;this._handles=m.destroyMaybe(this._handles)};w._setDirty=function(){this.updating||this._set("updating",!0)};w.setExtent=function(u){this._extent=u;this._extentIntersectionDirty=!0;this._setDirty()};w._viewChange=function(){this._setDirty()};w._elevationBoundsChange=function(){this._setDirty();this._extentIntersectionDirty=!0};w._updateIsVisibleBelowSurface=function(){const u=this.graphicsCoreOwner.view,z=u.basemapTerrain,y=u.map.ground&&u.map.ground.navigationConstraint&&
"none"===u.map.ground.navigationConstraint.type;this._isVisibleBelowSurface="local"===u.viewingMode||!z.opaque||y};w._updateExtentIntersection=function(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var u=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var z=-.3*f.getReferenceEllipsoid(u.spatialReference).radius;else{const {min:y,max:B}=u.basemapTerrain.visibleElevationBounds;z=y-Math.max(1,(B-y)*(1.2-1))}this._extentIntersection.update(this._extent,u.spatialReference,
z)}};w.runTask=function(){this._set("updating",!1);if(this._extent){this._updateExtentIntersection();var u=this.graphicsCoreOwner.view.frustum,z=f.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(u,z))}else this._set("suspended",!1)};a._createClass(t,[{key:"_isVisibleBelowSurface",set:function(u){this._isVisibleBelowSurfaceInternal=u;this._setDirty();this._extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return t}(c);b.__decorate([p.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([p.property({constructOnly:!0})],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils",
"./Graphics3DObjectStateSet"],function(a,b,c,r){let m=function(){function n(g){this._graphicsCore=g;this._stateSets=[]}var p=n.prototype;p.destroy=function(){this._stateSets&&this._stateSets.forEach(g=>g.objectStateSet.removeAll());this._stateSets=null};p.acquireSet=function(g,h){const d=new r.Graphics3DObjectStateSet(g,h);this._stateSets.push(d);g=c.makeHandle(()=>this.releaseSet(d));return{set:d,handle:g}};p.releaseSet=function(g){g.objectStateSet.removeAll();g=this._stateSets?this._stateSets.indexOf(g):
-1;-1!==g&&this._stateSets.splice(g,1)};p._addObjectStateSet=function(g,h){g.addObjectStateSet(h.stateType,h.objectStateSet)};p._removeObjectStateSet=function(g,h){g.removeObjectState(h.objectStateSet)};p.setUid=function(g,h){g.ids.add(h);(h=this._graphicsCore.graphics3DGraphics.get(h))&&this._addObjectStateSet(h,g)};p.setUids=function(g,h){h.forEach(d=>this.setUid(g,d))};p.setObjectIds=function(g,h){h.forEach(d=>g.ids.add(d));this._initializeSet(g)};p.addGraphic=function(g){this._stateSets.forEach(h=>
{!h.paused&&h.hasGraphic(g)&&this._addObjectStateSet(g,h)})};p.removeGraphic=function(g){this._stateSets.forEach(h=>{h.hasGraphic(g)&&this._removeObjectStateSet(g,h)})};p.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(g=>g.objectStateSet.removeAll())};p._initializeSet=function(g){const h=this._graphicsCore.graphics3DGraphics;g.objectIdField?h.forEach(d=>{d&&g.hasGraphic(d)&&this._addObjectStateSet(d,g)}):g.ids.forEach(d=>{(d=h.get(d))&&this._addObjectStateSet(d,g)})};b._createClass(n,
[{key:"test",get:function(){return{states:this._stateSets}}}]);return n}();a.Graphics3DObjectStates=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],function(a,b){let c=function(){function r(m,n){this.stateType=m;this.objectIdField=n;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}r.prototype.hasGraphic=
function(m){return this.objectIdField?this.ids.has(m.graphic.attributes[this.objectIdField]):this.ids.has(m.graphic.uid)};return r}();a.Graphics3DObjectStateSet=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var c;(function(m){m[m.Object=0]="Object";m[m.RenderGeometry=1]="RenderGeometry";m[m.External=2]="External";m[m.COUNT=3]="COUNT"})(c||
(c={}));let r=function(){function m(){this._items=[]}var n=m.prototype;n.addObject=function(p,g){this._items.push({type:c.Object,objectStateId:g,object:p})};n.addRenderGeometry=function(p,g,h){this._items.push({type:c.RenderGeometry,objectStateId:g,renderGeometry:p,owner:h})};n.addExternal=function(p,g){this._items.push({type:c.External,objectStateId:g,remove:p})};n.remove=function(p){for(let g=this._items.length-1;0<=g;--g){const h=this._items[g];h.objectStateId===p&&(this._removeObjectStateItem(h),
this._items.splice(g,1))}};n.removeObject=function(p){for(let g=this._items.length-1;0<=g;--g){const h=this._items[g];h.type===c.Object&&h.object===p&&(this._removeObjectStateItem(h),this._items.splice(g,1))}};n.removeRenderGeometry=function(p){for(let g=this._items.length-1;0<=g;--g){const h=this._items[g];h.type===c.RenderGeometry&&h.renderGeometry===p&&(this._removeObjectStateItem(h),this._items.splice(g,1))}};n.removeAll=function(){this._items.forEach(p=>{this._removeObjectStateItem(p)});this._items=
[]};n._removeObjectStateItem=function(p){switch(p.type){case c.Object:p.objectStateId.channel===b.Object3DState.Highlight?p.object.removeHighlight(p.objectStateId):p.objectStateId.channel===b.Object3DState.MaskOccludee&&p.object.removeOcclude(p.objectStateId);break;case c.RenderGeometry:p.owner.removeRenderGeometryObjectState(p.renderGeometry,p.objectStateId);break;case c.External:p.remove(p.objectStateId)}};return m}();a.Object3DStateSet=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){const t=r.getLogger("esri.views.3d.layers.graphics.Graphics3DScaleVisibility");c=function(u){function z(B){B=u.call(this,B)||this;B._scaleRangeActive=!1;B._layerScaleRangeVisibilityQuery=!1;B._extent=null;B.graphicsCoreOwner=null;B.layer=null;B.queryGraphicUIDsInExtent=null;B.graphicsCore=null;B.basemapTerrain=null;B.layerScaleEnabled=!0;B.suspended=!1;B._dirty=!0;return B}a._inheritsLoose(z,u);var y=z.prototype;y.initialize=function(){this.updateScaleRangeActive();
this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(A.TaskPriority.SCALE_VISIBILITY,this));this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())};y.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null};y._setDirty=function(){this._dirty=!0};y.setExtent=function(B){const C=
this.graphicsCoreOwner.view.spatialReference,k=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(C===k)this._extent=B;else{const q=f.create();d.projectBoundingRect(B,C,q,k)?this._extent=q:this._extent=null}this._setDirty()};y.scaleRangeActive=function(){return this._scaleRangeActive};y.updateScaleRangeActive=function(){var B=this.layer,C=B.effectiveScaleRange;C=this.layerScaleEnabled&&(0<C.minScale||0<C.maxScale);B.labelingInfo&&!C&&(C=B.labelingInfo.some(k=>k&&(0<k.minScale||0<k.maxScale)));
B=this._scaleRangeActive!==C;(this._scaleRangeActive=C)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",k=>this._scaleUpdateHandler(k)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!C&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return B};y.runTask=function(){const B=this.graphicsCoreOwner.view.basemapTerrain;
if(!(this._extent&&B&&B.ready&&this._scaleRangeActive&&this.layerScaleEnabled))this._finishUpdate(!0);else if(!this._layerScaleRangeVisibilityQuery){this._layerScaleRangeVisibilityQuery=!0;const C=this.layer.effectiveScaleRange;B.queryVisibleScaleRange(this._extent,C.minScale,C.maxScale,k=>this._finishUpdate(k))}};y._finishUpdate=function(B){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!B);this._dirty=!1};y._visibleAtLayerScale=function(B){const C=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||
l.scaleBoundsPredicate(B,C.minScale||0,C.maxScale||0)};y._visibleAtLabelScale=function(B,C){return l.scaleBoundsPredicate(B,C.minScale||0,C.maxScale||0)};y._graphicScale=function(B){let C;m.isSome(B.centroid)?C=B.centroid:m.isSome(B.graphic.geometry)&&"point"===B.graphic.geometry.type&&(C=B.graphic.geometry);return C?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(C):1:null};y._graphicVisible=function(B){if(!this.layerScaleEnabled)return!0;B=this._graphicScale(B);
return this._visibleAtLayerScale(B)};y.updateVisibility=function(B){if(this._scaleRangeActive){const C=this._graphicVisible(B);return B.setVisibilityFlag(e.VisibilityFlag.SCALE_RANGE,C,e.VisibilityGroup.GRAPHIC)}return!1};y.updateGraphicLabelScaleVisibility=function(B){if(!this._scaleRangeActive||!B.labelGraphics||0===B.labelGraphics.length)return!1;const C=this._graphicScale(B);if(B=this._updateLabelScaleVisibility(B,C))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();
return B};y._updateLabelScaleVisibility=function(B,C){if(!B.labelGraphics||0===B.labelGraphics.length)return!1;const k=B.labelGraphics[0]._labelClass;return k&&null!=k.minScale&&null!=k.maxScale&&(C=this._visibleAtLabelScale(C,k),B.setVisibilityFlag(e.VisibilityFlag.SCALE_RANGE,C,e.VisibilityGroup.LABEL))?!0:!1};y._scaleUpdateHandler=function(B){this._setDirty();if(!this.graphicsCoreOwner.suspended){var C=B.extent,k=B.scale,q=this._visibleAtLayerScale(k),x=!1,v=this.graphicsCoreOwner.view.spatialReference;
B=B.spatialReference;if(m.isNone(B))t.error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var D=!B.equals(v);D&&!d.projectBoundingRect(C,B,w,v)?t.error("scaleUpdate: Internal error, cannot project AABR from "+B+" to wkid "+v):(this.queryGraphicUIDsInExtent(D?w:C,v,F=>{F=this.graphicsCore.getGraphics3DGraphicById(F);if(!m.isNone(F)){var G=F.centroid;m.isSome(G)&&(C[0]>G.x||C[1]>G.y||C[2]<G.x||C[3]<G.y)||(F.setVisibilityFlag(e.VisibilityFlag.SCALE_RANGE,q,e.VisibilityGroup.GRAPHIC)&&
(x=!0),this._updateLabelScaleVisibility(F,k)&&(x=!0))}}),x&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()))}}};y.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(B=>B.clearVisibilityFlag(e.VisibilityFlag.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(z,[{key:"updating",get:function(){return this._dirty||
this.updatingHandles.updating}},{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return z}(c.HandleOwner);b.__decorate([n.property()],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([n.property()],c.prototype,"layer",void 0);b.__decorate([n.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([n.property()],c.prototype,"graphicsCore",void 0);b.__decorate([n.property()],c.prototype,"basemapTerrain",void 0);b.__decorate([n.property({constructOnly:!0})],
c.prototype,"layerScaleEnabled",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([n.property()],c.prototype,"_dirty",void 0);c=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c);const w=f.create();return c})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(b,c,r){if(!r||null==c)return null;
if(!b){a:{b=r.toLowerCase();for(var m in c)if(m.toLowerCase()===b){c=c[m];break a}c=null}return c}return(m=b.get(r))?c[m.name]:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){a.FeatureVisibilityFilter=function(z){function y(C){var k=z.call(this,C)||this;k._updateTask=null;k._frameTask=null;k._queryEngine=null;k._updateRequested=!0;k._updateVisibility=function(){var q=b._asyncToGenerator(function*(x){if(p.isNone(k._compositedFeatureFilter)&&p.isNone(k._sceneFilter)||0===k.context.getFeatureCount())return k._frameTask.schedule(()=>k.clear(),x);try{const v=yield k._queryEngine.executeQueryForIdSet(k._compositedFeatureFilter,k._sceneFilter,
x);return k._frameTask.schedule(()=>{k.context.updateFeatureVisibilities(D=>v.has(D))},x)}catch(v){return g.throwIfAbortError(v),n.getLogger(k.declaredClass).warn(`FeatureFilter query failed: ${v}`,{error:v}),k._frameTask.schedule(()=>{k.context.setAllFeaturesVisibility(!0)},x)}});return function(x){return q.apply(this,arguments)}}();return k}b._inheritsLoose(y,z);var B=y.prototype;B.initialize=function(){const C=u.TaskPriority.FILTER_VISIBILITY,{layer:k,view:q}=this._layerView,{featureStore:x}=this.context;
this._queryEngine=new w.QueryEngine({context:{spatialReference:q.spatialReference,layer:k,scheduler:q.resourceController.scheduler,featureStore:x,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:C});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(C,this);this.updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),h.initial)};B.destroy=function(){this._updateRequested=
!1;this.handles.removeAll();this.updatingHandles.removeAll();this.clear();this._updateTask=p.abortMaybe(this._updateTask);this._frameTask=p.removeMaybe(this._frameTask);this._queryEngine=p.destroyMaybe(this._queryEngine);this._set("context",null)};B.reapply=function(){this._updateRequested=!0};B.clear=function(){this._queryEngine.clear();this.context.clearFeaturesVisibility()};B.runTask=function(C){this._updateRequested&&(this._updateTask=p.abortMaybe(this._updateTask),this._updateTask=r.createTask(this._updateVisibility),
this._updateRequested=!1,C.madeProgress());this._frameTask.processQueue(C)};b._createClass(y,[{key:"updating",get:function(){return this.running||this.updatingHandles.updating||p.isSome(this._updateTask)&&!this._updateTask.finished}},{key:"running",get:function(){return this._updateRequested||this._frameTask.updating}},{key:"defaultVisibility",get:function(){return p.isNone(this._compositedFeatureFilter)&&p.isNone(this._sceneFilter)}},{key:"_featureFilter",get:function(){return"filter"in this._layerView?
this._layerView.filter:null}},{key:"_sceneFilter",get:function(){return"layerFilter"in this._layerView?this._layerView.layerFilter:null}},{key:"_floorFilter",get:function(){return t.getFloorFilterClause(this._layerView)}},{key:"_timeExtent",get:function(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}},{key:"_compositedFeatureFilter",get:function(){const {_featureFilter:C,_timeExtent:k,_floorFilter:q}=this;if(p.isNone(k)&&p.isNone(q))return C;const x=p.isSome(C)?C.clone():new A;
p.isSome(k)&&(x.timeExtent=p.isSome(x.timeExtent)?x.timeExtent.intersection(k):k);if(p.isSome(q)){const v=p.isNone(x.where)||""===x.where;x.where=v?q:`(${x.where}) AND (${q})`}return x}},{key:"_layerView",get:function(){return this.context.layerView}}]);return y}(m.HandleOwner);c.__decorate([d.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"updating",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,
"running",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,
"_compositedFeatureFilter",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_layerView",null);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);c.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=c.__decorate([l.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],a.FeatureVisibilityFilter);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(c,r){if(!c?.length)return null;c=c.filter(m=>""!==m).map(m=>`'${m}'`);c.push("''");return`${r} IN (${c.join(",")}) OR ${r} IS NULL`}a.getFloorFilterClause=function(c){const r=c.layer;return"floorInfo"in r&&r.floorInfo?.floorField&&"floors"in c.view?b(c.view.floors,r.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(c,r){return"floorInfo"in r&&r.floorInfo?.floorField?b(c,r.floorInfo.floorField):
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){const w=e.QueryEngine;a.QueryEngine=function(u){function z(B){B=u.call(this,B)||this;B._dataQueryEngineInstance=null;return B}b._inheritsLoose(z,u);var y=z.prototype;y.destroy=function(){this.clear()};y.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};y.executeQueryForIdSet=function(){var B=b._asyncToGenerator(function*(C,k,q){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(C,
k),q)});return function(C,k,q){return B.apply(this,arguments)}}();y.executeQueryForCount=function(){var B=b._asyncToGenerator(function*(C,k){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(C),k)});return function(C,k){return B.apply(this,arguments)}}();y.executeQueryForExtent=function(){var B=b._asyncToGenerator(function*(C,k){const {count:q,extent:x}=yield this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(C),k);C=f.fromJSON(x);return{count:q,extent:C}});return function(C,
k){return B.apply(this,arguments)}}();y.executeQueryForIds=function(){var B=b._asyncToGenerator(function*(C,k){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(C),k)});return function(C,k){return B.apply(this,arguments)}}();y.executeQueryForLatestObservations=function(){var B=b._asyncToGenerator(function*(C,k){C=yield this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(C),k);C=l.fromJSON(C);C.features.forEach(q=>{q.layer=this.layer;q.sourceLayer=this.layer});
return C});return function(C,k){return B.apply(this,arguments)}}();y.executeQuery=function(){var B=b._asyncToGenerator(function*(C,k){C=yield this._dataQueryEngine.executeQuery(this._ensureQueryJSON(C),k);C=l.fromJSON(C);C.features.forEach(q=>{q.layer=this.layer;q.sourceLayer=this.layer});return C});return function(C,k){return B.apply(this,arguments)}}();y._ensureQueryJSON=function(B,C){let k=this.defaultQueryJSON;n.isSome(B)&&("outSpatialReference"in B&&!B.outSpatialReference&&(B.outSpatialReference=
this.spatialReference),k=B.toJSON());n.isSome(C)&&(B=C.geometries.map(q=>q.toJSON()).reduce((q,x)=>{q.rings=q.rings.concat(x.rings);return q}),k={...k,sceneFilter:{...C,geometry:B}});return k};y._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const B="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,C=this.layer.objectIdField,k=t.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),q=this.layer.fields.map(L=>
L.toJSON()),x=this.priority,v=this.spatialReference.toJSON(),{hasZ:D,hasM:F,featureStore:G,scheduler:J}=this.context;return this._dataQueryEngineInstance=new w({hasZ:D,hasM:F,geometryType:k,fields:q,timeInfo:B,spatialReference:v,objectIdField:C,featureStore:G,scheduler:J,priority:x})};b._createClass(z,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new A({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return z}(m);c.__decorate([p.property({constructOnly:!0})],a.QueryEngine.prototype,"context",void 0);c.__decorate([p.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);c.__decorate([p.property()],a.QueryEngine.prototype,"layer",null);c.__decorate([p.property()],
a.QueryEngine.prototype,"spatialReference",null);c.__decorate([p.property()],a.QueryEngine.prototype,"_queryGeometryType",null);c.__decorate([p.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=c.__decorate([d.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v){function D(P){return P.every(N=>"exceedslimit"!==N.statisticType)}const F=new p.MemCacheStorage(2E6);let G=0,J=function(){function P(H){this.capabilities={query:z.queryCapabilities};this.geometryType=H.geometryType;this.hasM=H.hasM;this.hasZ=H.hasZ;this.objectIdField=H.objectIdField;this.spatialReference=H.spatialReference;this.definitionExpression=H.definitionExpression;this.featureStore=H.featureStore;this.aggregateAdapter=H.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=H.timeInfo;H.cacheSpatialQueries&&(this._geometryQueryCache=new p.MemCache(G++ +"$$",F));this.fieldsIndex=new q(H.fields);H.scheduler&&H.priority&&(this._frameTask=H.scheduler.registerTask(H.priority))}var N=P.prototype;N.destroy=function(){this._frameTask=n.removeMaybe(this._frameTask);this.clearCache();n.destroyMaybe(this._geometryQueryCache);this._changeHandle=n.removeMaybe(this._changeHandle);n.destroyMaybe(this.fieldsIndex)};
N.clearCache=function(){this._geometryQueryCache?.clear();this._timeExtent=this._allItems=null};N.executeQuery=function(){var H=b._asyncToGenerator(function*(E,I){try{return(yield this._executeQuery(E,{},I)).createQueryResponse()}catch(M){if(M!==k.QUERY_ENGINE_EMPTY_RESULT)throw M;return(new y.QueryEngineResult([],E,this)).createQueryResponse()}});return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForCount=function(){var H=b._asyncToGenerator(function*(E={},I){try{return(yield this._executeQuery(E,
{returnGeometry:!1,returnCentroid:!1,outSR:null},I)).createQueryResponseForCount()}catch(M){if(M!==k.QUERY_ENGINE_EMPTY_RESULT)throw M;return 0}});return function(){return H.apply(this,arguments)}}();N.executeQueryForExtent=function(){var H=b._asyncToGenerator(function*(E,I){const M=E.outSR;try{const Q=yield this._executeQuery(E,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),T=Q.size;if(!T)return{count:0,extent:null};h.set(K,h.NEGATIVE_INFINITY);this.featureStore.forEachBounds(Q.items,Y=>h.expandWithAABB(K,
Y),L);const S={xmin:K[0],ymin:K[1],xmax:K[3],ymax:K[4],spatialReference:k.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(K[2])&&isFinite(K[5])&&(S.zmin=K[2],S.zmax=K[5]);const U=u.project(S,Q.spatialReference,M);U.spatialReference=k.cleanFromGeometryEngine(M||this.spatialReference);if(0===U.xmax-U.xmin){const Y=g.getMetersPerUnitForSR(U.spatialReference);U.xmin-=Y;U.xmax+=Y}if(0===U.ymax-U.ymin){const Y=g.getMetersPerUnitForSR(U.spatialReference);U.ymin-=Y;U.ymax+=Y}if(this.hasZ&&
null!=U.zmin&&null!=U.zmax&&0===U.zmax-U.zmin){const Y=g.getMetersPerUnitForSR(U.spatialReference);U.zmin-=Y;U.zmax+=Y}return{count:T,extent:U}}catch(Q){if(Q===k.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw Q;}});return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForIds=function(){var H=b._asyncToGenerator(function*(E,I){return this.executeQueryForIdSet(E,I).then(M=>Array.from(M))});return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForIdSet=function(){var H=
b._asyncToGenerator(function*(E,I){try{const M=yield this._executeQuery(E,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),Q=M.items,T=new Set;yield this._reschedule(()=>{for(const S of Q)T.add(M.featureAdapter.getObjectId(S))},I);return T}catch(M){if(M===k.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw M;}});return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForSnapping=function(){var H=b._asyncToGenerator(function*(E,I){const {point:M,distance:Q,types:T}=E;if(T===y.SnappingTypes.NONE)return{candidates:[]};
const S=yield this._reschedule(()=>this._checkQuerySupport(E.query),I),U=!A.equals(M.spatialReference,this.spatialReference);U&&(yield u.checkProjectionSupport(M.spatialReference,this.spatialReference));var Y="number"===typeof Q?Q:Q.x,V="number"===typeof Q?Q:Q.y;Y={xmin:M.x-Y,xmax:M.x+Y,ymin:M.y-V,ymax:M.y+V,spatialReference:M.spatialReference};Y=U?u.project(Y,this.spatialReference):Y;if(!Y)return{candidates:[]};V=(yield l.normalizeCentralMeridian(e.fromJSON(M),null,{signal:I}))[0];const R=(yield l.normalizeCentralMeridian(e.fromJSON(Y),
null,{signal:I}))[0];if(n.isNone(V)||n.isNone(R))return{candidates:[]};const X=new y.QueryEngineResult(this._searchFeatures(this._getQueryBBoxes(R.toJSON())),S,this);yield this._reschedule(()=>this._executeObjectIdsQuery(X),I);yield this._reschedule(()=>this._executeTimeQuery(X),I);yield this._reschedule(()=>this._executeAttributesQuery(X),I);I=V.toJSON();I=U?u.project(I,this.spatialReference):I;return X.createSnappingResponse({...E,point:I,distance:U?Math.max(Y.xmax-Y.xmin,Y.ymax-Y.ymin)/2:Q},M.spatialReference)});
return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForLatestObservations=function(){var H=b._asyncToGenerator(function*(E,I){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new r("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:E,timeInfo:this.timeInfo});try{const M=yield this._executeQuery(E,{},I);yield this._reschedule(()=>this._filterLatest(M),I);return M.createQueryResponse()}catch(M){if(M!==k.QUERY_ENGINE_EMPTY_RESULT)throw M;return(new y.QueryEngineResult([],
E,this)).createQueryResponse()}});return function(E,I){return H.apply(this,arguments)}}();N.executeQueryForSummaryStatistics=function(){var H=b._asyncToGenerator(function*(E={},I,M){const {field:Q,normalizationField:T,valueExpression:S}=I;return(yield this._getQueryEngineResultForStats(E,{field:Q,normalizationField:T,valueExpression:S},M)).createSummaryStatisticsResponse(I)});return function(){return H.apply(this,arguments)}}();N.executeQueryForUniqueValues=function(){var H=b._asyncToGenerator(function*(E=
{},I,M){const {field:Q,field2:T,field3:S,valueExpression:U}=I;return(yield this._getQueryEngineResultForStats(E,{field:Q,field2:T,field3:S,valueExpression:U},M)).createUniqueValuesResponse(I)});return function(){return H.apply(this,arguments)}}();N.executeQueryForClassBreaks=function(){var H=b._asyncToGenerator(function*(E={},I,M){const {field:Q,normalizationField:T,valueExpression:S}=I;return(yield this._getQueryEngineResultForStats(E,{field:Q,normalizationField:T,valueExpression:S},M)).createClassBreaksResponse(I)});
return function(){return H.apply(this,arguments)}}();N.executeQueryForHistogram=function(){var H=b._asyncToGenerator(function*(E={},I,M){const {field:Q,normalizationField:T,valueExpression:S}=I;return(yield this._getQueryEngineResultForStats(E,{field:Q,normalizationField:T,valueExpression:S},M)).createHistogramResponse(I)});return function(){return H.apply(this,arguments)}}();N._schedule=function(){var H=b._asyncToGenerator(function*(E,I){return n.isSome(this._frameTask)?this._frameTask.schedule(E,
I):E(v.noBudget)});return function(E,I){return H.apply(this,arguments)}}();N._reschedule=function(){var H=b._asyncToGenerator(function*(E,I){return n.isSome(this._frameTask)?this._frameTask.reschedule(E,I):E(v.noBudget)});return function(E,I){return H.apply(this,arguments)}}();N._getAll=function(H){n.isNone(this._allItems)&&(this._allItems=this.featureStore.toArray());return new y.QueryEngineResult(this._allItems,H,this)};N._executeQuery=function(){var H=b._asyncToGenerator(function*(E,I,M){E=m.clone(E);
E=yield this._schedule(()=>k.normalizeQuery(E,this.definitionExpression,this.spatialReference),M);E=yield this._reschedule(()=>this._checkQuerySupport(E),M);E={...E,...I};const Q=yield this._reschedule(()=>this._executeSceneFilterQuery(E,M),M),T=yield this._reschedule(()=>this._executeGeometryQuery(E,Q,M),M);yield this._reschedule(()=>this._executeAggregateIdsQuery(T),M);yield this._reschedule(()=>this._executeObjectIdsQuery(T),M);yield this._reschedule(()=>this._executeTimeQuery(T),M);yield this._reschedule(()=>
this._executeAttributesQuery(T),M);return T});return function(E,I,M){return H.apply(this,arguments)}}();N._executeSceneFilterQuery=function(){var H=b._asyncToGenerator(function*(E,I){var M=this;if(n.isNone(E.sceneFilter))return null;const {outSR:Q,returnGeometry:T,returnCentroid:S}=E;var U=this.featureStore.featureSpatialReference,Y=E.sceneFilter.geometry;const V=n.isNone(U)||A.equals(U,Y.spatialReference)?Y:u.project(Y,U);if(!V)return null;U=T||S;U=A.isValid(Q)&&!A.equals(this.spatialReference,Q)&&
U?function(){var aa=b._asyncToGenerator(function*(ba){return M._project(ba,Q)});return function(ba){return aa.apply(this,arguments)}}():aa=>aa;const R=this.featureAdapter;Y=this._searchFeatures(this._getQueryBBoxes(V));if("disjoint"===E.sceneFilter.spatialRelationship){if(!Y.length)return null;const aa=new Set;for(var X of Y)aa.add(R.getObjectId(X));const ba=yield this._reschedule(()=>this.featureStore.toArray(),I);X=yield this._reschedule(b._asyncToGenerator(function*(){const ia=yield B.getSpatialQueryOperator("esriSpatialRelDisjoint",
V,M.geometryType,M.hasZ,M.hasM),ma=yield M._runSpatialFilter(ba,ha=>!aa.has(R.getObjectId(ha))||ia(R.getGeometry(ha)),I);return new y.QueryEngineResult(ma,E,M)}),I);return U(X)}if(!Y.length)return new y.QueryEngineResult([],E,this);if(this._canExecuteSinglePass(V,E))return U(new y.QueryEngineResult(Y,E,this));const W=yield B.getSpatialQueryOperator("esriSpatialRelContains",V,this.geometryType,this.hasZ,this.hasM);X=yield this._runSpatialFilter(Y,aa=>W(R.getGeometry(aa)),I);return U(new y.QueryEngineResult(X,
E,this))});return function(E,I){return H.apply(this,arguments)}}();N._executeGeometryQuery=function(){var H=b._asyncToGenerator(function*(E,I,M){var Q=this;if(n.isSome(I)&&0===I.items.length)return I;E=n.isSome(I)?I.query:E;const {geometry:T,outSR:S,spatialRel:U,returnGeometry:Y,returnCentroid:V}=E;var R=this.featureStore.featureSpatialReference;const X=!T||n.isNone(R)||A.equals(R,T.spatialReference)?T:u.project(T,R),W=Y||V,aa=A.isValid(S)&&!A.equals(this.spatialReference,S),ba=this._geometryQueryCache&&
n.isNone(I)?aa&&W?JSON.stringify({originalFilterGeometry:T,spatialRelationship:U,outSpatialReference:S}):JSON.stringify({originalFilterGeometry:T,spatialRelationship:U}):null;R=ba?this._geometryQueryCache.get(ba):null;if(n.isSome(R))return new y.QueryEngineResult(R,E,this);R=function(){var Z=b._asyncToGenerator(function*(ca){aa&&W&&(yield Q._project(ca,S));ba&&Q._geometryQueryCache.put(ba,ca.items,ca.items.length+1);return ca});return function(ca){return Z.apply(this,arguments)}}();if(!X)return R(n.isSome(I)?
I:this._getAll(E));const ia=this.featureAdapter;let ma=this._searchFeatures(this._getQueryBBoxes(T));if("esriSpatialRelDisjoint"===U){if(!ma.length)return R(n.isSome(I)?I:this._getAll(E));const Z=new Set;for(var ha of ma)Z.add(ia.getObjectId(ha));const ca=n.isSome(I)?I.items:yield this._reschedule(()=>this.featureStore.toArray(),M);ha=yield this._reschedule(b._asyncToGenerator(function*(){const fa=yield B.getSpatialQueryOperator(U,X,Q.geometryType,Q.hasZ,Q.hasM),ea=yield Q._runSpatialFilter(ca,da=>
!Z.has(ia.getObjectId(da))||fa(ia.getGeometry(da)),M);return new y.QueryEngineResult(ea,E,Q)}),M);return R(ha)}if(n.isSome(I)){const Z=new c.PositionHint;ma=ma.filter(ca=>0<=c.indexOf(I.items,ca,I.items.length,Z))}if(!ma.length)return R=new y.QueryEngineResult([],E,this),ba&&this._geometryQueryCache.put(ba,R.items,1),R;if(this._canExecuteSinglePass(X,E))return R(new y.QueryEngineResult(ma,E,this));const ka=yield B.getSpatialQueryOperator(U,X,this.geometryType,this.hasZ,this.hasM);ha=yield this._runSpatialFilter(ma,
Z=>ka(ia.getGeometry(Z)),M);return R(new y.QueryEngineResult(ha,E,this))});return function(E,I,M){return H.apply(this,arguments)}}();N._executeAggregateIdsQuery=function(H){if(0!==H.items.length&&H.query.aggregateIds&&H.query.aggregateIds.length&&!n.isNone(this.aggregateAdapter)){var E=new Set;for(const M of H.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(M).forEach(Q=>E.add(Q));var I=this.featureAdapter.getObjectId;H.items=H.items.filter(M=>E.has(I(M)))}};N._executeObjectIdsQuery=
function(H){if(0!==H.items.length&&H.query.objectIds&&H.query.objectIds.length){var E=new Set(H.query.objectIds),I=this.featureAdapter.getObjectId;H.items=H.items.filter(M=>E.has(I(M)))}};N._executeTimeQuery=function(H){if(0!==H.items.length){var E=C.getTimeOperator(this.timeInfo,H.query.timeExtent,this.featureAdapter);n.isNone(E)||(H.items=H.items.filter(E))}};N._executeAttributesQuery=function(H){if(0!==H.items.length){var E=w.getWhereClause(H.query.where,this.fieldsIndex);if(E){if(!E.isStandardized)throw new TypeError("Where clause is not standardized");
H.items=H.items.filter(I=>E.testFeature(I,this.featureAdapter))}}};N._runSpatialFilter=function(){var H=b._asyncToGenerator(function*(E,I,M){var Q=this;if(!I)return E;if(n.isNone(this._frameTask))return E.filter(Y=>I(Y));let T=0;const S=[],U=function(){var Y=b._asyncToGenerator(function*(V){for(;T<E.length;){const R=E[T++];I(R)&&(S.push(R),V.madeProgress());V.done&&(yield Q._reschedule(X=>U(X),M))}});return function(V){return Y.apply(this,arguments)}}();return this._reschedule(Y=>U(Y),M).then(()=>
S)});return function(E,I,M){return H.apply(this,arguments)}}();N._filterLatest=function(H){const {trackIdField:E,startTimeField:I,endTimeField:M}=this.timeInfo,Q=M||I,T=new Map,S=this.featureAdapter.getAttribute;for(const U of H.items){const Y=S(U,E),V=S(U,Q),R=T.get(Y);(!R||V>S(R,Q))&&T.set(Y,U)}H.items=Array.from(T.values())};N._canExecuteSinglePass=function(H,E){({spatialRel:E}=E);return B.canQueryWithRBush(H)&&("esriSpatialRelEnvelopeIntersects"===E||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===
E||"esriSpatialRelContains"===E||"esriSpatialRelWithin"===E))};N._project=function(){var H=b._asyncToGenerator(function*(E,I){if(!I||A.equals(this.spatialReference,I))return E;const M=this.featureAdapter;I=yield u.projectMany(E.items.map(Q=>k.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(Q))),this.spatialReference,I);E.items=I.map((Q,T)=>M.cloneWithGeometry(E.items[T],t.convertFromGeometry(Q,this.hasZ,this.hasM)));return E});return function(E,I){return H.apply(this,arguments)}}();
N._getQueryBBoxes=function(H){if(B.canQueryWithRBush(H)){if(e.isExtent(H))return[d.fromValues(H.xmin,H.ymin,H.xmax,H.ymax)];if(e.isPolygon(H))return H.rings.map(E=>d.fromValues(Math.min(E[0][0],E[2][0]),Math.min(E[0][1],E[2][1]),Math.max(E[0][0],E[2][0]),Math.max(E[0][1],E[2][1])))}return[f.getBoundsXY(d.create(),H)]};N._searchFeatures=function(H){for(const E of H)this.featureStore.forEachInBounds(E,I=>O.add(I));H=Array.from(O.values());O.clear();return H};N._checkStatisticsSupport=function(){var H=
b._asyncToGenerator(function*(E,I){if(0>E.distance||null!=E.geometryPrecision||E.multipatchOption||E.pixelSize||E.relationParam||E.text||E.outStatistics||E.groupByFieldsForStatistics||E.having||E.orderByFields)throw new r("feature-store:unsupported-query","Unsupported query options",{query:E});this._checkAttributesQuerySupport(E);return Promise.all([this._checkStatisticsParamsSupport(I),B.checkSpatialQuerySupport(E,this.geometryType,this.spatialReference),u.checkProjectionSupport(this.spatialReference,
E.outSR)]).then(()=>E)});return function(E,I){return H.apply(this,arguments)}}();N._checkStatisticsParamsSupport=function(){var H=b._asyncToGenerator(function*(E){var I=[];E.valueExpression&&({arcadeUtils:I}=yield x.loadArcade(),I=I.extractFieldNames(E.valueExpression));E.field&&I.push(E.field);E.field2&&I.push(E.field2);E.field3&&I.push(E.field3);E.normalizationField&&I.push(E.normalizationField);if(!I.length)throw new r("feature-store:unsupported-query","params should have at least a field or valueExpression",
{params:E});w.validateFields(this.fieldsIndex,I,"params contains missing fields")});return function(E){return H.apply(this,arguments)}}();N._checkQuerySupport=function(){var H=b._asyncToGenerator(function*(E){if(0>E.distance||null!=E.geometryPrecision||E.multipatchOption||E.pixelSize||E.relationParam||E.text)throw new r("feature-store:unsupported-query","Unsupported query options",{query:E});this._checkAttributesQuerySupport(E);this._checkStatisticsQuerySupport(E);return Promise.all([B.checkSpatialQuerySupport(E,
this.geometryType,this.spatialReference),u.checkProjectionSupport(this.spatialReference,E.outSR)]).then(()=>E)});return function(E){return H.apply(this,arguments)}}();N._checkAttributesQuerySupport=function(H){const {outFields:E,orderByFields:I,returnDistinctValues:M,outStatistics:Q}=H,T=Q?Q.map(S=>S.outStatisticFieldName&&S.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(I&&0<I.length){const S=I.map(U=>{const Y=U.toLowerCase();return Y.includes(" asc")?Y.split(" asc")[0]:Y.includes(" desc")?
Y.split(" desc")[0]:U}).filter(U=>!T.includes(U));w.validateFields(this.fieldsIndex,S,"orderByFields contains missing fields")}if(E&&0<E.length)w.validateFields(this.fieldsIndex,E,"outFields contains missing fields");else if(M)throw new r("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:H});w.validateWhere(this.fieldsIndex,H.where)};N._checkStatisticsQuerySupport=function(H){const {outStatistics:E,groupByFieldsForStatistics:I,having:M}=H;var Q=I&&I.length,
T=E&&E.length;if(M){if(!Q||!T)throw new r("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:H});w.validateHaving(this.fieldsIndex,M,E)}if(T&&D(E)){T=E.map(S=>S.onStatisticField).filter(Boolean);w.validateFields(this.fieldsIndex,T,"onStatisticFields contains missing fields");Q&&w.validateFields(this.fieldsIndex,I,"groupByFieldsForStatistics contains missing fields");for(const S of E){const {onStatisticField:U,statisticType:Y}=S;
if(("percentile_disc"===Y||"percentile_cont"===Y)&&"statisticParameters"in S){if({statisticParameters:Q}=S,!Q)throw new r("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:S,query:H});}else if("count"!==Y&&U&&w.hasInvalidFieldType(U,this.fieldsIndex))throw new r("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:S,query:H});}}};N._getQueryEngineResultForStats=function(){var H=b._asyncToGenerator(function*(E,
I,M){E=m.clone(E);try{E=yield this._schedule(()=>k.normalizeQuery(E,this.definitionExpression,this.spatialReference),M);E=yield this._reschedule(()=>this._checkStatisticsSupport(E,I),M);const Q=yield this._reschedule(()=>this._executeSceneFilterQuery(E,M),M),T=yield this._reschedule(()=>this._executeGeometryQuery(E,Q,M),M);yield this._reschedule(()=>this._executeAggregateIdsQuery(T),M);yield this._reschedule(()=>this._executeObjectIdsQuery(T),M);yield this._reschedule(()=>this._executeTimeQuery(T),
M);yield this._reschedule(()=>this._executeAttributesQuery(T),M);return T}catch(Q){if(Q!==k.QUERY_ENGINE_EMPTY_RESULT)throw Q;return new y.QueryEngineResult([],E,this)}});return function(E,I,M){return H.apply(this,arguments)}}();b._createClass(P,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const H=this.featureStore.fullBounds;return n.isNone(H)?null:{xmin:H[0],ymin:H[1],xmax:H[2],ymax:H[3],spatialReference:k.cleanFromGeometryEngine(this.spatialReference)}}},
{key:"timeExtent",get:function(){if(!this.timeInfo)return null;this._timeExtent||(this._timeExtent=C.getTimeExtent(this.timeInfo,this.featureStore));return this._timeExtent}}]);return P}();const L=h.create(),K=h.create(),O=new Set;a.Feature=function(P,N=null,H,E,I){this.attributes=P;this.geometry=H;this.centroid=E;this.filterFlags=I;this.groupId=-1;this.displayId=N};a.QueryEngine=J;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports",
"../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,b,c){function r(h,d){return h?p.get(h,d):null}function m(h,d,f,e=!0){const l=[];for(const A of d)if("*"!==A&&!h.has(A))if(e){d=n(A);try{const t=r(d,h);if(!t)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:d});if(!t.isStandardized)throw new b("feature-store:unsupported-query","expression is not standard",{clause:t});m(h,t.fieldNames,"expression contains missing fields")}catch(t){if((d=t&&t.details)&&
(d.clause||d.where))throw t;d&&d.missingFields?l.push(...d.missingFields):l.push(A)}}else l.push(A);if(l.length)throw new b("feature-store:unsupported-query",f,{missingFields:l});}function n(h){return h.split(" as ")[0]}const p=new c.WhereClauseCache(50,500),g=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(h){return h.split(" as ")[1]};a.getExpressionFromFieldName=
n;a.getWhereClause=r;a.hasInvalidFieldType=function(h,d){return(h=d.get(h))?!g.has(h.type):!1};a.validateFields=m;a.validateHaving=function(h,d,f){if(!d)return!0;const e=p.get(d,h);if(!e)throw new b("feature-store:unsupported-query","invalid SQL expression",{having:d});if(!e.isAggregate)throw new b("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:d});m(h,e.fieldNames,"having contains missing fields");if(!e.getExpressions().every(l=>{const {aggregateType:A,
field:t}=l,w=h.has(t)&&h.get(t).name;return f.some(u=>{const {onStatisticField:z,statisticType:y}=u;return(h.has(z)&&h.get(z).name)===w&&y.toLowerCase().trim()===A})}))throw new b("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:d});return!0};a.validateWhere=function(h,d){if(!d)return!0;const f=p.get(d,h);if(!f)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:d});if(!f.isStandardized)throw new b("feature-store:unsupported-query",
"where clause is not standard",{where:d});m(h,f.fieldNames,"where clause contains missing fields");return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,b,c){let r=function(){function m(n,p){this._cache=new b(n);this._invalidCache=new b(p)}m.prototype.get=function(n,p){const g=`${p.uid}:${n}`,h=this._cache.get(g);if(h)return h;if(void 0!==this._invalidCache.get(g))return null;
try{const d=c.WhereClause.create(n,p);this._cache.put(g,d);return d}catch{return this._invalidCache.put(g,null),null}};return m}();a.WhereClauseCache=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,b,c,r,m,n){function p(K,O){K+="";return K.length>=O?K:Array(O-K.length+1).join("0")+
K}function g(K,O,P="0",N="0",H="0",E="0",I="",M="0",Q="0"){return"+"===I||"-"===I?(K=`${p(parseInt(K,10),4)}-${p(parseInt(O,10),2)}-${p(parseInt(P,10),2)}`,O="",10>parseFloat(E)&&(O="0"),N=`${p(parseInt(N,10),2)}:${p(parseInt(H,10),2)}:${O+parseFloat(E).toString()}`,I=`${I}${p(parseInt(M,10),2)}:${p(parseInt(Q,10),2)}`,new Date(K+"T"+N+I)):new Date(parseInt(K,10),parseInt(O,10)-1,parseInt(P,10),parseInt(N,10),parseInt(H,10),parseFloat(E))}function h(K){let O=k.exec(K);if(null!==O){const [,P,N,H,E,
I,M]=O;return g(P,N,H,E,I,M)}O=q.exec(K);if(null!==O){const [,P,N,H,E,I,M,Q,T,S]=O;return g(P,N,H,E,I,M,Q,T,S)}O=x.exec(K);if(null!==O){const [,P,N,H,E,I,M,Q,T]=O;return g(P,N,H,E,I,"0",M,Q,T)}O=v.exec(K);if(null!==O){const [,P,N,H,E,I]=O;return g(P,N,H,E,I)}O=C.exec(K);if(null!==O){const [,P,N,H]=O;return g(P,N,H)}throw Error("SQL Invalid Timestamp");}function d(K){const O=C.exec(K);if(null===O)try{return h(K)}catch{throw Error("SQL Invalid Date");}const [,P,N,H]=O;return new Date(parseInt(P,10),
parseInt(N,10)-1,parseInt(H,10))}function f(K){return Array.isArray(K)?K:[K]}function e(K){return null!==K?!0!==K:null}function l(K,O){return null!=K&&null!=O?!0===K&&!0===O:!1===K||!1===O?!1:null}function A(K,O){return null!=K&&null!=O?!0===K||!0===O:!0===K||!0===O?!0:null}function t(K,O){if(null==K)return null;let P=!1;for(const N of O)if(null==N)P=null;else if(K===N){P=!0;break}return P}function w(K,O,P){if(null==K)return null;let N="",H=J.Normal;for(let E=0;E<O.length;E++){const I=O.charAt(E);
switch(H){case J.Normal:I===P?H=J.Escaped:N="-[]/{}()*+?.\\^$|".includes(I)?N+("\\"+I):"%"===I?N+".*":"_"===I?N+".":N+I;break;case J.Escaped:N="-[]/{}()*+?.\\^$|".includes(I)?N+("\\"+I):N+I,H=J.Normal}}return(new RegExp("^"+N+"$","m")).test(K)}function u(K){return K instanceof Date?K.valueOf():K}function z(K,O,P){if(null==O||null==P)return null;O=u(O);P=u(P);switch(K){case "\x3c\x3e":return O!==P;case "\x3d":return O===P;case "\x3e":return O>P;case "\x3c":return O<P;case "\x3e\x3d":return O>=P;case "\x3c\x3d":return O<=
P}}function y(K,O,P){if(O instanceof m.SqlInterval)if(P instanceof Date)switch(K){case "+":return new Date(O.valueInMilliseconds()+P.getTime());case "-":return O.valueInMilliseconds()-P.getTime();case "*":return O.valueInMilliseconds()*P.getTime();case "/":return O.valueInMilliseconds()/P.getTime()}else if(P instanceof m.SqlInterval)switch(K){case "+":return m.SqlInterval.createFromMilliseconds(O.valueInMilliseconds()+P.valueInMilliseconds());case "-":return m.SqlInterval.createFromMilliseconds(O.valueInMilliseconds()-
P.valueInMilliseconds());case "*":return O.valueInMilliseconds()*P.valueInMilliseconds();case "/":return O.valueInMilliseconds()/P.valueInMilliseconds()}else O=O.valueInMilliseconds();else if(P instanceof m.SqlInterval)if(O instanceof Date)switch(K){case "+":return new Date(P.valueInMilliseconds()+O.getTime());case "-":return new Date(O.getTime()-P.valueInMilliseconds());case "*":return O.getTime()*P.valueInMilliseconds();case "/":return O.getTime()/P.valueInMilliseconds()}else P=P.valueInMilliseconds();
else if(O instanceof Date&&"number"===typeof P)switch(P*=864E5,O=O.getTime(),K){case "+":return new Date(O+P);case "-":return new Date(O-P);case "*":return new Date(O*P);case "/":return new Date(O/P)}else if(P instanceof Date&&"number"===typeof O)switch(O*=864E5,P=P.getTime(),K){case "+":return new Date(O+P);case "-":return new Date(O-P);case "*":return new Date(O*P);case "/":return new Date(O/P)}switch(K){case "+":return O+P;case "-":return O-P;case "*":return O*P;case "/":return O/P}}function B(K,
O,P,N){K=N.getAttribute(K,O);return null!=K&&1===P[O]?new Date(K):K}const C=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,k=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,q=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,D=new Set(["current_timestamp","current_date","current_time"]);let F=function(){function K(){}
K.makeBool=function(O){return!0===O};K.featureValue=function(O,P,N,H){return B(O,P,N,H)};K.equalsNull=function(O){return null===O};K.applyLike=function(O,P,N){return w(O,P,N)};K.ensureArray=function(O){return f(O)};K.applyIn=function(O,P){return t(O,P)};K.currentDate=function(){const O=new Date;O.setHours(0,0,0,0);return O};K.makeSqlInterval=function(O,P,N){return m.SqlInterval.createFromValueAndQualifer(O,P,N)};K.convertInterval=function(O){return O instanceof m.SqlInterval?O.valueInMilliseconds():
O};K.currentTimestamp=function(){return new Date};K.compare=function(O,P,N){return z(O,P,N)};K.calculate=function(O,P,N){return y(O,P,N)};K.makeComparable=function(O){return u(O)};K.evaluateFunction=function(O,P){return m.evaluateFunction(O,P)};K.lookup=function(O,P){O=P[O];return void 0===O?null:O};K.between=function(O,P){return null==O||null==P[0]||null==P[1]?null:O>=P[0]&&O<=P[1]};K.notbetween=function(O,P){return null==O||null==P[0]||null==P[1]?null:O<P[0]||O>P[1]};K.ternaryNot=function(O){return e(O)};
K.ternaryAnd=function(O,P){return l(O,P)};K.ternaryOr=function(O,P){return A(O,P)};return K}(),G=function(){function K(P,N){this.fieldsIndex=N;this._datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=n.WhereGrammar.parse(P);const {isStandardized:H,isAggregate:E,referencedFieldNames:I}=this._extractExpressionInfo(N);this._referencedFieldNames=I;this.isStandardized=H;this.isAggregate=E}K.create=function(P,N){return new K(P,N)};var O=K.prototype;O.testSet=function(P,N=L){const H=
{};for(const E of this.fieldNames)H[E]=P.map(I=>N.getAttribute(I,E));return!!this._evaluateNode(this.parseTree,{attributes:H},L)};O.calculateValue=function(P,N=L){P=this._evaluateNode(this.parseTree,P,N);return P instanceof m.SqlInterval?P.valueInMilliseconds()/864E5:P};O.calculateValueCompiled=function(P,N=L){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(P,this.parameters,N,this._datefields);if(c("esri-csp-restrictions"))return this.calculateValue(P,N);this._compileMe();
return this.parseTree._compiledVersion(P,this.parameters,N,this._datefields)};O.testFeature=function(P,N=L){return!!this._evaluateNode(this.parseTree,P,N)};O.testFeatureCompiled=function(P,N=L){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(P,this.parameters,N,this._datefields);if(c("esri-csp-restrictions"))return this.testFeature(P,N);this._compileMe();return!!this.parseTree._compiledVersion(P,this.parameters,N,this._datefields)};O.getFunctions=function(){const P=
new Set;this._visitAll(this.parseTree,N=>{"function"===N.type&&P.add(N.name.toLowerCase())});return Array.from(P)};O.getExpressions=function(){const P=new Map;this._visitAll(this.parseTree,N=>{if("function"===N.type){const H=N.name.toLowerCase();N=N.args.value[0];if("column-reference"===N.type){N=N.column;const E=`${H}-${N}`;P.has(E)||P.set(E,{aggregateType:H,field:N})}}});return[...P.values()]};O.getVariables=function(){const P=new Set;this._visitAll(this.parseTree,N=>{"parameter"===N.type&&P.add(N.value.toLowerCase())});
return Array.from(P)};O._compileMe=function(){const P="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",P)).bind(F)};O._extractExpressionInfo=function(P){const N=[],H=new Set;let E=!0,I=!0;this._visitAll(this.parseTree,M=>{switch(M.type){case "column-reference":const Q=P?.get(M.column);let T,S;Q?T=S=Q.name??"":(S=M.column,T=S.toLowerCase());Q&&Q.name&&("date"===Q.type||
"esriFieldTypeDate"===Q.type)&&(this._datefields[Q.name]=1);H.has(T)||(H.add(T),N.push(S));M.column=S;break;case "function":const {name:U,args:Y}=M;M=Y.value.length;E&&(E=m.isStandardized(U,M));I&&(I=r.isAggregate(U,M))}});return{referencedFieldNames:Array.from(N),isStandardized:E,isAggregate:I}};O._visitAll=function(P,N){if(null!=P)switch(N(P),P.type){case "when-clause":this._visitAll(P.operand,N);this._visitAll(P.value,N);break;case "case-expression":for(const H of P.clauses)this._visitAll(H,N);
"simple"===P.format&&this._visitAll(P.operand,N);null!==P.else&&this._visitAll(P.else,N);break;case "expression-list":for(const H of P.value)this._visitAll(H,N);break;case "unary-expression":this._visitAll(P.expr,N);break;case "binary-expression":this._visitAll(P.left,N);this._visitAll(P.right,N);break;case "function":this._visitAll(P.args,N)}};O.evaluateNodeToJavaScript=function(P){switch(P.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(P.value)+", "+JSON.stringify(P.qualifier)+
","+JSON.stringify(P.op)+")";case "case-expression":var N="";if("simple"===P.format){var H="this.makeComparable("+this.evaluateNodeToJavaScript(P.operand)+")";N="( ";for(let E=0;E<P.clauses.length;E++)N+=" ("+H+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(P.clauses[E].operand)+")) ? ("+this.evaluateNodeToJavaScript(P.clauses[E].value)+") : "}else for(N="( ",H=0;H<P.clauses.length;H++)N+=" this.makeBool("+this.evaluateNodeToJavaScript(P.clauses[H].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(P.clauses[H].value)+") : ";N=null!==P.else?N+this.evaluateNodeToJavaScript(P.else):N+"null";return N+" )";case "parameter":return"this.lookup("+JSON.stringify(P.value.toLowerCase())+",lookups)";case "expression-list":N="[";for(H of P.value)"["!==N&&(N+=","),N+=this.evaluateNodeToJavaScript(H);return N+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(P.expr)+")";case "binary-expression":switch(P.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+" )";case "IS":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(P.left)+")";case "ISNOT":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(P.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(P.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(P.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(P.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(P.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+","+JSON.stringify(P.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+","+JSON.stringify(P.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(P.operator)+","+this.evaluateNodeToJavaScript(P.left)+","+
this.evaluateNodeToJavaScript(P.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(P.operator)+","+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+")"}throw Error("Not Supported Operator "+P.operator);case "null":case "boolean":case "string":case "number":return JSON.stringify(P.value);case "date":return"(new Date("+d(P.value).getTime().toString()+"))";case "timestamp":return"(new Date("+h(P.value).getTime().toString()+"))";case "current-time":return"date"===
P.mode?"this.currentDate()":"this.currentTimestamp()";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(P.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(P.name)+","+this.evaluateNodeToJavaScript(P.args)+")"}throw Error("Unsupported sql syntax "+P.type);};O._evaluateNode=function(P,N,H){switch(P.type){case "interval":return N=this._evaluateNode(P.value,N,H),m.SqlInterval.createFromValueAndQualifer(N,P.qualifier,P.op);case "case-expression":if("simple"===
P.format){var E=u(this._evaluateNode(P.operand,N,H));for(var I=0;I<P.clauses.length;I++)if(E===u(this._evaluateNode(P.clauses[I].operand,N,H)))return this._evaluateNode(P.clauses[I].value,N,H)}else for(E=0;E<P.clauses.length;E++)if(!0===this._evaluateNode(P.clauses[E].operand,N,H))return this._evaluateNode(P.clauses[E].value,N,H);return null!==P.else?this._evaluateNode(P.else,N,H):null;case "parameter":return this.parameters[P.value.toLowerCase()];case "expression-list":E=[];for(I of P.value)E.push(this._evaluateNode(I,
N,H));return E;case "unary-expression":return e(this._evaluateNode(P.expr,N,H));case "binary-expression":switch(P.operator){case "AND":return l(this._evaluateNode(P.left,N,H),this._evaluateNode(P.right,N,H));case "OR":return A(this._evaluateNode(P.left,N,H),this._evaluateNode(P.right,N,H));case "IS":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(P.left,N,H);case "ISNOT":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return null!==this._evaluateNode(P.left,
N,H);case "IN":return E=f(this._evaluateNode(P.right,N,H)),t(this._evaluateNode(P.left,N,H),E);case "NOT IN":return E=f(this._evaluateNode(P.right,N,H)),e(t(this._evaluateNode(P.left,N,H),E));case "BETWEEN":return E=this._evaluateNode(P.left,N,H),P=this._evaluateNode(P.right,N,H),null==E||null==P[0]||null==P[1]?null:E>=u(P[0])&&E<=u(P[1]);case "NOTBETWEEN":return E=this._evaluateNode(P.left,N,H),P=this._evaluateNode(P.right,N,H),null==E||null==P[0]||null==P[1]?null:E<u(P[0])||E>u(P[1]);case "LIKE":return w(this._evaluateNode(P.left,
N,H),this._evaluateNode(P.right,N,H),P.escape);case "NOT LIKE":return e(w(this._evaluateNode(P.left,N,H),this._evaluateNode(P.right,N,H),P.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return z(P.operator,this._evaluateNode(P.left,N,H),this._evaluateNode(P.right,N,H));case "-":case "+":case "*":case "/":return y(P.operator,this._evaluateNode(P.left,N,H),this._evaluateNode(P.right,N,H))}case "null":case "boolean":case "string":case "number":return P.value;
case "date":return d(P.value);case "timestamp":return h(P.value);case "current-time":return N=new Date,"date"===P.mode&&N.setHours(0,0,0,0),N;case "column-reference":return B(N,P.column,this._datefields,H);case "function":return N=this._evaluateNode(P.args,N,H),this.isAggregate?r.aggregateFunction(P.name,N):m.evaluateFunction(P.name,N)}throw Error("Unsupported sql syntax "+P.type);};b._createClass(K,[{key:"fieldNames",get:function(){return this._referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=
this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,P=>{"current-time"===P.type?this._hasDateFunctions=!0:"function"===P.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(P.name.toLowerCase()))});return this._hasDateFunctions}}]);return K}();var J;(function(K){K[K.Normal=0]="Normal";K[K.Escaped=1]="Escaped"})(J||(J={}));const L={getAttribute(K,O){return(K&&"object"===typeof K.attributes?K.attributes:K)[O]}};a.WhereClause=G;a.defaultAttributeAdapter=
L;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function b(m){let n=0;for(let p=0;p<m.length;p++)n+=m[p];return n/m.length}function c(m){const n=b(m),p=m.length;let g=0;for(const h of m)g+=(h-n)**2;return 1<p?g/(p-1):0}const r={min:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.min.apply(Math,m[0])},max:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.max.apply(Math,
m[0])},avg:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:b(m[0])},sum:{minParams:1,maxParams:1,evaluate:m=>{if(null==m[0])m=null;else{m=m[0];let n=0;for(let p=0;p<m.length;p++)n+=m[p];m=n}return m}},stddev:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.sqrt(c(m[0]))},count:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:m[0].length},var:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:c(m[0])}};a.aggregateFunction=function(m,n){const p=r[m.toLowerCase()];if(null==p)throw Error("Function Not Recognised");
if(n.length<p.minParams||n.length>p.maxParams)throw Error(`Invalid Parameter count for call to ${m.toUpperCase()}`);return p.evaluate(n)};a.isAggregate=function(m,n){m=r[m.toLowerCase()];return null!=m&&n>=m.minParams&&n<=m.maxParams};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(a,b){let c=function(){function m(){this.op="+";this.minute=this.year=this.month=this.hour=
this.second=this.day=0}m._fixDefaults=function(n){if(null!==n.precision||null!==n.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};m.createFromMilliseconds=function(n){const p=new m;p.second=n/1E3;return p};m.createFromValueAndQualifer=function(n,p,g){let h=null;const d=new m;d.op="-"===g?"-":"+";if("interval-period"===p.type){m._fixDefaults(p);g=RegExp("^[0-9]{1,}$");if("year"===p.period||"month"===p.period)throw Error("Year-Month Intervals not supported");if(g.test(n))d[p.period]=
parseFloat(n);else throw Error("Illegal Interval");}else{m._fixDefaults(p.start);m._fixDefaults(p.end);if("year"===p.start.period||"month"===p.start.period)throw Error("Year-Month Intervals not supported");if("year"===p.end.period||"month"===p.end.period)throw Error("Year-Month Intervals not supported");switch(p.start.period){case "day":switch(p.end.period){case "hour":h=RegExp("^[0-9]{1,} [0-9]{1,}$");if(h.test(n))d[p.start.period]=parseFloat(n.split(" ")[0]),d[p.end.period]=parseFloat(n.split(" ")[1]);
else throw Error("Illegal Interval");break;case "minute":h=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(h.test(n))d[p.start.period]=parseFloat(n.split(" ")[0]),n=n.split(" ")[1].split(":"),d.hour=parseFloat(n[0]),d.minute=parseFloat(n[1]);else throw Error("Illegal Interval");break;case "second":h=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(h.test(n))d[p.start.period]=parseFloat(n.split(" ")[0]),n=n.split(" ")[1].split(":"),d.hour=parseFloat(n[0]),d.minute=parseFloat(n[1]),
d.second=parseFloat(n[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "hour":switch(p.end.period){case "minute":h=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(h.test(n))d.hour=parseFloat(n.split(":")[0]),d.minute=parseFloat(n.split(":")[1]);else throw Error("Illegal Interval");break;case "second":h=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(h.test(n))n=n.split(":"),d.hour=parseFloat(n[0]),d.minute=parseFloat(n[1]),d.second=parseFloat(n[2]);
else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "minute":switch(p.end.period){case "second":h=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(h.test(n))n=n.split(":"),d.minute=parseFloat(n[0]),d.second=parseFloat(n[1]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;default:throw Error("Invalid Interval.");}}return d};m.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+
6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return m}();const r={extract:{minParams:2,maxParams:2,evaluate:([m,n])=>{if(null==n)return null;if(n instanceof Date)switch(m.toUpperCase()){case "SECOND":return n.getSeconds();case "MINUTE":return n.getMinutes();case "HOUR":return n.getHours();case "DAY":return n.getDate();case "MONTH":return n.getMonth()+1;case "YEAR":return n.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,
maxParams:3,evaluate:m=>{if(2===m.length){const [n,p]=m;return null==n||null==p?null:n.toString().substring(p-1)}if(3===m.length){const [n,p,g]=m;return null==n||null==p||null==g?null:0>=g?"":n.toString().substring(p-1,p+g-1)}}},position:{minParams:2,maxParams:2,evaluate:([m,n])=>null==m||null==n?null:n.indexOf(m)+1},trim:{minParams:2,maxParams:3,evaluate:m=>{var n=3===m.length,p=n?m[1]:" ";n=n?m[2]:m[1];if(null==p||null==n)return null;p=`(${b.escapeRegExpString(p)})`;switch(m[0]){case "BOTH":return n.replace(new RegExp(`^${p}*|${p}*$`,
"g"),"");case "LEADING":return n.replace(new RegExp(`^${p}*`,"g"),"");case "TRAILING":return n.replace(new RegExp(`${p}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.abs(m[0])},ceiling:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.ceil(m[0])},floor:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.floor(m[0])},log:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.log(m[0])},log10:{minParams:1,
maxParams:1,evaluate:m=>null==m[0]?null:Math.log(m[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.sin(m[0])},cos:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.cos(m[0])},tan:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.tan(m[0])},asin:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.asin(m[0])},acos:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.acos(m[0])},atan:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.atan(m[0])},
sign:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:0<m[0]?1:0>m[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:m=>null==m[0]||null==m[1]?null:m[0]**m[1]},mod:{minParams:2,maxParams:2,evaluate:m=>null==m[0]||null==m[1]?null:m[0]%m[1]},round:{minParams:1,maxParams:2,evaluate:m=>{const n=m[0];m=2===m.length?10**m[1]:1;return null==n?null:Math.round(n*m)/m}},truncate:{minParams:1,maxParams:2,evaluate:m=>null==m[0]?null:1===m.length?parseInt(m[0].toFixed(0),10):parseFloat(m[0].toFixed(m[1]))},
char_length:{minParams:1,maxParams:1,evaluate:m=>"string"===typeof m[0]||m[0]instanceof String?m[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:m=>{let n="";for(let p=0;p<m.length;p++){if(null==m[p])return null;n+=m[p].toString()}return n}},lower:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:m[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:m[0].toString().toUpperCase()}};a.SqlInterval=c;a.evaluateFunction=function(m,n){const p=r[m.toLowerCase()];
if(null==p)throw Error("Function Not Recognised");if(n.length<p.minParams||n.length>p.maxParams)throw Error(`Invalid Parameter count for call to ${m.toUpperCase()}`);return p.evaluate(n)};a.isStandardized=function(m,n){m=r[m.toLowerCase()];return null!=m&&n>=m.minParams&&n<=m.maxParams};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var c={exports:{}};
(function(m){(function(n,p){m.exports&&(m.exports=p())})(b.commonjsGlobal,function(){function n(g,h,d,f){g=Error.call(this,g);Object.setPrototypeOf&&Object.setPrototypeOf(g,n.prototype);g.expected=h;g.found=d;g.location=f;g.name="SyntaxError";return g}function p(g,h,d){d=d||" ";if(g.length>h)return g;h-=g.length;d+=d.repeat(h);return g+d.slice(0,h)}(function(g,h){function d(){this.constructor=g}d.prototype=h.prototype;g.prototype=new d})(n,Error);n.prototype.format=function(g){var h="Error: "+this.message;
if(this.location){var d=null,f;for(f=0;f<g.length;f++)if(g[f].source===this.location.source){d=g[f].text.split(/\r\n|\n|\r/g);break}g=this.location.start;f=this.location.source+":"+g.line+":"+g.column;if(d){var e=this.location.end,l=p("",g.line.toString().length," ");d=d[g.line-1];e=(g.line===e.line?e.column:d.length+1)-g.column||1;h+="\n --\x3e "+f+"\n"+l+" |\n"+g.line+" | "+d+"\n"+l+" | "+p("",g.column-1," ")+p("",e,"^")}else h+="\n at "+f}return h};n.buildMessage=function(g,h){function d(t){return t.charCodeAt(0).toString(16).toUpperCase()}
function f(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+d(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+d(w)})}function e(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+
d(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+d(w)})}function l(t){return A[t.type](t)}var A={literal:function(t){return'"'+f(t.text)+'"'},class:function(t){var w=t.parts.map(function(u){return Array.isArray(u)?e(u[0])+"-"+e(u[1]):e(u)});return"["+(t.inverted?"^":"")+w.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};return"Expected "+function(t){t=t.map(l);var w,u;t.sort();if(0<t.length){for(u=w=1;w<
t.length;w++)t[w-1]!==t[w]&&(t[u]=t[w],u++);t.length=u}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(g)+" but "+(h?'"'+f(h)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(g,h){function d(Ca,Ga){return{type:"literal",text:Ca,ignoreCase:Ga}}function f(Ca,Ga,Ka){return{type:"class",parts:Ca,inverted:Ga,ignoreCase:Ka}}function e(Ca){var Ga=Bd[Ca],Ka;if(!Ga){for(Ka=Ca-1;!Bd[Ka];)Ka--;Ga=Bd[Ka];for(Ga=
{line:Ga.line,column:Ga.column};Ka<Ca;)10===g.charCodeAt(Ka)?(Ga.line++,Ga.column=1):Ga.column++,Ka++;Bd[Ca]=Ga}return Ga}function l(Ca,Ga){var Ka=e(Ca),Ya=e(Ga);return{source:Ta,start:{offset:Ca,line:Ka.line,column:Ka.column},end:{offset:Ga,line:Ya.line,column:Ya.column}}}function A(Ca){sa<hc||(sa>hc&&(hc=sa,Zd=[]),Zd.push(Ca))}function t(){var Ca=sa;ya();var Ga=u();Ga!==ja?(ya(),Ca=Ga):(sa=Ca,Ca=ja);return Ca}function w(){var Ca=sa;var Ga=u();if(Ga!==ja){Ca=[];var Ka=sa;var Ya=ya();var hb=Ba();
if(hb!==ja){var rb=ya();var tb=u();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;for(;Ka!==ja;)Ca.push(Ka),Ka=sa,Ya=ya(),hb=Ba(),hb!==ja?(rb=ya(),tb=u(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja);Ka={type:"expression-list"};Ga=[Ga];for(Ya=0;Ya<Ca.length;Ya++)Ga.push(Ca[Ya][3]);Ka.value=Ga;Ca=Ka}else sa=Ca,Ca=ja;return Ca}function u(){var Ca=sa;var Ga=z();if(Ga!==ja){Ca=[];var Ka=sa;var Ya=ya();var hb=ka();if(hb!==ja){var rb=ya();var tb=z();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=
Ka,Ka=ja)}else sa=Ka,Ka=ja;for(;Ka!==ja;)Ca.push(Ka),Ka=sa,Ya=ya(),hb=ka(),hb!==ja?(rb=ya(),tb=z(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja);Ca=Sa(Ga,Ca)}else sa=Ca,Ca=ja;return Ca}function z(){var Ca=sa;var Ga=y();if(Ga!==ja){Ca=[];var Ka=sa;var Ya=ya();var hb=ha();if(hb!==ja){var rb=ya();var tb=y();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;for(;Ka!==ja;)Ca.push(Ka),Ka=sa,Ya=ya(),hb=ha(),hb!==ja?(rb=ya(),tb=y(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=
ja);Ca=Sa(Ga,Ca)}else sa=Ca,Ca=ja;return Ca}function y(){var Ca=sa;var Ga=ma();if(Ga===ja){Ga=sa;if(33===g.charCodeAt(sa)){var Ka=Oa;sa++}else Ka=ja,0===Za&&A(Vd);if(Ka!==ja){var Ya=sa;Za++;if(61===g.charCodeAt(sa)){var hb=Va;sa++}else hb=ja,0===Za&&A(lc);Za--;hb===ja?Ya=void 0:(sa=Ya,Ya=ja);Ya!==ja?Ga=Ka=[Ka,Ya]:(sa=Ga,Ga=ja)}else sa=Ga,Ga=ja}Ga!==ja?(Ka=ya(),Ya=y(),Ya!==ja?Ca={type:"unary-expression",operator:"NOT",expr:Ya}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja);if(Ca===ja){Ga=sa;Ca=q();if(Ca!==ja){ya();
Ga=[];Ka=sa;Ya=ya();hb=B();if(hb!==ja){var rb=ya();var tb=q();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;if(Ka!==ja)for(;Ka!==ja;)Ga.push(Ka),Ka=sa,Ya=ya(),hb=B(),hb!==ja?(rb=ya(),tb=q(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja);else Ga=ja;Ga!==ja&&(Ga={type:"arithmetic",tail:Ga});Ga===ja&&(Ga=sa,Ka=k(),Ka!==ja?(ya(),Ya=Ha(),Ya!==ja?(ya(),Ya=w(),Ya!==ja?(ya(),hb=wa(),hb!==ja?Ga={op:Ka,right:Ya}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja),Ga===ja&&(Ga=
sa,Ka=k(),Ka!==ja?(ya(),Ya=Ha(),Ya!==ja?(ya(),Ya=wa(),Ya!==ja?Ga={op:Ka,right:{type:"expression-list",value:[]}}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja),Ga===ja&&(Ga=sa,Ka=k(),Ka!==ja?(ya(),Ya=O(),Ya!==ja?Ga={op:Ka,right:Ya}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja))),Ga===ja&&(Ga=sa,hb=ma(),hb!==ja?(ya(),Ka=Z(),Ka!==ja?(ya(),Ya=q(),Ya!==ja?(ya(),rb=ha(),rb!==ja?(ya(),hb=q(),hb!==ja?Ga={op:"NOT"+Ka,right:{type:"expression-list",value:[Ya,hb]}}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=
Ga,Ga=ja),Ga===ja&&(Ga=sa,hb=Z(),hb!==ja?(ya(),Ka=q(),Ka!==ja?(ya(),Ya=ha(),Ya!==ja?(ya(),rb=q(),rb!==ja?Ga={op:hb,right:{type:"expression-list",value:[Ka,rb]}}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)),Ga===ja&&(Ga=sa,Ka=ba(),Ka!==ja?(ya(),Ya=ma(),Ya!==ja?(ya(),Ya=q(),Ya!==ja?Ga={op:Ka+"NOT",right:Ya}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja),Ga===ja&&(Ga=sa,Ka=ba(),Ka!==ja?(ya(),Ya=q(),Ya!==ja?Ga={op:Ka,right:Ya}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)),Ga===ja&&(Ga=sa,Ka=C(),Ka!==ja?(ya(),
Ya=M(),Ya!==ja?(ya(),hb=sa,g.substr(sa,6).toLowerCase()===Da?(rb=g.substr(sa,6),sa+=6):(rb=ja,0===Za&&A(Vc)),rb!==ja?(rb=sa,Za++,tb=L(),Za--,tb===ja?rb=void 0:(sa=rb,rb=ja),rb!==ja?hb="ESCAPE":(sa=hb,hb=ja)):(sa=hb,hb=ja),hb!==ja?(ya(),hb=Q(),hb!==ja?Ga={op:Ka,right:Ya,escape:hb.value}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja),Ga===ja&&(Ga=sa,Ka=C(),Ka!==ja?(ya(),Ya=M(),Ya!==ja?Ga={op:Ka,right:Ya,escape:""}:(sa=Ga,Ga=ja)):(sa=Ga,Ga=ja))))));Ga===ja&&(Ga=null);""==Ga||void 0==Ga||
null==Ga?Ga=Ca:(Ka=null,Ga=Ka="arithmetic"==Ga.type?Sa(Ca,Ga.tail):Ra(Ga.op,Ca,Ga.right,Ga.escape))}else sa=Ga,Ga=ja;Ca=Ga}return Ca}function B(){if(g.substr(sa,2)===Ua){var Ca=Ua;sa+=2}else Ca=ja,0===Za&&A(uc);Ca===ja&&(62===g.charCodeAt(sa)?(Ca=La,sa++):(Ca=ja,0===Za&&A(vc)),Ca===ja&&(g.substr(sa,2)===ta?(Ca=ta,sa+=2):(Ca=ja,0===Za&&A(wc)),Ca===ja&&(g.substr(sa,2)===xa?(Ca=xa,sa+=2):(Ca=ja,0===Za&&A(xc)),Ca===ja&&(60===g.charCodeAt(sa)?(Ca=Ia,sa++):(Ca=ja,0===Za&&A(yc)),Ca===ja&&(61===g.charCodeAt(sa)?
(Ca=Va,sa++):(Ca=ja,0===Za&&A(lc)),Ca===ja&&(g.substr(sa,2)===Qa?(Ca=Qa,sa+=2):(Ca=ja,0===Za&&A(Yc))))))));return Ca}function C(){var Ca=Ca=sa;var Ga=ma();if(Ga!==ja){var Ka=ya();var Ya=ia();Ya!==ja?Ca=Ga=[Ga,Ka,Ya]:(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;Ca!==ja&&(Ca=Ca[0]+" "+Ca[2]);Ca===ja&&(Ca=ia());return Ca}function k(){var Ca=Ca=sa;var Ga=ma();if(Ga!==ja){var Ka=ya();var Ya=aa();Ya!==ja?Ca=Ga=[Ga,Ka,Ya]:(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;Ca!==ja&&(Ca=Ca[0]+" "+Ca[2]);Ca===ja&&(Ca=aa());return Ca}function q(){var Ca=
sa;var Ga=v();if(Ga!==ja){Ca=[];var Ka=sa;var Ya=ya();var hb=x();if(hb!==ja){var rb=ya();var tb=v();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;for(;Ka!==ja;)Ca.push(Ka),Ka=sa,Ya=ya(),hb=x(),hb!==ja?(rb=ya(),tb=v(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja);Ca=Sa(Ga,Ca)}else sa=Ca,Ca=ja;return Ca}function x(){if(43===g.charCodeAt(sa)){var Ca=Xa;sa++}else Ca=ja,0===Za&&A(Tb);Ca===ja&&(45===g.charCodeAt(sa)?(Ca=cb,sa++):(Ca=ja,0===Za&&A(cc)));return Ca}function v(){var Ca=
sa;var Ga=F();if(Ga!==ja){Ca=[];var Ka=sa;var Ya=ya();var hb=D();if(hb!==ja){var rb=ya();var tb=F();tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;for(;Ka!==ja;)Ca.push(Ka),Ka=sa,Ya=ya(),hb=D(),hb!==ja?(rb=ya(),tb=F(),tb!==ja?Ka=Ya=[Ya,hb,rb,tb]:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja);Ca=Sa(Ga,Ca)}else sa=Ca,Ca=ja;return Ca}function D(){if(42===g.charCodeAt(sa)){var Ca=db;sa++}else Ca=ja,0===Za&&A(qc);Ca===ja&&(47===g.charCodeAt(sa)?(Ca=fb,sa++):(Ca=ja,0===Za&&A(rc)));return Ca}function F(){var Ca=
Q();if(Ca===ja){var Ga=sa;var Ka=sa;var Ya=Y();if(Ya!==ja){var hb=V();if(hb!==ja){var rb=R();rb!==ja?Ka=parseFloat(Ya+hb+rb):(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja}else sa=Ka,Ka=ja;Ka===ja&&(Ka=sa,Ya=Y(),Ya!==ja?(hb=V(),hb!==ja?Ka=parseFloat(Ya+hb):(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja),Ka===ja&&(Ka=sa,Ya=Y(),Ya!==ja?(hb=R(),hb!==ja?Ka=parseFloat(Ya+hb):(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja),Ka===ja&&(Ka=sa,Ya=Y(),Ya!==ja&&(Ya=parseFloat(Ya)),Ka=Ya)));var tb=Ka;if(tb!==ja){var Cd=sa;Za++;var Ge=J();Za--;Ge===ja?Cd=void 0:(sa=
Cd,Cd=ja);Cd!==ja?Ga={type:"number",value:tb}:(sa=Ga,Ga=ja)}else sa=Ga,Ga=ja;Ca=Ga;if(Ca===ja){var Zc=sa;var Hc=sa;if(g.substr(sa,4).toLowerCase()===ab){var Dd=g.substr(sa,4);sa+=4}else Dd=ja,0===Za&&A(qd);if(Dd!==ja){var $c=sa;Za++;var He=L();Za--;He===ja?$c=void 0:(sa=$c,$c=ja);$c!==ja?Hc=Dd=[Dd,$c]:(sa=Hc,Hc=ja)}else sa=Hc,Hc=ja;var Dc=Hc;Dc!==ja&&(Dc={type:"boolean",value:!0});Zc=Dc;if(Zc===ja){Zc=sa;var Ic=sa;if(g.substr(sa,5).toLowerCase()===ib){var Ed=g.substr(sa,5);sa+=5}else Ed=ja,0===Za&&
A(rd);if(Ed!==ja){var ad=sa;Za++;var Ie=L();Za--;Ie===ja?ad=void 0:(sa=ad,ad=ja);ad!==ja?Ic=Ed=[Ed,ad]:(sa=Ic,Ic=ja)}else sa=Ic,Ic=ja;Dc=Ic;Dc!==ja&&(Dc={type:"boolean",value:!1});Zc=Dc}Ca=Zc;if(Ca===ja){var Jc=sa;if(g.substr(sa,4).toLowerCase()===Bb){var Fd=g.substr(sa,4);sa+=4}else Fd=ja,0===Za&&A(pd);if(Fd!==ja){var bd=sa;Za++;var Je=L();Za--;Je===ja?bd=void 0:(sa=bd,bd=ja);bd!==ja?Jc=Fd=[Fd,bd]:(sa=Jc,Jc=ja)}else sa=Jc,Jc=ja;var $d=Jc;$d!==ja&&($d={type:"null",value:null});Ca=$d;if(Ca===ja){var Kc=
sa;var Lc=sa;if(g.substr(sa,4).toLowerCase()===pb){var me=g.substr(sa,4);sa+=4}else me=ja,0===Za&&A(Wc);if(me!==ja){var Gd=sa;Za++;var Ke=L();Za--;Ke===ja?Gd=void 0:(sa=Gd,Gd=ja);Gd!==ja?Lc="DATE":(sa=Lc,Lc=ja)}else sa=Lc,Lc=ja;if(Lc!==ja){ya();var ne=M();ne!==ja?Kc={type:"date",value:ne.value}:(sa=Kc,Kc=ja)}else sa=Kc,Kc=ja;Ca=Kc;if(Ca===ja){var Mc=sa;var Nc=sa;if(g.substr(sa,9).toLowerCase()===Gb){var oe=g.substr(sa,9);sa+=9}else oe=ja,0===Za&&A(Ad);if(oe!==ja){var Hd=sa;Za++;var Le=L();Za--;Le===
ja?Hd=void 0:(sa=Hd,Hd=ja);Hd!==ja?Nc="TIMESTAMP":(sa=Nc,Nc=ja)}else sa=Nc,Nc=ja;if(Nc!==ja){ya();var pe=M();pe!==ja?Mc={type:"timestamp",value:pe.value}:(sa=Mc,Mc=ja)}else sa=Mc,Mc=ja;Ca=Mc;if(Ca===ja){var Pb=sa;var ae=ea();if(ae!==ja){ya();if(45===g.charCodeAt(sa)){var mc=cb;sa++}else mc=ja,0===Za&&A(cc);mc===ja&&(43===g.charCodeAt(sa)?(mc=Xa,sa++):(mc=ja,0===Za&&A(Tb)));if(mc!==ja){ya();var cd=M();if(cd!==ja){ya();var qe=N();qe!==ja?Pb={type:"interval",value:cd,qualifier:qe,op:mc}:(sa=Pb,Pb=ja)}else sa=
Pb,Pb=ja}else sa=Pb,Pb=ja}else sa=Pb,Pb=ja;Pb===ja&&(Pb=sa,ae=ea(),ae!==ja?(ya(),mc=M(),mc!==ja?(ya(),cd=N(),cd!==ja?Pb={type:"interval",value:mc,qualifier:cd,op:""}:(sa=Pb,Pb=ja)):(sa=Pb,Pb=ja)):(sa=Pb,Pb=ja));Ca=Pb}}}}}}var Kb=Ca;if(Kb===ja){var Yb=sa;var Oc=sa;if(g.substr(sa,7).toLowerCase()===lb){var re=g.substr(sa,7);sa+=7}else re=ja,0===Za&&A(Gc);if(re!==ja){var Id=sa;Za++;var Me=L();Za--;Me===ja?Id=void 0:(sa=Id,Id=ja);Id!==ja?Oc="EXTRACT":(sa=Oc,Oc=ja)}else sa=Oc,Oc=ja;if(Oc!==ja){ya();var Ne=
Ha();if(Ne!==ja){ya();var ec=da();ec===ja&&(ec=la(),ec===ja&&(ec=oa(),ec===ja&&(ec=ra(),ec===ja&&(ec=Aa(),ec===ja&&(ec=ua())))));var se=ec;if(se!==ja){ya();var Oe=ca();if(Oe!==ja){ya();var te=u();if(te!==ja){ya();var Pe=wa();Pe!==ja?Yb={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:se},te]}}:(sa=Yb,Yb=ja)}else sa=Yb,Yb=ja}else sa=Yb,Yb=ja}else sa=Yb,Yb=ja}else sa=Yb,Yb=ja}else sa=Yb,Yb=ja;Kb=Yb;if(Kb===ja){var Zb=sa;var Pc=sa;if(g.substr(sa,9).toLowerCase()===
gb){var ue=g.substr(sa,9);sa+=9}else ue=ja,0===Za&&A(Fc);if(ue!==ja){var Jd=sa;Za++;var Qe=L();Za--;Qe===ja?Jd=void 0:(sa=Jd,Jd=ja);Jd!==ja?Pc="SUBSTRING":(sa=Pc,Pc=ja)}else sa=Pc,Pc=ja;if(Pc!==ja){ya();var Re=Ha();if(Re!==ja){ya();var be=u();if(be!==ja){ya();var Se=ca();if(Se!==ja){ya();var ce=u();if(ce!==ja){ya();var nc=sa;var Qc=sa;if(g.substr(sa,3).toLowerCase()===kb){var ve=g.substr(sa,3);sa+=3}else ve=ja,0===Za&&A(Ec);if(ve!==ja){var Kd=sa;Za++;var Te=L();Za--;Te===ja?Kd=void 0:(sa=Kd,Kd=ja);
Kd!==ja?Qc="FOR":(sa=Qc,Qc=ja)}else sa=Qc,Qc=ja;var dd=Qc;if(dd!==ja){var Ue=ya();var we=u();if(we!==ja){var Ve=ya();nc=dd=[dd,Ue,we,Ve]}else sa=nc,nc=ja}else sa=nc,nc=ja;nc===ja&&(nc=null);dd=wa();dd!==ja?Zb={type:"function",name:"substring",args:{type:"expression-list",value:nc?[be,ce,nc[2]]:[be,ce]}}:(sa=Zb,Zb=ja)}else sa=Zb,Zb=ja}else sa=Zb,Zb=ja}else sa=Zb,Zb=ja}else sa=Zb,Zb=ja}else sa=Zb,Zb=ja;Kb=Zb;if(Kb===ja){var Mb=sa;var de=fa();if(de!==ja){ya();var ee=Ha();if(ee!==ja){ya();var oc=P();
oc===ja&&(oc=null);ya();var ed=u();if(ed!==ja){ya();var fe=ca();if(fe!==ja){ya();var xe=u();if(xe!==ja){ya();var We=wa();We!==ja?Mb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==oc?"BOTH":oc},ed,xe]}}:(sa=Mb,Mb=ja)}else sa=Mb,Mb=ja}else sa=Mb,Mb=ja}else sa=Mb,Mb=ja}else sa=Mb,Mb=ja}else sa=Mb,Mb=ja;Mb===ja&&(Mb=sa,de=fa(),de!==ja?(ya(),ee=Ha(),ee!==ja?(ya(),oc=P(),oc===ja&&(oc=null),ya(),ed=u(),ed!==ja?(ya(),fe=wa(),fe!==ja?Mb={type:"function",name:"trim",
args:{type:"expression-list",value:[{type:"string",value:null==oc?"BOTH":oc},ed]}}:(sa=Mb,Mb=ja)):(sa=Mb,Mb=ja)):(sa=Mb,Mb=ja)):(sa=Mb,Mb=ja));Kb=Mb;if(Kb===ja){var $b=sa;var Rc=sa;if(g.substr(sa,8).toLowerCase()===Eb){var ye=g.substr(sa,8);sa+=8}else ye=ja,0===Za&&A(zd);if(ye!==ja){var Ld=sa;Za++;var Xe=L();Za--;Xe===ja?Ld=void 0:(sa=Ld,Ld=ja);Ld!==ja?Rc="POSITION":(sa=Rc,Rc=ja)}else sa=Rc,Rc=ja;if(Rc!==ja){ya();var Ye=Ha();if(Ye!==ja){ya();var ze=u();if(ze!==ja){ya();var Ze=aa();if(Ze!==ja){ya();
var Ae=u();if(Ae!==ja){ya();var $e=wa();$e!==ja?$b={type:"function",name:"position",args:{type:"expression-list",value:[ze,Ae]}}:(sa=$b,$b=ja)}else sa=$b,$b=ja}else sa=$b,$b=ja}else sa=$b,$b=ja}else sa=$b,$b=ja}else sa=$b,$b=ja;Kb=$b;if(Kb===ja){var zc=sa;var Md;var fc=sa;fc=Md=G();if(fc===ja)if(fc=sa,96===g.charCodeAt(sa)?(Md=Xb,sa++):(Md=ja,0===Za&&A(Be)),Md!==ja){var Nd=[];if(ld.test(g.charAt(sa))){var pc=g.charAt(sa);sa++}else pc=ja,0===Za&&A(Ce);if(pc!==ja)for(;pc!==ja;)Nd.push(pc),ld.test(g.charAt(sa))?
(pc=g.charAt(sa),sa++):(pc=ja,0===Za&&A(Ce));else Nd=ja;Nd!==ja?(96===g.charCodeAt(sa)?(pc=Xb,sa++):(pc=ja,0===Za&&A(Be)),pc!==ja?fc=Nd.join(""):(sa=fc,fc=ja)):(sa=fc,fc=ja)}else sa=fc,fc=ja;var De=fc;if(De!==ja){ya();var af=Ha();if(af!==ja){ya();var Od=w();Od===ja&&(Od=null);ya();var bf=wa();bf!==ja?zc={type:"function",name:De,args:Od?Od:{type:"expression-list",value:[]}}:(sa=zc,zc=ja)}else sa=zc,zc=ja}else sa=zc,zc=ja;Kb=zc;if(Kb===ja){var ic;var Qb=sa;var ge=za();if(ge!==ja){ya();var fd=u();if(fd!==
ja){ya();var gd=[];for(ic=S();ic!==ja;)gd.push(ic),ic=S();ic=ya();var Pd=va();Pd!==ja?Qb={type:"case-expression",format:"simple",operand:fd,clauses:gd,else:null}:(sa=Qb,Qb=ja)}else sa=Qb,Qb=ja}else sa=Qb,Qb=ja;if(Qb===ja)if(Qb=sa,ge=za(),ge!==ja)if(ya(),fd=u(),fd!==ja){ya();gd=[];for(ic=S();ic!==ja;)gd.push(ic),ic=S();ic=ya();Pd=U();if(Pd!==ja){ya();var cf=va();cf!==ja?Qb={type:"case-expression",format:"simple",operand:fd,clauses:gd,else:Pd.value}:(sa=Qb,Qb=ja)}else sa=Qb,Qb=ja}else sa=Qb,Qb=ja;else sa=
Qb,Qb=ja;var he=Qb;if(he===ja){var jc;var Ub=sa;var ie=za();if(ie!==ja){ya();var hd=[];for(jc=T();jc!==ja;)hd.push(jc),jc=T();jc=ya();var Qd=va();Qd!==ja?Ub={type:"case-expression",format:"searched",clauses:hd,else:null}:(sa=Ub,Ub=ja)}else sa=Ub,Ub=ja;if(Ub===ja)if(Ub=sa,ie=za(),ie!==ja){ya();hd=[];for(jc=T();jc!==ja;)hd.push(jc),jc=T();jc=ya();Qd=U();if(Qd!==ja){ya();var df=va();df!==ja?Ub={type:"case-expression",format:"searched",clauses:hd,else:Qd.value}:(sa=Ub,Ub=ja)}else sa=Ub,Ub=ja}else sa=
Ub,Ub=ja;he=Ub}Kb=he;if(Kb===ja){var Rd;var Sd=sa;var Ee=J();if(Ee!==ja){var Fe=[];for(Rd=K();Rd!==ja;)Fe.push(Rd),Rd=K();Sd=Ee+Fe.join("")}else sa=Sd,Sd=ja;var Td=Sd;if(Td!==ja){var je=Td;Td=/^CURRENT_DATE$/i.test(je)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(je)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:je}}Kb=Td;if(Kb===ja&&(Kb=O(),Kb===ja)){Kb=sa;var ef=Ha();if(ef!==ja){ya();var ke=u();if(ke!==ja){ya();var ff=wa();ff!==ja?(ke.paren=!0,
Kb=ke):(sa=Kb,Kb=ja)}else sa=Kb,Kb=ja}else sa=Kb,Kb=ja}}}}}}}}return Kb}function G(){var Ca;var Ga=sa;var Ka=J();if(Ka!==ja){Ga=[];for(Ca=L();Ca!==ja;)Ga.push(Ca),Ca=L();Ga=Ka+Ga.join("")}else sa=Ga,Ga=ja;return Ga}function J(){if(ac.test(g.charAt(sa))){var Ca=g.charAt(sa);sa++}else Ca=ja,0===Za&&A(kc);return Ca}function L(){if(gc.test(g.charAt(sa))){var Ca=g.charAt(sa);sa++}else Ca=ja,0===Za&&A(sc);return Ca}function K(){if(dc.test(g.charAt(sa))){var Ca=g.charAt(sa);sa++}else Ca=ja,0===Za&&A(tc);
return Ca}function O(){var Ca=sa;if(64===g.charCodeAt(sa)){var Ga=jb;sa++}else Ga=ja,0===Za&&A(Ac);if(Ga!==ja){var Ka=G();Ka!==ja?Ca=Ga=[Ga,Ka]:(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;Ca!==ja&&(Ca={type:"parameter",value:Ca[1]});return Ca}function P(){var Ca=sa;if(g.substr(sa,7).toLowerCase()===mb){var Ga=g.substr(sa,7);sa+=7}else Ga=ja,0===Za&&A(Xd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="LEADING":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;Ca===ja&&(Ca=sa,g.substr(sa,8).toLowerCase()===
zb?(Ga=g.substr(sa,8),sa+=8):(Ga=ja,0===Za&&A(Yd)),Ga!==ja?(Ga=sa,Za++,Ka=L(),Za--,Ka===ja?Ga=void 0:(sa=Ga,Ga=ja),Ga!==ja?Ca="TRAILING":(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja),Ca===ja&&(Ca=sa,g.substr(sa,4).toLowerCase()===Fb?(Ga=g.substr(sa,4),sa+=4):(Ga=ja,0===Za&&A(td)),Ga!==ja?(Ga=sa,Za++,Ka=L(),Za--,Ka===ja?Ga=void 0:(sa=Ga,Ga=ja),Ga!==ja?Ca="BOTH":(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)));return Ca}function N(){var Ca=sa;var Ga=sa;var Ka=H();if(Ka!==ja){ya();var Ya=Ha();if(Ya!==ja)if(ya(),Ya=I(),Ya!==ja){ya();var hb=
wa();hb!==ja?Ga={type:"interval-period",period:Ka.value,precision:Ya,secondary:null}:(sa=Ga,Ga=ja)}else sa=Ga,Ga=ja;else sa=Ga,Ga=ja}else sa=Ga,Ga=ja;Ga===ja&&(Ga=sa,Ka=H(),Ka!==ja&&(Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Ga=Ka);if(Ga!==ja)if(ya(),Ka=sa,g.substr(sa,2).toLowerCase()===ub?(Ya=g.substr(sa,2),sa+=2):(Ya=ja,0===Za&&A(gf)),Ya!==ja?(Ya=sa,Za++,hb=L(),Za--,hb===ja?Ya=void 0:(sa=Ya,Ya=ja),Ya!==ja?Ka="TO":(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja),Ka!==ja){ya();Ka=sa;
Ya=H();Ya!==ja&&(Ya={type:"interval-period",period:Ya.value,precision:null,secondary:null});Ka=Ya;if(Ka===ja){Ka=sa;Ya=ua();if(Ya!==ja)if(ya(),Ya=Ha(),Ya!==ja)if(ya(),Ya=I(),Ya!==ja)if(ya(),hb=Ba(),hb!==ja)if(ya(),hb=E(),hb!==ja){ya();var rb=wa();rb!==ja?Ka={type:"interval-period",period:"second",precision:Ya,secondary:hb}:(sa=Ka,Ka=ja)}else sa=Ka,Ka=ja;else sa=Ka,Ka=ja;else sa=Ka,Ka=ja;else sa=Ka,Ka=ja;else sa=Ka,Ka=ja;Ka===ja&&(Ka=sa,Ya=ua(),Ya!==ja?(ya(),Ya=Ha(),Ya!==ja?(ya(),Ya=I(),Ya!==ja?(ya(),
hb=wa(),hb!==ja?Ka={type:"interval-period",period:"second",precision:Ya,secondary:null}:(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja)):(sa=Ka,Ka=ja),Ka===ja&&(Ka=sa,Ya=ua(),Ya!==ja&&(Ya={type:"interval-period",period:"second",precision:null,secondary:null}),Ka=Ya))}Ka!==ja?Ca={type:"interval-qualifier",start:Ga,end:Ka}:(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;else sa=Ca,Ca=ja;Ca===ja&&(Ca=sa,Ka=H(),Ka!==ja?(ya(),Ga=Ha(),Ga!==ja?(ya(),Ga=E(),Ga!==ja?(ya(),Ya=wa(),Ya!==ja?Ca={type:"interval-period",period:Ka.value,
precision:Ga,secondary:null}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja),Ca===ja&&(Ca=sa,Ka=H(),Ka!==ja&&(Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Ca=Ka,Ca===ja&&(Ca=sa,Ka=ua(),Ka!==ja?(ya(),Ga=Ha(),Ga!==ja?(ya(),Ga=I(),Ga!==ja?(ya(),Ya=Ba(),Ya!==ja?(ya(),Ka=E(),Ka!==ja?(ya(),Ya=wa(),Ya!==ja?Ca={type:"interval-period",period:"second",precision:Ga,secondary:Ka}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja),
Ca===ja&&(Ca=sa,Ka=ua(),Ka!==ja?(ya(),Ga=Ha(),Ga!==ja?(ya(),Ga=E(),Ga!==ja?(ya(),Ya=wa(),Ya!==ja?Ca={type:"interval-period",period:"second",precision:Ga,secondary:null}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja),Ca===ja&&(Ca=sa,Ka=ua(),Ka!==ja&&(Ka={type:"interval-period",period:"second",precision:null,secondary:null}),Ca=Ka)))));return Ca}function H(){var Ca=sa;Ca=oa();Ca!==ja&&(Ca={type:"string",value:"day"});Ca===ja&&(Ca=sa,Ca=ra(),Ca!==ja&&(Ca={type:"string",value:"hour"}),Ca===
ja&&(Ca=sa,Ca=Aa(),Ca!==ja&&(Ca={type:"string",value:"minute"}),Ca===ja&&(Ca=sa,Ca=la(),Ca!==ja&&(Ca={type:"string",value:"month"}),Ca===ja&&(Ca=sa,Ca=da(),Ca!==ja&&(Ca={type:"string",value:"year"})))));return Ca}function E(){var Ca=X();Ca!==ja&&(Ca=parseFloat(Ca));return Ca}function I(){var Ca=X();Ca!==ja&&(Ca=parseFloat(Ca));return Ca}function M(){var Ca=Q();Ca===ja&&(Ca=O());return Ca}function Q(){var Ca=sa;if(39===g.charCodeAt(sa)){var Ga=qb;sa++}else Ga=ja,0===Za&&A(Bc);Ga===ja&&(g.substr(sa,
2)===nb?(Ga=nb,sa+=2):(Ga=ja,0===Za&&A(Cc)));if(Ga!==ja){Ga=[];var Ka=sa;g.substr(sa,2)===sb?(Ka=sb,sa+=2):(Ka=ja,0===Za&&A(Vb));Ka!==ja&&(Ka="'");Ka===ja&&(bc.test(g.charAt(sa))?(Ka=g.charAt(sa),sa++):(Ka=ja,0===Za&&A(Sc)));for(;Ka!==ja;)Ga.push(Ka),Ka=sa,g.substr(sa,2)===sb?(Ka=sb,sa+=2):(Ka=ja,0===Za&&A(Vb)),Ka!==ja&&(Ka="'"),Ka===ja&&(bc.test(g.charAt(sa))?(Ka=g.charAt(sa),sa++):(Ka=ja,0===Za&&A(Sc)));39===g.charCodeAt(sa)?(Ka=qb,sa++):(Ka=ja,0===Za&&A(Bc));Ka!==ja?Ca={type:"string",value:Ga.join("")}:
(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function T(){var Ca=sa;if(Ja()!==ja){ya();var Ga=u();if(Ga!==ja){ya();var Ka=pa();Ka!==ja?(ya(),Ka=u(),Ka!==ja?Ca={type:"when-clause",operand:Ga,value:Ka}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja}else sa=Ca,Ca=ja;return Ca}function S(){var Ca=sa;if(Ja()!==ja){ya();var Ga=u();if(Ga!==ja){ya();var Ka=pa();Ka!==ja?(ya(),Ka=u(),Ka!==ja?Ca={type:"when-clause",operand:Ga,value:Ka}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja}else sa=Ca,Ca=ja;return Ca}function U(){var Ca=
sa;var Ga=sa;if(g.substr(sa,4).toLowerCase()===yb){var Ka=g.substr(sa,4);sa+=4}else Ka=ja,0===Za&&A(hf);if(Ka!==ja){Ka=sa;Za++;var Ya=L();Za--;Ya===ja?Ka=void 0:(sa=Ka,Ka=ja);Ka!==ja?Ga="ELSE":(sa=Ga,Ga=ja)}else sa=Ga,Ga=ja;Ga!==ja?(ya(),Ga=u(),Ga!==ja?Ca={type:"else-clause",value:Ga}:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja);return Ca}function Y(){var Ca=X();if(Ca===ja){Ca=sa;if(45===g.charCodeAt(sa)){var Ga=cb;sa++}else Ga=ja,0===Za&&A(cc);Ga===ja&&(43===g.charCodeAt(sa)?(Ga=Xa,sa++):(Ga=ja,0===Za&&A(Tb)));
if(Ga!==ja){var Ka=X();Ka!==ja?Ca=Ga[0]+Ka:(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja}return Ca}function V(){var Ca=sa;if(46===g.charCodeAt(sa)){var Ga=vb;sa++}else Ga=ja,0===Za&&A(Wd);Ga!==ja?(Ca=X(),Ca===ja&&(Ca=null),Ca="."+(null!=Ca?Ca:"")):(sa=Ca,Ca=ja);return Ca}function R(){var Ca;var Ga=Ca=sa;if(jd.test(g.charAt(sa))){var Ka=g.charAt(sa);sa++}else Ka=ja,0===Za&&A(nd);Ka!==ja?(kd.test(g.charAt(sa))?(Ga=g.charAt(sa),sa++):(Ga=ja,0===Za&&A(od)),Ga===ja&&(Ga=null),Ga="e"+(null===Ga?"":Ga)):(sa=Ga,Ga=ja);
Ga!==ja?(Ka=X(),Ka!==ja?Ca=Ga+Ka:(sa=Ca,Ca=ja)):(sa=Ca,Ca=ja);return Ca}function X(){var Ca=[];var Ga=W();if(Ga!==ja)for(;Ga!==ja;)Ca.push(Ga),Ga=W();else Ca=ja;Ca!==ja&&(Ca=Ca.join(""));return Ca}function W(){if(id.test(g.charAt(sa))){var Ca=g.charAt(sa);sa++}else Ca=ja,0===Za&&A(md);return Ca}function aa(){var Ca=sa;if(g.substr(sa,2).toLowerCase()===bb){var Ga=g.substr(sa,2);sa+=2}else Ga=ja,0===Za&&A(sd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="IN":(sa=
Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ba(){var Ca=sa;if(g.substr(sa,2).toLowerCase()===Fa){var Ga=g.substr(sa,2);sa+=2}else Ga=ja,0===Za&&A(Tc);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="IS":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ia(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===na){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(Uc);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="LIKE":(sa=Ca,Ca=ja)}else sa=
Ca,Ca=ja;return Ca}function ma(){var Ca=sa;if(g.substr(sa,3).toLowerCase()===Ma){var Ga=g.substr(sa,3);sa+=3}else Ga=ja,0===Za&&A(Xc);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="NOT":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ha(){var Ca=sa;if(g.substr(sa,3).toLowerCase()===Pa){var Ga=g.substr(sa,3);sa+=3}else Ga=ja,0===Za&&A(ud);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="AND":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}
function ka(){var Ca=sa;if(g.substr(sa,2).toLowerCase()===Wa){var Ga=g.substr(sa,2);sa+=2}else Ga=ja,0===Za&&A(vd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="OR":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function Z(){var Ca=sa;if(g.substr(sa,7).toLowerCase()===$a){var Ga=g.substr(sa,7);sa+=7}else Ga=ja,0===Za&&A(wd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="BETWEEN":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ca(){var Ca=
sa;if(g.substr(sa,4).toLowerCase()===eb){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(xd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="FROM":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function fa(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===ob){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(yd);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="TRIM":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ea(){var Ca=sa;if(g.substr(sa,
8).toLowerCase()===Db){var Ga=g.substr(sa,8);sa+=8}else Ga=ja,0===Za&&A(jf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="INTERVAL":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function da(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===Ab){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(kf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="YEAR":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function la(){var Ca=sa;if(g.substr(sa,5).toLowerCase()===
Rb){var Ga=g.substr(sa,5);sa+=5}else Ga=ja,0===Za&&A(lf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="MONTH":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function oa(){var Ca=sa;if(g.substr(sa,3).toLowerCase()===Ob){var Ga=g.substr(sa,3);sa+=3}else Ga=ja,0===Za&&A(mf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="DAY":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ra(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===Sb){var Ga=
g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(nf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="HOUR":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function Aa(){var Ca=sa;if(g.substr(sa,6).toLowerCase()===Hb){var Ga=g.substr(sa,6);sa+=6}else Ga=ja,0===Za&&A(of);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="MINUTE":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function ua(){var Ca=sa;if(g.substr(sa,6).toLowerCase()===Cb){var Ga=g.substr(sa,
6);sa+=6}else Ga=ja,0===Za&&A(pf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="SECOND":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function za(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===Ib){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(qf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="CASE":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function va(){var Ca=sa;if(g.substr(sa,3).toLowerCase()===xb){var Ga=g.substr(sa,3);sa+=3}else Ga=
ja,0===Za&&A(rf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="END":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function Ja(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===wb){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(sf);if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="WHEN":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function pa(){var Ca=sa;if(g.substr(sa,4).toLowerCase()===Lb){var Ga=g.substr(sa,4);sa+=4}else Ga=ja,0===Za&&A(tf);
if(Ga!==ja){Ga=sa;Za++;var Ka=L();Za--;Ka===ja?Ga=void 0:(sa=Ga,Ga=ja);Ga!==ja?Ca="THEN":(sa=Ca,Ca=ja)}else sa=Ca,Ca=ja;return Ca}function Ba(){if(44===g.charCodeAt(sa)){var Ca=Wb;sa++}else Ca=ja,0===Za&&A(uf);return Ca}function Ha(){if(40===g.charCodeAt(sa)){var Ca=Jb;sa++}else Ca=ja,0===Za&&A(vf);return Ca}function wa(){if(41===g.charCodeAt(sa)){var Ca=Nb;sa++}else Ca=ja,0===Za&&A(wf);return Ca}function ya(){var Ca;var Ga=[];for(Ca=Na();Ca!==ja;)Ga.push(Ca),Ca=Na();return Ga}function Na(){if(Ud.test(g.charAt(sa))){var Ca=
g.charAt(sa);sa++}else Ca=ja,0===Za&&A(xf);return Ca}function Ra(Ca,Ga,Ka,Ya){Ca={type:"binary-expression",operator:Ca,left:Ga,right:Ka};void 0!==Ya&&(Ca.escape=Ya);return Ca}function Sa(Ca,Ga){for(var Ka=0;Ka<Ga.length;Ka++)Ca=Ra(Ga[Ka][1],Ca,Ga[Ka][3]);return Ca}h=void 0!==h?h:{};var ja={},Ta=h.grammarSource,qa={start:t},Ea=t,Oa="!",Va="\x3d",Ua="\x3e\x3d",La="\x3e",ta="\x3c\x3d",xa="\x3c\x3e",Ia="\x3c",Qa="!\x3d",Xa="+",cb="-",db="*",fb="/",jb="@",qb="'",nb="N'",sb="''",vb=".",Bb="null",ab="true",
ib="false",bb="in",Fa="is",na="like",Da="escape",Ma="not",Pa="and",Wa="or",$a="between",eb="from",kb="for",gb="substring",lb="extract",ob="trim",Eb="position",Gb="timestamp",pb="date",mb="leading",zb="trailing",Fb="both",ub="to",Db="interval",Ab="year",Rb="month",Ob="day",Sb="hour",Hb="minute",Cb="second",Ib="case",xb="end",wb="when",Lb="then",yb="else",Wb=",",Jb="(",Nb=")",Xb="`",ac=/^[A-Za-z_\x80-\uFFFF]/,gc=/^[A-Za-z0-9_]/,dc=/^[A-Za-z0-9_.\x80-\uFFFF]/,bc=/^[^']/,id=/^[0-9]/,jd=/^[eE]/,kd=/^[+\-]/,
Ud=/^[ \t\n\r]/,ld=/^[^`]/,Vd=d("!",!1),lc=d("\x3d",!1),uc=d("\x3e\x3d",!1),vc=d("\x3e",!1),wc=d("\x3c\x3d",!1),xc=d("\x3c\x3e",!1),yc=d("\x3c",!1),Yc=d("!\x3d",!1),Tb=d("+",!1),cc=d("-",!1),qc=d("*",!1),rc=d("/",!1),kc=f([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),sc=f([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),tc=f([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Ac=d("@",!1),Bc=d("'",!1),Cc=d("N'",!1),Vb=d("''",!1),Sc=f(["'"],!0,!1),Wd=d(".",!1),md=f([["0","9"]],!1,!1),
nd=f(["e","E"],!1,!1),od=f(["+","-"],!1,!1),pd=d("NULL",!0),qd=d("TRUE",!0),rd=d("FALSE",!0),sd=d("IN",!0),Tc=d("IS",!0),Uc=d("LIKE",!0),Vc=d("ESCAPE",!0),Xc=d("NOT",!0),ud=d("AND",!0),vd=d("OR",!0),wd=d("BETWEEN",!0),xd=d("FROM",!0),Ec=d("FOR",!0),Fc=d("SUBSTRING",!0),Gc=d("EXTRACT",!0),yd=d("TRIM",!0),zd=d("POSITION",!0),Ad=d("TIMESTAMP",!0),Wc=d("DATE",!0),Xd=d("LEADING",!0),Yd=d("TRAILING",!0),td=d("BOTH",!0),gf=d("TO",!0),jf=d("INTERVAL",!0),kf=d("YEAR",!0),lf=d("MONTH",!0),mf=d("DAY",!0),nf=
d("HOUR",!0),of=d("MINUTE",!0),pf=d("SECOND",!0),qf=d("CASE",!0),rf=d("END",!0),sf=d("WHEN",!0),tf=d("THEN",!0),hf=d("ELSE",!0),uf=d(",",!1),vf=d("(",!1),wf=d(")",!1),xf=f([" ","\t","\n","\r"],!1,!1),Be=d("`",!1),Ce=f(["`"],!0,!1),sa=0,Bd=[{line:1,column:1}],hc=0,Zd=[],Za=0;if("startRule"in h){if(!(h.startRule in qa))throw Error("Can't start parsing from rule \""+h.startRule+'".');Ea=qa[h.startRule]}var le=Ea();if(le!==ja&&sa===g.length)return le;le!==ja&&sa<g.length&&A({type:"end"});throw function(Ca,
Ga,Ka){return new n(n.buildMessage(Ca,Ga),Ca,Ga,Ka)}(Zd,hc<g.length?g.charAt(hc):null,hc<g.length?l(hc,hc+1):l(hc,hc));}}})})(c);let r=function(){function m(){}m.parse=function(n){return c.exports.parse(n)};return m}();a.WhereGrammar=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,b,c,r,m,n,p){function g(w,u){if(!u)return null;if("x"in u){var z={x:0,y:0};[z.x,z.y]=w(u.x,u.y,e);null!=u.z&&(z.z=u.z);null!=u.m&&(z.m=u.m);return z}return"xmin"in u?(z={xmin:0,ymin:0,xmax:0,ymax:0},[z.xmin,z.ymin]=w(u.xmin,u.ymin,e),[z.xmax,z.ymax]=w(u.xmax,u.ymax,e),u.hasZ&&(z.zmin=u.zmin,z.zmax=u.zmax,z.hasZ=!0),u.hasM&&(z.mmin=u.mmin,z.mmax=u.mmax,z.hasM=!0),z):"rings"in u?{rings:h(u.rings,w),hasM:u.hasM,hasZ:u.hasZ}:"paths"in u?{paths:h(u.paths,w),hasM:u.hasM,hasZ:u.hasZ}:"points"in
u?{points:d(u.points,w),hasM:u.hasM,hasZ:u.hasZ}:null}function h(w,u){const z=[];for(const y of w)z.push(d(y,u));return z}function d(w,u){const z=[];for(const y of w)w=u(y[0],y[1],[0,0]),z.push(w),2<y.length&&w.push(y[2]),3<y.length&&w.push(y[3]);return z}function f(){f=b._asyncToGenerator(function*(w,u){w&&u&&(w=Array.isArray(w)?w.map(z=>c.isSome(z.geometry)?z.geometry.spatialReference:null).filter(c.isSome):[w],yield r.initializeProjection(w.map(z=>({source:z,dest:u}))))});return f.apply(this,arguments)}
const e=[0,0],l=g.bind(null,p.lngLatToXY),A=g.bind(null,p.xyToLngLat),t=new (function(){function w(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var u=w.prototype;u.push=function(){var z=b._asyncToGenerator(function*(y,B,C){if(!(y&&y.length&&B&&C)||n.equals(B,C))return y;const k={geometries:y,inSpatialReference:B,outSpatialReference:C,resolve:null};this._jobs.push(k);return new Promise(q=>{k.resolve=q;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(y,
B,C){return z.apply(this,arguments)}}();u._process=function(){this._timer=null;const z=this._jobs.shift();if(z){var {geometries:y,inSpatialReference:B,outSpatialReference:C,resolve:k}=z;p.canProject(B,C)?n.isWebMercator(C)?k(y.map(l)):k(y.map(A)):k(r.projectMany(m.jsonAdapter,y,B,C,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return w}());a.checkProjectionSupport=function(w,u){return f.apply(this,arguments)};a.project=function(w,u,z,y){if(!w)return w;z||(z=u,u=w.spatialReference);
return n.isValid(u)&&n.isValid(z)&&!n.equals(u,z)?p.canProject(u,z)?(w=n.isWebMercator(z)?l(w):A(w),w.spatialReference=z,w):r.projectMany(m.jsonAdapter,[w],u,z,null,y)[0]:w};a.projectMany=function(w,u,z){return t.push(w,u,z)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let b=function(p,g,h){this.x=p;this.y=g;this.spatialReference=h;this.m=this.z=void 0},c=function(p,g,h,
d){this.rings=p;this.spatialReference=g;this.hasM=this.hasZ=void 0;h&&(this.hasZ=h);d&&(this.hasM=d)},r=function(p,g,h,d){this.paths=p;this.spatialReference=g;this.hasM=this.hasZ=void 0;h&&(this.hasZ=h);d&&(this.hasM=d)},m=function(p,g,h,d){this.points=p;this.spatialReference=g;this.hasM=this.hasZ=void 0;h&&(this.hasZ=h);d&&(this.hasM=d)},n=function(p,g,h,d,f){this.xmin=p;this.ymin=g;this.xmax=h;this.ymax=d;this.spatialReference=f;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(p,
g){return null==g?null:p.convertJSONToGeometry(g)},exportPoint:function(p,g,h){h=new b(p.getPointX(g),p.getPointY(g),h);const d=p.hasZ(g),f=p.hasM(g);d&&(h.z=p.getPointZ(g));f&&(h.m=p.getPointM(g));return h},exportPolygon:function(p,g,h){return new c(p.exportPaths(g),h,p.hasZ(g),p.hasM(g))},exportPolyline:function(p,g,h){return new r(p.exportPaths(g),h,p.hasZ(g),p.hasM(g))},exportMultipoint:function(p,g,h){return new m(p.exportPoints(g),h,p.hasZ(g),p.hasM(g))},exportExtent:function(p,g,h){var d=p.hasZ(g);
const f=p.hasM(g);h=new n(p.getXMin(g),p.getYMin(g),p.getXMax(g),p.getYMax(g),h);d&&(d=p.getZExtent(g),h.zmin=d.vmin,h.zmax=d.vmax);f&&(p=p.getMExtent(g),h.mmin=p.vmin,h.mmax=p.vmax);return h}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./projectionSupport ./SnappingCandidate ./utils ../../support/fieldUtils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){function w(B,C,k,q){const x=q.x-k.x;q=q.y-k.y;C=Math.min(1,Math.max(0,((C.x-k.x)*x+(C.y-k.y)*q)/(x*x+q*q)));B.x=k.x+x*C;B.y=k.y+q*C}function u(B,C){return B?C?4:3:C?3:2}let z=function(){function B(k,q,x){this.items=k;this.query=q;this.geometryType=x.geometryType;this.hasM=x.hasM;this.hasZ=x.hasZ;this.fieldsIndex=x.fieldsIndex;this.objectIdField=x.objectIdField;this.spatialReference=x.spatialReference;this.featureAdapter=x.featureAdapter}var C=B.prototype;C.createQueryResponseForCount=
function(){const k=new h(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return k.countDistinctValues(this.items);const {groupByFieldsForStatistics:q,having:x,outStatistics:v}=this.query;if(!q?.length)return 1;const D=new Map,F=new Map,G=new Set;for(const K of v){var {statisticType:J}=K;J="exceedslimit"!==J?K.onStatisticField:void 0;if(!F.has(J)){var L=[];for(const O of q){const P=this._getAttributeValues(k,O,D);L.push(P)}F.set(J,this._calculateUniqueValues(L,k.returnDistinctValues))}J=
F.get(J);for(const O in J){const {data:P,items:N}=J[O];L=P.join(",");x&&!k.validateItems(N,x)||G.add(L)}}return G.size};C.createQueryResponse=function(){var k=c._asyncToGenerator(function*(){let q;q=this.query.outStatistics?this.query.outStatistics.some(x=>"exceedslimit"===x.statisticType)?this._createExceedsLimitQueryResponse(this.query):yield this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);this.query.returnQueryGeometry&&(g.isValid(this.query.outSR)&&
!g.equals(this.query.geometry.spatialReference,this.query.outSR)?q.queryGeometry=e.cleanFromGeometryEngine({spatialReference:this.query.outSR,...d.project(this.query.geometry,this.query.geometry.spatialReference,this.query.outSR)}):q.queryGeometry=e.cleanFromGeometryEngine({spatialReference:this.query.outSR,...this.query.geometry}));return q});return function(){return k.apply(this,arguments)}}();C.createSnappingResponse=function(k,q){const x=this.featureAdapter,v=u(this.hasZ,this.hasM),{point:D}=
k,F="number"===typeof k.distance?k.distance:k.distance.x,G="number"===typeof k.distance?k.distance:k.distance.y,J={candidates:[]},L="esriGeometryPolygon"===this.geometryType;q=this._getPointCreator(D,null!=D.z,null!=D.m,this.spatialReference,q);const K=new y(null,0),O=new y(null,0),P={x:0,y:0,z:0};for(const T of this.items){var N=x.getGeometry(T);if(r.isNone(N))continue;const {coords:S,lengths:U}=N;K.coords=S;O.coords=S;if(k.types&b.SnappingTypes.EDGE){N=0;for(var H=0;H<U.length;H++){var E=U[H];for(var I=
0;I<E;I++,N+=v){var M=K;M.coordsIndex=N;if(I!==E-1){const Y=O;Y.coordsIndex=N+v;const V=P;w(P,D,M,Y);var Q=(D.x-V.x)/F;const R=(D.y-V.y)/G;Q=Q*Q+R*R;1>=Q&&J.candidates.push(f.makeEdgeCandidate(x.getObjectId(T),q(V),Math.sqrt(Q),q(M),q(Y)))}}}}if(k.types&b.SnappingTypes.VERTEX)for(N=L?S.length-v:S.length,H=0;H<N;H+=v)E=K,E.coordsIndex=H,I=(D.x-E.x)/F,M=(D.y-E.y)/G,I=I*I+M*M,1>=I&&J.candidates.push(f.makeVertexCandidate(x.getObjectId(T),q(E),Math.sqrt(I)))}J.candidates.sort((T,S)=>T.distance-S.distance);
return J};C._getPointCreator=function(k,q,x,v,D){const F=r.isSome(D)&&!g.equals(v,D)?L=>d.project(L,v,D):L=>L,{hasZ:G}=this,J=k.m;return q&&x?G?({x:L,y:K,z:O})=>F({x:L,y:K,z:O,m:J}):({x:L,y:K})=>F({x:L,y:K,z:0,m:J}):q?G?({x:L,y:K,z:O})=>F({x:L,y:K,z:O}):({x:L,y:K})=>F({x:L,y:K,z:0}):x?({x:L,y:K})=>F({x:L,y:K,m:J}):({x:L,y:K})=>F({x:L,y:K})};C.createSummaryStatisticsResponse=function(){var k=c._asyncToGenerator(function*(q){const {field:x,valueExpression:v,normalizationField:D,normalizationType:F,
normalizationTotal:G,minValue:J,maxValue:L,scale:K}=q;q=this.fieldsIndex.isDateField(x);var O=yield this._getDataValues({field:x,valueExpression:v,normalizationField:D,normalizationType:F,normalizationTotal:G,scale:K});const P=A.isNullCountSupported({normalizationType:F,normalizationField:D,minValue:J,maxValue:L}),N=this.fieldsIndex.get(x),H={value:.5,fieldType:N?.type};O=l.isStringField(N)?A.calculateStringStatistics({values:O,supportsNullCount:P,percentileParams:H}):A.calculateStatistics({values:O,
minValue:J,maxValue:L,useSampleStdDev:!F,supportsNullCount:P,percentileParams:H});return A.processSummaryStatisticsResult(O,q)});return function(q){return k.apply(this,arguments)}}();C.createUniqueValuesResponse=function(){var k=c._asyncToGenerator(function*(q){const {field:x,valueExpression:v,domains:D,returnAllCodedValues:F,scale:G}=q;var J=yield this._getDataValues({field:x,field2:q.field2,field3:q.field3,fieldDelimiter:q.fieldDelimiter,valueExpression:v,scale:G});J=A.calculateUniqueValuesCount(J);
return A.createUVResult(J,D,F,q.fieldDelimiter)});return function(q){return k.apply(this,arguments)}}();C.createClassBreaksResponse=function(){var k=c._asyncToGenerator(function*(q){const {field:x,valueExpression:v,normalizationField:D,normalizationType:F,normalizationTotal:G,classificationMethod:J,standardDeviationInterval:L,minValue:K,maxValue:O,numClasses:P,scale:N}=q;q=yield this._getDataValues({field:x,valueExpression:v,normalizationField:D,normalizationType:F,normalizationTotal:G,scale:N});
q=A.calculateClassBreaks(q,{field:x,normalizationField:D,normalizationType:F,normalizationTotal:G,classificationMethod:J,standardDeviationInterval:L,minValue:K,maxValue:O,numClasses:P});return A.resolveCBResult(q,J)});return function(q){return k.apply(this,arguments)}}();C.createHistogramResponse=function(){var k=c._asyncToGenerator(function*(q){const {field:x,valueExpression:v,normalizationField:D,normalizationType:F,normalizationTotal:G,classificationMethod:J,standardDeviationInterval:L,minValue:K,
maxValue:O,numBins:P,scale:N}=q;q=yield this._getDataValues({field:x,valueExpression:v,normalizationField:D,normalizationType:F,normalizationTotal:G,scale:N});return A.calculateHistogram(q,{field:x,normalizationField:D,normalizationType:F,normalizationTotal:G,classificationMethod:J,standardDeviationInterval:L,minValue:K,maxValue:O,numBins:P})});return function(q){return k.apply(this,arguments)}}();C._sortFeatures=function(k,q,x){if(1<k.length&&q&&q.length)for(const v of q.reverse()){q=v.split(" ");
const D=q[0],F=this.fieldsIndex.get(D);q=q[1]&&"desc"===q[1].toLowerCase();const G=A.getAttributeComparator(F?.type,q);k.sort((J,L)=>{J=x(J,D,F);L=x(L,D,F);return G(J,L)})}};C._createFeatureQueryResponse=function(k){const q=this.items,{geometryType:x,hasM:v,hasZ:D,objectIdField:F,spatialReference:G}=this,{outFields:J,outSR:L,quantizationParameters:K,resultRecordCount:O,resultOffset:P,returnZ:N,returnM:H}=k,E=null!=O?q.length>(P||0)+O:!1,I=J&&(J.includes("*")?[...this.fieldsIndex.fields]:J.map(M=>
this.fieldsIndex.get(M)));return{exceededTransferLimit:E,features:this._createFeatures(k,q),fields:I,geometryType:x,hasM:v&&H,hasZ:D&&N,objectIdFieldName:F,spatialReference:e.cleanFromGeometryEngine(L?L:G),transform:K&&p.toQuantizationTransform(K)||null}};C._createFeatures=function(k,q){const x=new h(k,this.featureAdapter,this.fieldsIndex),{hasM:v,hasZ:D}=this,{orderByFields:F,quantizationParameters:G,returnGeometry:J,returnCentroid:L,maxAllowableOffset:K,resultOffset:O,resultRecordCount:P,returnZ:N=
!1,returnM:H=!1}=k,E=D&&N,I=v&&H;k=[];var M=0;q=[...q];this._sortFeatures(q,F,(S,U,Y)=>x.getFieldValue(S,U,Y));if(J||L){var Q=p.toQuantizationTransform(G);if(J&&!L)for(var T of q)k[M++]={attributes:x.getAttributes(T),geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(T),K,Q,E,I)};else if(!J&&L)for(const S of q)k[M++]={attributes:x.getAttributes(S),centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(S,this),Q)};else for(const S of q)k[M++]={attributes:x.getAttributes(S),
centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(S,this),Q),geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),K,Q,E,I)}}else for(Q of q)(T=x.getAttributes(Q))&&(k[M++]={attributes:T});M=O||0;null!=P&&(k=k.slice(M,Math.min(k.length,M+P)));return k};C._createExceedsLimitQueryResponse=function(k){var q=!1;let x=Number.POSITIVE_INFINITY,v=Number.POSITIVE_INFINITY;q=Number.POSITIVE_INFINITY;for(const D of k.outStatistics)if("exceedslimit"===
D.statisticType){x=null!=D.maxPointCount?D.maxPointCount:Number.POSITIVE_INFINITY;v=null!=D.maxRecordCount?D.maxRecordCount:Number.POSITIVE_INFINITY;q=null!=D.maxVertexCount?D.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)q=this.items.length>x;else if(this.items.length>v)q=!0;else{k=u(this.hasZ,this.hasM);const D=this.featureAdapter;q=this.items.reduce((F,G)=>{G=D.getGeometry(G);return F+(r.isSome(G)&&G.coords.length||0)},0)/k>q}return{fields:[{name:"exceedslimit",
type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(q)}}]}};C._createStatisticsQueryResponse=function(){var k=c._asyncToGenerator(function*(q){var x={attributes:{}};const v=[],D=new Map,F=new Map,G=new Map,J=new Map,L=new h(q,this.featureAdapter,this.fieldsIndex);var K=q.outStatistics;const {groupByFieldsForStatistics:O,having:P,orderByFields:N}=q;q=O&&O.length;const H=!!q,E=H&&O[0],I=H&&!this.fieldsIndex.get(E);
for(const U of K){const {outStatisticFieldName:Y,statisticType:V}=U;K=U;var M="exceedslimit"!==V?U.onStatisticField:void 0;const R="percentile_disc"===V||"percentile_cont"===V,X="EnvelopeAggregate"===V||"CentroidAggregate"===V||"ConvexHullAggregate"===V,W=H&&1===q&&(M===E||I)&&"count"===V;if(H){if(!G.has(M)){var Q=[];for(const aa of O){var T=this._getAttributeValues(L,aa,D);Q.push(T)}G.set(M,this._calculateUniqueValues(Q,X?!1:L.returnDistinctValues))}Q=G.get(M);for(const aa in Q){const {count:ba,
data:ia,items:ma,itemPositions:ha}=Q[aa];T=ia.join(",");if(!P||L.validateItems(ma,P)){const ka=J.get(T)||{attributes:{}};if(X){ka.aggregateGeometries||(ka.aggregateGeometries={});const {aggregateGeometries:ca,outStatisticFieldName:fa}=yield this._getAggregateGeometry(K,ma);ka.aggregateGeometries[fa]=ca}else{var S=null;if(W)S=ba;else{const ca=this._getAttributeValues(L,M,D);S=ha.map(fa=>ca[fa]);S=R&&"statisticParameters"in K?this._getPercentileValue(K,S):this._getStatisticValue(K,S,null,L.returnDistinctValues)}ka.attributes[Y]=
S}let Z=0;O.forEach((ca,fa)=>ka.attributes[this.fieldsIndex.get(ca)?ca:`EXPR_${++Z}`]=ia[fa]);J.set(T,ka)}}}else if(X){x.aggregateGeometries||(x.aggregateGeometries={});const {aggregateGeometries:aa,outStatisticFieldName:ba}=yield this._getAggregateGeometry(K,this.items);x.aggregateGeometries[ba]=aa}else M=this._getAttributeValues(L,M,D),x.attributes[Y]=R&&"statisticParameters"in K?this._getPercentileValue(K,M):this._getStatisticValue(K,M,F,L.returnDistinctValues);v.push({name:Y,alias:Y,type:"esriFieldTypeDouble"})}x=
H?Array.from(J.values()):[x];this._sortFeatures(x,N,(U,Y)=>U.attributes[Y]);return{fields:v,features:x}});return function(q){return k.apply(this,arguments)}}();C._getAggregateGeometry=function(){var k=c._asyncToGenerator(function*(q,x){var v=yield new Promise((N,H)=>a(["../../../geometry/geometryEngineJSON"],N,H));const {statisticType:D,outStatisticFieldName:F}=q,{featureAdapter:G,spatialReference:J,geometryType:L,hasZ:K,hasM:O}=this;x=x.map(N=>e.getGeometry(L,K,O,G.getGeometry(N)));const P=v.convexHull(J,
x,!0)[0];q={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===D?(v=P?n.getPolygonExtent(P):n.getGeometryExtent(v.union(J,x)),q.aggregateGeometries={...v,spatialReference:J},q.outStatisticFieldName=F||"extent"):"CentroidAggregate"===D?(v=P?m.polygonCentroid(P):m.extentCentroid(n.getGeometryExtent(v.union(J,x))),q.aggregateGeometries={x:v[0],y:v[1],spatialReference:J},q.outStatisticFieldName=F||"centroid"):"ConvexHullAggregate"===D&&(q.aggregateGeometries=P,q.outStatisticFieldName=
F||"convexHull");return q});return function(q,x){return k.apply(this,arguments)}}();C._getStatisticValue=function(k,q,x,v){const {onStatisticField:D,statisticType:F}=k;k=null;k=x?.has(D)?x.get(D):l.isStringField(this.fieldsIndex.get(D))?A.calculateStringStatistics({values:q,returnDistinct:v}):A.calculateStatistics({values:q,minValue:null,maxValue:null,useSampleStdDev:!0});x&&x.set(D,k);return k["var"===F?"variance":F]};C._getPercentileValue=function(k,q){const {onStatisticField:x,statisticParameters:v,
statisticType:D}=k,{value:F,orderBy:G}=v;k=this.fieldsIndex.get(x);return A.calculatePercentile(q,{value:F,orderBy:G,fieldType:k?.type,isDiscrete:"percentile_disc"===D})};C._getAttributeValues=function(k,q,x){if(x.has(q))return x.get(q);const v=this.fieldsIndex.get(q),D=this.items.map(F=>k.getFieldValue(F,q,v));x.set(q,D);return D};C._getAttributeDataValues=function(k,q){return this.items.map(x=>k.getDataValue(x,{field:q.field,field2:q.field2,field3:q.field3,fieldDelimiter:q.fieldDelimiter,normalizationField:q.normalizationField,
normalizationType:q.normalizationType,normalizationTotal:q.normalizationTotal}))};C._getAttributeExpressionValues=function(){var k=c._asyncToGenerator(function*(q,x,v){const {arcadeUtils:D}=yield t.loadArcade();x=D.createFunction(x);v=v&&D.getViewInfo(v);return q.getExpressionValues(this.items,x,v,D)});return function(q,x,v){return k.apply(this,arguments)}}();C._calculateUniqueValues=function(k,q){const x={},v=this.items,D=v.length;for(let F=0;F<D;F++){const G=v[F],J=[];for(const K of k)J.push(K[F]);
const L=J.join(",");q?null==x[L]&&(x[L]={count:1,data:J,items:[G],itemPositions:[F]}):null==x[L]?x[L]={count:1,data:J,items:[G],itemPositions:[F]}:(x[L].count++,x[L].items.push(G),x[L].itemPositions.push(F))}return x};C._getDataValues=function(){var k=c._asyncToGenerator(function*(q){const x=new h(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:v,field:D,normalizationField:F,normalizationType:G,normalizationTotal:J,scale:L}=q,K=v?{viewingMode:"map",scale:L,spatialReference:this.query.outSR||
this.spatialReference}:null;return v?this._getAttributeExpressionValues(x,v,K):this._getAttributeDataValues(x,{field:D,field2:q.field2,field3:q.field3,fieldDelimiter:q.fieldDelimiter,normalizationField:F,normalizationType:G,normalizationTotal:J})});return function(q){return k.apply(this,arguments)}}();c._createClass(B,[{key:"size",get:function(){return this.items.length}}]);return B}();b.SnappingTypes=void 0;(function(B){B[B.NONE=0]="NONE";B[B.EDGE=1]="EDGE";B[B.VERTEX=2]="VERTEX"})(b.SnappingTypes||
(b.SnappingTypes={}));let y=function(){function B(C,k){this.coords=C;this.coordsIndex=k}c._createClass(B,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},{key:"y",get:function(){return this.coords[this.coordsIndex+1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]);return B}();b.QueryEngineResult=z;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe",
"./attributeSupport","../../../statistics/utils"],function(a,b,c){return function(){function r(n,p,g){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=n.returnDistinctValues??!1;this.fieldsIndex=g;this.featureAdapter=p;if((p=n.outFields)&&!p.includes("*")){this.outFields=p;n=0;for(const d of p){var h=b.getExpressionFromFieldName(d);h=(p=this.fieldsIndex.get(h))?null:b.getWhereClause(h,g);p=p?p.name:b.getAliasFromFieldName(d)||`FIELD_EXP_${n++}`;this._fieldDataCache.set(d,
{alias:p,clause:h})}}}var m=r.prototype;m.countDistinctValues=function(n){if(!this.returnDistinctValues)return n.length;n.forEach(p=>this.getAttributes(p));return this._returnDistinctMap.size};m.getAttributes=function(n){n=this._processAttributesForOutFields(n);return this._processAttributesForDistinctValues(n)};m.getFieldValue=function(n,p,g){const h=g?g.name:p;let d=null;this._fieldDataCache.has(h)?d=this._fieldDataCache.get(h).clause:g||(d=b.getWhereClause(p,this.fieldsIndex),this._fieldDataCache.set(h,
{alias:h,clause:d}));return g?this.featureAdapter.getAttribute(n,h):d.calculateValue(n,this.featureAdapter)};m.getDataValue=function(n,p){const g=p.normalizationType,h=p.normalizationTotal;let d=this.getFieldValue(n,p.field,this.fieldsIndex.get(p.field));p.field2&&(d=`${c.processNullValue(d)}${p.fieldDelimiter}${c.processNullValue(this.getFieldValue(n,p.field2,this.fieldsIndex.get(p.field2)))}`,p.field3&&(d=`${d}${p.fieldDelimiter}${c.processNullValue(this.getFieldValue(n,p.field3,this.fieldsIndex.get(p.field3)))}`));
g&&Number.isFinite(d)&&(n="field"===g&&p.normalizationField?this.getFieldValue(n,p.normalizationField,this.fieldsIndex.get(p.normalizationField)):null,d=c.getNormalizedValue(d,g,n,h));return d};m.getExpressionValue=function(n,p,g,h){n={attributes:this.featureAdapter.getAttributes(n),layer:{fields:this.fieldsIndex.fields}};g=h.createExecContext(n,g);return h.executeFunction(p,g)};m.getExpressionValues=function(n,p,g,h){const d={fields:this.fieldsIndex.fields};return n.map(f=>{f={attributes:this.featureAdapter.getAttributes(f),
layer:d};f=h.createExecContext(f,g);return h.executeFunction(p,f)})};m.validateItem=function(n,p){this._fieldDataCache.has(p)||this._fieldDataCache.set(p,{alias:p,clause:b.getWhereClause(p,this.fieldsIndex)});return this._fieldDataCache.get(p).clause.testFeature(n,this.featureAdapter)};m.validateItems=function(n,p){this._fieldDataCache.has(p)||this._fieldDataCache.set(p,{alias:p,clause:b.getWhereClause(p,this.fieldsIndex)});return this._fieldDataCache.get(p).clause.testSet(n,this.featureAdapter)};
m._processAttributesForOutFields=function(n){const p=this.outFields;if(!p||!p.length)return this.featureAdapter.getAttributes(n);const g={};for(const h of p){const {alias:d,clause:f}=this._fieldDataCache.get(h);g[d]=f?f.calculateValue(n,this.featureAdapter):this.featureAdapter.getAttribute(n,d)}return g};m._processAttributesForDistinctValues=function(n){if(a.isNone(n)||!this.returnDistinctValues)return n;var p=this.outFields,g=[];if(p)for(const d of p){var {alias:h}=this._fieldDataCache.get(d);g.push(n[h])}else for(h in n)g.push(n[h]);
p=`${(p||["*"]).join(",")}=${g.join(",")}`;g=this._returnDistinctMap.get(p)||0;this._returnDistinctMap.set(p,++g);return 1<g?null:n};return r}()})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,c){function r(k){return null==k||"string"===typeof k&&!k?"\x3cNull\x3e":k}function m(k){const q=null!=k.minValue||null!=k.maxValue,x=!!k.sqlExpression&&k.supportsSQLExpression;return!(null!=k.normalizationField||
null!=k.normalizationType)&&!q&&!x}function n(k){const {values:q,useSampleStdDev:x,supportsNullCount:v}=k;var D=Number.POSITIVE_INFINITY;let F=Number.NEGATIVE_INFINITY,G=null,J=null;var L=null;let K=null,O=0;const P=null==k.minValue?-Infinity:k.minValue,N=null==k.maxValue?Infinity:k.maxValue;for(const H of q)Number.isFinite(H)?H>=P&&H<=N&&(G+=H,D=Math.min(D,H),F=Math.max(F,H),O++):"string"===typeof H&&O++;if(O&&null!=G){J=G/O;L=0;for(const H of q)Number.isFinite(H)&&H>=P&&H<=N&&(L+=(H-J)**2);K=x?
1<O?L/(O-1):0:0<O?L/O:0;L=Math.sqrt(K)}else F=D=null;D={avg:J,count:O,max:F,min:D,stddev:L,sum:G,variance:K};v&&(D.nullcount=q.length-O);k.percentileParams&&(D.median=p(q,k.percentileParams));return D}function p(k,q){const {fieldType:x,value:v,orderBy:D,isDiscrete:F}=q,G=g(x,"desc"===D);k=[...k].filter(O=>null!=O).sort((O,P)=>G(O,P));if(0===k.length)return null;if(0>=v)return k[0];if(1<=v)return k[k.length-1];var J=(k.length-1)*v,L=Math.floor(J);q=L+1;J%=1;L=k[L];const K=k[q];return q>=k.length||
F||"string"===typeof L||"string"===typeof K?L:L*(1-J)+K*J}function g(k,q){const x=q?1:-1,v=d(q),D=h(q);if(!k||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...B].includes(k))return(F,G)=>"number"===typeof F&&"number"===typeof G?v(F,G):"string"===typeof F&&"string"===typeof G?D(F,G):x;if("esriFieldTypeDate"===k)return(F,G)=>{F=(new Date(F)).getTime();G=(new Date(G)).getTime();return isNaN(F)||isNaN(G)?x:v(F,G)};if(B.has(k))return(F,G)=>v(F,G);if("esriFieldTypeString"===
k)return(F,G)=>D(F,G);if("esriFieldTypeGUID"===k||"esriFieldTypeGlobalID"===k){const F=h(q);return(G,J)=>F(f(G),f(J))}return q?(F,G)=>1:(F,G)=>-1}function h(k){return k?(q,x)=>{q=q?.toUpperCase();x=x?.toUpperCase();return q>x?-1:q<x?1:0}:(q,x)=>{q=q?.toUpperCase();x=x?.toUpperCase();return q<x?-1:q>x?1:0}}function d(k){return k?(q,x)=>x-q:(q,x)=>q-x}function f(k){return k.substr(24,12)+k.substr(19,4)+k.substr(16,2)+k.substr(14,2)+k.substr(11,2)+k.substr(9,2)+k.substr(6,2)+k.substr(4,2)+k.substr(2,
2)+k.substr(0,2)}function e(k){return"coded-value"!==k?.type?[]:k.codedValues.map(q=>q.code)}function l(k,q){const x=t({field:q.field,normalizationType:q.normalizationType,normalizationField:q.normalizationField,classificationMethod:q.classificationMethod,standardDeviationInterval:q.standardDeviationInterval,breakCount:q.numClasses||5});k=A(k,q.minValue,q.maxValue);return c.createGenerateRendererClassBreaks({definition:x,values:k,normalizationTotal:q.normalizationTotal})}function A(k,q,x){q=null==
q?-Infinity:q;x=null==x?Infinity:x;return k.filter(v=>Number.isFinite(v)&&v>=q&&v<=x)}function t(k){const q=k.field,x=k.classificationMethod||"equal-interval",v=k.normalizationType,D=k.normalizationField,F=new b;F.classificationField=q;F.breakCount=k.breakCount;F.classificationMethod=x;F.standardDeviationInterval="standard-deviation"===x?k.standardDeviationInterval||1:void 0;F.normalizationType=v;F.normalizationField="field"===v?D:void 0;return F}function w(k,q){const {field:x,classificationMethod:v,
standardDeviationInterval:D,normalizationType:F,normalizationField:G,normalizationTotal:J,minValue:L,maxValue:K}=q,O=q.numBins||10;let P=q=null,N=null;v&&"equal-interval"!==v||F?({classBreaks:k}=l(k,{field:x,normalizationType:F,normalizationField:G,normalizationTotal:J,classificationMethod:v,standardDeviationInterval:D,minValue:L,maxValue:K,numClasses:O}),q=k[0].minValue,P=k[k.length-1].maxValue,N=k.map(H=>[H.minValue,H.maxValue])):(null!=L&&null!=K?(q=L,P=K):(k=n({values:k,minValue:L,maxValue:K,
useSampleStdDev:!F,supportsNullCount:m({normalizationType:F,normalizationField:G,minValue:L,maxValue:K})}),q=k.min,P=k.max),N=z(q,P,O));return{min:q,max:P,intervals:N}}function u(k,q){let x=-1;for(let v=k.length-1;0<=v;v--)if(q>=k[v][0]){x=v;break}return x}function z(k,q,x){const v=(q-k)/x,D=[];let F;for(let G=1;G<=x;G++)F=k+v,F=Number(F.toFixed(16)),D.push([k,G===x?q:F]),k=F;return D}const y=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,B=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"]),C="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=l;a.calculateHistogram=function(k,q){const {min:x,max:v,intervals:D}=w(k,q),F=D.map((G,J)=>({minValue:D[J][0],maxValue:D[J][1],count:0}));for(const G of k)null!=G&&G>=x&&G<=v&&(k=u(D,G),-1<k&&F[k].count++);return{bins:F,minValue:x,maxValue:v,normalizationTotal:q.normalizationTotal}};a.calculatePercentile=p;a.calculateStatistics=n;a.calculateStringStatistics=function(k){const q=k.returnDistinct?
[...(new Set(k.values))]:k.values,x=q.filter(D=>null!=D).length,v={count:x};k.supportsNullCount&&(v.nullcount=q.length-x);k.percentileParams&&(v.median=p(q,k.percentileParams));return v};a.calculateUniqueValuesCount=function(k){const q={};for(let x of k){if(null==x||"string"===typeof x&&""===x.trim())x=null;null==q[x]?q[x]={count:1,data:x}:q[x].count++}return{count:q}};a.createClassBreaksDefinition=t;a.createUVResult=function(k,q,x,v){k=k.count;const D=[];if(x&&q){x=[];var F=e(q[0]);for(const G of F)if(q[1]){F=
e(q[1]);for(const J of F)if(q[2]){F=e(q[2]);for(const L of F)x.push(`${r(G)}${v}${r(J)}${v}${r(L)}`)}else x.push(`${r(G)}${v}${r(J)}`)}else x.push(G);for(const G of x)k.hasOwnProperty(G)||(k[G]={data:G,count:0})}for(const G in k)q=k[G],D.push({value:q.data,count:q.count,label:q.label});return{uniqueValueInfos:D}};a.getAttributeComparator=g;a.getEqualIntervalBins=z;a.getNormalizedValue=function(k,q,x,v){let D=null;switch(q){case "log":0!==k&&(D=Math.log(k)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(v)&&
0!==v&&(D=k/v*100);break;case "field":Number.isFinite(x)&&0!==x&&(D=k/x);break;case "natural-log":0<k&&(D=Math.log(k));break;case "square-root":0<k&&(D=k**.5)}return D};a.isNullCountSupported=m;a.processNullValue=r;a.processSummaryStatisticsResult=function(k,q){let x;for(x in k)C.includes(x)&&(Number.isFinite(k[x])||(k[x]=null));if(!q)return k;["avg","stddev","variance"].forEach(v=>{null!=k[v]&&(k[v]=Math.ceil(k[v]))});return k};a.resolveCBResult=function(k,q){let x=k.classBreaks;const v=x[0].minValue,
D=x[x.length-1].maxValue,F="standard-deviation"===q;x=x.map(G=>{const J=G.label;G={minValue:G.minValue,maxValue:G.maxValue,label:J};if(F&&J){const L=J.match(y).map(K=>+K.trim());2===L.length?(G.minStdDev=L[0],G.maxStdDev=L[1],0>L[0]&&0<L[1]&&(G.hasAvg=!0)):1===L.length&&(J.includes("\x3c")?(G.minStdDev=null,G.maxStdDev=L[0]):J.includes("\x3e")&&(G.minStdDev=L[0],G.maxStdDev=null))}return G});return{minValue:v,maxValue:D,classBreakInfos:x,normalizationTotal:k.normalizationTotal}};a.statisticTypes=
C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ClassificationDefinition".split(" "),function(a,b,c,r,m,n,p,g){m=new c.JSONMap({esriClassifyEqualInterval:"equal-interval",
esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});c=new c.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});g=function(h){function d(){var f=h.apply(this,arguments)||this;f.breakCount=null;f.classificationField=null;f.classificationMethod=null;f.normalizationField=null;f.normalizationType=
null;f.type="class-breaks-definition";return f}a._inheritsLoose(d,h);a._createClass(d,[{key:"standardDeviationInterval",set:function(f){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",f)}},{key:"definedInterval",set:function(f){"defined-interval"===this.classificationMethod&&this._set("definedInterval",f)}}]);return d}(g);b.__decorate([r.property({json:{write:!0}})],g.prototype,"breakCount",void 0);b.__decorate([r.property({json:{write:!0}})],g.prototype,"classificationField",
void 0);b.__decorate([r.property({type:String,json:{read:m.read,write:m.write}})],g.prototype,"classificationMethod",void 0);b.__decorate([r.property({json:{write:!0}})],g.prototype,"normalizationField",void 0);b.__decorate([r.property({json:{read:c.read,write:c.write}})],g.prototype,"normalizationType",void 0);b.__decorate([r.property({value:null,json:{write:!0}})],g.prototype,"standardDeviationInterval",null);b.__decorate([r.property({value:null,json:{write:!0}})],g.prototype,"definedInterval",
null);b.__decorate([r.property()],g.prototype,"type",void 0);return g=b.__decorate([p.subclass("esri.rest.support.ClassBreaksDefinition")],g)})},"esri/rest/support/ClassificationDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./colorRamps ../../symbols/Symbol".split(" "),
function(a,b,c,r,m,n,p,g,h,d){c=new c.JSONMap({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});r=function(f){function e(){var l=f.apply(this,arguments)||this;l.baseSymbol=null;l.colorRamp=null;l.type=null;return l}a._inheritsLoose(e,f);return e}(r.JSONSupport);b.__decorate([m.property({type:d,json:{write:!0}})],r.prototype,"baseSymbol",void 0);b.__decorate([m.property({types:h.types,json:{read:{reader:h.fromJSON},write:!0}})],r.prototype,"colorRamp",void 0);b.__decorate([m.property({json:{read:c.read,
write:c.write}})],r.prototype,"type",void 0);return r=b.__decorate([g.subclass("esri.rest.support.ClassificationDefinition")],r)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function c(l){const {classificationMethod:A,breakCount:t,normalizationType:w,definedInterval:u}=l.definition,z=[];var y=l.values;if(0===y.length)return[];y=y.sort((v,D)=>v-D);var B=y[0],C=y[y.length-1];if("equal-interval"===A)if(y.length>=t){y=(C-B)/t;l=B;for(var k=
1;k<t;k++){var q=Number((B+k*y).toFixed(6));z.push({minValue:l,maxValue:q,label:r(l,q,w)});l=q}z.push({minValue:l,maxValue:C,label:r(l,C,w)})}else y.forEach(v=>{z.push({minValue:v,maxValue:v,label:r(v,v,w)})});else if("natural-breaks"===A){y=m(y);l=n(y.uniqueValues,l.valueFrequency||y.valueFrequency,t);for(k=1;k<t;k++)y.uniqueValues.length>k&&(q=Number(y.uniqueValues[l[k]].toFixed(6)),z.push({minValue:B,maxValue:q,label:r(B,q,w)}),B=q);z.push({minValue:B,maxValue:C,label:r(B,C,w)})}else if("quantile"===
A)if(y.length>=t&&B!==C){l=Math.ceil(y.length/t);k=0;for(q=1;q<t;q++){var x=l+k-1;x>y.length&&(x=y.length-1);0>x&&(x=0);z.push({minValue:B,maxValue:y[x],label:r(B,y[x],w)});B=y[x];k+=l;l=Math.ceil((y.length-k)/(t-q))}z.push({minValue:B,maxValue:C,label:r(B,C,w)})}else for(C=-1,B=0;B<y.length;B++)l=y[B],l!==C&&(C=l,z.push({minValue:C,maxValue:l,label:r(C,l,w)}),C=l);else if("standard-deviation"===A)if(l=h(y),k=d(y,l),0===k)z.push({minValue:y[0],maxValue:y[0],label:r(y[0],y[0],w)});else{y=g(B,C,t,l,
k)*k;k=0;for(q=t;1<=q;q--)x=Number((l-(q-.5)*y).toFixed(6)),z.push({minValue:B,maxValue:x,label:r(B,x,w)}),B=x,k++;q=Number((l+.5*y).toFixed(6));z.push({minValue:B,maxValue:q,label:r(B,q,w)});B=q;k++;for(x=1;x<=t;x++)q=k===2*t?C:Number((l+(x+.5)*y).toFixed(6)),z.push({minValue:B,maxValue:q,label:r(B,q,w)}),B=q,k++}else if("defined-interval"===A){if(!u)return z;C=y[0];y=y[y.length-1];B=Math.ceil((y-C)/u);l=C;for(k=1;k<B;k++)q=Number((C+k*u).toFixed(6)),z.push({minValue:l,maxValue:q,label:r(l,q,w)}),
l=q;z.push({minValue:l,maxValue:y,label:r(l,y,w)})}return z}function r(l,A,t){let w=null;return w=l===A?t&&"percent-of-total"===t?l+"%":l.toString():t&&"percent-of-total"===t?l+"% - "+A+"%":l+" - "+A}function m(l){const A=[],t=[];let w=Number.MIN_VALUE,u=1,z=-1;for(let y=0;y<l.length;y++){const B=l[y];B===w?(u++,t[z]=u):null!==B&&(A.push(B),w=B,u=1,t.push(u),z++)}return{uniqueValues:A,valueFrequency:t}}function n(l,A,t){var w=l.length;const u=[];t>w&&(t=w);for(var z=0;z<t;z++)u.push(Math.round(z*
w/t-1));u.push(w-1);z=p(u,l,A,t);w=z.mean;z=z.sdcm;var y=t,B=0,C=0;let k=0,q=0,x=!0;for(let D=0;2>D&&x;D++){0===D&&(x=!1);for(var v=0;v<y-1;v++)for(;u[v+1]+1!==u[v+2];)if(u[v+1]+=1,B=f(v,u,l,A),k=B.sbMean,B=B.sbSdcm,C=f(v+1,u,l,A),q=C.sbMean,C=C.sbSdcm,B+C<z[v]+z[v+1])z[v]=B,z[v+1]=C,w[v]=k,w[v+1]=q,x=!0;else{--u[v+1];break}for(v=y-1;0<v;v--)for(;u[v]!==u[v-1]+1;)if(--u[v],B=f(v-1,u,l,A),k=B.sbMean,B=B.sbSdcm,C=f(v,u,l,A),q=C.sbMean,C=C.sbSdcm,B+C<z[v-1]+z[v])z[v-1]=B,z[v]=C,w[v-1]=k,w[v]=q,x=!0;
else{u[v]+=1;break}}x&&(z=p(u,l,A,t));return u}function p(l,A,t,w){let u=[];var z=[],y=[];let B=0;const C=[],k=[];for(var q=0;q<w;q++){var x=f(q,l,A,t);C.push(x.sbMean);k.push(x.sbSdcm);B+=k[q]}x=B;for(q=!0;q||B<x;){q=!1;u=[];for(z=0;z<w;z++)u.push(l[z]);for(y=0;y<w;y++)for(x=l[y]+1;x<=l[y+1];x++)if(z=A[x],0<y&&x!==l[y+1]&&Math.abs(z-C[y])>Math.abs(z-C[y-1]))l[y]=x;else if(y<w-1&&l[y]!==x-1&&Math.abs(z-C[y])>Math.abs(z-C[y+1])){l[y+1]=x-1;break}x=B;B=0;z=[];y=[];for(let v=0;v<w;v++){z.push(C[v]);
y.push(k[v]);const D=f(v,l,A,t);C[v]=D.sbMean;k[v]=D.sbSdcm;B+=k[v]}}if(B>x){for(A=0;A<w;A++)l[A]=u[A],C[A]=z[A],k[A]=y[A];B=x}return{mean:C,sdcm:k}}function g(l,A,t,w,u){l=Math.max(w-l,A-w)/u/t;return 1<=l?1:.5<=l?.5:.25}function h(l){let A=0;for(let t=0;t<l.length;t++)A+=l[t];return A/=l.length}function d(l,A){let t=0;for(let w=0;w<l.length;w++){const u=l[w];t+=(u-A)*(u-A)}t/=l.length;return Math.sqrt(t)}function f(l,A,t,w){var u=0,z=0;for(var y=A[l]+1;y<=A[l+1];y++){const B=w[y];u+=t[y]*B;z+=B}0>=
z&&e.warn("Exception in Natural Breaks calculation");u/=z;z=0;for(y=A[l]+1;y<=A[l+1];y++)z+=w[y]*(t[y]-u)**2;return{sbMean:u,sbSdcm:z}}const e=b.getLogger("esri.rest.support.generateRendererUtils");a.createGenerateRendererClassBreaks=function(l){const {normalizationTotal:A}=l;return{classBreaks:c(l),normalizationTotal:A}};a.createGenerateRendererUniqueValues=function(l){l=m(l);const A=[],t=l.uniqueValues.length;for(let w=0;w<t;w++){const u=l.uniqueValues[w];A.push({value:u,count:l.valueFrequency[w],
label:u.toString()})}return{uniqueValues:A}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){function t(){t=c._asyncToGenerator(function*(L,K,O){const {outFields:P,orderByFields:N,groupByFieldsForStatistics:H,outStatistics:E}=L;if(P)for(var I=0;I<P.length;I++)P[I]=P[I].trim();if(N)for(I=0;I<N.length;I++)N[I]=N[I].trim();if(H)for(I=0;I<H.length;I++)H[I]=H[I].trim();if(E)for(I=0;I<E.length;I++)E[I].onStatisticField&&(E[I].onStatisticField=E[I].onStatisticField.trim());L.geometry&&!L.outSR&&(L.outSR=L.geometry.spatialReference);return w(L,K,O)});return t.apply(this,
arguments)}function w(L,K,O){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(L,K,O){if(!L)return null;var {where:P}=L;L.where=P=P&&P.trim();if(!P||/^1 *= *1$/.test(P)||K&&K===P)L.where=null;if(!L.geometry)return L;K=yield y(L);L.distance=0;L.units=null;"esriSpatialRelEnvelopeIntersects"===L.spatialRel&&({spatialReference:P}=L.geometry,K=g.getGeometryExtent(K),K.spatialReference=P);if(K){yield A.checkProjectionSupport(K.spatialReference,O);P=K.spatialReference;K=z(K,O)&&
h.isExtent(K)?{spatialReference:P,rings:[[[K.xmin,K.ymin],[K.xmin,K.ymax],[K.xmax,K.ymax],[K.xmax,K.ymin],[K.xmin,K.ymin]]]}:K;P=(yield d.normalizeCentralMeridian(h.fromJSON(K)))[0];if(m.isNone(P))throw x;const N="quantizationParameters"in L&&L.quantizationParameters?.tolerance||"maxAllowableOffset"in L&&L.maxAllowableOffset||0;K=N&&z(K,O)?{densificationStep:8*N}:void 0;P=P.toJSON();K=yield A.project(P,P.spatialReference,O,K);if(!K)throw x;K.spatialReference=O;L.geometry=K}return L});return u.apply(this,
arguments)}function z(L,K){if(!L)return!1;const O=L.spatialReference;return(h.isExtent(L)||h.isPolygon(L)||h.isPolyline(L))&&!f.equals(O,K)&&!p.canProjectWithoutEngine(O,K)}function y(L){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(L){const {distance:K,units:O}=L,P=L.geometry;if(null==K||"vertexAttributes"in P)return P;var N=P.spatialReference;L=O?q.fromJSON(O):n.getUnitString(N);N=N&&(f.isGeographic(N)||f.isWebMercator(N))?P:yield A.checkProjectionSupport(N,f.WGS84).then(()=>
A.project(P,f.WGS84));return(yield C())(N.spatialReference,N,K,L)});return B.apply(this,arguments)}function C(){return k.apply(this,arguments)}function k(){k=c._asyncToGenerator(function*(){return(yield new Promise((L,K)=>a(["../../../geometry/geometryEngineJSON"],L,K))).geodesicBuffer});return k.apply(this,arguments)}const q=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),
x=Object.freeze({}),v=new l,D=new l,F=new l,G={esriGeometryPoint:e.convertToPoint,esriGeometryPolyline:e.convertToPolyline,esriGeometryPolygon:e.convertToPolygon,esriGeometryMultipoint:e.convertToMultipoint},J=(L,K)=>"_geVersion"!==L?K:void 0;b.QUERY_ENGINE_EMPTY_RESULT=x;b.cleanFromGeometryEngine=function(L){return L&&"_geVersion"in L?JSON.parse(JSON.stringify(L,J)):L};b.getGeometry=function(L,K,O,P,N,H,E=K,I=O){const M=K&&E,Q=O&&I;P=m.isSome(P)?"coords"in P?P:P.geometry:null;if(m.isNone(P))return null;
if(N)return K=e.generalizeOptimizedGeometry(D,P,K,O,L,N,E,I),H&&(K=e.quantizeOptimizedGeometry(F,K,M,Q,L,H)),G[L]?.(K,M,Q)??null;if(H)return H=e.quantizeOptimizedGeometry(F,P,K,O,L,H,E,I),G[L]?.(H,M,Q)??null;e.removeZMValues(v,P,K,O,E,I);return G[L]?.(v,M,Q)??null};b.normalizeQuery=function(L,K,O){return t.apply(this,arguments)};b.normalizeQueryLike=w;b.transformCentroid=function(L,K,O,P=L.hasZ,N=L.hasM){if(m.isNone(K))return null;const H=L.hasZ&&P,E=L.hasM&&N;return O?(L=e.quantizeOptimizedGeometry(F,
K,L.hasZ,L.hasM,"esriGeometryPoint",O,P,N),e.convertToPoint(L,H,E)):e.convertToPoint(K,H,E)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){function A(){return new Promise((z,y)=>a(["../../../geometry/geometryEngineJSON"],z,y))}function t(){t=c._asyncToGenerator(function*(z,y,B){const {spatialRel:C,geometry:k}=z;if(k){if(null==C||!0!==u.spatialRelationship[C])throw new r("feature-store:unsupported-query","Unsupported query spatial relationship",{query:z});if(g.isValid(k.spatialReference)&&g.isValid(B)){if(null==k||!0!==u.queryGeometry[p.getJsonType(k)])throw new r("feature-store:unsupported-query",
"Unsupported query geometry type",{query:z});if(null==y||!0!==u.layerGeometry[y])throw new r("feature-store:unsupported-query","Unsupported layer geometry type",{query:z});if(z.outSR)return e.checkProjectionSupport(z.geometry&&z.geometry.spatialReference,z.outSR)}}});return t.apply(this,arguments)}const w={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,
esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},u={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};b.canQueryWithRBush=function(z){if(p.isExtent(z))return!0;if(p.isPolygon(z)){for(const y of z.rings)if(5!==y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=function(z,y,B){return t.apply(this,
arguments)};b.getSpatialQueryOperator=function(z,y,B,C,k){if(p.isPolygon(y)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z)){const q=d.convertFromPolygon(new f,y,!1,!1);return Promise.resolve(x=>h.polygonContainsPoint(q,!1,!1,x))}if(p.isPolygon(y)&&"esriGeometryMultipoint"===B){const q=d.convertFromPolygon(new f,y,!1,!1);if("esriSpatialRelContains"===z)return Promise.resolve(x=>h.polygonContainsMultipoint(q,!1,!1,x,C,k))}if(p.isExtent(y)&&"esriGeometryPoint"===
B&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z))return Promise.resolve(q=>m.extentContainsPoint(y,l.getGeometry(B,C,k,q)));if(p.isExtent(y)&&"esriGeometryMultipoint"===B&&"esriSpatialRelContains"===z)return Promise.resolve(q=>m.extentContainsMultipoint(y,l.getGeometry(B,C,k,q)));if(p.isExtent(y)&&"esriSpatialRelIntersects"===z){const q=n.getExtentIntersector(B);return Promise.resolve(x=>q(y,l.getGeometry(B,C,k,x)))}return A().then(q=>{const x=q[w[z]].bind(null,y.spatialReference,
y);return v=>x(l.getGeometry(B,C,k,v))})};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.extentIntersectsRings=
b.extentIntersectsRings;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(c){return"mesh"===c?b.extentIntersectsExtent:b.getFeatureExtentIntersector(c)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(c,r,m,n,p){if(!c)return!1;r=r?m?4:3:m?3:2;const {coords:g,
lengths:h}=c;m=!1;c=0;for(const f of h){var d=c;for(let e=c,l=c+f*r;e<l;e+=r){d=e+r;d===l&&(d=c);const A=g[e],t=g[e+1],w=g[d];d=g[d+1];(t<p&&d>=p||d<p&&t>=p)&&A+(p-t)/(d-t)*(w-A)<n&&(m=!m)}c+=f*r}return m}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(c,r,m,n,p,g){p=p?g?4:3:g?3:2;const {coords:h,lengths:d}=n;if(!d)return!1;for(let f=0,e=0;f<d.length;f++,e+=p)if(!b(c,r,m,h[e],h[e+1]))return!1;return!0};a.polygonContainsPoint=function(c,r,m,n){return b(c,r,m,n.coords[0],n.coords[1])};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(m,n,p,g,h){if(null!=g&&null!=h)return d=>{const f=m.getAttribute(d,n);d=m.getAttribute(d,p);return(null==f||f<=h)&&(null==d||d>=g)};if(null!=g)return d=>{d=m.getAttribute(d,p);return null==d||d>=g};if(null!=h)return d=>{d=m.getAttribute(d,n);return null==d||d<=h}}function c(m,n,p,g){if(null!=p&&null!=g&&p===g)return h=>
m.getAttribute(h,n)===p;if(null!=p&&null!=g)return h=>{h=m.getAttribute(h,n);return h>=p&&h<=g};if(null!=p)return h=>m.getAttribute(h,n)>=p;if(null!=g)return h=>m.getAttribute(h,n)<=g}function r(){return()=>!1}a.getTimeExtent=function(m,n){if(!m)return null;const p=n.featureAdapter,{startTimeField:g,endTimeField:h}=m;let d=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY;if(g&&h)n.forEach(e=>{const l=p.getAttribute(e,g);e=p.getAttribute(e,h);null==l||isNaN(l)||(d=Math.min(d,l));null==e||isNaN(e)||
(f=Math.max(f,e))});else{const e=g||h;n.forEach(l=>{l=p.getAttribute(l,e);null==l||isNaN(l)||(d=Math.min(d,l),f=Math.max(f,l))})}return{start:d,end:f}};a.getTimeOperator=function(m,n,p){if(!n||!m)return null;const {startTimeField:g,endTimeField:h}=m;if(!g&&!h)return null;const {start:d,end:f}=n;return null===d&&null===f?null:void 0===d&&void 0===f?r():g&&h?b(p,g,h,d,f):c(p,g||h,d,f)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,b,c,r,m){function n(){n=b._asyncToGenerator(function*(g,h,d){if(c.isNone(g)||0===h.candidates.length)return p;var f=g.graphics3DGraphicsByObjectID??g.graphics3DGraphics,e=[];const l=[],{renderer:A}=g,t=c.isSome(A)&&"arcadeRequired"in A&&A.arcadeRequired?m.loadArcade():null;var w=function(){var C=b._asyncToGenerator(function*(k,{graphic:q,graphics3DSymbol:x}){const v=
yield t;q=yield g.getRenderingInfoAsync(q,A,v,{signal:d});return c.isNone(q)?[]:x.queryForSnapping(k,z,q,d)});return function(k,q){return C.apply(this,arguments)}}();const {candidates:u,spatialReference:z}=h;for(h=0;h<u.length;++h){var y=u[h],{objectId:B}=y;B="number"===typeof B?f.get(B):void 0;if(c.isNone(B))continue;const {graphics3DSymbol:C}=B;C.symbologySnappingSupported&&(e.push(w(y,B)),l.push(h))}if(0===e.length)return p;f=yield Promise.all(e);r.throwIfAborted(d);e=[];w=[];for(h=0;h<f.length;++h){y=
f[h];B=l[h];for(const C of y)e.push(C),w.push(B)}return{candidates:e,sourceCandidateIndices:w}});return n.apply(this,arguments)}const p={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=function(g,h,d){return n.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/byteSizeEstimations ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M){const Q=p.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(S){function U(V){V=S.call(this,V)||this;V.type="heatmap";V.preferredUpdatePolicy=J.UpdatePolicy.ASYNC;V.dataExtent=null;V.drapeSourceType=D.DrapeSourceType.Features;V._renderGeometries=new Map;V._fieldTotal=0;V._drapeSourceRenderer=null;V._dataType=I.PixelType.HALF_FLOAT;V._pixelFormat=I.PixelFormat.RGBA;
V.initializePromise=Promise.resolve();return V}b._inheritsLoose(U,S);var Y=U.prototype;Y.initialize=function(){this._featureStore=new q({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:V,samplingMode:R,pixelFormat:X,internalFormat:W}=M.loadHeatmapTextureConfiguration(this._renderView.renderingContext,Q);this._dataType=V;this._pixelFormat=X;const aa=V!==I.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,L.DrapedHeatmapRenderer,
{...this._rendererParameters,dataType:V,samplingMode:R,pixelFormat:X,internalFormat:W});this._material=new H.HeatmapDensityMaterial({usesHalfFloats:aa});this._materialWithField=new H.HeatmapDensityMaterial({usesHalfFloats:aa,isAttributeDriven:!0});this._filterVisibility=new F.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:ba=>this._setAllFeaturesVisibility(ba),clearFeaturesVisibility:()=>
this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:ba=>this._updateFeatureVisibilities(ba)}});this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,ba=>this._onLoadedFeaturesChange(ba),h.initial);this.updatingHandles.addWhen(()=>this._materialParameters,ba=>this._forEachMaterial(ia=>ia.setParameters(ba)),h.initial);this.updatingHandles.add(()=>this._rendererParameters,ba=>this._drapeSourceRenderer.set(ba));this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},
h.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:ba,numeric:ia})=>{if(g.isSome(ba)&&ia){let ma=0;this._featureStore.forEach(ha=>ma+=ha.attributes[ba]??0);this._fieldTotal=ma}else this._fieldTotal=this._featureStore.numFeatures},h.initial);this.handles.add([h.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:ba,field:ia})=>{ba&&!ia&&Q.warn(`Heatmap renderer field '${ba}' for layer '${this.layer.title??
this.layer.id}' not found`)}),h.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:ba,numeric:ia})=>{g.isSome(ba)&&!ia&&Q.warn(`Heatmap renderer field '${ba.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),n.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])};Y.destroy=function(){this._renderGeometries.clear();this._material=g.disposeMaybe(this._material);
this._materialWithField=g.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};Y.whenGraphicBounds=function(){var V=b._asyncToGenerator(function*(){return null});return function(){return V.apply(this,arguments)}}();Y.computeAttachmentOrigin=function(){return null};Y.highlight=function(){return T};Y.maskOccludee=function(){return T};Y.setObjectIdVisibility=function(){};Y.refreshFilter=function(){this.filterVisibility.reapply()};Y._onLoadedFeaturesChange=function(V){if(this._featuresArePoints){var {objectIdField:R}=
this.layer;this._featureStore.removeManyById(V.removed.map(W=>y.getObjectId(W,R)));this._featureStore.addMany(V.added.map(W=>{const aa=new C.OptimizedFeature(B.convertFromPoint(new k,W.geometry),W.attributes,g.applySome(W.centroid,ba=>B.convertFromPoint(new k,ba)),y.getObjectId(W,R));aa.displayId=W.uid;return aa}));var X=V.added;V=V.removed;this._fieldTotal+=this._computeFieldTotalChange(X,V);V=g.mapSome(V,({uid:W})=>{const aa=this._renderGeometries.get(W);this._renderGeometries.delete(W);return aa});
X=X.map(W=>{const aa=this._pointGraphicToRenderGeometry(W);this._renderGeometries.set(W.uid,aa);return aa});0<V.length&&this._drapeSourceRenderer.removeGeometries(V,O.DirtyOperation.REMOVE);0<X.length&&this._drapeSourceRenderer.addGeometries(X,O.DirtyOperation.ADD);if(0<X.length||0<V.length)this.filterVisibility.reapply(),this._renderView.requestRender()}};Y._recreate=function(){if(this._loadedPointGraphics){var V=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:V,removed:V})}};
Y._pointGraphicToRenderGeometry=function(V){const R=this._heatmapRendererFieldName,X=g.isSome(R)?this._materialWithField:this._material,W=w.create();u.projectPointToVector(V.geometry,W,this._overlaySpatialReference);W[2]=G.DRAPED_Z;const aa=[[N.VertexAttribute.POSITION,{data:W,size:W.length}]],ba=this._heatmapRendererFieldIsNumeric;g.isSome(R)&&aa.push([N.VertexAttribute.FEATUREATTRIBUTE,{data:[ba?V.attributes[R]??0:0],size:1}]);V=new P.RenderGeometry(new K.Geometry(aa,null,J.PrimitiveType.Point),
X,{layerUid:this.layer.uid,graphicUid:V.uid});t.copy(V.boundingSphere,W);V.instanceParameters.visible=this.filterVisibility.defaultVisibility;return V};Y._forEachMaterial=function(V){V(this._material);V(this._materialWithField)};Y._computeFieldTotalChange=function(V,R){if(g.isNone(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return V.length-R.length;const X=this._heatmapRendererFieldName,W=(aa,ba)=>aa+(ba.attributes[X]??0);return V.reduce(W,0)-R.reduce(W,0)};Y._clampSearchRadius=
function(V){112<V&&Q.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(V,112)};Y._updateFeatureVisibilities=function(V){const R=[];this._featureStore.forEach(({objectId:X,displayId:W})=>{X=V(X);W=this._renderGeometries.get(W);W.instanceParameters.visible!==X&&(R.push(W),W.instanceParameters.visible=X)});this._drapeSourceRenderer.modifyGeometries(R,O.DirtyState.VISIBILITIES)};Y._setAllFeaturesVisibility=function(V){const R=[];for(const X of this._renderGeometries.values())X.instanceParameters.visible!==
V&&(R.push(X),X.instanceParameters.visible=V);this._drapeSourceRenderer.modifyGeometries(R,O.DirtyState.VISIBILITIES)};b._createClass(U,[{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating||this.filterVisibility.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"filterVisibility",
get:function(){return this._filterVisibility}},{key:"displayFeatureLimit",get:function(){var V=this.owner?.view?.resourceController?.memoryController?.memoryFactor??1;const R=this.owner?.view?.qualitySettings;V=R?Math.ceil(R.heatmap.maxTotalNumberOfFeatures*V):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:V,maximumTotalNumberOfPrimitives:2*V,maximumNumberOfFeatures:V}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in
this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){if(!this._isScaleRangeActive)return!1;const {minScale:V,maxScale:R}=this.layer.effectiveScaleRange,{scale:X}=this.view;return!E.scaleBoundsPredicate(X,V??0,R??0)}},{key:"usedMemory",get:function(){const V=Math.ceil(this._overlayRenderer?.overlays[0]?.resolution*
this._densityMapPixelRatio)??0;return V*V*(this._pixelFormat===I.PixelFormat.RED?1:4)*(this._dataType===I.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}},{key:"usedMemoryPerFeature",get:function(){var V=this._loadedPointGraphics.find(()=>!0);if(g.isNone(V))return 0;V=r.estimateAttributesObjectSize(V);const R=r.estimateNumberByteSize(),X=6*r.estimateFixedArraySize([0,0,0],R),W=6*r.estimateFixedArraySize([0,0],R);return X+W+(this._heatmapRendererFieldIsNumeric?6*R:0)+
V}},{key:"loadedFeatures",get:function(){return this._featureStore.numFeatures}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"renderer",get:function(){return this._heatmapRenderer}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return g.unwrap(this._overlayRenderer.spatialReference)}},
{key:"_rendererParameters",get:function(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,...this._pixelRatioParameter}}},{key:"_materialParameters",get:function(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}},{key:"_densityParameters",get:function(){const V=this._heatmapRenderer;if(g.isNone(V))return null;const {minDensity:R,maxDensity:X}=V;return{minDensity:R,maxDensity:X,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){return g.applySome(this._heatmapRenderer,
({radius:V})=>({searchRadius:d.pt2px(this._clampSearchRadius(V))}))}},{key:"_resolutionForScaleParameter",get:function(){return g.applySome(this._heatmapRenderer,({referenceScale:V})=>({resolutionForScale:0===V?0:z.getResolutionForScale(V,this.view.spatialReference)}))}},{key:"_colorRampParameter",get:function(){return g.applySome(this._heatmapRenderer,V=>({colorRampData:v.generateGradient(V.colorStops)}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},
{key:"_densityMapPixelRatio",get:function(){return(this.owner?.view?.qualitySettings.heatmap.pixelRatio??1)*Math.sqrt(this.owner?.view?.resourceController?.memoryController?.memoryFactor??1)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){const V=this.layer.renderer;return"heatmap"===
V?.type?V:null}},{key:"_heatmapRendererFieldName",get:function(){return g.applySome(this._heatmapRenderer,V=>V.field)}},{key:"_heatmapRendererField",get:function(){return g.applySome(this._heatmapRendererFieldName,V=>this.layer.fieldsIndex.get(V))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const V=this._heatmapRendererField;return g.isNone(V)?!1:x.isNumericField(V)}},{key:"_isScaleRangeActive",get:function(){const {layer:V}=this;if(!("effectiveScaleRange"in V))return!1;const {minScale:R,
maxScale:X}=V.effectiveScaleRange;return E.isScaleRangeActive(R,X)}},{key:"_visibleFeatures",get:function(){let V=0;this._renderGeometries.forEach(R=>{R.instanceParameters.visible&&++V});return V}},{key:"test",get:function(){return{visibleFeatureCount:this._visibleFeatures}}}]);return U}(m.HandleOwner);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);c.__decorate([f.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);c.__decorate([f.property()],
a.HeatmapFeatureProcessor.prototype,"layer",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);c.__decorate([f.property()],
a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);c.__decorate([f.property()],
a.HeatmapFeatureProcessor.prototype,"view",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);c.__decorate([f.property()],
a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",
null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,
"_densityMapPixelRatio",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);c.__decorate([f.property()],
a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,
"_fieldTotal",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);c.__decorate([f.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=c.__decorate([A.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const T=n.makeHandle();a.MAX_RADIUS_PT=112;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,r,m,n,p,g,h,d){return function(){function f(l){this.geometryInfo=l;this._boundsStore=new h.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=d.optimizedFeatureQueryEngineAdapter}var e=f.prototype;e.add=function(l){this._add(l);this._emitChanged()};e.addMany=function(l){for(const A of l)this._add(A);this._emitChanged()};e.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};e.removeById=function(l){l=
this._featuresById.get(l);if(!l)return null;this._remove(l);this._emitChanged();return l};e.removeManyById=function(l){this._boundsStore.invalidateIndex();for(const A of l)(l=this._featuresById.get(A))&&this._remove(l);this._emitChanged()};e.forEachBounds=function(l,A,t){for(const w of l)(l=this._boundsStore.get(w.objectId))&&A(n.fromRect(t,l))};e.getFeature=function(l){return this._featuresById.get(l)};e.has=function(l){return this._featuresById.has(l)};e.toArray=function(){return Array.from(this._featuresById.values())};
e.forEach=function(l){this._featuresById.forEach(A=>l(A))};e.forEachInBounds=function(l,A){this._boundsStore.forEachInBounds(l,t=>{A(this._featuresById.get(t))})};e.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};e.sweep=function(){let l=!1;this._featuresById.forEach((A,t)=>{this._markedIds.has(t)||(l=!0,this._remove(A))});this._markedIds.clear();l&&this._emitChanged()};e._emitChanged=function(){this.events.emit("changed",void 0)};e._add=function(l){if(l){var A=
l.objectId;if(null==A)r.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:l}));else{var t=this._featuresById.get(A);this._markedIds.add(A);if(t){l.displayId=t.displayId;var w=this._boundsStore.get(A);this._boundsStore.delete(A)}else if(m.isSome(this.onFeatureAdd))this.onFeatureAdd(l);!m.isNone(l.geometry)&&l.geometry.coords&&l.geometry.coords.length?(w=g.getBoundsOptimizedGeometry(m.isSome(w)?w:p.create(),l.geometry,this.geometryInfo.hasZ,
this.geometryInfo.hasM),m.isSome(w)&&this._boundsStore.set(A,w)):this._boundsStore.set(A,null);this._featuresById.set(A,l)}}};e._remove=function(l){if(m.isSome(this.onFeatureRemove))this.onFeatureRemove(l);this._markedIds.delete(l.objectId);this._boundsStore.delete(l.objectId);this._featuresById.delete(l.objectId);return l};a._createClass(f,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},
{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){let l=0;this._featuresById.forEach(A=>{m.isSome(A.geometry)&&A.geometry.coords&&(l+=A.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:l/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);return f}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,c,r,m){function n(h,d,f){p.minX=d[0];p.minY=d[1];p.maxX=d[2];p.maxY=d[3];h.search(p,f)}const p={minX:0,minY:0,maxX:0,maxY:0};let g=function(){function h(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new r.PooledRBush(9,c("esri-csp-restrictions")?f=>({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=
()=>{if(this._indexInvalid){const f=Array(this._idByBounds.size);let e=0;this._idByBounds.forEach((l,A)=>{f[e++]=A});this._indexInvalid=!1;this._index.clear();this._index.load(f)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(f=>this._idByBounds.has(f))),this._boundsToLoad.length=0)}}var d=h.prototype;d.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};d.delete=function(f){const e=
this._boundsById.get(f);this._boundsById.delete(f);e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))};d.forEachInBounds=function(f,e){this._loadIndex();n(this._index,f,l=>e(this._idByBounds.get(l)))};d.get=function(f){return this._boundsById.get(f)};d.has=function(f){return this._boundsById.has(f)};d.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};d.set=function(f,e){if(!this._indexInvalid){const l=this._boundsById.get(f);
l&&(this._index.remove(l),this._idByBounds.delete(l))}this._boundsById.set(f,e);e&&(this._idByBounds.set(e,f),this._indexInvalid||(this._boundsToLoad.push(e),5E4<this._boundsToLoad.length&&this._loadIndex()))};b._createClass(h,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;const f=m.empty();for(const e of this._boundsById.values())e&&(f[0]=Math.min(e[0],f[0]),f[1]=Math.min(e[1],f[1]),f[2]=Math.max(e[2],f[2]),f[3]=Math.max(e[3],f[3]));return f}},{key:"valid",get:function(){return!this._indexInvalid}}]);
return h}();a.BoundsStore=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){a.DrapedHeatmapRenderer=function(z){function y(C){C=z.call(this,C)||this;C.pixelRatio=1;C._colorRampData=new Uint8ClampedArray(4);C.type="draped-heatmap";C._heatmapParameters=new l.HeatmapPassParameters;return C}b._inheritsLoose(y,z);var B=y.prototype;B.initialize=function(){this._densityMap=new t.FramebufferObject(this.rctx,{colorTarget:A.TargetType.TEXTURE,depthStencilTarget:A.DepthStencilTargetType.NONE,width:0,height:0},{target:A.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=f.createQuadVAO(this.rctx);var C=this._colorRampData;this._colorRamp=new w.Texture(this.rctx,{target:A.TextureType.TEXTURE_2D,pixelFormat:A.PixelFormat.RGBA,dataType:A.PixelType.UNSIGNED_BYTE,samplingMode:A.TextureSamplingMode.LINEAR,wrapMode:A.TextureWrapMode.CLAMP_TO_EDGE,width:C.length/4,height:1},C);C=new l.HeatmapTechniqueConfiguration;
C.usesHalfFloat=this.dataType!==A.PixelType.FLOAT;this._technique=new l.HeatmapTechnique({rctx:this.rctx,viewingMode:d.ViewingMode.Local},C);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(m.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};B.destroy=function(){this._technique=r.releaseMaybe(this._technique);this._densityMap=r.disposeMaybe(this._densityMap);
this._quad=r.disposeMaybe(this._quad);this._colorRamp=r.disposeMaybe(this._colorRamp)};B.render=function(C,k){const q=this._sortedMaterialRenderers,x=q.length;if(!(1>x)){var v=this.rctx.getBoundFramebufferObject(),D=this.rctx.getViewport(),{pixelRatio:F}=this,G=Math.ceil(D.width*F);F=Math.ceil(D.height*F);this._densityMap.resize(G,F);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,G,F);this.rctx.clear(A.ClearBufferBit.COLOR_BUFFER_BIT);G=!1;for(F=0;F<x;F++){const J=q.getItemAt(F);
J.material.shouldRender(C)&&(G=G||J.materialRenderer.render(C.output,k))}this.rctx.bindFramebuffer(v);this.rctx.setViewport(D.x,D.y,D.width,D.height);G&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,C.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,u.vertexCount(this._quad,"geometry")))}};b._createClass(y,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(C){C!==this._heatmapParameters.searchRadius&&
(this._heatmapParameters.searchRadius=C,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(C){C!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=C,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(C){C!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=C,this.notifyChange("maxDensity"))}},{key:"fieldTotal",
get:function(){return this._heatmapParameters.fieldTotal},set:function(C){this._heatmapParameters.fieldTotal=C;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(C){const {colorRamp:k}=this._heatmapParameters;if(r.isSome(k)&&C!==this._colorRampData){const q=C.length/4;q!==k.descriptor.width&&k.resize(q,1);k.setData(C)}this._colorRampData=C}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(C){this._heatmapParameters.colorRamp=
C}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return y}(e.SortedRenderGeometryRenderer);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",
null);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([n.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);c.__decorate([n.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([n.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([n.property({constructOnly:!0})],
a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);c.__decorate([n.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t){m=function(w){function u(){var z=w.apply(this,arguments)||this;z.colorRamp=null;z.densityMap=null;z.searchRadius=1;z.fieldTotal=0;z.minDensity=0;z.maxDensity=100;return z}c._inheritsLoose(u,w);return u}(m.NoParameters);p=function(w){function u(y,B){var C;return C=w.call(this,y,B,()=>C.destroy())||this}c._inheritsLoose(u,w);var z=u.prototype;z.initializeProgram=function(y){return new f.Program(y.rctx,u.shader.get().build(this.configuration),h.Default3D)};z.initializePipeline=
function(){return t.makePipelineState({blending:d.blendingDefault,colorWrite:t.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(u,[{key:"primitiveType",get:function(){return A.PrimitiveType.TRIANGLE_STRIP}}]);return u}(p.ShaderTechnique);p.shader=new n.ReloadableShaderModule(l.HeatmapShader,()=>new Promise((w,u)=>a(["./Heatmap.glsl"],w,u)));n=function(w){function u(){var z=w.apply(this,arguments)||this;z.usesHalfFloat=!1;return z}c._inheritsLoose(u,w);return u}(e.DefaultTechniqueConfiguration);
r.__decorate([g.parameter()],n.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=m;b.HeatmapTechnique=p;b.HeatmapTechniqueConfiguration=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,r,m,n,p){function g(d){const f=new n.ShaderBuilder;f.include(b.ScreenSpacePass);f.include(c.DiscardOrAdjustAlphaBlend);({usesHalfFloat:d}=d);f.fragment.uniforms.add([new p.Texture2DPassUniform("densityMap",e=>e.densityMap),new p.Texture2DPassUniform("tex",e=>e.colorRamp),new r.FloatPassUniform("densityNormalizer",e=>1/(e.maxDensity-e.minDensity)),new r.FloatPassUniform("minDensity",e=>e.minDensity)]);f.fragment.uniforms.add(new r.FloatPassUniform("densityMultiplier",e=>3/(e.searchRadius*
e.searchRadius*Math.PI)));d&&f.constants.add("compressionFactor","float",4);f.fragment.code.add(m.glsl`
    void main() {
      float density = texture2D(densityMap, uv).r * densityMultiplier${d?m.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `);return f}const h=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=h;a.build=g})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../core/libs/gl-matrix-2/types/vec2 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){let t=function(k){function q(){var x=k.apply(this,arguments)||this;x.isAttributeDriven=!1;x.usesHalfFloats=!1;return x}b._inheritsLoose(q,k);return q}(A.HeatmapDensityPassParameters),w=function(k){function q(v){v=k.call(this,v,new t)||this;v._configuration=new A.HeatmapDensityTechniqueConfiguration;return v}b._inheritsLoose(q,k);var x=q.prototype;x.requiresSlot=function(v,D){return v===f.RenderSlot.DRAPED_MATERIAL&&D===g.ShaderOutput.Color};x.getConfiguration=
function(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;return this._configuration};x.createGLMaterial=function(v){return new u(v)};x.intersect=function(v,D,F,G,J,L,K,O,P){if(!c.isNone(P)&&n.isVec2(L))for(D=v.vertexAttributes.get(e.VertexAttribute.POSITION),{parameters:F}=this,{searchRadius:F}=F,{screenToWorldRatio:v}=v,v=F*v+2*v,v*=v,F=D.data.length/D.size,G=0;G<F;G++)J=G*D.size,J=r.set(C,D.data[J],D.data[J+
1]),r.squaredDistance(J,L)<v&&K(P.dist,P.normal,-1,!1)};x.createBufferWriter=function(){return new z(this.parameters.isAttributeDriven?B:y)};return q}(d.Material),u=function(k){function q(){return k.apply(this,arguments)||this}b._inheritsLoose(q,k);q.prototype.beginSlot=function(x){return this.ensureTechnique(A.HeatmapDensityTechnique,x)};return q}(h),z=function(){function k(x){this.vertexBufferLayout=x}var q=k.prototype;q.allocate=function(x){return this.vertexBufferLayout.createBuffer(x)};q.elementCount=
function(x){return 6*x.indices.get(e.VertexAttribute.POSITION).length};q.write=function(x,v,D,F,G){l.writePosition(D.indices.get(e.VertexAttribute.POSITION),D.vertexAttributes.get(e.VertexAttribute.POSITION).data,x,F.position,G,6);x=D.indices.get(e.VertexAttribute.POSITION).length;v=F.uv0;let J=G;for(let L=0;L<x;++L)v.setValues(J++,-1,-1),v.setValues(J++,1,-1),v.setValues(J++,1,1),v.setValues(J++,1,1),v.setValues(J++,-1,1),v.setValues(J++,-1,-1);(F="featureAttribute"in F?F.featureAttribute:null)&&
l.writeBufferFloat(D.indices.get(e.VertexAttribute.FEATUREATTRIBUTE),D.vertexAttributes.get(e.VertexAttribute.FEATUREATTRIBUTE).data,F,G,6)};return k}();const y=p.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0),B=y.clone().f32(e.VertexAttribute.FEATUREATTRIBUTE),C=m.create();Object.defineProperty(a,"RadiusMode",{enumerable:!0,get:()=>A.RadiusMode});a.HeatmapDensityMaterial=w;a.HeatmapDensityMaterialParameters=t;a.isHeatMapDensityMaterial=function(k){return k instanceof w};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){b.RadiusMode=void 0;(function(t){t[t.Screen=0]="Screen";t[t.World=1]="World"})(b.RadiusMode||(b.RadiusMode={}));h=function(t){function w(){var u=t.apply(this,arguments)||this;u.searchRadius=128;u.resolutionForScale=0;return u}c._inheritsLoose(w,t);return w}(h.MaterialParameters);n=function(t){function w(){return t.apply(this,arguments)||this}c._inheritsLoose(w,t);var u=w.prototype;u.initializeProgram=function(z){return new d.Program(z.rctx,w.shader.get().build(this.configuration),
g.Default3D)};u.initializePipeline=function(){return A.makePipelineState({blending:A.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendOperation.ADD),colorWrite:A.defaultColorWriteParams,depthTest:null,depthWrite:null})};u.destroy=function(){t.prototype.destroy.call(this)};return w}(n.ShaderTechnique);n.shader=new m.ReloadableShaderModule(e.HeatmapDensity,()=>new Promise((t,w)=>a(["./HeatmapDensity.glsl"],t,w)));m=function(t){function w(){var u=t.apply(this,arguments)||this;u.isAttributeDriven=
!1;u.usesHalfFloat=!1;return u}c._inheritsLoose(w,t);return w}(f.DefaultTechniqueConfiguration);r.__decorate([p.parameter()],m.prototype,"isAttributeDriven",void 0);r.__decorate([p.parameter()],m.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=h;b.HeatmapDensityTechnique=n;b.HeatmapDensityTechniqueConfiguration=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n){function p(h){const d=new m.ShaderBuilder,{vertex:f,fragment:e}=d;b.addProjViewLocalOrigin(f,h);const {isAttributeDriven:l,usesHalfFloat:A}=h;d.attributes.add(n.VertexAttribute.POSITION,"vec3");d.attributes.add(n.VertexAttribute.UV0,"vec2");l&&(d.attributes.add(n.VertexAttribute.FEATUREATTRIBUTE,"float"),d.varyings.add("attributeValue","float"));A&&d.constants.add("compressionFactor","float",.25);d.varyings.add("unitCirclePos","vec2");f.uniforms.add(new c.FloatPassUniform("radius",
({resolutionForScale:t,searchRadius:w},{camera:u,screenToWorldRatio:z})=>2*w*(0===t?1:t/z)*u.pixelRatio/u.fullViewport[2]));f.code.add(r.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${n.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${l?r.glsl`attributeValue = ${n.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);e.code.add(r.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${l?r.glsl` * attributeValue`:""} ${A?r.glsl` * compressionFactor`:""};
      gl_FragColor = vec4(density);
    }
  `);return d}const g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=g;a.build=p})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","../../core/maybe","./enums"],function(a,b,c,r){a.loadHeatmapTextureConfiguration=function(m,n){const {textureFloat:p,colorBufferFloat:g}=m.capabilities,h=p?.textureFloat,d=p?.textureFloatLinear;var f=p?.textureHalfFloat;const e=p?.textureHalfFloatLinear,l=p?.HALF_FLOAT,
A=g?.textureFloat;var t=g?.textureHalfFloat;const w=g?.floatBlend;({floatBufferBlendWorking:m}=c.unwrapOrThrow(m.driverTest));if(!h&&!f)throw new b("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!A&&!t)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(w&&m||t))throw new b("heatmap:missing-float-blend",
`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${m?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);f=f&&t;t=!!g?.R32F;const u=!!g?.R16F;if(h&&A&&w&&m&&(d||!e))return d||n.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:r.PixelType.FLOAT,samplingMode:d?r.TextureSamplingMode.LINEAR:r.TextureSamplingMode.NEAREST,pixelFormat:t?r.PixelFormat.RED:r.PixelFormat.RGBA,
internalFormat:t?r.SizedPixelFormat.R32F:r.PixelFormat.RGBA};if(f)return e||n.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),{dataType:l,samplingMode:e?r.TextureSamplingMode.LINEAR:r.TextureSamplingMode.NEAREST,pixelFormat:u?r.PixelFormat.RED:r.PixelFormat.RGBA,internalFormat:u?r.SizedPixelFormat.R16F:r.PixelFormat.RGBA};throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,c,r){a.toViewIfLocal=function(m){const n=m.view.spatialReference,p=m.layer.fullExtent;var g=b.isSome(p)&&p.spatialReference;if(b.isNone(p)||!g)return Promise.resolve(null);if(g.equals(n))return Promise.resolve(p.clone());
g=c.project(p,n);return b.isSome(g)?Promise.resolve(g):m.view.state.isLocal?r.projectGeometry(p,n,m.layer.portalItem).then(h=>!m.destroyed&&h?h:void 0).catch(()=>null):Promise.resolve(null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],
function(a,b,c,r,m){let n=function(){function p(h){this._capabilities=this._memoryCache=null;const d=h.layerView.layer;this._layerView=h.layerView;this.objectIdField=d.objectIdField;this.globalIdField="globalIdField"in d?d.globalIdField:null;this._returnZ=h.returnZ;this._returnM=h.returnM;const f=this._layerView.view.resourceController;this.query=m.createFeatureTileQuery3D(d,e=>f.schedule(e));f&&this._memoryCacheEnabled&&(this._memoryCache=f.memoryController.newCache(d.uid))}var g=p.prototype;g.destroy=
function(){this._memoryCache=c.destroyMaybe(this._memoryCache);this.query.destroy()};g.createQuery=function(){const h=this._layerView.layer.createQuery();h.outFields=this._layerView.availableFields;h.returnZ=this._returnZ;h.returnM=this._returnM;h.outSpatialReference=this.tilingScheme.spatialReference;return h};g.logFetchError=function(h,d){h.error("#fetchTile()",this._layerView.layer,d&&d.message?d.message:d)};b._createClass(p,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;
case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const h=this._layerView.view.resourceController;return h?h.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",
get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return c.isSome(this._capabilities)?this._capabilities:this._capabilities=r.contextCapabilitiesFromLayer(this._layerView.layer)}}]);return p}();a.FeatureTileFetcher3DLayerViewContext=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){let A=function(z){function y(C){return z.call(this,C)||this}b._inheritsLoose(y,z);var B=y.prototype;B.queryFeatureCount=function(C,k){return this.layer.queryFeatureCount(C,k)};B.destroy=function(){this._decoder=m.destroyMaybe(this._decoder)};B._createRequestOptions=function(C){return{...C,query:{...this.layer.customParameters,token:this.layer.apiKey,...C?.query}}};b._createClass(y,[{key:"queryFeaturesDehydrated",get:function(){var C=this.layer.capabilities;if((C=
C&&C.query)&&C.supportsFormatPBF){m.isNone(this._decoder)&&(this._decoder=new l.PBFDecoder(this.schedule));const k={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(q,x)=>e.runQuery(this.layer.parsedUrl,q,"pbf",this._createRequestOptions(x)).then(v=>{n.throwIfAborted(x);return m.isSome(this._decoder)?this._decoder.invoke({buffer:v.data,options:k},x.signal):Promise.reject(n.createAbortError())})}return(k,q)=>e.executeQuery(this.layer.parsedUrl,
k,this.layer.spatialReference,this._createRequestOptions(q)).then(x=>f.fromFeatureSetJSON(x.data))}}]);return y}(r);c.__decorate([p.property({constructOnly:!0})],A.prototype,"layer",void 0);c.__decorate([p.property({constructOnly:!0})],A.prototype,"schedule",void 0);c.__decorate([p.property({readOnly:!0})],A.prototype,"queryFeaturesDehydrated",null);A=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],A);let t=function(z){function y(C){return z.call(this,
C)||this}b._inheritsLoose(y,z);var B=y.prototype;B.queryFeaturesDehydrated=function(C,k){return this.layer.queryFeatures(C,k)};B.queryFeatureCount=function(C,k){return this.layer.queryFeatureCount(C,k)};return y}(r);c.__decorate([p.property({constructOnly:!0})],t.prototype,"layer",void 0);c.__decorate([p.property({readOnly:!0})],t.prototype,"queryFeaturesDehydrated",null);t=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],t);let w=function(z){function y(B){return z.call(this,
B)||this}b._inheritsLoose(y,z);y.prototype.queryFeaturesDehydrated=function(B,C){return this.layer.queryFeatures(B,C)};return y}(r);c.__decorate([p.property({constructOnly:!0})],w.prototype,"layer",void 0);w=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],w);let u=function(z){function y(C){return z.call(this,C)||this}b._inheritsLoose(y,z);var B=y.prototype;B.queryFeaturesDehydrated=function(C,k){return this.source.queryFeaturesJSON(C,k).then(f.fromFeatureSetJSON,
q=>{if(q&&"query-features-json:unsupported"===q.name)return this.layer.queryFeatures(C,k);throw q;})};B.queryFeatureCount=function(C,k){return this.layer.queryFeatureCount(C,k)};return y}(r);c.__decorate([p.property({constructOnly:!0})],u.prototype,"layer",void 0);c.__decorate([p.property({constructOnly:!0})],u.prototype,"source",void 0);u=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],u);a.createFeatureTileQuery3D=function(z,y){return"feature"===
z.type&&"feature-layer"===z.source.type?m.isSome(z.infoFor3D)?new t({layer:z}):new A({layer:z,schedule:y}):"feature"===z.type&&"memory"===z.source.type||"csv"===z.type||"geojson"===z.type||"oriented-imagery"===z.type||"wfs"===z.type?new u({layer:z,source:z.source}):"ogc-feature"===z.type?new w({layer:z}):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,c,r,m,n,p){let g=function(){function d(e){this._schedule=e;this._handle=new h(e)}var f=d.prototype;f.destroy=function(){this._handle.destroy()};f.invoke=function(e,l){if(!e.buffer||0===e.buffer.byteLength)return Promise.resolve(null);e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof n&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()});return this._handle.invoke(e,l).then(A=>this._schedule(()=>{A.spatialReference=n.fromJSON(A.spatialReference);
if(A.fields)for(var t=0;t<A.fields.length;t++)A.fields[t]=p.fromJSON(A.fields[t]);t=A.spatialReference;for(const w of A.features)w.uid=c.generateUID(),r.isSome(w.geometry)&&(w.geometry.spatialReference=t);return A}))};return d}(),h=function(d){function f(e){return d.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:l=>[l.buffer]},e)||this}b._inheritsLoose(f,d);return f}(m.WorkerHandle);a.PBFDecoder=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,c,r,m){c=function(n){function p(){var h=n.apply(this,arguments)||this;h._set=new Set;return h}b._inheritsLoose(p,n);var g=p.prototype;g.clear=function(){if(0<this._set.size){const h=this.toArray();this._set.clear();this.emit("after-changes",{type:r.ObservableChangesType.REMOVE});this.emit("change",
{added:[],removed:h})}};g.addMany=function(h){if(0!==h.length){for(const d of h)this._set.add(d);this.emit("after-changes",{type:r.ObservableChangesType.ADD});this.emit("change",{added:h,removed:[]})}};g.remove=function(h){this._set.delete(h)&&(this.emit("after-changes",{type:r.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[h]}))};g.removeMany=function(h){const d=[];for(const f of h)this._set.delete(f)&&d.push(f);0<d.length&&(this.emit("after-changes",{type:r.ObservableChangesType.REMOVE}),
this.emit("change",{added:[],removed:d}))};g.toArray=function(){return[...this._set]};g.find=function(h){let d;m.someSet(this._set,f=>h(f)?(d=f,!0):!1);return d};g.forEach=function(h){this._set.forEach(d=>h(d))};b._createClass(p,[{key:"length",get:function(){return this._set.size}}]);return p}(c);a.EventedSet=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){const B=r.getLogger("esri.views.layers.FeatureLayerView");return C=>{C=function(k){function q(...v){v=k.call(this,...v)||this;v._updatingRequiredFieldsPromise=null;v.filter=null;v.timeExtent=null;v.layer=null;v.requiredFields=[];v.view=null;return v}a._inheritsLoose(q,k);var x=q.prototype;x.initialize=function(){this.handles.add([p.watch(()=>{const v=this.layer;return[v?.elevationInfo?.featureExpressionInfo,v&&"displayField"in v?v.displayField:null,
v?.timeInfo,v&&"renderer"in v&&v.renderer,v&&"labelingInfo"in v&&v.labelingInfo,v&&"floorInfo"in v&&v.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),p.syncAndInitial),p.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),p.on(()=>{const v=this.layer;return v&&"sublayers"in v&&v.sublayers},"change",()=>this._handleRequiredFieldsChange())])};x.highlight=function(v){throw Error("missing implementation");};x.createQuery=function(){var v=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};v=m.isSome(this.filter)?this.filter.createQuery(v):new u(v);if("feature"===this.layer.type){const D=w.getFloorFilterClause(this);m.isSome(D)&&(v.where=v.where?`(${v.where}) AND (${D})`:D)}m.isSome(this.timeExtent)&&(v.timeExtent=m.isSome(v.timeExtent)?v.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return v};x.createAggregateQuery=function(){return new u({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})};
x.queryFeatures=function(v,D){throw Error("missing implementation");};x.queryObjectIds=function(v,D){throw Error("missing implementation");};x.queryFeatureCount=function(v,D){throw Error("missing implementation");};x.queryExtent=function(v,D){throw Error("missing implementation");};x.fetchPopupFeatures=function(){var v=a._asyncToGenerator(function*(D,F){if(D=this.validateFetchPopupFeatures(F))throw D;return this.fetchClientPopupFeatures(F)});return function(D,F){return v.apply(this,arguments)}}();
x._loadArcadeModules=function(v){if(v.get("expressionInfos.length")||Array.isArray(v.content)&&v.content.some(D=>"expression"===D.type))return z.loadArcade()};x._handleRequiredFieldsChange=function(){const v=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",v);v.then(()=>{this._updatingRequiredFieldsPromise===v&&this._set("_updatingRequiredFieldsPromise",null)})};x._updateRequiredFields=function(){var v=a._asyncToGenerator(function*(){if(this.layer&&this.view){var D="3d"===this.view.type,
{layer:F,layer:{fieldsIndex:G,objectIdField:J}}=this,L="renderer"in F&&F.renderer,K="orderBy"in F&&F.orderBy,O="featureReduction"in F?F.featureReduction:null,P=new Set;L=yield n.eachAlways([L?L.collectRequiredFields(P,G):null,t.collectLabelingFields(P,F),D?t.collectElevationFields(P,F):null,m.isSome(this.filter)?t.collectFilterFields(P,F,this.filter):null,m.isSome(this.featureEffect)?t.collectFilterFields(P,F,this.featureEffect.filter):null,O?t.collectFeatureReductionFields(P,F,O):null,K?t.collectOrderByInfos(P,
F,K):null]);F.timeInfo&&this.timeExtent&&t.collectFields(P,F.fieldsIndex,[F.timeInfo.startField,F.timeInfo.endField]);"feature"===F.type&&(F.floorInfo&&t.collectFields(P,F.fieldsIndex,[F.floorInfo.floorField]),D&&m.isSome(F.infoFor3D)&&(null==F.globalIdField&&B.error("globalIdField missing on 3DObjectFeatureLayer"),t.collectFields(P,F.fieldsIndex,[F.globalIdField])));"subtype-group"===F.type&&(t.collectField(P,G,F.subtypeField),K=F.sublayers.map(N=>Promise.all([N.renderer?.collectRequiredFields(P,
G),t.collectLabelingFields(P,N)])),yield n.eachAlways(K));for(const N of L)N.error&&B.error(N.error);t.collectField(P,G,J);D&&"displayField"in F&&F.displayField&&t.collectField(P,G,F.displayField);D=Array.from(P).sort();this._set("requiredFields",D)}});return function(){return v.apply(this,arguments)}}();x.validateFetchPopupFeatures=function(v){if(m.isNone(v))return null;for(const D of v.clientGraphics){const F=D.layer;if("popupEnabled"in F&&!F.popupEnabled)return new c("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:F});if(D.isAggregate){const G="featureReduction"in F?F.featureReduction:null;if(!(G&&"popupTemplate"in G&&G.popupEnabled&&G.popupTemplate))return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:F})}else if("popupTemplate"in F&&!y.getFetchPopupTemplate(F,v))return new c("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:F})}};x.fetchClientPopupFeatures=function(){var v=a._asyncToGenerator(function*(D){const F=
m.isSome(D)?D.clientGraphics:null;if(!F||0===F.length)return[];const G=Array(F.length),J=new Map,L=yield this.createPopupQuery(D);for(let O=0;O<F.length;O++){const P=F[O];if(P.isAggregate){G[O]=P;continue}var {layer:K}=P;if(!("popupEnabled"in K))continue;const N=t.unpackFieldNames(this.layer.fieldsIndex,L.outFields);K=y.getFetchPopupTemplate(K,D);if(m.isNone(K))continue;const H=yield this._loadArcadeModules(K);H&&H.arcadeUtils.hasGeometryOperations(K)||!t.featureHasFields(N,P)?J.set(P.getObjectId(),
O):G[O]=P}if("stream"===this.layer.type||0===J.size)return G.filter(Boolean);L.objectIds=Array.from(J.keys());try{const O=yield this.layer.queryFeatures(L);for(const P of O.features){const N=J.get(P.getObjectId());G[N]=P}}catch{}return G.filter(Boolean)});return function(D){return v.apply(this,arguments)}}();x.createPopupQuery=function(){var v=a._asyncToGenerator(function*(D){const F=this.layer.createQuery(),G=new Set;var J=!1,L=m.isSome(D)&&D.clientGraphics?D.clientGraphics.map(K=>K.layer):[this.layer];
for(const K of L)if("popupEnabled"in K&&(L=y.getFetchPopupTemplate(K,D),!m.isNone(L))){J=(J=yield this._loadArcadeModules(L))&&J.arcadeUtils.hasGeometryOperations(L);J=!("point"!==this.layer.geometryType&&!J);L=yield y.getRequiredFields(this.layer,L);for(const O of L)G.add(O)}F.returnGeometry=J;F.returnZ=J;F.returnM=J;F.outFields=Array.from(G);F.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(D=w.getFloorFilterClause(this),m.isSome(D)&&(F.where=F.where?`(${F.where}) AND (${D})`:
D));return F});return function(D){return v.apply(this,arguments)}}();x.canResume=function(){return!k.prototype.canResume.call(this)||m.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};a._createClass(q,[{key:"availableFields",get:function(){const {layer:v,layer:{fieldsIndex:D},requiredFields:F}=this;return"outFields"in v&&v.outFields?t.fixFields(D,[...t.unpackFieldNames(D,v.outFields),...F]):t.fixFields(D,F)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?
this.layer.featureEffect:null},set:function(v){this._override("featureEffect",v)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(v){B.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return q}(C);b.__decorate([g.property()],C.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([g.property({readOnly:!0})],C.prototype,"availableFields",null);b.__decorate([g.property({type:l})],
C.prototype,"featureEffect",null);b.__decorate([g.property({type:A})],C.prototype,"filter",void 0);b.__decorate([g.property(e.combinedViewLayerTimeExtentProperty)],C.prototype,"timeExtent",void 0);b.__decorate([g.property()],C.prototype,"layer",void 0);b.__decorate([g.property({type:Number})],C.prototype,"maximumNumberOfFeatures",null);b.__decorate([g.property({readOnly:!0,type:Boolean})],C.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([g.property({readOnly:!0})],C.prototype,"requiredFields",
void 0);b.__decorate([g.property()],C.prototype,"suspended",void 0);b.__decorate([g.property()],C.prototype,"view",void 0);return C=b.__decorate([f.subclass("esri.views.layers.FeatureLayerView")],C)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g,h){return d=>{d=function(f){function e(){return f.apply(this,arguments)||this}a._inheritsLoose(e,f);e.prototype.initialize=function(){this.handles.add(m.on(()=>this.layer,"refresh",l=>{this.doRefresh(l.dataChanged).catch(A=>{r.isAbortError(A)||c.getLogger(this.declaredClass).error(A)})}),"RefreshableLayerView")};return e}(d);b.__decorate([n.property()],d.prototype,"layer",void 0);return d=b.__decorate([h.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../core/has ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba){const ia=C.create();l=function(ha){function ka(){var ca=ha.apply(this,arguments)||this;ca.type="point-cloud-3d";ca.maximumPointCount=4E6;ca.slicePlaneEnabled=!1;ca._renderer=null;ca._rendererAdded=!1;ca._renderedNodes=new Set;ca._nodeScales=new Map;ca._updateViewNeeded=!0;ca._lodFactor=1;ca._maxLoggedBoxWarnings=5;ca._pageMultiplier=1;ca._nodeLoadEpoch=0;ca._indexQueue=[];ca._workQueue=[];
ca._idleQueue=new L.PromiseQueue;ca._indexPagesLoading=new Map;ca._loadingNodes=new Map;ca._recalcWork=!0;ca._layerIsVisible=!1;ca._codedDomainPopulationPromise=null;ca._codedDomainPopulationAbortController=null;ca._totalWork=0;ca._index=null;ca._loadingInitNodePage=!1;ca._nodeIdArray=[];return ca}a._inheritsLoose(ka,ha);var Z=ka.prototype;Z.initialize=function(){const ca=this.view.resourceController;this._worker=new P.PointCloudWorkerHandle(da=>ca.schedule(da));this.addResolvingPromise(this._worker.promise);
this._tmpPoint=k.makeDehydratedPoint(0,0,0,this.layer.spatialReference);N.checkPointCloudLayerValid(this.layer);N.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=ca.createStreamDataRequester(Y.ClientType.I3S_INDEX);this._dataRequester=ca.createStreamDataRequester(Y.ClientType.I3S_DATA);this._initRenderer();const fa=this._initNodePages(),ea=this.view.resourceController.memoryController;this._memCache=ea.newCache(this.layer.uid);this.updatingHandles.add(()=>this._clippingBox,
()=>this._setUpdateViewNeeded(),g.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),g.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),g.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),g.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),g.initial);this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this.updatingHandles.add(()=>
this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",da=>this._scaleUpdateHandler(da)),g.watch(()=>ea.memoryFactor,()=>this._setUpdateViewNeeded(),g.sync)]);this.addResolvingPromise(fa);this.when(()=>{this.handles.add([ca.scheduler.registerTask(ba.TaskPriority.POINT_CLOUD_LAYER,this),ca.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,da=>{da?this._clearNodeState():
this._setUpdateViewNeeded()},g.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};Z._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};Z.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);
this._codedDomainPopulationPromise=null};Z._initRenderer=function(){this._renderer=new T.PointRenderer({createGraphic:(ca,fa,ea)=>this._createGraphic(ca,fa,ea)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,ca=>this._renderer.clippingBox=ca,g.initial);this.updatingHandles.add(()=>this.suspended,ca=>this._setPointsVisible(!ca),g.initial);this.updatingHandles.add(()=>this.pointScale,ca=>this._renderer.scaleFactor=ca,g.initial);this._renderer.minSizePx=Math.sqrt(2);
this.updatingHandles.add(()=>this.useRealWorldSymbolSizes,ca=>this._renderer.useRealWorldSymbolSizes=ca,g.initial);this.updatingHandles.add(()=>this.pointSize,ca=>{const fa=h.pt2px(ca);this._renderer.size=ca;this._renderer.sizePx=fa},g.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,ca=>this._renderer.slicePlaneEnabled=ca,g.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),g.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),
g.initial);this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,ca=>{this._lodFactor=ca;this._setUpdateViewNeeded()},g.initial)};Z._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};Z._createGraphic=function(ca,fa,ea){const da=n.isSome(ca.pointIdFilterMap)?ca.pointIdFilterMap[fa]:fa;ea=this.view.computeMapPointFromVec3d(ea);const la=this._createGraphicAttributes(ca,da);return new Q.PointGraphic({pointCloudMetadata:{nodeId:ca.id,pointIndexInNode:fa,
attributePointIndexInNode:da,epoch:this._nodeLoadEpoch},geometry:ea,attributes:la,layer:this.layer,sourceLayer:this.layer})};Z._createGraphicAttributes=function(ca,fa){const ea={};for(const da of ca.attributes)this._encodeGraphicAttribute(da.attributeInfo,da.values,fa,ea);return ea};Z._encodeGraphicAttribute=function(ca,fa,ea,da){var la=ca.storageInfo&&ca.storageInfo.attributeValues;const oa=la?la.valuesPerElement:1;if(1===oa)da[ca.name]=fa[ea];else if("UInt8"===la.valueType&&4>=oa){la=0;ea*=oa;for(let ra=
ea;ra<ea+oa;ra++)la=(la<<8)+fa[ra];da[ca.name]=la}else da[ca.name]=void 0};Z._setPointsVisible=function(ca){ca&&!this._rendererAdded?(this.view._stage.addRenderPlugin([X.RenderSlot.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!ca&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};Z._rendererChanged=function(){this._renderer.useFixedSizes=I.rendererUsesFixedSizes(this.layer.renderer);this._reload()};Z._reload=function(){this._clearNodeState();
this._memCache.clear();this._setUpdateViewNeeded()};Z._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};Z._scaleUpdateHandler=function(ca){const fa=this.layer.effectiveScaleRange;aa.isScaleRangeActive(fa.minScale,fa.maxScale)?z.projectBoundingRect(ca.extent,ca.spatialReference,ma,this.layer.spatialReference)&&(this._nodeScales.forEach((ea,da)=>{this._renderedNodes.has(da)?(ea=this._index.getNode(da),B.containsPoint(ma,ea.obb.center)&&this._nodeScales.set(da,
ca.scale)):this._nodeScales.delete(da)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};Z._displayNodes=function(ca){this._workQueue=H.nodeDiff([...this._renderedNodes],ca,this._index);H.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);H.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<ca.length||this._loadingInitNodePage;this.notifyChange("suspended")};
Z.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};Z._cancelNodeLoading=function(){const ca=[];this._loadingNodes.forEach(({abortController:fa})=>ca.push(fa));this._loadingNodes.clear();for(const fa of ca)fa.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};Z._updateQueues=function(){const ca=new Set;this._workQueue.forEach(da=>da.load.forEach(la=>ca.add(la)));const fa=[],ea=new Map;this._loadingNodes.forEach((da,
la)=>{ca.has(la)?ea.set(la,da):fa.push(da)});this._loadingNodes=ea;for(const {abortController:da}of fa)da.abort();this._workQueue=this._workQueue.filter(da=>{for(const la of da.load)if(this._loadingNodes.has(la))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};Z._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:ca})=>ca.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();
this._updateLoading()};Z._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(ca=>this._removeFromRenderer(ca));this._cancelNodeLoading()};Z._idleBegin=function(){this._setUpdateViewNeeded()};Z._idleEnd=function(){this._setUpdateViewNeeded()};Z.runTask=function(ca){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,ca=this._isRootNodeVisible(),ca!==this._layerIsVisible&&(this._layerIsVisible=ca,this.notifyChange("suspended")),this._updateLoading());else{for(ca.run(()=>
this._updateWorkQueues());0<this._indexQueue.length&&ca.run(()=>this._processIndexQueue()););this._processWorkQueue(ca);this._idleQueue.runTask(ca)}};Z._processIndexQueue=function(){const ca=this._indexQueue.shift(),fa=this._loadNodePage(ca);this._indexPagesLoading.set(ca,fa);fa.promise.then(ea=>{this._index.addPage(ca,ea,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(ca)},()=>{this._indexPagesLoading.delete(ca)});return!0};Z._processWorkQueue=function(ca){for(;!ca.done;){const fa=
this._scheduleWorkEntry();if(n.isNone(fa))break;this._processWorkEntry(fa);ca.madeProgress()}};Z._scheduleWorkEntry=function(){let ca=this._workQueue.length;for(;ca--;){const fa=this._workQueue.shift();if(fa.remove.find(ea=>!this._renderedNodes.has(ea)))this._workQueue.push(fa);else return fa}return null};Z._processWorkEntry=function(ca){if(0===ca.load.length)for(const fa of ca.remove)this._removeFromRenderer(fa);else Promise.all(ca.load.map(fa=>{const ea=new AbortController,da=this._memCache.pop(fa.toString());
n.isSome(da)?this._loadingNodes.set(fa,{abortController:ea,promise:Promise.resolve(da)}):this._loadingNodes.has(fa)||this._loadingNodes.set(fa,{abortController:ea,promise:this._loadNode(fa,ea.signal)});return this._loadingNodes.get(fa).promise})).then(fa=>{for(let ea=0;ea<ca.load.length;ea++)if(fa[ea]){const da=this._setupRendererData(ca.load[ea],fa[ea]);this._addToRenderer(da)}for(const ea of ca.remove)this._removeFromRenderer(ea)}).catch(()=>{}).then(()=>{for(const fa of ca.load)this._loadingNodes.delete(fa);
this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};Z._populateClassCodeCodedDomain=function(){var ca=a._asyncToGenerator(function*(fa,ea){const da=this.layer.fieldsIndex.get("CLASS_CODE");da&&!da.domain&&fa.includes(da.name)&&(fa=yield c.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ea})),!1!==fa.ok&&(fa=(fa=fa.value)&&fa.labels&&fa.labels.labels)&&
Array.isArray(fa)&&(da.domain=new v({name:"CLASS_CODE",codedValues:fa.map(la=>new q.CodedValue({code:la.value,name:la.label}))})))});return function(fa,ea){return ca.apply(this,arguments)}}();Z.prepareFetchPopupFeatures=function(){var ca=a._asyncToGenerator(function*(fa){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(fa,this._codedDomainPopulationAbortController.signal).then(()=>
{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise});return function(fa){return ca.apply(this,arguments)}}();Z.whenGraphicAttributes=function(){var ca=a._asyncToGenerator(function*(fa,ea){var da=this;const la=this._splitGraphicsPerNode(fa),oa=this.layer.attributeStorageInfo,ra=ea.map(za=>I.getAttributeInfo(oa,za)),Aa=function(){var za=a._asyncToGenerator(function*(va,Ja){const pa=da._index.getNode(Ja);yield c.forEach(ra,function(){var Ba=a._asyncToGenerator(function*(Ha){const wa=
Ha.useElevation?yield da._loadElevationAttributeFromGeometry(pa.resourceId):yield da._loadAndParseAttribute(pa,Ha);if(wa)for(const ya of va)da._isValidPointGraphic(ya)&&da._encodeGraphicAttribute(Ha,wa,ya.pointCloudMetadata.attributePointIndexInNode,ya.attributes)});return function(Ha){return Ba.apply(this,arguments)}}())});return function(va,Ja){return za.apply(this,arguments)}}(),ua=[];la.forEach((za,va)=>{ua.push(Aa(za,va))});yield p.eachAlways(ua);return fa});return function(fa,ea){return ca.apply(this,
arguments)}}();Z._isValidPointGraphic=function(ca){return ca instanceof Q.PointGraphic&&ca.pointCloudMetadata&&ca.pointCloudMetadata.epoch===this._nodeLoadEpoch};Z._splitGraphicsPerNode=function(ca){const fa=new Map;for(const ea of ca){if(!this._isValidPointGraphic(ea))continue;ca=ea.pointCloudMetadata;const da=fa.get(ca.nodeId);da?da.push(ea):fa.set(ca.nodeId,[ea])}return fa};Z._loadAndParseAttribute=function(){var ca=a._asyncToGenerator(function*(fa,ea){const da=yield this._loadAttribute(fa.resourceId,
ea,null);return n.isSome(da)?M.getAttributeValues({attributeInfo:ea,buffer:da},null,fa.vertexCount):null});return function(fa,ea){return ca.apply(this,arguments)}}();Z._loadElevationAttributeFromGeometry=function(){var ca=a._asyncToGenerator(function*(fa){fa=M.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(fa,null));return M.elevationFromPositions(fa,fa.length/3)});return function(fa){return ca.apply(this,arguments)}}();Z.highlight=function(ca){if(!ca)return{remove(){}};
ca=r.isCollection(ca)?ca.toArray():Array.isArray(ca)?ca:[ca];return this._renderer.highlight(ca.map(fa=>this._graphicToPointDefinition(fa)))};Z._graphicToPointDefinition=function(ca){if(!this._isValidPointGraphic(ca))return null;const {nodeId:fa,pointIndexInNode:ea}=ca.pointCloudMetadata;return null!=fa&&null!=ea?{nodeId:fa,pointId:ea}:null};Z._computeWork=function(){let ca=0;for(const fa of this._workQueue)ca+=fa.load.length+fa.remove.length;ca+=this._loadingNodes.size;ca+=(this._indexQueue.length+
this._indexPagesLoading.size)*this._index.pageSize;ca+=this._loadingInitNodePage?100:0;return ca+=this._updateViewNeeded?100:0};Z._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};Z.canResume=function(){return ha.prototype.canResume.call(this)&&this._layerIsVisible};Z.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};Z._initNodePages=function(){const ca=this.layer.store.index;this._index=new E(this.layer.spatialReference,
this.view.renderCoordsHelper.spatialReference,ca.nodesPerPage||ca.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=ca.nodesPerPage?1:ca.nodePerIndexBlock;return this._loadNodePage(0).promise.then(fa=>{this._index.addPage(0,fa,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};Z._loadNodePage=
function(ca){const fa=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${ca*this._pageMultiplier}`,fa.signal).then(ea=>ea.nodes.map((da,la)=>({resourceId:null!=da.resourceId?da.resourceId:ca*this._index.pageSize+la,obb:da.obb,firstChild:da.firstChild,childCount:da.childCount,vertexCount:null!=da.vertexCount?da.vertexCount:da.pointCount,lodThreshold:null!=da.lodThreshold?da.lodThreshold:da.effectiveArea}))),abortController:fa}};Z._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;
let ca=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const fa=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let ea=this._computeNodesForMinimumDensity(ca),da=this._computePointCount(ea),la=Math.sqrt(da/(.75*fa));for(;da>fa;)ca*=la,ea=this._computeNodesForMinimumDensity(ca),da=this._computePointCount(ea),la=Math.sqrt(2);this._displayNodes(ea);this._updateViewNeeded=!1;this._updateLoading();return!0};Z._computePointCount=function(ca){let fa=0;for(let ea=0;ea<ca.length;ea++){const da=
this._index.getNode(ca[ea]);da&&(fa+=da.vertexCount)}return fa};Z._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};Z._isRootNodeVisible=function(){let ca=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(fa,ea,da)=>{ca=da;return!1},pageMiss:()=>{}});return ca};Z._computeNodesForMinimumDensity=function(ca){const fa=this.view.state.contentCamera,ea=fa.frustum,da=this._clippingBox,la=fa.viewForward,
oa=w.dot(la,fa.eye),ra=C.fromNormalAndOffset(la,-oa,ia),Aa=fa.perScreenPixelRatio/2,ua=ca*ca,za=this._nodeIdArray;za.length=0;const {minScale:va,maxScale:Ja}=aa.extractSafeScaleBounds(this.layer),pa=0===va&&0===Ja?Ba=>za.push(Ba):Ba=>{const Ha=this._getScale(Ba);aa.scaleBoundsPredicate(Ha,va,Ja)&&za.push(Ba)};this._traverseVisible({frustum:ea,clippingBox:da},{predicate:(Ba,Ha,wa)=>{if(!wa)return!1;if(0===Ha.childCount)return pa(Ba),!1;wa=this._index.getRenderObb(Ba);return this._computeAveragePixelArea(wa,
Ha.lodThreshold,Ha.vertexCount,ra,Aa)<=ua?(pa(Ba),!1):!0},pageMiss:(Ba,Ha)=>{pa(Ba);this._indexQueue.includes(Ha)||this._indexQueue.push(Ha)}});return za};Z._getScale=function(ca){var fa=this._nodeScales.get(ca);null==fa&&(fa=this._index.getNode(ca).obb.center,this._tmpPoint.x=fa[0],this._tmpPoint.y=fa[1],this._tmpPoint.z=fa[2],fa=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(ca,fa));return fa};Z._computeAveragePixelArea=function(ca,fa,ea,da,la){ca=Math.max(1E-7,V.minimumDistancePlane(ca,
da));return fa/(ca*ca)/(4*la*la)/ea};Z._loadNode=function(ca,fa){try{return this._loadNodeAsync(ca,fa)}catch(ea){throw p.isAbortError(ea)||m.getLogger(this.declaredClass).error(ea),ea;}};Z._loadAdditionalUserAttributes=function(){var ca=a._asyncToGenerator(function*(fa,ea,da){var la=this.layer.outFields;if(!la)return[];la=J.unpackFieldNames(this.layer.fieldsIndex,la);fa=new Set(fa.map(Aa=>n.isSome(Aa)?Aa.name:null));const oa=this.layer.attributeStorageInfo,ra=[];for(const Aa of la)fa.has(Aa)||(la=
I.getAttributeInfo(oa,Aa))&&ra.push(ea(la));ea=yield p.eachAlwaysValues(ra);p.throwIfAborted(da);return n.mapSome(ea,Aa=>Aa)});return function(fa,ea,da){return ca.apply(this,arguments)}}();Z._loadNodeAsync=function(){var ca=a._asyncToGenerator(function*(fa,ea){var da=this;const la=this._index.getNode(fa),oa=I.getRendererInfo(this.layer),ra=I.getFilterInfo(this.layer),Aa=la.resourceId,ua=function(){var za=a._asyncToGenerator(function*(va){if(n.isNone(va))return null;if(va.useElevation)return{attributeInfo:va,
buffer:null};const Ja=yield da._loadAttribute(Aa,va,ea);return n.isSome(Ja)?{attributeInfo:va,buffer:Ja}:null});return function(va){return za.apply(this,arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var za=da._loadGeometry(Aa,ea);const {primaryAttribute:va,modulationAttribute:Ja}=oa,pa=ua(va),Ba=ua(Ja);var Ha=ra.map(Ta=>Ta.attributeInfo);const wa=Ha.map(Ta=>ua(Ta));Ha=da._loadAdditionalUserAttributes([va,Ja,...Ha],ua,ea);const [ya,Na,Ra,Sa,ja]=yield Promise.all([za,pa,
Ba,Promise.all(wa),Ha]);p.throwIfAborted(ea);za={geometryBuffer:ya,primaryAttributeData:Na,modulationAttributeData:Ra,filterAttributesData:Sa,userAttributesData:ja,schema:da.layer.store.defaultGeometrySchema,rendererInfo:oa,filterInfo:ra,obb:da._index.getRenderObb(fa),elevationOffset:da._elevationOffset,inSR:da.layer.spatialReference.toJSON(),outSR:da.view.renderCoordsHelper.spatialReference.toJSON()};return da._worker.invoke(za,ea)}),ea)});return function(fa,ea){return ca.apply(this,arguments)}}();
Z._loadGeometry=function(){var ca=a._asyncToGenerator(function*(fa,ea){return this._requestData(`${this.baseUrl}/nodes/${fa}/geometries/0`,ea)});return function(fa,ea){return ca.apply(this,arguments)}}();Z._loadAttribute=function(){var ca=a._asyncToGenerator(function*(fa,ea,da){return n.isNone(ea)||!ea.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${fa}/attributes/${ea.storageInfo.key}`,da)});return function(fa,ea,da){return ca.apply(this,arguments)}}();Z._requestNodePage=function(ca,
fa){return this._indexRequester.request(ca,"json",{query:{f:"json",token:this.layer.apiKey},signal:fa})};Z._requestData=function(ca,fa){return this._dataRequester.request(ca,"binary",{query:{token:this.layer.apiKey},signal:fa})};Z._removeFromRenderer=function(ca){if(this._renderedNodes.has(ca)){const fa=this._renderer.removeNode(ca);this._renderedNodes.delete(ca);this._nodeScales.delete(ca);this._memCache.put(fa.id.toString(),fa,5*fa.coordinates.length+128)}};Z._addToRenderer=function(ca){this._renderedNodes.has(ca.id)||
(this._renderedNodes.add(ca.id),this._renderer.addNode(ca))};Z._setupRendererData=function(ca,fa){const ea=this._index.getNode(ca),da=Math.sqrt(ea.lodThreshold/ea.vertexCount),la=this._index.getRenderObb(ca);if(T.isInstanceOfNode(fa))return fa.splatSize=da,fa.obb=la,w.copy(fa.origin,fa.obb.center),fa;var oa=.01*Math.max(la.halfSize[0],la.halfSize[1],la.halfSize[2]);if(fa.obb.halfSize[0]>la.halfSize[0]+oa||fa.obb.halfSize[1]>la.halfSize[1]+oa||fa.obb.halfSize[2]>la.halfSize[2]+oa)0<this._maxLoggedBoxWarnings&&
(oa=ra=>`[${ra.halfSize[0]}, ${ra.halfSize[1]}, ${ra.halfSize[2]}]`,m.getLogger(this.declaredClass).warn(`Node ${ca} reported bounding box too small. got ${oa(la)} but points cover ${oa(fa.obb)}`),0===--this._maxLoggedBoxWarnings&&m.getLogger(this.declaredClass).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(ca,fa.obb);return new T.PointRendererNode(ca,da,u.clone(la.center),la,0===ea.childCount,fa.points,fa.rgb,fa.attributes,fa.pointIdFilterMap)};
Z.getUsedMemory=function(){let ca=0;this._renderer.forEachNode(fa=>{ca+=160;ca+=d.estimateSize(fa.coordinates);for(const ea of fa.attributes)fa=ea.values,d.isArrayBuffer(fa.buffer)&&(ca+=d.estimateSize(fa))});return ca};Z.getUnloadedMemory=function(){var ca=this._renderedNodes.size;if(4>ca)return 0;const fa=[...this._renderedNodes].reduce((la,oa)=>la+this._index.getNode(oa).vertexCount);let ea=this._loadingNodes.size;for(var da=0;da<this._workQueue.length;da++)ea+=this._workQueue[da].load.length,
ea-=this._workQueue[da].remove.length;if(0>ea)return 0;da=ea*fa/ca;ca=(this.getUsedMemory()-160*ca)/fa;return da*ca+160*ea};Z.ignoresMemoryFactor=function(){return!1};a._createClass(ka,[{key:"baseUrl",get:function(){return this.layer.parsedUrl.path}},{key:"pointScale",get:function(){const ca=I.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return ca&&null!=ca.scaleFactor?ca.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const ca=I.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);
return ca&&null!=ca.useRealWorldSymbolSizes?ca.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const ca=I.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return ca&&null!=ca.size?ca.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var ca=I.getRendererInfo(this.layer);const fa=new Set;ca.primaryAttribute&&fa.add(ca.primaryAttribute.name);ca.modulationAttribute&&fa.add(ca.primaryAttribute.name);
if(ca=I.getFilterInfo(this.layer))for(const ea of ca)fa.add(ea.attributeInfo.name);if(this.layer.outFields)for(const ea of J.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))fa.add(ea);return Array.from(fa)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const ca=y.create();return U.projectToBoundingBox(this.view.clippingArea,ca,this.view.renderSpatialReference)?ca:null}},{key:"_elevationOffset",get:function(){const ca=this.layer&&this.layer.elevationInfo;
if(ca&&"absolute-height"===ca.mode){const fa=f.getMetersPerVerticalUnitForSR(this.layer.spatialReference),ea=K.getMetersPerUnit(ca.unit);return n.unwrapOr(ca.offset,0)*ea/fa}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const ca=this._computeWork();return 1-Math.min(this._totalWork,
ca)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((ca,fa)=>ca+this._index.getNode(fa).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);
return ka}(S.PopupSceneLayerView(O.LayerView3D(W)));b.__decorate([e.property()],l.prototype,"layer",void 0);b.__decorate([e.property()],l.prototype,"baseUrl",null);b.__decorate([e.property()],l.prototype,"pointScale",null);b.__decorate([e.property()],l.prototype,"useRealWorldSymbolSizes",null);b.__decorate([e.property()],l.prototype,"pointSize",null);b.__decorate([e.property()],l.prototype,"inverseDensity",null);b.__decorate([e.property()],l.prototype,"maximumPointCount",void 0);b.__decorate([e.property({readOnly:!0})],
l.prototype,"availableFields",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"_clippingBox",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"_elevationOffset",null);b.__decorate([e.property({type:Boolean})],l.prototype,"slicePlaneEnabled",void 0);b.__decorate([e.property()],l.prototype,"updating",void 0);b.__decorate([e.property(R.updatingProgress)],l.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"updatingProgressValue",null);b=l=
b.__decorate([t.subclass("esri.views.3d.layers.PointCloudLayerView3D")],l);const ma=B.create();return b})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,b,c,r){r=function(m){function n(p){var g;return g=m.call(this,"PointCloudWorker","transform",{transform:h=>g._getTransferList(h)},p)||this}b._inheritsLoose(n,m);n.prototype._getTransferList=function(p){const g=
[p.geometryBuffer];c.isSome(p.primaryAttributeData)&&p.primaryAttributeData.buffer&&g.push(p.primaryAttributeData.buffer);c.isSome(p.modulationAttributeData)&&p.modulationAttributeData.buffer&&g.push(p.modulationAttributeData.buffer);if(c.isSome(p.filterAttributesData))for(const h of p.filterAttributesData)c.isSome(h)&&h.buffer&&g.push(h.buffer);for(const h of p.userAttributesData)h.buffer&&g.push(h.buffer);return g};return n}(r.WorkerHandle);a.PointCloudWorkerHandle=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,b){function c(h,d,f){for(;0<h;){const e=d.indexOf(h);if(0<=e)return e;h=f.getParentId(h)}return d.indexOf(h)}function r(h,d,f){const e=[d.remove[0]],l=[];for(;1===e.length;){const t=e.pop();l.length=0;for(let w=0;w<d.load.length;w++){let u=d.load[w];for(var A=f.getParentId(u);A!==t;)u=A,A=f.getParentId(u);A=e.indexOf(u);0>A&&(A=e.length,e.push(u),l.push([]));
l[A].push(d.load[w])}}d.load=e;for(d=0;d<e.length;d++)1<l[d].length?h.push({remove:[e[d]],load:l[d]}):e[d]=l[d][0]}const m=[!1],n=[null],p=[!1],g=[null];a.nodeDiff=function(h,d,f){for(var e=0;e<d.length;e++)p[e]=!1,g[e]=null;for(e=0;e<h.length;e++)m[e]=!1,n[e]=null;for(e=0;e<d.length;e++){var l=c(d[e],h,f);0<=l&&(p[e]=!0,null!=n[l]?n[l].push(d[e]):n[l]=[d[e]])}for(e=0;e<h.length;e++)l=c(h[e],d,f),0<=l&&(m[e]=!0,null!=g[l]?g[l].push(h[e]):g[l]=[h[e]]);f=[];for(e=0;e<h.length;e++)null!=n[e]||m[e]||
f.push({load:[],remove:[h[e]]});for(e=0;e<d.length;e++)null!=g[e]||p[e]||f.push({load:[d[e]],remove:[]});for(e=0;e<d.length;e++)null!=g[e]&&(1<g[e].length||g[e][0]!==d[e])&&f.push({load:[d[e]],remove:g[e]});for(d=0;d<h.length;d++)null!=n[d]&&(1<n[d].length||n[d][0]!==h[d])&&f.push({load:n[d],remove:[h[d]]});return f};a.sortFrontToBack=function(h,d,f){return h.sort((e,l)=>{if(0===e.load.length&&0===l.load.length)return 0;if(0===e.load.length)return-1;if(0===l.load.length)return 1;if(0===e.remove.length&&
0===l.remove.length)return e=f.getRenderCenter(e.load[0]),l=f.getRenderCenter(l.load[0]),b.dot(e,d)-b.dot(l,d);if(0===e.remove.length)return-1;if(0===l.remove.length)return 1;if(1===e.load.length&&1===l.load.length)return e=f.getRenderCenter(e.load[0]),l=f.getRenderCenter(l.load[0]),b.dot(e,d)-b.dot(l,d);if(1===e.load.length)return-1;if(1===l.load.length)return 1;e=f.getRenderCenter(e.remove[0]);l=f.getRenderCenter(l.remove[0]);return b.dot(e,d)-b.dot(l,d)})};a.splitWorkEntries=function(h,d,f){for(let e=
0;e<h.length;++e){const l=h[e];l.load.length>d&&1===l.remove.length&&r(h,l,f)}};a.splitWorkEntry=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,c){return function(){function r(n,p,g){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=n;this._renderSR=p;this.pageSize=
g}var m=r.prototype;m.addPage=function(n,p,g=0){for(;this._pages.length<n;)this._pages.push(null);var h=this._nodeSR,d=this._renderSR,f=new c.ObbArray(p.length);for(var e=0;e<p.length;e++)b.transformObb(p[e].obb,h,f.obbs[e],d,g);this._pages[n]={nodes:p,renderObbs:f.obbs,parents:new Uint32Array(this.pageSize)};n=this._pages;p=this.pageSize;for(g=[0];g.length;)for(h=g.pop(),d=n[h/p|0].nodes[h%p],f=0;f<d.childCount;f++)e=d.firstChild+f,null!=n[e/p|0]&&(n[e/p|0].parents[e%p]=h,g.push(e))};m.hasPage=function(n){return!!this._pages[n]};
m.getNode=function(n){const p=this.pageSize;return this._pages[n/p|0].nodes[n%p]};m.getRenderObb=function(n){const p=this.pageSize;return this._pages[n/p|0].renderObbs[n%p]};m.getRenderCenter=function(n){return this.getRenderObb(n).center};m.setRenderObb=function(n,p){const g=this.pageSize;c.set(p,this._pages[n/g|0].renderObbs[n%g])};m.getParentId=function(n){const p=this.pageSize;return this._pages[n/p|0].parents[n%p]};m.hasNodes=function(n,p){var g=n/this.pageSize|0;for(n=(n+p-1)/this.pageSize|
0;g<=n;g++)if(null==this._pages[g])return!1;return!0};m.forEachNodeId=function(n){for(let p=0;p<this._pages.length;p++){const g=this._pages[p];if(g)for(let h=0;h<g.nodes.length;h++)n(p*this.pageSize+h)}};m.createVisibilityTraverse=function(){var n=this,p=[],g=[],h=a.create();return(d,f)=>{if(n.hasNodes(0,1))for(p.length=0,p.push(0),g.length=0,g.push(0);0<p.length;){var e=p.pop();let z=g.pop();var l=n.getNode(e),A=n.getRenderObb(e),t=!0;if(null!=d.clippingBox){var w=1<<d.frustum.length;if(0===(z&w)){var u=
c.toAaBoundingBox(A,h);a.contains(d.clippingBox,u)?z|=w:a.intersects(d.clippingBox,u)||(t=!1)}}for(w=0;w<d.frustum.length&&t;w++)if(u=1<<w,0===(z&u)){const y=c.intersectPlane(A,d.frustum[w]);0<y?t=!1:0>y&&(z|=u)}if(f.predicate(e,l,t)){A=l.firstChild;l=l.childCount;t=!1;u=A/n.pageSize|0;for(w=(A+l-1)/n.pageSize|0;u<=w;u++)if(!n.hasPage(u)){f.pageMiss(e,u);t=!0;break}if(!t)for(e=0;e<l;e++)p.push(A+e),g.push(z)}}}};return r}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],
function(a){function b(r,m){for(const n of r)if(n.name===m&&null!=n.attributeValues&&"UInt8"===n.attributeValues.valueType&&3===n.attributeValues.valuesPerElement)return{name:m,storageInfo:n,useElevation:!1};return null}function c(r,m){for(const n of r)if(n.name===m)return r="embedded-elevation"===n.encoding,{name:m,storageInfo:r?null:n,useElevation:r};return"elevation"===m.toLowerCase()?{name:m,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=c;a.getFilterInfo=function(r){const m=r.filters;
return m?m.map(n=>({filterJSON:n.toJSON(),attributeInfo:c(r.attributeStorageInfo,n.field)})):[]};a.getFixedSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"fixed-size"===r.type?r:null};a.getRendererInfo=function(r){const m=r.renderer;var n=m&&m.type;const p=m&&r.renderer.toJSON()||null;let g=null,h=!1;"point-cloud-unique-value"===n?g=c(r.attributeStorageInfo,m.field):"point-cloud-stretch"===n?g=c(r.attributeStorageInfo,m.field):"point-cloud-class-breaks"===n?g=c(r.attributeStorageInfo,
m.field):(g="point-cloud-rgb"===n?b(r.attributeStorageInfo,m.field):b(r.attributeStorageInfo,"RGB"),h=null!=g);n=null;m&&m.colorModulation&&(n=c(r.attributeStorageInfo,m.colorModulation.field));return{rendererJSON:p,isRGBRenderer:h,primaryAttribute:g,modulationAttribute:n}};a.getSplatSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"splat"===r.type?r:null};a.rendererUsesFixedSizes=function(r){return(r=r&&r.pointSizeAlgorithm)&&r.type?"fixed-size"===r.type:!1};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(a,b,c,r,m,n,p){function g(f,e){const l=new Float64Array(e);for(let A=0;A<e;A++)l[A]=f[3*A+2];return l}function h(f){return null==f||"none"===
f?null:"low-four-bit"===f?e=>e&15:"high-four-bit"===f?e=>(e&240)>>4:"absolute-value"===f?e=>Math.abs(e):"modulo-ten"===f?e=>e%10:null}function d(f){let e=0;for(const l of f?f:[])e|=1<<l;return e}a.elevationFromPositions=g;a.evaluateRenderer=function(f,e,l,A){const {rendererJSON:t,isRGBRenderer:w}=f;var u=f=null;if(e&&w)f=e;else if(e&&"pointCloudUniqueValueRenderer"===t.type){u=m.fromJSON(t);var z=u.colorUniqueValueInfos;f=new Uint8Array(3*A);var y=h(u.fieldTransformType);for(var B=0;B<A;B++){var C=
(y?y(e[B]):e[B])+"";for(var k=0;k<z.length;k++)if(z[k].values.includes(C)){f[3*B]=z[k].color.r;f[3*B+1]=z[k].color.g;f[3*B+2]=z[k].color.b;break}}}else if(e&&"pointCloudStretchRenderer"===t.type)for(u=r.fromJSON(t),z=u.stops,f=new Uint8Array(3*A),y=h(u.fieldTransformType),B=0;B<A;B++)if(C=y?y(e[B]):e[B],k=z.length-1,C<z[0].value)f[3*B]=z[0].color.r,f[3*B+1]=z[0].color.g,f[3*B+2]=z[0].color.b;else if(C>=z[k].value)f[3*B]=z[k].color.r,f[3*B+1]=z[k].color.g,f[3*B+2]=z[k].color.b;else for(k=1;k<z.length;k++){if(C<
z[k].value){C=(C-z[k-1].value)/(z[k].value-z[k-1].value);f[3*B]=z[k].color.r*C+z[k-1].color.r*(1-C);f[3*B+1]=z[k].color.g*C+z[k-1].color.g*(1-C);f[3*B+2]=z[k].color.b*C+z[k-1].color.b*(1-C);break}}else if(e&&"pointCloudClassBreaksRenderer"===t.type)for(u=c.fromJSON(t),z=u.colorClassBreakInfos,f=new Uint8Array(3*A),y=h(u.fieldTransformType),B=0;B<A;B++)for(C=y?y(e[B]):e[B],k=0;k<z.length;k++){if(C>=z[k].minValue&&C<=z[k].maxValue){f[3*B]=z[k].color.r;f[3*B+1]=z[k].color.g;f[3*B+2]=z[k].color.b;break}}else for(f=
new Uint8Array(3*A),e=0;e<f.length;e++)f[e]=255;if(l&&u&&u.colorModulation)for(e=u.colorModulation.minValue,u=u.colorModulation.maxValue,z=0;z<A;z++)y=l[z],y=y>=u?1:y<=e?.3:.3+.7*(y-e)/(u-e),f[3*z]*=y,f[3*z+1]*=y,f[3*z+2]*=y;return f};a.filterInPlace=function(f,e,l,A,t){const w=f.length/3;let u=0;for(let q=0;q<w;q++){let x=!0;for(let v=0;v<A.length&&x;v++){var {filterJSON:z}=A[v],y=t[v].values[q];switch(z.type){case "pointCloudValueFilter":var B="exclude"===z.mode;z.values.includes(y)===B&&(x=!1);
break;case "pointCloudBitfieldFilter":B=d(z.requiredSetBits);z=d(z.requiredClearBits);if((y&B)!==B||0!==(y&z))x=!1;break;case "pointCloudReturnFilter":var C=y&15,k=y>>>4&15;y=1<k;B=1===C;C=C===k;k=!1;for(const D of z.includedReturns)if("last"===D&&C||"firstOfMany"===D&&B&&y||"lastOfMany"===D&&C&&y||"single"===D&&!y){k=!0;break}k||(x=!1)}}x&&(l[u]=q,f[3*u]=f[3*q],f[3*u+1]=f[3*q+1],f[3*u+2]=f[3*q+2],e[3*u]=e[3*q],e[3*u+1]=e[3*q+1],e[3*u+2]=e[3*q+2],u++)}return u};a.getAttributeValues=function(f,e,l){return b.isSome(f)&&
f.attributeInfo.useElevation?g(e,l):b.isSome(f)?n.readBinaryAttribute(f.attributeInfo.storageInfo,f.buffer,l):null};a.readGeometry=function(f,e){if(null==f.encoding||""===f.encoding){f=n.createGeometryIndexFromSchema(e,f);if(b.isNone(f.vertexAttributes.position))return;e=n.createTypedView(e,f.vertexAttributes.position);var l=f.header.fields;f=[l.offsetX,l.offsetY,l.offsetZ];l=[l.scaleX,l.scaleY,l.scaleZ];const A=e.length/3,t=new Float64Array(3*A);for(let w=0;w<A;w++)t[3*w]=e[3*w]*l[0]+f[0],t[3*w+
1]=e[3*w+1]*l[1]+f[1],t[3*w+2]=e[3*w+2]*l[2]+f[2];return t}if("lepcc-xyz"===f.encoding)return p.decodeXYZ(e).result};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;m=f=function(e){function l(A){A=e.call(this,A)||this;A.type="point-cloud-class-breaks";A.field=null;A.legendOptions=null;A.fieldTransformType=null;A.colorClassBreakInfos=null;return A}a._inheritsLoose(l,e);l.prototype.clone=function(){return new f({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:c.clone(this.colorClassBreakInfos),legendOptions:c.clone(this.legendOptions)})};return l}(g);b.__decorate([n.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
m.prototype,"type",void 0);b.__decorate([r.property({json:{write:!0},type:String})],m.prototype,"field",void 0);b.__decorate([r.property({type:h.LegendOptions,json:{write:!0}})],m.prototype,"legendOptions",void 0);b.__decorate([r.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],m.prototype,"fieldTransformType",void 0);b.__decorate([r.property({type:[d],json:{write:!0}})],
m.prototype,"colorClassBreakInfos",void 0);return m=f=b.__decorate([p.subclass("esri.renderers.PointCloudClassBreaksRenderer")],m)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d){p=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});r=function(f){function e(A){A=f.call(this,A)||this;A.type=void 0;A.pointSizeAlgorithm=null;A.colorModulation=null;A.pointsPerInch=10;return A}a._inheritsLoose(e,f);var l=e.prototype;l.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);
return null};l.cloneProperties=function(){return{pointSizeAlgorithm:m.clone(this.pointSizeAlgorithm),colorModulation:m.clone(this.colorModulation),pointsPerInch:m.clone(this.pointsPerInch)}};return e}(r.JSONSupport);b.__decorate([n.property({type:p.apiValues,readOnly:!0,nonNullable:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],r.prototype,"type",void 0);b.__decorate([n.property({types:d.pointSizeAlgorithmTypes,json:{write:!0}})],r.prototype,"pointSizeAlgorithm",void 0);b.__decorate([n.property({type:h,
json:{write:!0}})],r.prototype,"colorModulation",void 0);b.__decorate([n.property({json:{write:!0},nonNullable:!0,type:Number})],r.prototype,"pointsPerInch",void 0);r=b.__decorate([g.subclass("esri.renderers.PointCloudRenderer")],r);(r||(r={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return r})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p){var g;c=g=function(h){function d(){var f=h.apply(this,arguments)||this;f.field=null;f.minValue=0;f.maxValue=255;return f}a._inheritsLoose(d,h);d.prototype.clone=function(){return new g({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return d}(c.JSONSupport);b.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);b.__decorate([r.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);b.__decorate([r.property({type:Number,
nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=g=b.__decorate([p.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,c,r){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":c,splat:r}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){c=new c.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});r=function(h){function d(){return h.apply(this,
arguments)||this}a._inheritsLoose(d,h);return d}(r.JSONSupport);b.__decorate([m.property({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],r.prototype,"type",void 0);return r=b.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],r)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,r,m,n,p,g){var h;r=h=function(d){function f(){var e=d.apply(this,arguments)||this;e.type="fixed-size";e.size=0;e.useRealWorldSymbolSizes=null;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return f}(g);b.__decorate([n.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],r.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],r.prototype,"size",
void 0);b.__decorate([c.property({type:Boolean,json:{write:!0}})],r.prototype,"useRealWorldSymbolSizes",void 0);return r=h=b.__decorate([p.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],r)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,r,m,n,p,g){var h;r=h=function(d){function f(){var e=d.apply(this,arguments)||this;e.type="splat";e.scaleFactor=1;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({scaleFactor:this.scaleFactor})};return f}(g);b.__decorate([n.enumeration({pointCloudSplatAlgorithm:"splat"})],r.prototype,"type",void 0);b.__decorate([c.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],r.prototype,"scaleFactor",void 0);return r=h=b.__decorate([p.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],
r)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,r,m,n,p,g){var h;r=h=function(d){function f(){var e=d.apply(this,arguments)||this;e.description=null;e.label=null;e.minValue=
0;e.maxValue=0;e.color=null;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:m.clone(this.color)})};return f}(r.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],r.prototype,"description",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],r.prototype,"label",void 0);b.__decorate([n.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],
r.prototype,"minValue",void 0);b.__decorate([n.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],r.prototype,"maxValue",void 0);b.__decorate([n.property({type:c,json:{type:[p.Integer],write:!0}})],r.prototype,"color",void 0);return r=h=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],r)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;m=f=function(e){function l(A){A=e.call(this,A)||this;A.type="point-cloud-stretch";A.field=null;A.legendOptions=null;A.fieldTransformType=null;A.stops=null;return A}a._inheritsLoose(l,e);l.prototype.clone=function(){return new f({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),stops:c.clone(this.stops),legendOptions:c.clone(this.legendOptions)})};return l}(g);b.__decorate([n.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
m.prototype,"type",void 0);b.__decorate([r.property({json:{write:!0},type:String})],m.prototype,"field",void 0);b.__decorate([r.property({type:h.LegendOptions,json:{write:!0}})],m.prototype,"legendOptions",void 0);b.__decorate([r.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],m.prototype,"fieldTransformType",void 0);b.__decorate([r.property({type:[d],json:{write:!0}})],
m.prototype,"stops",void 0);return m=f=b.__decorate([p.subclass("esri.renderers.PointCloudStretchRenderer")],m)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,b,c,r,m,n,p,g,h,d){var f;m=f=function(e){function l(A){A=e.call(this,A)||this;A.type="point-cloud-unique-value";A.field=null;A.fieldTransformType=null;A.colorUniqueValueInfos=null;A.legendOptions=null;return A}a._inheritsLoose(l,e);l.prototype.clone=function(){return new f({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),colorUniqueValueInfos:c.clone(this.colorUniqueValueInfos),legendOptions:c.clone(this.legendOptions)})};return l}(g);
b.__decorate([n.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],m.prototype,"type",void 0);b.__decorate([r.property({json:{write:!0},type:String})],m.prototype,"field",void 0);b.__decorate([r.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],m.prototype,"fieldTransformType",void 0);b.__decorate([r.property({type:[d],json:{write:!0}})],
m.prototype,"colorUniqueValueInfos",void 0);b.__decorate([r.property({type:h.LegendOptions,json:{write:!0}})],m.prototype,"legendOptions",void 0);return m=f=b.__decorate([p.subclass("esri.renderers.PointCloudUniqueValueRenderer")],m)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){var h;r=h=function(d){function f(){var e=d.apply(this,arguments)||this;e.description=null;e.label=null;e.values=null;e.color=null;return e}a._inheritsLoose(f,d);f.prototype.clone=function(){return new h({description:this.description,label:this.label,values:m.clone(this.values),color:m.clone(this.color)})};return f}(r.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],r.prototype,"description",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],
r.prototype,"label",void 0);b.__decorate([n.property({type:[String],json:{write:!0}})],r.prototype,"values",void 0);b.__decorate([n.property({type:c,json:{type:[p.Integer],write:!0}})],r.prototype,"color",void 0);return r=h=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],r)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,r,m,n,p,g){a.PointGraphic=function(h){function d(f){return h.call(this,f)||this}b._inheritsLoose(d,h);return d}(r);c.__decorate([m.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=c.__decorate([g.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x){function v(O,P,N,H,E){if(N.drawScreenSpace)return N.fixedSize*P*H;E=y.getMaxPointSizeScreenspace(E)*P*H;return N.useFixedSizes?Math.min(N.fixedSize/2,E):0<N.screenMinSize?Math.min(Math.max(N.screenMinSize*P*H,O/2),E):Math.min(O/2,E)}function D(O,P,N,H,E){return N.drawScreenSpace?0:v(O,P,N,H,E)}function F(O){return c.isSome(O.component)?O.component:-1}function G(O,P){if(c.isNone(O))return O;O=O.filter(N=>N.id!==P);return 0===O.length?null:O}
function J(O){return c.isSome(O.dist)&&c.isSome(O.point)&&c.isSome(O.pointId)&&c.isSome(O.node)}const L={positions:[new x.VertexElementDescriptor(z.VertexAttribute.POSITION,3,q.DataType.FLOAT,0,12)],colors:[new x.VertexElementDescriptor(z.VertexAttribute.COLOR,3,q.DataType.UNSIGNED_BYTE,0,3,!0)]};z=function(){function O(N){this._params=N;this.type=w.IntersectorType.PCL;this.isGround=!1;this._passParameters=new y.PointRendererPassParameters;this._highlights=new f.PointHighlights({forEachNode:H=>this.forEachNode(H),
addHighlight:(H,E,I)=>this._addHighlight(H,E,I),removeHighlight:(H,E)=>this._removeHighlight(H,E)});this.canRender=!0;this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new C.PointRendererTechniqueConfiguration;this._nodes=new r}var P=O.prototype;P.initializeRenderContext=function(N){this._context=N;this._techniqueRep=this._context.shaderTechniqueRepository;N.requestRender()};P.uninitializeRenderContext=function(){};P.intersect=function(N,H,E,I){const M=n.create(),Q=n.create(),T=n.create(),
S=n.create(),U=h.create(),Y=N.camera.perScreenPixelRatio/2,V=N.camera.near;m.subtract(Q,I,E);const R=1/m.length(Q);m.scale(Q,Q,R);m.negate(T,Q);p.set(U,Q[0],Q[1],Q[2],-m.dot(Q,E));const X=new K,W=new K,aa=[],ba=g.create(),ia=g.create(this._passParameters.clipBox);g.offset(ia,-E[0],-E[1],-E[2],ia);this._nodes.forAll(Z=>{const ca=Z.splatSize*this._passParameters.scaleFactor;var fa=e.minimumDistancePlane(Z.obb,U),ea=e.maximumDistancePlane(Z.obb,U);fa-=D(ca,fa+V,this._passParameters,Y,Z.isLeaf);ea-=D(ca,
ea+V,this._passParameters,Y,Z.isLeaf);fa=null!=X.dist&&null!=W.dist&&X.dist<fa*R&&W.dist>ea*R;if(!(0>ea||fa)&&(ea=v(ca,ea+V,this._passParameters,Y,Z.isLeaf),e.intersectLine(Z.obb,E,Q,ea))){ea*=ea;e.toAaBoundingBox(Z.obb,ba);g.offset(ba,-E[0],-E[1],-E[2],ba);fa=!g.contains(ia,ba);m.subtract(S,Z.origin,E);var da=Z.coordinates.length/3;for(let Aa=0;Aa<da;Aa++){M[0]=S[0]+Z.coordinates[3*Aa];M[1]=S[1]+Z.coordinates[3*Aa+1];M[2]=S[2]+Z.coordinates[3*Aa+2];if(fa&&!g.containsPoint(ia,M))continue;var la=m.dot(M,
Q),oa=m.squaredLength(M)-la*la;if(oa>ea)continue;var ra=la+V;const ua=D(ca,ra,this._passParameters,Y,Z.isLeaf);if(0>la-ua)continue;ra-=ua;ra=v(ca,ra,this._passParameters,Y,Z.isLeaf);if(oa>ra*ra)continue;const za=(la-ua)*R;la=va=>{var Ja=Aa,pa=va.point;c.isNone(pa)&&(pa=n.create());pa[0]=Z.origin[0]+Z.coordinates[3*Ja];pa[1]=Z.origin[1]+Z.coordinates[3*Ja+1];pa[2]=Z.origin[2]+Z.coordinates[3*Ja+2];va.point=pa;va.dist=za;va.normal=T;va.node=Z;va.pointId=Aa;va.layerUid=this.layerUid;return va};(null==
X.dist||za<X.dist)&&(null==H||H(E,I,za))&&la(X);N.options.store!==w.StoreResults.MIN&&(null==W.dist||za>W.dist)&&(null==H||H(E,I,za))&&la(W);N.options.store!==w.StoreResults.ALL||null!=H&&!H(E,I,za)||(oa=new K,aa.push(la(oa)))}}});const ma=Z=>{const {layerUid:ca,node:fa,pointId:ea}=Z;return{point:Z.point,layerUid:ca,graphicUid:ea,createGraphic:()=>this._params.createGraphic(fa,ea,Z.point)}},ha=(Z,ca)=>{const fa=ma(ca);Z.set(this.type,fa,ca.dist,ca.normal)};if(J(X)){var ka=N.results.min;(null==ka.dist||
X.dist<ka.dist)&&ha(ka,X)}J(W)&&N.options.store!==w.StoreResults.MIN&&(ka=N.results.max,(null==ka.dist||W.dist>ka.dist)&&ha(ka,W));if(N.options.store===w.StoreResults.ALL){ka=d.fromPoints(E,I);for(const Z of aa){const ca=t.newIntersectorResult(ka);ha(ca,Z);N.results.all.push(ca)}}};P.prepareTechnique=function(N){if(0===this._nodes.length||N.output!==l.ShaderOutput.Color&&N.output!==l.ShaderOutput.Depth&&N.output!==l.ShaderOutput.Highlight)return null;this._nodes.forAll(H=>{null==H.vao&&this._initNode(N,
H)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=N.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=N.output===l.ShaderOutput.Depth?l.ShaderOutput.Depth:N.output===l.ShaderOutput.Highlight?l.ShaderOutput.Highlight:l.ShaderOutput.Color;return this._techniqueRep.releaseAndAcquire(B.PointRendererTechnique,
this._techniqueConfig,this._technique)};P.render=function(N,H){const E=N.rctx,I=E.bindTechnique(H,this._passParameters,N.bindParameters),M=N.output===l.ShaderOutput.Highlight;this._nodes.forAll(Q=>{0===Q.coordinates.length||M&&!Q.highlights||(I.bindDraw(Q,N.bindParameters,this._passParameters),E.bindVAO(Q.vao),M?this._renderHighlightFragments(E,Q):E.drawArrays(q.PrimitiveType.POINTS,0,Q.coordinates.length/3))})};P._renderHighlightFragments=function(N,H){var E=H.highlights;if(!c.isNone(E)){H=c.unwrap(E[0].component);
var I=H+1;for(let M=1;M<E.length;M++){const Q=c.unwrap(E[M].component);Q!==I&&(I-=H,0<I&&N.drawArrays(q.PrimitiveType.POINTS,H,I),H=Q);I=Q+1}E=I-H;0<E&&N.drawArrays(q.PrimitiveType.POINTS,H,E)}};P.addNode=function(N){this._nodes.push(N);this._highlights.nodeAdded(N);this._requestRender()};P.removeNode=function(N){let H=null;this._nodes.filterInPlace(E=>E.id===N?(H=E,E.vao=c.disposeMaybe(E.vao),this._highlights.nodeRemoved(E),!1):!0);this._requestRender();return H};P.forEachNode=function(N){this._nodes.forAll(N)};
P.removeAll=function(){this._nodes.forAll(N=>N.vao=c.disposeMaybe(N.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()};P.highlight=function(N){return this._highlights.add(N)};P._addHighlight=function(N,H,E){var I=N.highlights;c.isNone(I)&&(I=[]);H={component:H,id:E};I.push(H);H=F(H);for(E=I.length-1;0<E&&H<F(I[E-1]);)[I[E-1],I[E]]=[I[E],I[E-1]],--E;N.highlights=I;this._requestRender()};P._removeHighlight=function(N,H){N.highlights=G(N.highlights,H);this._requestRender()};
P._initNode=function(N,H){N=N.rctx;H.vao=new u.VertexArrayObject(N,A.Default3D,L,{positions:k.BufferObject.createVertex(N,q.Usage.STATIC_DRAW,H.coordinates),colors:k.BufferObject.createVertex(N,q.Usage.STATIC_DRAW,H.rgb)})};P._requestRender=function(){this._context&&this._context.requestRender()};b._createClass(O,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._passParameters.useFixedSizes},set:function(N){this._passParameters.useFixedSizes!==
N&&(this._passParameters.useFixedSizes=N,this._requestRender())}},{key:"scaleFactor",get:function(){return this._passParameters.scaleFactor},set:function(N){this._passParameters.scaleFactor!==N&&(this._passParameters.scaleFactor=N,this._requestRender())}},{key:"minSizePx",get:function(){return this._passParameters.minSizePx},set:function(N){this._passParameters.minSizePx!==N&&(this._passParameters.minSizePx=N,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._passParameters.useRealWorldSymbolSizes},
set:function(N){this._passParameters.useRealWorldSymbolSizes!==N&&(this._passParameters.useRealWorldSymbolSizes=N,this._requestRender())}},{key:"size",get:function(){return this._passParameters.size},set:function(N){this._passParameters.size!==N&&(this._passParameters.size=N,this._requestRender())}},{key:"sizePx",get:function(){return this._passParameters.sizePx},set:function(N){this._passParameters.sizePx!==N&&(this._passParameters.sizePx=N,this._requestRender())}},{key:"clippingBox",set:function(N){g.set(this._passParameters.clipBox,
N||g.POSITIVE_INFINITY)}},{key:"_clippingEnabled",get:function(){return!g.equals(this._passParameters.clipBox,g.POSITIVE_INFINITY,(N,H)=>N===H)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(N){this._slicePlaneEnabled!==N&&(this._slicePlaneEnabled=N,this._requestRender())}}]);return O}();x=function(O){function P(N,H,E,I,M,Q,T,S,U=null,Y=null){H=O.call(this,E,M,H)||this;H.id=N;H.obb=I;H.coordinates=Q;H.rgb=T;H.attributes=S;H.pointIdFilterMap=U;H.highlights=Y;
return H}b._inheritsLoose(P,O);return P}(y.PointRendererDrawParameters);let K=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};a.PointRenderer=z;a.PointRendererNode=x;a.isInstanceOfNode=function(O){return O.hasOwnProperty("splatSize")};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/handleUtils ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,r,m,n){let p=function(){function h(f){this._context=f;this._highlights=new Set}var d=h.prototype;d.destroy=function(){this._highlights=null};d.add=function(f){const e=new g(f);this._highlights.add(e);this._enableSet(e);return c.makeHandle(()=>this._removeSet(e))};d._removeSet=function(f){this._disableSet(f);this._highlights.delete(f)};d._enableSet=function(f){f.enabled||(f.enabled=!0,this._context.forEachNode(e=>this._enableSetForNode(f,e)))};d._enableSetForNode=function(f,e){if(f.enabled){var l=
f.ids.get(e.id);l&&l.forEach(A=>this._context.addHighlight(e,A,f.id))}};d._disableSet=function(f){f.enabled&&(f.enabled=!1,this._context.forEachNode(e=>this._disableSetForNode(f,e)))};d._disableSetForNode=function(f,e){f.enabled||this._context.removeHighlight(e,f.id)};d.nodeAdded=function(f){this._highlights.forEach(e=>this._enableSetForNode(e,f))};d.nodeRemoved=function(f){this._highlights.forEach(e=>this._disableSetForNode(e,f))};d.removeAll=function(){this._highlights.forEach(f=>this._disableSet(f))};
b._createClass(h,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return h}(),g=function(){function h(d){this.id=new n.Object3DStateID(m.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const f of d)r.isSome(f)&&this._add(f.nodeId,f.pointId)}h.prototype._add=function(d,f){const e=this.ids.get(d);e?e.add(f):this.ids.set(d,new Set([f]))};return h}();a.PointHighlights=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q){function x(K){const O=new k.ShaderBuilder,P=K.output===e.ShaderOutput.Color,N=K.output===e.ShaderOutput.Depth,H=K.output===e.ShaderOutput.Highlight,{vertex:E,fragment:I}=O;O.extensions.add("GL_OES_standard_derivatives");O.include(l.SliceDraw,K);O.attributes.add(q.VertexAttribute.POSITION,"vec3");O.attributes.add(q.VertexAttribute.COLOR,"vec3");E.uniforms.add([new B.Matrix4DrawUniform("modelView",(M,Q)=>r.multiply(G,Q.camera.viewMatrix,r.fromTranslation(G,
M.origin))),new C.Matrix4PassUniform("proj",(M,Q)=>Q.camera.projectionMatrix),new w.Float2DrawUniform("screenMinMaxSize",(M,Q,T)=>n.set(L,T.useFixedSizes?0:T.minSizePx*Q.camera.pixelRatio,(M.isLeaf?256:64)*Q.camera.pixelRatio))]);E.uniforms.add(K.useFixedSizes?new u.Float2PassUniform("pointScale",(M,Q)=>n.set(L,M.fixedSize*Q.camera.pixelRatio,Q.camera.fullHeight)):new w.Float2DrawUniform("pointScale",(M,Q,T)=>n.set(L,M.splatSize*T.scaleFactor*Q.camera.pixelRatio,Q.camera.fullHeight/Q.camera.pixelRatio)));
K.clippingEnabled?E.uniforms.add([new z.Float3DrawUniform("clipMin",(M,Q,T)=>g.set(J,T.clipBox[0]-M.origin[0],T.clipBox[1]-M.origin[1],T.clipBox[2]-M.origin[2])),new z.Float3DrawUniform("clipMax",(M,Q,T)=>g.set(J,T.clipBox[3]-M.origin[0],T.clipBox[4]-M.origin[1],T.clipBox[5]-M.origin[2]))]):(E.constants.add("clipMin","vec3",[-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32]),E.constants.add("clipMax","vec3",[c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32]));N?(f.addNearFar(O),
f.addCalculateLinearDepth(O),O.varyings.add("depth","float")):K.output!==e.ShaderOutput.Highlight&&O.varyings.add("vColor","vec3");E.code.add(y.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${K.drawScreenSize?y.glsl`
      float clampedScreenSize = pointSize;`:y.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${N?y.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${P?y.glsl`vColor = color;`:""}
    }
  `);I.include(t.RgbaFloatEncoding,K);H&&O.include(A.OutputHighlight,K);I.code.add(y.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${N?y.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${H?y.glsl`outputHighlight();`:""}
      ${P?y.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return O}function v(K){return K?256:64}let D=function(K){function O(){var P=K.apply(this,arguments)||this;P.clipBox=d.create(d.POSITIVE_INFINITY);P.useFixedSizes=!1;P.useRealWorldSymbolSizes=!1;P.scaleFactor=1;P.minSizePx=0;P.size=0;P.sizePx=0;return P}b._inheritsLoose(O,K);b._createClass(O,[{key:"fixedSize",get:function(){return this.drawScreenSpace?this.sizePx:this.size}},{key:"screenMinSize",get:function(){return this.useFixedSizes?0:this.minSizePx}},{key:"drawScreenSpace",get:function(){return this.useFixedSizes&&
!this.useRealWorldSymbolSizes}}]);return O}(y.NoParameters),F=function(K){function O(P,N,H){var E=K.call(this,P)||this;E.origin=P;E.isLeaf=N;E.splatSize=H;return E}b._inheritsLoose(O,K);return O}(l.SlicePlaneParameters);const G=m.create(),J=h.create(),L=p.create();m=Object.freeze(Object.defineProperty({__proto__:null,PointRendererPassParameters:D,PointRendererDrawParameters:F,build:x,getMaxPointSizeScreenspace:v},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=F;a.PointRendererPassParameters=
D;a.PointRendererShader=m;a.build=x;a.getMaxPointSizeScreenspace=v})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,c,r,m,n,p,g,h,d,f){m=
function(e){function l(t,w,u){return e.call(this,t,w,u)||this}c._inheritsLoose(l,e);var A=l.prototype;A.initializeProgram=function(t){return new p.Program(t.rctx,l.shader.get().build(this.configuration),n.Default3D)};A.initializePipeline=function(){return f.makePipelineState({depthTest:{func:d.CompareFunction.LESS},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?
g.stencilBaseAllZerosParams:null})};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(h.PointRendererShader,()=>new Promise((e,l)=>a(["./PointRenderer.glsl"],e,l)));b.PointRendererTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,r,m,n){n=function(p){function g(){var h=p.apply(this,arguments)||this;h.output=r.ShaderOutput.Color;h.hasSlicePlane=!1;h.drawScreenSize=!1;h.useFixedSizes=!1;h.hasOccludees=!1;h.clippingEnabled=!1;return h}b._inheritsLoose(g,p);return g}(n.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.ShaderOutput.COUNT})],n.prototype,"output",void 0);c.__decorate([m.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],n.prototype,"drawScreenSize",void 0);
c.__decorate([m.parameter()],n.prototype,"useFixedSizes",void 0);c.__decorate([m.parameter()],n.prototype,"hasOccludees",void 0);c.__decorate([m.parameter()],n.prototype,"clippingEnabled",void 0);c.__decorate([m.parameter({constValue:!0})],n.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){a.PopupSceneLayerView=l=>{l=function(A){function t(){return A.apply(this,arguments)||this}b._inheritsLoose(t,A);var w=t.prototype;w._validateFetchPopupFeatures=function(u){const {layer:z}=this,{popupEnabled:y}=z;if(!y)return new r("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:z});if(!e.getFetchPopupTemplate(z,u))return new r("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:z})};w.prepareFetchPopupFeatures=
function(){var u=b._asyncToGenerator(function*(z){});return function(z){return u.apply(this,arguments)}}();w.fetchPopupFeatures=function(){var u=b._asyncToGenerator(function*(z,y){if(z=this._validateFetchPopupFeatures(y))throw z;z=m.isSome(y)?y.clientGraphics:null;if(!z||0===z.length)return[];var B="scene"===this.layer.type&&m.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;y=f.unpackFieldNames(this.layer.fieldsIndex,yield e.getRequiredFields(B,e.getFetchPopupTemplate(this.layer,
y)));yield this.prepareFetchPopupFeatures(y);B=new Set;const C=[],k=[];for(const q of z)f.populateMissingFields(y,q,B)?k.push(q):C.push(q);return 0===k.length?C:this.whenGraphicAttributes(k,[...B]).catch(()=>k).then(q=>C.concat(q))});return function(z,y){return u.apply(this,arguments)}}();return t}(l);return l=c.__decorate([d.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P){g=G.defineFieldProperties();w=function(N){function H(){var I=N.apply(this,arguments)||this;I.type="scene-layer-3d";I.progressiveLoadFactor=1;I._elevationContext="scene";I._isIntegratedMesh=!1;I._supportsLabeling=!0;I._interactiveEditingSessions=new Map;I._queryEngine=null;return I}a._inheritsLoose(H,N);var E=H.prototype;E.initialize=function(){this._fieldsHelper=new L.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>
this.layer.rangeInfos,M=>this._rangeInfosChanged(M),n.initial);this.updatingHandles.add(()=>this.layer.renderer,M=>this.updatingHandles.addPromise(this._rendererChange(M)),n.initial);const I=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,I);this.updatingHandles.add(()=>this.filter,I);this.updatingHandles.add(()=>this._floorFilterClause,I);this.updatingHandles.add(()=>this._excludeObjectIdsSorted,I);this.updatingHandles.add(()=>m.isSome(this.viewFilter)?this.viewFilter.sortedObjectIds:
null,I);this.updatingHandles.add(()=>m.isSome(this.viewFilter)?this.viewFilter.parsedWhereClause:null,I);this.updatingHandles.add(()=>[m.isSome(this.viewFilter)?this.viewFilter.parsedGeometry:null,m.isSome(this.filter)?this.filter.spatialRelationship:null,m.isSome(this.layer.filter)?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",M=>this.updatingHandles.addPromise(M.result)));this.handles.add(this.layer.on("edits",M=>this._handleEdits(M)))};
E.destroy=function(){this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)};E._rangeInfosChanged=function(I){null!=I&&0<I.length&&r.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};E.createQuery=function(){const I={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return m.isSome(this.filter)?this.filter.createQuery(I):new A(I)};E.queryExtent=function(I,M){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(I),
M?.signal)};E.queryFeatureCount=function(I,M){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(I),M?.signal)};E.queryFeatures=function(I,M){return this._ensureQueryEngine().executeQuery(this._ensureQuery(I),M?.signal).then(Q=>{if(!Q?.features)return Q;const T=this.layer;for(const S of Q.features)S.layer=T,S.sourceLayer=T;return Q})};E.queryObjectIds=function(I,M){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(I),M?.signal)};E._ensureQueryEngine=function(){this._queryEngine||
(this._queryEngine=this._createQueryEngine());return this._queryEngine};E._createQueryEngine=function(){const I=B.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new q.I3SQueryEngine({layerView:this,priority:P.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new v.I3SQueryFeatureStore({featureAdapter:new x.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:I}),
toArray:()=>{const M=[];this._forAllFeatures((Q,T,S)=>{M.push({id:Q,index:T,meta:S});return u.ForAllFeaturesReturnType.CONTINUE},null,u.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA);return M},forAllFeatures:(M,Q)=>this._forAllFeatures((T,S,U)=>M({id:T,index:S,meta:U}),Q,u.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA),getFeatureExtent:I,sourceSpatialReference:D.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};E.highlight=function(I){const M=this._highlights;if(I instanceof
A){const {set:Q,handle:T}=M.acquireSet();this.queryObjectIds(I).then(S=>M.setFeatureIds(Q,S));return T}return N.prototype.highlight.call(this,I)};E.createInteractiveEditSession=function(I){return y.createInteractiveEditSession(this._attributeEditingContext,I)};E._createLayerGraphic=function(I){I=new c(null,null,I);I.layer=this.layer;I.sourceLayer=this.layer;return I};E.canResume=function(){return N.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};E.getFilters=
function(){const I=N.prototype.getFilters.call(this),M=this._excludeObjectIdsSorted;m.isSome(M)&&I.push(Q=>D.objectIdFilter(M,!1,Q));this._floorFilterClause&&this.addSqlFilter(I,this._floorFilterClause,this.logError);this.addSqlFilter(I,this.parsedDefinitionExpression,this.logError);m.isSome(this.viewFilter)&&this.viewFilter.addFilters(I,this.view,this._controller.crsIndex,this._collection);return I};E.isUpdating=function(){return N.prototype.isUpdating.call(this)||this.layerFilterUpdating||m.isSome(this.viewFilter)&&
this.viewFilter.updating||m.isSome(this.i3sOverrides)&&this.i3sOverrides.updating};E._ensureQuery=function(I){return this._addDefinitionExpressionToQuery(m.isNone(I)?this.createQuery():A.from(I))};E._handleEdits=function(I){t.sceneLayerEditingEnabled()&&y.processGeometryEdits(this._attributeEditingContext,I);y.processAttributeEdits(this._attributeEditingContext,I)};E.computeNodeFiltering=function(I){const M=this.viewFilter;return m.isNone(M)||M.isMBSGeometryVisible(I,this.view.spatialReference,this._controller.crsIndex)?
k.NodeFilterImpact.Unmodified:k.NodeFilterImpact.Culled};a._createClass(H,[{key:"i3slayer",get:function(){return this.layer}},{key:"layerPopupEnabled",get:function(){return this.layer.popupEnabled}},{key:"filter",get:function(){return this._get("filter")},set:function(I){this._set("filter",C.I3SMeshViewFilter.checkSupport(I)?I:null)}},{key:"viewFilter",get:function(){const I=this.filter,M=this.layerFilter;if(m.isNone(I)&&m.isNone(M))return null;const Q=this._get("viewFilter");if(m.isNone(Q))return new C.I3SMeshViewFilter({layerFilter:M,
viewFilter:I,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:T=>this._loadAsyncModule(T),addSqlFilter:(T,S)=>this.addSqlFilter(T,S,this.logError)});Q.viewFilter=I;Q.layerFilter=M;return Q}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"_floorFilterClause",get:function(){const I=l.getFloorFilterClause(this);return m.isSome(I)?f.WhereClause.create(I,this.layer.fieldsIndex):null}},{key:"_excludeObjectIdsSorted",get:function(){let I=this.layer.excludeObjectIds.toArray();
t.sceneLayerEditingEnabled()&&0<this.i3sOverrides.geometryChangedObjectIds.length&&(I=I.concat(this.i3sOverrides.geometryChangedObjectIds));return I.length?I.sort((M,Q)=>M-Q):null}},{key:"_objectQualitySettings",get:function(){return this.view?.qualitySettings?.sceneService?.object}},{key:"lodFactor",get:function(){return this._objectQualitySettings?.lodFactor??1}},{key:"lodCrossfadeinDuration",get:function(){return this._objectQualitySettings.lodCrossfadeinDuration??0}},{key:"lodCrossfadeoutDuration",
get:function(){return this._objectQualitySettings.lodCrossfadeoutDuration??0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"_attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:I=>this._forAllNodes(M=>m.isSome(M)?
I(M.node,M.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,i3sOverrides:this.i3sOverrides,getAttributeData:I=>this.getAttributeData(I),setAttributeData:(I,M)=>this.setAttributeData(I,M),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const I=this.viewFilter;return m.isSome(I)&&m.isSome(I.parsedGeometry)}}]);return H}(w.I3SMeshView3D(F.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(z.LayerView3D(O)))));b.__decorate([p.property()],
w.prototype,"i3slayer",null);b.__decorate([p.property(K.updatingProgress)],w.prototype,"updatingProgress",void 0);b.__decorate([p.property({type:e})],w.prototype,"filter",null);b.__decorate([p.property({readOnly:!0})],w.prototype,"viewFilter",null);b.__decorate([p.property(g.requiredFields)],w.prototype,"requiredFields",null);b.__decorate([p.property(g.availableFields)],w.prototype,"availableFields",void 0);b.__decorate([p.property()],w.prototype,"_fieldsHelper",void 0);b.__decorate([p.property()],
w.prototype,"_floorFilterClause",null);b.__decorate([p.property()],w.prototype,"_excludeObjectIdsSorted",null);b.__decorate([p.property()],w.prototype,"_objectQualitySettings",null);b.__decorate([p.property()],w.prototype,"lodFactor",null);b.__decorate([p.property()],w.prototype,"updatingProgressValue",null);return w=b.__decorate([d.subclass("esri.views.3d.layers.SceneLayerView3D")],w)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba,ia,ma,ha,ka,Z,ca,fa,ea,da,la,oa,ra,Aa,ua,za,va,Ja,pa,Ba,Ha,wa,ya,Na,Ra){function Sa(ab,ib){t.isAbortError(ab)||Ua.warn("Error while processing edges. Edges on this layer might not display correctly",ib,ab)}function ja(ab){if(l.isNone(ab))return!1;const ib=ab.metallicRoughness;return ib&&0<=ib.baseColorTextureId||ib&&0<=ib.metallicRoughnessTextureId||0<=ab.normalTextureId||0<=ab.emissiveTextureId||
0<=ab.occlusionTextureId}function Ta(ab){return l.isSome(ab)&&z.isArrayBuffer(ab.data)}function qa(ab,ib){ab=1024+ab.interleavedVertexData.byteLength+(ab.indices?ab.indices.byteLength:0)+ab.positionData.data.byteLength+ab.positionData.indices.byteLength;if(l.isSome(ib))for(const bb of ib)l.isSome(bb)&&z.isArrayBuffer(bb.data)&&(ab+=bb.data.byteLength);return ab}function Ea(ab,ib){return ib.byteSize>Ia?(Ua.warn(`Node is too big to store in IndexedDB cache: ${ab.id} (${ib.byteSize} bytes)`),!1):0<ib.byteSize}
function Oa(ab){if(0===ab.length)return null;const ib=new Float64Array(10*ab.length);ab.forAll((bb,Fa)=>{let na=bb.serviceObb;l.isNone(na)&&(na=fb,F.copy(na.center,bb.mbs),na.halfSize[0]=na.halfSize[1]=na.halfSize[2]=bb.mbs[3]);bb=10*Fa;ib[bb+0]=na.center[0];ib[bb+1]=na.center[1];ib[bb+2]=na.center[2];ib[bb+3]=na.halfSize[0];ib[bb+4]=na.halfSize[1];ib[bb+5]=na.halfSize[2];ib[bb+6]=na.quaternion[0];ib[bb+7]=na.quaternion[1];ib[bb+8]=na.quaternion[2];ib[bb+9]=na.quaternion[3]});return ib}function Va(ab,
ib){ab.forEach(bb=>bb.opacity=ib)}const Ua=f.getLogger("esri.views.3d.layers.I3SMeshView3D"),La=[1,1,1,1];let ta=function(ab){function ib(bb,Fa,na,Da,Ma,Pa,Wa){var $a=ab.call(this)||this;$a.node=bb;$a.featureIds=Fa;$a.objectHandle=na;$a.cachedRendererVersion=Da;$a.attributeInfo=Ma;$a.material=Pa;$a.textures=Wa;$a.cachedMidsTerrainSR=null;$a.cachedEdgeMaterials=[];$a.edgeMemoryUsage=0;$a.cachedSymbology=null;return $a}c._inheritsLoose(ib,ab);return ib}(ma.NodeCrossfadeMetaData);var xa;(function(ab){ab[ab.CastShadows=
4]="CastShadows";ab[ab.Pickable=5]="Pickable"})(xa||(xa={}));const Ia=100*g.ByteSizeUnit.MEGABYTES;var Qa;(function(ab){ab[ab.ADD=0]="ADD";ab[ab.REMOVE=1]="REMOVE";ab[ab.UPDATE=2]="UPDATE"})(Qa||(Qa={}));const Xa=O.create(),cb=P.create(),db=P.create(),fb=Ja.create(),jb=[0,0,0,0],qb=new m([0,0,0,0]),nb=[0,0,0,0],sb={remove(){},pause(){},resume(){}};b.ElevationMode=void 0;(function(ab){ab[ab.Absolute=0]="Absolute";ab[ab.RelativeToGround=1]="RelativeToGround";ab[ab.OnTheGround=2]="OnTheGround"})(b.ElevationMode||
(b.ElevationMode={}));const vb=G.create(),Bb=O.create();b.I3SMeshView3D=ab=>{ab=function(ib){function bb(...na){na=ib.call(this,na)||this;na._elevationProvider=null;na._intersectionHandler=null;na._nodeId2Meta=new Map;na._nodeId2MetaReloading=new Map;na._i3sWasmLoaded=!1;na._snappingSourcesTrackers=[];na._hasLoadedPBRTextures=!1;na._asyncModuleLoading=0;na._addTasks=new Map;na._rendererVersion=0;na._colorVariable=null;na._opacityVariable=null;na._rendererFields=null;na._symbologyFields=null;na._symbologyOverride=
null;na._symbologyOverrideFields=null;na._symbolInfos=new Map;na._idbCache=d("enable-feature:idb-mock-cache")?new ra.IDBMockCache:new oa.IDBCache("esri-scenelayer-cache","geometries");na.holeFilling="auto";na._hasColors=!1;na._hasTextures=!1;na._hasData=!1;na.slicePlaneEnabled=!1;na._modifications=[];na._layerUrl="";na._cacheKeySuffix=null;na._elevationTask=null;na._filters=[];na._arcade=null;na._tmpAttributeOnlyGraphic=new n(null,null,{});na._crossfadeHelper=new ma.I3SCrossfadeHelper(c._assertThisInitialized(na));
return na}c._inheritsLoose(bb,ib);var Fa=bb.prototype;Fa.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);const na=this.view.resourceController;this.i3sOverrides=new ea.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:na.memoryController});this._worker=new V.I3SMeshWorkerHandle(Ma=>na.schedule(Ma));this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);la.checkSceneLayerValid(this.i3slayer);
la.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new H({layerView:this});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new ba({collection:this._collection,forAllFeatures:Ma=>this._forAllFeatures(Ma,null,R.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(Ma,Pa)=>this._forAllFeaturesOfNode(Ma,
Pa)});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasComponentData=!1;else{var Da=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasComponentData=!!(Da&&Da.faceRange&&Da.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.i3slayer.uid,
Ma=>this._deleteComponentObject(Ma));this._intersectionHandler=new Z.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Ma=>l.isSome(this._controller.index)&&l.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,Pa=>{var Wa=Pa.index;Wa=this._nodeId2Meta.get(Wa)||this._nodeId2MetaReloading.get(Wa);return Ma(Pa,
l.isSome(Wa)?Wa.objectHandle:null)}):()=>{}});this._elevationProvider=new ha({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),w.initial);this.updatingHandles.add(()=>this.fullOpacity,Ma=>this._opacityChange(Ma));this.updatingHandles.add(()=>this.slicePlaneEnabled,Ma=>this._slicePlaneEnabledChange(Ma));this.updatingHandles.add(()=>this.elevationOffset,(Ma,Pa)=>
{this._reloadAll(Pa);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(Ma,Pa)=>this._elevationInfoChanged(Ma,Pa),w.initial);this.updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==b.ElevationMode.Absolute,(Ma,Pa)=>{Ma?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:Wa})=>this._ensureElevationTask().addExtent(Wa)),"elevation-change"):Pa&&this.handles.remove("elevation-change")},w.initial);this.updatingHandles.add(()=>
this.view.qualitySettings.physicallyBasedRenderingEnabled,()=>this._updatePBR());Da=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,Da);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,Da);this.updatingHandles.add(()=>this.suspended,Ma=>this._suspendedChange(Ma),w.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),w.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,
()=>this._labelingChanged(),w.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),w.initial);this.handles.add([w.watch(()=>za.I3S_TREE_SHOW_TILES,Ma=>{if(Ma&&!this._treeDebugger){const Pa=this._controller.crsIndex;(new Promise((Wa,$a)=>a(["./support/I3STreeDebugger"],Wa,$a))).then(({I3STreeDebugger:Wa})=>{!this._treeDebugger&&za.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Wa({lv:this,view:this.view,nodeSR:Pa}))})}else Ma||za.I3S_TREE_SHOW_TILES||(this._treeDebugger=
l.destroyMaybe(this._treeDebugger))},w.initial),w.watch(()=>za.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),w.initial)]);this._cacheKeySuffix=la.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Ma=>Ua.warn(`Failed to initialize IndexedDB cache: ${Ma}`))};Fa.destroy=function(){this._clearAddTasks();this._elevationTask=l.destroyMaybe(this._elevationTask);this.i3sOverrides=l.destroyMaybe(this.i3sOverrides);this._elevationProvider&&
(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const na=this._worker;na&&(na.destroyContext(this.i3slayer.uid).then(()=>na.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=l.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=
null;this._labeler=l.destroyMaybe(this._labeler);this._treeDebugger=l.destroyMaybe(this._treeDebugger);this._controller=l.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};Fa._memEstimateTextureAdded=function(na){na=na.estimatedTexMemRequired;this._gpuMemoryEstimate+=
na;this._texMemoryEstimate+=na;return na};Fa._memEstimateTextureRemoved=function(na){l.isSome(na)&&(na=na.estimatedTexMemRequired,this._gpuMemoryEstimate-=na,this._texMemoryEstimate-=na)};Fa._memEstimateGeometryAdded=function(na){na=this._collection.getObjectGPUMemoryUsage(na);this._gpuMemoryEstimate+=na;this._geoMemoryEstimate+=na;return na};Fa._memEstimateGeometryRemoved=function(na){na=this._collection.getObjectGPUMemoryUsage(na);this._gpuMemoryEstimate-=na;this._geoMemoryEstimate-=na};Fa.isNodeLoaded=
function(na){return this._nodeId2Meta.has(na)};Fa.isNodeReloading=function(na){return this._nodeId2MetaReloading.has(na)};Fa.getUsedMemory=function(){let na=l.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Da=>na+=l.isSome(Da)?Da.node.memory:0);this._nodeId2MetaReloading.forEach(Da=>na+=l.isSome(Da)?Da.node.memory:0);return na};Fa.getUnloadedMemory=function(){return(l.isSome(this._controller)?this._controller.unloadedMemoryEstimate:0)+(l.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:
0)};Fa.ignoresMemoryFactor=function(){return!1};Fa._labelingChanged=function(){if(!I.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)l.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!l.isSome(this._labeler)){var na=new Y({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Da=>l.isSome(Da)&&this._addMetaToLabeler(na,Da));this._labeler=na}};Fa._loadAsyncModule=function(na){++this._asyncModuleLoading;return na.then(Da=>{--this._asyncModuleLoading;
return Da},Da=>{--this._asyncModuleLoading;throw Da;})};Fa._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=X.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var na=this.i3slayer.uid,Da=this.i3slayer.spatialReference;this._worker.setModifications(na,this._layerClippingArea,this._modifications,Da);var Ma=V.toWasmModification(this._layerClippingArea,
this._modifications,Da);X.setModificationsSync({context:na,modifications:Ma,isGeodetic:Da.isGeographic});this._controller.modificationsChanged();var Pa=this.hasModifications?new A:null;this._nodeId2Meta.forEach((Wa,$a)=>{l.isNone(Wa)?(this._nodeId2Meta.delete($a),this._controller.updateLoadStatus($a,!1)):Wa.node.hasModifications?(this._nodeId2Meta.delete($a),this._nodeId2MetaReloading.set($a,Wa)):l.isSome(Pa)&&Pa.push(Wa.node)});l.isSome(Pa)&&this._nodeId2MetaReloading.forEach(Wa=>Pa.push(Wa.node));
l.isSome(Pa)&&0<Pa.length&&(this.updateNodeModificationStatus(Pa),Pa.forAll(Wa=>{if(Wa.imModificationImpact!==fa.NodeIMModificationImpact.Culled){const $a=this._nodeId2Meta.get(Wa.index);this._controller.invalidateGeometryVisibility(Wa.index);l.isSome($a)?(this._nodeId2Meta.delete(Wa.index),this._nodeId2MetaReloading.set(Wa.index,$a)):this._nodeId2Meta.has(Wa.index)&&(this._nodeId2Meta.delete(Wa.index),this._controller.updateLoadStatus(Wa.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();
this._showModifications()}};Fa._showModifications=function(){l.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(za.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var na={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Da={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ma of this._modifications)Ma.geometry.spatialReference=this.i3slayer.spatialReference,
this._modificationGraphics.push(new n({geometry:Ma.geometry,symbol:{...Da,color:na[Ma.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};Fa._addMetaToLabeler=function(na,Da){na.addNodeMeta(Da,(Ma,Pa)=>this._createAttributes(Ma,Pa))};Fa._suspendedChange=function(na){na?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):
(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};Fa.getLoadedAttributes=function(na){na=this._nodeId2Meta.get(na);if(l.isSome(na)&&l.isSome(na.attributeInfo))return na.attributeInfo.loadedAttributes};Fa.getAttributeData=function(na){na=this._nodeId2Meta.get(na);if(l.isSome(na)&&l.isSome(na.attributeInfo))return na.attributeInfo.attributeData};Fa.setAttributeData=function(na,
Da){na=this._nodeId2Meta.get(na);l.isSome(na)&&l.isSome(na.attributeInfo)&&(na.attributeInfo.attributeData=Da,this._attributeValuesChanged(na))};Fa.updateAttributes=function(){var na=c._asyncToGenerator(function*(Da,Ma,Pa){const Wa=this._nodeId2Meta.get(Da);l.isSome(Wa)&&(yield this.i3sOverrides.apply(Wa.featureIds,Ma,Pa),Wa.attributeInfo=Ma,this._controller.reschedule(()=>this._attributeValuesChanged(Wa),Pa).catch($a=>{t.isAbortError($a)||Ua.warn("Error while updating attribute values. Layer might not display correctly.",
$a)}))});return function(Da,Ma,Pa){return na.apply(this,arguments)}}();Fa._attributeValuesChanged=function(na){na.cachedRendererVersion=this._getInvalidRendererVersion();na.filteredIds=null;l.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(na,(Da,Ma)=>this._createAttributes(Da,Ma));this._updateEngineObject(na)};Fa.clearMemCache=function(){l.isSome(this._memCache)&&this._memCache.clear()};Fa.getVisibleNodes=function(){const na=[];this._nodeId2Meta.forEach(Da=>l.isSome(Da)&&na.push(Da.node));
return na};Fa.getNodeComponentObb=function(na){na=this._nodeId2Meta.get(na.index)??this._nodeId2MetaReloading.get(na.index);return l.isSome(na)?this._collection.getComponentObb(na.objectHandle):null};Fa.getLoadedNodeIndices=function(na){this._nodeId2Meta.forEach((Da,Ma)=>na.push(Ma));this._nodeId2MetaReloading.forEach((Da,Ma)=>na.push(Ma))};Fa._preLoadBasis=function(){!d("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&aa.TextureEncoding.Basis)&&l.applySome(this.i3slayer.textureSetDefinitions,
na=>na.some(Da=>Da.formats.some(Ma=>"basis"===Ma.format||"ktx2"===Ma.format)))&&Na.loadBasis()};Fa._getVertexBufferLayout=function(na,Da){na={hasTexture:ja(na.params.material),hasNormals:Da.normal,hasRegions:Da.uvRegion};return Ba.glLayout(wa.createVertexBufferLayout(this._getGeometryParameters(na)))};Fa._getObjectIdField=function(){return this.i3slayer.objectIdField||N.fallbackObjectIDAttribute};Fa._findGraphicNodeAndIndex=function(na){const Da=Aa.attributeLookup(this.i3slayer.fieldsIndex,na.attributes,
this._getObjectIdField());let Ma=null;e.someMap(this._nodeId2Meta,Pa=>{if(l.isNone(Pa))return!1;const Wa=Pa.featureIds.indexOf(Da);if(-1===Wa)return!1;Ma={node:Pa.node,index:Wa};return!0});return Ma};Fa._getGraphicIndices=function(na,Da){na=this._nodeId2Meta.get(na.index);if(l.isNone(na))return[];const Ma=[],Pa=this._getObjectIdField(),Wa=this.i3slayer.fieldsIndex;for(const $a of Da)Da=Aa.attributeLookup(Wa,$a.attributes,Pa),Da=na.featureIds.indexOf(Da),-1!==Da&&Ma.push(Da);return Ma};Fa.whenGraphicBounds=
function(na){na=this._findGraphicNodeAndIndex(na);if(!na)return Promise.reject();na=this._getAABB(na.node.index,na.index);return l.isNone(na)?Promise.reject():Promise.resolve({boundingBox:na,screenSpaceObjects:[]})};Fa.getAABBFromIntersectorTarget=function(na){return null==na.nodeIndex||null==na.componentIndex?null:this._getAABB(na.nodeIndex,na.componentIndex)};Fa._getAABB=function(na,Da){na=this._nodeId2Meta.get(na);if(l.isNone(na)||null==na.featureIds||Da>=na.featureIds.length)return null;Da=ka.boundingBoxCornerPoints(Da,
this._collection,na.objectHandle,new Float64Array(24));if(!K.projectBuffer(Da,this.view.renderSpatialReference,0,Da,this.view.spatialReference,0,8))return null;na=O.empty();O.expandWithBuffer(na,Da,0,8);return na};Fa.whenGraphicAttributes=function(na,Da){return la.whenGraphicAttributes(this.i3slayer,na,this._getObjectIdField(),Da,()=>[...this._nodeId2Meta.values()].filter(l.isSome))};Fa.getGraphicFromIntersectorTarget=function(na){if(null==na.nodeIndex||null==na.componentIndex)return null;const Da=
this._nodeId2Meta.get(na.nodeIndex);return l.isNone(Da)||null==Da.featureIds||na.componentIndex>=Da.featureIds.length?null:this._createGraphic(na.componentIndex,Da)};Fa._getCacheKey=function(na){return`${this._layerUrl}/v${19}/${na.id}${this._cacheKeySuffix}`};Fa._getMemCacheKey=function(na,Da=this.elevationOffset){return na+"#"+Da};Fa.loadCachedGPUData=function(na){return l.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(na.index)):null};Fa.deleteCachedGPUData=function(na){l.isSome(na)&&
this._deleteComponentObject(na)};Fa._cacheGPUData=function(na,Da=this.elevationOffset){if(l.isNone(this._memCache))this._deleteComponentObject(na);else{var Ma=this._controller.indexDepth-na.node.level;this._memCache.put(this._getMemCacheKey(na.node.index,Da),na,na.node.memory,Ma)}};Fa.loadMissingTextures=function(na,Da,Ma,Pa){const Wa=na?.filter(($a,eb)=>{if(0===($a.usage&this.rendererTextureUsage))return!1;if(l.isNone(Da))return!0;$a=ca.selectEncoding($a.encodings,this.supportedTextureEncodings);
eb=Da[eb];return l.isNone(eb)||null==eb.data||$a&&eb.encoding!==$a.encoding?!0:!1})??[];return 0===Wa.length?Promise.resolve(!1):Ma(Wa,Pa).then($a=>{let eb=0;for(let kb=0;kb<na.length;kb++)eb<$a.length&&$a[eb].id===na[kb].id&&(Da[kb]=$a[eb],eb++);return!0})};Fa.loadCachedNodeData=function(na,Da,Ma){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(na),Da).then(Pa=>{if(null==Pa)return null;if(Pa.nodeVersion!==na.version)return this._idbCache.remove(this._getCacheKey(na)),null;this.elevationInfo.mode===
b.ElevationMode.Absolute&&(na.geometryObb=Pa.geometryObb);return this.loadMissingTextures(Pa.requiredTextures,Pa.textureData,Ma,Da).then(Wa=>{Wa&&this._idbCache.initialized&&l.isSome(Pa.textureData)&&(Pa.byteSize=qa(Pa.transformedGeometry,Pa.textureData),Pa.textureData.every(Ta)&&Ea(na,Pa)&&this._idbCache.put(this._getCacheKey(na),Pa).catch($a=>Ua.warn(`Failed to update node with textures in IndexedDB cache: ${na.id}: ${$a}`)));t.throwIfAborted(Da);return Pa})}):Promise.resolve(null)};Fa.addNode=
function(na,Da,Ma){return"geometryData"in Da?null==Da.geometryBuffer?(this._addNodeMeta(na.index,null),Promise.resolve()):this._addData(na,Da.attributeDataInfo,()=>this._transformNode(na,Da,Ma).then(Pa=>this._safeReschedule(()=>{if(l.isNone(Pa))return na.hasModifications=!1,this._addCachedNodeData(na,null,Ma);na.hasModifications=Pa.transformedGeometry.hasModifications;const {obb:Wa,componentOffsets:$a,featureIds:eb,transformedGeometry:kb}=Pa;var gb=da.computeGlobalTransformation(na.mbs,this.elevationOffset,
this._controller.crsIndex,this.view.renderSpatialReference),lb=Ja.create([Wa.center.x,Wa.center.y,Wa.center.z],[Wa.extents.x,Wa.extents.y,Wa.extents.z],[Wa.orientation.x,Wa.orientation.y,Wa.orientation.z,Wa.orientation.w]);F.transformMat4(lb.center,lb.center,gb);this.elevationInfo.mode===b.ElevationMode.Absolute&&(na.geometryObb=lb);Da.geometryData.componentOffsets=$a;eb&&(Da.geometryData.featureIds=Array.from(eb));gb={nodeVersion:na.version,geometryData:Da.geometryData,requiredTextures:Da.requiredTextures,
textureData:Da.textureData,transformedGeometry:kb,globalTrafo:gb,geometryObb:lb,byteSize:qa(kb,Da.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&Ea(na,gb)&&(lb=l.isSome(gb.textureData)?gb.textureData.map(ob=>Ta(ob)?ob:null):null,this._idbCache.put(this._getCacheKey(na),{...gb,textureData:lb}).catch(ob=>Ua.warn(`Failed to store node in IndexedDB cache: ${na.id}: ${ob}`)));return this._addCachedNodeData(na,gb,Ma)},Ma))):Promise.reject()};Fa.computeVisibilityObb=function(na){return la.computeVisibilityObb(na,
this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Fa._transformNode=function(na,Da,Ma){var Pa=Da.geometryData.geometries;const Wa=Array(Pa.length);for(var $a=0;$a<Pa.length;++$a)Wa[$a]=this._getVertexBufferLayout(Pa[$a],Da.geometryDescriptor);Pa=na.mbs;$a=this.elevationOffset;var eb=this._controller.crsIndex,kb=this._controller.crsVertex;const gb=this.view.renderSpatialReference,lb=da.getLocalOrigin(Pa,$a,eb),ob=da.computeGlobalTransformation(Pa,
$a,eb,gb);eb=K.getProjectorName(eb,kb);kb=K.getProjectorName(kb,gb);return l.isNone(eb)||l.isNone(kb)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:Da.geometryBuffer,geometryData:Da.geometryData,geometryDescriptor:Da.geometryDescriptor,layouts:Wa,localOrigin:lb,globalTrafo:ob,mbs:Pa,obb:na.serviceObb,elevationOffset:$a,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:eb,
vertexToRenderProjector:kb},Ma)};Fa._setNewNodeOpacity=function(na){this._setNodeOpacity(na,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Fa.addCachedGPUData=function(na,Da,Ma){this.elevationInfo.mode===b.ElevationMode.Absolute&&(na.geometryObb=Ja.clone(this._collection.getComponentObb(Da.objectHandle)));this._controller.isGeometryVisible(na)?(l.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Da),na=na.index,this._addNodeMeta(na,Da),this.updateNodeState(na,Ma),this._collection.setObjectVisibility(Da.objectHandle,
Ha.State.Visible),this._updateMaterial(Da),this._setNewNodeOpacity(Da),this.elevationInfo.mode!==b.ElevationMode.Absolute&&this._ensureElevationTask().schedule(na),this._updateEngineObject(Da),this._highlights.objectCreated(Da),l.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Da)};Fa.addCachedNodeData=function(na,Da,Ma,Pa){return this._addData(na,Ma,()=>this._addCachedNodeData(na,Da,Pa))};Fa._addCachedNodeData=function(){var na=c._asyncToGenerator(function*(Da,Ma,Pa){if(this.suspended||
!this._controller.isGeometryVisible(Da))this._removeNodeStageData(Da.index,this.elevationOffset,this._nodeId2MetaReloading);else if(l.isNone(Ma))this._addNodeMeta(Da.index,null);else{var Wa=this._addTasks.get(Da.index),{geometryData:$a,transformedGeometry:eb,globalTrafo:kb}=Ma;yield this.i3sOverrides.apply($a.featureIds,Wa.attributeInfo,Pa);var gb=l.isSome(Ma.textureData)?Ma.textureData.filter(Jb=>l.isSome(Jb)&&0!==(Jb.usage&this.rendererTextureUsage)):[];!d("disable-feature:i3s-basis")&&gb.some(Jb=>
l.isSome(Jb)&&(Jb.encoding===aa.TextureEncoding.Basis||Jb.encoding===aa.TextureEncoding.KTX2))&&(yield Na.loadBasis());Da.memory=0;var {componentOffsets:lb,geometries:ob,featureIds:Eb}=$a,Gb=this._collection,pb=ob[0],{layout:mb,indices:zb,interleavedVertexData:Fb,positionData:ub,hasColors:Db}=eb,Ab=this._materialParameters(pb,mb),Rb=lb||new Uint32Array([0,zb?zb.length:Fb.byteLength/mb[0].stride]);Rb={vertices:{data:Fb,count:Fb.byteLength/mb[0].stride,layoutParameters:Ab.geometryParams},positionData:{positions:ub.data,
indices:ub.indices},indices:zb,componentOffsets:Rb};var Ob=pb.transformation?D.clone(pb.transformation):D.create();v.multiply(Ob,kb,Ob);pb=v.getTranslation(G.create(),Ob);Ob=q.fromMat4(x.create(),Ob);var Sb=this.view.renderSpatialReference,Hb=this.view.basemapTerrain.spatialReference,Cb=G.create(),Ib=[1,1,1];K.localLinearScaleFactors(pb,Sb,Ib,Hb)||Ua.errorOnce("Unsupported coordinate system for IM overlay");K.projectVectorToVector(pb,Sb,Cb,Hb);var xb=Gb.createObject({toMapSpace:L.fromValues(Cb[0],
Cb[1],Ib[0],Ib[1]),geometry:Rb,obb:Ma.geometryObb,transform:{position:pb,rotationScale:Ob}}),{textures:wb,texturePromise:Lb}=this._initMaterialAndTextures(xb,Ab.material,gb,Ab.geometryParams.textureCoordinates===ya.TextureCoordinateAttributeType.Atlas);Da.memory+=this._memEstimateGeometryAdded(xb);Da.memory+=wb.reduce((Jb,Nb)=>Jb+(l.isSome(Nb)?this._memEstimateTextureAdded(Nb):0),0);gb=!!Ab.material.hasParametersFromSource;Ab="blend"!==Ab.material.alphaMode&&1<=Ab.material.metallicRoughness.baseColorFactor[3];
var yb=new ta(Da,Eb,xb,this._getInvalidRendererVersion(),Wa.attributeInfo,{hasParametersFromSource:gb,isOpaque:Ab},wb);Wa.meta=yb;!this._hasTextures&&Ma.requiredTextures?.some(({usage:Jb})=>0!==(Jb&aa.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Db;this._hasTextures=this._hasTextures||!!Da.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Wb=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(yb),Lb]).then(([Jb])=>
{l.isSome(Jb)&&Jb.updateObjectVisibility(yb.objectHandle,!1).catch(Nb=>Sa(Nb,this.i3slayer.title));return this._safeReschedule(()=>{var Nb=this._addTasks.get(Da.index);if(Nb)if(this._addNodeMeta(Da.index,yb),Nb.meta=null,this.suspended)this._removeNodeStageData(Da.index,this.elevationOffset);else{Gb.setObjectVisibility(xb,Ha.State.Visible);l.isSome(Jb)&&Jb.updateObjectVisibility(yb.objectHandle,!0).catch(dc=>Sa(dc,this.i3slayer.title));yb.attributeInfo=Nb.attributeInfo;Nb=yb.cachedRendererVersion!==
this._rendererVersion;var Xb=Wb!==this.slicePlaneEnabled;this._updateElevationOffsets(yb);var ac=yb.elevationOffsets;this._updateComponentData(yb);var gc=this._applyFiltersToNode(yb);(Nb||l.isSome(Jb)&&(Xb||gc||ac))&&this._addOrUpdateEdgeRendering(yb);l.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,yb);this._visibleGeometryChanged(yb,Qa.ADD);this._highlights.objectCreated(yb);this._updateMaterial(yb);this._setNewNodeOpacity(yb);l.isSome(this._treeDebugger)&&this._treeDebugger.update()}},
Pa)}).catch(Jb=>{l.isSome(Wa.meta)&&(this._cacheGPUData(Wa.meta),Wa.meta=null);throw Jb;})}});return function(Da,Ma,Pa){return na.apply(this,arguments)}}();Fa._addNodeMeta=function(na,Da){this._removeNodeStageData(na,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(na)){Ua.error("Removing duplicated node");const Ma=this._nodeId2Meta.get(na);l.isSome(Ma)&&this._deleteComponentObject(Ma)}else this._controller.updateLoadStatus(na,!0);l.isSome(Da)&&(Da.lodCrossfadeProgress=null,
this.nodeCrossfadingEnabled&&Va(Da.cachedEdgeMaterials,0));this._nodeId2Meta.set(na,Da)};Fa._updateElevationOffsets=function(na){const Da=this.view.renderSpatialReference,Ma=this.elevationInfo,Pa=this.view.basemapTerrain,Wa=Pa.spatialReference;var $a=Ma.mode;if(l.isNone(Da)||l.isNone(Wa)||$a===b.ElevationMode.Absolute)na.elevationOffsets=null;else{var eb=this._collection.getObjectTransform(na.objectHandle);na.elevationOffsets=na.elevationOffsets??[];var kb=$a===b.ElevationMode.OnTheGround;$a=this.view.renderCoordsHelper;
var gb=na.featureIds.length;if(!na.cachedMidsTerrainSR){na.cachedMidsTerrainSR=new Float64Array(3*gb);const Gb=na.cachedMidsTerrainSR;for(let pb=0;pb<gb;pb++){this._collection.getComponentAabb(na.objectHandle,pb,Bb,!0);F.set(vb,(Bb[0]+Bb[3])/2,(Bb[1]+Bb[4])/2,Bb[2]);F.transformMat3(vb,vb,eb.rotationScale);F.add(vb,vb,eb.position);const mb=3*pb;Gb[mb+2]=$a.getAltitude(vb);K.projectVectorToVector(vb,Da,vb,Wa);Gb[mb+0]=vb[0];Gb[mb+1]=vb[1]}}var lb=na.cachedMidsTerrainSR,ob=Ma.offset,Eb=na.elevationOffsets;
Pa.getElevations(lb,gb,(Gb,pb)=>{const mb=kb?lb[3*Gb+2]:0;Eb[Gb]=ob+(l.isSome(pb)?pb-mb:0)})}};Fa._ensureElevationTask=function(){return l.isSome(this._elevationTask)?this._elevationTask:this._elevationTask=new ia.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,na=>{na=this._controller.updateElevationChanged(na,this.view.basemapTerrain.spatialReference);return l.isSome(na)?na.filterInPlace(Da=>l.isSome(this._nodeId2Meta.get(Da))):null},na=>{na=this._nodeId2Meta.get(na);this._nodeElevationAlignmentChanged(na)})};
Fa._elevationInfoChanged=function(na,Da){const Ma=na.mode!==b.ElevationMode.Absolute;na=null!=Da&&Da!==na&&Da.mode!==b.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Ma,this.view.state.viewingMode);Ma&&!na&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Pa=>this._nodeElevationAlignmentChanged(Pa))};Fa._nodeElevationAlignmentChanged=function(na){l.isNone(na)||(this._updateElevationOffsets(na),this._updateComponentData(na),this._updateEdgeRendering(na),
l.isSome(this._labeler)&&this._labeler.updateLabelPositions(na),this._updateSnappingSources(na,Qa.UPDATE))};Fa._safeReschedule=function(na,Da){t.throwIfAborted(Da);return this._controller.reschedule(na,Da)};Fa._materialParameters=function(na,Da){na=l.isSome(na.params.material)?na.params.material:ca.defaultMaterial();const Ma=Da.some(Wa=>"uvRegion"===Wa.name);Da=Da.some(Wa=>"normalCompressed"===Wa.name);const Pa=ja(na);return{geometryParams:this._getGeometryParameters({hasTexture:Pa,hasNormals:Da,
hasRegions:Ma}),material:na}};Fa._initMaterialAndTextures=function(na,Da,Ma,Pa){const Wa=this._stage.renderView,$a=Ma.map(kb=>ca.createTexture(kb,Da,Pa,Wa));this._stage.addMany($a);let eb=null;this._collection.updateMaterial(na,kb=>{eb=ca.configureMaterial(kb,Da,$a,Ma,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});
this._updateMaterialOverlay(kb)});return{textures:$a,texturePromise:eb}};Fa._getGeometryParameters=function(na){return{textureCoordinates:na.hasTexture?na.hasRegions?ya.TextureCoordinateAttributeType.Atlas:ya.TextureCoordinateAttributeType.Default:ya.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:na.hasNormals&&!this._isIntegratedMesh}};Fa._addData=function(na,Da,Ma){let Pa=this._addTasks.get(na.index);Pa?Pa.attributeInfo=Da:(Pa={...t.createResolver(),attributeInfo:Da,meta:null},
this._addTasks.set(na.index,Pa),Ma().then(Pa.resolve,Pa.reject).then(()=>this._addTasks.delete(na.index)).catch(Wa=>{this._addTasks.delete(na.index);throw Wa;}));return Pa.promise};Fa._clearAddTasks=function(){this._addTasks.forEach(na=>{l.isSome(na.meta)&&(this._cacheGPUData(na.meta),na.meta=null)});this._addTasks.clear()};Fa._clippingAreaChanged=function(){var na=this.view.renderSpatialReference;const Da=this.i3slayer.spatialReference,Ma=P.create();this._renderClippingArea=va.toBoundingRect(this.view.clippingArea,
Ma,na)?Ma:null;na=P.create();this._layerClippingArea=va.toBoundingRect(this.view.clippingArea,na,Da)?na:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};Fa._geometryFilterChange=function(){const na=this.hasGeometryFilter;this._controller.geometryFilterChanged(na);this._applyFilters(na)};Fa._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};Fa._applyFilters=function(na){this._filters=
this.getFilters();na?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Da=>{l.isSome(Da)&&this._applyFiltersToNode(Da)&&(this._addOrUpdateEdgeRendering(Da),this._visibleGeometryChanged(Da,Qa.UPDATE))})};Fa.getFilters=function(){const na=[],Da=this._renderClippingArea;l.isSome(Da)&&na.push((Ma,Pa)=>this._boundingRectFilter(Ma,Pa,Da));return na};Fa.addSqlFilter=function(na,Da,Ma){if(l.isSome(Da)){const Pa=Da.fieldNames;na.push((Wa,$a)=>this._sqlFilter(Wa,$a,Da,Pa,Ma))}};Fa._sqlFilter=
function(na,Da,Ma,Pa,Wa){const $a={},eb=this._createLayerGraphic($a),kb=this.i3slayer.objectIdField,gb=Da.featureIds,lb=l.isSome(Da.attributeInfo)&&Da.attributeInfo.attributeData;Pa.every(ob=>null!=lb[ob]||ob===kb)&&la.filterInPlace(na,gb,ob=>{$a[kb]=gb[ob];for(const Eb of Pa)Eb!==kb&&($a[Eb]=la.getCachedAttributeValue(lb[Eb],ob));try{return Ma.testFeature(eb)}catch(Eb){return Wa(Eb),!1}})};Fa._boundingRectNodeTest=function(na,Da){K.projectBoundingSphere(na.node.mbs,this._controller.crsIndex,nb,this.view.renderSpatialReference);
return la.intersectBoundingRectWithMbs(Da,nb)};Fa._boundingRectFeatureTest=function(na,Da,Ma){this._collection.getComponentAabb(na.objectHandle,Da,Xa);O.toRect(Xa,cb);return P.intersects(Ma,cb)};Fa._boundingRectFilter=function(na,Da,Ma){var Pa=this._collection;const Wa=this._boundingRectNodeTest(Da,Ma);if(Wa!==la.MbsIntersectResult.INSIDE)if(Wa===la.MbsIntersectResult.OUTSIDE)na.length=0;else if(Pa=Pa.getComponentCount(Da.objectHandle),Pa.invisible+Pa.visible===Da.featureIds.length){var $a=this._transformClippingArea(db,
Ma,Da.objectHandle);la.filterInPlace(na,Da.featureIds,eb=>this._boundingRectFeatureTest(Da,eb,$a))}};Fa._transformClippingArea=function(na,Da,Ma){var Pa=this._collection.getObjectTransform(Ma);Ma=Pa.position;Pa=Pa.rotationScale;na[0]=(Da[0]-Ma[0])/Pa[0];na[1]=(Da[1]-Ma[1])/Pa[4];na[2]=(Da[2]-Ma[0])/Pa[0];na[3]=(Da[3]-Ma[1])/Pa[4];return na};Fa._addOrUpdateEdgeRendering=function(na,Da=!0){const Ma=this._edgeView;if(l.isNone(Ma))return Promise.resolve(null);const Pa=na.objectHandle;var Wa=Ma.hasObject(Pa);
const {hasEdges:$a,perFeatureEdgeMaterials:eb}=this._getFilteredEdgeMaterials(na),kb={hasSlicePlane:this.slicePlaneEnabled};if($a&&Wa)return this.nodeCrossfadingEnabled&&(Wa=this.getNodeOpacity(na),Va(eb,Wa)),Ma.updateAllComponentMaterials(Pa,eb,kb,Da).catch(gb=>Sa(gb,this.i3slayer.title)),Ma.updateObjectVisibility(Pa,!0).catch(gb=>Sa(gb,this.i3slayer.title)),Ma.updateAllVerticalOffsets(Pa,na.elevationOffsets).catch(gb=>Sa(gb,this.i3slayer.title)),Promise.resolve(Ma);if($a&&!Wa)return this._collection.addEdges(Pa,
Ma,eb,kb).then(gb=>{na.edgeMemoryUsage=gb;na.node.memory+=gb;Ma.updateAllVerticalOffsets(Pa,na.elevationOffsets).catch(lb=>Sa(lb,this.i3slayer.title));return Ma});!$a&&Wa&&(na.node.memory-=na.edgeMemoryUsage,na.edgeMemoryUsage=0,Ma.removeObject(Pa));return Promise.resolve(null)};Fa._applyFiltersToNode=function(na){return this._applyFiltersToNodeComponents(na)?(l.isSome(this._labeler)&&this._labeler.applyFilterChange(na),!0):!1};Fa._applyFiltersToNodeComponents=function(na){const Da=this._collection;
var Ma=0===Da.getComponentCount(na.objectHandle).invisible;Da.setAllComponentVisibilities(na.objectHandle,"all");if(0===this._filters.length)return na.filteredIds=null,!Ma;this._updateCachedFilteredIds(na);if(na.filteredIds===na.featureIds)return!Ma;Ma=this._computeFilteredComponentIndices(na);Da.setAllComponentVisibilities(na.objectHandle,Ma);return!0};Fa._updateCachedFilteredIds=function(na){if(null==na.filteredIds||na.appliedFilters!==this._filters)na.filteredIds=this._computeFilteredIds(na),na.appliedFilters=
this._filters};Fa._computeFilteredIds=function(na){const Da=na.featureIds.slice();for(const Ma of this._filters)if(Ma(Da,na),0===Da.length)break;return Da.length===na.featureIds.length?na.featureIds:Da};Fa._computeFilteredComponentIndices=function(na){const Da=[];na.featureIds.forEach((Ma,Pa)=>{na.filteredIds[Da.length]===Ma&&Da.push(Pa)});return Da};Fa._removeAllNodeDataFromStage=function(na=this.elevationOffset){this._nodeId2Meta.forEach((Da,Ma)=>this._removeNodeStageData(Ma,na));this._nodeId2MetaReloading.forEach((Da,
Ma)=>this._removeNodeStageData(Ma,na,this._nodeId2MetaReloading));this._elevationTask=l.destroyMaybe(this._elevationTask)};Fa.removeNode=function(na){const Da=this.elevationOffset;this._removeNodeStageData(na,Da);this._removeNodeStageData(na,Da,this._nodeId2MetaReloading);l.isSome(this._elevationTask)&&this._elevationTask.remove(na)};Fa._removeNodeStageData=function(na,Da,Ma=this._nodeId2Meta){Ma.has(na)&&this._controller.updateLoadStatus(na,!1);const Pa=Ma.get(na);l.isNone(Pa)?Ma.delete(na):(this._collection.setObjectVisibility(Pa.objectHandle,
Ha.State.Hidden),l.isSome(this._edgeView)&&this._edgeView.hasObject(Pa.objectHandle)&&this._edgeView.updateObjectVisibility(Pa.objectHandle,!1).catch(Wa=>Sa(Wa,this.i3slayer.title)),this._visibleGeometryChanged(Pa,Qa.REMOVE),l.isSome(this._labeler)&&this._labeler.removeNodeMeta(Pa),Ma.delete(na),this._highlights.objectDeleted(Pa),Ma===this._nodeId2Meta?(this._cacheGPUData(Pa,Da),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Pa)):this._deleteComponentObject(Pa),l.isSome(this._treeDebugger)&&
this._treeDebugger.update())};Fa._deleteComponentObject=function(na){l.isSome(this._edgeView)&&this._edgeView.removeObject(na.objectHandle);this._memEstimateGeometryRemoved(na.objectHandle);this._collection.destroyObject(na.objectHandle);if(na.textures)for(const Da of na.textures)this._memEstimateTextureRemoved(Da),this._stage.remove(Da)};Fa.updateNodeState=function(na,Da){na=this._nodeId2Meta.get(na);l.isSome(na)&&this._collection.updateMaterial(na.objectHandle,Ma=>Ma.polygonOffsetEnabled=Da===fa.NodeState.Hole)};
Fa._invalidateAllSymbols=function(){this._rendererVersion=la.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Fa._getInvalidRendererVersion=function(){return la.addWraparound(this._rendererVersion,-1)};Fa._rendererChange=function(){var na=c._asyncToGenerator(function*(Da){this._currentRenderer=Da;this.notifyChange("rendererTextureUsage");this._rendererVersion=la.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=
null;this._invalidateAllSymbols();Da&&(this._rendererFields=yield Da.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&Da&&"arcadeRequired"in Da&&Da.arcadeRequired&&(this._arcade=yield T.loadArcade());if(Da&&"visualVariables"in Da&&Da.visualVariables)for(const Ma of Da.visualVariables)"color"===Ma.type?this._colorVariable=Ma:"opacity"===Ma.type?this._opacityVariable=Ma:Ua.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ma.type}`);if(Da)for(const Ma of Da.getSymbols())"mesh-3d"!==
Ma.type&&Ua.error(`Symbols of type '${Ma.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(Da){return na.apply(this,arguments)}}();Fa._getCachedEdgeMaterials=function(na){this._hasComponentData&&na.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(na);return na.cachedEdgeMaterials};Fa._getComponentParameters=function(na){this._hasComponentData&&na.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(na);const Da=na.cachedSymbology;return(Ma,Pa)=>{const Wa=5*Ma;J.set(Pa.externalColor,Da[Wa+0]/255,Da[Wa+1]/255,Da[Wa+2]/255,Da[Wa+3]/255);if(Pa.objectAndLayerIdColor){var $a=na.featureIds[Ma];this._stage.renderView._objectAndLayerIdRenderHelper.setUidToObjectAndLayerId($a,$a,this.layerId,this.layerUid,this.layerPopupEnabled,na.node.resources.attributes,Ma,this.sublayerId);$a=this._stage.renderView._getObjectAndLayerIdColor({graphicUid:$a,layerUid:this.layerUid});J.set(Pa.objectAndLayerIdColor,
$a[0],$a[1],$a[2],$a[3])}Pa.externalColorMixMode=Da[Wa+4]&(1<<xa.CastShadows)-1;Pa.castShadows=0!==(Da[Wa+4]&1<<xa.CastShadows);Pa.pickable=0!==(Da[Wa+4]&1<<xa.Pickable);Pa.elevationOffset=na.elevationOffsets?.[Ma]??0}};Fa._getSymbolInfo=function(na,Da){Da=na&&na.getSymbol(Da,{arcade:this._arcade});if(!(Da instanceof S))return null;na=Da.id;if(this._symbolInfos.has(na))return this._symbolInfos.get(na);Da=la.getSymbolInfo(Da);this._symbolInfos.set(na,Da);return Da};Fa._setSymbologyOverride=function(na,
Da){this._symbologyOverride!==na&&(this._symbologyOverride=na,this._symbologyOverrideFields=Da,this._invalidateAllSymbols(),this._updateSymbologyFields())};Fa._updateSymbologyFields=function(){this._symbologyFields=l.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?l.isSome(this._rendererFields)&&0<this._rendererFields.length?E.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};
Fa._updateCachedRendererData=function(na){na.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Da=this._tmpAttributeOnlyGraphic,Ma={};Da.attributes=Ma;var Pa=this._currentRenderer,Wa=l.isSome(na.attributeInfo)&&na.attributeInfo.attributeData,$a=null!=na.featureIds?this.i3slayer.objectIdField:null,eb=null!=Wa&&l.isSome(this._symbologyFields)&&0<this._symbologyFields.length,kb=eb?[]:null,gb=eb?[]:null;if(eb&&l.isSome(this._symbologyFields))for(var lb of this._symbologyFields){var ob=
Wa[lb];ob&&(kb.push(lb),gb.push(ob))}na.cachedSymbology||(na.cachedSymbology=new Uint8Array(5*na.featureIds.length));Wa={color:jb,castShadows:!0,pickable:!0,colorMixMode:ua.ColorMixModeEnum.Multiply,edgeMaterial:null};lb=this.fullOpacity;lb=this.nodeCrossfadingEnabled?this.getNodeOpacity(na):lb;ob=null;var Eb=Ra.Transparency.OPAQUE,Gb=la.transparentEdgeMaterial,pb=0;for(let ub=0;ub<na.featureIds.length;ub++){null!=$a&&(Ma[$a]=na.featureIds[ub]);if(eb)for(var mb=0;mb<kb.length;mb++)Ma[kb[mb]]=la.getCachedAttributeValue(gb[mb],
ub);var zb=this._getSymbolInfo(Pa,Da);let Db=mb=null;if(Pa&&"visualVariables"in Pa){if(this._colorVariable){var Fb=Q.getColor(this._colorVariable,Da,{color:qb,arcade:this._arcade});Fb&&(mb=jb,mb[0]=Fb.r/255,mb[1]=Fb.g/255,mb[2]=Fb.b/255,this._opacityVariable||null===Fb.a||(Db=Fb.a))}this._opacityVariable&&(Db=Q.getOpacity(this._opacityVariable,Da,{arcade:this._arcade}))}zb&&zb.material&&(Fb=zb.material,mb=l.isNone(mb)||l.isNone(Db)?W.overrideColor(mb,Db,Fb.color,Fb.alpha,La,jb):W.overrideColor(mb,
Db,null,null,La,jb));l.isNone(mb)&&(mb=jb,mb[0]=1,mb[1]=1,mb[2]=1,mb[3]=1);Wa.pickable=!0;Wa.castShadows=zb?zb.castShadows:!0;Wa.colorMixMode=zb&&zb.material?zb.material.colorMixMode:ua.ColorMixModeEnum.Multiply;Wa.edgeMaterial=zb?zb.edgeMaterial:null;l.isSome(this._symbologyOverride)&&(Wa.color=mb,this._symbologyOverride(Da,Wa),mb=Wa.color);if(l.isSome(Wa.edgeMaterial)){zb=0>=mb[3]?Ra.Transparency.INVISIBLE:1<=mb[3]&&(na.material.isOpaque||Wa.colorMixMode===ua.ColorMixModeEnum.Replace)?Ra.Transparency.OPAQUE:
Ra.Transparency.TRANSPARENT;if(Wa.edgeMaterial!==ob||zb!==Eb)Gb={...Wa.edgeMaterial,opacity:lb,objectTransparency:zb},ob=Wa.edgeMaterial,Eb=zb;na.cachedEdgeMaterials[ub]=Gb}else na.cachedEdgeMaterials[ub]=la.transparentEdgeMaterial;na.cachedSymbology[pb+0]=Math.round(255*mb[0]);na.cachedSymbology[pb+1]=Math.round(255*mb[1]);na.cachedSymbology[pb+2]=Math.round(255*mb[2]);na.cachedSymbology[pb+3]=Math.round(255*mb[3]);na.cachedSymbology[pb+4]=Wa.colorMixMode|+Wa.castShadows<<xa.CastShadows|+Wa.pickable<<
xa.Pickable;pb+=5}}};Fa._getFilteredEdgeMaterials=function(na){var Da=this._getCachedEdgeMaterials(na);this.nodeCrossfadingEnabled||Va(Da,this.fullOpacity);if(l.isNone(na.filteredIds))return{hasEdges:Da.some(Wa=>Wa!==la.transparentEdgeMaterial),perFeatureEdgeMaterials:Da};let Ma=0,Pa=!1;Da=Da.map((Wa,$a)=>{if(na.featureIds[$a]!==na.filteredIds[Ma])return la.transparentEdgeMaterial;Pa=Pa||Wa!==la.transparentEdgeMaterial;Ma++;return Wa});return{hasEdges:Pa,perFeatureEdgeMaterials:Da}};Fa._updateComponentData=
function(na){if(this._hasComponentData){var Da=na.objectHandle;na=this._getComponentParameters(na);this._collection.setComponentData(Da,na);this._stage.renderView.requestRender()}};Fa._reloadAll=function(na=this.elevationOffset){this._removeAllNodeDataFromStage(na);null!=this._controller&&this._controller.restartNodeLoading()};Fa._opacityChange=function(na){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Da=>{l.isNone(Da)||(this._collection.updateMaterial(Da.objectHandle,
Ma=>Ma.objectOpacity=na),Va(Da.cachedEdgeMaterials,na),this._updateEdgeRendering(Da))})};Fa._updateMaterial=function(na){this._collection.updateMaterial(na.objectHandle,Da=>{Da.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Da.usePBR=this._usePBR();this._updateMaterialOverlay(Da)})};Fa._updateMaterialOverlay=function(na){};Fa._updateEngineObject=function(na){this._updateComponentData(na);this._applyFiltersToNode(na);this._addOrUpdateEdgeRendering(na);this._visibleGeometryChanged(na,
Qa.UPDATE)};Fa._slicePlaneEnabledChange=function(na){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=na);l.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=na);this._nodeId2Meta.forEach(Da=>{l.isNone(Da)||(this._collection.updateMaterial(Da.objectHandle,Ma=>{Ma.commonMaterialParameters.hasSlicePlane=na}),this._updateEdgeRendering(Da,!1))})};Fa._updatePBR=function(){this._nodeId2Meta.forEach(na=>{l.isNone(na)||this._collection.updateMaterial(na.objectHandle,Da=>{Da.usePBR=
this._usePBR()})});this._hasLoadedPBRTextures=!0};Fa._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};Fa._updateEdgeRendering=function(na,Da=!0){l.isSome(this._edgeView)&&this._edgeView.hasObject(na.objectHandle)&&this._addOrUpdateEdgeRendering(na,Da)};Fa._forAllNodes=function(na){this._nodeId2Meta.forEach(na)};Fa._forAllFeatures=function(na,Da,Ma=R.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){e.someMap(this._nodeId2Meta,Pa=>{if(l.isNone(Pa))return!1;
if(l.isSome(Da))switch(Da(Pa)){case R.ForAllFeaturesReturnType.EXIT:return!0;case R.ForAllFeaturesReturnType.SKIP:return!1}let Wa=R.ForAllFeaturesReturnType.CONTINUE;switch(Ma){case R.ForAllFeaturesVisibilityMode.ALL:Wa=this._forAllFeaturesOfNode(Pa,na);break;case R.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:Wa=this._forVisibleFeaturesOfNode(Pa,na);break;case R.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:Wa=this._forAllFeaturesOfNodeInClippingArea(Pa,na)}return Wa===R.ForAllFeaturesReturnType.EXIT})};
Fa._forAllFeaturesOfNode=function(na,Da){let Ma=R.ForAllFeaturesReturnType.CONTINUE;const Pa=na.featureIds;for(let Wa=0;Wa<Pa.length&&(Ma=Da(Pa[Wa],Wa,na),Ma!==R.ForAllFeaturesReturnType.EXIT);Wa++);return Ma};Fa._forVisibleFeaturesOfNode=function(na,Da){let Ma=R.ForAllFeaturesReturnType.CONTINUE;const Pa=na.featureIds;this._collection.forEachVisibleComponent(na.objectHandle,Wa=>{Ma=Da(Pa[Wa],Wa,na);return Ma===R.ForAllFeaturesReturnType.CONTINUE});return Ma};Fa._forAllFeaturesOfNodeInClippingArea=
function(na,Da){if(l.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(na,Da);var Ma=this._boundingRectNodeTest(na,this._renderClippingArea);if(Ma===la.MbsIntersectResult.OUTSIDE)return R.ForAllFeaturesReturnType.CONTINUE;if(Ma===la.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(na,Da);Ma=R.ForAllFeaturesReturnType.CONTINUE;const Pa=na.featureIds,Wa=la.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(na.objectHandle));for(let $a=0;$a<Pa.length;$a++){if(!this._boundingRectFeatureTest(na,
$a,Wa))continue;const eb=Da(Pa[$a],$a,na);if(eb===R.ForAllFeaturesReturnType.EXIT)return eb}return Ma};Fa._createAttributes=function(na,Da){const Ma={};null!=Da.featureIds&&(Ma[this._getObjectIdField()]=Da.featureIds[na]);Da=l.isSome(Da.attributeInfo)&&Da.attributeInfo.attributeData;if(l.isSome(Da))for(const Pa of Object.keys(Da))Ma[Pa]=la.getCachedAttributeValue(Da[Pa],na);return Ma};Fa._createGraphic=function(na,Da){return this._createLayerGraphic(this._createAttributes(na,Da))};Fa.highlight=function(na){const Da=
this._highlights;"number"===typeof na?na=[na]:na instanceof n?na=[na]:na instanceof h&&(na=na.toArray());if(Array.isArray(na)&&0<na.length){if(na[0]instanceof n){const Ma=this.i3slayer.fieldsIndex,Pa=this._getObjectIdField();na=na.map(eb=>Aa.attributeLookup(Ma,eb.attributes,Pa));const {set:Wa,handle:$a}=Da.acquireSet();Da.setFeatureIds(Wa,na);return $a}if("number"===typeof na[0]){const {set:Ma,handle:Pa}=Da.acquireSet();Da.setFeatureIds(Ma,na);return Pa}}return sb};Fa._visibleGeometryChanged=function(na,
Da){this._elevationProvider&&(this._elevationProvider.objectChanged(na.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=u.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(na,Da))};Fa.getNodeOpacityByIndex=function(na){na=this._nodeId2Meta.get(na);return this.getNodeOpacity(na)};Fa.getNodeOpacity=function(na){return l.isSome(na)?this._collection.getMaterial(na.objectHandle).objectOpacity:
0};Fa.isNodeFullyFadedIn=function(na){return this._crossfadeHelper.isNodeFullyFadedIn(na)};Fa.getNodeCrossfadeMetaData=function(na){return this._nodeId2Meta.get(na)};Fa.markNodeToRemove=function(na){this._controller&&this._controller.markNodeToRemove(na)};Fa.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Fa.foreachCrossfadeNode=function(na){this._nodeId2Meta.forEach((Da,Ma)=>na(Ma,Da))};Fa.fadeNode=function(na,Da,Ma){if(this.nodeCrossfadingEnabled){var Pa=this._nodeId2Meta.get(na);
l.isSome(Pa)&&this._crossfadeHelper.fadeNode(na,Pa,Da,Ma)}};Fa.setNodeOpacityByIndex=function(na,Da){na=this._nodeId2Meta.get(na);l.isSome(na)&&this._setNodeOpacity(na,Da)};Fa._setNodeOpacity=function(na,Da){this._collection.updateMaterial(na.objectHandle,Ma=>Ma.objectOpacity=Da);this._setNodeEdgeOpacity(na,Da)};Fa._setNodeEdgeOpacity=function(na,Da){!l.isNone(this._edgeView)&&na.cachedEdgeMaterials&&(Va(na.cachedEdgeMaterials,Da),na=na.objectHandle,this._edgeView.hasObject(na)&&this._edgeView.updateAllComponentOpacities(na,
Da).catch(Ma=>Sa(Ma,this.i3slayer.title)))};Fa.updateNodeModificationStatus=function(na){var Da=na.length;if(this.hasModifications&&!(0>=Da)&&!0===this._i3sWasmLoaded){Da=this.i3slayer.uid;var Ma=Oa(na);if(l.isSome(Ma)){X.filterObbsForModificationsSync({context:Da,buffer:Ma.buffer});const Pa=new Float64Array(Ma.buffer);na.forAll((Wa,$a)=>{$a=X.interpretObbModificationResults(Pa[$a]);Wa.imModificationImpact=$a;$a!==fa.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Wa.index)})}}};
Fa.notifyUpdate=function(){this.notifyChange("updating")};Fa.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};Fa.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||l.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||l.isSome(this._elevationTask)&&this._elevationTask.running};Fa.trackSnappingSources=function(na){var Da=
this;const Ma={events:na,fetchEdgeLocations:function(){var Pa=c._asyncToGenerator(function*(Wa,$a,eb){Wa=Da._nodeId2Meta.get(Wa);if(l.isNone(Wa))throw Error("invalid-node");const {origin:kb,buffer:gb}=yield Da._collection.extractEdgeInformation(Wa.objectHandle,$a,eb);Da._snappingLocationsApplyElevation(Wa,gb,kb);return{type:"components",objectIds:Wa.featureIds,locations:gb,origin:kb}});return function(Wa,$a,eb){return Pa.apply(this,arguments)}}(),remove:()=>{p.removeUnordered(this._snappingSourcesTrackers,
Ma)}};this._snappingSourcesTrackers.push(Ma);this._nodeId2Meta.forEach((Pa,Wa)=>{l.isNone(Pa)||(Pa=this._controller.getRenderMbs(Pa.node),l.isSome(Pa)&&na.add(Wa,Pa))});return Ma};Fa._snappingLocationsApplyElevation=function(na,Da,Ma){if(na.elevationOffsets&&this.elevationInfo.mode!==b.ElevationMode.Absolute){var Pa=Da.position0,Wa=Da.position1;Da=Da.componentIndex;var $a=G.create(),eb=G.create(),kb=(gb,lb)=>{F.add(gb,gb,Ma);this.view.renderCoordsHelper.worldUpAtPosition(gb,eb);F.add(gb,gb,F.scale(eb,
eb,lb));F.subtract(gb,gb,Ma)};for(let gb=0;gb<Pa.count;gb++){const lb=na.elevationOffsets[Da.get(gb)];Pa.getVec(gb,$a);kb($a,lb);Pa.setVec(gb,$a);Wa.getVec(gb,$a);kb($a,lb);Wa.setVec(gb,$a)}}};Fa._updateSnappingSources=function(na,Da){const {index:Ma}=na.node;na=this._controller.getRenderMbs(na.node);if(!l.isNone(na))for(const Pa of this._snappingSourcesTrackers)Da!==Qa.REMOVE&&Da!==Qa.UPDATE||Pa.events.remove(Ma),Da!==Qa.ADD&&Da!==Qa.UPDATE||Pa.events.add(Ma,na)};c._createClass(bb,[{key:"lodCrossfadeoutDuration",
get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"hasTexturesOrVertexColors",
get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return la.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||this._hasLoadedPBRTextures?aa.TextureUsage.AllTexturesPBR:aa.TextureUsage.AllTextures:this._usePBR()||this._hasLoadedPBRTextures?aa.TextureUsage.GeometryTexturesPBR:aa.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const na=null!=this.i3slayer?this.i3slayer.elevationInfo:
null;if(null!=na&&"absolute-height"===na.mode){const Da=y.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Ma=U.getMetersPerUnit(na.unit);return l.unwrapOr(na.offset,0)*Ma/Da}return 0}},{key:"elevationInfo",get:function(){const na=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==na)return{mode:b.ElevationMode.Absolute,offset:0};var Da=y.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Ma=U.getMetersPerUnit(na.unit);Da=l.unwrapOr(na.offset,0)*Ma/Da;switch(na.mode){case "absolute-height":return{mode:b.ElevationMode.Absolute,
offset:Da};case "relative-to-ground":return{mode:b.ElevationMode.RelativeToGround,offset:Da};case "on-the-ground":return{mode:b.ElevationMode.OnTheGround,offset:0};default:return{mode:b.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return ca.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){const na=0===(this.supportedTextureEncodings&aa.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&
na}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderView.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&
0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const na={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/
1048576).toFixed(1)+"MB"};l.isSome(this._memCache)&&(na.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(na.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(na));return na}},{key:"test",get:function(){const na=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Da=[];na._forAllFeatures(Ma=>{Da.push(Ma);return R.ForAllFeaturesReturnType.CONTINUE},null,R.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);
Da.sort((Ma,Pa)=>Ma-Pa);return Da},get numNodes(){return na._nodeId2Meta.size},get loadedNodes(){return Array.from(na._nodeId2Meta.keys()).sort((Da,Ma)=>Da-Ma)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&l.isSome(this._layerClippingArea)||this._modifications&&0<this._modifications.length}}]);return bb}(ab);r.__decorate([B.property()],ab.prototype,"_hasLoadedPBRTextures",void 0);r.__decorate([B.property()],ab.prototype,"_asyncModuleLoading",void 0);r.__decorate([B.property()],
ab.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);r.__decorate([B.property()],ab.prototype,"view",void 0);r.__decorate([B.property()],ab.prototype,"i3slayer",void 0);r.__decorate([B.property()],ab.prototype,"_controller",void 0);r.__decorate([B.property()],ab.prototype,"_labeler",void 0);r.__decorate([B.property()],ab.prototype,"updating",void 0);r.__decorate([B.property()],ab.prototype,"suspended",void 0);r.__decorate([B.property()],ab.prototype,"holeFilling",void 0);r.__decorate([B.property(pa.updatingProgress)],
ab.prototype,"updatingProgress",void 0);r.__decorate([B.property()],ab.prototype,"updatingProgressValue",null);r.__decorate([B.property()],ab.prototype,"hasTexturesOrVertexColors",null);r.__decorate([B.property()],ab.prototype,"rendererTextureUsage",null);r.__decorate([B.property()],ab.prototype,"elevationOffset",null);r.__decorate([B.property()],ab.prototype,"elevationInfo",null);r.__decorate([B.property({type:Boolean})],ab.prototype,"slicePlaneEnabled",void 0);r.__decorate([B.property()],ab.prototype,
"supportedTextureEncodings",null);r.__decorate([B.property()],ab.prototype,"uncompressedTextureDownsamplingEnabled",null);r.__decorate([B.property({type:[M]})],ab.prototype,"_modifications",void 0);r.__decorate([B.property()],ab.prototype,"_elevationTask",void 0);return ab=r.__decorate([k.subclass("esri.views.3d.layers.I3SMeshView3D")],ab)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P){function N(U,Y){return p.isSome(U)&&U.length===Y.length&&U.every(V=>0<=H(Y,V.name))}function H(U,Y){Y=Y.toLowerCase();for(let V=0;V<U.length;V++)if(U[V].name.toLowerCase()===Y)return V;return-1}const E=n.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");c=function(U){function Y(R){R=U.call(this,R)||this;R.screenSizeFactor=0;R.featureTarget=5E4;R.fixedFeatureTarget=!1;R.updating=!0;R.updatingProgress=1;R.leavesReached=
!1;R.scaleVisibilityEnabled=!0;R._featureLOD=1;R._stableFeatureLOD=!1;R._isIdle=!1;R._cameraDirty=!0;R._invisibleDirty=!1;R._newLoadingNodes=new g({deallocator:null});R._loadedNodeScales=new Map;R._modificationsNodeFilteringArray=new g;R._downloadingCount=0;R._loadingNodes=new Map;R._updatingNodes=new Map;R._progressMaxNumNodes=1;R._requiredAttributes=[];R._requiredAttributesDirty=!0;R._updatesDisabled=!1;R.disableIDBCache=!1;R._disableMemCache=!1;R._restartNodeLoading=!1;R._fields=null;R._attributeStorageInfo=
null;R._handles=new r;R._idleQueue=new y.PromiseQueue;R._elevationUpdateNodes=new g({deallocator:null});R._errorCount=0;return R}a._inheritsLoose(Y,U);var V=Y.prototype;V.initialize=function(){const {layerView:R,layer:X}=this;this._disableMemCache=!R.loadCachedGPUData||!R.addCachedGPUData;this._lodHandling=new q(R);this._defaultGeometrySchema=X.store.defaultGeometrySchema;this.disableIDBCache=m("disable-feature:idb-cache");"fields"in X&&(this._fields=X.fields,this._attributeStorageInfo=X.attributeStorageInfo);
this.addResolvingPromise(Promise.all([X.indexInfo,X.when(),R.when()]).then(([W])=>{if(!this.destroyed&&R&&!R.destroyed){var {view:aa}=R,{resourceController:ba}=aa;this._setClippingArea(aa.clippingArea);this.addHandles([f.watch(()=>aa?.pointsOfInterest?.focus?.renderLocation,ia=>this._pointOfInterestChanged(ia),f.initial),f.watch(()=>ba.memoryController.memoryFactor,()=>this._setCameraDirty(),f.sync),f.watch(()=>R.suspended,ia=>{const ma=ia?()=>this._updateViewData():()=>this._updateIdleState(!0),
ha=ia?()=>{}:()=>this._updateIdleState(!1);!ia&&p.isSome(this._index)&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(ia&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ma,this._idleStateCallbacks.idleEnd=ha):this._idleStateCallbacks=ba.scheduler.registerIdleStateCallbacks(ma,ha)},f.initial),C.addTask(R.view.resourceController.scheduler,{update:(ia,ma)=>this._frame(ia,ma),needsUpdate:()=>this.updating}),f.watch(()=>R.uncompressedTextureDownsamplingEnabled,
()=>this.restartNodeLoading()),f.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),f.watch(()=>aa.state?.contentCamera,()=>this._setCameraDirty()),f.watch(()=>X.elevationInfo,ia=>this._elevationInfoChanged(ia)),f.watch(()=>X.effectiveScaleRange,()=>this._scaleBoundsChanged()),f.watch(()=>R.lodFactor,()=>this._setCameraDirty()),f.watch(()=>R.availableFields,()=>this._requiredFieldsChange()),f.watch(()=>R.holeFilling,ia=>p.isSome(this._index)&&
(this._index.holeFilling=ia))]);this._updateScaleHandles();this._viewportQueries=new G(this.crsIndex,aa.renderCoordsHelper,aa.state.contentCamera,!aa.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?aa.basemapTerrain:aa.elevationProvider,B.viewingModeFromString(aa.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._index=new k.I3SIndex(X,W,this.indexStreamController,
this._viewportQueries,E,R.holeFilling,ia=>R.isNodeLoaded(ia),ia=>R.isNodeReloading(ia),ia=>this._shouldLoadNode(ia),ia=>this._enableFromGPUCache(ia,x.NodeState.Leaf),ia=>this._needsUpdate(ia),()=>!this.indexStreamController.busy,ia=>R.computeVisibilityObb?R.computeVisibilityObb(ia):null,R?.computeNodeFiltering?ia=>R.computeNodeFiltering(ia):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid);this._index.imModificationsChanged(!!R.hasModifications);this._startNodeLoading()}}));
this._tmpPoint=z.makeDehydratedPoint(0,0,0,this.crsIndex)};V.updateNodeModificationStatus=function(R){const X=this._index,W=this.layerView;p.isSome(X)&&W?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),R.forAll(aa=>{aa=X.getNode(aa);p.isSome(aa)&&this._modificationsNodeFilteringArray.push(aa)}),W.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};V.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=
!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;I.prune();p.isSome(M)&&(M.hide(),M=null)};V._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const R=this._attributeStorageInfo,X=this._fields,W=this.layer.objectIdField;return this.layerView.availableFields.map(aa=>{const ba=H(R,aa);aa=H(X,aa);return 0<=ba&&0<=aa?{index:ba,name:X[aa].name,field:X[aa],attributeStorageInfo:R[ba]}:
null}).filter(aa=>null!=aa&&aa.name!==W)};V._requiredFieldsChange=function(){const R=this._getRequiredAttributes();N(this._requiredAttributes,R)||(this._requiredAttributes=R,this._requiredAttributesDirty=!1,this.restartNodeLoading())};V.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};V._setClippingArea=function(R){const X=u.create();L.toBoundingRect(R,X,this.layerView.view.renderSpatialReference)?this._clippingArea=X:this._clippingArea=null};V._pointOfInterestChanged=
function(R){p.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(R),p.isSome(this._index)&&(this._index.progressiveLoadPenalty=Q.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};V.updateClippingArea=function(R){this._setClippingArea(R);p.isSome(this._viewportQueries)&&p.isSome(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};V._setCameraDirty=function(){this._cameraDirty=
!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};V.updateElevationChanged=function(R,X){const W=this._index;if(p.isNone(W)||p.isNone(W.rootNode)||p.isNone(X))return null;this.crsIndex.equals(X)||(w.projectBoundingRect(R,X,T,this.crsIndex),R=T);const aa=this._elevationUpdateNodes;aa.clear();F.findIntersectingNodes(R,W.rootNode,W,ba=>aa.push(ba.index));aa.length&&(aa.forAll(ba=>W.updateElevationChanged(ba)),this._setCameraDirty());return aa};V.getParentIndex=function(R){return p.isSome(this._index)&&
this._index.getParentIndex(R)};V.removeAllGeometryObbs=function(){p.isSome(this._index)&&this._index.removeAllGeometryObbs()};V.getRenderMbs=function(R){return p.isSome(this._viewportQueries)?this._viewportQueries.getRenderMbs(R):null};V._elevationInfoChanged=function(R){p.isNone(this._index)||(this._index.updateElevationInfo(R,this.isMeshPyramid),this._setCameraDirty())};V._updateScaleHandles=function(){this._handles.remove("scale-bounds");this._areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",
R=>this._scaleUpdateHandler(R)),"scale-bounds")};V._scaleBoundsChanged=function(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};V._scaleUpdateHandler=function(R){this._updateScaleInBoundingRect(R.extent,R.spatialReference);this._setCameraDirty()};V._updateScaleInBoundingRect=function(R,X){const W=this._index;p.isNone(W)||!p.isNone(W.rootNode)&&w.projectBoundingRect(R,X,T,this.crsIndex)&&this._loadedNodeScales.forEach((aa,ba)=>{aa=W.getNode(ba);
p.isSome(aa)&&u.intersectsSphere(T,aa.mbs)&&this._loadedNodeScales.set(ba,this._computeScale(aa))})};V.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};V.schedule=function(R,X){return this._idleQueue.push(R,X)};V.reschedule=function(R,X){return this._idleQueue.unshift(R,X)};V._frame=function(R,X){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||p.isNone(this._index))return-Infinity;
this._processWithErrorLogging(R,X);return this._index.maxPriority};V._processWithErrorLogging=function(R,X){try{this._process(R,X)}catch(W){50>this._errorCount?E.error("Error during processing: "+W):50===this._errorCount&&E.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};V._process=function(R,X){this._restartNodeLoading&&this._startNodeLoading();null==this._nodeLoader||p.isNone(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(R)&&
(this._invisibleDirty=!1),this._isIntegratedMesh&&(R.enabled=!1),R.run(()=>this._processIndex(R)),this._updateFeatureLOD(),R.run(()=>this._processCache(R)),this._isIntegratedMesh&&(R.enabled=!0),R.run(()=>this._processNodes(R,X)),this._idleQueue.runTask(R),R.run(()=>this._prefetchIndex()),X.numIndexLoading+=this._index.indexLoading,X.numNodesLoading+=this._downloadingCount,R.run(()=>this._lodHandling.lodGlobalHandling(R)),this._evaluateUpdating())};V._processIndex=function(R){if(p.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),R,X=>this.updateNodeModificationStatus(X)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),R=this._index.featureEstimate.leavesReached,this._index.isLoading||R===this._get("leavesReached")||this._set("leavesReached",R));return this._index.load()};
V._prefetchIndex=function(){return p.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};V._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&!p.isNone(this._index)&&!p.isNone(this._viewportQueries)){var R=!this._index.isLoading,X=this.featureTarget*this._baseLOD,W=this._index.featureEstimate;W.estimate=W.estimate||X/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=
!1}else if(R&&W.estimate<X){if(W.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(X/W.estimate,1.001));R=this._lod;X=this._index.checkFeatureTarget(X,R);X!==R&&(this._featureLOD=X/this._baseLOD,this._stableFeatureLOD=!0)}else if(W.estimate>1.2*X||R&&W.estimate>X){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(W.estimate/X-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.requestUpdate()}};V._processCache=function(R){const X=this._index;if(p.isNone(X))return!1;for(;0<this._newLoadingNodes.length&&!R.done;){var W=this._newLoadingNodes.pop();for(W=X.getParent(W);p.isSome(W)&&!this.layerView.isNodeLoaded(W.index)&&this._isNodeInScaleBounds(W);W=X.getParent(W.index))if(this._enableFromGPUCache(W,x.NodeState.Hole)){R.madeProgress();break}}return R.hasProgressed};V._processNodes=function(R,X){if(p.isNone(this._index))return!1;let W=(this._isIdle?100:2)-this._loadingNodes.size;
const aa=this._index.updates;aa.cancel.forEach(this._cancelNode,this);for(aa.cancel=[];0<aa.remove.length&&!R.done;)this.layerView.removeNode(aa.remove.pop()),R.madeProgress();for(;0<aa.update.length&&!R.done;){var ba=this._index.getNode(aa.update.pop());p.isSome(ba)&&(this._updateLoadedNode(ba),R.madeProgress())}for(;0<aa.add.length&&!R.done&&0<W;){--W;ba=this._index.getNode(aa.add.back());if(p.isNone(ba)||ba.cacheState!==x.CacheState.Cached&&!this._hasNodeLoadToken(X))break;aa.add.pop();this._loadNode(ba);
R.madeProgress()}return R.hasProgressed};V._cancelAllNodes=function(){this._loadingNodes.forEach(R=>R.abort());this._loadingNodes.clear();this._updatingNodes.forEach(R=>R.abort());this._updatingNodes.clear()};V._cancelNode=function(R){const X=this._loadingNodes.get(R);X&&(X.abort(),this._loadingNodes.delete(R))};V._hasNodeLoadToken=function(R){return!this._isIdle&&2<=R.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<K.maxDownloadSlots&&!this.dataStreamController.busy};V._evaluateUpdating=
function(){var R=!1,X=0;this.layerView.suspended?X=(R=this._cameraDirty)?0:1:(R=p.isSome(this._index)?this._index.indexMissing:0,X=p.isSome(this._index)?this._index.updates.add.length:0,X=R+3*X+2*this._loadingNodes.size,R=!!(0<X||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||p.isSome(this._index)&&this._index.isPrefetching),0===X&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=
Math.max(X,this._progressMaxNumNodes),X=1-X/this._progressMaxNumNodes);this.updating=R;this.updatingProgress=X};V._updateViewData=function(){if(this._cameraDirty&&!p.isNone(this._index)&&!p.isNone(this._viewportQueries)){var R=this.layerView.view,{contentCamera:X,fixedContentCamera:W}=R.state;this.screenSizeFactor=1/(X.perScreenPixelRatio/2);this._viewportQueries.updateCamera(X,!W||this.isGraphics3D);this._viewportQueries.setPointOfInterest(R.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=Q.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};V._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};V.isGeometryVisible=function(R){return p.isSome(this._index)&&this._index.isGeometryVisible(R.index)};
V.updateVisibility=function(R){p.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(R)};V.invalidateGeometryVisibility=function(R){p.isSome(this._index)&&this._index.invalidateGeometryVisibility(R)};V.invalidateVisibilityObbs=function(){p.isSome(this._index)&&this._index.invalidateVisibilityObbs()};V.modificationsChanged=function(){p.isSome(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications);this._invisibleDirty=!0};V._shouldLoadNode=function(R){return!this._lodHandling.shouldLoadNode(R)||
this._shouldDropNode(R)||p.isNone(this._index)||!this._index.isGeometryVisible(R.index)?!1:this._isNodeInScaleBounds(R)};V._shouldDropNode=function(R){if(p.isNone(this._viewportQueries))return!1;const X=this._lodDropFactor;return 1<=X||!this._lodHandling.hasNoVisibleChildren(R)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(R))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*X};V._startNodeLoading=function(){this._restartNodeLoading=
!1;const R=this._index;this._updatesDisabled||p.isNone(R)||p.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new v(this.layer,this.dataStreamController,E,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,
textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),R.requestUpdate(),this._lodHandling.startNodeLoading(X=>this._isNodeInScaleBounds(X),(X,W)=>this._removeNodes(X,W,S.fadeout),R,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};V.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};V.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};V._removeInvisibleNodes=function(R){const X=this._index;if(p.isNone(X)||p.isNone(this._viewportQueries))return!1;I.clear();this.layerView.getLoadedNodeIndices(I);const W=0===this._viewportQueries.maxDistance,aa=W?()=>!1:ba=>this._shouldDropNode(ba);I.filterInPlace(ba=>{const ia=X.getNode(ba);return p.isNone(ia)||!X.isGeometryVisible(ba)||aa(ia)||!this._isNodeInScaleBounds(ia)});0<I.length&&this._lodHandling.setLodGlobalDirty();
this._removeNodes(I,R,S.pop);if(W&&1>this._lodDropFactor)return!1;if(0===I.length)return!0;I.clear();return!1};V.markNodeToRemove=function(R){I.push(R)};V.removeMarkedNodes=function(){this._removeNodes(I,P.noBudget,S.pop)};V._removeNodes=function(R,X,W){const aa=R.length;if(0!==aa&&!X.done){for(p.isSome(this._index)&&this._index.requestUpdate();0<R.length&&!X.done;){const ba=R.pop(),ia=this._index;W===S.fadeout&&this.layerView.nodeFadeoutEnabled&&p.isSome(ia)&&ia.isGeometryVisible(ba)?this.layerView.fadeNode(ba,
J.FadeDirection.FadeOut,!0):this.layerView.removeNode(ba);X.madeProgress()}if(0<this._loadedNodeScales.size)for(X=R.length;X<aa;X++)this._loadedNodeScales.delete(R.data[X])}};V._needsUpdate=function(R){if(!R.resources.hasFeatureData||this._updatingNodes.has(R.index))return!1;R=this.layerView.getLoadedAttributes(R.index);return null!=R&&R!==this._requiredAttributes};V._updateLoadedNode=function(R){const X=new AbortController;this._updatingNodes.set(R.index,X);const W=this.layerView.getLoadedAttributes(R.index);
(N(W,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(R.index)):this._nodeLoader.loadAttributes(R,this._requiredAttributes,X.signal)).then(aa=>this.schedule(()=>this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:aa},X.signal),X.signal)).catch(aa=>{if(!d.isAbortError(aa))return this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},X.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(R.index);
this._evaluateUpdating()});this._evaluateUpdating()};V._loadNode=function(R){if(this._loadingNodes.has(R.index))E.error("already loading node "+R.index);else{var X=new AbortController;this._loadingNodes.set(R.index,X);this._evaluateUpdating();this._loadAndAddNode(R,X.signal).then(W=>{W&&p.isSome(this._index)&&this._loadingNodes.get(R.index)===X&&(this._loadingNodes.delete(R.index),this._index.requestUpdate())}).catch(W=>{if(!d.isAbortError(W))throw W;}).finally(()=>{this._loadingNodes.get(R.index)===
X&&this._loadingNodes.delete(R.index);this._evaluateUpdating()})}};V._loadAndAddNode=function(R,X){return R.cacheState===x.CacheState.Uncached?this._loadUncached(R,X).then(()=>!1):this._loadCached(R,X).then(W=>{if(W)return!1;R.cacheState=x.CacheState.Uncached;return!0}).catch(W=>d.isAbortError(W)?!1:(R.cacheState=x.CacheState.Uncached,!0))};V._enableFromGPUCache=function(R,X){if(this._disableMemCache||p.isNone(this._index))return!1;if(X===x.NodeState.Hole&&!this._index.useNodeAsHole(R.index))return!0;
const W=this._loadCachedGPUData(R);if(!W)return!1;this.layerView.addCachedGPUData(R,W,X);this._nodeAdded();return!0};V._loadCachedGPUData=function(R){R=this.layerView.loadCachedGPUData(R);if(p.isSome(R)&&p.isSome(R.attributeInfo)&&N(R.attributeInfo.loadedAttributes,this._requiredAttributes))return R;this.layerView.deleteCachedGPUData(R);return null};V._nodeAdded=function(){p.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};V.updateLoadStatus=
function(R,X){const W=this._index;p.isSome(W)&&W.updateChildrenLoaded(R,X?1:-1)};V._loadCached=function(R,X){if(this._enableFromGPUCache(R,x.NodeState.Leaf))return Promise.resolve(!0);const W=this.layerView;return!this.disableIDBCache&&W.loadCachedNodeData&&W.addCachedNodeData?this.schedule(()=>W.loadCachedNodeData(R,X,(aa,ba)=>this._nodeLoader.loadTextures(R,aa,ba)),X).then(aa=>{if(p.isNone(aa))return!1;const ba=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(R,
ba,X),X).then(ia=>this.reschedule(()=>W.addCachedNodeData(R,aa,{loadedAttributes:ba,attributeData:ia},X),X)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};V._loadUncached=function(R,X){this._downloadingCount++;return this._nodeLoader.loadNodeData(R,X).catch(W=>{this._downloadingCount--;throw W;}).then(W=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(R,W,X),X)}).then(()=>{this._nodeAdded();R.cacheState=x.CacheState.Cached}).catch(W=>{if(!d.isAbortError(W))throw E.error("#loadNodeData()",
this.layer,`Failed to load node '${R.id}'`,W),R.failed=!0,p.isSome(this._index)&&this._index.requestUpdate(),W;})};V._updateIdleState=function(R){R!==this._isIdle&&(this._isIdle=R,this._evaluateUpdating(),R&&this._index&&p.isSome(this._index)&&this._index.resetFailedNodes())};V._getScale=function(R){if(this._loadedNodeScales.has(R.index))return this._loadedNodeScales.get(R.index);const X=this._computeScale(R);this.layerView.isNodeLoaded(R.index)&&this._loadedNodeScales.set(R.index,X);return X};V._computeScale=
function(R){this._tmpPoint.x=R.mbs[0];this._tmpPoint.y=R.mbs[1];this._tmpPoint.z=R.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,R.mbs[3])};V._isNodeInScaleBounds=function(R){if(!this._areScaleBoundsActive)return!0;R=this._getScale(R);const {minScale:X,maxScale:W}=O.extractSafeScaleBounds(this.layer);return O.scaleBoundsPredicate(R,X,W)};V.updateStats=function(R){R.index=p.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(R.detail=this._featureLOD,R.target=
this.featureTarget*this._baseLOD);p.isSome(this._index)&&this._index.updateStats(R)};V.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();p.isSome(this._index)&&this._index.requestUpdate()};V.geometryFilterChanged=function(R){const X=this._index;p.isSome(X)&&X.layerFilterChanged(R);this._setCameraDirty()};a._createClass(Y,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",
get:function(){return"points"===this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(p.isNone(this.layer.priority)||"High"===this.layer.priority)}},{key:"indexStreamController",get:function(){const R=this.layerView.view.resourceController.createStreamDataRequester(K.ClientType.I3S_INDEX);return new D.I3SStreamDataController(R,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const R=this.layerView.view.resourceController.createStreamDataRequester(K.ClientType.I3S_DATA);
return new D.I3SStreamDataController(R,this.layer.apiKey)}},{key:"crsVertex",get:function(){return F.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return F.getIndexCrs(this.layer)}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"rootNodeVisible",get:function(){if(p.isSome(this._index)){const R=this._index.rootNode;if(p.isSome(R))return this._updateViewData(),this._index.isNodeVisible(R.index)}return!0}},{key:"index",get:function(){return this._index}},{key:"_isIntegratedMesh",
get:function(){return"integrated-mesh"===this.layer.type}},{key:"_areScaleBoundsActive",get:function(){const {minScale:R,maxScale:X}=O.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<R||0<X)}},{key:"unloadedMemoryEstimate",get:function(){return p.isNone(this._index)||this.layerView.suspended?0:this._index.unloadedMemoryEstimate*this._lodDropFactor}},{key:"indexDepth",get:function(){return p.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(R){this.layerView.loadCachedGPUData&&
this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=R}},{key:"_lod",get:function(){return this._featureLOD*this._baseLOD}},{key:"_baseLOD",get:function(){const R=this.layerView.lodFactor,X=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<R?R:1)*X}},{key:"_lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const R=this.layerView.view.resourceController.memoryController;return(Math.min(R.memoryFactor,
.5)-R.minQuality)/(.5-R.minQuality)}},{key:"test",get:function(){const R=this;return{index:this._index,set disableUpdates(X){(R._updatesDisabled=X)?R.cancelNodeLoading():R.requestUpdate()},set disableIDBCache(X){R.disableIDBCache=X},set ignoreServiceObb(X){p.isSome(R._index)&&(R._index.ignoreServiceObb=X)},shouldLoadNode:X=>R._shouldLoadNode(X)}}}]);return Y}(h.EsriPromiseMixin(c));b.__decorate([e.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);b.__decorate([e.property({readOnly:!0})],
c.prototype,"isGraphics3D",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"useMaximumNumberOfFeatures",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"indexStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"dataStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsVertex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsIndex",null);b.__decorate([e.property()],c.prototype,"screenSizeFactor",void 0);b.__decorate([e.property()],
c.prototype,"featureTarget",void 0);b.__decorate([e.property()],c.prototype,"fixedFeatureTarget",void 0);b.__decorate([e.property()],c.prototype,"layerView",void 0);b.__decorate([e.property()],c.prototype,"layer",null);b.__decorate([e.property({})],c.prototype,"updating",void 0);b.__decorate([e.property({})],c.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"leavesReached",void 0);b.__decorate([e.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",
void 0);b.__decorate([e.property({readOnly:!0,dependsOn:[]})],c.prototype,"rootNodeVisible",null);c=b.__decorate([t.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c);const I=new g({deallocator:null});let M;const Q={factorIM:.2,factor3dObject:.05,distancePenalty:10},T=u.create();var S;(function(U){U[U.pop=0]="pop";U[U.fadeout=1]="fadeout"})(S||(S={}));return c})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/arrayUtils","../../../../core/maybe","../../../support/Scheduler"],function(a,b,c,r,m){let n=function(){function g(d){this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=d.registerTask(m.TaskPriority.I3S_CONTROLLER,this)}var h=g.prototype;h.destroy=function(){this.handle=r.removeMaybe(this.handle)};h.runTask=function(d){this._sort();const f=this.callbacks,e={numIndexLoading:0,numNodesLoading:0};for(let l=0;l<f.length&&!d.done;++l)f[l].priority=f[l].update(d,e),this.runIndex=
l};h._sort=function(){const d=this.callbacks;let f=d.length;for(let e=this.runIndex;0<e;e--){const l=d[e-1];let A=e;for(;A<d.length&&l.priority<=d[A].priority&&(A!==f||l.priority<d[A].priority);)d[A-1]=d[A],A++;d[A-1]=l;f=A-1}this.runIndex=0};h.add=function(d){this._sort();d.priority=Infinity;this.callbacks.unshift(d)};h.remove=function(d){c.removeUnordered(this.callbacks,d);this.runIndex=this.callbacks.length;this._sort()};b._createClass(g,[{key:"running",get:function(){for(const d of this.callbacks)if(d.needsUpdate())return!0;
return!1}}]);return g}();const p=new Map;a.addTask=function(g,h){let d=p.get(g);null==d&&(d=new n(g),p.set(g,d));d.add(h);return{remove:()=>{null!=d&&(d.remove(h),0<d.callbacks.length||(p.delete(g),d.destroy()),d=null)}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,r,m,n,p,g,h,d){function f(k){c.isSome(k.node)&&(h.invalidateMbs(k.node.renderMbs),h.invalidateObb(k.node.serviceObbInRenderSR));c.isSome(k.ref)&&(h.invalidateMbs(k.ref.renderMbs),h.invalidateObb(k.ref.serviceObbInRenderSR))}function e(k,q){return 0===q?0:k/q|0}function l(k,q){return 0===q?k:k%q}function A(k){if(k)for(let q=0;q<k.length;q++)for(const x of B)if(x[0]===k[q].metricType)return{lodMetric:x[1],maxError:k[q].maxError};return{lodMetric:g.LodMetric.None,maxError:0}}function t(k){return Math.sqrt(4/
Math.PI*k)}let w=function(k,q,x,v,D){this.childOffset=k;this.childCount=q;this.visibilityCache=x;this.ref=v;this.node=D;this.useAsHole=0;this.filterImpact=g.NodeFilterImpact.NotChecked},u=function(){function k(x,v,D,F,G,J,L,K,O,P,N,H,E,I){this._streamDataController=D;this._viewportQueries=F;this._logger=G;this.holeFilling=J;this._isLoaded=L;this._isReloading=K;this._isSelected=O;this._enable=P;this._needsUpdate=N;this._canRequest=H;this._computeVisibilityObb=E;this._computeNodeFiltering=I;this._dirty=
!0;this._nodePages=[];this._rootIndex=this._nodesPerPage=this._nodeCount=0;this._lodMetric=g.LodMetric.None;this._lodConversion=M=>M;this._urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=h.addWraparound(0,2);this._visibilityCacheVersion=h.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,
leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new r({deallocator:null});this._prefetch=new r({deallocator:null});this._updates=new y(this._missing);this._imModificationUncategorized=new r({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._logLayer=x;x.serviceUpdateTimeStamp&&x.serviceUpdateTimeStamp.lastUpdate&&(this._lastUpdate=`${x.serviceUpdateTimeStamp.lastUpdate}`);
this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(v)}var q=k.prototype;q._init=function(x){if("page"===x.type){this._urlPrefix=x.urlPrefix;this._nodesPerPage=x.pageSize;this._rootIndex=x.rootIndex;switch(x.lodMetric){case "maxScreenThreshold":this._lodMetric=g.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=g.LodMetric.MaxScreenThreshold,this._lodConversion=t}this._addPage(e(this._rootIndex,this._nodesPerPage),x.rootPage);this._updateParentsAndLevel()}else"node"===
x.type&&(this._urlPrefix=x.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this._makeRefNode(new g.NodeBase(x.rootNode.id,null),-1),(x=this._validateNode(x.rootNode.id,x.rootNode))&&this._addNode(x,0))};q._loadPage=function(x){this._loading.add(x);this._streamDataController.request(this._urlPrefix+x,"json").then(v=>{this._pageQueue.push({pageIndex:x,page:v})}).catch(v=>{this._loading.delete(x);m.isAbortError(v)||(this._failedPages.add(x),this._logger.error("#loadPage()",this._logLayer,
`Error when loading page ${x}`,v))})};q._addQueuedPages=function(x){for(;0<this._pageQueue.length&&!x.done;){const {pageIndex:v,page:D}=this._pageQueue.shift();this._addPage(v,D);this._loading.delete(v);x.madeProgress()}this._updateParentsAndLevel()};q._addPage=function(x,v){for(let G=this._nodePages.length;G<x;G++)this._nodePages[G]=null;const D=[],F=[];v=v.nodes.map((G,J)=>{const L=D.length,K=G.children?G.children.length:0;F.push(-1);for(var O=0;O<K;O++)D.push(G.children[O]);const P=`${G.index}`;
O=d.clone(G.obb);const N=p.fromArray([O.center[0],O.center[1],O.center[2],n.length(O.halfSize)]),H=G.mesh&&G.mesh.attribute,E=G.mesh&&G.mesh.geometry,I=G.mesh&&G.mesh.material;G=new g.Node(P,x*this._nodesPerPage+J,N,K,0,{hasSharedResource:!1,hasFeatureData:!!E,attributes:H&&null!=H.resource?`${H.resource}`:null,geometry:E&&null!=E.resource?`${E.resource}`:null,texture:I&&null!=I.resource?`${I.resource}`:null,geometryDefinition:E?E.definition:-1,materialDefinition:I?I.definition:-1},this._lastUpdate,
this._lodMetric,this._lodConversion(G.lodThreshold),E?E.featureCount:null);G.serviceObb=O;G.visibilityObb=this._computeVisibilityObb(G);G.vertexCount=E?E.vertexCount:0;return new w(L,K,h.addWraparound(this._visibilityCacheVersion,-2),null,G)});this._nodePages[x]={nodes:v,children:D,parents:F};this._nodeCount+=v.length};q._updateParentsAndLevel=function(){const x=[],v=(D,F,G)=>{const J=this._getPage(D);if(c.isSome(J)){const L=l(D,this._nodesPerPage);J.parents[L]=F;F=J.nodes[L].node;c.isSome(F)&&(F.level=
G,x.push(D))}};for(v(this._rootIndex,-1,0);x.length;){const D=x.pop(),F=this.getNode(D);if(c.isSome(F))for(let G=0;G<F.childCount;G++){const J=this.getChildIndex(F.index,G);v(J,D,F.level+1);this._maxLevel=Math.max(this._maxLevel,F.level+1)}}};q._getPage=function(x){return this._nodePages[e(x,this._nodesPerPage)]};q._getNodeInternal=function(x){const v=this._getPage(x);return c.isNone(v)?null:v.nodes[l(x,this._nodesPerPage)]};q._addNode=function(x,v){null!=x.children&&this.populateChildren(v,x.children);
var D=this.getParent(v);D=c.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,x.children?D+1:D);const {lodMetric:F,maxError:G}=A(x.lodSelection),J=c.unwrap(this._getNodeInternal(v));J.node=new g.Node(x.id,v,p.fromArray(x.mbs),J.childCount,D,x.resources,x.version,F,G,x.numFeatures);x.obb&&(J.node.serviceObb=d.clone(x.obb));J.node.visibilityObb=this._computeVisibilityObb(J.node);c.isSome(J.ref)&&(null==J.ref.mbs&&(J.ref.mbs=x.mbs),J.node.renderMbs=J.ref.renderMbs,J.node.serviceObbInRenderSR=
J.ref.serviceObbInRenderSR,J.ref.visibilityObb=J.node.visibilityObb);return J.node};q._makeRefNode=function(x,v){const D=this._nodePages[0],F=D.nodes.length;D.nodes.push(new w(0,0,h.addWraparound(this._visibilityCacheVersion,-2),x,null));this._nodeCount++;D.parents.push(v);h.invalidateMbs(x.renderMbs);h.invalidateObb(x.serviceObbInRenderSR);return F};q.populateChildren=function(x,v){var D=c.unwrap(this._getNodeInternal(x));const F=c.unwrap(this._getPage(x));D.childOffset=F.children.length;D.childCount=
v.length;for(D=0;D<v.length;D++){const G=this._makeRefNode(v[D],x);F.children.push(G)}};q.getNode=function(x){x=this._getNodeInternal(x);return c.isSome(x)?x.node:null};q.getIndexById=function(x){let v;this._forAllNodes((D,F)=>{c.isSome(D.node)&&D.node.id===x?v=F:c.isSome(D.ref)&&D.ref.id===x&&(v=F)});return v};q.getNodeById=function(x){x=this.getIndexById(x);return 0<=x?this.getNode(x):null};q.getChildIndex=function(x,v){const D=this._getPage(x);if(c.isNone(D))return-1;x=D.nodes[l(x,this._nodesPerPage)];
return D.children[x.childOffset+v]};q.getParentIndex=function(x){const v=this._getPage(x);return c.isSome(v)?v.parents[l(x,this._nodesPerPage)]:-1};q.getParent=function(x){x=this.getParentIndex(x);return 0<=x?this.getNode(x):null};q.isLeaf=function(x){x=this._getNodeInternal(x);return c.isSome(x)&&0===x.childCount};q.removeAllGeometryObbs=function(){this._forAllNodes(x=>{c.isSome(x.node)&&(x.node.geometryObb=null)})};q.invalidateVisibilityCache=function(){this._visibilityCacheVersion=h.addWraparound(this._visibilityCacheVersion,
2)};q.invalidateNodeVisibilityCache=function(x){x=this._getNodeInternal(x);c.isSome(x)&&this.invalidateNodeVisibilityCacheInternal(x)};q.invalidateNodeVisibilityCacheInternal=function(x){x.visibilityCache=h.addWraparound(this._visibilityCacheVersion,-2)};q.invalidateBoundingVolumeCache=function(x){x=this._getNodeInternal(x);c.isSome(x)&&(f(x),this.invalidateNodeVisibilityCacheInternal(x))};q.updateElevationChanged=function(x){const v=this._getNodeInternal(x);c.isNone(v)||(this.needNodeElevationRange?
(x=c.isSome(v.node)?v.node:v.ref,c.isNone(x)||(x=x.elevationRange,c.isNone(x)||(x.valid=!1))):this.invalidateBoundingVolumeCache(x))};q.invalidateGeometryVisibility=function(x){x=this._getNodeInternal(x);c.isSome(x)&&c.isSome(x.node)&&(x.node.geometryObb=null,h.invalidateMbs(x.node.renderMbs),h.invalidateObb(x.node.serviceObbInRenderSR))};q.invalidateVisibilityObbs=function(){c.isNone(this.rootNode)||this.traverse(this.rootNode,x=>{x.visibilityObb=this._computeVisibilityObb(x);x.geometryObb=null;
return!0})};q._updateElevationRange=function(x){var v=this._getNodeInternal(x);if(c.isNone(v))return null;const D=c.isSome(v.node)?v.node:v.ref;if(c.isNone(D))return null;const F=D.elevationRange;if(c.isSome(F)&&F.valid)return F;const G=new g.ElevationRange;let J=!1;for(let L=0;L<v.childCount;L++){const K=this._updateElevationRange(this.getChildIndex(x,L));c.isNone(K)?J=!0:(G.min=Math.min(G.min,K.min),G.max=Math.max(G.max,K.max))}if(0===v.childCount||J&&c.isSome(v.node)&&v.node.resources.geometry)v=
this._viewportQueries.getElevationRange(D),c.isSome(v)&&(G.min=Math.min(G.min,v.min),G.max=Math.max(G.max,v.max));if(c.isSome(F)&&F.min===G.min&&F.max===G.max)return F.valid=!0,F;G.valid=!0;D.elevationRange=G;this.invalidateBoundingVolumeCache(x);return G};q.isNodeVisible=function(x){const v=this._getNodeInternal(x);if(c.isNone(v)||c.isSome(v.ref)&&!v.ref.mbs)return!0;this.needNodeElevationRange&&this._updateElevationRange(x);if((v.visibilityCache&-2)!==this._visibilityCacheVersion){x=v.node;const F=
c.isSome(x)&&(c.isNone(v.ref)||c.isSome(x.visibilityObb))?x:c.isSome(v.ref)?v.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(c.isSome(x)||c.isSome(v.ref))&&v.filterImpact===g.NodeFilterImpact.NotChecked){var D=c.isSome(x)?x.mbs:c.isSome(v.ref)?v.ref.mbs:null;v.filterImpact=null!=D?this._computeNodeFiltering(D):g.NodeFilterImpact.Unmodified}D=c.isSome(x)&&v.filterImpact===g.NodeFilterImpact.Culled;x=!(c.isSome(x)&&x.imModificationImpact===g.NodeIMModificationImpact.Culled)&&(!F||this._viewportQueries.isNodeVisible(F))&&
!D;v.visibilityCache=this._visibilityCacheVersion+(x?1:0);return x}return 1===(v.visibilityCache&1)};q.isGeometryVisible=function(x){if(!this.isNodeVisible(x))return!1;x=this._getNodeInternal(x);return c.isSome(x)&&c.isSome(x.node)&&c.isSome(x.node.geometryObb)&&(!this.layerHasModifications||x.node.imModificationImpact!==g.NodeIMModificationImpact.NotChecked)?this._viewportQueries.isGeometryVisible(x.node):!0};q._traverseCoverage=function(x,v,D,F,G){x=this._getPage(x);if(!c.isNone(x)&&0!==v.childCount){var J=
v.childOffset+v.childCount,L=[];for(v=v.childOffset;v<J;++v){const K=x.children[v],O=this._getNodeInternal(K);c.isSome(O)&&c.isSome(O.node)&&this.isGeometryVisible(K)&&L.push(O)}F/=L.length;for(const K of L)x=c.unwrap(K.node).index,this._isLoaded(x)||this._isReloading(x)?(G.delta=Math.max(G.delta,D),G.coverage+=F):this._traverseCoverage(x,K,D+1,F,G)}};q.useNodeAsHole=function(x){if("off"===this.holeFilling)return!1;const v=this._getNodeInternal(x);if(c.isNone(v))return!1;if("always"===this.holeFilling)return!0;
if((v.useAsHole&-2)===this._version)return 1===(v.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(x,v,0,1,D);x=.5>=D.delta*D.coverage;v.useAsHole=this._version+(x?1:0);return x};q.destroy=function(){this._updates.add.prune();this._updates.update.prune()};q.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=h.addWraparound(this._version,2)};q.imModificationsChanged=function(x){this.layerHasModifications=x;this._forAllNodes(({node:v})=>{c.isSome(v)&&(v.imModificationImpact=
g.NodeIMModificationImpact.NotChecked,v.visibilityObb=this._computeVisibilityObb(v),v.hasModifications&&this.invalidateGeometryVisibility(v.index))});this.invalidateVisibilityCache()};q.layerFilterChanged=function(x){this._layerHasFilter=x;this._forAllNodes(v=>{c.isSome(v)&&(v.filterImpact=g.NodeFilterImpact.NotChecked,v=v.node,c.isSome(v)&&this.invalidateNodeVisibilityCache(v.index))});this.invalidateVisibilityCache()};q.update=function(x,v,D){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(v);
this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(x);z.clear();var F=!0,G=new C,J=new C,L=this._imModificationUncategorized;L.clear();var K=new Set;this.traverseVisible((P,N,H)=>{if(c.isNone(N))N=this._entryPriority(P),Infinity===N&&(N=this._entryPriority(H)),P=e(P,this._nodesPerPage),z.set(P,Math.max(N,z.get(P)||0)),this._loading.has(P)||this._failedPages.has(P)||this._missing.push(P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,
N);else{var E=N.node;this._updateNodeFeatureEstimate(E,J);if(c.isNone(E))N=this._entryPriority(P),this._loading.has(P)||this._failedNodes.has(P)||(this._missing.push(P),z.set(P,N)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,N);else{H=c.unwrap(this._getPage(P));if(0===this._missing.length&&0===this._nodesPerPage)for(let I=0;I<N.childCount;I++){const M=H.children[N.childOffset+I],Q=this._getNodeInternal(M);!c.isSome(Q)||Q.node||this._loading.has(M)||this._failedNodes.has(M)||(z.set(M,
this._entryPriority(M)),this._prefetch.push(M))}E.failed||!E.resources.hasFeatureData?F&&0<N.childCount&&this._isSelected(E)&&(F=!1):(K.add(E.id),this._isLoaded(P)?(G.known+=E.memory,++G.knownNodes,this._isSelected(E)?0<N.childCount&&(F=!1):(G.unremoved+=E.memory,F=!1),this._needsUpdate(E)&&(N=this._entryPriority(P),z.set(P,N),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,N),this._updates.update.push(P))):(E.memory&&(G.known+=E.memory,++G.knownNodes),this._isSelected(E)?(0<N.childCount&&
(F=!1),E.memory?(G.missing+=E.memory,G.known+=E.memory,++G.knownNodes):++G.missingNodes,x.includes(E.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(P)),this._updates.cancel=this._updates.cancel.filter(I=>I!==E.index)):!v.done&&this._enable(E)?v.madeProgress():(N=this._entryPriority(P),z.set(P,N),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,N),this._updates.add.push(P),this.layerHasModifications&&D&&c.isSome(E)&&E.imModificationImpact===g.NodeIMModificationImpact.NotChecked&&
L.push(P))):this._isReloading(P)&&this._updates.remove.push(P)))}}});var O=this._updates.add;0<O.length&&this.layerHasModifications&&(0<L.length&&D(L),O.filterInPlace(P=>{var N=this._getNodeInternal(P);(N=c.isNone(N)||c.isNone(N.node)||N.node.imModificationImpact!==g.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(P);return N}));this._unloadedMemoryEstimate=G.missing-G.unremoved;3<G.knownNodes&&0<G.missingNodes&&(this._unloadedMemoryEstimate+=G.known/G.knownNodes*G.missingNodes);
this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(J);this._featureEstimate.leavesReached=F;this._missing.sort((P,N)=>P-N);this._missing.filterInPlace((P,N)=>1>N||this._missing.data[N-1]!==P);this._missing.sort((P,N)=>z.get(P)-z.get(N));0<this._missing.length&&(this._maxUnloadedPrio=z.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(P=>z.get(P)>=this._maxUnloadedPrio).sort((P,N)=>z.get(P)-
z.get(N));this._updates.update.sort((P,N)=>z.get(P)-z.get(N));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;z.clear()}};q.checkFeatureTarget=function(x,v){const D=this._viewportQueries.updateScreenSpaceErrorBias(v);let F=v,G=v,J=D,L=10;for(;L--;){const K=new C;this._updateFeatureEstimate(F,K);if(this._computeFeatureEstimate(K)<=x){if(F>=v||0<K.missingNodes||0===L)break;J=F;F=.5*(F+G)}else G=F,F=.5*(F+J)}this._version=h.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(D);
return Math.min(v,F)};q._updateFeatureEstimate=function(x,v){this._version=h.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(x);this.traverseVisible((D,F)=>this._updateNodeFeatureEstimate(c.isSome(F)&&F.node,v))};q._updateNodeFeatureEstimate=function(x,v){c.isNone(x)||x.failed||c.isNone(x.numFeatures)||(this._isLoaded(x.index)?(v.known+=x.numFeatures,++v.knownNodes,this._isSelected(x)||(v.unremoved+=x.numFeatures)):this._isSelected(x)&&(c.isSome(x.numFeatures)?(v.missing+=
x.numFeatures,v.known+=x.numFeatures,++v.knownNodes):++v.missingNodes))};q._computeFeatureEstimate=function(x){let v=x.known-x.unremoved;3<x.knownNodes&&0<x.missingNodes&&(v+=x.known/x.knownNodes*x.missingNodes);return Math.max(0,v)};q.load=function(){return this._load(this._missing)};q.prefetch=function(){this._prefetch.sort((x,v)=>z.get(x)-z.get(v));return this._load(this._prefetch)};q._load=function(x){if(0===x.length||!this._canRequest())return!1;for(;0<x.length&&this._canRequest();)0===this._nodesPerPage?
this._loadNode(x.pop()):this._loadPage(x.pop());return!0};q.nodeTraversalState=function(x){if(c.isNone(x))return null;let v=this._nodeTraversalState.get(x.index);if(v&&(v.version&-2)===this._version)return v;const D=this._viewportQueries.getLodLevel(x),F=this._viewportQueries.hasLOD(x);var G=!0;F?(G=this.getParentIndex(x.index),G=0<=G?(G=this._nodeTraversalState.get(G))&&D>G.lodLevel:0<D):G=0===x.childCount;if(v)return v.lodLevel=D,v.isChosen=G,v.version=this._version+1,v;v=new g.NodeTraversalState(F,
G,D,this._version+1);this._nodeTraversalState.set(x.index,v);return v};q._loadNode=function(x){this._loading.add(x);const v=c.unwrap(this._getNodeInternal(x)).ref;if(c.isNone(v))this._failedNodes.add(x);else{var D=v.id,F=this._urlPrefix+D,G=()=>{this._loading.delete(x);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this._streamDataController.request(F,"json").then(J=>{G();J=this._validateNode(D,J);null!=J&&(J.obb&&this.invalidateNodeVisibilityCache(x),J=this._addNode(J,x),
this.nodeTraversalState(J))},J=>{G();m.isAbortError(J)||(this._logger.error("#loadNode()",this._logLayer,"Error loading node: "+F),this._failedNodes.add(x))})}};q._validateNode=function(x,v){if(null==v||"object"!==typeof v||v.id!==x)return this._logger.error("#validateNode()",this._logLayer,`Invalid node. Wrong type or wrong id "${x}"`),null;if(!Array.isArray(v.mbs))return this._logger.error("#validateNode()",this._logLayer,`Invalid bounding volume on node ${x}.`),null;v.sharedResource&&"./shared"!==
v.sharedResource.href&&"./shared/"!==v.sharedResource.href&&this._logger.warn("#validateNode()",this._logLayer,`Invalid shared resource href on node "${x}"`);null==v.geometryData||Array.isArray(v.geometryData)&&1===v.geometryData.length&&"./geometries/0"===v.geometryData[0].href||this._logger.warn("#validateNode()",this._logLayer,`Invalid geometry data on node "${x}"`);null==v.attributeData||Array.isArray(v.attributeData)&&!v.attributeData.some((J,L)=>J.href!==`./attributes/f_${L}/0`)||this._logger.warn("#validateNode()",
this._logLayer,`Invalid attribute data on node "${x}"`);v.featureData&&1<v.featureData.length&&this._logger.warn("#validateNode()",this._logLayer,`Node ${x} has ${v.featureData.length} bundles. Only the first bundle will be loaded.`);const D=v.hasOwnProperty("obb")&&!this.ignoreServiceObb?v.obb:null,F=v.featureData&&1===v.featureData.length&&v.featureData[0].featureRange?v.featureData[0].featureRange[1]-v.featureData[0].featureRange[0]+1:null;var G=J=>{if(null==J)return null;var L=K=>this._logger.error("#validateNode()",
this._logLayer,`Invalid node reference on node ${x}: ${K}`);if("number"===typeof J.id)L(`id ${J.id} is a number instead of a string.`);else if("string"!==typeof J.id||!Array.isArray(J.mbs))return L("Missing or invalid id."),null;if(!Array.isArray(J.mbs))return L(`Invalid bounding volume on reference ${J.id}.`),null;J.href&&J.href!=="../"+J.id&&this._logger.error("#validateNode()",this._logLayer,`Invalid node href on node "${x}"`);L=J.hasOwnProperty("obb")&&!this.ignoreServiceObb?J.obb:null;J=new g.NodeBase(`${J.id}`,
J.mbs);J.serviceObb=L;J.visibilityObb=this._computeVisibilityObb(J);return J};G=Array.isArray(v.children)?v.children.map(G).filter(J=>null!=J):null;return{id:x,mbs:v.mbs,obb:D,children:G,resources:{hasFeatureData:v.featureData&&0<v.featureData.length,hasSharedResource:null!=v.sharedResource,attributes:v.attributeData?x:null,texture:v.textureData&&0<v.textureData.length?x:null,geometry:null!=v.geometryData?x:null},version:"string"===typeof v.version?v.version:null,lodSelection:Array.isArray(v.lodSelection)?
v.lodSelection:null,numFeatures:F}};q.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(x=>{c.isSome(x.node)&&(x.node.failed=!1)})};q._entryPriority=function(x){var v=this._getNodeInternal(x),D=this.getParentIndex(x);if(c.isNone(v)||0>D&&null==v.node)return 0>D?Infinity:this._entryPriority(D);let F=0;v.node&&0<=D&&(D=this._nodeTraversalState.get(D),null!=D&&(F=D.lodLevel));for(D=this.progressiveLoadPenalty;0<=x;x=this.getParentIndex(x))if(this._isLoaded(x)){D=
0;break}v=c.isSome(v.ref)?this._viewportQueries.distToPOI(v.ref):c.isSome(v.node)?this._viewportQueries.distToPOI(v.node):0;return-v-F*(v+this.progressiveLoadPenalty)+D};q.traverseVisible=function(x){const v=this._getNodeInternal(this._rootIndex);c.isNone(v)?x(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,-1,v,x)};q._traverseVisible=function(x,v,D,F){if(D.node&&0===D.childCount)this.isGeometryVisible(x)&&F(x,D,v);else if(this.isNodeVisible(x)&&(F(x,D,v),null!=D.node&&(v=this.nodeTraversalState(D.node),
!v.nodeHasLOD||v.lodLevel!==this._maxLodLevel))){v=c.unwrap(this._getPage(x));for(let G=0;G<D.childCount;G++){const J=v.children[D.childOffset+G],L=this._getNodeInternal(J);c.isSome(L)?this._traverseVisible(J,x,L,F):F(J,null,x)}}};q.traverse=function(x,v){v(x)&&this.traverseChildren(x,v)};q.traverseChildren=function(x,v){x=x.index;const D=this._getNodeInternal(x);c.isSome(D)&&this._traverseChildren(x,D,v)};q._traverseChildren=function(x,v,D){x=this._getPage(x);if(!c.isNone(x)){var F=v.childOffset+
v.childCount;for(v=v.childOffset;v<F;++v){const G=x.children[v],J=this._getNodeInternal(G);c.isSome(J)&&c.isSome(J.node)&&D(J.node)&&this._traverseChildren(G,J,D)}}};q.updateChildrenLoaded=function(x,v){for(x=this.getNode(x);c.isSome(x);)x.childrenLoaded+=v,x=this.getParent(x.index)};q.checkChildrenLoadedInvariant=function(){if(c.isNone(this.rootNode))return!0;const x=[],v=D=>{let F=this._isLoaded(D.index)||this._isReloading(D.index)?1:0;this.traverseChildren(D,G=>{F+=v(G);return!1});D.childrenLoaded!==
F&&x.push(D.index);return F};v(this.rootNode);x.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+x.join(","));return 0<x.length};q.updateStats=function(x){0<this._updates.add.length&&(x.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)x.index+=" + "+this._indexMissing||this._prefetch.length;x.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const v=this._featureEstimate.estimate-x.features;0<v?x.features+=" + "+v:
0>v&&(x.features+=" - "+-v)}};q.updateElevationInfo=function(x,v){this.needNodeElevationRange=v&&x&&("relative-to-ground"===x.mode||"on-the-ground"===x.mode);this._viewportQueries.updateElevationInfo(x);this.invalidateAllElevationRanges()};q.invalidateAllElevationRanges=function(){this._forAllNodes(x=>{f(x);c.isSome(x.node)&&(x.node.elevationRange=null);c.isSome(x.ref)&&(x.ref.elevationRange=null)})};q._forAllNodes=function(x){for(let v=0;v<this._nodePages.length;v++){const D=this._nodePages[v];if(D){const F=
v*this._nodesPerPage;for(let G=0;G<D.nodes.length;G++)x(D.nodes[G],F+G)}}};b._createClass(k,[{key:"rootNode",get:function(){return this.getNode(this._rootIndex)}},{key:"size",get:function(){return this._nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"isLoading",get:function(){return 0<this._indexMissing}},{key:"isPrefetching",get:function(){return 0<this._prefetch.length}},{key:"indexLoading",get:function(){return this._loading.size}},
{key:"indexMissing",get:function(){return this._indexMissing}},{key:"unloadedMemoryEstimate",get:function(){return this._unloadedMemoryEstimate}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"maxPriority",get:function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)}},{key:"test",get:function(){return{addNode:(x,v)=>this._addNode(x,v)}}}]);return k}();const z=new Map;let y=function(){function k(q){this.missing=
q;this.update=new r({deallocator:null});this.add=new r({deallocator:null});this.remove=new r({deallocator:null});this.cancel=[]}k.prototype.reset=function(q){this.add.clear();this.update.clear();this.cancel=q};return k}();const B=[["maxScreenThreshold",g.LodMetric.MaxScreenThreshold],["screenSpaceRelative",g.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",g.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",g.LodMetric.DistanceRangeFromDefaultCamera]];let C=function(){this.unremoved=
this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=u;a.selectErrorMetric=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/sphere"],function(a,b,c){let r=function(n,p){this.id=n;this.mbs=p;this.renderMbs=c.fromValues(0,0,0,-1);this.elevationRange=null};a.NodeFilterImpact=void 0;(function(n){n[n.Unmodified=
0]="Unmodified";n[n.Culled=1]="Culled";n[n.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(n){n[n.Unmodified=0]="Unmodified";n[n.PotentiallyModified=1]="PotentiallyModified";n[n.Culled=2]="Culled";n[n.Unknown=3]="Unknown";n[n.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let m=function(n){function p(g,h,d,f,e,l,A,t,w,u){g=n.call(this,g,d)||this;g.index=h;g.childCount=f;g.level=e;g.resources=
l;g.version=A;g.lodMetric=t;g.maxError=w;g.numFeatures=u;g.failed=!1;g.cacheState=a.CacheState.Unknown;g.vertexCount=0;g.memory=0;g.childrenLoaded=0;g.hasModifications=!1;g.imModificationImpact=a.NodeIMModificationImpact.NotChecked;return g}b._inheritsLoose(p,n);return p}(r);a.CacheState=void 0;(function(n){n[n.Unknown=0]="Unknown";n[n.Uncached=1]="Uncached";n[n.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(n){n[n.None=0]="None";n[n.MaxScreenThreshold=1]="MaxScreenThreshold";
n[n.ScreenSpaceRelative=2]="ScreenSpaceRelative";n[n.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";n[n.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(n){n[n.Hole=0]="Hole";n[n.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));a.ElevationRange=function(){this.min=Infinity;this.max=-Infinity;this.valid=!1};a.Node=m;a.NodeBase=r;a.NodeTraversalState=function(n,p,g,h){this.nodeHasLOD=n;this.isChosen=p;this.lodLevel=g;
this.version=h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,c,r,m){let n=function(){function g(d){this._layerView=d;this._lodGlobalDirty=!1}var h=g.prototype;h.startNodeLoading=function(d,f,e,l){this._maxLodLevel=l.maxLodLevel;this._index=
e;this._isNodeInScaleBounds=d;this._removeNodes=f};h.shouldLoadNode=function(d){if(b.isNone(d))return!1;const f=this._index.nodeTraversalState(d);return this._isChosenMaxLOD(f)?!0:f.isChosen?this._childrenRequireLoading(d):!1};h.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};h.lodGlobalHandling=function(d){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var f=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));p.clear();this._lodGlobalHandling(this._index.rootNode,
f,!1,this._layerView.nodeCrossfadingEnabled);f=p.length;this._removeNodes(p,d);d=p.length<f;0!==p.length&&(this._lodGlobalDirty=!0);p.clear();return d};h._lodGlobalHandling=function(d,f,e,l){if(b.isNone(d))return!1;const A=d.index,t=this._index,w=this._layerView;var u=t.nodeTraversalState(d);u=this._isChosenMaxLOD(u);var z=!d.resources.hasFeatureData;if(u&&z)return 0<d.childrenLoaded&&this._removeChildrenRecursive(d),!0;z=w.isNodeLoaded(A);if(l&&z&&u){var y=!e&&this.hasNoVisibleChildren(d);w.fadeNode(A,
m.FadeDirection.FadeIn,!y)}y=z&&(!w.isNodeFullyFadedIn||w.isNodeFullyFadedIn(A));if(z&&(w.updateNodeState(A,u?r.NodeState.Leaf:r.NodeState.Hole),u))return y&&this._removeChildrenRecursive(d),y;var B=0<d.childCount;let C=B;if(B)for(B=0;B<d.childCount;B++){const k=t.getChildIndex(A,B),q=t.getNode(k);b.isSome(q)?t.isGeometryVisible(k)&&!this._lodGlobalHandling(q,f,e||y,l)&&this._isNodeInScaleBounds(q)&&(C=!1):t.isNodeVisible(k)&&(C=!1)}(f=z&&!u&&(C||p.length<f))&&p.push(A);!l||f||!z||e||C||w.fadeNode(A,
m.FadeDirection.FadeIn,!1);d=!d.resources.hasFeatureData;return C||y&&!f||d};h._removeChildrenRecursive=function(d){this._index.traverseChildren(d,f=>{(this._layerView.isNodeLoaded(f.index)||this._layerView.isNodeReloading(f.index))&&p.push(f.index);return 0<f.childrenLoaded})};h.hasNoVisibleChildren=function(d){let f=!0;this._index.traverseChildren(d,e=>f&&this._index.isNodeVisible(e.index)?this._layerView.isNodeLoaded(e.index)?f=!1:0<e.childrenLoaded:!1);return f};h._childrenRequireLoading=function(d){let f=
!1,e=!0;this._index.traverseChildren(d,l=>{if(!e||!this._index.isNodeVisible(l.index))return!1;const A=this._index.nodeTraversalState(l);this._isChosenMaxLOD(A)&&this._index.isGeometryVisible(l.index)&&(f=!0);return this._layerView.isNodeLoaded(l.index)?e=!1:0<l.childrenLoaded});return e&&f};h._isChosenMaxLOD=function(d){return d.isChosen&&(!d.nodeHasLOD||d.lodLevel===this._maxLodLevel)};a._createClass(g,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);
return g}();const p=new c({deallocator:null});return n})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d){return function(){function f(l,A,t,w,u,z){this._streamDataController=A;this._logger=t;this._defaultGeometrySchema=w;this._requiredAttributes=u;this._options=z;this._logLayer=l;this._layerUrl=l.parsedUrl.path;this._geometryDefinitions=l.geometryDefinitions;if(l.materialDefinitions){const y=l.textureSetDefinitions;this._materialAndTextures=l.materialDefinitions.map(B=>d.getMaterialAndTextures(y,B))}}var e=f.prototype;e._load=function(l,A,t){return this._streamDataController.request(l,
A,t)};e._loadAttribute=function(l,A,t){return this._load(`${this._layerUrl}/nodes/${l.resources.attributes}/attributes/${A.key}/0`,"binary",t).then(w=>h.readBinaryAttribute(A,w))};e.loadAttributes=function(l,A,t){return n.eachAlways(A.map(w=>this._loadAttribute(l,w.attributeStorageInfo,t))).then(w=>{const u={};for(let z=0;z<A.length;++z){const y=w[z].value;if(y)u[A[z].name]=y;else{if(n.isAbortError(w[z].error))throw w[z].error;this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${A[z].name}' on node '${l.id}'`,
w[z].error)}}return u})};e.loadNodeData=function(){var l=a._asyncToGenerator(function*(A,t){var w=null!=this._requiredAttributes&&A.resources.attributes?b.result(this.loadAttributes(A,this._requiredAttributes,t)):null;var u=this._geometryDefinitions;var z={bufferDefinition:null,bufferIndex:0};if(!(null==u||0>A.resources.geometryDefinition)&&(u=0<=A.resources.geometryDefinition?u[A.resources.geometryDefinition].geometryBuffers:null,null!=u))for(var y=0;y<u.length;y++){var B=u[y];if(null!=B.compressedAttributes){if("draco"===
B.compressedAttributes.encoding&&!c("disable-feature:i3s-draco")){z.bufferIndex=y;z.bufferDefinition=B;break}}else z.bufferIndex=y,z.bufferDefinition=u[y]}const {bufferDefinition:C,bufferIndex:k}=z;y=(B=!!A.resources.geometry)?b.result(this._loadGeometry(A.resources.geometry,k,t)):null;u=A.resources.hasSharedResource?yield this._loadShared(A,t):null;var q=(z=this._materialAndTextures&&0<=A.resources.materialDefinition?this._materialAndTextures[A.resources.materialDefinition]:null!=u?d.getMaterialAndTexturesFromShared(u):
null)&&z.material;z=z&&z.textures;const x=`${A.id}`,v=!B&&this._options.loadFeatureData;B=v?yield this._loadFeatureData(x,t):null;if(v)a:{for(F of B.featureData)if(q=F.geometries,null!=q)for(var D of q){var F={featureIds:[F.id],featureDataPosition:F.position,geometries:[D]};break a}F=null}else F={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:q}}],featureDataPosition:[0,0,0]};if(D=m.isNone(F)){D=[];for(var G of B.featureData)null!=G.position&&D.push({featureIds:[G.id],featureDataPosition:G.position,
geometries:null})}G=D;D=null!=z&&0<z.length?b.result(this.loadTextures(A,z,t)):null;t=A=null;y&&(A=b.assertResult(yield y),(t=this._defaultGeometrySchema)&&u&&u.materialDefinitions&&(y=Object.keys(u.materialDefinitions)[0],!u.materialDefinitions[y].params.vertexRegions&&t.vertexAttributes.region&&(t=r.clone(t),delete t.vertexAttributes.region)),t=h.createGeometryDescriptor(C,t));u=D?b.assertResult(yield D):null;w=(w=w?b.assertResult(yield w):{})?{attributeData:w,loadedAttributes:this._requiredAttributes}:
null;if(m.isSome(F))return{geometryData:F,attributeDataInfo:w,geometryBuffer:A,geometryDescriptor:t,requiredTextures:z,textureData:u};if(m.isSome(G))return{pointData:G,attributeDataInfo:w,geometryBuffer:A,geometryDescriptor:t,requiredTextures:z,textureData:u};throw Error();});return function(A,t){return l.apply(this,arguments)}}();f._addAbsoluteHrefTexture=function(l,A){l=l.textureDefinitions;if(null!=l)for(const t of Object.keys(l))for(const w of l[t].images)Array.isArray(w.href)?w.hrefConcat=w.href.map(u=>
p.makeAbsolute(u,A)):w.hrefConcat=p.makeAbsolute(w.href,A)};f._fixTextureEncodings=function(l){l=l.textureDefinitions;if(null!=l)for(const t in l){const w=l[t];if(Array.isArray(w.encoding))for(var A=0;A<w.encoding.length;A++){const u=w.encoding[A];"data:"===u.substring(0,5)&&(w.encoding[A]=u.substring(5))}else A=w.encoding,"data:"===A.substring(0,5)&&(w.encoding=A.substring(5))}};e._loadShared=function(l,A){const t=`${this._layerUrl}/nodes/${l.resources.geometry}/shared`;return this._load(t,"json",
A).then(w=>{f._fixTextureEncodings(w);f._addAbsoluteHrefTexture(w,t);return w})};e._loadTexture=function(l,A,t,w,u,z){let y=!1;return u===g.TextureEncoding.DDS_S3TC||u===g.TextureEncoding.KTX2||u===g.TextureEncoding.Basis?this._load(l,"binary",z).then(B=>({id:A,usage:t,data:B,encoding:u,downsampled:y})):this._load(l,"image",z).then(B=>{var C=B;if(w&&4096<=B.width*B.height){C=Math.ceil(B.width/2);const k=Math.ceil(B.height/2),q=document.createElement("canvas");q.width=C;q.height=k;q.getContext("2d").drawImage(B,
0,0,C,k);C=q;y=!0}return{id:A,usage:t,data:C,encoding:u,downsampled:y}})};e.loadTextures=function(l,A,t){const w=this._options.uncompressedTextureDownsamplingEnabled,u=this._options.textureUsageMask;return Promise.all(A.map(z=>{if(0===(z.usage&u))return null;const y=d.selectEncoding(z.encodings,this._options.textureEncodings);return null==y?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${l.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${l.resources.texture||
l.id}/textures/${y.name}`,z.id,z.usage,w,y.encoding,t)}))};e._loadFeatureData=function(l,A){return this._load(`${this._layerUrl}/nodes/${l}/features/0`,"json",A)};e._loadGeometry=function(l,A,t){return this._load(`${this._layerUrl}/nodes/${l}/geometries/${A}`,"binary",t)};return f}()})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";
b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||
(a.TextureUsage={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../../webgl/enums".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(C){return C.sort((k,q)=>k.encoding-q.encoding)}function A(C,k,q){if(r.isNone(C)||q===m.TextureUsage.None)return null;for(let x=0;x<C.length;x++){const v=C[x];if(r.isSome(v)&&0!==(v.usage&q))return C=k[x],r.isSome(C)?C.id:null}return null}function t(C){switch(C){case m.TextureEncoding.KTX2:return f.Texture.KTX2_ENCODING;case m.TextureEncoding.Basis:return f.Texture.BASIS_ENCODING;case m.TextureEncoding.DDS_S3TC:return f.Texture.DDS_ENCODING;case m.TextureEncoding.PNG:return"image/png";
case m.TextureEncoding.JPG:return"image/jpeg";case m.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const w={ktx2:m.TextureEncoding.KTX2,basis:m.TextureEncoding.Basis,dds:m.TextureEncoding.DDS_S3TC,png:m.TextureEncoding.PNG,jpg:m.TextureEncoding.JPG,"ktx-etc2":m.TextureEncoding.KTX_ETC2},u={[f.Texture.KTX2_ENCODING]:m.TextureEncoding.Basis,[f.Texture.BASIS_ENCODING]:m.TextureEncoding.Basis,[f.Texture.DDS_ENCODING]:m.TextureEncoding.DDS_S3TC,"image/png":m.TextureEncoding.PNG,"image/jpg":m.TextureEncoding.JPG,
"image/jpeg":m.TextureEncoding.JPG,"image/ktx":m.TextureEncoding.KTX_ETC2},z=()=>({alphaMode:"opaque",alphaCutoff:g.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:d.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),y={s:e.TextureWrapMode.CLAMP_TO_EDGE,t:e.TextureWrapMode.CLAMP_TO_EDGE},
B={s:e.TextureWrapMode.REPEAT,t:e.TextureWrapMode.REPEAT};a.configureMaterial=function(C,k,q,x,v,D){const F=D.rendererTextureUsage;var G=k.metallicRoughness.baseColorFactor,J=c.clamp(k.metallicRoughness.baseColorFactor[3],0,1);C.baseColor=[G[0],G[1],G[2],J];C.hasParametersFromSource=!!k.hasParametersFromSource;C.usePBR=D.usePBR;C.mrrFactors=[k.metallicRoughness.metallicFactor,k.metallicRoughness.roughnessFactor,k.hasParametersFromSource?.2:.5];C.emissiveFactor=k.emissiveFactor;C.isIntegratedMesh=
D.isIntegratedMesh;C.textureAlphaCutoff="mask"===k.alphaMode?k.alphaCutoff:g.defaultMaskAlphaCutoff;C.alphaDiscardMode="opaque"===k.alphaMode?d.AlphaDiscardMode.Opaque:"mask"===k.alphaMode?d.AlphaDiscardMode.Mask:d.AlphaDiscardMode.MaskBlend;G=[];J=A(x,q,(m.TextureUsage.Color|m.TextureUsage.AlphaMask)&F);r.isSome(J)&&(C.baseColorTexture=new n.RenderTexture(v,J),G.push(C.baseColorTexture.loadPromise));J=A(x,q,m.TextureUsage.MetallicRoughness&F);r.isSome(J)&&(C.metallicRoughnessTexture=new n.RenderTexture(v,
J),G.push(C.metallicRoughnessTexture.loadPromise));J=A(x,q,m.TextureUsage.Emissive&F);r.isSome(J)&&(C.emissionTexture=new n.RenderTexture(v,J),G.push(C.emissionTexture.loadPromise));J=A(x,q,m.TextureUsage.Occlusion&F);r.isSome(J)&&(C.occlusionTexture=new n.RenderTexture(v,J),G.push(C.occlusionTexture.loadPromise));q=A(x,q,m.TextureUsage.Normal&F);r.isSome(q)&&(C.normalTexture=new n.RenderTexture(v,q),G.push(C.normalTexture.loadPromise));C.commonMaterialParameters.hasSlicePlane=D.slicePlaneEnabled;
C.commonMaterialParameters.doubleSided=k.doubleSided;C.commonMaterialParameters.cullFace=k.cullFace;C.ellipsoidMode=h.getEllipsoidMode(D.viewSpatialReference);return Promise.all(G)};a.createTexture=function(C,k,q,x){if(r.isNone(C)||null==C.data)return null;const v=C.data;var D=!(v instanceof HTMLImageElement)||c.isPowerOfTwo(v.width)&&c.isPowerOfTwo(v.height),F=x.renderingContext.parameters.maxMaxAnisotropy;x=q&&!x.capabilities.shaderTextureLOD?1:F;D=D&&!C.downsampled&&1<x;q=q||!k.wrapTextures?y:
B;F=t(C.encoding);return new f.Texture(v,{mipmap:D,maxAnisotropy:x,encoding:F,wrap:q,components:C.usage&m.TextureUsage.Color?"opaque"===k.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=z;a.getMaterialAndTextures=function(C,k){const q=new Map,x=(O,P)=>{if(r.isNone(O))return-1;if(q.has(O.id))return O=q.get(O.id),O.usage|=P,O.id;const N=q.size;q.set(O.id,{id:N,usage:P});return N};var v=k.pbrMetallicRoughness;const D=v&&v.baseColorFactor,F=k.emissiveFactor,G=null==k.normalTexture&&null==k.emissiveTexture&&
null==k.occlusionTexture&&(v?null==v.metallicRoughnessTexture&&1===v.roughnessFactor&&(1===v.metallicFactor||0===v.metallicFactor):!0),J=G?p.PBRSchematicMRRValues[0]:v?v.metallicFactor:1,L=G?p.PBRSchematicMRRValues[1]:v?v.roughnessFactor:1;v={baseColorFactor:D?[D[0],D[1],D[2],D[3]]:[1,1,1,1],baseColorTextureId:x(v&&v.baseColorTexture,"mask"===k.alphaMode?m.TextureUsage.Color|m.TextureUsage.AlphaMask:m.TextureUsage.Color),metallicRoughnessTextureId:x(v&&v.metallicRoughnessTexture,m.TextureUsage.MetallicRoughness),
metallicFactor:J,roughnessFactor:L};k={alphaMode:k.alphaMode,alphaCutoff:k.alphaCutoff,doubleSided:k.doubleSided,cullFace:"none"===k.cullFace?d.CullFaceOptions.None:"back"===k.cullFace?d.CullFaceOptions.Back:"front"===k.cullFace?d.CullFaceOptions.Front:void 0,normalTextureId:x(k.normalTexture,m.TextureUsage.Normal),emissiveTextureId:x(k.emissiveTexture,m.TextureUsage.Emissive),occlusionTextureId:x(k.occlusionTexture,m.TextureUsage.Occlusion),emissiveFactor:F?[F[0],F[1],F[2]]:[0,0,0],metallicRoughness:v,
wrapTextures:!1,hasParametersFromSource:G};const K=[];q.forEach(({usage:O},P)=>{var N=r.isSome(C)&&C[P]&&C[P].formats;N=N?l(N.map(({name:H,format:E})=>({name:H,encoding:w[E]}))):[];K.push({id:P,usage:O,encodings:N})});return{material:k,textures:K}};a.getMaterialAndTexturesFromShared=function(C){var k=C&&C.materialDefinitions?Object.keys(C.materialDefinitions)[0]:null,q=C&&C.textureDefinitions?Object.keys(C.textureDefinitions)[0]:null;k=k&&C.materialDefinitions[k];q=q&&C.textureDefinitions[q];C=z();
if(null!=k){k=k.params;k.diffuse&&(C.metallicRoughness.baseColorFactor=[k.diffuse[0],k.diffuse[1],k.diffuse[2],1]);null!=k.doubleSided&&(C.doubleSided=k.doubleSided,C.cullFace=k.doubleSided?d.CullFaceOptions.None:d.CullFaceOptions.Back);if("none"===k.cullFace||"front"===k.cullFace||"back"===k.cullFace)C.cullFace="none"===k.cullFace?d.CullFaceOptions.None:"back"===k.cullFace?d.CullFaceOptions.Back:d.CullFaceOptions.Front;k.transparency&&(C.metallicRoughness.baseColorFactor[3]=c.clamp(1-k.transparency,
0,1));if(k.useVertexColorAlpha||1>C.metallicRoughness.baseColorFactor[3])C.alphaMode="blend"}k=[];if(null!=q){!q.wrap||"repeat"!==q.wrap[0]&&"repeat"!==q.wrap[1]||(C.wrapTextures=!0);let x=m.TextureUsage.Color;"rgba"===q.channels&&(C.alphaMode="blend",x|=m.TextureUsage.AlphaMask);const v=q.images[q.images.length-1],D=F=>F&&F.split("/").pop();q=Array.isArray(q.encoding)?l(q.encoding.map((F,G)=>({name:D(v.href[G]),encoding:u[F]||0}))):[{name:D(v.href),encoding:u[q.encoding]||0}];k.push({id:0,usage:x,
encodings:q});C.metallicRoughness.baseColorTextureId=0}return{material:C,textures:k}};a.getSupportedEncodings=function(C){const k=!!C.compressedTextureS3TC;C=!!C.compressedTextureETC;const q=b("disable-feature:i3s-basis")?0:m.TextureEncoding.Basis|m.TextureEncoding.KTX2,x=q|m.TextureEncoding.DDS_S3TC;return m.TextureEncoding.JPG|m.TextureEncoding.PNG|(k?x:0)|(C?q:0)};a.selectEncoding=function(C,k){return C.find(q=>0!==(q.encoding&k))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,c,r){let m=function(){function n(p,g){this._textureRep=p;this._disposed=!1;p=this._textureRep.acquire(g);r.isPromiseLike(p)?(p.then(h=>{this._disposed?c.releaseMaybe(h):this._textureRef=h}),this.loadPromise=p):this._textureRef=p}n.prototype.dispose=function(){this._textureRef=c.releaseMaybe(this._textureRef);
this._disposed=!0};b._createClass(n,[{key:"glTexture",get:function(){return c.isSome(this._textureRef)?this._textureRef.glTexture:null}}]);return n}();a.RenderTexture=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,b,c){let r=function(){function m(p,g){this._requester=p;this._apiKey=
g;this._activeRequests=new Set}var n=m.prototype;n.request=function(p,g,h){const d=new AbortController;h=c.onAbortOrThrow(h,()=>d.abort());p=this._requester.request(p,g,{signal:d.signal,query:{token:this._apiKey}});const f={response:p,abortController:d,abortHandle:h};this._activeRequests.add(f);c.always(p,()=>{f.abortController=null;f.abortHandle?.remove();f.abortHandle=null;this._activeRequests.delete(f)});return p};n.cancelAll=function(){this._activeRequests.forEach(p=>{p.abortController?.abort();
p.abortController=null;p.abortHandle?.remove()});this._activeRequests.clear()};b._createClass(m,[{key:"busy",get:function(){return this._requester.busy}}]);return m}();a.I3SStreamDataController=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){return function(){function u(y,B,C,k,q,x,v,D,F={}){this._indexSR=y;this._renderCoordsHelper=B;this._clippingArea=q;this._elevationProvider=x;this._viewingMode=v;this._options=F;this._frustum=p.create();this._useFrustumCulling=!1;this._poi=c.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=w.create();this._tmp1=c.create();this._tmp2=c.create();this._tmp3=c.create();this._tmp0=c.create();this._screenspaceErrorBias=F.screenspaceErrorBias||
1;this._progressiveLoadFactor=F.progressiveLoadFactor||1;this.updateCamera(C,k);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(D);this._tmpPoint=d.makeDehydratedPoint(0,0,0,y);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||g.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=n.getReferenceEllipsoid(this._indexSR).radius}var z=u.prototype;z.updateElevationInfo=function(y){null==y?this._elevationContext=null:(this._elevationContext=
e.ElevationContext.fromElevationInfo(y),this._elevationContext.updateFeatureExpressionInfoContext(l.createContextWithoutExpressionSupport(l.extractExpressionInfo(y,!1))))};z.updateCamera=function(y,B){(this._useFrustumCulling=B)&&p.fromMatrix(y.viewMatrix,y.projectionMatrix,this._frustum);this._screenSizeFactor=1/(y.perScreenPixelRatio/2);this._camPos=y.eye;this.minDistance=Infinity;this.maxDistance=0};z.setPointOfInterest=function(y){this._poi=y};z.updateScreenSpaceErrorBias=function(y){const B=
this._screenspaceErrorBias;this._screenspaceErrorBias=y;return B};z.updateClippingArea=function(y){this._clippingArea=y};z.getElevationRange=function(y){if(a.isNone(this._elevationContext))return null;var B=y.mbs[0];const C=y.mbs[1],k=y.mbs[2];y=y.mbs[3];const q="relative-to-scene"===this._elevationContext.mode?"scene":"ground";if(this._elevationProvider.getSphereElevationBounds)return this._elevationProvider.getSphereElevationBounds(B,C,k,y,this._indexSR,q);B=this._elevationProvider.getElevation(B,
C,k,this._indexSR,q);return a.isSome(B)?{min:B,max:B}:null};z.getRenderMbs=function(y){const B=y.renderMbs;if(t.isValidMbs(B))return B;r.copy(B,y.mbs);this._elevationContext&&1E5>B[3]&&(this._tmpPoint.x=B[0],this._tmpPoint.y=B[1],this._tmpPoint.z=B[2],B[2]=f.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));m.projectBoundingSphere(B,this._indexSR,B,this.engineSR);return B};z.getVisibilityObb=function(y){if(a.isSome(y.visibilityObb))return y.visibilityObb;
const B=y.serviceObb,C=.01*this._indexSREllipsoidRadius;if(a.isNone(B)||!t.isValidObb(B)||this._isECEFOBBInLocalMode&&B.halfSize.some(k=>k>C))return null;y.serviceObbInRenderSR=this._computeRenderObb(B,y.serviceObbInRenderSR,y.mbs[3],y.elevationRange);return y.serviceObbInRenderSR};z._computeRenderObb=function(y,B,C,k){if(a.isNone(B))B=w.create();else if(t.isValidObb(B))return B;let q=0,x=0;if(this._elevationContext&&a.isSome(k)&&Number.isFinite(k.min))switch(this._elevationContext.mode){case "relative-to-ground":q=
this._elevationContext.geometryZWithOffset(y.center[2],this._renderCoordsHelper)+k.min-y.center[2];x=k.max-k.min;break;case "on-the-ground":q=k.min-y.center[2],x=k.max-k.min}else this._elevationContext&&1E5>C&&(this._tmpPoint.x=y.center[0],this._tmpPoint.y=y.center[1],this._tmpPoint.z=y.center[2],q=f.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-y.center[2]);0<x?(t.transformObb(y,this._indexSR,this._tmpObb,this.engineSR,q),
t.computeOffsetObb(this._tmpObb,0,x,this._viewingMode,B)):t.transformObb(y,this._indexSR,B,this.engineSR,q);return B};z.isNodeVisible=function(y){const B=this.getRenderMbs(y);if(!this._isMBSinClippingArea(B))return!1;if(!this._useFrustumCulling)return!0;y=this.getVisibilityObb(y);return a.isSome(y)?w.isVisible(y,this._frustum):p.intersectsSphere(this._frustum,h.wrap(B))};z.isGeometryVisible=function(y){if(!this._useFrustumCulling)return!0;const B=y.geometryObb;return a.isSome(B)?w.isVisible(B,this._frustum):
this.isNodeVisible(y)};z._isMBSinClippingArea=function(y){return a.isNone(this._clippingArea)?!0:t.intersectBoundingRectWithMbs(this._clippingArea,y)!==t.MbsIntersectResult.OUTSIDE};z._screenSpaceDiameterMbs=function(y,B){var C=this.getRenderMbs(y);y=Math.sqrt(b.squaredDistance(C,this._camPos));C=y-C[3];this._updateMinMaxDistance(y);return 0>C?.5*Number.MAX_VALUE:B/C*this._screenSizeFactor};z.calcCameraDistance=function(y){return this.calcCameraDistanceToCenter(y)-this.getRenderMbs(y)[3]};z.calcCameraDistanceToCenter=
function(y){y=this.getRenderMbs(y);y=b.distance(y,this._camPos);this._updateMinMaxDistance(y);return y};z.calcAngleDependentLoD=function(y){y=this.getRenderMbs(y);const B=y[3];y=(Math.abs(y[0]*(y[0]-this._camPos[0])+y[1]*(y[1]-this._camPos[1])+y[2]*(y[2]-this._camPos[2]))/b.length(y)+B)/b.distance(y,this._camPos);return Math.min(1,y)};z.hasLOD=function(y){return y.lodMetric!==A.LodMetric.None};z._getDistancePlanarMode=function(y,B){var C=y[0]-B[0];const k=y[1]-B[1];y=y[2]-B[2];C=C*C+k*k;B=B[3];if(C<=
B*B)return Math.abs(y);B=Math.sqrt(C)-B;return Math.sqrt(y*y+B*B)};z._getDistanceGlobeMode=function(y,B){var C=b.length(B);const k=b.length(y)-C;b.scale(this._tmp0,y,b.dot(y,B)/b.squaredLength(y));var q=b.squaredDistance(B,this._tmp0),x=B[3];if(q<=x*x)return Math.abs(k);B=b.scale(this._tmp0,B,1/C);C=b.scale(this._tmp1,B,C-x*x/2/C);q=b.subtract(this._tmp2,y,C);q=b.subtract(this._tmp2,q,b.scale(this._tmp3,B,b.dot(B,q)));C=b.add(this._tmp2,C,b.scale(this._tmp2,q,x/b.length(q)));x=b.distance(y,C);2E5<=
k&&(y=b.subtract(this._tmp1,y,C),y=b.dot(y,B)/b.length(y),.08>y&&(y=1E-4),x/=y);return x};z._getDistance=function(y,B){return this.engineSR===n.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(y,B):this._getDistancePlanarMode(y,B)};z._updateMinMaxDistance=function(y){0<y?(this.minDistance=Math.min(this.minDistance,y),this.maxDistance=Math.max(this.maxDistance,y)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-y))};z.getLodLevel=function(y){if(y.lodMetric===A.LodMetric.None)return 0;
if(0===y.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const B=this._screenspaceErrorBias;return this.evaluateLODmetric(y,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(y,B)?2:1:0}return this.evaluateLODmetric(y,this._screenspaceErrorBias)?this.maxLodLevel:0};z.evaluateLODmetric=function(y,B){switch(y.lodMetric){case A.LodMetric.ScreenSpaceRelative:const C=this.getRenderMbs(y),k=this._getDistance(this._camPos,C),q=2*k/
this._screenSizeFactor;this._updateMinMaxDistance(k+C[3]);return y.maxError*B<=q;case A.LodMetric.MaxScreenThreshold:return B=this._screenSpaceDiameterMbs(y,y.mbs[3]*B),this._options.angleDependentLoD&&(B*=this.calcAngleDependentLoD(y)),B<y.maxError;case A.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(y,y.maxError)*B;case A.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(y)>y.maxError*B}return!1};z.distToPOI=function(y){y=this.getRenderMbs(y);return b.distance(y,
this._poi)-y[3]};z.distCameraToPOI=function(){return b.distance(this._camPos,this._poi)};return u}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){var A;c=A=function(t){function w(z){z=t.call(this,z)||this;z.geometry=null;z.type="clip";return z}a._inheritsLoose(w,t);var u=w.prototype;u.writeGeometry=function(z,y,B,C){if(C.layer&&C.layer.spatialReference&&!C.layer.spatialReference.equals(this.geometry.spatialReference)){if(!e.canProjectWithoutEngine(z.spatialReference,C.layer.spatialReference)){C&&C.messages&&C.messages.push(new n("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:C.layer.spatialReference,context:C}));return}const k=new l;e.projectPolygon(z,k,C.layer.spatialReference);y[B]=k.toJSON(C)}else y[B]=z.toJSON(C);delete y[B].spatialReference};u.clone=function(){return new A({geometry:m.clone(this.geometry),type:this.type})};return w}(r.JSONSupport);b.__decorate([p.property({type:l}),f.persistable()],c.prototype,"geometry",void 0);b.__decorate([d.writer(["web-scene","portal-item"],"geometry")],c.prototype,"writeGeometry",null);b.__decorate([p.property({type:["clip",
"mask","replace"],nonNullable:!0}),f.persistable()],c.prototype,"type",void 0);return c=A=b.__decorate([h.subclass("esri.layers.support.SceneModification")],c)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/basicInterfaces ../../../symbols/PointSymbol3D".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C){r=function(x){function v(F){F=x.call(this,F)||this;F.loadedGraphics=new y.LimitGraphicsMap(5E4);F.slicePlaneEnabled=!1;F._renderingInfo={symbol:new C};F._handles=new n;F._graphicsByNode=new Map;return F}a._inheritsLoose(v,x);var D=v.prototype;D.initialize=function(){const F=this.view.basemapTerrain;this._graphicsCore=new w.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:B.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:G=>this.view.deconflictor.addGraphicsOwner(G),labeler:(G,J)=>this.view.labeler.addGraphicsOwner(G,J,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),scaleVisibility:(G,J)=>new u({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:J,graphicsCore:G,basemapTerrain:F,layerScaleEnabled:!1})}});
this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this._handles.add(g.watch(()=>this.layer.labelingInfo,(G,J)=>{l.diff(G,J)&&this._graphicsCore.updateLabelingInfo()}))};D.destroy=function(){this._handles=p.destroyMaybe(this._handles);this._graphicsCore=p.destroyMaybe(this._graphicsCore);this.loadedGraphics=p.destroyMaybe(this.loadedGraphics);this.view=null};D.addNodeMeta=function(F,G){let J=0;const L=F.filteredIds,K=this.view.spatialReference,O=
F.featureIds.map((P,N)=>{z.boundingBoxTop(N,this.collection,F.objectHandle,q);const H=t.makeDehydratedPoint(0,0,0,K);this.view.renderCoordsHelper.fromRenderCoords(q,H);N=G(N,F);let E=!1;p.isNone(L)?E=!0:J<L.length&&P===L[J]&&(E=!0,J++);return{objectId:P,uid:c.generateUID(),attributes:N,visible:E,geometry:H}});this.loadedGraphics.addMany(O);this._graphicsByNode.set(F.node.index,O)};D.updateLabelPositions=function(F){const G=this._graphicsByNode.get(F.node.index);let J=0;const L=this.view.spatialReference,
K=[];for(let O=0;O<F.featureIds.length;O++){const P=G[J];F.featureIds[O]===P.objectId&&(J++,z.boundingBoxTop(O,this.collection,F.objectHandle,q),this.view.renderCoordsHelper.fromRenderCoords(q,q,L),p.isSome(P.geometry)&&"point"===P.geometry.type&&P.geometry.x===q[0]&&P.geometry.y===q[1]&&P.geometry.z===q[2]||(p.isSome(P.geometry)&&"point"===P.geometry.type?(P.geometry.x=q[0],P.geometry.y=q[1],P.geometry.z=q[2]):P.geometry=t.makeDehydratedPoint(q[0],q[1],q[2],L),K.push(P.uid)))}this._graphicsCore.updateLabelingInfo(K)};
D.setNodeMetaAttributes=function(F,G){const J=this._graphicsByNode.get(F.node.index),L=Array(J.length);for(let K=0;K<J.length;K++){const O=J[K];O.attributes=G(K,F);L[K]=O.uid}this._graphicsCore.updateLabelingInfo(L)};D.applyFilterChange=function(F){var G=this._graphicsByNode.get(F.node.index);if(G)if(p.isNone(F.filteredIds))for(var J of G)J.visible||(J.visible=!0,k.graphic=J,k.property="visible",k.oldValue=!1,k.newValue=!0,this._graphicsCore.graphicUpdateHandler(k));else{J=0;for(const L of G)G=L.visible,
J<F.filteredIds.length&&L.objectId===F.filteredIds[J]?(L.visible=!0,J++):L.visible=!1,G!==L.visible&&(k.graphic=L,k.property="visible",k.oldValue=G,k.newValue=L.visible,this._graphicsCore.graphicUpdateHandler(k))}};D.removeNodeMeta=function(F){this.loadedGraphics.removeManyByObjectId(F.featureIds)};D.getRenderingInfo=function(){return this._renderingInfo};D.notifyGraphicGeometryChanged=function(){};D.notifyGraphicVisibilityChanged=function(){};a._createClass(v,[{key:"updating",get:function(){return this._graphicsCore?.updating??
!1}},{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return v}(m);b.__decorate([h.property()],r.prototype,"view",void 0);b.__decorate([h.property()],r.prototype,"layer",void 0);b.__decorate([h.property()],r.prototype,"collection",
void 0);b.__decorate([h.property()],r.prototype,"loadedGraphics",void 0);b.__decorate([h.property()],r.prototype,"updating",null);b.__decorate([h.property()],r.prototype,"slicePlaneEnabled",void 0);b.__decorate([h.property()],r.prototype,"_graphicsCore",void 0);r=b.__decorate([e.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],r);const k={graphic:null,property:null,oldValue:null,newValue:null},q=A.create();return r})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),
function(a,b,c,r,m,n){function p(d,f,e,l){d=f.getComponentAabb(e,d,g);f=f.getObjectTransform(e);for(e=0;8>e;++e)h[0]=e&1?d[0]:d[3],h[1]=e&2?d[1]:d[4],h[2]=e&4?d[2]:d[5],c.transformMat3(h,h,f.rotationScale),c.add(h,h,f.position),l[3*e]=h[0],l[3*e+1]=h[1],l[3*e+2]=h[2];return l}const g=n.create(),h=r.create();a.boundingBoxCornerPoints=p;a.boundingBoxTop=function(d,f,e,l){d=f.getComponentAabb(e,d,g);f=f.getObjectTransform(e);l[0]=0;l[1]=0;l[2]=0;for(e=0;8>e;++e)h[0]=e&1?d[0]:d[3],h[1]=e&2?d[1]:d[4],
h[2]=d[5],c.transformMat3(h,h,f.rotationScale),c.add(h,h,f.position),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2];l[0]/=8;l[1]/=8;l[2]/=8;return l};a.createGetFeatureExtent=function(d,f,e){const l=new Float64Array(24);return A=>{var t=A.meta.featureExtents;if(b.isNone(t)){t=new Float64Array(6*A.meta.featureIds.length);A.meta.featureExtents=t;for(let w=0;w<t.length;w+=6)t[w]=Number.POSITIVE_INFINITY}t=new Float64Array(t.buffer,6*A.index*Float64Array.BYTES_PER_ELEMENT,6);t[0]===Number.POSITIVE_INFINITY&&(p(A.index,
e,A.meta.objectHandle,l),m.projectBuffer(l,f,0,l,d,0,8)?(n.set(t,n.NEGATIVE_INFINITY),n.expandWithBuffer(t,l,0,8)):n.set(t,n.ZERO));return t}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,c,r,m){c=function(g){function h(f){var e=g.call(this)||this;e._limit=f;e._all=
new m.GraphicsMap;e._active=new p(b._assertThisInitialized(e));e._pending=new Map;e._handle=e._all.on("change",l=>e._handleChanges(l));return e}b._inheritsLoose(h,g);var d=h.prototype;d.destroy=function(){this._handle.remove()};d.toArray=function(){return this._active.toArray()};d.find=function(f){return this._active.find(f)};d.forEach=function(f){this._active.forEach(f)};d.addMany=function(f){this._all.addMany(f)};d.removeManyByObjectId=function(f){this._all.removeManyByObjectId(f)};d._handleChanges=
function(f){let e=f.removed;if(0<this._pending.size){e=[];for(var l of f.removed)this._pending.delete(l.objectId)||e.push(l)}l=this._limit-this._active.length+e.length;l<f.added.length&&(this._active.removeMany(e),e=[],n.reset(1-this._limit/(this._active.length+f.added.length)),this._active.forEach(t=>{n.sample()&&(e.push(t),this._pending.set(t.objectId,t))}),l=this._limit-this._active.length+e.length);let A=f.added;if(l<f.added.length){A=[];n.reset(l/f.added.length);for(const t of f.added)n.sample()?
A.push(t):this._pending.set(t.objectId,t)}f=l-A.length;0<f&&0<this._pending.size&&(n.reset(f/this._pending.size),this._pending.forEach(t=>{n.sample()&&(A.push(t),this._pending.delete(t.objectId))}));this._active.addAndRemove(A,e)};b._createClass(h,[{key:"length",get:function(){return this._active.length}}]);return h}(c);const n=new (function(){function g(){this._percentage=1;this._last=-1;this._index=0}var h=g.prototype;h.reset=function(d){this._percentage=d;this._last=-1};h.sample=function(){const d=
Math.floor(this._index*this._percentage);++this._index;if(d===this._last)return!1;this._last=d;return!0};return g}());let p=function(){function g(d){this._parent=d;this._map=new Map}var h=g.prototype;h.forEach=function(d){this._map.forEach(f=>d(f))};h.find=function(d){let f;r.someMap(this._map,e=>d(e)?(f=e,!0):!1);return f};h.toArray=function(){return[...this._map.values()]};h.addAndRemove=function(d,f){for(const e of d)this._map.set(e.objectId,e);for(const e of f)this._map.delete(e.objectId);(0<
d.length||0<f.length)&&this._parent.emit("change",{added:d,removed:f})};h.removeMany=function(d){for(const f of d)this._map.delete(f.objectId);0<d.length&&this._parent.emit("change",{added:[],removed:d})};b._createClass(g,[{key:"length",get:function(){return this._map.size}}]);return g}();a.LimitGraphicsMap=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/Evented","../../../core/MapUtils"],function(a,b,c,r){c=function(m){function n(){var g=m.apply(this,arguments)||this;g._map=new Map;return g}b._inheritsLoose(n,m);var p=n.prototype;p.clear=function(){if(0<this._map.size){const g=this.toArray();this._map.clear();this.emit("change",{added:[],removed:g})}};p.get=function(g){return this._map.get(g)};p.addMany=function(g){if(0!==g.length){var h=new Set;for(let d=0;d<g.length;d++){const f=g[d],e=f.objectId,l=this._map.get(e);l?(h.add(e),f!==
l&&(g[d]=l),++l.refCount):(f.refCount=1,this._map.set(e,f))}g=0<h.size?g.filter(d=>!h.has(d.objectId)):g;0<g.length&&this.emit("change",{added:g,removed:[]})}};p.removeMany=function(g){const h=[];for(const d of g){g=d.objectId;const f=this._map.get(g);null!=f&&0>=--f.refCount&&(this._map.delete(g),h.push(d))}0<h.length&&this.emit("change",{added:[],removed:h})};p.removeManyByObjectId=function(g){const h=[];for(const d of g)g=this._map.get(d),null!=g&&0>=--g.refCount&&(this._map.delete(d),h.push(g));
0<h.length&&this.emit("change",{added:[],removed:h})};p.toArray=function(){return[...this._map.values()]};p.find=function(g){let h;r.someMap(this._map,d=>g(d)?(h=d,!0):!1);return h};p.forEach=function(g){this._map.forEach(h=>g(h))};b._createClass(n,[{key:"length",get:function(){return this._map.size}}]);return n}(c);a.GraphicsMap=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),
function(a,b,c,r,m,n,p,g){function h(e,l,A){d.clear();var t=Infinity;let w=Infinity,u=-Infinity,z=-Infinity,y=!1;for(const C of l){var B="clip"===C.type?g.ModificationType.Inside:"mask"===C.type?g.ModificationType.Outside:g.ModificationType.Replace;const k=r.unwrapOrThrow(C.geometry,"modification.geometry");l=q=>q;if(k.spatialReference){if(!p.canProjectWithoutEngine(k.spatialReference,A)){c.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}l=q=>{p.projectVectorToVector(q,k.spatialReference,f,A);return f}}else k.hasZ||(f[2]=0,l=q=>{f[0]=q[0];f[1]=q[1];return f});y=y||B===g.ModificationType.Outside;d.push(B);d.push(k.rings.length);for(const q of k.rings){d.push(q.length);for(const x of q)B=l(x),d.push(B[0]),d.push(B[1]),d.push(B[2]),t=Math.min(t,B[0]),w=Math.min(w,B[1]),u=Math.max(u,B[0]),z=Math.max(z,B[1])}}r.isSome(e)&&(y?(d.push(g.ModificationType.Inside),d.push(2),d.push(4),d.push(t-1E-4),d.push(w-1E-4),d.push(0),d.push(u+
1E-4),d.push(w-1E-4),d.push(0),d.push(u+1E-4),d.push(z+1E-4),d.push(0),d.push(t-1E-4),d.push(z+1E-4),d.push(0)):(d.push(g.ModificationType.Outside),d.push(1)),d.push(4),d.push(e[0]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[3]),d.push(0),d.push(e[0]),d.push(e[3]),d.push(0));d.push(g.ModificationType.Finished);e=new Float64Array(d.length);for(t=0;t<d.length;++t)e[t]=d.getItemAt(t);return e}n=function(e){function l(t){return e.call(this,"SceneLayerWorker","process",
{process:w=>[w.geometryBuffer]},t,{hasInitialize:!0})||this}b._inheritsLoose(l,e);var A=l.prototype;A.setModifications=function(t,w,u,z){t={context:t,modifications:h(w,u,z),isGeodetic:z.isGeographic};this.broadcast(t,"setModifications")};A.setLegacySchema=function(t,w){w=JSON.stringify(w);this.broadcast({context:t,jsonSchema:w},"setLegacySchema")};A.destroyContext=function(t){return this.broadcast(t,"destroyContext")};return l}(n.WorkerHandle);const d=new m({deallocator:null}),f=[0,0,0];a.I3SMeshWorkerHandle=
n;a.toWasmModification=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesVisibilityMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.ALL_IN_CLIPPING_AREA=2]="ALL_IN_CLIPPING_AREA"})(a.ForAllFeaturesVisibilityMode||(a.ForAllFeaturesVisibilityMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||
(a.ForAllFeaturesReturnType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/typedArrayUtil ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),function(a,b,c,r,m,n,p){function g(){g=b._asyncToGenerator(function*(k){yield z();const q=[k.geometryBuffer];return{result:A(k,q),transferList:q}});
return g.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(k){yield z();const q=[k.geometryBuffer];var {geometryBuffer:x}=k,v=x.byteLength;k=B._malloc(v);v=new Uint8Array(B.HEAPU8.buffer,k,v);v.set(new Uint8Array(x));x=B.dracoDecompressPointCloudData(k,v.byteLength);B._free(k);if(0<x.error.length)throw`i3s.wasm: ${x.error}`;k=0<x.featureIds?.length?r.slice(x.featureIds):null;x=r.slice(x.positions);k&&q.push(k.buffer);q.push(x.buffer);return{result:{positions:x,featureIds:k},transferList:q}});
return h.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(k){yield z();t(k);k={buffer:k.buffer};return{result:k,transferList:[k.buffer]}});return d.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(k){yield z();l(k)});return f.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(k){yield z();B.setLegacySchema(k.context,k.jsonSchema)});return e.apply(this,arguments)}function l(k){const q=k.modifications,x=B._malloc(8*q.length),v=new Float64Array(B.HEAPU8.buffer,
x,q.length);for(let D=0;D<q.length;++D)v[D]=q[D];B.setModifications(k.context,x,q.length,k.isGeodetic);B._free(x)}function A(k,q){if(!B)return null;const {context:x,localOrigin:v,globalTrafo:D,mbs:F,obb:G,elevationOffset:J,geometryBuffer:L,geometryDescriptor:K,indexToVertexProjector:O,vertexToRenderProjector:P}=k;var N=B._malloc(L.byteLength),H=B._malloc(33*Float64Array.BYTES_PER_ELEMENT),E=new Uint8Array(B.HEAPU8.buffer,N,L.byteLength);E.set(new Uint8Array(L));var I=new Float64Array(B.HEAPU8.buffer,
H,33);u(I,v);var M=I.byteOffset+3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,M);u(Q,D);M+=16*I.BYTES_PER_ELEMENT;Q=new Float64Array(I.buffer,M);u(Q,F);M+=4*I.BYTES_PER_ELEMENT;c.isSome(G)&&(Q=new Float64Array(I.buffer,M),u(Q,G.center),M+=3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,M),u(Q,G.halfSize),M+=3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,M),u(Q,G.quaternion));I={isDraco:!1,isLegacy:!1,color:k.layouts.some(S=>S.some(U=>"color"===U.name)),normal:k.needNormals&&k.layouts.some(S=>
S.some(U=>"normalCompressed"===U.name)),uv0:k.layouts.some(S=>S.some(U=>"uv0"===U.name)),uvRegion:k.layouts.some(S=>S.some(U=>"uvRegion"===U.name)),featureIndex:K.featureIndex};E=B.process(x,!!k.obb,N,E.byteLength,K,I,H,J,O,P,k.normalReferenceFrame);B._free(H);B._free(N);if(0<E.error.length)throw`i3s.wasm: ${E.error}`;if(E.discarded)return null;N=0<E.componentOffsets.length?r.slice(E.componentOffsets):null;H=0<E.featureIds.length?r.slice(E.featureIds):null;I=r.slice(E.interleavedVertedData).buffer;
M=E.indicesType===m.IndexType.Int16?r.slice(new Uint16Array(E.indices.buffer,E.indices.byteOffset,E.indices.byteLength/2)):r.slice(new Uint32Array(E.indices.buffer,E.indices.byteOffset,E.indices.byteLength/4));Q=r.slice(E.positions);const T=E.positionIndicesType===m.IndexType.Int16?r.slice(new Uint16Array(E.positionIndices.buffer,E.positionIndices.byteOffset,E.positionIndices.byteLength/2)):r.slice(new Uint32Array(E.positionIndices.buffer,E.positionIndices.byteOffset,E.positionIndices.byteLength/
4));k={layout:k.layouts[0],interleavedVertexData:I,indices:M,hasColors:E.hasColors,hasModifications:E.hasModifications,positionData:{data:Q,indices:T}};H&&q.push(H.buffer);N&&q.push(N.buffer);q.push(I);q.push(M.buffer);q.push(Q.buffer);q.push(T.buffer);return{componentOffsets:N,featureIds:H,transformedGeometry:k,obb:E.obb}}function t(k){const {context:q,buffer:x}=k;k=B._malloc(x.byteLength);const v=x.byteLength/Float64Array.BYTES_PER_ELEMENT,D=new Float64Array(B.HEAPU8.buffer,k,v),F=new Float64Array(x);
D.set(F);B.filterOBBs(q,k,v);F.set(D);B._free(k)}function w(k){B&&B.destroy(k)}function u(k,q){for(let x=0;x<q.length;++x)k[x]=q[x]}function z(){if(B)return Promise.resolve();y||(y=n.get().then(k=>{B=k;y=null}));return y}let y,B;const C={transform:A,destroy:w};a.destroyContext=function(k){w(k)};a.dracoDecompressPointCloudData=function(k){return h.apply(this,arguments)};a.filterObbsForModifications=function(k){return d.apply(this,arguments)};a.filterObbsForModificationsSync=t;a.initialize=z;a.interpretObbModificationResults=
function(k){return 0===k?p.NodeIMModificationImpact.Unmodified:1===k?p.NodeIMModificationImpact.PotentiallyModified:2===k?p.NodeIMModificationImpact.Culled:p.NodeIMModificationImpact.Unknown};a.process=function(k){return g.apply(this,arguments)};a.setLegacySchema=function(k){return e.apply(this,arguments)};a.setModifications=function(k){return f.apply(this,arguments)};a.setModificationsSync=l;a.test=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/i3s/I3SModule":function(){define(["require",
"exports","../../assets"],function(a,b,c){function r(n){return c.getAssetUrl(`esri/libs/i3s/${n}`)}let m;b.get=function(){m||(m=(new Promise(n=>(new Promise((p,g)=>a(["../../chunks/i3s"],p,g))).then(p=>p.i3s).then(({default:p})=>{const g=p({locateFile:r,onRuntimeInitialized:()=>n(g)});delete g.then}))).catch(n=>{throw n;}));return m};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils",
"../II3SMeshView3D"],function(a,b){let c=function(){this.ids=new Set;this.paused=!1};return function(){function r({collection:n,forAllFeatures:p,forAllFeaturesOfNode:g}){this._highlights=[];this._collection=n;this._forAllFeatures=p;this._forAllFeaturesOfNode=g}var m=r.prototype;m.destroy=function(){this._highlights.forEach(n=>this._releaseSet(n));this._highlights=null};m.acquireSet=function(){const n=new c;this._highlights.push(n);return{set:n,handle:{remove:()=>{this._releaseSet(n);a.removeUnordered(this._highlights,
n)},pause:()=>{this._releaseSet(n);n.paused=!0},resume:()=>{n.paused=!1;this._initializeSet(n)}}}};m.setFeatureIds=function(n,p){p.forEach(g=>n.ids.add(g));this._initializeSet(n)};m._initializeSet=function(n){this._forAllFeatures((p,g,h)=>{n.ids.has(p)&&this._collection.addComponentHighlight(h.objectHandle,g);return b.ForAllFeaturesReturnType.CONTINUE})};m._releaseSet=function(n){this._forAllFeatures((p,g,h)=>{n.ids.has(p)&&this._collection.removeComponentHighlight(h.objectHandle,g);return b.ForAllFeaturesReturnType.CONTINUE})};
m.objectCreated=function(n){this._highlights.forEach(p=>{p.paused||this._forAllFeaturesOfNode(n,(g,h)=>{p.ids.has(g)&&this._collection.addComponentHighlight(n.objectHandle,h);return b.ForAllFeaturesReturnType.CONTINUE})})};m.objectDeleted=function(n){this._collection.clearHighlights(n.objectHandle)};return r}()})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f){a.I3SAsyncElevationUpdater=function(e){function l(t,w,u){var z=e.call(this,{})||this;z._updateExtent=w;z._updateNode=u;z.running=!1;z._extentSet=new d.ExtentSet;z._nodeSet=new Set;z.addHandles(t.registerTask(f.TaskPriority.ELEVATION_ALIGNMENT,b._assertThisInitialized(z)));return z}b._inheritsLoose(l,e);var A=l.prototype;A.normalizeCtorArgs=function(){return{}};A.addExtent=function(t){this._extentSet.add(t);this.running=!0};A.schedule=function(t){this._nodeSet.add(t);
this.running=!0};A.remove=function(t){this._nodeSet.delete(t);this._updateRunning()};A.runTask=function(t){const w=this._extentSet;for(t.run(()=>w.merge(t));!w.empty&&!t.done;){var u=this._updateExtent(w.pop());if(m.isNone(u))return;u.forAll(z=>this.schedule(z));t.madeProgress()}if(!t.done){u=this._nodeSet;for(const z of u)if(u.delete(z),this._updateNode(z),t.madeProgress(),t.done)break;this._updateRunning()}};A._updateRunning=function(){this.running=0<this._nodeSet.size||0<this._extentSet.size};
return l}(r);c.__decorate([n.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=c.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling",
"../support/I3SLayerView"],function(a,b,c,r,m){let n=function(){function p(h){this._view=h;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var g=p.prototype;g.stopNodeFading=function(h){null!=h.lodCrossfadeProgress&&(this._numFadingNodes--,h.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=c.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))};
g._startNodeFading=function(h,d,f){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=r.addFrameTask({preRender:e=>this._updateAllNodeFading(e)}),this._view.notifyLODUpdate());null==h.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());h.lodCrossfadeSignedDuration=f;h.lodCrossfadeProgress=d};g._updateAllNodeFading=function(h){const d=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((f,e)=>{if(c.isSome(e)&&c.isSome(e.lodCrossfadeProgress)){const l=e.lodCrossfadeSignedDuration,
A=e.lodCrossfadeProgress+Math.abs(h.deltaTime/l),t=!d||1<=A||0===l,w=(0<l?this._view.fullOpacity:0)-(t?0:0<l?1:-1)*(1-A);t?(this.stopNodeFading(e),0>l&&this._view.markNodeToRemove(f)):e.lodCrossfadeProgress=A;this._view.setNodeOpacityByIndex(f,w)}});this._view.removeMarkedNodes()};g.stopAllNodeFading=function(){this._view.foreachCrossfadeNode((h,d)=>{c.isSome(d)&&c.isSome(d.lodCrossfadeProgress)&&(this.stopNodeFading(d),d=d.lodCrossfadeSignedDuration,0>d&&this._view.markNodeToRemove(h),this._view.setNodeOpacityByIndex(h,
0<d?this._view.fullOpacity:0))});this._view.removeMarkedNodes()};g.fadeNode=function(h,d,f,e){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var l=this._view;const A=l.nodeCrossfadingEnabled,t=f===m.FadeDirection.FadeIn?l.fullOpacity:0;e=A?e?f===m.FadeDirection.FadeIn?l.lodCrossfadeinDuration:l.lodCrossfadeoutDuration:l.lodCrossfadeUncoveredDuration:0;l=this._view.getNodeOpacityByIndex(h);A&&l!==t&&0<e?this._startNodeFading(d,1-Math.abs(t-l),(f===m.FadeDirection.FadeIn?
1:-1)*e):(this.stopNodeFading(d),this._view.setNodeOpacityByIndex(h,t),f===m.FadeDirection.FadeOut&&this._view.removeNode(h))};g.isNodeFullyFadedIn=function(h){const d=this._view.getNodeCrossfadeMetaData(h);return c.isNone(d)||null==d.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(h)===this._view.fullOpacity};b._createClass(p,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return p}();a.I3SCrossfadeHelper=n;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=
0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u){const z=t.empty(),y=e.create(),B=A.create(),C=A.create(),k=A.create();c=function(q){function x(D){D=q.call(this,D)||this;D._tmpEvent={spatialReference:null,extent:z,context:"scene"};return D}a._inheritsLoose(x,q);var v=x.prototype;v.initialize=function(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=w.newIntersector(this.view.state.viewingMode);this._intersector.options.store=u.StoreResults.MIN;const D=
this.layerView.i3slayer.fullExtent;n.isNone(D)?m.getLogger(this.declaredClass).error("I3SElevationProvider expected fullExtent on I3SLayer."):(this._zmin=D.zmin,this._zmax=D.zmax);this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};v.getElevation=function(D,F,G,J){B[0]=D;B[1]=F;B[2]=G;if(!this._renderCoordsHelper.toRenderCoords(B,J,B))return m.getLogger(this.declaredClass).error("could not project point to compute elevation"),null;D=this.layerView.elevationOffset;F=this._zmin+
D;this._renderCoordsHelper.setAltitude(C,this._zmax+D,B);this._renderCoordsHelper.setAltitude(k,F,B);this._intersector.reset(C,k,null);this.intersectionHandler.intersect(this._intersector,null,C,k);return this._intersector.results.min.getIntersectionPoint(B)?this._renderCoordsHelper.getAltitude(B):null};v.layerChanged=function(){this.spatialReference&&(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};
v.objectChanged=function(D){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(D),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};v._computeObjectExtent=function(D){t.empty(z);this._expandExtent(D,z);return z};v._computeLayerExtent=function(){t.empty(z);for(const D of this.layerView.getVisibleNodes())this._expandExtent(D,z);return z};v._expandExtent=function(D,F){const G=this.spatialReference;if(!n.isNone(G)&&(D=this.layerView.getNodeComponentObb(D),
!n.isNone(D))){f.fromQuat(y,D.quaternion);y[12]=D.center[0];y[13]=D.center[1];y[14]=D.center[2];for(let J=0;8>J;++J)B[0]=J&1?D.halfSize[0]:-D.halfSize[0],B[1]=J&2?D.halfSize[1]:-D.halfSize[1],B[2]=J&4?D.halfSize[2]:-D.halfSize[2],l.transformMat4(B,B,y),this._renderCoordsHelper.fromRenderCoords(B,B,G),t.expand(F,B,F)}};a._createClass(x,[{key:"spatialReference",get:function(){return this.view?.elevationProvider?.spatialReference}}]);return x}(r.EventedMixin(c));b.__decorate([p.property({constructOnly:!0})],
c.prototype,"layerView",void 0);b.__decorate([p.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);b.__decorate([p.property()],c.prototype,"view",void 0);b.__decorate([p.property()],c.prototype,"spatialReference",null);return c=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],c)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../core/maybe ../../../ViewingMode ./I3SUtil ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,r,m,n,p,g){function h(f,e,l,A=0){A=f[3]+A;const t=e[0]-f[0],w=e[1]-f[1];f=e[2]-f[2];e=l[0];const u=l[1];l=l[2];const z=e*t+u*w+l*f;return 0<=z*z-(e*e+u*u+l*l)*(t*t+w*w+f*f-A*A)}let d=function(){function f(l){this.type=p.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=l.layerUid;this._sublayerUid=l.sublayerUid;this._collection=l.collection;this._traverseNodeHierarchy=l.traverseNodeHierarchy;this.slicePlaneEnabled=l.slicePlaneEnabled;this.isGround=l.isGround}var e=f.prototype;
e.updateElevationAlignState=function(l,A){this._needVerticalOffset=l&&A===c.ViewingMode.Global};e.intersect=function(l,A,t,w){const u=l.results,z=l.options.store===p.StoreResults.ALL,y=l.ray.direction,B=l.tolerance;let C=x=>x,k=x=>x;const q=g.getVerticalOffsetI3S(b.isSome(l.verticalOffset)?l.verticalOffset:this._needVerticalOffset?0:null);b.isSome(l.verticalOffset)&&b.isSome(q)&&(C=x=>q.applyToMbs(x),k=x=>q.applyToObb(x));this._traverseNodeHierarchy((x,v)=>{if(0===x.childrenLoaded)return!1;const D=
b.isSome(x.serviceObbInRenderSR)&&r.isValidObb(x.serviceObbInRenderSR)?x.serviceObbInRenderSR:null;if(b.isSome(D)&&!m.intersectLine(k(D),t,y,B))return!1;v&&(b.isSome(D)||!r.isValidMbs(x.renderMbs)||h(C(x.renderMbs),t,y,B))&&(b.isNone(x.geometryObb)||m.intersectLine(k(x.geometryObb),t,y,B))&&this._collection.intersect(v,t,w,B,q,(F,G,J,L)=>{if(0<=G&&(null==A||A(t,w,G))){var K=O=>{O.set(this.type,{layerUid:this.layerUid,sublayerUid:this._sublayerUid,nodeIndex:x.index,componentIndex:F,triangleNr:L},G,
J)};this.isGround&&(null==u.ground.dist||G<u.ground.dist)&&K(u.ground);if(!l.options.isFiltered&&((null==u.min.dist||G<u.min.dist)&&K(u.min),(null==u.max.dist||G>u.max.dist)&&K(u.max),z)){const O=n.newIntersectorResult(l.ray);K(O);l.results.all.push(O)}}});return!0})};return f}();a.I3SIntersectionHandler=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../support/featureFlags ../FeatureLayerView3D".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y){a.I3SOverrides=function(k){function q(v){v=k.call(this,v)||this;v._warnMaximumChangedObjectsExceeded=!1;v._pendingFetchAbortController=new AbortController;v._interactiveEditingSessions=null;v._maximumNumberOfEditOVerrides=5E4;v._original3DOFLDefinitionExpression=null;v._associatedLayerView=null;v._changedObjectIds=new Set;return v}b._inheritsLoose(q,k);var x=q.prototype;x.initialize=function(){this._memCache=this.memoryController.newCache(`${this.layer.uid}-attribute-overrides`);
this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController.signal);this._pendingFetchChangedObjectIds.then(()=>this._pendingFetchAbortController=null);z.sceneLayerEditingEnabled()&&d.isSome(this._associatedLayer)&&d.isSome(this._associatedLayer.infoFor3D)&&this._associatedLayer.load().then(v=>{this.destroyed||(this._original3DOFLDefinitionExpression=v.definitionExpression,this.addHandles(e.watch(()=>this._definitionExpression,D=>v.definitionExpression=D,e.initial)),
this._associatedLayerView=new y({layer:this._associatedLayer,view:this.view}))})};x.destroy=function(){z.sceneLayerEditingEnabled()&&d.isSome(this._associatedLayer)&&d.isSome(this._associatedLayer.infoFor3D)&&d.isSome(this._associatedLayerView)&&(this._associatedLayer.definitionExpression=d.unwrap(this._original3DOFLDefinitionExpression));this._set("layer",null);this._memCache.destroy();this._memCache=null;this._pendingFetchAbortController&&(this._pendingFetchAbortController.abort(),this._pendingFetchAbortController=
null);this._pendingFetchChangedObjectIds=null};x.createInteractiveEditSession=function(v){this._changedObjectIds.add(v);this.notifyChange("_changedObjectIds");d.isNone(this._interactiveEditingSessions)&&(this._interactiveEditingSessions=[]);const D=this._interactiveEditingSessions,F=new B(v,{rollback:()=>{n.remove(D,F);0===D.length&&(this._interactiveEditingSessions=null)},commit:G=>{for(const [J,L]of G)this.updateAttributeValue(v,J,L)}});D.unshift(F);return F};x.apply=function(){var v=b._asyncToGenerator(function*(D,
F,G){if(!d.isNone(F)){var {loadedAttributes:J,attributeData:L}=F;if(!d.isNone(J)&&0!==J.length&&!d.isNone(L)&&(yield f.whenOrAbort(this._pendingFetchChangedObjectIds,G),0!==this._changedObjectIds.size)){F={loadedAttributes:J,attributeData:L};var K=this._getOverridesFromCache(D,F,this._changedObjectIds),{objectIds:O,fieldNames:P}=K;G=yield this._queryOverridesFromAssociatedLayer(O,P,G);d.isNone(G)||this._processOverridesFromAssociatedLayer(D,G,P,F)}}});return function(D,F,G){return v.apply(this,arguments)}}();
x.updateGeometry=function(v){this._changedObjectIds.add(v);this.notifyChange("_changedObjectIds")};x.updateAttributeValue=function(v,D,F){this._changedObjectIds.add(v);this._cacheAttributeValue(v,D,F);this.notifyChange("_changedObjectIds")};x._cacheAttributeValue=function(v,D,F){this._memCache.put(this._getAttributeCacheKey(v,D),F,this._memCacheAttributeValueSize(F))};x._getOverridesFromCache=function(v,{loadedAttributes:D,attributeData:F},G){const J=new Set,L=[];for(var K of D)L[K.index]=F[K.name];
F=new Set;for(K=0;K<v.length;K++){const O=v[K];if(G.has(O))for(const P of D){const N=this._fromCache(O,P.index);void 0!==N?L[P.index][K]=N:(J.add(O),F.add(P.name))}}return{objectIds:Array.from(J),fieldNames:Array.from(F)}};x._fromCache=function(v,D){const F=this._fromInteractiveEditingSession(v,D);if(void 0!==F)return F;v=this._getAttributeCacheKey(v,D);return this._memCache.get(v)};x._fromInteractiveEditingSession=function(v,D){if(!d.isNone(this._interactiveEditingSessions))for(const F of this._interactiveEditingSessions){if(F.objectId!==
v)continue;const G=F.get(D);if(void 0!==G)return G}};x._getAttributeCacheKey=function(v,D){return`${v}-${D}`};x._queryOverridesFromAssociatedLayer=function(){var v=b._asyncToGenerator(function*(D,F,G){if(0===D.length||0===F.length)return null;D=D.sort((K,O)=>K-O);this._warnMaximumChangedObjectsExceeded&&(this._warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const J=this.layer.associatedLayer;if(d.isNone(J))return null;const L=J.createQuery();L.where="1\x3d1";L.returnGeometry=
!1;L.outFields=[J.objectIdField,...F];L.cacheHint=!0;L.objectIds=D;F=u.getMaximumQuerySize(J);D=D.length>F?n.splitIntoChunks(D,F).map(K=>{const O=L.clone();O.objectIds=K;return p.resultOrAbort(u.queryAllJSON(J,O,{signal:G}))}):[p.resultOrAbort(u.queryAllJSON(J,L,{signal:G}))];return(yield Promise.all(D)).reduce((K,O)=>K.concat(O.ok?O.value.features:[]),[])});return function(D,F,G){return v.apply(this,arguments)}}();x._logMaximumObjectsExceededWarning=function(){let v=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${w.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const D=this.layer.portalItem;v=D&&D.loaded?v+` (${D.portal.url}/home/item.html?id=${D.id}#settings)`:v+` (${this.layer.parsedUrl.path})`;h.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,`${v}.`)};x._processOverridesFromAssociatedLayer=function(v,D,F,{loadedAttributes:G,attributeData:J}){var L=this.layer.associatedLayer;if(!d.isNone(L)){L=L.objectIdField;var K=F.map(P=>J[P]),O=new Map(G.map(P=>[P.name,P.index]));G=F.map(P=>O.get(P));v=new Map(Array.from(v,
(P,N)=>[P,N]));for(const P of D){D=P.attributes[L];for(let N=0;N<F.length;N++){const H=G[N],E=v.get(D),I=P.attributes[F[N]];K[N][E]=I;this._cacheAttributeValue(D,H,I)}}}};x._memCacheAttributeValueSize=function(v){return"string"===typeof v?g.estimateStringByteSize(v):g.estimateNumberByteSize()};x._fetchChangedObjectIds=function(){var v=b._asyncToGenerator(function*(D){var F=this.layer;yield F.load({signal:D});this._changedObjectIds.clear();if(!d.isNone(F.associatedLayer)&&F.associatedLayer.capabilities?.operations?.supportsChangeTracking){var G=
this._getFetchChangedObjectIdsServerGen();if(d.isNone(G))return null;var J=F.associatedLayer.layerId,L=d.isSome(F.associatedLayer.infoFor3D);D=yield p.result(r(`${F.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`[${J}]`,returnUpdates:!0,returnDeletes:L,returnInserts:L,layerServerGens:JSON.stringify([{id:J,serverGen:G}])},timeout:1E4,signal:D}));if(D.ok&&D.value.data?.edits&&1===D.value.data.edits.length)for(G=D.value.data.edits[0],D=d.get(G,"objectIds",
"adds"),F=d.get(G,"objectIds","updates"),J=d.get(G,"objectIds","deletes"),G=[],d.isSome(D)&&(G=G.concat(D)),d.isSome(F)&&(G=G.concat(F)),d.isSome(J)&&(G=G.concat(J)),D=Math.min(this._maximumNumberOfEditOVerrides,G.length),D<G.length&&(this._warnMaximumChangedObjectsExceeded=!0),F=G.sort((K,O)=>K-O),G=0;G<D;G++)this._changedObjectIds.add(F[G]);this.notifyChange("_changedObjectIds")}});return function(D){return v.apply(this,arguments)}}();x._getFetchChangedObjectIdsServerGen=function(){var v=this.layer;
if(d.isSome(v.serviceUpdateTimeStamp)&&d.isSome(v.serviceUpdateTimeStamp.lastUpdate))return v.serviceUpdateTimeStamp.lastUpdate;v=v.associatedLayer;return d.isSome(v)&&d.isSome(v.serverGens)&&d.isSome(v.serverGens.minServerGen)?v.serverGens.minServerGen:null};b._createClass(q,[{key:"geometryChangedObjectIds",get:function(){return[...this._changedObjectIds]}},{key:"_associatedLayer",get:function(){return this.layer.associatedLayer}},{key:"_definitionExpression",get:function(){const v=this.geometryChangedObjectIds;
return 0===v.length?"1 \x3d 0":`OBJECTID IN (${v.join(",")})`}},{key:"updating",get:function(){return z.sceneLayerEditingEnabled()&&d.isSome(this._associatedLayer)&&d.isSome(this._associatedLayer.infoFor3D)?!d.isSome(this._associatedLayerView)||d.isSome(this._associatedLayerView)&&this._associatedLayerView.updating:!1}},{key:"test",get:function(){const v=this;return{changedObjectIds:Array.from(this._changedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return v._maximumNumberOfEditOVerrides},
set maximumNumberOfEditOVerrides(D){v._maximumNumberOfEditOVerrides=D}}}}]);return q}(m);c.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);c.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,"layer",void 0);c.__decorate([l.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryChangedObjectIds",null);c.__decorate([l.property()],a.I3SOverrides.prototype,"_associatedLayer",null);c.__decorate([l.property()],a.I3SOverrides.prototype,"_associatedLayerView",
void 0);c.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);c.__decorate([l.property()],a.I3SOverrides.prototype,"_changedObjectIds",void 0);c.__decorate([l.property()],a.I3SOverrides.prototype,"_definitionExpression",null);c.__decorate([l.property()],a.I3SOverrides.prototype,"updating",null);a.I3SOverrides=c.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);let B=function(){function k(x,v){this.objectId=x;this._options=
v;this._updates=new Map;this._state=C.ACTIVE}var q=k.prototype;q.get=function(x){return this._updates.get(x)};q.set=function(x,v){this._isActive&&this._updates.set(x,v)};q.rollback=function(){this._isActive&&(this._state=C.ROLLED_BACK,this._options.rollback())};q.commit=function(){this._isActive&&(this._state=C.COMMITTED,this._options.commit(this._updates),this._updates.clear())};b._createClass(k,[{key:"_isActive",get:function(){return this._state===C.ACTIVE}}]);return k}();var C;(function(k){k[k.ACTIVE=
0]="ACTIVE";k[k.COMMITTED=1]="COMMITTED";k[k.ROLLED_BACK=2]="ROLLED_BACK"})(C||(C={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],function(a,b,c,r){function m(){m=b._asyncToGenerator(function*(h,d,f){d=d.clone();h.capabilities.query.supportsMaxRecordCountFactor&&(d.maxRecordCountFactor=g(h));const e=
n(h),l=h.capabilities.query.supportsPagination;d.start=0;d.num=e;let A=null;for(;;){const t=yield h.source.queryFeaturesJSON(d,f);c.isNone(A)?A=t:A.features=A.features.concat(t.features);A.exceededTransferLimit=t.exceededTransferLimit;if(!l||!t.exceededTransferLimit)break;d.start+=e}return A});return m.apply(this,arguments)}function n(h){return g(h)*p(h)}function p(h){return h.capabilities.query.maxRecordCount||2E3}function g(h){return h.capabilities.query.supportsMaxRecordCountFactor?r.MAX_MAX_RECORD_COUNT_FACTOR:
1}a.getMaxRecordCountFactor=g;a.getMaximumQuerySize=n;a.getMaximumRecordCount=p;a.queryAllJSON=function(h,d,f){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/IDBCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils".split(" "),function(a,b,c,r,m,n){function p(d){return new Promise((f,
e)=>{d.oncomplete=()=>f();d.onerror=()=>e(d.error);d.onabort=()=>e(d.error)})}function g(d){return new Promise((f,e)=>{"done"===d.readyState?null!=d.error?e(d.error):f(d.result):(d.onsuccess=()=>f(d.result),d.onerror=()=>e(d.error))})}let h=function(){function d(e,l,A=14){this._version=A;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=c.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=e;this._storeName=
l}var f=d.prototype;f.init=function(){return Promise.resolve().then(()=>{const e=indexedDB.open(this._dbName,this._version);e.onupgradeneeded=l=>{var A=e.result;const t=e.transaction,w=A.objectStoreNames.contains(this._storeName)?t.objectStore(this._storeName):A.createObjectStore(this._storeName);A=A.objectStoreNames.contains("last_access")?t.objectStore("last_access"):A.createObjectStore("last_access");A.indexNames.contains("date")||A.createIndex("date","date",{unique:!1});A.indexNames.contains("byteSize")||
A.createIndex("byteSize","byteSize",{unique:!1});l.oldVersion<this._version&&(w.clear(),A.clear())};return g(e)}).then(e=>{this._destroyed?e.close():this._db=e})};f.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};f.getHitRate=function(){return this._hit/(this._hit+this._miss)};f.put=function(e,l){return null==this._db?Promise.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:
Promise.resolve()).then(()=>this._put(e,l)).catch(A=>{if(A&&"QuotaExceededError"===A.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(t=>this._removeLeastRecentlyAccessed(l.byteSize+Math.ceil(t*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(e,l));throw A;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=
this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(A=>this._removeLeastRecentlyAccessed(A-this.maxByteSize)))})};f.get=function(e,l){const A=this._db;if(null==A)return Promise.resolve(void 0);let t=null;return Promise.resolve().then(()=>{const w=A.transaction(this._storeName,"readonly");t=n.onAbort(l,()=>{w.abort()});const u=w.objectStore(this._storeName).get(e);return g(u)}).then(w=>{null==w?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:w.byteSize},e));m.isSome(t)&&t.remove();return w}).catch(()=>{++this._miss;n.throwIfAborted(l);m.isSome(t)&&t.remove()})};f.remove=function(e){var l=this;const A=this._db;return null==A?Promise.resolve():Promise.resolve().then(b._asyncToGenerator(function*(){const t=A.transaction([l._storeName,"last_access"],"readwrite");var w=t.objectStore(l._storeName),u=t.objectStore("last_access");w=w.delete(e);u=u.delete(e);yield Promise.all([g(w),g(u),p(t)])}))};f._put=function(e,l){var A=this._db;
if(null==A)return Promise.resolve();A=A.transaction([this._storeName,"last_access"],"readwrite");var t=A.objectStore(this._storeName);const w=A.objectStore("last_access");t=t.put(l,e);e=w.put({date:Date.now(),byteSize:l.byteSize},e);return Promise.all([g(t),g(e),p(A)])};f._removeLeastRecentlyAccessed=function(e){if(0>=e||!this._db)return Promise.resolve();const l=this._db.transaction([this._storeName,"last_access"],"readwrite"),A=l.objectStore(this._storeName),t=l.objectStore("last_access");let w=
0;const u=t.index("date").openCursor(null,"next");u.onsuccess=()=>{const z=u.result;null!=z&&(null!=z.value.byteSize&&(w+=z.value.byteSize),A.delete(z.primaryKey),t.delete(z.primaryKey),w<e&&z.continue())};return p(l)};f._getCacheSize=function(){var e=this._db;if(null==e)return Promise.resolve(0);e=e.transaction("last_access");let l=0;const A=e.objectStore("last_access").index("byteSize").openKeyCursor();A.onsuccess=()=>{const t=A.result;if(t){var w=t.key;null!=w&&(l+=w);t.continue()}};return p(e).then(()=>
l)};b._createClass(d,[{key:"initialized",get:function(){return null!=this._db}}]);return d}();a.IDBCache=h;a.whenRequest=g;a.whenTransaction=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function r(){this._data=new Map;this._hit=this._miss=0;this.initialized=!0}var m=r.prototype;m.init=function(){return Promise.resolve()};
m.get=function(){var n=b._asyncToGenerator(function*(p,g){if(this._data.has(p))return this._hit++,this._data.get(p)??void 0;this._miss++});return function(p,g){return n.apply(this,arguments)}}();m.destroy=function(){};m.put=function(n,p){this._data.set(n,p);return Promise.resolve()};m.remove=function(n){this._data.delete(n);return Promise.resolve()};m.getHitRate=function(){return this._hit/(this._hit+this._miss)};return r}();a.IDBMockCache=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,b,c,r){function m(f,e){const l=e.edits.updateFeatures;if(!l||0===l.length)return new d;const A=n(e),t=new d;e=new Map;for(let y=0;y<f.attributeStorageInfo.length;y++)e.set(f.attributeStorageInfo[y].name,y);const w=f.fieldsIndex,u=f.objectIdField,z=l.filter(y=>{y=r.attributeLookup(w,y.attributes,u);return A.has(y)});f.forEachNode((y,B)=>{const C=
new Set(B);for(const D of z){const F=r.attributeLookup(w,D.attributes,u);if(!C.has(F))continue;const G=B.indexOf(F);for(const J in D.attributes){var k=f.fieldsIndex.normalizeFieldName(J);var q=t;var x=y.index,v=q.get(x);v?q=v:(v=new h,q.set(x,v),q=v);(x=q.get(k))?k=x:(x=[],q.set(k,x),k=x);k.push({featureIndex:G,featureId:F,value:D.attributes[J]})}}});return t}function n(f){const e=new Set;if(!f.updatedFeatures)return e;for(const l of f.updatedFeatures)null!=l.objectId&&null==l.error&&e.add(l.objectId);
return e}const p={setAttribute(){},rollback(){},commit(){}};var g;(function(f){f[f.EDITING=0]="EDITING";f[f.ROLLED_BACK=1]="ROLLED_BACK";f[f.COMMITTED=2]="COMMITTED"})(g||(g={}));const h=Map,d=Map;a.createInteractiveEditSession=function(f,e){const l=e.attributes[f.objectIdField];var A=f.sessions.get(l);if(A)return A;const t=b.clone(e.attributes),w=new Set;if(null==l)return p;const u=f.i3sOverrides.createInteractiveEditSession(l),z=new Map;let y=g.EDITING;A={setAttribute(B,C){if(y===g.EDITING){var k=
f.fieldsIndex.get(B);if(!c.isNone(k)){var q=f.attributeStorageInfo.findIndex(D=>D.name===k.name);if(!(0>q)){u.set(q,C);var x=f.attributeStorageInfo[q],v=!1;w.add(B);f.forEachNode((D,F)=>{var G=z.get(D);null==G?(F=F.indexOf(l),z.set(D,F)):F=G;if(-1!==F&&(G=f.getAttributeData(D.index))){const J=G[x.name];J&&(J[F]=C,f.setAttributeData(D.index,G,e),v=!0)}});v&&f.clearMemCache()}}}},rollback(){if(y===g.EDITING){for(const B of w)this.setAttribute(B,t[B]);u.rollback();y=g.ROLLED_BACK;f.sessions.delete(l)}},
commit(){y===g.EDITING&&(u.commit(),y=g.COMMITTED,f.sessions.delete(l))}};f.sessions.set(l,A);return A};a.processAttributeEdits=function(f,e){e=m(f,e);if(0!==e.size){var l=new Map;for(let t=0;t<f.attributeStorageInfo.length;t++)l.set(f.attributeStorageInfo[t].name,t);var A=!1;e.forEach((t,w)=>{const u=f.getAttributeData(w);let z=!1;t.forEach((y,B)=>{const C=c.isSome(u)?u[B]:null;B=l.get(B);for(const {featureIndex:k,value:q,featureId:x}of y)C&&(C[k]=q,A=z=!0),f.i3sOverrides.updateAttributeValue(x,
B,q)});z&&f.setAttributeData(w,u,null)});A&&f.clearMemCache()}};a.processGeometryEdits=function(f,e){e=[...e.addedFeatures,...e.updatedFeatures,...e.deletedFeatures];for(const l of e)l.objectId&&f.i3sOverrides.updateGeometry(l.objectId)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F){function G(U,Y,V){if(d.isNone(Y))return null;if("disjoint"===V&&"polygon"===Y.type){V=Y.rings.length;const R=Y.spatialReference,X=Array(V);for(let ba=0;ba<V;++ba){const ia=C.fromValues(Infinity,Infinity,-Infinity,-Infinity);C.expandWithNestedArray(ia,Y.rings[ba]);X[ba]={type:"polygon",rings:[Y.rings[ba]],spatialReference:R,cache:{},aabr:ia}}X.sort((ba,ia)=>ba.aabr[0]-ia.aabr[0]);const W=new Set,aa=new p.PositionHint;for(Y=0;Y<X.length;++Y){const ba=
X[Y],ia=ba.aabr[0];W.forEach(ma=>{ia>=ma.aabr[2]?W.delete(ma):ba.aabr[1]>ma.aabr[3]||ba.aabr[3]<ma.aabr[1]||!U.intersects(ba,ma)||(ba.rings=ba.rings.concat(ma.rings),C.expand(ba.aabr,ma.aabr,ba.aabr),ba.cache={},W.delete(ma),ma=p.indexOf(X,ma,X.length,aa),X.splice(ma,1))});W.add(ba)}for(const ba of X)delete ba.aabr;return X}return[Y]}function J(U,Y,V,R,X){const W=O(U,Y,R);return V.every(aa=>P(U,aa,W,X)!==Q.DISCARD)}function L(U,Y,V,R,X,W,aa,ba){const ia=aa[0].spatialReference||X.spatialReference;
if(y.projectBoundingSphere(V.node.mbs,W,T,ia)){W=O(U,T,ia);var ma=K(ba,X,ia,R,V.objectHandle);for(const ha of aa){if(0===Y.length)break;switch(P(U,ha,W,ba)){case Q.DISCARD:Y.length=0;return;case Q.KEEP:continue}D.filterInPlace(Y,V.featureIds,ka=>E(U,ha,ka,ma))}}else I.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function K(U,Y,V,R,X){Y=Y.renderSpatialReference;const W=new Map,aa={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],
spatialReference:V};aa.rings[0][3]=aa.rings[0][0];let ba,ia;switch(U){case "intersects":ba=(ma,ha,ka)=>ma.intersects(ha,ka)?Q.KEEP:Q.TEST;ia=N;break;case "contains":ba=(ma,ha,ka)=>ma.contains(ha,ka)?Q.TEST:Q.DISCARD;ia=N;break;default:ba=(ma,ha,ka)=>ma.disjoint(ha,ka)?Q.TEST:Q.DISCARD,ia=H}return{collection:R,object:X,type:U,maskSR:V,renderSR:Y,aabbCache:W,triangle:aa,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:ba,geometryTest:ia}}function O(U,Y,V){const R={type:"point",
x:Y[0],y:Y[1],hasZ:!1,hasM:!1,spatialReference:V};V=!q.isWGS84(V)&&!q.isWebMercator(V);Y=Number.isNaN(Y[3])?0:h.clamp(Y[3],0,2*k.earth.radius);U=V?U.buffer(R,Y,1):U.geodesicBuffer(R,Y,1);U.type="polygon";return U}function P(U,Y,V,R){switch(R){case "intersects":case "contains":return N(U,Y,V);case "disjoint":return H(U,Y,V)}}function N(U,Y,V){return U.intersects(Y,V)?U.contains(Y,V)?Q.KEEP:Q.TEST:Q.DISCARD}function H(U,Y,V){return U.intersects(Y,V)?U.contains(Y,V)?Q.DISCARD:Q.TEST:Q.KEEP}function E(U,
Y,V,R){const {collection:X,object:W,renderSR:aa,maskSR:ba,geometryTest:ia,aabbCache:ma}=R;var ha=ma.get(V);if(!ha){ha=X.getObjectTransform(W);X.getComponentAabb(W,V,S);var ka=[[S[0],S[1],0],[S[0],S[4],0],[S[3],S[4],0],[S[3],S[1],0]];for(var Z=0;4>Z;++Z)u.transformMat3(ka[Z],ka[Z],ha.rotationScale),u.add(ka[Z],ka[Z],ha.position),y.projectVectorToVector(ka[Z],aa,ka[Z],ba);ha={type:"polygon",rings:[ka],spatialReference:ba,cache:{}};ha.rings[0][4]=ha.rings[0][0];ma.set(V,ha)}switch(ia(U,Y,ha)){case Q.DISCARD:return!1;
case Q.KEEP:return!0}const {triangle:ca,triangleTest:fa,positions:ea}=R;ha=ca.rings[0][0];ka=ca.rings[0][1];Z=ca.rings[0][2];const da=X.getObjectTransform(W);X.getComponentPositions(W,V,ea);const {indices:la,data:oa,stride:ra,startIndex:Aa,endIndex:ua}=ea;for(V=Aa;V<ua;V+=3){const za=ra*la[V+0],va=ra*la[V+1],Ja=ra*la[V+2];u.set(ha,oa[za+0],oa[za+1],oa[za+2]);u.set(ka,oa[va+0],oa[va+1],oa[va+2]);u.set(Z,oa[Ja+0],oa[Ja+1],oa[Ja+2]);u.transformMat3(ha,ha,da.rotationScale);u.transformMat3(ka,ka,da.rotationScale);
u.transformMat3(Z,Z,da.rotationScale);u.add(ha,ha,da.position);u.add(ka,ka,da.position);u.add(Z,Z,da.position);y.projectVectorToVector(ha,aa,ha,ba);y.projectVectorToVector(ka,aa,ka,ba);y.projectVectorToVector(Z,aa,Z,ba);switch(fa(U,Y,ca)){case Q.DISCARD:return!1;case Q.KEEP:return!0}}switch(R.type){case "intersects":return!1;default:return!0}}const I=g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");b.I3SMeshViewFilter=function(U){function Y(R){R=U.call(this,R)||this;R._projectionEngineLoaded=
!1;return R}c._inheritsLoose(Y,U);var V=Y.prototype;V.initialize=function(){e.whenOnce(()=>d.unwrap(this.viewFilter)?.geometry||d.isSome(this.layerFilter)).then(()=>this.loadAsyncModule((new Promise((R,X)=>a(["../../../../geometry/geometryEngine"],R,X))).then(R=>{this.destroyed||(this._geometryEngine=R)})))};V.addFilters=function(R,X,W,aa){const ba=this.sortedObjectIds;d.isSome(ba)&&R.push(ka=>D.objectIdFilter(ba,!0,ka));this.addSqlFilter(R,this.parsedWhereClause);const ia=f.unwrapUpdating(this._layerMaskGeometries),
ma=this._geometryEngine;if(d.isSome(ia)&&d.isSome(this.layerFilter)&&d.isSome(ma)){const ka=this.layerFilter.spatialRelationship;R.push((Z,ca)=>L(ma,Z,ca,aa,X,W,ia,ka))}const ha=f.unwrapUpdating(this._viewMaskGeometries);if(d.isSome(ha)&&d.isSome(this.viewFilter)&&d.isSome(ma)){const ka=this.viewFilter.spatialRelationship;R.push((Z,ca)=>L(ma,Z,ca,aa,X,W,ha,ka))}};V.isMBSGeometryVisible=function(R,X,W){var aa=f.unwrapUpdating(this._layerMaskGeometries);const ba=this._geometryEngine;if(d.isSome(aa)&&
d.isSome(this.layerFilter)&&d.isSome(ba)){var ia=this.layerFilter.spatialRelationship;X=aa[0].spatialReference||X;return y.projectBoundingSphere(R,W,T,X)?J(ba,T,aa,X,ia):(I.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}aa=f.unwrapUpdating(this._viewMaskGeometries);return d.isSome(aa)&&d.isSome(this.viewFilter)&&d.isSome(ba)?(ia=this.viewFilter.spatialRelationship,X=aa[0].spatialReference||X,y.projectBoundingSphere(R,W,T,X)?J(ba,T,
aa,X,ia):(I.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0};Y.checkSupport=function(R){if(d.isNone(R))return!1;if(R.timeExtent)return I.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;R=R.spatialRelationship;return null!=R&&M.includes(R)?!0:(I.warn(`Filters with spatialRelationship other than ${M.join(", ")} are not supported for mesh scene layers`),!1)};c._createClass(Y,[{key:"sortedObjectIds",
get:function(){if(d.isNone(this.viewFilter)||d.isNone(this.viewFilter.objectIds))return null;const R=new Float64Array(this.viewFilter.objectIds);R.sort();return R}},{key:"parsedWhereClause",get:function(){const R=d.isSome(this.viewFilter)?this.viewFilter.where:null;if(d.isNone(R)||!R)return null;try{return z.WhereClause.create(R,this.layerFieldsIndex)}catch(X){I.error(`Failed to parse filter where clause: ${X}`)}return null}},{key:"parsedGeometry",get:function(){const R=f.unwrapUpdating(this._viewMaskGeometries),
X=f.unwrapUpdating(this._layerMaskGeometries);return d.isNone(R)||d.isNone(X)?R||X:X.concat(R)}},{key:"_layerMaskGeometries",get:function(){const R=this.layerFilter;return d.isNone(R)?null:d.isNone(this._geometryEngine)?f.updating:"disjoint"===R.spatialRelationship?R.geometries.map(X=>({type:"polygon",rings:X.rings,spatialReference:X.spatialReference,cache:{}})):[R.geometries.reduce((X,W)=>{X.rings=X.rings.concat(W.rings);return X},{type:"polygon",rings:[],spatialReference:R.geometries[0].spatialReference,
cache:{}})]}},{key:"_viewMaskGeometries",get:function(){if(d.isNone(this.viewFilter))return null;var {geometry:R}=this.viewFilter;if(d.isNone(R))return null;if(d.isNone(this.viewFilter)||d.isNone(this._geometryEngine))return f.updating;const {distance:X,units:W}=this.viewFilter,aa=this.viewFilter.spatialRelationship;R="mesh"===R.type?R.extent:R;if(d.isNone(X)||0===X)return G(this._geometryEngine,R,aa);const ba=W||l.getUnitString(R.spatialReference);if(R.spatialReference.isWGS84)return R=this._geometryEngine.geodesicBuffer(R,
X,ba),G(this._geometryEngine,R,aa);var ia=x.project(R,F.WGS84);if(d.isSome(ia))return R=x.project(this._geometryEngine.geodesicBuffer(ia,X,ba),R.spatialReference),G(this._geometryEngine,R,aa);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(y.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ia=null;try{ia=y.project(R,F.WGS84)}catch(ma){}if(ia)try{ia=y.project(this._geometryEngine.geodesicBuffer(ia,X,ba),R.spatialReference)}catch(ma){ia=null}ia||I.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${R.spatialReference.wkid}) to WGS84.`);
return G(this._geometryEngine,ia,aa)}},{key:"updating",get:function(){return f.isUpdating(this._layerMaskGeometries)||f.isUpdating(this._viewMaskGeometries)}}]);return Y}(n);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);r.__decorate([A.property({type:v})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",
void 0);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);r.__decorate([A.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);r.__decorate([A.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);r.__decorate([A.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);r.__decorate([A.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);r.__decorate([A.property({readOnly:!0})],
b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"updating",null);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);r.__decorate([A.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=r.__decorate([w.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const M=["contains","intersects","disjoint"];var Q;(function(U){U[U.KEEP=0]="KEEP";
U[U.DISCARD=1]="DISCARD";U[U.TEST=2]="TEST"})(Q||(Q={}));const T=[0,0,0,0],S=B.create();Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===b?null:b};a.updating="updating";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w){const u=A.QueryEngine;a.I3SQueryEngine=function(z){function y(C){C=z.call(this,C)||this;C._dataQueryEngineInstance=null;C._handles=new n;return C}b._inheritsLoose(y,z);var B=y.prototype;B.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};B.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};B.executeQueryForCount=function(){var C=b._asyncToGenerator(function*(k,q){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(k),q)});return function(k,q){return C.apply(this,arguments)}}();B.executeQueryForExtent=function(){var C=b._asyncToGenerator(function*(k,q){const {count:x,extent:v}=yield this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(k),q);k=e.fromJSON(v);return{count:x,extent:k}});
return function(k,q){return C.apply(this,arguments)}}();B.executeQueryForIds=function(){var C=b._asyncToGenerator(function*(k,q){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(k),q)});return function(k,q){return C.apply(this,arguments)}}();B.executeQuery=function(){var C=b._asyncToGenerator(function*(k,q){k=this._ensureQueryJSON(k);if(k.returnGeometry)throw new m("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(k.returnCentroid)throw new m("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");q=yield this._dataQueryEngine.executeQuery(k,q);q=t.fromJSON(q);q.features.forEach(x=>{x.geometry=null});return q});return function(k,q){return C.apply(this,arguments)}}();B._ensureQueryJSON=function(C){return p.isNone(C)?this.defaultQueryJSON:C.toJSON()};B._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const C=this.layer.objectIdField||l.fallbackObjectIDAttribute,k=this.layer.fields.map(v=>
v.toJSON()),q=this.layerView.view.resourceController.scheduler,x=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new u({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:k,timeInfo:null,spatialReference:x,objectIdField:C,featureStore:this.spatialIndex,scheduler:q,priority:this.priority})};b._createClass(y,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",
get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return y}(r);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);c.__decorate([g.property()],a.I3SQueryEngine.prototype,
"spatialReference",null);c.__decorate([g.property()],a.I3SQueryEngine.prototype,"layer",null);c.__decorate([g.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=c.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,b,c,r,m,n){let p=function(){function h(f){this._objectIdField=f.objectIdField;this._getFeatureExtent=f.getFeatureExtent}var d=h.prototype;d.getObjectId=function(f){return f.id};d.getAttributes=function(f){const {meta:e,index:l}=f,A={};this._objectIdField&&(A[this._objectIdField]=f.id);f=b.isSome(e.attributeInfo)&&e.attributeInfo.attributeData;if(b.isSome(f))for(const t of Object.keys(f))A[t]=n.getCachedAttributeValue(f[t],l);return A};d.getAttribute=function(f,e){if(e===this._objectIdField)return f.id;
const {meta:l,index:A}=f;f=b.isSome(l.attributeInfo)&&l.attributeInfo.attributeData;return b.isSome(f)?n.getCachedAttributeValue(f[e],A):null};d.getGeometry=function(f){if(f.geometry)return f.geometry;const [e,l,A,t,w]=this._getFeatureExtent(f,g);return new m([5],[e,l,A,t,l,A,t,w,A,e,w,A,e,l,A])};d.getCentroid=function(f,e){if(f.geometry)return r.getCentroidOptimizedGeometry(new m,f.geometry,e.hasZ,e.hasM);const [l,A,t,w,u,z]=this._getFeatureExtent(f,g);return new m([0],[(l+w)/2,(A+u)/2,(t+z)/2])};
d.cloneWithGeometry=function(f,e){const {id:l,index:A,meta:t}=f;return{id:l,index:A,meta:t,geometry:e}};return h}();const g=c.create();a.I3SQueryFeatureAdapter=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../II3SMeshView3D".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A){a.I3SQueryFeatureStore=function(z){function y(C){C=z.call(this,C)||this;C.events=new m;return C}b._inheritsLoose(y,z);var B=y.prototype;B.forEach=function(C){this.forAllFeatures(k=>{C(k);return A.ForAllFeaturesReturnType.CONTINUE})};B.forEachBounds=function(C,k,q){const x=this.getFeatureExtent;for(const v of C)k(x(v,q))};B.forEachInBounds=function(C,k){this.forAllFeatures(q=>{const x=this.getFeatureExtent(q,w);l.intersects(C,e.toRect(x,u))&&k(q);return A.ForAllFeaturesReturnType.CONTINUE},
q=>{f.projectBoundingSphere(q.node.mbs,this.sourceSpatialReference,t,this.viewSpatialReference);if(t[0]>=C[0]&&t[2]<=C[2]&&t[1]>=C[1]&&t[3]<=C[3])return A.ForAllFeaturesReturnType.CONTINUE;q=t[0]-Math.max(C[0],Math.min(t[0],C[2]));const x=t[1]-Math.max(C[1],Math.min(t[1],C[3]));return q*q+x*x<=t[3]*t[3]?A.ForAllFeaturesReturnType.CONTINUE:A.ForAllFeaturesReturnType.SKIP})};return y}(r);c.__decorate([n.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);c.__decorate([n.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"toArray",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=
c.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const t=d.create(),w=e.create(),u=l.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,b,c,r,m,n,p,g,h,d){a.DefinitionExpressionSceneLayerView=f=>{f=function(e){function l(){var t=e.apply(this,arguments)||this;t._definitionExpressionErrors=0;t._maxDefinitionExpressionErrors=20;t.logError=w=>{t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&r.getLogger(t.declaredClass).error("Error while evaluating definitionExpression: "+w);t._definitionExpressionErrors++;t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&r.getLogger(t.declaredClass).error("Further errors are ignored")};
return t}b._inheritsLoose(l,e);var A=l.prototype;A._evaluateClause=function(t,w){try{return t.testFeature(w)}catch(u){return this.logError(u),!1}};A._addDefinitionExpressionToQuery=function(t){if(!this.parsedDefinitionExpression)return t;const w=this.i3slayer.definitionExpression;t=t.clone();t.where=t.where?`(${w}) AND (${t.where})`:w;return t};b._createClass(l,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const t=h.WhereClause.create(this.i3slayer.definitionExpression,
this.i3slayer.fieldsIndex);if(!t.isStandardized)return r.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;const w=[];d.findFieldsCaseInsensitive(t.fieldNames,this.i3slayer.fields,{missingFields:w});if(0<w.length)return r.getLogger(this.declaredClass).error(`definitionExpression references unknown fields: ${w.join(", ")}`),null;this._definitionExpressionErrors=0;return t}catch(t){return r.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+
t),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}}]);return l}(f);c.__decorate([m.property()],f.prototype,"i3slayer",void 0);c.__decorate([m.property({readOnly:!0})],f.prototype,"parsedDefinitionExpression",null);c.__decorate([m.property({readOnly:!0})],f.prototype,"definitionExpressionFields",null);return f=c.__decorate([g.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],
f)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:c,layer:{fieldsIndex:r},requiredFields:m}=this;return c.outFields?b.fixFields(r,[...b.unpackFieldNames(r,c.outFields),
...m]):b.fixFields(r,m)}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e){function l(t){return A.apply(this,arguments)}function A(){A=b._asyncToGenerator(function*(t){const w=new Set;try{return yield t(w),Array.from(w).sort()}catch(u){return n.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(u),null}});return A.apply(this,arguments)}a.SceneLayerViewRequiredFields=function(t){function w(u){return t.call(this,u)||this}b._inheritsLoose(w,t);w.prototype.initialize=function(){this.layer=this.layerView.layer;this.handles.add([this.autoUpdateAsync("rendererFields",
()=>{const {fieldsIndex:u,renderer:z}=this.layer;return z?l(y=>z.collectRequiredFields(y,u)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:u}=this;return u.labelsVisible?l(z=>e.collectLabelingFields(z,u)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:u,filter:z}=this.layerView;return l(y=>e.collectFilterFields(y,u,z))})])};b._createClass(w,[{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:u},definitionExpressionFields:z},rendererFields:y,
labelingFields:B,viewFilterFields:C}=this;return e.fixFields(u,[...p.unwrapOr(z,[]),...p.unwrapOr(y,[]),...p.unwrapOr(B,[]),...p.unwrapOr(C,[])])}}]);return w}(r.AsyncUpdateMixin(m.HandleOwner));c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,
"rendererFields",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=c.__decorate([f.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,b,c,r,m,n,p,g,h){function d(l,A){const t=()=>{if(!w||u)return A();w.clear();u=!0;const z=n.runTracked(w,A);u=!1;return z};let w=new h.SimpleTrackingTarget(()=>{w&&!u&&l(t)}),u=!1;l(t);return{remove:()=>{w&&(w.destroy(),w=null)}}}const f=l=>{l=function(A){function t(){var u=A.apply(this,arguments)||this;u._numUpdating=0;u._asyncUpdateState=new Map;return u}b._inheritsLoose(t,A);var w=t.prototype;w.autoUpdateAsync=function(u,z){return d(y=>this._updateAsync(u,y),z)};w._updateAsync=function(){var u=
b._asyncToGenerator(function*(z,y){if(!this._startAsyncUpdate(z)){try{const B=yield y();this._set(z,B)}catch(B){m.getLogger(this.declaredClass).warn(`Async update of "${String(z)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(z)&&this._updateAsync(z,y)}});return function(z,y){return u.apply(this,arguments)}}();w._startAsyncUpdate=function(u){const z=this._asyncUpdateState.get(u)??e.None;if(z&e.Updating)return this._asyncUpdateState.set(u,z|e.Invalidated),!0;++this._numUpdating;
this._asyncUpdateState.set(u,z|e.Updating);return!1};w._endAsyncUpdate=function(u){--this._numUpdating;const z=(this._asyncUpdateState.get(u)??e.None)&~e.Updating;if(z&e.Invalidated)return this._asyncUpdateState.set(u,z&~e.Invalidated),!0;this._asyncUpdateState.set(u,z);return!1};b._createClass(t,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return t}(l);c.__decorate([p.property({readOnly:!0})],l.prototype,"updating",null);c.__decorate([p.property()],l.prototype,"_numUpdating",void 0);
return l=c.__decorate([g.subclass("esri.core.AsyncUpdate")],l)};var e;(function(l){l[l.None=0]="None";l[l.Updating=1]="Updating";l[l.Invalidated=2]="Invalidated"})(e||(e={}));a.AsyncUpdate=function(l){function A(){return l.apply(this,arguments)||this}b._inheritsLoose(A,l);return A}(f(r));a.AsyncUpdate=c.__decorate([g.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l){const A=r.getLogger("esri.views.layers.SceneLayerView");r=function(t){function w(){var z=t.apply(this,arguments)||this;z.layer=null;z.filter=null;z._geometryEngine=null;z._projectionEngineLoaded=!1;return z}b._inheritsLoose(w,t);var u=w.prototype;u.initialize=function(){var z=this;p.whenOnce(()=>!this._geometryEngine&&m.isSome(this.layer.filter)&&this.layer.filter.geometries.length).then(b._asyncToGenerator(function*(){return z._geometryEngine=yield new Promise((y,
B)=>a(["../../geometry/geometryEngine"],y,B))}));this._projectionEngineLoaded=e.isLoaded();p.whenOnce(()=>!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine).then(b._asyncToGenerator(function*(){yield e.load();z._projectionEngineLoaded=!0}))};u.highlight=function(z){throw Error("Not implemented");};u.queryFeatures=function(z,y){throw Error("Not implemented");};u.queryObjectIds=function(z,y){throw Error("Not implemented");};u.queryFeatureCount=function(z,y){throw Error("Not implemented");
};u.createQuery=function(){throw Error("Not implemented");};u.queryExtent=function(z,y){throw Error("Not implemented");};b._createClass(w,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(z){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return n.unwrapUpdating(this._layerFilter)}},{key:"_layerFilter",get:function(){const z=this.layer.filter;if(m.isNone(z)||
1>z.geometries.length)return null;const y=this._geometryEngine;if(m.isNone(y)||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return n.updating;const B=z.geometries.getItemAt(0).spatialReference,C=z.geometries.toArray().map(v=>{try{v=y.simplify(v)}catch(D){return A.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==v)return null;if(v.spatialReference.equals(B))return v;try{return e.project(v,B)}catch(D){return A.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(v=>null!=v).sort((v,D)=>v.extent.xmin-D.extent.xmin),k=new Set,q=[],x=[];for(let v of C){const D=v.extent.xmin;q.length=0;k.forEach(F=>{D>=F.extent.xmax?(x.push(F),k.delete(F)):v.extent.ymin<=F.extent.ymax&&v.extent.ymax>=F.extent.ymin&&y.intersects(v,F)&&q.push(F)});if(0<q.length){q.push(v);try{v=y.union(q)}catch(F){A.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}q.pop();q.forEach(F=>k.delete(F))}k.add(v)}k.forEach(v=>x.push(v));return 0<
x.length?{spatialRelationship:z.spatialRelationship,geometries:x}:null}},{key:"_filterNeedsProjectionEngine",get:function(){const z=this.layer.filter;if(m.isNone(z)||1>=z.geometries.length)return!1;const y=z.geometries.getItemAt(0).spatialReference;return z.geometries.some(({spatialReference:B})=>!B.equals(y)&&!e.canProjectWithoutEngine(B,y))}},{key:"layerFilterUpdating",get:function(){return n.isUpdating(this._layerFilter)}}]);return w}(l);c.__decorate([g.property()],r.prototype,"layer",void 0);
c.__decorate([g.property()],r.prototype,"availableFields",null);c.__decorate([g.property()],r.prototype,"maximumNumberOfFeatures",null);c.__decorate([g.property({readOnly:!0})],r.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([g.property()],r.prototype,"filter",void 0);c.__decorate([g.property({readOnly:!0})],r.prototype,"layerFilter",null);c.__decorate([g.property({readOnly:!0})],r.prototype,"_layerFilter",null);c.__decorate([g.property()],r.prototype,"_geometryEngine",void 0);c.__decorate([g.property()],
r.prototype,"_projectionEngineLoaded",void 0);c.__decorate([g.property()],r.prototype,"_filterNeedsProjectionEngine",null);c.__decorate([g.property()],r.prototype,"layerFilterUpdating",null);return r=c.__decorate([f.subclass("esri.views.layers.SceneLayerView")],r)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/contains ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T){function S(R){const X=R.attributeInfo;for(let W=0;W<R.graphics.length;W++){const aa=R.graphics[W];aa.attributes||(aa.attributes={});if(p.isSome(X)&&p.isSome(X.loadedAttributes))for(const {name:ba}of X.loadedAttributes)X.attributeData[ba]&&(aa.attributes[ba]=J.getCachedAttributeValue(X.attributeData[ba],W))}}d=K.defineFieldProperties();x=function(R){function X(){var aa=R.apply(this,arguments)||this;aa.type="scene-layer-graphics-3d";
aa._nodesAddedToStage=new Map;aa._queryEngine=null;aa._memCache=null;aa._interactiveEditingSessions=new Map;aa.loadedGraphics=new H.GraphicsMap;aa.holeFilling="always";aa.progressiveLoadFactor=1;aa.supportsHeightUnitConversion=!0;aa._coordinatesOutsideExtentErrors=0;aa._maxCoordinatesOutsideExtentErrors=20;return aa}b._inheritsLoose(X,R);var W=X.prototype;W.initialize=function(){const aa=this.layer;this.addResolvingPromise(aa.indexInfo);this._i3sOverrides=new G.I3SOverrides({view:this.view,layer:this.layer,
memoryController:this.view.resourceController?.memoryController});J.checkSpatialReferences(aa,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new P.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>aa.rangeInfos,ba=>this._rangeInfosChanged(ba),g.initial);this.updatingHandles.add(()=>aa.renderer,(ba,ia)=>this._rendererChange(ba,ia));this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange());this.handles.add(g.watch(()=>
N.I3S_TREE_SHOW_TILES,ba=>{if(ba&&!this._treeDebugger){const ia=this._controller.crsIndex;(new Promise((ma,ha)=>a(["./support/I3STreeDebugger"],ma,ha))).then(({I3STreeDebugger:ma})=>{!this._treeDebugger&&N.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ma({lv:this,view:this.view,nodeSR:ia}))})}else ba||!this._treeDebugger||N.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},g.initial));this._set("processor",new v({owner:this,preferredUpdatePolicy:M.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,
filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:aa.fullExtent,updateClippingExtent:ba=>this._updateClippingExtent(ba)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",ba=>this._controller.updateElevationChanged(ba.extent,ba.spatialReference));this.supportsHeightUnitConversion&&(this._verticalScale=w.getGeometryZScaler("point",aa.spatialReference,this.view.spatialReference));
this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(aa.uid);this._controller=new B({layerView:this,scaleVisibilityEnabled:!1});J.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new q.I3SPointsWorkerHandle(ba=>this.view.resourceController.schedule(ba)));this.handles.add(this.layer.on("apply-edits",ba=>this.updatingHandles.addPromise(ba.result)));this.handles.add(this.layer.on("edits",ba=>this._handleEdits(ba)));
this.when(()=>{const ba=()=>this.processor.featureStore;this._queryEngine=new D.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return ba()},hasZ:this.hasZ,hasM:this.hasM},priority:T.TaskPriority.FEATURE_QUERY_ENGINE});this.updatingHandles.add(()=>this.maximumNumberOfFeatures,ia=>this._controller.featureTarget=ia,g.initial);this.updatingHandles.add(()=>this.suspended,ia=>{ia&&this._removeAllNodeData()})})};
W.destroy=function(){this._treeDebugger=p.destroyMaybe(this._treeDebugger);this._i3sOverrides=p.destroyMaybe(this._i3sOverrides);this._set("processor",p.destroyMaybe(this.processor));this._controller=p.destroyMaybe(this._controller);this._queryEngine=p.destroyMaybe(this._queryEngine);this._worker=p.destroyMaybe(this._worker);this._memCache=p.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this._fieldsHelper=p.destroyMaybe(this._fieldsHelper)};W.whenGraphicAttributes=function(){var aa=
b._asyncToGenerator(function*(ba,ia){return J.whenGraphicAttributes(this.layer,ba,this._getObjectIdField(),ia,()=>[...this._nodesAddedToStage.values()])});return function(ba,ia){return aa.apply(this,arguments)}}();W.getHit=function(aa){if(!this.loadedGraphics)return null;const ba=y.hydrateGraphic(this.loadedGraphics.find(ma=>ma.uid===aa),this.layer),ia=this._getObjectIdField();if(!ba||!ba.attributes||!ba.attributes[ia])return null;ba.layer=this.layer;ba.sourceLayer=this.layer;return{type:"graphic",
graphic:ba,layer:ba.layer}};W.whenGraphicBounds=function(aa,ba){return this.processor.whenGraphicBounds(aa,ba)};W.computeAttachmentOrigin=function(aa,ba){return this.processor.computeAttachmentOrigin(aa,ba)};W.canResume=function(){return R.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};W.isUpdating=function(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)};W.highlight=function(aa){return this.processor.highlight(aa,
this.layer.objectIdField)};W.createInteractiveEditSession=function(aa){return F.createInteractiveEditSession(this._attributeEditingContext,aa)};W._extractBinaryPointData=function(){var aa=b._asyncToGenerator(function*(ba,ia){ba={geometryBuffer:ba.geometryBuffer};p.isNone(this._worker)&&(this._worker=new q.I3SPointsWorkerHandle(ma=>this.view.resourceController.schedule(ma)));return this._worker.invoke(ba,ia).then(ma=>{if(p.isSome(ma))return{positionData:ma.positions,featureIds:ma.featureIds};throw Error("Failed to decompress Draco point data");
})});return function(ba,ia){return aa.apply(this,arguments)}}();W._checkExtent=function(aa,ba){aa&&!t.extentContainsCoords3D(aa,ba)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&n.getLogger(this.declaredClass).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&n.getLogger(this.declaredClass).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};
W.addNode=function(){var aa=b._asyncToGenerator(function*(ba,ia,ma){if(!("geometryBuffer"in ia&&null!==ia.geometryBuffer||"pointData"in ia))throw Error();if(this._nodesAddedToStage.has(ba.index))n.getLogger(this.declaredClass).error("I3S node "+ba.id+" already added");else{if(p.isSome(this.layer.fullExtent)){var ha=this.layer.fullExtent.clone();ha.xmin-=.5;ha.ymin-=.5;ha.xmax+=.5;ha.ymax+=.5;ha.hasZ&&(ha.zmin-=.5,ha.zmax+=.5);ha.hasM&&(ha.mmin-=.5,ha.mmax+=.5)}else ha=null;var ka=ha,Z=this._controller.crsVertex,
ca=[];ha={graphics:null,featureIds:null,attributeInfo:ia.attributeDataInfo,node:ba};"geometryBuffer"in ia&&null!==ia.geometryBuffer?yield this._addNodeBinaryPointData(ba,ha,ia,ka,ca,ma):"pointData"in ia&&this._addNodeLegacyPointData(ba,ha,ia,ka,ca);yield this._i3sOverrides.apply(ha.featureIds,ia.attributeDataInfo,ma);ba.numFeatures=ha.graphics.length;this._updateNodeMemory(ba);S(ha);0<ca.length&&(this._computeObb(ba,ca,Z),this._controller.updateVisibility(ba.index));if(this._controller.isGeometryVisible(ba)){if(p.isSome(this._verticalScale))for(const fa of ha.graphics)this._verticalScale(fa.geometry);
if(ia=this.view._stage.renderView._objectAndLayerIdRenderHelper)for(ma=0;ma<ha.featureIds.length;ma++)ia.setUidToObjectAndLayerId(ha.featureIds[ma],ha.graphics[ma].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled,ha.node.resources.attributes,ma);this._nodesAddedToStage.set(ba.index,ha);this.loadedGraphics.addMany(ha.graphics);this._controller.updateLoadStatus(ba.index,!0);this._filterNode(ha);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(ha)}});return function(ba,
ia,ma){return aa.apply(this,arguments)}}();W._computeObb=function(aa,ba,ia){const ma=this._controller.crsIndex,ha=ma.isGeographic?this.view.renderSpatialReference:ma;A.projectBuffer(ba,ia,0,ba,ha,0,ba.length/3);aa.serviceObb=E.compute({data:ba,size:3});ma.isGeographic&&A.projectVectorToVector(aa.serviceObb.center,ha,aa.serviceObb.center,ma)};W.isNodeLoaded=function(aa){return this._nodesAddedToStage.has(aa)};W.isNodeReloading=function(){return!1};W.updateNodeState=function(){};W._addNodeBinaryPointData=
function(){var aa=b._asyncToGenerator(function*(ba,ia,ma,ha,ka,Z){var ca=yield this._extractBinaryPointData(ma,Z);if(null==ca)throw Error();ma=this._getObjectIdField();Z=this._controller.crsVertex;const fa=this.view.spatialReference,ea=this.processor.graphicsCore,{positionData:da,featureIds:la}=ca;ca=da.length/3;const oa=[],ra=p.isSome(ba.serviceObb)?ba.serviceObb.center:[0,0,0],Aa=Math.abs(ra[2])*2**-20;for(let pa=0;pa<ca;pa++){var ua=3*pa,za=l.fromValues(da[ua+0],da[ua+1],da[ua+2]);e.add(za,za,
ra);Math.abs(za[2])<Aa&&(za[2]=0);ba.serviceObb||ka.push(za[0],za[1],za[2]);p.isSome(ha)&&this._checkExtent(ha,za);var va=la[pa];ua={};null!=va&&(ua[ma]=va);va=null==va?r.generateUID():va;A.projectBuffer(za,Z,0,Y,fa,0,1);za=z.makeDehydratedPoint(Y[0],Y[1],Y[2],fa);var Ja=this.loadedGraphics.get(va);p.isSome(Ja)?(Ja.level<ba.level&&(V.property="geometry",V.graphic=Ja,V.oldValue=p.unwrap(Ja.geometry),V.newValue=za,Ja.geometry=za,ea.graphicUpdateHandler(V)),oa.push(Ja)):(Ja=r.generateUID(),oa.push({objectId:va,
uid:Ja,geometry:za,attributes:ua,visible:!0,level:ba.level}))}ia.graphics=oa;ia.featureIds=Array.from(la)});return function(ba,ia,ma,ha,ka,Z){return aa.apply(this,arguments)}}();W._addNodeLegacyPointData=function(aa,ba,ia,ma,ha){const ka=this._getObjectIdField(),Z=this._controller.crsVertex,ca=this.view.spatialReference,fa=[0,0,0],ea=[],da=[];for(const ra of ia.pointData){ia=ra.featureDataPosition;const Aa=ia.length;var la=ra.geometries&&ra.geometries[0]||U[Aa];const ua=ra.featureIds[0];if("points"!==
la.params.type)continue;p.isSome(ma)&&this._checkExtent(ma,ia);const za={};null!=ua&&(za[ka]=ua);const va=null==ua?r.generateUID():ua;let Ja;"Embedded"===la.type&&(Ja=la.params.vertexAttributes.position);for(la=0;la<Ja.length;la+=Aa){for(var oa=0;oa<Aa;oa++)fa[oa]=ia[oa]+Ja[la+oa];oa=3===Aa;aa.serviceObb||ha.push(fa[0],fa[1],oa?fa[2]:0);A.projectBuffer(fa,Z,0,Y,ca,0,1);oa=z.makeDehydratedPoint(Y[0],Y[1],oa?Y[2]:void 0,ca);const pa=this.loadedGraphics.get(va);p.isSome(pa)?da.push(pa):da.push({objectId:va,
uid:r.generateUID(),geometry:oa,attributes:za,visible:!0})}ea.push(ua)}ba.graphics=da;ba.featureIds=ea};W._updateNodeMemory=function(aa){aa.memory=4096+(p.isSome(aa.numFeatures)?aa.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};W._cacheNodeData=function(aa){const ba=aa.graphics.reduce((ia,ma)=>z.estimateSize(ma)+ia,8*aa.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(aa.node),aa,ba)};W._getMemCacheKey=function(aa){return`${aa.index}`};W._removeAllNodeData=function(){this._nodesAddedToStage.forEach((aa,
ba)=>{aa&&(this._updateNodeMemory(aa.node),this._cacheNodeData(aa));this._controller.updateLoadStatus(ba,!1)});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};W.removeNode=function(aa){if(aa=this._removeNodeStageData(aa))this._updateNodeMemory(aa.node),this._cacheNodeData(aa)};W._removeNodeStageData=function(aa){const ba=this._nodesAddedToStage.get(aa);if(!ba)return null;this._controller.updateLoadStatus(aa,!1);this.loadedGraphics.removeMany(ba.graphics);
this._nodesAddedToStage.delete(aa);this._treeDebugger&&this._treeDebugger.update();return ba};W.loadCachedNodeData=function(){var aa=b._asyncToGenerator(function*(ba){return this._memCache.pop(this._getMemCacheKey(ba))});return function(ba){return aa.apply(this,arguments)}}();W.addCachedNodeData=function(){var aa=b._asyncToGenerator(function*(ba,ia,ma,ha){this._nodesAddedToStage.has(ba.index)?n.getLogger(this.declaredClass).error("I3S node "+ba.id+" already added"):(this.loadedGraphics.addMany(ia.graphics),
this._nodesAddedToStage.set(ba.index,ia),this._controller.updateLoadStatus(ba.index,!0),this._updateNodeMemory(ba),yield this.updateAttributes(ba.index,ma,ha),this._filterNode(ia),this._treeDebugger&&this._treeDebugger.update())});return function(ba,ia,ma,ha){return aa.apply(this,arguments)}}();W.getLoadedNodeIds=function(){const aa=[];this._nodesAddedToStage.forEach(ba=>aa.push(ba.node.id));return aa.sort()};W.getVisibleNodes=function(){const aa=[];this._nodesAddedToStage.forEach(ba=>aa.push(ba.node));
return aa};W.getLoadedNodeIndices=function(aa){this._nodesAddedToStage.forEach((ba,ia)=>aa.push(ia))};W.getLoadedAttributes=function(aa){if((aa=this._nodesAddedToStage.get(aa))&&p.isSome(aa.attributeInfo))return aa.attributeInfo.loadedAttributes};W.getAttributeData=function(aa){if((aa=this._nodesAddedToStage.get(aa))&&p.isSome(aa.attributeInfo))return aa.attributeInfo.attributeData};W._setAttributeData=function(aa,ba){(aa=this._nodesAddedToStage.get(aa))&&!p.isNone(aa.attributeInfo)&&(aa.attributeInfo.attributeData=
ba,this._attributeValuesChanged(aa))};W.updateAttributes=function(){var aa=b._asyncToGenerator(function*(ba,ia,ma){if(ba=this._nodesAddedToStage.get(ba))yield this._i3sOverrides.apply(ba.featureIds,ia,ma),ba.attributeInfo=ia,this._attributeValuesChanged(ba)});return function(ba,ia,ma){return aa.apply(this,arguments)}}();W._attributeValuesChanged=function(aa){S(aa);this._filterNode(aa);this.processor.graphicsCore.labelsEnabled&&(aa=aa.graphics.map(ba=>ba.uid),this.processor.graphicsCore.updateLabelingInfo(aa))};
W._updateClippingExtent=function(aa){this._controller&&this._controller.updateClippingArea(aa);return!1};W._getObjectIdField=function(){return this.layer.objectIdField||u.fallbackObjectIDAttribute};W._rendererChange=function(){var aa=b._asyncToGenerator(function*(ba,ia){const {layer:{fieldsIndex:ma}}=this,ha=new Set;let ka;ba?(yield ba.collectRequiredFields(ha,ma),ka=Array.from(ha).sort()):ka=[];ha.clear();let Z;ia?(yield ia.collectRequiredFields(ha,ma),Z=Array.from(ha).sort()):Z=[];ka.length===Z.length&&
ka.every((ca,fa)=>ka[fa]===Z[fa])||this._reloadAllNodes()});return function(ba,ia){return aa.apply(this,arguments)}}();W._rangeInfosChanged=function(aa){null!=aa&&0<aa.length&&n.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};W._filterChange=function(){this._nodesAddedToStage.forEach(aa=>this._filterNode(aa))};W._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};
W._filterNode=function(aa){const ba=this.parsedDefinitionExpression,ia=this._excludeObjectIdsSorted,ma=this._getObjectIdField();for(const ha of aa.graphics){aa=ha.visible;const ka=!ba||this._evaluateClause(ba,ha),Z=p.isNone(ia)||0>m.binaryIndexOf(ia,ha.attributes[ma]);ha.visible=ka&&Z;aa!==ha.visible&&(V.graphic=ha,V.property="visible",V.oldValue=aa,V.newValue=ha.visible,this.processor.graphicsCore.graphicUpdateHandler(V))}};W.createQuery=function(){const aa={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};
return p.isSome(this.filter)?this.filter.createQuery(aa):new k(aa)};W.queryFeatures=function(aa,ba){return this._queryEngine.executeQuery(this._ensureQuery(aa),ba?.signal)};W.queryObjectIds=function(aa,ba){return this._queryEngine.executeQueryForIds(this._ensureQuery(aa),ba?.signal)};W.queryFeatureCount=function(aa,ba){return this._queryEngine.executeQueryForCount(this._ensureQuery(aa),ba?.signal)};W.queryExtent=function(aa,ba){return this._queryEngine.executeQueryForExtent(this._ensureQuery(aa),
ba?.signal)};W._ensureQuery=function(aa){return this._addDefinitionExpressionToQuery(p.isNone(aa)?this.createQuery():k.from(aa))};W.getUsedMemory=function(){return this.processor?.graphicsCore?.usedMemory??0};W.getUnloadedMemory=function(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))};W.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};W._handleEdits=function(aa){F.processAttributeEdits(this._attributeEditingContext,
aa)};b._createClass(X,[{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??1}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"maximumNumberOfFeatures",get:function(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0},set:function(aa){null!=aa?(this._override("maximumNumberOfFeatures",aa),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),
this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",get:function(){const aa=this.layer.excludeObjectIds;return aa.length?aa.toArray().sort((ba,ia)=>ba-ia):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},
{key:"hasZ",get:function(){return!0}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"_attributeEditingContext",get:function(){const aa=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:aa,forEachNode:ba=>this._nodesAddedToStage.forEach(ia=>ba(ia.node,ia.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,i3sOverrides:this._i3sOverrides,getAttributeData:ba=>
this.getAttributeData(ba),setAttributeData:(ba,ia,ma)=>{this._setAttributeData(ba,ia);ba=this._nodesAddedToStage.get(ba);p.isSome(ma)?(ma=this.loadedGraphics.get(ma.attributes[aa]),p.isSome(ma)&&this.processor.graphicsCore.recreateGraphics([ma])):p.isSome(ba)&&this.processor.graphicsCore.recreateGraphics(ba.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const aa={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,
nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(aa);return aa}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}}]);return X}(L.DefinitionExpressionSceneLayerView(O.PopupSceneLayerView(x.LayerView3D(Q))));c.__decorate([h.property()],x.prototype,"processor",void 0);c.__decorate([h.property({type:C})],x.prototype,"filter",void 0);
c.__decorate([h.property()],x.prototype,"loadedGraphics",void 0);c.__decorate([h.property()],x.prototype,"i3slayer",null);c.__decorate([h.property()],x.prototype,"_controller",void 0);c.__decorate([h.property()],x.prototype,"updating",void 0);c.__decorate([h.property()],x.prototype,"suspended",void 0);c.__decorate([h.property()],x.prototype,"holeFilling",void 0);c.__decorate([h.property(I.updatingProgress)],x.prototype,"updatingProgress",void 0);c.__decorate([h.property()],x.prototype,"updatingProgressValue",
null);c.__decorate([h.property(d.requiredFields)],x.prototype,"requiredFields",null);c.__decorate([h.property(d.availableFields)],x.prototype,"availableFields",void 0);c.__decorate([h.property()],x.prototype,"_fieldsHelper",void 0);c.__decorate([h.property({type:Number})],x.prototype,"maximumNumberOfFeatures",null);c.__decorate([h.property({readOnly:!0})],x.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([h.property()],x.prototype,"_excludeObjectIdsSorted",null);c.__decorate([h.property({readOnly:!0})],
x.prototype,"lodFactor",null);c.__decorate([h.property({readOnly:!0})],x.prototype,"hasM",null);c.__decorate([h.property({readOnly:!0})],x.prototype,"hasZ",null);c=x=c.__decorate([f.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],x);const U={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},Y=l.create(),V={graphic:null,property:null,oldValue:null,newValue:null};return c})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(r){function m(n){return r.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:p=>[p.geometryBuffer]},n,{hasInitialize:!0})||this}b._inheritsLoose(m,r);return m}(c.WorkerHandle);a.I3SPointsWorkerHandle=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
b,c,r,m,n,p,g,h,d,f,e,l,A,t,w,u,z,y,B,C,k,q,x,v,D,F,G,J,L,K,O,P,N,H,E,I,M,Q,T,S,U,Y,V,R,X,W,aa,ba,ia,ma,ha,ka,Z,ca,fa,ea,da,la,oa,ra,Aa,ua,za,va,Ja,pa,Ba,Ha,wa,ya,Na,Ra,Sa,ja,Ta,qa,Ea,Oa,Va,Ua,La,ta,xa,Ia,Qa,Xa,cb,db){function fb(ab,ib){ab.layerUids||(ab.layerUids=new Set);ab.layerUids.add(ib)}function jb(ab,ib){return w.isSome(ab)&&K.canProjectWithoutEngine(ab.spatialReference,ib)?K.project(ab,ib):null}const qb=ab=>Object.freeze(Object.defineProperty({__proto__:null,default:ab},Symbol.toStringTag,
{value:"Module"}));m=function(ab){function ib(Fa){var na=ab.call(this,Fa)||this;na._userClippingArea=null;na._clippingArea=null;na._initialDefaultSpatialReference=null;na._defaults={};na._externallySet={environment:!1};na._createGraphicsViewController=null;na._resolveWhenReady=[];na._propertiesPool=new za.PropertiesPool({slicePlane:P.BoundedPlaneClass},b._assertThisInitialized(na));na._resourceController=pa.newResourceController(b._assertThisInitialized(na));na._defaultToMapOptions={include:new Set};
na._defaultHitTestOptions={exclude:new Set};na.deconflictor=new ha.GraphicsDeconflictor({view:b._assertThisInitialized(na)});na.labeler=new ka.Labeler({view:b._assertThisInitialized(na),deconflictor:na.deconflictor.labels});na.sharedSymbolResources=null;na.analyses=new M.AnalysesCollection;na.basemapTerrain=null;na.elevationProvider=null;na.canvas=null;na.constraints=new aa.Constraints;na.environmentManager=new ia.SceneViewEnvironmentManager;na.floors=new g;na.fullOpacity=1;na.graphicsView=null;na.analysisViewManager=
new W({view:b._assertThisInitialized(na)});na.groundView=null;na.map=null;na.screenSizePerspectiveEnabled=!0;na.state=new ca;na.spatialReference=null;na.alphaCompositingEnabled=!1;na.preserveDrawingBufferEnabled=!1;na.supersampleScreenshotsEnabled=!0;na.type="3d";na.ui=new Ia;na._numUpdating=0;na._lastUpdateTime=0;na.updatingProgress=.5;na.highlightOptions=new Aa;na.voxelWasm=null;na.voxelWasmPromise=null;k.initialize();Fa&&Fa.environment||(na._defaults.environment=new ba,na.environment=na._defaults.environment);
const Da=(Ma=null)=>{w.isSome(Ma)&&Ma.type===u.ObservableChangesType.MOVE||(na._updatingChanged(),na.map&&na.map.allLayers.forEach(function(){var Pa=b._asyncToGenerator(function*(Wa){try{yield Wa.when()}catch{}na._updatingChanged()});return function(Wa){return Pa.apply(this,arguments)}}()))};na.handles.add([y.on(()=>na.map?.allLayers,"after-changes",Ma=>Da(Ma),{onListenerAdd:()=>Da(),onListenerRemove:()=>Da(),sync:!0}),na.allLayerViews.on("after-changes",Ma=>na._updateUpdatingMonitors(Ma)),y.watch(()=>
na.map,Ma=>{Ma&&"load"in Ma&&Ma.load&&Ma.load().catch(()=>{})})]);na.inputManager=new ma({view:b._assertThisInitialized(na)});na.stateManager=new fa.ViewStateManager({view:b._assertThisInitialized(na)});return na}b._inheritsLoose(ib,ab);var bb=ib.prototype;bb.initialize=function(){this.groundView=new S({view:this});this._updateUpdatingMonitors();const Fa=()=>this._updateDefaultToMapOptions();this.handles.add(y.on(()=>this.map?.allLayers,"after-changes",Fa,{onListenerAdd:Fa,onListenerRemove:Fa}));
this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,na=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=na)},y.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,na=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=na)},y.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate,na=>B.setFrameDuration(0<na?1E3/Math.ceil(na):0),y.initial);this.updatingHandles.add(()=>this.map?.ground,
Fa,y.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),y.syncAndInitial);this.handles.add(y.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),y.sync))};bb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=w.destroyMaybe(this.sharedSymbolResources),this._set("labeler",w.destroyMaybe(this.labeler)),
this._set("deconflictor",w.destroyMaybe(this.deconflictor)),this._resourceController=w.destroyMaybe(this._resourceController),this._set("stateManager",w.destroyMaybe(this.stateManager)),this._set("inputManager",w.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",w.destroyMaybe(this.environmentManager)),this.groundView=w.destroyMaybe(this.groundView))};bb.installContentCameraReset=function(Fa=
{sticky:!1}){return this.stateManager.installContentCameraReset(Fa)};bb.castEnvironment=function(Fa){return Fa?Fa instanceof ba?Fa:Fa instanceof Qa?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Fa):ba.fromWebsceneEnvironment(Fa):F.ensureType(ba,Fa):new ba};bb.on=function(Fa,na,Da,Ma){return(Da=this.viewEvents.on(Fa,na,Da,Ma))?Da:ab.prototype.on.call(this,Fa,na)};bb.hasEventListener=function(Fa){return ab.prototype.hasEventListener.call(this,Fa)||this.viewEvents.hasHandler(Fa)};
bb.toMap=function(Fa,na){if(!this.ready)return t.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;na=na?this.externalToInternalIntersectOptions(na):this._defaultToMapOptions;var Da=w.isSome(na.graphics)&&(w.isSome(na.graphics.include)||w.isSome(na.graphics.exclude));Fa=La.isSupportedScreenPointEvent(Fa)?La.createScreenPointFromSupportedEvent(this,Fa):Fa;Fa=C.screenPointObjectToArray(Fa);na.enableDraped=na.include&&!na.include.has(Ea.TERRAIN_ID)||
na.exclude&&na.exclude.has(Ea.TERRAIN_ID);const Ma=this.sceneIntersectionHelper,Pa=Sa.newIntersector(this.state.viewingMode);Pa.options.selectionMode=!0;Pa.options.store=Da?ja.StoreResults.ALL:ja.StoreResults.MIN;Ma.intersectIntersectorScreen(Fa,Pa,na);if(Da){for(const Wa of Pa.results.all)if(Da=qa.toHit(Wa,this),w.isNone(Da)||"graphic"!==Da.type||this._testGraphicUidFilter(na.graphics,Da.graphic))return this._intersectResultToMapPoint(Wa);return null}return this._intersectResultToMapPoint(Pa.results.min)};
bb.toScreen=function(Fa){if(!this.ready)return t.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const na=w.unwrapOr(null==Fa.z&&ra.getElevationAtPoint(this.elevationProvider,Fa),0);K.projectPointToVector(Fa,sb,this.renderSpatialReference,na);this.state.camera.projectToScreen(sb,vb);return C.createScreenPoint(vb[0],vb[1])};bb.pixelSizeAt=function(Fa){if(!this.ready)return t.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if(!Fa)return 0;K.projectPointToVector(Fa,sb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(sb)};bb.overlayPixelSizeInMapUnits=function(Fa){const na=this.basemapTerrain.overlayManager;return na?na.overlayPixelSizeInMapUnits(Fa):1};bb.hitTest=function(Fa,na){if(!this.ready)return t.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;Fa=La.isSupportedScreenPointEvent(Fa)?La.createScreenPointFromSupportedEvent(this,
Fa):Fa;var Da=C.createScreenPointArray(Fa.x,Fa.y),Ma=na?this.externalToInternalIntersectOptions(na):this._defaultHitTestOptions;Ma.requiresGroundFeedback=!0;Ma.enableDraped=!0;na=Sa.newIntersector(this.state.viewingMode);na.options.selectionMode=!0;na.options.store=ja.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Da,na,Ma);Da=this._intersectResultsToHits(na.results.all,Ma.graphics);Ma=na.results.ground;var Pa=qa.toOwner(Ma,this);Pa=w.isSome(Pa)&&"type"in Pa&&"integrated-mesh"===
Pa.type?Pa:null;Fa={screenPoint:Fa,results:Da,ground:{mapPoint:this._intersectResultToMapPoint(Ma),distance:Ta.isValidIntersectorResult(Ma)?Ma.distanceInRenderSpace:0,layer:Pa}};la.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Fa.intersector=na);return Promise.resolve(Fa)};bb.popupHitTest=function(){var Fa=b._asyncToGenerator(function*(na){const {results:Da,ground:Ma}=yield Oa.hitTestSelectSimilarDistance(this,na);let Pa=null;!(0===Da.length||1E-5>Math.abs(w.unwrapOr(Da[0].distance,0)-Ma.distance))||Ma.layer&&
"integrated-mesh"===Ma.layer.type||(Pa=Ma.mapPoint);return{results:Da,screenPoint:na,mapPoint:Pa}});return function(na){return Fa.apply(this,arguments)}}();bb.goTo=function(Fa,na){return this.updatingHandles.addPromise(this.stateManager.goTo(Fa,na))};bb.whenAnalysisView=function(){var Fa=b._asyncToGenerator(function*(na){if(w.isNone(na.parent))throw new d("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:na});switch(na.parent.type){case "line-of-sight":case "dimension":return(yield this.whenLayerView(na.parent)).whenAnalysisView();
default:return this.analysisViewManager.whenAnalysisView(na)}});return function(na){return Fa.apply(this,arguments)}}();bb.whenLayerView=function(Fa){return ab.prototype.whenLayerView.call(this,Fa)};bb.takeScreenshot=function(){var Fa=b._asyncToGenerator(function*(na){na=this._completeSettings(na);yield this.whenReady();const Da=yield this._stage.renderView.takeScreenshot(na);return Ua.encode(Da,na,this._pixelFormat())});return function(na){return Fa.apply(this,arguments)}}();bb._takeScreenshot=function(){var Fa=
b._asyncToGenerator(function*(na){na=this._completeSettings(na);yield this.whenReady();na=yield this._stage.renderView.takeScreenshot(na);return Ua.encodeData(na,this._pixelFormat())});return function(na){return Fa.apply(this,arguments)}}();bb._completeSettings=function(Fa){Fa=Ua.toRenderSettings(Fa,this);Fa.pixelRatio/=this.state.pixelRatio;return Ua.screenshotSuperSampleSettings(Fa,this.supersampleScreenshotsEnabled,this.padding)};bb._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};
bb.takeScreenshotWithObjectAndLayerId=function(){var Fa=b._asyncToGenerator(function*(na){if(!l("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");var Da=this._completeSettings(na);yield this.whenReady();var Ma=yield this._stage.renderView.takeScreenshotWithOID(Da);Da=Ua.encode(Ma[0],Da,this._pixelFormat());na=this._completeSettings(na);na.format="png";Ma=Ua.encode(Ma[1],na,this._pixelFormat());return[Da,Ma]});return function(na){return Fa.apply(this,
arguments)}}();bb.getColorToObjectAndLayerIdMapping=function(){if(!l("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView._objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()};bb.addUpdatingPromise=function(Fa){return this.updatingHandles.addPromise(Fa)};bb.importLayerView=function(Fa){return X.layerView3DImporter.importLayerView(Fa)};bb.hasLayerViewModule=function(Fa){return X.layerView3DImporter.hasLayerViewModule(Fa)};
bb.forceDOMReadyCycle=function(){this.forceReadyCycle()};bb.getDefaultSpatialReference=function(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null};bb.validate=function(){var Fa=b._asyncToGenerator(function*(){let na=xa.check(this.type);l("safari")&&9>l("safari")&&(na=new d("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",
{type:"safari",requiredVersion:9,detectedVersion:l("safari")}));if(w.isSome(na))throw t.getLogger(this.declaredClass).warn("#validate()",na.message),na;});return function(){return Fa.apply(this,arguments)}}();bb.getSpatialReferenceSupport=function({spatialReference:Fa,layer:na}){var Da=this._predeterminedViewingMode;if(w.isSome(Da))return this._validateSpatialReferenceForViewingMode(Fa,na,Da)?{constraints:this._makeSpatialReferenceConstraints(Fa,na,Da)}:null;Da=this._validateSpatialReferenceForViewingMode(Fa,
na,R.ViewingMode.Local);const Ma=this._validateSpatialReferenceForViewingMode(Fa,na,R.ViewingMode.Global);return Da||Ma?Da&&Ma?{constraints:this._makeSpatialReferenceConstraints(Fa,na,null)}:Da?{constraints:this._makeSpatialReferenceConstraints(Fa,na,R.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Fa,na,R.ViewingMode.Global)}:null};bb._validateSpatialReferenceForViewingMode=function(Fa,na,Da){return ta.isSpatialReferenceSupported(Fa,Da)?w.isNone(na)||I.isImageryTileLayer(na)?
!0:I.isTiledLayer(na)&&w.isNone(Na.getTiledLayerInfo(na,Fa,Da))||I.isVoxelLayer(na)&&Da===R.ViewingMode.Global?!1:!0:!1};bb._makeSpatialReferenceConstraints=function(Fa,na,Da){if(w.isNone(na))return[{spatialReference:Fa,viewingMode:Da}];const Ma=Fa.isWebMercator,Pa=Fa.isWGS84;return I.isImageryTileLayer(na)&&(Ma||Pa)?(Pa&&Da!==R.ViewingMode.Local?null===Na.checkIfTileInfoSupportedForView(na.tileInfo,na.fullExtent,Fa,R.ViewingMode.Global):1)?[{spatialReference:Fa,viewingMode:Da},{spatialReference:Xa.WebMercator,
viewingMode:Da}]:[{spatialReference:Ma?Xa.WGS84:Xa.WebMercator,viewingMode:Da}]:I.isTiledLayer(na)||I.isVoxelLayer(na)||!Ma&&!Pa?I.isTiledLayer(na)&&Ma&&Da!==R.ViewingMode.Global?[{spatialReference:Fa,viewingMode:Da},{spatialReference:Xa.WGS84,viewingMode:R.ViewingMode.Local}]:[{spatialReference:Fa,viewingMode:Da}]:[{spatialReference:Fa,viewingMode:Da},{spatialReference:Ma?Xa.WGS84:Xa.WebMercator,viewingMode:Da}]};bb._validateSpatialReference=function(Fa){const na=w.isSome(this.getSpatialReferenceSupport({spatialReference:Fa})),
Da=this._predeterminedViewingMode;na||(w.isSome(Da)?t.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${R.stringFromViewingMode(Da)} viewing mode.`):Fa.isGeographic&&t.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported."));return na};bb.whenReady=function(){return new Promise(Fa=>{this.ready?Fa(this):this._resolveWhenReady.push(Fa)})};bb.computeMapPointFromVec3d=function(Fa,na){let Da=this.spatialReference||Xa.WGS84;
K.projectVectorToVector(Fa,this.renderSpatialReference,Fa,Da)||(Da=Xa.WGS84,K.projectVectorToVector(Fa,this.renderSpatialReference,Fa,Da));na?(na.x=Fa[0],na.y=Fa[1],na.z=Fa[2],na.spatialReference=Da):na=new cb(Fa,Da);return na};bb.trackGraphicState=function(Fa){if(!Fa.graphic)return t.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const na=this.getViewForGraphic(Fa.graphic);let Da=null,Ma=!1;const Pa=Wa=>{!Ma&&w.isSome(Wa)&&
"processor"in Wa&&"graphics-3d"===Wa.processor?.type&&Wa.processor.graphicsCore&&(Da=Wa.processor.graphicsCore.trackGraphicState(Fa))};w.isSome(na)?Pa(na):this.whenViewForGraphic(Fa.graphic,{waitForLayer:!0}).then(Wa=>Pa(Wa),()=>{}).catch(()=>{});return{remove:()=>{Ma=!0;w.isSome(Da)&&(Da.remove(),Da=null)}}};bb.highlight=function(Fa){if(Array.isArray(Fa))return e.handlesGroup(Fa.map(Da=>this.highlight(Da)));if(g.isCollection(Fa))return e.handlesGroup(Fa.toArray().map(Da=>this.highlight(Da)));const na=
this.getViewForGraphic(Fa);return na&&"highlight"in na?na.highlight(Fa):e.makeHandle()};bb.maskOccludee=function(Fa){if(!Fa)return t.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const na=this.getViewForGraphic(Fa);let Da=null,Ma=!1;const Pa=Wa=>{!Ma&&w.isSome(Wa)&&Va.occludeesSupported(Wa)&&(Da=Wa.maskOccludee(Fa))};w.isSome(na)?Pa(na):this.whenViewForGraphic(Fa,{waitForLayer:!0}).then(Wa=>Pa(Wa),()=>{}).catch(()=>
{});return{remove:()=>{Ma=!0;w.isSome(Da)&&(Da.remove(),Da=null)}}};bb.getViewForGraphic=function(Fa){return Fa.layer===this.graphics?this.graphicsView:Fa.layer?this.allLayerViews.find(na=>na.layer===Fa.layer):null};bb.graphicChanged=function(Fa){w.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Fa)};bb.whenViewForGraphic=function(){var Fa=b._asyncToGenerator(function*(na,Da){if(na.layer===this)return yield y.whenOnce(()=>this.graphicsView),this.graphicsView;if(!na.layer||!this.map)throw new d("no-view-for-graphic");
return Da&&Da.waitForLayer&&!this.map.allLayers.includes(na.layer)?new Promise((Ma,Pa)=>{const Wa=this.map.allLayers.on("change",$a=>{$a.added.includes(na.layer)&&(Wa.remove(),this.whenLayerView(na.layer).then(Ma,Pa))})}):this.whenLayerView(na.layer)});return function(na,Da){return Fa.apply(this,arguments)}}();bb.externalToInternalIntersectOptions=function(Fa){const na=this._externalToInternalRenderItems(Fa.include,nb.INCLUDE);Fa=this._externalToInternalRenderItems(Fa.exclude,nb.EXCLUDE);return{include:na.layerUids,
exclude:Fa.layerUids,graphics:{include:na.graphicUids,exclude:Fa.graphicUids}}};bb._intersectResultToMapPoint=function(Fa,na){return Fa.getIntersectionPoint(sb)?(na=this.computeMapPointFromVec3d(sb,na),Fa.intersector===ja.IntersectorType.TERRAIN&&this.basemapTerrain&&(na.z=w.unwrapOr(ra.getElevationAtPoint(this.basemapTerrain,na),0)),na):null};bb._intersectResultsToHits=function(Fa,na){const Da=[];let Ma=null;for(let $a=0;$a<Fa.length;$a++){const eb=Fa[$a];var Pa=qa.toOwner(eb,this);if(w.isSome(Pa)&&
(Pa===this.map.ground||"type"in Pa&&"integrated-mesh"===Pa.type))break;Pa=qa.toHit(eb,this);if(!w.isNone(Pa)){if("graphic"===Pa.type){w.isNone(Ma)&&$a!==Fa.length-1&&(Ma=new Set);if(w.isSome(Ma)){var Wa=this._getGraphicFilterUid(Pa.graphic);if(Ma.has(Wa))continue;Ma.add(Wa)}if(!this._testGraphicUidFilter(na,Pa.graphic))continue}Wa=this._intersectResultToMapPoint(eb);Da.push({...Pa,mapPoint:Wa,distance:eb.distanceInRenderSpace})}}return Da};bb._getGraphicFilterUid=function(Fa){var na=Fa.sourceLayer,
Da=Fa.layer;if(na=na&&"objectIdField"in na?na:Da&&"objectIdField"in Da?Da:na)if(Da=Fa.attributes[na.objectIdField??E.fallbackObjectIDAttribute])return`o-${na.id}-${Da}`;return`u-${Fa.uid}`};bb._testGraphicUidFilter=function(Fa,na){na=this._getGraphicFilterUid(na);return w.isNone(Fa)||(w.isNone(Fa.include)||Fa.include.has(na))&&(w.isNone(Fa.exclude)||!Fa.exclude.has(na))};bb._externalToInternalRenderItems=function(Fa,na,Da={layerUids:null,graphicUids:null}){if(!Fa)return Da;if(Fa instanceof n){var Ma=
this._getGraphicFilterUid(Fa);Da.graphicUids||(Da.graphicUids=new Set);Da.graphicUids.add(Ma);na===nb.INCLUDE&&(w.isSome(this.graphicsView)&&Fa.layer===this?fb(Da,this.graphicsView.processor.layer.id):Fa.layer&&fb(Da,Fa.layer.uid))}else if(A.isIterable(Fa))for(Ma of Fa)Ma===this.graphics&&w.isSome(this.graphicsView)?fb(Da,this.graphicsView.processor.layer.id):Ma===this.map.ground?fb(Da,Ea.TERRAIN_ID):this._externalToInternalRenderItems(Ma,na,Da);else"uid"in Fa&&fb(Da,Fa.uid);return Da};bb._initBasemapTerrain=
function(){this._set("basemapTerrain",new ya({view:this}));this._set("elevationProvider",new da.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};bb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};bb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();
this._initBasemapTerrain();this._set("pointsOfInterest",new wa.PointsOfInterest({view:this}));this._set("featureTiles",new Z.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Fa=()=>{var na=this.basemapTerrain?.extent;this.clippingArea||na?na&&this.basemapTerrain.spatialReference?
(na=w.isSome(this.basemapTerrain.extent)&&w.isSome(this.basemapTerrain.spatialReference)?K.project(O.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,w.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(na):this.featureTiles.filterExtent=na):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>la.FEATURE_TILE_TREE_SHOW_TILES,na=>
{na&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Da,Ma)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Da,Ma))).then(({FeatureTileTree3DDebugger:Da})=>{!this._featureTreeDebugger&&la.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Da({view:this}))}):na||!this._featureTreeDebugger||la.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},y.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,
Fa,y.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Fa,y.syncAndInitial)],"feature-tiles");this.stateManager.init()};bb._exitGlobe=function(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};bb._initCoordinateSystem=
function(){if(this.spatialReference){var Fa=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Fa)||this._set("mapCoordsHelper",new ua.MapCoordsHelper(this.map,Fa));const na=this.state.isGlobal;Fa=N.renderSRFromViewSR(na,Fa);Fa!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Ja.RenderCoordsHelper.create(this.state.viewingMode,Fa)),na||this.handles.add(y.watch(()=>this.basemapTerrain?.extent,Da=>{const Ma=this.renderCoordsHelper.spatialReference;
Da&&(0!==Da[0]||0!==Da[1]||0!==Da[2]||0!==Da[3])&&K.projectBoundingRect(Da,this.basemapTerrain.spatialReference,Bb,Ma)&&(this.renderCoordsHelper.extent=Bb)},y.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Sa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};bb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),
this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};bb._updatingChanged=function(){this.notifyChange("updating")};bb._updateUpdatingMonitors=function(Fa=null){w.isSome(Fa)&&Fa.type===u.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(na=>{na.destroyed||(this.handles.add(y.watch(()=>[na.updating,na.updatingProgress],()=>this._updatingChanged(),y.sync),"updatingMonitors"),na.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),
this._updatingChanged())};bb._prepareScreenshotOverlay=function(){var Fa=b._asyncToGenerator(function*(){this.overlay&&(yield this.overlay.prepare())});return function(){return Fa.apply(this,arguments)}}();bb._renderScreenshotOverlay=function(Fa,na){if(!this.overlay||!this.overlay.hasVisibleItems)return na;const Da=Fa.getContext("2d");Da.putImageData(na,0,0);this.overlay.renderCanvas(Fa);return Da.getImageData(0,0,na.width,na.height)};bb._initStage=function(){var Fa={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,
debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:($a,eb)=>this._renderScreenshotOverlay($a,eb)}};const na=new ea.SceneIntersectionHelper(this.state.viewingMode,$a=>this._stage.layers.forAll($a),this);this._set("sceneIntersectionHelper",na);const Da=h.byId(this.surface),{resourceController:Ma,state:Pa,renderSpatialReference:Wa}=
this;this._stage=new Ra.Stage({options:Fa,container:Da,resourceController:Ma,state:Pa,sceneIntersectionHelper:na,renderSR:Wa});this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=f.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new d("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),
y.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),y.initial),y.watch(()=>this.magnifier,$a=>this._stage.renderView.magnifier=$a,y.syncAndInitial)],"stage");Fa=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Aa.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,
this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],Fa),"stage");Fa();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Sa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};bb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=
null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};bb._initSurface=function(Fa){this._exitSurface();this.state.init(Fa,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ha.SharedSymbolResources({view:this,viewingMode:Fa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};bb._exitSurface=function(){this.sharedSymbolResources&&
(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};bb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=new AbortController;var Fa=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Fa,
Fa);this._updatingChanged()}};bb._createGraphicsViewAsync=function(){var Fa=b._asyncToGenerator(function*(na){const Da=(yield new Promise((Ma,Pa)=>a(["./3d/layers/GraphicsView3D"],Wa=>Ma(qb(Wa)),Pa))).default;z.throwIfAborted(na);yield y.whenOnce(()=>this.basemapTerrain?.ready,na);this._set("graphicsView",new Da({view:this}))});return function(na){return Fa.apply(this,arguments)}}();bb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),
this._createGraphicsViewController=null);this.handles.remove("graphics-view");w.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};bb._startup=function(){var Fa=R.viewingModeFromString(this.viewingMode);Fa===R.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Fa);this._set("ready",!0);this.handles.add(y.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");
this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Fa=this.get("map.initialViewProperties.environment"))&&(this.environment=Fa);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Fa=this._resolveWhenReady;this._resolveWhenReady=[];Fa.forEach(na=>na(this))};bb._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();
this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};bb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ea.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===Fa.type&&this._defaultToMapOptions.include.add(Fa.uid)}};bb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&
this._defaultHitTestOptions.exclude.add(Ea.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===Fa.type&&1>Fa.opacity&&this._defaultToMapOptions.exclude.add(Fa.uid)}};bb.addVoxelLayerViewToWasm=function(Fa){return w.isNone(this.voxelWasm)?(w.isNone(this.voxelWasmPromise)&&(this.voxelWasmPromise=(new Promise((na,Da)=>a(["../layers/VoxelWasmPerSceneView"],Ma=>na(qb(Ma)),Da))).then(na=>this.voxelWasm=new na.default(this))),this.voxelWasmPromise.then(na=>na.addVoxelLayer(Fa))):this.voxelWasm.addVoxelLayer(Fa)};
bb.removeVoxelLayerViewFromWasm=function(Fa){w.isSome(this.voxelWasm)&&1>this.voxelWasm.removeVoxelLayer(Fa)&&(this.voxelWasmPromise=this.voxelWasm=null)};b._createClass(ib,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain?.spatialReference}},{key:"animation",get:function(){return this.state?.animation}},{key:"camera",get:function(){return this.stateManager?.camera},
set:function(Fa){this.stateManager&&(this.stateManager.camera=Fa)}},{key:"contentCamera",get:function(){return this.stateManager?.contentCamera},set:function(Fa){this.stateManager&&(this.stateManager.contentCamera=Fa)}},{key:"center",get:function(){return this.stateManager?.center},set:function(Fa){this.stateManager&&(this.stateManager.center=Fa)}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Fa=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&
!this.get("map.clippingEnabled")||w.isNone(Fa))return this._clippingArea=null;if(!(Fa instanceof db))return t.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Fa=jb(Fa,this.spatialReference),w.isNone(Fa)))return t.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Fa=Fa.clone();w.isNone(Fa.intersection(this._groundAndLayersExtent))&&
(Fa.xmin=Fa.xmax,Fa.ymin=Fa.ymax);Fa.zmin=void 0;Fa.zmax=void 0;Fa.equals(this._clippingArea)||(this._clippingArea=Fa);return this._clippingArea},set:function(Fa){this.ready&&"global"===this.viewingMode&&w.isSome(Fa)?t.getLogger(this.declaredClass).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Fa}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===R.ViewingMode.Global)return null;const Fa=this.renderSpatialReference,na=this.dataExtent;
return w.isNone(na)||w.isNone(Fa)||na.spatialReference.equals(Fa)?na:jb(na,Fa)}},{key:"dataExtent",get:function(){let Fa=this._groundAndLayersExtent;var na=jb(this.clippingArea,this.spatialReference||Xa.WGS84);w.isSome(na)&&(Fa=w.isSome(Fa)?Fa.intersection(na):na);na=this._get("dataExtent");return w.isSome(Fa)&&Fa.equals(na)?na:Fa}},{key:"_groundAndLayersExtent",get:function(){const Fa=this.spatialReference||Xa.WGS84;let na;const Da=Pa=>{Pa=jb(Pa,Fa);w.isNone(Pa)||(w.isSome(na)?na.union(Pa):na=Pa.clone())};
var Ma=this.basemapTerrain;if(Ma?.spatialReference){const Pa=Ma.groundExtent;Da(new db({xmin:Pa[0],ymin:Pa[1],zmin:0,xmax:Pa[2],ymax:Pa[3],zmax:0,spatialReference:Ma.spatialReference}))}this.map&&this.map.allLayers.forEach(Pa=>{!w.isSome(Pa.fullExtent)||"graphics"===Pa.type&&Pa.internal||Da(Pa.fullExtent)});if(w.isNone(na))return null;na.hasZ?(na.zmin=Math.min(0,na.zmin),na.zmax=Math.max(0,na.zmax)):(na.zmin=0,na.zmax=0);Ma=this._get("_groundAndLayersExtent");return na.equals(Ma)?Ma:na}},{key:"environment",
set:function(Fa){Fa!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Fa)}},{key:"extent",get:function(){return this.stateManager?.extent},set:function(Fa){this.stateManager&&(this.stateManager.extent=Fa)}},{key:"screenCenter",get:function(){return this.stateManager?.screenCenter}},{key:"frustum",get:function(){return this.stateManager?.frustum}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",
get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||w.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(w.isNone(this.state)||this.state.stationary)}},{key:"navigating",get:function(){return this.state?.navigating??!1}},{key:"padding",get:function(){return this.stateManager?.padding},set:function(Fa){this.stateManager&&(this.stateManager.padding=Fa)}},{key:"qualityProfile",
get:function(){return this._get("qualityProfile")||oa.getDefaultProfile()},set:function(Fa){oa.isValidProfile(Fa)&&(oa.apply(Fa,this.qualitySettings),this._set("qualityProfile",Fa))}},{key:"slicePlane",set:function(Fa){w.isSome(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:Fa});if(w.isNone(Fa))this._set("slicePlane",null);else{var na=this._propertiesPool.get("slicePlane");P.copy(Fa,na);this._set("slicePlane",na)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},
{key:"resolution",get:function(){return null!=this.spatialReference?H.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"scale",get:function(){return this.stateManager?.scale},set:function(Fa){this.stateManager&&(this.stateManager.scale=Fa)}},{key:"heightModelInfo",get:function(){const Fa=this.getDefaultHeightModelInfo();return null!=Fa?L.deriveUnitFromSR(Fa,this.spatialReference):null}},{key:"updating",get:function(){if(this.destroyed)return!1;let Fa=0,na=this.layerViewManager.updating,
Da=na?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(Wa=>{Wa.isFulfilled()?Wa.updating&&(na=!0,Wa.suspended||Na.isSurfaceLayerView(Wa)||(++Da,Fa+=Wa.updatingProgress)):++Da});for(var Ma of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])w.isSome(Ma)&&Ma.updating&&(Da+=.1,Fa+=.05);for(var Pa of[this.deconflictor,
this.labeler,this.basemapTerrain])w.isSome(Pa)&&Pa.updating&&(++Da,Fa+=Pa.updatingProgress);(na=!!(na||0<Da||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some(Wa=>!Wa.isFulfilled())))?(this._numUpdating=Math.max(Da,this._numUpdating),Fa+=this._numUpdating-Da):this._numUpdating=0;Fa=0<this._numUpdating?Fa/this._numUpdating:na?0:1;this._get("updatingProgress")!==Fa&&(Ma=performance.now(),1>
Fa&&(Pa=Math.min((Ma-this._lastUpdateTime)/2E3,1),Fa=this.updatingProgress*(1-Pa)+Fa*Pa),this._set("updatingProgress",Fa),this._lastUpdateTime=na&&1>Fa?Ma:0);return na}},{key:"viewingMode",get:function(){var Fa=this._predeterminedViewingMode;return w.isSome(Fa)?R.stringFromViewingMode(Fa):(Fa=this.spatialReference)?w.isSome(this.defaultsFromMap?.viewingMode)&&Fa.equals(this.defaultsFromMap.spatialReference)?R.stringFromViewingMode(this.defaultsFromMap.viewingMode):ta.isSpatialReferenceSupported(Fa,
R.ViewingMode.Global)?"global":"local":"global"},set:function(Fa){this.ready?t.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Fa)}},{key:"viewpoint",get:function(){return this.stateManager?.viewpoint},set:function(Fa){this.stateManager&&(this.stateManager.viewpoint=Fa)}},{key:"zoom",get:function(){return this.stateManager?.zoom},set:function(Fa){this.stateManager&&(this.stateManager.zoom=Fa)}},{key:"resourceController",
get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Ba(this)}},{key:"test",get:function(){return{takeScreenshot:Fa=>this._takeScreenshot(Fa)}}},{key:"_predeterminedViewingMode",get:function(){const Fa=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return w.isSome(Fa)?R.viewingModeFromString(Fa):null}}]);return ib}(Q.BreakpointsOwner(T.DOMContainer(U.PopupView(Y))));
m.type="3d";c.__decorate([q.property()],m.prototype,"_userClippingArea",void 0);c.__decorate([q.property()],m.prototype,"_resourceController",void 0);c.__decorate([q.property()],m.prototype,"_stage",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"deconflictor",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"labeler",void 0);c.__decorate([q.property(J.owningCollectionProperty(M.AnalysesCollection,"analyses"))],m.prototype,"analyses",void 0);c.__decorate([q.property({type:V,
readOnly:!0})],m.prototype,"animation",null);c.__decorate([q.property({readOnly:!0})],m.prototype,"basemapTerrain",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"elevationProvider",void 0);c.__decorate([q.property()],m.prototype,"camera",null);c.__decorate([q.property({type:r})],m.prototype,"contentCamera",null);c.__decorate([q.property({readOnly:!0})],m.prototype,"canvas",void 0);c.__decorate([q.property({type:cb})],m.prototype,"center",null);c.__decorate([q.property({type:db})],m.prototype,
"clippingArea",null);c.__decorate([q.property({type:aa.Constraints})],m.prototype,"constraints",void 0);c.__decorate([q.property({type:db,readOnly:!0})],m.prototype,"renderDataExtent",null);c.__decorate([q.property({type:db,readOnly:!0})],m.prototype,"dataExtent",null);c.__decorate([q.property({type:db,readOnly:!0})],m.prototype,"_groundAndLayersExtent",null);c.__decorate([q.property({value:null,type:ba})],m.prototype,"environment",null);c.__decorate([v.cast("environment")],m.prototype,"castEnvironment",
null);c.__decorate([q.property({readOnly:!0})],m.prototype,"environmentManager",void 0);c.__decorate([q.property({type:db})],m.prototype,"extent",null);c.__decorate([q.property()],m.prototype,"floors",void 0);c.__decorate([q.property()],m.prototype,"screenCenter",null);c.__decorate([q.property()],m.prototype,"frustum",null);c.__decorate([q.property({type:Number,readOnly:!0})],m.prototype,"fullOpacity",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"graphicsView",void 0);c.__decorate([q.property({readOnly:!0})],
m.prototype,"analysisViewManager",void 0);c.__decorate([q.property()],m.prototype,"groundView",void 0);c.__decorate([q.property({type:Boolean})],m.prototype,"initialExtentRequired",null);c.__decorate([q.property()],m.prototype,"_defaultsFromMapSettings",null);c.__decorate([q.property()],m.prototype,"interacting",null);c.__decorate([q.property()],m.prototype,"stationary",null);c.__decorate([q.property()],m.prototype,"navigating",null);c.__decorate([q.property()],m.prototype,"map",void 0);c.__decorate([q.property({readOnly:!0})],
m.prototype,"mapCoordsHelper",void 0);c.__decorate([q.property()],m.prototype,"padding",null);c.__decorate([q.property({type:wa.PointsOfInterest,readOnly:!0})],m.prototype,"pointsOfInterest",void 0);c.__decorate([q.property({type:Z.FeatureTileTree3D,readOnly:!0})],m.prototype,"featureTiles",void 0);c.__decorate([q.property()],m.prototype,"_featureTreeDebugger",void 0);c.__decorate([q.property({type:Boolean})],m.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([q.property({constructOnly:!0})],
m.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([q.property({constructOnly:!0})],m.prototype,"debugWebGLExtensions",void 0);c.__decorate([q.property({constructOnly:!0})],m.prototype,"renderCanvas",void 0);c.__decorate([q.property({constructOnly:!0})],m.prototype,"state",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"inputManager",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"stateManager",void 0);c.__decorate([q.property({type:["low","medium","high"]})],
m.prototype,"qualityProfile",null);c.__decorate([q.property({type:va,get(){let ab=this._get("qualitySettings");ab||(ab=new va,oa.apply(this.qualityProfile,ab));return ab}})],m.prototype,"qualitySettings",void 0);c.__decorate([q.property()],m.prototype,"slicePlane",null);c.__decorate([q.property({readOnly:!0})],m.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([q.property({readOnly:!0})],m.prototype,"renderCoordsHelper",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"sceneIntersectionHelper",
void 0);c.__decorate([q.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],m.prototype,"resolution",null);c.__decorate([q.property({type:Number})],m.prototype,"scale",null);c.__decorate([q.property()],m.prototype,"heightModelInfo",null);c.__decorate([q.property()],m.prototype,"spatialReference",void 0);c.__decorate([q.property({type:Boolean,constructOnly:!0})],m.prototype,"alphaCompositingEnabled",void 0);c.__decorate([q.property({constructOnly:!0})],m.prototype,"preserveDrawingBufferEnabled",
void 0);c.__decorate([q.property({type:Boolean})],m.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([q.property({readOnly:!0})],m.prototype,"type",void 0);c.__decorate([q.property({type:Ia})],m.prototype,"ui",void 0);c.__decorate([q.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating".split(" ")})],
m.prototype,"updating",null);c.__decorate([q.property({type:Number,readOnly:!0,dependsOn:["updating"]})],m.prototype,"updatingProgress",void 0);c.__decorate([q.property({type:["global","local"]})],m.prototype,"viewingMode",null);c.__decorate([q.property({type:p})],m.prototype,"viewpoint",null);c.__decorate([q.property({type:Number})],m.prototype,"zoom",null);c.__decorate([q.property({type:Aa})],m.prototype,"highlightOptions",void 0);m=c.__decorate([D.subclass("esri.views.SceneView")],m);var nb;(function(ab){ab[ab.INCLUDE=
0]="INCLUDE";ab[ab.EXCLUDE=1]="EXCLUDE"})(nb||(nb={}));const sb=G.create(),vb=C.createScreenPointArray(),Bb=O.create();return m});