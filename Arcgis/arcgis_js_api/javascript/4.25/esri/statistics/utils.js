// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.25/esri/copyright.txt for details.
//>>built
define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(l,G,H){function r(a){return null==a||"string"===typeof a&&!a?"\x3cNull\x3e":a}function w(a){const b=null!=a.minValue||null!=a.maxValue,c=!!a.sqlExpression&&a.supportsSQLExpression;return!(null!=a.normalizationField||null!=a.normalizationType)&&!b&&!c}function x(a){const {values:b,useSampleStdDev:c,supportsNullCount:f}=a;var g=Number.POSITIVE_INFINITY;let e=Number.NEGATIVE_INFINITY,d=null,k=
null;var h=null;let p=null,m=0;const q=null==a.minValue?-Infinity:a.minValue,t=null==a.maxValue?Infinity:a.maxValue;for(const n of b)Number.isFinite(n)?n>=q&&n<=t&&(d+=n,g=Math.min(g,n),e=Math.max(e,n),m++):"string"===typeof n&&m++;if(m&&null!=d){k=d/m;h=0;for(const n of b)Number.isFinite(n)&&n>=q&&n<=t&&(h+=(n-k)**2);p=c?1<m?h/(m-1):0:0<m?h/m:0;h=Math.sqrt(p)}else e=g=null;g={avg:k,count:m,max:e,min:g,stddev:h,sum:d,variance:p};f&&(g.nullcount=b.length-m);a.percentileParams&&(g.median=u(b,a.percentileParams));
return g}function u(a,b){const {fieldType:c,value:f,orderBy:g,isDiscrete:e}=b,d=y(c,"desc"===g);a=[...a].filter(m=>null!=m).sort((m,q)=>d(m,q));if(0===a.length)return null;if(0>=f)return a[0];if(1<=f)return a[a.length-1];var k=(a.length-1)*f,h=Math.floor(k);b=h+1;k%=1;h=a[h];const p=a[b];return b>=a.length||e||"string"===typeof h||"string"===typeof p?h:h*(1-k)+p*k}function y(a,b){const c=b?1:-1,f=I(b),g=z(b);if(!a||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",
...A].includes(a))return(e,d)=>"number"===typeof e&&"number"===typeof d?f(e,d):"string"===typeof e&&"string"===typeof d?g(e,d):c;if("esriFieldTypeDate"===a)return(e,d)=>{e=(new Date(e)).getTime();d=(new Date(d)).getTime();return isNaN(e)||isNaN(d)?c:f(e,d)};if(A.has(a))return(e,d)=>f(e,d);if("esriFieldTypeString"===a)return(e,d)=>g(e,d);if("esriFieldTypeGUID"===a||"esriFieldTypeGlobalID"===a){const e=z(b);return(d,k)=>e(B(d),B(k))}return b?(e,d)=>1:(e,d)=>-1}function z(a){return a?(b,c)=>{b=b?.toUpperCase();
c=c?.toUpperCase();return b>c?-1:b<c?1:0}:(b,c)=>{b=b?.toUpperCase();c=c?.toUpperCase();return b<c?-1:b>c?1:0}}function I(a){return a?(b,c)=>c-b:(b,c)=>b-c}function B(a){return a.substr(24,12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function v(a){return"coded-value"!==a?.type?[]:a.codedValues.map(b=>b.code)}function C(a,b){const c=D({field:b.field,normalizationType:b.normalizationType,normalizationField:b.normalizationField,
classificationMethod:b.classificationMethod,standardDeviationInterval:b.standardDeviationInterval,breakCount:b.numClasses||5});a=J(a,b.minValue,b.maxValue);return H.createGenerateRendererClassBreaks({definition:c,values:a,normalizationTotal:b.normalizationTotal})}function J(a,b,c){b=null==b?-Infinity:b;c=null==c?Infinity:c;return a.filter(f=>Number.isFinite(f)&&f>=b&&f<=c)}function D(a){const b=a.field,c=a.classificationMethod||"equal-interval",f=a.normalizationType,g=a.normalizationField,e=new G;
e.classificationField=b;e.breakCount=a.breakCount;e.classificationMethod=c;e.standardDeviationInterval="standard-deviation"===c?a.standardDeviationInterval||1:void 0;e.normalizationType=f;e.normalizationField="field"===f?g:void 0;return e}function K(a,b){const {field:c,classificationMethod:f,standardDeviationInterval:g,normalizationType:e,normalizationField:d,normalizationTotal:k,minValue:h,maxValue:p}=b,m=b.numBins||10;let q=b=null,t=null;f&&"equal-interval"!==f||e?({classBreaks:a}=C(a,{field:c,
normalizationType:e,normalizationField:d,normalizationTotal:k,classificationMethod:f,standardDeviationInterval:g,minValue:h,maxValue:p,numClasses:m}),b=a[0].minValue,q=a[a.length-1].maxValue,t=a.map(n=>[n.minValue,n.maxValue])):(null!=h&&null!=p?(b=h,q=p):(a=x({values:a,minValue:h,maxValue:p,useSampleStdDev:!e,supportsNullCount:w({normalizationType:e,normalizationField:d,minValue:h,maxValue:p})}),b=a.min,q=a.max),t=E(b,q,m));return{min:b,max:q,intervals:t}}function L(a,b){let c=-1;for(let f=a.length-
1;0<=f;f--)if(b>=a[f][0]){c=f;break}return c}function E(a,b,c){const f=(b-a)/c,g=[];let e;for(let d=1;d<=c;d++)e=a+f,e=Number(e.toFixed(16)),g.push([a,d===c?b:e]),a=e;return g}const M=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,A=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),F="min max avg stddev count sum variance nullcount median".split(" ");l.calculateClassBreaks=C;l.calculateHistogram=function(a,b){const {min:c,max:f,intervals:g}=K(a,b),
e=g.map((d,k)=>({minValue:g[k][0],maxValue:g[k][1],count:0}));for(const d of a)null!=d&&d>=c&&d<=f&&(a=L(g,d),-1<a&&e[a].count++);return{bins:e,minValue:c,maxValue:f,normalizationTotal:b.normalizationTotal}};l.calculatePercentile=u;l.calculateStatistics=x;l.calculateStringStatistics=function(a){const b=a.returnDistinct?[...(new Set(a.values))]:a.values,c=b.filter(g=>null!=g).length,f={count:c};a.supportsNullCount&&(f.nullcount=b.length-c);a.percentileParams&&(f.median=u(b,a.percentileParams));return f};
l.calculateUniqueValuesCount=function(a){const b={};for(let c of a){if(null==c||"string"===typeof c&&""===c.trim())c=null;null==b[c]?b[c]={count:1,data:c}:b[c].count++}return{count:b}};l.createClassBreaksDefinition=D;l.createUVResult=function(a,b,c,f){a=a.count;const g=[];if(c&&b){c=[];var e=v(b[0]);for(const d of e)if(b[1]){e=v(b[1]);for(const k of e)if(b[2]){e=v(b[2]);for(const h of e)c.push(`${r(d)}${f}${r(k)}${f}${r(h)}`)}else c.push(`${r(d)}${f}${r(k)}`)}else c.push(d);for(const d of c)a.hasOwnProperty(d)||
(a[d]={data:d,count:0})}for(const d in a)b=a[d],g.push({value:b.data,count:b.count,label:b.label});return{uniqueValueInfos:g}};l.getAttributeComparator=y;l.getEqualIntervalBins=E;l.getNormalizedValue=function(a,b,c,f){let g=null;switch(b){case "log":0!==a&&(g=Math.log(a)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(f)&&0!==f&&(g=a/f*100);break;case "field":Number.isFinite(c)&&0!==c&&(g=a/c);break;case "natural-log":0<a&&(g=Math.log(a));break;case "square-root":0<a&&(g=a**.5)}return g};
l.isNullCountSupported=w;l.processNullValue=r;l.processSummaryStatisticsResult=function(a,b){let c;for(c in a)F.includes(c)&&(Number.isFinite(a[c])||(a[c]=null));if(!b)return a;["avg","stddev","variance"].forEach(f=>{null!=a[f]&&(a[f]=Math.ceil(a[f]))});return a};l.resolveCBResult=function(a,b){let c=a.classBreaks;const f=c[0].minValue,g=c[c.length-1].maxValue,e="standard-deviation"===b;c=c.map(d=>{const k=d.label;d={minValue:d.minValue,maxValue:d.maxValue,label:k};if(e&&k){const h=k.match(M).map(p=>
+p.trim());2===h.length?(d.minStdDev=h[0],d.maxStdDev=h[1],0>h[0]&&0<h[1]&&(d.hasAvg=!0)):1===h.length&&(k.includes("\x3c")?(d.minStdDev=null,d.maxStdDev=h[0]):k.includes("\x3e")&&(d.minStdDev=h[0],d.maxStdDev=null))}return d});return{minValue:f,maxValue:g,classBreakInfos:c,normalizationTotal:a.normalizationTotal}};l.statisticTypes=F;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});